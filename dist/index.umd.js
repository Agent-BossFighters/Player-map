(function(wa,Dt){typeof exports=="object"&&typeof module<"u"?Dt(exports,require("react"),require("react-dom")):typeof define=="function"&&define.amd?define(["exports","react","react-dom"],Dt):(wa=typeof globalThis<"u"?globalThis:wa||self,Dt(wa.PlayerMap={},wa.React))})(this,function(wa,Dt){"use strict";var p2={exports:{}},U0={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var RL;function oW(){if(RL)return U0;RL=1;var r=Dt,e=Symbol.for("react.element"),i=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function l(u,c,h){var p,f={},g=null,m=null;h!==void 0&&(g=""+h),c.key!==void 0&&(g=""+c.key),c.ref!==void 0&&(m=c.ref);for(p in c)n.call(c,p)&&!o.hasOwnProperty(p)&&(f[p]=c[p]);if(u&&u.defaultProps)for(p in c=u.defaultProps,c)f[p]===void 0&&(f[p]=c[p]);return{$$typeof:e,type:u,key:g,ref:m,props:f,_owner:s.current}}return U0.Fragment=i,U0.jsx=l,U0.jsxs=l,U0}var z0={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var IL;function lW(){return IL||(IL=1,process.env.NODE_ENV!=="production"&&function(){var r=Dt,e=Symbol.for("react.element"),i=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),l=Symbol.for("react.provider"),u=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),p=Symbol.for("react.suspense_list"),f=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),m=Symbol.for("react.offscreen"),y=Symbol.iterator,b="@@iterator";function v(pe){if(pe===null||typeof pe!="object")return null;var ct=y&&pe[y]||pe[b];return typeof ct=="function"?ct:null}var _=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function C(pe){{for(var ct=arguments.length,Tt=new Array(ct>1?ct-1:0),Jt=1;Jt<ct;Jt++)Tt[Jt-1]=arguments[Jt];E("error",pe,Tt)}}function E(pe,ct,Tt){{var Jt=_.ReactDebugCurrentFrame,Ni=Jt.getStackAddendum();Ni!==""&&(ct+="%s",Tt=Tt.concat([Ni]));var ar=Tt.map(function(Di){return String(Di)});ar.unshift("Warning: "+ct),Function.prototype.apply.call(console[pe],console,ar)}}var T=!1,R=!1,B=!1,I=!1,D=!1,L;L=Symbol.for("react.module.reference");function O(pe){return!!(typeof pe=="string"||typeof pe=="function"||pe===n||pe===o||D||pe===s||pe===h||pe===p||I||pe===m||T||R||B||typeof pe=="object"&&pe!==null&&(pe.$$typeof===g||pe.$$typeof===f||pe.$$typeof===l||pe.$$typeof===u||pe.$$typeof===c||pe.$$typeof===L||pe.getModuleId!==void 0))}function F(pe,ct,Tt){var Jt=pe.displayName;if(Jt)return Jt;var Ni=ct.displayName||ct.name||"";return Ni!==""?Tt+"("+Ni+")":Tt}function q(pe){return pe.displayName||"Context"}function H(pe){if(pe==null)return null;if(typeof pe.tag=="number"&&C("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof pe=="function")return pe.displayName||pe.name||null;if(typeof pe=="string")return pe;switch(pe){case n:return"Fragment";case i:return"Portal";case o:return"Profiler";case s:return"StrictMode";case h:return"Suspense";case p:return"SuspenseList"}if(typeof pe=="object")switch(pe.$$typeof){case u:var ct=pe;return q(ct)+".Consumer";case l:var Tt=pe;return q(Tt._context)+".Provider";case c:return F(pe,pe.render,"ForwardRef");case f:var Jt=pe.displayName||null;return Jt!==null?Jt:H(pe.type)||"Memo";case g:{var Ni=pe,ar=Ni._payload,Di=Ni._init;try{return H(Di(ar))}catch{return null}}}return null}var G=Object.assign,J=0,Q,V,z,te,K,ae,Ae;function _e(){}_e.__reactDisabledLog=!0;function me(){{if(J===0){Q=console.log,V=console.info,z=console.warn,te=console.error,K=console.group,ae=console.groupCollapsed,Ae=console.groupEnd;var pe={configurable:!0,enumerable:!0,value:_e,writable:!0};Object.defineProperties(console,{info:pe,log:pe,warn:pe,error:pe,group:pe,groupCollapsed:pe,groupEnd:pe})}J++}}function Pe(){{if(J--,J===0){var pe={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:G({},pe,{value:Q}),info:G({},pe,{value:V}),warn:G({},pe,{value:z}),error:G({},pe,{value:te}),group:G({},pe,{value:K}),groupCollapsed:G({},pe,{value:ae}),groupEnd:G({},pe,{value:Ae})})}J<0&&C("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var Xe=_.ReactCurrentDispatcher,Je;function tt(pe,ct,Tt){{if(Je===void 0)try{throw Error()}catch(Ni){var Jt=Ni.stack.trim().match(/\n( *(at )?)/);Je=Jt&&Jt[1]||""}return`
`+Je+pe}}var dt=!1,wt;{var qt=typeof WeakMap=="function"?WeakMap:Map;wt=new qt}function yt(pe,ct){if(!pe||dt)return"";{var Tt=wt.get(pe);if(Tt!==void 0)return Tt}var Jt;dt=!0;var Ni=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var ar;ar=Xe.current,Xe.current=null,me();try{if(ct){var Di=function(){throw Error()};if(Object.defineProperty(Di.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Di,[])}catch(lt){Jt=lt}Reflect.construct(pe,[],Di)}else{try{Di.call()}catch(lt){Jt=lt}pe.call(Di.prototype)}}else{try{throw Error()}catch(lt){Jt=lt}pe()}}catch(lt){if(lt&&Jt&&typeof lt.stack=="string"){for(var ki=lt.stack.split(`
`),Ie=Jt.stack.split(`
`),se=ki.length-1,fe=Ie.length-1;se>=1&&fe>=0&&ki[se]!==Ie[fe];)fe--;for(;se>=1&&fe>=0;se--,fe--)if(ki[se]!==Ie[fe]){if(se!==1||fe!==1)do if(se--,fe--,fe<0||ki[se]!==Ie[fe]){var Be=`
`+ki[se].replace(" at new "," at ");return pe.displayName&&Be.includes("<anonymous>")&&(Be=Be.replace("<anonymous>",pe.displayName)),typeof pe=="function"&&wt.set(pe,Be),Be}while(se>=1&&fe>=0);break}}}finally{dt=!1,Xe.current=ar,Pe(),Error.prepareStackTrace=Ni}var Fe=pe?pe.displayName||pe.name:"",Ye=Fe?tt(Fe):"";return typeof pe=="function"&&wt.set(pe,Ye),Ye}function Ei(pe,ct,Tt){return yt(pe,!1)}function $e(pe){var ct=pe.prototype;return!!(ct&&ct.isReactComponent)}function Ui(pe,ct,Tt){if(pe==null)return"";if(typeof pe=="function")return yt(pe,$e(pe));if(typeof pe=="string")return tt(pe);switch(pe){case h:return tt("Suspense");case p:return tt("SuspenseList")}if(typeof pe=="object")switch(pe.$$typeof){case c:return Ei(pe.render);case f:return Ui(pe.type,ct,Tt);case g:{var Jt=pe,Ni=Jt._payload,ar=Jt._init;try{return Ui(ar(Ni),ct,Tt)}catch{}}}return""}var hi=Object.prototype.hasOwnProperty,Ri={},Si=_.ReactDebugCurrentFrame;function Zi(pe){if(pe){var ct=pe._owner,Tt=Ui(pe.type,pe._source,ct?ct.type:null);Si.setExtraStackFrame(Tt)}else Si.setExtraStackFrame(null)}function Vi(pe,ct,Tt,Jt,Ni){{var ar=Function.call.bind(hi);for(var Di in pe)if(ar(pe,Di)){var ki=void 0;try{if(typeof pe[Di]!="function"){var Ie=Error((Jt||"React class")+": "+Tt+" type `"+Di+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof pe[Di]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw Ie.name="Invariant Violation",Ie}ki=pe[Di](ct,Di,Jt,Tt,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(se){ki=se}ki&&!(ki instanceof Error)&&(Zi(Ni),C("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",Jt||"React class",Tt,Di,typeof ki),Zi(null)),ki instanceof Error&&!(ki.message in Ri)&&(Ri[ki.message]=!0,Zi(Ni),C("Failed %s type: %s",Tt,ki.message),Zi(null))}}}var Ge=Array.isArray;function Ce(pe){return Ge(pe)}function At(pe){{var ct=typeof Symbol=="function"&&Symbol.toStringTag,Tt=ct&&pe[Symbol.toStringTag]||pe.constructor.name||"Object";return Tt}}function Pt(pe){try{return $t(pe),!1}catch{return!0}}function $t(pe){return""+pe}function Mt(pe){if(Pt(pe))return C("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",At(pe)),$t(pe)}var yi=_.ReactCurrentOwner,vt={key:!0,ref:!0,__self:!0,__source:!0},ye,ve;function Ne(pe){if(hi.call(pe,"ref")){var ct=Object.getOwnPropertyDescriptor(pe,"ref").get;if(ct&&ct.isReactWarning)return!1}return pe.ref!==void 0}function Te(pe){if(hi.call(pe,"key")){var ct=Object.getOwnPropertyDescriptor(pe,"key").get;if(ct&&ct.isReactWarning)return!1}return pe.key!==void 0}function ke(pe,ct){typeof pe.ref=="string"&&yi.current}function Oe(pe,ct){{var Tt=function(){ye||(ye=!0,C("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",ct))};Tt.isReactWarning=!0,Object.defineProperty(pe,"key",{get:Tt,configurable:!0})}}function U(pe,ct){{var Tt=function(){ve||(ve=!0,C("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",ct))};Tt.isReactWarning=!0,Object.defineProperty(pe,"ref",{get:Tt,configurable:!0})}}var $=function(pe,ct,Tt,Jt,Ni,ar,Di){var ki={$$typeof:e,type:pe,key:ct,ref:Tt,props:Di,_owner:ar};return ki._store={},Object.defineProperty(ki._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(ki,"_self",{configurable:!1,enumerable:!1,writable:!1,value:Jt}),Object.defineProperty(ki,"_source",{configurable:!1,enumerable:!1,writable:!1,value:Ni}),Object.freeze&&(Object.freeze(ki.props),Object.freeze(ki)),ki};function re(pe,ct,Tt,Jt,Ni){{var ar,Di={},ki=null,Ie=null;Tt!==void 0&&(Mt(Tt),ki=""+Tt),Te(ct)&&(Mt(ct.key),ki=""+ct.key),Ne(ct)&&(Ie=ct.ref,ke(ct,Ni));for(ar in ct)hi.call(ct,ar)&&!vt.hasOwnProperty(ar)&&(Di[ar]=ct[ar]);if(pe&&pe.defaultProps){var se=pe.defaultProps;for(ar in se)Di[ar]===void 0&&(Di[ar]=se[ar])}if(ki||Ie){var fe=typeof pe=="function"?pe.displayName||pe.name||"Unknown":pe;ki&&Oe(Di,fe),Ie&&U(Di,fe)}return $(pe,ki,Ie,Ni,Jt,yi.current,Di)}}var Re=_.ReactCurrentOwner,ce=_.ReactDebugCurrentFrame;function Ue(pe){if(pe){var ct=pe._owner,Tt=Ui(pe.type,pe._source,ct?ct.type:null);ce.setExtraStackFrame(Tt)}else ce.setExtraStackFrame(null)}var je;je=!1;function pt(pe){return typeof pe=="object"&&pe!==null&&pe.$$typeof===e}function Lt(){{if(Re.current){var pe=H(Re.current.type);if(pe)return`

Check the render method of \``+pe+"`."}return""}}function xt(pe){return""}var Gt={};function mi(pe){{var ct=Lt();if(!ct){var Tt=typeof pe=="string"?pe:pe.displayName||pe.name;Tt&&(ct=`

Check the top-level render call using <`+Tt+">.")}return ct}}function _r(pe,ct){{if(!pe._store||pe._store.validated||pe.key!=null)return;pe._store.validated=!0;var Tt=mi(ct);if(Gt[Tt])return;Gt[Tt]=!0;var Jt="";pe&&pe._owner&&pe._owner!==Re.current&&(Jt=" It was passed a child from "+H(pe._owner.type)+"."),Ue(pe),C('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',Tt,Jt),Ue(null)}}function Fi(pe,ct){{if(typeof pe!="object")return;if(Ce(pe))for(var Tt=0;Tt<pe.length;Tt++){var Jt=pe[Tt];pt(Jt)&&_r(Jt,ct)}else if(pt(pe))pe._store&&(pe._store.validated=!0);else if(pe){var Ni=v(pe);if(typeof Ni=="function"&&Ni!==pe.entries)for(var ar=Ni.call(pe),Di;!(Di=ar.next()).done;)pt(Di.value)&&_r(Di.value,ct)}}}function gn(pe){{var ct=pe.type;if(ct==null||typeof ct=="string")return;var Tt;if(typeof ct=="function")Tt=ct.propTypes;else if(typeof ct=="object"&&(ct.$$typeof===c||ct.$$typeof===f))Tt=ct.propTypes;else return;if(Tt){var Jt=H(ct);Vi(Tt,pe.props,"prop",Jt,pe)}else if(ct.PropTypes!==void 0&&!je){je=!0;var Ni=H(ct);C("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",Ni||"Unknown")}typeof ct.getDefaultProps=="function"&&!ct.getDefaultProps.isReactClassApproved&&C("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function kr(pe){{for(var ct=Object.keys(pe.props),Tt=0;Tt<ct.length;Tt++){var Jt=ct[Tt];if(Jt!=="children"&&Jt!=="key"){Ue(pe),C("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",Jt),Ue(null);break}}pe.ref!==null&&(Ue(pe),C("Invalid attribute `ref` supplied to `React.Fragment`."),Ue(null))}}var nn={};function vs(pe,ct,Tt,Jt,Ni,ar){{var Di=O(pe);if(!Di){var ki="";(pe===void 0||typeof pe=="object"&&pe!==null&&Object.keys(pe).length===0)&&(ki+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var Ie=xt();Ie?ki+=Ie:ki+=Lt();var se;pe===null?se="null":Ce(pe)?se="array":pe!==void 0&&pe.$$typeof===e?(se="<"+(H(pe.type)||"Unknown")+" />",ki=" Did you accidentally export a JSX literal instead of a component?"):se=typeof pe,C("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",se,ki)}var fe=re(pe,ct,Tt,Ni,ar);if(fe==null)return fe;if(Di){var Be=ct.children;if(Be!==void 0)if(Jt)if(Ce(Be)){for(var Fe=0;Fe<Be.length;Fe++)Fi(Be[Fe],pe);Object.freeze&&Object.freeze(Be)}else C("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else Fi(Be,pe)}if(hi.call(ct,"key")){var Ye=H(pe),lt=Object.keys(ct).filter(function(ei){return ei!=="key"}),Ct=lt.length>0?"{key: someKey, "+lt.join(": ..., ")+": ...}":"{key: someKey}";if(!nn[Ye+Ct]){var Yt=lt.length>0?"{"+lt.join(": ..., ")+": ...}":"{}";C(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,Ct,Ye,Yt,Ye),nn[Ye+Ct]=!0}}return pe===n?kr(fe):gn(fe),fe}}function An(pe,ct,Tt){return vs(pe,ct,Tt,!0)}function Ns(pe,ct,Tt){return vs(pe,ct,Tt,!1)}var ts=Ns,bs=An;z0.Fragment=n,z0.jsx=ts,z0.jsxs=bs}()),z0}process.env.NODE_ENV==="production"?p2.exports=oW():p2.exports=lW();var It=p2.exports;const BL="data:image/svg+xml,%3csvg%20width='300'%20height='50'%20viewBox='0%200%20500%2084'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3crect%20width='500'%20height='84'%20fill='url(%23pattern0_10_2)'/%3e%3cdefs%3e%3cpattern%20id='pattern0_10_2'%20patternContentUnits='objectBoundingBox'%20width='1'%20height='1'%3e%3cuse%20xlink:href='%23image0_10_2'%20transform='scale(0.002%200.0119048)'/%3e%3c/pattern%3e%3cimage%20id='image0_10_2'%20width='500'%20height='84'%20preserveAspectRatio='none'%20xlink:href='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAfQAAABUCAYAAAB0vcXQAAAAAXNSR0IArs4c6QAAIABJREFUeF7tXQeYJFW5vfdWro4zw2wgioCoJEUMwDOsGEAFFR/6RFEREAH1IUpQQaIEFcWEiiAGVIKib0URFFBEfQbQJ+CCgODCssvuhE5VXfm+PjVVQ01vz0x3T/eE3arvQ2S6wr3/Def+6fyULPC1YcOGjKZpewiC8JwgCPZkjD07CIIVlNICISRPCMG/JUJImVJa4ZzXov//YBAED3iet0bTtPtVVX2MUore8AXuUvr5VAKpBFIJpBJYaAkADjpGg64eWuieTn4/RMD5vsrl8m6CILyRc/56wsl/EEoEQkhXbclms8S2beL7/oZ6vf6rTCbzy2q1euuyZcs2RO/seEh7Io+lPS96IoIt9SWLeWgXc9u21PmwNPqVzoylMU5za2VXINrNJyuVyrMppScSQt5KCFk+zTtcQsjDhJDHCSElQgg08rLImOdzDk09RwjJEkKWEUKeTQgZEASBQDN3HIcwxggAvlarBZIk/da27Svuv//+H++///4WpXRhgL0bYaXPpBJIJZBKIJVAKoEOJdBXQOecy4Zh/GcQBO8jhLxcEAROOKEBD2LT+AOc819QSv9IKV2TyWTWUEoB6m1d1Wp1med5z1UUZR/XdV8tCMIrGGMZ3/eJ53kEYC8IwngQBN+2bfvr22yzDb5HU3BvS7zpTakEUgmkEghNp6k2tDQmQl8AnXPODMN4G2PsfELILgBYzAhBFIDkd/i+f4PnebcMDAw81ksxcc4Vy7IO9DzvMELIkZIkDQdBwD3PA4jjoHC14zjnDw0NPbFVA3u6Qns57dJ3TfFttTe52rsrFW1/JJBKvz9yXfi39hzQa7XaqznnFxPC9+WchOZwTdVGOeFXm6Z5RaFQeKhVtzdt2pTLZDLPIYQ8k3P+TELIDoQQJTKzi5xzh1I6TiktE0I2BEHwD8YYAuIeb6VxP/TQQ8qKFSveFATBcYyxgxhjOGTSIAjqlmV9yXXdc1euXFlPtfWFn4RpCxa/BBYvBCzels06qku46bP2Lb1hQSTQM0Avl8uDjLEvEkLeEVloKOd8I6X0vGw2eyUhBIA8abnZuHFjVtO0QxhjLyOEHEgI2ZsQwjoNjvN9v+L7/p2MsdsEQbgtm83e26x912q1vSilnyKEHCpJEszx9+i6/oI77rhDXLVqlTdXyafrcq4STJ9PJZBKIJVAKoG5SqAngF6r1V7LOb8qCILt0CDGWKWhWV+azWY/Rwg3KA21YwKfer1eP6yRavY2SunrCCE6Atmmv0KletqfgyD0xYe+crwn8p0/LEkSDhDf13X98SS4V6vVV8iyfKrrul/MZrO3wDVAKZ14SXqlEkglsMQkkB6ll9iApc3tswTmBOgAaNu2P+e67kmKohDDMACs/2NZ1vHLli2Ddh4C+djYWIEx9n7G2AcppTHo96RrUe755Ls47PwTl885/7nv+58qFAp/BLAzSjlv2gOq1eqwIAhfC4IAloT/26p96z0ZkS3kJYsSKxa4UQvw+QX45BYygdNubI0S6BrQOecF0zSv9X3/YKSMqapq+L5/WqFQuDwGRZDGKIpyKmX0I5TQDCLTAMAza+WdDcNmgB7AcT/lHdDAb23cd46u6yGwxwcNBNHZtn1BEAQfJYSMEkJO0nX9ulRz72wM0rtTCcwsgRSW0xmSSmA+JNAVoI+Pjz+DMXaTJEl7oJGyJP/JcZ0jdF1fi/8GaG7cuPFwxtjndF3fMdmRGTTqrvrb7vtgWuecX+O67smFQqEEUOecC7Ztn8A5/1Kk2duO45xXLBYvxG+UUr+rRs36ULrBzSqi9IYF5UXa8sW/BNbgEmjilj9PllYP2wP0xMSqVqugab0d5C6+73NBEG7UNO2dlFIbWL5hw4Zl+Xz+SsbYoa7rclEUN/tGwiwO8J9RYhGoIvCtEGnOUzT8DgA9/A6ldF2DrObDuq7fEGvrlmW9LgiC6wkhGdd1EST3tUKh8MFegXq6LpfWokhbm0oglUAqgaUogfYAPepZvV7fyfO83wmCAD84kPhyTdM+FAeWIWXN87zvSpIEJrfQvN58wdwOf3u1WiW5XA6sbrgFh4E/U0p/Rwj5P9/3/8UYezSXy21MPj86OpoXBGFIFMXdGWNIcXs+53wVIWT7yIwOtXvGcdA0jZTLZV/TtKtWr1594hFHHAEbfLBx48bnZbPZnzRy1XdCRH6Dhe4Luq6f1itQX4qTI21zswTSo1k6J1IJpBJYvBJoG9BHRka203X9TkrpMwOwtXB+Rjab/UxsYq9Wqx9paLifCdngpglNjwEeLG6O4xiiKK5uAPN1uVzuFkqp1Y2YoGU7jrN7EARv5py/mxCye5w2F78vBnlExeP/4x+krzmO8wdZlo/QNO1JHAg2bNiwcz6f/xVy4aM0u0s1Tft4CurdjEz6TCqBVAKpBFIJzKcE2gJ05Jjruv5by7KeyzkPBEH4VCaT+WQE5uKGDRs+VywWEcHOgyCY7Z3ws3++Xq9/c2hoqNpLVkGAe71eP4Axdirn/I0T7vwwrn3StA8gB7BblkWgrQtUeNxyrNcjfx33VSqV3ZHPTgjZjlJaJ4Scoev6F1NQn2ZapkrrfK7X9FupBFIJpBKYVgKzgS+AkNm2/UPHcd4MwBYE4Yu6rp8cgaRcq9WuURTlCPjLZyGFGSGEfELX9asIIUG/Gdocx3keUtE454fiEIJ+oM2u64bsdbIsh8Cuqiqqta13HOcNxWLxHtyDOAEQ1QRBsFwQhDHP896Yz+fv6k30e6cIGN3f6WPppE8lMC8SSCfmvIg5ZVSfHzEv8a/MCOjQbqvV6oc555dCyaWM3pjP5f8TfQbL2gEHHHBlEAQwc4eacNJ/DV85gNO2bT+fz39t7dq1Z+24445hdPl8yQxtMk3zjZTSLxNCto0APfTtx4CONkeuAJRbfaOu63/CfeVy+SXw6cuyjAPNg47jvHCbbbYxQjnMYx/mS1bpd7ZGCfQKjHv1nq1xDNI+b7kSmP91MSOgR6D2W865SAh5NAiCfQcGBkrQVGu12qWe552squqkZh4DOv4d5Zo/6TjOewuFAljZFqzKWalUGpAk6TJK6btgHYgoZjebR5zzfzuO8woUjYGJ3TTNoxtEON/ww+oy5Ke5XA5+epFSOme62C13Eqc9SyWQSiCVwGYSCNENezFjDKWv4drcidKQnwRlsaEQViilcMM+Rjh/SNW0+yilYdR0erUngWkBnXOeaZQ+vS8IgmegoIkkSQdmMpm/ApgrlcpJmqZ9SZIkblnWlHfAhA2zdr1e/61hGIevXLlydDFotADoer2OeuyXRaLZjHMWB5Eg8P9qGOZLV6xYYYBvXlXVy2VZPooQUmtYG84qFAqXzbc/vdNzHudcN03zlYj+B2Ne5AoJXxMVtMEhbU60t/fdd5+84447vkiW5X0453bDvcFAwYsrNNdQqvi+/0Qmk/lJ94e5mXsev9c0zR0YY6+PDl7hQ4IgiEEQoJDPbyMK4Fn7G7+vUqlgwwE1MZ4X4n61t6R6ehcOy4wxhnKBd6mq+uBs43bOOeewc845JxgdHd1eUZSXc87zeD6ymIXvqtfrvykUCg/P9q5OehLLrlarreCcv5wxNgQPVyKZXhIE4Zeqqj7U5XfDcUX/zjjjjNfatr1rIzDXUlUVQAAXXoYx9ntZlv88e7spmXgk5KLI1uv1VzPGtvN9H9k2s7ohZ39/d3f4vo9GyaIoPqiq6u/aDRSO5Wnb9uGc822xHqPOId5JHR0d/eOKFSvu6R+vRuv+xnOxVqs9jzH2XyhxTSndBwuqVQZU01swNmD7vJtzfhvn/Lv5fP6B7iTb/VOJef0aSukzpnsTCodpmnZjv2UMZlPG2JswT5P7EmLCKKU/bDl50YlarXYeIeTMaHP+YC6X+wo6MzIy8iJFUe4KgkDM5XIUL8KFAUL0OnLTGWM/yuVy72wuyNK9WHv3pGVZr25YGlaDD6dZU58A9AB9+Vk2m30DvooNShTFO0VB3K1m1NbWarV9t9tuu/HFaHpPbqqMse8TQpDSB0CfQNqJcbpC07TjQdtLKUV6XkdX/A0ARaVSuViWZRDzuJxzKcEAGFptMMkrlcopy5Yt+9Zf/vIXab/99tus1n2nh5VkY+ODlWVZB3POb/Y8zxcEgWEOSpLEgiBYyxh7n6qqsBDNalmJi/VUKpVjRFG8EhtjVPEvdst0JKse3Bxbv1AV8ERN074FOUelgFu+Pu5nuVx+ra7rV3qeh0NdXK+Acc7rmqYdSyn9/nRj0k27E7I7kFJ6FWMM2SaYezg4A6iEIAiOymaz17QzFhO4+rR3Lp53aPNuu+22WlXVgz3P83Bwi9JM5Qbz40Wapn3i6TPl9O69GATr9fozOOc3CIKwH+ZPEARCksmyDeDpRlyTzzS5KXFwE13Xva7BXIk9d1M7h+F4LVuWdTeldN84Zgjr0nVdKZvNXvjkk09esMMOO9Tbed+cOjQhfHbDDTeIr3zlK4+UZRnxVnvLskxh6OxEnvF+HGctNep//Mn3/cvy+fwPZ1oDc21/qz2mWq3eyBhDHFkr7pTY6ntoJpO5aWKj7WW499MtMgzjhZyQ/6UTB/1QnpATlGjP8/ZpCejlcnk3Qsh9jYkgG4bxx3w+/xK8EuYSURTv4ZyDKW4SyOPPAfwJId/KZDLvnY+JM+1paRZZ1uv1l4LnHcVhpgF1qwF2H89ms5/H0NRqtYMymcwvy+WyA6DM5/NHt7cp9XJqzf6uhQD0fD5/Qr1edz3Pk0RRTC7YcJIHQfBX0zTfMDw8/GSXmtm0HY8BfXR09OBMJnOz67q+KIoMAZqqquLfay3Let/Q0FBHgF6v148RBAFgOAnos0u/L3fMCdBxKGn0Y3ts8FHrmOd59SAIji0UCn0F9Gw2u3u9XofRBBtPoOu6UKlUjioUCm0C+lR5JgF9r732Wi3L8sGWZXlQLHAw1TRNrlarF+Xz+Y4B3XXdGxob8X6I9/F9fzNA79PeHHYwCeiiKIaAXq/XrzNN84MrV67sCNBN07y7kQocAjrk7vu+m81mpWq1emG5XO47oCcOSdj/z0EJ7BiUY/DpdJUkQD0Ul67riIt6pGFN+ditt95641vf+tY+sXlOtDTeYwDogiC8eYb2Y61uaGjpe1NKEQDelwuATgDolIYAHAM6Dkuu624O6BgU0zRvcl33kIaGDl/x/sVi8S9YUIZhXNXwMx8dmW6nHAaik9f/aJoWdnoxmNlnkqhpmijZ+uvoLDWpwSYmEEhtXpHL5dagVjui83VdPyIIgk2lUumNQ0NDf+gYoPq5M0SUu5A7rArTaegNk9wVmUymJxp6uVy+uFAonGCaZgjoSAlsxdzXcNt8K5vN4hA0o3bZ6QpIAno2m70ZG3IUxMgzeobZjt01oEuidKXjOimgtzkosYY+NjZ2oCRJV80HoNfrdS86WHcN6KCxFgThhmw2u59lWf6E0j+5HXSkUbYpqim3NQO6wATRsq3rqtVqx4BuGMbdqqzs6wV+4HleCOi5XK7vgB7vgxs2bNgTAdBROezJAwusnq0UwHbk1QToRNd1YppmkM1m2fj4+K0o+lUsFh9t513d3BPvMZVK5UZRFGcDdPhwrlqzZs0JrayRU77fJRZ0DOgjIyMHybL8K1mWkVP+ZV3XP4SG1Ov1lwVB8Jtm0pbEBv47TdPgt3UXO5jHgjVNExH7NyTN0skFFgTBXblc7qW4v1qtPldTtb+7novVfqemaS/vpcmym8nW/Eyzhk4pXQU/VNLk3ktAh8kdGjoAHaY9ZA40AXqoYQqCMMI5P1lRlO/10rKRBPRcLnczNmRFUZhlWRwL3rKsmQG9aVHFoNSJhh6fkKcxxU07rLGcZmE2XHIa+qICdEZ5wmrfDKRhTEUM6Llcbj9YFJoBvbmQVKvxwj2Rq64llXUrM3Pze/DfgiAg1kF0HGcaQG+NArHJvVqt3q3r+r6e54WA7nmem8/n+wro8RrctGnTkaqqfqmR1jyYFHRzPzsxuTdbMPDfiqyQag1xc4TDtaYoSo1zflQ+n4cbtedXM6DPss4RswC31iGqqv6i540hBBVNO9PQy+XyzfBP+b5fdhxn52KxOI4JY5omcrTDYizJK+rgJvhudF1/oh+d6Nc7oTFalgUSmk9NgDoVnrZOhl81HMc5aWBg4Nucc81xnNNQtc3zvBHHcd5WLBZv71hL71dnWmjojLFVQRAsJKAD4AP4s13XvbtUKr1uxYoVG3slszkDetNYJAGdMXZlFCSlzDRkmP/YzKHVxUyE7WxaKaB3linSyuTeCw0dPvTY5I4DIUzuSQ29HUDH/YgfSgI7TKDxe2YD9Bj0ouDH0Ideq9U61tA7A/QuVcTEYogP57Va7dOiKJ6M/bTVQaUZL6JgyTWEkH8QQtYhsj0IAsT0aBGh13M8z3suBgJyTI4BfMUIvMZag8yjIDSBc35cLpf7ZkxD3qtttkNADy3TjuMAB59XKBTGetWO+D0dAXqtVtuLMfZ3xhg0g0sbJVEBdmBfOwkVyaZpHMxeh2az2b6cSHotkBZabb5er/+UEPKyViltvu8/cPPNN+8JXw247CmliDTGxF2t6zrS2HpqRp5Lf5sijb8vy/JmgB4EQc9M7m1o6OFJmjEWchRwzq/UNO24bmXWvAX1GtDj9zXiRg4RBOEizvmTQRBI041JvNFgY1EUBUE/iPZHENreyX0vChAE6+CaRnAbXDl4ZxjxhY1phgvZAogIRkzHF9sJ7ksGxS2ED31Raegz8EXEh0q4pxqgcJYois/zPK+GbA2MRzy2Sd9vkkI6jiKnlO4niuKAbdsIxAQNNZixmSiKjzLGUJMCAzzpnmw2IcdjH5mlfUTr+77/C9d1vzw4OFhuJxYp1tDL5fLd2Wx2XjT0eJ4ZhoFg6eNjK+A0h9l4kv8MMVaapv0ySk/bbOonMk1Qs+OVnPNjRVE8yLbt8KDVrCFH6ydWWj6QzWa/1stI81aAPuOCnZgkmB5fVVUVdU56muLcDOhxW1r60E3TvIYQ8o4G3SlC13eDxo2a4fV6HSku2Kg2w0Pf96/O5/PHTJ14cz/9zQXY2n92op22bT/H9/2/hZOSEiE200FIQRDYkiR9Utf1T8OXLsvyhaqqfoBzDiKaV0SpRH3PsW9HoklAD4Lg+6qqropSuSadggsA6CGoR3mmALMPRTXnZ406n20cew3os31vloUc9qdaraJs8I8ScZlh6hmlFBv88aqq/rKXbocWB9SwHYhyTwG9PyRWEZ00DlqeaZq3y5K8yqybcPcInuc5uq7LlmVd8Mgjj5y/5557Ou2A8hznXpixUiqV7s7lcn0H9Hj+joyMnK9p2qlxJgj60AToMZD/oHGw+aSqqv/qpJ+x3EZHR587MDBwvmEYb2SMPR3gMPVAHIP6W3O5HNyoPbm6APTwnB6t+YM0TUNl0p5dk4DOKEu6k1oCumEYb2qkGv13o8jJo3Gkummax4BcZZoWbWyYh56Tz+fH5+43bweyeiaXKS/CBK3X6x9tTMyLmtO8wPduGMZD2Wz2WXhobGxsb0VR/k8URQsap6qqKLM6Z3DqRc+aAV3X9FWu504xufcS0Gu12sXZbLalDz3BwBfB+cQkD4LgT4899tghe+yxx9hspvfZZsRSAXSEeWNNpYDe2yj3uZjc57LemgEdB+darearqhoCOiLuOwH02eb5bG2NNfTx8fG7G77kvgJ6vObK5TJKZn+ZUlqILLqhFSIC9DiN65+NctXHNWKr7pytD7MclsN4B6Sn+r7/1YaWP10+eBjxTik9UNf1P7b7zZnk3yWgx/mW/7Zt+/kgY2u3LbPd15GGHr8s7kRExoJk/l1bfAj86CdmMpmv9/sEOlsne/F7tVpdJgjCXyIylnBe4H8cx4E51ajVascODw9fi9Q9ALksy4cLgvCIqqoguEgBfSIoboIOkPN/c87/jzF2WOKAFGrpCJyrVqtfKxaLJ4CcBhpMt+O3KAA92g3iOZDU0CfCF2iYE+/7/qOc8+Oz2WyqoXexXnrtQ+92zuG5dgDdNM0LHn300XnV0PsN6EnSIkmSfpPL5Z5pmuaUGh6xT9v3/Rsx3/P5fE9SuCKZY+8YFEXxes45ArCbr7A4mCAID3ie99K5fzskIIIlxo+j3BMWiNjq+GtUIEWKHhZ7HByZCB7/gqZpH+mVG6ArQI+lVK1WXyEIwh0RiUpzzvq/VVXdZT4Krcxl8bX7LCbr6aef/i7O+dVRup6Y9Jl5nvebgYGBVyCyfeedd37z4ODgda7rbqpWq+8cGhq6dTZts912zOW+djR0PwiuyPYoba2Fhh5omsYQk+D7/scFQbg38iHBTIb5EyA/3LKsDZZlIdgQi77rw9CiAPRowFoBekSkgUhcBAWmgN7jPPRuNPS5asPNgN7I/rk91tA1VRNcz3VUVZUrlcoFjz/++BYF6HHsi2EYq4MgOLQ5YBCHd/ANVKvVq2zb/vDw8HC118oe1jzGoFwug4sAbI5TLrgYZVlGMN1n1q1bd9Zuu+2G1NOOr3iezKChx5U8f8YYu5wQ8kPf9xHUl7xAqISYjP/Qdf134Q9znICtAD2Oy2iZhx63BgNhmuY3KKXHhO2gU/AcDf1vVVW/3OsB61jyPXwgotX7Kwq5RBGrYaejwIuNkiT9B6grx8bGdmwUpXlUEAQwn10xMDDwobkA0/Rd6Gz02wH0zk3urRm7wBTXAtB9TdMEwzRvzWYyrzVN8zMNLma4MqCFg5kvFCdA3ff9Pzz66KMH77rrrtVzzz2Xgq6006FsBnTbsny5k7S1Tj84w/3x+I+Pjx8uy3LoQ4+icLmu6cyyLeTKphp6D4llugH0Xgx5UkOfAuiKJniB5yiKssUBerzWTNMEvSxcsEhPS2rnoWvP9/0fB0FwTJQd1ZfYIrQFe8Zpp52GNOoDmscUwfFIP6xWq3utWLHivrmM+WyAzjn/RaOg1+vq9fqXfd9/f0TVPAmjEW7+U9O0/XrBSz8zoE/DFIfWRHzg6yml+WZAB6WnoiioXgbO4HmrnjaXgZl4dmaAhAl4l112Oc0PgvMFxkIayERUJWgTP5nNZj+L+vCEkG/m8/k3mqa5JpPJoE78gke79wfQp0o9Sf3aDOiiJPkZXQdn/h26rr8SZWglSfpOwPm+NKKgrdfrXNO0kIfY87yv6Lr+gVlN79MMWysNHcQyjuOEeeiGYax1HKdtprju51domtssKA4aOo7xuVwOZE1LEtDbPVIuNWKZ7sd6qsl9Og29XKlc8MQWpKEntHNUo0Qu9BRNFEDGOX/IcZxXDQ4Oru2noheb30dGRlZkMhn4ymHuDpXOaL8OMw0459fCVYq6HN2O90yAjk+6rvvz0dHRt3iex1esWHE/YwxW68krwkcso4s1TTuzG9N7cg1OZ3KHlm7b9gRTXLVaBWe7Aw7zXC53P/5mGMbr8N8JHt3JUwch5GpN05oi27sV2eJ6zrKsXV3XfUiSJM/3fWzSk2QRKJCh6zpoYxXXdY8SBOEbrus+ZVkWaqmDTW/WAiD97O1CA7okSaHJDZucrusHoa+QDeccaYFIbwxN70jlgaxc133Stu33DQ8P/6wbC8fiAfRwk587oLeLnm1YCtIo9/5Vd5xWQ99CTe4J7fwIzvnXCSEDMS7g0CpJEiyVkm3brykWi7/s5x4Xv/v6668XolRiMFCiPDZovAnop23bRtqhp+u6uH79+uduu+22yHnv6moH0HO53OGUUrtWq72qkcYILvdJ7oqmIMGXtBWsN8M+0Bagl8vl9YSQFZIkfVfXdfiR6fj4+CW6riMPfYogOAh6PP+gXC4Hc8cWd3HOC9VqdbWiKC9DTimYfxKHmg3j4+N7bbvttiOVSmV3RVEesG27ZNv2GcPDwwgODAMoFkoorQDdcZ2+EcvEGnqtVnMFQZDgv8pms+Dsvq1QKLwKIPfYY4+JQ0NDZ+dyuTMqlQoOjTK0c1EUA4EJMEX/Znx8/JDtt98+rPLTicWnHUAPguB9Ufnern317Yxn66C4AO4ans/nQw09DYrrbZQ7uNw9zxMFQeiY+rWdMZ3unukAHSlVMa/8YvGhg/q1VqvNics9jqI3TRNVz6YEo6GgDdL1KKXfrtVqHxoaGqr0UztPjkm85iqVyl2NSn4HxnnqcHXBnw8OB8/zPpfL5T7WTSEqvCTeY0ql0o2SJIXFWaIrdDd4nvdzlNWO31+pVL4my/Jx8J0joLqJRvh+VVVfRCk1u51/MaAna5DEhEahhl4qlXaRZflhfMBxnBOLxeJXoT1VKpU/KoqyXzOge543msvltmlv0HqgcnTb8y6fwySpVCof1DTtc7Ztx9Wcwrdxzsu+778zn8/fZBgGXA5/C4JgIAiCbxQKhRPxLKPUmzgCzX/fJ8aE8VqtugJ56EhbmxHQGXWmo8acaTOLyk5O+tCTgA4N3XXd21RVfdWTTz6pb7vttmalUnmWIAjX6rr+fNM0w4WGVJcoIh7z7rP5fP7UWU3vTY1KAX3zUZqWWGbC29n34iybEct4PmNC/4qzpIAe7kthHnqrKPe5AnpsdYzWMHKqt4sVnCi2yBVFUWpUsNwX5bW73Ha7eixuW7lcfp0kSdcxxrIRgVW4XUf/bNQ07TmU0VKne12ngI72rF+/Xi0UCn8XRTE0vcOCkTwANIrmnJfNZs+dYLTrHCOSgB4HMDQD+ltkWf5hBOgvKBaLqKaWN02zFEUxTomGa5wCflwsFhEY0ZeAh65GtscPjY+PPz+Tydxj23Y4WROvBw3UZzKZzJmVSmXI87zv5XP517qeCx77/+gUkHrc7DCdJi7O0hagz7F8arOGjtN6LpeDyf02XdehoatxnAUWnaqqcOGEpnekl8D0HuVow+fWdpnTyRUSWURQbS3mckeKGPxZ8KHXarW1862hR0FDk8QyqPxWKBRSDb1P1dYWG6BDLwKxzJaiocdZq3WfAAAgAElEQVQHxFKpdFqj+BIqqGmxXxjWSKxlz/MQ9f6efgbCTbdXxvU0fNe/16ibe4rilMI6UNVF3/dflc1mb+tmv51NQ4cPPZ/Phxp6vP9Wq9VXMsZ+LoqikgD08HwA/nnf918MF2037Wmloce005Zl7QNa1zMdxzkf0cf5fD4Hc4BpmjAL/DEqh5oEdG7b9n8PDAx8qW1A7/wQ0k0/e/JMYkCWaar2QN2qF0RRRA8mSBMYJb7n35LJZA4Ga1yj3vAnBgcGT3c9d+0ll1yy89lnnw3zPDTQBQkUXMyA/uijj6rDw8PnqIp6uh/4DrJL4OuC6T2TySCV7XZN0+IKfziZzCrDVhp6CugTvvytwYe+GE3uWyCgxyx0N0uSdHBTthPKSaPOx9sHBwev7ckm3OFL4j2gWq2eBUXLtm05YVUOrYG2bV9aKBQ+3o3ZvRNAjzT6MI6qVCp9nVJ6LPajZJcAvo7j/K1UKh2A+vQddneyOEvS5D4F0CuVyncIIQjwAjvcMwEKhmG8UxTF77TgmQZbz8sHBwfv6rQhS+n+0dHRPOhJKaUHJ/jdQwtHEAQP6rr+bJi5KpXKEblc7hrHcdY7jrMqn88/GJMvLER/FwugW5Z1m6ZpoYYOHvLYNGZZ1rMopZDr81AFDoUwoopJ4EHHYfHTxWLxjHYtHSmgd2Byn7h1/k3ufa6Hnmro/TO5x7EC5557bvChD33oHwMDA7ujkmHCn4hUU8+27T2KxeIjbSt5Pdwc429GDJ6/EUWxmDRz43dFVv53vDT+GuTFd/rp2QCdc/5z1PRIHhZi0/vAwMDfBUHYBQVlEKxnWVaY9YK6Dw1r5lnZbPbCTovJzKqhVyqVOwRBeAWlNEw1igD9U6IofiyuHpUQQuD7/rJcLjfWjgbVqfAWy/2PP/64tnLlys+g0hpjLA4qiwF93U033bQTIiwty3qVLMu/bMQebISpdXBw8HcLGem+WAE9OrmG7oBKpXKoIAiroUVGla3w95Aq0vf9xzzPQw7r7XEa1ExzIgX0RQzomezudauOQxu8KgFiKyo9JpZJNfSJ8e+XDz3ey0ql0n6SJP2PKIqIG8JJHBbL0NzeIE35VRAER+ZyuU0LAehR/8OUYcMwHmOMoYDWZNEj3/c9TdUFs24M5/P50U4xpktAD/e6Uqn0almWf0opVSRRIo47ESQXFfJBsa8XDA4O/r2TNs0K6MijJoQ8mxDyA13Xj8QgVqvVb8qy/O4WgD6WyWSGFmrgOun4lHs7NPvDb7Rx48b/Hh4e/qzjOKEfJllgxLbtA3AiXbdu3fNXrlx5j+M4I6ihPTAwsDpOp+i6rW0+2KpLSwHQYXpfuXLlOYqinO44Tmh6b0rt+KWqqjC9h0EtMx0cU0DvDNA5Dk2eVw+C4NhCofD92P/Y5pSb8bZZ89A1XahUt/wo98Vucg84p6wNd1YElGHWjmmab3Uc56uodS6KYlxNDLEwKPV6SS6XQ5BXx+bjXsy7qJ2hm6lULv1YkZU3xeVs8Zvv+66malLdqu+Ry+VQrrWjqxtAj9oUmt4bwdNX+L5/LA5BoL2O0+oa8QgA9r888cQTB3ZCfz0roBuGsYkQgqj1L2SzWdS0RTDRjyRJelMzoKN0aGRu3gIC4mZG+dHR0bcV8oVrPT/MgQgBHYDJGButVquv32abbRBj8AwU3bAsa9y27Y8ODAx8cyFT1xYzoCcnOUzvhBBEpYamdxD4JOI1YAW6MJfLnTWb6T0F9M4APTW5d7SXT3vzTGlrMaCXKpUL1i0CYpm5RLnHAXGWZaGi2jmSJOkIOPU8D/ugSylFqupxuq5f1RuLbYeaVzRCCdC9RBCEU2RZDmm7gV8TGromVqqVwwYHB8GH0dHVLaDH+93dd9+t7rrrrv+QZXknpNOhTYqiEATLwvQuMvFUJrJL25VfO4BeI4RkGtScF2YymU9EgH6bJEmvaOFD/5Ou6y9echp6R0M4cXO5XH490tOQupYEdLDkua77ZuThm6a5g+/7axljtcYJ7Nx8Pv/ZdkzF0zenuwkdv2+xA3o0ycPD4NjY2KGZTGY1fHAA9JjrPTLz/ct13ffk8/nfznRA6j2gdy//ePNLo9zHDpQk6apsNrt7vZ6a3OezfGqv09ZidjjTNC/mnJ8C8hhkPgGYkPuPgDjP8w7OZrO3dLHFTvtIp6sw3gfK5fJJoih+VhRFFdgVFUoJq+CBMS6Xy13dqc96joAe7nXIwpEkCdzzSO9L9pvDSskY2wfxV+3IcFZAr1arYPmBBnoOTCeRyf1/ZVl+YQtAj9ORtgANfWbxlUqlgwqFwq+QuoaJDA0dqVacc5TCOzKTydxsmub2vu8/EqViXZDP5y/qhvGsnYFs556lBOiIDWlUajq7kdb2McZYyPWOU7VpmsHQ0BCsRLdeeumlh5x9Nm5pbXrvJaB3uok0j0cK6HeIq1at8jbLQ0996PNWD71fgG4YxhcJISdFNb6hXcJ0bGuapjTW6QH5fP4P7exP/bonkY/+TlmWEV2ux9gFl0EE6B/KZrOXd0r8NRdAb7JKXmnb9nslSZqSNYYsKtd1f7dmzZpV++23H7BmxmtWQK9UKsdFdJx/ymazf4s09DslSTqwBaDfqev6y7cGDX18fPzlxWLx10lAR7+DIAC5zLsadYdXxxo6IaTWOPmB5/3zc9PQZxvOmX9fCoDeNMl355zfEATBXgg+hKaOaHdMelhGcrncBYIgnDud6X1isTF/dHSkZR56tVZby+eZKS7V0FMNHXnoi4XLfS4m93jdwQ9MCAFOhFzpAHRJkkJAL5VK+w4MDPx1ITEhBnTTNN8CxjpYnIFdsCYAwMFkZxjGGZlMBqbtkEau3WuugB5bJR988MHstttue68oijslvw0XBkDd9/3/zmazX2plem/F5T5t2loLTSPUjiRJOqgFoP9Z1/UXLeTgtTsQc72vUqm8IZfL/bTZ5B4EwXgQBG/J5XJ3mKa5o+/7/4aF3vf9j0UsewtG/7pUAD1pejcMAzXTEUEbRr1H/smwIlsjffLhRsGHdxQKhT+1Mr33UkOf63xJNfQeaugtzCXx3EYg35577bVakeWD0yj3iVnbxyj3OHocXOknxCACk3sM6JVK5SWFQgEFUhbsigG9Xq+/g3OOw0fI6w6LX6yhV6vVk/P5/JfnW0NP7nVPPfXUa3K5HLjeJ8nKIl8/r9frKLs7q+l9Vg29eRSQR33qqaf+BPVu8VuSi5YQ8kAjP/s5WwGg03K5fGQ+n7+mGdBd1x21bfvg4eHhv4yPj+9ULBYfq9Vq457npUFxEVNccx56q5UezyHOuVatVs/XNf0jjuvAPBmWWVVVNfA8j9m2vRpV7aIUGZTtnSScSfjODs7omZuRJgUiB2j5uq6nTHGieKUgCNs3qgTGjrulmYdO4e+aYEEEoO+1117wRy4AoE+cNNoJitsSmOISPvRPN1yNJwdBEAIRQEiSpNCH7rpu1yxsvToBxPuAYRjHU0o/TynVYgrYIAh81KmvGbXjCoXCN+fTh57sX7zfGYaBAMKjGUMQ/EThr8jXj9vvUFX1NTNZEToGdHy4XC5fpSjK0fHgJRpm6LoOvtwt2ocOs/n+++9/kqIolzUDuiAIm+r1+oGFQuEhy7LCAi2NogRjrut+YHBw8AdbXZR7JnNCzTCmFGdpB9CjuRWmdlSr1eeKongd53zPOL8VmzcmPefcbvC+n60oyiXNpvctD9Dn6sl/uupbkiku4DwI38w5Djt9TVurVCoHUko3C4rTNA31qY8q9LAeeqqh91dDj9Maa7Uaipuc5fs+gDJcl6iwhih3UL5qmgYz94JdCUA/v5E+dzraFbPFxVHu1Vr1LQMDAzd22shemNzjbwI3YXpfsWLFvbqu7xQxZU7+HBGXnaDrOuIAWjJldgXotVrtzAYbxHlg3EHeXOJCStHKbDa7qd0w+04FuBjuh9ZYqVQ+qygKCq6E9IFxHnq9Xn8SBW123nlna3R09DWDg4O31Gq1jZ7nvXVgYOA3cyOWmduGvhAm90wmc4LRJaAnzVEjIyOH5/P5HzHKPNux4bagoIUVRRFVi9ZUKpV3LFu2DL66SZfGlgfoc5/9yeIsjLErZVkONfTIfbYggC4IAlwobQD69PM/aXJfOA19EkDRUMxDL1kPHdXWFnseeifKWBwPVKvV3hEEwZcFQSiiemAjroUKghBn/5wry/JFKB8699nb3RviOV+r1b7PGPuvuOgT3pYA9OcPDAz8rdMvzAbolNKfq6o6hSluum/Esi+Xy4dQSuFmhEtjsjx3hDEmpXRPTdMea/UeAHoQBP8Ltqb49ynUr7VaDb5yfCCXy+WOj5jiQDBzDZLfm/zoMIO+AulEnQpmKd0/NjZWyGazNzDKXu16Lsy8k8LjnD+A6j2gNa3VakcjctI0zXX1ev3FQ0NDT6KfC3XYgSI2UW2t1l61tR4UZ9F1/QTTNEMNHYcfaGK2bU+hfp1p7ONJjspsy5cvP58xdoplWa7neWGKDMBAURSQHd2Yz+ffkjS9p4C+uWRnAnQcNoMg6LuGLoriVZqmTaatRWOI1KEJDT3gImUdByctApP71gXoMUkWrC6SJN2gKMpKwzBiQA8ZNBljq+v1+nvBwtbJYaGXeJBwDSD1C/TSkyCJ+rq6pot1qw6GU3CudHT1EtCTCsy6deu+OTg4+J7IfTOlTZzzW3Vdf10rf/+sgF6pVD4my/KF9Xqdj4yMFHfbbbfK6OjoSzRN+wOS35vD7B3HOb1YLH5moQZvsudzU2ZbDmrcp2q1Oqyp2n1+4G+DVLW4OEs0IDfpun4oKtI1ZHa27/unMMYey2QyO8cTq60ZM5f2T/NsJxp6wLnM5gjotm1fLAriCXWr3jWgRzINTe+2bT8XXO9BEOzpum4Y9Q5mKpj4CCF1zvmZuq5/Lja9twJ0aPQLXW2NEDKl2hrqodfr9UcZY8erqvrLfqY2JgGdUnqlqqrbQz3HPAZblWEYnq7rx+bz+W93NF+bJnXzFEzUg18lSdKViqI807Ks8LsYW1mSBcu2jspms9d00//pNHTXdcN66GFkebl8UbFY/ERMAtWvg/VmPnRFXVUzauC4ndTQt4Qo96if9KmnntIYY38dHh7eDTiBAYVsAZyU0hHDMF40MDDw2EJgQgyI9Xp9B0opyrcORntKyASG+aer+t9LldJLUau9rb05cVO8x1QqlRtFUZxSDz3q7+Ya+ix7e2x632677e4jhOyYULbDpkd4c0zDLI+8+Smm9xjQ4wDFSOkJFe+w2trY2NjrFEX5Gf5gmuaBy5cv/z3nXK9UKuMSVPSo0ljcR9/3f4KC7gsxeJ0ORrf3G4YB7uI/gzYwGZFICHE555fpun5auVwelCTpakVRDjNN8w+5XO6A2ZjNum1Pu891AuhxZGy7747vSwSz5QHojLETkNoHDR0WLqSIOI7Ttobe/F6kfTHGftQAbxyuoQGEZVajCXw/TGqKotwXaephFGu5XJ4MiltUgE4JcR2XLwSg12q1VwVBAEDfKQZ0RCdnMhlqWdaJmUzmq3MB9OZ5E4M0uPobmtzXBSasdFwniOdLNC5H6rqOOJOQqrOtuRdtjosa0FV1Va2WAHRNlyvVygWPd8QU1/0Jv19R7hifhx56SNltt91szvntKEAVB5tFYO4ITJAN0zikUCj8oq3x7OVNE8GSoQvO9/2TbNv+LKVUTVRbC8szW5Z1eaFQOKUbt0BXgD5LHxOm99cSQn4mJmu+RkYgQojR2Af3aja9zwroIyMj2ymK8kRUJP3EXC6HhQ4T512SJO0fCicx13zfH8lmsytQhaxfJ+Bejnmn78JmU6/XTxZF8TPwv0SbT/gaznm5QfX67kwm8z+GYayklP5JUZRtDdO4Jp/Lv7uX3Nidtjtpztnc5I4YgImDHtI6MpkMXCthWcTZvzN1o+k3oOMwaRjGBaIofrhRnjZ5oApPro3KTjcUi8W3YlzQ9qhU6OIEdJwA3XkH9HCDq1QqL+WcX5nRM8/yA9/H4QjzGeZHyujHBEG4uJcH0PhwALO6JEmXB0GA4NmQ0Rc+V/AMeJ73Nl3XcVhrH9CjCbqkAH3e6qFPRt2Ha7nXxDLRfhGmrm3cuPF8SZJO0zQNWSjhWmSMxfXGr6xWqx9etmxZbb4VvXjPrVQqqLT2stjcjnmH9iEUp16vHz4wMPDj2fe6KVAX75fxempfQ2/jQ7GcKpXKtymlR8WKc1Jb55zflMlkDkvibLlcfmGjCuj/xm7gzTR0fBt87r7vb0MI+XY+nw/t+q7rfsbzvI80t822bZiWXl8oFLqj++v+INqGmOZ+C+e8UK/X/0dgwssDHkDDgDk4Lkiw3jTN5wwODpYNw3g+pfQe3/dLnPPT8/n8FQsZ4T4zoBOYArsE9KkybQZ0SukJjuOEGjqARBIlwfXcjjX0qP2TUe/gepckaU/45eGrwyYCDukgCIxGyszHdV3/YlyeddFq6AsI6JifnucB0PeNAT0IAheBOJzzr+i6/gHM7dkK4LS7ouIDYr1eP7MRRHo+rAJRVS4uyzLjnCO188hsNvuLbsiXthRAb739zW1T7KeGHgf5btq0ab9MJvNTxhiUuRjQQ6u27/uB67rPLRQK4I3oLgOqCxHEpao3bdq0r6Iot6uqWoAVKtpL0EZY9mxd13eklHZcaS16T18APd6vCSGFWq12LyFke/wtAeihuwCV7AqFwg/iddgWoJdKJQQ8/CfnfKOu68vx8FNPPfVqTdNuFQQhtumH70SUIyHkqlwud1zXg9fuLrEA99m2/Rzf9/+B012sBcbNoJT+TlXV/0AUfBAE76OUXua67nrUiEca20LLYyFM7r0E9OShZHx8/HBoc0EQYIWGXO+R6ZiJongvY+ytSBnEM7Va7WBRFG+Oa3V25UPvYkNJTs8kscwC+9DDQxFoiV3XBaC/1g+gHHsiNHRFUUTTNG8qFovHUEo3zi0rY/KQmIz6/gal9FhYV5C3jDFBhLtt22sEQXhPI9inJUnQbEt9SwH02frZze/9BHS0JxGz8kfLsl6U8POGFrIgCGAtu1jTNFRds7rpQzfPJNw8P5Jl+fCwbKrvT5RpjCOEOf8WAne7bVc/TO4J5WqypLQkST9GzFDMcBdjre/7Y6g3v3z58qfwtxjQYx86ItynRLnjpvHx8aNVVUWlMOI4zguKxeI9mCRI0eKcDzULm1JaMgxjx2222QaUpy3z5boZoIV+BhN3l112Oa0xiMhnjDXDuFmYqOc16A4vgv9cFMVv6rr+xtHR0Xu32WabvbvxR84RQzYT15YE6DC927Z9QWMOTzG9J6qyXavr+tt7BuhznHyLCNAnNaRSqXRlNpM9xg/8MGsAByJBEJC6tk6SJKz5ngToxZveyMjIszOZzNWEkJcgngIHMdd1QzO/WTdvFkXx/bqur+3mELFVAXqHG0O/AT2e2yMjIydkMplPE0KyCVDHksRYwwoDLf6vSRftHJfVtI/HcwhZWqIoIgi1EGdkRQxxobmdc/5iHCK7bUc/AT2pwNTr9e8EQfBOaOVJLd11XZrP528477zz/uucc84J2gL0arW6TBTF9RBSo/73mcVi8VNYQJZlXYHayc3CQJCS4zgfKRQKly20VtrtQLV6DnJolI0Fnz3MSriSRPo4Ib1Y07R/m6a5neM4DzHGRFSW0jTthG78gt20faa1viUAejTJJ03vjLEbGGPPjQEiAejVRs4vTO9fRiCWLMur56ShdzMYiWcWC6BH8gv9nqVS6YxsJnsRNHTf98WoSpYnorKGbX8in89f2It5Gx9mK5XKsZIkgSZUiTd813WdTCYjG4ZxaT6f/2hyE+tE5FsVoHcimD5SvyY1SRzObrjhBn7ooYf+nRCC9Zi03MbKz69d1z0in8+PdIILHZ5fwmYBaO+//35h1113vYcQskccrBeB+UT+Lue3GYbx5uHhYewVXV39BvR4PTz22GOF7bff/l7HcULTe3xBYQbXO2PsCFEUf1gqlfZjjIFqN0ylbqmh44d6vf5nnLAIIX/XdX0f/K1arb6SMXZb0+CFdn7XdR/J5XK7bynBcRi4SqXyflmWsSHFpAlJ2f5S07TXQIvfYYcd3pbP57/DOR91HOe9qqqujnM2u5o1PXpoSwH05KZvmuZbGWOonR6WWY3SCMOod0rpfVbdeqkkSy8QRfFXSxLQu9nNZpkvidS1gxtpa1dyzreDdg4qXUEQfEVWBLNu/r4RDHusoihr5hL7EfsxEc9g2zZS0t6SWD/cdd2QVKZer7+rUCh8t9sDRAro0w96vzX0aD2GgYzIkGi4HC+Blt5gcMT5GmyOuCXcMymln1EU5ewGY1t98xb3ZrLHc2j9+vXXDgwMvC2Oao//jXZG7tKX6rp+11y21/kA9Lh9hmEcQghBzfYw5im2OAC0HccZFUVxD8/zdmgL0E3TRGT35z3Pw2YJQSB9DXzYf2WM7Z04McT/F/edrOv6lzo5jc1FuP18tlarLaeU/rmRuxufkELtXNM0UiqVEIh1Qjab/W6lUhmilF6fzWZfOT4+/uDg4OCzu92ket2fLRHQN2zYkCkWixdJkvRBFyHjnMeFDeJAxUtN0/xJoVD4rWGavhTloWeyWWbUamsR64AAzn6P0SLT0EMLR6lUGtAA6IQcHsUihJkBYPmCT73BAnmOoigomdx1QaFYOx8bGztBUZQvwmqVUADCNEbbtv/i+/4x2Wz2791+a94AvQ3MQVvaY4p74vw999xj3sqnjo2P313I5/fFHo7Dm+d57lyqrTXvT3FEuWEYd+m6HlbjdJynE2UApDBz+76PaPjLYCXqwx4XztVyufxlRVHej3FIpKmFOBiZ/7+naRrinMy5tGG+AD2e36Zp4tD7jtg63ETs9r0gCLDGfh+Dfssod3T40UcfLW6zzTbrwNfLGEO0+9GR2f3oIAiuagHo+NOm9evX7/bMZz6zspR96diUIrrbTzb7zmGm9DwvBG50eGx8bK+B4sDfDcMwfN//fKFQOCsJFm3sB3OZXzM+uyUB+oRWEDBKGQhn9ooIZ8DQNxn1Hk36hx3HuUfTtNc3MjMy0Bq6Coqb06iAmSoINRjk0S9kUFzcjRhoLcuCO+jyUJWi4RkV/xPn9YPd67iGRe7H3Rx4EsQ+LwTNbCaT2RtZMPFmg1QqSqncCKQ9W9O08yIg7IpJcd4AvY150D6gP37+nnvuOW+A3o+0taQ4Yr+14zgvNE1ztaqqKxIusLC0ahwk1zhQnJfNZkEJ27MguWi+cZRzdRznPcjfnqBKmaysNpEnScg4IWS/6ehT2xjiyVvmC9CjPtBSqVQQRfE+xth2SS090ebzG8kzIE8KTe7TAjp+rFQq3yGEHKUoirFhw4Yddtppp3FEdNdqtX9F6QrhoCUubBJX4iTUfy29f1BZrVb3IIQgchq87VPI60VRBFXmqaqqfgXaoizLZw0MDJxeq9UQcwAa3H920/d+9GZLA/R4kuOwWK1W3yYIwrURIUkY9R4v5KhgRPgvzE9oKNlsdsGqrS0SQJ+MdscaJYSAxCLpSgqB13Gch3VdP0aSpDs7SSeLXUylUmlnWZavliUZaZ7wesQpkuH7KaVrGkyK75Fluavo9sQBpSX166Jgimsmlpm3PPQJ6cyHyT0xDuHBtVKpfLxxuD5LlmU1tshEgA5Tcch7EATBTz3PO3FoaOiJTkC0+d54X1u/fv0zMpnMtzzPezksp7Ish7XZE1fMG3KYqqowXc/5mk9AjxtbqVQOEwQBhWTCqPemKz6Mh3+eDdAPlGX5rojeL6RRhDBN0zyGEPINvKAJ0DGZfNu23zQ4OIg6r0vuAm87AqoopS+L4gEmedvRGUmS/vmpT33qOYgwtCxrV8dx7ofWkc1mb6WUvrab6PZ+CWlLBnQcpvL5PE78H0R6N4Ym4TObKEHIWIjyKaBPzLBEtayjKKXfEARBSWpUmO9RkYcNlUrlw8PDw9e2E4Eeb3Ku677M87zLVVXdA77ySqXCsNFGBZ1Csz6l9COg623nvVPWRdOJN9XQp9815hPQowNECOqGYXybMfau+GAdAzrWJaxkWJOc8zFVVc99/PHHrwDjXKd7H+bNr3/9a3nPPfc8qVGs6ZOKouTjXPNcLkdQsSy6QqroRq2C0zOZzOfaZiKcpUHtAzpzYvKuTvuYvD+e55VK5buCIISm9xagPvnIjICOu0ql0q9lWX657/s1y7KeNTw8DE1Usizr7iAI9trsuBAEGLwnZVneT9f1DUvJ9A5aw+XLl58jCMIZcRR104HFqFarxy9fvvx7GzduzEqSdGGxWPygZVkjoigeIUnSrzveqOYy2rNPvlCLma/iLKB+7XUeeqsuJlJU9hIE4XpCCNwfoQYYRbVO1hRuR0Pvk3VkUZnco012wsY+YeH4vKIoJyMXHcFLsZwTAA9T5Q8aVqqzVFX9VyurUzwOqHXQMKWeQSmFjzKZwoTqVkRRlPDA1eB0QEnck6LCHaHFoNvpv7QAXZMrlWqH1K/dSmZ+NfTEvArHs16v39SwvrwOwBqnW8U1vjEXMPfAFOi67kOCIFzNGPuOruvrZuptPNaWZe3SKIb1X5xz1DnfYZq9Afjjy7Ii+L73JdBy98HMD+bFnjLFzdZ/RL0PDQ3d1ziIh6b36a5ZAX18fPxliqL8BoQylNIvyLL8YbwMpUJ1Xb8lIpaZtLvjhZIoEddz/zIyMvKy7bff3poJ1PuxmXa7FEZHR5EKcL0oikm/3+TrfN+/JZfLHRz1fw/4NmRZhqZ+88DAwBsWmuq1ud/NGrqqqqsw2WOfZrQYO6R+nfqV+BsoTjMF0EVBomRuTHEzTvKAU8ooN03zbZTSayPzMQAdh5jNAD2TyTDDMBY8KA6aSi6Xm7fiLC3mRLjx4pAniuIVhBAUFpoE9URAURxk6HPOUWbyds75w0EQlKHJc7Bb0nwAABCXSURBVM5znPNnSJIESlnkmYem1lD40RUdrnwBYbmE/M3zvPciL7nbQLhWmgvWXLJ8ampynwrouWwOzIBhUBxqUWSzWcQHXVguly/YYYcdUOCoOya3pokVxRGwc889lx9//PHXDwwMvEUUROBAeCfmAgAdU6F5jhFC/kEIgQsG1dE2MMYQuIZEjFwEYLtSSl/aYC7dOXatTU6zKTRnIbWyr2u6UK1VL4VFuRu+9lnANcEUJ7054XGOwlLaL5+62XdmAcNKpfJGzvmNyVKpze8A/ka07bBW7DPFIR4NBMjsb/I8DyH0lmVZzxseHn4QA1gul78uSdJxyTS2BKAjze3Hy5YtO7xXk6ZboG7nuVKp9BpBEG5GEFUS8BL70yZBEHC4eQDaeaFQ+IrjOO+SJGnj2NjYIdtuuy3Id+akdbTTzk7uSQI65/z7jYPZvAA6omkppSh36ouCKDiuc1sjXeRVMTVrJ32Y7t7EQSJbr9dhev9AVCwnrCkcmtwngnLCnaERhLWoAN2yrEcppX2vtjaNFhNuSrC4BUEAJje4l8KDXiy32NKRLD0Zb8RJk19TZagpLjgcHJD/6/v+Y/Cba5r2m16AebQvbeZDt23bcxxn4autLSIf+nwBeuIQF84tWIBEUTwpWcyqOZ2sk33g6X14etTDdxs0w4JhGB8dHBz8Qq/M7E0Hyb5Rv85ykAjne7VaRY33t89kdoeLC7+3BHR8BNy4siz/WZIkZtv2XcViEaT3OJHkGlG8IBZ4RrIxSF1AgIKu6wisu64RKHZkrziiO5kE7d6LwhWCINzCGINPEcmUk49GEwk5lGdEfOEoVPP6XC63GnW/GyQn12ua9s62o4Ln0STRDOiyLK9ClFK/NHTXdS/mnJ8wH4AeHzajMqt7+b4/aXrHom4GdFVVmWma/dHQW4zpdGlrvu9zWAts254fQJ9mvsWHz3q9vhMh5GuEEFieQr9jrElNKNZP57+2A+gA+Oi+cJ4pinJ/rVZ7b6FQmFMQXAtLw6IEdMuybsfBOa62hsh+FDCpVDqtttbu7rX5fUkfeiaT2Re0p9DQwd0PDb1cLl9YrVZ7qqE/vWE+XfHM87y3eJ6HGgvbxvMoeUCM/9Z8KGzV8+ZYraZ7Yj19bePw+J5cLndH99Kb+cn2fejtFLrqrJXYz6vV6iD4NhprNiY72+wlWLdYw67rbq6hx6fher2O0pinVatVrmnaKdls9jL8BjCklN4RBAHL6BnquE54So9P+AhYkCTpJw3CirdBg1psPnWYMQRBuA4aZcQmNEVAUYWo67LZbEgrCk5smIdEUVzped6/gyB4SSaTCXl1p+vbPGJ4c9snfejQ0AHoiDiNS41Gbb5C07QOqq1NnT/NJncAOni7EWcB0pJ+aegJjSA+uU5GvUf9S1qbUH+b1a16fwC9xbpsBeiRL5Hrug4GxvkB9Bn2jMTYabZtgyXuZByEkN4PP6eiKOHGkNQGmjWD5s0Y2oFpmr6macg3v85xnFOGh4dBGd1T61XSh/6sZz1rNVxh0NAjAhEkQ6MK2EWaps1rPXTP9W4nhKyyncl0vbA2e6lUumDdunXzmraGOCfG2PwCejTf4pREQkjRtu1PEUKOBZd/xE4Y3oWIdIDPxBxqsp3PgnUJgEccBv65zDCM8+bCAtcOvC4koMftq1arSIW9IU5VizA6/BlyiU3u0wJ69AC4tP8qy/KzKpVKzXXdFwwPD4cpWtVq9RhZlr8hSRJ3HGdqHtvT2u6fG7z+/wnu5nYE1+97MDD1ev0E3/e/BOBJaq3Jb7uu+7exsbH9d955Zwum9lwu93XG2JEonep53knZbPZ7vTIj9rrPzRq6JEmoXzwF0JHD2Qh07Amg12q1UEMXRXHeAR1jgzxXQRA+0KJufYD627ZtLzigY+dSZIW5nrvggJ44FMUpbQcSQj7ted4BiJkBqEeRyZNTcxZABwsc5PwAKg42tMPV0YM9P9P2B9C7a2YyDx2A7npueHBmjOFQ4xQKBbnhCrjgoYcemhbQu/ty6x0j1tA3btx4d6FQ2BeABw0dGKqqqmQYRs996NPtXYmAtmc1SpEj2PjtnuepOCjOrJnPDPCR8mRTSr/FOb+oJa70UqhPH1QWxOTeLF+Y3iHLxBqeBPQY4D3Pa62hxw+Zpnmg7/u/1VSN2o695sknn3zJbrvtVonqpV8ERiBVVaeMRBNrz8YgCN6Nkon98au3N4KIymWMXS4Iwn/Cv5o86TQJ7hFN0w6ilP4boF2tVt8ty/JVoB31PO+HKAbStqm912idfN/0ZtVQe0Uqnqqqx4ADPaopjsUdHrwcx7mzUChc00nOcfLT8Tg+/vjj2rJly94siuJrXdc1okNOIDIx53jO3bquf74XKX2tuhprf+VyeVfG2IdEUZzkDo/XoSAIsud5T/m+f00ul7u/1xpj8/DG70fZUsYYGKzCtB1ciqLIqMrHGPueoij/6Hdb2p168Vi6rnug67of9DwPZvhCssJiC0CP1zvcUncJgvDFhx9++NZ+E6jEbUX++2GHHXZSvV5/kaqq1Qi4EOQ3wDm/Pp/P/6Rfh4qEXOF/xFpD2dBTXNeFVlxF4ZswSEvX85s2bbp+zZo1P1+1atVEPc8+XvFaLpVKn9A0bXfOuRmVrsUhIxsEwY26rv+sH8xtswF7pVJBWW7sE9g794+CKTuRhkEIATPatbZj/2hwYBBBmvN2JTI73i+K4vOjfTQs6BbRT9+rKMpX++G/T3YSckRZ4hC7OD7OJzb0hIbemH/nbRYU17x5VyqVcxog+Mkw+E2SVqPCGO7BJDrggAOu9n3/nTPZT+BDlGX5GhRzyWazI52a4NuD7NbjC57p00477U0wzzRKvu4giii+M8E93LxRcc6fCILgtblcDhGYKFP3WkrpL2BSbORa/qvBjLTvwMAASP6xkreYCnPztjLm40MdTJYObp2Pli/oN5KHtEKhgOIP+zcyCZAauDwIgoGocVWUVxYE4Z9Icbdt5/eDgwPl/hzUF1Qc6cf7JIE77rhDffGLX7xfI3Ib1SkRyQ53ZoEQko+yVqAYlBhjj3POH6GU/p+qaXcz2nv/dJ+6uOCvnRHQ0bqoAhvK070JKWtBEFyYyWTOjH4TTNNEgM2xEcht9r6EqWUUJwxN05A6M2NqWy+kAk2pkSP7Wc75K+P0mmSIf1ydB9+CJsc5P7RQKMBNgPrazwuC4E5CSE4QhDFK6WG6rv9usWhWvZBP+o5UAqkEUgm0JYH09NuWmBbDTbMCegTcecuyfh8EwR4wWTfyWM8Ea1cM6rVa7XMwfTbnpUa/N/dzQ6PW9aeDIPguyuz1UggAXMuykKp1KmMMVJeT7oA4cC8iO5gMzmgQ4T/kuu5h+Xz+gUgz3xU5uBGRQVUURXBdX7cYqqn1Ulbpu1IJTCeBdP9O50YqgaUpgbYAHV0rlUq7MMZ+SwhZGUUZop7yxRFogx72+IYfC7mAYMufQjbRLJrI3G03yrWCLvZ7vu/fMTAwUOpYhDR0VFLX9fYG4UgQBEcIggC/KmeMTelbHCUZR/GiDb7v/8nzvEOXL1++CRaG9evX75HJZH5GCEFqj9Uo1XlusVhE4FfX1ag67lP6wAwS6DHU9Ph16dDNXQKLYUgWQxvmLsn0DVujBNoGdAinUqkg4OI38K0xxhDxc04ul4OjPrzK5fJLGqVWbxQEATlz4bubguTC+2L/deI3BI78JQiCuxhjawgha1zXBaF/eWhoqBK9R/7nP/+ZX7Zs2XaCIIBBCCQZCLI4UBAEBL1NUCBF/vHpCDDANW2apjc2Nvb1crl8yh577BGm1o2MjLxoYGDgZ4ZhIIgDZQC/ksvlTl4yYJ7uQlvj+k373BcJpIupL2JNX9p3CXQE6GhNtVpFCUsk8i8HXsuy/JMHH3zwqH322QfRiPh9mSAIl9m2/XYEoTVrytNo69N2NCa7iG+Ahp0Mq49z8JooBiff10xQ4Pv+esuy3jc8PHxTHNBTLpdfLEnS7b7v65qqOa7nXqJp2ieXDJj3fZosxQ8stk15sbVnKY5p2uZUAqkEZpJAx4CeAHUA4jOhEbuue3cmk3mTruuTZfJc1z2oXq9/DSbwuQxBi+puHb0u8Ty07m+WSqUzV6xYEfru42j1Rm72tg061z8ODQ0NBUHwcZDopGDekZh7cHMKeD0QYvqKVAKpBLZiCXQF6JBXqVQaUBTle5ZlHZLJZBApPo5SiZqmXZ1gpNINwziRUvrRSKPfTNSzUPzNOjStTPrJhwDalNJbkDOfzWbvbZVmg7+Zpvk83/dfkM/nr0yj2WcV+ww3pMA8F+kttWfT0V5qI7ZE25tOtLYGrmtAx9tBHFKtVi+WZfkU0EY2ctZRC/mnpmm+H/SPcQsaUe0A9hMopScTQpB7OHFxQujU2LW2Gp28KU6Liw8GCYB3KaPX8YB/Lqr4FLnYuWqa5qt93/9DFGWfTpWOpb40HkgHdmmM05bSynS+bSkjuXT7MSdAj7sdcc1eHgTBchRp4ZyPNwpeXfLII498ee+99zZj0zbM2IZhHEQIOZpSCoIaNVl+cVoxTrNSwBMMAIcfHQQwEQ/7Pb7v/wBlUXVdB0HBZLlAwzBe6Ps+ige8WJblr2madmJqWl+6kzdteSqBVAKpBFIJPC2BngA6XgcTvCRJn6WUvtdxnDAYznXdjYqiXJzJZC4H62iSYY1znjFNE1XcXtWgkMQ/e0zHrz7TgPm+/ySi40VRvLPBSX1roVB4qNmsDqKYBuif4/s+6suGbHGSJD1Uq9X2HR4eRi3elP1tK1wVqUa1dAe9p2PX05ctXZmmLV/6EugZoMeisCzr9ZzzS0BCI0kSMQyDaJoGJrarbdu+slgsPtJKbA3CfcUwjN0ZY8+JCtsPUErBz1yMABfpa14QBBsZY/8mhPyLc/6viKR/syUZuQMOkSQJhUhQ2x0XtHWHc/7VtWvXnrX77rvXUhrXpT+J0x6kEtgaJJCeO5b4KM/DAPYc0CHyiC72yIZJ/BxCyC4om4cLVc4YY0h5Q/nSW3tdiQ2ad71eh1n9aM75mwVBWI5CEw2CGGpZliOK4reDILi4WCziMDBpiu94mszDwHTcpj49sBV1tU8STF+bSiCVQFsSSDebtsQ00019AfT4gyjrZ1nW213XfR/n/ACUW03UzUU6+T8opTejjq8kSfdls9kH2q1ag/esXbu26HlesMsuu4QVeFABLJ/Pf1UUxXfj7yihGQRBSVEUpKt9ddmyZQ/PCcjnLO70BakEUgmkEkglsPVIYH5PKX0F9OSgVavVPRhjJzRA/K2EkOHI/h0WaMcF9rhGDrjDGHuYUrqRcz5KCEFBl1KjIIxMKdUJIVIjqG2wkU++oyiKuzqOgzq7nxwcHAQ9a/iier3+X5RS1I69pUGCc10QBNcvX758MjBv65lIaU9TCaQSSCWwdUpgfmG0lYwXpgXzBugJrZ0ahrE3pfQNCIjzff+lbOIKA96RhjbbFfGwE9Ri55xfq2nakXG0esN/r61bt25o++23B8nNwkh1tg6kv6cSSCWQSiCVwFYlgafBqH+wNO+A3jyCyFE3TXMPx3H2lCRpz6gO8yDnHJr4UKPgC4LjUCcXjviaKIp1z/PWIijOdd1/EULuKRaLv5rRlN4/+W1VEzLtbCqBVAKpBFIJLF4J/D/xclRhztyp5QAAAABJRU5ErkJggg=='/%3e%3c/defs%3e%3c/svg%3e",f2=({walletConnected:r,walletAddress:e,wagmiConfig:i,walletHooks:n,onClose:s,isOpen:o,onCreatePlayer:l})=>{r&&(e||r.account&&r.account.address);const u=()=>{l&&l()};return It.jsxs("div",{style:{backgroundColor:"#101020",color:"#fff",padding:"20px",textAlign:"center",border:"4px solid #0078D4",borderRadius:"5px",display:"flex",flexDirection:"column",alignItems:"center",maxWidth:"960px",margin:"0 auto",position:"relative",overflow:"hidden"},children:[It.jsx("div",{style:{position:"absolute",top:"0",left:"0",width:"100%",height:"4px",backgroundColor:"#0078D4"}}),It.jsx("div",{style:{position:"absolute",bottom:"0",left:"0",width:"100%",height:"4px",backgroundColor:"#0078D4"}}),It.jsx("img",{src:BL,alt:"Intuition Logo",style:{width:"200px",marginBottom:"10px",marginTop:"20px"}}),It.jsx("h2",{style:{fontSize:"1.2em",margin:"0 0 20px 0",color:"#FFD32A"},children:"BOSS FIGHTERS COMMUNITY PLAYER MAP"}),It.jsxs("div",{style:{maxWidth:"80%",margin:"0 auto"},children:[It.jsx("p",{style:{fontSize:"0.9em",lineHeight:"1.5"},children:"At first, there was nothing. And then, suddenly, the whole community appeared !"}),It.jsx("p",{style:{fontSize:"0.9em",lineHeight:"1.5"},children:"Everything of which the Boss Fighters community would one day be composed, would be born in an instant."}),It.jsx("p",{style:{fontSize:"0.9em",lineHeight:"1.5"},children:"A single species of condensed matter, exploding in a vast universe."}),It.jsx("p",{style:{fontSize:"0.9em",lineHeight:"1.5"},children:"Although energy would neither be created nor destroyed, the interaction between these newly-created atoms would continue to create something beautiful..."}),It.jsx("p",{style:{fontSize:"0.9em",lineHeight:"1.5"},children:"What had been separate would become whole again. And what would be created in the process would be even more beautiful than what came before..."}),It.jsx("p",{style:{fontSize:"0.9em",lineHeight:"1.5"},children:"Our story begins with the atom. The cornerstone of our ecosystem."}),It.jsx("p",{style:{fontSize:"0.9em",lineHeight:"1.5"},children:'And our "atoms" start with you !'}),It.jsx("p",{style:{fontSize:"0.9em",lineHeight:"1.5"},children:"Every contribution will help build our ecosystem and make it healthy..."})]}),It.jsxs("div",{style:{border:"1px solid #FFD32A",borderRadius:"10px",padding:"15px",margin:"20px 0",display:"inline-block",backgroundColor:"rgba(0, 0, 0, 0.3)",width:"80%",maxWidth:"700px"},children:[It.jsx("p",{style:{fontSize:"0.9em",margin:"0 0 10px 0",textAlign:"left"},children:'Claims in Intuition, also referred to as "Triples" structured in Semantic Triple format :'}),It.jsx("p",{style:{fontSize:"0.9em",margin:"0 0 10px 0",textAlign:"left"},children:"[Subject] ⇒ [Predicate] ⇒ [Object] (For example, a triple could be : [SciFi] [is] [strong Boss])"}),It.jsx("p",{style:{fontSize:"0.9em",margin:"0",textAlign:"left"},children:"This keeps our attestations tidy !"})]}),It.jsx("button",{onClick:u,style:{marginTop:"20px",marginBottom:"20px",padding:"10px 20px",backgroundColor:"#FFD32A",color:"#000",border:"none",cursor:"pointer",borderRadius:"5px",fontSize:"1em",fontWeight:"bold"},children:"CREATE YOUR PLAYER"})]})},Uc="0x1A6950807E33d5bC9975067e6D6b5Ea4cD661665",cW=BigInt("1000000000000000"),uW=BigInt("1000000000000000"),zc=[{type:"function",name:"getAtomByOwner",inputs:[{name:"owner",type:"address",internalType:"address"}],outputs:[{name:"",type:"bool",internalType:"bool"}],stateMutability:"view"},{type:"function",name:"balanceOf",inputs:[{name:"owner",type:"address",internalType:"address"}],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"atomsByHash",inputs:[{name:"atomHash",type:"bytes32",internalType:"bytes32"}],outputs:[{name:"atomId",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"createAtom",inputs:[{name:"atomUri",type:"bytes",internalType:"bytes"}],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"payable"},{type:"function",name:"createTriple",inputs:[{name:"subjectId",type:"uint256",internalType:"uint256"},{name:"predicateId",type:"uint256",internalType:"uint256"},{name:"objectId",type:"uint256",internalType:"uint256"}],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"payable"},{type:"function",name:"batchCreateTriple",inputs:[{name:"subjectIds",type:"uint256[]",internalType:"uint256[]"},{name:"predicateIds",type:"uint256[]",internalType:"uint256[]"},{name:"objectIds",type:"uint256[]",internalType:"uint256[]"}],outputs:[{name:"",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"payable"},{type:"function",name:"isTriple",inputs:[{name:"subjectId",type:"uint256",internalType:"uint256"},{name:"predicateId",type:"uint256",internalType:"uint256"},{name:"objectId",type:"uint256",internalType:"uint256"}],outputs:[{name:"",type:"bool",internalType:"bool"}],stateMutability:"view"},{type:"function",name:"depositTriple",inputs:[{name:"receiver",type:"address",internalType:"address"},{name:"id",type:"uint256",internalType:"uint256"}],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"payable"},{type:"function",name:"redeemTriple",inputs:[{name:"shares",type:"uint256",internalType:"uint256"},{name:"receiver",type:"address",internalType:"address"},{name:"id",type:"uint256",internalType:"uint256"}],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"nonpayable"},{type:"fallback",stateMutability:"payable"},{type:"receive",stateMutability:"payable"}];function NL(r,e){return function(){return r.apply(e,arguments)}}const{toString:hW}=Object.prototype,{getPrototypeOf:m2}=Object,{iterator:Jv,toStringTag:LL}=Symbol,Zv=(r=>e=>{const i=hW.call(e);return r[i]||(r[i]=i.slice(8,-1).toLowerCase())})(Object.create(null)),Jl=r=>(r=r.toLowerCase(),e=>Zv(e)===r),$v=r=>e=>typeof e===r,{isArray:jf}=Array,j0=$v("undefined");function dW(r){return r!==null&&!j0(r)&&r.constructor!==null&&!j0(r.constructor)&&ko(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}const DL=Jl("ArrayBuffer");function pW(r){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(r):e=r&&r.buffer&&DL(r.buffer),e}const fW=$v("string"),ko=$v("function"),OL=$v("number"),eb=r=>r!==null&&typeof r=="object",mW=r=>r===!0||r===!1,tb=r=>{if(Zv(r)!=="object")return!1;const e=m2(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(LL in r)&&!(Jv in r)},gW=Jl("Date"),AW=Jl("File"),yW=Jl("Blob"),vW=Jl("FileList"),bW=r=>eb(r)&&ko(r.pipe),xW=r=>{let e;return r&&(typeof FormData=="function"&&r instanceof FormData||ko(r.append)&&((e=Zv(r))==="formdata"||e==="object"&&ko(r.toString)&&r.toString()==="[object FormData]"))},_W=Jl("URLSearchParams"),[EW,wW,CW,SW]=["ReadableStream","Request","Response","Headers"].map(Jl),TW=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function G0(r,e,{allOwnKeys:i=!1}={}){if(r===null||typeof r>"u")return;let n,s;if(typeof r!="object"&&(r=[r]),jf(r))for(n=0,s=r.length;n<s;n++)e.call(null,r[n],n,r);else{const o=i?Object.getOwnPropertyNames(r):Object.keys(r),l=o.length;let u;for(n=0;n<l;n++)u=o[n],e.call(null,r[u],u,r)}}function PL(r,e){e=e.toLowerCase();const i=Object.keys(r);let n=i.length,s;for(;n-- >0;)if(s=i[n],e===s.toLowerCase())return s;return null}const ep=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,kL=r=>!j0(r)&&r!==ep;function g2(){const{caseless:r}=kL(this)&&this||{},e={},i=(n,s)=>{const o=r&&PL(e,s)||s;tb(e[o])&&tb(n)?e[o]=g2(e[o],n):tb(n)?e[o]=g2({},n):jf(n)?e[o]=n.slice():e[o]=n};for(let n=0,s=arguments.length;n<s;n++)arguments[n]&&G0(arguments[n],i);return e}const MW=(r,e,i,{allOwnKeys:n}={})=>(G0(e,(s,o)=>{i&&ko(s)?r[o]=NL(s,i):r[o]=s},{allOwnKeys:n}),r),RW=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),IW=(r,e,i,n)=>{r.prototype=Object.create(e.prototype,n),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:e.prototype}),i&&Object.assign(r.prototype,i)},BW=(r,e,i,n)=>{let s,o,l;const u={};if(e=e||{},r==null)return e;do{for(s=Object.getOwnPropertyNames(r),o=s.length;o-- >0;)l=s[o],(!n||n(l,r,e))&&!u[l]&&(e[l]=r[l],u[l]=!0);r=i!==!1&&m2(r)}while(r&&(!i||i(r,e))&&r!==Object.prototype);return e},NW=(r,e,i)=>{r=String(r),(i===void 0||i>r.length)&&(i=r.length),i-=e.length;const n=r.indexOf(e,i);return n!==-1&&n===i},LW=r=>{if(!r)return null;if(jf(r))return r;let e=r.length;if(!OL(e))return null;const i=new Array(e);for(;e-- >0;)i[e]=r[e];return i},DW=(r=>e=>r&&e instanceof r)(typeof Uint8Array<"u"&&m2(Uint8Array)),OW=(r,e)=>{const n=(r&&r[Jv]).call(r);let s;for(;(s=n.next())&&!s.done;){const o=s.value;e.call(r,o[0],o[1])}},PW=(r,e)=>{let i;const n=[];for(;(i=r.exec(e))!==null;)n.push(i);return n},kW=Jl("HTMLFormElement"),FW=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(i,n,s){return n.toUpperCase()+s}),FL=(({hasOwnProperty:r})=>(e,i)=>r.call(e,i))(Object.prototype),UW=Jl("RegExp"),UL=(r,e)=>{const i=Object.getOwnPropertyDescriptors(r),n={};G0(i,(s,o)=>{let l;(l=e(s,o,r))!==!1&&(n[o]=l||s)}),Object.defineProperties(r,n)},zW=r=>{UL(r,(e,i)=>{if(ko(r)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const n=r[i];if(ko(n)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")})}})},jW=(r,e)=>{const i={},n=s=>{s.forEach(o=>{i[o]=!0})};return jf(r)?n(r):n(String(r).split(e)),i},GW=()=>{},VW=(r,e)=>r!=null&&Number.isFinite(r=+r)?r:e;function HW(r){return!!(r&&ko(r.append)&&r[LL]==="FormData"&&r[Jv])}const WW=r=>{const e=new Array(10),i=(n,s)=>{if(eb(n)){if(e.indexOf(n)>=0)return;if(!("toJSON"in n)){e[s]=n;const o=jf(n)?[]:{};return G0(n,(l,u)=>{const c=i(l,s+1);!j0(c)&&(o[u]=c)}),e[s]=void 0,o}}return n};return i(r,0)},QW=Jl("AsyncFunction"),qW=r=>r&&(eb(r)||ko(r))&&ko(r.then)&&ko(r.catch),zL=((r,e)=>r?setImmediate:e?((i,n)=>(ep.addEventListener("message",({source:s,data:o})=>{s===ep&&o===i&&n.length&&n.shift()()},!1),s=>{n.push(s),ep.postMessage(i,"*")}))(`axios@${Math.random()}`,[]):i=>setTimeout(i))(typeof setImmediate=="function",ko(ep.postMessage)),XW=typeof queueMicrotask<"u"?queueMicrotask.bind(ep):typeof process<"u"&&process.nextTick||zL,Ht={isArray:jf,isArrayBuffer:DL,isBuffer:dW,isFormData:xW,isArrayBufferView:pW,isString:fW,isNumber:OL,isBoolean:mW,isObject:eb,isPlainObject:tb,isReadableStream:EW,isRequest:wW,isResponse:CW,isHeaders:SW,isUndefined:j0,isDate:gW,isFile:AW,isBlob:yW,isRegExp:UW,isFunction:ko,isStream:bW,isURLSearchParams:_W,isTypedArray:DW,isFileList:vW,forEach:G0,merge:g2,extend:MW,trim:TW,stripBOM:RW,inherits:IW,toFlatObject:BW,kindOf:Zv,kindOfTest:Jl,endsWith:NW,toArray:LW,forEachEntry:OW,matchAll:PW,isHTMLForm:kW,hasOwnProperty:FL,hasOwnProp:FL,reduceDescriptors:UL,freezeMethods:zW,toObjectSet:jW,toCamelCase:FW,noop:GW,toFiniteNumber:VW,findKey:PL,global:ep,isContextDefined:kL,isSpecCompliantForm:HW,toJSONObject:WW,isAsyncFn:QW,isThenable:qW,setImmediate:zL,asap:XW,isIterable:r=>r!=null&&ko(r[Jv])};function $r(r,e,i,n,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",e&&(this.code=e),i&&(this.config=i),n&&(this.request=n),s&&(this.response=s,this.status=s.status?s.status:null)}Ht.inherits($r,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ht.toJSONObject(this.config),code:this.code,status:this.status}}});const jL=$r.prototype,GL={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{GL[r]={value:r}}),Object.defineProperties($r,GL),Object.defineProperty(jL,"isAxiosError",{value:!0}),$r.from=(r,e,i,n,s,o)=>{const l=Object.create(jL);return Ht.toFlatObject(r,l,function(c){return c!==Error.prototype},u=>u!=="isAxiosError"),$r.call(l,r.message,e,i,n,s),l.cause=r,l.name=r.name,o&&Object.assign(l,o),l};const KW=null;function A2(r){return Ht.isPlainObject(r)||Ht.isArray(r)}function VL(r){return Ht.endsWith(r,"[]")?r.slice(0,-2):r}function HL(r,e,i){return r?r.concat(e).map(function(s,o){return s=VL(s),!i&&o?"["+s+"]":s}).join(i?".":""):e}function YW(r){return Ht.isArray(r)&&!r.some(A2)}const JW=Ht.toFlatObject(Ht,{},null,function(e){return/^is[A-Z]/.test(e)});function ib(r,e,i){if(!Ht.isObject(r))throw new TypeError("target must be an object");e=e||new FormData,i=Ht.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(b,v){return!Ht.isUndefined(v[b])});const n=i.metaTokens,s=i.visitor||p,o=i.dots,l=i.indexes,c=(i.Blob||typeof Blob<"u"&&Blob)&&Ht.isSpecCompliantForm(e);if(!Ht.isFunction(s))throw new TypeError("visitor must be a function");function h(y){if(y===null)return"";if(Ht.isDate(y))return y.toISOString();if(!c&&Ht.isBlob(y))throw new $r("Blob is not supported. Use a Buffer instead.");return Ht.isArrayBuffer(y)||Ht.isTypedArray(y)?c&&typeof Blob=="function"?new Blob([y]):Buffer.from(y):y}function p(y,b,v){let _=y;if(y&&!v&&typeof y=="object"){if(Ht.endsWith(b,"{}"))b=n?b:b.slice(0,-2),y=JSON.stringify(y);else if(Ht.isArray(y)&&YW(y)||(Ht.isFileList(y)||Ht.endsWith(b,"[]"))&&(_=Ht.toArray(y)))return b=VL(b),_.forEach(function(E,T){!(Ht.isUndefined(E)||E===null)&&e.append(l===!0?HL([b],T,o):l===null?b:b+"[]",h(E))}),!1}return A2(y)?!0:(e.append(HL(v,b,o),h(y)),!1)}const f=[],g=Object.assign(JW,{defaultVisitor:p,convertValue:h,isVisitable:A2});function m(y,b){if(!Ht.isUndefined(y)){if(f.indexOf(y)!==-1)throw Error("Circular reference detected in "+b.join("."));f.push(y),Ht.forEach(y,function(_,C){(!(Ht.isUndefined(_)||_===null)&&s.call(e,_,Ht.isString(C)?C.trim():C,b,g))===!0&&m(_,b?b.concat(C):[C])}),f.pop()}}if(!Ht.isObject(r))throw new TypeError("data must be an object");return m(r),e}function WL(r){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function y2(r,e){this._pairs=[],r&&ib(r,this,e)}const QL=y2.prototype;QL.append=function(e,i){this._pairs.push([e,i])},QL.toString=function(e){const i=e?function(n){return e.call(this,n,WL)}:WL;return this._pairs.map(function(s){return i(s[0])+"="+i(s[1])},"").join("&")};function ZW(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function qL(r,e,i){if(!e)return r;const n=i&&i.encode||ZW;Ht.isFunction(i)&&(i={serialize:i});const s=i&&i.serialize;let o;if(s?o=s(e,i):o=Ht.isURLSearchParams(e)?e.toString():new y2(e,i).toString(n),o){const l=r.indexOf("#");l!==-1&&(r=r.slice(0,l)),r+=(r.indexOf("?")===-1?"?":"&")+o}return r}class XL{constructor(){this.handlers=[]}use(e,i,n){return this.handlers.push({fulfilled:e,rejected:i,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Ht.forEach(this.handlers,function(n){n!==null&&e(n)})}}const KL={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},$W={isBrowser:!0,classes:{URLSearchParams:typeof URLSearchParams<"u"?URLSearchParams:y2,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]},v2=typeof window<"u"&&typeof document<"u",b2=typeof navigator=="object"&&navigator||void 0,eQ=v2&&(!b2||["ReactNative","NativeScript","NS"].indexOf(b2.product)<0),tQ=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",iQ=v2&&window.location.href||"http://localhost",Ja={...Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:v2,hasStandardBrowserEnv:eQ,hasStandardBrowserWebWorkerEnv:tQ,navigator:b2,origin:iQ},Symbol.toStringTag,{value:"Module"})),...$W};function rQ(r,e){return ib(r,new Ja.classes.URLSearchParams,Object.assign({visitor:function(i,n,s,o){return Ja.isNode&&Ht.isBuffer(i)?(this.append(n,i.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},e))}function nQ(r){return Ht.matchAll(/\w+|\[(\w*)]/g,r).map(e=>e[0]==="[]"?"":e[1]||e[0])}function sQ(r){const e={},i=Object.keys(r);let n;const s=i.length;let o;for(n=0;n<s;n++)o=i[n],e[o]=r[o];return e}function YL(r){function e(i,n,s,o){let l=i[o++];if(l==="__proto__")return!0;const u=Number.isFinite(+l),c=o>=i.length;return l=!l&&Ht.isArray(s)?s.length:l,c?(Ht.hasOwnProp(s,l)?s[l]=[s[l],n]:s[l]=n,!u):((!s[l]||!Ht.isObject(s[l]))&&(s[l]=[]),e(i,n,s[l],o)&&Ht.isArray(s[l])&&(s[l]=sQ(s[l])),!u)}if(Ht.isFormData(r)&&Ht.isFunction(r.entries)){const i={};return Ht.forEachEntry(r,(n,s)=>{e(nQ(n),s,i,0)}),i}return null}function aQ(r,e,i){if(Ht.isString(r))try{return(e||JSON.parse)(r),Ht.trim(r)}catch(n){if(n.name!=="SyntaxError")throw n}return(i||JSON.stringify)(r)}const V0={transitional:KL,adapter:["xhr","http","fetch"],transformRequest:[function(e,i){const n=i.getContentType()||"",s=n.indexOf("application/json")>-1,o=Ht.isObject(e);if(o&&Ht.isHTMLForm(e)&&(e=new FormData(e)),Ht.isFormData(e))return s?JSON.stringify(YL(e)):e;if(Ht.isArrayBuffer(e)||Ht.isBuffer(e)||Ht.isStream(e)||Ht.isFile(e)||Ht.isBlob(e)||Ht.isReadableStream(e))return e;if(Ht.isArrayBufferView(e))return e.buffer;if(Ht.isURLSearchParams(e))return i.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let u;if(o){if(n.indexOf("application/x-www-form-urlencoded")>-1)return rQ(e,this.formSerializer).toString();if((u=Ht.isFileList(e))||n.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return ib(u?{"files[]":e}:e,c&&new c,this.formSerializer)}}return o||s?(i.setContentType("application/json",!1),aQ(e)):e}],transformResponse:[function(e){const i=this.transitional||V0.transitional,n=i&&i.forcedJSONParsing,s=this.responseType==="json";if(Ht.isResponse(e)||Ht.isReadableStream(e))return e;if(e&&Ht.isString(e)&&(n&&!this.responseType||s)){const l=!(i&&i.silentJSONParsing)&&s;try{return JSON.parse(e)}catch(u){if(l)throw u.name==="SyntaxError"?$r.from(u,$r.ERR_BAD_RESPONSE,this,null,this.response):u}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ja.classes.FormData,Blob:Ja.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Ht.forEach(["delete","get","head","post","put","patch"],r=>{V0.headers[r]={}});const oQ=Ht.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),lQ=r=>{const e={};let i,n,s;return r&&r.split(`
`).forEach(function(l){s=l.indexOf(":"),i=l.substring(0,s).trim().toLowerCase(),n=l.substring(s+1).trim(),!(!i||e[i]&&oQ[i])&&(i==="set-cookie"?e[i]?e[i].push(n):e[i]=[n]:e[i]=e[i]?e[i]+", "+n:n)}),e},JL=Symbol("internals");function H0(r){return r&&String(r).trim().toLowerCase()}function rb(r){return r===!1||r==null?r:Ht.isArray(r)?r.map(rb):String(r)}function cQ(r){const e=Object.create(null),i=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=i.exec(r);)e[n[1]]=n[2];return e}const uQ=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function x2(r,e,i,n,s){if(Ht.isFunction(n))return n.call(this,e,i);if(s&&(e=i),!!Ht.isString(e)){if(Ht.isString(n))return e.indexOf(n)!==-1;if(Ht.isRegExp(n))return n.test(e)}}function hQ(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,i,n)=>i.toUpperCase()+n)}function dQ(r,e){const i=Ht.toCamelCase(" "+e);["get","set","has"].forEach(n=>{Object.defineProperty(r,n+i,{value:function(s,o,l){return this[n].call(this,e,s,o,l)},configurable:!0})})}let Fo=class{constructor(e){e&&this.set(e)}set(e,i,n){const s=this;function o(u,c,h){const p=H0(c);if(!p)throw new Error("header name must be a non-empty string");const f=Ht.findKey(s,p);(!f||s[f]===void 0||h===!0||h===void 0&&s[f]!==!1)&&(s[f||c]=rb(u))}const l=(u,c)=>Ht.forEach(u,(h,p)=>o(h,p,c));if(Ht.isPlainObject(e)||e instanceof this.constructor)l(e,i);else if(Ht.isString(e)&&(e=e.trim())&&!uQ(e))l(lQ(e),i);else if(Ht.isObject(e)&&Ht.isIterable(e)){let u={},c,h;for(const p of e){if(!Ht.isArray(p))throw TypeError("Object iterator must return a key-value pair");u[h=p[0]]=(c=u[h])?Ht.isArray(c)?[...c,p[1]]:[c,p[1]]:p[1]}l(u,i)}else e!=null&&o(i,e,n);return this}get(e,i){if(e=H0(e),e){const n=Ht.findKey(this,e);if(n){const s=this[n];if(!i)return s;if(i===!0)return cQ(s);if(Ht.isFunction(i))return i.call(this,s,n);if(Ht.isRegExp(i))return i.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,i){if(e=H0(e),e){const n=Ht.findKey(this,e);return!!(n&&this[n]!==void 0&&(!i||x2(this,this[n],n,i)))}return!1}delete(e,i){const n=this;let s=!1;function o(l){if(l=H0(l),l){const u=Ht.findKey(n,l);u&&(!i||x2(n,n[u],u,i))&&(delete n[u],s=!0)}}return Ht.isArray(e)?e.forEach(o):o(e),s}clear(e){const i=Object.keys(this);let n=i.length,s=!1;for(;n--;){const o=i[n];(!e||x2(this,this[o],o,e,!0))&&(delete this[o],s=!0)}return s}normalize(e){const i=this,n={};return Ht.forEach(this,(s,o)=>{const l=Ht.findKey(n,o);if(l){i[l]=rb(s),delete i[o];return}const u=e?hQ(o):String(o).trim();u!==o&&delete i[o],i[u]=rb(s),n[u]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const i=Object.create(null);return Ht.forEach(this,(n,s)=>{n!=null&&n!==!1&&(i[s]=e&&Ht.isArray(n)?n.join(", "):n)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,i])=>e+": "+i).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...i){const n=new this(e);return i.forEach(s=>n.set(s)),n}static accessor(e){const n=(this[JL]=this[JL]={accessors:{}}).accessors,s=this.prototype;function o(l){const u=H0(l);n[u]||(dQ(s,l),n[u]=!0)}return Ht.isArray(e)?e.forEach(o):o(e),this}};Fo.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Ht.reduceDescriptors(Fo.prototype,({value:r},e)=>{let i=e[0].toUpperCase()+e.slice(1);return{get:()=>r,set(n){this[i]=n}}}),Ht.freezeMethods(Fo);function _2(r,e){const i=this||V0,n=e||i,s=Fo.from(n.headers);let o=n.data;return Ht.forEach(r,function(u){o=u.call(i,o,s.normalize(),e?e.status:void 0)}),s.normalize(),o}function ZL(r){return!!(r&&r.__CANCEL__)}function Gf(r,e,i){$r.call(this,r??"canceled",$r.ERR_CANCELED,e,i),this.name="CanceledError"}Ht.inherits(Gf,$r,{__CANCEL__:!0});function $L(r,e,i){const n=i.config.validateStatus;!i.status||!n||n(i.status)?r(i):e(new $r("Request failed with status code "+i.status,[$r.ERR_BAD_REQUEST,$r.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i))}function pQ(r){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return e&&e[1]||""}function fQ(r,e){r=r||10;const i=new Array(r),n=new Array(r);let s=0,o=0,l;return e=e!==void 0?e:1e3,function(c){const h=Date.now(),p=n[o];l||(l=h),i[s]=c,n[s]=h;let f=o,g=0;for(;f!==s;)g+=i[f++],f=f%r;if(s=(s+1)%r,s===o&&(o=(o+1)%r),h-l<e)return;const m=p&&h-p;return m?Math.round(g*1e3/m):void 0}}function mQ(r,e){let i=0,n=1e3/e,s,o;const l=(h,p=Date.now())=>{i=p,s=null,o&&(clearTimeout(o),o=null),r.apply(null,h)};return[(...h)=>{const p=Date.now(),f=p-i;f>=n?l(h,p):(s=h,o||(o=setTimeout(()=>{o=null,l(s)},n-f)))},()=>s&&l(s)]}const nb=(r,e,i=3)=>{let n=0;const s=fQ(50,250);return mQ(o=>{const l=o.loaded,u=o.lengthComputable?o.total:void 0,c=l-n,h=s(c),p=l<=u;n=l;const f={loaded:l,total:u,progress:u?l/u:void 0,bytes:c,rate:h||void 0,estimated:h&&u&&p?(u-l)/h:void 0,event:o,lengthComputable:u!=null,[e?"download":"upload"]:!0};r(f)},i)},eD=(r,e)=>{const i=r!=null;return[n=>e[0]({lengthComputable:i,total:r,loaded:n}),e[1]]},tD=r=>(...e)=>Ht.asap(()=>r(...e)),gQ=Ja.hasStandardBrowserEnv?((r,e)=>i=>(i=new URL(i,Ja.origin),r.protocol===i.protocol&&r.host===i.host&&(e||r.port===i.port)))(new URL(Ja.origin),Ja.navigator&&/(msie|trident)/i.test(Ja.navigator.userAgent)):()=>!0,AQ=Ja.hasStandardBrowserEnv?{write(r,e,i,n,s,o){const l=[r+"="+encodeURIComponent(e)];Ht.isNumber(i)&&l.push("expires="+new Date(i).toGMTString()),Ht.isString(n)&&l.push("path="+n),Ht.isString(s)&&l.push("domain="+s),o===!0&&l.push("secure"),document.cookie=l.join("; ")},read(r){const e=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(r){this.write(r,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function yQ(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function vQ(r,e){return e?r.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):r}function iD(r,e,i){let n=!yQ(e);return r&&(n||i==!1)?vQ(r,e):e}const rD=r=>r instanceof Fo?{...r}:r;function tp(r,e){e=e||{};const i={};function n(h,p,f,g){return Ht.isPlainObject(h)&&Ht.isPlainObject(p)?Ht.merge.call({caseless:g},h,p):Ht.isPlainObject(p)?Ht.merge({},p):Ht.isArray(p)?p.slice():p}function s(h,p,f,g){if(Ht.isUndefined(p)){if(!Ht.isUndefined(h))return n(void 0,h,f,g)}else return n(h,p,f,g)}function o(h,p){if(!Ht.isUndefined(p))return n(void 0,p)}function l(h,p){if(Ht.isUndefined(p)){if(!Ht.isUndefined(h))return n(void 0,h)}else return n(void 0,p)}function u(h,p,f){if(f in e)return n(h,p);if(f in r)return n(void 0,h)}const c={url:o,method:o,data:o,baseURL:l,transformRequest:l,transformResponse:l,paramsSerializer:l,timeout:l,timeoutMessage:l,withCredentials:l,withXSRFToken:l,adapter:l,responseType:l,xsrfCookieName:l,xsrfHeaderName:l,onUploadProgress:l,onDownloadProgress:l,decompress:l,maxContentLength:l,maxBodyLength:l,beforeRedirect:l,transport:l,httpAgent:l,httpsAgent:l,cancelToken:l,socketPath:l,responseEncoding:l,validateStatus:u,headers:(h,p,f)=>s(rD(h),rD(p),f,!0)};return Ht.forEach(Object.keys(Object.assign({},r,e)),function(p){const f=c[p]||s,g=f(r[p],e[p],p);Ht.isUndefined(g)&&f!==u||(i[p]=g)}),i}const nD=r=>{const e=tp({},r);let{data:i,withXSRFToken:n,xsrfHeaderName:s,xsrfCookieName:o,headers:l,auth:u}=e;e.headers=l=Fo.from(l),e.url=qL(iD(e.baseURL,e.url,e.allowAbsoluteUrls),r.params,r.paramsSerializer),u&&l.set("Authorization","Basic "+btoa((u.username||"")+":"+(u.password?unescape(encodeURIComponent(u.password)):"")));let c;if(Ht.isFormData(i)){if(Ja.hasStandardBrowserEnv||Ja.hasStandardBrowserWebWorkerEnv)l.setContentType(void 0);else if((c=l.getContentType())!==!1){const[h,...p]=c?c.split(";").map(f=>f.trim()).filter(Boolean):[];l.setContentType([h||"multipart/form-data",...p].join("; "))}}if(Ja.hasStandardBrowserEnv&&(n&&Ht.isFunction(n)&&(n=n(e)),n||n!==!1&&gQ(e.url))){const h=s&&o&&AQ.read(o);h&&l.set(s,h)}return e},bQ=typeof XMLHttpRequest<"u"&&function(r){return new Promise(function(i,n){const s=nD(r);let o=s.data;const l=Fo.from(s.headers).normalize();let{responseType:u,onUploadProgress:c,onDownloadProgress:h}=s,p,f,g,m,y;function b(){m&&m(),y&&y(),s.cancelToken&&s.cancelToken.unsubscribe(p),s.signal&&s.signal.removeEventListener("abort",p)}let v=new XMLHttpRequest;v.open(s.method.toUpperCase(),s.url,!0),v.timeout=s.timeout;function _(){if(!v)return;const E=Fo.from("getAllResponseHeaders"in v&&v.getAllResponseHeaders()),R={data:!u||u==="text"||u==="json"?v.responseText:v.response,status:v.status,statusText:v.statusText,headers:E,config:r,request:v};$L(function(I){i(I),b()},function(I){n(I),b()},R),v=null}"onloadend"in v?v.onloadend=_:v.onreadystatechange=function(){!v||v.readyState!==4||v.status===0&&!(v.responseURL&&v.responseURL.indexOf("file:")===0)||setTimeout(_)},v.onabort=function(){v&&(n(new $r("Request aborted",$r.ECONNABORTED,r,v)),v=null)},v.onerror=function(){n(new $r("Network Error",$r.ERR_NETWORK,r,v)),v=null},v.ontimeout=function(){let T=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded";const R=s.transitional||KL;s.timeoutErrorMessage&&(T=s.timeoutErrorMessage),n(new $r(T,R.clarifyTimeoutError?$r.ETIMEDOUT:$r.ECONNABORTED,r,v)),v=null},o===void 0&&l.setContentType(null),"setRequestHeader"in v&&Ht.forEach(l.toJSON(),function(T,R){v.setRequestHeader(R,T)}),Ht.isUndefined(s.withCredentials)||(v.withCredentials=!!s.withCredentials),u&&u!=="json"&&(v.responseType=s.responseType),h&&([g,y]=nb(h,!0),v.addEventListener("progress",g)),c&&v.upload&&([f,m]=nb(c),v.upload.addEventListener("progress",f),v.upload.addEventListener("loadend",m)),(s.cancelToken||s.signal)&&(p=E=>{v&&(n(!E||E.type?new Gf(null,r,v):E),v.abort(),v=null)},s.cancelToken&&s.cancelToken.subscribe(p),s.signal&&(s.signal.aborted?p():s.signal.addEventListener("abort",p)));const C=pQ(s.url);if(C&&Ja.protocols.indexOf(C)===-1){n(new $r("Unsupported protocol "+C+":",$r.ERR_BAD_REQUEST,r));return}v.send(o||null)})},xQ=(r,e)=>{const{length:i}=r=r?r.filter(Boolean):[];if(e||i){let n=new AbortController,s;const o=function(h){if(!s){s=!0,u();const p=h instanceof Error?h:this.reason;n.abort(p instanceof $r?p:new Gf(p instanceof Error?p.message:p))}};let l=e&&setTimeout(()=>{l=null,o(new $r(`timeout ${e} of ms exceeded`,$r.ETIMEDOUT))},e);const u=()=>{r&&(l&&clearTimeout(l),l=null,r.forEach(h=>{h.unsubscribe?h.unsubscribe(o):h.removeEventListener("abort",o)}),r=null)};r.forEach(h=>h.addEventListener("abort",o));const{signal:c}=n;return c.unsubscribe=()=>Ht.asap(u),c}},_Q=function*(r,e){let i=r.byteLength;if(i<e){yield r;return}let n=0,s;for(;n<i;)s=n+e,yield r.slice(n,s),n=s},EQ=async function*(r,e){for await(const i of wQ(r))yield*_Q(i,e)},wQ=async function*(r){if(r[Symbol.asyncIterator]){yield*r;return}const e=r.getReader();try{for(;;){const{done:i,value:n}=await e.read();if(i)break;yield n}}finally{await e.cancel()}},sD=(r,e,i,n)=>{const s=EQ(r,e);let o=0,l,u=c=>{l||(l=!0,n&&n(c))};return new ReadableStream({async pull(c){try{const{done:h,value:p}=await s.next();if(h){u(),c.close();return}let f=p.byteLength;if(i){let g=o+=f;i(g)}c.enqueue(new Uint8Array(p))}catch(h){throw u(h),h}},cancel(c){return u(c),s.return()}},{highWaterMark:2})},sb=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",aD=sb&&typeof ReadableStream=="function",CQ=sb&&(typeof TextEncoder=="function"?(r=>e=>r.encode(e))(new TextEncoder):async r=>new Uint8Array(await new Response(r).arrayBuffer())),oD=(r,...e)=>{try{return!!r(...e)}catch{return!1}},SQ=aD&&oD(()=>{let r=!1;const e=new Request(Ja.origin,{body:new ReadableStream,method:"POST",get duplex(){return r=!0,"half"}}).headers.has("Content-Type");return r&&!e}),lD=64*1024,E2=aD&&oD(()=>Ht.isReadableStream(new Response("").body)),ab={stream:E2&&(r=>r.body)};sb&&(r=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!ab[e]&&(ab[e]=Ht.isFunction(r[e])?i=>i[e]():(i,n)=>{throw new $r(`Response type '${e}' is not supported`,$r.ERR_NOT_SUPPORT,n)})})})(new Response);const TQ=async r=>{if(r==null)return 0;if(Ht.isBlob(r))return r.size;if(Ht.isSpecCompliantForm(r))return(await new Request(Ja.origin,{method:"POST",body:r}).arrayBuffer()).byteLength;if(Ht.isArrayBufferView(r)||Ht.isArrayBuffer(r))return r.byteLength;if(Ht.isURLSearchParams(r)&&(r=r+""),Ht.isString(r))return(await CQ(r)).byteLength},MQ=async(r,e)=>{const i=Ht.toFiniteNumber(r.getContentLength());return i??TQ(e)},w2={http:KW,xhr:bQ,fetch:sb&&(async r=>{let{url:e,method:i,data:n,signal:s,cancelToken:o,timeout:l,onDownloadProgress:u,onUploadProgress:c,responseType:h,headers:p,withCredentials:f="same-origin",fetchOptions:g}=nD(r);h=h?(h+"").toLowerCase():"text";let m=xQ([s,o&&o.toAbortSignal()],l),y;const b=m&&m.unsubscribe&&(()=>{m.unsubscribe()});let v;try{if(c&&SQ&&i!=="get"&&i!=="head"&&(v=await MQ(p,n))!==0){let R=new Request(e,{method:"POST",body:n,duplex:"half"}),B;if(Ht.isFormData(n)&&(B=R.headers.get("content-type"))&&p.setContentType(B),R.body){const[I,D]=eD(v,nb(tD(c)));n=sD(R.body,lD,I,D)}}Ht.isString(f)||(f=f?"include":"omit");const _="credentials"in Request.prototype;y=new Request(e,{...g,signal:m,method:i.toUpperCase(),headers:p.normalize().toJSON(),body:n,duplex:"half",credentials:_?f:void 0});let C=await fetch(y);const E=E2&&(h==="stream"||h==="response");if(E2&&(u||E&&b)){const R={};["status","statusText","headers"].forEach(L=>{R[L]=C[L]});const B=Ht.toFiniteNumber(C.headers.get("content-length")),[I,D]=u&&eD(B,nb(tD(u),!0))||[];C=new Response(sD(C.body,lD,I,()=>{D&&D(),b&&b()}),R)}h=h||"text";let T=await ab[Ht.findKey(ab,h)||"text"](C,r);return!E&&b&&b(),await new Promise((R,B)=>{$L(R,B,{data:T,headers:Fo.from(C.headers),status:C.status,statusText:C.statusText,config:r,request:y})})}catch(_){throw b&&b(),_&&_.name==="TypeError"&&/Load failed|fetch/i.test(_.message)?Object.assign(new $r("Network Error",$r.ERR_NETWORK,r,y),{cause:_.cause||_}):$r.from(_,_&&_.code,r,y)}})};Ht.forEach(w2,(r,e)=>{if(r){try{Object.defineProperty(r,"name",{value:e})}catch{}Object.defineProperty(r,"adapterName",{value:e})}});const cD=r=>`- ${r}`,RQ=r=>Ht.isFunction(r)||r===null||r===!1,uD={getAdapter:r=>{r=Ht.isArray(r)?r:[r];const{length:e}=r;let i,n;const s={};for(let o=0;o<e;o++){i=r[o];let l;if(n=i,!RQ(i)&&(n=w2[(l=String(i)).toLowerCase()],n===void 0))throw new $r(`Unknown adapter '${l}'`);if(n)break;s[l||"#"+o]=n}if(!n){const o=Object.entries(s).map(([u,c])=>`adapter ${u} `+(c===!1?"is not supported by the environment":"is not available in the build"));let l=e?o.length>1?`since :
`+o.map(cD).join(`
`):" "+cD(o[0]):"as no adapter specified";throw new $r("There is no suitable adapter to dispatch the request "+l,"ERR_NOT_SUPPORT")}return n},adapters:w2};function C2(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new Gf(null,r)}function hD(r){return C2(r),r.headers=Fo.from(r.headers),r.data=_2.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),uD.getAdapter(r.adapter||V0.adapter)(r).then(function(n){return C2(r),n.data=_2.call(r,r.transformResponse,n),n.headers=Fo.from(n.headers),n},function(n){return ZL(n)||(C2(r),n&&n.response&&(n.response.data=_2.call(r,r.transformResponse,n.response),n.response.headers=Fo.from(n.response.headers))),Promise.reject(n)})}const dD="1.9.0",ob={};["object","boolean","number","function","string","symbol"].forEach((r,e)=>{ob[r]=function(n){return typeof n===r||"a"+(e<1?"n ":" ")+r}});const pD={};ob.transitional=function(e,i,n){function s(o,l){return"[Axios v"+dD+"] Transitional option '"+o+"'"+l+(n?". "+n:"")}return(o,l,u)=>{if(e===!1)throw new $r(s(l," has been removed"+(i?" in "+i:"")),$r.ERR_DEPRECATED);return i&&!pD[l]&&(pD[l]=!0,console.warn(s(l," has been deprecated since v"+i+" and will be removed in the near future"))),e?e(o,l,u):!0}},ob.spelling=function(e){return(i,n)=>(console.warn(`${n} is likely a misspelling of ${e}`),!0)};function IQ(r,e,i){if(typeof r!="object")throw new $r("options must be an object",$r.ERR_BAD_OPTION_VALUE);const n=Object.keys(r);let s=n.length;for(;s-- >0;){const o=n[s],l=e[o];if(l){const u=r[o],c=u===void 0||l(u,o,r);if(c!==!0)throw new $r("option "+o+" must be "+c,$r.ERR_BAD_OPTION_VALUE);continue}if(i!==!0)throw new $r("Unknown option "+o,$r.ERR_BAD_OPTION)}}const lb={assertOptions:IQ,validators:ob},jc=lb.validators;let ip=class{constructor(e){this.defaults=e||{},this.interceptors={request:new XL,response:new XL}}async request(e,i){try{return await this._request(e,i)}catch(n){if(n instanceof Error){let s={};Error.captureStackTrace?Error.captureStackTrace(s):s=new Error;const o=s.stack?s.stack.replace(/^.+\n/,""):"";try{n.stack?o&&!String(n.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+o):n.stack=o}catch{}}throw n}}_request(e,i){typeof e=="string"?(i=i||{},i.url=e):i=e||{},i=tp(this.defaults,i);const{transitional:n,paramsSerializer:s,headers:o}=i;n!==void 0&&lb.assertOptions(n,{silentJSONParsing:jc.transitional(jc.boolean),forcedJSONParsing:jc.transitional(jc.boolean),clarifyTimeoutError:jc.transitional(jc.boolean)},!1),s!=null&&(Ht.isFunction(s)?i.paramsSerializer={serialize:s}:lb.assertOptions(s,{encode:jc.function,serialize:jc.function},!0)),i.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?i.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:i.allowAbsoluteUrls=!0),lb.assertOptions(i,{baseUrl:jc.spelling("baseURL"),withXsrfToken:jc.spelling("withXSRFToken")},!0),i.method=(i.method||this.defaults.method||"get").toLowerCase();let l=o&&Ht.merge(o.common,o[i.method]);o&&Ht.forEach(["delete","get","head","post","put","patch","common"],y=>{delete o[y]}),i.headers=Fo.concat(l,o);const u=[];let c=!0;this.interceptors.request.forEach(function(b){typeof b.runWhen=="function"&&b.runWhen(i)===!1||(c=c&&b.synchronous,u.unshift(b.fulfilled,b.rejected))});const h=[];this.interceptors.response.forEach(function(b){h.push(b.fulfilled,b.rejected)});let p,f=0,g;if(!c){const y=[hD.bind(this),void 0];for(y.unshift.apply(y,u),y.push.apply(y,h),g=y.length,p=Promise.resolve(i);f<g;)p=p.then(y[f++],y[f++]);return p}g=u.length;let m=i;for(f=0;f<g;){const y=u[f++],b=u[f++];try{m=y(m)}catch(v){b.call(this,v);break}}try{p=hD.call(this,m)}catch(y){return Promise.reject(y)}for(f=0,g=h.length;f<g;)p=p.then(h[f++],h[f++]);return p}getUri(e){e=tp(this.defaults,e);const i=iD(e.baseURL,e.url,e.allowAbsoluteUrls);return qL(i,e.params,e.paramsSerializer)}};Ht.forEach(["delete","get","head","options"],function(e){ip.prototype[e]=function(i,n){return this.request(tp(n||{},{method:e,url:i,data:(n||{}).data}))}}),Ht.forEach(["post","put","patch"],function(e){function i(n){return function(o,l,u){return this.request(tp(u||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:o,data:l}))}}ip.prototype[e]=i(),ip.prototype[e+"Form"]=i(!0)});let BQ=class HH{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let i;this.promise=new Promise(function(o){i=o});const n=this;this.promise.then(s=>{if(!n._listeners)return;let o=n._listeners.length;for(;o-- >0;)n._listeners[o](s);n._listeners=null}),this.promise.then=s=>{let o;const l=new Promise(u=>{n.subscribe(u),o=u}).then(s);return l.cancel=function(){n.unsubscribe(o)},l},e(function(o,l,u){n.reason||(n.reason=new Gf(o,l,u),i(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const i=this._listeners.indexOf(e);i!==-1&&this._listeners.splice(i,1)}toAbortSignal(){const e=new AbortController,i=n=>{e.abort(n)};return this.subscribe(i),e.signal.unsubscribe=()=>this.unsubscribe(i),e.signal}static source(){let e;return{token:new HH(function(s){e=s}),cancel:e}}};function NQ(r){return function(i){return r.apply(null,i)}}function LQ(r){return Ht.isObject(r)&&r.isAxiosError===!0}const S2={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(S2).forEach(([r,e])=>{S2[e]=r});function fD(r){const e=new ip(r),i=NL(ip.prototype.request,e);return Ht.extend(i,ip.prototype,e,{allOwnKeys:!0}),Ht.extend(i,e,null,{allOwnKeys:!0}),i.create=function(s){return fD(tp(r,s))},i}const Ms=fD(V0);Ms.Axios=ip,Ms.CanceledError=Gf,Ms.CancelToken=BQ,Ms.isCancel=ZL,Ms.VERSION=dD,Ms.toFormData=ib,Ms.AxiosError=$r,Ms.Cancel=Ms.CanceledError,Ms.all=function(e){return Promise.all(e)},Ms.spread=NQ,Ms.isAxiosError=LQ,Ms.mergeConfig=tp,Ms.AxiosHeaders=Fo,Ms.formToJSON=r=>YL(Ht.isHTMLForm(r)?new FormData(r):r),Ms.getAdapter=uD.getAdapter,Ms.HttpStatusCode=S2,Ms.default=Ms;const{Axios:LBe,AxiosError:DBe,CanceledError:OBe,isCancel:PBe,CancelToken:kBe,VERSION:FBe,all:UBe,Cancel:zBe,isAxiosError:jBe,spread:GBe,toFormData:VBe,AxiosHeaders:HBe,HttpStatusCode:WBe,formToJSON:QBe,getAdapter:qBe,mergeConfig:XBe}=Ms,mD=r=>{localStorage.setItem("auth_token",r)},T2=()=>localStorage.getItem("auth_token"),cb=()=>!!T2(),DQ=()=>{localStorage.removeItem("auth_token")},M2=()=>{const r=T2();return r?`Bearer ${r}`:""};let R2=null;const ub=()=>{if(!R2)throw new Error("Configuration Player-map non initialisée. Utilisez PlayerMapConfig.init() pour configurer la bibliothèque.");return{...R2}},OQ=r=>{if(!r.apiUrl)throw new Error("L'URL de l'API est requise pour initialiser Player-map");R2={apiUrl:r.apiUrl}},PQ=async r=>{try{const e=new FormData;if(e.append("file",r),!cb())throw new Error("Vous devez être connecté pour téléverser des fichiers");const{apiUrl:i}=ub(),n=`${i}/ipfs/upload_file`;return(await Ms.post(n,e,{headers:{"Content-Type":"multipart/form-data",Authorization:M2()}})).data.ipfs_url}catch(e){throw e instanceof Error&&e.message.includes("Configuration Player-map non initialisée")?(console.error("Erreur de configuration Player-map:",e.message),new Error("Erreur de configuration: Initialisez la bibliothèque Player-map avec PlayerMapConfig.init() avant utilisation")):(console.error("Erreur lors du téléversement vers le serveur:",e),new Error("Échec du téléversement de l'image vers IPFS"))}},gD=r=>r?r.startsWith("ipfs://"):!1,kQ=async r=>{if(!gD(r))return r;try{let e=sessionStorage.getItem("ipfs_gateway");if(!e){if(!cb())throw new Error("Vous devez être connecté pour accéder à la passerelle IPFS");const{apiUrl:n}=ub();if(e=(await Ms.get(`${n}/ipfs/gateway_url`,{headers:{Authorization:M2()}})).data.gateway_url,e)sessionStorage.setItem("ipfs_gateway",e);else throw new Error("Aucune passerelle IPFS configurée")}const i=r.replace("ipfs://","");return`https://${e}/ipfs/${i}`}catch(e){throw e instanceof Error&&e.message.includes("Configuration Player-map non initialisée")?(console.error("Erreur de configuration Player-map:",e.message),new Error("Erreur de configuration: Initialisez la bibliothèque Player-map avec PlayerMapConfig.init() avant utilisation")):(console.error("Erreur lors de la récupération du gateway URL:",e),e)}},fs={IS_PLAYER_GAMES:{predicateId:24536n,objectId:24537n},IS_FAIRPLAY:{predicateId:11995n,objectId:24533n},IS_STRONG_BOSS:{predicateId:11995n,objectId:24534n},IS_STRONG_FIGHTER:{predicateId:11995n,objectId:24535n},IS_PLAYER_GUILD:{predicateId:24536n,objectId:null}},FQ=[{id:24538n,name:"The Alchemists"},{id:24539n,name:"Big Time Warriors"},{id:24540n,name:"The NEST"},{id:24541n,name:"Clock Work Gamers"},{id:24542n,name:"Vast Impact Gaming"},{id:24543n,name:"Kraken Gaming"},{id:24544n,name:"FAM"}],UQ=({src:r})=>{const[e,i]=Dt.useState(r),[n,s]=Dt.useState(!0);return Dt.useEffect(()=>{(async()=>{s(!0);try{const l=zQ(r)?jQ(r):r;i(l)}catch(l){console.error("Error loading image:",l)}finally{s(!1)}})()},[r]),n?It.jsx("div",{children:"Loading image..."}):It.jsx("img",{src:e,alt:"Preview",style:{maxWidth:"100%",maxHeight:"150px",borderRadius:"5px"}})},zQ=r=>r.startsWith("ipfs://"),jQ=r=>r.replace("ipfs://","https://gateway.pinata.cloud/ipfs/"),GQ=({step:r,isCreatingAtom:e,isCreatingTriples:i,creationSuccess:n,atomId:s,tripleCreated:o,walletAddress:l,hasExistingAtom:u,formData:c,handleInputChange:h,handleSelectChange:p,handleFileUpload:f,handleSubmit:g,isLoading:m,isUploading:y,fileInputRef:b})=>It.jsxs(It.Fragment,{children:[It.jsxs("div",{style:{marginBottom:"20px"},children:[It.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"10px"},children:[It.jsxs("div",{style:{textAlign:"center",flex:1},children:[It.jsx("div",{style:{width:"30px",height:"30px",borderRadius:"15px",backgroundColor:e||r>1?"#FFD32A":"#2e2e40",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto",color:e||r>1?"#000":"#fff"},children:r>1?"✓":"1"}),It.jsx("p",{style:{fontSize:"0.8em",marginTop:"5px"},children:"Atom Creation"})]}),It.jsxs("div",{style:{textAlign:"center",flex:1},children:[It.jsx("div",{style:{width:"30px",height:"30px",borderRadius:"15px",backgroundColor:i||r>2?"#FFD32A":"#2e2e40",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto",color:i||r>2?"#000":"#fff"},children:r>2?"✓":"2"}),It.jsx("p",{style:{fontSize:"0.8em",marginTop:"5px"},children:"Triples Creation"})]}),It.jsxs("div",{style:{textAlign:"center",flex:1},children:[It.jsx("div",{style:{width:"30px",height:"30px",borderRadius:"15px",backgroundColor:r===3?"#4CAF50":"#2e2e40",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto",color:r===3?"#000":"#fff"},children:r===3?"✓":"3"}),It.jsx("p",{style:{fontSize:"0.8em",marginTop:"5px"},children:"Success"})]})]}),It.jsx("div",{style:{height:"4px",backgroundColor:"#2e2e40",position:"relative",marginBottom:"20px"},children:It.jsx("div",{style:{position:"absolute",left:0,top:0,height:"100%",width:`${(r-1)*50}%`,backgroundColor:"#FFD32A",transition:"width 0.3s ease"}})})]}),n?It.jsxs("div",{style:{textAlign:"center",color:"#4CAF50"},children:[It.jsx("h3",{style:{color:"#4CAF50",marginBottom:"10px"},children:"Success!"}),It.jsx("p",{children:"Your player has been created successfully."}),It.jsxs("p",{children:["Atom ID: ",s]}),It.jsxs("p",{children:["Triples created: ",o?"Yes":"No"]}),It.jsx("p",{children:"This window will close automatically..."})]}):l?u?It.jsx("p",{style:{textAlign:"center",color:"#ff4444"},children:"You already have an atom associated with this wallet"}):It.jsxs(It.Fragment,{children:[It.jsxs("div",{style:{marginBottom:"15px"},children:[It.jsx("label",{style:{display:"block",marginBottom:"5px",fontSize:"0.9em",textAlign:"left"},children:"Pseudo"}),It.jsx("input",{type:"text",name:"pseudo",value:c.pseudo,onChange:h,placeholder:"Enter your pseudo",style:{width:"100%",padding:"8px",backgroundColor:"#1e1e30",border:"1px solid #333",color:"#fff",borderRadius:"4px"}})]}),It.jsxs("div",{style:{marginBottom:"15px"},children:[It.jsx("label",{style:{display:"block",marginBottom:"5px",fontSize:"0.9em",textAlign:"left"},children:"User UID"}),It.jsx("input",{type:"text",name:"userId",value:c.userId,onChange:h,placeholder:"Enter your BossFighters UID",style:{width:"100%",padding:"8px",backgroundColor:"#1e1e30",border:"1px solid #333",color:"#fff",borderRadius:"4px"}})]}),It.jsxs("div",{style:{marginBottom:"15px"},children:[It.jsx("label",{style:{display:"block",marginBottom:"5px",fontSize:"0.9em",textAlign:"left"},children:"Guild (Optional)"}),It.jsxs("select",{name:"guildId",value:c.guildId||"",onChange:p,style:{width:"100%",padding:"8px",backgroundColor:"#1e1e30",border:"1px solid #333",color:"#fff",borderRadius:"4px"},children:[It.jsx("option",{value:"",children:"Select a guild (optional)"}),FQ.map(v=>It.jsx("option",{value:v.id.toString(),children:v.name},v.id.toString()))]})]}),It.jsxs("div",{style:{marginBottom:"15px"},children:[It.jsx("label",{style:{display:"block",marginBottom:"5px",fontSize:"0.9em",textAlign:"left"},children:"Profile Picture (optional)"}),It.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:[It.jsxs("div",{children:[It.jsx("button",{onClick:()=>{var v;return(v=b.current)==null?void 0:v.click()},style:{padding:"8px 15px",backgroundColor:"#2e2e40",color:"#fff",border:"1px solid #333",borderRadius:"4px",cursor:"pointer",marginRight:"10px"},disabled:y,children:y?"Upload in progress...":"Choose an image"}),It.jsx("input",{ref:b,type:"file",accept:"image/*",onChange:f,style:{display:"none"}})]}),It.jsx("p",{style:{fontSize:"0.8em",color:"#aaa",marginTop:"0px"},children:"This image will be used as your player's profile picture."}),c.image&&It.jsxs("div",{style:{marginTop:"10px"},children:[It.jsx("p",{style:{fontSize:"0.8em",color:"#aaa",marginBottom:"5px"},children:"Image preview:"}),It.jsx(UQ,{src:c.image})]})]})]}),It.jsx("div",{style:{textAlign:"center"},children:It.jsx("button",{onClick:g,disabled:m||y,style:{padding:"8px 20px",backgroundColor:"#FFD32A",color:"#000",border:"none",borderRadius:"5px",cursor:"pointer",fontWeight:"bold",opacity:m||y?.7:1},children:m?e?"Creating atom...":i?"Creating triples...":"Creating in progress...":"CREATE YOUR PLAYER"})})]}):It.jsx("div",{children:It.jsx("p",{style:{textAlign:"center",color:"#ff4444"},children:"Please connect your wallet first"})})]});function I2(r,{strict:e=!0}={}){return!r||typeof r!="string"?!1:e?/^0x[0-9a-fA-F]*$/.test(r):r.startsWith("0x")}function AD(r){return I2(r,{strict:!1})?Math.ceil((r.length-2)/2):r.length}const yD="2.29.2";let W0={getDocsUrl:({docsBaseUrl:r,docsPath:e="",docsSlug:i})=>e?`${r??"https://viem.sh"}${e}${i?`#${i}`:""}`:void 0,version:`viem@${yD}`};class rp extends Error{constructor(e,i={}){var u;const n=(()=>{var c;return i.cause instanceof rp?i.cause.details:(c=i.cause)!=null&&c.message?i.cause.message:i.details})(),s=i.cause instanceof rp&&i.cause.docsPath||i.docsPath,o=(u=W0.getDocsUrl)==null?void 0:u.call(W0,{...i,docsPath:s}),l=[e||"An error occurred.","",...i.metaMessages?[...i.metaMessages,""]:[],...o?[`Docs: ${o}`]:[],...n?[`Details: ${n}`]:[],...W0.version?[`Version: ${W0.version}`]:[]].join(`
`);super(l,i.cause?{cause:i.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=n,this.docsPath=s,this.metaMessages=i.metaMessages,this.name=i.name??this.name,this.shortMessage=e,this.version=yD}walk(e){return vD(this,e)}}function vD(r,e){return e!=null&&e(r)?r:r&&typeof r=="object"&&"cause"in r&&r.cause!==void 0?vD(r.cause,e):e?null:r}class bD extends rp{constructor({size:e,targetSize:i,type:n}){super(`${n.charAt(0).toUpperCase()}${n.slice(1).toLowerCase()} size (${e}) exceeds padding size (${i}).`,{name:"SizeExceedsPaddingSizeError"})}}function Vf(r,{dir:e,size:i=32}={}){return typeof r=="string"?VQ(r,{dir:e,size:i}):HQ(r,{dir:e,size:i})}function VQ(r,{dir:e,size:i=32}={}){if(i===null)return r;const n=r.replace("0x","");if(n.length>i*2)throw new bD({size:Math.ceil(n.length/2),targetSize:i,type:"hex"});return`0x${n[e==="right"?"padEnd":"padStart"](i*2,"0")}`}function HQ(r,{dir:e,size:i=32}={}){if(i===null)return r;if(r.length>i)throw new bD({size:r.length,targetSize:i,type:"bytes"});const n=new Uint8Array(i);for(let s=0;s<i;s++){const o=e==="right";n[o?s:i-s-1]=r[o?s:r.length-s-1]}return n}class WQ extends rp{constructor({max:e,min:i,signed:n,size:s,value:o}){super(`Number "${o}" is not in safe ${s?`${s*8}-bit ${n?"signed":"unsigned"} `:""}integer range ${e?`(${i} to ${e})`:`(above ${i})`}`,{name:"IntegerOutOfRangeError"})}}class QQ extends rp{constructor({givenSize:e,maxSize:i}){super(`Size cannot exceed ${i} bytes. Given size: ${e} bytes.`,{name:"SizeOverflowError"})}}function Q0(r,{size:e}){if(AD(r)>e)throw new QQ({givenSize:AD(r),maxSize:e})}const qQ=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function xD(r,e={}){return typeof r=="number"||typeof r=="bigint"?ED(r,e):typeof r=="string"?YQ(r,e):typeof r=="boolean"?XQ(r,e):_D(r,e)}function XQ(r,e={}){const i=`0x${Number(r)}`;return typeof e.size=="number"?(Q0(i,{size:e.size}),Vf(i,{size:e.size})):i}function _D(r,e={}){let i="";for(let s=0;s<r.length;s++)i+=qQ[r[s]];const n=`0x${i}`;return typeof e.size=="number"?(Q0(n,{size:e.size}),Vf(n,{dir:"right",size:e.size})):n}function ED(r,e={}){const{signed:i,size:n}=e,s=BigInt(r);let o;n?i?o=(1n<<BigInt(n)*8n-1n)-1n:o=2n**(BigInt(n)*8n)-1n:typeof r=="number"&&(o=BigInt(Number.MAX_SAFE_INTEGER));const l=typeof o=="bigint"&&i?-o-1n:0;if(o&&s>o||s<l){const c=typeof r=="bigint"?"n":"";throw new WQ({max:o?`${o}${c}`:void 0,min:`${l}${c}`,signed:i,size:n,value:`${r}${c}`})}const u=`0x${(i&&s<0?(1n<<BigInt(n*8))+BigInt(s):s).toString(16)}`;return n?Vf(u,{size:n}):u}const KQ=new TextEncoder;function YQ(r,e={}){const i=KQ.encode(r);return _D(i,e)}const JQ=new TextEncoder;function ZQ(r,e={}){return typeof r=="number"||typeof r=="bigint"?eq(r,e):typeof r=="boolean"?$Q(r,e):I2(r)?CD(r,e):tq(r,e)}function $Q(r,e={}){const i=new Uint8Array(1);return i[0]=Number(r),typeof e.size=="number"?(Q0(i,{size:e.size}),Vf(i,{size:e.size})):i}const pu={zero:48,nine:57,A:65,F:70,a:97,f:102};function wD(r){if(r>=pu.zero&&r<=pu.nine)return r-pu.zero;if(r>=pu.A&&r<=pu.F)return r-(pu.A-10);if(r>=pu.a&&r<=pu.f)return r-(pu.a-10)}function CD(r,e={}){let i=r;e.size&&(Q0(i,{size:e.size}),i=Vf(i,{dir:"right",size:e.size}));let n=i.slice(2);n.length%2&&(n=`0${n}`);const s=n.length/2,o=new Uint8Array(s);for(let l=0,u=0;l<s;l++){const c=wD(n.charCodeAt(u++)),h=wD(n.charCodeAt(u++));if(c===void 0||h===void 0)throw new rp(`Invalid byte sequence ("${n[u-2]}${n[u-1]}" in "${n}").`);o[l]=c*16+h}return o}function eq(r,e){const i=ED(r,e);return CD(i)}function tq(r,e={}){const i=JQ.encode(r);return typeof e.size=="number"?(Q0(i,{size:e.size}),Vf(i,{dir:"right",size:e.size})):i}function SD(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function iq(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function B2(r,...e){if(!iq(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function TD(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function rq(r,e){B2(r);const i=e.outputLen;if(r.length<i)throw new Error("digestInto() expects output buffer of length at least "+i)}const hb=BigInt(2**32-1),MD=BigInt(32);function nq(r,e=!1){return e?{h:Number(r&hb),l:Number(r>>MD&hb)}:{h:Number(r>>MD&hb)|0,l:Number(r&hb)|0}}function sq(r,e=!1){let i=new Uint32Array(r.length),n=new Uint32Array(r.length);for(let s=0;s<r.length;s++){const{h:o,l}=nq(r[s],e);[i[s],n[s]]=[o,l]}return[i,n]}const aq=(r,e,i)=>r<<i|e>>>32-i,oq=(r,e,i)=>e<<i|r>>>32-i,lq=(r,e,i)=>e<<i-32|r>>>64-i,cq=(r,e,i)=>r<<i-32|e>>>64-i;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function uq(r){return new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4))}const RD=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function hq(r){return r<<24&4278190080|r<<8&16711680|r>>>8&65280|r>>>24&255}function ID(r){for(let e=0;e<r.length;e++)r[e]=hq(r[e])}typeof Uint8Array.from([]).toHex=="function"&&Uint8Array.fromHex;function dq(r){if(typeof r!="string")throw new Error("utf8ToBytes expected string, got "+typeof r);return new Uint8Array(new TextEncoder().encode(r))}function BD(r){return typeof r=="string"&&(r=dq(r)),B2(r),r}class pq{clone(){return this._cloneInto()}}function fq(r){const e=n=>r().update(BD(n)).digest(),i=r();return e.outputLen=i.outputLen,e.blockLen=i.blockLen,e.create=()=>r(),e}const ND=[],LD=[],DD=[],mq=BigInt(0),q0=BigInt(1),gq=BigInt(2),Aq=BigInt(7),yq=BigInt(256),vq=BigInt(113);for(let r=0,e=q0,i=1,n=0;r<24;r++){[i,n]=[n,(2*i+3*n)%5],ND.push(2*(5*n+i)),LD.push((r+1)*(r+2)/2%64);let s=mq;for(let o=0;o<7;o++)e=(e<<q0^(e>>Aq)*vq)%yq,e&gq&&(s^=q0<<(q0<<BigInt(o))-q0);DD.push(s)}const[bq,xq]=sq(DD,!0),OD=(r,e,i)=>i>32?lq(r,e,i):aq(r,e,i),PD=(r,e,i)=>i>32?cq(r,e,i):oq(r,e,i);function _q(r,e=24){const i=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let l=0;l<10;l++)i[l]=r[l]^r[l+10]^r[l+20]^r[l+30]^r[l+40];for(let l=0;l<10;l+=2){const u=(l+8)%10,c=(l+2)%10,h=i[c],p=i[c+1],f=OD(h,p,1)^i[u],g=PD(h,p,1)^i[u+1];for(let m=0;m<50;m+=10)r[l+m]^=f,r[l+m+1]^=g}let s=r[2],o=r[3];for(let l=0;l<24;l++){const u=LD[l],c=OD(s,o,u),h=PD(s,o,u),p=ND[l];s=r[p],o=r[p+1],r[p]=c,r[p+1]=h}for(let l=0;l<50;l+=10){for(let u=0;u<10;u++)i[u]=r[l+u];for(let u=0;u<10;u++)r[l+u]^=~i[(u+2)%10]&i[(u+4)%10]}r[0]^=bq[n],r[1]^=xq[n]}i.fill(0)}class N2 extends pq{constructor(e,i,n,s=!1,o=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=i,this.outputLen=n,this.enableXOF=s,this.rounds=o,SD(n),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=uq(this.state)}keccak(){RD||ID(this.state32),_q(this.state32,this.rounds),RD||ID(this.state32),this.posOut=0,this.pos=0}update(e){TD(this);const{blockLen:i,state:n}=this;e=BD(e);const s=e.length;for(let o=0;o<s;){const l=Math.min(i-this.pos,s-o);for(let u=0;u<l;u++)n[this.pos++]^=e[o++];this.pos===i&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:i,pos:n,blockLen:s}=this;e[n]^=i,i&128&&n===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){TD(this,!1),B2(e),this.finish();const i=this.state,{blockLen:n}=this;for(let s=0,o=e.length;s<o;){this.posOut>=n&&this.keccak();const l=Math.min(n-this.posOut,o-s);e.set(i.subarray(this.posOut,this.posOut+l),s),this.posOut+=l,s+=l}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return SD(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(rq(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:i,suffix:n,outputLen:s,rounds:o,enableXOF:l}=this;return e||(e=new N2(i,n,s,l,o)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=o,e.suffix=n,e.outputLen=s,e.enableXOF=l,e.destroyed=this.destroyed,e}}const Eq=((r,e,i)=>fq(()=>new N2(e,r,i)))(1,136,256/8);function wq(r,e){const i=Eq(I2(r,{strict:!1})?ZQ(r):r);return xD(i)}const Cq=async r=>{try{if(!cb())throw new Error("Vous devez être connecté pour envoyer des données à IPFS");const{apiUrl:e}=ub(),i=`${e}/ipfs/hash_data`,n=await Ms.post(i,{data:r},{headers:{"Content-Type":"application/json",Authorization:M2()}});return{ipfsHash:n.data.ipfs_hash,httpUrl:n.data.http_url}}catch(e){throw e instanceof Error&&e.message.includes("Configuration Player-map non initialisée")?(console.error("Erreur de configuration Player-map:",e.message),new Error("Erreur de configuration: Initialisez la bibliothèque Player-map avec PlayerMapConfig.init() avant utilisation")):(console.error("Erreur lors du hachage de données vers IPFS:",e),e)}},Sq=({walletConnected:r,walletAddress:e,publicClient:i})=>({createAtom:async s=>{if(!r||!e)throw new Error("Wallet not connected");try{const o={"@context":"https://schema.org/","@type":"Thing",...s};o.image&&gD(o.image)&&(o.image=await kQ(o.image));const{ipfsHash:l}=await Cq(o),u=xD(l),c=wq(u),h=i||r;if(h&&typeof h.readContract=="function")try{const g=await h.readContract({address:Uc,abi:zc,functionName:"atomsByHash",args:[c]});if(g&&BigInt(g)!==0n)return{atomId:BigInt(g),ipfsHash:l}}catch(g){console.error("Error checking if atom exists:",g)}else console.warn("No valid read client with readContract method available");const p=await r.writeContract({address:Uc,abi:zc,functionName:"createAtom",args:[u],value:cW});let f;if(r.waitForTransactionReceipt?f=await r.waitForTransactionReceipt({hash:p}):p.wait?f=await p.wait():await new Promise(g=>setTimeout(g,3e3)),h&&typeof h.readContract=="function")try{const g=await h.readContract({address:Uc,abi:zc,functionName:"atomsByHash",args:[c]});return{atomId:BigInt(g),ipfsHash:l}}catch(g){if(console.error("Error reading new atom ID with readClient:",g),i&&i!==h&&typeof i.readContract=="function")try{const m=await i.readContract({address:Uc,abi:zc,functionName:"atomsByHash",args:[c]});return{atomId:BigInt(m),ipfsHash:l}}catch(m){console.error("Failed second attempt to read atom ID:",m)}}else if(console.warn("No valid read client available to read the new atom ID"),i&&typeof i.readContract=="function")try{const g=await i.readContract({address:Uc,abi:zc,functionName:"atomsByHash",args:[c]});return{atomId:BigInt(g),ipfsHash:l}}catch(g){console.error("Failed fallback attempt to read atom ID with publicClient:",g)}return console.warn("Using default atom ID as a fallback"),{atomId:1n,ipfsHash:l}}catch(o){throw console.error("Error creating atom:",o),o}}}),Tq=({walletConnected:r,walletAddress:e,publicClient:i})=>{const n=async(l,u,c)=>{if(!r||!e)throw new Error("Wallet not connected");try{const h=i||r;return!h||typeof h.readContract!="function"?(console.warn("No valid read client available to check if triple exists"),!1):await h.readContract({address:Uc,abi:zc,functionName:"isTriple",args:[l,u,c]})}catch(h){if(console.error("Error checking if triple exists:",h),i&&i!==r&&typeof i.readContract=="function")try{return await i.readContract({address:Uc,abi:zc,functionName:"isTriple",args:[l,u,c]})}catch(p){console.error("Second attempt failed when checking if triple exists:",p)}return!1}},s=async l=>{if(!r||!e)throw new Error("Wallet not connected");try{const u=l.map(g=>g.subjectId),c=l.map(g=>g.predicateId),h=l.map(g=>g.objectId),p=await r.writeContract({address:Uc,abi:zc,functionName:"batchCreateTriple",args:[u,c,h],value:uW*BigInt(l.length)});let f;return r.waitForTransactionReceipt?f=await r.waitForTransactionReceipt({hash:p}):p.wait?f=await p.wait():await new Promise(g=>setTimeout(g,3e3)),{hash:typeof p=="string"?p:p.hash,receipt:f}}catch(u){throw console.error("Error batch creating triples:",u),u}};return{checkTripleExists:n,batchCreateTriple:s,createPlayerTriples:async l=>{const u=[{subjectId:l,predicateId:fs.IS_PLAYER_GAMES.predicateId,objectId:fs.IS_PLAYER_GAMES.objectId},{subjectId:l,predicateId:fs.IS_FAIRPLAY.predicateId,objectId:fs.IS_FAIRPLAY.objectId},{subjectId:l,predicateId:fs.IS_STRONG_BOSS.predicateId,objectId:fs.IS_STRONG_BOSS.objectId},{subjectId:l,predicateId:fs.IS_STRONG_FIGHTER.predicateId,objectId:fs.IS_STRONG_FIGHTER.objectId}];return s(u)}}},Mq=(r,e,i)=>{const{createAtom:n}=Sq({walletConnected:r,walletAddress:e,publicClient:i}),{batchCreateTriple:s}=Tq({walletConnected:r,walletAddress:e,publicClient:i});return{createPlayer:async l=>{try{const u=await n({name:l.pseudo,description:l.userId,image:l.image}),c=u.atomId;await new Promise(h=>setTimeout(h,2e3));try{const h=[{subjectId:c,predicateId:fs.IS_PLAYER_GAMES.predicateId,objectId:fs.IS_PLAYER_GAMES.objectId},{subjectId:c,predicateId:fs.IS_FAIRPLAY.predicateId,objectId:fs.IS_FAIRPLAY.objectId},{subjectId:c,predicateId:fs.IS_STRONG_BOSS.predicateId,objectId:fs.IS_STRONG_BOSS.objectId},{subjectId:c,predicateId:fs.IS_STRONG_FIGHTER.predicateId,objectId:fs.IS_STRONG_FIGHTER.objectId}];l.guildId&&h.push({subjectId:c,predicateId:fs.IS_PLAYER_GUILD.predicateId,objectId:l.guildId});const p=await s(h);return{atomId:c,ipfsHash:u.ipfsHash,tripleCreated:!0,transactionHash:p.hash}}catch(h){return console.error("Erreur lors de la création des triples:",h),{atomId:c,ipfsHash:u.ipfsHash,tripleCreated:!1,transactionHash:void 0}}}catch(u){throw console.error("Erreur lors de la création du joueur:",u),u}}}},L2=({isOpen:r,onClose:e,walletConnected:i,walletAddress:n,wagmiConfig:s,walletHooks:o})=>{const[l,u]=Dt.useState({pseudo:"",userId:"",image:"",guildId:""}),[c,h]=Dt.useState(!1),[p,f]=Dt.useState(!1),[g,m]=Dt.useState(!1),[y,b]=Dt.useState(null),v=s==null?void 0:s.publicClient,[_,C]=Dt.useState(!1),E=Dt.useRef(null),[T,R]=Dt.useState(1),[B,I]=Dt.useState(!1),[D,L]=Dt.useState(!1),[O,F]=Dt.useState(!1),{createPlayer:q}=Mq(i,n||"",v);Dt.useEffect(()=>{(async()=>{if(!(!n||!i))try{const z=await i.readContract({address:Uc,abi:zc,functionName:"balanceOf",args:[n]});h(z>0)}catch(z){console.error("Error checking atom balance:",z)}})()},[n,i]);const H=V=>{const{name:z,value:te}=V.target;u(K=>({...K,[z]:te}))},G=V=>{const{name:z,value:te}=V.target;u(K=>({...K,[z]:te}))},J=async V=>{if(!V.target.files||V.target.files.length===0)return;const z=V.target.files[0];try{C(!0);const te=await PQ(z);u(K=>({...K,image:te})),C(!1)}catch(te){console.error("Error uploading image:",te),alert("Error uploading image. Please try again."),C(!1)}},Q=async()=>{if(!n||!i){alert("Please connect your wallet first");return}if(c){alert("You already have an atom!");return}if(!l.pseudo||!l.userId){alert("Please fill in all fields");return}try{f(!0),I(!0),R(1);const V=await q({pseudo:l.pseudo,userId:l.userId,image:l.image||void 0,guildId:l.guildId?BigInt(l.guildId):void 0});b(V.atomId.toString()),I(!1),R(2),L(!0),await new Promise(z=>setTimeout(z,1500)),L(!1),F(V.tripleCreated),R(3),m(!0),f(!1),setTimeout(()=>{e()},3e3)}catch(V){console.error("Error creating player:",V),alert("Error creating player. Please try again."),f(!1),I(!1),L(!1)}};return r?It.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3},children:It.jsxs("div",{style:{backgroundColor:"#101020",color:"#fff",padding:"30px",borderRadius:"10px",maxWidth:"760px",width:"90%",position:"relative",border:"1px solid #FFD32A"},children:[It.jsx("div",{style:{position:"absolute",top:"40px",right:"10px",fontSize:"10px",color:"#666",textAlign:"left",backgroundColor:"rgba(0,0,0,0.3)",padding:"5px",borderRadius:"3px",maxWidth:"200px",overflow:"hidden"},children:It.jsxs("div",{children:["Wallet:"," ",n?n.slice(0,6)+"..."+n.slice(-4):"Not connected"]})}),It.jsx("button",{onClick:e,style:{position:"absolute",top:"10px",right:"10px",backgroundColor:"transparent",border:"none",fontSize:"20px",color:"#666",cursor:"pointer"},children:"×"}),It.jsx("img",{src:BL,alt:"Intuition Logo",style:{width:"100px",marginBottom:"10px"}}),It.jsx("h2",{style:{fontSize:"1.5em",margin:"0 0 20px 0",textAlign:"center"},children:"Create Your Player"}),It.jsx(GQ,{step:T,isCreatingAtom:B,isCreatingTriples:D,creationSuccess:g,atomId:y,tripleCreated:O,walletAddress:n,hasExistingAtom:c,formData:l,handleInputChange:H,handleSelectChange:G,handleFileUpload:J,handleSubmit:Q,isLoading:p,isUploading:_,fileInputRef:E})]})}):null};var Rq=Object.defineProperty,Iq=(r,e,i)=>e in r?Rq(r,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[e]=i,X0=(r,e,i)=>Iq(r,typeof e!="symbol"?e+"":e,i);function D2(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function O2(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var i=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};i.prototype=e.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var s=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(i,n,s.get?s:{enumerable:!0,get:function(){return r[n]}})}),i}var P2={exports:{}},K0={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kD;function Bq(){if(kD)return K0;kD=1;var r=Dt,e=Symbol.for("react.element"),i=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function l(u,c,h){var p,f={},g=null,m=null;h!==void 0&&(g=""+h),c.key!==void 0&&(g=""+c.key),c.ref!==void 0&&(m=c.ref);for(p in c)n.call(c,p)&&!o.hasOwnProperty(p)&&(f[p]=c[p]);if(u&&u.defaultProps)for(p in c=u.defaultProps,c)f[p]===void 0&&(f[p]=c[p]);return{$$typeof:e,type:u,key:g,ref:m,props:f,_owner:s.current}}return K0.Fragment=i,K0.jsx=l,K0.jsxs=l,K0}var db={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var FD;function Nq(){return FD||(FD=1,process.env.NODE_ENV!=="production"&&function(){var r=Dt,e=Symbol.for("react.element"),i=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),l=Symbol.for("react.provider"),u=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),p=Symbol.for("react.suspense_list"),f=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),m=Symbol.for("react.offscreen"),y=Symbol.iterator,b="@@iterator";function v(pe){if(pe===null||typeof pe!="object")return null;var ct=y&&pe[y]||pe[b];return typeof ct=="function"?ct:null}var _=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function C(pe){{for(var ct=arguments.length,Tt=new Array(ct>1?ct-1:0),Jt=1;Jt<ct;Jt++)Tt[Jt-1]=arguments[Jt];E("error",pe,Tt)}}function E(pe,ct,Tt){{var Jt=_.ReactDebugCurrentFrame,Ni=Jt.getStackAddendum();Ni!==""&&(ct+="%s",Tt=Tt.concat([Ni]));var ar=Tt.map(function(Di){return String(Di)});ar.unshift("Warning: "+ct),Function.prototype.apply.call(console[pe],console,ar)}}var T=!1,R=!1,B=!1,I=!1,D=!1,L;L=Symbol.for("react.module.reference");function O(pe){return!!(typeof pe=="string"||typeof pe=="function"||pe===n||pe===o||D||pe===s||pe===h||pe===p||I||pe===m||T||R||B||typeof pe=="object"&&pe!==null&&(pe.$$typeof===g||pe.$$typeof===f||pe.$$typeof===l||pe.$$typeof===u||pe.$$typeof===c||pe.$$typeof===L||pe.getModuleId!==void 0))}function F(pe,ct,Tt){var Jt=pe.displayName;if(Jt)return Jt;var Ni=ct.displayName||ct.name||"";return Ni!==""?Tt+"("+Ni+")":Tt}function q(pe){return pe.displayName||"Context"}function H(pe){if(pe==null)return null;if(typeof pe.tag=="number"&&C("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof pe=="function")return pe.displayName||pe.name||null;if(typeof pe=="string")return pe;switch(pe){case n:return"Fragment";case i:return"Portal";case o:return"Profiler";case s:return"StrictMode";case h:return"Suspense";case p:return"SuspenseList"}if(typeof pe=="object")switch(pe.$$typeof){case u:var ct=pe;return q(ct)+".Consumer";case l:var Tt=pe;return q(Tt._context)+".Provider";case c:return F(pe,pe.render,"ForwardRef");case f:var Jt=pe.displayName||null;return Jt!==null?Jt:H(pe.type)||"Memo";case g:{var Ni=pe,ar=Ni._payload,Di=Ni._init;try{return H(Di(ar))}catch{return null}}}return null}var G=Object.assign,J=0,Q,V,z,te,K,ae,Ae;function _e(){}_e.__reactDisabledLog=!0;function me(){{if(J===0){Q=console.log,V=console.info,z=console.warn,te=console.error,K=console.group,ae=console.groupCollapsed,Ae=console.groupEnd;var pe={configurable:!0,enumerable:!0,value:_e,writable:!0};Object.defineProperties(console,{info:pe,log:pe,warn:pe,error:pe,group:pe,groupCollapsed:pe,groupEnd:pe})}J++}}function Pe(){{if(J--,J===0){var pe={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:G({},pe,{value:Q}),info:G({},pe,{value:V}),warn:G({},pe,{value:z}),error:G({},pe,{value:te}),group:G({},pe,{value:K}),groupCollapsed:G({},pe,{value:ae}),groupEnd:G({},pe,{value:Ae})})}J<0&&C("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var Xe=_.ReactCurrentDispatcher,Je;function tt(pe,ct,Tt){{if(Je===void 0)try{throw Error()}catch(Ni){var Jt=Ni.stack.trim().match(/\n( *(at )?)/);Je=Jt&&Jt[1]||""}return`
`+Je+pe}}var dt=!1,wt;{var qt=typeof WeakMap=="function"?WeakMap:Map;wt=new qt}function yt(pe,ct){if(!pe||dt)return"";{var Tt=wt.get(pe);if(Tt!==void 0)return Tt}var Jt;dt=!0;var Ni=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var ar;ar=Xe.current,Xe.current=null,me();try{if(ct){var Di=function(){throw Error()};if(Object.defineProperty(Di.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Di,[])}catch(lt){Jt=lt}Reflect.construct(pe,[],Di)}else{try{Di.call()}catch(lt){Jt=lt}pe.call(Di.prototype)}}else{try{throw Error()}catch(lt){Jt=lt}pe()}}catch(lt){if(lt&&Jt&&typeof lt.stack=="string"){for(var ki=lt.stack.split(`
`),Ie=Jt.stack.split(`
`),se=ki.length-1,fe=Ie.length-1;se>=1&&fe>=0&&ki[se]!==Ie[fe];)fe--;for(;se>=1&&fe>=0;se--,fe--)if(ki[se]!==Ie[fe]){if(se!==1||fe!==1)do if(se--,fe--,fe<0||ki[se]!==Ie[fe]){var Be=`
`+ki[se].replace(" at new "," at ");return pe.displayName&&Be.includes("<anonymous>")&&(Be=Be.replace("<anonymous>",pe.displayName)),typeof pe=="function"&&wt.set(pe,Be),Be}while(se>=1&&fe>=0);break}}}finally{dt=!1,Xe.current=ar,Pe(),Error.prepareStackTrace=Ni}var Fe=pe?pe.displayName||pe.name:"",Ye=Fe?tt(Fe):"";return typeof pe=="function"&&wt.set(pe,Ye),Ye}function Ei(pe,ct,Tt){return yt(pe,!1)}function $e(pe){var ct=pe.prototype;return!!(ct&&ct.isReactComponent)}function Ui(pe,ct,Tt){if(pe==null)return"";if(typeof pe=="function")return yt(pe,$e(pe));if(typeof pe=="string")return tt(pe);switch(pe){case h:return tt("Suspense");case p:return tt("SuspenseList")}if(typeof pe=="object")switch(pe.$$typeof){case c:return Ei(pe.render);case f:return Ui(pe.type,ct,Tt);case g:{var Jt=pe,Ni=Jt._payload,ar=Jt._init;try{return Ui(ar(Ni),ct,Tt)}catch{}}}return""}var hi=Object.prototype.hasOwnProperty,Ri={},Si=_.ReactDebugCurrentFrame;function Zi(pe){if(pe){var ct=pe._owner,Tt=Ui(pe.type,pe._source,ct?ct.type:null);Si.setExtraStackFrame(Tt)}else Si.setExtraStackFrame(null)}function Vi(pe,ct,Tt,Jt,Ni){{var ar=Function.call.bind(hi);for(var Di in pe)if(ar(pe,Di)){var ki=void 0;try{if(typeof pe[Di]!="function"){var Ie=Error((Jt||"React class")+": "+Tt+" type `"+Di+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof pe[Di]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw Ie.name="Invariant Violation",Ie}ki=pe[Di](ct,Di,Jt,Tt,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(se){ki=se}ki&&!(ki instanceof Error)&&(Zi(Ni),C("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",Jt||"React class",Tt,Di,typeof ki),Zi(null)),ki instanceof Error&&!(ki.message in Ri)&&(Ri[ki.message]=!0,Zi(Ni),C("Failed %s type: %s",Tt,ki.message),Zi(null))}}}var Ge=Array.isArray;function Ce(pe){return Ge(pe)}function At(pe){{var ct=typeof Symbol=="function"&&Symbol.toStringTag,Tt=ct&&pe[Symbol.toStringTag]||pe.constructor.name||"Object";return Tt}}function Pt(pe){try{return $t(pe),!1}catch{return!0}}function $t(pe){return""+pe}function Mt(pe){if(Pt(pe))return C("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",At(pe)),$t(pe)}var yi=_.ReactCurrentOwner,vt={key:!0,ref:!0,__self:!0,__source:!0},ye,ve;function Ne(pe){if(hi.call(pe,"ref")){var ct=Object.getOwnPropertyDescriptor(pe,"ref").get;if(ct&&ct.isReactWarning)return!1}return pe.ref!==void 0}function Te(pe){if(hi.call(pe,"key")){var ct=Object.getOwnPropertyDescriptor(pe,"key").get;if(ct&&ct.isReactWarning)return!1}return pe.key!==void 0}function ke(pe,ct){typeof pe.ref=="string"&&yi.current}function Oe(pe,ct){{var Tt=function(){ye||(ye=!0,C("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",ct))};Tt.isReactWarning=!0,Object.defineProperty(pe,"key",{get:Tt,configurable:!0})}}function U(pe,ct){{var Tt=function(){ve||(ve=!0,C("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",ct))};Tt.isReactWarning=!0,Object.defineProperty(pe,"ref",{get:Tt,configurable:!0})}}var $=function(pe,ct,Tt,Jt,Ni,ar,Di){var ki={$$typeof:e,type:pe,key:ct,ref:Tt,props:Di,_owner:ar};return ki._store={},Object.defineProperty(ki._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(ki,"_self",{configurable:!1,enumerable:!1,writable:!1,value:Jt}),Object.defineProperty(ki,"_source",{configurable:!1,enumerable:!1,writable:!1,value:Ni}),Object.freeze&&(Object.freeze(ki.props),Object.freeze(ki)),ki};function re(pe,ct,Tt,Jt,Ni){{var ar,Di={},ki=null,Ie=null;Tt!==void 0&&(Mt(Tt),ki=""+Tt),Te(ct)&&(Mt(ct.key),ki=""+ct.key),Ne(ct)&&(Ie=ct.ref,ke(ct));for(ar in ct)hi.call(ct,ar)&&!vt.hasOwnProperty(ar)&&(Di[ar]=ct[ar]);if(pe&&pe.defaultProps){var se=pe.defaultProps;for(ar in se)Di[ar]===void 0&&(Di[ar]=se[ar])}if(ki||Ie){var fe=typeof pe=="function"?pe.displayName||pe.name||"Unknown":pe;ki&&Oe(Di,fe),Ie&&U(Di,fe)}return $(pe,ki,Ie,Ni,Jt,yi.current,Di)}}var Re=_.ReactCurrentOwner,ce=_.ReactDebugCurrentFrame;function Ue(pe){if(pe){var ct=pe._owner,Tt=Ui(pe.type,pe._source,ct?ct.type:null);ce.setExtraStackFrame(Tt)}else ce.setExtraStackFrame(null)}var je;je=!1;function pt(pe){return typeof pe=="object"&&pe!==null&&pe.$$typeof===e}function Lt(){{if(Re.current){var pe=H(Re.current.type);if(pe)return`

Check the render method of \``+pe+"`."}return""}}function xt(pe){return""}var Gt={};function mi(pe){{var ct=Lt();if(!ct){var Tt=typeof pe=="string"?pe:pe.displayName||pe.name;Tt&&(ct=`

Check the top-level render call using <`+Tt+">.")}return ct}}function _r(pe,ct){{if(!pe._store||pe._store.validated||pe.key!=null)return;pe._store.validated=!0;var Tt=mi(ct);if(Gt[Tt])return;Gt[Tt]=!0;var Jt="";pe&&pe._owner&&pe._owner!==Re.current&&(Jt=" It was passed a child from "+H(pe._owner.type)+"."),Ue(pe),C('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',Tt,Jt),Ue(null)}}function Fi(pe,ct){{if(typeof pe!="object")return;if(Ce(pe))for(var Tt=0;Tt<pe.length;Tt++){var Jt=pe[Tt];pt(Jt)&&_r(Jt,ct)}else if(pt(pe))pe._store&&(pe._store.validated=!0);else if(pe){var Ni=v(pe);if(typeof Ni=="function"&&Ni!==pe.entries)for(var ar=Ni.call(pe),Di;!(Di=ar.next()).done;)pt(Di.value)&&_r(Di.value,ct)}}}function gn(pe){{var ct=pe.type;if(ct==null||typeof ct=="string")return;var Tt;if(typeof ct=="function")Tt=ct.propTypes;else if(typeof ct=="object"&&(ct.$$typeof===c||ct.$$typeof===f))Tt=ct.propTypes;else return;if(Tt){var Jt=H(ct);Vi(Tt,pe.props,"prop",Jt,pe)}else if(ct.PropTypes!==void 0&&!je){je=!0;var Ni=H(ct);C("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",Ni||"Unknown")}typeof ct.getDefaultProps=="function"&&!ct.getDefaultProps.isReactClassApproved&&C("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function kr(pe){{for(var ct=Object.keys(pe.props),Tt=0;Tt<ct.length;Tt++){var Jt=ct[Tt];if(Jt!=="children"&&Jt!=="key"){Ue(pe),C("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",Jt),Ue(null);break}}pe.ref!==null&&(Ue(pe),C("Invalid attribute `ref` supplied to `React.Fragment`."),Ue(null))}}var nn={};function vs(pe,ct,Tt,Jt,Ni,ar){{var Di=O(pe);if(!Di){var ki="";(pe===void 0||typeof pe=="object"&&pe!==null&&Object.keys(pe).length===0)&&(ki+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var Ie=xt();Ie?ki+=Ie:ki+=Lt();var se;pe===null?se="null":Ce(pe)?se="array":pe!==void 0&&pe.$$typeof===e?(se="<"+(H(pe.type)||"Unknown")+" />",ki=" Did you accidentally export a JSX literal instead of a component?"):se=typeof pe,C("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",se,ki)}var fe=re(pe,ct,Tt,Ni,ar);if(fe==null)return fe;if(Di){var Be=ct.children;if(Be!==void 0)if(Jt)if(Ce(Be)){for(var Fe=0;Fe<Be.length;Fe++)Fi(Be[Fe],pe);Object.freeze&&Object.freeze(Be)}else C("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else Fi(Be,pe)}if(hi.call(ct,"key")){var Ye=H(pe),lt=Object.keys(ct).filter(function(ei){return ei!=="key"}),Ct=lt.length>0?"{key: someKey, "+lt.join(": ..., ")+": ...}":"{key: someKey}";if(!nn[Ye+Ct]){var Yt=lt.length>0?"{"+lt.join(": ..., ")+": ...}":"{}";C(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,Ct,Ye,Yt,Ye),nn[Ye+Ct]=!0}}return pe===n?kr(fe):gn(fe),fe}}function An(pe,ct,Tt){return vs(pe,ct,Tt,!0)}function Ns(pe,ct,Tt){return vs(pe,ct,Tt,!1)}var ts=Ns,bs=An;db.Fragment=n,db.jsx=ts,db.jsxs=bs}()),db}process.env.NODE_ENV==="production"?P2.exports=Bq():P2.exports=Nq();var qe=P2.exports;const Ks={SUBJECT:"#FFB300",PREDICATE:"#1976D2",OBJECT:"#43A047"},k2=r=>{switch(r){case"subject":return Ks.SUBJECT;case"predicate":return Ks.PREDICATE;case"object":return Ks.OBJECT;default:return"#444"}},UD=()=>qe.jsxs("div",{className:"agent-legend",style:{position:"absolute",bottom:"20px",right:"10px",zIndex:10},children:[qe.jsx("h4",{style:{margin:"0 0 10px 0",fontSize:"16px"},children:"Graph Legend"}),qe.jsxs("ul",{style:{listStyle:"none",padding:0,margin:0},children:[qe.jsxs("li",{style:{display:"flex",alignItems:"center",marginBottom:"5px"},children:[qe.jsx("span",{style:{width:"15px",height:"15px",backgroundColor:Ks.SUBJECT,borderRadius:"50%",display:"inline-block",marginRight:"10px"}}),"Subject"]}),qe.jsxs("li",{style:{display:"flex",alignItems:"center",marginBottom:"5px"},children:[qe.jsx("span",{style:{width:"15px",height:"15px",backgroundColor:Ks.PREDICATE,borderRadius:"50%",display:"inline-block",marginRight:"10px"}}),"Predicate"]}),qe.jsxs("li",{style:{display:"flex",alignItems:"center",marginBottom:"5px"},children:[qe.jsx("span",{style:{width:"15px",height:"15px",backgroundColor:Ks.OBJECT,borderRadius:"50%",display:"inline-block",marginRight:"10px"}}),"Object"]})]})]});var Lq={exports:{}};(function(r,e){(function(i,n){r.exports=n()})(self,()=>(()=>{var i={"./node_modules/an-array/index.js":l=>{var u=Object.prototype.toString;l.exports=c;function c(h){return h.BYTES_PER_ELEMENT&&u.call(h.buffer)==="[object ArrayBuffer]"||Array.isArray(h)}},"./node_modules/as-number/index.js":l=>{l.exports=function(u,c){return typeof u=="number"?u:typeof c=="number"?c:0}},"./node_modules/base64-js/index.js":(l,u)=>{u.byteLength=b,u.toByteArray=_,u.fromByteArray=T;for(var c=[],h=[],p=typeof Uint8Array<"u"?Uint8Array:Array,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",g=0,m=f.length;g<m;++g)c[g]=f[g],h[f.charCodeAt(g)]=g;h[45]=62,h[95]=63;function y(R){var B=R.length;if(B%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var I=R.indexOf("=");I===-1&&(I=B);var D=I===B?0:4-I%4;return[I,D]}function b(R){var B=y(R),I=B[0],D=B[1];return(I+D)*3/4-D}function v(R,B,I){return(B+I)*3/4-I}function _(R){var B,I=y(R),D=I[0],L=I[1],O=new p(v(R,D,L)),F=0,q=L>0?D-4:D,H;for(H=0;H<q;H+=4)B=h[R.charCodeAt(H)]<<18|h[R.charCodeAt(H+1)]<<12|h[R.charCodeAt(H+2)]<<6|h[R.charCodeAt(H+3)],O[F++]=B>>16&255,O[F++]=B>>8&255,O[F++]=B&255;return L===2&&(B=h[R.charCodeAt(H)]<<2|h[R.charCodeAt(H+1)]>>4,O[F++]=B&255),L===1&&(B=h[R.charCodeAt(H)]<<10|h[R.charCodeAt(H+1)]<<4|h[R.charCodeAt(H+2)]>>2,O[F++]=B>>8&255,O[F++]=B&255),O}function C(R){return c[R>>18&63]+c[R>>12&63]+c[R>>6&63]+c[R&63]}function E(R,B,I){for(var D,L=[],O=B;O<I;O+=3)D=(R[O]<<16&16711680)+(R[O+1]<<8&65280)+(R[O+2]&255),L.push(C(D));return L.join("")}function T(R){for(var B,I=R.length,D=I%3,L=[],O=16383,F=0,q=I-D;F<q;F+=O)L.push(E(R,F,F+O>q?q:F+O));return D===1?(B=R[I-1],L.push(c[B>>2]+c[B<<4&63]+"==")):D===2&&(B=(R[I-2]<<8)+R[I-1],L.push(c[B>>10]+c[B>>4&63]+c[B<<2&63]+"=")),L.join("")}},"./node_modules/buffer-equal/index.js":(l,u,c)=>{var h=c("./node_modules/buffer/index.js").Buffer;l.exports=function(p,f){if(h.isBuffer(p)&&h.isBuffer(f)){if(typeof p.equals=="function")return p.equals(f);if(p.length!==f.length)return!1;for(var g=0;g<p.length;g++)if(p[g]!==f[g])return!1;return!0}}},"./node_modules/buffer/index.js":(l,u,c)=>{/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */const h=c("./node_modules/base64-js/index.js"),p=c("./node_modules/ieee754/index.js"),f=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;u.Buffer=b,u.SlowBuffer=O,u.INSPECT_MAX_BYTES=50;const g=2147483647;u.kMaxLength=g,b.TYPED_ARRAY_SUPPORT=m(),!b.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function m(){try{const U=new Uint8Array(1),$={foo:function(){return 42}};return Object.setPrototypeOf($,Uint8Array.prototype),Object.setPrototypeOf(U,$),U.foo()===42}catch{return!1}}Object.defineProperty(b.prototype,"parent",{enumerable:!0,get:function(){if(b.isBuffer(this))return this.buffer}}),Object.defineProperty(b.prototype,"offset",{enumerable:!0,get:function(){if(b.isBuffer(this))return this.byteOffset}});function y(U){if(U>g)throw new RangeError('The value "'+U+'" is invalid for option "size"');const $=new Uint8Array(U);return Object.setPrototypeOf($,b.prototype),$}function b(U,$,re){if(typeof U=="number"){if(typeof $=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return E(U)}return v(U,$,re)}b.poolSize=8192;function v(U,$,re){if(typeof U=="string")return T(U,$);if(ArrayBuffer.isView(U))return B(U);if(U==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof U);if(ve(U,ArrayBuffer)||U&&ve(U.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(ve(U,SharedArrayBuffer)||U&&ve(U.buffer,SharedArrayBuffer)))return I(U,$,re);if(typeof U=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const Re=U.valueOf&&U.valueOf();if(Re!=null&&Re!==U)return b.from(Re,$,re);const ce=D(U);if(ce)return ce;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof U[Symbol.toPrimitive]=="function")return b.from(U[Symbol.toPrimitive]("string"),$,re);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof U)}b.from=function(U,$,re){return v(U,$,re)},Object.setPrototypeOf(b.prototype,Uint8Array.prototype),Object.setPrototypeOf(b,Uint8Array);function _(U){if(typeof U!="number")throw new TypeError('"size" argument must be of type number');if(U<0)throw new RangeError('The value "'+U+'" is invalid for option "size"')}function C(U,$,re){return _(U),U<=0?y(U):$!==void 0?typeof re=="string"?y(U).fill($,re):y(U).fill($):y(U)}b.alloc=function(U,$,re){return C(U,$,re)};function E(U){return _(U),y(U<0?0:L(U)|0)}b.allocUnsafe=function(U){return E(U)},b.allocUnsafeSlow=function(U){return E(U)};function T(U,$){if((typeof $!="string"||$==="")&&($="utf8"),!b.isEncoding($))throw new TypeError("Unknown encoding: "+$);const re=F(U,$)|0;let Re=y(re);const ce=Re.write(U,$);return ce!==re&&(Re=Re.slice(0,ce)),Re}function R(U){const $=U.length<0?0:L(U.length)|0,re=y($);for(let Re=0;Re<$;Re+=1)re[Re]=U[Re]&255;return re}function B(U){if(ve(U,Uint8Array)){const $=new Uint8Array(U);return I($.buffer,$.byteOffset,$.byteLength)}return R(U)}function I(U,$,re){if($<0||U.byteLength<$)throw new RangeError('"offset" is outside of buffer bounds');if(U.byteLength<$+(re||0))throw new RangeError('"length" is outside of buffer bounds');let Re;return $===void 0&&re===void 0?Re=new Uint8Array(U):re===void 0?Re=new Uint8Array(U,$):Re=new Uint8Array(U,$,re),Object.setPrototypeOf(Re,b.prototype),Re}function D(U){if(b.isBuffer(U)){const $=L(U.length)|0,re=y($);return re.length===0||U.copy(re,0,0,$),re}if(U.length!==void 0)return typeof U.length!="number"||Ne(U.length)?y(0):R(U);if(U.type==="Buffer"&&Array.isArray(U.data))return R(U.data)}function L(U){if(U>=g)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+g.toString(16)+" bytes");return U|0}function O(U){return+U!=U&&(U=0),b.alloc(+U)}b.isBuffer=function(U){return U!=null&&U._isBuffer===!0&&U!==b.prototype},b.compare=function(U,$){if(ve(U,Uint8Array)&&(U=b.from(U,U.offset,U.byteLength)),ve($,Uint8Array)&&($=b.from($,$.offset,$.byteLength)),!b.isBuffer(U)||!b.isBuffer($))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(U===$)return 0;let re=U.length,Re=$.length;for(let ce=0,Ue=Math.min(re,Re);ce<Ue;++ce)if(U[ce]!==$[ce]){re=U[ce],Re=$[ce];break}return re<Re?-1:Re<re?1:0},b.isEncoding=function(U){switch(String(U).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},b.concat=function(U,$){if(!Array.isArray(U))throw new TypeError('"list" argument must be an Array of Buffers');if(U.length===0)return b.alloc(0);let re;if($===void 0)for($=0,re=0;re<U.length;++re)$+=U[re].length;const Re=b.allocUnsafe($);let ce=0;for(re=0;re<U.length;++re){let Ue=U[re];if(ve(Ue,Uint8Array))ce+Ue.length>Re.length?(b.isBuffer(Ue)||(Ue=b.from(Ue)),Ue.copy(Re,ce)):Uint8Array.prototype.set.call(Re,Ue,ce);else if(b.isBuffer(Ue))Ue.copy(Re,ce);else throw new TypeError('"list" argument must be an Array of Buffers');ce+=Ue.length}return Re};function F(U,$){if(b.isBuffer(U))return U.length;if(ArrayBuffer.isView(U)||ve(U,ArrayBuffer))return U.byteLength;if(typeof U!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof U);const re=U.length,Re=arguments.length>2&&arguments[2]===!0;if(!Re&&re===0)return 0;let ce=!1;for(;;)switch($){case"ascii":case"latin1":case"binary":return re;case"utf8":case"utf-8":return $t(U).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return re*2;case"hex":return re>>>1;case"base64":return vt(U).length;default:if(ce)return Re?-1:$t(U).length;$=(""+$).toLowerCase(),ce=!0}}b.byteLength=F;function q(U,$,re){let Re=!1;if(($===void 0||$<0)&&($=0),$>this.length||((re===void 0||re>this.length)&&(re=this.length),re<=0)||(re>>>=0,$>>>=0,re<=$))return"";for(U||(U="utf8");;)switch(U){case"hex":return Je(this,$,re);case"utf8":case"utf-8":return Ae(this,$,re);case"ascii":return Pe(this,$,re);case"latin1":case"binary":return Xe(this,$,re);case"base64":return ae(this,$,re);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return tt(this,$,re);default:if(Re)throw new TypeError("Unknown encoding: "+U);U=(U+"").toLowerCase(),Re=!0}}b.prototype._isBuffer=!0;function H(U,$,re){const Re=U[$];U[$]=U[re],U[re]=Re}b.prototype.swap16=function(){const U=this.length;if(U%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let $=0;$<U;$+=2)H(this,$,$+1);return this},b.prototype.swap32=function(){const U=this.length;if(U%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let $=0;$<U;$+=4)H(this,$,$+3),H(this,$+1,$+2);return this},b.prototype.swap64=function(){const U=this.length;if(U%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let $=0;$<U;$+=8)H(this,$,$+7),H(this,$+1,$+6),H(this,$+2,$+5),H(this,$+3,$+4);return this},b.prototype.toString=function(){const U=this.length;return U===0?"":arguments.length===0?Ae(this,0,U):q.apply(this,arguments)},b.prototype.toLocaleString=b.prototype.toString,b.prototype.equals=function(U){if(!b.isBuffer(U))throw new TypeError("Argument must be a Buffer");return this===U?!0:b.compare(this,U)===0},b.prototype.inspect=function(){let U="";const $=u.INSPECT_MAX_BYTES;return U=this.toString("hex",0,$).replace(/(.{2})/g,"$1 ").trim(),this.length>$&&(U+=" ... "),"<Buffer "+U+">"},f&&(b.prototype[f]=b.prototype.inspect),b.prototype.compare=function(U,$,re,Re,ce){if(ve(U,Uint8Array)&&(U=b.from(U,U.offset,U.byteLength)),!b.isBuffer(U))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof U);if($===void 0&&($=0),re===void 0&&(re=U?U.length:0),Re===void 0&&(Re=0),ce===void 0&&(ce=this.length),$<0||re>U.length||Re<0||ce>this.length)throw new RangeError("out of range index");if(Re>=ce&&$>=re)return 0;if(Re>=ce)return-1;if($>=re)return 1;if($>>>=0,re>>>=0,Re>>>=0,ce>>>=0,this===U)return 0;let Ue=ce-Re,je=re-$;const pt=Math.min(Ue,je),Lt=this.slice(Re,ce),xt=U.slice($,re);for(let Gt=0;Gt<pt;++Gt)if(Lt[Gt]!==xt[Gt]){Ue=Lt[Gt],je=xt[Gt];break}return Ue<je?-1:je<Ue?1:0};function G(U,$,re,Re,ce){if(U.length===0)return-1;if(typeof re=="string"?(Re=re,re=0):re>2147483647?re=2147483647:re<-2147483648&&(re=-2147483648),re=+re,Ne(re)&&(re=ce?0:U.length-1),re<0&&(re=U.length+re),re>=U.length){if(ce)return-1;re=U.length-1}else if(re<0)if(ce)re=0;else return-1;if(typeof $=="string"&&($=b.from($,Re)),b.isBuffer($))return $.length===0?-1:J(U,$,re,Re,ce);if(typeof $=="number")return $=$&255,typeof Uint8Array.prototype.indexOf=="function"?ce?Uint8Array.prototype.indexOf.call(U,$,re):Uint8Array.prototype.lastIndexOf.call(U,$,re):J(U,[$],re,Re,ce);throw new TypeError("val must be string, number or Buffer")}function J(U,$,re,Re,ce){let Ue=1,je=U.length,pt=$.length;if(Re!==void 0&&(Re=String(Re).toLowerCase(),Re==="ucs2"||Re==="ucs-2"||Re==="utf16le"||Re==="utf-16le")){if(U.length<2||$.length<2)return-1;Ue=2,je/=2,pt/=2,re/=2}function Lt(Gt,mi){return Ue===1?Gt[mi]:Gt.readUInt16BE(mi*Ue)}let xt;if(ce){let Gt=-1;for(xt=re;xt<je;xt++)if(Lt(U,xt)===Lt($,Gt===-1?0:xt-Gt)){if(Gt===-1&&(Gt=xt),xt-Gt+1===pt)return Gt*Ue}else Gt!==-1&&(xt-=xt-Gt),Gt=-1}else for(re+pt>je&&(re=je-pt),xt=re;xt>=0;xt--){let Gt=!0;for(let mi=0;mi<pt;mi++)if(Lt(U,xt+mi)!==Lt($,mi)){Gt=!1;break}if(Gt)return xt}return-1}b.prototype.includes=function(U,$,re){return this.indexOf(U,$,re)!==-1},b.prototype.indexOf=function(U,$,re){return G(this,U,$,re,!0)},b.prototype.lastIndexOf=function(U,$,re){return G(this,U,$,re,!1)};function Q(U,$,re,Re){re=Number(re)||0;const ce=U.length-re;Re?(Re=Number(Re),Re>ce&&(Re=ce)):Re=ce;const Ue=$.length;Re>Ue/2&&(Re=Ue/2);let je;for(je=0;je<Re;++je){const pt=parseInt($.substr(je*2,2),16);if(Ne(pt))return je;U[re+je]=pt}return je}function V(U,$,re,Re){return ye($t($,U.length-re),U,re,Re)}function z(U,$,re,Re){return ye(Mt($),U,re,Re)}function te(U,$,re,Re){return ye(vt($),U,re,Re)}function K(U,$,re,Re){return ye(yi($,U.length-re),U,re,Re)}b.prototype.write=function(U,$,re,Re){if($===void 0)Re="utf8",re=this.length,$=0;else if(re===void 0&&typeof $=="string")Re=$,re=this.length,$=0;else if(isFinite($))$=$>>>0,isFinite(re)?(re=re>>>0,Re===void 0&&(Re="utf8")):(Re=re,re=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const ce=this.length-$;if((re===void 0||re>ce)&&(re=ce),U.length>0&&(re<0||$<0)||$>this.length)throw new RangeError("Attempt to write outside buffer bounds");Re||(Re="utf8");let Ue=!1;for(;;)switch(Re){case"hex":return Q(this,U,$,re);case"utf8":case"utf-8":return V(this,U,$,re);case"ascii":case"latin1":case"binary":return z(this,U,$,re);case"base64":return te(this,U,$,re);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return K(this,U,$,re);default:if(Ue)throw new TypeError("Unknown encoding: "+Re);Re=(""+Re).toLowerCase(),Ue=!0}},b.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function ae(U,$,re){return $===0&&re===U.length?h.fromByteArray(U):h.fromByteArray(U.slice($,re))}function Ae(U,$,re){re=Math.min(U.length,re);const Re=[];let ce=$;for(;ce<re;){const Ue=U[ce];let je=null,pt=Ue>239?4:Ue>223?3:Ue>191?2:1;if(ce+pt<=re){let Lt,xt,Gt,mi;switch(pt){case 1:Ue<128&&(je=Ue);break;case 2:Lt=U[ce+1],(Lt&192)===128&&(mi=(Ue&31)<<6|Lt&63,mi>127&&(je=mi));break;case 3:Lt=U[ce+1],xt=U[ce+2],(Lt&192)===128&&(xt&192)===128&&(mi=(Ue&15)<<12|(Lt&63)<<6|xt&63,mi>2047&&(mi<55296||mi>57343)&&(je=mi));break;case 4:Lt=U[ce+1],xt=U[ce+2],Gt=U[ce+3],(Lt&192)===128&&(xt&192)===128&&(Gt&192)===128&&(mi=(Ue&15)<<18|(Lt&63)<<12|(xt&63)<<6|Gt&63,mi>65535&&mi<1114112&&(je=mi))}}je===null?(je=65533,pt=1):je>65535&&(je-=65536,Re.push(je>>>10&1023|55296),je=56320|je&1023),Re.push(je),ce+=pt}return me(Re)}const _e=4096;function me(U){const $=U.length;if($<=_e)return String.fromCharCode.apply(String,U);let re="",Re=0;for(;Re<$;)re+=String.fromCharCode.apply(String,U.slice(Re,Re+=_e));return re}function Pe(U,$,re){let Re="";re=Math.min(U.length,re);for(let ce=$;ce<re;++ce)Re+=String.fromCharCode(U[ce]&127);return Re}function Xe(U,$,re){let Re="";re=Math.min(U.length,re);for(let ce=$;ce<re;++ce)Re+=String.fromCharCode(U[ce]);return Re}function Je(U,$,re){const Re=U.length;(!$||$<0)&&($=0),(!re||re<0||re>Re)&&(re=Re);let ce="";for(let Ue=$;Ue<re;++Ue)ce+=Te[U[Ue]];return ce}function tt(U,$,re){const Re=U.slice($,re);let ce="";for(let Ue=0;Ue<Re.length-1;Ue+=2)ce+=String.fromCharCode(Re[Ue]+Re[Ue+1]*256);return ce}b.prototype.slice=function(U,$){const re=this.length;U=~~U,$=$===void 0?re:~~$,U<0?(U+=re,U<0&&(U=0)):U>re&&(U=re),$<0?($+=re,$<0&&($=0)):$>re&&($=re),$<U&&($=U);const Re=this.subarray(U,$);return Object.setPrototypeOf(Re,b.prototype),Re};function dt(U,$,re){if(U%1!==0||U<0)throw new RangeError("offset is not uint");if(U+$>re)throw new RangeError("Trying to access beyond buffer length")}b.prototype.readUintLE=b.prototype.readUIntLE=function(U,$,re){U=U>>>0,$=$>>>0,re||dt(U,$,this.length);let Re=this[U],ce=1,Ue=0;for(;++Ue<$&&(ce*=256);)Re+=this[U+Ue]*ce;return Re},b.prototype.readUintBE=b.prototype.readUIntBE=function(U,$,re){U=U>>>0,$=$>>>0,re||dt(U,$,this.length);let Re=this[U+--$],ce=1;for(;$>0&&(ce*=256);)Re+=this[U+--$]*ce;return Re},b.prototype.readUint8=b.prototype.readUInt8=function(U,$){return U=U>>>0,$||dt(U,1,this.length),this[U]},b.prototype.readUint16LE=b.prototype.readUInt16LE=function(U,$){return U=U>>>0,$||dt(U,2,this.length),this[U]|this[U+1]<<8},b.prototype.readUint16BE=b.prototype.readUInt16BE=function(U,$){return U=U>>>0,$||dt(U,2,this.length),this[U]<<8|this[U+1]},b.prototype.readUint32LE=b.prototype.readUInt32LE=function(U,$){return U=U>>>0,$||dt(U,4,this.length),(this[U]|this[U+1]<<8|this[U+2]<<16)+this[U+3]*16777216},b.prototype.readUint32BE=b.prototype.readUInt32BE=function(U,$){return U=U>>>0,$||dt(U,4,this.length),this[U]*16777216+(this[U+1]<<16|this[U+2]<<8|this[U+3])},b.prototype.readBigUInt64LE=ke(function(U){U=U>>>0,Ge(U,"offset");const $=this[U],re=this[U+7];($===void 0||re===void 0)&&Ce(U,this.length-8);const Re=$+this[++U]*2**8+this[++U]*2**16+this[++U]*2**24,ce=this[++U]+this[++U]*2**8+this[++U]*2**16+re*2**24;return BigInt(Re)+(BigInt(ce)<<BigInt(32))}),b.prototype.readBigUInt64BE=ke(function(U){U=U>>>0,Ge(U,"offset");const $=this[U],re=this[U+7];($===void 0||re===void 0)&&Ce(U,this.length-8);const Re=$*2**24+this[++U]*2**16+this[++U]*2**8+this[++U],ce=this[++U]*2**24+this[++U]*2**16+this[++U]*2**8+re;return(BigInt(Re)<<BigInt(32))+BigInt(ce)}),b.prototype.readIntLE=function(U,$,re){U=U>>>0,$=$>>>0,re||dt(U,$,this.length);let Re=this[U],ce=1,Ue=0;for(;++Ue<$&&(ce*=256);)Re+=this[U+Ue]*ce;return ce*=128,Re>=ce&&(Re-=Math.pow(2,8*$)),Re},b.prototype.readIntBE=function(U,$,re){U=U>>>0,$=$>>>0,re||dt(U,$,this.length);let Re=$,ce=1,Ue=this[U+--Re];for(;Re>0&&(ce*=256);)Ue+=this[U+--Re]*ce;return ce*=128,Ue>=ce&&(Ue-=Math.pow(2,8*$)),Ue},b.prototype.readInt8=function(U,$){return U=U>>>0,$||dt(U,1,this.length),this[U]&128?(255-this[U]+1)*-1:this[U]},b.prototype.readInt16LE=function(U,$){U=U>>>0,$||dt(U,2,this.length);const re=this[U]|this[U+1]<<8;return re&32768?re|4294901760:re},b.prototype.readInt16BE=function(U,$){U=U>>>0,$||dt(U,2,this.length);const re=this[U+1]|this[U]<<8;return re&32768?re|4294901760:re},b.prototype.readInt32LE=function(U,$){return U=U>>>0,$||dt(U,4,this.length),this[U]|this[U+1]<<8|this[U+2]<<16|this[U+3]<<24},b.prototype.readInt32BE=function(U,$){return U=U>>>0,$||dt(U,4,this.length),this[U]<<24|this[U+1]<<16|this[U+2]<<8|this[U+3]},b.prototype.readBigInt64LE=ke(function(U){U=U>>>0,Ge(U,"offset");const $=this[U],re=this[U+7];($===void 0||re===void 0)&&Ce(U,this.length-8);const Re=this[U+4]+this[U+5]*2**8+this[U+6]*2**16+(re<<24);return(BigInt(Re)<<BigInt(32))+BigInt($+this[++U]*256+this[++U]*65536+this[++U]*16777216)}),b.prototype.readBigInt64BE=ke(function(U){U=U>>>0,Ge(U,"offset");const $=this[U],re=this[U+7];($===void 0||re===void 0)&&Ce(U,this.length-8);const Re=($<<24)+this[++U]*2**16+this[++U]*2**8+this[++U];return(BigInt(Re)<<BigInt(32))+BigInt(this[++U]*16777216+this[++U]*65536+this[++U]*256+re)}),b.prototype.readFloatLE=function(U,$){return U=U>>>0,$||dt(U,4,this.length),p.read(this,U,!0,23,4)},b.prototype.readFloatBE=function(U,$){return U=U>>>0,$||dt(U,4,this.length),p.read(this,U,!1,23,4)},b.prototype.readDoubleLE=function(U,$){return U=U>>>0,$||dt(U,8,this.length),p.read(this,U,!0,52,8)},b.prototype.readDoubleBE=function(U,$){return U=U>>>0,$||dt(U,8,this.length),p.read(this,U,!1,52,8)};function wt(U,$,re,Re,ce,Ue){if(!b.isBuffer(U))throw new TypeError('"buffer" argument must be a Buffer instance');if($>ce||$<Ue)throw new RangeError('"value" argument is out of bounds');if(re+Re>U.length)throw new RangeError("Index out of range")}b.prototype.writeUintLE=b.prototype.writeUIntLE=function(U,$,re,Re){if(U=+U,$=$>>>0,re=re>>>0,!Re){const je=Math.pow(2,8*re)-1;wt(this,U,$,re,je,0)}let ce=1,Ue=0;for(this[$]=U&255;++Ue<re&&(ce*=256);)this[$+Ue]=U/ce&255;return $+re},b.prototype.writeUintBE=b.prototype.writeUIntBE=function(U,$,re,Re){if(U=+U,$=$>>>0,re=re>>>0,!Re){const je=Math.pow(2,8*re)-1;wt(this,U,$,re,je,0)}let ce=re-1,Ue=1;for(this[$+ce]=U&255;--ce>=0&&(Ue*=256);)this[$+ce]=U/Ue&255;return $+re},b.prototype.writeUint8=b.prototype.writeUInt8=function(U,$,re){return U=+U,$=$>>>0,re||wt(this,U,$,1,255,0),this[$]=U&255,$+1},b.prototype.writeUint16LE=b.prototype.writeUInt16LE=function(U,$,re){return U=+U,$=$>>>0,re||wt(this,U,$,2,65535,0),this[$]=U&255,this[$+1]=U>>>8,$+2},b.prototype.writeUint16BE=b.prototype.writeUInt16BE=function(U,$,re){return U=+U,$=$>>>0,re||wt(this,U,$,2,65535,0),this[$]=U>>>8,this[$+1]=U&255,$+2},b.prototype.writeUint32LE=b.prototype.writeUInt32LE=function(U,$,re){return U=+U,$=$>>>0,re||wt(this,U,$,4,4294967295,0),this[$+3]=U>>>24,this[$+2]=U>>>16,this[$+1]=U>>>8,this[$]=U&255,$+4},b.prototype.writeUint32BE=b.prototype.writeUInt32BE=function(U,$,re){return U=+U,$=$>>>0,re||wt(this,U,$,4,4294967295,0),this[$]=U>>>24,this[$+1]=U>>>16,this[$+2]=U>>>8,this[$+3]=U&255,$+4};function qt(U,$,re,Re,ce){Vi($,Re,ce,U,re,7);let Ue=Number($&BigInt(4294967295));U[re++]=Ue,Ue=Ue>>8,U[re++]=Ue,Ue=Ue>>8,U[re++]=Ue,Ue=Ue>>8,U[re++]=Ue;let je=Number($>>BigInt(32)&BigInt(4294967295));return U[re++]=je,je=je>>8,U[re++]=je,je=je>>8,U[re++]=je,je=je>>8,U[re++]=je,re}function yt(U,$,re,Re,ce){Vi($,Re,ce,U,re,7);let Ue=Number($&BigInt(4294967295));U[re+7]=Ue,Ue=Ue>>8,U[re+6]=Ue,Ue=Ue>>8,U[re+5]=Ue,Ue=Ue>>8,U[re+4]=Ue;let je=Number($>>BigInt(32)&BigInt(4294967295));return U[re+3]=je,je=je>>8,U[re+2]=je,je=je>>8,U[re+1]=je,je=je>>8,U[re]=je,re+8}b.prototype.writeBigUInt64LE=ke(function(U,$=0){return qt(this,U,$,BigInt(0),BigInt("0xffffffffffffffff"))}),b.prototype.writeBigUInt64BE=ke(function(U,$=0){return yt(this,U,$,BigInt(0),BigInt("0xffffffffffffffff"))}),b.prototype.writeIntLE=function(U,$,re,Re){if(U=+U,$=$>>>0,!Re){const pt=Math.pow(2,8*re-1);wt(this,U,$,re,pt-1,-pt)}let ce=0,Ue=1,je=0;for(this[$]=U&255;++ce<re&&(Ue*=256);)U<0&&je===0&&this[$+ce-1]!==0&&(je=1),this[$+ce]=(U/Ue>>0)-je&255;return $+re},b.prototype.writeIntBE=function(U,$,re,Re){if(U=+U,$=$>>>0,!Re){const pt=Math.pow(2,8*re-1);wt(this,U,$,re,pt-1,-pt)}let ce=re-1,Ue=1,je=0;for(this[$+ce]=U&255;--ce>=0&&(Ue*=256);)U<0&&je===0&&this[$+ce+1]!==0&&(je=1),this[$+ce]=(U/Ue>>0)-je&255;return $+re},b.prototype.writeInt8=function(U,$,re){return U=+U,$=$>>>0,re||wt(this,U,$,1,127,-128),U<0&&(U=255+U+1),this[$]=U&255,$+1},b.prototype.writeInt16LE=function(U,$,re){return U=+U,$=$>>>0,re||wt(this,U,$,2,32767,-32768),this[$]=U&255,this[$+1]=U>>>8,$+2},b.prototype.writeInt16BE=function(U,$,re){return U=+U,$=$>>>0,re||wt(this,U,$,2,32767,-32768),this[$]=U>>>8,this[$+1]=U&255,$+2},b.prototype.writeInt32LE=function(U,$,re){return U=+U,$=$>>>0,re||wt(this,U,$,4,2147483647,-2147483648),this[$]=U&255,this[$+1]=U>>>8,this[$+2]=U>>>16,this[$+3]=U>>>24,$+4},b.prototype.writeInt32BE=function(U,$,re){return U=+U,$=$>>>0,re||wt(this,U,$,4,2147483647,-2147483648),U<0&&(U=4294967295+U+1),this[$]=U>>>24,this[$+1]=U>>>16,this[$+2]=U>>>8,this[$+3]=U&255,$+4},b.prototype.writeBigInt64LE=ke(function(U,$=0){return qt(this,U,$,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),b.prototype.writeBigInt64BE=ke(function(U,$=0){return yt(this,U,$,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Ei(U,$,re,Re,ce,Ue){if(re+Re>U.length)throw new RangeError("Index out of range");if(re<0)throw new RangeError("Index out of range")}function $e(U,$,re,Re,ce){return $=+$,re=re>>>0,ce||Ei(U,$,re,4),p.write(U,$,re,Re,23,4),re+4}b.prototype.writeFloatLE=function(U,$,re){return $e(this,U,$,!0,re)},b.prototype.writeFloatBE=function(U,$,re){return $e(this,U,$,!1,re)};function Ui(U,$,re,Re,ce){return $=+$,re=re>>>0,ce||Ei(U,$,re,8),p.write(U,$,re,Re,52,8),re+8}b.prototype.writeDoubleLE=function(U,$,re){return Ui(this,U,$,!0,re)},b.prototype.writeDoubleBE=function(U,$,re){return Ui(this,U,$,!1,re)},b.prototype.copy=function(U,$,re,Re){if(!b.isBuffer(U))throw new TypeError("argument should be a Buffer");if(re||(re=0),!Re&&Re!==0&&(Re=this.length),$>=U.length&&($=U.length),$||($=0),Re>0&&Re<re&&(Re=re),Re===re||U.length===0||this.length===0)return 0;if($<0)throw new RangeError("targetStart out of bounds");if(re<0||re>=this.length)throw new RangeError("Index out of range");if(Re<0)throw new RangeError("sourceEnd out of bounds");Re>this.length&&(Re=this.length),U.length-$<Re-re&&(Re=U.length-$+re);const ce=Re-re;return this===U&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin($,re,Re):Uint8Array.prototype.set.call(U,this.subarray(re,Re),$),ce},b.prototype.fill=function(U,$,re,Re){if(typeof U=="string"){if(typeof $=="string"?(Re=$,$=0,re=this.length):typeof re=="string"&&(Re=re,re=this.length),Re!==void 0&&typeof Re!="string")throw new TypeError("encoding must be a string");if(typeof Re=="string"&&!b.isEncoding(Re))throw new TypeError("Unknown encoding: "+Re);if(U.length===1){const Ue=U.charCodeAt(0);(Re==="utf8"&&Ue<128||Re==="latin1")&&(U=Ue)}}else typeof U=="number"?U=U&255:typeof U=="boolean"&&(U=Number(U));if($<0||this.length<$||this.length<re)throw new RangeError("Out of range index");if(re<=$)return this;$=$>>>0,re=re===void 0?this.length:re>>>0,U||(U=0);let ce;if(typeof U=="number")for(ce=$;ce<re;++ce)this[ce]=U;else{const Ue=b.isBuffer(U)?U:b.from(U,Re),je=Ue.length;if(je===0)throw new TypeError('The value "'+U+'" is invalid for argument "value"');for(ce=0;ce<re-$;++ce)this[ce+$]=Ue[ce%je]}return this};const hi={};function Ri(U,$,re){hi[U]=class extends re{constructor(){super(),Object.defineProperty(this,"message",{value:$.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${U}]`,this.stack,delete this.name}get code(){return U}set code(Re){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:Re,writable:!0})}toString(){return`${this.name} [${U}]: ${this.message}`}}}Ri("ERR_BUFFER_OUT_OF_BOUNDS",function(U){return U?`${U} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Ri("ERR_INVALID_ARG_TYPE",function(U,$){return`The "${U}" argument must be of type number. Received type ${typeof $}`},TypeError),Ri("ERR_OUT_OF_RANGE",function(U,$,re){let Re=`The value of "${U}" is out of range.`,ce=re;return Number.isInteger(re)&&Math.abs(re)>4294967296?ce=Si(String(re)):typeof re=="bigint"&&(ce=String(re),(re>BigInt(2)**BigInt(32)||re<-(BigInt(2)**BigInt(32)))&&(ce=Si(ce)),ce+="n"),Re+=` It must be ${$}. Received ${ce}`,Re},RangeError);function Si(U){let $="",re=U.length;const Re=U[0]==="-"?1:0;for(;re>=Re+4;re-=3)$=`_${U.slice(re-3,re)}${$}`;return`${U.slice(0,re)}${$}`}function Zi(U,$,re){Ge($,"offset"),(U[$]===void 0||U[$+re]===void 0)&&Ce($,U.length-(re+1))}function Vi(U,$,re,Re,ce,Ue){if(U>re||U<$){const je=typeof $=="bigint"?"n":"";let pt;throw $===0||$===BigInt(0)?pt=`>= 0${je} and < 2${je} ** ${(Ue+1)*8}${je}`:pt=`>= -(2${je} ** ${(Ue+1)*8-1}${je}) and < 2 ** ${(Ue+1)*8-1}${je}`,new hi.ERR_OUT_OF_RANGE("value",pt,U)}Zi(Re,ce,Ue)}function Ge(U,$){if(typeof U!="number")throw new hi.ERR_INVALID_ARG_TYPE($,"number",U)}function Ce(U,$,re){throw Math.floor(U)!==U?(Ge(U,re),new hi.ERR_OUT_OF_RANGE("offset","an integer",U)):$<0?new hi.ERR_BUFFER_OUT_OF_BOUNDS:new hi.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${$}`,U)}const At=/[^+/0-9A-Za-z-_]/g;function Pt(U){if(U=U.split("=")[0],U=U.trim().replace(At,""),U.length<2)return"";for(;U.length%4!==0;)U=U+"=";return U}function $t(U,$){$=$||1/0;let re;const Re=U.length;let ce=null;const Ue=[];for(let je=0;je<Re;++je){if(re=U.charCodeAt(je),re>55295&&re<57344){if(!ce){if(re>56319){($-=3)>-1&&Ue.push(239,191,189);continue}else if(je+1===Re){($-=3)>-1&&Ue.push(239,191,189);continue}ce=re;continue}if(re<56320){($-=3)>-1&&Ue.push(239,191,189),ce=re;continue}re=(ce-55296<<10|re-56320)+65536}else ce&&($-=3)>-1&&Ue.push(239,191,189);if(ce=null,re<128){if(($-=1)<0)break;Ue.push(re)}else if(re<2048){if(($-=2)<0)break;Ue.push(re>>6|192,re&63|128)}else if(re<65536){if(($-=3)<0)break;Ue.push(re>>12|224,re>>6&63|128,re&63|128)}else if(re<1114112){if(($-=4)<0)break;Ue.push(re>>18|240,re>>12&63|128,re>>6&63|128,re&63|128)}else throw new Error("Invalid code point")}return Ue}function Mt(U){const $=[];for(let re=0;re<U.length;++re)$.push(U.charCodeAt(re)&255);return $}function yi(U,$){let re,Re,ce;const Ue=[];for(let je=0;je<U.length&&!(($-=2)<0);++je)re=U.charCodeAt(je),Re=re>>8,ce=re%256,Ue.push(ce),Ue.push(Re);return Ue}function vt(U){return h.toByteArray(Pt(U))}function ye(U,$,re,Re){let ce;for(ce=0;ce<Re&&!(ce+re>=$.length||ce>=U.length);++ce)$[ce+re]=U[ce];return ce}function ve(U,$){return U instanceof $||U!=null&&U.constructor!=null&&U.constructor.name!=null&&U.constructor.name===$.name}function Ne(U){return U!==U}const Te=function(){const U="0123456789abcdef",$=new Array(256);for(let re=0;re<16;++re){const Re=re*16;for(let ce=0;ce<16;++ce)$[Re+ce]=U[re]+U[ce]}return $}();function ke(U){return typeof BigInt>"u"?Oe:U}function Oe(){throw new Error("BigInt not supported")}},"./node_modules/css-loader/dist/runtime/api.js":l=>{l.exports=function(u){var c=[];return c.toString=function(){return this.map(function(h){var p="",f=typeof h[5]<"u";return h[4]&&(p+="@supports (".concat(h[4],") {")),h[2]&&(p+="@media ".concat(h[2]," {")),f&&(p+="@layer".concat(h[5].length>0?" ".concat(h[5]):""," {")),p+=u(h),f&&(p+="}"),h[2]&&(p+="}"),h[4]&&(p+="}"),p}).join("")},c.i=function(h,p,f,g,m){typeof h=="string"&&(h=[[null,h,void 0]]);var y={};if(f)for(var b=0;b<this.length;b++){var v=this[b][0];v!=null&&(y[v]=!0)}for(var _=0;_<h.length;_++){var C=[].concat(h[_]);f&&y[C[0]]||(typeof m<"u"&&(typeof C[5]>"u"||(C[1]="@layer".concat(C[5].length>0?" ".concat(C[5]):""," {").concat(C[1],"}")),C[5]=m),p&&(C[2]&&(C[1]="@media ".concat(C[2]," {").concat(C[1],"}")),C[2]=p),g&&(C[4]?(C[1]="@supports (".concat(C[4],") {").concat(C[1],"}"),C[4]=g):C[4]="".concat(g)),c.push(C))}},c}},"./node_modules/css-loader/dist/runtime/getUrl.js":l=>{l.exports=function(u,c){return c||(c={}),u&&(u=String(u.__esModule?u.default:u),/^['"].*['"]$/.test(u)&&(u=u.slice(1,-1)),c.hash&&(u+=c.hash),/["'() \t\n]|(%20)/.test(u)||c.needQuotes?'"'.concat(u.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):u)}},"./node_modules/css-loader/dist/runtime/sourceMaps.js":l=>{l.exports=function(u){var c=u[1],h=u[3];if(!h)return c;if(typeof btoa=="function"){var p=btoa(unescape(encodeURIComponent(JSON.stringify(h)))),f="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(p),g="/*# ".concat(f," */");return[c].concat([g]).join(`
`)}return[c].join(`
`)}},"./node_modules/debug/src/browser.js":(l,u,c)=>{u.formatArgs=p,u.save=f,u.load=g,u.useColors=h,u.storage=m(),u.destroy=(()=>{let b=!1;return()=>{b||(b=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),u.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function h(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function p(b){if(b[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+b[0]+(this.useColors?"%c ":" ")+"+"+l.exports.humanize(this.diff),!this.useColors)return;const v="color: "+this.color;b.splice(1,0,v,"color: inherit");let _=0,C=0;b[0].replace(/%[a-zA-Z%]/g,E=>{E!=="%%"&&(_++,E==="%c"&&(C=_))}),b.splice(C,0,v)}u.log=console.debug||console.log||(()=>{});function f(b){try{b?u.storage.setItem("debug",b):u.storage.removeItem("debug")}catch{}}function g(){let b;try{b=u.storage.getItem("debug")}catch{}return!b&&typeof process<"u"&&"env"in process&&(b=process.env.DEBUG),b}function m(){try{return localStorage}catch{}}l.exports=c("./node_modules/debug/src/common.js")(u);const{formatters:y}=l.exports;y.j=function(b){try{return JSON.stringify(b)}catch(v){return"[UnexpectedJSONParseError]: "+v.message}}},"./node_modules/debug/src/common.js":(l,u,c)=>{function h(p){g.debug=g,g.default=g,g.coerce=C,g.disable=b,g.enable=y,g.enabled=v,g.humanize=c("./node_modules/ms/index.js"),g.destroy=E,Object.keys(p).forEach(T=>{g[T]=p[T]}),g.names=[],g.skips=[],g.formatters={};function f(T){let R=0;for(let B=0;B<T.length;B++)R=(R<<5)-R+T.charCodeAt(B),R|=0;return g.colors[Math.abs(R)%g.colors.length]}g.selectColor=f;function g(T){let R,B=null,I,D;function L(...O){if(!L.enabled)return;const F=L,q=Number(new Date),H=q-(R||q);F.diff=H,F.prev=R,F.curr=q,R=q,O[0]=g.coerce(O[0]),typeof O[0]!="string"&&O.unshift("%O");let G=0;O[0]=O[0].replace(/%([a-zA-Z%])/g,(J,Q)=>{if(J==="%%")return"%";G++;const V=g.formatters[Q];if(typeof V=="function"){const z=O[G];J=V.call(F,z),O.splice(G,1),G--}return J}),g.formatArgs.call(F,O),(F.log||g.log).apply(F,O)}return L.namespace=T,L.useColors=g.useColors(),L.color=g.selectColor(T),L.extend=m,L.destroy=g.destroy,Object.defineProperty(L,"enabled",{enumerable:!0,configurable:!1,get:()=>B!==null?B:(I!==g.namespaces&&(I=g.namespaces,D=g.enabled(T)),D),set:O=>{B=O}}),typeof g.init=="function"&&g.init(L),L}function m(T,R){const B=g(this.namespace+(typeof R>"u"?":":R)+T);return B.log=this.log,B}function y(T){g.save(T),g.namespaces=T,g.names=[],g.skips=[];let R;const B=(typeof T=="string"?T:"").split(/[\s,]+/),I=B.length;for(R=0;R<I;R++)B[R]&&(T=B[R].replace(/\*/g,".*?"),T[0]==="-"?g.skips.push(new RegExp("^"+T.slice(1)+"$")):g.names.push(new RegExp("^"+T+"$")))}function b(){const T=[...g.names.map(_),...g.skips.map(_).map(R=>"-"+R)].join(",");return g.enable(""),T}function v(T){if(T[T.length-1]==="*")return!0;let R,B;for(R=0,B=g.skips.length;R<B;R++)if(g.skips[R].test(T))return!1;for(R=0,B=g.names.length;R<B;R++)if(g.names[R].test(T))return!0;return!1}function _(T){return T.toString().substring(2,T.toString().length-2).replace(/\.\*\?$/,"*")}function C(T){return T instanceof Error?T.stack||T.message:T}function E(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return g.enable(g.load()),g}l.exports=h},"./node_modules/deep-assign/index.js":(l,u,c)=>{var h=c("./node_modules/is-obj/index.js"),p=Object.prototype.hasOwnProperty,f=Object.prototype.propertyIsEnumerable;function g(b){if(b==null)throw new TypeError("Sources cannot be null or undefined");return Object(b)}function m(b,v,_){var C=v[_];if(C!=null){if(p.call(b,_)&&(b[_]===void 0||b[_]===null))throw new TypeError("Cannot convert undefined or null to object ("+_+")");!p.call(b,_)||!h(C)?b[_]=C:b[_]=y(Object(b[_]),v[_])}}function y(b,v){if(b===v)return b;v=Object(v);for(var _ in v)p.call(v,_)&&m(b,v,_);if(Object.getOwnPropertySymbols)for(var C=Object.getOwnPropertySymbols(v),E=0;E<C.length;E++)f.call(v,C[E])&&m(b,v,C[E]);return b}l.exports=function(b){b=g(b);for(var v=1;v<arguments.length;v++)y(b,arguments[v]);return b}},"./node_modules/dtype/index.js":l=>{l.exports=function(u){switch(u){case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array;case"array":return Array;case"uint8_clamped":return Uint8ClampedArray}}},"./node_modules/global/window.js":(l,u,c)=>{var h;typeof window<"u"?h=window:typeof c.g<"u"?h=c.g:typeof self<"u"?h=self:h={},l.exports=h},"./node_modules/ieee754/index.js":(l,u)=>{/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */u.read=function(c,h,p,f,g){var m,y,b=g*8-f-1,v=(1<<b)-1,_=v>>1,C=-7,E=p?g-1:0,T=p?-1:1,R=c[h+E];for(E+=T,m=R&(1<<-C)-1,R>>=-C,C+=b;C>0;m=m*256+c[h+E],E+=T,C-=8);for(y=m&(1<<-C)-1,m>>=-C,C+=f;C>0;y=y*256+c[h+E],E+=T,C-=8);if(m===0)m=1-_;else{if(m===v)return y?NaN:(R?-1:1)*(1/0);y=y+Math.pow(2,f),m=m-_}return(R?-1:1)*y*Math.pow(2,m-f)},u.write=function(c,h,p,f,g,m){var y,b,v,_=m*8-g-1,C=(1<<_)-1,E=C>>1,T=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,R=f?0:m-1,B=f?1:-1,I=h<0||h===0&&1/h<0?1:0;for(h=Math.abs(h),isNaN(h)||h===1/0?(b=isNaN(h)?1:0,y=C):(y=Math.floor(Math.log(h)/Math.LN2),h*(v=Math.pow(2,-y))<1&&(y--,v*=2),y+E>=1?h+=T/v:h+=T*Math.pow(2,1-E),h*v>=2&&(y++,v/=2),y+E>=C?(b=0,y=C):y+E>=1?(b=(h*v-1)*Math.pow(2,g),y=y+E):(b=h*Math.pow(2,E-1)*Math.pow(2,g),y=0));g>=8;c[p+R]=b&255,R+=B,b/=256,g-=8);for(y=y<<g|b,_+=g;_>0;c[p+R]=y&255,R+=B,y/=256,_-=8);c[p+R-B]|=I*128}},"./node_modules/is-buffer/index.js":l=>{/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */l.exports=function(h){return h!=null&&(u(h)||c(h)||!!h._isBuffer)};function u(h){return!!h.constructor&&typeof h.constructor.isBuffer=="function"&&h.constructor.isBuffer(h)}function c(h){return typeof h.readFloatLE=="function"&&typeof h.slice=="function"&&u(h.slice(0,0))}},"./node_modules/is-function/index.js":l=>{l.exports=c;var u=Object.prototype.toString;function c(h){if(!h)return!1;var p=u.call(h);return p==="[object Function]"||typeof h=="function"&&p!=="[object RegExp]"||typeof window<"u"&&(h===window.setTimeout||h===window.alert||h===window.confirm||h===window.prompt)}},"./node_modules/is-obj/index.js":l=>{l.exports=function(u){var c=typeof u;return u!==null&&(c==="object"||c==="function")}},"./node_modules/layout-bmfont-text/index.js":(l,u,c)=>{var h=c("./node_modules/word-wrapper/index.js"),p=c("./node_modules/xtend/immutable.js"),f=c("./node_modules/as-number/index.js"),g=["x","e","a","o","n","s","r","c","u","m","v","w","z"],m=["m","w"],y=["H","I","N","E","F","K","L","T","U","V","W","X","Y","Z"],b=9,v=32,_=0,C=1,E=2;l.exports=function(G){return new T(G)};function T(G){this.glyphs=[],this._measure=this.computeMetrics.bind(this),this.update(G)}T.prototype.update=function(G){if(G=p({measure:this._measure},G),this._opt=G,this._opt.tabSize=f(this._opt.tabSize,4),!G.font)throw new Error("must provide a valid bitmap font");var J=this.glyphs,Q=G.text||"",V=G.font;this._setupSpaceGlyphs(V);var z=h.lines(Q,G),te=G.width||0;J.length=0;var K=z.reduce(function(wt,qt){return Math.max(wt,qt.width,te)},0),ae=0,Ae=0,_e=f(G.lineHeight,V.common.lineHeight),me=V.common.base,Pe=_e-me,Xe=G.letterSpacing||0,Je=_e*z.length-Pe,tt=q(this._opt.align);Ae-=Je,this._width=K,this._height=Je,this._descender=_e-me,this._baseline=me,this._xHeight=D(V),this._capHeight=O(V),this._lineHeight=_e,this._ascender=_e-Pe-this._xHeight;var dt=this;z.forEach(function(wt,qt){for(var yt=wt.start,Ei=wt.end,$e=wt.width,Ui,hi=yt;hi<Ei;hi++){var Ri=Q.charCodeAt(hi),Si=dt.getGlyph(V,Ri);if(Si){Ui&&(ae+=F(V,Ui.id,Si.id));var Zi=ae;tt===C?Zi+=(K-$e)/2:tt===E&&(Zi+=K-$e),J.push({position:[Zi,Ae],data:Si,index:hi,line:qt}),ae+=Si.xadvance+Xe,Ui=Si}}Ae+=_e,ae=0}),this._linesTotal=z.length},T.prototype._setupSpaceGlyphs=function(G){if(this._fallbackSpaceGlyph=null,this._fallbackTabGlyph=null,!(!G.chars||G.chars.length===0)){var J=I(G,v)||L(G)||G.chars[0],Q=this._opt.tabSize*J.xadvance;this._fallbackSpaceGlyph=J,this._fallbackTabGlyph=p(J,{x:0,y:0,xadvance:Q,id:b,xoffset:0,yoffset:0,width:0,height:0})}},T.prototype.getGlyph=function(G,J){var Q=I(G,J);return Q||(J===b?this._fallbackTabGlyph:J===v?this._fallbackSpaceGlyph:null)},T.prototype.computeMetrics=function(G,J,Q,V){var z=this._opt.letterSpacing||0,te=this._opt.font,K=0,ae=0,Ae=0,_e,me;if(!te.chars||te.chars.length===0)return{start:J,end:J,width:0};Q=Math.min(G.length,Q);for(var Pe=J;Pe<Q;Pe++){var Xe=G.charCodeAt(Pe),_e=this.getGlyph(te,Xe);if(_e){_e.xoffset;var Je=me?F(te,me.id,_e.id):0;K+=Je;var tt=K+_e.xadvance+z,dt=K+_e.width;if(dt>=V||tt>=V)break;K=tt,ae=dt,me=_e}Ae++}return me&&(ae+=me.xoffset),{start:J,end:J+Ae,width:ae}},["width","height","descender","ascender","xHeight","baseline","capHeight","lineHeight"].forEach(R);function R(G){Object.defineProperty(T.prototype,G,{get:B(G),configurable:!0})}function B(G){return new Function(["return function "+G+"() {","  return this._"+G,"}"].join(`
`))()}function I(G,J){if(!G.chars||G.chars.length===0)return null;var Q=H(G.chars,J);return Q>=0?G.chars[Q]:null}function D(G){for(var J=0;J<g.length;J++){var Q=g[J].charCodeAt(0),V=H(G.chars,Q);if(V>=0)return G.chars[V].height}return 0}function L(G){for(var J=0;J<m.length;J++){var Q=m[J].charCodeAt(0),V=H(G.chars,Q);if(V>=0)return G.chars[V]}return 0}function O(G){for(var J=0;J<y.length;J++){var Q=y[J].charCodeAt(0),V=H(G.chars,Q);if(V>=0)return G.chars[V].height}return 0}function F(G,J,Q){if(!G.kernings||G.kernings.length===0)return 0;for(var V=G.kernings,z=0;z<V.length;z++){var te=V[z];if(te.first===J&&te.second===Q)return te.amount}return 0}function q(G){return G==="center"?C:G==="right"?E:_}function H(G,J,Q){Q=Q||0;for(var V=Q;V<G.length;V++)if(G[V].id===J)return V;return-1}},"./node_modules/load-bmfont/browser.js":(l,u,c)=>{var h=c("./node_modules/buffer/index.js").Buffer,p=c("./node_modules/xhr/index.js"),f=function(){},g=c("./node_modules/parse-bmfont-ascii/index.js"),m=c("./node_modules/parse-bmfont-xml/lib/browser.js"),y=c("./node_modules/parse-bmfont-binary/index.js"),b=c("./node_modules/load-bmfont/lib/is-binary.js"),v=c("./node_modules/xtend/immutable.js"),_=function(){return self.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}();l.exports=function(T,R){R=typeof R=="function"?R:f,typeof T=="string"?T={uri:T}:T||(T={});var B=T.binary;B&&(T=E(T)),p(T,function(I,D,L){if(I)return R(I);if(!/^2/.test(D.statusCode))return R(new Error("http status code: "+D.statusCode));if(!L)return R(new Error("no body result"));var O=!1;if(C(L)){var F=new Uint8Array(L);L=h.from(F,"binary")}b(L)&&(O=!0,typeof L=="string"&&(L=h.from(L,"binary"))),O||(h.isBuffer(L)&&(L=L.toString(T.encoding)),L=L.trim());var q;try{var H=D.headers["content-type"];O?q=y(L):/json/.test(H)||L.charAt(0)==="{"?q=JSON.parse(L):/xml/.test(H)||L.charAt(0)==="<"?q=m(L):q=g(L)}catch(G){R(new Error("error parsing font "+G.message)),R=f}R(null,q)})};function C(T){var R=Object.prototype.toString;return R.call(T)==="[object ArrayBuffer]"}function E(T){if(_)return v(T,{responseType:"arraybuffer"});if(typeof self.XMLHttpRequest>"u")throw new Error("your browser does not support XHR loading");var R=new self.XMLHttpRequest;return R.overrideMimeType("text/plain; charset=x-user-defined"),v({xhr:R},T)}},"./node_modules/load-bmfont/lib/is-binary.js":(l,u,c)=>{var h=c("./node_modules/buffer/index.js").Buffer,p=c("./node_modules/buffer-equal/index.js"),f=h.from([66,77,70,3]);l.exports=function(g){return typeof g=="string"?g.substring(0,3)==="BMF":g.length>4&&p(g.slice(0,4),f)}},"./node_modules/ms/index.js":l=>{var u=1e3,c=u*60,h=c*60,p=h*24,f=p*7,g=p*365.25;l.exports=function(_,C){C=C||{};var E=typeof _;if(E==="string"&&_.length>0)return m(_);if(E==="number"&&isFinite(_))return C.long?b(_):y(_);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(_))};function m(_){if(_=String(_),!(_.length>100)){var C=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(_);if(C){var E=parseFloat(C[1]),T=(C[2]||"ms").toLowerCase();switch(T){case"years":case"year":case"yrs":case"yr":case"y":return E*g;case"weeks":case"week":case"w":return E*f;case"days":case"day":case"d":return E*p;case"hours":case"hour":case"hrs":case"hr":case"h":return E*h;case"minutes":case"minute":case"mins":case"min":case"m":return E*c;case"seconds":case"second":case"secs":case"sec":case"s":return E*u;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return E;default:return}}}}function y(_){var C=Math.abs(_);return C>=p?Math.round(_/p)+"d":C>=h?Math.round(_/h)+"h":C>=c?Math.round(_/c)+"m":C>=u?Math.round(_/u)+"s":_+"ms"}function b(_){var C=Math.abs(_);return C>=p?v(_,C,p,"day"):C>=h?v(_,C,h,"hour"):C>=c?v(_,C,c,"minute"):C>=u?v(_,C,u,"second"):_+" ms"}function v(_,C,E,T){var R=C>=E*1.5;return Math.round(_/E)+" "+T+(R?"s":"")}},"./node_modules/parse-bmfont-ascii/index.js":l=>{l.exports=function(p){if(!p)throw new Error("no data provided");p=p.toString().trim();var f={pages:[],chars:[],kernings:[]},g=p.split(/\r\n?|\n/g);if(g.length===0)throw new Error("no data in BMFont file");for(var m=0;m<g.length;m++){var y=u(g[m],m);if(y)if(y.key==="page"){if(typeof y.data.id!="number")throw new Error("malformed file at line "+m+" -- needs page id=N");if(typeof y.data.file!="string")throw new Error("malformed file at line "+m+' -- needs page file="path"');f.pages[y.data.id]=y.data.file}else y.key==="chars"||y.key==="kernings"||(y.key==="char"?f.chars.push(y.data):y.key==="kerning"?f.kernings.push(y.data):f[y.key]=y.data)}return f};function u(p,f){if(p=p.replace(/\t+/g," ").trim(),!p)return null;var g=p.indexOf(" ");if(g===-1)throw new Error("no named row at line "+f);var m=p.substring(0,g);p=p.substring(g+1),p=p.replace(/letter=[\'\"]\S+[\'\"]/gi,""),p=p.split("="),p=p.map(function(C){return C.trim().match(/(".*?"|[^"\s]+)+(?=\s*|\s*$)/g)});for(var y=[],b=0;b<p.length;b++){var v=p[b];b===0?y.push({key:v[0],data:""}):b===p.length-1?y[y.length-1].data=c(v[0]):(y[y.length-1].data=c(v[0]),y.push({key:v[1],data:""}))}var _={key:m,data:{}};return y.forEach(function(C){_.data[C.key]=C.data}),_}function c(p){return!p||p.length===0?"":p.indexOf('"')===0||p.indexOf("'")===0?p.substring(1,p.length-1):p.indexOf(",")!==-1?h(p):parseInt(p,10)}function h(p){return p.split(",").map(function(f){return parseInt(f,10)})}},"./node_modules/parse-bmfont-binary/index.js":l=>{var u=[66,77,70];l.exports=function(v){if(v.length<6)throw new Error("invalid buffer length for BMFont");var _=u.every(function(B,I){return v.readUInt8(I)===B});if(!_)throw new Error("BMFont missing BMF byte header");var C=3,E=v.readUInt8(C++);if(E>3)throw new Error("Only supports BMFont Binary v3 (BMFont App v1.10)");for(var T={kernings:[],chars:[]},R=0;R<5;R++)C+=c(T,v,C);return T};function c(v,_,C){if(C>_.length-1)return 0;var E=_.readUInt8(C++),T=_.readInt32LE(C);switch(C+=4,E){case 1:v.info=h(_,C);break;case 2:v.common=p(_,C);break;case 3:v.pages=f(_,C,T);break;case 4:v.chars=g(_,C,T);break;case 5:v.kernings=m(_,C,T);break}return 5+T}function h(v,_){var C={};C.size=v.readInt16LE(_);var E=v.readUInt8(_+2);return C.smooth=E>>7&1,C.unicode=E>>6&1,C.italic=E>>5&1,C.bold=E>>4&1,E>>3&1&&(C.fixedHeight=1),C.charset=v.readUInt8(_+3)||"",C.stretchH=v.readUInt16LE(_+4),C.aa=v.readUInt8(_+6),C.padding=[v.readInt8(_+7),v.readInt8(_+8),v.readInt8(_+9),v.readInt8(_+10)],C.spacing=[v.readInt8(_+11),v.readInt8(_+12)],C.outline=v.readUInt8(_+13),C.face=b(v,_+14),C}function p(v,_){var C={};return C.lineHeight=v.readUInt16LE(_),C.base=v.readUInt16LE(_+2),C.scaleW=v.readUInt16LE(_+4),C.scaleH=v.readUInt16LE(_+6),C.pages=v.readUInt16LE(_+8),v.readUInt8(_+10),C.packed=0,C.alphaChnl=v.readUInt8(_+11),C.redChnl=v.readUInt8(_+12),C.greenChnl=v.readUInt8(_+13),C.blueChnl=v.readUInt8(_+14),C}function f(v,_,C){for(var E=[],T=y(v,_),R=T.length+1,B=C/R,I=0;I<B;I++)E[I]=v.slice(_,_+T.length).toString("utf8"),_+=R;return E}function g(v,_,C){for(var E=[],T=C/20,R=0;R<T;R++){var B={},I=R*20;B.id=v.readUInt32LE(_+0+I),B.x=v.readUInt16LE(_+4+I),B.y=v.readUInt16LE(_+6+I),B.width=v.readUInt16LE(_+8+I),B.height=v.readUInt16LE(_+10+I),B.xoffset=v.readInt16LE(_+12+I),B.yoffset=v.readInt16LE(_+14+I),B.xadvance=v.readInt16LE(_+16+I),B.page=v.readUInt8(_+18+I),B.chnl=v.readUInt8(_+19+I),E[R]=B}return E}function m(v,_,C){for(var E=[],T=C/10,R=0;R<T;R++){var B={},I=R*10;B.first=v.readUInt32LE(_+0+I),B.second=v.readUInt32LE(_+4+I),B.amount=v.readInt16LE(_+8+I),E[R]=B}return E}function y(v,_){for(var C=_;C<v.length&&v[C]!==0;C++);return v.slice(_,C)}function b(v,_){return y(v,_).toString("utf8")}},"./node_modules/parse-bmfont-xml/lib/browser.js":(l,u,c)=>{var h=c("./node_modules/parse-bmfont-xml/lib/parse-attribs.js"),p=c("./node_modules/xml-parse-from-string/index.js"),f={scaleh:"scaleH",scalew:"scaleW",stretchh:"stretchH",lineheight:"lineHeight",alphachnl:"alphaChnl",redchnl:"redChnl",greenchnl:"greenChnl",bluechnl:"blueChnl"};l.exports=function(b){b=b.toString();var v=p(b),_={pages:[],chars:[],kernings:[]};["info","common"].forEach(function(D){var L=v.getElementsByTagName(D)[0];L&&(_[D]=h(g(L)))});var C=v.getElementsByTagName("pages")[0];if(!C)throw new Error("malformed file -- no <pages> element");for(var E=C.getElementsByTagName("page"),T=0;T<E.length;T++){var R=E[T],B=parseInt(R.getAttribute("id"),10),I=R.getAttribute("file");if(isNaN(B))throw new Error('malformed file -- page "id" attribute is NaN');if(!I)throw new Error('malformed file -- needs page "file" attribute');_.pages[parseInt(B,10)]=I}return["chars","kernings"].forEach(function(D){var L=v.getElementsByTagName(D)[0];if(L)for(var O=D.substring(0,D.length-1),F=L.getElementsByTagName(O),q=0;q<F.length;q++){var H=F[q];_[D].push(h(g(H)))}}),_};function g(b){var v=m(b);return v.reduce(function(_,C){var E=y(C.nodeName);return _[E]=C.nodeValue,_},{})}function m(b){for(var v=[],_=0;_<b.attributes.length;_++)v.push(b.attributes[_]);return v}function y(b){return f[b.toLowerCase()]||b}},"./node_modules/parse-bmfont-xml/lib/parse-attribs.js":l=>{var u="chasrset";l.exports=function(h){u in h&&(h.charset=h[u],delete h[u]);for(var p in h)p==="face"||p==="charset"||(p==="padding"||p==="spacing"?h[p]=c(h[p]):h[p]=parseInt(h[p],10));return h};function c(h){return h.split(",").map(function(p){return parseInt(p,10)})}},"./node_modules/parse-headers/parse-headers.js":l=>{var u=function(h){return h.replace(/^\s+|\s+$/g,"")},c=function(h){return Object.prototype.toString.call(h)==="[object Array]"};l.exports=function(h){if(!h)return{};for(var p={},f=u(h).split(`
`),g=0;g<f.length;g++){var m=f[g],y=m.indexOf(":"),b=u(m.slice(0,y)).toLowerCase(),v=u(m.slice(y+1));typeof p[b]>"u"?p[b]=v:c(p[b])?p[b].push(v):p[b]=[p[b],v]}return p}},"./node_modules/quad-indices/index.js":(l,u,c)=>{var h=c("./node_modules/dtype/index.js"),p=c("./node_modules/an-array/index.js"),f=c("./node_modules/is-buffer/index.js"),g=[0,2,3],m=[2,1,3];l.exports=function(y,b){(!y||!(p(y)||f(y)))&&(b=y||{},y=null),typeof b=="number"?b={count:b}:b=b||{};for(var v=typeof b.type=="string"?b.type:"uint16",_=typeof b.count=="number"?b.count:1,C=b.start||0,E=b.clockwise!==!1?g:m,T=E[0],R=E[1],B=E[2],I=_*6,D=y||new(h(v))(I),L=0,O=0;L<I;L+=6,O+=4){var F=L+C;D[F+0]=O+0,D[F+1]=O+1,D[F+2]=O+2,D[F+3]=O+T,D[F+4]=O+R,D[F+5]=O+B}return D}},"./node_modules/super-animejs/lib/anime.es.js":(l,u,c)=>{c.r(u),c.d(u,{default:()=>Ie});var h={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0},p={duration:1e3,delay:0,endDelay:0,easing:"easeOutElastic(1, .5)",round:0},f=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective"],g={CSS:{},springs:{}};function m(se,fe,Be){return Math.min(Math.max(se,fe),Be)}function y(se,fe){return se.indexOf(fe)>-1}function b(se,fe){return se.apply(null,fe)}var v=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i,_=/^rgb/,C=/^hsl/,E={arr:function(se){return Array.isArray(se)},obj:function(se){return y(Object.prototype.toString.call(se),"Object")},pth:function(se){return E.obj(se)&&se.hasOwnProperty("totalLength")},svg:function(se){return se instanceof SVGElement},inp:function(se){return se instanceof HTMLInputElement},dom:function(se){return se.nodeType||E.svg(se)},str:function(se){return typeof se=="string"},fnc:function(se){return typeof se=="function"},und:function(se){return typeof se>"u"},hex:function(se){return v.test(se)},rgb:function(se){return _.test(se)},hsl:function(se){return C.test(se)},col:function(se){return E.hex(se)||E.rgb(se)||E.hsl(se)},key:function(se){return!h.hasOwnProperty(se)&&!p.hasOwnProperty(se)&&se!=="targets"&&se!=="keyframes"}},T=/\(([^)]+)\)/;function R(se){var fe=T.exec(se);return fe?fe[1].split(",").map(function(Be){return parseFloat(Be)}):[]}function B(se,fe){var Be=R(se),Fe=m(E.und(Be[0])?1:Be[0],.1,100),Ye=m(E.und(Be[1])?100:Be[1],.1,100),lt=m(E.und(Be[2])?10:Be[2],.1,100),Ct=m(E.und(Be[3])?0:Be[3],.1,100),Yt=Math.sqrt(Ye/Fe),ei=lt/(2*Math.sqrt(Ye*Fe)),Bt=ei<1?Yt*Math.sqrt(1-ei*ei):0,ni=1,wi=ei<1?(ei*Yt+-Ct)/Bt:-Ct+Yt;function zi(hr){var er=fe?fe*hr/1e3:hr;return ei<1?er=Math.exp(-er*ei*Yt)*(ni*Math.cos(Bt*er)+wi*Math.sin(Bt*er)):er=(ni+wi*er)*Math.exp(-er*Yt),hr===0||hr===1?hr:1-er}function Sr(){var hr=g.springs[se];if(hr)return hr;for(var er=.16666666666666666,_i=0,Rn=0;;)if(_i+=er,zi(_i)===1){if(Rn++,Rn>=16)break}else Rn=0;var Kn=_i*er*1e3;return g.springs[se]=Kn,Kn}return fe?zi:Sr}function I(se,fe){se===void 0&&(se=1),fe===void 0&&(fe=.5);var Be=m(se,1,10),Fe=m(fe,.1,2);return function(Ye){return Ye===0||Ye===1?Ye:-Be*Math.pow(2,10*(Ye-1))*Math.sin((Ye-1-Fe/(Math.PI*2)*Math.asin(1/Be))*(Math.PI*2)/Fe)}}function D(se){return se===void 0&&(se=10),function(fe){return Math.round(fe*se)*(1/se)}}var L=function(){var se=11,fe=1/(se-1);function Be(ni,wi){return 1-3*wi+3*ni}function Fe(ni,wi){return 3*wi-6*ni}function Ye(ni){return 3*ni}function lt(ni,wi,zi){return((Be(wi,zi)*ni+Fe(wi,zi))*ni+Ye(wi))*ni}function Ct(ni,wi,zi){return 3*Be(wi,zi)*ni*ni+2*Fe(wi,zi)*ni+Ye(wi)}function Yt(ni,wi,zi,Sr,hr){var er,_i,Rn=0;do _i=wi+(zi-wi)/2,er=lt(_i,Sr,hr)-ni,er>0?zi=_i:wi=_i;while(Math.abs(er)>1e-7&&++Rn<10);return _i}function ei(ni,wi,zi,Sr){for(var hr=0;hr<4;++hr){var er=Ct(wi,zi,Sr);if(er===0)return wi;var _i=lt(wi,zi,Sr)-ni;wi-=_i/er}return wi}function Bt(ni,wi,zi,Sr){if(!(0<=ni&&ni<=1&&0<=zi&&zi<=1))return;var hr=new Float32Array(se);if(ni!==wi||zi!==Sr)for(var er=0;er<se;++er)hr[er]=lt(er*fe,ni,zi);function _i(Rn){for(var Kn=0,Bi=1,or=se-1;Bi!==or&&hr[Bi]<=Rn;++Bi)Kn+=fe;--Bi;var dn=(Rn-hr[Bi])/(hr[Bi+1]-hr[Bi]),qr=Kn+dn*fe,W=Ct(qr,ni,zi);return W>=.001?ei(Rn,qr,ni,zi):W===0?qr:Yt(Rn,Kn,Kn+fe,ni,zi)}return function(Rn){return ni===wi&&zi===Sr||Rn===0||Rn===1?Rn:lt(_i(Rn),wi,Sr)}}return Bt}(),O=function(){var se=["Quad","Cubic","Quart","Quint","Sine","Expo","Circ","Back","Elastic"],fe={In:[[.55,.085,.68,.53],[.55,.055,.675,.19],[.895,.03,.685,.22],[.755,.05,.855,.06],[.47,0,.745,.715],[.95,.05,.795,.035],[.6,.04,.98,.335],[.6,-.28,.735,.045],I],Out:[[.25,.46,.45,.94],[.215,.61,.355,1],[.165,.84,.44,1],[.23,1,.32,1],[.39,.575,.565,1],[.19,1,.22,1],[.075,.82,.165,1],[.175,.885,.32,1.275],function(Ct,Yt){return function(ei){return 1-I(Ct,Yt)(1-ei)}}],InOut:[[.455,.03,.515,.955],[.645,.045,.355,1],[.77,0,.175,1],[.86,0,.07,1],[.445,.05,.55,.95],[1,0,0,1],[.785,.135,.15,.86],[.68,-.55,.265,1.55],function(Ct,Yt){return function(ei){return ei<.5?I(Ct,Yt)(ei*2)/2:1-I(Ct,Yt)(ei*-2+2)/2}}]},Be={linear:[.25,.25,.75,.75]};for(var Fe in fe)for(var Ye=0,lt=fe[Fe].length;Ye<lt;Ye++)Be["ease"+Fe+se[Ye]]=fe[Fe][Ye];return Be}();function F(se,fe){if(E.fnc(se))return se;var Be=se.split("(")[0],Fe=O[Be],Ye=R(se);switch(Be){case"spring":return B(se,fe);case"cubicBezier":return b(L,Ye);case"steps":return b(D,Ye);default:return E.fnc(Fe)?b(Fe,Ye):b(L,Fe)}}function q(se){try{var fe=document.querySelectorAll(se);return fe}catch{return}}var H=[];function G(se,fe){for(var Be=H,Fe=se.length,Ye=arguments.length>=2?arguments[1]:void 0,lt=0;lt<Fe;lt++)if(lt in se){var Ct=se[lt];fe.call(Ye,Ct,lt,se)&&Be.push(Ct)}return H=se,H.length=0,Be}function J(se,fe){fe||(fe=[]);for(var Be=0,Fe=se.length;Be<Fe;Be++){var Ye=se[Be];Array.isArray(Ye)?J(Ye,fe):fe.push(Ye)}return fe}function Q(se){return E.arr(se)?se:(E.str(se)&&(se=q(se)||se),se instanceof NodeList||se instanceof HTMLCollection?[].slice.call(se):[se])}function V(se,fe){return se.some(function(Be){return Be===fe})}function z(se){var fe={};for(var Be in se)fe[Be]=se[Be];return fe}function te(se,fe){var Be=z(se);for(var Fe in se)Be[Fe]=fe.hasOwnProperty(Fe)?fe[Fe]:se[Fe];return Be}function K(se,fe){var Be=z(se);for(var Fe in fe)Be[Fe]=E.und(se[Fe])?fe[Fe]:se[Fe];return Be}var ae=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g;function Ae(se){var fe=ae.exec(se);return fe?"rgba("+fe[1]+",1)":se}var _e=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,me=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i;function Pe(se){var fe=se.replace(_e,function(Ct,Yt,ei,Bt){return Yt+Yt+ei+ei+Bt+Bt}),Be=me.exec(fe),Fe=parseInt(Be[1],16),Ye=parseInt(Be[2],16),lt=parseInt(Be[3],16);return"rgba("+Fe+","+Ye+","+lt+",1)"}var Xe=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g,Je=/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g;function tt(se){var fe=Xe.exec(se)||Je.exec(se),Be=parseInt(fe[1],10)/360,Fe=parseInt(fe[2],10)/100,Ye=parseInt(fe[3],10)/100,lt=fe[4]||1;function Ct(zi,Sr,hr){return hr<0&&(hr+=1),hr>1&&(hr-=1),hr<.16666666666666666?zi+(Sr-zi)*6*hr:hr<.5?Sr:hr<.6666666666666666?zi+(Sr-zi)*(.6666666666666666-hr)*6:zi}var Yt,ei,Bt;if(Fe==0)Yt=ei=Bt=Ye;else{var ni=Ye<.5?Ye*(1+Fe):Ye+Fe-Ye*Fe,wi=2*Ye-ni;Yt=Ct(wi,ni,Be+.3333333333333333),ei=Ct(wi,ni,Be),Bt=Ct(wi,ni,Be-.3333333333333333)}return"rgba("+Yt*255+","+ei*255+","+Bt*255+","+lt+")"}function dt(se){if(E.rgb(se))return Ae(se);if(E.hex(se))return Pe(se);if(E.hsl(se))return tt(se)}var wt=/([\+\-]?[0-9#\.]+)(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/;function qt(se){var fe=wt.exec(se);if(fe)return fe[2]}function yt(se){if(y(se,"translate")||se==="perspective")return"px";if(y(se,"rotate")||y(se,"skew"))return"deg"}function Ei(se,fe){return E.fnc(se)?se(fe.target,fe.id,fe.total):se}function $e(se,fe){return se.getAttribute(fe)}function Ui(se,fe,Be){var Fe=qt(fe);if(V([Be,"deg","rad","turn"],Fe))return fe;var Ye=g.CSS[fe+Be];if(!E.und(Ye))return Ye;var lt=100,Ct=document.createElement(se.tagName),Yt=se.parentNode&&se.parentNode!==document?se.parentNode:document.body;Yt.appendChild(Ct),Ct.style.position="absolute",Ct.style.width=lt+Be;var ei=lt/Ct.offsetWidth;Yt.removeChild(Ct);var Bt=ei*parseFloat(fe);return g.CSS[fe+Be]=Bt,Bt}function hi(se,fe,Be){if(fe in se.style){var Fe=fe.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),Ye=se.style[fe]||getComputedStyle(se).getPropertyValue(Fe)||"0";return Be?Ui(se,Ye,Be):Ye}}function Ri(se,fe){if(E.dom(se)&&!E.inp(se)&&($e(se,fe)||E.svg(se)&&se[fe]))return"attribute";if(E.dom(se)&&V(f,fe))return"transform";if(E.dom(se)&&fe!=="transform"&&hi(se,fe))return"css";if(se[fe]!=null)return"object"}var Si=/(\w+)\(([^)]*)\)/g;function Zi(se){if(E.dom(se)){for(var fe=se.style.transform||"",Be=new Map,Fe;Fe=Si.exec(fe);)Be.set(Fe[1],Fe[2]);return Be}}function Vi(se,fe,Be,Fe){var Ye=y(fe,"scale")?1:0+yt(fe),lt=Zi(se).get(fe)||Ye;return Be&&(Be.transforms.list.set(fe,lt),Be.transforms.last=fe),Fe?Ui(se,lt,Fe):lt}function Ge(se,fe,Be,Fe){switch(Ri(se,fe)){case"transform":return Vi(se,fe,Fe,Be);case"css":return hi(se,fe,Be);case"attribute":return $e(se,fe);default:return se[fe]||0}}var Ce=/^(\*=|\+=|-=)/;function At(se,fe){var Be=Ce.exec(se);if(!Be)return se;var Fe=qt(se)||0,Ye=parseFloat(fe),lt=parseFloat(se.replace(Be[0],""));switch(Be[0][0]){case"+":return Ye+lt+Fe;case"-":return Ye-lt+Fe;case"*":return Ye*lt+Fe}}var Pt=/\s/g;function $t(se,fe){if(E.col(se))return dt(se);var Be=qt(se),Fe=Be?se.substr(0,se.length-Be.length):se;return fe&&!Pt.test(se)?Fe+fe:Fe}function Mt(se,fe){return Math.sqrt(Math.pow(fe.x-se.x,2)+Math.pow(fe.y-se.y,2))}function yi(se){return Math.PI*2*$e(se,"r")}function vt(se){return $e(se,"width")*2+$e(se,"height")*2}function ye(se){return Mt({x:$e(se,"x1"),y:$e(se,"y1")},{x:$e(se,"x2"),y:$e(se,"y2")})}function ve(se){for(var fe=se.points,Be=0,Fe,Ye=0;Ye<fe.numberOfItems;Ye++){var lt=fe.getItem(Ye);Ye>0&&(Be+=Mt(Fe,lt)),Fe=lt}return Be}function Ne(se){var fe=se.points;return ve(se)+Mt(fe.getItem(fe.numberOfItems-1),fe.getItem(0))}function Te(se){if(se.getTotalLength)return se.getTotalLength();switch(se.tagName.toLowerCase()){case"circle":return yi(se);case"rect":return vt(se);case"line":return ye(se);case"polyline":return ve(se);case"polygon":return Ne(se)}}function ke(se){var fe=Te(se);return se.setAttribute("stroke-dasharray",fe),fe}function Oe(se){for(var fe=se.parentNode;E.svg(fe)&&(fe=fe.parentNode,!!E.svg(fe.parentNode)););return fe}function U(se,fe){var Be=fe||{},Fe=Be.el||Oe(se),Ye=Fe.getBoundingClientRect(),lt=$e(Fe,"viewBox"),Ct=Ye.width,Yt=Ye.height,ei=Be.viewBox||(lt?lt.split(" "):[0,0,Ct,Yt]);return{el:Fe,viewBox:ei,x:ei[0]/1,y:ei[1]/1,w:Ct/ei[2],h:Yt/ei[3]}}function $(se,fe){var Be=E.str(se)?q(se)[0]:se,Fe=fe||100;return function(Ye){return{property:Ye,el:Be,svg:U(Be),totalLength:Te(Be)*(Fe/100)}}}function re(se,fe){function Be(Yt){Yt===void 0&&(Yt=0);var ei=fe+Yt>=1?fe+Yt:0;return se.el.getPointAtLength(ei)}var Fe=U(se.el,se.svg),Ye=Be(),lt=Be(-1),Ct=Be(1);switch(se.property){case"x":return(Ye.x-Fe.x)*Fe.w;case"y":return(Ye.y-Fe.y)*Fe.h;case"angle":return Math.atan2(Ct.y-lt.y,Ct.x-lt.x)*180/Math.PI}}var Re=/-?\d*\.?\d+/g;function ce(se,fe){var Be=$t(E.pth(se)?se.totalLength:se,fe)+"";return{original:Be,numbers:Be.match(Re)?Be.match(Re).map(Number):[0],strings:E.str(se)||fe?Be.split(Re):[]}}function Ue(se){var fe=se?J(E.arr(se)?se.map(Q):Q(se)):[];return G(fe,function(Be,Fe,Ye){return Ye.indexOf(Be)===Fe})}function je(se){var fe=Ue(se);return fe.map(function(Be,Fe){return{target:Be,id:Fe,total:fe.length,transforms:{list:Zi(Be)}}})}var pt=/^spring/;function Lt(se,fe){var Be=z(fe);if(pt.test(Be.easing)&&(Be.duration=B(Be.easing)),E.arr(se)){var Fe=se.length,Ye=Fe===2&&!E.obj(se[0]);Ye?se={value:se}:E.fnc(fe.duration)||(Be.duration=fe.duration/Fe)}var lt=E.arr(se)?se:[se];return lt.map(function(Ct,Yt){var ei=E.obj(Ct)&&!E.pth(Ct)?Ct:{value:Ct};return E.und(ei.delay)&&(ei.delay=Yt?0:fe.delay),E.und(ei.endDelay)&&(ei.endDelay=Yt===lt.length-1?fe.endDelay:0),ei}).map(function(Ct){return K(Ct,Be)})}function xt(se){for(var fe=G(J(se.map(function(lt){return Object.keys(lt)})),function(lt){return E.key(lt)}).reduce(function(lt,Ct){return lt.indexOf(Ct)<0&&lt.push(Ct),lt},[]),Be={},Fe=function(lt){var Ct=fe[lt];Be[Ct]=se.map(function(Yt){var ei={};for(var Bt in Yt)E.key(Bt)?Bt==Ct&&(ei.value=Yt[Bt]):ei[Bt]=Yt[Bt];return ei})},Ye=0;Ye<fe.length;Ye++)Fe(Ye);return Be}function Gt(se,fe){var Be=[],Fe=fe.keyframes;Fe&&(fe=K(xt(Fe),fe));for(var Ye in fe)E.key(Ye)&&Be.push({name:Ye,tweens:Lt(fe[Ye],se)});return Be}function mi(se,fe){var Be={};for(var Fe in se){var Ye=Ei(se[Fe],fe);E.arr(Ye)&&(Ye=Ye.map(function(lt){return Ei(lt,fe)}),Ye.length===1&&(Ye=Ye[0])),Be[Fe]=Ye}return Be.duration=parseFloat(Be.duration),Be.delay=parseFloat(Be.delay),Be}function _r(se,fe){var Be;return se.tweens.map(function(Fe){var Ye=mi(Fe,fe),lt=Ye.value,Ct=E.arr(lt)?lt[1]:lt,Yt=qt(Ct),ei=Ge(fe.target,se.name,Yt,fe),Bt=Be?Be.to.original:ei,ni=E.arr(lt)?lt[0]:Bt,wi=qt(ni)||qt(ei),zi=Yt||wi;return E.und(Ct)&&(Ct=Bt),Ye.from=ce(ni,zi),Ye.to=ce(At(Ct,ni),zi),Ye.start=Be?Be.end:0,Ye.end=Ye.start+Ye.delay+Ye.duration+Ye.endDelay,Ye.easing=F(Ye.easing,Ye.duration),Ye.isPath=E.pth(lt),Ye.isColor=E.col(Ye.from.original),Ye.isColor&&(Ye.round=1),Be=Ye,Ye})}var Fi={css:function(se,fe,Be){return se.style[fe]=Be},attribute:function(se,fe,Be){return se.setAttribute(fe,Be)},object:function(se,fe,Be){return se[fe]=Be},transform:function(se,fe,Be,Fe,Ye){if(Fe.list.set(fe,Be),fe===Fe.last||Ye){var lt="";Fe.list.forEach(function(Ct,Yt){lt+=Yt+"("+Ct+") "}),se.style.transform=lt}}};function gn(se,fe){for(var Be=je(se),Fe=0,Ye=Be.length;Fe<Ye;Fe++){var lt=Be[Fe];for(var Ct in fe){var Yt=Ei(fe[Ct],lt),ei=lt.target,Bt=qt(Yt),ni=Ge(ei,Ct,Bt,lt),wi=Bt||qt(ni),zi=At($t(Yt,wi),ni),Sr=Ri(ei,Ct);Fi[Sr](ei,Ct,zi,lt.transforms,!0)}}}function kr(se,fe){var Be=Ri(se.target,fe.name);if(Be){var Fe=_r(fe,se),Ye=Fe[Fe.length-1];return{type:Be,property:fe.name,animatable:se,tweens:Fe,duration:Ye.end,delay:Fe[0].delay,endDelay:Ye.endDelay}}}function nn(se,fe){return G(J(se.map(function(Be){return fe.map(function(Fe){return kr(Be,Fe)})})),function(Be){return!E.und(Be)})}function vs(se,fe){var Be=se.length,Fe=function(lt){return lt.timelineOffset?lt.timelineOffset:0},Ye={};return Ye.duration=Be?Math.max.apply(Math,se.map(function(lt){return Fe(lt)+lt.duration})):fe.duration,Ye.delay=Be?Math.min.apply(Math,se.map(function(lt){return Fe(lt)+lt.delay})):fe.delay,Ye.endDelay=Be?Ye.duration-Math.max.apply(Math,se.map(function(lt){return Fe(lt)+lt.duration-lt.endDelay})):fe.endDelay,Ye}var An=0;function Ns(se){var fe=te(h,se),Be=te(p,se),Fe=Gt(Be,se),Ye=je(se.targets),lt=nn(Ye,Fe),Ct=vs(lt,Be),Yt=An;return An++,K(fe,{id:Yt,children:[],animatables:Ye,animations:lt,duration:Ct.duration,delay:Ct.delay,endDelay:Ct.endDelay})}var ts=[],bs=[],pe,ct=function(){function se(){pe=requestAnimationFrame(fe)}function fe(Be){var Fe=ts.length;if(Fe){for(var Ye=0;Ye<Fe;){var lt=ts[Ye];if(!lt.paused)lt.tick(Be);else{var Ct=ts.indexOf(lt);Ct>-1&&(ts.splice(Ct,1),Fe=ts.length)}Ye++}se()}else pe=cancelAnimationFrame(pe)}return se}();function Tt(){if(document.hidden){for(var se=0,fe=ts.length;se<fe;se++)activeInstance[se].pause();bs=ts.slice(0),ts=[]}else for(var Be=0,Fe=bs.length;Be<Fe;Be++)bs[Be].play()}document.addEventListener("visibilitychange",Tt);function Jt(se){se===void 0&&(se={});var fe=0,Be=0,Fe=0,Ye,lt=0,Ct=null;function Yt(){return window.Promise&&new Promise(function(Bi){return Ct=Bi})}var ei=Yt(),Bt=Ns(se);function ni(){Bt.reversed=!Bt.reversed;for(var Bi=0,or=Ye.length;Bi<or;Bi++)Ye[Bi].reversed=Bt.reversed}function wi(Bi){return Bt.reversed?Bt.duration-Bi:Bi}function zi(){fe=0,Be=wi(Bt.currentTime)*(1/Jt.speed)}function Sr(Bi,or){or&&or.seek(Bi-or.timelineOffset)}function hr(Bi){if(Bt.reversePlayback)for(var or=lt;or--;)Sr(Bi,Ye[or]);else for(var dn=0;dn<lt;dn++)Sr(Bi,Ye[dn])}function er(Bi){for(var or=0,dn=Bt.animations,qr=dn.length;or<qr;){var W=dn[or],ue=W.animatable,ge=W.tweens,Se=ge.length-1,We=ge[Se];Se&&(We=G(ge,function(pr){return Bi<pr.end})[0]||We);for(var Ke=m(Bi-We.start-We.delay,0,We.duration)/We.duration,mt=isNaN(Ke)?1:We.easing(Ke),he=We.to.strings,le=We.round,de=[],be=We.to.numbers.length,Ee=void 0,at=0;at<be;at++){var St=void 0,Qt=We.to.numbers[at],si=We.from.numbers[at]||0;We.isPath?St=re(We.value,mt*Qt):St=si+mt*(Qt-si),le&&(We.isColor&&at>2||(St=Math.round(St*le)/le)),de.push(St)}var vi=he.length;if(!vi)Ee=de[0];else{Ee=he[0];for(var Xt=0;Xt<vi;Xt++){he[Xt];var Li=he[Xt+1],vr=de[Xt];isNaN(vr)||(Li?Ee+=vr+Li:Ee+=vr+" ")}}Fi[W.type](ue.target,W.property,Ee,ue.transforms),W.currentValue=Ee,or++}}function _i(Bi){Bt[Bi]&&!Bt.passThrough&&Bt[Bi](Bt)}function Rn(){Bt.remaining&&Bt.remaining!==!0&&Bt.remaining--}function Kn(Bi){var or=Bt.duration,dn=Bt.delay,qr=or-Bt.endDelay,W=wi(Bi);Bt.progress=m(W/or*100,0,100),Bt.reversePlayback=W<Bt.currentTime,Ye&&hr(W),!Bt.began&&Bt.currentTime>0&&(Bt.began=!0,_i("begin"),_i("loopBegin")),W<=dn&&Bt.currentTime!==0&&er(0),(W>=qr&&Bt.currentTime!==or||!or)&&er(or),W>dn&&W<qr?(Bt.changeBegan||(Bt.changeBegan=!0,Bt.changeCompleted=!1,_i("changeBegin")),_i("change"),er(W)):Bt.changeBegan&&(Bt.changeCompleted=!0,Bt.changeBegan=!1,_i("changeComplete")),Bt.currentTime=m(W,0,or),Bt.began&&_i("update"),Bi>=or&&(Be=0,Rn(),Bt.remaining?(fe=Fe,_i("loopComplete"),_i("loopBegin"),Bt.direction==="alternate"&&ni()):(Bt.paused=!0,Bt.completed||(Bt.completed=!0,_i("loopComplete"),_i("complete"),"Promise"in window&&(Ct(),ei=Yt()))))}return Bt.reset=function(){var Bi=Bt.direction;Bt.passThrough=!1,Bt.currentTime=0,Bt.progress=0,Bt.paused=!0,Bt.began=!1,Bt.changeBegan=!1,Bt.completed=!1,Bt.changeCompleted=!1,Bt.reversePlayback=!1,Bt.reversed=Bi==="reverse",Bt.remaining=Bt.loop,Ye=Bt.children,lt=Ye.length;for(var or=lt;or--;)Bt.children[or].reset();(Bt.reversed&&Bt.loop!==!0||Bi==="alternate"&&Bt.loop===1)&&Bt.remaining++,er(0)},Bt.set=function(Bi,or){return gn(Bi,or),Bt},Bt.tick=function(Bi){Fe=Bi,fe||(fe=Fe),Kn((Fe+(Be-fe))*Jt.speed)},Bt.seek=function(Bi){Kn(wi(Bi))},Bt.pause=function(){Bt.paused=!0,zi()},Bt.play=function(){Bt.paused&&(Bt.paused=!1,ts.push(Bt),zi(),pe||ct())},Bt.reverse=function(){ni(),zi()},Bt.restart=function(){Bt.reset(),Bt.play()},Bt.finished=ei,Bt.reset(),Bt.autoplay&&Bt.play(),Bt}function Ni(se,fe){for(var Be=fe.length;Be--;)V(se,fe[Be].animatable.target)&&fe.splice(Be,1)}function ar(se){for(var fe=Ue(se),Be=ts.length;Be--;){var Fe=ts[Be],Ye=Fe.animations,lt=Fe.children;Ni(fe,Ye);for(var Ct=lt.length;Ct--;){var Yt=lt[Ct],ei=Yt.animations;Ni(fe,ei),!ei.length&&!Yt.children.length&&lt.splice(Ct,1)}!Ye.length&&!lt.length&&Fe.pause()}}function Di(se,fe){fe===void 0&&(fe={});var Be=fe.direction||"normal",Fe=fe.easing?F(fe.easing):null,Ye=fe.grid,lt=fe.axis,Ct=fe.from||0,Yt=Ct==="first",ei=Ct==="center",Bt=Ct==="last",ni=E.arr(se),wi=parseFloat(ni?se[0]:se),zi=ni?parseFloat(se[1]):0,Sr=qt(ni?se[1]:se)||0,hr=fe.start||0+(ni?wi:0),er=[],_i=0;return function(Rn,Kn,Bi){if(Yt&&(Ct=0),ei&&(Ct=(Bi-1)/2),Bt&&(Ct=Bi-1),!er.length){for(var or=0;or<Bi;or++){if(!Ye)er.push(Math.abs(Ct-or));else{var dn=ei?(Ye[0]-1)/2:Ct%Ye[0],qr=ei?(Ye[1]-1)/2:Math.floor(Ct/Ye[0]),W=or%Ye[0],ue=Math.floor(or/Ye[0]),ge=dn-W,Se=qr-ue,We=Math.sqrt(ge*ge+Se*Se);lt==="x"&&(We=-ge),lt==="y"&&(We=-Se),er.push(We)}_i=Math.max.apply(Math,er)}Fe&&(er=er.map(function(mt){return Fe(mt/_i)*_i})),Be==="reverse"&&(er=er.map(function(mt){return lt?mt<0?mt*-1:-mt:Math.abs(_i-mt)}))}var Ke=ni?(zi-wi)/_i:wi;return hr+Ke*(Math.round(er[Kn]*100)/100)+Sr}}function ki(se){se===void 0&&(se={});var fe=Jt(se);return fe.duration=0,fe.add=function(Be,Fe){var Ye=ts.indexOf(fe),lt=fe.children;Ye>-1&&ts.splice(Ye,1);function Ct(zi){zi.passThrough=!0}for(var Yt=0;Yt<lt.length;Yt++)Ct(lt[Yt]);var ei=K(Be,te(p,se));ei.targets=ei.targets||se.targets;var Bt=fe.duration;ei.autoplay=!1,ei.direction=fe.direction,ei.timelineOffset=E.und(Fe)?Bt:At(Fe,Bt),Ct(fe),fe.seek(ei.timelineOffset);var ni=Jt(ei);Ct(ni),lt.push(ni);var wi=vs(lt,se);return fe.delay=wi.delay,fe.endDelay=wi.endDelay,fe.duration=wi.duration,fe.seek(0),fe.reset(),fe.autoplay&&fe.play(),fe},fe}Jt.version="3.0.0",Jt.speed=1,Jt.running=ts,Jt.remove=ar,Jt.get=Ge,Jt.set=gn,Jt.convertPx=Ui,Jt.path=$,Jt.setDashoffset=ke,Jt.stagger=Di,Jt.timeline=ki,Jt.easing=F,Jt.penner=O,Jt.random=function(se,fe){return Math.floor(Math.random()*(fe-se+1))+se};const Ie=Jt},"./node_modules/three-bmfont-text/index.js":(l,u,c)=>{var h=c("./node_modules/layout-bmfont-text/index.js"),p=c("./node_modules/quad-indices/index.js"),f=c("./node_modules/three-bmfont-text/lib/vertices.js"),g=c("./node_modules/three-bmfont-text/lib/utils.js");l.exports=function(y){return new m(y)};class m extends THREE.BufferGeometry{constructor(b){super(),typeof b=="string"&&(b={text:b}),this._opt=Object.assign({},b),b&&this.update(b)}update(b){if(typeof b=="string"&&(b={text:b}),b=Object.assign({},this._opt,b),!b.font)throw new TypeError("must specify a { font } in options");this.layout=h(b);var v=b.flipY!==!1,_=b.font,C=_.common.scaleW,E=_.common.scaleH,T=this.layout.glyphs.filter(function(L){var O=L.data;return O.width*O.height>0});this.visibleGlyphs=T;var R=f.positions(T),B=f.uvs(T,C,E,v),I=p([],{clockwise:!0,type:"uint16",count:T.length});if(this.setIndex(I),this.setAttribute("position",new THREE.BufferAttribute(R,2)),this.setAttribute("uv",new THREE.BufferAttribute(B,2)),!b.multipage&&"page"in this.attributes)this.removeAttribute("page");else if(b.multipage){var D=f.pages(T);this.setAttribute("page",new THREE.BufferAttribute(D,1))}this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere()}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new THREE.Sphere);var b=this.attributes.position.array,v=this.attributes.position.itemSize;if(!b||!v||b.length<2){this.boundingSphere.radius=0,this.boundingSphere.center.set(0,0,0);return}g.computeSphere(b,this.boundingSphere),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new THREE.Box3);var b=this.boundingBox,v=this.attributes.position.array,_=this.attributes.position.itemSize;if(!v||!_||v.length<2){b.makeEmpty();return}g.computeBox(v,b)}}},"./node_modules/three-bmfont-text/lib/utils.js":l=>{var u=2,c={min:[0,0],max:[0,0]};function h(p){var f=p.length/u;c.min[0]=p[0],c.min[1]=p[1],c.max[0]=p[0],c.max[1]=p[1];for(var g=0;g<f;g++){var m=p[g*u+0],y=p[g*u+1];c.min[0]=Math.min(m,c.min[0]),c.min[1]=Math.min(y,c.min[1]),c.max[0]=Math.max(m,c.max[0]),c.max[1]=Math.max(y,c.max[1])}}l.exports.computeBox=function(p,f){h(p),f.min.set(c.min[0],c.min[1],0),f.max.set(c.max[0],c.max[1],0)},l.exports.computeSphere=function(p,f){h(p);var g=c.min[0],m=c.min[1],y=c.max[0],b=c.max[1],v=y-g,_=b-m,C=Math.sqrt(v*v+_*_);f.center.set(g+v/2,m+_/2,0),f.radius=C/2}},"./node_modules/three-bmfont-text/lib/vertices.js":l=>{l.exports.pages=function(u){var c=new Float32Array(u.length*4*1),h=0;return u.forEach(function(p){var f=p.data.page||0;c[h++]=f,c[h++]=f,c[h++]=f,c[h++]=f}),c},l.exports.uvs=function(u,c,h,p){var f=new Float32Array(u.length*4*2),g=0;return u.forEach(function(m){var y=m.data,b=y.x+y.width,v=y.y+y.height,_=y.x/c,C=y.y/h,E=b/c,T=v/h;p&&(C=(h-y.y)/h,T=(h-v)/h),f[g++]=_,f[g++]=C,f[g++]=_,f[g++]=T,f[g++]=E,f[g++]=T,f[g++]=E,f[g++]=C}),f},l.exports.positions=function(u){var c=new Float32Array(u.length*4*2),h=0;return u.forEach(function(p){var f=p.data,g=p.position[0]+f.xoffset,m=p.position[1]+f.yoffset,y=f.width,b=f.height;c[h++]=g,c[h++]=m,c[h++]=g,c[h++]=m+b,c[h++]=g+y,c[h++]=m+b,c[h++]=g+y,c[h++]=m}),c}},"./node_modules/webvr-polyfill/build/webvr-polyfill.js":function(l,u,c){/**
 * @license
 * webvr-polyfill
 * Copyright (c) 2015-2017 Google
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * cardboard-vr-display
 * Copyright (c) 2015-2017 Google
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * webvr-polyfill-dpdb 
 * Copyright (c) 2017 Google
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * wglu-preserve-state
 * Copyright (c) 2016, Brandon Jones.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *//**
 * @license
 * nosleep.js
 * Copyright (c) 2017, Rich Tibbett
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */(function(h,p){l.exports=p()})(this,function(){var h=typeof window<"u"?window:typeof c.g<"u"?c.g:typeof self<"u"?self:{};function p(I){return I&&I.__esModule&&Object.prototype.hasOwnProperty.call(I,"default")?I.default:I}function f(I,D){return D={exports:{}},I(D,D.exports),D.exports}var g=function(){return/Android/i.test(navigator.userAgent)||/iPhone|iPad|iPod/i.test(navigator.userAgent)},m=function(I,D){for(var L=0,O=I.length;L<O;L++)D[L]=I[L]},y=function(I,D){for(var L in D)D.hasOwnProperty(L)&&(I[L]=D[L]);return I},b=f(function(I,D){/**
 * @license
 * cardboard-vr-display
 * Copyright (c) 2015-2017 Google
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * gl-preserve-state
 * Copyright (c) 2016, Brandon Jones.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *//**
 * @license
 * webvr-polyfill-dpdb
 * Copyright (c) 2015-2017 Google
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * nosleep.js
 * Copyright (c) 2017, Rich Tibbett
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */(function(L,O){I.exports=O()})(h,function(){var L=function(W,ue){if(!(W instanceof ue))throw new TypeError("Cannot call a class as a function")},O=function(){function W(ue,ge){for(var Se=0;Se<ge.length;Se++){var We=ge[Se];We.enumerable=We.enumerable||!1,We.configurable=!0,"value"in We&&(We.writable=!0),Object.defineProperty(ue,We.key,We)}}return function(ue,ge,Se){return ge&&W(ue.prototype,ge),Se&&W(ue,Se),ue}}(),F=function(){function W(ue,ge){var Se=[],We=!0,Ke=!1,mt=void 0;try{for(var he=ue[Symbol.iterator](),le;!(We=(le=he.next()).done)&&(Se.push(le.value),!(ge&&Se.length===ge));We=!0);}catch(de){Ke=!0,mt=de}finally{try{!We&&he.return&&he.return()}finally{if(Ke)throw mt}}return Se}return function(ue,ge){if(Array.isArray(ue))return ue;if(Symbol.iterator in Object(ue))return W(ue,ge);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),q=.001,H=1,G=function(W,ue){return"data:"+W+","+encodeURIComponent(ue)},J=function(W,ue,ge){return W+(ue-W)*ge},Q=function(){var W=/iPad|iPhone|iPod/.test(navigator.platform);return function(){return W}}(),V=function(){var W=navigator.userAgent.indexOf("Version")!==-1&&navigator.userAgent.indexOf("Android")!==-1&&navigator.userAgent.indexOf("Chrome")!==-1;return function(){return W}}(),z=function(){var W=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);return function(){return W}}(),te=function(){var W=navigator.userAgent.indexOf("Firefox")!==-1&&navigator.userAgent.indexOf("Android")!==-1;return function(){return W}}(),K=function(){var W=navigator.userAgent.match(/.*Chrome\/([0-9]+)/),ue=W?parseInt(W[1],10):null;return function(){return ue}}(),ae=function(){var W=!1;return W=Q()&&z()&&navigator.userAgent.indexOf("13_4")!==-1,function(){return W}}(),Ae=function(){var W=!1;if(K()===65){var ue=navigator.userAgent.match(/.*Chrome\/([0-9\.]*)/);if(ue){var ge=ue[1].split("."),Se=F(ge,4);Se[0],Se[1];var We=Se[2],Ke=Se[3];W=parseInt(We,10)===3325&&parseInt(Ke,10)<148}}return function(){return W}}(),_e=function(){var W=navigator.userAgent.indexOf("R7 Build")!==-1;return function(){return W}}(),me=function(){var W=window.orientation==90||window.orientation==-90;return _e()?!W:W},Pe=function(W){return!(isNaN(W)||W<=q||W>H)},Xe=function(){return Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio},Je=function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio},tt=function(W){if(V())return!1;if(W.requestFullscreen)W.requestFullscreen();else if(W.webkitRequestFullscreen)W.webkitRequestFullscreen();else if(W.mozRequestFullScreen)W.mozRequestFullScreen();else if(W.msRequestFullscreen)W.msRequestFullscreen();else return!1;return!0},dt=function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.msExitFullscreen)document.msExitFullscreen();else return!1;return!0},wt=function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement},qt=function(W,ue,ge,Se){var We=W.createShader(W.VERTEX_SHADER);W.shaderSource(We,ue),W.compileShader(We);var Ke=W.createShader(W.FRAGMENT_SHADER);W.shaderSource(Ke,ge),W.compileShader(Ke);var mt=W.createProgram();W.attachShader(mt,We),W.attachShader(mt,Ke);for(var he in Se)W.bindAttribLocation(mt,Se[he],he);return W.linkProgram(mt),W.deleteShader(We),W.deleteShader(Ke),mt},yt=function(W,ue){for(var ge={},Se=W.getProgramParameter(ue,W.ACTIVE_UNIFORMS),We="",Ke=0;Ke<Se;Ke++){var mt=W.getActiveUniform(ue,Ke);We=mt.name.replace("[0]",""),ge[We]=W.getUniformLocation(ue,We)}return ge},Ei=function(W,ue,ge,Se,We,Ke,mt){var he=1/(ue-ge),le=1/(Se-We),de=1/(Ke-mt);return W[0]=-2*he,W[1]=0,W[2]=0,W[3]=0,W[4]=0,W[5]=-2*le,W[6]=0,W[7]=0,W[8]=0,W[9]=0,W[10]=2*de,W[11]=0,W[12]=(ue+ge)*he,W[13]=(We+Se)*le,W[14]=(mt+Ke)*de,W[15]=1,W},$e=function(){var W=!1;return function(ue){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(ue)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(ue.substr(0,4)))&&(W=!0)}(navigator.userAgent||navigator.vendor||window.opera),W},Ui=function(W,ue){for(var ge in ue)ue.hasOwnProperty(ge)&&(W[ge]=ue[ge]);return W},hi=function(W){if(Q()){var ue=W.style.width,ge=W.style.height;W.style.width=parseInt(ue)+1+"px",W.style.height=parseInt(ge)+"px",setTimeout(function(){W.style.width=ue,W.style.height=ge},100)}window.canvas=W},Ri=function(){var W=Math.PI/180,ue=Math.PI*.25;function ge(de,be,Ee,at){var St=Math.tan(be?be.upDegrees*W:ue),Qt=Math.tan(be?be.downDegrees*W:ue),si=Math.tan(be?be.leftDegrees*W:ue),vi=Math.tan(be?be.rightDegrees*W:ue),Xt=2/(si+vi),Li=2/(St+Qt);return de[0]=Xt,de[1]=0,de[2]=0,de[3]=0,de[4]=0,de[5]=Li,de[6]=0,de[7]=0,de[8]=-((si-vi)*Xt*.5),de[9]=(St-Qt)*Li*.5,de[10]=at/(Ee-at),de[11]=-1,de[12]=0,de[13]=0,de[14]=at*Ee/(Ee-at),de[15]=0,de}function Se(de,be,Ee){var at=be[0],St=be[1],Qt=be[2],si=be[3],vi=at+at,Xt=St+St,Li=Qt+Qt,vr=at*vi,pr=at*Xt,fr=at*Li,Qi=St*Xt,wr=St*Li,Tr=Qt*Li,Fr=si*vi,Gr=si*Xt,xn=si*Li;return de[0]=1-(Qi+Tr),de[1]=pr+xn,de[2]=fr-Gr,de[3]=0,de[4]=pr-xn,de[5]=1-(vr+Tr),de[6]=wr+Fr,de[7]=0,de[8]=fr+Gr,de[9]=wr-Fr,de[10]=1-(vr+Qi),de[11]=0,de[12]=Ee[0],de[13]=Ee[1],de[14]=Ee[2],de[15]=1,de}function We(de,be,Ee){var at=Ee[0],St=Ee[1],Qt=Ee[2],si,vi,Xt,Li,vr,pr,fr,Qi,wr,Tr,Fr,Gr;return be===de?(de[12]=be[0]*at+be[4]*St+be[8]*Qt+be[12],de[13]=be[1]*at+be[5]*St+be[9]*Qt+be[13],de[14]=be[2]*at+be[6]*St+be[10]*Qt+be[14],de[15]=be[3]*at+be[7]*St+be[11]*Qt+be[15]):(si=be[0],vi=be[1],Xt=be[2],Li=be[3],vr=be[4],pr=be[5],fr=be[6],Qi=be[7],wr=be[8],Tr=be[9],Fr=be[10],Gr=be[11],de[0]=si,de[1]=vi,de[2]=Xt,de[3]=Li,de[4]=vr,de[5]=pr,de[6]=fr,de[7]=Qi,de[8]=wr,de[9]=Tr,de[10]=Fr,de[11]=Gr,de[12]=si*at+vr*St+wr*Qt+be[12],de[13]=vi*at+pr*St+Tr*Qt+be[13],de[14]=Xt*at+fr*St+Fr*Qt+be[14],de[15]=Li*at+Qi*St+Gr*Qt+be[15]),de}function Ke(de,be){var Ee=be[0],at=be[1],St=be[2],Qt=be[3],si=be[4],vi=be[5],Xt=be[6],Li=be[7],vr=be[8],pr=be[9],fr=be[10],Qi=be[11],wr=be[12],Tr=be[13],Fr=be[14],Gr=be[15],xn=Ee*vi-at*si,jr=Ee*Xt-St*si,hs=Ee*Li-Qt*si,Dr=at*Xt-St*vi,Cl=at*Li-Qt*vi,il=St*Li-Qt*Xt,Nc=vr*Tr-pr*wr,su=vr*Fr-fr*wr,au=vr*Gr-Qi*wr,uo=pr*Fr-fr*Tr,ou=pr*Gr-Qi*Tr,Xa=fr*Gr-Qi*Fr,On=xn*Xa-jr*ou+hs*uo+Dr*au-Cl*su+il*Nc;return On?(On=1/On,de[0]=(vi*Xa-Xt*ou+Li*uo)*On,de[1]=(St*ou-at*Xa-Qt*uo)*On,de[2]=(Tr*il-Fr*Cl+Gr*Dr)*On,de[3]=(fr*Cl-pr*il-Qi*Dr)*On,de[4]=(Xt*au-si*Xa-Li*su)*On,de[5]=(Ee*Xa-St*au+Qt*su)*On,de[6]=(Fr*hs-wr*il-Gr*jr)*On,de[7]=(vr*il-fr*hs+Qi*jr)*On,de[8]=(si*ou-vi*au+Li*Nc)*On,de[9]=(at*au-Ee*ou-Qt*Nc)*On,de[10]=(wr*Cl-Tr*hs+Gr*xn)*On,de[11]=(pr*hs-vr*Cl-Qi*xn)*On,de[12]=(vi*su-si*uo-Xt*Nc)*On,de[13]=(Ee*uo-at*su+St*Nc)*On,de[14]=(Tr*jr-wr*Dr-Fr*xn)*On,de[15]=(vr*Dr-pr*jr+fr*xn)*On,de):null}var mt=new Float32Array([0,0,0,1]),he=new Float32Array([0,0,0]);function le(de,be,Ee,at,St,Qt){ge(de,at||null,Qt.depthNear,Qt.depthFar);var si=Ee.orientation||mt,vi=Ee.position||he;Se(be,si,vi),St&&We(be,be,St),Ke(be,be)}return function(de,be,Ee){return!de||!be?!1:(de.pose=be,de.timestamp=be.timestamp,le(de.leftProjectionMatrix,de.leftViewMatrix,be,Ee._getFieldOfView("left"),Ee._getEyeOffset("left"),Ee),le(de.rightProjectionMatrix,de.rightViewMatrix,be,Ee._getFieldOfView("right"),Ee._getEyeOffset("right"),Ee),!0)}}(),Si=function(){var W=window.self!==window.top,ue=Zi(document.referrer),ge=Zi(window.location.href);return W&&ue!==ge},Zi=function(W){var ue,ge=W.indexOf("://");ge!==-1?ue=ge+3:ue=0;var Se=W.indexOf("/",ue);return Se===-1&&(Se=W.length),W.substring(0,Se)},Vi=function(W){if(W.w>1)return console.warn("getQuaternionAngle: w > 1"),0;var ue=2*Math.acos(W.w);return ue},Ge=function(){var W={};return function(ue,ge){W[ue]===void 0&&(console.warn("webvr-polyfill: "+ge),W[ue]=!0)}}(),Ce=function(W,ue){var ge=ue?"Please use "+ue+" instead.":"";Ge(W,W+" has been deprecated. This may not work on native WebVR displays. "+ge)};function At(W,ue,ge){if(!ue){ge(W);return}for(var Se=[],We=null,Ke=0;Ke<ue.length;++Ke){var mt=ue[Ke];switch(mt){case W.TEXTURE_BINDING_2D:case W.TEXTURE_BINDING_CUBE_MAP:var he=ue[++Ke];if(he<W.TEXTURE0||he>W.TEXTURE31){console.error("TEXTURE_BINDING_2D or TEXTURE_BINDING_CUBE_MAP must be followed by a valid texture unit"),Se.push(null,null);break}We||(We=W.getParameter(W.ACTIVE_TEXTURE)),W.activeTexture(he),Se.push(W.getParameter(mt),null);break;case W.ACTIVE_TEXTURE:We=W.getParameter(W.ACTIVE_TEXTURE),Se.push(null);break;default:Se.push(W.getParameter(mt));break}}ge(W);for(var Ke=0;Ke<ue.length;++Ke){var mt=ue[Ke],le=Se[Ke];switch(mt){case W.ACTIVE_TEXTURE:break;case W.ARRAY_BUFFER_BINDING:W.bindBuffer(W.ARRAY_BUFFER,le);break;case W.COLOR_CLEAR_VALUE:W.clearColor(le[0],le[1],le[2],le[3]);break;case W.COLOR_WRITEMASK:W.colorMask(le[0],le[1],le[2],le[3]);break;case W.CURRENT_PROGRAM:W.useProgram(le);break;case W.ELEMENT_ARRAY_BUFFER_BINDING:W.bindBuffer(W.ELEMENT_ARRAY_BUFFER,le);break;case W.FRAMEBUFFER_BINDING:W.bindFramebuffer(W.FRAMEBUFFER,le);break;case W.RENDERBUFFER_BINDING:W.bindRenderbuffer(W.RENDERBUFFER,le);break;case W.TEXTURE_BINDING_2D:var he=ue[++Ke];if(he<W.TEXTURE0||he>W.TEXTURE31)break;W.activeTexture(he),W.bindTexture(W.TEXTURE_2D,le);break;case W.TEXTURE_BINDING_CUBE_MAP:var he=ue[++Ke];if(he<W.TEXTURE0||he>W.TEXTURE31)break;W.activeTexture(he),W.bindTexture(W.TEXTURE_CUBE_MAP,le);break;case W.VIEWPORT:W.viewport(le[0],le[1],le[2],le[3]);break;case W.BLEND:case W.CULL_FACE:case W.DEPTH_TEST:case W.SCISSOR_TEST:case W.STENCIL_TEST:le?W.enable(mt):W.disable(mt);break;default:console.log("No GL restore behavior for 0x"+mt.toString(16));break}We&&W.activeTexture(We)}}var Pt=At,$t=["attribute vec2 position;","attribute vec3 texCoord;","varying vec2 vTexCoord;","uniform vec4 viewportOffsetScale[2];","void main() {","  vec4 viewport = viewportOffsetScale[int(texCoord.z)];","  vTexCoord = (texCoord.xy * viewport.zw) + viewport.xy;","  gl_Position = vec4( position, 1.0, 1.0 );","}"].join(`
`),Mt=["precision mediump float;","uniform sampler2D diffuse;","varying vec2 vTexCoord;","void main() {","  gl_FragColor = texture2D(diffuse, vTexCoord);","}"].join(`
`);function yi(W,ue,ge,Se){this.gl=W,this.cardboardUI=ue,this.bufferScale=ge,this.dirtySubmitFrameBindings=Se,this.ctxAttribs=W.getContextAttributes(),this.instanceExt=W.getExtension("ANGLE_instanced_arrays"),this.meshWidth=20,this.meshHeight=20,this.bufferWidth=W.drawingBufferWidth,this.bufferHeight=W.drawingBufferHeight,this.realBindFramebuffer=W.bindFramebuffer,this.realEnable=W.enable,this.realDisable=W.disable,this.realColorMask=W.colorMask,this.realClearColor=W.clearColor,this.realViewport=W.viewport,Q()||(this.realCanvasWidth=Object.getOwnPropertyDescriptor(W.canvas.__proto__,"width"),this.realCanvasHeight=Object.getOwnPropertyDescriptor(W.canvas.__proto__,"height")),this.isPatched=!1,this.lastBoundFramebuffer=null,this.cullFace=!1,this.depthTest=!1,this.blend=!1,this.scissorTest=!1,this.stencilTest=!1,this.viewport=[0,0,0,0],this.colorMask=[!0,!0,!0,!0],this.clearColor=[0,0,0,0],this.attribs={position:0,texCoord:1},this.program=qt(W,$t,Mt,this.attribs),this.uniforms=yt(W,this.program),this.viewportOffsetScale=new Float32Array(8),this.setTextureBounds(),this.vertexBuffer=W.createBuffer(),this.indexBuffer=W.createBuffer(),this.indexCount=0,this.renderTarget=W.createTexture(),this.framebuffer=W.createFramebuffer(),this.depthStencilBuffer=null,this.depthBuffer=null,this.stencilBuffer=null,this.ctxAttribs.depth&&this.ctxAttribs.stencil?this.depthStencilBuffer=W.createRenderbuffer():this.ctxAttribs.depth?this.depthBuffer=W.createRenderbuffer():this.ctxAttribs.stencil&&(this.stencilBuffer=W.createRenderbuffer()),this.patch(),this.onResize()}yi.prototype.destroy=function(){var W=this.gl;this.unpatch(),W.deleteProgram(this.program),W.deleteBuffer(this.vertexBuffer),W.deleteBuffer(this.indexBuffer),W.deleteTexture(this.renderTarget),W.deleteFramebuffer(this.framebuffer),this.depthStencilBuffer&&W.deleteRenderbuffer(this.depthStencilBuffer),this.depthBuffer&&W.deleteRenderbuffer(this.depthBuffer),this.stencilBuffer&&W.deleteRenderbuffer(this.stencilBuffer),this.cardboardUI&&this.cardboardUI.destroy()},yi.prototype.onResize=function(){var W=this.gl,ue=this,ge=[W.RENDERBUFFER_BINDING,W.TEXTURE_BINDING_2D,W.TEXTURE0];Pt(W,ge,function(Se){ue.realBindFramebuffer.call(Se,Se.FRAMEBUFFER,null),ue.scissorTest&&ue.realDisable.call(Se,Se.SCISSOR_TEST),ue.realColorMask.call(Se,!0,!0,!0,!0),ue.realViewport.call(Se,0,0,Se.drawingBufferWidth,Se.drawingBufferHeight),ue.realClearColor.call(Se,0,0,0,1),Se.clear(Se.COLOR_BUFFER_BIT),ue.realBindFramebuffer.call(Se,Se.FRAMEBUFFER,ue.framebuffer),Se.bindTexture(Se.TEXTURE_2D,ue.renderTarget),Se.texImage2D(Se.TEXTURE_2D,0,ue.ctxAttribs.alpha?Se.RGBA:Se.RGB,ue.bufferWidth,ue.bufferHeight,0,ue.ctxAttribs.alpha?Se.RGBA:Se.RGB,Se.UNSIGNED_BYTE,null),Se.texParameteri(Se.TEXTURE_2D,Se.TEXTURE_MAG_FILTER,Se.LINEAR),Se.texParameteri(Se.TEXTURE_2D,Se.TEXTURE_MIN_FILTER,Se.LINEAR),Se.texParameteri(Se.TEXTURE_2D,Se.TEXTURE_WRAP_S,Se.CLAMP_TO_EDGE),Se.texParameteri(Se.TEXTURE_2D,Se.TEXTURE_WRAP_T,Se.CLAMP_TO_EDGE),Se.framebufferTexture2D(Se.FRAMEBUFFER,Se.COLOR_ATTACHMENT0,Se.TEXTURE_2D,ue.renderTarget,0),ue.ctxAttribs.depth&&ue.ctxAttribs.stencil?(Se.bindRenderbuffer(Se.RENDERBUFFER,ue.depthStencilBuffer),Se.renderbufferStorage(Se.RENDERBUFFER,Se.DEPTH_STENCIL,ue.bufferWidth,ue.bufferHeight),Se.framebufferRenderbuffer(Se.FRAMEBUFFER,Se.DEPTH_STENCIL_ATTACHMENT,Se.RENDERBUFFER,ue.depthStencilBuffer)):ue.ctxAttribs.depth?(Se.bindRenderbuffer(Se.RENDERBUFFER,ue.depthBuffer),Se.renderbufferStorage(Se.RENDERBUFFER,Se.DEPTH_COMPONENT16,ue.bufferWidth,ue.bufferHeight),Se.framebufferRenderbuffer(Se.FRAMEBUFFER,Se.DEPTH_ATTACHMENT,Se.RENDERBUFFER,ue.depthBuffer)):ue.ctxAttribs.stencil&&(Se.bindRenderbuffer(Se.RENDERBUFFER,ue.stencilBuffer),Se.renderbufferStorage(Se.RENDERBUFFER,Se.STENCIL_INDEX8,ue.bufferWidth,ue.bufferHeight),Se.framebufferRenderbuffer(Se.FRAMEBUFFER,Se.STENCIL_ATTACHMENT,Se.RENDERBUFFER,ue.stencilBuffer)),!Se.checkFramebufferStatus(Se.FRAMEBUFFER)===Se.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer incomplete!"),ue.realBindFramebuffer.call(Se,Se.FRAMEBUFFER,ue.lastBoundFramebuffer),ue.scissorTest&&ue.realEnable.call(Se,Se.SCISSOR_TEST),ue.realColorMask.apply(Se,ue.colorMask),ue.realViewport.apply(Se,ue.viewport),ue.realClearColor.apply(Se,ue.clearColor)}),this.cardboardUI&&this.cardboardUI.onResize()},yi.prototype.patch=function(){if(!this.isPatched){var W=this,ue=this.gl.canvas,ge=this.gl;Q()||(ue.width=Xe()*this.bufferScale,ue.height=Je()*this.bufferScale,Object.defineProperty(ue,"width",{configurable:!0,enumerable:!0,get:function(){return W.bufferWidth},set:function(Se){W.bufferWidth=Se,W.realCanvasWidth.set.call(ue,Se),W.onResize()}}),Object.defineProperty(ue,"height",{configurable:!0,enumerable:!0,get:function(){return W.bufferHeight},set:function(Se){W.bufferHeight=Se,W.realCanvasHeight.set.call(ue,Se),W.onResize()}})),this.lastBoundFramebuffer=ge.getParameter(ge.FRAMEBUFFER_BINDING),this.lastBoundFramebuffer==null&&(this.lastBoundFramebuffer=this.framebuffer,this.gl.bindFramebuffer(ge.FRAMEBUFFER,this.framebuffer)),this.gl.bindFramebuffer=function(Se,We){W.lastBoundFramebuffer=We||W.framebuffer,W.realBindFramebuffer.call(ge,Se,W.lastBoundFramebuffer)},this.cullFace=ge.getParameter(ge.CULL_FACE),this.depthTest=ge.getParameter(ge.DEPTH_TEST),this.blend=ge.getParameter(ge.BLEND),this.scissorTest=ge.getParameter(ge.SCISSOR_TEST),this.stencilTest=ge.getParameter(ge.STENCIL_TEST),ge.enable=function(Se){switch(Se){case ge.CULL_FACE:W.cullFace=!0;break;case ge.DEPTH_TEST:W.depthTest=!0;break;case ge.BLEND:W.blend=!0;break;case ge.SCISSOR_TEST:W.scissorTest=!0;break;case ge.STENCIL_TEST:W.stencilTest=!0;break}W.realEnable.call(ge,Se)},ge.disable=function(Se){switch(Se){case ge.CULL_FACE:W.cullFace=!1;break;case ge.DEPTH_TEST:W.depthTest=!1;break;case ge.BLEND:W.blend=!1;break;case ge.SCISSOR_TEST:W.scissorTest=!1;break;case ge.STENCIL_TEST:W.stencilTest=!1;break}W.realDisable.call(ge,Se)},this.colorMask=ge.getParameter(ge.COLOR_WRITEMASK),ge.colorMask=function(Se,We,Ke,mt){W.colorMask[0]=Se,W.colorMask[1]=We,W.colorMask[2]=Ke,W.colorMask[3]=mt,W.realColorMask.call(ge,Se,We,Ke,mt)},this.clearColor=ge.getParameter(ge.COLOR_CLEAR_VALUE),ge.clearColor=function(Se,We,Ke,mt){W.clearColor[0]=Se,W.clearColor[1]=We,W.clearColor[2]=Ke,W.clearColor[3]=mt,W.realClearColor.call(ge,Se,We,Ke,mt)},this.viewport=ge.getParameter(ge.VIEWPORT),ge.viewport=function(Se,We,Ke,mt){W.viewport[0]=Se,W.viewport[1]=We,W.viewport[2]=Ke,W.viewport[3]=mt,W.realViewport.call(ge,Se,We,Ke,mt)},this.isPatched=!0,hi(ue)}},yi.prototype.unpatch=function(){if(this.isPatched){var W=this.gl,ue=this.gl.canvas;Q()||(Object.defineProperty(ue,"width",this.realCanvasWidth),Object.defineProperty(ue,"height",this.realCanvasHeight)),ue.width=this.bufferWidth,ue.height=this.bufferHeight,W.bindFramebuffer=this.realBindFramebuffer,W.enable=this.realEnable,W.disable=this.realDisable,W.colorMask=this.realColorMask,W.clearColor=this.realClearColor,W.viewport=this.realViewport,this.lastBoundFramebuffer==this.framebuffer&&W.bindFramebuffer(W.FRAMEBUFFER,null),this.isPatched=!1,setTimeout(function(){hi(ue)},1)}},yi.prototype.setTextureBounds=function(W,ue){W||(W=[0,0,.5,1]),ue||(ue=[.5,0,.5,1]),this.viewportOffsetScale[0]=W[0],this.viewportOffsetScale[1]=W[1],this.viewportOffsetScale[2]=W[2],this.viewportOffsetScale[3]=W[3],this.viewportOffsetScale[4]=ue[0],this.viewportOffsetScale[5]=ue[1],this.viewportOffsetScale[6]=ue[2],this.viewportOffsetScale[7]=ue[3]},yi.prototype.submitFrame=function(){var W=this.gl,ue=this,ge=[];if(this.dirtySubmitFrameBindings||ge.push(W.CURRENT_PROGRAM,W.ARRAY_BUFFER_BINDING,W.ELEMENT_ARRAY_BUFFER_BINDING,W.TEXTURE_BINDING_2D,W.TEXTURE0),Pt(W,ge,function(We){ue.realBindFramebuffer.call(We,We.FRAMEBUFFER,null);var Ke=0,mt=0;ue.instanceExt&&(Ke=We.getVertexAttrib(ue.attribs.position,ue.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE),mt=We.getVertexAttrib(ue.attribs.texCoord,ue.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE)),ue.cullFace&&ue.realDisable.call(We,We.CULL_FACE),ue.depthTest&&ue.realDisable.call(We,We.DEPTH_TEST),ue.blend&&ue.realDisable.call(We,We.BLEND),ue.scissorTest&&ue.realDisable.call(We,We.SCISSOR_TEST),ue.stencilTest&&ue.realDisable.call(We,We.STENCIL_TEST),ue.realColorMask.call(We,!0,!0,!0,!0),ue.realViewport.call(We,0,0,We.drawingBufferWidth,We.drawingBufferHeight),(ue.ctxAttribs.alpha||Q())&&(ue.realClearColor.call(We,0,0,0,1),We.clear(We.COLOR_BUFFER_BIT)),We.useProgram(ue.program),We.bindBuffer(We.ELEMENT_ARRAY_BUFFER,ue.indexBuffer),We.bindBuffer(We.ARRAY_BUFFER,ue.vertexBuffer),We.enableVertexAttribArray(ue.attribs.position),We.enableVertexAttribArray(ue.attribs.texCoord),We.vertexAttribPointer(ue.attribs.position,2,We.FLOAT,!1,20,0),We.vertexAttribPointer(ue.attribs.texCoord,3,We.FLOAT,!1,20,8),ue.instanceExt&&(Ke!=0&&ue.instanceExt.vertexAttribDivisorANGLE(ue.attribs.position,0),mt!=0&&ue.instanceExt.vertexAttribDivisorANGLE(ue.attribs.texCoord,0)),We.activeTexture(We.TEXTURE0),We.uniform1i(ue.uniforms.diffuse,0),We.bindTexture(We.TEXTURE_2D,ue.renderTarget),We.uniform4fv(ue.uniforms.viewportOffsetScale,ue.viewportOffsetScale),We.drawElements(We.TRIANGLES,ue.indexCount,We.UNSIGNED_SHORT,0),ue.cardboardUI&&ue.cardboardUI.renderNoState(),ue.realBindFramebuffer.call(ue.gl,We.FRAMEBUFFER,ue.framebuffer),ue.ctxAttribs.preserveDrawingBuffer||(ue.realClearColor.call(We,0,0,0,0),We.clear(We.COLOR_BUFFER_BIT)),ue.dirtySubmitFrameBindings||ue.realBindFramebuffer.call(We,We.FRAMEBUFFER,ue.lastBoundFramebuffer),ue.cullFace&&ue.realEnable.call(We,We.CULL_FACE),ue.depthTest&&ue.realEnable.call(We,We.DEPTH_TEST),ue.blend&&ue.realEnable.call(We,We.BLEND),ue.scissorTest&&ue.realEnable.call(We,We.SCISSOR_TEST),ue.stencilTest&&ue.realEnable.call(We,We.STENCIL_TEST),ue.realColorMask.apply(We,ue.colorMask),ue.realViewport.apply(We,ue.viewport),(ue.ctxAttribs.alpha||!ue.ctxAttribs.preserveDrawingBuffer)&&ue.realClearColor.apply(We,ue.clearColor),ue.instanceExt&&(Ke!=0&&ue.instanceExt.vertexAttribDivisorANGLE(ue.attribs.position,Ke),mt!=0&&ue.instanceExt.vertexAttribDivisorANGLE(ue.attribs.texCoord,mt))}),Q()){var Se=W.canvas;(Se.width!=ue.bufferWidth||Se.height!=ue.bufferHeight)&&(ue.bufferWidth=Se.width,ue.bufferHeight=Se.height,ue.onResize())}},yi.prototype.updateDeviceInfo=function(W){var ue=this.gl,ge=this,Se=[ue.ARRAY_BUFFER_BINDING,ue.ELEMENT_ARRAY_BUFFER_BINDING];Pt(ue,Se,function(We){var Ke=ge.computeMeshVertices_(ge.meshWidth,ge.meshHeight,W);if(We.bindBuffer(We.ARRAY_BUFFER,ge.vertexBuffer),We.bufferData(We.ARRAY_BUFFER,Ke,We.STATIC_DRAW),!ge.indexCount){var mt=ge.computeMeshIndices_(ge.meshWidth,ge.meshHeight);We.bindBuffer(We.ELEMENT_ARRAY_BUFFER,ge.indexBuffer),We.bufferData(We.ELEMENT_ARRAY_BUFFER,mt,We.STATIC_DRAW),ge.indexCount=mt.length}})},yi.prototype.computeMeshVertices_=function(W,ue,ge){for(var Se=new Float32Array(2*W*ue*5),We=ge.getLeftEyeVisibleTanAngles(),Ke=ge.getLeftEyeNoLensTanAngles(),mt=ge.getLeftEyeVisibleScreenRect(Ke),he=0,le=0;le<2;le++){for(var de=0;de<ue;de++)for(var be=0;be<W;be++,he++){var Ee=be/(W-1),at=de/(ue-1),St=Ee,Qt=at,si=J(We[0],We[2],Ee),vi=J(We[3],We[1],at),Xt=Math.sqrt(si*si+vi*vi),Li=ge.distortion.distortInverse(Xt),vr=si*Li/Xt,pr=vi*Li/Xt;Ee=(vr-Ke[0])/(Ke[2]-Ke[0]),at=(pr-Ke[3])/(Ke[1]-Ke[3]),Ee=(mt.x+Ee*mt.width-.5)*2,at=(mt.y+at*mt.height-.5)*2,Se[he*5+0]=Ee,Se[he*5+1]=at,Se[he*5+2]=St,Se[he*5+3]=Qt,Se[he*5+4]=le}var fr=We[2]-We[0];We[0]=-(fr+We[0]),We[2]=fr-We[2],fr=Ke[2]-Ke[0],Ke[0]=-(fr+Ke[0]),Ke[2]=fr-Ke[2],mt.x=1-(mt.x+mt.width)}return Se},yi.prototype.computeMeshIndices_=function(W,ue){for(var ge=new Uint16Array(2*(W-1)*(ue-1)*6),Se=W/2,We=ue/2,Ke=0,mt=0,he=0;he<2;he++)for(var le=0;le<ue;le++)for(var de=0;de<W;de++,Ke++)de==0||le==0||(de<=Se==le<=We?(ge[mt++]=Ke,ge[mt++]=Ke-W-1,ge[mt++]=Ke-W,ge[mt++]=Ke-W-1,ge[mt++]=Ke,ge[mt++]=Ke-1):(ge[mt++]=Ke-1,ge[mt++]=Ke-W,ge[mt++]=Ke,ge[mt++]=Ke-W,ge[mt++]=Ke-1,ge[mt++]=Ke-W-1));return ge},yi.prototype.getOwnPropertyDescriptor_=function(W,ue){var ge=Object.getOwnPropertyDescriptor(W,ue);return(ge.get===void 0||ge.set===void 0)&&(ge.configurable=!0,ge.enumerable=!0,ge.get=function(){return this.getAttribute(ue)},ge.set=function(Se){this.setAttribute(ue,Se)}),ge};var vt=["attribute vec2 position;","uniform mat4 projectionMat;","void main() {","  gl_Position = projectionMat * vec4( position, -1.0, 1.0 );","}"].join(`
`),ye=["precision mediump float;","uniform vec4 color;","void main() {","  gl_FragColor = color;","}"].join(`
`),ve=Math.PI/180,Ne=60,Te=12,ke=20,Oe=1,U=.75,$=.3125,re=4,Re=28,ce=1.5;function Ue(W){this.gl=W,this.attribs={position:0},this.program=qt(W,vt,ye,this.attribs),this.uniforms=yt(W,this.program),this.vertexBuffer=W.createBuffer(),this.gearOffset=0,this.gearVertexCount=0,this.arrowOffset=0,this.arrowVertexCount=0,this.projMat=new Float32Array(16),this.listener=null,this.onResize()}Ue.prototype.destroy=function(){var W=this.gl;this.listener&&W.canvas.removeEventListener("click",this.listener,!1),W.deleteProgram(this.program),W.deleteBuffer(this.vertexBuffer)},Ue.prototype.listen=function(W,ue){var ge=this.gl.canvas;this.listener=function(Se){var We=ge.clientWidth/2,Ke=Re*ce;Se.clientX>We-Ke&&Se.clientX<We+Ke&&Se.clientY>ge.clientHeight-Ke?W(Se):Se.clientX<Ke&&Se.clientY<Ke&&ue(Se)},ge.addEventListener("click",this.listener,!1)},Ue.prototype.onResize=function(){var W=this.gl,ue=this,ge=[W.ARRAY_BUFFER_BINDING];Pt(W,ge,function(Se){var We=[],Ke=Se.drawingBufferWidth/2,mt=Math.max(screen.width,screen.height)*window.devicePixelRatio,he=Se.drawingBufferWidth/mt,le=he*window.devicePixelRatio,de=re*le/2,be=Re*ce*le,Ee=Re*le/2,at=(Re*ce-Re)*le;We.push(Ke-de,be),We.push(Ke-de,Se.drawingBufferHeight),We.push(Ke+de,be),We.push(Ke+de,Se.drawingBufferHeight),ue.gearOffset=We.length/2;function St(Li,vr){var pr=(90-Li)*ve,fr=Math.cos(pr),Qi=Math.sin(pr);We.push($*fr*Ee+Ke,$*Qi*Ee+Ee),We.push(vr*fr*Ee+Ke,vr*Qi*Ee+Ee)}for(var Qt=0;Qt<=6;Qt++){var si=Qt*Ne;St(si,Oe),St(si+Te,Oe),St(si+ke,U),St(si+(Ne-ke),U),St(si+(Ne-Te),Oe)}ue.gearVertexCount=We.length/2-ue.gearOffset,ue.arrowOffset=We.length/2;function vi(Li,vr){We.push(at+Li,Se.drawingBufferHeight-at-vr)}var Xt=de/Math.sin(45*ve);vi(0,Ee),vi(Ee,0),vi(Ee+Xt,Xt),vi(Xt,Ee+Xt),vi(Xt,Ee-Xt),vi(0,Ee),vi(Ee,Ee*2),vi(Ee+Xt,Ee*2-Xt),vi(Xt,Ee-Xt),vi(0,Ee),vi(Xt,Ee-de),vi(Re*le,Ee-de),vi(Xt,Ee+de),vi(Re*le,Ee+de),ue.arrowVertexCount=We.length/2-ue.arrowOffset,Se.bindBuffer(Se.ARRAY_BUFFER,ue.vertexBuffer),Se.bufferData(Se.ARRAY_BUFFER,new Float32Array(We),Se.STATIC_DRAW)})},Ue.prototype.render=function(){var W=this.gl,ue=this,ge=[W.CULL_FACE,W.DEPTH_TEST,W.BLEND,W.SCISSOR_TEST,W.STENCIL_TEST,W.COLOR_WRITEMASK,W.VIEWPORT,W.CURRENT_PROGRAM,W.ARRAY_BUFFER_BINDING];Pt(W,ge,function(Se){Se.disable(Se.CULL_FACE),Se.disable(Se.DEPTH_TEST),Se.disable(Se.BLEND),Se.disable(Se.SCISSOR_TEST),Se.disable(Se.STENCIL_TEST),Se.colorMask(!0,!0,!0,!0),Se.viewport(0,0,Se.drawingBufferWidth,Se.drawingBufferHeight),ue.renderNoState()})},Ue.prototype.renderNoState=function(){var W=this.gl;W.useProgram(this.program),W.bindBuffer(W.ARRAY_BUFFER,this.vertexBuffer),W.enableVertexAttribArray(this.attribs.position),W.vertexAttribPointer(this.attribs.position,2,W.FLOAT,!1,8,0),W.uniform4f(this.uniforms.color,1,1,1,1),Ei(this.projMat,0,W.drawingBufferWidth,0,W.drawingBufferHeight,.1,1024),W.uniformMatrix4fv(this.uniforms.projectionMat,!1,this.projMat),W.drawArrays(W.TRIANGLE_STRIP,0,4),W.drawArrays(W.TRIANGLE_STRIP,this.gearOffset,this.gearVertexCount),W.drawArrays(W.TRIANGLE_STRIP,this.arrowOffset,this.arrowVertexCount)};function je(W){this.coefficients=W}je.prototype.distortInverse=function(W){for(var ue=0,ge=1,Se=W-this.distort(ue);Math.abs(ge-ue)>1e-4;){var We=W-this.distort(ge),Ke=ge-We*((ge-ue)/(We-Se));ue=ge,ge=Ke,Se=We}return ge},je.prototype.distort=function(W){for(var ue=W*W,ge=0,Se=0;Se<this.coefficients.length;Se++)ge=ue*(ge+this.coefficients[Se]);return(ge+1)*W};var pt=Math.PI/180,Lt=180/Math.PI,xt=function(W,ue,ge){this.x=W||0,this.y=ue||0,this.z=ge||0};xt.prototype={constructor:xt,set:function(W,ue,ge){return this.x=W,this.y=ue,this.z=ge,this},copy:function(W){return this.x=W.x,this.y=W.y,this.z=W.z,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var W=this.length();if(W!==0){var ue=1/W;this.multiplyScalar(ue)}else this.x=0,this.y=0,this.z=0;return this},multiplyScalar:function(W){this.x*=W,this.y*=W,this.z*=W},applyQuaternion:function(W){var ue=this.x,ge=this.y,Se=this.z,We=W.x,Ke=W.y,mt=W.z,he=W.w,le=he*ue+Ke*Se-mt*ge,de=he*ge+mt*ue-We*Se,be=he*Se+We*ge-Ke*ue,Ee=-We*ue-Ke*ge-mt*Se;return this.x=le*he+Ee*-We+de*-mt-be*-Ke,this.y=de*he+Ee*-Ke+be*-We-le*-mt,this.z=be*he+Ee*-mt+le*-Ke-de*-We,this},dot:function(W){return this.x*W.x+this.y*W.y+this.z*W.z},crossVectors:function(W,ue){var ge=W.x,Se=W.y,We=W.z,Ke=ue.x,mt=ue.y,he=ue.z;return this.x=Se*he-We*mt,this.y=We*Ke-ge*he,this.z=ge*mt-Se*Ke,this}};var Gt=function(W,ue,ge,Se){this.x=W||0,this.y=ue||0,this.z=ge||0,this.w=Se!==void 0?Se:1};Gt.prototype={constructor:Gt,set:function(W,ue,ge,Se){return this.x=W,this.y=ue,this.z=ge,this.w=Se,this},copy:function(W){return this.x=W.x,this.y=W.y,this.z=W.z,this.w=W.w,this},setFromEulerXYZ:function(W,ue,ge){var Se=Math.cos(W/2),We=Math.cos(ue/2),Ke=Math.cos(ge/2),mt=Math.sin(W/2),he=Math.sin(ue/2),le=Math.sin(ge/2);return this.x=mt*We*Ke+Se*he*le,this.y=Se*he*Ke-mt*We*le,this.z=Se*We*le+mt*he*Ke,this.w=Se*We*Ke-mt*he*le,this},setFromEulerYXZ:function(W,ue,ge){var Se=Math.cos(W/2),We=Math.cos(ue/2),Ke=Math.cos(ge/2),mt=Math.sin(W/2),he=Math.sin(ue/2),le=Math.sin(ge/2);return this.x=mt*We*Ke+Se*he*le,this.y=Se*he*Ke-mt*We*le,this.z=Se*We*le-mt*he*Ke,this.w=Se*We*Ke+mt*he*le,this},setFromAxisAngle:function(W,ue){var ge=ue/2,Se=Math.sin(ge);return this.x=W.x*Se,this.y=W.y*Se,this.z=W.z*Se,this.w=Math.cos(ge),this},multiply:function(W){return this.multiplyQuaternions(this,W)},multiplyQuaternions:function(W,ue){var ge=W.x,Se=W.y,We=W.z,Ke=W.w,mt=ue.x,he=ue.y,le=ue.z,de=ue.w;return this.x=ge*de+Ke*mt+Se*le-We*he,this.y=Se*de+Ke*he+We*mt-ge*le,this.z=We*de+Ke*le+ge*he-Se*mt,this.w=Ke*de-ge*mt-Se*he-We*le,this},inverse:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.normalize(),this},normalize:function(){var W=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return W===0?(this.x=0,this.y=0,this.z=0,this.w=1):(W=1/W,this.x=this.x*W,this.y=this.y*W,this.z=this.z*W,this.w=this.w*W),this},slerp:function(W,ue){if(ue===0)return this;if(ue===1)return this.copy(W);var ge=this.x,Se=this.y,We=this.z,Ke=this.w,mt=Ke*W.w+ge*W.x+Se*W.y+We*W.z;if(mt<0?(this.w=-W.w,this.x=-W.x,this.y=-W.y,this.z=-W.z,mt=-mt):this.copy(W),mt>=1)return this.w=Ke,this.x=ge,this.y=Se,this.z=We,this;var he=Math.acos(mt),le=Math.sqrt(1-mt*mt);if(Math.abs(le)<.001)return this.w=.5*(Ke+this.w),this.x=.5*(ge+this.x),this.y=.5*(Se+this.y),this.z=.5*(We+this.z),this;var de=Math.sin((1-ue)*he)/le,be=Math.sin(ue*he)/le;return this.w=Ke*de+this.w*be,this.x=ge*de+this.x*be,this.y=Se*de+this.y*be,this.z=We*de+this.z*be,this},setFromUnitVectors:function(){var W,ue,ge=1e-6;return function(Se,We){return W===void 0&&(W=new xt),ue=Se.dot(We)+1,ue<ge?(ue=0,Math.abs(Se.x)>Math.abs(Se.z)?W.set(-Se.y,Se.x,0):W.set(0,-Se.z,Se.y)):W.crossVectors(Se,We),this.x=W.x,this.y=W.y,this.z=W.z,this.w=ue,this.normalize(),this}}()};function mi(W){this.width=W.width||Xe(),this.height=W.height||Je(),this.widthMeters=W.widthMeters,this.heightMeters=W.heightMeters,this.bevelMeters=W.bevelMeters}var _r=new mi({widthMeters:.11,heightMeters:.062,bevelMeters:.004}),Fi=new mi({widthMeters:.1038,heightMeters:.0584,bevelMeters:.004}),gn={CardboardV1:new nn({id:"CardboardV1",label:"Cardboard I/O 2014",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]}),CardboardV2:new nn({id:"CardboardV2",label:"Cardboard I/O 2015",fov:60,interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-.0009904169,6183535e-11,-16981803e-13]})};function kr(W,ue){this.viewer=gn.CardboardV2,this.updateDeviceParams(W),this.distortion=new je(this.viewer.distortionCoefficients);for(var ge=0;ge<ue.length;ge++){var Se=ue[ge];gn[Se.id]=new nn(Se)}}kr.prototype.updateDeviceParams=function(W){this.device=this.determineDevice_(W)||this.device},kr.prototype.getDevice=function(){return this.device},kr.prototype.setViewer=function(W){this.viewer=W,this.distortion=new je(this.viewer.distortionCoefficients)},kr.prototype.determineDevice_=function(W){if(!W)return Q()?(console.warn("Using fallback iOS device measurements."),Fi):(console.warn("Using fallback Android device measurements."),_r);var ue=.0254,ge=ue/W.xdpi,Se=ue/W.ydpi,We=Xe(),Ke=Je();return new mi({widthMeters:ge*We,heightMeters:Se*Ke,bevelMeters:W.bevelMm*.001})},kr.prototype.getDistortedFieldOfViewLeftEye=function(){var W=this.viewer,ue=this.device,ge=this.distortion,Se=W.screenLensDistance,We=(ue.widthMeters-W.interLensDistance)/2,Ke=W.interLensDistance/2,mt=W.baselineLensDistance-ue.bevelMeters,he=ue.heightMeters-mt,le=Lt*Math.atan(ge.distort(We/Se)),de=Lt*Math.atan(ge.distort(Ke/Se)),be=Lt*Math.atan(ge.distort(mt/Se)),Ee=Lt*Math.atan(ge.distort(he/Se));return{leftDegrees:Math.min(le,W.fov),rightDegrees:Math.min(de,W.fov),downDegrees:Math.min(be,W.fov),upDegrees:Math.min(Ee,W.fov)}},kr.prototype.getLeftEyeVisibleTanAngles=function(){var W=this.viewer,ue=this.device,ge=this.distortion,Se=Math.tan(-pt*W.fov),We=Math.tan(pt*W.fov),Ke=Math.tan(pt*W.fov),mt=Math.tan(-pt*W.fov),he=ue.widthMeters/4,le=ue.heightMeters/2,de=W.baselineLensDistance-ue.bevelMeters-le,be=W.interLensDistance/2-he,Ee=-de,at=W.screenLensDistance,St=ge.distort((be-he)/at),Qt=ge.distort((Ee+le)/at),si=ge.distort((be+he)/at),vi=ge.distort((Ee-le)/at),Xt=new Float32Array(4);return Xt[0]=Math.max(Se,St),Xt[1]=Math.min(We,Qt),Xt[2]=Math.min(Ke,si),Xt[3]=Math.max(mt,vi),Xt},kr.prototype.getLeftEyeNoLensTanAngles=function(){var W=this.viewer,ue=this.device,ge=this.distortion,Se=new Float32Array(4),We=ge.distortInverse(Math.tan(-pt*W.fov)),Ke=ge.distortInverse(Math.tan(pt*W.fov)),mt=ge.distortInverse(Math.tan(pt*W.fov)),he=ge.distortInverse(Math.tan(-pt*W.fov)),le=ue.widthMeters/4,de=ue.heightMeters/2,be=W.baselineLensDistance-ue.bevelMeters-de,Ee=W.interLensDistance/2-le,at=-be,St=W.screenLensDistance,Qt=(Ee-le)/St,si=(at+de)/St,vi=(Ee+le)/St,Xt=(at-de)/St;return Se[0]=Math.max(We,Qt),Se[1]=Math.min(Ke,si),Se[2]=Math.min(mt,vi),Se[3]=Math.max(he,Xt),Se},kr.prototype.getLeftEyeVisibleScreenRect=function(W){var ue=this.viewer,ge=this.device,Se=ue.screenLensDistance,We=(ge.widthMeters-ue.interLensDistance)/2,Ke=ue.baselineLensDistance-ge.bevelMeters,mt=(W[0]*Se+We)/ge.widthMeters,he=(W[1]*Se+Ke)/ge.heightMeters,le=(W[2]*Se+We)/ge.widthMeters,de=(W[3]*Se+Ke)/ge.heightMeters;return{x:mt,y:de,width:le-mt,height:he-de}},kr.prototype.getFieldOfViewLeftEye=function(W){return W?this.getUndistortedFieldOfViewLeftEye():this.getDistortedFieldOfViewLeftEye()},kr.prototype.getFieldOfViewRightEye=function(W){var ue=this.getFieldOfViewLeftEye(W);return{leftDegrees:ue.rightDegrees,rightDegrees:ue.leftDegrees,upDegrees:ue.upDegrees,downDegrees:ue.downDegrees}},kr.prototype.getUndistortedFieldOfViewLeftEye=function(){var W=this.getUndistortedParams_();return{leftDegrees:Lt*Math.atan(W.outerDist),rightDegrees:Lt*Math.atan(W.innerDist),downDegrees:Lt*Math.atan(W.bottomDist),upDegrees:Lt*Math.atan(W.topDist)}},kr.prototype.getUndistortedViewportLeftEye=function(){var W=this.getUndistortedParams_(),ue=this.viewer,ge=this.device,Se=ue.screenLensDistance,We=ge.widthMeters/Se,Ke=ge.heightMeters/Se,mt=ge.width/We,he=ge.height/Ke,le=Math.round((W.eyePosX-W.outerDist)*mt),de=Math.round((W.eyePosY-W.bottomDist)*he);return{x:le,y:de,width:Math.round((W.eyePosX+W.innerDist)*mt)-le,height:Math.round((W.eyePosY+W.topDist)*he)-de}},kr.prototype.getUndistortedParams_=function(){var W=this.viewer,ue=this.device,ge=this.distortion,Se=W.screenLensDistance,We=W.interLensDistance/2/Se,Ke=ue.widthMeters/Se,mt=ue.heightMeters/Se,he=Ke/2-We,le=(W.baselineLensDistance-ue.bevelMeters)/Se,de=W.fov,be=ge.distortInverse(Math.tan(pt*de)),Ee=Math.min(he,be),at=Math.min(We,be),St=Math.min(le,be),Qt=Math.min(mt-le,be);return{outerDist:Ee,innerDist:at,topDist:Qt,bottomDist:St,eyePosX:he,eyePosY:le}};function nn(W){this.id=W.id,this.label=W.label,this.fov=W.fov,this.interLensDistance=W.interLensDistance,this.baselineLensDistance=W.baselineLensDistance,this.screenLensDistance=W.screenLensDistance,this.distortionCoefficients=W.distortionCoefficients,this.inverseCoefficients=W.inverseCoefficients}kr.Viewers=gn;var vs=1,An="2019-11-09T17:36:14Z",Ns=[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X00PD/*"},{ua:"ASUS_X00PD"}],dpi:245,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X008D/*"},{ua:"ASUS_X008D"}],dpi:282,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2 XL/*"},{ua:"Pixel 2 XL"}],dpi:537.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3 XL/*"},{ua:"Pixel 3 XL"}],dpi:[558.5,553.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel XL/*"},{ua:"Pixel XL"}],dpi:[537.9,533],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3/*"},{ua:"Pixel 3"}],dpi:442.4,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2/*"},{ua:"Pixel 2"}],dpi:441,bw:3,ac:500},{type:"android",rules:[{mdmh:"Google/*/Pixel/*"},{ua:"Pixel"}],dpi:[432.6,436.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/BLN-L24/*"},{ua:"HONORBLN-L24"}],dpi:480,bw:4,ac:500},{type:"android",rules:[{mdmh:"Huawei/*/BKL-L09/*"},{ua:"BKL-L09"}],dpi:403,bw:3.47,ac:500},{type:"android",rules:[{mdmh:"LENOVO/*/Lenovo PB2-690Y/*"},{ua:"Lenovo PB2-690Y"}],dpi:[457.2,454.713],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},{ua:"VS985 4G"}],dpi:[537.9,535.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,401.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/G5/*"},{ua:"Moto G (5) Plus"}],dpi:[403.4,403],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},{ua:"XT830C"}],dpi:[254,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,327.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,316.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/G4/*"},{ua:"Moto G (4)"}],dpi:401,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1001/*"},{ua:"ONE E1001"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1003/*"},{ua:"ONE E1003"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2001/*"},{ua:"ONE A2001"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2003/*"},{ua:"ONE A2003"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3000/*"},{ua:"ONEPLUS A3000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3003/*"},{ua:"ONEPLUS A3003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3010/*"},{ua:"ONEPLUS A3010"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A5000/*"},{ua:"ONEPLUS A5000 "}],dpi:[403.411,399.737],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A5010/*"},{ua:"ONEPLUS A5010"}],dpi:[403,400],bw:2,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6000/*"},{ua:"ONEPLUS A6000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6003/*"},{ua:"ONEPLUS A6003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6010/*"},{ua:"ONEPLUS A6010"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6013/*"},{ua:"ONEPLUS A6013"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],dpi:[442.4,444.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},{ua:"GT-I9082"}],dpi:[184.7,185.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],dpi:[196.7,205.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],dpi:[217.7,231.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SGH-M919/*"},{ua:"SGH-M919"}],dpi:[440.8,437.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,136.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920P/*"},{ua:"SM-N920P"}],dpi:[386.3655,390.144],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920W8/*"},{ua:"SM-N920W8"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],dpi:285.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],dpi:[217.7,204.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G930F/*"},{ua:"SM-G930F"}],dpi:576.6,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G935F/*"},{ua:"SM-G935F"}],dpi:533,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G950F/*"},{ua:"SM-G950F"}],dpi:[562.707,565.293],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955U/*"},{ua:"SM-G955U"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955F/*"},{ua:"SM-G955F"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G960F/*"},{ua:"SM-G960F"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9600/*"},{ua:"SM-G9600"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960T/*"},{ua:"SM-G960T"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960N/*"},{ua:"SM-G960N"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960U/*"},{ua:"SM-G960U"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9608/*"},{ua:"SM-G9608"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960FD/*"},{ua:"SM-G960FD"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960W/*"},{ua:"SM-G960W"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G965F/*"},{ua:"SM-G965F"}],dpi:529,bw:2,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],dpi:[428.6,427.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],dpi:[480,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Fly/*/IQ4412/*"},{ua:"IQ4412"}],dpi:307.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"BENEVE/*/VR518/*"},{ua:"VR518"}],dpi:480,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1e3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1e3},{type:"ios",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2001]}],dpi:[410.9,415.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2436]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/EML-L29/*"},{ua:"EML-L29"}],dpi:428,bw:3.45,ac:500},{type:"android",rules:[{mdmh:"Nokia/*/Nokia 7.1/*"},{ua:"Nokia 7.1"}],dpi:[432,431.9],bw:3,ac:500},{type:"ios",rules:[{res:[1242,2688]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G570M/*"},{ua:"SM-G570M"}],dpi:320,bw:3.684,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G970F/*"},{ua:"SM-G970F"}],dpi:438,bw:2.281,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G973F/*"},{ua:"SM-G973F"}],dpi:550,bw:2.002,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G975F/*"},{ua:"SM-G975F"}],dpi:522,bw:2.054,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G977F/*"},{ua:"SM-G977F"}],dpi:505,bw:2.334,ac:500},{type:"ios",rules:[{res:[828,1792]}],dpi:326,bw:5,ac:500}],ts={format:vs,last_updated:An,devices:Ns};function bs(W,ue){if(this.dpdb=ts,this.recalculateDeviceParams_(),W){this.onDeviceParamsUpdated=ue;var ge=new XMLHttpRequest,Se=this;ge.open("GET",W,!0),ge.addEventListener("load",function(){Se.loading=!1,ge.status>=200&&ge.status<=299?(Se.dpdb=JSON.parse(ge.response),Se.recalculateDeviceParams_()):console.error("Error loading online DPDB!")}),ge.send()}}bs.prototype.getDeviceParams=function(){return this.deviceParams},bs.prototype.recalculateDeviceParams_=function(){var W=this.calcDeviceParams_();W?(this.deviceParams=W,this.onDeviceParamsUpdated&&this.onDeviceParamsUpdated(this.deviceParams)):console.error("Failed to recalculate device parameters.")},bs.prototype.calcDeviceParams_=function(){var W=this.dpdb;if(!W)return console.error("DPDB not available."),null;if(W.format!=1)return console.error("DPDB has unexpected format version."),null;if(!W.devices||!W.devices.length)return console.error("DPDB does not have a devices section."),null;var ue=navigator.userAgent||navigator.vendor||window.opera,ge=Xe(),Se=Je();if(!W.devices)return console.error("DPDB has no devices section."),null;for(var We=0;We<W.devices.length;We++){var Ke=W.devices[We];if(!Ke.rules){console.warn("Device["+We+"] has no rules section.");continue}if(Ke.type!="ios"&&Ke.type!="android"){console.warn("Device["+We+"] has invalid type.");continue}if(Q()==(Ke.type=="ios")){for(var mt=!1,he=0;he<Ke.rules.length;he++){var le=Ke.rules[he];if(this.ruleMatches_(le,ue,ge,Se)){mt=!0;break}}if(mt){var de=Ke.dpi[0]||Ke.dpi,be=Ke.dpi[1]||Ke.dpi;return new pe({xdpi:de,ydpi:be,bevelMm:Ke.bw})}}}return console.warn("No DPDB device match."),null},bs.prototype.ruleMatches_=function(W,ue,ge,Se){if(!W.ua&&!W.res||(W.ua&&W.ua.substring(0,2)==="SM"&&(W.ua=W.ua.substring(0,7)),W.ua&&ue.indexOf(W.ua)<0))return!1;if(W.res){if(!W.res[0]||!W.res[1])return!1;var We=W.res[0],Ke=W.res[1];if(Math.min(ge,Se)!=Math.min(We,Ke)||Math.max(ge,Se)!=Math.max(We,Ke))return!1}return!0};function pe(W){this.xdpi=W.xdpi,this.ydpi=W.ydpi,this.bevelMm=W.bevelMm}function ct(W,ue){this.set(W,ue)}ct.prototype.set=function(W,ue){this.sample=W,this.timestampS=ue},ct.prototype.copy=function(W){this.set(W.sample,W.timestampS)};function Tt(W,ue){this.kFilter=W,this.isDebug=ue,this.currentAccelMeasurement=new ct,this.currentGyroMeasurement=new ct,this.previousGyroMeasurement=new ct,Q()?this.filterQ=new Gt(-1,0,0,1):this.filterQ=new Gt(1,0,0,1),this.previousFilterQ=new Gt,this.previousFilterQ.copy(this.filterQ),this.accelQ=new Gt,this.isOrientationInitialized=!1,this.estimatedGravity=new xt,this.measuredGravity=new xt,this.gyroIntegralQ=new Gt}Tt.prototype.addAccelMeasurement=function(W,ue){this.currentAccelMeasurement.set(W,ue)},Tt.prototype.addGyroMeasurement=function(W,ue){this.currentGyroMeasurement.set(W,ue);var ge=ue-this.previousGyroMeasurement.timestampS;Pe(ge)&&this.run_(),this.previousGyroMeasurement.copy(this.currentGyroMeasurement)},Tt.prototype.run_=function(){if(!this.isOrientationInitialized){this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),this.previousFilterQ.copy(this.accelQ),this.isOrientationInitialized=!0;return}var W=this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS,ue=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,W);this.gyroIntegralQ.multiply(ue),this.filterQ.copy(this.previousFilterQ),this.filterQ.multiply(ue);var ge=new Gt;ge.copy(this.filterQ),ge.inverse(),this.estimatedGravity.set(0,0,-1),this.estimatedGravity.applyQuaternion(ge),this.estimatedGravity.normalize(),this.measuredGravity.copy(this.currentAccelMeasurement.sample),this.measuredGravity.normalize();var Se=new Gt;Se.setFromUnitVectors(this.estimatedGravity,this.measuredGravity),Se.inverse(),this.isDebug&&console.log("Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)",Lt*Vi(Se),this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1));var We=new Gt;We.copy(this.filterQ),We.multiply(Se),this.filterQ.slerp(We,1-this.kFilter),this.previousFilterQ.copy(this.filterQ)},Tt.prototype.getOrientation=function(){return this.filterQ},Tt.prototype.accelToQuaternion_=function(W){var ue=new xt;ue.copy(W),ue.normalize();var ge=new Gt;return ge.setFromUnitVectors(new xt(0,0,-1),ue),ge.inverse(),ge},Tt.prototype.gyroToQuaternionDelta_=function(W,ue){var ge=new Gt,Se=new xt;return Se.copy(W),Se.normalize(),ge.setFromAxisAngle(Se,W.length()*ue),ge};function Jt(W,ue){this.predictionTimeS=W,this.isDebug=ue,this.previousQ=new Gt,this.previousTimestampS=null,this.deltaQ=new Gt,this.outQ=new Gt}Jt.prototype.getPrediction=function(W,ue,ge){if(!this.previousTimestampS)return this.previousQ.copy(W),this.previousTimestampS=ge,W;var Se=new xt;Se.copy(ue),Se.normalize();var We=ue.length();if(We<pt*20)return this.isDebug&&console.log("Moving slowly, at %s deg/s: no prediction",(Lt*We).toFixed(1)),this.outQ.copy(W),this.previousQ.copy(W),this.outQ;var Ke=We*this.predictionTimeS;return this.deltaQ.setFromAxisAngle(Se,Ke),this.outQ.copy(this.previousQ),this.outQ.multiply(this.deltaQ),this.previousQ.copy(W),this.previousTimestampS=ge,this.outQ};function Ni(W,ue,ge,Se){this.yawOnly=ge,this.accelerometer=new xt,this.gyroscope=new xt,this.filter=new Tt(W,Se),this.posePredictor=new Jt(ue,Se),this.isFirefoxAndroid=te(),this.isIOS=Q();var We=K();this.isDeviceMotionInRadians=!this.isIOS&&We&&We<66,this.isWithoutDeviceMotion=Ae()||ae(),this.filterToWorldQ=new Gt,Q()?this.filterToWorldQ.setFromAxisAngle(new xt(1,0,0),Math.PI/2):this.filterToWorldQ.setFromAxisAngle(new xt(1,0,0),-Math.PI/2),this.inverseWorldToScreenQ=new Gt,this.worldToScreenQ=new Gt,this.originalPoseAdjustQ=new Gt,this.originalPoseAdjustQ.setFromAxisAngle(new xt(0,0,1),-window.orientation*Math.PI/180),this.setScreenTransform_(),me()&&this.filterToWorldQ.multiply(this.inverseWorldToScreenQ),this.resetQ=new Gt,this.orientationOut_=new Float32Array(4),this.start()}Ni.prototype.getPosition=function(){return null},Ni.prototype.getOrientation=function(){var W=void 0;if(this.isWithoutDeviceMotion&&this._deviceOrientationQ){this.deviceOrientationFixQ=this.deviceOrientationFixQ||function(){var We=new Gt().setFromAxisAngle(new xt(0,0,-1),0),Ke=new Gt;return window.orientation===-90?Ke.setFromAxisAngle(new xt(0,1,0),Math.PI/-2):Ke.setFromAxisAngle(new xt(0,1,0),Math.PI/2),We.multiply(Ke)}(),this.deviceOrientationFilterToWorldQ=this.deviceOrientationFilterToWorldQ||function(){var We=new Gt;return We.setFromAxisAngle(new xt(1,0,0),-Math.PI/2),We}(),W=this._deviceOrientationQ;var ge=new Gt;return ge.copy(W),ge.multiply(this.deviceOrientationFilterToWorldQ),ge.multiply(this.resetQ),ge.multiply(this.worldToScreenQ),ge.multiplyQuaternions(this.deviceOrientationFixQ,ge),this.yawOnly&&(ge.x=0,ge.z=0,ge.normalize()),this.orientationOut_[0]=ge.x,this.orientationOut_[1]=ge.y,this.orientationOut_[2]=ge.z,this.orientationOut_[3]=ge.w,this.orientationOut_}else{var ue=this.filter.getOrientation();W=this.posePredictor.getPrediction(ue,this.gyroscope,this.previousTimestampS)}var ge=new Gt;return ge.copy(this.filterToWorldQ),ge.multiply(this.resetQ),ge.multiply(W),ge.multiply(this.worldToScreenQ),this.yawOnly&&(ge.x=0,ge.z=0,ge.normalize()),this.orientationOut_[0]=ge.x,this.orientationOut_[1]=ge.y,this.orientationOut_[2]=ge.z,this.orientationOut_[3]=ge.w,this.orientationOut_},Ni.prototype.resetPose=function(){this.resetQ.copy(this.filter.getOrientation()),this.resetQ.x=0,this.resetQ.y=0,this.resetQ.z*=-1,this.resetQ.normalize(),me()&&this.resetQ.multiply(this.inverseWorldToScreenQ),this.resetQ.multiply(this.originalPoseAdjustQ)},Ni.prototype.onDeviceOrientation_=function(W){this._deviceOrientationQ=this._deviceOrientationQ||new Gt;var ue=W.alpha,ge=W.beta,Se=W.gamma;ue=(ue||0)*Math.PI/180,ge=(ge||0)*Math.PI/180,Se=(Se||0)*Math.PI/180,this._deviceOrientationQ.setFromEulerYXZ(ge,ue,-Se)},Ni.prototype.onDeviceMotion_=function(W){this.updateDeviceMotion_(W)},Ni.prototype.updateDeviceMotion_=function(W){var ue=W.accelerationIncludingGravity,ge=W.rotationRate,Se=W.timeStamp/1e3,We=Se-this.previousTimestampS;if(We<0){Ge("fusion-pose-sensor:invalid:non-monotonic","Invalid timestamps detected: non-monotonic timestamp from devicemotion"),this.previousTimestampS=Se;return}else if(We<=q||We>H){Ge("fusion-pose-sensor:invalid:outside-threshold","Invalid timestamps detected: Timestamp from devicemotion outside expected range."),this.previousTimestampS=Se;return}this.accelerometer.set(-ue.x,-ue.y,-ue.z),ge&&(_e()?this.gyroscope.set(-ge.beta,ge.alpha,ge.gamma):this.gyroscope.set(ge.alpha,ge.beta,ge.gamma),this.isDeviceMotionInRadians||this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addGyroMeasurement(this.gyroscope,Se)),this.filter.addAccelMeasurement(this.accelerometer,Se),this.previousTimestampS=Se},Ni.prototype.onOrientationChange_=function(W){this.setScreenTransform_()},Ni.prototype.onMessage_=function(W){var ue=W.data;if(!(!ue||!ue.type)){var ge=ue.type.toLowerCase();ge==="devicemotion"&&this.updateDeviceMotion_(ue.deviceMotionEvent)}},Ni.prototype.setScreenTransform_=function(){switch(this.worldToScreenQ.set(0,0,0,1),window.orientation){case 0:break;case 90:this.worldToScreenQ.setFromAxisAngle(new xt(0,0,1),-Math.PI/2);break;case-90:this.worldToScreenQ.setFromAxisAngle(new xt(0,0,1),Math.PI/2);break}this.inverseWorldToScreenQ.copy(this.worldToScreenQ),this.inverseWorldToScreenQ.inverse()},Ni.prototype.start=function(){this.onDeviceMotionCallback_=this.onDeviceMotion_.bind(this),this.onOrientationChangeCallback_=this.onOrientationChange_.bind(this),this.onMessageCallback_=this.onMessage_.bind(this),this.onDeviceOrientationCallback_=this.onDeviceOrientation_.bind(this),Q()&&Si()&&window.addEventListener("message",this.onMessageCallback_),window.addEventListener("orientationchange",this.onOrientationChangeCallback_),this.isWithoutDeviceMotion?window.addEventListener("deviceorientation",this.onDeviceOrientationCallback_):window.addEventListener("devicemotion",this.onDeviceMotionCallback_)},Ni.prototype.stop=function(){window.removeEventListener("devicemotion",this.onDeviceMotionCallback_),window.removeEventListener("deviceorientation",this.onDeviceOrientationCallback_),window.removeEventListener("orientationchange",this.onOrientationChangeCallback_),window.removeEventListener("message",this.onMessageCallback_)};var ar=60,Di=new xt(1,0,0),ki=new xt(0,0,1),Ie=new Gt;Ie.setFromAxisAngle(Di,-Math.PI/2),Ie.multiply(new Gt().setFromAxisAngle(ki,Math.PI/2));var se=function(){function W(ue){L(this,W),this.config=ue,this.sensor=null,this.fusionSensor=null,this._out=new Float32Array(4),this.api=null,this.errors=[],this._sensorQ=new Gt,this._outQ=new Gt,this._onSensorRead=this._onSensorRead.bind(this),this._onSensorError=this._onSensorError.bind(this),this.init()}return O(W,[{key:"init",value:function(){var ue=null;try{ue=new RelativeOrientationSensor({frequency:ar,referenceFrame:"screen"}),ue.addEventListener("error",this._onSensorError)}catch(ge){this.errors.push(ge),ge.name==="SecurityError"?(console.error("Cannot construct sensors due to the Feature Policy"),console.warn('Attempting to fall back using "devicemotion"; however this will fail in the future without correct permissions.'),this.useDeviceMotion()):ge.name==="ReferenceError"?this.useDeviceMotion():console.error(ge)}ue&&(this.api="sensor",this.sensor=ue,this.sensor.addEventListener("reading",this._onSensorRead),this.sensor.start())}},{key:"useDeviceMotion",value:function(){this.api="devicemotion",this.fusionSensor=new Ni(this.config.K_FILTER,this.config.PREDICTION_TIME_S,this.config.YAW_ONLY,this.config.DEBUG),this.sensor&&(this.sensor.removeEventListener("reading",this._onSensorRead),this.sensor.removeEventListener("error",this._onSensorError),this.sensor=null)}},{key:"getOrientation",value:function(){if(this.fusionSensor)return this.fusionSensor.getOrientation();if(!this.sensor||!this.sensor.quaternion)return this._out[0]=this._out[1]=this._out[2]=0,this._out[3]=1,this._out;var ue=this.sensor.quaternion;this._sensorQ.set(ue[0],ue[1],ue[2],ue[3]);var ge=this._outQ;return ge.copy(Ie),ge.multiply(this._sensorQ),this.config.YAW_ONLY&&(ge.x=ge.z=0,ge.normalize()),this._out[0]=ge.x,this._out[1]=ge.y,this._out[2]=ge.z,this._out[3]=ge.w,this._out}},{key:"_onSensorError",value:function(ue){this.errors.push(ue.error),ue.error.name==="NotAllowedError"?console.error("Permission to access sensor was denied"):ue.error.name==="NotReadableError"?console.error("Sensor could not be read"):console.error(ue.error),this.useDeviceMotion()}},{key:"_onSensorRead",value:function(){}}]),W}(),fe="<svg width='198' height='240' viewBox='0 0 198 240' xmlns='http://www.w3.org/2000/svg'><g fill='none' fill-rule='evenodd'><path d='M149.625 109.527l6.737 3.891v.886c0 .177.013.36.038.549.01.081.02.162.027.242.14 1.415.974 2.998 2.105 3.999l5.72 5.062.081-.09s4.382-2.53 5.235-3.024l25.97 14.993v54.001c0 .771-.386 1.217-.948 1.217-.233 0-.495-.076-.772-.236l-23.967-13.838-.014.024-27.322 15.775-.85-1.323c-4.731-1.529-9.748-2.74-14.951-3.61a.27.27 0 0 0-.007.024l-5.067 16.961-7.891 4.556-.037-.063v27.59c0 .772-.386 1.217-.948 1.217-.232 0-.495-.076-.772-.236l-42.473-24.522c-.95-.549-1.72-1.877-1.72-2.967v-1.035l-.021.047a5.111 5.111 0 0 0-1.816-.399 5.682 5.682 0 0 0-.546.001 13.724 13.724 0 0 1-1.918-.041c-1.655-.153-3.2-.6-4.404-1.296l-46.576-26.89.005.012-10.278-18.75c-1.001-1.827-.241-4.216 1.698-5.336l56.011-32.345a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.659 3.227 1.853l.005-.003.227.413-.006.004a9.63 9.63 0 0 0 1.477 2.018l.277.27c1.914 1.85 4.468 2.801 7.113 2.801 1.949 0 3.948-.517 5.775-1.572.013 0 7.319-4.219 7.319-4.219a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.658 3.226 1.853l3.25 5.928.022-.018 6.785 3.917-.105-.182 46.881-26.965m0-1.635c-.282 0-.563.073-.815.218l-46.169 26.556-5.41-3.124-3.005-5.481c-.913-1.667-2.699-2.702-4.66-2.703-1.011 0-2.02.274-2.917.792a3825 3825 0 0 1-7.275 4.195l-.044.024a9.937 9.937 0 0 1-4.957 1.353c-2.292 0-4.414-.832-5.976-2.342l-.252-.245a7.992 7.992 0 0 1-1.139-1.534 1.379 1.379 0 0 0-.06-.122l-.227-.414a1.718 1.718 0 0 0-.095-.154c-.938-1.574-2.673-2.545-4.571-2.545-1.011 0-2.02.274-2.917.792L3.125 155.502c-2.699 1.559-3.738 4.94-2.314 7.538l10.278 18.75c.177.323.448.563.761.704l46.426 26.804c1.403.81 3.157 1.332 5.072 1.508a15.661 15.661 0 0 0 2.146.046 4.766 4.766 0 0 1 .396 0c.096.004.19.011.283.022.109 1.593 1.159 3.323 2.529 4.114l42.472 24.522c.524.302 1.058.455 1.59.455 1.497 0 2.583-1.2 2.583-2.852v-26.562l7.111-4.105a1.64 1.64 0 0 0 .749-.948l4.658-15.593c4.414.797 8.692 1.848 12.742 3.128l.533.829a1.634 1.634 0 0 0 2.193.531l26.532-15.317L193 192.433c.523.302 1.058.455 1.59.455 1.497 0 2.583-1.199 2.583-2.852v-54.001c0-.584-.312-1.124-.818-1.416l-25.97-14.993a1.633 1.633 0 0 0-1.636.001c-.606.351-2.993 1.73-4.325 2.498l-4.809-4.255c-.819-.725-1.461-1.933-1.561-2.936a7.776 7.776 0 0 0-.033-.294 2.487 2.487 0 0 1-.023-.336v-.886c0-.584-.312-1.123-.817-1.416l-6.739-3.891a1.633 1.633 0 0 0-.817-.219' fill='#455A64'/><path d='M96.027 132.636l46.576 26.891c1.204.695 1.979 1.587 2.242 2.541l-.01.007-81.374 46.982h-.001c-1.654-.152-3.199-.6-4.403-1.295l-46.576-26.891 83.546-48.235' fill='#FAFAFA'/><path d='M63.461 209.174c-.008 0-.015 0-.022-.002-1.693-.156-3.228-.609-4.441-1.309l-46.576-26.89a.118.118 0 0 1 0-.203l83.546-48.235a.117.117 0 0 1 .117 0l46.576 26.891c1.227.708 2.021 1.612 2.296 2.611a.116.116 0 0 1-.042.124l-.021.016-81.375 46.981a.11.11 0 0 1-.058.016zm-50.747-28.303l46.401 26.79c1.178.68 2.671 1.121 4.32 1.276l81.272-46.922c-.279-.907-1.025-1.73-2.163-2.387l-46.517-26.857-83.313 48.1z' fill='#607D8B'/><path d='M148.327 165.471a5.85 5.85 0 0 1-.546.001c-1.894-.083-3.302-1.038-3.145-2.132a2.693 2.693 0 0 0-.072-1.105l-81.103 46.822c.628.058 1.272.073 1.918.042.182-.009.364-.009.546-.001 1.894.083 3.302 1.038 3.145 2.132l79.257-45.759' fill='#FFF'/><path d='M69.07 211.347a.118.118 0 0 1-.115-.134c.045-.317-.057-.637-.297-.925-.505-.61-1.555-1.022-2.738-1.074a5.966 5.966 0 0 0-.535.001 14.03 14.03 0 0 1-1.935-.041.117.117 0 0 1-.103-.092.116.116 0 0 1 .055-.126l81.104-46.822a.117.117 0 0 1 .171.07c.104.381.129.768.074 1.153-.045.316.057.637.296.925.506.61 1.555 1.021 2.739 1.073.178.008.357.008.535-.001a.117.117 0 0 1 .064.218l-79.256 45.759a.114.114 0 0 1-.059.016zm-3.405-2.372c.089 0 .177.002.265.006 1.266.056 2.353.488 2.908 1.158.227.274.35.575.36.882l78.685-45.429c-.036 0-.072-.001-.107-.003-1.267-.056-2.354-.489-2.909-1.158-.282-.34-.402-.724-.347-1.107a2.604 2.604 0 0 0-.032-.91L63.846 208.97a13.91 13.91 0 0 0 1.528.012c.097-.005.194-.007.291-.007z' fill='#607D8B'/><path d='M2.208 162.134c-1.001-1.827-.241-4.217 1.698-5.337l56.011-32.344c1.939-1.12 4.324-.546 5.326 1.281l.232.41a9.344 9.344 0 0 0 1.47 2.021l.278.27c3.325 3.214 8.583 3.716 12.888 1.23l7.319-4.22c1.94-1.119 4.324-.546 5.325 1.282l3.25 5.928-83.519 48.229-10.278-18.75z' fill='#FAFAFA'/><path d='M12.486 181.001a.112.112 0 0 1-.031-.005.114.114 0 0 1-.071-.056L2.106 162.19c-1.031-1.88-.249-4.345 1.742-5.494l56.01-32.344a4.328 4.328 0 0 1 2.158-.588c1.415 0 2.65.702 3.311 1.882.01.008.018.017.024.028l.227.414a.122.122 0 0 1 .013.038 9.508 9.508 0 0 0 1.439 1.959l.275.266c1.846 1.786 4.344 2.769 7.031 2.769 1.977 0 3.954-.538 5.717-1.557a.148.148 0 0 1 .035-.013l7.284-4.206a4.321 4.321 0 0 1 2.157-.588c1.427 0 2.672.716 3.329 1.914l3.249 5.929a.116.116 0 0 1-.044.157l-83.518 48.229a.116.116 0 0 1-.059.016zm49.53-57.004c-.704 0-1.41.193-2.041.557l-56.01 32.345c-1.882 1.086-2.624 3.409-1.655 5.179l10.221 18.645 83.317-48.112-3.195-5.829c-.615-1.122-1.783-1.792-3.124-1.792a4.08 4.08 0 0 0-2.04.557l-7.317 4.225a.148.148 0 0 1-.035.013 11.7 11.7 0 0 1-5.801 1.569c-2.748 0-5.303-1.007-7.194-2.835l-.278-.27a9.716 9.716 0 0 1-1.497-2.046.096.096 0 0 1-.013-.037l-.191-.347a.11.11 0 0 1-.023-.029c-.615-1.123-1.783-1.793-3.124-1.793z' fill='#607D8B'/><path d='M42.434 155.808c-2.51-.001-4.697-1.258-5.852-3.365-1.811-3.304-.438-7.634 3.059-9.654l12.291-7.098a7.599 7.599 0 0 1 3.789-1.033c2.51 0 4.697 1.258 5.852 3.365 1.811 3.304.439 7.634-3.059 9.654l-12.291 7.098a7.606 7.606 0 0 1-3.789 1.033zm13.287-20.683a7.128 7.128 0 0 0-3.555.971l-12.291 7.098c-3.279 1.893-4.573 5.942-2.883 9.024 1.071 1.955 3.106 3.122 5.442 3.122a7.13 7.13 0 0 0 3.556-.97l12.291-7.098c3.279-1.893 4.572-5.942 2.883-9.024-1.072-1.955-3.106-3.123-5.443-3.123z' fill='#607D8B'/><path d='M149.588 109.407l6.737 3.89v.887c0 .176.013.36.037.549.011.081.02.161.028.242.14 1.415.973 2.998 2.105 3.999l7.396 6.545c.177.156.358.295.541.415 1.579 1.04 2.95.466 3.062-1.282.049-.784.057-1.595.023-2.429l-.003-.16v-1.151l25.987 15.003v54c0 1.09-.77 1.53-1.72.982l-42.473-24.523c-.95-.548-1.72-1.877-1.72-2.966v-34.033' fill='#FAFAFA'/><path d='M194.553 191.25c-.257 0-.54-.085-.831-.253l-42.472-24.521c-.981-.567-1.779-1.943-1.779-3.068v-34.033h.234v34.033c0 1.051.745 2.336 1.661 2.866l42.473 24.521c.424.245.816.288 1.103.122.285-.164.442-.52.442-1.002v-53.933l-25.753-14.868.003 1.106c.034.832.026 1.654-.024 2.439-.054.844-.396 1.464-.963 1.746-.619.309-1.45.173-2.28-.373a5.023 5.023 0 0 1-.553-.426l-7.397-6.544c-1.158-1.026-1.999-2.625-2.143-4.076a9.624 9.624 0 0 0-.027-.238 4.241 4.241 0 0 1-.038-.564v-.82l-6.68-3.856.117-.202 6.738 3.89.058.034v.954c0 .171.012.351.036.533.011.083.021.165.029.246.138 1.395.948 2.935 2.065 3.923l7.397 6.545c.173.153.35.289.527.406.758.499 1.504.63 2.047.359.49-.243.786-.795.834-1.551.05-.778.057-1.591.024-2.417l-.004-.163v-1.355l.175.1 25.987 15.004.059.033v54.068c0 .569-.198.996-.559 1.204a1.002 1.002 0 0 1-.506.131' fill='#607D8B'/><path d='M145.685 163.161l24.115 13.922-25.978 14.998-1.462-.307c-6.534-2.17-13.628-3.728-21.019-4.616-4.365-.524-8.663 1.096-9.598 3.62a2.746 2.746 0 0 0-.011 1.928c1.538 4.267 4.236 8.363 7.995 12.135l.532.845-25.977 14.997-24.115-13.922 75.518-43.6' fill='#FFF'/><path d='M94.282 220.818l-.059-.033-24.29-14.024.175-.101 75.577-43.634.058.033 24.29 14.024-26.191 15.122-.045-.01-1.461-.307c-6.549-2.174-13.613-3.725-21.009-4.614a13.744 13.744 0 0 0-1.638-.097c-3.758 0-7.054 1.531-7.837 3.642a2.62 2.62 0 0 0-.01 1.848c1.535 4.258 4.216 8.326 7.968 12.091l.016.021.526.835.006.01.064.102-.105.061-25.977 14.998-.058.033zm-23.881-14.057l23.881 13.788 24.802-14.32c.546-.315.846-.489 1.017-.575l-.466-.74c-3.771-3.787-6.467-7.881-8.013-12.168a2.851 2.851 0 0 1 .011-2.008c.815-2.199 4.203-3.795 8.056-3.795.557 0 1.117.033 1.666.099 7.412.891 14.491 2.445 21.041 4.621.836.175 1.215.254 1.39.304l25.78-14.884-23.881-13.788-75.284 43.466z' fill='#607D8B'/><path d='M167.23 125.979v50.871l-27.321 15.773-6.461-14.167c-.91-1.996-3.428-1.738-5.624.574a10.238 10.238 0 0 0-2.33 4.018l-6.46 21.628-27.322 15.774v-50.871l75.518-43.6' fill='#FFF'/><path d='M91.712 220.567a.127.127 0 0 1-.059-.016.118.118 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.519-43.6a.117.117 0 0 1 .175.101v50.871c0 .041-.023.08-.059.1l-27.321 15.775a.118.118 0 0 1-.094.01.12.12 0 0 1-.071-.063l-6.46-14.168c-.375-.822-1.062-1.275-1.934-1.275-1.089 0-2.364.686-3.5 1.881a10.206 10.206 0 0 0-2.302 3.972l-6.46 21.627a.118.118 0 0 1-.054.068L91.77 220.551a.12.12 0 0 1-.058.016zm.117-50.92v50.601l27.106-15.65 6.447-21.583a10.286 10.286 0 0 1 2.357-4.065c1.18-1.242 2.517-1.954 3.669-1.954.969 0 1.731.501 2.146 1.411l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M168.543 126.213v50.87l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.624.574a10.248 10.248 0 0 0-2.33 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6' fill='#FFF'/><path d='M93.025 220.8a.123.123 0 0 1-.059-.015.12.12 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.518-43.6a.112.112 0 0 1 .117 0c.036.02.059.059.059.1v50.871a.116.116 0 0 1-.059.101l-27.321 15.774a.111.111 0 0 1-.094.01.115.115 0 0 1-.071-.062l-6.46-14.168c-.375-.823-1.062-1.275-1.935-1.275-1.088 0-2.363.685-3.499 1.881a10.19 10.19 0 0 0-2.302 3.971l-6.461 21.628a.108.108 0 0 1-.053.067l-27.322 15.775a.12.12 0 0 1-.058.015zm.117-50.919v50.6l27.106-15.649 6.447-21.584a10.293 10.293 0 0 1 2.357-4.065c1.179-1.241 2.516-1.954 3.668-1.954.969 0 1.732.502 2.147 1.412l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M169.8 177.083l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.625.574a10.246 10.246 0 0 0-2.329 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6v50.87z' fill='#FAFAFA'/><path d='M94.282 220.917a.234.234 0 0 1-.234-.233v-50.871c0-.083.045-.161.117-.202l75.518-43.601a.234.234 0 1 1 .35.202v50.871a.233.233 0 0 1-.116.202l-27.322 15.775a.232.232 0 0 1-.329-.106l-6.461-14.168c-.36-.789-.992-1.206-1.828-1.206-1.056 0-2.301.672-3.415 1.844a10.099 10.099 0 0 0-2.275 3.924l-6.46 21.628a.235.235 0 0 1-.107.136l-27.322 15.774a.23.23 0 0 1-.116.031zm.233-50.969v50.331l26.891-15.525 6.434-21.539a10.41 10.41 0 0 1 2.384-4.112c1.201-1.265 2.569-1.991 3.753-1.991 1.018 0 1.818.526 2.253 1.48l6.354 13.934 26.982-15.578v-50.331l-75.051 43.331z' fill='#607D8B'/><path d='M109.894 199.943c-1.774 0-3.241-.725-4.244-2.12a.224.224 0 0 1 .023-.294.233.233 0 0 1 .301-.023c.78.547 1.705.827 2.75.827 1.323 0 2.754-.439 4.256-1.306 5.311-3.067 9.631-10.518 9.631-16.611 0-1.927-.442-3.56-1.278-4.724a.232.232 0 0 1 .323-.327c1.671 1.172 2.591 3.381 2.591 6.219 0 6.242-4.426 13.863-9.865 17.003-1.574.908-3.084 1.356-4.488 1.356zm-2.969-1.542c.813.651 1.82.877 2.968.877h.001c1.321 0 2.753-.327 4.254-1.194 5.311-3.067 9.632-10.463 9.632-16.556 0-1.979-.463-3.599-1.326-4.761.411 1.035.625 2.275.625 3.635 0 6.243-4.426 13.883-9.865 17.023-1.574.909-3.084 1.317-4.49 1.317-.641 0-1.243-.149-1.799-.341z' fill='#607D8B'/><path d='M113.097 197.23c5.384-3.108 9.748-10.636 9.748-16.814 0-2.051-.483-3.692-1.323-4.86-1.784-1.252-4.374-1.194-7.257.47-5.384 3.108-9.748 10.636-9.748 16.814 0 2.051.483 3.692 1.323 4.86 1.784 1.252 4.374 1.194 7.257-.47' fill='#FAFAFA'/><path d='M108.724 198.614c-1.142 0-2.158-.213-3.019-.817-.021-.014-.04.014-.055-.007-.894-1.244-1.367-2.948-1.367-4.973 0-6.242 4.426-13.864 9.865-17.005 1.574-.908 3.084-1.363 4.49-1.363 1.142 0 2.158.309 3.018.913a.23.23 0 0 1 .056.056c.894 1.244 1.367 2.972 1.367 4.997 0 6.243-4.426 13.783-9.865 16.923-1.574.909-3.084 1.276-4.49 1.276zm-2.718-1.109c.774.532 1.688.776 2.718.776 1.323 0 2.754-.413 4.256-1.28 5.311-3.066 9.631-10.505 9.631-16.598 0-1.909-.434-3.523-1.255-4.685-.774-.533-1.688-.799-2.718-.799-1.323 0-2.755.441-4.256 1.308-5.311 3.066-9.631 10.506-9.631 16.599 0 1.909.434 3.517 1.255 4.679z' fill='#607D8B'/><path d='M149.318 114.262l-9.984 8.878 15.893 11.031 5.589-6.112-11.498-13.797' fill='#FAFAFA'/><path d='M169.676 120.84l-9.748 5.627c-3.642 2.103-9.528 2.113-13.147.024-3.62-2.089-3.601-5.488.041-7.591l9.495-5.608-6.729-3.885-81.836 47.071 45.923 26.514 3.081-1.779c.631-.365.869-.898.618-1.39-2.357-4.632-2.593-9.546-.683-14.262 5.638-13.92 24.509-24.815 48.618-28.07 8.169-1.103 16.68-.967 24.704.394.852.145 1.776.008 2.407-.357l3.081-1.778-25.825-14.91' fill='#FAFAFA'/><path d='M113.675 183.459a.47.47 0 0 1-.233-.062l-45.924-26.515a.468.468 0 0 1 .001-.809l81.836-47.071a.467.467 0 0 1 .466 0l6.729 3.885a.467.467 0 0 1-.467.809l-6.496-3.75-80.9 46.533 44.988 25.973 2.848-1.644c.192-.111.62-.409.435-.773-2.416-4.748-2.658-9.814-.7-14.65 2.806-6.927 8.885-13.242 17.582-18.263 8.657-4.998 19.518-8.489 31.407-10.094 8.198-1.107 16.79-.97 24.844.397.739.125 1.561.007 2.095-.301l2.381-1.374-25.125-14.506a.467.467 0 0 1 .467-.809l25.825 14.91a.467.467 0 0 1 0 .809l-3.081 1.779c-.721.417-1.763.575-2.718.413-7.963-1.351-16.457-1.486-24.563-.392-11.77 1.589-22.512 5.039-31.065 9.977-8.514 4.916-14.456 11.073-17.183 17.805-1.854 4.578-1.623 9.376.666 13.875.37.725.055 1.513-.8 2.006l-3.081 1.78a.476.476 0 0 1-.234.062' fill='#455A64'/><path d='M153.316 128.279c-2.413 0-4.821-.528-6.652-1.586-1.818-1.049-2.82-2.461-2.82-3.975 0-1.527 1.016-2.955 2.861-4.02l9.493-5.607a.233.233 0 1 1 .238.402l-9.496 5.609c-1.696.979-2.628 2.263-2.628 3.616 0 1.34.918 2.608 2.585 3.571 3.549 2.049 9.343 2.038 12.914-.024l9.748-5.628a.234.234 0 0 1 .234.405l-9.748 5.628c-1.858 1.072-4.296 1.609-6.729 1.609' fill='#607D8B'/><path d='M113.675 182.992l-45.913-26.508M113.675 183.342a.346.346 0 0 1-.175-.047l-45.913-26.508a.35.35 0 1 1 .35-.607l45.913 26.508a.35.35 0 0 1-.175.654' fill='#455A64'/><path d='M67.762 156.484v54.001c0 1.09.77 2.418 1.72 2.967l42.473 24.521c.95.549 1.72.11 1.72-.98v-54.001' fill='#FAFAFA'/><path d='M112.727 238.561c-.297 0-.62-.095-.947-.285l-42.473-24.521c-1.063-.613-1.895-2.05-1.895-3.27v-54.001a.35.35 0 1 1 .701 0v54.001c0 .96.707 2.18 1.544 2.663l42.473 24.522c.344.198.661.243.87.122.206-.119.325-.411.325-.799v-54.001a.35.35 0 1 1 .7 0v54.001c0 .655-.239 1.154-.675 1.406a1.235 1.235 0 0 1-.623.162' fill='#455A64'/><path d='M112.86 147.512h-.001c-2.318 0-4.499-.522-6.142-1.471-1.705-.984-2.643-2.315-2.643-3.749 0-1.445.952-2.791 2.68-3.788l12.041-6.953c1.668-.962 3.874-1.493 6.212-1.493 2.318 0 4.499.523 6.143 1.472 1.704.984 2.643 2.315 2.643 3.748 0 1.446-.952 2.791-2.68 3.789l-12.042 6.952c-1.668.963-3.874 1.493-6.211 1.493zm12.147-16.753c-2.217 0-4.298.497-5.861 1.399l-12.042 6.952c-1.502.868-2.33 1.998-2.33 3.182 0 1.173.815 2.289 2.293 3.142 1.538.889 3.596 1.378 5.792 1.378h.001c2.216 0 4.298-.497 5.861-1.399l12.041-6.953c1.502-.867 2.33-1.997 2.33-3.182 0-1.172-.814-2.288-2.292-3.142-1.539-.888-3.596-1.377-5.793-1.377z' fill='#607D8B'/><path d='M165.63 123.219l-5.734 3.311c-3.167 1.828-8.286 1.837-11.433.02-3.147-1.817-3.131-4.772.036-6.601l5.734-3.31 11.397 6.58' fill='#FAFAFA'/><path d='M154.233 117.448l9.995 5.771-4.682 2.704c-1.434.827-3.352 1.283-5.399 1.283-2.029 0-3.923-.449-5.333-1.263-1.29-.744-2-1.694-2-2.674 0-.991.723-1.955 2.036-2.713l5.383-3.108m0-.809l-5.734 3.31c-3.167 1.829-3.183 4.784-.036 6.601 1.568.905 3.623 1.357 5.684 1.357 2.077 0 4.159-.46 5.749-1.377l5.734-3.311-11.397-6.58M145.445 179.667c-1.773 0-3.241-.85-4.243-2.245-.067-.092-.057-.275.023-.356.08-.081.207-.12.3-.055.781.548 1.706.812 2.751.811 1.322 0 2.754-.446 4.256-1.313 5.31-3.066 9.631-10.522 9.631-16.615 0-1.927-.442-3.562-1.279-4.726a.235.235 0 0 1 .024-.301.232.232 0 0 1 .3-.027c1.67 1.172 2.59 3.38 2.59 6.219 0 6.242-4.425 13.987-9.865 17.127-1.573.908-3.083 1.481-4.488 1.481zM142.476 178c.814.651 1.82 1.002 2.969 1.002 1.322 0 2.753-.452 4.255-1.32 5.31-3.065 9.631-10.523 9.631-16.617 0-1.98-.463-3.63-1.325-4.793.411 1.035.624 2.26.624 3.62 0 6.242-4.425 13.875-9.865 17.015-1.573.909-3.084 1.376-4.489 1.376a5.49 5.49 0 0 1-1.8-.283z' fill='#607D8B'/><path d='M148.648 176.704c5.384-3.108 9.748-10.636 9.748-16.813 0-2.052-.483-3.693-1.322-4.861-1.785-1.252-4.375-1.194-7.258.471-5.383 3.108-9.748 10.636-9.748 16.813 0 2.051.484 3.692 1.323 4.86 1.785 1.253 4.374 1.195 7.257-.47' fill='#FAFAFA'/><path d='M144.276 178.276c-1.143 0-2.158-.307-3.019-.911a.217.217 0 0 1-.055-.054c-.895-1.244-1.367-2.972-1.367-4.997 0-6.241 4.425-13.875 9.865-17.016 1.573-.908 3.084-1.369 4.489-1.369 1.143 0 2.158.307 3.019.91a.24.24 0 0 1 .055.055c.894 1.244 1.367 2.971 1.367 4.997 0 6.241-4.425 13.875-9.865 17.016-1.573.908-3.084 1.369-4.489 1.369zm-2.718-1.172c.773.533 1.687.901 2.718.901 1.322 0 2.754-.538 4.256-1.405 5.31-3.066 9.631-10.567 9.631-16.661 0-1.908-.434-3.554-1.256-4.716-.774-.532-1.688-.814-2.718-.814-1.322 0-2.754.433-4.256 1.3-5.31 3.066-9.631 10.564-9.631 16.657 0 1.91.434 3.576 1.256 4.738z' fill='#607D8B'/><path d='M150.72 172.361l-.363-.295a24.105 24.105 0 0 0 2.148-3.128 24.05 24.05 0 0 0 1.977-4.375l.443.149a24.54 24.54 0 0 1-2.015 4.46 24.61 24.61 0 0 1-2.19 3.189M115.917 191.514l-.363-.294a24.174 24.174 0 0 0 2.148-3.128 24.038 24.038 0 0 0 1.976-4.375l.443.148a24.48 24.48 0 0 1-2.015 4.461 24.662 24.662 0 0 1-2.189 3.188M114 237.476V182.584 237.476' fill='#607D8B'/><g><path d='M81.822 37.474c.017-.135-.075-.28-.267-.392-.327-.188-.826-.21-1.109-.045l-6.012 3.471c-.131.076-.194.178-.191.285.002.132.002.461.002.578v.043l-.007.128-6.591 3.779c-.001 0-2.077 1.046-2.787 5.192 0 0-.912 6.961-.898 19.745.015 12.57.606 17.07 1.167 21.351.22 1.684 3.001 2.125 3.001 2.125.331.04.698-.027 1.08-.248l75.273-43.551c1.808-1.069 2.667-3.719 3.056-6.284 1.213-7.99 1.675-32.978-.275-39.878-.196-.693-.51-1.083-.868-1.282l-2.086-.79c-.727.028-1.416.467-1.534.535L82.032 37.072l-.21.402' fill='#FFF'/><path d='M144.311 1.701l2.085.79c.358.199.672.589.868 1.282 1.949 6.9 1.487 31.887.275 39.878-.39 2.565-1.249 5.215-3.056 6.284L69.21 93.486a1.78 1.78 0 0 1-.896.258l-.183-.011c0 .001-2.782-.44-3.003-2.124-.56-4.282-1.151-8.781-1.165-21.351-.015-12.784.897-19.745.897-19.745.71-4.146 2.787-5.192 2.787-5.192l6.591-3.779.007-.128v-.043c0-.117 0-.446-.002-.578-.003-.107.059-.21.191-.285l6.012-3.472a.98.98 0 0 1 .481-.11c.218 0 .449.053.627.156.193.112.285.258.268.392l.211-.402 60.744-34.836c.117-.068.806-.507 1.534-.535m0-.997l-.039.001c-.618.023-1.283.244-1.974.656l-.021.012-60.519 34.706a2.358 2.358 0 0 0-.831-.15c-.365 0-.704.084-.98.244l-6.012 3.471c-.442.255-.699.69-.689 1.166l.001.15-6.08 3.487c-.373.199-2.542 1.531-3.29 5.898l-.006.039c-.009.07-.92 7.173-.906 19.875.014 12.62.603 17.116 1.172 21.465l.002.015c.308 2.355 3.475 2.923 3.836 2.98l.034.004c.101.013.204.019.305.019a2.77 2.77 0 0 0 1.396-.392l75.273-43.552c1.811-1.071 2.999-3.423 3.542-6.997 1.186-7.814 1.734-33.096-.301-40.299-.253-.893-.704-1.527-1.343-1.882l-.132-.062-2.085-.789a.973.973 0 0 0-.353-.065' fill='#455A64'/><path d='M128.267 11.565l1.495.434-56.339 32.326' fill='#FFF'/><path d='M74.202 90.545a.5.5 0 0 1-.25-.931l18.437-10.645a.499.499 0 1 1 .499.864L74.451 90.478l-.249.067M75.764 42.654l-.108-.062.046-.171 5.135-2.964.17.045-.045.171-5.135 2.964-.063.017M70.52 90.375V46.421l.063-.036L137.84 7.554v43.954l-.062.036L70.52 90.375zm.25-43.811v43.38l66.821-38.579V7.985L70.77 46.564z' fill='#607D8B'/><path d='M86.986 83.182c-.23.149-.612.384-.849.523l-11.505 6.701c-.237.139-.206.252.068.252h.565c.275 0 .693-.113.93-.252L87.7 83.705c.237-.139.428-.253.425-.256a11.29 11.29 0 0 1-.006-.503c0-.274-.188-.377-.418-.227l-.715.463' fill='#607D8B'/><path d='M75.266 90.782H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.236-.138.615-.371.844-.519l.715-.464a.488.488 0 0 1 .266-.089c.172 0 .345.13.345.421 0 .214.001.363.003.437l.006.004-.004.069c-.003.075-.003.075-.486.356l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.108.866-.234l11.505-6.702c.168-.098.294-.173.361-.214-.004-.084-.004-.218-.004-.437l-.095-.171-.131.049-.714.463c-.232.15-.616.386-.854.525l-11.505 6.702-.029.018z' fill='#607D8B'/><path d='M75.266 89.871H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.258-.151.694-.268.993-.268h.565c.2 0 .316.056.346.166.03.11-.043.217-.215.317l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.107.866-.234l11.505-6.702.03-.018-.035-.001h-.565c-.252 0-.649.108-.867.234l-11.505 6.702-.029.018zM74.37 90.801v-1.247 1.247' fill='#607D8B'/><path d='M68.13 93.901c-.751-.093-1.314-.737-1.439-1.376-.831-4.238-1.151-8.782-1.165-21.352-.015-12.784.897-19.745.897-19.745.711-4.146 2.787-5.192 2.787-5.192l74.859-43.219c.223-.129 2.487-1.584 3.195.923 1.95 6.9 1.488 31.887.275 39.878-.389 2.565-1.248 5.215-3.056 6.283L69.21 93.653c-.382.221-.749.288-1.08.248 0 0-2.781-.441-3.001-2.125-.561-4.281-1.152-8.781-1.167-21.351-.014-12.784.898-19.745.898-19.745.71-4.146 2.787-5.191 2.787-5.191l6.598-3.81.871-.119 6.599-3.83.046-.461L68.13 93.901' fill='#FAFAFA'/><path d='M68.317 94.161l-.215-.013h-.001l-.244-.047c-.719-.156-2.772-.736-2.976-2.292-.568-4.34-1.154-8.813-1.168-21.384-.014-12.654.891-19.707.9-19.777.725-4.231 2.832-5.338 2.922-5.382l6.628-3.827.87-.119 6.446-3.742.034-.334a.248.248 0 0 1 .273-.223.248.248 0 0 1 .223.272l-.059.589-6.752 3.919-.87.118-6.556 3.785c-.031.016-1.99 1.068-2.666 5.018-.007.06-.908 7.086-.894 19.702.014 12.539.597 16.996 1.161 21.305.091.691.689 1.154 1.309 1.452a1.95 1.95 0 0 1-.236-.609c-.781-3.984-1.155-8.202-1.17-21.399-.014-12.653.891-19.707.9-19.777.725-4.231 2.832-5.337 2.922-5.382-.004.001 74.444-42.98 74.846-43.212l.028-.017c.904-.538 1.72-.688 2.36-.433.555.221.949.733 1.172 1.52 2.014 7.128 1.46 32.219.281 39.983-.507 3.341-1.575 5.515-3.175 6.462L69.335 93.869a2.023 2.023 0 0 1-1.018.292zm-.147-.507c.293.036.604-.037.915-.217l75.273-43.551c1.823-1.078 2.602-3.915 2.934-6.106 1.174-7.731 1.731-32.695-.268-39.772-.178-.631-.473-1.032-.876-1.192-.484-.193-1.166-.052-1.921.397l-.034.021-74.858 43.218c-.031.017-1.989 1.069-2.666 5.019-.007.059-.908 7.085-.894 19.702.015 13.155.386 17.351 1.161 21.303.09.461.476.983 1.037 1.139.114.025.185.037.196.039h.001z' fill='#455A64'/><path d='M69.317 68.982c.489-.281.885-.056.885.505 0 .56-.396 1.243-.885 1.525-.488.282-.884.057-.884-.504 0-.56.396-1.243.884-1.526' fill='#FFF'/><path d='M68.92 71.133c-.289 0-.487-.228-.487-.625 0-.56.396-1.243.884-1.526a.812.812 0 0 1 .397-.121c.289 0 .488.229.488.626 0 .56-.396 1.243-.885 1.525a.812.812 0 0 1-.397.121m.794-2.459a.976.976 0 0 0-.49.147c-.548.317-.978 1.058-.978 1.687 0 .486.271.812.674.812a.985.985 0 0 0 .491-.146c.548-.317.978-1.057.978-1.687 0-.486-.272-.813-.675-.813' fill='#8097A2'/><path d='M68.92 70.947c-.271 0-.299-.307-.299-.439 0-.491.361-1.116.79-1.363a.632.632 0 0 1 .303-.096c.272 0 .301.306.301.438 0 .491-.363 1.116-.791 1.364a.629.629 0 0 1-.304.096m.794-2.086a.812.812 0 0 0-.397.121c-.488.283-.884.966-.884 1.526 0 .397.198.625.487.625a.812.812 0 0 0 .397-.121c.489-.282.885-.965.885-1.525 0-.397-.199-.626-.488-.626' fill='#8097A2'/><path d='M69.444 85.35c.264-.152.477-.031.477.272 0 .303-.213.67-.477.822-.263.153-.477.031-.477-.271 0-.302.214-.671.477-.823' fill='#FFF'/><path d='M69.23 86.51c-.156 0-.263-.123-.263-.337 0-.302.214-.671.477-.823a.431.431 0 0 1 .214-.066c.156 0 .263.124.263.338 0 .303-.213.67-.477.822a.431.431 0 0 1-.214.066m.428-1.412c-.1 0-.203.029-.307.09-.32.185-.57.618-.57.985 0 .309.185.524.449.524a.63.63 0 0 0 .308-.09c.32-.185.57-.618.57-.985 0-.309-.185-.524-.45-.524' fill='#8097A2'/><path d='M69.23 86.322l-.076-.149c0-.235.179-.544.384-.661l.12-.041.076.151c0 .234-.179.542-.383.66l-.121.04m.428-1.038a.431.431 0 0 0-.214.066c-.263.152-.477.521-.477.823 0 .214.107.337.263.337a.431.431 0 0 0 .214-.066c.264-.152.477-.519.477-.822 0-.214-.107-.338-.263-.338' fill='#8097A2'/><path d='M139.278 7.769v43.667L72.208 90.16V46.493l67.07-38.724' fill='#455A64'/><path d='M72.083 90.375V46.421l.063-.036 67.257-38.831v43.954l-.062.036-67.258 38.831zm.25-43.811v43.38l66.821-38.579V7.985L72.333 46.564z' fill='#607D8B'/></g><path d='M125.737 88.647l-7.639 3.334V84l-11.459 4.713v8.269L99 100.315l13.369 3.646 13.368-15.314' fill='#455A64'/></g></svg>";function Be(){this.loadIcon_();var W=document.createElement("div"),mt=W.style;mt.position="fixed",mt.top=0,mt.right=0,mt.bottom=0,mt.left=0,mt.backgroundColor="gray",mt.fontFamily="sans-serif",mt.zIndex=1e6;var ue=document.createElement("img");ue.src=this.icon;var mt=ue.style;mt.marginLeft="25%",mt.marginTop="25%",mt.width="50%",W.appendChild(ue);var ge=document.createElement("div"),mt=ge.style;mt.textAlign="center",mt.fontSize="16px",mt.lineHeight="24px",mt.margin="24px 25%",mt.width="50%",ge.innerHTML="Place your phone into your Cardboard viewer.",W.appendChild(ge);var Se=document.createElement("div"),mt=Se.style;mt.backgroundColor="#CFD8DC",mt.position="fixed",mt.bottom=0,mt.width="100%",mt.height="48px",mt.padding="14px 24px",mt.boxSizing="border-box",mt.color="#656A6B",W.appendChild(Se);var We=document.createElement("div");We.style.float="left",We.innerHTML="No Cardboard viewer?";var Ke=document.createElement("a");Ke.href="https://www.google.com/get/cardboard/get-cardboard/",Ke.innerHTML="get one",Ke.target="_blank";var mt=Ke.style;mt.float="right",mt.fontWeight=600,mt.textTransform="uppercase",mt.borderLeft="1px solid gray",mt.paddingLeft="24px",mt.textDecoration="none",mt.color="#656A6B",Se.appendChild(We),Se.appendChild(Ke),this.overlay=W,this.text=ge,this.hide()}Be.prototype.show=function(W){!W&&!this.overlay.parentElement?document.body.appendChild(this.overlay):W&&(this.overlay.parentElement&&this.overlay.parentElement!=W&&this.overlay.parentElement.removeChild(this.overlay),W.appendChild(this.overlay)),this.overlay.style.display="block";var ue=this.overlay.querySelector("img"),ge=ue.style;me()?(ge.width="20%",ge.marginLeft="40%",ge.marginTop="3%"):(ge.width="50%",ge.marginLeft="25%",ge.marginTop="25%")},Be.prototype.hide=function(){this.overlay.style.display="none"},Be.prototype.showTemporarily=function(W,ue){this.show(ue),this.timer=setTimeout(this.hide.bind(this),W)},Be.prototype.disableShowTemporarily=function(){clearTimeout(this.timer)},Be.prototype.update=function(){this.disableShowTemporarily(),!me()&&$e()?this.show():this.hide()},Be.prototype.loadIcon_=function(){this.icon=G("image/svg+xml",fe)};var Fe="CardboardV1",Ye="WEBVR_CARDBOARD_VIEWER",lt="webvr-polyfill-viewer-selector";function Ct(W){try{this.selectedKey=localStorage.getItem(Ye)}catch(ue){console.error("Failed to load viewer profile: %s",ue)}this.selectedKey||(this.selectedKey=W||Fe),this.dialog=this.createDialog_(kr.Viewers),this.root=null,this.onChangeCallbacks_=[]}Ct.prototype.show=function(W){this.root=W,W.appendChild(this.dialog);var ue=this.dialog.querySelector("#"+this.selectedKey);ue.checked=!0,this.dialog.style.display="block"},Ct.prototype.hide=function(){this.root&&this.root.contains(this.dialog)&&this.root.removeChild(this.dialog),this.dialog.style.display="none"},Ct.prototype.getCurrentViewer=function(){return kr.Viewers[this.selectedKey]},Ct.prototype.getSelectedKey_=function(){var W=this.dialog.querySelector("input[name=field]:checked");return W?W.id:null},Ct.prototype.onChange=function(W){this.onChangeCallbacks_.push(W)},Ct.prototype.fireOnChange_=function(W){for(var ue=0;ue<this.onChangeCallbacks_.length;ue++)this.onChangeCallbacks_[ue](W)},Ct.prototype.onSave_=function(){if(this.selectedKey=this.getSelectedKey_(),!this.selectedKey||!kr.Viewers[this.selectedKey]){console.error("ViewerSelector.onSave_: this should never happen!");return}this.fireOnChange_(kr.Viewers[this.selectedKey]);try{localStorage.setItem(Ye,this.selectedKey)}catch(W){console.error("Failed to save viewer profile: %s",W)}this.hide()},Ct.prototype.createDialog_=function(W){var ue=document.createElement("div");ue.classList.add(lt),ue.style.display="none";var ge=document.createElement("div"),Ke=ge.style;Ke.position="fixed",Ke.left=0,Ke.top=0,Ke.width="100%",Ke.height="100%",Ke.background="rgba(0, 0, 0, 0.3)",ge.addEventListener("click",this.hide.bind(this));var Se=280,We=document.createElement("div"),Ke=We.style;Ke.boxSizing="border-box",Ke.position="fixed",Ke.top="24px",Ke.left="50%",Ke.marginLeft=-280/2+"px",Ke.width=Se+"px",Ke.padding="24px",Ke.overflow="hidden",Ke.background="#fafafa",Ke.fontFamily="'Roboto', sans-serif",Ke.boxShadow="0px 5px 20px #666",We.appendChild(this.createH1_("Select your viewer"));for(var mt in W)We.appendChild(this.createChoice_(mt,W[mt].label));return We.appendChild(this.createButton_("Save",this.onSave_.bind(this))),ue.appendChild(ge),ue.appendChild(We),ue},Ct.prototype.createH1_=function(W){var ue=document.createElement("h1"),ge=ue.style;return ge.color="black",ge.fontSize="20px",ge.fontWeight="bold",ge.marginTop=0,ge.marginBottom="24px",ue.innerHTML=W,ue},Ct.prototype.createChoice_=function(W,ue){var ge=document.createElement("div");ge.style.marginTop="8px",ge.style.color="black";var Se=document.createElement("input");Se.style.fontSize="30px",Se.setAttribute("id",W),Se.setAttribute("type","radio"),Se.setAttribute("value",W),Se.setAttribute("name","field");var We=document.createElement("label");return We.style.marginLeft="4px",We.setAttribute("for",W),We.innerHTML=ue,ge.appendChild(Se),ge.appendChild(We),ge},Ct.prototype.createButton_=function(W,ue){var ge=document.createElement("button");ge.innerHTML=W;var Se=ge.style;return Se.float="right",Se.textTransform="uppercase",Se.color="#1094f7",Se.fontSize="14px",Se.letterSpacing=0,Se.border=0,Se.background="none",Se.marginTop="16px",ge.addEventListener("click",ue),ge};var Yt=typeof window<"u"?window:typeof h<"u"?h:typeof self<"u"?self:{};function ei(W){return W&&W.__esModule&&Object.prototype.hasOwnProperty.call(W,"default")?W.default:W}function Bt(W,ue){return ue={exports:{}},W(ue,ue.exports),ue.exports}var ni=Bt(function(W,ue){(function(ge,Se){W.exports=Se()})(Yt,function(){return function(ge){var Se={};function We(Ke){if(Se[Ke])return Se[Ke].exports;var mt=Se[Ke]={i:Ke,l:!1,exports:{}};return ge[Ke].call(mt.exports,mt,mt.exports,We),mt.l=!0,mt.exports}return We.m=ge,We.c=Se,We.d=function(Ke,mt,he){We.o(Ke,mt)||Object.defineProperty(Ke,mt,{configurable:!1,enumerable:!0,get:he})},We.n=function(Ke){var mt=Ke&&Ke.__esModule?function(){return Ke.default}:function(){return Ke};return We.d(mt,"a",mt),mt},We.o=function(Ke,mt){return Object.prototype.hasOwnProperty.call(Ke,mt)},We.p="",We(We.s=0)}([function(ge,Se,We){var Ke=function(){function be(Ee,at){for(var St=0;St<at.length;St++){var Qt=at[St];Qt.enumerable=Qt.enumerable||!1,Qt.configurable=!0,"value"in Qt&&(Qt.writable=!0),Object.defineProperty(Ee,Qt.key,Qt)}}return function(Ee,at,St){return at&&be(Ee.prototype,at),St&&be(Ee,St),Ee}}();function mt(be,Ee){if(!(be instanceof Ee))throw new TypeError("Cannot call a class as a function")}var he=We(1),le=typeof navigator<"u"&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,de=function(){function be(){mt(this,be),le?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("playsinline",""),this.noSleepVideo.setAttribute("src",he),this.noSleepVideo.addEventListener("timeupdate",(function(Ee){this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())}).bind(this)))}return Ke(be,[{key:"enable",value:function(){le?(this.disable(),this.noSleepTimer=window.setInterval(function(){window.location.href="/",window.setTimeout(window.stop,0)},15e3)):this.noSleepVideo.play()}},{key:"disable",value:function(){le?this.noSleepTimer&&(window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause()}}]),be}();ge.exports=de},function(ge,Se,We){ge.exports="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA="}])})}),wi=ei(ni),zi=1e3,Sr=[0,0,.5,1],hr=[.5,0,.5,1],er=window.requestAnimationFrame,_i=window.cancelAnimationFrame;function Rn(){this.leftProjectionMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.rightViewMatrix=new Float32Array(16),this.pose=null}function Kn(W){Object.defineProperties(this,{hasPosition:{writable:!1,enumerable:!0,value:W.hasPosition},hasExternalDisplay:{writable:!1,enumerable:!0,value:W.hasExternalDisplay},canPresent:{writable:!1,enumerable:!0,value:W.canPresent},maxLayers:{writable:!1,enumerable:!0,value:W.maxLayers},hasOrientation:{enumerable:!0,get:function(){return Ce("VRDisplayCapabilities.prototype.hasOrientation","VRDisplay.prototype.getFrameData"),W.hasOrientation}}})}function Bi(W){W=W||{};var ue="wakelock"in W?W.wakelock:!0;this.isPolyfilled=!0,this.displayId=zi++,this.displayName="",this.depthNear=.01,this.depthFar=1e4,this.isPresenting=!1,Object.defineProperty(this,"isConnected",{get:function(){return Ce("VRDisplay.prototype.isConnected","VRDisplayCapabilities.prototype.hasExternalDisplay"),!1}}),this.capabilities=new Kn({hasPosition:!1,hasOrientation:!1,hasExternalDisplay:!1,canPresent:!1,maxLayers:1}),this.stageParameters=null,this.waitingForPresent_=!1,this.layer_=null,this.originalParent_=null,this.fullscreenElement_=null,this.fullscreenWrapper_=null,this.fullscreenElementCachedStyle_=null,this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null,ue&&$e()&&(this.wakelock_=new wi)}Bi.prototype.getFrameData=function(W){return Ri(W,this._getPose(),this)},Bi.prototype.getPose=function(){return Ce("VRDisplay.prototype.getPose","VRDisplay.prototype.getFrameData"),this._getPose()},Bi.prototype.resetPose=function(){return Ce("VRDisplay.prototype.resetPose"),this._resetPose()},Bi.prototype.getImmediatePose=function(){return Ce("VRDisplay.prototype.getImmediatePose","VRDisplay.prototype.getFrameData"),this._getPose()},Bi.prototype.requestAnimationFrame=function(W){return er(W)},Bi.prototype.cancelAnimationFrame=function(W){return _i(W)},Bi.prototype.wrapForFullscreen=function(W){if(Q())return W;if(!this.fullscreenWrapper_){this.fullscreenWrapper_=document.createElement("div");var ue=["height: "+Math.min(screen.height,screen.width)+"px !important","top: 0 !important","left: 0 !important","right: 0 !important","border: 0","margin: 0","padding: 0","z-index: 999999 !important","position: fixed"];this.fullscreenWrapper_.setAttribute("style",ue.join("; ")+";"),this.fullscreenWrapper_.classList.add("webvr-polyfill-fullscreen-wrapper")}if(this.fullscreenElement_==W)return this.fullscreenWrapper_;if(this.fullscreenElement_&&(this.originalParent_?this.originalParent_.appendChild(this.fullscreenElement_):this.fullscreenElement_.parentElement.removeChild(this.fullscreenElement_)),this.fullscreenElement_=W,this.originalParent_=W.parentElement,this.originalParent_||document.body.appendChild(W),!this.fullscreenWrapper_.parentElement){var ge=this.fullscreenElement_.parentElement;ge.insertBefore(this.fullscreenWrapper_,this.fullscreenElement_),ge.removeChild(this.fullscreenElement_)}this.fullscreenWrapper_.insertBefore(this.fullscreenElement_,this.fullscreenWrapper_.firstChild),this.fullscreenElementCachedStyle_=this.fullscreenElement_.getAttribute("style");var Se=this;function We(){if(Se.fullscreenElement_){var Ke=["position: absolute","top: 0","left: 0","width: "+Math.max(screen.width,screen.height)+"px","height: "+Math.min(screen.height,screen.width)+"px","border: 0","margin: 0","padding: 0"];Se.fullscreenElement_.setAttribute("style",Ke.join("; ")+";")}}return We(),this.fullscreenWrapper_},Bi.prototype.removeFullscreenWrapper=function(){if(this.fullscreenElement_){var W=this.fullscreenElement_;this.fullscreenElementCachedStyle_?W.setAttribute("style",this.fullscreenElementCachedStyle_):W.removeAttribute("style"),this.fullscreenElement_=null,this.fullscreenElementCachedStyle_=null;var ue=this.fullscreenWrapper_.parentElement;return this.fullscreenWrapper_.removeChild(W),this.originalParent_===ue?ue.insertBefore(W,this.fullscreenWrapper_):this.originalParent_&&this.originalParent_.appendChild(W),ue.removeChild(this.fullscreenWrapper_),W}},Bi.prototype.requestPresent=function(W){var ue=this.isPresenting,ge=this;return W instanceof Array||(Ce("VRDisplay.prototype.requestPresent with non-array argument","an array of VRLayers as the first argument"),W=[W]),new Promise(function(Se,We){if(!ge.capabilities.canPresent){We(new Error("VRDisplay is not capable of presenting."));return}if(W.length==0||W.length>ge.capabilities.maxLayers){We(new Error("Invalid number of layers."));return}var Ke=W[0];if(!Ke.source){Se();return}var mt=Ke.leftBounds||Sr,he=Ke.rightBounds||hr;if(ue){var le=ge.layer_;le.source!==Ke.source&&(le.source=Ke.source);for(var de=0;de<4;de++)le.leftBounds[de]=mt[de],le.rightBounds[de]=he[de];ge.wrapForFullscreen(ge.layer_.source),ge.updatePresent_(),Se();return}if(ge.layer_={predistorted:Ke.predistorted,source:Ke.source,leftBounds:mt.slice(0),rightBounds:he.slice(0)},ge.waitingForPresent_=!1,ge.layer_&&ge.layer_.source){var be=ge.wrapForFullscreen(ge.layer_.source),Ee=function(){var St=wt();ge.isPresenting=be===St,ge.isPresenting?(screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary").catch(function(Qt){console.error("screen.orientation.lock() failed due to",Qt.message)}),ge.waitingForPresent_=!1,ge.beginPresent_(),Se()):(screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),ge.removeFullscreenWrapper(),ge.disableWakeLock(),ge.endPresent_(),ge.removeFullscreenListeners_()),ge.fireVRDisplayPresentChange_()},at=function(){ge.waitingForPresent_&&(ge.removeFullscreenWrapper(),ge.removeFullscreenListeners_(),ge.disableWakeLock(),ge.waitingForPresent_=!1,ge.isPresenting=!1,We(new Error("Unable to present.")))};ge.addFullscreenListeners_(be,Ee,at),tt(be)?(ge.enableWakeLock(),ge.waitingForPresent_=!0):(Q()||V())&&(ge.enableWakeLock(),ge.isPresenting=!0,ge.beginPresent_(),ge.fireVRDisplayPresentChange_(),Se())}!ge.waitingForPresent_&&!Q()&&(dt(),We(new Error("Unable to present.")))})},Bi.prototype.exitPresent=function(){var W=this.isPresenting,ue=this;return this.isPresenting=!1,this.layer_=null,this.disableWakeLock(),new Promise(function(ge,Se){W?(!dt()&&Q()&&(ue.endPresent_(),ue.fireVRDisplayPresentChange_()),V()&&(ue.removeFullscreenWrapper(),ue.removeFullscreenListeners_(),ue.endPresent_(),ue.fireVRDisplayPresentChange_()),ge()):Se(new Error("Was not presenting to VRDisplay."))})},Bi.prototype.getLayers=function(){return this.layer_?[this.layer_]:[]},Bi.prototype.fireVRDisplayPresentChange_=function(){var W=new CustomEvent("vrdisplaypresentchange",{detail:{display:this}});window.dispatchEvent(W)},Bi.prototype.fireVRDisplayConnect_=function(){var W=new CustomEvent("vrdisplayconnect",{detail:{display:this}});window.dispatchEvent(W)},Bi.prototype.addFullscreenListeners_=function(W,ue,ge){this.removeFullscreenListeners_(),this.fullscreenEventTarget_=W,this.fullscreenChangeHandler_=ue,this.fullscreenErrorHandler_=ge,ue&&(document.fullscreenEnabled?W.addEventListener("fullscreenchange",ue,!1):document.webkitFullscreenEnabled?W.addEventListener("webkitfullscreenchange",ue,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenchange",ue,!1):document.msFullscreenEnabled&&W.addEventListener("msfullscreenchange",ue,!1)),ge&&(document.fullscreenEnabled?W.addEventListener("fullscreenerror",ge,!1):document.webkitFullscreenEnabled?W.addEventListener("webkitfullscreenerror",ge,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenerror",ge,!1):document.msFullscreenEnabled&&W.addEventListener("msfullscreenerror",ge,!1))},Bi.prototype.removeFullscreenListeners_=function(){if(this.fullscreenEventTarget_){var W=this.fullscreenEventTarget_;if(this.fullscreenChangeHandler_){var ue=this.fullscreenChangeHandler_;W.removeEventListener("fullscreenchange",ue,!1),W.removeEventListener("webkitfullscreenchange",ue,!1),document.removeEventListener("mozfullscreenchange",ue,!1),W.removeEventListener("msfullscreenchange",ue,!1)}if(this.fullscreenErrorHandler_){var ge=this.fullscreenErrorHandler_;W.removeEventListener("fullscreenerror",ge,!1),W.removeEventListener("webkitfullscreenerror",ge,!1),document.removeEventListener("mozfullscreenerror",ge,!1),W.removeEventListener("msfullscreenerror",ge,!1)}this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null}},Bi.prototype.enableWakeLock=function(){this.wakelock_&&this.wakelock_.enable()},Bi.prototype.disableWakeLock=function(){this.wakelock_&&this.wakelock_.disable()},Bi.prototype.beginPresent_=function(){},Bi.prototype.endPresent_=function(){},Bi.prototype.submitFrame=function(W){},Bi.prototype.getEyeParameters=function(W){return null};var or={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1},dn={LEFT:"left",RIGHT:"right"};function qr(W){var ue=Ui({},or);W=Ui(ue,W||{}),Bi.call(this,{wakelock:W.MOBILE_WAKE_LOCK}),this.config=W,this.displayName="Cardboard VRDisplay",this.capabilities=new Kn({hasPosition:!1,hasOrientation:!0,hasExternalDisplay:!1,canPresent:!0,maxLayers:1}),this.stageParameters=null,this.bufferScale_=this.config.BUFFER_SCALE,this.poseSensor_=new se(this.config),this.distorter_=null,this.cardboardUI_=null,this.dpdb_=new bs(this.config.DPDB_URL,this.onDeviceParamsUpdated_.bind(this)),this.deviceInfo_=new kr(this.dpdb_.getDeviceParams(),W.ADDITIONAL_VIEWERS),this.viewerSelector_=new Ct(W.DEFAULT_VIEWER),this.viewerSelector_.onChange(this.onViewerChanged_.bind(this)),this.deviceInfo_.setViewer(this.viewerSelector_.getCurrentViewer()),this.config.ROTATE_INSTRUCTIONS_DISABLED||(this.rotateInstructions_=new Be),Q()&&window.addEventListener("resize",this.onResize_.bind(this))}return qr.prototype=Object.create(Bi.prototype),qr.prototype._getPose=function(){return{position:null,orientation:this.poseSensor_.getOrientation(),linearVelocity:null,linearAcceleration:null,angularVelocity:null,angularAcceleration:null}},qr.prototype._resetPose=function(){this.poseSensor_.resetPose&&this.poseSensor_.resetPose()},qr.prototype._getFieldOfView=function(W){var ue;if(W==dn.LEFT)ue=this.deviceInfo_.getFieldOfViewLeftEye();else if(W==dn.RIGHT)ue=this.deviceInfo_.getFieldOfViewRightEye();else return console.error("Invalid eye provided: %s",W),null;return ue},qr.prototype._getEyeOffset=function(W){var ue;if(W==dn.LEFT)ue=[-this.deviceInfo_.viewer.interLensDistance*.5,0,0];else if(W==dn.RIGHT)ue=[this.deviceInfo_.viewer.interLensDistance*.5,0,0];else return console.error("Invalid eye provided: %s",W),null;return ue},qr.prototype.getEyeParameters=function(W){var ue=this._getEyeOffset(W),ge=this._getFieldOfView(W),Se={offset:ue,renderWidth:this.deviceInfo_.device.width*.5*this.bufferScale_,renderHeight:this.deviceInfo_.device.height*this.bufferScale_};return Object.defineProperty(Se,"fieldOfView",{enumerable:!0,get:function(){return Ce("VRFieldOfView","VRFrameData's projection matrices"),ge}}),Se},qr.prototype.onDeviceParamsUpdated_=function(W){this.config.DEBUG&&console.log("DPDB reported that device params were updated."),this.deviceInfo_.updateDeviceParams(W),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_)},qr.prototype.updateBounds_=function(){this.layer_&&this.distorter_&&(this.layer_.leftBounds||this.layer_.rightBounds)&&this.distorter_.setTextureBounds(this.layer_.leftBounds,this.layer_.rightBounds)},qr.prototype.beginPresent_=function(){var W=this.layer_.source.getContext("webgl");W||(W=this.layer_.source.getContext("experimental-webgl")),W||(W=this.layer_.source.getContext("webgl2")),W&&(this.layer_.predistorted?this.config.CARDBOARD_UI_DISABLED||(W.canvas.width=Xe()*this.bufferScale_,W.canvas.height=Je()*this.bufferScale_,this.cardboardUI_=new Ue(W)):(this.config.CARDBOARD_UI_DISABLED||(this.cardboardUI_=new Ue(W)),this.distorter_=new yi(W,this.cardboardUI_,this.config.BUFFER_SCALE,this.config.DIRTY_SUBMIT_FRAME_BINDINGS),this.distorter_.updateDeviceInfo(this.deviceInfo_)),this.cardboardUI_&&this.cardboardUI_.listen((function(ue){this.viewerSelector_.show(this.layer_.source.parentElement),ue.stopPropagation(),ue.preventDefault()}).bind(this),(function(ue){this.exitPresent(),ue.stopPropagation(),ue.preventDefault()}).bind(this)),this.rotateInstructions_&&(me()&&$e()?this.rotateInstructions_.showTemporarily(3e3,this.layer_.source.parentElement):this.rotateInstructions_.update()),this.orientationHandler=this.onOrientationChange_.bind(this),window.addEventListener("orientationchange",this.orientationHandler),this.vrdisplaypresentchangeHandler=this.updateBounds_.bind(this),window.addEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler),this.fireVRDisplayDeviceParamsChange_())},qr.prototype.endPresent_=function(){this.distorter_&&(this.distorter_.destroy(),this.distorter_=null),this.cardboardUI_&&(this.cardboardUI_.destroy(),this.cardboardUI_=null),this.rotateInstructions_&&this.rotateInstructions_.hide(),this.viewerSelector_.hide(),window.removeEventListener("orientationchange",this.orientationHandler),window.removeEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler)},qr.prototype.updatePresent_=function(){this.endPresent_(),this.beginPresent_()},qr.prototype.submitFrame=function(W){if(this.distorter_)this.updateBounds_(),this.distorter_.submitFrame();else if(this.cardboardUI_&&this.layer_){var ue=this.layer_.source.getContext("webgl");ue||(ue=this.layer_.source.getContext("experimental-webgl")),ue||(ue=this.layer_.source.getContext("webgl2"));var ge=ue.canvas;(ge.width!=this.lastWidth||ge.height!=this.lastHeight)&&this.cardboardUI_.onResize(),this.lastWidth=ge.width,this.lastHeight=ge.height,this.cardboardUI_.render()}},qr.prototype.onOrientationChange_=function(W){this.viewerSelector_.hide(),this.rotateInstructions_&&this.rotateInstructions_.update(),this.onResize_()},qr.prototype.onResize_=function(W){if(this.layer_){var ue=this.layer_.source.getContext("webgl");ue||(ue=this.layer_.source.getContext("experimental-webgl")),ue||(ue=this.layer_.source.getContext("webgl2"));var ge=["position: absolute","top: 0","left: 0","width: 100vw","height: 100vh","border: 0","margin: 0","padding: 0px","box-sizing: content-box"];ue.canvas.setAttribute("style",ge.join("; ")+";"),hi(ue.canvas)}},qr.prototype.onViewerChanged_=function(W){this.deviceInfo_.setViewer(W),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_),this.fireVRDisplayDeviceParamsChange_()},qr.prototype.fireVRDisplayDeviceParamsChange_=function(){var W=new CustomEvent("vrdisplaydeviceparamschange",{detail:{vrdisplay:this,deviceInfo:this.deviceInfo_}});window.dispatchEvent(W)},qr.VRFrameData=Rn,qr.VRDisplay=Bi,qr})}),v=p(b),_="0.10.12",C={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",PROVIDE_MOBILE_VRDISPLAY:!0,MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1};function E(I){this.config=y(y({},C),I),this.polyfillDisplays=[],this.enabled=!1,this.hasNative="getVRDisplays"in navigator,this.native={},this.native.getVRDisplays=navigator.getVRDisplays,this.native.VRFrameData=window.VRFrameData,this.native.VRDisplay=window.VRDisplay,(!this.hasNative||this.config.PROVIDE_MOBILE_VRDISPLAY&&g())&&(this.enable(),this.getVRDisplays().then(function(D){D&&D[0]&&D[0].fireVRDisplayConnect_&&D[0].fireVRDisplayConnect_()}))}E.prototype.getPolyfillDisplays=function(){if(this._polyfillDisplaysPopulated)return this.polyfillDisplays;if(g()){var I=new v({ADDITIONAL_VIEWERS:this.config.ADDITIONAL_VIEWERS,DEFAULT_VIEWER:this.config.DEFAULT_VIEWER,MOBILE_WAKE_LOCK:this.config.MOBILE_WAKE_LOCK,DEBUG:this.config.DEBUG,DPDB_URL:this.config.DPDB_URL,CARDBOARD_UI_DISABLED:this.config.CARDBOARD_UI_DISABLED,K_FILTER:this.config.K_FILTER,PREDICTION_TIME_S:this.config.PREDICTION_TIME_S,ROTATE_INSTRUCTIONS_DISABLED:this.config.ROTATE_INSTRUCTIONS_DISABLED,YAW_ONLY:this.config.YAW_ONLY,BUFFER_SCALE:this.config.BUFFER_SCALE,DIRTY_SUBMIT_FRAME_BINDINGS:this.config.DIRTY_SUBMIT_FRAME_BINDINGS});this.polyfillDisplays.push(I)}return this._polyfillDisplaysPopulated=!0,this.polyfillDisplays},E.prototype.enable=function(){if(this.enabled=!0,this.hasNative&&this.native.VRFrameData){var I=this.native.VRFrameData,D=new this.native.VRFrameData,L=this.native.VRDisplay.prototype.getFrameData;window.VRDisplay.prototype.getFrameData=function(O){if(O instanceof I){L.call(this,O);return}L.call(this,D),O.pose=D.pose,m(D.leftProjectionMatrix,O.leftProjectionMatrix),m(D.rightProjectionMatrix,O.rightProjectionMatrix),m(D.leftViewMatrix,O.leftViewMatrix),m(D.rightViewMatrix,O.rightViewMatrix)}}navigator.getVRDisplays=this.getVRDisplays.bind(this),window.VRDisplay=v.VRDisplay,window.VRFrameData=v.VRFrameData},E.prototype.getVRDisplays=function(){var I=this;return this.config,this.hasNative?this.native.getVRDisplays.call(navigator).then(function(D){return D.length>0?D:I.getPolyfillDisplays()}):Promise.resolve(this.getPolyfillDisplays())},E.version=_,E.VRFrameData=v.VRFrameData,E.VRDisplay=v.VRDisplay;var T=Object.freeze({default:E}),R=T&&E||T;typeof h<"u"&&h.window&&(h.document||(h.document=h.window.document),h.navigator||(h.navigator=h.window.navigator));var B=R;return B})},"./node_modules/word-wrapper/index.js":l=>{var u=/\n/,c=`
`,h=/\s/;l.exports=function(b,v){var _=l.exports.lines(b,v);return _.map(function(C){return b.substring(C.start,C.end)}).join(`
`)},l.exports.lines=function(b,v){if(v=v||{},v.width===0&&v.mode!=="nowrap")return[];b=b||"";var _=typeof v.width=="number"?v.width:Number.MAX_VALUE,C=Math.max(0,v.start||0),E=typeof v.end=="number"?v.end:b.length,T=v.mode,R=v.measure||y;return T==="pre"?g(R,b,C,E,_):m(R,b,C,E,_,T)};function p(b,v,_,C){var E=b.indexOf(v,_);return E===-1||E>C?C:E}function f(b){return h.test(b)}function g(b,v,_,C,E){for(var T=[],R=_,B=_;B<C&&B<v.length;B++){var I=v.charAt(B),D=u.test(I);if(D||B===C-1){var L=D?B:B+1,O=b(v,R,L,E);T.push(O),R=B+1}}return T}function m(b,v,_,C,E,T){var R=[],B=E;for(T==="nowrap"&&(B=Number.MAX_VALUE);_<C&&_<v.length;){for(var I=p(v,c,_,C);_<I&&f(v.charAt(_));)_++;var D=b(v,_,I,B),L=_+(D.end-D.start),O=L+c.length;if(L<I){for(;L>_&&!f(v.charAt(L));)L--;if(L===_)O>_+c.length&&O--,L=O;else for(O=L;L>_&&f(v.charAt(L-c.length));)L--}if(L>=_){var F=b(v,_,L,B);R.push(F)}_=O}return R}function y(b,v,_,C){var E=Math.min(C,_-v);return{start:v,end:v+E}}},"./node_modules/xhr/index.js":(l,u,c)=>{var h=c("./node_modules/global/window.js"),p=c("./node_modules/is-function/index.js"),f=c("./node_modules/parse-headers/parse-headers.js"),g=c("./node_modules/xtend/immutable.js");l.exports=v,l.exports.default=v,v.XMLHttpRequest=h.XMLHttpRequest||E,v.XDomainRequest="withCredentials"in new v.XMLHttpRequest?v.XMLHttpRequest:h.XDomainRequest,m(["get","put","post","patch","head","delete"],function(T){v[T==="delete"?"del":T]=function(R,B,I){return B=b(R,B,I),B.method=T.toUpperCase(),_(B)}});function m(T,R){for(var B=0;B<T.length;B++)R(T[B])}function y(T){for(var R in T)if(T.hasOwnProperty(R))return!1;return!0}function b(T,R,B){var I=T;return p(R)?(B=R,typeof T=="string"&&(I={uri:T})):I=g(R,{uri:T}),I.callback=B,I}function v(T,R,B){return R=b(T,R,B),_(R)}function _(T){if(typeof T.callback>"u")throw new Error("callback argument missing");var R=!1,B=function(Ae,_e,me){R||(R=!0,T.callback(Ae,_e,me))};function I(){F.readyState===4&&setTimeout(O,0)}function D(){var Ae=void 0;if(F.response?Ae=F.response:Ae=F.responseText||C(F),te)try{Ae=JSON.parse(Ae)}catch{}return Ae}function L(Ae){return clearTimeout(K),Ae instanceof Error||(Ae=new Error(""+(Ae||"Unknown XMLHttpRequest Error"))),Ae.statusCode=0,B(Ae,ae)}function O(){if(!H){var Ae;clearTimeout(K),T.useXDR&&F.status===void 0?Ae=200:Ae=F.status===1223?204:F.status;var _e=ae,me=null;return Ae!==0?(_e={body:D(),statusCode:Ae,method:J,headers:{},url:G,rawRequest:F},F.getAllResponseHeaders&&(_e.headers=f(F.getAllResponseHeaders()))):me=new Error("Internal XMLHttpRequest Error"),B(me,_e,_e.body)}}var F=T.xhr||null;F||(T.cors||T.useXDR?F=new v.XDomainRequest:F=new v.XMLHttpRequest);var q,H,G=F.url=T.uri||T.url,J=F.method=T.method||"GET",Q=T.body||T.data,V=F.headers=T.headers||{},z=!!T.sync,te=!1,K,ae={body:void 0,headers:{},statusCode:0,method:J,url:G,rawRequest:F};if("json"in T&&T.json!==!1&&(te=!0,V.accept||V.Accept||(V.Accept="application/json"),J!=="GET"&&J!=="HEAD"&&(V["content-type"]||V["Content-Type"]||(V["Content-Type"]="application/json"),Q=JSON.stringify(T.json===!0?Q:T.json))),F.onreadystatechange=I,F.onload=O,F.onerror=L,F.onprogress=function(){},F.onabort=function(){H=!0},F.ontimeout=L,F.open(J,G,!z,T.username,T.password),z||(F.withCredentials=!!T.withCredentials),!z&&T.timeout>0&&(K=setTimeout(function(){if(!H){H=!0,F.abort("timeout");var Ae=new Error("XMLHttpRequest timeout");Ae.code="ETIMEDOUT",L(Ae)}},T.timeout)),F.setRequestHeader)for(q in V)V.hasOwnProperty(q)&&F.setRequestHeader(q,V[q]);else if(T.headers&&!y(T.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in T&&(F.responseType=T.responseType),"beforeSend"in T&&typeof T.beforeSend=="function"&&T.beforeSend(F),F.send(Q||null),F}function C(T){try{if(T.responseType==="document")return T.responseXML;var R=T.responseXML&&T.responseXML.documentElement.nodeName==="parsererror";if(T.responseType===""&&!R)return T.responseXML}catch{}return null}function E(){}},"./node_modules/xml-parse-from-string/index.js":l=>{l.exports=function(){return typeof self.DOMParser<"u"?function(u){var c=new self.DOMParser;return c.parseFromString(u,"application/xml")}:typeof self.ActiveXObject<"u"&&new self.ActiveXObject("Microsoft.XMLDOM")?function(u){var c=new self.ActiveXObject("Microsoft.XMLDOM");return c.async="false",c.loadXML(u),c}:function(u){var c=document.createElement("div");return c.innerHTML=u,c}}()},"./node_modules/xtend/immutable.js":l=>{l.exports=c;var u=Object.prototype.hasOwnProperty;function c(){for(var h={},p=0;p<arguments.length;p++){var f=arguments[p];for(var g in f)u.call(f,g)&&(h[g]=f[g])}return h}},"./src/components/anchored.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/utils/index.js"),f=p.debug("components:anchored:warn");l.exports.Component=h("anchored",{schema:{persistent:{default:!1}},init:function(){var m=this.el.sceneEl,y=m.getAttribute("webxr"),b=y.optionalFeatures;b.indexOf("anchors")===-1&&(b.push("anchors"),this.el.sceneEl.setAttribute("webxr",y)),this.auxQuaternion=new THREE.Quaternion,this.onEnterVR=this.onEnterVR.bind(this),this.el.sceneEl.addEventListener("enter-vr",this.onEnterVR)},onEnterVR:function(){this.anchor=void 0,this.requestPersistentAnchorPending=this.data.persistent,this.requestAnchorPending=!this.data.persistent},tick:function(){var m=this.el.sceneEl,y=m.renderer.xr,b,v,_,C=this.el.object3D;!m.is("ar-mode")&&!m.is("vr-mode")||(!this.anchor&&this.requestPersistentAnchorPending&&this.restorePersistentAnchor(),!this.anchor&&this.requestAnchorPending&&this.createAnchor(),this.anchor&&(b=m.frame,v=y.getReferenceSpace(),_=b.getPose(this.anchor.anchorSpace,v),C.matrix.elements=_.transform.matrix,C.matrix.decompose(C.position,C.rotation,C.scale)))},createAnchor:async function(m,y){var b=this.el.sceneEl,v=b.renderer.xr,_,C,E,T,R=this.el.object3D;if(m=m||R.position,y=y||this.auxQuaternion.setFromEuler(R.rotation),!g(b)){f("This browser doesn't support the WebXR anchors module");return}this.anchor&&this.deleteAnchor(),_=b.frame,C=v.getReferenceSpace(),E=new XRRigidTransform({x:m.x,y:m.y,z:m.z},{x:y.x,y:y.y,z:y.z,w:y.w}),this.requestAnchorPending=!1,T=await _.createAnchor(E,C),this.data.persistent&&(this.el.id?(this.persistentHandle=await T.requestPersistentHandle(),localStorage.setItem(this.el.id,this.persistentHandle)):f("The anchor won't be persisted because the entity has no assigned id.")),b.object3D.attach(this.el.object3D),this.anchor=T},restorePersistentAnchor:async function(){var m=this.el.sceneEl.renderer.xr,y=m.getSession(),b=y.persistentAnchors,v;if(this.requestPersistentAnchorPending=!1,!this.el.id){f("The entity associated to the persistent anchor cannot be retrieved because it doesn't have an assigned id."),this.requestAnchorPending=!0;return}if(b){v=localStorage.getItem(this.el.id);for(var _=0;_<b.length;++_)if(v===b[_]){this.anchor=await y.restorePersistentAnchor(b[_]),this.anchor&&(this.persistentHandle=b[_]);break}this.anchor||(this.requestAnchorPending=!0)}else this.requestPersistentAnchorPending=!0},deleteAnchor:function(){var m,y,b=this.anchor;b&&(m=this.el.sceneEl.renderer.xr,y=m.getSession(),b.delete(),this.el.sceneEl.object3D.add(this.el.object3D),this.persistentHandle&&y.deletePersistentAnchor(this.persistentHandle),this.anchor=void 0)}});function g(m){var y=m.renderer.xr,b=y.getSession();return b&&b.restorePersistentAnchor}},"./src/components/animation.js":(l,u,c)=>{var h=c("./node_modules/super-animejs/lib/anime.es.js").default,p=c("./src/core/component.js").components,f=c("./src/core/component.js").registerComponent,g=c("./src/lib/three.js"),m=c("./src/utils/index.js"),y=new g.Color,b=new g.Color,v=m.entity.getComponentProperty,_=m.entity.setComponentProperty,C={},E="color",T="position",R="rotation",B="scale",I="components",D="object3D";l.exports.Component=f("animation",{schema:{autoplay:{default:!0},delay:{default:0},dir:{default:""},dur:{default:1e3},easing:{default:"easeInQuad"},elasticity:{default:400},enabled:{default:!0},from:{default:""},loop:{default:0,parse:function(V){return V===!0||V==="true"?!0:V===!1||V==="false"?!1:parseInt(V,10)}},property:{default:""},startEvents:{type:"array"},pauseEvents:{type:"array"},resumeEvents:{type:"array"},round:{default:!1},to:{default:""},type:{default:""},isRawProperty:{default:!1}},multiple:!0,init:function(){var V=this;this.eventDetail={name:this.attrName},this.time=0,this.animation=null,this.animationIsPlaying=!1,this.onStartEvent=this.onStartEvent.bind(this),this.beginAnimation=this.beginAnimation.bind(this),this.pauseAnimation=this.pauseAnimation.bind(this),this.resumeAnimation=this.resumeAnimation.bind(this),this.fromColor={},this.toColor={},this.targets={},this.targetsArray=[],this.updateConfigForDefault=this.updateConfigForDefault.bind(this),this.updateConfigForRawColor=this.updateConfigForRawColor.bind(this),this.config={complete:function(){V.animationIsPlaying=!1,V.el.emit("animationcomplete",V.eventDetail,!1),V.id&&V.el.emit("animationcomplete__"+V.id,V.eventDetail,!1)}}},update:function(V){var z=this.config,te=this.data;this.animationIsPlaying=!1,this.data.enabled&&te.property&&(z.autoplay=!1,z.direction=te.dir,z.duration=te.dur,z.easing=te.easing,z.elasticity=te.elasticity,z.loop=te.loop,z.round=te.round,this.createAndStartAnimation())},tick:function(V,z){this.animationIsPlaying&&(this.time+=z,this.animation.tick(this.time))},remove:function(){this.pauseAnimation(),this.removeEventListeners()},pause:function(){this.paused=!0,this.pausedWasPlaying=this.animationIsPlaying,this.pauseAnimation(),this.removeEventListeners()},play:function(){this.paused&&(this.paused=!1,this.addEventListeners(),this.pausedWasPlaying&&(this.resumeAnimation(),this.pausedWasPlaying=!1))},createAndStartAnimation:function(){var V=this.data;if(this.updateConfig(),this.animationIsPlaying=!1,this.animation=h(this.config),this.animation.began=!0,this.removeEventListeners(),this.addEventListeners(),!(!V.autoplay||V.startEvents&&V.startEvents.length)){if(V.delay){setTimeout(this.beginAnimation,V.delay);return}this.beginAnimation()}},beginAnimation:function(){this.updateConfig(),this.animation.began=!0,this.time=0,this.animationIsPlaying=!0,this.stopRelatedAnimations(),this.el.emit("animationbegin",this.eventDetail,!1)},pauseAnimation:function(){this.animationIsPlaying=!1},resumeAnimation:function(){this.animationIsPlaying=!0},onStartEvent:function(){if(this.data.enabled){if(this.updateConfig(),this.animation&&this.animation.pause(),this.animation=h(this.config),this.data.delay){setTimeout(this.beginAnimation,this.data.delay);return}this.beginAnimation()}},updateConfigForRawColor:function(){var V=this.config,z=this.data,te=this.el,K,ae,Ae;if(!this.waitComponentInitRawProperty(this.updateConfigForRawColor)){K=z.from===""?H(te,z.property):z.from,Ae=z.to,this.setColorConfig(K,Ae),K=this.fromColor,Ae=this.toColor,this.targetsArray.length=0,this.targetsArray.push(K),V.targets=this.targetsArray;for(ae in Ae)V[ae]=Ae[ae];V.update=function(){var _e={};return function(me){var Pe;Pe=me.animatables[0].target,!(Pe.r===_e.r&&Pe.g===_e.g&&Pe.b===_e.b)&&G(te,z.property,Pe,z.type)}}()}},updateConfigForDefault:function(){var V=this.config,z=this.data,te=this.el,K,ae,Ae,_e;this.waitComponentInitRawProperty(this.updateConfigForDefault)||(z.from===""?K=Q(z)?H(te,z.property):v(te,z.property):K=z.from,_e=z.to,Ae=!isNaN(K||_e),Ae?(K=parseFloat(K),_e=parseFloat(_e)):(K=K&&K.toString(),_e=_e&&_e.toString()),ae=z.to==="true"||z.to==="false"||z.to===!0||z.to===!1,ae&&(K=z.from==="true"||z.from===!0?1:0,_e=z.to==="true"||z.to===!0?1:0),this.targets.aframeProperty=K,V.targets=this.targets,V.aframeProperty=_e,V.update=function(){var me;return function(Pe){var Xe;Xe=Pe.animatables[0].target.aframeProperty,Xe!==me&&(me=Xe,ae&&(Xe=Xe>=1),Q(z)?G(te,z.property,Xe,z.type):_(te,z.property,Xe))}}())},updateConfigForVector:function(){var V=this.config,z=this.data,te=this.el,K,ae,Ae;ae=z.from!==""?m.coordinates.parse(z.from):v(te,z.property),Ae=m.coordinates.parse(z.to),z.property===R&&(O(ae),O(Ae)),this.targetsArray.length=0,this.targetsArray.push(ae),V.targets=this.targetsArray;for(K in Ae)V[K]=Ae[K];if(z.property===T||z.property===R||z.property===B){V.update=function(){var _e={};return function(me){var Pe=me.animatables[0].target;Pe.x===_e.x&&Pe.y===_e.y&&Pe.z===_e.z||(_e.x=Pe.x,_e.y=Pe.y,_e.z=Pe.z,te.object3D[z.property].set(Pe.x,Pe.y,Pe.z))}}();return}V.update=function(){var _e={};return function(me){var Pe=me.animatables[0].target;Pe.x===_e.x&&Pe.y===_e.y&&Pe.z===_e.z||(_e.x=Pe.x,_e.y=Pe.y,_e.z=Pe.z,_(te,z.property,Pe))}}()},updateConfig:function(){var V;V=L(this.el,this.data.property),Q(this.data)&&this.data.type===E?this.updateConfigForRawColor():V==="vec2"||V==="vec3"||V==="vec4"?this.updateConfigForVector():this.updateConfigForDefault()},waitComponentInitRawProperty:function(V){var z,te=this.data,K=this.el,ae=this;return te.from!==""||!te.property.startsWith(I)||(z=J(te.property)[1],K.components[z])?!1:(K.addEventListener("componentinitialized",function Ae(_e){_e.detail.name===z&&(V(),ae.animation=h(ae.config),K.removeEventListener("componentinitialized",Ae))}),!0)},stopRelatedAnimations:function(){var V,z;for(z in this.el.components)V=this.el.components[z],z!==this.attrName&&V.name==="animation"&&V.animationIsPlaying&&V.data.property===this.data.property&&(V.animationIsPlaying=!1)},addEventListeners:function(){var V=this.data,z=this.el;F(z,V.startEvents,this.onStartEvent),F(z,V.pauseEvents,this.pauseAnimation),F(z,V.resumeEvents,this.resumeAnimation)},removeEventListeners:function(){var V=this.data,z=this.el;q(z,V.startEvents,this.onStartEvent),q(z,V.pauseEvents,this.pauseAnimation),q(z,V.resumeEvents,this.resumeAnimation)},setColorConfig:function(V,z){y.set(V),b.set(z),V=this.fromColor,z=this.toColor,V.r=y.r,V.g=y.g,V.b=y.b,z.r=b.r,z.g=b.g,z.b=b.b}});function L(V,z){var te,K,ae,Ae;return ae=z.split("."),K=ae[0],Ae=ae[1],te=V.components[K]||p[K],!te||Ae&&!te.schema[Ae]?null:Ae?te.schema[Ae].type:te.schema.type}function O(V){V.x=g.MathUtils.degToRad(V.x),V.y=g.MathUtils.degToRad(V.y),V.z=g.MathUtils.degToRad(V.z)}function F(V,z,te){var K;for(K=0;K<z.length;K++)V.addEventListener(z[K],te)}function q(V,z,te){var K;for(K=0;K<z.length;K++)V.removeEventListener(z[K],te)}function H(V,z){var te,K,ae;for(K=J(z),ae=V,te=0;te<K.length;te++)ae=ae[K[te]];if(ae===void 0)throw console.log(V),new Error("[animation] property ("+z+") could not be found");return ae}function G(V,z,te,K){var ae,Ae,_e,me;for(z.startsWith("object3D.rotation")&&(te=g.MathUtils.degToRad(te)),Ae=J(z),me=V,ae=0;ae<Ae.length-1;ae++)me=me[Ae[ae]];if(_e=Ae[Ae.length-1],K===E){"r"in me[_e]?(me[_e].r=te.r,me[_e].g=te.g,me[_e].b=te.b):(me[_e].x=te.r,me[_e].y=te.g,me[_e].z=te.b);return}me[_e]=te}function J(V){return V in C||(C[V]=V.split(".")),C[V]}function Q(V){return V.isRawProperty||V.property.startsWith(I)||V.property.startsWith(D)}},"./src/components/camera.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/lib/three.js");l.exports.Component=h("camera",{schema:{active:{default:!0},far:{default:1e4},fov:{default:80,min:0},near:{default:.005,min:0},spectator:{default:!1},zoom:{default:1,min:0}},init:function(){var f,g=this.el;f=this.camera=new p.PerspectiveCamera,g.setObject3D("camera",f)},update:function(f){var g=this.data,m=this.camera;m.aspect=g.aspect||window.innerWidth/window.innerHeight,m.far=g.far,m.fov=g.fov,m.near=g.near,m.zoom=g.zoom,m.updateProjectionMatrix(),this.updateActiveCamera(f),this.updateSpectatorCamera(f)},updateActiveCamera:function(f){var g=this.data,m=this.el,y=this.system;f&&f.active===g.active||g.spectator||(g.active&&y.activeCameraEl!==m?y.setActiveCamera(m):!g.active&&y.activeCameraEl===m&&y.disableActiveCamera())},updateSpectatorCamera:function(f){var g=this.data,m=this.el,y=this.system;f&&f.spectator===g.spectator||(g.spectator&&y.spectatorCameraEl!==m?y.setSpectatorCamera(m):!g.spectator&&y.spectatorCameraEl===m&&y.disableSpectatorCamera())},remove:function(){this.el.removeObject3D("camera")}})},"./src/components/cursor.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/utils/index.js"),f={CLICK:"click",FUSING:"fusing",MOUSEENTER:"mouseenter",MOUSEDOWN:"mousedown",MOUSELEAVE:"mouseleave",MOUSEUP:"mouseup"},g={FUSING:"cursor-fusing",HOVERING:"cursor-hovering",HOVERED:"cursor-hovered"},m={DOWN:["mousedown","touchstart"],UP:["mouseup","touchend"]},y={DOWN:["selectstart"],UP:["selectend"]},b="a-mouse-cursor-hover";l.exports.Component=h("cursor",{dependencies:["raycaster"],schema:{downEvents:{default:[]},fuse:{default:p.device.isMobile()},fuseTimeout:{default:1500,min:0},mouseCursorStylesEnabled:{default:!0},upEvents:{default:[]},rayOrigin:{default:"entity",oneOf:["mouse","entity","xrselect"]}},after:["tracked-controls"],multiple:!0,init:function(){var v=this;this.fuseTimeout=void 0,this.cursorDownEl=null,this.intersectedEl=null,this.canvasBounds=document.body.getBoundingClientRect(),this.isCursorDown=!1,this.activeXRInput=null,this.updateCanvasBounds=p.debounce(function(){v.canvasBounds=v.el.sceneEl.canvas.getBoundingClientRect()},500),this.eventDetail={},this.intersectedEventDetail={cursorEl:this.el},this.onCursorDown=this.onCursorDown.bind(this),this.onCursorUp=this.onCursorUp.bind(this),this.onIntersection=this.onIntersection.bind(this),this.onIntersectionCleared=this.onIntersectionCleared.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onEnterVR=this.onEnterVR.bind(this)},update:function(v){this.data.rayOrigin!==v.rayOrigin&&this.updateMouseEventListeners()},tick:function(){var v=this.el.sceneEl.frame,_=this.activeXRInput;this.data.rayOrigin==="xrselect"&&v&&_&&this.onMouseMove({frame:v,inputSource:_,type:"fakeselectevent"})},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners()},remove:function(){var v=this.el;v.removeState(g.HOVERING),v.removeState(g.FUSING),clearTimeout(this.fuseTimeout),this.intersectedEl&&this.intersectedEl.removeState(g.HOVERED),this.removeEventListeners()},addEventListeners:function(){var v,_=this.data,C=this.el,E=this;function T(){v=C.sceneEl.canvas,!(_.downEvents.length||_.upEvents.length)&&(m.DOWN.forEach(function(R){v.addEventListener(R,E.onCursorDown,{passive:!1})}),m.UP.forEach(function(R){v.addEventListener(R,E.onCursorUp,{passive:!1})}))}v=C.sceneEl.canvas,v?T():C.sceneEl.addEventListener("render-target-loaded",T),_.downEvents.forEach(function(R){C.addEventListener(R,E.onCursorDown)}),_.upEvents.forEach(function(R){C.addEventListener(R,E.onCursorUp)}),C.addEventListener("raycaster-intersection",this.onIntersection),C.addEventListener("raycaster-closest-entity-changed",this.onIntersection),C.addEventListener("raycaster-intersection-cleared",this.onIntersectionCleared),C.sceneEl.addEventListener("rendererresize",this.updateCanvasBounds),C.sceneEl.addEventListener("enter-vr",this.onEnterVR),window.addEventListener("resize",this.updateCanvasBounds),window.addEventListener("scroll",this.updateCanvasBounds),this.updateMouseEventListeners()},removeEventListeners:function(){var v,_=this.data,C=this.el,E=this;v=C.sceneEl.canvas,v&&!_.downEvents.length&&!_.upEvents.length&&(m.DOWN.forEach(function(T){v.removeEventListener(T,E.onCursorDown)}),m.UP.forEach(function(T){v.removeEventListener(T,E.onCursorUp)})),_.downEvents.forEach(function(T){C.removeEventListener(T,E.onCursorDown)}),_.upEvents.forEach(function(T){C.removeEventListener(T,E.onCursorUp)}),C.removeEventListener("raycaster-intersection",this.onIntersection),C.removeEventListener("raycaster-intersection-cleared",this.onIntersectionCleared),v.removeEventListener("mousemove",this.onMouseMove),v.removeEventListener("touchstart",this.onMouseMove),v.removeEventListener("touchmove",this.onMouseMove),C.sceneEl.removeEventListener("rendererresize",this.updateCanvasBounds),C.sceneEl.removeEventListener("enter-vr",this.onEnterVR),window.removeEventListener("resize",this.updateCanvasBounds),window.removeEventListener("scroll",this.updateCanvasBounds)},updateMouseEventListeners:function(){var v,_=this.el;v=_.sceneEl.canvas,v.removeEventListener("mousemove",this.onMouseMove),v.removeEventListener("touchmove",this.onMouseMove),_.setAttribute("raycaster","useWorldCoordinates",!1),this.data.rayOrigin==="mouse"&&(v.addEventListener("mousemove",this.onMouseMove),v.addEventListener("touchmove",this.onMouseMove,{passive:!1}),_.setAttribute("raycaster","useWorldCoordinates",!0),this.updateCanvasBounds())},onMouseMove:function(){var v=new THREE.Vector3,_=new THREE.Vector2,C=new THREE.Vector3,E={origin:C,direction:v};return function(T){var R=this.canvasBounds,B=this.el.sceneEl.camera,I,D,L,O,F,q,H,G;B.parent.updateMatrixWorld(),T.type==="touchmove"||T.type==="touchstart"?D=T.touches.item(0):D=T,I=D.clientX-R.left,L=D.clientY-R.top,_.x=I/R.width*2-1,_.y=-(L/R.height)*2+1,this.data.rayOrigin==="xrselect"&&(T.type==="selectstart"||T.type==="fakeselectevent")?(O=T.frame,F=T.inputSource,q=this.el.renderer.xr.getReferenceSpace(),H=O.getPose(F.targetRaySpace,q),G=H.transform,v.set(0,0,-1),v.applyQuaternion(G.orientation),C.copy(G.position)):T.type==="fakeselectout"?(v.set(0,1,0),C.set(0,9999,0)):B&&B.isPerspectiveCamera?(C.setFromMatrixPosition(B.matrixWorld),v.set(_.x,_.y,.5).unproject(B).sub(C).normalize()):B&&B.isOrthographicCamera?(C.set(_.x,_.y,(B.near+B.far)/(B.near-B.far)).unproject(B),v.set(0,0,-1).transformDirection(B.matrixWorld)):console.error("AFRAME.Raycaster: Unsupported camera type: "+B.type),this.el.setAttribute("raycaster",E),T.type==="touchmove"&&T.preventDefault()}}(),onCursorDown:function(v){this.isCursorDown=!0,this.data.rayOrigin==="mouse"&&v.type==="touchstart"&&(this.onMouseMove(v),this.el.components.raycaster.checkIntersections(),v.preventDefault()),this.data.rayOrigin==="xrselect"&&v.type==="selectstart"&&(this.activeXRInput=v.inputSource,this.onMouseMove(v),this.el.components.raycaster.checkIntersections(),this.el.components.raycaster.intersectedEls.length&&this.el.sceneEl.components["ar-hit-test"]!==void 0&&this.el.sceneEl.getAttribute("ar-hit-test").enabled&&(this.el.sceneEl.setAttribute("ar-hit-test","enabled",!1),this.reenableARHitTest=!0)),this.twoWayEmit(f.MOUSEDOWN,v),this.cursorDownEl=this.intersectedEl},onCursorUp:function(v){if(this.isCursorDown){this.isCursorDown=!1;var _=this.data;this.twoWayEmit(f.MOUSEUP,v),this.reenableARHitTest===!0&&(this.el.sceneEl.setAttribute("ar-hit-test","enabled",!0),this.reenableARHitTest=void 0),this.cursorDownEl&&this.cursorDownEl!==this.intersectedEl&&(this.intersectedEventDetail.intersection=null,this.cursorDownEl.emit(f.MOUSEUP,this.intersectedEventDetail)),(!_.fuse||_.rayOrigin==="mouse"||_.rayOrigin==="xrselect")&&this.intersectedEl&&this.cursorDownEl===this.intersectedEl&&this.twoWayEmit(f.CLICK,v),_.rayOrigin==="xrselect"&&this.activeXRInput===v.inputSource&&this.onMouseMove({type:"fakeselectout"}),this.activeXRInput=null,this.cursorDownEl=null,v.type==="touchend"&&v.preventDefault()}},onIntersection:function(v){var _,C=this.el,E,T,R;E=v.detail.els[0]===C?1:0,R=v.detail.intersections[E],T=v.detail.els[E],T&&this.intersectedEl!==T&&(this.intersectedEl&&(_=this.el.components.raycaster.getIntersection(this.intersectedEl),_&&_.distance<=R.distance)||(this.clearCurrentIntersection(!0),this.setIntersection(T,R)))},onIntersectionCleared:function(v){var _=v.detail.clearedEls;_.indexOf(this.intersectedEl)!==-1&&this.clearCurrentIntersection()},onEnterVR:function(){this.clearCurrentIntersection(!0);var v=this.el.sceneEl.xrSession,_=this;v&&this.data.rayOrigin!=="mouse"&&(y.DOWN.forEach(function(C){v.addEventListener(C,_.onCursorDown)}),y.UP.forEach(function(C){v.addEventListener(C,_.onCursorUp)}))},setIntersection:function(v,_){var C=this.el,E=this.data,T=this;this.intersectedEl!==v&&(this.intersectedEl=v,C.addState(g.HOVERING),v.addState(g.HOVERED),this.twoWayEmit(f.MOUSEENTER),this.data.mouseCursorStylesEnabled&&this.data.rayOrigin==="mouse"&&this.el.sceneEl.canvas.classList.add(b),!(E.fuseTimeout===0||!E.fuse||E.rayOrigin==="xrselect"||E.rayOrigin==="mouse")&&(C.addState(g.FUSING),this.twoWayEmit(f.FUSING),this.fuseTimeout=setTimeout(function(){C.removeState(g.FUSING),T.twoWayEmit(f.CLICK)},E.fuseTimeout)))},clearCurrentIntersection:function(v){var _,C,E,T=this.el;this.intersectedEl&&(this.intersectedEl.removeState(g.HOVERED),T.removeState(g.HOVERING),T.removeState(g.FUSING),this.twoWayEmit(f.MOUSELEAVE),this.data.mouseCursorStylesEnabled&&this.data.rayOrigin==="mouse"&&this.el.sceneEl.canvas.classList.remove(b),this.intersectedEl=null,clearTimeout(this.fuseTimeout),v!==!0&&(E=this.el.components.raycaster.intersections,E.length!==0&&(_=E[0].object.el===T?1:0,C=E[_],C&&this.setIntersection(C.object.el,C))))},twoWayEmit:function(v,_){var C=this.el,E=this.intersectedEl,T;function R(B,I){_ instanceof MouseEvent?B.mouseEvent=_:typeof TouchEvent<"u"&&_ instanceof TouchEvent&&(B.touchEvent=_)}T=this.el.components.raycaster.getIntersection(E),this.eventDetail.intersectedEl=E,this.eventDetail.intersection=T,R(this.eventDetail),C.emit(v,this.eventDetail),E&&(this.intersectedEventDetail.intersection=T,R(this.intersectedEventDetail),E.emit(v,this.intersectedEventDetail))}})},"./src/components/generic-tracked-controller-controls.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/utils/tracked-controls.js"),f=p.checkControllerPresentAndSetup,g=p.emitIfAxesChanged,m=p.onButtonEvent,y="generic",b={axes:{touchpad:[0,1],thumbstick:[2,3]},buttons:["trigger","squeeze","touchpad","thumbstick"]};l.exports.Component=h("generic-tracked-controller-controls",{schema:{hand:{default:""},defaultModel:{default:!0},defaultModelColor:{default:"gray"},orientationOffset:{type:"vec3"},disabled:{default:!1}},after:["tracked-controls"],mapping:b,bindMethods:function(){this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},init:function(){var v=this;this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(_){m(_.detail.id,"down",v)},this.onButtonUp=function(_){m(_.detail.id,"up",v)},this.onButtonTouchStart=function(_){m(_.detail.id,"touchstart",v)},this.onButtonTouchEnd=function(_){m(_.detail.id,"touchend",v)},this.controllerPresent=!1,this.wasControllerConnected=!1,this.lastControllerCheck=0,this.bindMethods(),this.el.addEventListener("controllerconnected",function(_){_.detail.name!==v.name&&(v.wasControllerConnected=!0,v.removeEventListeners(),v.removeControllersUpdateListener())})},addEventListeners:function(){var v=this.el;v.addEventListener("buttonchanged",this.onButtonChanged),v.addEventListener("buttondown",this.onButtonDown),v.addEventListener("buttonup",this.onButtonUp),v.addEventListener("touchstart",this.onButtonTouchStart),v.addEventListener("touchend",this.onButtonTouchEnd),v.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var v=this.el;v.removeEventListener("buttonchanged",this.onButtonChanged),v.removeEventListener("buttondown",this.onButtonDown),v.removeEventListener("buttonup",this.onButtonUp),v.removeEventListener("touchstart",this.onButtonTouchStart),v.removeEventListener("touchend",this.onButtonTouchEnd),v.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var v=this.data,_=v.hand?v.hand:void 0;f(this,y,{hand:_,iterateControllerProfiles:!0})},play:function(){this.wasControllerConnected||(this.checkIfControllerPresent(),this.addControllersUpdateListener())},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var v=this.el,_=this.data;if(this.el.components["tracked-controls"]){this.removeEventListeners();return}v.setAttribute("tracked-controls",{hand:_.hand,idPrefix:y,orientationOffset:_.orientationOffset,iterateControllerProfiles:!0}),this.data.defaultModel&&this.initDefaultModel()},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.wasControllerConnected&&this.checkIfControllerPresent()},onButtonChanged:function(v){var _=this.mapping.buttons[v.detail.id];_&&this.el.emit(_+"changed",v.detail.state)},onAxisMoved:function(v){g(this,this.mapping.axes,v)},initDefaultModel:function(){var v=this.modelEl=document.createElement("a-entity");v.setAttribute("geometry",{primitive:"sphere",radius:.03}),v.setAttribute("material",{color:this.data.color}),this.el.appendChild(v),this.el.emit("controllermodelready",{name:"generic-tracked-controller-controls",model:this.modelEl,rayOrigin:{origin:{x:0,y:0,z:-.01},direction:{x:0,y:0,z:-1}}})}})},"./src/components/geometry.js":(l,u,c)=>{var h=c("./src/core/geometry.js").geometries,p=c("./src/core/geometry.js").geometryNames,f=c("./src/core/component.js").registerComponent,g=c("./src/lib/three.js"),m=new g.BufferGeometry;l.exports.Component=f("geometry",{schema:{buffer:{default:!0},primitive:{default:"box",oneOf:p,schemaChange:!0},skipCache:{default:!1}},init:function(){this.geometry=null},update:function(y){var b=this.data,v=this.el,_,C=this.system;this.geometry&&(C.unuseGeometry(y),this.geometry=null),this.geometry=C.getOrCreateGeometry(b),_=v.getObject3D("mesh"),_?_.geometry=this.geometry:(_=new g.Mesh,_.geometry=this.geometry,this.el.getAttribute("material")||(_.material=new g.MeshStandardMaterial({color:Math.random()*16777215,metalness:0,roughness:.5})),v.setObject3D("mesh",_))},remove:function(){this.system.unuseGeometry(this.data),this.el.getObject3D("mesh").geometry=m,this.geometry=null},updateSchema:function(y){var b=this.oldData&&this.oldData.primitive,v=y.primitive,_=h[v]&&h[v].schema;if(!_)throw new Error("Unknown geometry schema `"+v+"`");b&&b===v||this.extendSchema(_)}})},"./src/components/gltf-model.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/lib/three.js"),f=c("./src/utils/index.js"),g=f.debug("components:gltf-model:warn");l.exports.Component=h("gltf-model",{schema:{type:"model"},init:function(){var m=this,y=this.system.getDRACOLoader(),b=this.system.getMeshoptDecoder(),v=this.system.getKTX2Loader();this.model=null,this.loader=new p.GLTFLoader,y&&this.loader.setDRACOLoader(y),b?this.ready=b.then(function(_){m.loader.setMeshoptDecoder(_)}):this.ready=Promise.resolve(),v&&this.loader.setKTX2Loader(v)},update:function(){var m=this,y=this.el,b=this.data;b&&(this.remove(),this.ready.then(function(){m.loader.load(b,function(v){m.model=v.scene||v.scenes[0],m.model.animations=v.animations,y.setObject3D("mesh",m.model),y.emit("model-loaded",{format:"gltf",model:m.model})},void 0,function(v){var _=v&&v.message?v.message:"Failed to load glTF model";g(_),y.emit("model-error",{format:"gltf",src:b})})}))},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},"./src/components/grabbable.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent;h("grabbable",{init:function(){this.el.setAttribute("obb-collider","centerModel: true")}})},"./src/components/hand-controls.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/constants/index.js").AFRAME_CDN_ROOT,f={toonLeft:p+"controllers/hands/leftHand.glb",toonRight:p+"controllers/hands/rightHand.glb",lowPolyLeft:p+"controllers/hands/leftHandLow.glb",lowPolyRight:p+"controllers/hands/rightHandLow.glb",highPolyLeft:p+"controllers/hands/leftHandHigh.glb",highPolyRight:p+"controllers/hands/rightHandHigh.glb"},g={open:"Open",point:"Point",pointThumb:"Point + Thumb",fist:"Fist",hold:"Hold",thumbUp:"Thumb Up"},m={};m[g.fist]="grip",m[g.thumbUp]="pistol",m[g.point]="pointing",l.exports.Component=h("hand-controls",{schema:{color:{default:"white",type:"color"},hand:{default:"left"},handModelStyle:{default:"lowPoly",oneOf:["lowPoly","highPoly","toon"]}},after:["tracked-controls"],init:function(){var v=this,_=this.el;this.pressedButtons={},this.touchedButtons={},this.loader=new THREE.GLTFLoader,this.loader.setCrossOrigin("anonymous"),this.onGripDown=function(){v.handleButton("grip","down")},this.onGripUp=function(){v.handleButton("grip","up")},this.onTrackpadDown=function(){v.handleButton("trackpad","down")},this.onTrackpadUp=function(){v.handleButton("trackpad","up")},this.onTrackpadTouchStart=function(){v.handleButton("trackpad","touchstart")},this.onTrackpadTouchEnd=function(){v.handleButton("trackpad","touchend")},this.onTriggerDown=function(){v.handleButton("trigger","down")},this.onTriggerUp=function(){v.handleButton("trigger","up")},this.onTriggerTouchStart=function(){v.handleButton("trigger","touchstart")},this.onTriggerTouchEnd=function(){v.handleButton("trigger","touchend")},this.onGripTouchStart=function(){v.handleButton("grip","touchstart")},this.onGripTouchEnd=function(){v.handleButton("grip","touchend")},this.onThumbstickDown=function(){v.handleButton("thumbstick","down")},this.onThumbstickUp=function(){v.handleButton("thumbstick","up")},this.onAorXTouchStart=function(){v.handleButton("AorX","touchstart")},this.onAorXTouchEnd=function(){v.handleButton("AorX","touchend")},this.onBorYTouchStart=function(){v.handleButton("BorY","touchstart")},this.onBorYTouchEnd=function(){v.handleButton("BorY","touchend")},this.onSurfaceTouchStart=function(){v.handleButton("surface","touchstart")},this.onSurfaceTouchEnd=function(){v.handleButton("surface","touchend")},this.onControllerConnected=this.onControllerConnected.bind(this),this.onControllerDisconnected=this.onControllerDisconnected.bind(this),_.addEventListener("controllerconnected",this.onControllerConnected),_.addEventListener("controllerdisconnected",this.onControllerDisconnected),_.object3D.visible=!1},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners()},tick:function(v,_){var C=this.el.getObject3D("mesh");!C||!C.mixer||C.mixer.update(_/1e3)},onControllerConnected:function(){this.el.object3D.visible=!0},onControllerDisconnected:function(){this.el.object3D.visible=!1},addEventListeners:function(){var v=this.el;v.addEventListener("gripdown",this.onGripDown),v.addEventListener("gripup",this.onGripUp),v.addEventListener("trackpaddown",this.onTrackpadDown),v.addEventListener("trackpadup",this.onTrackpadUp),v.addEventListener("trackpadtouchstart",this.onTrackpadTouchStart),v.addEventListener("trackpadtouchend",this.onTrackpadTouchEnd),v.addEventListener("triggerdown",this.onTriggerDown),v.addEventListener("triggerup",this.onTriggerUp),v.addEventListener("triggertouchstart",this.onTriggerTouchStart),v.addEventListener("triggertouchend",this.onTriggerTouchEnd),v.addEventListener("griptouchstart",this.onGripTouchStart),v.addEventListener("griptouchend",this.onGripTouchEnd),v.addEventListener("thumbstickdown",this.onThumbstickDown),v.addEventListener("thumbstickup",this.onThumbstickUp),v.addEventListener("abuttontouchstart",this.onAorXTouchStart),v.addEventListener("abuttontouchend",this.onAorXTouchEnd),v.addEventListener("bbuttontouchstart",this.onBorYTouchStart),v.addEventListener("bbuttontouchend",this.onBorYTouchEnd),v.addEventListener("xbuttontouchstart",this.onAorXTouchStart),v.addEventListener("xbuttontouchend",this.onAorXTouchEnd),v.addEventListener("ybuttontouchstart",this.onBorYTouchStart),v.addEventListener("ybuttontouchend",this.onBorYTouchEnd),v.addEventListener("surfacetouchstart",this.onSurfaceTouchStart),v.addEventListener("surfacetouchend",this.onSurfaceTouchEnd)},removeEventListeners:function(){var v=this.el;v.removeEventListener("gripdown",this.onGripDown),v.removeEventListener("gripup",this.onGripUp),v.removeEventListener("trackpaddown",this.onTrackpadDown),v.removeEventListener("trackpadup",this.onTrackpadUp),v.removeEventListener("trackpadtouchstart",this.onTrackpadTouchStart),v.removeEventListener("trackpadtouchend",this.onTrackpadTouchEnd),v.removeEventListener("triggerdown",this.onTriggerDown),v.removeEventListener("triggerup",this.onTriggerUp),v.removeEventListener("triggertouchstart",this.onTriggerTouchStart),v.removeEventListener("triggertouchend",this.onTriggerTouchEnd),v.removeEventListener("griptouchstart",this.onGripTouchStart),v.removeEventListener("griptouchend",this.onGripTouchEnd),v.removeEventListener("thumbstickdown",this.onThumbstickDown),v.removeEventListener("thumbstickup",this.onThumbstickUp),v.removeEventListener("abuttontouchstart",this.onAorXTouchStart),v.removeEventListener("abuttontouchend",this.onAorXTouchEnd),v.removeEventListener("bbuttontouchstart",this.onBorYTouchStart),v.removeEventListener("bbuttontouchend",this.onBorYTouchEnd),v.removeEventListener("xbuttontouchstart",this.onAorXTouchStart),v.removeEventListener("xbuttontouchend",this.onAorXTouchEnd),v.removeEventListener("ybuttontouchstart",this.onBorYTouchStart),v.removeEventListener("ybuttontouchend",this.onBorYTouchEnd),v.removeEventListener("surfacetouchstart",this.onSurfaceTouchStart),v.removeEventListener("surfacetouchend",this.onSurfaceTouchEnd)},update:function(v){var _,C=this.el,E=this.data.hand,T=this.data.handModelStyle,R=this.data.color,B=this;if(_={hand:E,model:!1},E!==v){var I=f[T+E.charAt(0).toUpperCase()+E.slice(1)];this.loader.load(I,function(D){var L=D.scene.children[0],O=E==="left"?Math.PI/2:-Math.PI/2,F=C.sceneEl.hasWebXR?-Math.PI/2:0;L.mixer=new THREE.AnimationMixer(L),B.clips=D.animations,C.setObject3D("mesh",L),L.traverse(function(q){q.isMesh&&(q.material.color=new THREE.Color(R))}),L.position.set(0,0,0),L.rotation.set(F,0,O),C.setAttribute("magicleap-controls",_),C.setAttribute("vive-controls",_),C.setAttribute("oculus-touch-controls",_),C.setAttribute("pico-controls",_),C.setAttribute("windows-motion-controls",_),C.setAttribute("hp-mixed-reality-controls",_)})}},remove:function(){this.el.removeObject3D("mesh")},handleButton:function(v,_){var C,E=_==="down",T=_==="touchstart";if(_.indexOf("touch")===0){if(T===this.touchedButtons[v])return;this.touchedButtons[v]=T}else{if(E===this.pressedButtons[v])return;this.pressedButtons[v]=E}C=this.gesture,this.gesture=this.determineGesture(),this.gesture!==C&&(this.animateGesture(this.gesture,C),this.emitGestureEvents(this.gesture,C))},determineGesture:function(){var v,_=this.pressedButtons.grip,C=this.pressedButtons.surface||this.touchedButtons.surface,E=this.pressedButtons.trackpad||this.touchedButtons.trackpad,T=this.pressedButtons.trigger||this.touchedButtons.trigger,R=this.touchedButtons.AorX||this.touchedButtons.BorY,B=b(this.el.components["tracked-controls"]);return B?_||T?v=g.fist:E&&(v=g.point):_?C||R||E?v=T?g.fist:g.point:v=T?g.thumbUp:g.pointThumb:T&&(v=g.hold),v},getClip:function(v){var _,C;for(C=0;C<this.clips.length;C++)if(_=this.clips[C],_.name===v)return _},animateGesture:function(v,_){if(v){this.playAnimation(v||g.open,_,!1);return}this.playAnimation(_,_,!0)},emitGestureEvents:function(v,_){var C=this.el,E;_!==v&&(E=y(_,!1),E&&C.emit(E),E=y(v,!0),E&&C.emit(E))},playAnimation:function(v,_,C){var E,T,R=this.el.getObject3D("mesh"),B;if(R){if(E=this.getClip(v),B=R.mixer.clipAction(E),C){B.paused=!1,B.timeScale=-1;return}if(B.clampWhenFinished=!0,B.loop=THREE.LoopOnce,B.repetitions=0,B.timeScale=1,B.time=0,B.weight=1,!_){R.mixer.stopAllAction(),B.play();return}E=this.getClip(_),B.reset(),B.play(),T=R.mixer.clipAction(E),T.crossFadeTo(B,.15,!0)}}});function y(v,_){var C;if(v){if(C=m[v],C==="grip")return C+(_?"close":"open");if(C==="point")return C+(_?"up":"down");if(C==="pointing"||C==="pistol")return C+(_?"start":"end")}}function b(v){var _=v&&v.controller,C=_&&(_.id&&_.id.indexOf("OpenVR ")===0||_.profiles&&_.profiles[0]&&_.profiles[0]==="htc-vive");return C}},"./src/components/hand-tracking-controls.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/core/a-entity.js").AEntity,f=c("./src/utils/tracked-controls.js"),g=f.checkControllerPresentAndSetup,m=c("./src/constants/index.js").AFRAME_CDN_ROOT,y=m+"controllers/oculus-hands/v4/left.glb",b=m+"controllers/oculus-hands/v4/right.glb",v=["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"],_=0,C=4,E=9,T=.015,R=.1;l.exports.Component=h("hand-tracking-controls",{schema:{hand:{default:"right",oneOf:["left","right"]},modelStyle:{default:"mesh",oneOf:["dots","mesh"]},modelColor:{default:"white"},modelOpacity:{default:1}},after:["tracked-controls"],bindMethods:function(){this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this)},addEventListeners:function(){this.el.addEventListener("model-loaded",this.onModelLoaded);for(var B=0;B<this.jointEls.length;++B)this.jointEls[B].object3D.visible=!0},removeEventListeners:function(){this.el.removeEventListener("model-loaded",this.onModelLoaded);for(var B=0;B<this.jointEls.length;++B)this.jointEls[B].object3D.visible=!1},init:function(){var B=this.el.sceneEl,I=B.getAttribute("webxr"),D=I.optionalFeatures;D.indexOf("hand-tracking")===-1&&(D.push("hand-tracking"),B.setAttribute("webxr",I)),this.wristObject3D=new THREE.Object3D,this.el.sceneEl.object3D.add(this.wristObject3D),this.onModelLoaded=this.onModelLoaded.bind(this),this.onChildAttached=this.onChildAttached.bind(this),this.jointEls=[],this.controllerPresent=!1,this.isPinched=!1,this.pinchEventDetail={position:new THREE.Vector3,wristRotation:new THREE.Quaternion},this.indexTipPosition=new THREE.Vector3,this.hasPoses=!1,this.jointPoses=new Float32Array(16*v.length),this.jointRadii=new Float32Array(v.length),this.bindMethods(),this.updateReferenceSpace=this.updateReferenceSpace.bind(this),this.el.sceneEl.addEventListener("enter-vr",this.updateReferenceSpace),this.el.sceneEl.addEventListener("exit-vr",this.updateReferenceSpace),this.el.addEventListener("child-attached",this.onChildAttached),this.el.object3D.visible=!1,this.wristObject3D.visible=!1},onChildAttached:function(B){this.addChildEntity(B.detail.el)},update:function(){this.updateModelMaterial()},updateModelMaterial:function(){var B=this.jointEls,I=this.skinnedMesh,D=this.data.modelOpacity!==1;I&&(this.skinnedMesh.material.color.set(this.data.modelColor),this.skinnedMesh.material.transparent=D,this.skinnedMesh.material.opacity=this.data.modelOpacity);for(var L=0;L<B.length;L++)B[L].setAttribute("material",{color:this.data.modelColor,transparent:D,opacity:this.data.modelOpacity})},updateReferenceSpace:function(){var B=this,I=this.el.sceneEl.xrSession;if(this.referenceSpace=void 0,!!I){var D=B.el.sceneEl.systems.webxr.sessionReferenceSpaceType;I.requestReferenceSpace(D).then(function(L){B.referenceSpace=L}).catch(function(L){throw B.el.sceneEl.systems.webxr.warnIfFeatureNotRequested(D,"tracked-controls-webxr uses reference space "+D),L})}},checkIfControllerPresent:function(){var B=this.data,I=B.hand?B.hand:void 0;g(this,"",{hand:I,iterateControllerProfiles:!0,handTracking:!0})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},tick:function(){var B=this.el.sceneEl,I=this.el.components["tracked-controls"]&&this.el.components["tracked-controls"].controller,D=B.frame,L=this.el.components["tracked-controls-webxr"],O=this.referenceSpace;!I||!D||!O||!L||(this.hasPoses=!1,I.hand&&(this.el.object3D.position.set(0,0,0),this.el.object3D.rotation.set(0,0,0),this.hasPoses=D.fillPoses(I.hand.values(),O,this.jointPoses)&&D.fillJointRadii(I.hand.values(),this.jointRadii),this.updateHandModel(),this.detectGesture(),this.updateWristObject()))},updateWristObject:function(){var B=new THREE.Matrix4;return function(){var I=this.wristObject3D;!I||!this.hasPoses||(B.fromArray(this.jointPoses,_*16),I.position.setFromMatrixPosition(B),I.quaternion.setFromRotationMatrix(B))}}(),updateHandModel:function(){this.data.modelStyle==="dots"&&this.updateHandDotsModel(),this.data.modelStyle==="mesh"&&this.updateHandMeshModel()},getBone:function(B){for(var I=this.bones,D=0;D<I.length;D++)if(I[D].name===B)return I[D];return null},updateHandMeshModel:function(){var B=new THREE.Matrix4;return function(){var I=0,D=this.jointPoses,L=this.el.components["tracked-controls"]&&this.el.components["tracked-controls"].controller;if(!(!L||!this.mesh)&&(this.mesh.visible=!1,!!this.hasPoses))for(var O of L.hand.values()){var F=this.getBone(O.jointName);F!=null&&(this.mesh.visible=!0,B.fromArray(D,I*16),F.position.setFromMatrixPosition(B),F.quaternion.setFromRotationMatrix(B)),I++}}}(),updateHandDotsModel:function(){for(var B=this.jointPoses,I=this.jointRadii,D=this.el.components["tracked-controls"]&&this.el.components["tracked-controls"].controller,L,O,F=0;F<D.hand.size;F++)L=this.jointEls[F],O=L.object3D,L.object3D.visible=this.hasPoses,this.hasPoses&&(O.matrix.fromArray(B,F*16),O.matrix.decompose(O.position,O.rotation,O.scale),L.setAttribute("scale",{x:I[F],y:I[F],z:I[F]}))},detectGesture:function(){this.detectPinch()},detectPinch:function(){var B=new THREE.Vector3,I=new THREE.Matrix4;return function(){var D=this.indexTipPosition,L=this.pinchEventDetail;if(this.hasPoses){B.setFromMatrixPosition(I.fromArray(this.jointPoses,C*16)),D.setFromMatrixPosition(I.fromArray(this.jointPoses,E*16)),L.wristRotation.setFromRotationMatrix(I.fromArray(this.jointPoses,_*16));var O=D.distanceTo(B);O<T&&this.isPinched===!1&&(this.isPinched=!0,this.pinchDistance=O,L.position.copy(D).add(B).multiplyScalar(.5),this.el.emit("pinchstarted",L)),O>this.pinchDistance+this.pinchDistance*R&&this.isPinched===!0&&(this.isPinched=!1,L.position.copy(D).add(B).multiplyScalar(.5),this.el.emit("pinchended",L)),this.isPinched&&(L.position.copy(D).add(B).multiplyScalar(.5),this.el.emit("pinchmoved",L))}}}(),pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var B=this.el,I=this.data;if(B.setAttribute("tracked-controls",{id:"",hand:I.hand,iterateControllerProfiles:!0,handTrackingEnabled:!0}),this.mesh){this.mesh!==B.getObject3D("mesh")&&B.setObject3D("mesh",this.mesh);return}this.initDefaultModel()},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){var B=this.el,I;this.checkIfControllerPresent(),I=B.components["tracked-controls"]&&B.components["tracked-controls"].controller,this.mesh&&I&&I.hand&&I.hand instanceof XRHand&&B.setObject3D("mesh",this.mesh)},initDefaultModel:function(){var B=this.data;B.modelStyle==="dots"&&this.initDotsModel(),B.modelStyle==="mesh"&&this.initMeshHandModel(),this.el.object3D.visible=!0,this.wristObject3D.visible=!0},initDotsModel:function(){if(this.jointEls.length===0){for(var B=0;B<v.length;++B){var I=this.jointEl=document.createElement("a-entity");I.setAttribute("geometry",{primitive:"sphere",radius:1}),I.object3D.visible=!1,this.el.appendChild(I),this.jointEls.push(I)}this.updateModelMaterial()}},initMeshHandModel:function(){var B=this.data.hand==="left"?y:b;this.el.setAttribute("gltf-model",B)},onModelLoaded:function(){var B=this.mesh=this.el.getObject3D("mesh").children[0],I=this.skinnedMesh=B.getObjectByProperty("type","SkinnedMesh");this.skinnedMesh&&(this.bones=I.skeleton.bones,this.el.removeObject3D("mesh"),B.position.set(0,0,0),B.rotation.set(0,0,0),I.frustumCulled=!1,I.material=new THREE.MeshStandardMaterial,this.updateModelMaterial(),this.setupChildrenEntities(),this.el.setObject3D("mesh",B))},setupChildrenEntities:function(){for(var B=this.el.children,I=0;I<B.length;++I)B[I]instanceof p&&this.addChildEntity(B[I])},addChildEntity:function(B){B instanceof p&&this.wristObject3D.add(B.object3D)}})},"./src/components/hand-tracking-grab-controls.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/lib/three.js");h("hand-tracking-grab-controls",{schema:{hand:{default:"right",oneOf:["left","right"]},color:{type:"color",default:"white"},hoverColor:{type:"color",default:"#538df1"},hoverEnabled:{default:!1}},init:function(){var f=this.el,g=this.data,m;g.hand==="right"?m="components.hand-tracking-controls.bones.3":m="components.hand-tracking-controls.bones.21",f.setAttribute("hand-tracking-controls",{hand:g.hand}),f.setAttribute("obb-collider",{trackedObject3D:m,size:.04}),this.auxMatrix=new p.Matrix4,this.auxQuaternion=new p.Quaternion,this.auxQuaternion2=new p.Quaternion,this.auxVector=new p.Vector3,this.auxVector2=new p.Vector3,this.grabbingObjectPosition=new p.Vector3,this.grabbedObjectPosition=new p.Vector3,this.grabbedObjectPositionDelta=new p.Vector3,this.grabDeltaPosition=new p.Vector3,this.grabInitialRotation=new p.Quaternion,this.onCollisionStarted=this.onCollisionStarted.bind(this),this.el.addEventListener("obbcollisionstarted",this.onCollisionStarted),this.onCollisionEnded=this.onCollisionEnded.bind(this),this.el.addEventListener("obbcollisionended",this.onCollisionEnded),this.onPinchStarted=this.onPinchStarted.bind(this),this.el.addEventListener("pinchstarted",this.onPinchStarted),this.onPinchEnded=this.onPinchEnded.bind(this),this.el.addEventListener("pinchended",this.onPinchEnded),this.onPinchMoved=this.onPinchMoved.bind(this),this.el.addEventListener("pinchmoved",this.onPinchMoved)},transferEntityOwnership:function(){for(var f,g=this.el.sceneEl.querySelectorAll("[hand-tracking-grab-controls]"),m=0;m<g.length;++m)f=g[m].components["hand-tracking-grab-controls"],f!==this&&this.grabbedEl&&this.grabbedEl===f.grabbedEl&&f.releaseGrabbedEntity();return!1},onCollisionStarted:function(f){var g=f.detail.withEl;this.collidedEl||g.getAttribute("grabbable")&&(this.collidedEl=g,this.grabbingObject3D=f.detail.trackedObject3D,this.data.hoverEnabled&&this.el.setAttribute("hand-tracking-controls","modelColor",this.data.hoverColor))},onCollisionEnded:function(){this.collidedEl=void 0,!this.grabbedEl&&(this.grabbingObject3D=void 0,this.data.hoverEnabled&&this.el.setAttribute("hand-tracking-controls","modelColor",this.data.color))},onPinchStarted:function(f){this.collidedEl&&(this.pinchPosition=f.detail.position,this.wristRotation=f.detail.wristRotation,this.grabbedEl=this.collidedEl,this.transferEntityOwnership(),this.grab())},onPinchEnded:function(){this.releaseGrabbedEntity()},onPinchMoved:function(f){this.wristRotation=f.detail.wristRotation},releaseGrabbedEntity:function(){var f=this.grabbedEl;f&&(f.object3D.updateMatrixWorld=this.originalUpdateMatrixWorld,f.object3D.matrixAutoUpdate=!0,f.object3D.matrixWorldAutoUpdate=!0,f.object3D.matrixWorld.decompose(this.auxVector,this.auxQuaternion,this.auxVector2),f.object3D.position.copy(this.auxVector),f.object3D.quaternion.copy(this.auxQuaternion),this.el.emit("grabended",{grabbedEl:f}),this.grabbedEl=void 0)},grab:function(){var f=this.grabbedEl,g;g=f.object3D.getWorldPosition(this.grabbedObjectPosition),this.grabDeltaPosition.copy(g).sub(this.pinchPosition),this.grabInitialRotation.copy(this.auxQuaternion.copy(this.wristRotation).invert()),this.originalUpdateMatrixWorld=f.object3D.updateMatrixWorld,f.object3D.updateMatrixWorld=function(){},f.object3D.updateMatrixWorldChildren=function(m){for(var y=this.children,b=0,v=y.length;b<v;b++){var _=y[b];(_.matrixWorldAutoUpdate===!0||m===!0)&&_.updateMatrixWorld(!0)}},f.object3D.matrixAutoUpdate=!1,f.object3D.matrixWorldAutoUpdate=!1,this.el.emit("grabstarted",{grabbedEl:f})},tock:function(){var f=this.auxMatrix,g=this.auxQuaternion,m=this.auxQuaternion2,y,b=this.grabbedEl;b&&(y=b.object3D,y.getWorldQuaternion(m),y.matrixWorld.identity(),f.identity(),f.makeTranslation(this.pinchPosition),y.matrixWorld.multiply(f),f.identity(),f.makeRotationFromQuaternion(g.copy(this.wristRotation).multiply(this.grabInitialRotation)),y.matrixWorld.multiply(f),f.identity(),f.makeTranslation(this.grabDeltaPosition),y.matrixWorld.multiply(f),f.identity(),f.makeRotationFromQuaternion(m),y.matrixWorld.multiply(f),f.makeScale(b.object3D.scale.x,b.object3D.scale.y,b.object3D.scale.z),y.matrixWorld.multiply(f),y.updateMatrixWorldChildren())}})},"./src/components/hide-on-enter-ar.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent;l.exports.Component=h("hide-on-enter-ar",{init:function(){var p=this;this.el.sceneEl.addEventListener("enter-vr",function(){p.el.sceneEl.is("ar-mode")&&(p.el.object3D.visible=!1)}),this.el.sceneEl.addEventListener("exit-vr",function(){p.el.object3D.visible=!0})}})},"./src/components/hide-on-enter-vr.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent;l.exports.Component=h("hide-on-enter-vr",{init:function(){var p=this;this.el.sceneEl.addEventListener("enter-vr",function(){p.el.sceneEl.is("vr-mode")&&(p.el.object3D.visible=!1)}),this.el.sceneEl.addEventListener("exit-vr",function(){p.el.object3D.visible=!0})}})},"./src/components/hp-mixed-reality-controls.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/lib/three.js"),f=c("./src/utils/tracked-controls.js"),g=f.checkControllerPresentAndSetup,m=f.emitIfAxesChanged,y=f.onButtonEvent,b="hp-mixed-reality",v=c("./src/constants/index.js").AFRAME_CDN_ROOT,_=v+"controllers/hp/mixed-reality/",C={x:0,y:0,z:.06},E={_x:Math.PI/4,_y:0,_z:0,_order:"XYZ"},T={left:{axes:{touchpad:[2,3]},buttons:["trigger","grip","none","thumbstick","xbutton","ybutton"]},right:{axes:{touchpad:[2,3]},buttons:["trigger","grip","none","thumbstick","abutton","bbutton"]}};l.exports.Component=h("hp-mixed-reality-controls",{schema:{hand:{default:"none"},model:{default:!0},orientationOffset:{type:"vec3"}},mapping:T,init:function(){var R=this;this.controllerPresent=!1,this.lastControllerCheck=0,this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(B){y(B.detail.id,"down",R,R.data.hand)},this.onButtonUp=function(B){y(B.detail.id,"up",R,R.data.hand)},this.onButtonTouchEnd=function(B){y(B.detail.id,"touchend",R,R.data.hand)},this.onButtonTouchStart=function(B){y(B.detail.id,"touchstart",R,R.data.hand)},this.previousButtonValues={},this.bindMethods()},update:function(){var R=this.data;this.controllerIndex=R.hand==="right"?0:R.hand==="left"?1:2},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},addEventListeners:function(){var R=this.el;R.addEventListener("buttonchanged",this.onButtonChanged),R.addEventListener("buttondown",this.onButtonDown),R.addEventListener("buttonup",this.onButtonUp),R.addEventListener("touchstart",this.onButtonTouchStart),R.addEventListener("touchend",this.onButtonTouchEnd),R.addEventListener("axismove",this.onAxisMoved),R.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var R=this.el;R.removeEventListener("buttonchanged",this.onButtonChanged),R.removeEventListener("buttondown",this.onButtonDown),R.removeEventListener("buttonup",this.onButtonUp),R.removeEventListener("touchstart",this.onButtonTouchStart),R.removeEventListener("touchend",this.onButtonTouchEnd),R.removeEventListener("axismove",this.onAxisMoved),R.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var R=this.data;g(this,b,{index:this.controllerIndex,hand:R.hand})},injectTrackedControls:function(){var R=this.el,B=this.data;R.setAttribute("tracked-controls",{idPrefix:b,hand:B.hand,controller:this.controllerIndex,orientationOffset:B.orientationOffset}),this.data.model&&this.el.setAttribute("gltf-model",_+this.data.hand+".glb")},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(R){var B=this.mapping[this.data.hand].buttons[R.detail.id],I;B&&(B==="trigger"&&(I=R.detail.state.value,console.log("analog value of trigger press: "+I)),this.el.emit(B+"changed",R.detail.state))},onModelLoaded:function(R){var B=R.detail.model;this.data.model&&(B.position.copy(C),B.rotation.copy(E),this.el.emit("controllermodelready",{name:"hp-mixed-reality-controls",model:this.data.model,rayOrigin:new p.Vector3(0,0,0)}))},onAxisMoved:function(R){m(this,this.mapping.axes,R)}})},"./src/components/index.js":(l,u,c)=>{c("./src/components/animation.js"),c("./src/components/anchored.js"),c("./src/components/camera.js"),c("./src/components/cursor.js"),c("./src/components/geometry.js"),c("./src/components/generic-tracked-controller-controls.js"),c("./src/components/gltf-model.js"),c("./src/components/grabbable.js"),c("./src/components/hand-tracking-controls.js"),c("./src/components/hand-tracking-grab-controls.js"),c("./src/components/hand-controls.js"),c("./src/components/hide-on-enter-ar.js"),c("./src/components/hide-on-enter-vr.js"),c("./src/components/hp-mixed-reality-controls.js"),c("./src/components/layer.js"),c("./src/components/laser-controls.js"),c("./src/components/light.js"),c("./src/components/line.js"),c("./src/components/link.js"),c("./src/components/look-controls.js"),c("./src/components/magicleap-controls.js"),c("./src/components/material.js"),c("./src/components/obb-collider.js"),c("./src/components/obj-model.js"),c("./src/components/oculus-go-controls.js"),c("./src/components/oculus-touch-controls.js"),c("./src/components/pico-controls.js"),c("./src/components/position.js"),c("./src/components/raycaster.js"),c("./src/components/rotation.js"),c("./src/components/scale.js"),c("./src/components/shadow.js"),c("./src/components/sound.js"),c("./src/components/text.js"),c("./src/components/tracked-controls.js"),c("./src/components/tracked-controls-webvr.js"),c("./src/components/tracked-controls-webxr.js"),c("./src/components/visible.js"),c("./src/components/valve-index-controls.js"),c("./src/components/vive-controls.js"),c("./src/components/vive-focus-controls.js"),c("./src/components/wasd-controls.js"),c("./src/components/windows-motion-controls.js"),c("./src/components/scene/ar-hit-test.js"),c("./src/components/scene/background.js"),c("./src/components/scene/debug.js"),c("./src/components/scene/device-orientation-permission-ui.js"),c("./src/components/scene/embedded.js"),c("./src/components/scene/inspector.js"),c("./src/components/scene/fog.js"),c("./src/components/scene/keyboard-shortcuts.js"),c("./src/components/scene/pool.js"),c("./src/components/scene/real-world-meshing.js"),c("./src/components/scene/reflection.js"),c("./src/components/scene/screenshot.js"),c("./src/components/scene/stats.js"),c("./src/components/scene/xr-mode-ui.js")},"./src/components/laser-controls.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/utils/index.js");h("laser-controls",{schema:{hand:{default:"right"},model:{default:!0},defaultModelColor:{type:"color",default:"grey"}},init:function(){var f=this.config,g=this.data,m=this.el,y=this,b={hand:g.hand,model:g.model};m.setAttribute("hp-mixed-reality-controls",b),m.setAttribute("magicleap-controls",b),m.setAttribute("oculus-go-controls",b),m.setAttribute("oculus-touch-controls",b),m.setAttribute("pico-controls",b),m.setAttribute("valve-index-controls",b),m.setAttribute("vive-controls",b),m.setAttribute("vive-focus-controls",b),m.setAttribute("windows-motion-controls",b),m.setAttribute("generic-tracked-controller-controls",{hand:b.hand}),m.addEventListener("controllerconnected",v),m.addEventListener("controllerdisconnected",_),m.addEventListener("controllermodelready",function(C){v(C),y.modelReady=!0});function v(C){var E=f[C.detail.name];if(E){var T=p.extend({showLine:!0},E.raycaster||{});C.detail.rayOrigin&&(T.origin=C.detail.rayOrigin.origin,T.direction=C.detail.rayOrigin.direction,T.showLine=!0),C.detail.rayOrigin||!y.modelReady?m.setAttribute("raycaster",T):m.setAttribute("raycaster","showLine",!0),m.setAttribute("cursor",p.extend({fuse:!1},E.cursor))}}function _(C){var E=f[C.detail.name];E&&m.setAttribute("raycaster","showLine",!1)}},config:{"generic-tracked-controller-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]}},"hp-mixed-reality-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{origin:{x:0,y:0,z:0}}},"magicleap-controls":{cursor:{downEvents:["trackpaddown","triggerdown"],upEvents:["trackpadup","triggerup"]}},"oculus-go-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{origin:{x:0,y:5e-4,z:0}}},"oculus-touch-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{origin:{x:0,y:0,z:0}}},"pico-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]}},"valve-index-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]}},"vive-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]}},"vive-focus-controls":{cursor:{downEvents:["trackpaddown","triggerdown"],upEvents:["trackpadup","triggerup"]}},"windows-motion-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{showLine:!1}}}})},"./src/components/layer.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/utils/index.js"),f=p.debug("components:layer:warn");l.exports.Component=h("layer",{schema:{type:{default:"quad",oneOf:["quad","monocubemap","stereocubemap"]},src:{type:"map"},rotateCubemap:{default:!1},width:{default:0},height:{default:0}},init:function(){var m=this.el.sceneEl.renderer.getContext();this.quaternion=new THREE.Quaternion,this.position=new THREE.Vector3,this.bindMethods(),this.needsRedraw=!1,this.frameBuffer=m.createFramebuffer();var y=this.el.sceneEl.getAttribute("webxr"),b=y.requiredFeatures;b.indexOf("layers")===-1&&(b.push("layers"),this.el.sceneEl.setAttribute("webxr",y)),this.el.sceneEl.addEventListener("enter-vr",this.onEnterVR),this.el.sceneEl.addEventListener("exit-vr",this.onExitVR)},bindMethods:function(){this.onRequestedReferenceSpace=this.onRequestedReferenceSpace.bind(this),this.onEnterVR=this.onEnterVR.bind(this),this.onExitVR=this.onExitVR.bind(this)},update:function(m){this.data.src!==m.src&&this.updateSrc()},updateSrc:function(){var m=this.data.type;if(this.texture=void 0,m==="quad"){this.loadQuadImage();return}if(m==="monocubemap"||m==="stereocubemap"){this.loadCubeMapImages();return}},loadCubeMapImages:function(){var m,y=this.xrGLFactory,b=this.el.sceneEl.frame,v=this.data.src,_=this.data.type;this.visibilityChanged=!1,this.layer&&(_!=="monocubemap"&&_!=="stereocubemap"||(v.complete?this.pendingCubeMapUpdate=!1:this.pendingCubeMapUpdate=!0,this.loadingScreen?this.loadingScreen=!1:this.loadingScreen=!0,_==="monocubemap"?(m=y.getSubImage(this.layer,b),this.loadCubeMapImage(m.colorTexture,v,0)):(m=y.getSubImage(this.layer,b,"left"),this.loadCubeMapImage(m.colorTexture,v,0),m=y.getSubImage(this.layer,b,"right"),this.loadCubeMapImage(m.colorTexture,v,6))))},loadQuadImage:function(){var m=this.data.src,y=this;this.el.sceneEl.systems.material.loadTexture(m,{src:m},function(b){y.el.sceneEl.renderer.initTexture(b),y.texture=b,m.tagName==="VIDEO"&&setTimeout(function(){y.textureIsVideo=!0},1e3),y.layer&&(y.layer.height=y.data.height/2||y.texture.image.height/1e3,y.layer.width=y.data.width/2||y.texture.image.width/1e3,y.needsRedraw=!0),y.updateQuadPanel()})},preGenerateCubeMapTextures:function(m,y){this.data.type==="monocubemap"?this.generateCubeMapTextures(m,0,y):(this.generateCubeMapTextures(m,0,y),this.generateCubeMapTextures(m,6,y))},generateCubeMapTextures:function(m,y,b){for(var v=this.data,_=this.cubeFaceSize,C=Math.min(m.width,m.height),E=[],T,R,B=0;B<6;B++){var I=document.createElement("CANVAS");I.width=I.height=_;var D=I.getContext("2d");v.rotateCubemap&&(B===2||B===3)&&(D.save(),D.translate(_,_),D.rotate(Math.PI)),D.drawImage(m,(B+y)*C,0,C,C,0,0,_,_),D.restore(),b&&b(),E.push(I)}return v.rotateCubemap&&(T=E[0],R=E[1],E[0]=R,E[1]=T,T=E[4],R=E[5],E[4]=R,E[5]=T),b&&b(),E},loadCubeMapImage:function(m,y,b){var v=this.el.sceneEl.renderer.getContext(),_;v.pixelStorei(v.UNPACK_FLIP_Y_WEBGL,!1),v.bindTexture(v.TEXTURE_CUBE_MAP,m),!y.complete||this.loadingScreen?_=this.loadingScreenImages:_=this.generateCubeMapTextures(y,b);var C=0;_.forEach(function(E,T){v.texSubImage2D(v.TEXTURE_CUBE_MAP_POSITIVE_X+T,0,0,0,v.RGBA,v.UNSIGNED_BYTE,E),C=v.getError()}),C!==0&&console.log("renderingError, WebGL Error Code: "+C),v.bindTexture(v.TEXTURE_CUBE_MAP,null)},tick:function(){this.el.sceneEl.xrSession&&(!this.layer&&(this.el.sceneEl.is("vr-mode")||this.el.sceneEl.is("ar-mode"))&&this.initLayer(),this.updateTransform(),this.data.src.complete&&(this.pendingCubeMapUpdate||this.loadingScreen||this.visibilityChanged)&&this.loadCubeMapImages(),!(!this.needsRedraw&&!this.layer.needsRedraw&&!this.textureIsVideo)&&(this.data.type==="quad"&&this.draw(),this.needsRedraw=!1))},initLayer:function(){var m=this,y=this.data.type;if(this.el.sceneEl.xrSession.onvisibilitychange=function(b){m.visibilityChanged=b.session.visibilityState!=="hidden"},y==="quad"){this.initQuadLayer();return}if(y==="monocubemap"||y==="stereocubemap"){this.initCubeMapLayer();return}},initQuadLayer:function(){var m=this.el.sceneEl,y=m.renderer.getContext(),b=this.xrGLFactory=new XRWebGLBinding(m.xrSession,y);this.texture&&(this.layer=b.createQuadLayer({space:this.referenceSpace,viewPixelHeight:2048,viewPixelWidth:2048,height:this.data.height/2||this.texture.image.height/1e3,width:this.data.width/2||this.texture.image.width/1e3}),this.initLoadingScreenImages(),m.renderer.xr.addLayer(this.layer))},initCubeMapLayer:function(){var m=this.data.src,y=this.el.sceneEl,b=y.renderer.getContext(),v=b.getParameter(b.MAX_CUBE_MAP_TEXTURE_SIZE),_=this.cubeFaceSize=Math.min(v,Math.min(m.width,m.height)),C=this.xrGLFactory=new XRWebGLBinding(y.xrSession,b);this.layer=C.createCubeLayer({space:this.referenceSpace,viewPixelWidth:_,viewPixelHeight:_,layout:this.data.type==="monocubemap"?"mono":"stereo",isStatic:!1}),this.initLoadingScreenImages(),this.loadCubeMapImages(),y.renderer.xr.addLayer(this.layer)},initLoadingScreenImages:function(){for(var m=this.cubeFaceSize,y=this.loadingScreenImages=[],b=0;b<6;b++){var v=document.createElement("CANVAS");v.width=v.height=m;var _=v.getContext("2d");v.width=v.height=m,_.fillStyle="black",_.fillRect(0,0,m,m),b!==2&&b!==3&&(_.translate(m,0),_.scale(-1,1),_.fillStyle="white",_.font="30px Arial",_.fillText("Loading",m/2,m/2)),y.push(v)}},destroyLayer:function(){this.layer&&(this.el.sceneEl.renderer.xr.removeLayer(this.layer),this.layer.destroy(),this.layer=void 0)},toggleCompositorLayer:function(){this.enableCompositorLayer(!this.layerEnabled)},enableCompositorLayer:function(m){this.layerEnabled=m,this.quadPanelEl.object3D.visible=!this.layerEnabled},updateQuadPanel:function(){var m=this.quadPanelEl;this.quadPanelEl||(m=this.quadPanelEl=document.createElement("a-entity"),this.el.appendChild(m)),m.setAttribute("material",{shader:"flat",src:this.data.src,transparent:!0}),m.setAttribute("geometry",{primitive:"plane",height:this.data.height||this.texture.image.height/1e3,width:this.data.width||this.texture.image.height/1e3})},draw:function(){var m=this.el.sceneEl,y=this.el.sceneEl.renderer.getContext(),b=this.xrGLFactory.getSubImage(this.layer,m.frame),v=m.renderer.properties.get(this.texture).__webglTexture,_=y.getParameter(y.FRAMEBUFFER_BINDING);y.viewport(b.viewport.x,b.viewport.y,b.viewport.width,b.viewport.height),y.bindFramebuffer(y.FRAMEBUFFER,this.frameBuffer),y.framebufferTexture2D(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0,y.TEXTURE_2D,b.colorTexture,0),g(y,v,b,this.data.src),y.bindFramebuffer(y.FRAMEBUFFER,_)},updateTransform:function(){var m=this.el,y=this.position,b=this.quaternion;m.object3D.updateMatrixWorld(),y.setFromMatrixPosition(m.object3D.matrixWorld),b.setFromRotationMatrix(m.object3D.matrixWorld),this.layerEnabled||y.set(0,0,1e8),this.layer.transform=new XRRigidTransform(y,b)},onEnterVR:function(){var m=this.el.sceneEl,y=m.xrSession;if(!m.hasWebXR||!XRWebGLBinding||!y){f("The layer component requires WebXR and the layers API enabled");return}y.requestReferenceSpace("local-floor").then(this.onRequestedReferenceSpace),this.layerEnabled=!0,this.quadPanelEl&&(this.quadPanelEl.object3D.visible=!1),this.data.src.play&&this.data.src.play()},onExitVR:function(){this.quadPanelEl&&(this.quadPanelEl.object3D.visible=!0),this.destroyLayer()},onRequestedReferenceSpace:function(m){this.referenceSpace=m}});function g(m,y,b,v){var _=m.createFramebuffer(),C=b.viewport.x,E=b.viewport.y,T=b.viewport.x+b.viewport.width,R=b.viewport.y+b.viewport.height;v.tagName==="VIDEO"&&(m.bindTexture(m.TEXTURE_2D,y),m.texSubImage2D(m.TEXTURE_2D,0,0,0,v.width,v.height,m.RGB,m.UNSIGNED_BYTE,v)),m.bindFramebuffer(m.READ_FRAMEBUFFER,_),m.framebufferTexture2D(m.READ_FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,y,0),m.readBuffer(m.COLOR_ATTACHMENT0),m.blitFramebuffer(0,0,v.width,v.height,C,E,T,R,m.COLOR_BUFFER_BIT,m.NEAREST),m.bindFramebuffer(m.READ_FRAMEBUFFER,null),m.deleteFramebuffer(_)}},"./src/components/light.js":(l,u,c)=>{var h=c("./src/utils/index.js"),p=h.diff,f=c("./src/utils/debug.js"),g=c("./src/core/component.js").registerComponent,m=c("./src/lib/three.js"),y=c("./src/utils/math.js"),b=m.MathUtils.degToRad,v=f("components:light:warn"),_=new m.CubeTextureLoader,C={};l.exports.Component=g("light",{schema:{angle:{default:60,if:{type:["spot"]}},color:{type:"color",if:{type:["ambient","directional","hemisphere","point","spot"]}},envMap:{default:"",if:{type:["probe"]}},groundColor:{type:"color",if:{type:["hemisphere"]}},decay:{default:1,if:{type:["point","spot"]}},distance:{default:0,min:0,if:{type:["point","spot"]}},intensity:{default:1,min:0,if:{type:["ambient","directional","hemisphere","point","spot","probe"]}},penumbra:{default:0,min:0,max:1,if:{type:["spot"]}},type:{default:"directional",oneOf:["ambient","directional","hemisphere","point","spot","probe"],schemaChange:!0},target:{type:"selector",if:{type:["spot","directional"]}},castShadow:{default:!1,if:{type:["point","spot","directional"]}},shadowBias:{default:0,if:{castShadow:!0}},shadowCameraFar:{default:500,if:{castShadow:!0}},shadowCameraFov:{default:90,if:{castShadow:!0}},shadowCameraNear:{default:.5,if:{castShadow:!0}},shadowCameraTop:{default:5,if:{castShadow:!0}},shadowCameraRight:{default:5,if:{castShadow:!0}},shadowCameraBottom:{default:-5,if:{castShadow:!0}},shadowCameraLeft:{default:-5,if:{castShadow:!0}},shadowCameraVisible:{default:!1,if:{castShadow:!0}},shadowCameraAutomatic:{default:"",if:{type:["directional"]}},shadowMapHeight:{default:512,if:{castShadow:!0}},shadowMapWidth:{default:512,if:{castShadow:!0}},shadowRadius:{default:1,if:{castShadow:!0}}},init:function(){var E=this.el;this.light=null,this.defaultTarget=null,this.system.registerLight(E)},update:function(E){var T=this.data,R=p(T,E),B=this.light,I=this;if(B&&!("type"in R)){var D=!1;Object.keys(R).forEach(function(L){var O=T[L];switch(L){case"color":{B.color.set(O);break}case"groundColor":{B.groundColor.set(O);break}case"angle":{B.angle=b(O);break}case"target":{O===null?(T.type==="spot"||T.type==="directional")&&(B.target=I.defaultTarget):O.hasLoaded?I.onSetTarget(O,B):O.addEventListener("loaded",I.onSetTarget.bind(I,O,B));break}case"envMap":I.updateProbeMap(T,B);break;case"castShadow":case"shadowBias":case"shadowCameraFar":case"shadowCameraFov":case"shadowCameraNear":case"shadowCameraTop":case"shadowCameraRight":case"shadowCameraBottom":case"shadowCameraLeft":case"shadowCameraVisible":case"shadowMapHeight":case"shadowMapWidth":case"shadowRadius":D||(I.updateShadow(),D=!0);break;case"shadowCameraAutomatic":T.shadowCameraAutomatic?I.shadowCameraAutomaticEls=Array.from(document.querySelectorAll(T.shadowCameraAutomatic)):I.shadowCameraAutomaticEls=[];break;default:B[L]=O}});return}this.setLight(this.data),this.updateShadow()},tick:function(){var E=new m.Box3,T=new m.Vector3,R=new m.Vector3,B=new m.Matrix4,I=new m.Sphere,D=new m.Vector3;return function(){if(this.data.type==="directional"&&this.light.shadow&&this.light.shadow.camera instanceof m.OrthographicCamera&&this.shadowCameraAutomaticEls.length){var L=this.light.shadow.camera;L.getWorldDirection(T),L.getWorldPosition(R),B.copy(L.matrixWorld),B.invert(),L.near=1,L.left=1e5,L.right=-1e5,L.top=-1e5,L.bottom=1e5,this.shadowCameraAutomaticEls.forEach(function(O){E.setFromObject(O.object3D),E.getBoundingSphere(I);var F=y.distanceOfPointFromPlane(R,T,I.center),q=y.nearestPointInPlane(R,T,I.center,D),H=q.applyMatrix4(B);L.near=Math.min(-F-I.radius-1,L.near),L.left=Math.min(-I.radius+H.x,L.left),L.right=Math.max(I.radius+H.x,L.right),L.top=Math.max(I.radius+H.y,L.top),L.bottom=Math.min(-I.radius+H.y,L.bottom)}),L.updateProjectionMatrix()}}}(),setLight:function(E){var T=this.el,R=this.getLight(E);R&&(this.light&&T.removeObject3D("light"),this.light=R,this.light.el=T,T.setObject3D("light",this.light),(E.type==="spot"||E.type==="directional"||E.type==="hemisphere")&&T.getObject3D("light").translateY(-1),E.type==="spot"&&(T.setObject3D("light-target",this.defaultTarget),T.getObject3D("light-target").position.set(0,0,-1)),E.shadowCameraAutomatic?this.shadowCameraAutomaticEls=Array.from(document.querySelectorAll(E.shadowCameraAutomatic)):this.shadowCameraAutomaticEls=[])},updateShadow:function(){var E=this.el,T=this.data,R=this.light;R.castShadow=T.castShadow;var B=E.getObject3D("cameraHelper");if(T.shadowCameraVisible&&!B?E.setObject3D("cameraHelper",new m.CameraHelper(R.shadow.camera)):!T.shadowCameraVisible&&B&&E.removeObject3D("cameraHelper"),!T.castShadow)return R;R.shadow.bias=T.shadowBias,R.shadow.radius=T.shadowRadius,R.shadow.mapSize.height=T.shadowMapHeight,R.shadow.mapSize.width=T.shadowMapWidth,R.shadow.camera.near=T.shadowCameraNear,R.shadow.camera.far=T.shadowCameraFar,R.shadow.camera instanceof m.OrthographicCamera?(R.shadow.camera.top=T.shadowCameraTop,R.shadow.camera.right=T.shadowCameraRight,R.shadow.camera.bottom=T.shadowCameraBottom,R.shadow.camera.left=T.shadowCameraLeft):R.shadow.camera.fov=T.shadowCameraFov,R.shadow.camera.updateProjectionMatrix(),B&&B.update()},getLight:function(E){var T=E.angle,R=new m.Color(E.color);R=R.getHex();var B=E.decay,I=E.distance,D=new m.Color(E.groundColor);D=D.getHex();var L=E.intensity,O=E.type,F=E.target,q=null;switch(O.toLowerCase()){case"ambient":return new m.AmbientLight(R,L);case"directional":return q=new m.DirectionalLight(R,L),this.defaultTarget=q.target,F&&(F.hasLoaded?this.onSetTarget(F,q):F.addEventListener("loaded",this.onSetTarget.bind(this,F,q))),q;case"hemisphere":return new m.HemisphereLight(R,D,L);case"point":return new m.PointLight(R,L,I,B);case"spot":return q=new m.SpotLight(R,L,I,b(T),E.penumbra,B),this.defaultTarget=q.target,F&&(F.hasLoaded?this.onSetTarget(F,q):F.addEventListener("loaded",this.onSetTarget.bind(this,F,q))),q;case"probe":return q=new m.LightProbe,this.updateProbeMap(E,q),q;default:v("%s is not a valid light type. Choose from ambient, directional, hemisphere, point, spot.",O)}},updateProbeMap:function(E,T){E.envMap||T.copy(new m.LightProbe),C[E.envMap]instanceof window.Promise&&C[E.envMap].then(function(R){T.copy(R)}),C[E.envMap]instanceof m.LightProbe&&T.copy(C[E.envMap]),C[E.envMap]=new window.Promise(function(R){h.srcLoader.validateCubemapSrc(E.envMap,function(B){_.load(B,function(I){var D=m.LightProbeGenerator.fromCubeTexture(I);C[E.envMap]=D,T.copy(D)})})})},onSetTarget:function(E,T){T.target=E.object3D},remove:function(){var E=this.el;E.removeObject3D("light"),E.getObject3D("cameraHelper")&&E.removeObject3D("cameraHelper")}})},"./src/components/line.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent;l.exports.Component=h("line",{schema:{start:{type:"vec3",default:{x:0,y:0,z:0}},end:{type:"vec3",default:{x:0,y:0,z:0}},color:{type:"color",default:"#74BEC1"},opacity:{type:"number",default:1},visible:{default:!0}},multiple:!0,init:function(){var f=this.data,g,m;m=this.material=new THREE.LineBasicMaterial({color:f.color,opacity:f.opacity,transparent:f.opacity<1,visible:f.visible}),g=this.geometry=new THREE.BufferGeometry,g.setAttribute("position",new THREE.BufferAttribute(new Float32Array(6),3)),this.line=new THREE.Line(g,m),this.el.setObject3D(this.attrName,this.line)},update:function(f){var g=this.data,m=this.geometry,y=!1,b=this.material,v=m.attributes.position.array;p(g.start,f.start)||(v[0]=g.start.x,v[1]=g.start.y,v[2]=g.start.z,y=!0),p(g.end,f.end)||(v[3]=g.end.x,v[4]=g.end.y,v[5]=g.end.z,y=!0),y&&(m.attributes.position.needsUpdate=!0,m.computeBoundingSphere()),b.color.setStyle(g.color),b.opacity=g.opacity,b.transparent=g.opacity<1,b.visible=g.visible},remove:function(){this.el.removeObject3D(this.attrName,this.line)}});function p(f,g){return!f||!g?!1:f.x===g.x&&f.y===g.y&&f.z===g.z}},"./src/components/link.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/core/shader.js").registerShader,f=c("./src/lib/three.js");l.exports.Component=h("link",{schema:{backgroundColor:{default:"red",type:"color"},borderColor:{default:"white",type:"color"},highlighted:{default:!1},highlightedColor:{default:"#24CAFF",type:"color"},href:{default:""},image:{type:"asset"},on:{default:"click"},peekMode:{default:!1},title:{default:""},titleColor:{default:"white",type:"color"},visualAspectEnabled:{default:!1}},init:function(){this.navigate=this.navigate.bind(this),this.previousQuaternion=void 0,this.quaternionClone=new f.Quaternion,this.hiddenEls=[]},update:function(g){var m=this.data,y=this.el,b,v;m.visualAspectEnabled&&(this.initVisualAspect(),b=m.highlighted?m.highlightedColor:m.backgroundColor,v=m.highlighted?m.highlightedColor:m.borderColor,y.setAttribute("material","backgroundColor",b),y.setAttribute("material","strokeColor",v),m.on!==g.on&&this.updateEventListener(),g.peekMode!==void 0&&m.peekMode!==g.peekMode&&this.updatePeekMode(),!(!m.image||g.image===m.image)&&y.setAttribute("material","pano",typeof m.image=="string"?m.image:m.image.src))},updatePeekMode:function(){var g=this.el,m=this.sphereEl;this.data.peekMode?(this.hideAll(),g.getObject3D("mesh").visible=!1,m.setAttribute("visible",!0)):(this.showAll(),g.getObject3D("mesh").visible=!0,m.setAttribute("visible",!1))},play:function(){this.updateEventListener()},pause:function(){this.removeEventListener()},updateEventListener:function(){var g=this.el;g.isPlaying&&(this.removeEventListener(),g.addEventListener(this.data.on,this.navigate))},removeEventListener:function(){var g=this.data.on;g&&this.el.removeEventListener(g,this.navigate)},initVisualAspect:function(){var g=this.el,m,y,b;!this.data.visualAspectEnabled||this.visualAspectInitialized||(b=this.textEl=this.textEl||document.createElement("a-entity"),y=this.sphereEl=this.sphereEl||document.createElement("a-entity"),m=this.semiSphereEl=this.semiSphereEl||document.createElement("a-entity"),g.setAttribute("geometry",{primitive:"circle",radius:1,segments:64}),g.setAttribute("material",{shader:"portal",pano:this.data.image,side:"double"}),b.setAttribute("text",{color:this.data.titleColor,align:"center",font:"kelsonsans",value:this.data.title||this.data.href,width:4}),b.setAttribute("position","0 1.5 0"),g.appendChild(b),m.setAttribute("geometry",{primitive:"sphere",radius:1,phiStart:0,segmentsWidth:64,segmentsHeight:64,phiLength:180,thetaStart:0,thetaLength:360}),m.setAttribute("material",{shader:"portal",borderEnabled:0,pano:this.data.image,side:"back"}),m.setAttribute("rotation","0 180 0"),m.setAttribute("position","0 0 0"),m.setAttribute("visible",!1),g.appendChild(m),y.setAttribute("geometry",{primitive:"sphere",radius:10,segmentsWidth:64,segmentsHeight:64}),y.setAttribute("material",{shader:"portal",borderEnabled:0,pano:this.data.image,side:"back"}),y.setAttribute("visible",!1),g.appendChild(y),this.visualAspectInitialized=!0)},navigate:function(){window.location=this.data.href},tick:function(){var g=new f.Vector3,m=new f.Vector3,y=new f.Quaternion,b=new f.Vector3;return function(){var v=this.el,_=v.object3D,C=v.sceneEl.camera,E,T,R=this.textEl;if(this.data.visualAspectEnabled)if(_.updateMatrixWorld(),C.parent.updateMatrixWorld(),C.updateMatrixWorld(),_.matrix.decompose(m,y,b),m.setFromMatrixPosition(_.matrixWorld),g.setFromMatrixPosition(C.matrixWorld),T=m.distanceTo(g),T>20)this.previousQuaternion||(this.quaternionClone.copy(y),this.previousQuaternion=this.quaternionClone),_.lookAt(g);else{if(E=this.calculateCameraPortalOrientation(),T<.5){if(this.semiSphereEl.getAttribute("visible")===!0)return;R.setAttribute("text","width",1.5),E<=0?(R.setAttribute("position","0 0 0.75"),R.setAttribute("rotation","0 180 0"),this.semiSphereEl.setAttribute("rotation","0 0 0")):(R.setAttribute("position","0 0 -0.75"),R.setAttribute("rotation","0 0 0"),this.semiSphereEl.setAttribute("rotation","0 180 0")),v.getObject3D("mesh").visible=!1,this.semiSphereEl.setAttribute("visible",!0),this.peekCameraPortalOrientation=E}else E<=0?R.setAttribute("rotation","0 180 0"):R.setAttribute("rotation","0 0 0"),R.setAttribute("text","width",5),R.setAttribute("position","0 1.5 0"),v.getObject3D("mesh").visible=!0,this.semiSphereEl.setAttribute("visible",!1),this.peekCameraPortalOrientation=void 0;this.previousQuaternion&&(_.quaternion.copy(this.previousQuaternion),this.previousQuaternion=void 0)}}}(),hideAll:function(){var g=this.el,m=this.hiddenEls,y=this;m.length>0||g.sceneEl.object3D.traverse(function(b){b&&b.el&&b.el.hasAttribute("link-controls")||!b.el||b===g.sceneEl.object3D||b.el===g||b.el===y.sphereEl||b.el===g.sceneEl.cameraEl||b.el.getAttribute("visible")===!1||b.el===y.textEl||b.el===y.semiSphereEl||(b.el.setAttribute("visible",!1),m.push(b.el))})},showAll:function(){this.hiddenEls.forEach(function(g){g.setAttribute("visible",!0)}),this.hiddenEls=[]},calculateCameraPortalOrientation:function(){var g=new f.Matrix4,m=new f.Vector3,y=new f.Vector3(0,0,1),b=new f.Vector3(0,0,0);return function(){var v=this.el,_=v.sceneEl.camera;return m.set(0,0,0),y.set(0,0,1),b.set(0,0,0),v.object3D.matrixWorld.extractRotation(g),y.applyMatrix4(g),v.object3D.updateMatrixWorld(),v.object3D.localToWorld(b),_.parent.parent.updateMatrixWorld(),_.parent.updateMatrixWorld(),_.updateMatrixWorld(),_.localToWorld(m),m.sub(b).normalize(),y.normalize(),Math.sign(y.dot(m))}}(),remove:function(){this.removeEventListener()}}),p("portal",{schema:{borderEnabled:{default:1,type:"int",is:"uniform"},backgroundColor:{default:"red",type:"color",is:"uniform"},pano:{type:"map",is:"uniform"},strokeColor:{default:"white",type:"color",is:"uniform"}},vertexShader:["vec3 portalPosition;","varying vec3 vWorldPosition;","varying float vDistanceToCenter;","varying float vDistance;","void main() {","vDistanceToCenter = clamp(length(position - vec3(0.0, 0.0, 0.0)), 0.0, 1.0);","portalPosition = (modelMatrix * vec4(0.0, 0.0, 0.0, 1.0)).xyz;","vDistance = length(portalPosition - cameraPosition);","vWorldPosition = (modelMatrix * vec4(position, 1.0)).xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join(`
`),fragmentShader:["#define RECIPROCAL_PI2 0.15915494","uniform sampler2D pano;","uniform vec3 strokeColor;","uniform vec3 backgroundColor;","uniform float borderEnabled;","varying float vDistanceToCenter;","varying float vDistance;","varying vec3 vWorldPosition;","void main() {","vec3 direction = normalize(vWorldPosition - cameraPosition);","vec2 sampleUV;","float borderThickness = clamp(exp(-vDistance / 50.0), 0.6, 0.95);","sampleUV.y = clamp(direction.y * 0.5  + 0.5, 0.0, 1.0);","sampleUV.x = atan(direction.z, -direction.x) * -RECIPROCAL_PI2 + 0.5;","if (vDistanceToCenter > borderThickness && borderEnabled == 1.0) {","gl_FragColor = vec4(strokeColor, 1.0);","} else {","gl_FragColor = mix(texture2D(pano, sampleUV), vec4(backgroundColor, 1.0), clamp(pow((vDistance / 15.0), 2.0), 0.0, 1.0));","}","}"].join(`
`)})},"./src/components/look-controls.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/lib/three.js"),f=c("./src/utils/index.js"),g=Math.PI/2;l.exports.Component=h("look-controls",{dependencies:["position","rotation"],schema:{enabled:{default:!0},magicWindowTrackingEnabled:{default:!0},pointerLockEnabled:{default:!1},reverseMouseDrag:{default:!1},reverseTouchDrag:{default:!1},touchEnabled:{default:!0},mouseEnabled:{default:!0}},init:function(){this.deltaYaw=0,this.previousHMDPosition=new p.Vector3,this.hmdQuaternion=new p.Quaternion,this.magicWindowAbsoluteEuler=new p.Euler,this.magicWindowDeltaEuler=new p.Euler,this.position=new p.Vector3,this.magicWindowObject=new p.Object3D,this.rotation={},this.deltaRotation={},this.savedPose=null,this.pointerLocked=!1,this.setupMouseControls(),this.bindMethods(),this.previousMouseEvent={},this.setupMagicWindowControls(),this.savedPose={position:new p.Vector3,rotation:new p.Euler},(this.el.sceneEl.is("vr-mode")||this.el.sceneEl.is("ar-mode"))&&this.onEnterVR()},setupMagicWindowControls:function(){var m,y=this.data;(f.device.isMobile()||f.device.isMobileDeviceRequestingDesktopSite())&&(m=this.magicWindowControls=new p.DeviceOrientationControls(this.magicWindowObject),typeof DeviceOrientationEvent<"u"&&DeviceOrientationEvent.requestPermission&&(m.enabled=!1,this.el.sceneEl.components["device-orientation-permission-ui"].permissionGranted?m.enabled=y.magicWindowTrackingEnabled:this.el.sceneEl.addEventListener("deviceorientationpermissiongranted",function(){m.enabled=y.magicWindowTrackingEnabled})))},update:function(m){var y=this.data;y.enabled!==m.enabled&&this.updateGrabCursor(y.enabled),m&&!y.magicWindowTrackingEnabled&&m.magicWindowTrackingEnabled&&(this.magicWindowAbsoluteEuler.set(0,0,0),this.magicWindowDeltaEuler.set(0,0,0)),this.magicWindowControls&&(this.magicWindowControls.enabled=y.magicWindowTrackingEnabled),m&&!y.pointerLockEnabled!==m.pointerLockEnabled&&(this.removeEventListeners(),this.addEventListeners(),this.pointerLocked&&this.exitPointerLock())},tick:function(m){var y=this.data;y.enabled&&this.updateOrientation()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.pointerLocked&&this.exitPointerLock()},remove:function(){this.removeEventListeners(),this.pointerLocked&&this.exitPointerLock()},bindMethods:function(){this.onMouseDown=this.onMouseDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onEnterVR=this.onEnterVR.bind(this),this.onExitVR=this.onExitVR.bind(this),this.onPointerLockChange=this.onPointerLockChange.bind(this),this.onPointerLockError=this.onPointerLockError.bind(this)},setupMouseControls:function(){this.mouseDown=!1,this.pitchObject=new p.Object3D,this.yawObject=new p.Object3D,this.yawObject.position.y=10,this.yawObject.add(this.pitchObject)},addEventListeners:function(){var m=this.el.sceneEl,y=m.canvas;if(!y){m.addEventListener("render-target-loaded",this.addEventListeners.bind(this));return}y.addEventListener("mousedown",this.onMouseDown,!1),window.addEventListener("mousemove",this.onMouseMove,!1),window.addEventListener("mouseup",this.onMouseUp,!1),y.addEventListener("touchstart",this.onTouchStart,{passive:!0}),window.addEventListener("touchmove",this.onTouchMove,{passive:!0}),window.addEventListener("touchend",this.onTouchEnd,{passive:!0}),m.addEventListener("enter-vr",this.onEnterVR),m.addEventListener("exit-vr",this.onExitVR),this.data.pointerLockEnabled&&(document.addEventListener("pointerlockchange",this.onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",this.onPointerLockChange,!1),document.addEventListener("pointerlockerror",this.onPointerLockError,!1))},removeEventListeners:function(){var m=this.el.sceneEl,y=m&&m.canvas;y&&(y.removeEventListener("mousedown",this.onMouseDown),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mouseup",this.onMouseUp),y.removeEventListener("touchstart",this.onTouchStart),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd),m.removeEventListener("enter-vr",this.onEnterVR),m.removeEventListener("exit-vr",this.onExitVR),document.removeEventListener("pointerlockchange",this.onPointerLockChange,!1),document.removeEventListener("mozpointerlockchange",this.onPointerLockChange,!1),document.removeEventListener("pointerlockerror",this.onPointerLockError,!1))},updateOrientation:function(){var m=this.el.object3D,y=this.pitchObject,b=this.yawObject,v=this.el.sceneEl;(v.is("vr-mode")||v.is("ar-mode"))&&v.checkHeadsetConnected()||(this.updateMagicWindowOrientation(),m.rotation.x=this.magicWindowDeltaEuler.x+y.rotation.x,m.rotation.y=this.magicWindowDeltaEuler.y+b.rotation.y,m.rotation.z=this.magicWindowDeltaEuler.z)},updateMagicWindowOrientation:function(){var m=this.magicWindowAbsoluteEuler,y=this.magicWindowDeltaEuler;this.magicWindowControls&&this.magicWindowControls.enabled&&(this.magicWindowControls.update(),m.setFromQuaternion(this.magicWindowObject.quaternion,"YXZ"),!this.previousMagicWindowYaw&&m.y!==0&&(this.previousMagicWindowYaw=m.y),this.previousMagicWindowYaw&&(y.x=m.x,y.y+=m.y-this.previousMagicWindowYaw,y.z=m.z,this.previousMagicWindowYaw=m.y))},onMouseMove:function(m){var y,b,v,_=this.pitchObject,C=this.previousMouseEvent,E=this.yawObject;!this.data.enabled||!this.mouseDown&&!this.pointerLocked||(this.pointerLocked?(b=m.movementX||m.mozMovementX||0,v=m.movementY||m.mozMovementY||0):(b=m.screenX-C.screenX,v=m.screenY-C.screenY),this.previousMouseEvent.screenX=m.screenX,this.previousMouseEvent.screenY=m.screenY,y=this.data.reverseMouseDrag?1:-1,E.rotation.y+=b*.002*y,_.rotation.x+=v*.002*y,_.rotation.x=Math.max(-g,Math.min(g,_.rotation.x)))},onMouseDown:function(m){var y=this.el.sceneEl;if(!(!this.data.enabled||!this.data.mouseEnabled||(y.is("vr-mode")||y.is("ar-mode"))&&y.checkHeadsetConnected())&&m.button===0){var b=y&&y.canvas;this.mouseDown=!0,this.previousMouseEvent.screenX=m.screenX,this.previousMouseEvent.screenY=m.screenY,this.showGrabbingCursor(),this.data.pointerLockEnabled&&!this.pointerLocked&&(b.requestPointerLock?b.requestPointerLock():b.mozRequestPointerLock&&b.mozRequestPointerLock())}},showGrabbingCursor:function(){this.el.sceneEl.canvas.style.cursor="grabbing"},hideGrabbingCursor:function(){this.el.sceneEl.canvas.style.cursor=""},onMouseUp:function(){this.mouseDown=!1,this.hideGrabbingCursor()},onTouchStart:function(m){m.touches.length!==1||!this.data.touchEnabled||this.el.sceneEl.is("vr-mode")||this.el.sceneEl.is("ar-mode")||(this.touchStart={x:m.touches[0].pageX,y:m.touches[0].pageY},this.touchStarted=!0)},onTouchMove:function(m){var y,b=this.el.sceneEl.canvas,v,_=this.yawObject;!this.touchStarted||!this.data.touchEnabled||(v=2*Math.PI*(m.touches[0].pageX-this.touchStart.x)/b.clientWidth,y=this.data.reverseTouchDrag?1:-1,_.rotation.y-=v*.5*y,this.touchStart={x:m.touches[0].pageX,y:m.touches[0].pageY})},onTouchEnd:function(){this.touchStarted=!1},onEnterVR:function(){var m=this.el.sceneEl;m.checkHeadsetConnected()&&(this.saveCameraPose(),this.el.object3D.position.set(0,0,0),this.el.object3D.rotation.set(0,0,0),m.hasWebXR&&(this.el.object3D.matrixAutoUpdate=!1,this.el.object3D.updateMatrix()))},onExitVR:function(){this.el.sceneEl.checkHeadsetConnected()&&(this.restoreCameraPose(),this.previousHMDPosition.set(0,0,0),this.el.object3D.matrixAutoUpdate=!0)},onPointerLockChange:function(){this.pointerLocked=!!(document.pointerLockElement||document.mozPointerLockElement)},onPointerLockError:function(){this.pointerLocked=!1},exitPointerLock:function(){document.exitPointerLock(),this.pointerLocked=!1},updateGrabCursor:function(m){var y=this.el.sceneEl;function b(){y.canvas.classList.add("a-grab-cursor")}function v(){y.canvas.classList.remove("a-grab-cursor")}if(!y.canvas){m?y.addEventListener("render-target-loaded",b):y.addEventListener("render-target-loaded",v);return}if(m){b();return}v()},saveCameraPose:function(){var m=this.el;this.savedPose.position.copy(m.object3D.position),this.savedPose.rotation.copy(m.object3D.rotation),this.hasSavedPose=!0},restoreCameraPose:function(){var m=this.el,y=this.savedPose;this.hasSavedPose&&(m.object3D.position.copy(y.position),m.object3D.rotation.copy(y.rotation),this.hasSavedPose=!1)}})},"./src/components/magicleap-controls.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/utils/tracked-controls.js"),f=p.checkControllerPresentAndSetup,g=p.emitIfAxesChanged,m=p.onButtonEvent,y="magicleap",b="-one",v=y+b,_=c("./src/constants/index.js").AFRAME_CDN_ROOT,C=_+"controllers/magicleap/magicleap-one-controller.glb",E={axes:{touchpad:[0,1]},buttons:["trigger","grip","touchpad","menu"]};l.exports.Component=h("magicleap-controls",{schema:{hand:{default:"none"},model:{default:!0},orientationOffset:{type:"vec3"}},mapping:E,init:function(){var T=this;this.controllerPresent=!1,this.lastControllerCheck=0,this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(R){m(R.detail.id,"down",T)},this.onButtonUp=function(R){m(R.detail.id,"up",T)},this.onButtonTouchEnd=function(R){m(R.detail.id,"touchend",T)},this.onButtonTouchStart=function(R){m(R.detail.id,"touchstart",T)},this.previousButtonValues={},this.bindMethods()},update:function(){var T=this.data;this.controllerIndex=T.hand==="right"?0:T.hand==="left"?1:2},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},addEventListeners:function(){var T=this.el;T.addEventListener("buttonchanged",this.onButtonChanged),T.addEventListener("buttondown",this.onButtonDown),T.addEventListener("buttonup",this.onButtonUp),T.addEventListener("touchstart",this.onButtonTouchStart),T.addEventListener("touchend",this.onButtonTouchEnd),T.addEventListener("axismove",this.onAxisMoved),T.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var T=this.el;T.removeEventListener("buttonchanged",this.onButtonChanged),T.removeEventListener("buttondown",this.onButtonDown),T.removeEventListener("buttonup",this.onButtonUp),T.removeEventListener("touchstart",this.onButtonTouchStart),T.removeEventListener("touchend",this.onButtonTouchEnd),T.removeEventListener("axismove",this.onAxisMoved),T.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var T=this.data;f(this,v,{index:this.controllerIndex,hand:T.hand})},injectTrackedControls:function(){var T=this.el,R=this.data;T.setAttribute("tracked-controls",{idPrefix:v,hand:R.hand,controller:this.controllerIndex,orientationOffset:R.orientationOffset}),this.data.model&&this.el.setAttribute("gltf-model",C)},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(T){var R=this.mapping.buttons[T.detail.id],B;R&&(R==="trigger"&&(B=T.detail.state.value,console.log("analog value of trigger press: "+B)),this.el.emit(R+"changed",T.detail.state))},onModelLoaded:function(T){var R=T.detail.model;R.scale.set(.01,.01,.01)},onAxisMoved:function(T){g(this,this.mapping.axes,T)},updateModel:function(T,R){},setButtonColor:function(T,R){}})},"./src/components/material.js":(l,u,c)=>{var h=c("./src/utils/index.js"),p=c("./src/core/component.js"),f=c("./src/lib/three.js"),g=c("./src/core/shader.js"),m=h.debug("components:material:error"),y=p.registerComponent,b=g.shaders,v=g.shaderNames;l.exports.Component=y("material",{schema:{alphaTest:{default:0,min:0,max:1},depthTest:{default:!0},depthWrite:{default:!0},flatShading:{default:!1},npot:{default:!1},offset:{type:"vec2",default:{x:0,y:0}},opacity:{default:1,min:0,max:1},repeat:{type:"vec2",default:{x:1,y:1}},shader:{default:"standard",oneOf:v,schemaChange:!0},side:{default:"front",oneOf:["front","back","double"]},transparent:{default:!1},vertexColorsEnabled:{default:!1},visible:{default:!0},blending:{default:"normal",oneOf:["none","normal","additive","subtractive","multiply"]},dithering:{default:!0},anisotropy:{default:0,min:0}},init:function(){this.material=null},update:function(T){var R=this.data;(!this.shader||R.shader!==T.shader)&&this.updateShader(R.shader),this.shader.update(this.data),this.updateMaterial(T)},updateSchema:function(T){var R,B,I,D;B=T&&T.shader,R=this.oldData&&this.oldData.shader,D=B||R,I=b[D]&&b[D].schema,I||m("Unknown shader schema "+D),!(R&&B===R)&&(this.extendSchema(I),this.updateBehavior())},updateBehavior:function(){var T,R=this.el.sceneEl,B=this.schema,I=this,D;function L(O,F){var q;for(q in D)D[q]=O;I.shader.update(D)}this.tick=void 0,D={};for(T in B)B[T].type==="time"&&(this.tick=L,D[T]=!0);R&&(this.tick?R.addBehavior(this):R.removeBehavior(this))},updateShader:function(T){var R=this.data,B=b[T]&&b[T].Shader,I;if(!B)throw new Error("Unknown shader "+T);I=this.shader=new B,I.el=this.el,I.init(R),this.setMaterial(I.material),this.updateSchema(R)},updateMaterial:function(T){var R=this.data,B=this.material,I;B.alphaTest=R.alphaTest,B.depthTest=R.depthTest!==!1,B.depthWrite=R.depthWrite!==!1,B.opacity=R.opacity,B.flatShading=R.flatShading,B.side=_(R.side),B.transparent=R.transparent!==!1||R.opacity<1,B.vertexColors=R.vertexColorsEnabled,B.visible=R.visible,B.blending=C(R.blending),B.dithering=R.dithering;for(I in T)break;I&&(T.alphaTest!==R.alphaTest||T.side!==R.side||T.vertexColorsEnabled!==R.vertexColorsEnabled)&&(B.needsUpdate=!0)},remove:function(){var T=new f.MeshBasicMaterial,R=this.material,B=this.el.getObject3D("mesh");B&&(B.material=T),E(R,this.system)},setMaterial:function(T){var R=this.el,B,I=this.system;this.material&&E(this.material,I),this.material=T,I.registerMaterial(T),B=R.getObject3D("mesh"),B?B.material=T:R.addEventListener("object3dset",function D(L){L.detail.type!=="mesh"||L.target!==R||(R.getObject3D("mesh").material=T,R.removeEventListener("object3dset",D))})}});function _(T){switch(T){case"back":return f.BackSide;case"double":return f.DoubleSide;default:return f.FrontSide}}function C(T){switch(T){case"none":return f.NoBlending;case"additive":return f.AdditiveBlending;case"subtractive":return f.SubtractiveBlending;case"multiply":return f.MultiplyBlending;default:return f.NormalBlending}}function E(T,R){T.dispose(),R.unregisterMaterial(T),Object.keys(T).filter(function(B){return T[B]&&T[B].isTexture}).forEach(function(B){T[B].dispose()})}},"./src/components/obb-collider.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/lib/three.js");h("obb-collider",{schema:{size:{default:0},trackedObject3D:{default:""},minimumColliderDimension:{default:.02},centerModel:{default:!1}},init:function(){this.previousScale=new p.Vector3().copy(this.el.object3D.scale),this.auxEuler=new p.Euler,this.boundingBox=new p.Box3,this.boundingBoxSize=new p.Vector3,this.updateCollider=this.updateCollider.bind(this),this.onModelLoaded=this.onModelLoaded.bind(this),this.updateBoundingBox=this.updateBoundingBox.bind(this),this.el.addEventListener("model-loaded",this.onModelLoaded),this.updateCollider(),this.system.addCollider(this.el)},remove:function(){this.system.removeCollider(this.el)},update:function(){this.data.trackedObject3D&&(this.trackedObject3DPath=this.data.trackedObject3D.split("."))},onModelLoaded:function(){this.data.centerModel&&this.centerModel(),this.updateCollider()},centerModel:function(){var f=this.el,g=f.components["gltf-model"]&&f.components["gltf-model"].model,m,y;g&&(this.el.removeObject3D("mesh"),m=new p.Box3().setFromObject(g),y=m.getCenter(new p.Vector3),g.position.x+=g.position.x-y.x,g.position.y+=g.position.y-y.y,g.position.z+=g.position.z-y.z,this.el.setObject3D("mesh",g))},updateCollider:function(){var f=this.el,g=this.boundingBoxSize,m=this.aabb=this.aabb||new p.OBB;if(this.obb=this.obb||new p.OBB,!f.hasLoaded){f.addEventListener("loaded",this.updateCollider);return}this.updateBoundingBox(),m.halfSize.copy(g).multiplyScalar(.5),this.el.sceneEl.systems["obb-collider"].data.showColliders&&this.showCollider()},showCollider:function(){this.updateColliderMesh(),this.renderColliderMesh.visible=!0},updateColliderMesh:function(){var f=this.renderColliderMesh,g=this.boundingBoxSize;if(!f){this.initColliderMesh();return}f.geometry.dispose(),f.geometry=new p.BoxGeometry(g.x,g.y,g.z)},hideCollider:function(){this.renderColliderMesh&&(this.renderColliderMesh.visible=!1)},initColliderMesh:function(){var f,g,m;f=this.boundingBoxSize,g=this.renderColliderGeometry=new p.BoxGeometry(f.x,f.y,f.z),m=this.renderColliderMesh=new p.Mesh(g,new p.MeshLambertMaterial({color:65280,side:p.DoubleSide})),m.matrixAutoUpdate=!1,m.matrixWorldAutoUpdate=!1,m.updateMatrixWorld=function(){},this.el.sceneEl.object3D.add(m)},updateBoundingBox:function(){var f=new p.Vector3,g=new p.Vector3,m=new p.Quaternion,y=new p.Quaternion,b=new p.Matrix4;return function(){var v=this.auxEuler,_=this.boundingBox,C=this.data.size,E=this.trackedObject3D||this.el.object3D,T=this.boundingBoxSize,R=this.data.minimumColliderDimension;if(C){this.boundingBoxSize.x=C,this.boundingBoxSize.y=C,this.boundingBoxSize.z=C;return}v.copy(E.rotation),E.rotation.set(0,0,0),E.parent.matrixWorld.decompose(f,m,g),b.compose(f,y,g),E.parent.matrixWorld.copy(b),_.setFromObject(E,!0),_.getSize(T),T.x=T.x<R?R:T.x,T.y=T.y<R?R:T.y,T.z=T.z<R?R:T.z,E.parent.matrixWorld.compose(f,m,g),this.el.object3D.rotation.copy(v)}}(),checkTrackedObject:function(){var f=this.trackedObject3DPath,g;if(f&&f.length&&!this.trackedObject3D){g=this.el;for(var m=0;m<f.length&&(g=g[f[m]],!!g);m++);g&&(this.trackedObject3D=g,this.updateCollider())}return this.trackedObject3D},tick:function(){var f=new p.Vector3,g=new p.Vector3,m=new p.Quaternion,y=new p.Matrix4;return function(){var b=this.obb,v=this.renderColliderMesh,_=this.checkTrackedObject()||this.el.object3D;_&&(_.updateMatrix(),_.updateMatrixWorld(!0),_.matrixWorld.decompose(f,m,g),(Math.abs(g.x-this.previousScale.x)>1e-4||Math.abs(g.y-this.previousScale.y)>1e-4||Math.abs(g.z-this.previousScale.z)>1e-4)&&this.updateCollider(),this.previousScale.copy(g),g.set(1,1,1),y.compose(f,m,g),v&&v.matrixWorld.copy(y),b.copy(this.aabb),b.applyMatrix4(y))}}()})},"./src/components/obj-model.js":(l,u,c)=>{var h=c("./src/utils/debug.js"),p=c("./src/core/component.js").registerComponent,f=c("./src/lib/three.js"),g=h("components:obj-model:warn");l.exports.Component=p("obj-model",{schema:{mtl:{type:"model"},obj:{type:"model"}},init:function(){var m=this;this.model=null,this.objLoader=new f.OBJLoader,this.mtlLoader=new f.MTLLoader(this.objLoader.manager),this.mtlLoader.crossOrigin="",this.el.addEventListener("componentinitialized",function(y){m.model&&y.detail.name==="material"&&m.applyMaterial()})},update:function(){var m=this.data;m.obj&&(this.resetMesh(),this.loadObj(m.obj,m.mtl))},remove:function(){this.resetMesh()},resetMesh:function(){this.model&&this.el.removeObject3D("mesh")},loadObj:function(m,y){var b=this,v=this.el,_=this.mtlLoader,C=this.objLoader,E=this.el.sceneEl.systems.renderer,T=y.substr(0,y.lastIndexOf("/")+1);if(y){v.hasAttribute("material")&&g("Material component properties are ignored when a .MTL is provided"),_.setResourcePath(T),_.load(y,function(R){R.preload(),C.setMaterials(R),C.load(m,function(B){b.model=B,b.model.traverse(function(I){if(I.isMesh){var D=I.material;D.map&&E.applyColorCorrection(D.map),D.emissiveMap&&E.applyColorCorrection(D.emissiveMap)}}),v.setObject3D("mesh",B),v.emit("model-loaded",{format:"obj",model:B})})});return}C.load(m,function(R){b.model=R,b.applyMaterial(),v.setObject3D("mesh",R),v.emit("model-loaded",{format:"obj",model:R})})},applyMaterial:function(){var m=this.el.components.material;m&&this.model.traverse(function(y){y instanceof f.Mesh&&(y.material=m.material)})}})},"./src/components/oculus-go-controls.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/utils/tracked-controls.js"),f=p.checkControllerPresentAndSetup,g=p.emitIfAxesChanged,m=p.onButtonEvent,y=c("./src/utils/index.js").device.isWebXRAvailable,b="oculus-go",v="Oculus Go",_=c("./src/constants/index.js").AFRAME_CDN_ROOT,C=_+"controllers/oculus/go/oculus-go-controller.gltf",E=y?b:v,T={axes:{trackpad:[0,1]},buttons:["trackpad","trigger"]},R={axes:{touchpad:[0,1]},buttons:["trigger","none","touchpad"]},B=y?R:T;l.exports.Component=h("oculus-go-controls",{schema:{hand:{default:""},buttonColor:{type:"color",default:"#FFFFFF"},buttonTouchedColor:{type:"color",default:"#BBBBBB"},buttonHighlightColor:{type:"color",default:"#7A7A7A"},model:{default:!0},orientationOffset:{type:"vec3"},armModel:{default:!0}},mapping:B,bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},init:function(){var I=this;this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(D){m(D.detail.id,"down",I)},this.onButtonUp=function(D){m(D.detail.id,"up",I)},this.onButtonTouchStart=function(D){m(D.detail.id,"touchstart",I)},this.onButtonTouchEnd=function(D){m(D.detail.id,"touchend",I)},this.controllerPresent=!1,this.lastControllerCheck=0,this.bindMethods()},addEventListeners:function(){var I=this.el;I.addEventListener("buttonchanged",this.onButtonChanged),I.addEventListener("buttondown",this.onButtonDown),I.addEventListener("buttonup",this.onButtonUp),I.addEventListener("touchstart",this.onButtonTouchStart),I.addEventListener("touchend",this.onButtonTouchEnd),I.addEventListener("model-loaded",this.onModelLoaded),I.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var I=this.el;I.removeEventListener("buttonchanged",this.onButtonChanged),I.removeEventListener("buttondown",this.onButtonDown),I.removeEventListener("buttonup",this.onButtonUp),I.removeEventListener("touchstart",this.onButtonTouchStart),I.removeEventListener("touchend",this.onButtonTouchEnd),I.removeEventListener("model-loaded",this.onModelLoaded),I.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){f(this,E,this.data.hand?{hand:this.data.hand}:{})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var I=this.el,D=this.data;I.setAttribute("tracked-controls",{armModel:D.armModel,hand:D.hand,idPrefix:E,orientationOffset:D.orientationOffset}),this.data.model&&this.el.setAttribute("gltf-model",C)},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelLoaded:function(I){var D=I.detail.model,L;I.target!==this.el||!this.data.model||(L=this.buttonMeshes={},L.trigger=D.getObjectByName("oculus_go_button_trigger"),L.trackpad=D.getObjectByName("oculus_go_touchpad"),L.touchpad=D.getObjectByName("oculus_go_touchpad"))},onButtonChanged:function(I){var D=this.mapping.buttons[I.detail.id];D&&this.el.emit(D+"changed",I.detail.state)},onAxisMoved:function(I){g(this,this.mapping.axes,I)},updateModel:function(I,D){this.data.model&&this.updateButtonModel(I,D)},updateButtonModel:function(I,D){var L=this.buttonMeshes;if(!(!L||!L[I])){var O,F;switch(D){case"down":O=this.data.buttonHighlightColor;break;case"touchstart":O=this.data.buttonTouchedColor;break;default:O=this.data.buttonColor}F=L[I],F.material.color.set(O)}}})},"./src/components/oculus-touch-controls.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/lib/three.js"),f=c("./src/utils/tracked-controls.js"),g=f.checkControllerPresentAndSetup,m=f.emitIfAxesChanged,y=f.onButtonEvent,b=c("./src/utils/index.js").device.isWebXRAvailable,v="oculus-touch",_="Oculus Touch",C=b?v:_,E=c("./src/constants/index.js").AFRAME_CDN_ROOT,T=E+"controllers/oculus/oculus-touch-controller-",R=E+"controllers/meta/",B={left:{modelUrl:T+"left.gltf",rayOrigin:{origin:{x:.008,y:-.01,z:0},direction:{x:0,y:-.8,z:-1}},modelPivotOffset:new p.Vector3(-.005,.003,-.055),modelPivotRotation:new p.Euler(0,0,0)},right:{modelUrl:T+"right.gltf",rayOrigin:{origin:{x:-.008,y:-.01,z:0},direction:{x:0,y:-.8,z:-1}},modelPivotOffset:new p.Vector3(.005,.003,-.055),modelPivotRotation:new p.Euler(0,0,0)}},I={left:{modelUrl:T+"left.gltf",rayOrigin:{origin:{x:.002,y:-.005,z:-.03},direction:{x:0,y:-.8,z:-1}},modelPivotOffset:new p.Vector3(-.005,.036,-.037),modelPivotRotation:new p.Euler(Math.PI/4.5,0,0)},right:{modelUrl:T+"right.gltf",rayOrigin:{origin:{x:-.002,y:-.005,z:-.03},direction:{x:0,y:-.8,z:-1}},modelPivotOffset:new p.Vector3(.005,.036,-.037),modelPivotRotation:new p.Euler(Math.PI/4.5,0,0)}},D=b?I:B,L="oculus-touch",O={"oculus-touch":D,"oculus-touch-v2":{left:{modelUrl:T+"gen2-left.gltf",rayOrigin:{origin:{x:-.006,y:-.03,z:-.04},direction:{x:0,y:-.9,z:-1}},modelPivotOffset:new p.Vector3(0,-.007,-.021),modelPivotRotation:new p.Euler(-Math.PI/4,0,0)},right:{modelUrl:T+"gen2-right.gltf",rayOrigin:{origin:{x:.006,y:-.03,z:-.04},direction:{x:0,y:-.9,z:-1}},modelPivotOffset:new p.Vector3(0,-.007,-.021),modelPivotRotation:new p.Euler(-Math.PI/4,0,0)}},"oculus-touch-v3":{left:{modelUrl:T+"v3-left.glb",rayOrigin:{origin:{x:.0065,y:-.0186,z:-.05},direction:{x:.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new p.Vector3(0,0,0),modelPivotRotation:new p.Euler(0,0,0)},right:{modelUrl:T+"v3-right.glb",rayOrigin:{origin:{x:-.0065,y:-.0186,z:-.05},direction:{x:-.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new p.Vector3(0,0,0),modelPivotRotation:new p.Euler(0,0,0)}},"meta-quest-touch-pro":{left:{modelUrl:R+"quest-touch-pro-left.glb",rayOrigin:{origin:{x:.0065,y:-.0186,z:-.05},direction:{x:.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new p.Vector3(0,0,0),modelPivotRotation:new p.Euler(0,0,0)},right:{modelUrl:R+"quest-touch-pro-right.glb",rayOrigin:{origin:{x:-.0065,y:-.0186,z:-.05},direction:{x:-.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new p.Vector3(0,0,0),modelPivotRotation:new p.Euler(0,0,0)}},"meta-quest-touch-plus":{left:{modelUrl:R+"quest-touch-plus-left.glb",rayOrigin:{origin:{x:.0065,y:-.0186,z:-.05},direction:{x:.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new p.Vector3(0,0,0),modelPivotRotation:new p.Euler(0,0,0)},right:{modelUrl:R+"quest-touch-plus-right.glb",rayOrigin:{origin:{x:-.0065,y:-.0186,z:-.05},direction:{x:-.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new p.Vector3(0,0,0),modelPivotRotation:new p.Euler(0,0,0)}}},F={left:{axes:{thumbstick:[0,1]},buttons:["thumbstick","trigger","grip","xbutton","ybutton","surface"]},right:{axes:{thumbstick:[0,1]},buttons:["thumbstick","trigger","grip","abutton","bbutton","surface"]}},q={left:{axes:{thumbstick:[2,3]},buttons:["trigger","grip","none","thumbstick","xbutton","ybutton","surface"]},right:{axes:{thumbstick:[2,3]},buttons:["trigger","grip","none","thumbstick","abutton","bbutton","surface"]}},H=b?q:F;l.exports.Component=h("oculus-touch-controls",{schema:{hand:{default:"left"},buttonColor:{type:"color",default:"#999"},buttonTouchColor:{type:"color",default:"#8AB"},buttonHighlightColor:{type:"color",default:"#2DF"},model:{default:!0},controllerType:{default:"auto",oneOf:["auto","oculus-touch","oculus-touch-v2","oculus-touch-v3"]},orientationOffset:{type:"vec3",default:{x:43,y:0,z:0}}},after:["tracked-controls"],mapping:H,bindMethods:function(){this.onButtonChanged=this.onButtonChanged.bind(this),this.onThumbstickMoved=this.onThumbstickMoved.bind(this),this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},init:function(){var J=this;this.onButtonDown=function(Q){y(Q.detail.id,"down",J,J.data.hand)},this.onButtonUp=function(Q){y(Q.detail.id,"up",J,J.data.hand)},this.onButtonTouchStart=function(Q){y(Q.detail.id,"touchstart",J,J.data.hand)},this.onButtonTouchEnd=function(Q){y(Q.detail.id,"touchend",J,J.data.hand)},this.controllerPresent=!1,this.lastControllerCheck=0,this.previousButtonValues={},this.bindMethods(),this.triggerEuler=new p.Euler},addEventListeners:function(){var J=this.el;J.addEventListener("buttonchanged",this.onButtonChanged),J.addEventListener("buttondown",this.onButtonDown),J.addEventListener("buttonup",this.onButtonUp),J.addEventListener("touchstart",this.onButtonTouchStart),J.addEventListener("touchend",this.onButtonTouchEnd),J.addEventListener("axismove",this.onAxisMoved),J.addEventListener("model-loaded",this.onModelLoaded),J.addEventListener("thumbstickmoved",this.onThumbstickMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var J=this.el;J.removeEventListener("buttonchanged",this.onButtonChanged),J.removeEventListener("buttondown",this.onButtonDown),J.removeEventListener("buttonup",this.onButtonUp),J.removeEventListener("touchstart",this.onButtonTouchStart),J.removeEventListener("touchend",this.onButtonTouchEnd),J.removeEventListener("axismove",this.onAxisMoved),J.removeEventListener("model-loaded",this.onModelLoaded),J.removeEventListener("thumbstickmoved",this.onThumbstickMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){g(this,C,{hand:this.data.hand,iterateControllerProfiles:!0})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},loadModel:function(J){var Q=this.data,V;if(Q.model){if(this.controllerObject3D){this.el.setObject3D("mesh",this.controllerObject3D);return}if(this.displayModel=O[Q.controllerType]||O[L],Q.controllerType==="auto"){var z=this.el.sceneEl.systems["tracked-controls-webvr"];if(z&&z.vrDisplay){var te=z.vrDisplay.displayName;/^Oculus Quest$/.test(te)&&(this.displayModel=O["oculus-touch-v2"])}else{V=L;for(var K=Object.keys(O),ae=0;ae<J.profiles.length;ae++)if(K.indexOf(J.profiles[ae])!==-1){V=J.profiles[ae];break}this.displayModel=O[V]}}var Ae=this.displayModel[Q.hand].modelUrl;this.isTouchV3orPROorPlus=this.displayModel===O["oculus-touch-v3"]||this.displayModel===O["meta-quest-touch-pro"]||this.displayModel===O["meta-quest-touch-plus"],this.el.setAttribute("gltf-model",Ae)}},injectTrackedControls:function(J){var Q=this.data,V=v,z=Q.hand==="right"?"Oculus Touch (Right)":"Oculus Touch (Left)",te=b?V:z;this.el.setAttribute("tracked-controls",{id:te,hand:Q.hand,orientationOffset:Q.orientationOffset,handTrackingEnabled:!1,iterateControllerProfiles:!0,space:"gripSpace"}),this.loadModel(J)},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(J){var Q=this.mapping[this.data.hand].buttons[J.detail.id];if(Q){if(this.isTouchV3orPROorPlus)this.onButtonChangedV3orPROorPlus(J);else{var V=this.buttonMeshes,z;(Q==="trigger"||Q==="grip")&&(z=J.detail.state.value),V&&(Q==="trigger"&&V.trigger&&(V.trigger.rotation.x=this.originalXRotationTrigger-z*(Math.PI/26)),Q==="grip"&&V.grip&&(z*=this.data.hand==="left"?-1:1,V.grip.position.x=this.originalXPositionGrip+z*.004))}this.el.emit(Q+"changed",J.detail.state)}},onButtonChangedV3orPROorPlus:function(J){var Q=this.mapping[this.data.hand].buttons[J.detail.id],V=this.buttonObjects,z;!V||!V[Q]||(z=J.detail.state.value,V[Q].quaternion.slerpQuaternions(this.buttonRanges[Q].min.quaternion,this.buttonRanges[Q].max.quaternion,z),V[Q].position.lerpVectors(this.buttonRanges[Q].min.position,this.buttonRanges[Q].max.position,z))},onModelLoaded:function(J){if(!(J.target!==this.el||!this.data.model)){if(this.isTouchV3orPROorPlus)this.onTouchV3orPROorPlusModelLoaded(J);else{var Q=this.controllerObject3D=J.detail.model,V;V=this.buttonMeshes={},V.grip=Q.getObjectByName("buttonHand"),this.originalXPositionGrip=V.grip&&V.grip.position.x,V.trigger=Q.getObjectByName("buttonTrigger"),this.originalXRotationTrigger=V.trigger&&V.trigger.rotation.x,V.thumbstick=Q.getObjectByName("stick"),V.xbutton=Q.getObjectByName("buttonX"),V.abutton=Q.getObjectByName("buttonA"),V.ybutton=Q.getObjectByName("buttonY"),V.bbutton=Q.getObjectByName("buttonB")}for(var z in this.buttonMeshes)this.buttonMeshes[z]&&G(this.buttonMeshes[z]);this.applyOffset(J.detail.model),this.el.emit("controllermodelready",{name:"oculus-touch-controls",model:this.data.model,rayOrigin:this.displayModel[this.data.hand].rayOrigin})}},applyOffset:function(J){J.position.copy(this.displayModel[this.data.hand].modelPivotOffset),J.rotation.copy(this.displayModel[this.data.hand].modelPivotRotation)},onTouchV3orPROorPlusModelLoaded:function(J){var Q=this.controllerObject3D=J.detail.model,V=this.buttonObjects={},z=this.buttonMeshes={},te=this.buttonRanges={};z.grip=Q.getObjectByName("squeeze"),V.grip=Q.getObjectByName("xr_standard_squeeze_pressed_value"),te.grip={min:Q.getObjectByName("xr_standard_squeeze_pressed_min"),max:Q.getObjectByName("xr_standard_squeeze_pressed_max")},V.grip.minX=V.grip.position.x,z.thumbstick=Q.getObjectByName("thumbstick"),V.thumbstick=Q.getObjectByName("xr_standard_thumbstick_pressed_value"),te.thumbstick={min:Q.getObjectByName("xr_standard_thumbstick_pressed_min"),max:Q.getObjectByName("xr_standard_thumbstick_pressed_max")},V.thumbstickXAxis=Q.getObjectByName("xr_standard_thumbstick_xaxis_pressed_value"),te.thumbstickXAxis={min:Q.getObjectByName("xr_standard_thumbstick_xaxis_pressed_min"),max:Q.getObjectByName("xr_standard_thumbstick_xaxis_pressed_max")},V.thumbstickYAxis=Q.getObjectByName("xr_standard_thumbstick_yaxis_pressed_value"),te.thumbstickYAxis={min:Q.getObjectByName("xr_standard_thumbstick_yaxis_pressed_min"),max:Q.getObjectByName("xr_standard_thumbstick_yaxis_pressed_max")},z.trigger=Q.getObjectByName("trigger"),V.trigger=Q.getObjectByName("xr_standard_trigger_pressed_value"),te.trigger={min:Q.getObjectByName("xr_standard_trigger_pressed_min"),max:Q.getObjectByName("xr_standard_trigger_pressed_max")},te.trigger.diff={x:Math.abs(te.trigger.max.rotation.x)-Math.abs(te.trigger.min.rotation.x),y:Math.abs(te.trigger.max.rotation.y)-Math.abs(te.trigger.min.rotation.y),z:Math.abs(te.trigger.max.rotation.z)-Math.abs(te.trigger.min.rotation.z)};var K=this.data.hand==="left"?"x":"a",ae=this.data.hand==="left"?"y":"b",Ae=K+"button",_e=ae+"button";z[Ae]=Q.getObjectByName(K+"_button"),V[Ae]=Q.getObjectByName(K+"_button_pressed_value"),te[Ae]={min:Q.getObjectByName(K+"_button_pressed_min"),max:Q.getObjectByName(K+"_button_pressed_max")},z[_e]=Q.getObjectByName(ae+"_button"),V[_e]=Q.getObjectByName(ae+"_button_pressed_value"),te[_e]={min:Q.getObjectByName(ae+"_button_pressed_min"),max:Q.getObjectByName(ae+"_button_pressed_max")}},onAxisMoved:function(J){m(this,this.mapping[this.data.hand].axes,J)},onThumbstickMoved:function(J){if(!(!this.buttonMeshes||!this.buttonMeshes.thumbstick)){if(this.isTouchV3orPROorPlus){this.updateThumbstickTouchV3orPROorPlus(J);return}for(var Q in J.detail)this.buttonObjects.thumbstick.rotation[this.axisMap[Q]]=this.buttonRanges.thumbstick.originalRotation[this.axisMap[Q]]-Math.PI/8*J.detail[Q]*(Q==="y"||this.data.hand==="right"?-1:1)}},axisMap:{y:"x",x:"z"},updateThumbstickTouchV3orPROorPlus:function(J){var Q=(J.detail.x+1)/2;this.buttonObjects.thumbstickXAxis.quaternion.slerpQuaternions(this.buttonRanges.thumbstickXAxis.min.quaternion,this.buttonRanges.thumbstickXAxis.max.quaternion,Q);var V=(J.detail.y+1)/2;this.buttonObjects.thumbstickYAxis.quaternion.slerpQuaternions(this.buttonRanges.thumbstickYAxis.min.quaternion,this.buttonRanges.thumbstickYAxis.max.quaternion,V)},updateModel:function(J,Q){this.data.model&&this.updateButtonModel(J,Q)},updateButtonModel:function(J,Q){var V=this.buttonMeshes,z,te;V&&V[J]&&(te=Q==="up"||Q==="touchend"?V[J].originalColor||this.data.buttonColor:Q==="touchstart"?this.data.buttonTouchColor:this.data.buttonHighlightColor,z=V[J],z.material.color.set(te))}});function G(J){J.traverse(function(Q){var V;Q.type==="Mesh"&&(V=Q.material.clone(),J.originalColor=Q.material.color,Q.material.dispose(),Q.material=V)})}},"./src/components/pico-controls.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/lib/three.js"),f=c("./src/utils/tracked-controls.js"),g=f.checkControllerPresentAndSetup,m=f.emitIfAxesChanged,y=f.onButtonEvent,b="pico-4",v=c("./src/constants/index.js").AFRAME_CDN_ROOT,_=v+"controllers/pico/pico4/",C={left:{axes:{touchpad:[2,3]},buttons:["trigger","squeeze","none","thumbstick","xbutton","ybutton"]},right:{axes:{touchpad:[2,3]},buttons:["trigger","squeeze","none","thumbstick","abutton","bbutton"]}};l.exports.Component=h("pico-controls",{schema:{hand:{default:"none"},model:{default:!0},orientationOffset:{type:"vec3"}},mapping:C,init:function(){var E=this;this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(T){y(T.detail.id,"down",E,E.data.hand)},this.onButtonUp=function(T){y(T.detail.id,"up",E,E.data.hand)},this.onButtonTouchEnd=function(T){y(T.detail.id,"touchend",E,E.data.hand)},this.onButtonTouchStart=function(T){y(T.detail.id,"touchstart",E,E.data.hand)},this.bindMethods()},update:function(){var E=this.data;this.controllerIndex=E.hand==="right"?0:E.hand==="left"?1:2},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},addEventListeners:function(){var E=this.el;E.addEventListener("buttonchanged",this.onButtonChanged),E.addEventListener("buttondown",this.onButtonDown),E.addEventListener("buttonup",this.onButtonUp),E.addEventListener("touchstart",this.onButtonTouchStart),E.addEventListener("touchend",this.onButtonTouchEnd),E.addEventListener("axismove",this.onAxisMoved),E.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var E=this.el;E.removeEventListener("buttonchanged",this.onButtonChanged),E.removeEventListener("buttondown",this.onButtonDown),E.removeEventListener("buttonup",this.onButtonUp),E.removeEventListener("touchstart",this.onButtonTouchStart),E.removeEventListener("touchend",this.onButtonTouchEnd),E.removeEventListener("axismove",this.onAxisMoved),E.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var E=this.data;g(this,b,{index:this.controllerIndex,hand:E.hand})},injectTrackedControls:function(){var E=this.el,T=this.data;E.setAttribute("tracked-controls",{idPrefix:b,hand:T.hand,controller:this.controllerIndex,orientationOffset:T.orientationOffset}),this.data.model&&this.el.setAttribute("gltf-model",_+this.data.hand+".glb")},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(E){var T=this.mapping[this.data.hand].buttons[E.detail.id],R;T&&(T==="trigger"&&(R=E.detail.state.value,console.log("analog value of trigger press: "+R)),this.el.emit(T+"changed",E.detail.state))},onModelLoaded:function(E){E.target!==this.el||!this.data.model||this.el.emit("controllermodelready",{name:"pico-controls",model:this.data.model,rayOrigin:new p.Vector3(0,0,0)})},onAxisMoved:function(E){m(this,this.mapping.axes,E)}})},"./src/components/position.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent;l.exports.Component=h("position",{schema:{type:"vec3"},update:function(){var p=this.el.object3D,f=this.data;p.position.set(f.x,f.y,f.z)},remove:function(){this.el.object3D.position.set(0,0,0)}})},"./src/components/raycaster.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/lib/three.js"),f=c("./src/utils/index.js"),g=f.debug("components:raycaster:warn"),m=/^[\w\s-.,[\]#]*$/,y={childList:!0,attributes:!0,subtree:!0},b={INTERSECT:"raycaster-intersected",INTERSECTION:"raycaster-intersection",INTERSECT_CLEAR:"raycaster-intersected-cleared",INTERSECTION_CLEAR:"raycaster-intersection-cleared",INTERSECTION_CLOSEST_ENTITY_CHANGED:"raycaster-closest-entity-changed"};l.exports.Component=h("raycaster",{schema:{autoRefresh:{default:!0},direction:{type:"vec3",default:{x:0,y:0,z:-1}},enabled:{default:!0},far:{default:1e3},interval:{default:0},near:{default:0},objects:{default:""},origin:{type:"vec3"},showLine:{default:!1},lineColor:{default:"white"},lineOpacity:{default:1},useWorldCoordinates:{default:!1}},multiple:!0,init:function(){this.clearedIntersectedEls=[],this.unitLineEndVec3=new p.Vector3,this.intersectedEls=[],this.intersections=[],this.newIntersectedEls=[],this.newIntersections=[],this.objects=[],this.prevCheckTime=void 0,this.prevIntersectedEls=[],this.rawIntersections=[],this.raycaster=new p.Raycaster,this.updateOriginDirection(),this.setDirty=this.setDirty.bind(this),this.updateLine=this.updateLine.bind(this),this.observer=new MutationObserver(this.setDirty),this.dirty=!0,this.lineEndVec3=new p.Vector3,this.otherLineEndVec3=new p.Vector3,this.lineData={end:this.lineEndVec3},this.getIntersection=this.getIntersection.bind(this),this.intersectedDetail={el:this.el,getIntersection:this.getIntersection},this.intersectedClearedDetail={el:this.el},this.intersectionClearedDetail={clearedEls:this.clearedIntersectedEls},this.intersectionDetail={}},update:function(_){var C=this.data,E=this.el,T=this.raycaster;T.far=C.far,T.near=C.near,C.showLine&&(C.far!==_.far||C.origin!==_.origin||C.direction!==_.direction||!_.showLine)&&(this.unitLineEndVec3.copy(C.direction).normalize(),this.drawLine()),!C.showLine&&_.showLine&&E.removeAttribute("line"),C.objects!==_.objects&&!m.test(C.objects)&&g('[raycaster] Selector "'+C.objects+'" may not update automatically with DOM changes.'),C.objects||g('[raycaster] For performance, please define raycaster.objects when using raycaster or cursor components to whitelist which entities to intersect with. e.g., raycaster="objects: [data-raycastable]".'),C.autoRefresh!==_.autoRefresh&&E.isPlaying&&(C.autoRefresh?this.addEventListeners():this.removeEventListeners()),_.enabled&&!C.enabled&&this.clearAllIntersections(),this.setDirty()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners()},remove:function(){this.data.showLine&&this.el.removeAttribute("line"),this.clearAllIntersections()},addEventListeners:function(){this.data.autoRefresh&&(this.observer.observe(this.el.sceneEl,y),this.el.sceneEl.addEventListener("object3dset",this.setDirty),this.el.sceneEl.addEventListener("object3dremove",this.setDirty))},removeEventListeners:function(){this.observer.disconnect(),this.el.sceneEl.removeEventListener("object3dset",this.setDirty),this.el.sceneEl.removeEventListener("object3dremove",this.setDirty)},setDirty:function(){this.dirty=!0},refreshObjects:function(){var _=this.data,C;C=_.objects?this.el.sceneEl.querySelectorAll(_.objects):this.el.sceneEl.querySelectorAll("*"),this.objects=this.flattenObject3DMaps(C),this.dirty=!1},tock:function(_){var C=this.data,E=this.prevCheckTime;C.enabled&&(E&&_-E<C.interval||(this.prevCheckTime=_,this.checkIntersections()))},checkIntersections:function(){var _=this.clearedIntersectedEls,C=this.el,E=this.data,T,R=this.intersectedEls,B,I=this.intersections,D=this.newIntersectedEls,L=this.newIntersections,O=this.prevIntersectedEls,F=this.rawIntersections;for(this.dirty&&this.refreshObjects(),v(this.prevIntersectedEls,this.intersectedEls),this.updateOriginDirection(),F.length=0,this.raycaster.intersectObjects(this.objects,!0,F),I.length=0,R.length=0,T=0;T<F.length;T++)B=F[T],!(E.showLine&&B.object===C.getObject3D("line"))&&B.object.el&&(I.push(B),R.push(B.object.el));for(L.length=0,D.length=0,T=0;T<I.length;T++)O.indexOf(I[T].object.el)===-1&&(L.push(I[T]),D.push(I[T].object.el));for(_.length=0,T=0;T<O.length;T++)R.indexOf(O[T])===-1&&(O[T].emit(b.INTERSECT_CLEAR,this.intersectedClearedDetail),_.push(O[T]));for(_.length&&C.emit(b.INTERSECTION_CLEAR,this.intersectionClearedDetail),T=0;T<D.length;T++)D[T].emit(b.INTERSECT,this.intersectedDetail);L.length&&(this.intersectionDetail.els=D,this.intersectionDetail.intersections=L,C.emit(b.INTERSECTION,this.intersectionDetail)),(O.length===0&&I.length>0||O.length>0&&I.length===0||O.length&&I.length&&O[0]!==I[0].object.el)&&(this.intersectionDetail.els=this.intersectedEls,this.intersectionDetail.intersections=I,C.emit(b.INTERSECTION_CLOSEST_ENTITY_CHANGED,this.intersectionDetail)),E.showLine&&setTimeout(this.updateLine)},updateLine:function(){var _=this.el,C=this.intersections,E;C.length&&(C[0].object.el===_&&C[1]?E=C[1].distance:E=C[0].distance),this.drawLine(E)},getIntersection:function(_){var C,E;for(C=0;C<this.intersections.length;C++)if(E=this.intersections[C],E.object.el===_)return E;return null},updateOriginDirection:function(){var _=new p.Vector3,C=new p.Vector3;return function(){var E=this.el,T=this.data;if(T.useWorldCoordinates){this.raycaster.set(T.origin,T.direction);return}E.object3D.updateMatrixWorld(),C.setFromMatrixPosition(E.object3D.matrixWorld),(T.origin.x!==0||T.origin.y!==0||T.origin.z!==0)&&(C=E.object3D.localToWorld(C.copy(T.origin))),_.copy(T.direction).transformDirection(E.object3D.matrixWorld).normalize(),this.raycaster.set(C,_)}}(),drawLine:function(_){var C=this.data,E=this.el,T;T=this.lineData.end===this.lineEndVec3?this.otherLineEndVec3:this.lineEndVec3,_===void 0&&(_=C.far===1/0?1e3:C.far),this.lineData.start=C.origin,this.lineData.end=T.copy(this.unitLineEndVec3).multiplyScalar(_).add(C.origin),this.lineData.color=C.lineColor,this.lineData.opacity=C.lineOpacity,E.setAttribute("line",this.lineData)},flattenObject3DMaps:function(_){var C,E,T=this.objects,R=this.el.sceneEl.object3D;function B(D){return D.parent?B(D.parent):D===R}for(T.length=0,E=0;E<_.length;E++){var I=_[E];if(I.isEntity&&I.object3D&&B(I.object3D))for(C in I.object3DMap)T.push(I.getObject3D(C))}return T},clearAllIntersections:function(){var _;for(_=0;_<this.intersectedEls.length;_++)this.intersectedEls[_].emit(b.INTERSECT_CLEAR,this.intersectedClearedDetail);v(this.clearedIntersectedEls,this.intersectedEls),this.intersectedEls.length=0,this.intersections.length=0,this.el.emit(b.INTERSECTION_CLEAR,this.intersectionClearedDetail)}});function v(_,C){var E;for(_.length=C.length,E=0;E<C.length;E++)_[E]=C[E]}},"./src/components/rotation.js":(l,u,c)=>{var h=c("./src/lib/three.js").MathUtils.degToRad,p=c("./src/core/component.js").registerComponent;l.exports.Component=p("rotation",{schema:{type:"vec3"},update:function(){var f=this.data,g=this.el.object3D;g.rotation.set(h(f.x),h(f.y),h(f.z),"YXZ")},remove:function(){this.el.object3D.rotation.set(0,0,0)}})},"./src/components/scale.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent;l.exports.Component=h("scale",{schema:{type:"vec3",default:{x:1,y:1,z:1}},update:function(){var p=this.data,f=this.el.object3D;f.scale.set(p.x,p.y,p.z)},remove:function(){this.el.object3D.scale.set(1,1,1)}})},"./src/components/scene/ar-hit-test.js":(l,u,c)=>{var h="data:image/webp;base64,UklGRkQHAABXRUJQVlA4WAoAAAAQAAAA/wEA/wEAQUxQSL0DAAARDzD/ERGCjrY9sYYFfgo6aa1kJ7K0w9Lo3AadLSVeFxevQwj5kuM8RfR/Atw/C0+ozB/oUBrloFZs6ElSW88j1KA4yExNWQaqRZquIDF0JYmlq0hAuUDTFu66tng3teW7pa3cQf1V1edvur54M/Slm6Wv3Gx9zw0MXlQLntcsBN6wkHjTQuYtC4W3LTw8mGRVG57TbAROtxHfZNhInGkjc5aNwtk2Hg6Mvki14k+NkZzCwQgCxalcAv3kddRTPI1DcUrXId1FLf1uHpzaQz4tquhZVLlKesbVpqKeTj0n0F5PpXDlFN9UqmhalL/ImuZFo6KmToWLoKlddMprqlS8cKovBvHo2kTiFV2LN4msaxKZl3QNiair8xYRdDWivIvXVXmbcMqJ51UebZuFXxZt6xd4laxtciqRtA3Cv0nU1t+kEUFbI8JvCa+tvkm3FDlO/W+OR99+kWEp/YYo+tYfTVnf/K8cE/F///3vv//993eeL+a+uvjawLcX3xjYvJotBFY3kVjTRGFtE+BU2AiMbiQyhpHMWEYeBozAH5qNBYRDB5KBCaTDBKKBAZTDBoKBDjwHAN5ABeCJBsAZcAAC0YHHxAYSMYBiYgGZWEA2MYFCbCCZGAAIANFEB+AnYgMQTDQAYSJ2AN5EBZAm4gDgTDgAeSIu4DGygTIRN1CMLOCZiACykQlg4jsAycgA8AO+BxCNdJyDkcbwRirDGXGnx8w+FDPrkM3MQ9JQZMYhiiwV/RDMtIM3U1/DmXHUo+IR2kSR2ToWkQ1NIn2qf2J8LCqJKiDUiSADHY3whirhdHgZ94HKaR97PhE+twEUJUFoAcgyTct8hfSxSkShASDKdMJ/ritKHwgyQ0sD4D/miCxU5SbhOOUDTnZpccCjYP/i0bZ/8bAgtVGEoGapWIQXyzKVKLwgNJFk2rtMIgoNRJlOZF7SNSSyUEeQmbxBFKEmtYjEe8S8zOZ1AkJVCmS88FJOtF40Ksg4oUaFiygk3C8qlTVNyl8UTevCUdAE2t14PfVqU1FPp57TopKeQZWromddTQp6QOfTOEQt/ZDuipZ11w/wOiqO8dRORcc6BQEkDQMClaHcn5wV9yLbxsNZNgpn2sicYSNxuo34Js1G4FQbnuNsOPa28PCWhcKbFjJvWEi8ZiHwqgXPcxbc5db33Cx95WboSzddX7yp+vyN0+eul7ZyN7Xlu64t3jVt4c5pc4JLV5EYupJE0xUknC4nOjVlmaYpyLit53HCQ0+ScnqceNcS5dzUkd0/CwMAVlA4IGADAAAQXwCdASoAAgACP8ne6Wy/tjCpqJ/IA/A5CWlu4XYBG/Pz8AfwD8APz//f3v8E1fuHZnxKYACtfuHZnxKYACrYTb5mOslhxu843ecbvON3nG7zjd3a0VCn7G1MABVxwH/Xd25gAK1+4dmfEpe2+PHhQaj75++riG6FuYACtfuHZnxKYACRrK3q9xO8Ss3uWKnMhs/rDF1hi6wxdYYusMXWGI5QRcCFDZog5OgqNlse1NDuz/UoFa/cOzPiUwAEsAOK4/nu5eZHK2tlXxJfNYlMABWv3Dsz4bvNJ5YA/LtxJ38SmAArX7h2Z8Sk5vdZUYv7mZPiUwAFa/cOzPh21s5OgZxf1mfEpemRyFr/rM+JS9noA/LtxJ38SmAAlUJIotzAASn6TjdhK+D3Dsz4dyvB7h2Z8O2tnJ0DOL+sz4lL2nKLT4lL/+iSLOocxq639w7M34MNZdm55uJ8v8ra2cpVZnxKTq2F3PN/cNksAfl24k7+JTAASqrD37h2Z7b1W+VtbOUqsz4lJ1bC7nm/uGyWAPy7cSd/EpgAJVVh79w7M9t6rfK2tnKVWZ8Sk6thdzzf3DZLAH5duJO/iUwAEqqw9+4dme29VvlbWzlKrM+JSdWwu55v7hslgD8u3EnfxKYACVVYe/cOzPbeq3ytrZylVme0kYJ8557FLerqFrzIbPrrf3DZLAH5duJO/iUvaVMS9BoaF4p7pSDFTP1XMyfElelrM0DOL+sz4eBJ13nV1OppBGPuKb4YzXQgq9uH19uS/0+JS9t9fr6ZUlQBelDG6GMgq97otb5QMPJwtKyBTbFp8Sl7b6/X0ykkawEOsgdiE6Fi0vb/Eve6xkwsmug0Z4nGNHQO8839bpTsjpz7SWIJxKagvd1QWMa6FYT1KEw3j4XDT6vJ9Xk+nyfT5Pq8n1eEmk5dinMM/9Fcfz4Z3Dsz3KD2dw7LxBRxKrqUUGQPH/7zxr1KIfNpLEJ0MZB2ITM/0Z2EFoh12NlXnEcpYcbvON3nG7zjd5xu84vfcNIAAP7+y8ceyzbVxkakPYY4lcr72fqOnDwipv+yxC71wAADBrjKnAAAAAAAAAAAAAAw7oNGHttqWONcoFN/2WIDc2pa6WVFtFYROlsaMaTXdcOjXHz93+YxAglKa4AAAAA=",p=c("./src/core/component.js").registerComponent,f=c("./src/lib/three.js"),g=21,m=function(){var _=new f.Quaternion,C=new f.Vector3;function E(T,R,B){R.position.copy(T.transform.position),R.quaternion.copy(T.transform.orientation),C.copy(B),_.copy(T.transform.orientation),C.applyQuaternion(_),R.position.sub(C)}return E}();m.tempFakePose={transform:{orientation:new f.Quaternion,position:new f.Vector3}};function y(_,C){this.renderer=_,this.xrHitTestSource=null,_.xr.addEventListener("sessionend",(function(){this.xrHitTestSource=null}).bind(this)),_.xr.addEventListener("sessionstart",(function(){this.sessionStart(C)}).bind(this)),this.renderer.xr.isPresenting&&this.sessionStart(C)}y.prototype.previousFrameAnchors=new Set,y.prototype.anchorToObject3D=new Map;function b(_){console.warn(_.message),console.warn('Cannot requestHitTestSource Are you missing: webxr="optionalFeatures: hit-test;" from <a-scene>?')}y.prototype.sessionStart=function(_){if(this.session=this.renderer.xr.getSession(),!("requestHitTestSource"in this.session)){b({message:"No requestHitTestSource on the session."});return}_.space?this.session.requestHitTestSource(_).then((function(C){this.xrHitTestSource=C}).bind(this)).catch(b):_.profile&&this.session.requestHitTestSourceForTransientInput(_).then((function(C){this.xrHitTestSource=C,this.transient=!0}).bind(this)).catch(b)},y.prototype.anchorFromLastHitTestResult=function(_,C){var E=this.lastHitTest;if(E){var T={object3D:_,offset:C};Array.from(this.anchorToObject3D.entries()).forEach((function(R){var B=R[1].object3D,I=R[0];B===_&&(this.anchorToObject3D.delete(I),I.delete())}).bind(this)),E.createAnchor&&E.createAnchor().then((function(R){this.anchorToObject3D.set(R,T)}).bind(this)).catch(function(R){console.warn(R.message),console.warn('Cannot create anchor, are you missing: webxr="optionalFeatures: anchors;" from <a-scene>?')})}},y.prototype.doHit=function(_){if(this.renderer.xr.isPresenting){var C=this.renderer.xr.getReferenceSpace(),E=_.getViewerPose(C),T,R;if(this.xrHitTestSource&&E)return this.transient?(T=_.getHitTestResultsForTransientInput(this.xrHitTestSource),T.length>0?(R=T[0].results,R.length>0?(this.lastHitTest=R[0],R[0].getPose(C)):!1):!1):(T=_.getHitTestResults(this.xrHitTestSource),T.length>0?(this.lastHitTest=T[0],T[0].getPose(C)):!1)}},y.updateAnchorPoses=function(_,C){var E=_.trackedAnchors||y.prototype.previousFrameAnchors;y.prototype.previousFrameAnchors.forEach(function(T){E.has(T)||y.prototype.anchorToObject3D.delete(T)}),E.forEach(function(T){var R,B,I,D;try{R=_.getPose(T.anchorSpace,C)}catch{}if(R){if(B=y.prototype.anchorToObject3D.get(T),!B)return;I=B.offset,D=B.object3D,m(R,D,I)}})};var v;l.exports.Component=p("ar-hit-test",{schema:{target:{type:"selector"},enabled:{default:!0},src:{default:h,type:"map"},type:{default:"footprint",oneOf:["footprint","map"]},footprintDepth:{default:.1},mapSize:{type:"vec2",default:{x:.5,y:.5}}},sceneOnly:!0,init:function(){this.hitTest=null,this.imageDataArray=new Uint8ClampedArray(1048576),this.imageData=new ImageData(this.imageDataArray,512,512),this.textureCache=new Map,this.orthoCam=new f.OrthographicCamera,this.orthoCam.layers.set(g),this.textureTarget=new f.WebGLRenderTarget(512,512,{}),this.basicMaterial=new f.MeshBasicMaterial({color:0,side:f.DoubleSide}),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.context.imageSmoothingEnabled=!1,this.canvas.width=512,this.canvas.height=512,this.canvasTexture=new f.CanvasTexture(this.canvas,{alpha:!0}),this.canvasTexture.flipY=!1;var _=this.el.getAttribute("webxr"),C=_.optionalFeatures;(!C.includes("hit-test")||!C.includes("anchors"))&&(C.push("hit-test"),C.push("anchors"),this.el.setAttribute("webxr",_)),this.el.sceneEl.renderer.xr.addEventListener("sessionend",(function(){this.hitTest=null}).bind(this)),this.el.sceneEl.renderer.xr.addEventListener("sessionstart",(function(){if(this.el.is("ar-mode")){var E=this.el.sceneEl.renderer,T=this.session=E.xr.getSession();this.hasPosedOnce=!1,this.bboxMesh.visible=!1,v||(v=new Map),T.requestReferenceSpace("viewer").then((function(I){this.hitTest=new y(E,{space:I}),v.set(I,this.hitTest),this.el.emit("ar-hit-test-start")}).bind(this));var R="generic-touchscreen",B=new y(E,{profile:R});T.addEventListener("selectstart",(function(I){if(this.data.enabled===!0){var D=I.inputSource;this.bboxMesh.visible=!0,this.hasPosedOnce===!0&&(this.el.emit("ar-hit-test-select-start",{inputSource:D,position:this.bboxMesh.position,orientation:this.bboxMesh.quaternion}),D.profiles[0]===R?this.hitTest=B:(this.hitTest=v.get(D)||new y(E,{space:D.targetRaySpace}),v.set(D,this.hitTest)))}}).bind(this)),T.addEventListener("selectend",(function(I){if(!this.hitTest||this.data.enabled!==!0){this.hitTest=null;return}var D=I.inputSource,L;this.hasPosedOnce===!0&&(this.bboxMesh.visible=!1,this.data.target&&(L=this.data.target.object3D,L&&(m.tempFakePose.transform.position.copy(this.bboxMesh.position),m.tempFakePose.transform.orientation.copy(this.bboxMesh.quaternion),m(m.tempFakePose,L,this.bboxOffset),L.visible=!0,this.hitTest.anchorFromLastHitTestResult(L,this.bboxOffset))),this.el.emit("ar-hit-test-select",{inputSource:D,position:this.bboxMesh.position,orientation:this.bboxMesh.quaternion})),this.hitTest=null}).bind(this))}}).bind(this)),this.bboxOffset=new f.Vector3,this.update=this.update.bind(this),this.makeBBox()},update:function(){this.data.enabled===!1&&(this.hitTest=null,this.bboxMesh.visible=!1),this.data.target&&(this.data.target.object3D?(this.data.target.addEventListener("model-loaded",this.update),this.data.target.object3D.layers.enable(g),this.data.target.object3D.traverse(function(_){_.layers.enable(g)})):this.data.target.addEventListener("loaded",this.update,{once:!0})),this.bboxNeedsUpdate=!0},makeBBox:function(){var _=new f.PlaneGeometry(1,1),C=new f.MeshBasicMaterial({transparent:!0,color:16777215});_.rotateX(-Math.PI/2),_.rotateY(-Math.PI/2),this.bbox=new f.Box3,this.bboxMesh=new f.Mesh(_,C),this.el.setObject3D("ar-hit-test",this.bboxMesh),this.bboxMesh.visible=!1},updateFootprint:function(){var _,C=this.el.sceneEl.renderer,E,T,R=C.xr.enabled;this.bboxMesh.material.map=this.canvasTexture,this.bboxMesh.material.needsUpdate=!0,this.orthoCam.rotation.set(-Math.PI/2,0,-Math.PI/2),this.orthoCam.position.copy(this.bboxMesh.position),this.orthoCam.position.y-=this.bboxMesh.scale.y/2,this.orthoCam.near=.1,this.orthoCam.far=this.orthoCam.near+this.data.footprintDepth*this.bboxMesh.scale.y,this.orthoCam.position.y+=this.orthoCam.far,this.orthoCam.right=this.bboxMesh.scale.z/2,this.orthoCam.left=-this.bboxMesh.scale.z/2,this.orthoCam.top=this.bboxMesh.scale.x/2,this.orthoCam.bottom=-this.bboxMesh.scale.x/2,this.orthoCam.updateProjectionMatrix(),E=C.getRenderTarget(),C.setRenderTarget(this.textureTarget),C.xr.enabled=!1,T=this.el.object3D.background,this.el.object3D.overrideMaterial=this.basicMaterial,this.el.object3D.background=null,C.render(this.el.object3D,this.orthoCam),this.el.object3D.background=T,this.el.object3D.overrideMaterial=null,C.xr.enabled=R,C.setRenderTarget(E),C.readRenderTargetPixels(this.textureTarget,0,0,512,512,this.imageDataArray),this.context.putImageData(this.imageData,0,0),this.context.shadowColor="white",this.context.shadowBlur=10,this.context.drawImage(this.canvas,0,0),_=this.context.getImageData(0,0,512,512);for(var B=0;B<262144;B++)_.data[B*4+3]!==0&&_.data[B*4+3]!==255&&(_.data[B*4+3]=128);this.context.putImageData(_,0,0),this.canvasTexture.needsUpdate=!0},tick:function(){var _,C=this.el.sceneEl.frame,E=this.el.sceneEl.renderer;if(C&&y.updateAnchorPoses(C,E.xr.getReferenceSpace()),this.bboxNeedsUpdate){if(this.bboxNeedsUpdate=!1,!this.data.target||this.data.type==="map"){var T;this.textureCache.has(this.data.src)?T=this.textureCache.get(this.data.src):(T=new f.TextureLoader().load(this.data.src),this.textureCache.set(this.data.src,T)),this.bboxMesh.material.map=T,this.bboxMesh.material.needsUpdate=!0}this.data.target&&this.data.target.object3D?(this.bbox.setFromObject(this.data.target.object3D),this.bbox.getCenter(this.bboxMesh.position),this.bbox.getSize(this.bboxMesh.scale),this.data.type==="footprint"&&(this.bboxMesh.scale.x*=1.04,this.bboxMesh.scale.z*=1.04,this.updateFootprint()),this.bboxMesh.position.y-=this.bboxMesh.scale.y/2,this.bboxOffset.copy(this.bboxMesh.position),this.bboxOffset.sub(this.data.target.object3D.position)):this.bboxMesh.scale.set(this.data.mapSize.x,1,this.data.mapSize.y)}this.hitTest&&(_=this.hitTest.doHit(C),_&&(this.hasPosedOnce!==!0&&(this.hasPosedOnce=!0,this.el.emit("ar-hit-test-achieved")),this.bboxMesh.visible=!0,this.bboxMesh.position.copy(_.transform.position),this.bboxMesh.quaternion.copy(_.transform.orientation)))}})},"./src/components/scene/background.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent;l.exports.Component=h("background",{schema:{color:{type:"color",default:"black"},transparent:{default:!1}},sceneOnly:!0,update:function(){var p=this.data,f=this.el.object3D;p.transparent?f.background=null:f.background=new THREE.Color(p.color)},remove:function(){var p=this.el.object3D;p.background=null}})},"./src/components/scene/debug.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent;l.exports.Component=h("debug",{schema:{default:!0},sceneOnly:!0})},"./src/components/scene/device-orientation-permission-ui.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/constants/index.js"),f="a-modal",g="a-dialog",m="a-dialog-text",y="a-dialog-text-container",b="a-dialog-buttons-container",v="a-dialog-button",_="a-dialog-allow-button",C="a-dialog-deny-button",E="a-dialog-ok-button";l.exports.Component=h("device-orientation-permission-ui",{schema:{enabled:{default:!0},deviceMotionMessage:{default:"This immersive website requires access to your device motion sensors."},httpsMessage:{default:"Access this site over HTTPS to enter VR mode and grant access to the device sensors."},denyButtonText:{default:"Deny"},allowButtonText:{default:"Allow"},cancelButtonText:{default:"Cancel"}},sceneOnly:!0,init:function(){var I=this;if(this.data.enabled){if(window.isSecureContext||this.showHTTPAlert(),typeof DeviceOrientationEvent>"u"||!DeviceOrientationEvent.requestPermission){this.permissionGranted=!0;return}this.onDeviceMotionDialogAllowClicked=this.onDeviceMotionDialogAllowClicked.bind(this),this.onDeviceMotionDialogDenyClicked=this.onDeviceMotionDialogDenyClicked.bind(this),DeviceOrientationEvent.requestPermission().then(function(){I.el.emit("deviceorientationpermissiongranted"),I.permissionGranted=!0}).catch(function(){I.devicePermissionDialogEl=T(I.data.denyButtonText,I.data.allowButtonText,I.data.deviceMotionMessage,I.onDeviceMotionDialogAllowClicked,I.onDeviceMotionDialogDenyClicked),I.el.appendChild(I.devicePermissionDialogEl)})}},remove:function(){this.devicePermissionDialogEl&&this.el.removeChild(this.devicePermissionDialogEl)},onDeviceMotionDialogDenyClicked:function(){this.remove()},showHTTPAlert:function(){var I=this,D=R(I.data.cancelButtonText,I.data.httpsMessage,function(){I.el.removeChild(D)});this.el.appendChild(D)},onDeviceMotionDialogAllowClicked:function(){var I=this;this.el.emit("deviceorientationpermissionrequested"),DeviceOrientationEvent.requestPermission().then(function(D){D==="granted"?(I.el.emit("deviceorientationpermissiongranted"),I.permissionGranted=!0):I.el.emit("deviceorientationpermissionrejected"),I.remove()}).catch(console.error)}});function T(I,D,L,O,F){var q,H,G;return q=document.createElement("div"),q.classList.add(b),H=document.createElement("button"),H.classList.add(v,C),H.setAttribute(p.AFRAME_INJECTED,""),H.innerHTML=I,q.appendChild(H),G=document.createElement("button"),G.classList.add(v,_),G.setAttribute(p.AFRAME_INJECTED,""),G.innerHTML=D,q.appendChild(G),G.addEventListener("click",function(J){J.stopPropagation(),O()}),H.addEventListener("click",function(J){J.stopPropagation(),F()}),B(L,q)}function R(I,D,L){var O,F;return O=document.createElement("div"),O.classList.add(b),F=document.createElement("button"),F.classList.add(v,E),F.setAttribute(p.AFRAME_INJECTED,""),F.innerHTML=I,O.appendChild(F),F.addEventListener("click",function(q){q.stopPropagation(),L()}),B(D,O)}function B(I,D){var L,O,F,q;return L=document.createElement("div"),L.classList.add(f),L.setAttribute(p.AFRAME_INJECTED,""),O=document.createElement("div"),O.className=g,O.setAttribute(p.AFRAME_INJECTED,""),L.appendChild(O),F=document.createElement("div"),F.classList.add(y),O.appendChild(F),q=document.createElement("div"),q.classList.add(m),q.innerHTML=I,F.appendChild(q),O.appendChild(D),L}},"./src/components/scene/embedded.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent;l.exports.Component=h("embedded",{dependencies:["xr-mode-ui"],schema:{default:!0},sceneOnly:!0,update:function(){var p=this.el,f=p.querySelector(".a-enter-vr");this.data===!0?(f&&f.classList.add("embedded"),p.removeFullScreenStyles()):(f&&f.classList.remove("embedded"),p.addFullScreenStyles())}})},"./src/components/scene/fog.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/lib/three.js"),f=c("./src/utils/debug.js");f("components:fog:warn"),l.exports.Component=h("fog",{schema:{color:{type:"color",default:"#000"},density:{default:25e-5},far:{default:1e3,min:0},near:{default:1,min:0},type:{default:"linear",oneOf:["linear","exponential"]}},sceneOnly:!0,update:function(){var m=this.data,y=this.el,b=this.el.object3D.fog;if(!b||m.type!==b.name){y.object3D.fog=g(m);return}Object.keys(this.schema).forEach(function(v){var _=m[v];v==="color"&&(_=new p.Color(_)),b[v]=_})},remove:function(){var m=this.el,y=this.el.object3D.fog;y&&(m.object3D.fog=null)}});function g(m){var y;return m.type==="exponential"?y=new p.FogExp2(m.color,m.density):y=new p.Fog(m.color,m.near,m.far),y.name=m.type,y}},"./src/components/scene/inspector.js":(l,u,c)=>{var h=c("./src/constants/index.js").AFRAME_INJECTED,p=c("./package.json"),f=c("./src/core/component.js").registerComponent,g=c("./src/utils/index.js");function m(C){var E=C.split(".");return E[2]="x",E.join(".")}var y="https://unpkg.com/aframe-inspector@"+m(p.version)+"/dist/aframe-inspector.min.js",b=y,v="Loading Inspector",_="Error loading Inspector";l.exports.Component=f("inspector",{schema:{url:{default:b}},sceneOnly:!0,init:function(){this.firstPlay=!0,this.onKeydown=this.onKeydown.bind(this),this.onMessage=this.onMessage.bind(this),this.initOverlay(),window.addEventListener("keydown",this.onKeydown),window.addEventListener("message",this.onMessage)},play:function(){var C;this.firstPlay&&(C=g.getUrlParameter("inspector"),C!=="false"&&C&&(this.openInspector(),this.firstPlay=!1))},initOverlay:function(){var C='<span class="dots"><span>.</span><span>.</span><span>.</span></span>';this.loadingMessageEl=document.createElement("div"),this.loadingMessageEl.classList.add("a-inspector-loader"),this.loadingMessageEl.innerHTML=v+C},remove:function(){this.removeEventListeners()},onKeydown:function(C){var E=C.keyCode===73&&(C.ctrlKey&&C.altKey||C.getModifierState("AltGraph"));E&&this.openInspector()},showLoader:function(){document.body.appendChild(this.loadingMessageEl)},hideLoader:function(){document.body.removeChild(this.loadingMessageEl)},onMessage:function(C){C.data==="INJECT_AFRAME_INSPECTOR"&&this.openInspector()},openInspector:function(C){var E=this,T;if(AFRAME.INSPECTOR||AFRAME.inspectorInjected){AFRAME.INSPECTOR.open(C);return}this.showLoader(),T=document.createElement("script"),T.src=this.data.url,T.setAttribute("data-name","aframe-inspector"),T.setAttribute(h,""),T.onload=function(){AFRAME.INSPECTOR.open(C),E.hideLoader(),E.removeEventListeners()},T.onerror=function(){E.loadingMessageEl.innerHTML=_},document.head.appendChild(T),AFRAME.inspectorInjected=!0},removeEventListeners:function(){window.removeEventListener("keydown",this.onKeydown),window.removeEventListener("message",this.onMessage)}})},"./src/components/scene/keyboard-shortcuts.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/utils/index.js").shouldCaptureKeyEvent;l.exports.Component=h("keyboard-shortcuts",{schema:{enterVR:{default:!0},exitVR:{default:!0}},sceneOnly:!0,init:function(){this.onKeyup=this.onKeyup.bind(this)},update:function(f){var g=this.data;this.enterVREnabled=g.enterVR},play:function(){window.addEventListener("keyup",this.onKeyup,!1)},pause:function(){window.removeEventListener("keyup",this.onKeyup)},onKeyup:function(f){var g=this.el;p(f)&&(this.enterVREnabled&&f.keyCode===70&&g.enterVR(),this.enterVREnabled&&f.keyCode===27&&g.exitVR())}})},"./src/components/scene/pool.js":(l,u,c)=>{var h=c("./src/utils/debug.js"),p=c("./src/core/component.js").registerComponent,f=h("components:pool:warn");l.exports.Component=p("pool",{schema:{container:{default:""},mixin:{default:""},size:{default:0},dynamic:{default:!1}},sceneOnly:!0,multiple:!0,initPool:function(){var g;for(this.availableEls=[],this.usedEls=[],this.data.mixin||f("No mixin provided for pool component."),this.data.container&&(this.container=document.querySelector(this.data.container),this.container||f("Container "+this.data.container+" not found.")),this.container=this.container||this.el,g=0;g<this.data.size;++g)this.createEntity()},update:function(g){var m=this.data;(g.mixin!==m.mixin||g.size!==m.size)&&this.initPool()},createEntity:function(){var g;g=document.createElement("a-entity"),g.play=this.wrapPlay(g.play),g.setAttribute("mixin",this.data.mixin),g.object3D.visible=!1,g.pause(),this.container.appendChild(g),this.availableEls.push(g);var m=this.usedEls;g.addEventListener("loaded",function(){m.indexOf(g)===-1&&(g.object3DParent=g.object3D.parent,g.object3D.parent.remove(g.object3D))})},wrapPlay:function(g){var m=this.usedEls;return function(){m.indexOf(this)!==-1&&g.call(this)}},requestEntity:function(){var g;if(this.availableEls.length===0){if(this.data.dynamic===!1){f("Requested entity from empty pool: "+this.attrName);return}else f("Requested entity from empty pool. This pool is dynamic and will resize automatically. You might want to increase its initial size: "+this.attrName);this.createEntity()}return g=this.availableEls.shift(),this.usedEls.push(g),g.object3DParent&&(g.object3DParent.add(g.object3D),this.updateRaycasters()),g.object3D.visible=!0,g},returnEntity:function(g){var m=this.usedEls.indexOf(g);if(m===-1){f("The returned entity was not previously pooled from "+this.attrName);return}return this.usedEls.splice(m,1),this.availableEls.push(g),g.object3DParent=g.object3D.parent,g.object3D.parent.remove(g.object3D),this.updateRaycasters(),g.object3D.visible=!1,g.pause(),g},updateRaycasters:function(){var g=document.querySelectorAll("[raycaster]");g.forEach(function(m){m.components.raycaster.setDirty()})}})},"./src/components/scene/real-world-meshing.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/lib/three.js");l.exports.Component=h("real-world-meshing",{schema:{filterLabels:{type:"array"},meshesEnabled:{default:!0},meshMixin:{default:!0},planesEnabled:{default:!0},planeMixin:{default:""}},sceneOnly:!0,init:function(){var f=this.el.getAttribute("webxr"),g=f.requiredFeatures;g.indexOf("mesh-detection")===-1&&(g.push("mesh-detection"),this.el.setAttribute("webxr",f)),g.indexOf("plane-detection")===-1&&(g.push("plane-detection"),this.el.setAttribute("webxr",f)),this.meshEntities=[],this.initWorldMeshEntity=this.initWorldMeshEntity.bind(this)},tick:function(){this.el.is("ar-mode")&&(this.detectMeshes(),this.updateMeshes())},detectMeshes:function(){var f=this.data,g,m,y=this.el;y.renderer.xr;var b,v=this.meshEntities,_=!1,C=[],E=this.data.filterLabels;b=y.frame,g=b.detectedMeshes,m=b.detectedPlanes;for(var T=0;T<v.length;T++)v[T].present=!1;if(f.meshesEnabled){for(var R of g.values())if(!(E.length&&E.indexOf(R.semanticLabel)===-1)){for(T=0;T<v.length;T++)if(R===v[T].mesh){_=!0,v[T].present=!0,v[T].lastChangedTime<R.lastChangedTime&&this.updateMeshGeometry(v[T].el,R),v[T].lastChangedTime=R.lastChangedTime;break}_||C.push(R),_=!1}}if(f.planesEnabled){for(R of m.values())if(!(E.length&&E.indexOf(R.semanticLabel)===-1)){for(T=0;T<v.length;T++)if(R===v[T].mesh){_=!0,v[T].present=!0,v[T].lastChangedTime<R.lastChangedTime&&this.updateMeshGeometry(v[T].el,R),v[T].lastChangedTime=R.lastChangedTime;break}_||C.push(R),_=!1}}this.deleteMeshes(),this.createNewMeshes(C)},updateMeshes:function(){var f=new p.Matrix4;return function(){for(var g,m=this.el,y,b=m.frame,v=this.meshEntities,_=m.renderer.xr.getReferenceSpace(),C,E=0;E<v.length;E++)C=v[E].mesh.meshSpace||v[E].mesh.planeSpace,g=b.getPose(C,_),y=v[E].el,y.hasLoaded&&(f.fromArray(g.transform.matrix),f.decompose(y.object3D.position,y.object3D.quaternion,y.object3D.scale))}}(),deleteMeshes:function(){for(var f=this.meshEntities,g=[],m=0;m<f.length;m++)f[m].present?g.push(f[m]):this.el.removeChild(f[m]);this.meshEntities=g},createNewMeshes:function(f){for(var g,m=0;m<f.length;m++)g=document.createElement("a-entity"),this.meshEntities.push({mesh:f[m],el:g}),g.addEventListener("loaded",this.initWorldMeshEntity),this.el.appendChild(g)},initMeshGeometry:function(f){var g,m,y;if(f instanceof XRPlane){m=new p.Shape,y=f.polygon;for(var b=0;b<y.length;++b)b===0?m.moveTo(y[b].x,y[b].z):m.lineTo(y[b].x,y[b].z);return g=new p.ShapeGeometry(m),g.rotateX(Math.PI/2),g}return g=new p.BufferGeometry,g.setAttribute("position",new p.BufferAttribute(f.vertices,3)),g.setIndex(new p.BufferAttribute(f.indices,1)),g},initWorldMeshEntity:function(f){for(var g=f.target,m,y,b,v=this.meshEntities,_=0;_<v.length;_++)if(v[_].el===g){b=v[_];break}m=this.initMeshGeometry(b.mesh),y=new p.Mesh(m,new p.MeshBasicMaterial({color:Math.random()*16777215,side:p.DoubleSide})),g.setObject3D("mesh",y),b.mesh instanceof XRPlane&&this.data.planeMixin?g.setAttribute("mixin",this.data.planeMixin):this.data.meshMixin&&g.setAttribute("mixin",this.data.meshMixin),g.setAttribute("data-world-mesh",b.mesh.semanticLabel)},updateMeshGeometry:function(f,g){var m=f.getObject3D("mesh");m.geometry.dispose(),m.geometry=this.initMeshGeometry(g)}})},"./src/components/scene/reflection.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent;function p(f,g,m,y){var b=Math.max(f.primaryLightIntensity.x,Math.max(f.primaryLightIntensity.y,f.primaryLightIntensity.z));g.sh.fromArray(f.sphericalHarmonicsCoefficients),g.intensity=1,m&&(m.color.setRGB(f.primaryLightIntensity.x/b,f.primaryLightIntensity.y/b,f.primaryLightIntensity.z/b),m.intensity=b,y.copy(f.primaryLightDirection))}l.exports.Component=h("reflection",{schema:{directionalLight:{type:"selector"}},sceneOnly:!0,init:function(){var f=this;this.cubeRenderTarget=new THREE.WebGLCubeRenderTarget(16),this.cubeCamera=new THREE.CubeCamera(.1,1e3,this.cubeRenderTarget),this.lightingEstimationTexture=new THREE.WebGLCubeRenderTarget(16).texture,this.needsVREnvironmentUpdate=!0;var g=this.el.getAttribute("webxr"),m=g.optionalFeatures;m.includes("light-estimation")||(m.push("light-estimation"),this.el.setAttribute("webxr",g)),this.el.addEventListener("enter-vr",function(){if(f.el.is("ar-mode")){var y=f.el.renderer,b=y.xr.getSession();b.requestLightProbe&&f.startLightProbe()}}),this.el.addEventListener("exit-vr",function(){f.xrLightProbe&&f.stopLightProbe()}),this.el.object3D.environment=this.cubeRenderTarget.texture},stopLightProbe:function(){this.xrLightProbe=null,this.probeLight&&(this.probeLight.components.light.light.intensity=0),this.needsVREnvironmentUpdate=!0,this.el.object3D.environment=this.cubeRenderTarget.texture},startLightProbe:function(){this.needsLightProbeUpdate=!0},setupLightProbe:function(){var f=this.el.renderer,g=f.xr.getSession(),m=this,y=f.getContext();if(!this.probeLight){var b=document.createElement("a-light");b.setAttribute("type","probe"),b.setAttribute("intensity",0),this.el.appendChild(b),this.probeLight=b}switch(g.preferredReflectionFormat){case"srgba8":y.getExtension("EXT_sRGB");break;case"rgba16f":y.getExtension("OES_texture_half_float");break}this.glBinding=new XRWebGLBinding(g,y),y.getExtension("EXT_sRGB"),y.getExtension("OES_texture_half_float"),g.requestLightProbe().then(function(v){m.xrLightProbe=v,v.addEventListener("reflectionchange",m.updateXRCubeMap.bind(m))}).catch(function(v){console.warn("Lighting estimation not supported: "+v.message),console.warn('Are you missing: webxr="optionalFeatures: light-estimation;" from <a-scene>?')})},updateXRCubeMap:function(){var f=this.el.renderer,g=this.glBinding.getReflectionCubeMap(this.xrLightProbe);if(g){var m=f.properties.get(this.lightingEstimationTexture);m.__webglTexture=g,this.lightingEstimationTexture.needsPMREMUpdate=!0,this.el.object3D.environment=this.lightingEstimationTexture}},tick:function(){var f=this.el.object3D,g=this.el.renderer,m=this.el.frame;if(m&&this.xrLightProbe){var y=m.getLightEstimate(this.xrLightProbe);y&&p(y,this.probeLight.components.light.light,this.data.directionalLight&&this.data.directionalLight.components.light.light,this.data.directionalLight&&this.data.directionalLight.object3D.position)}this.needsVREnvironmentUpdate&&(f.environment=null,this.needsVREnvironmentUpdate=!1,this.cubeCamera.position.set(0,1.6,0),this.cubeCamera.update(g,f),f.environment=this.cubeRenderTarget.texture),this.needsLightProbeUpdate&&m&&(this.setupLightProbe(),this.needsLightProbeUpdate=!1)},remove:function(){this.el.object3D.environment=null,this.probeLight&&this.el.removeChild(this.probeLight)}})},"./src/components/scene/screenshot.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/lib/three.js"),f=["attribute vec3 position;","attribute vec2 uv;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","varying vec2 vUv;","void main()  {","  vUv = vec2( 1.- uv.x, uv.y );","  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),g=["precision mediump float;","uniform samplerCube map;","varying vec2 vUv;","#define M_PI 3.141592653589793238462643383279","void main() {","  vec2 uv = vUv;","  float longitude = uv.x * 2. * M_PI - M_PI + M_PI / 2.;","  float latitude = uv.y * M_PI;","  vec3 dir = vec3(","    - sin( longitude ) * sin( latitude ),","    cos( latitude ),","    - cos( longitude ) * sin( latitude )","  );","  normalize( dir );","  gl_FragColor = vec4( textureCube( map, dir ).rgb, 1.0 );","}"].join(`
`);l.exports.Component=h("screenshot",{schema:{width:{default:4096},height:{default:2048},camera:{type:"selector"}},sceneOnly:!0,setup:function(){var m=this.el;if(!this.canvas){var y=m.renderer.getContext();y&&(this.cubeMapSize=y.getParameter(y.MAX_CUBE_MAP_TEXTURE_SIZE),this.material=new p.RawShaderMaterial({uniforms:{map:{type:"t",value:null}},vertexShader:f,fragmentShader:g,side:p.DoubleSide}),this.quad=new p.Mesh(new p.PlaneGeometry(1,1),this.material),this.quad.visible=!1,this.camera=new p.OrthographicCamera(-.5,.5,.5,-.5,-1e4,1e4),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),m.object3D.add(this.quad),this.onKeyDown=this.onKeyDown.bind(this))}},getRenderTarget:function(m,y){return new p.WebGLRenderTarget(m,y,{colorSpace:this.el.sceneEl.renderer.outputColorSpace,minFilter:p.LinearFilter,magFilter:p.LinearFilter,wrapS:p.ClampToEdgeWrapping,wrapT:p.ClampToEdgeWrapping,format:p.RGBAFormat,type:p.UnsignedByteType})},resize:function(m,y){this.quad.scale.set(m,y,1),this.camera.left=-1*m/2,this.camera.right=m/2,this.camera.top=y/2,this.camera.bottom=-1*y/2,this.camera.updateProjectionMatrix(),this.canvas.width=m,this.canvas.height=y},play:function(){window.addEventListener("keydown",this.onKeyDown)},onKeyDown:function(m){var y=m.keyCode===83&&m.ctrlKey&&m.altKey;if(!(!this.data||!y)){var b=m.shiftKey?"equirectangular":"perspective";this.capture(b)}},setCapture:function(m){var y=this.el,b,v,_,C;return m==="perspective"?(this.quad.visible=!1,v=this.data.camera&&this.data.camera.components.camera.camera||y.camera,b={width:this.data.width,height:this.data.height}):(v=this.camera,C=new p.WebGLCubeRenderTarget(Math.min(this.cubeMapSize,2048),{format:p.RGBFormat,generateMipmaps:!0,minFilter:p.LinearMipmapLinearFilter,colorSpace:p.SRGBColorSpace}),_=new p.CubeCamera(y.camera.near,y.camera.far,C),y.camera.getWorldPosition(_.position),y.camera.getWorldQuaternion(_.quaternion),_.update(y.renderer,y.object3D),this.quad.material.uniforms.map.value=_.renderTarget.texture,b={width:this.data.width,height:this.data.height},this.quad.visible=!0),{camera:v,size:b,projection:m}},capture:function(m){var y=this.el.renderer.xr.enabled,b=this.el.renderer,v;this.setup(),b.xr.enabled=!1,v=this.setCapture(m),this.renderCapture(v.camera,v.size,v.projection),this.saveCapture(),b.xr.enabled=y},getCanvas:function(m){var y=this.el.renderer.xr.enabled,b=this.el.renderer;this.setup();var v=this.setCapture(m);return b.xr.enabled=!1,this.renderCapture(v.camera,v.size,v.projection),b.xr.enabled=y,this.canvas},renderCapture:function(m,y,b){var v=this.el.renderer.autoClear,_=this.el,C,E,T,R=_.renderer;E=this.getRenderTarget(y.width,y.height),T=new Uint8Array(4*y.width*y.height),this.resize(y.width,y.height),R.autoClear=!0,R.clear(),R.setRenderTarget(E),R.render(_.object3D,m),R.autoClear=v,R.readRenderTargetPixels(E,0,0,y.width,y.height,T),R.setRenderTarget(null),b==="perspective"&&(T=this.flipPixelsVertically(T,y.width,y.height)),C=new ImageData(new Uint8ClampedArray(T),y.width,y.height),this.quad.visible=!1,this.ctx.putImageData(C,0,0)},flipPixelsVertically:function(m,y,b){for(var v=m.slice(0),_=0;_<y;++_)for(var C=0;C<b;++C)v[_*4+C*y*4]=m[_*4+(b-C)*y*4],v[_*4+1+C*y*4]=m[_*4+1+(b-C)*y*4],v[_*4+2+C*y*4]=m[_*4+2+(b-C)*y*4],v[_*4+3+C*y*4]=m[_*4+3+(b-C)*y*4];return v},saveCapture:function(){this.canvas.toBlob(function(m){var y="screenshot-"+document.title.toLowerCase()+"-"+Date.now()+".png",b=document.createElement("a"),v=URL.createObjectURL(m);b.href=v,b.setAttribute("download",y),b.innerHTML="downloading...",b.style.display="none",document.body.appendChild(b),setTimeout(function(){b.click(),document.body.removeChild(b)},1)},"image/png")}})},"./src/components/scene/stats.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./vendor/rStats.js"),f=c("./src/utils/index.js");c("./vendor/rStats.extras.js"),c("./src/lib/rStatsAframe.js");var g=window.aframeStats,m="a-hidden",y=window.threeStats;l.exports.Component=h("stats",{schema:{default:!0},sceneOnly:!0,init:function(){var v=this.el;f.getUrlParameter("stats")!=="false"&&(this.stats=b(v),this.statsEl=document.querySelector(".rs-base"),this.hideBound=this.hide.bind(this),this.showBound=this.show.bind(this),v.addEventListener("enter-vr",this.hideBound),v.addEventListener("exit-vr",this.showBound))},update:function(){if(this.stats)return this.data?this.show():this.hide()},remove:function(){this.el.removeEventListener("enter-vr",this.hideBound),this.el.removeEventListener("exit-vr",this.showBound),this.statsEl&&this.statsEl.parentNode.removeChild(this.statsEl)},tick:function(){var v=this.stats;v&&(v("rAF").tick(),v("FPS").frame(),v().update())},hide:function(){this.statsEl.classList.add(m)},show:function(){this.statsEl.classList.remove(m)}});function b(v){var _=new y(v.renderer),C=new g(v),E=v.isMobile?[]:[_,C];return new p({css:[],values:{fps:{caption:"fps",below:30}},groups:[{caption:"Framerate",values:["fps","raf"]}],plugins:E})}},"./src/components/scene/xr-mode-ui.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/constants/index.js"),f=c("./src/utils/index.js"),g="a-enter-vr",m="a-enter-ar",y="a-enter-vr-button",b="a-enter-ar-button",v="a-hidden",_="a-orientation-modal";l.exports.Component=h("xr-mode-ui",{dependencies:["canvas"],schema:{enabled:{default:!0},cardboardModeEnabled:{default:!1},enterVRButton:{default:""},enterVREnabled:{default:!0},enterARButton:{default:""},enterAREnabled:{default:!0},XRMode:{default:"vr",oneOf:["vr","ar","xr"]}},sceneOnly:!0,init:function(){var B=this,I=this.el;f.getUrlParameter("ui")!=="false"&&(this.insideLoader=!1,this.enterVREl=null,this.enterAREl=null,this.orientationModalEl=null,this.bindMethods(),I.addEventListener("enter-vr",this.updateEnterInterfaces),I.addEventListener("exit-vr",this.updateEnterInterfaces),I.addEventListener("update-vr-devices",this.updateEnterInterfaces),window.addEventListener("message",function(D){D.data.type==="loaderReady"&&(B.insideLoader=!0,B.remove())}),window.addEventListener("orientationchange",this.toggleOrientationModalIfNeeded))},bindMethods:function(){this.onEnterVRButtonClick=this.onEnterVRButtonClick.bind(this),this.onEnterARButtonClick=this.onEnterARButtonClick.bind(this),this.onModalClick=this.onModalClick.bind(this),this.toggleOrientationModalIfNeeded=this.toggleOrientationModalIfNeeded.bind(this),this.updateEnterInterfaces=this.updateEnterInterfaces.bind(this)},onModalClick:function(){this.el.exitVR()},onEnterVRButtonClick:function(){this.el.enterVR()},onEnterARButtonClick:function(){this.el.enterAR()},update:function(){var B=this.data,I=this.el;if(!B.enabled||this.insideLoader||f.getUrlParameter("ui")==="false")return this.remove();this.enterVREl||this.enterAREl||this.orientationModalEl||(!this.enterVREl&&B.enterVREnabled&&(B.XRMode==="xr"||B.XRMode==="vr")&&(B.enterVRButton?(this.enterVREl=document.querySelector(B.enterVRButton),this.enterVREl.addEventListener("click",this.onEnterVRButtonClick)):(this.enterVREl=C(this.onEnterVRButtonClick),I.appendChild(this.enterVREl))),!this.enterAREl&&B.enterAREnabled&&(B.XRMode==="xr"||B.XRMode==="ar")&&(B.enterARButton?(this.enterAREl=document.querySelector(B.enterARButton),this.enterAREl.addEventListener("click",this.onEnterARButtonClick)):(this.enterAREl=E(this.onEnterARButtonClick,B.XRMode==="xr"),I.appendChild(this.enterAREl))),this.orientationModalEl=T(this.onModalClick),I.appendChild(this.orientationModalEl),this.updateEnterInterfaces())},remove:function(){[this.enterVREl,this.enterAREl,this.orientationModalEl].forEach(function(B){B&&B.parentNode&&B.parentNode.removeChild(B)}),this.enterVREl=void 0,this.enterAREl=void 0,this.orientationModalEl=void 0},updateEnterInterfaces:function(){this.toggleEnterVRButtonIfNeeded(),this.toggleEnterARButtonIfNeeded(),this.toggleOrientationModalIfNeeded()},toggleEnterVRButtonIfNeeded:function(){var B=this.el;this.enterVREl&&(B.is("vr-mode")||(B.isMobile||f.device.isMobileDeviceRequestingDesktopSite())&&!this.data.cardboardModeEnabled&&!f.device.checkVRSupport()?this.enterVREl.classList.add(v):(f.device.checkVRSupport()||this.enterVREl.classList.add("fullscreen"),this.enterVREl.classList.remove(v),B.enterVR(!1,!0)))},toggleEnterARButtonIfNeeded:function(){var B=this.el;this.enterAREl&&(B.is("vr-mode")||!f.device.checkARSupport()?this.enterAREl.classList.add(v):(this.enterAREl.classList.remove(v),B.enterVR(!0,!0)))},toggleOrientationModalIfNeeded:function(){var B=this.el,I=this.orientationModalEl;!I||!B.isMobile||(!f.device.isLandscape()&&B.is("vr-mode")?I.classList.remove(v):I.classList.add(v))}});function C(B){var I,D;return D=document.createElement("div"),D.classList.add(g),D.setAttribute(p.AFRAME_INJECTED,""),I=document.createElement("button"),I.className=y,I.setAttribute("title","Enter VR mode with a headset or fullscreen without"),I.setAttribute(p.AFRAME_INJECTED,""),f.device.isMobile()&&R(I),D.appendChild(I),I.addEventListener("click",function(L){B(),L.stopPropagation()}),D}function E(B,I){var D,L;return L=document.createElement("div"),L.classList.add(m),I&&L.classList.add("xr"),L.setAttribute(p.AFRAME_INJECTED,""),D=document.createElement("button"),D.className=b,D.setAttribute("title","Enter AR mode with a headset or handheld device."),D.setAttribute(p.AFRAME_INJECTED,""),f.device.isMobile()&&R(D),L.appendChild(D),D.addEventListener("click",function(O){B(),O.stopPropagation()}),L}function T(B){var I=document.createElement("div");I.className=_,I.classList.add(v),I.setAttribute(p.AFRAME_INJECTED,"");var D=document.createElement("button");return D.setAttribute(p.AFRAME_INJECTED,""),D.innerHTML="Exit VR",D.addEventListener("click",B),I.appendChild(D),I}function R(B){B.addEventListener("touchstart",function(){B.classList.remove("resethover")},{passive:!0}),B.addEventListener("touchend",function(){B.classList.add("resethover")},{passive:!0})}},"./src/components/shadow.js":(l,u,c)=>{var h=c("./src/core/component.js"),p=c("./src/lib/three.js"),f=h.registerComponent;l.exports.Component=f("shadow",{schema:{cast:{default:!0},receive:{default:!0}},init:function(){this.onMeshChanged=this.update.bind(this),this.el.addEventListener("object3dset",this.onMeshChanged),this.system.setShadowMapEnabled(!0)},update:function(){var g=this.data;this.updateDescendants(g.cast,g.receive)},remove:function(){var g=this.el;g.removeEventListener("object3dset",this.onMeshChanged),this.updateDescendants(!1,!1)},updateDescendants:function(g,m){var y=this.el.sceneEl;this.el.object3D.traverse(function(b){if(b instanceof p.Mesh&&(b.castShadow=g,b.receiveShadow=m,y.hasLoaded&&b.material))for(var v=Array.isArray(b.material)?b.material:[b.material],_=0;_<v.length;_++)v[_].needsUpdate=!0})}})},"./src/components/sound.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/utils/debug.js"),f=c("./src/lib/three.js"),g=p("components:sound:warn");l.exports.Component=h("sound",{schema:{autoplay:{default:!1},distanceModel:{default:"inverse",oneOf:["linear","inverse","exponential"]},loop:{default:!1},loopStart:{default:0},loopEnd:{default:0},maxDistance:{default:1e4},on:{default:""},poolSize:{default:1},positional:{default:!0},refDistance:{default:1},rolloffFactor:{default:1},src:{type:"audio"},volume:{default:1}},multiple:!0,init:function(){var m=this;this.listener=null,this.audioLoader=new f.AudioLoader,this.pool=new f.Group,this.loaded=!1,this.mustPlay=!1,this.playSoundBound=function(){m.playSound()}},update:function(m){var y=this.data,b,v,_=y.src!==m.src;if(_){if(!y.src)return;this.setupSound()}for(b=0;b<this.pool.children.length;b++)v=this.pool.children[b],y.positional&&(v.setDistanceModel(y.distanceModel),v.setMaxDistance(y.maxDistance),v.setRefDistance(y.refDistance),v.setRolloffFactor(y.rolloffFactor)),v.setLoop(y.loop),v.setLoopStart(y.loopStart),y.loopStart!==0&&y.loopEnd===0?v.setLoopEnd(v.buffer.duration):v.setLoopEnd(y.loopEnd),v.setVolume(y.volume),v.isPaused=!1;if(y.on!==m.on&&this.updateEventListener(m.on),_){var C=this;this.loaded=!1,this.audioLoader.load(y.src,function(E){for(b=0;b<C.pool.children.length;b++)v=C.pool.children[b],v.setBuffer(E);C.loaded=!0,f.Cache.remove(y.src),(C.data.autoplay||C.mustPlay)&&C.playSound(C.processSound),C.el.emit("sound-loaded",C.evtDetail,!1)})}},pause:function(){this.stopSound(),this.removeEventListener()},play:function(){this.data.autoplay&&this.playSound(),this.updateEventListener()},remove:function(){var m,y;this.removeEventListener(),this.el.getObject3D(this.attrName)&&this.el.removeObject3D(this.attrName);try{for(m=0;m<this.pool.children.length;m++)y=this.pool.children[m],y.disconnect()}catch{g("Audio source not properly disconnected")}},updateEventListener:function(m){var y=this.el;m&&y.removeEventListener(m,this.playSoundBound),y.addEventListener(this.data.on,this.playSoundBound)},removeEventListener:function(){this.el.removeEventListener(this.data.on,this.playSoundBound)},setupSound:function(){var m=this.el,y,b=m.sceneEl,v=this,_;this.pool.children.length>0&&(this.stopSound(),m.removeObject3D("sound"));var C=this.listener=b.audioListener||new f.AudioListener;for(b.audioListener=C,b.camera&&b.camera.add(C),b.addEventListener("camera-set-active",function(E){E.detail.cameraEl.getObject3D("camera").add(C)}),this.pool=new f.Group,y=0;y<this.data.poolSize;y++)_=this.data.positional?new f.PositionalAudio(C):new f.Audio(C),this.pool.add(_);for(m.setObject3D(this.attrName,this.pool),y=0;y<this.pool.children.length;y++)_=this.pool.children[y],_.onEnded=function(){this.isPlaying=!1,v.el.emit("sound-ended",v.evtDetail,!1)}},pauseSound:function(){var m,y;for(this.isPlaying=!1,m=0;m<this.pool.children.length;m++)y=this.pool.children[m],!(!y.source||!y.source.buffer||!y.isPlaying||y.isPaused)&&(y.isPaused=!0,y.pause())},playSound:function(m){var y,b,v;if(!this.loaded){g("Sound not loaded yet. It will be played once it finished loading"),this.mustPlay=!0,this.processSound=m;return}for(y=!1,this.isPlaying=!0,b=0;b<this.pool.children.length;b++)if(v=this.pool.children[b],!v.isPlaying&&v.buffer&&!y){m&&m(v),v.play(),v.isPaused=!1,y=!0;continue}if(!y){g("All the sounds are playing. If you need to play more sounds simultaneously consider increasing the size of pool with the `poolSize` attribute.",this.el);return}this.mustPlay=!1,this.processSound=void 0},stopSound:function(){var m,y;for(this.isPlaying=!1,m=0;m<this.pool.children.length;m++){if(y=this.pool.children[m],!y.source||!y.source.buffer)return;y.stop()}}})},"./src/components/text.js":(l,u,c)=>{var h=c("./node_modules/three-bmfont-text/index.js"),p=c("./node_modules/load-bmfont/browser.js"),f=c("./src/core/component.js").registerComponent,g=c("./src/core/shader.js"),m=c("./src/lib/three.js"),y=c("./src/utils/index.js"),b=y.debug("components:text:error"),v=g.shaders,_=y.debug("components:text:warn"),C=1,E=16,T=c("./src/constants/index.js").AFRAME_CDN_ROOT,R=T+"fonts/",B={aileronsemibold:R+"Aileron-Semibold.fnt",dejavu:R+"DejaVu-sdf.fnt",exo2bold:R+"Exo2Bold.fnt",exo2semibold:R+"Exo2SemiBold.fnt",kelsonsans:R+"KelsonSans.fnt",monoid:R+"Monoid.fnt",mozillavr:R+"mozillavr.fnt",roboto:R+"Roboto-msdf.json",sourcecodepro:R+"SourceCodePro.fnt"},I=["roboto"],D="roboto";l.exports.FONTS=B;var L=new te,O={},F={},q=/^\w+:/;l.exports.Component=f("text",{multiple:!0,schema:{align:{type:"string",default:"left",oneOf:["left","right","center"]},alphaTest:{default:.5},anchor:{default:"center",oneOf:["left","right","center","align"]},baseline:{default:"center",oneOf:["top","center","bottom"]},color:{type:"color",default:"#FFF"},font:{type:"string",default:D},fontImage:{type:"string"},height:{type:"number"},letterSpacing:{type:"number",default:0},lineHeight:{type:"number"},negate:{type:"boolean",default:!0},opacity:{type:"number",default:1},shader:{default:"sdf",oneOf:v},side:{default:"front",oneOf:["front","back","double"]},tabSize:{default:4},transparent:{default:!0},value:{type:"string"},whiteSpace:{default:"normal",oneOf:["normal","pre","nowrap"]},width:{type:"number"},wrapCount:{type:"number",default:40},wrapPixels:{type:"number"},xOffset:{type:"number",default:0},yOffset:{type:"number",default:0},zOffset:{type:"number",default:.001}},init:function(){this.shaderData={},this.geometry=h(),this.createOrUpdateMaterial(),this.explicitGeoDimensionsChecked=!1},update:function(K){var ae=this.data,Ae=this.currentFont;if(F[ae.font]?this.texture=F[ae.font]:(this.texture=F[ae.font]=new m.Texture,this.texture.anisotropy=E),this.createOrUpdateMaterial(),K.font!==ae.font){this.updateFont();return}Ae&&(this.updateGeometry(this.geometry,Ae),this.updateLayout())},remove:function(){this.geometry.dispose(),this.geometry=null,this.el.removeObject3D(this.attrName),this.material.dispose(),this.material=null,this.texture.dispose(),this.texture=null,this.shaderObject&&delete this.shaderObject},createOrUpdateMaterial:function(){var K=this.data,ae,Ae=this.material,_e,me=this.shaderData,Pe;if(Pe=K.shader,I.indexOf(K.font)!==-1||K.font.indexOf("-msdf.")>=0?Pe="msdf":K.font in B&&I.indexOf(K.font)===-1&&(Pe="sdf"),ae=(this.shaderObject&&this.shaderObject.name)!==Pe,me.alphaTest=K.alphaTest,me.color=K.color,me.map=this.texture,me.opacity=K.opacity,me.side=H(K.side),me.transparent=K.transparent,me.negate=K.negate,!ae){this.shaderObject.update(me),Ae.transparent=me.transparent,Ae.side=me.side;return}_e=Q(this.el,Pe,me),this.material=_e.material,this.shaderObject=_e.shader,this.material.side=me.side,this.mesh&&(this.mesh.material=this.material)},updateFont:function(){var K=this.data,ae=this.el,Ae,_e=this.geometry,me=this;K.font||_("No font specified. Using the default font."),this.mesh&&(this.mesh.visible=!1),Ae=this.lookupFont(K.font||D)||K.font,L.get(Ae,function(){return G(Ae,K.yOffset)}).then(function(Pe){var Xe;if(Pe.pages.length!==1)throw new Error("Currently only single-page bitmap fonts are supported.");O[Ae]||(Pe.widthFactor=O[Pe]=z(Pe)),me.currentFont=Pe,Xe=me.getFontImageSrc(),L.get(Xe,function(){return J(Xe)}).then(function(Je){var tt=me.texture;tt&&(tt.image=Je,tt.needsUpdate=!0,F[K.font]=tt,me.texture=tt,me.initMesh(),me.currentFont=Pe,me.updateGeometry(_e,Pe),me.updateLayout(),me.mesh.visible=!0,ae.emit("textfontset",{font:K.font,fontObj:Pe}))}).catch(function(Je){b(Je.message),b(Je.stack)})}).catch(function(Pe){b(Pe.message),b(Pe.stack)})},initMesh:function(){this.mesh||(this.mesh=new m.Mesh(this.geometry,this.material),this.el.setObject3D(this.attrName,this.mesh))},getFontImageSrc:function(){if(this.data.fontImage)return this.data.fontImage;var K=this.lookupFont(this.data.font||D)||this.data.font,ae=this.currentFont.pages[0];return ae.match(q)&&ae.indexOf("http")!==0?K.replace(/(\.fnt)|(\.json)/,".png"):m.LoaderUtils.extractUrlBase(K)+ae},updateLayout:function(){var K,ae,Ae=this.el,_e=this.data,me=this.geometry,Pe,Xe,Je,tt=this.mesh,dt,wt,qt,yt,Ei;if(!(!tt||!me.layout)){if(Pe=Ae.getAttribute("geometry"),qt=_e.width||Pe&&Pe.width||C,dt=V(_e.wrapPixels,_e.wrapCount,this.currentFont.widthFactor),wt=qt/dt,Je=me.layout,Xe=wt*(Je.height+Je.descender),Pe&&Pe.primitive==="plane"&&(this.explicitGeoDimensionsChecked||(this.explicitGeoDimensionsChecked=!0,this.hasExplicitGeoWidth=!!Pe.width,this.hasExplicitGeoHeight=!!Pe.height),this.hasExplicitGeoWidth||Ae.setAttribute("geometry","width",qt),this.hasExplicitGeoHeight||Ae.setAttribute("geometry","height",Xe)),K=_e.anchor==="align"?_e.align:_e.anchor,K==="left")yt=0;else if(K==="right")yt=-1*Je.width;else if(K==="center")yt=-1*Je.width/2;else throw new TypeError("Invalid text.anchor property value",K);if(ae=_e.baseline,ae==="bottom")Ei=0;else if(ae==="top")Ei=-1*Je.height+Je.ascender;else if(ae==="center")Ei=-1*Je.height/2;else throw new TypeError("Invalid text.baseline property value",ae);tt.position.x=yt*wt+_e.xOffset,tt.position.y=Ei*wt,tt.position.z=_e.zOffset,tt.scale.set(wt,-1*wt,wt)}},lookupFont:function(K){return B[K]},updateGeometry:function(){var K={},ae={},Ae=/\\n/g,_e=/\\t/g;return function(me,Pe){var Xe=this.data;ae.font=Pe,ae.lineHeight=Xe.lineHeight&&isFinite(Xe.lineHeight)?Xe.lineHeight:Pe.common.lineHeight,ae.text=Xe.value.toString().replace(Ae,`
`).replace(_e,"	"),ae.width=V(Xe.wrapPixels,Xe.wrapCount,Pe.widthFactor),me.update(y.extend(K,Xe,ae))}}()});function H(K){switch(K){case"back":return m.FrontSide;case"double":return m.DoubleSide;default:return m.BackSide}}function G(K,ae){return new Promise(function(Ae,_e){p(K,function(me,Pe){if(me){b("Error loading font",K),_e(me);return}K.indexOf("/Roboto-msdf.json")>=0&&(ae=30),ae&&Pe.chars.map(function(Xe){Xe.yoffset+=ae}),Ae(Pe)})})}function J(K){return new Promise(function(ae,Ae){new m.ImageLoader().load(K,function(_e){ae(_e)},void 0,function(){b("Error loading font image",K),Ae(null)})})}function Q(K,ae,Ae){var _e,me;return me=new v[ae].Shader,me.el=K,me.init(Ae),me.update(Ae),_e=me.material,_e.transparent=Ae.transparent,{material:_e,shader:me}}function V(K,ae,Ae){return K||(.5+ae)*Ae}function z(K){var ae=0,Ae=0,_e=0;return K.chars.map(function(me){ae+=me.xadvance,me.id>=48&&me.id<=57&&(_e++,Ae+=me.xadvance)}),_e?Ae/_e:ae/K.chars.length}function te(){var K=this.cache={};this.get=function(ae,Ae){return ae in K||(K[ae]=Ae()),K[ae]}}},"./src/components/tracked-controls-webvr.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/utils/tracked-controls.js"),f=c("./src/constants/index.js").DEFAULT_CAMERA_HEIGHT,g=c("./src/lib/three.js"),m=c("./src/constants/index.js").DEFAULT_HANDEDNESS,y={x:.175,y:-.3,z:-.03},b={x:0,y:0,z:-.175},v={touches:[]},_={AXISMOVE:"axismove",BUTTONCHANGED:"buttonchanged",BUTTONDOWN:"buttondown",BUTTONUP:"buttonup",TOUCHSTART:"touchstart",TOUCHEND:"touchend"};l.exports.Component=h("tracked-controls-webvr",{schema:{autoHide:{default:!0},controller:{default:0},id:{type:"string",default:""},hand:{type:"string",default:""},idPrefix:{type:"string",default:""},orientationOffset:{type:"vec3"},armModel:{default:!1},headElement:{type:"selector"}},init:function(){this.axis=this.el.components["tracked-controls"].axis=[0,0,0],this.buttonStates=this.el.components["tracked-controls"].buttonStates={},this.changedAxes=[],this.targetControllerNumber=this.data.controller,this.axisMoveEventDetail={axis:this.axis,changed:this.changedAxes},this.deltaControllerPosition=new g.Vector3,this.controllerQuaternion=new g.Quaternion,this.controllerEuler=new g.Euler,this.updateGamepad(),this.buttonEventDetails={}},tick:function(C,E){var T=this.el.getObject3D("mesh");T&&T.update&&T.update(E/1e3),this.updateGamepad(),this.updatePose(),this.updateButtons()},defaultUserHeight:function(){return f},getHeadElement:function(){return this.data.headElement||this.el.sceneEl.camera.el},updateGamepad:function(){var C=this.data,E=p.findMatchingControllerWebVR(this.system.controllers,C.id,C.idPrefix,C.hand,C.controller);this.controller=E,this.el.components["tracked-controls"].controller=E,this.data.autoHide&&(this.el.object3D.visible=!!this.controller)},applyArmModel:function(C){var E=this.controller,T=this.controllerEuler,R=this.controllerQuaternion,B=this.deltaControllerPosition,I,D,L,O,F;D=this.getHeadElement(),L=D.object3D,F=this.defaultUserHeight(),O=E.pose,I=(E?E.hand:void 0)||m,C.copy(L.position),B.set(y.x*(I==="left"?-1:I==="right"?1:0),y.y,y.z),B.multiplyScalar(F),B.applyAxisAngle(L.up,L.rotation.y),C.add(B),B.set(b.x,b.y,b.z),B.multiplyScalar(F),O.orientation?R.fromArray(O.orientation):R.copy(L.quaternion),T.setFromQuaternion(R),T.set(T.x,T.y,0),B.applyEuler(T),C.add(B)},updatePose:function(){var C=this.controller,E=this.data,T=this.el.object3D,R,B=this.system.vrDisplay,I;C&&(R=C.pose,R.position?T.position.fromArray(R.position):E.armModel&&this.applyArmModel(T.position),R.orientation&&T.quaternion.fromArray(R.orientation),B&&R.position&&(I=this.el.sceneEl.renderer.xr.getStandingMatrix(),T.matrix.compose(T.position,T.quaternion,T.scale),T.matrix.multiplyMatrices(I,T.matrix),T.matrix.decompose(T.position,T.quaternion,T.scale)),T.rotateX(this.data.orientationOffset.x*g.MathUtils.DEG2RAD),T.rotateY(this.data.orientationOffset.y*g.MathUtils.DEG2RAD),T.rotateZ(this.data.orientationOffset.z*g.MathUtils.DEG2RAD))},updateButtons:function(){var C,E=this.controller,T;if(E){for(T=0;T<E.buttons.length;++T)this.buttonStates[T]||(this.buttonStates[T]={pressed:!1,touched:!1,value:0}),this.buttonEventDetails[T]||(this.buttonEventDetails[T]={id:T,state:this.buttonStates[T]}),C=E.buttons[T],this.handleButton(T,C);this.handleAxes()}},handleButton:function(C,E){var T;return T=this.handlePress(C,E)|this.handleTouch(C,E)|this.handleValue(C,E),T?(this.el.emit(_.BUTTONCHANGED,this.buttonEventDetails[C],!1),!0):!1},handleAxes:function(){var C=!1,E=this.controller.axes,T,R=this.axis,B=this.changedAxes;for(this.changedAxes.splice(0,this.changedAxes.length),T=0;T<E.length;++T)B.push(R[T]!==E[T]),B[T]&&(C=!0);if(!C)return!1;for(this.axis.splice(0,this.axis.length),T=0;T<E.length;T++)this.axis.push(E[T]);return this.el.emit(_.AXISMOVE,this.axisMoveEventDetail,!1),!0},handlePress:function(C,E){var T,R=this.buttonStates[C];return E.pressed===R.pressed?!1:(T=E.pressed?_.BUTTONDOWN:_.BUTTONUP,this.el.emit(T,this.buttonEventDetails[C],!1),R.pressed=E.pressed,!0)},handleTouch:function(C,E){var T,R=this.buttonStates[C];return E.touched===R.touched?!1:(T=E.touched?_.TOUCHSTART:_.TOUCHEND,this.el.emit(T,this.buttonEventDetails[C],!1,v),R.touched=E.touched,!0)},handleValue:function(C,E){var T=this.buttonStates[C];return E.value===T.value?!1:(T.value=E.value,!0)}})},"./src/components/tracked-controls-webxr.js":(l,u,c)=>{var h=c("./src/utils/tracked-controls.js"),p=c("./src/core/component.js").registerComponent,f={AXISMOVE:"axismove",BUTTONCHANGED:"buttonchanged",BUTTONDOWN:"buttondown",BUTTONUP:"buttonup",TOUCHSTART:"touchstart",TOUCHEND:"touchend"};l.exports.Component=p("tracked-controls-webxr",{schema:{id:{type:"string",default:""},hand:{type:"string",default:""},handTrackingEnabled:{default:!1},index:{type:"int",default:-1},iterateControllerProfiles:{default:!1},space:{type:"string",oneOf:["targetRaySpace","gripSpace"],default:"gripSpace"}},init:function(){this.updateController=this.updateController.bind(this),this.buttonEventDetails={},this.buttonStates=this.el.components["tracked-controls"].buttonStates={},this.axis=this.el.components["tracked-controls"].axis=[0,0,0],this.changedAxes=[],this.axisMoveEventDetail={axis:this.axis,changed:this.changedAxes}},update:function(){this.updateController()},play:function(){var g=this.el.sceneEl;this.updateController(),g.addEventListener("controllersupdated",this.updateController)},pause:function(){var g=this.el.sceneEl;g.removeEventListener("controllersupdated",this.updateController)},isControllerPresent:function(g){return!(!this.controller||this.controller.gamepad||g.inputSource.handedness!=="none"&&g.inputSource.handedness!==this.data.hand)},updateController:function(){this.controller=h.findMatchingControllerWebXR(this.system.controllers,this.data.id,this.data.hand,this.data.index,this.data.iterateControllerProfiles,this.data.handTrackingEnabled),this.el.components["tracked-controls"].controller=this.controller,this.data.autoHide&&(this.el.object3D.visible=!!this.controller)},tick:function(){var g=this.el.sceneEl,m=this.controller,y=g.frame;!m||!g.frame||!this.system.referenceSpace||m.hand||(this.pose=y.getPose(m[this.data.space],this.system.referenceSpace),this.updatePose(),this.updateButtons())},updatePose:function(){var g=this.el.object3D,m=this.pose;m&&(g.matrix.elements=m.transform.matrix,g.matrix.decompose(g.position,g.rotation,g.scale))},updateButtons:function(){var g,m,y=this.controller,b;if(!(!y||!y.gamepad)){for(b=y.gamepad,m=0;m<b.buttons.length;++m)this.buttonStates[m]||(this.buttonStates[m]={pressed:!1,touched:!1,value:0}),this.buttonEventDetails[m]||(this.buttonEventDetails[m]={id:m,state:this.buttonStates[m]}),g=b.buttons[m],this.handleButton(m,g);this.handleAxes()}},handleButton:function(g,m){var y;return y=this.handlePress(g,m)|this.handleTouch(g,m)|this.handleValue(g,m),y?(this.el.emit(f.BUTTONCHANGED,this.buttonEventDetails[g],!1),!0):!1},handleAxes:function(){var g=!1,m=this.controller.gamepad.axes,y,b=this.axis,v=this.changedAxes;for(this.changedAxes.splice(0,this.changedAxes.length),y=0;y<m.length;++y)v.push(b[y]!==m[y]),v[y]&&(g=!0);if(!g)return!1;for(this.axis.splice(0,this.axis.length),y=0;y<m.length;y++)this.axis.push(m[y]);return this.el.emit(f.AXISMOVE,this.axisMoveEventDetail,!1),!0},handlePress:function(g,m){var y,b=this.buttonStates[g];return m.pressed===b.pressed?!1:(y=m.pressed?f.BUTTONDOWN:f.BUTTONUP,this.el.emit(y,this.buttonEventDetails[g],!1),b.pressed=m.pressed,!0)},handleTouch:function(g,m){var y,b=this.buttonStates[g];return m.touched===b.touched?!1:(y=m.touched?f.TOUCHSTART:f.TOUCHEND,this.el.emit(y,this.buttonEventDetails[g],!1),b.touched=m.touched,!0)},handleValue:function(g,m){var y=this.buttonStates[g];return m.value===y.value?!1:(y.value=m.value,!0)}})},"./src/components/tracked-controls.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent;l.exports.Component=h("tracked-controls",{schema:{autoHide:{default:!0},controller:{default:-1},id:{type:"string",default:""},hand:{type:"string",default:""},idPrefix:{type:"string",default:""},handTrackingEnabled:{default:!1},orientationOffset:{type:"vec3"},armModel:{default:!1},headElement:{type:"selector"},iterateControllerProfiles:{default:!1},space:{type:"string",oneOf:["targetRaySpace","gripSpace"],default:"targetRaySpace"}},after:["tracked-controls-webvr","tracked-controls-webxr"],update:function(){var p=this.data,f=this.el;f.sceneEl.hasWebXR?f.setAttribute("tracked-controls-webxr",{id:p.id,hand:p.hand,index:p.controller,iterateControllerProfiles:p.iterateControllerProfiles,handTrackingEnabled:p.handTrackingEnabled,space:p.space}):f.setAttribute("tracked-controls-webvr",p)}})},"./src/components/valve-index-controls.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/lib/three.js"),f=c("./src/utils/tracked-controls.js"),g=f.checkControllerPresentAndSetup,m=f.emitIfAxesChanged,y=f.onButtonEvent,b=c("./src/constants/index.js").AFRAME_CDN_ROOT,v=b+"controllers/valve/index/valve-index-",_={left:v+"left.glb",right:v+"right.glb"},C="valve",E=c("./src/utils/index.js").device.isWebXRAvailable,T={left:{x:-.00023692678902063457,y:.04724540367838371,z:-.061959880395271096},right:{x:.002471558599671131,y:.055765208987076195,z:-.061068168708348844}},R={left:{x:0,y:-.05,z:.06},right:{x:0,y:-.05,z:.06}},B={left:{_x:.692295102620542,_y:-.0627618864318427,_z:-.06265893149611756,_order:"XYZ"},right:{_x:.6484021229942998,_y:-.032563619881892894,_z:-.1327973171917482,_order:"XYZ"}},I={left:{_x:Math.PI/3,_y:0,_z:0,_order:"XYZ"},right:{_x:Math.PI/3,_y:0,_z:0,_order:"XYZ"}},D=E?I:B,L=E?R:T;l.exports.Component=h("valve-index-controls",{schema:{hand:{default:"left"},buttonColor:{type:"color",default:"#FAFAFA"},buttonHighlightColor:{type:"color",default:"#22D1EE"},model:{default:!0},orientationOffset:{type:"vec3"}},after:["tracked-controls"],mapping:{axes:{trackpad:[0,1],thumbstick:[2,3]},buttons:["trigger","grip","trackpad","thumbstick","abutton"]},init:function(){var O=this;this.controllerPresent=!1,this.lastControllerCheck=0,this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(F){y(F.detail.id,"down",O)},this.onButtonUp=function(F){y(F.detail.id,"up",O)},this.onButtonTouchEnd=function(F){y(F.detail.id,"touchend",O)},this.onButtonTouchStart=function(F){y(F.detail.id,"touchstart",O)},this.previousButtonValues={},this.bindMethods()},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},addEventListeners:function(){var O=this.el;O.addEventListener("buttonchanged",this.onButtonChanged),O.addEventListener("buttondown",this.onButtonDown),O.addEventListener("buttonup",this.onButtonUp),O.addEventListener("touchend",this.onButtonTouchEnd),O.addEventListener("touchstart",this.onButtonTouchStart),O.addEventListener("model-loaded",this.onModelLoaded),O.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var O=this.el;O.removeEventListener("buttonchanged",this.onButtonChanged),O.removeEventListener("buttondown",this.onButtonDown),O.removeEventListener("buttonup",this.onButtonUp),O.removeEventListener("touchend",this.onButtonTouchEnd),O.removeEventListener("touchstart",this.onButtonTouchStart),O.removeEventListener("model-loaded",this.onModelLoaded),O.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var O=this.data,F=O.hand==="right"?0:O.hand==="left"?1:2;g(this,C,{index:F,iterateControllerProfiles:!0,hand:O.hand})},injectTrackedControls:function(){var O=this.el,F=this.data;O.setAttribute("tracked-controls",{idPrefix:C,controller:F.hand==="right"?1:F.hand==="left"?0:2,hand:F.hand,orientationOffset:F.orientationOffset}),this.loadModel()},loadModel:function(){var O=this.data;O.model&&this.el.setAttribute("gltf-model",""+_[O.hand])},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(O){var F=this.mapping.buttons[O.detail.id],q=this.buttonMeshes,H;F&&(F==="trigger"&&(H=O.detail.state.value,q&&q.trigger&&(q.trigger.rotation.x=this.triggerOriginalRotationX-H*(Math.PI/40))),this.el.emit(F+"changed",O.detail.state))},onModelLoaded:function(O){var F,q=O.detail.model,H=this;O.target!==this.el||!this.data.model||(F=this.buttonMeshes={},F.grip={left:q.getObjectByName("leftgrip"),right:q.getObjectByName("rightgrip")},F.menu=q.getObjectByName("menubutton"),F.system=q.getObjectByName("systembutton"),F.trackpad=q.getObjectByName("touchpad"),F.trigger=q.getObjectByName("trigger"),this.triggerOriginalRotationX=F.trigger.rotation.x,Object.keys(F).forEach(function(G){H.setButtonColor(G,H.data.buttonColor)}),q.position.copy(L[this.data.hand]),q.rotation.copy(D[this.data.hand]),this.el.emit("controllermodelready",{name:"valve-index-controls",model:this.data.model,rayOrigin:new p.Vector3(0,0,0)}))},onAxisMoved:function(O){m(this,this.mapping.axes,O)},updateModel:function(O,F){var q,H;this.data.model&&(H=F.indexOf("touch")!==-1,!H&&(q=F==="up"?this.data.buttonColor:this.data.buttonHighlightColor,this.setButtonColor(O,q)))},setButtonColor:function(O,F){}})},"./src/components/visible.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent;l.exports.Component=h("visible",{schema:{default:!0},update:function(){this.el.object3D.visible=this.data}})},"./src/components/vive-controls.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/utils/tracked-controls.js"),f=p.checkControllerPresentAndSetup,g=p.emitIfAxesChanged,m=p.onButtonEvent,y=c("./src/constants/index.js").AFRAME_CDN_ROOT,b=y+"controllers/vive/vr_controller_vive.obj",v=y+"controllers/vive/vr_controller_vive.mtl",_=c("./src/utils/index.js").device.isWebXRAvailable,C="htc-vive",E="OpenVR ",T=_?C:E,R={axes:{trackpad:[0,1]},buttons:["trackpad","trigger","grip","menu","system"]},B={axes:{touchpad:[0,1]},buttons:["trigger","grip","touchpad","none"]},I=_?B:R;l.exports.Component=h("vive-controls",{schema:{hand:{default:"left"},buttonColor:{type:"color",default:"#FAFAFA"},buttonHighlightColor:{type:"color",default:"#22D1EE"},model:{default:!0},orientationOffset:{type:"vec3"}},after:["tracked-controls"],mapping:I,init:function(){var D=this;this.controllerPresent=!1,this.lastControllerCheck=0,this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(L){m(L.detail.id,"down",D)},this.onButtonUp=function(L){m(L.detail.id,"up",D)},this.onButtonTouchEnd=function(L){m(L.detail.id,"touchend",D)},this.onButtonTouchStart=function(L){m(L.detail.id,"touchstart",D)},this.previousButtonValues={},this.bindMethods()},update:function(){var D=this.data;this.controllerIndex=D.hand==="right"?0:D.hand==="left"?1:2},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},addEventListeners:function(){var D=this.el;D.addEventListener("buttonchanged",this.onButtonChanged),D.addEventListener("buttondown",this.onButtonDown),D.addEventListener("buttonup",this.onButtonUp),D.addEventListener("touchend",this.onButtonTouchEnd),D.addEventListener("touchstart",this.onButtonTouchStart),D.addEventListener("model-loaded",this.onModelLoaded),D.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var D=this.el;D.removeEventListener("buttonchanged",this.onButtonChanged),D.removeEventListener("buttondown",this.onButtonDown),D.removeEventListener("buttonup",this.onButtonUp),D.removeEventListener("touchend",this.onButtonTouchEnd),D.removeEventListener("touchstart",this.onButtonTouchStart),D.removeEventListener("model-loaded",this.onModelLoaded),D.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var D=this.data;f(this,T,{index:this.controllerIndex,hand:D.hand})},injectTrackedControls:function(){var D=this.el,L=this.data;D.setAttribute("tracked-controls",{idPrefix:T,hand:L.hand,controller:this.controllerIndex,orientationOffset:L.orientationOffset}),this.data.model&&this.el.setAttribute("obj-model",{obj:b,mtl:v})},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(D){var L=this.mapping.buttons[D.detail.id],O=this.buttonMeshes,F;L&&(L==="trigger"&&(F=D.detail.state.value,O&&O.trigger&&(O.trigger.rotation.x=-F*(Math.PI/12))),this.el.emit(L+"changed",D.detail.state))},onModelLoaded:function(D){var L,O=D.detail.model,F=this;D.target!==this.el||!this.data.model||(L=this.buttonMeshes={},L.grip={left:O.getObjectByName("leftgrip"),right:O.getObjectByName("rightgrip")},L.menu=O.getObjectByName("menubutton"),L.system=O.getObjectByName("systembutton"),L.trackpad=O.getObjectByName("touchpad"),L.touchpad=O.getObjectByName("touchpad"),L.trigger=O.getObjectByName("trigger"),Object.keys(L).forEach(function(q){F.setButtonColor(q,F.data.buttonColor)}),O.position.set(0,-.015,.04))},onAxisMoved:function(D){g(this,this.mapping.axes,D)},updateModel:function(D,L){var O,F;this.data.model&&(F=L.indexOf("touch")!==-1,!F&&(O=L==="up"?this.data.buttonColor:this.data.buttonHighlightColor,this.setButtonColor(D,O)))},setButtonColor:function(D,L){var O=this.buttonMeshes;if(O){if(D==="grip"){O.grip.left.material.color.set(L),O.grip.right.material.color.set(L);return}O[D].material.color.set(L)}}})},"./src/components/vive-focus-controls.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/utils/tracked-controls.js"),f=p.checkControllerPresentAndSetup,g=p.emitIfAxesChanged,m=p.onButtonEvent,y=c("./src/constants/index.js").AFRAME_CDN_ROOT,b=y+"controllers/vive/focus-controller/focus-controller.gltf",v=c("./src/utils/index.js").device.isWebXRAvailable,_="htc-vive-focus",C="HTC Vive Focus ",E=v?_:C,T={axes:{trackpad:[0,1]},buttons:["trackpad","trigger"]},R={axes:{touchpad:[0,1]},buttons:["trigger","none","touchpad","none","menu"]},B=v?R:T;l.exports.Component=h("vive-focus-controls",{schema:{hand:{default:""},buttonTouchedColor:{type:"color",default:"#BBBBBB"},buttonHighlightColor:{type:"color",default:"#7A7A7A"},model:{default:!0},orientationOffset:{type:"vec3"},armModel:{default:!0}},after:["tracked-controls"],mapping:B,bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},init:function(){var I=this;this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(D){m(D.detail.id,"down",I)},this.onButtonUp=function(D){m(D.detail.id,"up",I)},this.onButtonTouchStart=function(D){m(D.detail.id,"touchstart",I)},this.onButtonTouchEnd=function(D){m(D.detail.id,"touchend",I)},this.controllerPresent=!1,this.lastControllerCheck=0,this.bindMethods()},addEventListeners:function(){var I=this.el;I.addEventListener("buttonchanged",this.onButtonChanged),I.addEventListener("buttondown",this.onButtonDown),I.addEventListener("buttonup",this.onButtonUp),I.addEventListener("touchstart",this.onButtonTouchStart),I.addEventListener("touchend",this.onButtonTouchEnd),I.addEventListener("model-loaded",this.onModelLoaded),I.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0,this.addControllersUpdateListener()},removeEventListeners:function(){var I=this.el;I.removeEventListener("buttonchanged",this.onButtonChanged),I.removeEventListener("buttondown",this.onButtonDown),I.removeEventListener("buttonup",this.onButtonUp),I.removeEventListener("touchstart",this.onButtonTouchStart),I.removeEventListener("touchend",this.onButtonTouchEnd),I.removeEventListener("model-loaded",this.onModelLoaded),I.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1,this.removeControllersUpdateListener()},checkIfControllerPresent:function(){f(this,E,this.data.hand?{hand:this.data.hand}:{})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var I=this.el,D=this.data;I.setAttribute("tracked-controls",{armModel:D.armModel,idPrefix:E,orientationOffset:D.orientationOffset}),this.data.model&&this.el.setAttribute("gltf-model",b)},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelLoaded:function(I){var D=I.detail.model,L;I.target!==this.el||!this.data.model||(L=this.buttonMeshes={},L.trigger=D.getObjectByName("BumperKey"),L.triggerPressed=D.getObjectByName("BumperKey_Press"),L.triggerPressed&&(L.triggerPressed.visible=!1),L.trackpad=D.getObjectByName("TouchPad"),L.trackpadPressed=D.getObjectByName("TouchPad_Press"),L.trackpadPressed&&(L.trackpadPressed.visible=!1))},onButtonChanged:function(I){var D=this.mapping.buttons[I.detail.id];D&&this.el.emit(D+"changed",I.detail.state)},onAxisMoved:function(I){g(this,this.mapping.axes,I)},updateModel:function(I,D){this.data.model&&this.updateButtonModel(I,D)},updateButtonModel:function(I,D){var L=this.buttonMeshes,O=I+"Pressed";if(!(!L||!L[I]||!L[O])){var F;switch(D){case"down":F=this.data.buttonHighlightColor;break;case"touchstart":F=this.data.buttonTouchedColor;break}F&&L[O].material.color.set(F),L[O].visible=!!F,L[I].visible=!F}}})},"./src/components/wasd-controls.js":(l,u,c)=>{var h=c("./src/constants/index.js").keyboardevent.KEYCODE_TO_CODE,p=c("./src/core/component.js").registerComponent,f=c("./src/lib/three.js"),g=c("./src/utils/index.js"),m=g.shouldCaptureKeyEvent,y=1e-5,b=.2,v=["KeyW","KeyA","KeyS","KeyD","ArrowUp","ArrowLeft","ArrowRight","ArrowDown"];l.exports.Component=p("wasd-controls",{schema:{acceleration:{default:65},adAxis:{default:"x",oneOf:["x","y","z"]},adEnabled:{default:!0},adInverted:{default:!1},enabled:{default:!0},fly:{default:!1},wsAxis:{default:"z",oneOf:["x","y","z"]},wsEnabled:{default:!0},wsInverted:{default:!1}},after:["look-controls"],init:function(){this.keys={},this.easing=1.1,this.velocity=new f.Vector3,this.onBlur=this.onBlur.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.onFocus=this.onFocus.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.onVisibilityChange=this.onVisibilityChange.bind(this),this.attachVisibilityEventListeners()},tick:function(C,E){var T=this.data,R=this.el,B=this.velocity;!B[T.adAxis]&&!B[T.wsAxis]&&_(this.keys)||(E=E/1e3,this.updateVelocity(E),!(!B[T.adAxis]&&!B[T.wsAxis])&&R.object3D.position.add(this.getMovementVector(E)))},update:function(C){C.adAxis!==this.data.adAxis&&(this.velocity[C.adAxis]=0),C.wsAxis!==this.data.wsAxis&&(this.velocity[C.wsAxis]=0)},remove:function(){this.removeKeyEventListeners(),this.removeVisibilityEventListeners()},play:function(){this.attachKeyEventListeners()},pause:function(){this.keys={},this.removeKeyEventListeners()},updateVelocity:function(C){var E,T,R,B=this.data,I=this.keys,D=this.velocity,L,O;if(T=B.adAxis,L=B.wsAxis,C>b){D[T]=0,D[L]=0;return}var F=Math.pow(1/this.easing,C*60);D[T]!==0&&(D[T]=D[T]*F),D[L]!==0&&(D[L]=D[L]*F),Math.abs(D[T])<y&&(D[T]=0),Math.abs(D[L])<y&&(D[L]=0),B.enabled&&(E=B.acceleration,B.adEnabled&&(R=B.adInverted?-1:1,(I.KeyA||I.ArrowLeft)&&(D[T]-=R*E*C),(I.KeyD||I.ArrowRight)&&(D[T]+=R*E*C)),B.wsEnabled&&(O=B.wsInverted?-1:1,(I.KeyW||I.ArrowUp)&&(D[L]-=O*E*C),(I.KeyS||I.ArrowDown)&&(D[L]+=O*E*C)))},getMovementVector:function(){var C=new f.Vector3(0,0,0),E=new f.Euler(0,0,0,"YXZ");return function(T){var R=this.el.getAttribute("rotation"),B=this.velocity,I;return C.copy(B),C.multiplyScalar(T),R&&(I=this.data.fly?R.x:0,E.set(f.MathUtils.degToRad(I),f.MathUtils.degToRad(R.y),0),C.applyEuler(E)),C}}(),attachVisibilityEventListeners:function(){window.oncontextmenu=this.onContextMenu,window.addEventListener("blur",this.onBlur),window.addEventListener("focus",this.onFocus),document.addEventListener("visibilitychange",this.onVisibilityChange)},removeVisibilityEventListeners:function(){window.removeEventListener("blur",this.onBlur),window.removeEventListener("focus",this.onFocus),document.removeEventListener("visibilitychange",this.onVisibilityChange)},attachKeyEventListeners:function(){window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp)},removeKeyEventListeners:function(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)},onContextMenu:function(){for(var C=Object.keys(this.keys),E=0;E<C.length;E++)delete this.keys[C[E]]},onBlur:function(){this.pause()},onFocus:function(){this.play()},onVisibilityChange:function(){document.hidden?this.onBlur():this.onFocus()},onKeyDown:function(C){var E;m(C)&&(E=C.code||h[C.keyCode],v.indexOf(E)!==-1&&(this.keys[E]=!0))},onKeyUp:function(C){var E;E=C.code||h[C.keyCode],delete this.keys[E]}});function _(C){var E;for(E in C)return!1;return!0}},"./src/components/windows-motion-controls.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/utils/tracked-controls.js"),f=p.checkControllerPresentAndSetup,g=p.emitIfAxesChanged,m=p.onButtonEvent,y=c("./src/utils/index.js"),b=y.debug("components:windows-motion-controls:debug"),v=y.debug("components:windows-motion-controls:warn"),_=c("./src/constants/index.js").DEFAULT_HANDEDNESS,C=c("./src/constants/index.js").AFRAME_CDN_ROOT,E=C+"controllers/microsoft/",T={left:"left.glb",right:"right.glb",default:"universal.glb"},R=c("./src/utils/index.js").device.isWebXRAvailable,B="windows-mixed-reality",I="Spatial Controller (Spatial Interaction Source) ",D=/([0-9a-zA-Z]+-[0-9a-zA-Z]+)$/,L=R?B:I,O={axes:{thumbstick:[0,1],trackpad:[2,3]},buttons:["thumbstick","trigger","grip","menu","trackpad"],axisMeshNames:["THUMBSTICK_X","THUMBSTICK_Y","TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_Y"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",grip:"GRASP",thumbstick:"THUMBSTICK_PRESS",trackpad:"TOUCHPAD_PRESS"},pointingPoseMeshName:"POINTING_POSE"},F={axes:{touchpad:[0,1],thumbstick:[2,3]},buttons:["trigger","squeeze","touchpad","thumbstick","menu"],axisMeshNames:["TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_X","THUMBSTICK_X","THUMBSTICK_Y"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",squeeze:"GRASP",thumbstick:"THUMBSTICK_PRESS",touchpad:"TOUCHPAD_PRESS"},pointingPoseMeshName:"POINTING_POSE"},q=R?F:O;l.exports.Component=h("windows-motion-controls",{schema:{hand:{default:_},pair:{default:0},model:{default:!0},hideDisconnected:{default:!0}},after:["tracked-controls"],mapping:q,bindMethods:function(){this.onModelError=this.onModelError.bind(this),this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},init:function(){var H=this,G=this.el;this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(J){m(J.detail.id,"down",H)},this.onButtonUp=function(J){m(J.detail.id,"up",H)},this.onButtonTouchStart=function(J){m(J.detail.id,"touchstart",H)},this.onButtonTouchEnd=function(J){m(J.detail.id,"touchend",H)},this.onControllerConnected=function(){H.setModelVisibility(!0)},this.onControllerDisconnected=function(){H.setModelVisibility(!1)},this.controllerPresent=!1,this.lastControllerCheck=0,this.previousButtonValues={},this.bindMethods(),this.loadedMeshInfo={buttonMeshes:null,axisMeshes:null},this.rayOrigin={origin:new THREE.Vector3,direction:new THREE.Vector3(0,0,-1),createdFromMesh:!1},G.addEventListener("controllerconnected",this.onControllerConnected),G.addEventListener("controllerdisconnected",this.onControllerDisconnected)},addEventListeners:function(){var H=this.el;H.addEventListener("buttonchanged",this.onButtonChanged),H.addEventListener("buttondown",this.onButtonDown),H.addEventListener("buttonup",this.onButtonUp),H.addEventListener("touchstart",this.onButtonTouchStart),H.addEventListener("touchend",this.onButtonTouchEnd),H.addEventListener("axismove",this.onAxisMoved),H.addEventListener("model-error",this.onModelError),H.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var H=this.el;H.removeEventListener("buttonchanged",this.onButtonChanged),H.removeEventListener("buttondown",this.onButtonDown),H.removeEventListener("buttonup",this.onButtonUp),H.removeEventListener("touchstart",this.onButtonTouchStart),H.removeEventListener("touchend",this.onButtonTouchEnd),H.removeEventListener("axismove",this.onAxisMoved),H.removeEventListener("model-error",this.onModelError),H.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){f(this,L,{hand:this.data.hand,index:this.data.pair,iterateControllerProfiles:!0})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},updateControllerModel:function(){if(!this.data.model||this.rayOrigin.createdFromMesh){this.modelReady();return}var H=this.createControllerModelUrl();this.loadModel(H)},createControllerModelUrl:function(H){var G=this.el.components["tracked-controls"],J=G?G.controller:null,Q="default",V=this.data.hand,z;if(J&&!window.hasNativeWebXRImplementation&&(V=J.hand,!H)){var te=J.id.match(D);Q=te&&te[0]||Q}return z=T[V]||T.default,E+Q+"/"+z},injectTrackedControls:function(){var H=this.data;this.el.setAttribute("tracked-controls",{idPrefix:L,controller:H.pair,hand:H.hand,armModel:!1}),this.updateControllerModel()},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelError:function(H){var G=this.createControllerModelUrl(!0);H.detail.src!==G?(v("Failed to load controller model for device, attempting to load default."),this.loadModel(G)):v("Failed to load default controller model.")},loadModel:function(H){this.el.setAttribute("gltf-model","url("+H+")")},onModelLoaded:function(H){var G=this.controllerModel=H.detail.model,J=this.loadedMeshInfo,Q,V,z,te;if(H.target!==this.el)return;if(b("Processing model"),J.buttonMeshes={},J.axisMeshes={},G){for(Q=0;Q<this.mapping.buttons.length;Q++){if(V=this.mapping.buttonMeshNames[this.mapping.buttons[Q]],!V){b("Skipping unknown button at index: "+Q+" with mapped name: "+this.mapping.buttons[Q]);continue}if(z=G.getObjectByName(V),!z){v("Missing button mesh with name: "+V);continue}te={index:Q,value:K(z,"VALUE"),pressed:K(z,"PRESSED"),unpressed:K(z,"UNPRESSED")},te.value&&te.pressed&&te.unpressed?J.buttonMeshes[this.mapping.buttons[Q]]=te:v("Missing button submesh under mesh with name: "+V+"(VALUE: "+!!te.value+", PRESSED: "+!!te.pressed+", UNPRESSED:"+!!te.unpressed+")")}for(Q=0;Q<this.mapping.axisMeshNames.length;Q++){if(V=this.mapping.axisMeshNames[Q],!V){b("Skipping unknown axis at index: "+Q);continue}if(z=G.getObjectByName(V),!z){v("Missing axis mesh with name: "+V);continue}te={index:Q,value:K(z,"VALUE"),min:K(z,"MIN"),max:K(z,"MAX")},te.value&&te.min&&te.max?J.axisMeshes[Q]=te:v("Missing axis submesh under mesh with name: "+V+"(VALUE: "+!!te.value+", MIN: "+!!te.min+", MAX:"+!!te.max+")")}this.calculateRayOriginFromMesh(G),this.setModelVisibility()}b("Model load complete.");function K(ae,Ae){for(var _e=0,me=ae.children.length;_e<me;_e++){var Pe=ae.children[_e];if(Pe&&Pe.name===Ae)return Pe}}},calculateRayOriginFromMesh:function(){var H=new THREE.Quaternion;return function(G){var J;if(this.rayOrigin.origin.set(0,0,0),this.rayOrigin.direction.set(0,0,-1),this.rayOrigin.createdFromMesh=!0,J=G.getObjectByName(this.mapping.pointingPoseMeshName),J){var Q=G.parent;Q&&(G.parent=null,G.updateMatrixWorld(!0),G.parent=Q),J.getWorldPosition(this.rayOrigin.origin),J.getWorldQuaternion(H),this.rayOrigin.direction.applyQuaternion(H),Q&&G.updateMatrixWorld(!0)}else b("Mesh does not contain pointing origin data, defaulting to none.");this.modelReady()}}(),lerpAxisTransform:function(){var H=new THREE.Quaternion;return function(G,J){var Q=this.loadedMeshInfo.axisMeshes[G];if(Q){var V=Q.min,z=Q.max,te=Q.value,K=J*.5+.5;te.setRotationFromQuaternion(H.copy(V.quaternion).slerp(z.quaternion,K)),te.position.lerpVectors(V.position,z.position,K)}}}(),lerpButtonTransform:function(){var H=new THREE.Quaternion;return function(G,J){var Q=this.loadedMeshInfo.buttonMeshes[G];if(Q){var V=Q.unpressed,z=Q.pressed,te=Q.value;te.setRotationFromQuaternion(H.copy(V.quaternion).slerp(z.quaternion,J)),te.position.lerpVectors(V.position,z.position,J)}}}(),modelReady:function(){this.el.emit("controllermodelready",{name:"windows-motion-controls",model:this.data.model,rayOrigin:this.rayOrigin})},onButtonChanged:function(H){var G=this.mapping.buttons[H.detail.id];G&&(this.loadedMeshInfo&&this.loadedMeshInfo.buttonMeshes&&this.lerpButtonTransform(G,H.detail.state.value),this.el.emit(G+"changed",H.detail.state))},onAxisMoved:function(H){var G=this.mapping.axisMeshNames.length;if(this.loadedMeshInfo&&this.loadedMeshInfo.axisMeshes)for(var J=0;J<G;J++)this.lerpAxisTransform(J,H.detail.axis[J]||0);g(this,this.mapping.axes,H)},setModelVisibility:function(H){var G=this.el.getObject3D("mesh");this.controllerPresent&&(H=H!==void 0?H:this.modelVisible,this.modelVisible=H,G&&(G.visible=H))}})},"./src/constants/index.js":(l,u,c)=>{l.exports={AFRAME_CDN_ROOT:window.AFRAME_CDN_ROOT||"https://cdn.aframe.io/",AFRAME_INJECTED:"aframe-injected",DEFAULT_CAMERA_HEIGHT:1.6,DEFAULT_HANDEDNESS:"right",keyboardevent:c("./src/constants/keyboardevent.js")}},"./src/constants/keyboardevent.js":l=>{l.exports={KEYCODE_TO_CODE:{38:"ArrowUp",37:"ArrowLeft",40:"ArrowDown",39:"ArrowRight",87:"KeyW",65:"KeyA",83:"KeyS",68:"KeyD"}}},"./src/core/a-assets.js":(l,u,c)=>{var h=c("./src/core/a-node.js").ANode,p=c("./src/utils/debug.js"),f=c("./src/lib/three.js"),g=new f.FileLoader,m=p("core:a-assets:warn");class y extends h{constructor(){super(),this.isAssets=!0,this.fileLoader=g,this.timeout=null}doConnectedCallback(){var I=this,D,L=[],O,F,q,H,G,J;if(super.doConnectedCallback(),!this.parentNode.isScene)throw new Error("<a-assets> must be a child of a <a-scene>.");for(H=this.querySelectorAll("img"),D=0;D<H.length;D++)q=_(H[D]),L.push(new Promise(function(Q,V){if(f.Cache.add(H[D].getAttribute("src"),q),q.complete){Q();return}q.onload=Q,q.onerror=V}));for(F=this.querySelectorAll("audio, video"),D=0;D<F.length;D++)O=_(F[D]),!O.src&&!O.srcObject&&m("Audio/video asset has neither `src` nor `srcObject` attributes."),L.push(v(O));J=this.getChildren(),J.forEach(function(Q){!Q.isAssetItem||!Q.hasAttribute("src")||L.push(new Promise(function(V,z){if(Q.hasLoaded)return V();Q.addEventListener("loaded",V),Q.addEventListener("error",z)}))}),Promise.allSettled(L).then(function(){I.timeout!==null&&I.load()}),G=parseInt(this.getAttribute("timeout"),10)||3e3,this.timeout=setTimeout(function(){I.hasLoaded||(m("Asset loading timed out in",G,"ms"),I.timeout=null,I.emit("timeout"),I.load())},G)}disconnectedCallback(){super.disconnectedCallback(),this.timeout&&clearTimeout(this.timeout)}load(){super.load.call(this,null,function(){return!1})}}customElements.define("a-assets",y);class b extends h{constructor(){super(),this.data=null,this.isAssetItem=!0}connectedCallback(){var I=this,D=this.getAttribute("src");g.setResponseType(this.getAttribute("response-type")||T(D)),g.load(D,function(L){I.data=L,h.prototype.load.call(I)},function(L){I.emit("progress",{loadedBytes:L.loaded,totalBytes:L.total,xhr:L})},function(L){I.emit("error",{xhr:L})})}}customElements.define("a-asset-item",b);function v(B){if(!(!B.hasAttribute("autoplay")&&B.getAttribute("preload")!=="auto"))return new Promise(function(I,D){if(B.readyState===4)return I();if(B.error)return D();B.addEventListener("loadeddata",L,!1),B.addEventListener("progress",L,!1),B.addEventListener("error",D,!1);function L(){for(var O=0,F=0;F<B.buffered.length;F++)O+=B.buffered.end(F)-B.buffered.start(F);O>=B.duration&&(B.tagName==="VIDEO"&&f.Cache.add(B.getAttribute("src"),B),I())}})}function _(B){var I=C(B);return I.tagName&&I.tagName.toLowerCase()==="video"&&(I.setAttribute("playsinline",""),I.setAttribute("webkit-playsinline","")),I!==B&&(B.parentNode.appendChild(I),B.parentNode.removeChild(B)),I}function C(B){var I,D;return B.hasAttribute("crossorigin")||(D=B.getAttribute("src"),D!==null&&(D.indexOf("://")===-1||E(D)===window.location.host))?B:(m('Cross-origin element (e.g., <img>) was requested without `crossorigin` set. A-Frame will re-request the asset with `crossorigin` attribute set. Please set `crossorigin` on the element (e.g., <img crossorigin="anonymous">)',D),B.crossOrigin="anonymous",I=B.cloneNode(!0),I)}function E(B){var I=B.indexOf("://")>-1?B.split("/")[2]:B.split("/")[0];return I.substring(0,I.indexOf(":"))}function T(B){var I=R(B),D=I.lastIndexOf(".");if(D>=0){var L=I.slice(D,B.search(/\?|#|$/));if(L===".glb")return"arraybuffer"}return"text"}l.exports.inferResponseType=T;function R(B){var I=document.createElement("a");I.href=B;var D=I.search.replace(/^\?/,""),L=B.replace(D,"").replace("?","");return L.substring(L.lastIndexOf("/")+1)}l.exports.getFileNameFromURL=R},"./src/core/a-cubemap.js":(l,u,c)=>{var h=c("./src/utils/debug.js"),p=h("core:cubemap:warn");class f extends HTMLElement{constructor(m){return m=super(m),m}onReadyStateChange(){document.readyState==="complete"&&this.doConnectedCallback()}connectedCallback(){if(document.readyState!=="complete"){document.addEventListener("readystatechange",this.onReadyStateChange.bind(this));return}f.prototype.doConnectedCallback.call(this)}doConnectedCallback(){this.srcs=this.validate()}validate(){var m=this.querySelectorAll("[src]"),y,b=[];if(m.length===6){for(y=0;y<m.length;y++)m[y].tagName==="IMG"?b.push(m[y]):b.push(m[y].getAttribute("src"));return b}p("<a-cubemap> did not contain exactly six elements each with a `src` attribute.")}}customElements.define("a-cubemap",f)},"./src/core/a-entity.js":(l,u,c)=>{var h=c("./src/core/a-node.js").ANode,p=c("./src/core/component.js").components,f=c("./src/lib/three.js"),g=c("./src/utils/index.js"),m=g.debug("core:a-entity:debug"),y=g.debug("core:a-entity:warn"),b="__",v=["position","rotation","scale","visible"],_={once:!0};class C extends h{constructor(){super(),this.components={},this.initializingComponents={},this.componentsToUpdate={},this.isEntity=!0,this.isPlaying=!1,this.object3D=new f.Group,this.object3D.rotation.order="YXZ",this.object3D.el=this,this.object3DMap={},this.parentEl=null,this.rotationObj={},this.states=[]}attributeChangedCallback(L,O,F){var q=this.components[L];if(super.attributeChangedCallback(),q&&q.justInitialized&&F===""){delete q.justInitialized;return}!q&&F===null||this.setEntityAttribute(L,O,F)}doConnectedCallback(){var L=this,O,F;if(super.doConnectedCallback(),F=this.sceneEl,this.addToParent(),!this.isScene){if(!F){this.load();return}if(O=F.querySelector("a-assets"),O&&!O.hasLoaded){O.addEventListener("loaded",function(){L.load()});return}this.load()}}disconnectedCallback(){var L;if(this.parentEl){for(L in this.components)this.removeComponent(L,!1);this.isScene||(this.removeFromParent(),super.disconnectedCallback(),this.object3D.el=null)}}getObject3D(L){return this.object3DMap[L]}setObject3D(L,O){var F,q=this;if(!(O instanceof f.Object3D))throw new Error("`Entity.setObject3D` was called with an object that was not an instance of THREE.Object3D.");F=this.getObject3D(L),F&&this.object3D.remove(F),O.el=this,O.children.length&&O.traverse(function(H){H.el=q}),this.object3D.add(O),this.object3DMap[L]=O,this.emit("object3dset",{object:O,type:L})}removeObject3D(L){var O=this.getObject3D(L);if(!O){y("Tried to remove `Object3D` of type:",L,"which was not defined.");return}this.object3D.remove(O),delete this.object3DMap[L],this.emit("object3dremove",{type:L})}getOrCreateObject3D(L,O){var F=this.getObject3D(L);return!F&&O&&(F=new O,this.setObject3D(L,F)),y("`getOrCreateObject3D` has been deprecated. Use `setObject3D()` and `object3dset` event instead."),F}add(L){if(!L.object3D)throw new Error("Trying to add an element that doesn't have an `object3D`");this.object3D.add(L.object3D),this.emit("child-attached",{el:L})}addToParent(){var L=this.parentEl=this.parentNode;!L||!L.add||this.attachedToParent||(L.add(this),this.attachedToParent=!0)}removeFromParent(){var L=this.parentEl;this.parentEl.remove(this),this.attachedToParent=!1,this.parentEl=null,L.emit("child-detached",{el:this})}load(){var L=this;this.hasLoaded||!this.parentEl||super.load.call(this,function(){L.parentEl&&(L.updateComponents(),(L.isScene||L.parentEl.isPlaying)&&L.play())})}remove(L){L?this.object3D.remove(L.object3D):this.parentNode.removeChild(this)}getChildEntities(){for(var L=this.children,O=[],F=0;F<L.length;F++){var q=L[F];q instanceof C&&O.push(q)}return O}initComponent(L,O,F){var q,H,G,J,Q;G=g.split(L,b),J=G[0],H=G.length>2?G.slice(1).join("__"):G[1],p[J]&&(Q=E(this,L)||O!==void 0,!(!Q&&!F)&&(L in this.components||(this.initComponentDependencies(J),q=new p[J].Component(this,O,H),this.isPlaying&&q.play(),this.hasAttribute(L)||(q.justInitialized=!0,window.HTMLElement.prototype.setAttribute.call(this,L,"")),m("Component initialized: %s",L))))}initComponentDependencies(L){var O=this,F=p[L],q,H;if(F&&(q=p[L].dependencies,!!q))for(H=0;H<q.length;H++)O.initComponent(q[H],window.HTMLElement.prototype.getAttribute.call(O,q[H])||void 0,!0)}removeComponent(L,O){var F;if(F=this.components[L],!!F){if(!F.initialized){this.addEventListener("componentinitialized",function q(H){H.detail.name===L&&(this.removeComponent(L,O),this.removeEventListener("componentinitialized",q))});return}F.pause(),F.remove(),O&&(F.destroy(),delete this.components[L],this.hasAttribute(L)&&window.HTMLElement.prototype.removeAttribute.call(this,L)),this.emit("componentremoved",F.evtDetail,!1)}}updateComponents(){var L,O,F,q,H=this.componentsToUpdate;if(!(!this.hasLoaded&&!this.isLoading)){for(F=0;F<this.mixinEls.length;F++)for(q in this.mixinEls[F].componentCache)B(q)&&(H[q]=!0);if(this.getExtraComponents){O=this.getExtraComponents();for(q in O)B(q)&&(H[q]=!0)}for(F=0;F<this.attributes.length;++F)q=this.attributes[F].name,v.indexOf(q)===-1&&B(q)&&(H[q]=!0);for(F=0;F<v.length;F++)q=v[F],this.hasAttribute(q)&&this.updateComponent(q,this.getDOMAttribute(q));for(q in H)L=R(this.getDOMAttribute(q),O&&O[q]),this.updateComponent(q,L),delete H[q]}}updateComponent(L,O,F){var q=this.components[L];if(q){if(O===null&&!E(this,L)){this.removeComponent(L,!0);return}q.updateProperties(O,F);return}this.initComponent(L,O,!1)}removeAttribute(L,O){var F=this.components[L];if(F&&O===void 0&&this.removeComponent(L,!0),F&&O!==void 0){F.resetProperty(O);return}L==="mixin"&&this.mixinUpdate(""),window.HTMLElement.prototype.removeAttribute.call(this,L)}play(){var L,O,F;if(!(this.isPlaying||!this.hasLoaded&&!this.isLoading)){this.isPlaying=!0;for(F in this.components)this.components[F].play();for(L=this.getChildEntities(),O=0;O<L.length;O++)L[O].play();this.emit("play")}}pause(){var L,O,F;if(this.isPlaying){this.isPlaying=!1;for(F in this.components)this.components[F].pause();for(L=this.getChildEntities(),O=0;O<L.length;O++)L[O].pause();this.emit("pause")}}setEntityAttribute(L,O,F){if(p[L]||this.components[L]){this.updateComponent(L,F);return}if(L==="mixin"){if(F===this.computedMixinStr)return;this.mixinUpdate(F,O)}}mixinUpdate(L,O,F){var q=C.componentsUpdated,H,G,J,Q,V=this;if(F||(O=O||this.getAttribute("mixin")),!this.hasLoaded){this.addEventListener("loaded-private",function(){V.mixinUpdate(L,O,!0)},_);return}for(J=this.updateMixins(L,O),q.length=0,Q=0;Q<this.mixinEls.length;Q++)for(H in this.mixinEls[Q].componentCache)q.indexOf(H)===-1&&(this.components[H]?this.components[H].handleMixinUpdate():this.initComponent(H,null),q.push(H));for(Q=0;Q<J.oldMixinIds.length;Q++)if(G=document.getElementById(J.oldMixinIds[Q]),!!G)for(H in G.componentCache)q.indexOf(H)===-1&&this.components[H]&&(this.getDOMAttribute(H)?this.components[H].handleMixinUpdate():this.removeComponent(H,!0))}setAttribute(L,O,F){var q=C.singlePropUpdate,H,G,J,Q,V,z;if(Q=L.indexOf(b),J=Q>0?L.substring(0,Q):L,!p[J]){L==="mixin"&&this.mixinUpdate(O),super.setAttribute.call(this,L,O);return}if(!this.components[L]&&this.hasAttribute(L)&&this.updateComponent(L,window.HTMLElement.prototype.getAttribute.call(this,L)),typeof F<"u"&&typeof O=="string"&&O.length>0&&typeof g.styleParser.parse(O)=="string"){for(z in q)delete q[z];H=q,H[O]=F,G=!1}else H=O,G=F===!0;this.updateComponent(L,H,G),V=this.sceneEl&&this.sceneEl.getAttribute("debug"),V&&this.components[L].flushToDOM()}flushToDOM(L){var O=this.components,F,q=this.children,H,G;for(G in O)O[G].flushToDOM();if(L)for(H=0;H<q.length;++H)F=q[H],F.flushToDOM&&F.flushToDOM(L)}getAttribute(L){var O;return L==="position"?this.object3D.position:L==="rotation"?I(this):L==="scale"?this.object3D.scale:L==="visible"?this.object3D.visible:(O=this.components[L],O?O.data:window.HTMLElement.prototype.getAttribute.call(this,L))}getDOMAttribute(L){var O=this.components[L];return O?O.attrValue:window.HTMLElement.prototype.getAttribute.call(this,L)}addState(L){this.is(L)||(this.states.push(L),this.emit("stateadded",L))}removeState(L){var O=this.states.indexOf(L);O!==-1&&(this.states.splice(O,1),this.emit("stateremoved",L))}is(L){return this.states.indexOf(L)!==-1}inspect(){this.sceneEl.components.inspector.openInspector(this)}destroy(){var L;if(this.parentNode){y("Entity can only be destroyed if detached from scenegraph.");return}for(L in this.components)this.components[L].destroy()}}function E(D,L){return D.components[L]&&D.components[L].attrValue?!0:T(L,D.mixinEls)}function T(D,L){var O,F=!1;for(O=0;O<L.length&&(F=L[O].hasAttribute(D),!F);++O);return F}function R(D,L){return L?L.constructor===Object?g.extend(L,g.styleParser.parse(D||{})):D||L:D}function B(D){return D.indexOf(b)!==-1&&(D=g.split(D,b)[0]),!!p[D]}function I(D){var L=f.MathUtils.radToDeg,O=D.object3D.rotation,F=D.rotationObj;return F.x=L(O.x),F.y=L(O.y),F.z=L(O.z),F}C.componentsUpdated=[],C.singlePropUpdate={},customElements.define("a-entity",C),l.exports.AEntity=C},"./src/core/a-mixin.js":(l,u,c)=>{var h=c("./src/core/a-node.js").ANode,p=c("./src/core/component.js").components,f=c("./src/utils/index.js"),g=f.styleParser,m="__";class y extends h{constructor(){super(),this.componentCache={},this.rawAttributeCache={},this.isMixin=!0}doConnectedCallback(){super.doConnectedCallback(),this.sceneEl=this.closestScene(),this.id=this.getAttribute("id"),this.cacheAttributes(),this.updateEntities(),this.load()}attributeChangedCallback(v,_,C){super.attributeChangedCallback(),this.cacheAttribute(v,C),this.updateEntities()}setAttribute(v,_){window.HTMLElement.prototype.setAttribute.call(this,v,_),this.cacheAttribute(v,_)}cacheAttribute(v,_){var C,E;E=f.split(v,m)[0],C=p[E],_===void 0&&(_=window.HTMLElement.prototype.getAttribute.call(this,v)),this.rawAttributeCache[v]=_,C&&(this.componentCache[v]=this.parseComponentAttrValue(C,_))}parseComponentAttrValue(v,_){var C;return typeof _!="string"?_:(v.isSingleProperty?(C=v.schema.parse(_),typeof C=="string"&&(C=_)):C=g.parse(_),C)}getAttribute(v){return this.componentCache[v]||window.HTMLElement.prototype.getAttribute.call(this,v)}cacheAttributes(){var v=this.attributes,_,C;for(C=0;C<v.length;C++)_=v[C].name,this.cacheAttribute(_)}updateEntities(){var v,_,C;if(this.sceneEl)for(_=this.sceneEl.querySelectorAll("[mixin~="+this.id+"]"),C=0;C<_.length;C++)v=_[C],!(!v.hasLoaded||v.isMixin)&&v.mixinUpdate(this.id)}}customElements.define("a-mixin",y)},"./src/core/a-node.js":(l,u,c)=>{var h=c("./src/utils/index.js"),p=c("./src/core/readyState.js"),f=h.debug("core:a-node:warn"),g={"a-scene":!0,"a-assets":!0,"a-assets-items":!0,"a-cubemap":!0,"a-mixin":!0,"a-node":!0,"a-entity":!0};function m(b){return b.tagName.toLowerCase()in g||b.isNode}class y extends HTMLElement{constructor(){super(),this.computedMixinStr="",this.hasLoaded=!1,this.isNode=!0,this.mixinEls=[]}connectedCallback(){if(!p.canInitializeElements){document.addEventListener("aframeready",this.connectedCallback.bind(this));return}this.doConnectedCallback()}doConnectedCallback(){var v;this.sceneEl=this.closestScene(),this.sceneEl||f("You are attempting to attach <"+this.tagName+"> outside of an A-Frame scene. Append this element to `<a-scene>` instead."),this.hasLoaded=!1,this.emit("nodeready",void 0,!1),this.isMixin||(v=this.getAttribute("mixin"),v&&this.updateMixins(v))}attributeChangedCallback(v,_,C){C!==this.computedMixinStr&&v==="mixin"&&!this.isMixin&&this.updateMixins(C,_)}closestScene(){for(var v=this;v&&!v.isScene;)v=v.parentElement;return v}closest(v){for(var _=this.matches||this.mozMatchesSelector||this.msMatchesSelector||this.oMatchesSelector||this.webkitMatchesSelector,C=this;C&&!_.call(C,v);)C=C.parentElement;return C}disconnectedCallback(){this.hasLoaded=!1}load(v,_){var C,E,T=this;this.hasLoaded||(_=_||m,C=this.getChildren(),E=C.filter(_).map(function(R){return new Promise(function(B,I){if(R.hasLoaded)return B();R.addEventListener("loaded",B),R.addEventListener("error",I)})}),Promise.allSettled(E).then(function(R){R.forEach(function(B){B.status==="rejected"&&f("Rendering scene with errors on node: ",B.reason.target)}),T.isLoading=!0,T.setupMutationObserver(),v&&v(),T.isLoading=!1,T.hasLoaded=!0,T.emit("loaded-private",void 0,!1),T.emit("loaded",void 0,!1)}))}setupMutationObserver(){var v=this,_={attributes:!0,attributeOldValue:!0},C=new MutationObserver(function(E){var T;for(T=0;T<E.length;T++)if(E[T].type==="attributes"){var R=E[T].attributeName,B=window.HTMLElement.prototype.getAttribute.call(v,R),I=E[T].oldValue;v.attributeChangedCallback(R,I,B)}});C.observe(this,_)}getChildren(){return Array.prototype.slice.call(this.children,0)}updateMixins(v,_){var C=y.newMixinIdArray,E=y.oldMixinIdArray,T=y.mixinIds,R,B,I;for(C.length=0,E.length=0,B=v?h.split(v.trim(),/\s+/):C,I=_?h.split(_.trim(),/\s+/):E,T.newMixinIds=B,T.oldMixinIds=I,R=0;R<I.length;R++)B.indexOf(I[R])===-1&&this.unregisterMixin(I[R]);for(this.computedMixinStr="",this.mixinEls.length=0,R=0;R<B.length;R++)this.registerMixin(B[R]);return this.computedMixinStr&&(this.computedMixinStr=this.computedMixinStr.trim(),window.HTMLElement.prototype.setAttribute.call(this,"mixin",this.computedMixinStr)),B.length===0&&window.HTMLElement.prototype.removeAttribute.call(this,"mixin"),T}registerMixin(v){var _,C,E,T=document.getElementById(v);if(!T){f("No mixin was found with id `%s`",v);return}if(E=T.getAttribute("mixin"),E)for(_=h.split(E.trim(),/\s+/),C=0;C<_.length;C++)this.registerMixin(_[C]);this.computedMixinStr=this.computedMixinStr+" "+T.id,this.mixinEls.push(T)}setAttribute(v,_){v==="mixin"&&this.updateMixins(_),window.HTMLElement.prototype.setAttribute.call(this,v,_)}unregisterMixin(v){var _,C=this.mixinEls,E;for(_=0;_<C.length;++_)if(E=C[_],v===E.id){C.splice(_,1);break}}emit(v,_,C,E){var T=y.evtData;C===void 0&&(C=!0),T.bubbles=!!C,T.detail=_,E&&(T=h.extend({},E,T)),this.dispatchEvent(new CustomEvent(v,T))}}y.evtData={},y.newMixinIdArray=[],y.oldMixinIdArray=[],y.mixinIds={},customElements.define("a-node",y),l.exports.ANode=y,l.exports.knownTags=g},"./src/core/component.js":(l,u,c)=>{var h=c("./src/core/schema.js"),p=c("./src/core/scene/scenes.js"),f=c("./src/core/system.js"),g=c("./src/utils/index.js"),m=l.exports.components={},y=h.parseProperty,b=h.process,v=h.isSingleProperty,_=h.stringifyProperties,C=h.stringifyProperty,E=g.styleParser,T=g.debug("core:component:warn"),R=document.currentScript,B=new RegExp("[A-Z]+"),I={},D=Object.freeze({}),L=[],O={get:function(z,te){return z.getComputedPropertyValue(te)},set:function(z,te,K){return te in z.schema?z.recomputeProperty(te,K):K!==void 0&&z.handleUnknownProperty(te,K),!0}},F=l.exports.Component=function(z,te,K){var ae=this;if(this.sceneOnly&&!z.isScene)throw new Error("Component `"+this.name+"` can only be applied to <a-scene>");if(K&&!this.multiple)throw new Error("Trying to initialize multiple components of type `"+this.name+"`. There can only be one component of this type per entity.");this.el=z,this.id=K,this.attrName=this.name+(K?"__"+K:""),this.evtDetail={id:this.id,name:this.name},this.initialized=!1,this.el.components[this.attrName]=this,this.objectPool=I[this.name];var Ae=this.events;this.events={},q(this,Ae),this.attrValue=void 0,this.isObjectBased?(this.data=this.objectPool.use(),g.objectPool.removeUnusedKeys(this.data,this.schema),this.oldData=this.objectPool.use(),g.objectPool.removeUnusedKeys(this.oldData,this.schema),this.attrValueProxy=new Proxy(this,O)):(this.data=void 0,this.oldData=void 0,this.attrValueProxy=void 0),this.deferUnknownPropertyWarnings=!!this.updateSchema,this.silenceUnknownPropertyWarnings=!1,this.throttledEmitComponentChanged=g.throttleLeadingAndTrailing(function(){z.emit("componentchanged",ae.evtDetail,!1)},200),this.updateProperties(te,!0)};F.prototype={schema:{},init:function(){},events:{},update:function(z){},updateSchema:void 0,tick:void 0,tock:void 0,play:function(){},pause:function(){},remove:function(){},stringify:function(z){var te=this.schema;return typeof z=="string"?z:this.isSingleProperty?C(z,te):(z=_(z,te),E.stringify(z))},flushToDOM:function(z){var te=z?this.data:this.attrValue;te!=null&&window.HTMLElement.prototype.setAttribute.call(this.el,this.attrName,this.stringify(te))},updateProperties:function(z,te){var K=this.el;this.updateData(z,te),!(!K.hasLoaded&&!K.isLoading)&&(this.initialized?this.callUpdateHandler():this.initComponent())},initComponent:function(){var z=this.el,te;z.initializingComponents[this.name]||(z.initializingComponents[this.name]=!0,this.init(),this.initialized=!0,delete z.initializingComponents[this.name],te=this.isObjectBased?D:void 0,this.dataChanged=!1,this.storeOldData(),this.update(te),z.isPlaying&&this.play(),z.emit("componentinitialized",this.evtDetail,!1))},updateData:function(z,te){if(this.isSingleProperty){this.recomputeProperty(void 0,z);return}te?(g.objectPool.clearObject(this.attrValue),this.recomputeData(z),this.schemaChangeRequired=!!this.updateSchema):typeof z=="string"?E.parse(z,this.attrValueProxy):g.extend(this.attrValueProxy,z),this.updateSchemaIfNeeded(z)},updateSchemaIfNeeded:function(z){if(!this.schemaChangeRequired||!this.updateSchema){for(var te=0;te<L.length;te++)T("Unknown property `"+L[te]+"` for component `"+this.name+"`.");L.length=0;return}L.length=0,this.updateSchema(this.data),g.objectPool.removeUnusedKeys(this.data,this.schema),this.silenceUnknownPropertyWarnings=!0,this.recomputeData(z),this.silenceUnknownPropertyWarnings=!1,this.schemaChangeRequired=!1},callUpdateHandler:function(){if(!(!this.isPositionRotationScale&&!this.dataChanged)){this.dataChanged=!1;var z=this.oldData;this.oldDataInUse=!0,this.update(z),z!==this.oldData&&this.objectPool.recycle(z),this.oldDataInUse=!1,this.storeOldData(),this.throttledEmitComponentChanged()}},handleMixinUpdate:function(){this.recomputeData(),this.updateSchemaIfNeeded(),this.callUpdateHandler()},resetProperty:function(z){!this.isSingleProperty&&!(z in this.schema)||(z?this.attrValue[z]=void 0:(this.isObjectBased&&this.objectPool.recycle(this.attrValue),this.attrValue=void 0),this.recomputeProperty(z,void 0),this.updateSchemaIfNeeded(),this.callUpdateHandler())},extendSchema:function(z){var te;te=g.extend({},m[this.name].schema),g.extend(te,z),this.schema=b(te),this.el.emit("schemachanged",this.evtDetail)},getComputedPropertyValue:function(z){var te=this.el.mixinEls,K=this.attrValue&&z?this.attrValue[z]:this.attrValue;if(K!==void 0)return K;for(var ae=te.length-1;ae>=0;ae--){var Ae=te[ae].getAttribute(this.attrName);if(!(Ae===null||z&&!(z in Ae)))return z?Ae[z]:Ae}var _e=z?this.schema[z].default:this.schema.default;return _e},recomputeProperty:function(z,te){var K=z?this.schema[z]:this.schema;if(te!=null){this.attrValue===void 0&&this.isObjectBased&&(this.attrValue=this.objectPool.use());var ae=z?this.attrValue[z]:this.attrValue;ae=K.isCacheable?y(te,K,ae):te,typeof ae=="string"&&(ae=te===""?void 0:te),z?this.attrValue[z]=ae:this.attrValue=ae}this.oldDataInUse&&(this.oldData=this.objectPool.use(),g.objectPool.removeUnusedKeys(this.oldData,this.schema),this.storeOldData(),this.oldDataInUse=!1);var Ae=z?this.oldData[z]:this.oldData,_e=z?this.data[z]:this.data,me=y(this.getComputedPropertyValue(z),K,_e);return K.type==="array"&&!z&&(me=g.clone(me)),K.equals(me,Ae)||(this.dataChanged=!0,K.schemaChange&&(this.schemaChangeRequired=!0)),z?this.data[z]=me:this.data=me,me},handleUnknownProperty:function(z,te){this.attrValue===void 0&&(this.attrValue=this.objectPool.use()),this.attrValue[z]=te,this.silenceUnknownPropertyWarnings||(this.deferUnknownPropertyWarnings?L.push(z):this.silenceUnknownPropertyWarnings||T("Unknown property `"+z+"` for component `"+this.name+"`."))},storeOldData:function(){if(!this.isObjectBased){this.oldData=this.data;return}if(this.isSingleProperty){this.oldData=y(this.data,this.schema,this.oldData);return}var z;for(z in this.schema)this.data[z]!==void 0&&(this.data[z]&&typeof this.data[z]=="object"?this.oldData[z]=y(this.data[z],this.schema[z],this.oldData[z]):this.oldData[z]=this.data[z])},recomputeData:function(z){var te;if(this.isSingleProperty){this.recomputeProperty(void 0,z);return}if(z&&typeof z=="object")for(te in this.schema)this.attrValueProxy[te]=z[te];else for(te in this.schema)this.attrValueProxy[te]=void 0;typeof z=="string"&&E.parse(z,this.attrValueProxy);for(te in this.attrValue)this.attrValue[te]!==void 0&&L.indexOf(te)!==-1&&(te in this.schema||T("Unknown property `"+te+"` for component `"+this.name+"`."))},eventsAttach:function(){var z;this.eventsDetach();for(z in this.events)this.el.addEventListener(z,this.events[z])},eventsDetach:function(){var z;for(z in this.events)this.el.removeEventListener(z,this.events[z])},destroy:function(){this.objectPool.recycle(this.attrValue),this.objectPool.recycle(this.data),this.objectPool.recycle(this.oldData),this.attrValue=this.data=this.oldData=this.attrValueProxy=void 0}};function q(z,te){var K;for(K in te)z.events[K]=te[K].bind(z)}if(window.debug)var H=l.exports.registrationOrderWarnings={};l.exports.registerComponent=function(z,te){var K,ae={},Ae,_e;if(document.currentScript&&document.currentScript!==R&&p.forEach(function(Pe){Pe.hasLoaded||document.currentScript.compareDocumentPosition(Pe)!==Node.DOCUMENT_POSITION_FOLLOWING&&(T("The component `"+z+"` was registered in a <script> tag after the scene. Component <script> tags in an HTML file should be declared *before* the scene such that the component is available to entities during scene initialization."),window.debug&&(H[z]=!0))}),B.test(z)===!0&&T("The component name `"+z+"` contains uppercase characters, but HTML will ignore the capitalization of attribute names. Change the name to be lowercase: `"+z.toLowerCase()+"`"),z.indexOf("__")!==-1)throw new Error("The component name `"+z+"` is not allowed. The sequence __ (double underscore) is reserved to specify an id for multiple components of the same type");if(Object.keys(te).forEach(function(Pe){ae[Pe]={value:te[Pe],writable:!0}}),m[z])throw new Error("The component `"+z+"` has been already registered. Check that you are not loading two versions of the same component or two different components of the same name.");K=function(Pe,Xe,Je){F.call(this,Pe,Xe,Je)},K.prototype=Object.create(F.prototype,ae),K.prototype.name=z,K.prototype.isPositionRotationScale=z==="position"||z==="rotation"||z==="scale",K.prototype.constructor=K,K.prototype.system=f&&f.systems[z],K.prototype.play=Q(K.prototype.play),K.prototype.pause=J(K.prototype.pause),Ae=g.extend(b(K.prototype.schema,K.prototype.name)),K.prototype.isSingleProperty=_e=v(K.prototype.schema),K.prototype.isObjectBased=!_e||_e&&(V(Ae.default)||V(y(void 0,Ae))),I[z]=g.objectPool.createPool(),m[z]={Component:K,dependencies:K.prototype.dependencies,before:K.prototype.before,after:K.prototype.after,isSingleProperty:K.prototype.isSingleProperty,isObjectBased:K.prototype.isObjectBased,multiple:K.prototype.multiple,sceneOnly:K.prototype.sceneOnly,name:z,schema:Ae,stringify:K.prototype.stringify};for(var me=0;me<p.length;me++)p[me].emit("componentregistered",{name:z},!1);return K};function G(z){return z.tick||z.tock}function J(z){return function(){var te=this.el.sceneEl;this.isPlaying&&(z.call(this),this.isPlaying=!1,this.eventsDetach(),G(this)&&te.removeBehavior(this))}}function Q(z){return function(){var te=this.el.sceneEl,K=this.el.isPlaying&&!this.isPlaying;!this.initialized||!K||(z.call(this),this.isPlaying=!0,this.eventsAttach(),G(this)&&te.addBehavior(this))}}function V(z){return z&&z.constructor===Object&&!(z instanceof window.HTMLElement)}},"./src/core/geometry.js":(l,u,c)=>{var h=c("./src/core/schema.js"),p=h.process,f=l.exports.geometries={},g=l.exports.geometryNames=[],m=c("./src/lib/three.js"),y=l.exports.Geometry=function(){};y.prototype={schema:{},init:function(b){return this.geometry=new m.BufferGeometry,this.geometry},update:function(b){}},l.exports.registerGeometry=function(b,v){var _,C={};if(Object.keys(v).forEach(function(E){C[E]={value:v[E],writable:!0}}),f[b])throw new Error("The geometry `"+b+"` has been already registered");return _=function(){y.call(this)},_.prototype=Object.create(y.prototype,C),_.prototype.name=b,_.prototype.constructor=_,f[b]={Geometry:_,schema:p(_.prototype.schema)},g.push(b),_}},"./src/core/propertyTypes.js":(l,u,c)=>{var h=c("./src/utils/coordinates.js"),p=c("./node_modules/debug/src/browser.js"),f=p("core:propertyTypes:warn"),g=l.exports.propertyTypes={},m=/[,> .[\]:]/,y=/url\((.+)\)/;b("audio","",E),b("array",[],v,_,C),b("asset","",E),b("boolean",!1,I),b("color","#FFF"),b("int",0,D),b("number",0,L),b("map","",E),b("model","",E),b("selector",null,O,q,B,!1),b("selectorAll",null,F,H,C,!1),b("src","",G),b("string",""),b("time",0,D),b("vec2",{x:0,y:0},J,h.stringify,h.equals),b("vec3",{x:0,y:0,z:0},J,h.stringify,h.equals),b("vec4",{x:0,y:0,z:0,w:1},J,h.stringify,h.equals);function b(z,te,K,ae,Ae,_e){if(z in g)throw new Error("Property type "+z+" is already registered.");g[z]={default:te,parse:K||T,stringify:ae||R,equals:Ae||B,isCacheable:_e!==!1}}l.exports.registerPropertyType=b;function v(z){if(Array.isArray(z))return z;if(!z||typeof z!="string")return[];return z.split(",").map(te);function te(K){return K.trim()}}function _(z){return z.join(", ")}function C(z,te){if(!Array.isArray(z)||!Array.isArray(te))return z===te;if(z.length!==te.length)return!1;for(var K=0;K<z.length;K++)if(z[K]!==te[K])return!1;return!0}function E(z){var te,K;if(typeof z!="string")return z;if(K=z.match(y),K)return K[1];if(z.charAt(0)==="#"){if(te=document.getElementById(z.substring(1)),te)return te.tagName==="CANVAS"||te.tagName==="VIDEO"||te.tagName==="IMG"?te:te.getAttribute("src");f('"'+z+'" asset not found.');return}return z}function T(z){return z}function R(z){return z===null?"null":z.toString()}function B(z,te){return z===te}function I(z){return z!=="false"&&z!==!1}function D(z){return parseInt(z,10)}function L(z){return parseFloat(z,10)}function O(z){return z?typeof z!="string"?z:z[0]==="#"&&!m.test(z)?document.getElementById(z.substring(1)):document.querySelector(z):null}function F(z){return z?typeof z!="string"?z:Array.prototype.slice.call(document.querySelectorAll(z),0):null}function q(z){return z.getAttribute?"#"+z.getAttribute("id"):R(z)}function H(z){return z instanceof Array?z.map(function(te){return"#"+te.getAttribute("id")}).join(", "):R(z)}function G(z){return f("`src` property type is deprecated. Use `asset` instead."),E(z)}function J(z,te,K){return h.parse(z,te,K)}function Q(z,te){return z==="audio"&&typeof te!="string"||z==="array"&&!Array.isArray(te)||z==="asset"&&typeof te!="string"||z==="boolean"&&typeof te!="boolean"||z==="color"&&typeof te!="string"||z==="int"&&typeof te!="number"||z==="number"&&typeof te!="number"||z==="map"&&typeof te!="string"||z==="model"&&typeof te!="string"||z==="selector"&&typeof te!="string"&&te!==null||z==="selectorAll"&&typeof te!="string"&&te!==null||z==="src"&&typeof te!="string"||z==="string"&&typeof te!="string"||z==="time"&&typeof te!="number"?!1:z==="vec2"?V(te,2):z==="vec3"?V(te,3):z==="vec4"?V(te,4):!0}l.exports.isValidDefaultValue=Q;function V(z,te){if(z===null)return!0;if(typeof z!="object"||Object.keys(z).length!==te)return!1;var K=z.x,ae=z.y,Ae=z.z,_e=z.w;return!(typeof K!="number"||typeof ae!="number"||te>2&&typeof Ae!="number"||te>3&&typeof _e!="number")}l.exports.isValidDefaultCoordinate=V},"./src/core/readyState.js":l=>{l.exports.canInitializeElements=!1;function u(){if(document.readyState==="complete"){c();return}document.addEventListener("readystatechange",function h(){document.readyState==="complete"&&(document.removeEventListener("readystatechange",h),c())})}l.exports.waitForDocumentReadyState=u;function c(){l.exports.canInitializeElements||(l.exports.canInitializeElements=!0,setTimeout(function(){document.dispatchEvent(new CustomEvent("aframeready"))}))}l.exports.emitReady=c},"./src/core/scene/a-scene.js":(l,u,c)=>{var h=c("./src/core/scene/metaTags.js").inject,p=c("./src/core/scene/wakelock.js"),f=c("./src/core/scene/loadingScreen.js"),g=c("./src/core/scene/scenes.js"),m=c("./src/core/system.js").systems,y=c("./src/core/component.js").components,b=c("./src/lib/three.js"),v=c("./src/utils/index.js"),_=v.debug("core:a-scene:warn"),C=c("./src/core/a-entity.js").AEntity,E=c("./src/core/a-node.js").ANode,T=c("./src/core/scene/postMessage.js"),R=v.device.isIOS(),B=v.device.isMobile(),I=v.device.isWebXRAvailable;R&&c("./src/utils/ios-orientationchange-blank-bug.js");class D extends C{constructor(){var V;super(),V=this,V.clock=new b.Clock,V.isIOS=R,V.isMobile=B,V.hasWebXR=I,V.isAR=!1,V.isScene=!0,V.object3D=new b.Scene,V.object3D.onAfterRender=function(z,te,K){V.isPlaying&&V.tock(V.time,V.delta,K)},V.resize=V.resize.bind(V),V.render=V.render.bind(V),V.systems={},V.systemNames=[],V.time=V.delta=0,V.usedOfferSession=!1,V.componentOrder=[],V.behaviors={},V.hasLoaded=!1,V.isPlaying=!1,V.originalHTML=V.innerHTML}addFullScreenStyles(){document.documentElement.classList.add("a-fullscreen")}removeFullScreenStyles(){document.documentElement.classList.remove("a-fullscreen")}doConnectedCallback(){var V=this,z=this.hasAttribute("embedded");this.setAttribute("inspector",""),this.setAttribute("keyboard-shortcuts",""),this.setAttribute("screenshot",""),this.setAttribute("xr-mode-ui",""),this.setAttribute("device-orientation-permission-ui",""),super.doConnectedCallback(),J(this),this.setupRenderer(),f.setup(this,F),this.resize(),z||this.addFullScreenStyles(),T(this),h(this),p(this),this.onVRPresentChangeBound=this.onVRPresentChange.bind(this),window.addEventListener("vrdisplaypresentchange",this.onVRPresentChangeBound),this.enterVRBound=function(){V.enterVR()},this.exitVRBound=function(){V.exitVR()},this.exitVRTrueBound=function(){V.exitVR(!0)},this.pointerRestrictedBound=function(){V.pointerRestricted()},this.pointerUnrestrictedBound=function(){V.pointerUnrestricted()},V.hasWebXR||(window.addEventListener("vrdisplaydeactivate",this.exitVRBound),window.addEventListener("vrdisplaydisconnect",this.exitVRTrueBound),window.addEventListener("vrdisplaypointerrestricted",this.pointerRestrictedBound),window.addEventListener("vrdisplaypointerunrestricted",this.pointerUnrestrictedBound)),window.addEventListener("sessionend",this.resize),this.addEventListener("cameraready",function(){V.attachedCallbackPostCamera()}),this.initSystems(),this.componentOrder=L(y,this.componentOrder),this.addEventListener("componentregistered",function(){V.componentOrder=L(y,V.componentOrder)}),this.hasWebXR&&navigator.xr&&navigator.xr.addEventListener&&navigator.xr.addEventListener("sessiongranted",function(){V.enterVR()})}attachedCallbackPostCamera(){var V,z=this;window.addEventListener("load",V),window.addEventListener("resize",function(){z.isIOS?setTimeout(z.resize,100):z.resize()}),this.play(),g.push(this)}initSystems(){var V;this.initSystem("camera");for(V in m)V!=="camera"&&this.initSystem(V)}initSystem(V){this.systems[V]||(this.systems[V]=new m[V](this),this.systemNames.push(V))}disconnectedCallback(){var V=g.indexOf(this);super.disconnectedCallback(),g.splice(V,1),window.removeEventListener("vrdisplaypresentchange",this.onVRPresentChangeBound),window.removeEventListener("vrdisplayactivate",this.enterVRBound),window.removeEventListener("vrdisplaydeactivate",this.exitVRBound),window.removeEventListener("vrdisplayconnect",this.enterVRBound),window.removeEventListener("vrdisplaydisconnect",this.exitVRTrueBound),window.removeEventListener("vrdisplaypointerrestricted",this.pointerRestrictedBound),window.removeEventListener("vrdisplaypointerunrestricted",this.pointerUnrestrictedBound),window.removeEventListener("sessionend",this.resize),this.renderer.dispose()}addBehavior(V){var z,te=this.behaviors[V.name],K;te||(te=this.behaviors[V.name]={tick:{inUse:!1,array:[],markedForRemoval:[]},tock:{inUse:!1,array:[],markedForRemoval:[]}});for(K in te)if(V[K]){if(z=te[K],z.inUse){var ae=z.markedForRemoval.indexOf(V);ae!==-1&&z.markedForRemoval.splice(ae,1)}z.array.indexOf(V)===-1&&z.array.push(V)}}getPointerLockElement(){return document.pointerLockElement}checkHeadsetConnected(){return v.device.checkHeadsetConnected()}enterAR(){var V;if(!this.hasWebXR)throw V="Failed to enter AR mode, WebXR not supported.",new Error(V);if(!v.device.checkARSupport())throw V="Failed to enter AR, WebXR immersive-ar mode not supported in your browser or device.",new Error(V);return this.enterVR(!0)}enterVR(V,z){var te=this,K,ae=te.renderer.xr,Ae;if(z&&(!navigator.xr||!navigator.xr.offerSession))return Promise.resolve("OfferSession is not supported.");if(te.usedOfferSession&&z)return Promise.resolve("OfferSession was already called.");if(this.is("vr-mode"))return Promise.resolve("Already in VR.");if(this.checkHeadsetConnected()||this.isMobile){var _e=te.getAttribute("renderer");if(ae.enabled=!0,this.hasWebXR){this.xrSession&&this.xrSession.removeEventListener("end",this.exitVRBound);var me=this.sceneEl.systems.webxr.sessionReferenceSpaceType;ae.setReferenceSpaceType(me);var Pe=V?"immersive-ar":"immersive-vr";return Ae=this.sceneEl.systems.webxr.sessionConfiguration,new Promise(function(dt,wt){var qt=z?navigator.xr.offerSession.bind(navigator.xr):navigator.xr.requestSession.bind(navigator.xr);te.usedOfferSession|=z,qt(Pe,Ae).then(function(yt){z&&(te.usedOfferSession=!1),ae.layersEnabled=Ae.requiredFeatures.indexOf("layers")!==-1,ae.setSession(yt).then(function(){ae.setFoveation(_e.foveationLevel),te.xrSession=yt,te.systems.renderer.setWebXRFrameRate(yt),yt.addEventListener("end",te.exitVRBound),Je(dt)})},function(yt){var Ei=Pe==="immersive-ar",$e=Ei?"AR":"VR";wt(new Error("Failed to enter "+$e+" mode (`requestSession`)",{cause:yt}))})})}else{if(K=v.device.getVRDisplay(),ae.setDevice(K),K.isPresenting&&!window.hasNativeWebVRImplementation)return Je(),Promise.resolve();var Xe={highRefreshRate:_e.highRefreshRate};return K.requestPresent([{source:this.canvas,attributes:Xe}]).then(Je,tt)}}return Je(),Promise.resolve();function Je(dt){var wt;window.hasNativeWebVRImplementation&&!window.hasNativeWebXRImplementation&&(wt=new CustomEvent("vrdisplaypresentchange",{detail:{display:v.device.getVRDisplay()}}),window.dispatchEvent(wt)),V?te.addState("ar-mode"):te.addState("vr-mode"),te.emit("enter-vr",{target:te}),!te.hasWebXR&&te.isMobile&&screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape"),te.addFullScreenStyles(),!te.isMobile&&!te.checkHeadsetConnected()&&H(te.canvas),te.resize(),dt&&dt()}function tt(dt){throw te.removeState("vr-mode"),dt&&dt.message?new Error("Failed to enter VR mode (`requestPresent`): "+dt.message):new Error("Failed to enter VR mode (`requestPresent`).")}}exitVR(){var V=this,z,te=this.renderer.xr;if(!this.is("vr-mode")&&!this.is("ar-mode"))return Promise.resolve("Not in immersive mode.");if(this.checkHeadsetConnected()||this.isMobile){if(te.enabled=!1,z=v.device.getVRDisplay(),this.hasWebXR)this.xrSession.removeEventListener("end",this.exitVRBound),this.xrSession.end().then(function(){},function(){}),this.xrSession=void 0;else if(z.isPresenting)return z.exitPresent().then(K,ae)}else G();return K(),Promise.resolve();function K(){V.removeState("vr-mode"),V.removeState("ar-mode"),V.isMobile&&screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),V.hasAttribute("embedded")&&V.removeFullScreenStyles(),V.resize(),V.isIOS&&v.forceCanvasResizeSafariMobile(V.canvas),V.renderer.setPixelRatio(window.devicePixelRatio),V.emit("exit-vr",{target:V})}function ae(Ae){throw Ae&&Ae.message?new Error("Failed to exit VR mode (`exitPresent`): "+Ae.message):new Error("Failed to exit VR mode (`exitPresent`).")}}pointerRestricted(){if(this.canvas){var V=this.getPointerLockElement();V&&V!==this.canvas&&document.exitPointerLock&&document.exitPointerLock(),this.canvas.requestPointerLock&&this.canvas.requestPointerLock()}}pointerUnrestricted(){var V=this.getPointerLockElement();V&&V===this.canvas&&document.exitPointerLock&&document.exitPointerLock()}onVRPresentChange(V){var z=V.display||V.detail.display;if(z&&z.isPresenting){this.enterVR();return}this.exitVR()}getAttribute(V){var z=this.systems[V];return z?z.data:C.prototype.getAttribute.call(this,V)}getDOMAttribute(V){var z=this.systems[V];return z?z.data:C.prototype.getDOMAttribute.call(this,V)}setAttribute(V,z,te){if(m[V]){E.prototype.setAttribute.call(this,V,z);var K=this.systems[V];K&&K.updateProperties(z);return}C.prototype.setAttribute.call(this,V,z,te)}removeBehavior(V){var z,te,K=this.behaviors[V.name],ae;for(te in K)V[te]&&(z=K[te],ae=z.array.indexOf(V),ae!==-1&&(z.inUse?z.markedForRemoval.indexOf(V)===-1&&z.markedForRemoval.push(V):(z.array[ae]=z.array[z.array.length-1],z.array.pop())))}resize(){var V=this.camera,z=this.canvas,te,K,ae,Ae=this.renderer.xr.isPresenting;K=this.renderer.xr.enabled&&Ae,!(!V||!z||this.is("vr-mode")&&(this.isMobile||K))&&(te=this.getAttribute("embedded")&&!this.is("vr-mode"),ae=F(z,te,this.maxCanvasSize,this.is("vr-mode")),V.aspect=ae.width/ae.height,V.updateProjectionMatrix(),this.renderer.setSize(ae.width,ae.height,!1),this.emit("rendererresize",null,!1))}setupRenderer(){var V=this,z,te,K,ae;ae={alpha:!0,antialias:!B,canvas:this.canvas,logarithmicDepthBuffer:!1,powerPreference:"high-performance"},this.maxCanvasSize={height:-1,width:-1},this.hasAttribute("renderer")&&(K=this.getAttribute("renderer"),te=v.styleParser.parse(K),te.precision&&(ae.precision=te.precision+"p"),te.antialias&&te.antialias!=="auto"&&(ae.antialias=te.antialias==="true"),te.logarithmicDepthBuffer&&te.logarithmicDepthBuffer!=="auto"&&(ae.logarithmicDepthBuffer=te.logarithmicDepthBuffer==="true"),te.alpha&&(ae.alpha=te.alpha==="true"),te.stencil&&(ae.stencil=te.stencil==="true"),te.multiviewStereo&&(ae.multiviewStereo=te.multiviewStereo==="true"),this.maxCanvasSize={width:te.maxCanvasWidth?parseInt(te.maxCanvasWidth):this.maxCanvasSize.width,height:te.maxCanvasHeight?parseInt(te.maxCanvasHeight):this.maxCanvasSize.height}),z=this.renderer=new b.WebGLRenderer(ae),z.setPixelRatio(window.devicePixelRatio),this.camera&&z.xr.setPoseTarget(this.camera.el.object3D),this.addEventListener("camera-set-active",function(){z.xr.setPoseTarget(V.camera.el.object3D)})}play(){var V=this,z=this;if(this.renderStarted){C.prototype.play.call(this);return}this.addEventListener("loaded",function(){var te=this.renderer,K,ae=this.renderer.xr;C.prototype.play.call(this),!z.renderStarted&&(z.resize(),z.renderer&&(window.performance&&window.performance.mark("render-started"),f.remove(),K=v.device.getVRDisplay(),K&&K.isPresenting&&(ae.setDevice(K),ae.enabled=!0,z.enterVR()),te.setAnimationLoop(this.render),z.renderStarted=!0,z.emit("renderstart")))}),setTimeout(function(){C.prototype.load.call(V)})}updateComponent(V){V in m||C.prototype.updateComponent.apply(this,arguments)}tick(V,z){var te,K=this.systems;for(this.callComponentBehaviors("tick",V,z),te=0;te<this.systemNames.length;te++)K[this.systemNames[te]].tick&&K[this.systemNames[te]].tick(V,z)}tock(V,z,te){var K,ae=this.systems;for(this.callComponentBehaviors("tock",V,z),K=0;K<this.systemNames.length;K++)ae[this.systemNames[K]].tock&&ae[this.systemNames[K]].tock(V,z,te)}render(V,z){var te=this.renderer;this.frame=z,this.delta=this.clock.getDelta()*1e3,this.time=this.clock.elapsedTime*1e3,this.isPlaying&&this.tick(this.time,this.delta);var K=null;this.is("ar-mode")&&(K=this.object3D.background,this.object3D.background=null),te.render(this.object3D,this.camera),K&&(this.object3D.background=K)}callComponentBehaviors(V,z,te){for(var K,ae=0;ae<this.componentOrder.length;ae++){var Ae=this.behaviors[this.componentOrder[ae]];if(Ae){var _e=Ae[V];for(_e.inUse=!0,K=0;K<_e.array.length;K++)_e.array[K].isPlaying&&_e.array[K][V](z,te);for(_e.inUse=!1,K=0;K<_e.markedForRemoval.length;K++)this.removeBehavior(_e.markedForRemoval[K]);_e.markedForRemoval.length=0}}}}function L(Q,V){var z={},te,K,ae=V||[];ae.length=0;for(K in Q){var Ae=Q[K];if(Ae!==void 0){var _e=Ae.before?Ae.before.slice(0):[],me=Ae.after?Ae.after.slice(0):[];z[K]={before:_e,after:me,visited:!1,done:!1}}}for(K in z)for(te=0;te<z[K].before.length;te++){var Pe=z[K].before[te];if(!(Pe in z)){_("Invalid ordering constraint, no component named `"+Pe+"` referenced by `"+K+"`");continue}z[Pe].after.push(K)}function Xe(Je){if(!(!(Je in z)||z[Je].done)){if(z[Je].visited){_("Cycle detected, ignoring one or more before/after constraints. The resulting order might be incorrect");return}z[Je].visited=!0;for(var tt=0;tt<z[Je].after.length;tt++){var dt=z[Je].after[tt];dt in z||_("Invalid before/after constraint, no component named `"+dt+"` referenced in `"+Je+"`"),Xe(dt)}z[Je].done=!0,ae.push(Je)}}for(K in z)z[K].done||Xe(K);return ae}l.exports.determineComponentBehaviorOrder=L;function O(Q,V){var z,te=window.devicePixelRatio;return!V||V.width===-1&&V.height===-1||Q.width*te<V.width&&Q.height*te<V.height||(z=Q.width/Q.height,Q.width*te>V.width&&V.width!==-1&&(Q.width=Math.round(V.width/te),Q.height=Math.round(V.width/z/te)),Q.height*te>V.height&&V.height!==-1&&(Q.height=Math.round(V.height/te),Q.width=Math.round(V.height*z/te))),Q}customElements.define("a-scene",D);function F(Q,V,z,te){if(!Q.parentElement)return{height:0,width:0};if(V){var K;return K={height:Q.parentElement.offsetHeight,width:Q.parentElement.offsetWidth},O(K,z)}return q(z,te)}function q(Q,V){var z;return z={height:document.body.offsetHeight,width:document.body.offsetWidth},V?z:O(z,Q)}function H(Q){var V=Q.requestFullscreen||Q.webkitRequestFullscreen||Q.mozRequestFullScreen||Q.msRequestFullscreen;V.apply(Q,[{navigationUI:"hide"}])}function G(){var Q=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement;Q&&(document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen())}function J(Q){var V;V=document.createElement("canvas"),V.classList.add("a-canvas"),V.dataset.aframeCanvas=!0,Q.appendChild(V),document.addEventListener("fullscreenchange",z),document.addEventListener("mozfullscreenchange",z),document.addEventListener("webkitfullscreenchange",z),document.addEventListener("MSFullscreenChange",z),V.addEventListener("touchmove",function(te){te.preventDefault()},{passive:!1}),Q.canvas=V,Q.emit("render-target-loaded",{target:V}),setTimeout(Q.resize.bind(Q),0);function z(){var te=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement;te||Q.exitVR(),document.activeElement.blur(),document.body.focus()}}l.exports.setupCanvas=J,l.exports.AScene=D},"./src/core/scene/loadingScreen.js":(l,u,c)=>{var h=c("./src/utils/index.js"),p=h.styleParser,f,g,m,y="loading-screen",b="a-loader-title";l.exports.setup=function(C,E){f=C,m=E;var T=f.hasAttribute(y)?p.parse(f.getAttribute(y)):void 0,R=T&&T.dotsColor||"white",B=T&&T.backgroundColor||"#24CAFF",I=T===void 0||T.enabled==="true"||T.enabled===void 0,D,L,O,F,q,H,G,J,Q,V;I&&(D=new THREE.Scene,L=new THREE.SphereGeometry(.2,36,18,0,2*Math.PI,0,Math.PI),O=new THREE.MeshBasicMaterial({color:R}),F=new THREE.Mesh(L,O),q=F.clone(),H=F.clone(),G=new THREE.PerspectiveCamera(80,window.innerWidth/window.innerHeight,5e-4,1e4),J=new THREE.Clock,Q=0,V=function(){f.renderer.render(D,G),Q=J.getElapsedTime()%4,F.visible=Q>=1,q.visible=Q>=2,H.visible=Q>=3},D.background=new THREE.Color(B),D.add(G),F.position.set(-1,0,-15),q.position.set(0,0,-15),H.position.set(1,0,-15),G.add(F),G.add(q),G.add(H),_(),setTimeout(function(){f.hasLoaded||(v(G),g.style.display="block",window.addEventListener("resize",function(){v(G)}),f.renderer.setAnimationLoop(V))},200))},l.exports.remove=function(){window.removeEventListener("resize",v),g&&(g.style.display="none")};function v(C){var E=f.hasAttribute("embedded"),T=m(f.canvas,E,f.maxCanvasSize,f.is("vr-mode"));C.aspect=T.width/T.height,C.updateProjectionMatrix(),f.renderer.setSize(T.width,T.height,!1)}function _(){g=document.createElement("div"),g.className=b,g.innerHTML=document.title,g.style.display="none",f.appendChild(g)}},"./src/core/scene/metaTags.js":(l,u,c)=>{var h=c("./src/constants/index.js"),p=c("./src/utils/index.js").extend,f=l.exports.MOBILE_HEAD_TAGS=[m({name:"viewport",content:"width=device-width,initial-scale=1,maximum-scale=1,shrink-to-fit=no,user-scalable=no,minimal-ui,viewport-fit=cover"}),m({name:"mobile-web-app-capable",content:"yes"}),m({name:"theme-color",content:"black"})],g=[m({name:"apple-mobile-web-app-capable",content:"yes"}),m({name:"apple-mobile-web-app-status-bar-style",content:"black"}),y({rel:"apple-touch-icon",href:"https://aframe.io/images/aframe-logo-152.png"})];function m(v){return{tagName:"meta",attributes:v,exists:function(){return document.querySelector('meta[name="'+v.name+'"]')}}}function y(v){return{tagName:"link",attributes:v,exists:function(){return document.querySelector('link[rel="'+v.rel+'"]')}}}l.exports.inject=function(v){var _=document.head,C=_.querySelector("script"),E,T=[];return f.forEach(R),v.isIOS&&g.forEach(R),T;function R(B){!B||B.exists()||(E=b(B),E&&(C?C.parentNode.insertBefore(E,C):_.appendChild(E),T.push(E)))}};function b(v){if(!(!v||!v.tagName)){var _=document.createElement(v.tagName);return _.setAttribute(h.AFRAME_INJECTED,""),p(_,v.attributes)}}},"./src/core/scene/postMessage.js":(l,u,c)=>{var h=c("./src/utils/index.js").isIframed;l.exports=function(f){h()&&window.addEventListener("message",p.bind(f))};function p(f){var g=this;if(f.data)switch(f.data.type){case"vr":switch(f.data.data){case"enter":g.enterVR();break;case"exit":g.exitVR();break}}}},"./src/core/scene/scenes.js":l=>{l.exports=[]},"./src/core/scene/wakelock.js":(l,u,c)=>{var h=c("./vendor/wakelock/wakelock.js");l.exports=function(p){if(p.isMobile){var f=p.wakelock=new h;p.addEventListener("enter-vr",function(){f.request()}),p.addEventListener("exit-vr",function(){f.release()})}}},"./src/core/schema.js":(l,u,c)=>{var h=c("./src/utils/index.js"),p=c("./src/core/propertyTypes.js"),f=h.debug,g=p.isValidDefaultValue,m=p.propertyTypes,y=f("core:schema:warn");function b(E){return"type"in E?typeof E.type=="string":"default"in E}l.exports.isSingleProperty=b,l.exports.process=function(E,T){var R;if(b(E))return v(E,T);for(R in E)E[R]=v(E[R],T);return E};function v(E,T){var R=E.default,B,I,D=E.type;return E.type?E.type==="bool"?D="boolean":E.type==="float"&&(D="number"):R!==void 0&&(typeof R=="boolean"||typeof R=="number")?D=typeof R:Array.isArray(R)?D="array":D="string",I=m[D],I||y("Unknown property type for component `"+T+"`: "+D),B=!!E.parse,E.parse=E.parse||I.parse,E.stringify=E.stringify||I.stringify,E.equals=E.equals||I.equals,E.isCacheable=E.isCacheable===!0||I.isCacheable,E.type=D,"default"in E?!B&&!g(D,R)&&y("Default value `"+R+"` does not match type `"+D+"` in component `"+T+"`"):E.default=I.default,E}l.exports.processPropertyDefinition=v,l.exports.parseProperties=function(){var E=[];return function(T,R,B,I,D){var L,O,F,q;E.length=0;for(O in B?T:R)B&&T[O]===void 0||E.push(O);if(T===null||typeof T!="object")return T;for(O in T)T[O]!==void 0&&!R[O]&&!D&&y("Unknown property `"+O+"` for component/system `"+I+"`.");for(L=0;L<E.length;L++){if(O=E[L],F=R[O],q=T[O],!R[O])return;T[O]=_(q,F)}return T}}();function _(E,T,R){return(E==null||E==="")&&(E=T.default,Array.isArray(E)&&(E=E.slice())),T.parse(E,T.default,R)}l.exports.parseProperty=_,l.exports.stringifyProperties=function(E,T){var R,B,I,D={},L;for(R in E)B=T[R],I=E[R],L=I,typeof L=="object"&&(L=C(I,B),B||y("Unknown component property: "+R)),D[R]=L;return D};function C(E,T){return typeof E!="object"?E:!T||E===null?JSON.stringify(E):T.stringify(E)}l.exports.stringifyProperty=C},"./src/core/shader.js":(l,u,c)=>{var h=c("./src/core/schema.js"),p=h.process,f=l.exports.shaders={},g=l.exports.shaderNames=[],m=c("./src/lib/three.js"),y=c("./src/utils/index.js"),b={array:"v3",color:"v3",int:"i",number:"f",map:"t",time:"f",vec2:"v2",vec3:"v3",vec4:"v4"},v=l.exports.Shader=function(){};v.prototype={schema:{},vertexShader:"void main() {gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);}",fragmentShader:"void main() {gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);}",init:function(_){return this.uniforms=this.initUniforms(),this.material=new(this.raw?m.RawShaderMaterial:m.ShaderMaterial)({uniforms:this.uniforms,glslVersion:this.raw||this.glsl3?m.GLSL3:null,vertexShader:this.vertexShader,fragmentShader:this.fragmentShader}),this.material},initUniforms:function(){var _,C=this.schema,E={},T;for(_ in C)C[_].is==="uniform"&&(T=b[C[_].type],E[_]={type:T,value:void 0});return E},update:function(_){var C,E,T=this.schema,R=this.uniforms;for(C in _)if(!(!T[C]||T[C].is!=="uniform")){if(T[C].type==="map"){if(!R[C]||R[C].value===_[C])continue;E="_texture_"+C,this.setMapOnTextureLoad(R,C,E),y.material.updateMapMaterialFromData(E,C,this,_);continue}R[C].value=this.parseValue(T[C].type,_[C]),R[C].needsUpdate=!0}},parseValue:function(_,C){var E;switch(_){case"vec2":return new m.Vector2(C.x,C.y);case"vec3":return new m.Vector3(C.x,C.y,C.z);case"vec4":return new m.Vector4(C.x,C.y,C.z,C.w);case"color":return E=new m.Color(C),new m.Vector3(E.r,E.g,E.b);default:return C}},setMapOnTextureLoad:function(_,C,E){var T=this;this.el.addEventListener("materialtextureloaded",function(){_[C].value=T.material[E],_[C].needsUpdate=!0})}},l.exports.registerShader=function(_,C){var E,T={};if(Object.keys(C).forEach(function(R){T[R]={value:C[R],writable:!0}}),f[_])throw new Error("The shader "+_+" has already been registered");return E=function(){v.call(this)},E.prototype=Object.create(v.prototype,T),E.prototype.name=_,E.prototype.constructor=E,f[_]={Shader:E,schema:p(E.prototype.schema)},g.push(_),E}},"./src/core/system.js":(l,u,c)=>{var h=c("./src/core/component.js"),p=c("./src/core/schema.js"),f=c("./src/utils/index.js"),g=c("./src/core/readyState.js"),m=p.parseProperties,y=p.parseProperty,b=p.process,v=p.isSingleProperty,_=f.styleParser,C=l.exports.systems={},E=l.exports.System=function(T){var R=h&&h.components[this.name];this.el=T,this.sceneEl=T,R&&(R.Component.prototype.system=this),this.buildData(),this.init(),this.update({})};E.prototype={schema:{},init:function(){},update:function(T){},updateProperties:function(T){var R=this.data;Object.keys(p).length&&(this.buildData(T),this.update(R))},buildData:function(T){var R=this.schema;Object.keys(R).length&&(T=T||window.HTMLElement.prototype.getAttribute.call(this.sceneEl,this.name),v(R)?this.data=y(T,R):this.data=m(_.parse(T)||{},R,!1,this.name))},tick:void 0,tock:void 0,play:function(){},pause:function(){}},l.exports.registerSystem=function(T,R){var B,I,D={},L=f.findAllScenes(document);if(Object.keys(R).forEach(function(O){D[O]={value:R[O],writable:!0}}),C[T])throw new Error("The system `"+T+"` has been already registered. Check that you are not loading two versions of the same system or two different systems of the same name.");if(I=function(O){E.call(this,O)},I.prototype=Object.create(E.prototype,D),I.prototype.name=T,I.prototype.constructor=I,I.prototype.schema=f.extend(b(I.prototype.schema)),C[T]=I,g.canInitializeElements)for(B=0;B<L.length;B++)L[B].initSystem(T)}},"./src/extras/components/index.js":(l,u,c)=>{c("./src/extras/components/pivot.js")},"./src/extras/components/pivot.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/lib/three.js"),f=new p.Vector3,g=new p.Vector3;h("pivot",{dependencies:["position"],schema:{type:"vec3"},init:function(){var m=this.data,y=this.el,b=y.object3D.parent,v=y.object3D,_=new p.Group;f.copy(v.position),g.copy(v.rotation),b.remove(v),_.add(v),b.add(_),y.object3D=_,v.position.set(-1*m.x,-1*m.y,-1*m.z),_.position.set(m.x+f.x,m.y+f.y,m.z+f.z),_.rotation.copy(v.rotation),v.rotation.set(0,0,0)}})},"./src/extras/primitives/getMeshMixin.js":(l,u,c)=>{var h=c("./src/core/component.js").components,p=c("./src/core/shader.js").shaders,f=c("./src/utils/index.js"),g={};Object.keys(h.material.schema).forEach(m),Object.keys(p.standard.schema).forEach(m);function m(y){var b=y.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();y==="fog"&&(b="material-fog"),y==="visible"&&(b="material-visible"),g[b]="material."+y}l.exports=function(){return{defaultComponents:{material:{}},mappings:f.extend({},g)}}},"./src/extras/primitives/index.js":(l,u,c)=>{c("./src/extras/primitives/primitives/a-camera.js"),c("./src/extras/primitives/primitives/a-cursor.js"),c("./src/extras/primitives/primitives/a-curvedimage.js"),c("./src/extras/primitives/primitives/a-gltf-model.js"),c("./src/extras/primitives/primitives/a-image.js"),c("./src/extras/primitives/primitives/a-light.js"),c("./src/extras/primitives/primitives/a-link.js"),c("./src/extras/primitives/primitives/a-obj-model.js"),c("./src/extras/primitives/primitives/a-sky.js"),c("./src/extras/primitives/primitives/a-sound.js"),c("./src/extras/primitives/primitives/a-text.js"),c("./src/extras/primitives/primitives/a-video.js"),c("./src/extras/primitives/primitives/a-videosphere.js"),c("./src/extras/primitives/primitives/meshPrimitives.js")},"./src/extras/primitives/primitives.js":(l,u,c)=>{var h=c("./src/core/a-node.js").knownTags,p=c("./src/core/a-entity.js").AEntity,f=c("./src/core/component.js").components,g=c("./src/utils/index.js"),m=g.debug,y=g.entity.setComponentProperty,b=m("extras:primitives:debug"),v=m("extras:primitives:warn"),_=m("extras:primitives:error"),C=l.exports.primitives={};l.exports.registerPrimitive=function(B,I){if(B=B.toLowerCase(),h[B]){_("Trying to register primitive "+B+" that has been already previously registered");return}h[B]=!0,b("Registering <%s>",B),I.defaultAttributes&&v("The 'defaultAttributes' object is deprecated. Use 'defaultComponents' instead.");var D=I.mappings||{},L=class extends p{constructor(){super(),this.defaultComponentsFromPrimitive=I.defaultComponents||I.defaultAttributes||{},this.deprecated=I.deprecated||null,this.deprecatedMappings=I.deprecatedMappings||{},this.mappings=D,I.deprecated&&console.warn(I.deprecated),this.resolveMappingCollisions()}resolveMappingCollisions(){var O=this.mappings,F=this;Object.keys(O).forEach(function(q){var H;q!==q.toLowerCase()&&v("Mapping keys should be specified in lower case. The mapping key "+q+" may not be recognized"),f[q]&&(H=O[q].replace(".","-"),O[H]=O[q],delete O[q],console.warn("The primitive "+F.tagName.toLowerCase()+" has a mapping collision. The attribute "+q+" has the same name as a registered component and has been renamed to "+H))})}getExtraComponents(){var O,F,q,H,G,J=this;for(F=g.clone(this.defaultComponentsFromPrimitive),G=this.getAttribute("mixin"),G&&(G=g.split(G.trim(),/\s+/),G.forEach(function(K){var ae=document.getElementById(K);if(ae){var Ae=ae.rawAttributeCache,_e=ae.componentCache;for(var me in Ae){if(H=J.mappings[me],H){E(H,Ae[me],F);return}me in _e&&(F[me]=Q(F[me],_e[me]))}}})),q=0;q<this.attributes.length;q++)O=this.attributes[q],H=this.mappings[O.name],H&&E(H,O.value,F);return F;function Q(K,ae){return V(K)?z(ae):V(ae)?z(K):te(K)&&te(ae)?g.extendDeep(K,ae):z(ae)}function V(K){return typeof K>"u"}function z(K){return te(K)?g.extendDeep({},K):K}function te(K){return K!==null&&K.constructor===Object}}attributeChangedCallback(O,F,q){var H=this.mappings[O];if(O in this.deprecatedMappings&&console.warn(this.deprecatedMappings[O]),!O||!H){super.attributeChangedCallback(O,F,q);return}y(this,H,q)}};return customElements.define(B,L),L.mappings=D,C[B]=L,L};function E(B,I,D){var L=g.entity.getComponentPropertyPath(B);L.constructor===Array?(D[L[0]]=D[L[0]]||{},D[L[0]][L[1]]=I.trim()):D[L]=I.trim()}function T(B,I){var D=f[B].schema;Object.keys(D).map(function(L){var O=L.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();I[O]!==void 0&&(O=B+"-"+L),I[O]=B+"."+L})}function R(B,I,D){D=D||{},Object.keys(I).map(function(L){T(L,D)}),l.exports.registerPrimitive(B,g.extendDeep({},null,{defaultComponents:I,mappings:D}))}l.exports.definePrimitive=R},"./src/extras/primitives/primitives/a-camera.js":(l,u,c)=>{var h=c("./src/extras/primitives/primitives.js").registerPrimitive;h("a-camera",{defaultComponents:{camera:{},"look-controls":{},"wasd-controls":{},position:{x:0,y:1.6,z:0}},mappings:{active:"camera.active",far:"camera.far",fov:"camera.fov","look-controls-enabled":"look-controls.enabled",near:"camera.near","pointer-lock-enabled":"look-controls.pointerLockEnabled","wasd-controls-enabled":"wasd-controls.enabled","reverse-mouse-drag":"look-controls.reverseMouseDrag",zoom:"camera.zoom"}})},"./src/extras/primitives/primitives/a-cursor.js":(l,u,c)=>{var h=c("./src/extras/primitives/getMeshMixin.js"),p=c("./src/extras/primitives/primitives.js").registerPrimitive,f=c("./src/utils/index.js");p("a-cursor",f.extendDeep({},h(),{defaultComponents:{cursor:{},geometry:{primitive:"ring",radiusOuter:.016,radiusInner:.01,segmentsTheta:32},material:{color:"#000",shader:"flat",opacity:.8},position:{x:0,y:0,z:-1}},mappings:{far:"raycaster.far",fuse:"cursor.fuse","fuse-timeout":"cursor.fuseTimeout",interval:"raycaster.interval",objects:"raycaster.objects"}}))},"./src/extras/primitives/primitives/a-curvedimage.js":(l,u,c)=>{var h=c("./src/extras/primitives/getMeshMixin.js"),p=c("./src/extras/primitives/primitives.js").registerPrimitive,f=c("./src/utils/index.js");p("a-curvedimage",f.extendDeep({},h(),{defaultComponents:{geometry:{height:1,primitive:"cylinder",radius:2,segmentsRadial:48,thetaLength:270,openEnded:!0,thetaStart:0},material:{color:"#FFF",shader:"flat",side:"double",transparent:!0,repeat:"-1 1"}},mappings:{height:"geometry.height","open-ended":"geometry.openEnded",radius:"geometry.radius",segments:"geometry.segmentsRadial",start:"geometry.thetaStart","theta-length":"geometry.thetaLength","theta-start":"geometry.thetaStart",width:"geometry.thetaLength"}}))},"./src/extras/primitives/primitives/a-gltf-model.js":(l,u,c)=>{var h=c("./src/extras/primitives/primitives.js").registerPrimitive;h("a-gltf-model",{mappings:{src:"gltf-model"}})},"./src/extras/primitives/primitives/a-image.js":(l,u,c)=>{var h=c("./src/extras/primitives/getMeshMixin.js"),p=c("./src/extras/primitives/primitives.js").registerPrimitive,f=c("./src/utils/index.js");p("a-image",f.extendDeep({},h(),{defaultComponents:{geometry:{primitive:"plane"},material:{color:"#FFF",shader:"flat",side:"double",transparent:!0}},mappings:{height:"geometry.height",width:"geometry.width"}}))},"./src/extras/primitives/primitives/a-light.js":(l,u,c)=>{var h=c("./src/extras/primitives/primitives.js").registerPrimitive;h("a-light",{defaultComponents:{light:{}},mappings:{angle:"light.angle",color:"light.color","ground-color":"light.groundColor",decay:"light.decay",distance:"light.distance",intensity:"light.intensity",penumbra:"light.penumbra",type:"light.type",target:"light.target",envmap:"light.envMap","shadow-camera-automatic":"light.shadowCameraAutomatic"}})},"./src/extras/primitives/primitives/a-link.js":(l,u,c)=>{var h=c("./src/extras/primitives/primitives.js").registerPrimitive;h("a-link",{defaultComponents:{link:{visualAspectEnabled:!0}},mappings:{href:"link.href",image:"link.image",title:"link.title"}})},"./src/extras/primitives/primitives/a-obj-model.js":(l,u,c)=>{var h=c("./src/extras/primitives/getMeshMixin.js")(),p=c("./src/extras/primitives/primitives.js").registerPrimitive,f=c("./src/utils/index.js");p("a-obj-model",f.extendDeep({},h,{defaultComponents:{"obj-model":{}},mappings:{src:"obj-model.obj",mtl:"obj-model.mtl"}}))},"./src/extras/primitives/primitives/a-sky.js":(l,u,c)=>{var h=c("./src/extras/primitives/getMeshMixin.js"),p=c("./src/extras/primitives/primitives.js").registerPrimitive,f=c("./src/utils/index.js"),g=c("./src/extras/primitives/primitives/meshPrimitives.js");p("a-sky",f.extendDeep({},h(),{defaultComponents:{geometry:{primitive:"sphere",radius:500,segmentsWidth:64,segmentsHeight:32},material:{color:"#FFF",side:"back",shader:"flat",npot:!0},scale:"-1 1 1"},mappings:f.extendDeep({},g["a-sphere"].mappings)}))},"./src/extras/primitives/primitives/a-sound.js":(l,u,c)=>{var h=c("./src/extras/primitives/primitives.js").registerPrimitive;h("a-sound",{defaultComponents:{sound:{}},mappings:{src:"sound.src",on:"sound.on",autoplay:"sound.autoplay",loop:"sound.loop",volume:"sound.volume"}})},"./src/extras/primitives/primitives/a-text.js":(l,u,c)=>{var h=c("./src/extras/primitives/primitives.js").definePrimitive;h("a-text",{text:{anchor:"align",width:5}})},"./src/extras/primitives/primitives/a-video.js":(l,u,c)=>{var h=c("./src/extras/primitives/getMeshMixin.js"),p=c("./src/extras/primitives/primitives.js").registerPrimitive,f=c("./src/utils/index.js");p("a-video",f.extendDeep({},h(),{defaultComponents:{geometry:{primitive:"plane"},material:{color:"#FFF",shader:"flat",side:"double",transparent:!0}},mappings:{height:"geometry.height",width:"geometry.width"}}))},"./src/extras/primitives/primitives/a-videosphere.js":(l,u,c)=>{var h=c("./src/extras/primitives/getMeshMixin.js"),p=c("./src/extras/primitives/primitives.js").registerPrimitive,f=c("./src/utils/index.js");p("a-videosphere",f.extendDeep({},h(),{defaultComponents:{geometry:{primitive:"sphere",radius:500,segmentsWidth:64,segmentsHeight:32},material:{color:"#FFF",shader:"flat",side:"back",npot:!0},scale:"-1 1 1"},mappings:{radius:"geometry.radius","segments-height":"geometry.segmentsHeight","segments-width":"geometry.segmentsWidth"}}))},"./src/extras/primitives/primitives/meshPrimitives.js":(l,u,c)=>{var h=c("./src/extras/primitives/getMeshMixin.js"),p=c("./src/core/geometry.js").geometries,f=c("./src/core/geometry.js").geometryNames,g=c("./src/extras/primitives/primitives.js").registerPrimitive,m=c("./src/utils/index.js"),y=l.exports={};f.forEach(function(v){var _=p[v],C=b(v),E={};Object.keys(_.schema).forEach(function(B){E[b(B)]="geometry."+B});var T="a-"+C,R=g(T,m.extendDeep({},h(),{defaultComponents:{geometry:{primitive:v}},mappings:E}));y[T]=R});function b(v){return v.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}},"./src/geometries/box.js":(l,u,c)=>{var h=c("./src/core/geometry.js").registerGeometry,p=c("./src/lib/three.js");h("box",{schema:{depth:{default:1,min:0},height:{default:1,min:0},width:{default:1,min:0},segmentsHeight:{default:1,min:1,max:20,type:"int"},segmentsWidth:{default:1,min:1,max:20,type:"int"},segmentsDepth:{default:1,min:1,max:20,type:"int"}},init:function(f){this.geometry=new p.BoxGeometry(f.width,f.height,f.depth,f.segmentsWidth,f.segmentsHeight,f.segmentsDepth)}})},"./src/geometries/circle.js":(l,u,c)=>{var h=c("./src/core/geometry.js").registerGeometry,p=c("./src/lib/three.js"),f=p.MathUtils.degToRad;h("circle",{schema:{radius:{default:1,min:0},segments:{default:32,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(g){this.geometry=new p.CircleGeometry(g.radius,g.segments,f(g.thetaStart),f(g.thetaLength))}})},"./src/geometries/cone.js":(l,u,c)=>{var h=c("./src/core/geometry.js").registerGeometry,p=c("./src/lib/three.js"),f=p.MathUtils.degToRad;h("cone",{schema:{height:{default:1,min:0},openEnded:{default:!1},radiusBottom:{default:1,min:0},radiusTop:{default:.01,min:0},segmentsHeight:{default:18,min:1,type:"int"},segmentsRadial:{default:36,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(g){this.geometry=new p.CylinderGeometry(g.radiusTop,g.radiusBottom,g.height,g.segmentsRadial,g.segmentsHeight,g.openEnded,f(g.thetaStart),f(g.thetaLength))}})},"./src/geometries/cylinder.js":(l,u,c)=>{var h=c("./src/core/geometry.js").registerGeometry,p=c("./src/lib/three.js"),f=p.MathUtils.degToRad;h("cylinder",{schema:{height:{default:1,min:0},openEnded:{default:!1},radius:{default:1,min:0},segmentsHeight:{default:18,min:1,type:"int"},segmentsRadial:{default:36,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(g){this.geometry=new p.CylinderGeometry(g.radius,g.radius,g.height,g.segmentsRadial,g.segmentsHeight,g.openEnded,f(g.thetaStart),f(g.thetaLength))}})},"./src/geometries/dodecahedron.js":(l,u,c)=>{var h=c("./src/core/geometry.js").registerGeometry,p=c("./src/lib/three.js");h("dodecahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(f){this.geometry=new p.DodecahedronGeometry(f.radius,f.detail)}})},"./src/geometries/icosahedron.js":(l,u,c)=>{var h=c("./src/core/geometry.js").registerGeometry,p=c("./src/lib/three.js");h("icosahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(f){this.geometry=new p.IcosahedronGeometry(f.radius,f.detail)}})},"./src/geometries/index.js":(l,u,c)=>{c("./src/geometries/box.js"),c("./src/geometries/circle.js"),c("./src/geometries/cone.js"),c("./src/geometries/cylinder.js"),c("./src/geometries/dodecahedron.js"),c("./src/geometries/icosahedron.js"),c("./src/geometries/octahedron.js"),c("./src/geometries/plane.js"),c("./src/geometries/ring.js"),c("./src/geometries/sphere.js"),c("./src/geometries/tetrahedron.js"),c("./src/geometries/torus.js"),c("./src/geometries/torusKnot.js"),c("./src/geometries/triangle.js")},"./src/geometries/octahedron.js":(l,u,c)=>{var h=c("./src/core/geometry.js").registerGeometry,p=c("./src/lib/three.js");h("octahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(f){this.geometry=new p.OctahedronGeometry(f.radius,f.detail)}})},"./src/geometries/plane.js":(l,u,c)=>{var h=c("./src/core/geometry.js").registerGeometry,p=c("./src/lib/three.js");h("plane",{schema:{height:{default:1,min:0},width:{default:1,min:0},segmentsHeight:{default:1,min:1,max:20,type:"int"},segmentsWidth:{default:1,min:1,max:20,type:"int"}},init:function(f){this.geometry=new p.PlaneGeometry(f.width,f.height,f.segmentsWidth,f.segmentsHeight)}})},"./src/geometries/ring.js":(l,u,c)=>{var h=c("./src/core/geometry.js").registerGeometry,p=c("./src/lib/three.js"),f=p.MathUtils.degToRad;h("ring",{schema:{radiusInner:{default:.8,min:0},radiusOuter:{default:1.2,min:0},segmentsPhi:{default:10,min:1,type:"int"},segmentsTheta:{default:32,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(g){this.geometry=new p.RingGeometry(g.radiusInner,g.radiusOuter,g.segmentsTheta,g.segmentsPhi,f(g.thetaStart),f(g.thetaLength))}})},"./src/geometries/sphere.js":(l,u,c)=>{var h=c("./src/core/geometry.js").registerGeometry,p=c("./src/lib/three.js"),f=p.MathUtils.degToRad;h("sphere",{schema:{radius:{default:1,min:0},phiLength:{default:360},phiStart:{default:0,min:0},thetaLength:{default:180,min:0},thetaStart:{default:0},segmentsHeight:{default:18,min:2,type:"int"},segmentsWidth:{default:36,min:3,type:"int"}},init:function(g){this.geometry=new p.SphereGeometry(g.radius,g.segmentsWidth,g.segmentsHeight,f(g.phiStart),f(g.phiLength),f(g.thetaStart),f(g.thetaLength))}})},"./src/geometries/tetrahedron.js":(l,u,c)=>{var h=c("./src/core/geometry.js").registerGeometry,p=c("./src/lib/three.js");h("tetrahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(f){this.geometry=new p.TetrahedronGeometry(f.radius,f.detail)}})},"./src/geometries/torus.js":(l,u,c)=>{var h=c("./src/core/geometry.js").registerGeometry,p=c("./src/lib/three.js"),f=p.MathUtils.degToRad;h("torus",{schema:{arc:{default:360},radius:{default:1,min:0},radiusTubular:{default:.2,min:0},segmentsRadial:{default:36,min:2,type:"int"},segmentsTubular:{default:32,min:3,type:"int"}},init:function(g){this.geometry=new p.TorusGeometry(g.radius,g.radiusTubular*2,g.segmentsRadial,g.segmentsTubular,f(g.arc))}})},"./src/geometries/torusKnot.js":(l,u,c)=>{var h=c("./src/core/geometry.js").registerGeometry,p=c("./src/lib/three.js");h("torusKnot",{schema:{p:{default:2,min:1},q:{default:3,min:1},radius:{default:1,min:0},radiusTubular:{default:.2,min:0},segmentsRadial:{default:8,min:3,type:"int"},segmentsTubular:{default:100,min:3,type:"int"}},init:function(f){this.geometry=new p.TorusKnotGeometry(f.radius,f.radiusTubular*2,f.segmentsTubular,f.segmentsRadial,f.p,f.q)}})},"./src/geometries/triangle.js":(l,u,c)=>{var h=c("./src/core/geometry.js").registerGeometry,p=c("./src/lib/three.js"),f=new p.Quaternion,g=new p.Vector3(0,0,1),m=new p.Vector2,y=new p.Vector2,b=new p.Vector2;h("triangle",{schema:{vertexA:{type:"vec3",default:{x:0,y:.5,z:0}},vertexB:{type:"vec3",default:{x:-.5,y:-.5,z:0}},vertexC:{type:"vec3",default:{x:.5,y:-.5,z:0}}},init:function(v){var _,C,E,T,R,B,I,D,L;E=new p.Triangle,E.a.set(v.vertexA.x,v.vertexA.y,v.vertexA.z),E.b.set(v.vertexB.x,v.vertexB.y,v.vertexB.z),E.c.set(v.vertexC.x,v.vertexC.y,v.vertexC.z),C=E.getNormal(new p.Vector3),f.setFromUnitVectors(C,g),T=E.a.clone().applyQuaternion(f),R=E.b.clone().applyQuaternion(f),B=E.c.clone().applyQuaternion(f),m.set(Math.min(T.x,R.x,B.x),Math.min(T.y,R.y,B.y)),y.set(Math.max(T.x,R.x,B.x),Math.max(T.y,R.y,B.y)),b.set(0,0).subVectors(y,m),T=new p.Vector2().subVectors(T,m).divide(b),R=new p.Vector2().subVectors(R,m).divide(b),B=new p.Vector2().subVectors(B,m).divide(b),_=this.geometry=new p.BufferGeometry,I=[E.a.x,E.a.y,E.a.z,E.b.x,E.b.y,E.b.z,E.c.x,E.c.y,E.c.z],D=[C.x,C.y,C.z,C.x,C.y,C.z,C.x,C.y,C.z],L=[T.x,T.y,R.x,R.y,B.x,B.y],_.setAttribute("position",new p.Float32BufferAttribute(I,3)),_.setAttribute("normal",new p.Float32BufferAttribute(D,3)),_.setAttribute("uv",new p.Float32BufferAttribute(L,2))}})},"./src/index.js":(l,u,c)=>{if(window.hasNativeWebVRImplementation=!!window.navigator.getVRDisplays||!!window.navigator.getVRDevices,window.hasNativeWebXRImplementation=navigator.xr!==void 0,!window.hasNativeWebXRImplementation&&!window.hasNativeWebVRImplementation){var h=c("./src/utils/isIOSOlderThan10.js"),p=h(window.navigator.userAgent)?1/window.devicePixelRatio:1,f=c("./node_modules/webvr-polyfill/build/webvr-polyfill.js"),g={BUFFER_SCALE:p,CARDBOARD_UI_DISABLED:!0,ROTATE_INSTRUCTIONS_DISABLED:!0,MOBILE_WAKE_LOCK:!!window.cordova};window.webvrpolyfill=new f(g)}var m=c("./src/utils/index.js"),y=m.debug,b=y("A-Frame:error"),v=y("A-Frame:warn");window.document.currentScript&&window.document.currentScript.parentNode!==window.document.head&&!window.debug&&v("Put the A-Frame <script> tag in the <head> of the HTML *before* the scene to ensure everything for A-Frame is properly registered before they are used from HTML."),!window.cordova&&window.location.protocol==="file:"&&b("This HTML file is currently being served via the file:// protocol. Assets, textures, and models WILL NOT WORK due to cross-origin policy! Please use a local or hosted server: https://aframe.io/docs/1.4.0/introduction/installation.html#use-a-local-server."),m.device.isBrowserEnvironment&&(c("./src/style/aframe.css"),c("./src/style/rStats.css"));var _=c("./src/core/scene/a-scene.js").AScene,C=c("./src/core/component.js").components,E=c("./src/core/component.js").registerComponent,T=c("./src/core/geometry.js").registerGeometry,R=c("./src/extras/primitives/primitives.js").registerPrimitive,B=c("./src/core/shader.js").registerShader,I=c("./src/core/system.js").registerSystem,D=c("./src/core/shader.js").shaders,L=c("./src/core/system.js").systems,O=window.THREE=c("./src/lib/three.js"),F=c("./src/core/readyState.js"),q=c("./package.json");c("./src/components/index.js"),c("./src/geometries/index.js"),c("./src/shaders/index.js"),c("./src/systems/index.js");var H=c("./src/core/a-node.js").ANode,G=c("./src/core/a-entity.js").AEntity;c("./src/core/a-assets.js"),c("./src/core/a-cubemap.js"),c("./src/core/a-mixin.js"),c("./src/extras/components/index.js"),c("./src/extras/primitives/index.js"),console.log("A-Frame Version: 1.6.0 (Date 2024-05-23, Commit #e6c47761)"),console.log("THREE Version (https://github.com/supermedium/three.js):",O.REVISION),console.log("WebVR Polyfill Version:",q.dependencies["webvr-polyfill"]),window.AFRAME_ASYNC||F.waitForDocumentReadyState(),l.exports=window.AFRAME={AComponent:c("./src/core/component.js").Component,AEntity:G,ANode:H,ANIME:c("./node_modules/super-animejs/lib/anime.es.js").default,AScene:_,components:C,coreComponents:Object.keys(C),geometries:c("./src/core/geometry.js").geometries,registerComponent:E,registerGeometry:T,registerPrimitive:R,registerShader:B,registerSystem:I,primitives:{getMeshMixin:c("./src/extras/primitives/getMeshMixin.js"),primitives:c("./src/extras/primitives/primitives.js").primitives},scenes:c("./src/core/scene/scenes.js"),schema:c("./src/core/schema.js"),shaders:D,systems:L,emitReady:F.emitReady,THREE:O,utils:m,version:q.version}},"./src/lib/rStatsAframe.js":l=>{window.aframeStats=function(u){var c=null,h=u,p={te:{caption:"Entities"},lt:{caption:"Load Time"}},f=[{caption:"A-Frame",values:["te","lt"]}];function g(){c("te").set(m()),window.performance.getEntriesByName&&c("lt").set(window.performance.getEntriesByName("render-started")[0].startTime.toFixed(0))}function m(){var _=h.querySelectorAll("*");return Array.prototype.slice.call(_).filter(function(C){return C.isEntity}),_.length}function y(){}function b(){}function v(_){c=_}return{update:g,start:y,end:b,attach:v,values:p,groups:f,fractions:[]}},l.exports={aframeStats:window.aframeStats}},"./src/lib/three.js":(l,u,c)=>{var h=c("./src/lib/three.mjs").default;c.g.THREE=h,c("./vendor/DeviceOrientationControls.js"),h.Cache&&(h.Cache.enabled=!0),l.exports=h},"./src/shaders/flat.js":(l,u,c)=>{var h=c("./src/core/shader.js").registerShader,p=c("./src/lib/three.js"),f=c("./src/utils/index.js");l.exports.Shader=h("flat",{schema:{color:{type:"color"},fog:{default:!0},height:{default:256},offset:{type:"vec2",default:{x:0,y:0}},repeat:{type:"vec2",default:{x:1,y:1}},src:{type:"map"},width:{default:512},wireframe:{default:!1},wireframeLinewidth:{default:2},toneMapped:{default:!0}},init:function(m){this.materialData={color:new p.Color},g(m,this.materialData),this.material=new p.MeshBasicMaterial(this.materialData)},update:function(m){this.updateMaterial(m),f.material.updateMap(this,m)},updateMaterial:function(m){var y;g(m,this.materialData);for(y in this.materialData)this.material[y]=this.materialData[y]}});function g(m,y){return y.color.set(m.color),y.fog=m.fog,y.wireframe=m.wireframe,y.toneMapped=m.toneMapped,y.wireframeLinewidth=m.wireframeLinewidth,y}},"./src/shaders/index.js":(l,u,c)=>{c("./src/shaders/flat.js"),c("./src/shaders/standard.js"),c("./src/shaders/phong.js"),c("./src/shaders/sdf.js"),c("./src/shaders/msdf.js"),c("./src/shaders/shadow.js")},"./src/shaders/msdf.js":(l,u,c)=>{var h=c("./src/core/shader.js").registerShader,p=c("./src/lib/three.js"),f=["#include <common>","#include <fog_pars_vertex>","#include <logdepthbuf_pars_vertex>","out vec2 vUV;","void main(void) {","  vUV = uv;","  #include <begin_vertex>","  #include <project_vertex>","  #include <logdepthbuf_vertex>","  #include <fog_vertex>","}"].join(`
`),g=["#include <common>","#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","uniform bool negate;","uniform float alphaTest;","uniform float opacity;","uniform sampler2D map;","uniform vec3 color;","in vec2 vUV;","float median(float r, float g, float b) {","  return max(min(r, g), min(max(r, g), b));","}","#define BIG_ENOUGH 0.001","#define MODIFIED_ALPHATEST (0.02 * isBigEnough / BIG_ENOUGH)","void main() {","  vec3 sampleColor = texture(map, vUV).rgb;","  if (negate) { sampleColor = 1.0 - sampleColor; }","  float sigDist = median(sampleColor.r, sampleColor.g, sampleColor.b) - 0.5;","  float alpha = clamp(sigDist / fwidth(sigDist) + 0.5, 0.0, 1.0);","  float dscale = 0.353505;","  vec2 duv = dscale * (dFdx(vUV) + dFdy(vUV));","  float isBigEnough = max(abs(duv.x), abs(duv.y));","  // Do modified alpha test.","  if (isBigEnough > BIG_ENOUGH) {","    float ratio = BIG_ENOUGH / isBigEnough;","    alpha = ratio * alpha + (1.0 - ratio) * (sigDist + 0.5);","  }","  // Do modified alpha test.","  if (alpha < alphaTest * MODIFIED_ALPHATEST) { discard; return; }","  gl_FragColor = vec4(color.xyz, alpha * opacity);","  #include <logdepthbuf_fragment>","  #include <tonemapping_fragment>","  #include <colorspace_fragment>","  #include <fog_fragment>","}"].join(`
`);l.exports.Shader=h("msdf",{schema:{alphaTest:{type:"number",is:"uniform",default:.5},color:{type:"color",is:"uniform",default:"white"},map:{type:"map",is:"uniform"},negate:{type:"boolean",is:"uniform",default:!0},opacity:{type:"number",is:"uniform",default:1}},vertexShader:f,fragmentShader:g,init:function(){return this.uniforms=p.UniformsUtils.merge([p.UniformsLib.fog,this.initUniforms()]),this.material=new p.ShaderMaterial({uniforms:this.uniforms,vertexShader:this.vertexShader,fragmentShader:this.fragmentShader,fog:!0}),this.material}})},"./src/shaders/phong.js":(l,u,c)=>{var h=c("./src/core/shader.js").registerShader,p=c("./src/lib/three.js"),f=c("./src/utils/index.js");l.exports.Shader=h("phong",{schema:{color:{type:"color"},emissive:{type:"color",default:"black"},emissiveIntensity:{default:1},specular:{type:"color",default:"#111111"},transparent:{default:!1},fog:{default:!0},offset:{type:"vec2",default:{x:0,y:0}},repeat:{type:"vec2",default:{x:1,y:1}},src:{type:"map"},envMap:{default:""},sphericalEnvMap:{type:"map"},shininess:{default:30},flatShading:{default:!1},wireframe:{default:!1},wireframeLinewidth:{default:2},combine:{oneOF:["multiply","mix","add"],default:"mix"},reflectivity:{default:.9},refractionRatio:{default:.98},refract:{default:!1},normalMap:{type:"map"},normalScale:{type:"vec2",default:{x:1,y:1}},normalTextureOffset:{type:"vec2"},normalTextureRepeat:{type:"vec2",default:{x:1,y:1}},ambientOcclusionMap:{type:"map"},ambientOcclusionMapIntensity:{default:1},displacementMap:{type:"map"},displacementScale:{default:1},displacementBias:{default:.5},displacementTextureOffset:{type:"vec2"},displacementTextureRepeat:{type:"vec2",default:{x:1,y:1}},bumpMap:{type:"map"},bumpMapScale:{default:1},bumpTextureOffset:{type:"vec2"},bumpTextureRepeat:{type:"vec2",default:{x:1,y:1}}},init:function(m){this.materialData={color:new p.Color,specular:new p.Color,emissive:new p.Color},g(m,this.materialData),this.material=new p.MeshPhongMaterial(this.materialData);var y=this.el.sceneEl;Object.defineProperty(this.material,"envMap",{get:function(){return this._envMap||y.object3D.environment},set:function(b){this._envMap=b}})},update:function(m){this.updateMaterial(m),f.material.updateMap(this,m),f.material.updateDistortionMap("normal",this,m),f.material.updateDistortionMap("displacement",this,m),f.material.updateDistortionMap("ambientOcclusion",this,m),f.material.updateDistortionMap("bump",this,m),f.material.updateEnvMap(this,m)},updateMaterial:function(m){var y;g(m,this.materialData);for(y in this.materialData)this.material[y]=this.materialData[y]}});function g(m,y){switch(y.color.set(m.color),y.specular.set(m.specular),y.emissive.set(m.emissive),y.emissiveIntensity=m.emissiveIntensity,y.fog=m.fog,y.transparent=m.transparent,y.wireframe=m.wireframe,y.wireframeLinewidth=m.wireframeLinewidth,y.shininess=m.shininess,y.flatShading=m.flatShading,y.wireframe=m.wireframe,y.wireframeLinewidth=m.wireframeLinewidth,y.reflectivity=m.reflectivity,y.refractionRatio=m.refractionRatio,m.combine){case"mix":y.combine=p.MixOperation;break;case"multiply":y.combine=p.MultiplyOperation;break;case"add":y.combine=p.AddOperation;break}return m.normalMap&&(y.normalScale=m.normalScale),m.ambientOcclusionMap&&(y.aoMapIntensity=m.ambientOcclusionMapIntensity),m.bumpMap&&(y.bumpScale=m.bumpMapScale),m.displacementMap&&(y.displacementScale=m.displacementScale,y.displacementBias=m.displacementBias),y}},"./src/shaders/sdf.js":(l,u,c)=>{var h=c("./src/core/shader.js").registerShader,p=c("./src/lib/three.js"),f=["#include <common>","#include <fog_pars_vertex>","#include <logdepthbuf_pars_vertex>","out vec2 vUV;","void main(void) {","  vUV = uv;","  #include <begin_vertex>","  #include <project_vertex>","  #include <logdepthbuf_vertex>","  #include <fog_vertex>","}"].join(`
`),g=["#include <common>","#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","uniform float alphaTest;","uniform float opacity;","uniform sampler2D map;","uniform vec3 color;","in vec2 vUV;","float contour(float width, float value) {","  return smoothstep(0.5 - value, 0.5 + value, width);","}","#define BIG_ENOUGH 0.001","#define MODIFIED_ALPHATEST (0.02 * isBigEnough / BIG_ENOUGH)","void main() {","  vec2 uv = vUV;","  vec4 texColor = texture(map, uv);","  float dist = texColor.a;","  float width = fwidth(dist);","  float alpha = contour(dist, width);","  float dscale = 0.353505;","  vec2 duv = dscale * (dFdx(uv) + dFdy(uv));","  float isBigEnough = max(abs(duv.x), abs(duv.y));","  if (isBigEnough > BIG_ENOUGH) {","    float ratio = BIG_ENOUGH / isBigEnough;","    alpha = ratio * alpha + (1.0 - ratio) * dist;","  }","  if (isBigEnough <= BIG_ENOUGH) {","    vec4 box = vec4 (uv - duv, uv + duv);","    alpha = (alpha + 0.5 * (","      contour(texture(map, box.xy).a, width)","      + contour(texture(map, box.zw).a, width)","      + contour(texture(map, box.xw).a, width)","      + contour(texture(map, box.zy).a, width)","    )) / 3.0;","  }","  if (alpha < alphaTest * MODIFIED_ALPHATEST) { discard; return; }","  gl_FragColor = vec4(color, opacity * alpha);","  #include <logdepthbuf_fragment>","  #include <tonemapping_fragment>","  #include <colorspace_fragment>","  #include <fog_fragment>","}"].join(`
`);l.exports.Shader=h("sdf",{schema:{alphaTest:{type:"number",is:"uniform",default:.5},color:{type:"color",is:"uniform",default:"white"},map:{type:"map",is:"uniform"},opacity:{type:"number",is:"uniform",default:1}},vertexShader:f,fragmentShader:g,init:function(){return this.uniforms=p.UniformsUtils.merge([p.UniformsLib.fog,this.initUniforms()]),this.material=new p.ShaderMaterial({uniforms:this.uniforms,vertexShader:this.vertexShader,fragmentShader:this.fragmentShader,fog:!0}),this.material}})},"./src/shaders/shadow.js":(l,u,c)=>{var h=c("./src/core/shader.js").registerShader,p=c("./src/lib/three.js");l.exports.Shader=h("shadow",{schema:{opacity:{default:.5},transparent:{default:!0},alphaToCoverage:{default:!0}},init:function(f){this.material=new p.ShadowMaterial},update:function(f){this.material.opacity=f.opacity,this.material.alphaToCoverage=f.alphaToCoverage,this.material.transparent=f.transparent}})},"./src/shaders/standard.js":(l,u,c)=>{var h=c("./src/core/shader.js").registerShader,p=c("./src/lib/three.js"),f=c("./src/utils/index.js");l.exports.Shader=h("standard",{schema:{ambientOcclusionMap:{type:"map"},ambientOcclusionMapIntensity:{default:1},ambientOcclusionTextureOffset:{type:"vec2"},ambientOcclusionTextureRepeat:{type:"vec2",default:{x:1,y:1}},color:{type:"color"},displacementMap:{type:"map"},displacementScale:{default:1},displacementBias:{default:.5},displacementTextureOffset:{type:"vec2"},displacementTextureRepeat:{type:"vec2",default:{x:1,y:1}},emissive:{type:"color",default:"#000"},emissiveIntensity:{default:1},envMap:{default:""},fog:{default:!0},height:{default:256},metalness:{default:0,min:0,max:1},metalnessMap:{type:"map"},metalnessTextureOffset:{type:"vec2"},metalnessTextureRepeat:{type:"vec2",default:{x:1,y:1}},normalMap:{type:"map"},normalScale:{type:"vec2",default:{x:1,y:1}},normalTextureOffset:{type:"vec2"},normalTextureRepeat:{type:"vec2",default:{x:1,y:1}},offset:{type:"vec2",default:{x:0,y:0}},repeat:{type:"vec2",default:{x:1,y:1}},roughness:{default:.5,min:0,max:1},roughnessMap:{type:"map"},roughnessTextureOffset:{type:"vec2"},roughnessTextureRepeat:{type:"vec2",default:{x:1,y:1}},sphericalEnvMap:{type:"map"},src:{type:"map"},width:{default:512},wireframe:{default:!1},wireframeLinewidth:{default:2}},init:function(m){this.materialData={color:new p.Color,emissive:new p.Color},g(m,this.materialData),this.material=new p.MeshStandardMaterial(this.materialData)},update:function(m){this.updateMaterial(m),f.material.updateMap(this,m),f.material.updateDistortionMap("normal",this,m),f.material.updateDistortionMap("displacement",this,m),f.material.updateDistortionMap("ambientOcclusion",this,m),f.material.updateDistortionMap("metalness",this,m),f.material.updateDistortionMap("roughness",this,m),f.material.updateEnvMap(this,m)},updateMaterial:function(m){var y,b=this.material;g(m,this.materialData);for(y in this.materialData)b[y]=this.materialData[y]}});function g(m,y){return y.color.set(m.color),y.emissive.set(m.emissive),y.emissiveIntensity=m.emissiveIntensity,y.fog=m.fog,y.metalness=m.metalness,y.roughness=m.roughness,y.wireframe=m.wireframe,y.wireframeLinewidth=m.wireframeLinewidth,m.normalMap&&(y.normalScale=m.normalScale),m.ambientOcclusionMap&&(y.aoMapIntensity=m.ambientOcclusionMapIntensity),m.displacementMap&&(y.displacementScale=m.displacementScale,y.displacementBias=m.displacementBias),y}},"./src/systems/camera.js":(l,u,c)=>{var h=c("./src/constants/index.js"),p=c("./src/core/system.js").registerSystem,f="data-aframe-default-camera";l.exports.System=p("camera",{init:function(){this.activeCameraEl=null,this.render=this.render.bind(this),this.unwrapRender=this.unwrapRender.bind(this),this.wrapRender=this.wrapRender.bind(this),this.initialCameraFound=!1,this.numUserCameras=0,this.numUserCamerasChecked=0,this.setupInitialCamera()},setupInitialCamera:function(){var m,y,b=this.sceneEl,v=this;if(b.camera&&!b.camera.el.getAttribute("camera").spectator){b.emit("cameraready",{cameraEl:b.camera.el});return}if(m=b.querySelectorAll("a-camera, :not(a-mixin)[camera]"),!m.length){this.createDefaultCamera();return}for(this.numUserCameras=m.length,y=0;y<m.length;y++)m[y].addEventListener("object3dset",function(_){_.detail.type==="camera"&&v.checkUserCamera(this)}),m[y].isNode?m[y].load():m[y].addEventListener("nodeready",function(){this.load()})},checkUserCamera:function(m){var y,b=this.el.sceneEl;if(this.numUserCamerasChecked++,!this.initialCameraFound){if(y=m.getAttribute("camera"),!y.active||y.spectator){this.numUserCamerasChecked===this.numUserCameras&&this.createDefaultCamera();return}this.initialCameraFound=!0,b.camera=m.getObject3D("camera"),b.emit("cameraready",{cameraEl:m})}},createDefaultCamera:function(){var m,y=this.sceneEl;m=document.createElement("a-entity"),m.setAttribute("camera",{active:!0}),m.setAttribute("position",{x:0,y:h.DEFAULT_CAMERA_HEIGHT,z:0}),m.setAttribute("wasd-controls",""),m.setAttribute("look-controls",""),m.setAttribute(h.AFRAME_INJECTED,""),m.addEventListener("object3dset",function(b){b.detail.type==="camera"&&(y.camera=b.detail.object,y.emit("cameraready",{cameraEl:m}))}),y.appendChild(m)},disableActiveCamera:function(){var m,y;m=this.sceneEl.querySelectorAll(":not(a-mixin)[camera]"),y=m[m.length-1],y.setAttribute("camera","active",!0)},setActiveCamera:function(m){var y,b,v,_,C=this.activeCameraEl,E=this.sceneEl;if(_=m.getObject3D("camera"),!(!_||m===this.activeCameraEl)){var T=E.querySelector("["+f+"]"),R=T&&T.querySelector(":not(a-mixin)[camera]");for(m!==R&&g(E),this.activeCameraEl=m,this.activeCameraEl.play(),E.camera=_,C&&C.setAttribute("camera","active",!1),b=E.querySelectorAll(":not(a-mixin)[camera]"),v=0;v<b.length;v++)y=b[v],!(!y.isEntity||m===y)&&(y.setAttribute("camera","active",!1),y.pause());E.emit("camera-set-active",{cameraEl:m})}},setSpectatorCamera:function(m){var y,b=this.spectatorCameraEl,v=this.sceneEl,_;y=m.getObject3D("camera"),!(!y||m===this.spectatorCameraEl)&&(b&&b.setAttribute("camera","spectator",!1),_=this.spectatorCameraEl=m,v.addEventListener("enter-vr",this.wrapRender),v.addEventListener("exit-vr",this.unwrapRender),_.setAttribute("camera","active",!1),_.play(),v.emit("camera-set-spectator",{cameraEl:m}))},disableSpectatorCamera:function(){this.spectatorCameraEl=void 0},wrapRender:function(){!this.spectatorCameraEl||this.originalRender||(this.originalRender=this.sceneEl.renderer.render,this.sceneEl.renderer.render=this.render)},unwrapRender:function(){this.originalRender&&(this.sceneEl.renderer.render=this.originalRender,this.originalRender=void 0)},render:function(m,y){var b,v=this.sceneEl,_;b=v.renderer.xr.enabled,this.originalRender.call(v.renderer,m,y),!(!this.spectatorCameraEl||v.isMobile||!b)&&(_=this.spectatorCameraEl.components.camera.camera,v.renderer.xr.enabled=!1,this.originalRender.call(v.renderer,m,_),v.renderer.xr.enabled=b)}});function g(m){var y,b=m.camera;b&&(y=m.querySelector("["+f+"]"),y&&m.removeChild(y))}},"./src/systems/geometry.js":(l,u,c)=>{var h=c("./src/core/geometry.js").geometries,p=c("./src/core/system.js").registerSystem;l.exports.System=p("geometry",{init:function(){this.cache={},this.cacheCount={}},clearCache:function(){this.cache={},this.cacheCount={}},getOrCreateGeometry:function(y){var b=this.cache,v,_;return y.skipCache?f(y):(_=this.hash(y),v=b[_],m(this.cacheCount,_),v||(v=f(y),b[_]=v,v))},unuseGeometry:function(y){var b=this.cache,v=this.cacheCount,_,C;y.skipCache||(C=this.hash(y),b[C]&&(g(v,C),!(v[C]>0)&&(_=b[C],_.dispose(),delete b[C],delete v[C])))},hash:function(y){return JSON.stringify(y)}});function f(y){var b=y.primitive,v=h[b]&&h[b].Geometry,_=new v;if(!v)throw new Error("Unknown geometry `"+b+"`");return _.init(y),_.geometry}function g(y,b){y[b]--}function m(y,b){y[b]=y[b]===void 0?1:y[b]+1}},"./src/systems/gltf-model.js":(l,u,c)=>{var h=c("./src/core/system.js").registerSystem,p=c("./src/lib/three.js");function f(g){return new Promise(function(m,y){var b=document.createElement("script");document.body.appendChild(b),b.onload=m,b.onerror=y,b.async=!0,b.src=g})}l.exports.System=h("gltf-model",{schema:{dracoDecoderPath:{default:"https://www.gstatic.com/draco/versioned/decoders/1.5.6/"},basisTranscoderPath:{default:""},meshoptDecoderPath:{default:""}},init:function(){this.update()},update:function(){var g=this.data.dracoDecoderPath,m=this.data.basisTranscoderPath,y=this.data.meshoptDecoderPath;!this.dracoLoader&&g&&(this.dracoLoader=new p.DRACOLoader,this.dracoLoader.setDecoderPath(g)),!this.ktx2Loader&&m&&(this.ktx2Loader=new p.KTX2Loader,this.ktx2Loader.setTranscoderPath(m).detectSupport(this.el.renderer)),!this.meshoptDecoder&&y&&(this.meshoptDecoder=f(y).then(function(){return window.MeshoptDecoder.ready}).then(function(){return window.MeshoptDecoder}))},getDRACOLoader:function(){return this.dracoLoader},getKTX2Loader:function(){return this.ktx2Loader},getMeshoptDecoder:function(){return this.meshoptDecoder}})},"./src/systems/index.js":(l,u,c)=>{c("./src/systems/camera.js"),c("./src/systems/geometry.js"),c("./src/systems/gltf-model.js"),c("./src/systems/light.js"),c("./src/systems/material.js"),c("./src/systems/obb-collider.js"),c("./src/systems/renderer.js"),c("./src/systems/shadow.js"),c("./src/systems/tracked-controls-webvr.js"),c("./src/systems/tracked-controls-webxr.js"),c("./src/systems/webxr.js")},"./src/systems/light.js":(l,u,c)=>{var h=c("./src/core/system.js").registerSystem,p=c("./src/constants/index.js"),f="data-aframe-default-light";l.exports.System=h("light",{schema:{defaultLightsEnabled:{default:!0}},init:function(){this.defaultLights=!1,this.userDefinedLights=!1,this.sceneEl.addEventListener("loaded",this.setupDefaultLights.bind(this))},registerLight:function(g){g.hasAttribute(f)||(this.removeDefaultLights(),this.userDefinedLights=!0)},removeDefaultLights:function(){var g,m=this.sceneEl;if(this.defaultLights){g=document.querySelectorAll("["+f+"]");for(var y=0;y<g.length;y++)m.removeChild(g[y]);this.defaultLights=!1}},setupDefaultLights:function(){var g=this.sceneEl,m,y;this.userDefinedLights||this.defaultLights||!this.data.defaultLightsEnabled||(m=document.createElement("a-entity"),m.setAttribute("light",{color:"#BBB",type:"ambient"}),m.setAttribute(f,""),m.setAttribute(p.AFRAME_INJECTED,""),g.appendChild(m),y=document.createElement("a-entity"),y.setAttribute("light",{color:"#FFF",intensity:.6,castShadow:!0}),y.setAttribute("position",{x:-.5,y:1,z:1}),y.setAttribute(f,""),y.setAttribute(p.AFRAME_INJECTED,""),g.appendChild(y),this.defaultLights=!0)}})},"./src/systems/material.js":(l,u,c)=>{var h=c("./src/core/system.js").registerSystem,p=c("./src/lib/three.js"),f=c("./src/utils/index.js"),g=c("./src/utils/material.js").setTextureProperties,m=c("./src/utils/material.js").createCompatibleTexture,y=f.debug,b=y("components:texture:error"),v=y("components:texture:warn"),_=new p.ImageLoader;l.exports.System=h("material",{init:function(){this.materials={},this.sourceCache={}},clearTextureSourceCache:function(){this.sourceCache={}},loadTexture:function(R,B,I){this.loadTextureSource(R,function(D){var L=m(D);g(L,B),I(L)})},loadTextureSource:function(R,B){var I=this,D=this.sourceCache,L=this.hash(R);if(D[L]){D[L].then(B);return}if(R.tagName==="CANVAS"){F(new p.Source(R));return}F(new Promise(O));function O(q,H){f.srcLoader.validateSrc(R,G,J);function G(Q){I.loadImage(Q,q)}function J(Q){I.loadVideo(Q,q)}}function F(q){D[L]=Promise.resolve(q),D[L].then(B)}},loadCubeMapTexture:function(R,B){var I=this,D=0,L=new p.CubeTexture;L.colorSpace=p.SRGBColorSpace;function O(q){I.loadTextureSource(R[q],function(H){L.images[q]=H,D++,D===6&&(L.needsUpdate=!0,B(L))})}if(R.length!==6){v("Cube map texture requires exactly 6 sources, got only %s sources",R.length);return}for(var F=0;F<R.length;F++)O(F)},loadImage:function(R,B){if(typeof R!="string"){B(new p.Source(R));return}B(C(R))},loadVideo:function(R,B){var I;typeof R!="string"&&(I=R,T(I)),I=I||E(R),B(new p.Source(I))},hash:function(R){return R.tagName&&(R.id||R.src)||R},registerMaterial:function(R){this.materials[R.uuid]=R},unregisterMaterial:function(R){delete this.materials[R.uuid]}});function C(R){return new Promise(B);function B(I,D){_.load(R,L,function(){},function(O){b("`$s` could not be fetched (Error code: %s; Response: %s)",O.status,O.statusText)});function L(O){I(new p.Source(O))}}}function E(R){var B=document.createElement("video");return B.setAttribute("playsinline",""),B.setAttribute("webkit-playsinline",""),B.autoplay=!0,B.loop=!0,B.crossOrigin="anonymous",B.addEventListener("error",function(){v("`%s` is not a valid video",R)},!0),B.src=R,B}function T(R){return R.autoplay=R.hasAttribute("autoplay")&&R.getAttribute("autoplay")!=="false",R.controls=R.hasAttribute("controls")&&R.getAttribute("controls")!=="false",R.getAttribute("loop")==="false"&&R.removeAttribute("loop"),R.getAttribute("preload")==="false"&&(R.preload="none"),R.crossOrigin=R.crossOrigin||"anonymous",R.setAttribute("playsinline",""),R.setAttribute("webkit-playsinline",""),R}},"./src/systems/obb-collider.js":(l,u,c)=>{var h=c("./src/core/system.js").registerSystem;h("obb-collider",{schema:{showColliders:{default:!1}},init:function(){this.collisions=[],this.colliderEls=[]},addCollider:function(p){this.colliderEls.push(p),this.data.showColliders?p.components["obb-collider"].showCollider():p.components["obb-collider"].hideCollider(),this.tick=this.detectCollisions},removeCollider:function(p){var f=this.colliderEls,g=f.indexOf(p);p.components["obb-collider"].hideCollider(),g>-1&&f.splice(g,1),f.length===0&&(this.tick=void 0)},registerCollision:function(p,f){var g=this.collisions,m=!1,y=p.obb,b=f.obb,v=p.renderColliderMesh,_=f.renderColliderMesh;v&&v.material.color.set(16711680),_&&_.material.color.set(16711680);for(var C=0;C<g.length;C++)if(g[C].componentA.obb===y&&g[C].componentB.obb===b||g[C].componentA.obb===b&&g[C].componentB.obb===y){m=!0,g[C].detected=!0;break}m||(g.push({componentA:p,componentB:f,detected:!0}),p.el.emit("obbcollisionstarted",{trackedObject3D:p.trackedObject3D,withEl:f.el}),f.el.emit("obbcollisionstarted",{trackedObject3D:f.trackedObject3D,withEl:p.el}))},resetCollisions:function(){for(var p=this.collisions,f=0;f<p.length;f++)p[f].detected=!1},clearCollisions:function(){for(var p=this.collisions,f=[],g,m,y,b,v=0;v<p.length;v++)p[v].detected?f.push(p[v]):(g=p[v].componentA,m=p[v].componentB,y=g.renderColliderMesh,b=m.renderColliderMesh,y&&y.material.color.set(65280),g.el.emit("obbcollisionended",{trackedObject3D:this.trackedObject3D,withEl:m.el}),b&&b.material.color.set(65280),m.el.emit("obbcollisionended",{trackedObject3D:this.trackedObject3D,withEl:g.el}));this.collisions=f},detectCollisions:function(){var p,f,g,m,y=this.colliderEls;if(!(y.length<2)){this.resetCollisions();for(var b=0;b<y.length;b++)if(g=y[b].components["obb-collider"],p=y[b].components["obb-collider"].obb,!(p.halfSize.x===0||p.halfSize.y===0||p.halfSize.z===0))for(var v=b+1;v<y.length;v++)m=y[v].components["obb-collider"],f=m.obb,!(f.halfSize.x===0||f.halfSize.y===0||f.halfSize.z===0)&&p.intersectsOBB(f)&&this.registerCollision(g,m);this.clearCollisions()}}})},"./src/systems/renderer.js":(l,u,c)=>{var h=c("./src/core/system.js").registerSystem,p=c("./src/utils/index.js"),f=c("./src/lib/three.js"),g=p.debug,m=g("components:renderer:warn");l.exports.System=h("renderer",{schema:{antialias:{default:"auto",oneOf:["true","false","auto"]},highRefreshRate:{default:p.device.isOculusBrowser()},logarithmicDepthBuffer:{default:"auto",oneOf:["true","false","auto"]},maxCanvasWidth:{default:-1},maxCanvasHeight:{default:-1},multiviewStereo:{default:!1},physicallyCorrectLights:{default:!1},exposure:{default:1,if:{toneMapping:["ACESFilmic","linear","reinhard","cineon"]}},toneMapping:{default:"no",oneOf:["no","ACESFilmic","linear","reinhard","cineon"]},precision:{default:"high",oneOf:["high","medium","low"]},anisotropy:{default:1},sortTransparentObjects:{default:!1},colorManagement:{default:!0},alpha:{default:!0},stencil:{default:!1},foveationLevel:{default:1}},init:function(){var _=this.data,C=this.el,E=this.data.toneMapping.charAt(0).toUpperCase()+this.data.toneMapping.slice(1),T=C.renderer;_.physicallyCorrectLights||(T.useLegacyLights=!_.physicallyCorrectLights),T.toneMapping=f[E+"ToneMapping"],f.Texture.DEFAULT_ANISOTROPY=_.anisotropy,f.ColorManagement.enabled=_.colorManagement,T.outputColorSpace=_.colorManagement?f.SRGBColorSpace:f.LinearSRGBColorSpace,C.hasAttribute("antialias")&&m('Component `antialias` is deprecated. Use `renderer="antialias: true"` instead.'),C.hasAttribute("logarithmicDepthBuffer")&&m('Component `logarithmicDepthBuffer` is deprecated. Use `renderer="logarithmicDepthBuffer: true"` instead.'),T.sortObjects=!0,T.setOpaqueSort(y)},update:function(){var _=this.data,C=this.el,E=C.renderer,T=this.data.toneMapping.charAt(0).toUpperCase()+this.data.toneMapping.slice(1);E.toneMapping=f[T+"ToneMapping"],E.toneMappingExposure=_.exposure,E.xr.setFoveation(_.foveationLevel),_.sortObjects&&m('`sortObjects` property is deprecated. Use `renderer="sortTransparentObjects: true"` instead.'),_.sortTransparentObjects?E.setTransparentSort(v):E.setTransparentSort(b)},applyColorCorrection:function(_){!this.data.colorManagement||!_||_.isTexture&&_.colorSpace!==f.SRGBColorSpace&&(_.colorSpace=f.SRGBColorSpace,_.needsUpdate=!0)},setWebXRFrameRate:function(_){var C=this.data,E=_.supportedFrameRates;if(E&&_.updateTargetFrameRate){var T;E.includes(90)?T=C.highRefreshRate?90:72:T=C.highRefreshRate?72:60,_.updateTargetFrameRate(T).catch(function(R){console.warn("failed to set target frame rate of "+T+". Error info: "+R)})}}});function y(_,C){return _.groupOrder!==C.groupOrder?_.groupOrder-C.groupOrder:_.renderOrder!==C.renderOrder?_.renderOrder-C.renderOrder:_.z-C.z}function b(_,C){return _.groupOrder!==C.groupOrder?_.groupOrder-C.groupOrder:_.renderOrder-C.renderOrder}function v(_,C){return _.groupOrder!==C.groupOrder?_.groupOrder-C.groupOrder:_.renderOrder!==C.renderOrder?_.renderOrder-C.renderOrder:C.z-_.z}l.exports.sortFrontToBack=y,l.exports.sortRenderOrderOnly=b,l.exports.sortBackToFront=v},"./src/systems/shadow.js":(l,u,c)=>{var h=c("./src/core/system.js").registerSystem,p=c("./src/lib/three.js"),f={basic:p.BasicShadowMap,pcf:p.PCFShadowMap,pcfsoft:p.PCFSoftShadowMap};l.exports.System=h("shadow",{schema:{enabled:{default:!0},autoUpdate:{default:!0},type:{default:"pcf",oneOf:["basic","pcf","pcfsoft"]}},init:function(){var m=this.sceneEl,y=this.data;this.shadowMapEnabled=!1,m.renderer.shadowMap.type=f[y.type],m.renderer.shadowMap.autoUpdate=y.autoUpdate},update:function(m){m.enabled!==this.data.enabled&&this.setShadowMapEnabled(this.shadowMapEnabled)},setShadowMapEnabled:function(m){var y=this.sceneEl,b=this.sceneEl.renderer;this.shadowMapEnabled=m;var v=this.data.enabled&&this.shadowMapEnabled;b&&v!==b.shadowMap.enabled&&(b.shadowMap.enabled=v,g(y))}});function g(m){m.hasLoaded&&m.object3D.traverse(function(y){if(y.material)for(var b=Array.isArray(y.material)?y.material:[y.material],v=0;v<b.length;v++)b[v].needsUpdate=!0})}},"./src/systems/tracked-controls-webvr.js":(l,u,c)=>{var h=c("./src/core/system.js").registerSystem,p=c("./src/utils/index.js"),f=p.device.isWebXRAvailable;l.exports.System=h("tracked-controls-webvr",{init:function(){var g=this;this.controllers=[],this.isChrome=navigator.userAgent.indexOf("Chrome")!==-1,this.updateControllerList(),this.throttledUpdateControllerList=p.throttle(this.updateControllerList,500,this),!f&&navigator.getVRDisplays&&this.sceneEl.addEventListener("enter-vr",function(){navigator.getVRDisplays().then(function(m){m.length&&(g.vrDisplay=m[0])})})},tick:function(){this.isChrome?this.updateControllerList():this.throttledUpdateControllerList()},updateControllerList:function(){var g=this.controllers,m,y,b,v;if(y=navigator.getGamepads&&navigator.getGamepads(),!!y){for(v=g.length,g.length=0,b=0;b<y.length;++b)m=y[b],m&&m.pose&&g.push(m);g.length!==v&&this.el.emit("controllersupdated",void 0,!1)}}})},"./src/systems/tracked-controls-webxr.js":(l,u,c)=>{var h=c("./src/core/system.js").registerSystem,p=c("./src/utils/index.js");l.exports.System=h("tracked-controls-webxr",{init:function(){this.controllers=[],this.oldControllers=[],this.oldControllersLength=0,this.throttledUpdateControllerList=p.throttle(this.updateControllerList,500,this),this.updateReferenceSpace=this.updateReferenceSpace.bind(this),this.el.addEventListener("enter-vr",this.updateReferenceSpace),this.el.addEventListener("exit-vr",this.updateReferenceSpace)},tick:function(){this.throttledUpdateControllerList()},updateReferenceSpace:function(){var f=this,g=this.el.xrSession;if(!g){this.referenceSpace=void 0,this.controllers=[],this.oldControllersLength>0&&(this.oldControllersLength=0,this.el.emit("controllersupdated",void 0,!1));return}var m=f.el.sceneEl.systems.webxr.sessionReferenceSpaceType;g.requestReferenceSpace(m).then(function(y){f.referenceSpace=y}).catch(function(y){throw f.el.sceneEl.systems.webxr.warnIfFeatureNotRequested(m,'tracked-controls-webxr uses reference space "'+m+'".'),y})},updateControllerList:function(){var f=this.el.xrSession,g=this.oldControllers,m;if(!f){if(this.oldControllersLength===0)return;this.oldControllersLength=0,this.controllers=[],this.el.emit("controllersupdated",void 0,!1);return}if(f.inputSources){if(this.controllers=f.inputSources,this.oldControllersLength===this.controllers.length){var y=!0;for(m=0;m<this.controllers.length;++m)if(!(this.controllers[m]===g[m]&&this.controllers[m].gamepad===g[m].gamepad)){y=!1;break}if(y)return}for(g.length=0,m=0;m<this.controllers.length;m++)g.push(this.controllers[m]);this.oldControllersLength=this.controllers.length,this.el.emit("controllersupdated",void 0,!1)}}})},"./src/systems/webxr.js":(l,u,c)=>{var h=c("./src/core/system.js").registerSystem,p=c("./src/utils/index.js"),f=p.debug("systems:webxr:warn");l.exports.System=h("webxr",{schema:{referenceSpaceType:{type:"string",default:"local-floor"},requiredFeatures:{type:"array",default:["local-floor"]},optionalFeatures:{type:"array",default:["bounded-floor"]},overlayElement:{type:"selector"}},update:function(){var g=this.data;this.sessionConfiguration={requiredFeatures:g.requiredFeatures,optionalFeatures:g.optionalFeatures},this.sessionReferenceSpaceType=g.referenceSpaceType,g.overlayElement&&(g.overlayElement.classList.remove("a-dom-overlay"),g.optionalFeatures.includes("dom-overlay")||(g.optionalFeatures.push("dom-overlay"),this.el.setAttribute("webxr",g)),this.warnIfFeatureNotRequested("dom-overlay"),this.sessionConfiguration.domOverlay={root:g.overlayElement},g.overlayElement.classList.add("a-dom-overlay"))},wasFeatureRequested:function(g){return!!(g==="viewer"||g==="local"||this.sessionConfiguration.requiredFeatures.includes(g)||this.sessionConfiguration.optionalFeatures.includes(g))},warnIfFeatureNotRequested:function(g,m){if(!this.wasFeatureRequested(g)){var y='Please add the feature "'+g+`" to a-scene's webxr system options in requiredFeatures/optionalFeatures.`;f((m?m+" ":"")+y)}}})},"./src/utils/coordinates.js":(l,u,c)=>{var h=c("./src/utils/debug.js"),p=h("utils:coordinates:warn"),f=["x","y","z","w"],g=/^\s*((-?\d*\.{0,1}\d+(e-?\d+)?)\s+){2,3}(-?\d*\.{0,1}\d+(e-?\d+)?)\s*$/;l.exports.regex=g;var m=/\s+/g;function y(E,T,R){var B,I,D,L,O=R&&typeof R=="object"?R:{},F,q,H,G;if(E&&E instanceof Object)return F=E.x===void 0?T&&T.x:E.x,q=E.y===void 0?T&&T.y:E.y,H=E.z===void 0?T&&T.z:E.z,G=E.w===void 0?T&&T.w:E.w,F!=null&&(O.x=C(F)),q!=null&&(O.y=C(q)),H!=null&&(O.z=C(H)),G!=null&&(O.w=C(G)),O;if(E==null)return typeof T=="object"?Object.assign(O,T):T;for(B=E.trim().split(m),L=0;L<f.length;L++)if(D=f[L],B[L])O[D]=parseFloat(B[L],10);else{if(I=T&&T[D],I===void 0)continue;O[D]=C(I)}return O}l.exports.parse=y;function b(E){var T;return typeof E!="object"?E:(T=E.x+" "+E.y,E.z!=null&&(T+=" "+E.z),E.w!=null&&(T+=" "+E.w),T)}l.exports.stringify=b;function v(E,T){return typeof E!="object"||typeof T!="object"?E===T:E.x===T.x&&E.y===T.y&&E.z===T.z&&E.w===T.w}l.exports.equals=v;function _(E){return g.test(E)}l.exports.isCoordinates=_,l.exports.isCoordinate=function(E){return p("`AFRAME.utils.isCoordinate` has been renamed to `AFRAME.utils.isCoordinates`"),_(E)};function C(E){return E!=null&&E.constructor===String?parseFloat(E,10):E}l.exports.toVector3=function(E){return new THREE.Vector3(E.x,E.y,E.z)}},"./src/utils/debug.js":(l,u,c)=>{var h=c("./node_modules/debug/src/browser.js"),p=c("./src/utils/device.js").isBrowserEnvironment,f={colors:{debug:"gray",error:"red",info:"gray",warn:"orange"}};h.formatArgs=g;function g(_){if(_[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+_[0]+(this.useColors?"%c ":" "),!!this.useColors){this.color=y(this.namespace);var C="color: "+this.color;_.splice(1,0,C,"color: inherit");var E=0,T=0;_[0].replace(/%[a-zA-Z%]/g,function(R){R!=="%%"&&(E++,R==="%c"&&(T=E))}),_.splice(T,0,C)}}function m(_){var C=_.split(":");return C[C.length-1]}function y(_){var C=m(_),E=f.colors&&f.colors[C];return E||null}function b(){try{return window.localStorage}catch{}}var v=b();v&&(parseInt(v.logs,10)||v.logs==="true")?h.enable("*"):h.enable("*:error,*:info,*:warn"),p&&(window.logs=h),l.exports=h},"./src/utils/device.js":(l,u,c)=>{var h=c("./node_modules/debug/src/browser.js")("device:error"),p,f=!1,g=!1,m=l.exports.isWebXRAvailable=navigator.xr!==void 0;if(window.addEventListener("vrdisplayactivate",function(H){var G;m||(G=document.createElement("canvas"),p=H.display,G.getContext("webgl",{}),p.requestPresent([{source:G}]).then(function(){},function(){}))}),m){var y=function(){var H=document.querySelector("a-scene");if(!H){window.addEventListener("DOMContentLoaded",y);return}H.hasLoaded?H.components["xr-mode-ui"].updateEnterInterfaces():H.addEventListener("loaded",y)},b=function(H){h("WebXR session support error: "+H.message)};navigator.xr.isSessionSupported?(navigator.xr.isSessionSupported("immersive-vr").then(function(H){f=H,y()}).catch(b),navigator.xr.isSessionSupported("immersive-ar").then(function(H){g=H,y()}).catch(function(){})):navigator.xr.supportsSession?(navigator.xr.supportsSession("immersive-vr").then(function(){f=!0,y()}).catch(b),navigator.xr.supportsSession("immersive-ar").then(function(){g=!0,y()}).catch(function(){})):h("WebXR has neither isSessionSupported or supportsSession?!")}else navigator.getVRDisplays&&navigator.getVRDisplays().then(function(H){var G=document.querySelector("a-scene");p=H.length&&H[0],G&&G.emit("displayconnected",{vrDisplay:p})});function v(){return p}l.exports.getVRDisplay=v;function _(){return f||g||!!v()}l.exports.checkHeadsetConnected=_;function C(){return g}l.exports.checkARSupport=C;function E(){return f}l.exports.checkVRSupport=E;var T=function(){var H=!1;return function(G){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(G)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(G.substr(0,4)))&&(H=!0),(I()||R()||q())&&(H=!0),F()&&(H=!1)}(window.navigator.userAgent||window.navigator.vendor||window.opera),function(){return H}}();l.exports.isMobile=T;function R(H){var G=H||window.navigator.userAgent,J=/Nexus (7|9)|xoom|sch-i800|playbook|tablet|kindle/i.test(G);return J||B()}l.exports.isTablet=R;function B(H,G,J){var Q=H||window.navigator.userAgent,V=G||window.navigator.platform,z=J||window.navigator.maxTouchPoints||0;return(V==="iPad"||V==="MacIntel")&&z>0&&/Macintosh|Intel|iPad|ipad/i.test(Q)&&!window.MSStream}l.exports.isIpad=B;function I(){return/iPad|iPhone|iPod/.test(window.navigator.platform)}l.exports.isIOS=I;function D(){return!T()&&!F()&&window.orientation!==void 0}l.exports.isMobileDeviceRequestingDesktopSite=D;function L(){return/(OculusBrowser)/i.test(window.navigator.userAgent)}l.exports.isOculusBrowser=L;function O(){return/(Mobile VR)/i.test(window.navigator.userAgent)}l.exports.isFirefoxReality=O;function F(){return L()||O()}l.exports.isMobileVR=F;function q(){return/R7 Build/.test(window.navigator.userAgent)}l.exports.isR7=q,l.exports.isLandscape=function(){var H=window.orientation;return q()&&(H+=90),H===90||H===-90},l.exports.isBrowserEnvironment=typeof process>"u"||process.browser===!0,l.exports.isNodeEnvironment=!l.exports.isBrowserEnvironment},"./src/utils/entity.js":(l,u,c)=>{var h=c("./src/utils/split.js").split;function p(f,g){g=g||".";var m=h(f,g);return m.length===1?m[0]:m}l.exports.getComponentPropertyPath=p,l.exports.getComponentProperty=function(f,g,m){var y;return m=m||".",g.indexOf(m)!==-1?(y=p(g,m),y.constructor===String?f.getAttribute(y):f.getAttribute(y[0])[y[1]]):f.getAttribute(g)},l.exports.setComponentProperty=function(f,g,m,y){var b;if(y=y||".",g.indexOf(y)!==-1){b=p(g,y),b.constructor===String?f.setAttribute(b,m):f.setAttribute(b[0],b[1],m);return}f.setAttribute(g,m)}},"./src/utils/forceCanvasResizeSafariMobile.js":l=>{l.exports=function(u){var c=u.style.width,h=u.style.height;u.style.width=parseInt(c,10)+1+"px",u.style.height=parseInt(h,10)+1+"px",setTimeout(function(){u.style.width=c,u.style.height=h},200)}},"./src/utils/index.js":(l,u,c)=>{var h=c("./src/utils/debug.js"),p=c("./node_modules/deep-assign/index.js"),f=c("./src/utils/device.js"),g=c("./src/utils/object-pool.js"),m=h("utils:warn");l.exports.bind=function(b){return b.bind.apply(b,Array.prototype.slice.call(arguments,1))},l.exports.coordinates=c("./src/utils/coordinates.js"),l.exports.debug=h,l.exports.device=f,l.exports.entity=c("./src/utils/entity.js"),l.exports.forceCanvasResizeSafariMobile=c("./src/utils/forceCanvasResizeSafariMobile.js"),l.exports.material=c("./src/utils/material.js"),l.exports.objectPool=g,l.exports.split=c("./src/utils/split.js").split,l.exports.styleParser=c("./src/utils/styleParser.js"),l.exports.trackedControls=c("./src/utils/tracked-controls.js"),l.exports.checkHeadsetConnected=function(){return m("`utils.checkHeadsetConnected` has moved to `utils.device.checkHeadsetConnected`"),f.checkHeadsetConnected(arguments)},l.exports.isGearVR=l.exports.device.isGearVR=function(){m("`utils.isGearVR` has been deprecated, use `utils.device.isMobileVR`")},l.exports.isIOS=function(){return m("`utils.isIOS` has moved to `utils.device.isIOS`"),f.isIOS(arguments)},l.exports.isOculusGo=l.exports.device.isOculusGo=function(){m("`utils.isOculusGo` has been deprecated, use `utils.device.isMobileVR`")},l.exports.isMobile=function(){return m("`utils.isMobile has moved to `utils.device.isMobile`"),f.isMobile(arguments)},l.exports.throttle=function(b,v,_){var C;return _&&(b=b.bind(_)),function(){var E=Date.now(),T=typeof C>"u"?v:E-C;(typeof C>"u"||T>=v)&&(C=E,b.apply(null,arguments))}},l.exports.throttleLeadingAndTrailing=function(b,v,_){var C,E;_&&(b=b.bind(_));var T,R=function(){C=Date.now(),b.apply(this,T),E=void 0};return function(){var B=Date.now(),I=typeof C>"u"?v:B-C;I>=v?(clearTimeout(E),E=void 0,C=B,b.apply(null,arguments)):(E=E||setTimeout(R,v-I),T=arguments)}},l.exports.throttleTick=function(b,v,_){var C;return _&&(b=b.bind(_)),function(E,T){var R=typeof C>"u"?T:E-C;(typeof C>"u"||R>=v)&&(C=E,b(E,R))}},l.exports.debounce=function(b,v,_){var C;return function(){var E=this,T=arguments,R=function(){C=null,_||b.apply(E,T)},B=_&&!C;clearTimeout(C),C=setTimeout(R,v),B&&b.apply(E,T)}},l.exports.extend=Object.assign,l.exports.extendDeep=p,l.exports.clone=function(b){return JSON.parse(JSON.stringify(b))};var y=function(){var b=g.createPool(function(){return[]});return function(v,_){var C,E,T,R,B,I;if(v===void 0||_===void 0||v===null||_===null||!(v&&_&&v.constructor===Object&&_.constructor===Object||v.constructor===Array&&_.constructor===Array))return v===_;E=b.use(),T=b.use(),E.length=0,T.length=0;for(C in v)E.push(C);for(C in _)T.push(C);if(E.length!==T.length)return b.recycle(E),b.recycle(T),!1;for(R=0;R<E.length;++R)if(B=v[E[R]],I=_[E[R]],typeof B=="object"||typeof I=="object"||Array.isArray(B)&&Array.isArray(I)){if(B===I)continue;if(!y(B,I))return b.recycle(E),b.recycle(T),!1}else if(B!==I)return b.recycle(E),b.recycle(T),!1;return b.recycle(E),b.recycle(T),!0}}();l.exports.deepEqual=y,l.exports.diff=function(){var b=[];return function(v,_,C){var E,T,R,B,I,D,L;B=C||{},b.length=0;for(I in v)b.push(I);if(!_)return B;for(R in _)b.indexOf(R)===-1&&b.push(R);for(D=0;D<b.length;D++)I=b[D],E=v[I],T=_[I],L=E&&T&&E.constructor===Object&&T.constructor===Object,(L&&!y(E,T)||!L&&E!==T)&&(B[I]=T);return B}}(),l.exports.shouldCaptureKeyEvent=function(b){return b.metaKey?!1:document.activeElement===document.body},l.exports.splitString=function(b,v){typeof v>"u"&&(v=" ");var _=new RegExp(v,"g");return b=(b||"").replace(_,v),b.split(v)},l.exports.getElData=function(b,v){v=v||{};var _={};Object.keys(v).forEach(C);function C(E){b.hasAttribute(E)&&(_[E]=b.getAttribute(E))}return _},l.exports.getUrlParameter=function(b){b=b.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var v=new RegExp("[\\?&]"+b+"=([^&#]*)"),_=v.exec(location.search);return _===null?"":decodeURIComponent(_[1].replace(/\+/g," "))},l.exports.isIframed=function(){return window.top!==window.self},l.exports.findAllScenes=function(b){for(var v=[],_=b.getElementsByTagName("*"),C=0,E=_.length;C<E;C++)_[C].isScene&&v.push(_[C]);return v},l.exports.srcLoader=c("./src/utils/src-loader.js")},"./src/utils/ios-orientationchange-blank-bug.js":()=>{window.addEventListener("orientationchange",function(){document.documentElement.style.height="initial",setTimeout(function(){document.documentElement.style.height="100%",setTimeout(function(){window.scrollTo(0,1)},500)},500)})},"./src/utils/isIOSOlderThan10.js":l=>{l.exports=function(u){return/(iphone|ipod|ipad).*os.(7_|8_|9_)/i.test(u)}},"./src/utils/material.js":(l,u,c)=>{var h=c("./src/lib/three.js"),p=c("./src/utils/src-loader.js"),f=c("./src/utils/debug.js"),g=f("utils:material:warn"),m=new Set(["emissiveMap","envMap","map","specularMap"]);function y(E,T){var R=T.offset||{x:0,y:0},B=T.repeat||{x:1,y:1},I=T.npot||!1,D=T.anisotropy||h.Texture.DEFAULT_ANISOTROPY,L=E.wrapS,O=E.wrapT,F=E.magFilter,q=E.minFilter;I&&(L=h.ClampToEdgeWrapping,O=h.ClampToEdgeWrapping,F=h.LinearFilter,q=h.LinearFilter),(B.x!==1||B.y!==1)&&(L=h.RepeatWrapping,O=h.RepeatWrapping),E.offset.set(R.x,R.y),E.repeat.set(B.x,B.y),(E.wrapS!==L||E.wrapT!==O||E.magFilter!==F||E.minFilter!==q||E.anisotropy!==D)&&(E.wrapS=L,E.wrapT=O,E.magFilter=F,E.minFilter=q,E.anisotropy=D,E.needsUpdate=!0)}l.exports.setTextureProperties=y,l.exports.updateMapMaterialFromData=function(E,T,R,B){var I=R.el,D=R.material,L=I.sceneEl.systems.renderer,O=B[T];if(R.materialSrcs||(R.materialSrcs={}),!O){delete R.materialSrcs[E],q(null);return}if(O===R.materialSrcs[E]&&D[E]){y(D[E],B);return}R.materialSrcs[E]=O,O instanceof h.Texture?q(O):I.sceneEl.systems.material.loadTextureSource(O,F);function F(H){if(R.materialSrcs[E]===O){var G=D[E];G&&(H===null||!_(G,H))&&(G=null),!G&&H&&(G=C(H)),G&&(G.source!==H&&(G.source=H,G.needsUpdate=!0),m.has(E)&&L.applyColorCorrection(G),y(G,B)),q(G)}}function q(H){D[E]!==H&&(D[E]&&D[E].dispose(),D[E]=H,D.needsUpdate=!0,v(I,H))}},l.exports.updateMap=function(E,T){return l.exports.updateMapMaterialFromData("map","src",E,T)},l.exports.updateDistortionMap=function(E,T,R){var B=E;E==="ambientOcclusion"&&(B="ao");var I={};return I.src=R[E+"Map"],I.offset=R[E+"TextureOffset"],I.repeat=R[E+"TextureRepeat"],I.wrap=R[E+"TextureWrap"],l.exports.updateMapMaterialFromData(B+"Map","src",T,I)};var b={};l.exports.updateEnvMap=function(E,T){var R=E.material,B=E.el,I="envMap",D=T.envMap,L=T.sphericalEnvMap,O=T.refract;if(L&&(D=L,g("`sphericalEnvMap` property is deprecated, using spherical map as equirectangular map instead. Use `envMap` property with a CubeMap or Equirectangular image instead.")),E.materialSrcs||(E.materialSrcs={}),!D){delete E.materialSrcs[I],R.envMap=null,R.needsUpdate=!0;return}if(E.materialSrcs[I]=D,b[D]){b[D].then(F);return}b[D]=new Promise(function(q){p.validateEnvMapSrc(D,function(H){B.sceneEl.systems.material.loadCubeMapTexture(H,function(G){G.mapping=O?h.CubeRefractionMapping:h.CubeReflectionMapping,F(G),q(G)})},function(H){B.sceneEl.systems.material.loadTexture(H,{src:H},function(G){G.mapping=O?h.EquirectangularRefractionMapping:h.EquirectangularReflectionMapping,F(G),q(G)})})});function F(q){E.materialSrcs[I]===D&&(R.envMap=q,R.needsUpdate=!0,v(B,q))}};function v(E,T){if(!T||(E.emit("materialtextureloaded",{src:T.image,texture:T}),!T.image||T.image.tagName!=="VIDEO"))return;T.image.addEventListener("loadeddata",R),T.image.addEventListener("ended",B);function R(){E.emit("materialvideoloadeddata",{src:T.image,texture:T})}function B(){E.emit("materialvideoended",{src:T.image,texture:T})}T.addEventListener("dispose",function(){T.image.removeEventListener("loadeddata",R),T.image.removeEventListener("ended",B)})}l.exports.handleTextureEvents=v;function _(E,T){return T.data instanceof HTMLCanvasElement?E.isCanvasTexture:T.data instanceof HTMLVideoElement?E.isVideoTexture&&E.source===T:E.isTexture&&!E.isCanvasTexture&&!E.isVideoTexture}l.exports.isCompatibleTexture=_;function C(E){var T;return E.data instanceof HTMLCanvasElement?T=new h.CanvasTexture:E.data instanceof HTMLVideoElement?T=new h.VideoTexture(E.data):T=new h.Texture,T.source=E,T.needsUpdate=!0,T}l.exports.createCompatibleTexture=C},"./src/utils/math.js":l=>{function u(h,p,f){var g=p.dot(h);return(g-p.dot(f))/p.length()}function c(h,p,f,g){var m=u(h,p,f);return g.copy(p),g.multiplyScalar(m),g.add(f),g}l.exports.distanceOfPointFromPlane=u,l.exports.nearestPointInPlane=c},"./src/utils/object-pool.js":l=>{var u=Object.freeze(Object.create(null));function c(){return{}}l.exports.createPool=function(f){var g=[],m=null;f=f||c;function y(){var C;return(m===null||m===g.length)&&v(g.length||5),C=g[m],g[m++]=u,h(C),C}function b(C){if(C instanceof Object){if(m===null||m===-1){g[g.length]=C;return}g[--m]=C}}function v(C){var E,T;if(C=C===void 0?g.length:C,C>0&&m==null&&(m=0),C>0)for(E=g.length,g.length+=Number(C),T=E;T<g.length;T++)g[T]=f();return g.length}function _(){return g.length}return{grow:v,pool:g,recycle:b,size:_,use:y}};function h(f){var g;if(!(!f||f.constructor!==Object))for(g in f)f[g]=void 0}l.exports.clearObject=h;function p(f,g){var m;if(!(!f||f.constructor!==Object))for(m in f)m in g||delete f[m]}l.exports.removeUnusedKeys=p},"./src/utils/split.js":l=>{l.exports.split=function(){var u={};return function(c,h){return h in u||(u[h]={}),c in u[h]||(u[h][c]=c.split(h)),u[h][c]}}()},"./src/utils/src-loader.js":(l,u,c)=>{var h=c("./src/utils/debug.js"),p=h("utils:src-loader:warn");function f(C,E,T){b(C,function(R){if(R){E(C);return}T(C)})}function g(C,E,T){var R,B="",I,D,L=[];if(typeof C=="string"){let F=function(q){L.push(q),L.length===6&&E(L)};for(I=0;I<5;I++)B+="(url\\((?:[^\\)]+)\\),\\s*)";if(B+="(url\\((?:[^\\)]+)\\)\\s*)",D=C.match(new RegExp(B)),D){for(I=1;I<7;I++)f(y(D[I]),F);return}if(!C.startsWith("#")){var O=y(C);f(O||C,T);return}}if(C.tagName?R=C:R=_(C),!!R){if(R.tagName==="A-CUBEMAP"&&R.srcs)return E(R.srcs);if(R.tagName==="IMG")return T(R);p('Selector "%s" does not point to <a-cubemap> or <img>',C)}}function m(C,E){return g(C,E,function(){p("Expected cubemap but got image")})}function y(C){var E=C.match(/url\((.+)\)/);if(E)return E[1]}function b(C,E){var T;if(C.tagName){E(C.tagName==="IMG");return}T=new XMLHttpRequest,T.open("HEAD",C),T.addEventListener("load",function(R){var B;T.status>=200&&T.status<300?(B=T.getResponseHeader("Content-Type"),B==null?v(C,E):B.startsWith("image")?E(!0):E(!1)):v(C,E),T.abort()}),T.send()}function v(C,E){var T=new Image;T.addEventListener("load",R);function R(){E(!0)}T.addEventListener("error",B);function B(){E(!1)}T.src=C}function _(C){try{var E=document.querySelector(C);return E||p('No element was found matching the selector: "%s"',C),E}catch{p('"%s" is not a valid selector',C);return}}l.exports={parseUrl:y,validateSrc:f,validateCubemapSrc:m,validateEnvMapSrc:g}},"./src/utils/styleParser.js":l=>{var u=/-([a-z])/g;l.exports.parse=function(m,y){var b;return typeof m!="string"||(b=p(m,y),b[""])?m:b},l.exports.stringify=function(m){return typeof m=="string"?m:f(m)};function c(m){return m.replace(u,g)}l.exports.toCamelCase=c;var h=function(){var m=[],y=/url\([^)]+$/;return function(b){var v="",_,C=0,E=";";for(m.length=0;C<b.length;){if(_=b.indexOf(E,C),_===-1&&(_=b.length),v+=b.substring(C,_),y.test(v)){v+=";",C=_+1;continue}m.push(v.trim()),v="",C=_+1}return m}}();function p(m,y){var b,v,_,C,E,T;for(y=y||{},b=h(m),v=0;v<b.length;v++)_=b[v],_&&(C=_.indexOf(":"),E=_.substr(0,C).trim(),T=_.substr(C+1).trim(),y[c(E)]=T);return y}function f(m){var y,b=0,v=0,_="";for(y in m)b++;for(y in m)_+=y+": "+m[y],v<b-1&&(_+="; "),v++;return _}function g(m){return m[1].toUpperCase()}},"./src/utils/tracked-controls.js":(l,u,c)=>{var h=c("./src/constants/index.js").DEFAULT_HANDEDNESS,p=["x","y","z","w"],f=2;l.exports.checkControllerPresentAndSetup=function(v,_,C){var E=v.el,T,R=E.sceneEl.hasWebXR,B=R?m:g,I;if(T=B(v,_,C),I=!!T,v.controllerPresent&&!v.controllerEventsActive&&!R&&v.addEventListeners(),I===v.controllerPresent)return I;v.controllerPresent=I,I?(v.addEventListeners(),v.injectTrackedControls(T),E.emit("controllerconnected",{name:v.name,component:v})):(v.removeEventListeners(),E.emit("controllerdisconnected",{name:v.name,component:v}))};function g(v,_,C){var E,T=v.el.sceneEl,R,B=C.index||0;return!_||(R=T&&T.systems["tracked-controls-webvr"],!R)||(E=R.controllers,!E.length)?!1:!!y(E,null,_,C.hand,B)}function m(v,_,C){var E,T=v.el.sceneEl,R=T&&T.systems["tracked-controls-webxr"];return!R||(E=R.controllers,!E||!E.length)?!1:b(E,_,C.hand,C.index,C.iterateControllerProfiles,C.handTracking)}l.exports.isControllerPresentWebVR=g,l.exports.isControllerPresentWebXR=m;function y(v,_,C,E,T){var R,B,I=0,D=T>=0?T:0;for(B=0;B<v.length;B++)if(R=v[B],!(C&&!R.id.startsWith(C))&&!(!C&&R.id!==_)&&!(E&&R.hand&&E!==R.hand)){if(E&&!R.hand)D=f*T+(E===h?0:1);else return R;if(I===D)return R;++I}}function b(v,_,C,E,T,R){var B,I,D,L=!1,O,F;for(B=0;B<v.length;B++){if(D=v[B],F=D.profiles,R)L=D.hand;else if(T)for(I=0;I<F.length&&(L=F[I].startsWith(_),!L);I++);else L=F.length>0&&F[0].startsWith(_);if(L){if(O=D.handedness==="right"||D.handedness==="left",O){if(D.handedness===C)return v[B]}else if(B===E)return v[B]}}}l.exports.findMatchingControllerWebVR=y,l.exports.findMatchingControllerWebXR=b,l.exports.emitIfAxesChanged=function(v,_,C){var E,T,R,B,I;for(T in _){for(E=_[T],R=!1,I=0;I<E.length;I++)C.detail.changed[E[I]]&&(R=!0);if(R){for(B={},I=0;I<E.length;I++)B[p[I]]=C.detail.axis[E[I]];v.el.emit(T+"moved",B)}}},l.exports.onButtonEvent=function(v,_,C,E){var T=E?C.mapping[E]:C.mapping,R=T.buttons[v];C.el.emit(R+_),C.updateModel&&C.updateModel(R,_)}},"./vendor/DeviceOrientationControls.js":()=>{THREE.DeviceOrientationControls=function(l){var u=this;this.object=l,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0,this.alphaOffset=0;var c=function(f){u.deviceOrientation=f},h=function(){u.screenOrientation=window.orientation||0},p=function(){var f=new THREE.Vector3(0,0,1),g=new THREE.Euler,m=new THREE.Quaternion,y=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5));return function(b,v,_,C,E){g.set(_,v,-C,"YXZ"),b.setFromEuler(g),b.multiply(y),b.multiply(m.setFromAxisAngle(f,-E))}}();this.connect=function(){h(),window.addEventListener("orientationchange",h,!1),window.addEventListener("deviceorientation",c,!1),u.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",h,!1),window.removeEventListener("deviceorientation",c,!1),u.enabled=!1},this.update=function(){if(u.enabled!==!1){var f=u.deviceOrientation;if(f){var g=f.alpha?THREE.MathUtils.degToRad(f.alpha)+u.alphaOffset:0,m=f.beta?THREE.MathUtils.degToRad(f.beta):0,y=f.gamma?THREE.MathUtils.degToRad(f.gamma):0,b=u.screenOrientation?THREE.MathUtils.degToRad(u.screenOrientation):0;p(u.object.quaternion,g,m,y,b)}}},this.dispose=function(){u.disconnect()},this.connect()}},"./vendor/rStats.extras.js":l=>{window.glStats=function(){var u=null,c=0,h=0,p=0,f=0,g=0,m=0,y=0;function b(I,D){return function(){D.apply(this,arguments),I.apply(this,arguments)}}WebGLRenderingContext.prototype.drawArrays=b(WebGLRenderingContext.prototype.drawArrays,function(){c++,arguments[0]==this.POINTS?m+=arguments[2]:g+=arguments[2]}),WebGLRenderingContext.prototype.drawElements=b(WebGLRenderingContext.prototype.drawElements,function(){h++,f+=arguments[1]/3,g+=arguments[1]}),WebGLRenderingContext.prototype.useProgram=b(WebGLRenderingContext.prototype.useProgram,function(){p++}),WebGLRenderingContext.prototype.bindTexture=b(WebGLRenderingContext.prototype.bindTexture,function(){y++});var v={allcalls:{over:3e3,caption:"Calls (hook)"},drawelements:{caption:"drawElements (hook)"},drawarrays:{caption:"drawArrays (hook)"}},_=[{caption:"WebGL",values:["allcalls","drawelements","drawarrays","useprogram","bindtexture","glfaces","glvertices","glpoints"]}],C=[{base:"allcalls",steps:["drawelements","drawarrays"]}];function E(){u("allcalls").set(c+h),u("drawElements").set(h),u("drawArrays").set(c),u("bindTexture").set(y),u("useProgram").set(p),u("glfaces").set(f),u("glvertices").set(g),u("glpoints").set(m)}function T(){c=0,h=0,p=0,f=0,g=0,m=0,y=0}function R(){}function B(I){u=I}return{update:E,start:T,end:R,attach:B,values:v,groups:_,fractions:C}},window.threeStats=function(u){var c=null,h={"renderer.info.memory.geometries":{caption:"Geometries"},"renderer.info.memory.textures":{caption:"Textures"},"renderer.info.programs":{caption:"Programs"},"renderer.info.render.calls":{caption:"Calls"},"renderer.info.render.triangles":{caption:"Triangles",over:1e3},"renderer.info.render.points":{caption:"Points"}},p=[{caption:"Three.js - Memory",values:["renderer.info.memory.geometries","renderer.info.programs","renderer.info.memory.textures"]},{caption:"Three.js - Render",values:["renderer.info.render.calls","renderer.info.render.triangles","renderer.info.render.points"]}],f=[];function g(){c("renderer.info.memory.geometries").set(u.info.memory.geometries),c("renderer.info.programs").set(u.info.programs.length),c("renderer.info.memory.textures").set(u.info.memory.textures),c("renderer.info.render.calls").set(u.info.render.calls),c("renderer.info.render.triangles").set(u.info.render.triangles),c("renderer.info.render.points").set(u.info.render.points)}function m(){}function y(){}function b(v){c=v}return{update:g,start:m,end:y,attach:b,values:h,groups:p,fractions:f}},window.BrowserStats=function(){var u=null,c=0,h=0;window.performance&&!performance.memory&&(performance.memory={usedJSHeapSize:0,totalJSHeapSize:0}),performance.memory.totalJSHeapSize===0&&console.warn("totalJSHeapSize === 0... performance.memory is only available in Chrome .");var p={memory:{caption:"Used Memory",average:!0,avgMs:1e3,over:22},total:{caption:"Total Memory"}},f=[{caption:"Browser",values:["memory","total"]}],g=[{base:"total",steps:["memory"]}],m=Math.log(1024);function y(E){var T=100,R=Math.floor(Math.log(E)/m);return Math.round(E*T/Math.pow(1024,R))/T}function b(){c=y(performance.memory.usedJSHeapSize),h=y(performance.memory.totalJSHeapSize),u("memory").set(c),u("total").set(h)}function v(){c=0}function _(){}function C(E){u=E}return{update:b,start:v,end:_,attach:C,values:p,groups:f,fractions:g}},l.exports={glStats:window.glStats,threeStats:window.threeStats,BrowserStats:window.BrowserStats}},"./vendor/rStats.js":l=>{(function(){"performance"in window||(window.performance={});var u=window.performance;if(!("now"in u)){var c=Date.now();u.timing&&u.timing.navigationStart&&(c=u.timing.navigationStart),u.now=function(){return Date.now()-c}}u.mark||(u.mark=function(){}),u.measure||(u.measure=function(){})})(),window.rStats=function(u){function c(O,F){for(var q=Object.keys(O),H=0,G=q.length;H<G;H++)F(q[H])}function h(O){var F=document.createElement("link");F.href=O,F.rel="stylesheet",F.type="text/css",document.getElementsByTagName("head")[0].appendChild(F)}var p=u||{},f=p.colours||["#850700","#c74900","#fcb300","#284280","#4c7c0c"],g="https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700,300",m=(p.CSSPath?p.CSSPath:"")+"rStats.css",y=p.css||[g,m];y.forEach(function(O){h(O)}),p.values||(p.values={});var b,v,_=10,C=200,E={};function T(O,F,q){var H=q||{},G=document.createElement("canvas"),J=G.getContext("2d"),Q=0,V=0,z=H.color?H.color:"#666666",te=document.createElement("canvas"),K=te.getContext("2d");te.width=1,te.height=2*_,K.fillStyle="#444444",K.fillRect(0,0,1,2*_),K.fillStyle=z,K.fillRect(0,_,1,_),K.fillStyle="#ffffff",K.globalAlpha=.5,K.fillRect(0,_,1,1),K.globalAlpha=1;var ae=document.createElement("canvas"),Ae=ae.getContext("2d");ae.width=1,ae.height=2*_,Ae.fillStyle="#444444",Ae.fillRect(0,0,1,2*_),Ae.fillStyle="#b70000",Ae.fillRect(0,_,1,_),Ae.globalAlpha=.5,Ae.fillStyle="#ffffff",Ae.fillRect(0,_,1,1),Ae.globalAlpha=1;function _e(){G.width=C,G.height=_,G.style.width=G.width+"px",G.style.height=G.height+"px",G.className="rs-canvas",O.appendChild(G),J.fillStyle="#444444",J.fillRect(0,0,G.width,G.height)}function me(Pe,Xe){V+=(Pe-V)*.1,Q*=.99,V>Q&&(Q=V),J.drawImage(G,1,0,G.width-1,G.height,0,0,G.width-1,G.height),Xe?J.drawImage(ae,G.width-1,G.height-V*G.height/Q-_):J.drawImage(te,G.width-1,G.height-V*G.height/Q-_)}return _e(),{draw:me}}function R(O,F){var q=document.createElement("canvas"),H=q.getContext("2d");function G(){q.width=C,q.height=_*F,q.style.width=q.width+"px",q.style.height=q.height+"px",q.className="rs-canvas",O.appendChild(q),H.fillStyle="#444444",H.fillRect(0,0,q.width,q.height)}function J(Q){H.drawImage(q,1,0,q.width-1,q.height,0,0,q.width-1,q.height);var V=0;c(Q,function(z){var te=Q[z]*q.height;H.fillStyle=f[z],H.fillRect(q.width-1,V,1,te),V+=te})}return G(),{draw:J}}function B(O,F){var q=O,H,G=0,J=0,Q=0,V=0,z=performance.now(),te=0,K=document.createElement("div"),ae=document.createElement("span"),Ae=document.createElement("div"),_e=document.createTextNode(""),me=p?p.values[q.toLowerCase()]:null,Pe=new T(K,q,me),Xe=!1;ae.className="rs-counter-id",ae.textContent=me&&me.caption?me.caption:q,Ae.className="rs-counter-value",Ae.appendChild(_e),K.appendChild(ae),K.appendChild(Ae),F?F.div.appendChild(K):v.appendChild(K),H=performance.now();function Je($e){if(me&&me.average){V+=$e,te++;var Ui=performance.now();Ui-z>=(me.avgMs||1e3)&&(Q=V/te,V=0,z=Ui,te=0)}}function tt(){H=performance.now(),p.userTimingAPI&&performance.mark(q+"-start"),Xe=!0}function dt(){G=performance.now()-H,p.userTimingAPI&&(performance.mark(q+"-end"),Xe&&performance.measure(q,q+"-start",q+"-end")),Je(G)}function wt(){dt(),tt()}function qt(){var $e=me&&me.average?Q:G;_e.nodeValue=Math.round($e*100)/100;var Ui=me&&(me.below&&G<me.below||me.over&&G>me.over);Pe.draw(G,Ui),K.className=Ui?"rs-counter-base alarm":"rs-counter-base"}function yt(){var $e=performance.now(),Ui=$e-H;J++,Ui>1e3&&(me&&me.interpolate===!1?G=J:G=J*1e3/Ui,J=0,H=$e,Je(G))}function Ei($e){G=$e,Je(G)}return{set:Ei,start:tt,tick:wt,end:dt,frame:yt,value:function(){return G},draw:qt}}function I(O){var F=O.toLowerCase();if(F===void 0&&(F="default"),E[F])return E[F];var q=null;p&&p.groups&&c(p.groups,function(G){var J=p.groups[parseInt(G,10)];!q&&J.values.indexOf(F.toLowerCase())!==-1&&(q=J)});var H=new B(F,q);return E[F]=H,H}function D(){if(p.plugins){p.values||(p.values={}),p.groups||(p.groups=[]),p.fractions||(p.fractions=[]);for(var O=0;O<p.plugins.length;O++)p.plugins[O].attach(I),c(p.plugins[O].values,function(F){p.values[F]=p.plugins[O].values[F]}),p.groups=p.groups.concat(p.plugins[O].groups),p.fractions=p.fractions.concat(p.plugins[O].fractions)}else p.plugins={};b=document.createElement("div"),b.className="rs-base",v=document.createElement("div"),v.className="rs-container",v.style.height="auto",b.appendChild(v),document.body.appendChild(b),p&&(p.groups&&c(p.groups,function(F){var q=p.groups[parseInt(F,10)],H=document.createElement("div");H.className="rs-group",q.div=H;var G=document.createElement("h1");G.textContent=q.caption,G.addEventListener("click",(function(J){this.classList.toggle("hidden"),J.preventDefault()}).bind(H)),v.appendChild(G),v.appendChild(H)}),p.fractions&&c(p.fractions,function(F){var q=p.fractions[parseInt(F,10)],H=document.createElement("div");H.className="rs-fraction";var G=document.createElement("div");G.className="rs-legend";var J=0;c(p.fractions[F].steps,function(V){var z=document.createElement("p");z.textContent=p.fractions[F].steps[V],z.style.color=f[J],G.appendChild(z),J++}),H.appendChild(G),H.style.height=J*_+"px",q.div=H;var Q=new R(H,J);q.graph=Q,v.appendChild(H)}))}function L(){c(p.plugins,function(O){p.plugins[O].update()}),c(E,function(O){E[O].draw()}),p&&p.fractions&&c(p.fractions,function(O){var F=p.fractions[parseInt(O,10)],q=[],H=E[F.base.toLowerCase()];H&&(H=H.value(),c(p.fractions[O].steps,function(G){var J=p.fractions[O].steps[parseInt(G,10)].toLowerCase(),Q=E[J];Q&&q.push(Q.value()/H)})),F.graph.draw(q)})}return D(),function(O){return O?I(O):{element:b,update:L}}},l.exports=window.rStats},"./vendor/wakelock/util.js":l=>{var u={};u.base64=function(c,h){return"data:"+c+";base64,"+h},u.isMobile=function(){var c=!1;return function(h){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(h)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(h.substr(0,4)))&&(c=!0)}(navigator.userAgent||navigator.vendor||window.opera),c},u.isIOS=function(){return/(iPad|iPhone|iPod)/g.test(navigator.userAgent)},u.isIFrame=function(){try{return window.self!==window.top}catch{return!0}},u.appendQueryParameter=function(c,h,p){var f=c.indexOf("?")<0?"?":"&";return c+=f+h+"="+p,c},u.getQueryParameter=function(c){c=c.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var h=new RegExp("[\\?&]"+c+"=([^&#]*)"),p=h.exec(location.search);return p===null?"":decodeURIComponent(p[1].replace(/\+/g," "))},u.isLandscapeMode=function(){return window.orientation==90||window.orientation==-90},l.exports=u},"./vendor/wakelock/wakelock.js":(l,u,c)=>{var h=c("./vendor/wakelock/util.js");function p(){var m=document.createElement("video");m.addEventListener("ended",function(){m.play()}),this.request=function(){m.paused&&(m.src=h.base64("video/webm","GkXfowEAAAAAAAAfQoaBAUL3gQFC8oEEQvOBCEKChHdlYm1Ch4ECQoWBAhhTgGcBAAAAAAAH4xFNm3RALE27i1OrhBVJqWZTrIHfTbuMU6uEFlSua1OsggEwTbuMU6uEHFO7a1OsggfG7AEAAAAAAACkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmAQAAAAAAAEUq17GDD0JATYCNTGF2ZjU2LjQwLjEwMVdBjUxhdmY1Ni40MC4xMDFzpJAGSJTMbsLpDt/ySkipgX1fRImIQO1MAAAAAAAWVK5rAQAAAAAAADuuAQAAAAAAADLXgQFzxYEBnIEAIrWcg3VuZIaFVl9WUDmDgQEj44OEO5rKAOABAAAAAAAABrCBsLqBkB9DtnUBAAAAAAAAo+eBAKOmgQAAgKJJg0IAAV4BHsAHBIODCoAACmH2MAAAZxgz4dPSTFi5JACjloED6ACmAECSnABMQAADYAAAWi0quoCjloEH0ACmAECSnABNwAADYAAAWi0quoCjloELuACmAECSnABNgAADYAAAWi0quoCjloEPoACmAECSnABNYAADYAAAWi0quoCjloETiACmAECSnABNIAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTnghdwo5aBAAAApgBAkpwATOAAA2AAAFotKrqAo5aBA+gApgBAkpwATMAAA2AAAFotKrqAo5aBB9AApgBAkpwATIAAA2AAAFotKrqAo5aBC7gApgBAkpwATEAAA2AAAFotKrqAo5aBD6AApgDAkpwAQ2AAA2AAAFotKrqAo5aBE4gApgBAkpwATCAAA2AAAFotKrqAH0O2dQEAAAAAAACU54Iu4KOWgQAAAKYAQJKcAEvAAANgAABaLSq6gKOWgQPoAKYAQJKcAEtgAANgAABaLSq6gKOWgQfQAKYAQJKcAEsAAANgAABaLSq6gKOWgQu4AKYAQJKcAEqAAANgAABaLSq6gKOWgQ+gAKYAQJKcAEogAANgAABaLSq6gKOWgROIAKYAQJKcAEnAAANgAABaLSq6gB9DtnUBAAAAAAAAlOeCRlCjloEAAACmAECSnABJgAADYAAAWi0quoCjloED6ACmAECSnABJIAADYAAAWi0quoCjloEH0ACmAMCSnABDYAADYAAAWi0quoCjloELuACmAECSnABI4AADYAAAWi0quoCjloEPoACmAECSnABIoAADYAAAWi0quoCjloETiACmAECSnABIYAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTngl3Ao5aBAAAApgBAkpwASCAAA2AAAFotKrqAo5aBA+gApgBAkpwASAAAA2AAAFotKrqAo5aBB9AApgBAkpwAR8AAA2AAAFotKrqAo5aBC7gApgBAkpwAR4AAA2AAAFotKrqAo5aBD6AApgBAkpwAR2AAA2AAAFotKrqAo5aBE4gApgBAkpwARyAAA2AAAFotKrqAH0O2dQEAAAAAAACU54J1MKOWgQAAAKYAwJKcAENgAANgAABaLSq6gKOWgQPoAKYAQJKcAEbgAANgAABaLSq6gKOWgQfQAKYAQJKcAEagAANgAABaLSq6gKOWgQu4AKYAQJKcAEaAAANgAABaLSq6gKOWgQ+gAKYAQJKcAEZAAANgAABaLSq6gKOWgROIAKYAQJKcAEYAAANgAABaLSq6gB9DtnUBAAAAAAAAlOeCjKCjloEAAACmAECSnABF4AADYAAAWi0quoCjloED6ACmAECSnABFwAADYAAAWi0quoCjloEH0ACmAECSnABFoAADYAAAWi0quoCjloELuACmAECSnABFgAADYAAAWi0quoCjloEPoACmAMCSnABDYAADYAAAWi0quoCjloETiACmAECSnABFYAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTngqQQo5aBAAAApgBAkpwARUAAA2AAAFotKrqAo5aBA+gApgBAkpwARSAAA2AAAFotKrqAo5aBB9AApgBAkpwARQAAA2AAAFotKrqAo5aBC7gApgBAkpwARQAAA2AAAFotKrqAo5aBD6AApgBAkpwAROAAA2AAAFotKrqAo5aBE4gApgBAkpwARMAAA2AAAFotKrqAH0O2dQEAAAAAAACU54K7gKOWgQAAAKYAQJKcAESgAANgAABaLSq6gKOWgQPoAKYAQJKcAESAAANgAABaLSq6gKOWgQfQAKYAwJKcAENgAANgAABaLSq6gKOWgQu4AKYAQJKcAERgAANgAABaLSq6gKOWgQ+gAKYAQJKcAERAAANgAABaLSq6gKOWgROIAKYAQJKcAEQgAANgAABaLSq6gB9DtnUBAAAAAAAAlOeC0vCjloEAAACmAECSnABEIAADYAAAWi0quoCjloED6ACmAECSnABEAAADYAAAWi0quoCjloEH0ACmAECSnABD4AADYAAAWi0quoCjloELuACmAECSnABDwAADYAAAWi0quoCjloEPoACmAECSnABDoAADYAAAWi0quoCjloETiACmAECSnABDgAADYAAAWi0quoAcU7trAQAAAAAAABG7j7OBALeK94EB8YIBd/CBAw=="),m.play())},this.release=function(){m.pause(),m.src=""}}function f(){var m=null;this.request=function(){m||(m=setInterval(function(){window.location.href="/",setTimeout(window.stop,0)},15e3))},this.release=function(){m&&(clearInterval(m),m=null)}}function g(){var m=navigator.userAgent||navigator.vendor||window.opera;return m.match(/iPhone/i)||m.match(/iPod/i)?f:p}l.exports=g()},"./node_modules/css-loader/dist/cjs.js!./src/style/aframe.css":(l,u,c)=>{c.r(u),c.d(u,{default:()=>O});var h=c("./node_modules/css-loader/dist/runtime/sourceMaps.js"),p=c.n(h),f=c("./node_modules/css-loader/dist/runtime/api.js"),g=c.n(f),m=c("./node_modules/css-loader/dist/runtime/getUrl.js"),y=c.n(m),b=new URL(c("data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27%3E%3Ctitle%3Eaframe-vrmode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M68.81,21.56H64.23v8.27h4.58a4.13,4.13,0,0,0,3.1-1.09,4.2,4.2,0,0,0,1-3,4.24,4.24,0,0,0-1-3A4.05,4.05,0,0,0,68.81,21.56Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0ZM41.9,46H34L24,16h8l6,21.84,6-21.84H52Zm39.29,0H73.44L68.15,35.39H64.23V46H57V16H68.81q5.32,0,8.34,2.37a8,8,0,0,1,3,6.69,9.68,9.68,0,0,1-1.27,5.18,8.9,8.9,0,0,1-4,3.34l6.26,12.11Z%27 fill=%27%23fff%27/%3E%3C/svg%3E"),c.b),v=new URL(c("data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27%3E%3Ctitle%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0Zm8,50a8,8,0,0,1-8,8H12a8,8,0,0,1-8-8V12a8,8,0,0,1,8-8H96a8,8,0,0,1,8,8Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M43.35,39.82H32.51L30.45,46H23.88L35,16h5.73L52,46H45.43Zm-9.17-5h7.5L37.91,23.58Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M68.11,35H63.18V46H57V16H68.15q5.31,0,8.2,2.37a8.18,8.18,0,0,1,2.88,6.7,9.22,9.22,0,0,1-1.33,5.12,9.09,9.09,0,0,1-4,3.26l6.49,12.26V46H73.73Zm-4.93-5h5a5.09,5.09,0,0,0,3.6-1.18,4.21,4.21,0,0,0,1.28-3.27,4.56,4.56,0,0,0-1.2-3.34A5,5,0,0,0,68.15,21h-5Z%27 fill=%27%23fff%27/%3E%3C/svg%3E"),c.b),_=new URL(c("data:image/svg+xml,%3C%3Fxml version=%271.0%27 encoding=%27UTF-8%27 standalone=%27no%27%3F%3E%3Csvg width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27 version=%271.1%27 id=%27svg320%27 sodipodi:docname=%27fullscreen-aframe.svg%27 xml:space=%27preserve%27 inkscape:version=%271.2.1 %289c6d41e  2022-07-14%29%27 xmlns:inkscape=%27http://www.inkscape.org/namespaces/inkscape%27 xmlns:sodipodi=%27http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd%27 xmlns=%27http://www.w3.org/2000/svg%27 xmlns:svg=%27http://www.w3.org/2000/svg%27 xmlns:rdf=%27http://www.w3.org/1999/02/22-rdf-syntax-ns%23%27 xmlns:cc=%27http://creativecommons.org/ns%23%27 xmlns:dc=%27http://purl.org/dc/elements/1.1/%27%3E%3Cdefs id=%27defs324%27 /%3E%3Csodipodi:namedview id=%27namedview322%27 pagecolor=%27%23ffffff%27 bordercolor=%27%23000000%27 borderopacity=%270.25%27 inkscape:showpageshadow=%272%27 inkscape:pageopacity=%270.0%27 inkscape:pagecheckerboard=%270%27 inkscape:deskcolor=%27%23d1d1d1%27 showgrid=%27false%27 inkscape:zoom=%273.8064516%27 inkscape:cx=%2791.423729%27 inkscape:cy=%27-1.4449153%27 inkscape:window-width=%271440%27 inkscape:window-height=%27847%27 inkscape:window-x=%2732%27 inkscape:window-y=%2725%27 inkscape:window-maximized=%270%27 inkscape:current-layer=%27svg320%27 /%3E%3Ctitle id=%27title312%27%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M96 0H12A12 12 0 0 0 0 12V50A12 12 0 0 0 12 62H96a12 12 0 0 0 12-12V12A12 12 0 0 0 96 0Zm8 50a8 8 0 0 1-8 8H12a8 8 0 0 1-8-8V12a8 8 0 0 1 8-8H96a8 8 0 0 1 8 8Z%27 fill=%27%23fff%27 id=%27path314%27 style=%27fill:%23ffffff%27 /%3E%3Cg id=%27g356%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g358%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g360%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g362%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g364%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g366%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g368%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g370%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g372%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g374%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g376%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g378%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g380%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g382%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g384%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cmetadata id=%27metadata561%27%3E%3Crdf:RDF%3E%3Ccc:Work rdf:about=%27%27%3E%3Cdc:title%3Eaframe-armode-noborder-reduced-tracking%3C/dc:title%3E%3C/cc:Work%3E%3C/rdf:RDF%3E%3C/metadata%3E%3Cpath d=%27m 98.168511 40.083649 c 0 -1.303681 -0.998788 -2.358041 -2.239389 -2.358041 -1.230088 0.0031 -2.240892 1.05436 -2.240892 2.358041 v 4.881296 l -9.041661 -9.041662 c -0.874129 -0.875631 -2.288954 -0.875631 -3.16308 0 -0.874129 0.874126 -0.874129 2.293459 0 3.167585 l 8.995101 8.992101 h -4.858767 c -1.323206 0.0031 -2.389583 1.004796 -2.389583 2.239386 0 1.237598 1.066377 2.237888 2.389583 2.237888 h 10.154599 c 1.323206 0 2.388082 -0.998789 2.392587 -2.237888 -0.0044 -0.03305 -0.009 -0.05858 -0.0134 -0.09161 0.0046 -0.04207 0.0134 -0.08712 0.0134 -0.13066 V 40.085172 h -1.52e-4%27 id=%27path596%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 23.091002 35.921781 -9.026643 9.041662 v -4.881296 c 0 -1.303681 -1.009302 -2.355037 -2.242393 -2.358041 -1.237598 0 -2.237888 1.05436 -2.237888 2.358041 l -0.0031 10.016421 c 0 0.04356 0.01211 0.08862 0.0015 0.130659 -0.0031 0.03153 -0.009 0.05709 -0.01211 0.09161 0.0031 1.239099 1.069379 2.237888 2.391085 2.237888 h 10.156101 c 1.320202 0 2.388079 -1.000291 2.388079 -2.237888 0 -1.234591 -1.067877 -2.236383 -2.388079 -2.239387 h -4.858767 l 8.995101 -8.9921 c 0.871126 -0.874127 0.871126 -2.293459 0 -3.167586 -0.875628 -0.877132 -2.291957 -0.877132 -3.169087 -1.52e-4%27 id=%27path598%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 84.649572 25.978033 9.041662 -9.041664 v 4.881298 c 0 1.299176 1.010806 2.350532 2.240891 2.355037 1.240601 0 2.23939 -1.055861 2.23939 -2.355037 V 11.798242 c 0 -0.04356 -0.009 -0.08862 -0.0134 -0.127671 0.0044 -0.03153 0.009 -0.06157 0.0134 -0.09313 -0.0044 -1.240598 -1.069379 -2.2393873 -2.391085 -2.2393873 h -10.1546 c -1.323205 0 -2.38958 0.9987893 -2.38958 2.2393873 0 1.233091 1.066375 2.237887 2.38958 2.240891 h 4.858768 l -8.995102 8.9921 c -0.874129 0.872625 -0.874129 2.288954 0 3.161578 0.874127 0.880137 2.288951 0.880137 3.16308 1.5e-4%27 id=%27path600%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 17.264988 13.822853 h 4.857265 c 1.320202 -0.0031 2.388079 -1.0078 2.388079 -2.240889 0 -1.240601 -1.067877 -2.2393893 -2.388079 -2.2393893 H 11.967654 c -1.321707 0 -2.388082 0.9987883 -2.391085 2.2393893 0.0031 0.03153 0.009 0.06157 0.01211 0.09313 -0.0031 0.03905 -0.0015 0.08262 -0.0015 0.127671 l 0.0031 10.020926 c 0 1.299176 1.00029 2.355038 2.237887 2.355038 1.233092 -0.0044 2.242393 -1.055862 2.242393 -2.355038 v -4.881295 l 9.026644 9.041661 c 0.877132 0.878635 2.293459 0.878635 3.169087 0 0.871125 -0.872624 0.871125 -2.288953 0 -3.161577 l -8.995282 -8.993616%27 id=%27path602%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3C/svg%3E"),c.b),C=new URL(c("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%2090%2090%22%20enable-background%3D%22new%200%200%2090%2090%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpolygon%20points%3D%220%2C0%200%2C0%200%2C0%20%22%3E%3C/polygon%3E%3Cg%3E%3Cpath%20d%3D%22M71.545%2C48.145h-31.98V20.743c0-2.627-2.138-4.765-4.765-4.765H18.456c-2.628%2C0-4.767%2C2.138-4.767%2C4.765v42.789%20%20%20c0%2C2.628%2C2.138%2C4.766%2C4.767%2C4.766h5.535v0.959c0%2C2.628%2C2.138%2C4.765%2C4.766%2C4.765h42.788c2.628%2C0%2C4.766-2.137%2C4.766-4.765V52.914%20%20%20C76.311%2C50.284%2C74.173%2C48.145%2C71.545%2C48.145z%20M18.455%2C16.935h16.344c2.1%2C0%2C3.808%2C1.708%2C3.808%2C3.808v27.401H37.25V22.636%20%20%20c0-0.264-0.215-0.478-0.479-0.478H16.482c-0.264%2C0-0.479%2C0.214-0.479%2C0.478v36.585c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h7.507v7.644%20%20%20h-5.534c-2.101%2C0-3.81-1.709-3.81-3.81V20.743C14.645%2C18.643%2C16.354%2C16.935%2C18.455%2C16.935z%20M16.96%2C23.116h19.331v25.031h-7.535%20%20%20c-2.628%2C0-4.766%2C2.139-4.766%2C4.768v5.828h-7.03V23.116z%20M71.545%2C73.064H28.757c-2.101%2C0-3.81-1.708-3.81-3.808V52.914%20%20%20c0-2.102%2C1.709-3.812%2C3.81-3.812h42.788c2.1%2C0%2C3.809%2C1.71%2C3.809%2C3.812v16.343C75.354%2C71.356%2C73.645%2C73.064%2C71.545%2C73.064z%22%3E%3C/path%3E%3Cpath%20d%3D%22M28.919%2C58.424c-1.466%2C0-2.659%2C1.193-2.659%2C2.66c0%2C1.466%2C1.193%2C2.658%2C2.659%2C2.658c1.468%2C0%2C2.662-1.192%2C2.662-2.658%20%20%20C31.581%2C59.617%2C30.387%2C58.424%2C28.919%2C58.424z%20M28.919%2C62.786c-0.939%2C0-1.703-0.764-1.703-1.702c0-0.939%2C0.764-1.704%2C1.703-1.704%20%20%20c0.94%2C0%2C1.705%2C0.765%2C1.705%2C1.704C30.623%2C62.022%2C29.858%2C62.786%2C28.919%2C62.786z%22%3E%3C/path%3E%3Cpath%20d%3D%22M69.654%2C50.461H33.069c-0.264%2C0-0.479%2C0.215-0.479%2C0.479v20.288c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h36.585%20%20%20c0.263%2C0%2C0.477-0.214%2C0.477-0.478V50.939C70.131%2C50.676%2C69.917%2C50.461%2C69.654%2C50.461z%20M69.174%2C51.417V70.75H33.548V51.417H69.174z%22%3E%3C/path%3E%3Cpath%20d%3D%22M45.201%2C30.296c6.651%2C0%2C12.233%2C5.351%2C12.551%2C11.977l-3.033-2.638c-0.193-0.165-0.507-0.142-0.675%2C0.048%20%20%20c-0.174%2C0.198-0.153%2C0.501%2C0.045%2C0.676l3.883%2C3.375c0.09%2C0.075%2C0.198%2C0.115%2C0.312%2C0.115c0.141%2C0%2C0.273-0.061%2C0.362-0.166%20%20%20l3.371-3.877c0.173-0.2%2C0.151-0.502-0.047-0.675c-0.194-0.166-0.508-0.144-0.676%2C0.048l-2.592%2C2.979%20%20%20c-0.18-3.417-1.629-6.605-4.099-9.001c-2.538-2.461-5.877-3.817-9.404-3.817c-0.264%2C0-0.479%2C0.215-0.479%2C0.479%20%20%20C44.72%2C30.083%2C44.936%2C30.296%2C45.201%2C30.296z%22%3E%3C/path%3E%3C/g%3E%3C/svg%3E"),c.b),E=new URL(c("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%20100%20100%22%20enable-background%3D%22new%200%200%20100%20100%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpath%20fill%3D%22%23000000%22%20d%3D%22M55.209%2C50l17.803-17.803c1.416-1.416%2C1.416-3.713%2C0-5.129c-1.416-1.417-3.713-1.417-5.129%2C0L50.08%2C44.872%20%20L32.278%2C27.069c-1.416-1.417-3.714-1.417-5.129%2C0c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129L44.951%2C50L27.149%2C67.803%20%20c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129c0.708%2C0.708%2C1.636%2C1.062%2C2.564%2C1.062c0.928%2C0%2C1.856-0.354%2C2.564-1.062L50.08%2C55.13l17.803%2C17.802%20%20c0.708%2C0.708%2C1.637%2C1.062%2C2.564%2C1.062s1.856-0.354%2C2.564-1.062c1.416-1.416%2C1.416-3.713%2C0-5.129L55.209%2C50z%22%3E%3C/path%3E%3C/svg%3E"),c.b),T=g()(p()),R=y()(b),B=y()(v),I=y()(_),D=y()(C),L=y()(E);T.push([l.id,`/* .a-fullscreen means not embedded. */
html.a-fullscreen {
  bottom: 0;
  left: 0;
  position: fixed;
  right: 0;
  top: 0;
}

html.a-fullscreen body {
  height: 100%;
  margin: 0;
  overflow: hidden;
  padding: 0;
  width: 100%;
}

/* Class is removed when doing <a-scene embedded>. */
html.a-fullscreen .a-canvas {
  width: 100% !important;
  height: 100% !important;
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  bottom: 0 !important;
  position: fixed !important;
}

html:not(.a-fullscreen) .a-enter-vr,
html:not(.a-fullscreen) .a-enter-ar {
  right: 5px;
  bottom: 5px;
}

html:not(.a-fullscreen) .a-enter-ar {
  right: 60px;
}

/* In chrome mobile the user agent stylesheet set it to white  */
:-webkit-full-screen {
  background-color: transparent;
}

.a-hidden {
  display: none !important;
}

.a-canvas {
  height: 100%;
  left: 0;
  position: absolute;
  top: 0;
  width: 100%;
}

.a-canvas.a-grab-cursor:hover {
  cursor: grab;
  cursor: -moz-grab;
  cursor: -webkit-grab;
}

canvas.a-canvas.a-mouse-cursor-hover:hover {
  cursor: pointer;
}

.a-inspector-loader {
  background-color: #ed3160;
  position: fixed;
  left: 3px;
  top: 3px;
  padding: 6px 10px;
  color: #fff;
  text-decoration: none;
  font-size: 12px;
  font-family: Roboto,sans-serif;
  text-align: center;
  z-index: 99999;
  width: 204px;
}

/* Inspector loader animation */
@keyframes dots-1 { from { opacity: 0; } 25% { opacity: 1; } }
@keyframes dots-2 { from { opacity: 0; } 50% { opacity: 1; } }
@keyframes dots-3 { from { opacity: 0; } 75% { opacity: 1; } }
@-webkit-keyframes dots-1 { from { opacity: 0; } 25% { opacity: 1; } }
@-webkit-keyframes dots-2 { from { opacity: 0; } 50% { opacity: 1; } }
@-webkit-keyframes dots-3 { from { opacity: 0; } 75% { opacity: 1; } }

.a-inspector-loader .dots span {
  animation: dots-1 2s infinite steps(1);
  -webkit-animation: dots-1 2s infinite steps(1);
}

.a-inspector-loader .dots span:first-child + span {
  animation-name: dots-2;
  -webkit-animation-name: dots-2;
}

.a-inspector-loader .dots span:first-child + span + span {
  animation-name: dots-3;
  -webkit-animation-name: dots-3;
}

a-scene {
  display: block;
  position: relative;
  height: 100%;
  width: 100%;
}

a-assets,
a-scene video,
a-scene img,
a-scene audio {
  display: none;
}

.a-enter-vr-modal,
.a-orientation-modal {
  font-family: Consolas, Andale Mono, Courier New, monospace;
}

.a-enter-vr-modal a {
  border-bottom: 1px solid #fff;
  padding: 2px 0;
  text-decoration: none;
  transition: .1s color ease-in;
}

.a-enter-vr-modal a:hover {
  background-color: #fff;
  color: #111;
  padding: 2px 4px;
  position: relative;
  left: -4px;
}

.a-enter-vr,
.a-enter-ar {
  font-family: sans-serif, monospace;
  font-size: 13px;
  width: 100%;
  font-weight: 200;
  line-height: 16px;
  position: absolute;
  right: 20px;
  bottom: 20px;
}

.a-enter-ar.xr {
  right: 90px;
}

.a-enter-vr-button,
.a-enter-vr-modal,
.a-enter-vr-modal a {
  color: #fff;
  user-select: none;
  outline: none;
}

.a-enter-vr-button {
  background: rgba(0, 0, 0, 0.35) url(`+R+`) 50% 50% no-repeat;
}

.a-enter-ar-button {
  background: rgba(0, 0, 0, 0.20) url(`+B+`) 50% 50% no-repeat;
}

.a-enter-vr.fullscreen .a-enter-vr-button {
  background-image: url(`+I+`);
}

.a-enter-vr-button,
.a-enter-ar-button {
  background-size: 90% 90%;
  border: 0;
  bottom: 0;
  cursor: pointer;
  min-width: 58px;
  min-height: 34px;
  /* 1.74418604651 */
  /*
    In order to keep the aspect ratio when resizing
    padding-top percentages are relative to the containing block's width.
    http://stackoverflow.com/questions/12121090/responsively-change-div-size-keeping-aspect-ratio
  */
  padding-right: 0;
  padding-top: 0;
  position: absolute;
  right: 0;
  transition: background-color .05s ease;
  -webkit-transition: background-color .05s ease;
  z-index: 9999;
  border-radius: 8px;
  touch-action: manipulation; /* Prevent iOS double tap zoom on the button */
}

.a-enter-ar-button {
  background-size: 100% 90%;
  border-radius: 7px;
}

.a-enter-ar-button:active,
.a-enter-ar-button:hover,
.a-enter-vr-button:active,
.a-enter-vr-button:hover {
  background-color: #ef2d5e;
}

.a-enter-vr-button.resethover {
  background-color: rgba(0, 0, 0, 0.35);
}

.a-enter-vr-modal {
  background-color: #666;
  border-radius: 0;
  display: none;
  min-height: 32px;
  margin-right: 70px;
  padding: 9px;
  width: 280px;
  right: 2%;
  position: absolute;
}

.a-enter-vr-modal:after {
  border-bottom: 10px solid transparent;
  border-left: 10px solid #666;
  border-top: 10px solid transparent;
  display: inline-block;
  content: '';
  position: absolute;
  right: -5px;
  top: 5px;
  width: 0;
  height: 0;
}

.a-enter-vr-modal p,
.a-enter-vr-modal a {
  display: inline;
}

.a-enter-vr-modal p {
  margin: 0;
}

.a-enter-vr-modal p:after {
  content: ' ';
}

.a-orientation-modal {
  background: rgba(244, 244, 244, 1) url(`+D+`) center no-repeat;
  background-size: 50% 50%;
  bottom: 0;
  font-size: 14px;
  font-weight: 600;
  left: 0;
  line-height: 20px;
  right: 0;
  position: fixed;
  top: 0;
  z-index: 9999999;
}

.a-orientation-modal:after {
  color: #666;
  content: "Insert phone into Cardboard holder.";
  display: block;
  position: absolute;
  text-align: center;
  top: 70%;
  transform: translateY(-70%);
  width: 100%;
}

.a-orientation-modal button {
  background: url(`+L+`) no-repeat;
  border: none;
  height: 50px;
  text-indent: -9999px;
  width: 50px;
}

.a-loader-title {
  background-color: rgba(0, 0, 0, 0.6);
  font-family: sans-serif, monospace;
  text-align: center;
  font-size: 20px;
  height: 50px;
  font-weight: 300;
  line-height: 50px;
  position: absolute;
  right: 0px;
  left: 0px;
  top: 0px;
  color: white;
}

.a-modal {
  position: absolute;
  background: rgba(0, 0, 0, 0.60);
  background-size: 50% 50%;
  bottom: 0;
  font-size: 14px;
  font-weight: 600;
  left: 0;
  line-height: 20px;
  right: 0;
  position: fixed;
  top: 0;
  z-index: 9999999;
}

.a-dialog {
  position: relative;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  z-index: 199995;
  width: 300px;
  height: 200px;
  background-size: contain;
  background-color: white;
  font-family: sans-serif, monospace;
  font-size: 20px;
  border-radius: 3px;
  padding: 6px;
}

.a-dialog-text-container {
  width: 100%;
  height: 70%;
  align-self: flex-start;
  display: flex;
  justify-content: center;
  align-content: center;
  flex-direction: column;
}

.a-dialog-text {
  display: inline-block;
  font-weight: normal;
  font-size: 14pt;
  margin: 8px;
}

.a-dialog-buttons-container {
  display: inline-flex;
  align-self: flex-end;
  width: 100%;
  height: 30%;
}

.a-dialog-button {
  cursor: pointer;
  align-self: center;
  opacity: 0.9;
  height: 80%;
  width: 50%;
  font-size: 12pt;
  margin: 4px;
  border-radius: 2px;
  text-align:center;
  border: none;
  display: inline-block;
  -webkit-transition: all 0.25s ease-in-out;
  transition: all 0.25s ease-in-out;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.10), 0 1px 2px rgba(0, 0, 0, 0.20);
  user-select: none;
}

.a-dialog-permission-button:hover {
  box-shadow: 0 7px 14px rgba(0,0,0,0.20), 0 2px 2px rgba(0,0,0,0.20);
}

.a-dialog-allow-button {
  background-color: #00ceff;
}

.a-dialog-deny-button {
  background-color: #ff005b;
}

.a-dialog-ok-button {
  background-color: #00ceff;
  width: 100%;
}

.a-dom-overlay:not(.a-no-style) {
  overflow: hidden;
  position: absolute;
  pointer-events: none;
  box-sizing: border-box;
  bottom: 0;
  left: 0;
  right: 0;
  top: 0;
  padding: 1em;
}

.a-dom-overlay:not(.a-no-style)>* {
  pointer-events: auto;
}
`,"",{version:3,sources:["webpack://./src/style/aframe.css"],names:[],mappings:"AAAA,sCAAsC;AACtC;EACE,SAAS;EACT,OAAO;EACP,eAAe;EACf,QAAQ;EACR,MAAM;AACR;;AAEA;EACE,YAAY;EACZ,SAAS;EACT,gBAAgB;EAChB,UAAU;EACV,WAAW;AACb;;AAEA,oDAAoD;AACpD;EACE,sBAAsB;EACtB,uBAAuB;EACvB,iBAAiB;EACjB,kBAAkB;EAClB,mBAAmB;EACnB,oBAAoB;EACpB,0BAA0B;AAC5B;;AAEA;;EAEE,UAAU;EACV,WAAW;AACb;;AAEA;EACE,WAAW;AACb;;AAEA,gEAAgE;AAChE;EACE,6BAA6B;AAC/B;;AAEA;EACE,wBAAwB;AAC1B;;AAEA;EACE,YAAY;EACZ,OAAO;EACP,kBAAkB;EAClB,MAAM;EACN,WAAW;AACb;;AAEA;EACE,YAAY;EACZ,iBAAiB;EACjB,oBAAoB;AACtB;;AAEA;EACE,eAAe;AACjB;;AAEA;EACE,yBAAyB;EACzB,eAAe;EACf,SAAS;EACT,QAAQ;EACR,iBAAiB;EACjB,WAAW;EACX,qBAAqB;EACrB,eAAe;EACf,8BAA8B;EAC9B,kBAAkB;EAClB,cAAc;EACd,YAAY;AACd;;AAEA,+BAA+B;AAC/B,oBAAoB,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;AAC7D,oBAAoB,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;AAC7D,oBAAoB,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;AAC7D,4BAA4B,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;AACrE,4BAA4B,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;AACrE,4BAA4B,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;;AAErE;EACE,sCAAsC;EACtC,8CAA8C;AAChD;;AAEA;EACE,sBAAsB;EACtB,8BAA8B;AAChC;;AAEA;EACE,sBAAsB;EACtB,8BAA8B;AAChC;;AAEA;EACE,cAAc;EACd,kBAAkB;EAClB,YAAY;EACZ,WAAW;AACb;;AAEA;;;;EAIE,aAAa;AACf;;AAEA;;EAEE,0DAA0D;AAC5D;;AAEA;EACE,6BAA6B;EAC7B,cAAc;EACd,qBAAqB;EACrB,6BAA6B;AAC/B;;AAEA;EACE,sBAAsB;EACtB,WAAW;EACX,gBAAgB;EAChB,kBAAkB;EAClB,UAAU;AACZ;;AAEA;;EAEE,kCAAkC;EAClC,eAAe;EACf,WAAW;EACX,gBAAgB;EAChB,iBAAiB;EACjB,kBAAkB;EAClB,WAAW;EACX,YAAY;AACd;;AAEA;EACE,WAAW;AACb;;AAEA;;;EAGE,WAAW;EACX,iBAAiB;EACjB,aAAa;AACf;;AAEA;EACE,yFAA4qB;AAC9qB;;AAEA;EACE,yFAAkzB;AACpzB;;AAEA;EACE,yDAA2qK;AAC7qK;;AAEA;;EAEE,wBAAwB;EACxB,SAAS;EACT,SAAS;EACT,eAAe;EACf,eAAe;EACf,gBAAgB;EAChB,kBAAkB;EAClB;;;;GAIC;EACD,gBAAgB;EAChB,cAAc;EACd,kBAAkB;EAClB,QAAQ;EACR,sCAAsC;EACtC,8CAA8C;EAC9C,aAAa;EACb,kBAAkB;EAClB,0BAA0B,EAAE,8CAA8C;AAC5E;;AAEA;EACE,yBAAyB;EACzB,kBAAkB;AACpB;;AAEA;;;;EAIE,yBAAyB;AAC3B;;AAEA;EACE,qCAAqC;AACvC;;AAEA;EACE,sBAAsB;EACtB,gBAAgB;EAChB,aAAa;EACb,gBAAgB;EAChB,kBAAkB;EAClB,YAAY;EACZ,YAAY;EACZ,SAAS;EACT,kBAAkB;AACpB;;AAEA;EACE,qCAAqC;EACrC,4BAA4B;EAC5B,kCAAkC;EAClC,qBAAqB;EACrB,WAAW;EACX,kBAAkB;EAClB,WAAW;EACX,QAAQ;EACR,QAAQ;EACR,SAAS;AACX;;AAEA;;EAEE,eAAe;AACjB;;AAEA;EACE,SAAS;AACX;;AAEA;EACE,YAAY;AACd;;AAEA;EACE,2FAAivF;EACjvF,wBAAwB;EACxB,SAAS;EACT,eAAe;EACf,gBAAgB;EAChB,OAAO;EACP,iBAAiB;EACjB,QAAQ;EACR,eAAe;EACf,MAAM;EACN,gBAAgB;AAClB;;AAEA;EACE,WAAW;EACX,8CAA8C;EAC9C,cAAc;EACd,kBAAkB;EAClB,kBAAkB;EAClB,QAAQ;EACR,2BAA2B;EAC3B,WAAW;AACb;;AAEA;EACE,6DAA25B;EAC35B,YAAY;EACZ,YAAY;EACZ,oBAAoB;EACpB,WAAW;AACb;;AAEA;EACE,oCAAoC;EACpC,kCAAkC;EAClC,kBAAkB;EAClB,eAAe;EACf,YAAY;EACZ,gBAAgB;EAChB,iBAAiB;EACjB,kBAAkB;EAClB,UAAU;EACV,SAAS;EACT,QAAQ;EACR,YAAY;AACd;;AAEA;EACE,kBAAkB;EAClB,+BAA+B;EAC/B,wBAAwB;EACxB,SAAS;EACT,eAAe;EACf,gBAAgB;EAChB,OAAO;EACP,iBAAiB;EACjB,QAAQ;EACR,eAAe;EACf,MAAM;EACN,gBAAgB;AAClB;;AAEA;EACE,kBAAkB;EAClB,SAAS;EACT,QAAQ;EACR,gCAAgC;EAChC,eAAe;EACf,YAAY;EACZ,aAAa;EACb,wBAAwB;EACxB,uBAAuB;EACvB,kCAAkC;EAClC,eAAe;EACf,kBAAkB;EAClB,YAAY;AACd;;AAEA;EACE,WAAW;EACX,WAAW;EACX,sBAAsB;EACtB,aAAa;EACb,uBAAuB;EACvB,qBAAqB;EACrB,sBAAsB;AACxB;;AAEA;EACE,qBAAqB;EACrB,mBAAmB;EACnB,eAAe;EACf,WAAW;AACb;;AAEA;EACE,oBAAoB;EACpB,oBAAoB;EACpB,WAAW;EACX,WAAW;AACb;;AAEA;EACE,eAAe;EACf,kBAAkB;EAClB,YAAY;EACZ,WAAW;EACX,UAAU;EACV,eAAe;EACf,WAAW;EACX,kBAAkB;EAClB,iBAAiB;EACjB,YAAY;EACZ,qBAAqB;EACrB,yCAAyC;EACzC,iCAAiC;EACjC,wEAAwE;EACxE,iBAAiB;AACnB;;AAEA;EACE,mEAAmE;AACrE;;AAEA;EACE,yBAAyB;AAC3B;;AAEA;EACE,yBAAyB;AAC3B;;AAEA;EACE,yBAAyB;EACzB,WAAW;AACb;;AAEA;EACE,gBAAgB;EAChB,kBAAkB;EAClB,oBAAoB;EACpB,sBAAsB;EACtB,SAAS;EACT,OAAO;EACP,QAAQ;EACR,MAAM;EACN,YAAY;AACd;;AAEA;EACE,oBAAoB;AACtB",sourcesContent:[`/* .a-fullscreen means not embedded. */
html.a-fullscreen {
  bottom: 0;
  left: 0;
  position: fixed;
  right: 0;
  top: 0;
}

html.a-fullscreen body {
  height: 100%;
  margin: 0;
  overflow: hidden;
  padding: 0;
  width: 100%;
}

/* Class is removed when doing <a-scene embedded>. */
html.a-fullscreen .a-canvas {
  width: 100% !important;
  height: 100% !important;
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  bottom: 0 !important;
  position: fixed !important;
}

html:not(.a-fullscreen) .a-enter-vr,
html:not(.a-fullscreen) .a-enter-ar {
  right: 5px;
  bottom: 5px;
}

html:not(.a-fullscreen) .a-enter-ar {
  right: 60px;
}

/* In chrome mobile the user agent stylesheet set it to white  */
:-webkit-full-screen {
  background-color: transparent;
}

.a-hidden {
  display: none !important;
}

.a-canvas {
  height: 100%;
  left: 0;
  position: absolute;
  top: 0;
  width: 100%;
}

.a-canvas.a-grab-cursor:hover {
  cursor: grab;
  cursor: -moz-grab;
  cursor: -webkit-grab;
}

canvas.a-canvas.a-mouse-cursor-hover:hover {
  cursor: pointer;
}

.a-inspector-loader {
  background-color: #ed3160;
  position: fixed;
  left: 3px;
  top: 3px;
  padding: 6px 10px;
  color: #fff;
  text-decoration: none;
  font-size: 12px;
  font-family: Roboto,sans-serif;
  text-align: center;
  z-index: 99999;
  width: 204px;
}

/* Inspector loader animation */
@keyframes dots-1 { from { opacity: 0; } 25% { opacity: 1; } }
@keyframes dots-2 { from { opacity: 0; } 50% { opacity: 1; } }
@keyframes dots-3 { from { opacity: 0; } 75% { opacity: 1; } }
@-webkit-keyframes dots-1 { from { opacity: 0; } 25% { opacity: 1; } }
@-webkit-keyframes dots-2 { from { opacity: 0; } 50% { opacity: 1; } }
@-webkit-keyframes dots-3 { from { opacity: 0; } 75% { opacity: 1; } }

.a-inspector-loader .dots span {
  animation: dots-1 2s infinite steps(1);
  -webkit-animation: dots-1 2s infinite steps(1);
}

.a-inspector-loader .dots span:first-child + span {
  animation-name: dots-2;
  -webkit-animation-name: dots-2;
}

.a-inspector-loader .dots span:first-child + span + span {
  animation-name: dots-3;
  -webkit-animation-name: dots-3;
}

a-scene {
  display: block;
  position: relative;
  height: 100%;
  width: 100%;
}

a-assets,
a-scene video,
a-scene img,
a-scene audio {
  display: none;
}

.a-enter-vr-modal,
.a-orientation-modal {
  font-family: Consolas, Andale Mono, Courier New, monospace;
}

.a-enter-vr-modal a {
  border-bottom: 1px solid #fff;
  padding: 2px 0;
  text-decoration: none;
  transition: .1s color ease-in;
}

.a-enter-vr-modal a:hover {
  background-color: #fff;
  color: #111;
  padding: 2px 4px;
  position: relative;
  left: -4px;
}

.a-enter-vr,
.a-enter-ar {
  font-family: sans-serif, monospace;
  font-size: 13px;
  width: 100%;
  font-weight: 200;
  line-height: 16px;
  position: absolute;
  right: 20px;
  bottom: 20px;
}

.a-enter-ar.xr {
  right: 90px;
}

.a-enter-vr-button,
.a-enter-vr-modal,
.a-enter-vr-modal a {
  color: #fff;
  user-select: none;
  outline: none;
}

.a-enter-vr-button {
  background: rgba(0, 0, 0, 0.35) url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='108' height='62' viewBox='0 0 108 62'%3E%3Ctitle%3Eaframe-vrmode-noborder-reduced-tracking%3C/title%3E%3Cpath d='M68.81,21.56H64.23v8.27h4.58a4.13,4.13,0,0,0,3.1-1.09,4.2,4.2,0,0,0,1-3,4.24,4.24,0,0,0-1-3A4.05,4.05,0,0,0,68.81,21.56Z' fill='%23fff'/%3E%3Cpath d='M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0ZM41.9,46H34L24,16h8l6,21.84,6-21.84H52Zm39.29,0H73.44L68.15,35.39H64.23V46H57V16H68.81q5.32,0,8.34,2.37a8,8,0,0,1,3,6.69,9.68,9.68,0,0,1-1.27,5.18,8.9,8.9,0,0,1-4,3.34l6.26,12.11Z' fill='%23fff'/%3E%3C/svg%3E") 50% 50% no-repeat;
}

.a-enter-ar-button {
  background: rgba(0, 0, 0, 0.20) url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='108' height='62' viewBox='0 0 108 62'%3E%3Ctitle%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d='M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0Zm8,50a8,8,0,0,1-8,8H12a8,8,0,0,1-8-8V12a8,8,0,0,1,8-8H96a8,8,0,0,1,8,8Z' fill='%23fff'/%3E%3Cpath d='M43.35,39.82H32.51L30.45,46H23.88L35,16h5.73L52,46H45.43Zm-9.17-5h7.5L37.91,23.58Z' fill='%23fff'/%3E%3Cpath d='M68.11,35H63.18V46H57V16H68.15q5.31,0,8.2,2.37a8.18,8.18,0,0,1,2.88,6.7,9.22,9.22,0,0,1-1.33,5.12,9.09,9.09,0,0,1-4,3.26l6.49,12.26V46H73.73Zm-4.93-5h5a5.09,5.09,0,0,0,3.6-1.18,4.21,4.21,0,0,0,1.28-3.27,4.56,4.56,0,0,0-1.2-3.34A5,5,0,0,0,68.15,21h-5Z' fill='%23fff'/%3E%3C/svg%3E") 50% 50% no-repeat;
}

.a-enter-vr.fullscreen .a-enter-vr-button {
  background-image: url("data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8' standalone='no'%3F%3E%3Csvg width='108' height='62' viewBox='0 0 108 62' version='1.1' id='svg320' sodipodi:docname='fullscreen-aframe.svg' xml:space='preserve' inkscape:version='1.2.1 (9c6d41e  2022-07-14)' xmlns:inkscape='http://www.inkscape.org/namespaces/inkscape' xmlns:sodipodi='http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd' xmlns='http://www.w3.org/2000/svg' xmlns:svg='http://www.w3.org/2000/svg' xmlns:rdf='http://www.w3.org/1999/02/22-rdf-syntax-ns%23' xmlns:cc='http://creativecommons.org/ns%23' xmlns:dc='http://purl.org/dc/elements/1.1/'%3E%3Cdefs id='defs324' /%3E%3Csodipodi:namedview id='namedview322' pagecolor='%23ffffff' bordercolor='%23000000' borderopacity='0.25' inkscape:showpageshadow='2' inkscape:pageopacity='0.0' inkscape:pagecheckerboard='0' inkscape:deskcolor='%23d1d1d1' showgrid='false' inkscape:zoom='3.8064516' inkscape:cx='91.423729' inkscape:cy='-1.4449153' inkscape:window-width='1440' inkscape:window-height='847' inkscape:window-x='32' inkscape:window-y='25' inkscape:window-maximized='0' inkscape:current-layer='svg320' /%3E%3Ctitle id='title312'%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d='M96 0H12A12 12 0 0 0 0 12V50A12 12 0 0 0 12 62H96a12 12 0 0 0 12-12V12A12 12 0 0 0 96 0Zm8 50a8 8 0 0 1-8 8H12a8 8 0 0 1-8-8V12a8 8 0 0 1 8-8H96a8 8 0 0 1 8 8Z' fill='%23fff' id='path314' style='fill:%23ffffff' /%3E%3Cg id='g356' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g358' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g360' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g362' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g364' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g366' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g368' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g370' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g372' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g374' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g376' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g378' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g380' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g382' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g384' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cmetadata id='metadata561'%3E%3Crdf:RDF%3E%3Ccc:Work rdf:about=''%3E%3Cdc:title%3Eaframe-armode-noborder-reduced-tracking%3C/dc:title%3E%3C/cc:Work%3E%3C/rdf:RDF%3E%3C/metadata%3E%3Cpath d='m 98.168511 40.083649 c 0 -1.303681 -0.998788 -2.358041 -2.239389 -2.358041 -1.230088 0.0031 -2.240892 1.05436 -2.240892 2.358041 v 4.881296 l -9.041661 -9.041662 c -0.874129 -0.875631 -2.288954 -0.875631 -3.16308 0 -0.874129 0.874126 -0.874129 2.293459 0 3.167585 l 8.995101 8.992101 h -4.858767 c -1.323206 0.0031 -2.389583 1.004796 -2.389583 2.239386 0 1.237598 1.066377 2.237888 2.389583 2.237888 h 10.154599 c 1.323206 0 2.388082 -0.998789 2.392587 -2.237888 -0.0044 -0.03305 -0.009 -0.05858 -0.0134 -0.09161 0.0046 -0.04207 0.0134 -0.08712 0.0134 -0.13066 V 40.085172 h -1.52e-4' id='path596' style='fill:%23ffffff%3Bstroke-width:1.50194' /%3E%3Cpath d='m 23.091002 35.921781 -9.026643 9.041662 v -4.881296 c 0 -1.303681 -1.009302 -2.355037 -2.242393 -2.358041 -1.237598 0 -2.237888 1.05436 -2.237888 2.358041 l -0.0031 10.016421 c 0 0.04356 0.01211 0.08862 0.0015 0.130659 -0.0031 0.03153 -0.009 0.05709 -0.01211 0.09161 0.0031 1.239099 1.069379 2.237888 2.391085 2.237888 h 10.156101 c 1.320202 0 2.388079 -1.000291 2.388079 -2.237888 0 -1.234591 -1.067877 -2.236383 -2.388079 -2.239387 h -4.858767 l 8.995101 -8.9921 c 0.871126 -0.874127 0.871126 -2.293459 0 -3.167586 -0.875628 -0.877132 -2.291957 -0.877132 -3.169087 -1.52e-4' id='path598' style='fill:%23ffffff%3Bstroke-width:1.50194' /%3E%3Cpath d='m 84.649572 25.978033 9.041662 -9.041664 v 4.881298 c 0 1.299176 1.010806 2.350532 2.240891 2.355037 1.240601 0 2.23939 -1.055861 2.23939 -2.355037 V 11.798242 c 0 -0.04356 -0.009 -0.08862 -0.0134 -0.127671 0.0044 -0.03153 0.009 -0.06157 0.0134 -0.09313 -0.0044 -1.240598 -1.069379 -2.2393873 -2.391085 -2.2393873 h -10.1546 c -1.323205 0 -2.38958 0.9987893 -2.38958 2.2393873 0 1.233091 1.066375 2.237887 2.38958 2.240891 h 4.858768 l -8.995102 8.9921 c -0.874129 0.872625 -0.874129 2.288954 0 3.161578 0.874127 0.880137 2.288951 0.880137 3.16308 1.5e-4' id='path600' style='fill:%23ffffff%3Bstroke-width:1.50194' /%3E%3Cpath d='m 17.264988 13.822853 h 4.857265 c 1.320202 -0.0031 2.388079 -1.0078 2.388079 -2.240889 0 -1.240601 -1.067877 -2.2393893 -2.388079 -2.2393893 H 11.967654 c -1.321707 0 -2.388082 0.9987883 -2.391085 2.2393893 0.0031 0.03153 0.009 0.06157 0.01211 0.09313 -0.0031 0.03905 -0.0015 0.08262 -0.0015 0.127671 l 0.0031 10.020926 c 0 1.299176 1.00029 2.355038 2.237887 2.355038 1.233092 -0.0044 2.242393 -1.055862 2.242393 -2.355038 v -4.881295 l 9.026644 9.041661 c 0.877132 0.878635 2.293459 0.878635 3.169087 0 0.871125 -0.872624 0.871125 -2.288953 0 -3.161577 l -8.995282 -8.993616' id='path602' style='fill:%23ffffff%3Bstroke-width:1.50194' /%3E%3C/svg%3E");
}

.a-enter-vr-button,
.a-enter-ar-button {
  background-size: 90% 90%;
  border: 0;
  bottom: 0;
  cursor: pointer;
  min-width: 58px;
  min-height: 34px;
  /* 1.74418604651 */
  /*
    In order to keep the aspect ratio when resizing
    padding-top percentages are relative to the containing block's width.
    http://stackoverflow.com/questions/12121090/responsively-change-div-size-keeping-aspect-ratio
  */
  padding-right: 0;
  padding-top: 0;
  position: absolute;
  right: 0;
  transition: background-color .05s ease;
  -webkit-transition: background-color .05s ease;
  z-index: 9999;
  border-radius: 8px;
  touch-action: manipulation; /* Prevent iOS double tap zoom on the button */
}

.a-enter-ar-button {
  background-size: 100% 90%;
  border-radius: 7px;
}

.a-enter-ar-button:active,
.a-enter-ar-button:hover,
.a-enter-vr-button:active,
.a-enter-vr-button:hover {
  background-color: #ef2d5e;
}

.a-enter-vr-button.resethover {
  background-color: rgba(0, 0, 0, 0.35);
}

.a-enter-vr-modal {
  background-color: #666;
  border-radius: 0;
  display: none;
  min-height: 32px;
  margin-right: 70px;
  padding: 9px;
  width: 280px;
  right: 2%;
  position: absolute;
}

.a-enter-vr-modal:after {
  border-bottom: 10px solid transparent;
  border-left: 10px solid #666;
  border-top: 10px solid transparent;
  display: inline-block;
  content: '';
  position: absolute;
  right: -5px;
  top: 5px;
  width: 0;
  height: 0;
}

.a-enter-vr-modal p,
.a-enter-vr-modal a {
  display: inline;
}

.a-enter-vr-modal p {
  margin: 0;
}

.a-enter-vr-modal p:after {
  content: ' ';
}

.a-orientation-modal {
  background: rgba(244, 244, 244, 1) url(data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%2090%2090%22%20enable-background%3D%22new%200%200%2090%2090%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpolygon%20points%3D%220%2C0%200%2C0%200%2C0%20%22%3E%3C/polygon%3E%3Cg%3E%3Cpath%20d%3D%22M71.545%2C48.145h-31.98V20.743c0-2.627-2.138-4.765-4.765-4.765H18.456c-2.628%2C0-4.767%2C2.138-4.767%2C4.765v42.789%20%20%20c0%2C2.628%2C2.138%2C4.766%2C4.767%2C4.766h5.535v0.959c0%2C2.628%2C2.138%2C4.765%2C4.766%2C4.765h42.788c2.628%2C0%2C4.766-2.137%2C4.766-4.765V52.914%20%20%20C76.311%2C50.284%2C74.173%2C48.145%2C71.545%2C48.145z%20M18.455%2C16.935h16.344c2.1%2C0%2C3.808%2C1.708%2C3.808%2C3.808v27.401H37.25V22.636%20%20%20c0-0.264-0.215-0.478-0.479-0.478H16.482c-0.264%2C0-0.479%2C0.214-0.479%2C0.478v36.585c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h7.507v7.644%20%20%20h-5.534c-2.101%2C0-3.81-1.709-3.81-3.81V20.743C14.645%2C18.643%2C16.354%2C16.935%2C18.455%2C16.935z%20M16.96%2C23.116h19.331v25.031h-7.535%20%20%20c-2.628%2C0-4.766%2C2.139-4.766%2C4.768v5.828h-7.03V23.116z%20M71.545%2C73.064H28.757c-2.101%2C0-3.81-1.708-3.81-3.808V52.914%20%20%20c0-2.102%2C1.709-3.812%2C3.81-3.812h42.788c2.1%2C0%2C3.809%2C1.71%2C3.809%2C3.812v16.343C75.354%2C71.356%2C73.645%2C73.064%2C71.545%2C73.064z%22%3E%3C/path%3E%3Cpath%20d%3D%22M28.919%2C58.424c-1.466%2C0-2.659%2C1.193-2.659%2C2.66c0%2C1.466%2C1.193%2C2.658%2C2.659%2C2.658c1.468%2C0%2C2.662-1.192%2C2.662-2.658%20%20%20C31.581%2C59.617%2C30.387%2C58.424%2C28.919%2C58.424z%20M28.919%2C62.786c-0.939%2C0-1.703-0.764-1.703-1.702c0-0.939%2C0.764-1.704%2C1.703-1.704%20%20%20c0.94%2C0%2C1.705%2C0.765%2C1.705%2C1.704C30.623%2C62.022%2C29.858%2C62.786%2C28.919%2C62.786z%22%3E%3C/path%3E%3Cpath%20d%3D%22M69.654%2C50.461H33.069c-0.264%2C0-0.479%2C0.215-0.479%2C0.479v20.288c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h36.585%20%20%20c0.263%2C0%2C0.477-0.214%2C0.477-0.478V50.939C70.131%2C50.676%2C69.917%2C50.461%2C69.654%2C50.461z%20M69.174%2C51.417V70.75H33.548V51.417H69.174z%22%3E%3C/path%3E%3Cpath%20d%3D%22M45.201%2C30.296c6.651%2C0%2C12.233%2C5.351%2C12.551%2C11.977l-3.033-2.638c-0.193-0.165-0.507-0.142-0.675%2C0.048%20%20%20c-0.174%2C0.198-0.153%2C0.501%2C0.045%2C0.676l3.883%2C3.375c0.09%2C0.075%2C0.198%2C0.115%2C0.312%2C0.115c0.141%2C0%2C0.273-0.061%2C0.362-0.166%20%20%20l3.371-3.877c0.173-0.2%2C0.151-0.502-0.047-0.675c-0.194-0.166-0.508-0.144-0.676%2C0.048l-2.592%2C2.979%20%20%20c-0.18-3.417-1.629-6.605-4.099-9.001c-2.538-2.461-5.877-3.817-9.404-3.817c-0.264%2C0-0.479%2C0.215-0.479%2C0.479%20%20%20C44.72%2C30.083%2C44.936%2C30.296%2C45.201%2C30.296z%22%3E%3C/path%3E%3C/g%3E%3C/svg%3E) center no-repeat;
  background-size: 50% 50%;
  bottom: 0;
  font-size: 14px;
  font-weight: 600;
  left: 0;
  line-height: 20px;
  right: 0;
  position: fixed;
  top: 0;
  z-index: 9999999;
}

.a-orientation-modal:after {
  color: #666;
  content: "Insert phone into Cardboard holder.";
  display: block;
  position: absolute;
  text-align: center;
  top: 70%;
  transform: translateY(-70%);
  width: 100%;
}

.a-orientation-modal button {
  background: url(data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%20100%20100%22%20enable-background%3D%22new%200%200%20100%20100%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpath%20fill%3D%22%23000000%22%20d%3D%22M55.209%2C50l17.803-17.803c1.416-1.416%2C1.416-3.713%2C0-5.129c-1.416-1.417-3.713-1.417-5.129%2C0L50.08%2C44.872%20%20L32.278%2C27.069c-1.416-1.417-3.714-1.417-5.129%2C0c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129L44.951%2C50L27.149%2C67.803%20%20c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129c0.708%2C0.708%2C1.636%2C1.062%2C2.564%2C1.062c0.928%2C0%2C1.856-0.354%2C2.564-1.062L50.08%2C55.13l17.803%2C17.802%20%20c0.708%2C0.708%2C1.637%2C1.062%2C2.564%2C1.062s1.856-0.354%2C2.564-1.062c1.416-1.416%2C1.416-3.713%2C0-5.129L55.209%2C50z%22%3E%3C/path%3E%3C/svg%3E) no-repeat;
  border: none;
  height: 50px;
  text-indent: -9999px;
  width: 50px;
}

.a-loader-title {
  background-color: rgba(0, 0, 0, 0.6);
  font-family: sans-serif, monospace;
  text-align: center;
  font-size: 20px;
  height: 50px;
  font-weight: 300;
  line-height: 50px;
  position: absolute;
  right: 0px;
  left: 0px;
  top: 0px;
  color: white;
}

.a-modal {
  position: absolute;
  background: rgba(0, 0, 0, 0.60);
  background-size: 50% 50%;
  bottom: 0;
  font-size: 14px;
  font-weight: 600;
  left: 0;
  line-height: 20px;
  right: 0;
  position: fixed;
  top: 0;
  z-index: 9999999;
}

.a-dialog {
  position: relative;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  z-index: 199995;
  width: 300px;
  height: 200px;
  background-size: contain;
  background-color: white;
  font-family: sans-serif, monospace;
  font-size: 20px;
  border-radius: 3px;
  padding: 6px;
}

.a-dialog-text-container {
  width: 100%;
  height: 70%;
  align-self: flex-start;
  display: flex;
  justify-content: center;
  align-content: center;
  flex-direction: column;
}

.a-dialog-text {
  display: inline-block;
  font-weight: normal;
  font-size: 14pt;
  margin: 8px;
}

.a-dialog-buttons-container {
  display: inline-flex;
  align-self: flex-end;
  width: 100%;
  height: 30%;
}

.a-dialog-button {
  cursor: pointer;
  align-self: center;
  opacity: 0.9;
  height: 80%;
  width: 50%;
  font-size: 12pt;
  margin: 4px;
  border-radius: 2px;
  text-align:center;
  border: none;
  display: inline-block;
  -webkit-transition: all 0.25s ease-in-out;
  transition: all 0.25s ease-in-out;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.10), 0 1px 2px rgba(0, 0, 0, 0.20);
  user-select: none;
}

.a-dialog-permission-button:hover {
  box-shadow: 0 7px 14px rgba(0,0,0,0.20), 0 2px 2px rgba(0,0,0,0.20);
}

.a-dialog-allow-button {
  background-color: #00ceff;
}

.a-dialog-deny-button {
  background-color: #ff005b;
}

.a-dialog-ok-button {
  background-color: #00ceff;
  width: 100%;
}

.a-dom-overlay:not(.a-no-style) {
  overflow: hidden;
  position: absolute;
  pointer-events: none;
  box-sizing: border-box;
  bottom: 0;
  left: 0;
  right: 0;
  top: 0;
  padding: 1em;
}

.a-dom-overlay:not(.a-no-style)>* {
  pointer-events: auto;
}
`],sourceRoot:""}]);const O=T},"./node_modules/css-loader/dist/cjs.js!./src/style/rStats.css":(l,u,c)=>{c.r(u),c.d(u,{default:()=>y});var h=c("./node_modules/css-loader/dist/runtime/sourceMaps.js"),p=c.n(h),f=c("./node_modules/css-loader/dist/runtime/api.js"),g=c.n(f),m=g()(p());m.push([l.id,`.rs-base {
  background-color: #333;
  color: #fafafa;
  border-radius: 0;
  font: 10px monospace;
  left: 5px;
  line-height: 1em;
  opacity: 0.85;
  overflow: hidden;
  padding: 10px;
  position: fixed;
  top: 5px;
  width: 300px;
  z-index: 10000;
}

.rs-base div.hidden {
  display: none;
}

.rs-base h1 {
  color: #fff;
  cursor: pointer;
  font-size: 1.4em;
  font-weight: 300;
  margin: 0 0 5px;
  padding: 0;
}

.rs-group {
  display: -webkit-box;
  display: -webkit-flex;
  display: flex;
  -webkit-flex-direction: column-reverse;
  flex-direction: column-reverse;
  margin-bottom: 5px;
}

.rs-group:last-child {
  margin-bottom: 0;
}

.rs-counter-base {
  align-items: center;
  display: -webkit-box;
  display: -webkit-flex;
  display: flex;
  height: 10px;
  -webkit-justify-content: space-between;
  justify-content: space-between;
  margin: 2px 0;
}

.rs-counter-base.alarm {
  color: #b70000;
  text-shadow: 0 0 0 #b70000,
               0 0 1px #fff,
               0 0 1px #fff,
               0 0 2px #fff,
               0 0 2px #fff,
               0 0 3px #fff,
               0 0 3px #fff,
               0 0 4px #fff,
               0 0 4px #fff;
}

.rs-counter-id {
  font-weight: 300;
  -webkit-box-ordinal-group: 0;
  -webkit-order: 0;
  order: 0;
  width: 54px;
}

.rs-counter-value {
  font-weight: 300;
  -webkit-box-ordinal-group: 1;
  -webkit-order: 1;
  order: 1;
  text-align: right;
  width: 35px;
}

.rs-canvas {
  -webkit-box-ordinal-group: 2;
  -webkit-order: 2;
  order: 2;
}

@media (min-width: 480px) {
  .rs-base {
    left: 20px;
    top: 20px;
  }
}
`,"",{version:3,sources:["webpack://./src/style/rStats.css"],names:[],mappings:"AAAA;EACE,sBAAsB;EACtB,cAAc;EACd,gBAAgB;EAChB,oBAAoB;EACpB,SAAS;EACT,gBAAgB;EAChB,aAAa;EACb,gBAAgB;EAChB,aAAa;EACb,eAAe;EACf,QAAQ;EACR,YAAY;EACZ,cAAc;AAChB;;AAEA;EACE,aAAa;AACf;;AAEA;EACE,WAAW;EACX,eAAe;EACf,gBAAgB;EAChB,gBAAgB;EAChB,eAAe;EACf,UAAU;AACZ;;AAEA;EACE,oBAAoB;EACpB,qBAAqB;EACrB,aAAa;EACb,sCAAsC;EACtC,8BAA8B;EAC9B,kBAAkB;AACpB;;AAEA;EACE,gBAAgB;AAClB;;AAEA;EACE,mBAAmB;EACnB,oBAAoB;EACpB,qBAAqB;EACrB,aAAa;EACb,YAAY;EACZ,sCAAsC;EACtC,8BAA8B;EAC9B,aAAa;AACf;;AAEA;EACE,cAAc;EACd;;;;;;;;2BAQyB;AAC3B;;AAEA;EACE,gBAAgB;EAChB,4BAA4B;EAC5B,gBAAgB;EAChB,QAAQ;EACR,WAAW;AACb;;AAEA;EACE,gBAAgB;EAChB,4BAA4B;EAC5B,gBAAgB;EAChB,QAAQ;EACR,iBAAiB;EACjB,WAAW;AACb;;AAEA;EACE,4BAA4B;EAC5B,gBAAgB;EAChB,QAAQ;AACV;;AAEA;EACE;IACE,UAAU;IACV,SAAS;EACX;AACF",sourcesContent:[`.rs-base {
  background-color: #333;
  color: #fafafa;
  border-radius: 0;
  font: 10px monospace;
  left: 5px;
  line-height: 1em;
  opacity: 0.85;
  overflow: hidden;
  padding: 10px;
  position: fixed;
  top: 5px;
  width: 300px;
  z-index: 10000;
}

.rs-base div.hidden {
  display: none;
}

.rs-base h1 {
  color: #fff;
  cursor: pointer;
  font-size: 1.4em;
  font-weight: 300;
  margin: 0 0 5px;
  padding: 0;
}

.rs-group {
  display: -webkit-box;
  display: -webkit-flex;
  display: flex;
  -webkit-flex-direction: column-reverse;
  flex-direction: column-reverse;
  margin-bottom: 5px;
}

.rs-group:last-child {
  margin-bottom: 0;
}

.rs-counter-base {
  align-items: center;
  display: -webkit-box;
  display: -webkit-flex;
  display: flex;
  height: 10px;
  -webkit-justify-content: space-between;
  justify-content: space-between;
  margin: 2px 0;
}

.rs-counter-base.alarm {
  color: #b70000;
  text-shadow: 0 0 0 #b70000,
               0 0 1px #fff,
               0 0 1px #fff,
               0 0 2px #fff,
               0 0 2px #fff,
               0 0 3px #fff,
               0 0 3px #fff,
               0 0 4px #fff,
               0 0 4px #fff;
}

.rs-counter-id {
  font-weight: 300;
  -webkit-box-ordinal-group: 0;
  -webkit-order: 0;
  order: 0;
  width: 54px;
}

.rs-counter-value {
  font-weight: 300;
  -webkit-box-ordinal-group: 1;
  -webkit-order: 1;
  order: 1;
  text-align: right;
  width: 35px;
}

.rs-canvas {
  -webkit-box-ordinal-group: 2;
  -webkit-order: 2;
  order: 2;
}

@media (min-width: 480px) {
  .rs-base {
    left: 20px;
    top: 20px;
  }
}
`],sourceRoot:""}]);const y=m},"./src/style/aframe.css":(l,u,c)=>{c.r(u),c.d(u,{default:()=>I});var h=c("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),p=c.n(h),f=c("./node_modules/style-loader/dist/runtime/styleDomAPI.js"),g=c.n(f),m=c("./node_modules/style-loader/dist/runtime/insertBySelector.js"),y=c.n(m),b=c("./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js"),v=c.n(b),_=c("./node_modules/style-loader/dist/runtime/insertStyleElement.js"),C=c.n(_),E=c("./node_modules/style-loader/dist/runtime/styleTagTransform.js"),T=c.n(E),R=c("./node_modules/css-loader/dist/cjs.js!./src/style/aframe.css"),B={};B.styleTagTransform=T(),B.setAttributes=v(),B.insert=y().bind(null,"head"),B.domAPI=g(),B.insertStyleElement=C(),p()(R.default,B);const I=R.default&&R.default.locals?R.default.locals:void 0},"./src/style/rStats.css":(l,u,c)=>{c.r(u),c.d(u,{default:()=>I});var h=c("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),p=c.n(h),f=c("./node_modules/style-loader/dist/runtime/styleDomAPI.js"),g=c.n(f),m=c("./node_modules/style-loader/dist/runtime/insertBySelector.js"),y=c.n(m),b=c("./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js"),v=c.n(b),_=c("./node_modules/style-loader/dist/runtime/insertStyleElement.js"),C=c.n(_),E=c("./node_modules/style-loader/dist/runtime/styleTagTransform.js"),T=c.n(E),R=c("./node_modules/css-loader/dist/cjs.js!./src/style/rStats.css"),B={};B.styleTagTransform=T(),B.setAttributes=v(),B.insert=y().bind(null,"head"),B.domAPI=g(),B.insertStyleElement=C(),p()(R.default,B);const I=R.default&&R.default.locals?R.default.locals:void 0},"./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js":l=>{var u=[];function c(f){for(var g=-1,m=0;m<u.length;m++)if(u[m].identifier===f){g=m;break}return g}function h(f,g){for(var m={},y=[],b=0;b<f.length;b++){var v=f[b],_=g.base?v[0]+g.base:v[0],C=m[_]||0,E="".concat(_," ").concat(C);m[_]=C+1;var T=c(E),R={css:v[1],media:v[2],sourceMap:v[3],supports:v[4],layer:v[5]};if(T!==-1)u[T].references++,u[T].updater(R);else{var B=p(R,g);g.byIndex=b,u.splice(b,0,{identifier:E,updater:B,references:1})}y.push(E)}return y}function p(f,g){var m=g.domAPI(g);m.update(f);var y=function(b){if(b){if(b.css===f.css&&b.media===f.media&&b.sourceMap===f.sourceMap&&b.supports===f.supports&&b.layer===f.layer)return;m.update(f=b)}else m.remove()};return y}l.exports=function(f,g){g=g||{},f=f||[];var m=h(f,g);return function(y){y=y||[];for(var b=0;b<m.length;b++){var v=m[b],_=c(v);u[_].references--}for(var C=h(y,g),E=0;E<m.length;E++){var T=m[E],R=c(T);u[R].references===0&&(u[R].updater(),u.splice(R,1))}m=C}}},"./node_modules/style-loader/dist/runtime/insertBySelector.js":l=>{var u={};function c(p){if(typeof u[p]>"u"){var f=document.querySelector(p);if(window.HTMLIFrameElement&&f instanceof window.HTMLIFrameElement)try{f=f.contentDocument.head}catch{f=null}u[p]=f}return u[p]}function h(p,f){var g=c(p);if(!g)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");g.appendChild(f)}l.exports=h},"./node_modules/style-loader/dist/runtime/insertStyleElement.js":l=>{function u(c){var h=document.createElement("style");return c.setAttributes(h,c.attributes),c.insert(h,c.options),h}l.exports=u},"./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js":(l,u,c)=>{function h(p){var f=c.nc;f&&p.setAttribute("nonce",f)}l.exports=h},"./node_modules/style-loader/dist/runtime/styleDomAPI.js":l=>{function u(p,f,g){var m="";g.supports&&(m+="@supports (".concat(g.supports,") {")),g.media&&(m+="@media ".concat(g.media," {"));var y=typeof g.layer<"u";y&&(m+="@layer".concat(g.layer.length>0?" ".concat(g.layer):""," {")),m+=g.css,y&&(m+="}"),g.media&&(m+="}"),g.supports&&(m+="}");var b=g.sourceMap;b&&typeof btoa<"u"&&(m+=`
/*# sourceMappingURL=data:application/json;base64,`.concat(btoa(unescape(encodeURIComponent(JSON.stringify(b))))," */")),f.styleTagTransform(m,p,f.options)}function c(p){if(p.parentNode===null)return!1;p.parentNode.removeChild(p)}function h(p){if(typeof document>"u")return{update:function(){},remove:function(){}};var f=p.insertStyleElement(p);return{update:function(g){u(f,p,g)},remove:function(){c(f)}}}l.exports=h},"./node_modules/style-loader/dist/runtime/styleTagTransform.js":l=>{function u(c,h){if(h.styleSheet)h.styleSheet.cssText=c;else{for(;h.firstChild;)h.removeChild(h.firstChild);h.appendChild(document.createTextNode(c))}}l.exports=u},"data:image/svg+xml,%3C%3Fxml version=%271.0%27 encoding=%27UTF-8%27 standalone=%27no%27%3F%3E%3Csvg width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27 version=%271.1%27 id=%27svg320%27 sodipodi:docname=%27fullscreen-aframe.svg%27 xml:space=%27preserve%27 inkscape:version=%271.2.1 %289c6d41e  2022-07-14%29%27 xmlns:inkscape=%27http://www.inkscape.org/namespaces/inkscape%27 xmlns:sodipodi=%27http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd%27 xmlns=%27http://www.w3.org/2000/svg%27 xmlns:svg=%27http://www.w3.org/2000/svg%27 xmlns:rdf=%27http://www.w3.org/1999/02/22-rdf-syntax-ns%23%27 xmlns:cc=%27http://creativecommons.org/ns%23%27 xmlns:dc=%27http://purl.org/dc/elements/1.1/%27%3E%3Cdefs id=%27defs324%27 /%3E%3Csodipodi:namedview id=%27namedview322%27 pagecolor=%27%23ffffff%27 bordercolor=%27%23000000%27 borderopacity=%270.25%27 inkscape:showpageshadow=%272%27 inkscape:pageopacity=%270.0%27 inkscape:pagecheckerboard=%270%27 inkscape:deskcolor=%27%23d1d1d1%27 showgrid=%27false%27 inkscape:zoom=%273.8064516%27 inkscape:cx=%2791.423729%27 inkscape:cy=%27-1.4449153%27 inkscape:window-width=%271440%27 inkscape:window-height=%27847%27 inkscape:window-x=%2732%27 inkscape:window-y=%2725%27 inkscape:window-maximized=%270%27 inkscape:current-layer=%27svg320%27 /%3E%3Ctitle id=%27title312%27%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M96 0H12A12 12 0 0 0 0 12V50A12 12 0 0 0 12 62H96a12 12 0 0 0 12-12V12A12 12 0 0 0 96 0Zm8 50a8 8 0 0 1-8 8H12a8 8 0 0 1-8-8V12a8 8 0 0 1 8-8H96a8 8 0 0 1 8 8Z%27 fill=%27%23fff%27 id=%27path314%27 style=%27fill:%23ffffff%27 /%3E%3Cg id=%27g356%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g358%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g360%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g362%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g364%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g366%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g368%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g370%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g372%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g374%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g376%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g378%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g380%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g382%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g384%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cmetadata id=%27metadata561%27%3E%3Crdf:RDF%3E%3Ccc:Work rdf:about=%27%27%3E%3Cdc:title%3Eaframe-armode-noborder-reduced-tracking%3C/dc:title%3E%3C/cc:Work%3E%3C/rdf:RDF%3E%3C/metadata%3E%3Cpath d=%27m 98.168511 40.083649 c 0 -1.303681 -0.998788 -2.358041 -2.239389 -2.358041 -1.230088 0.0031 -2.240892 1.05436 -2.240892 2.358041 v 4.881296 l -9.041661 -9.041662 c -0.874129 -0.875631 -2.288954 -0.875631 -3.16308 0 -0.874129 0.874126 -0.874129 2.293459 0 3.167585 l 8.995101 8.992101 h -4.858767 c -1.323206 0.0031 -2.389583 1.004796 -2.389583 2.239386 0 1.237598 1.066377 2.237888 2.389583 2.237888 h 10.154599 c 1.323206 0 2.388082 -0.998789 2.392587 -2.237888 -0.0044 -0.03305 -0.009 -0.05858 -0.0134 -0.09161 0.0046 -0.04207 0.0134 -0.08712 0.0134 -0.13066 V 40.085172 h -1.52e-4%27 id=%27path596%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 23.091002 35.921781 -9.026643 9.041662 v -4.881296 c 0 -1.303681 -1.009302 -2.355037 -2.242393 -2.358041 -1.237598 0 -2.237888 1.05436 -2.237888 2.358041 l -0.0031 10.016421 c 0 0.04356 0.01211 0.08862 0.0015 0.130659 -0.0031 0.03153 -0.009 0.05709 -0.01211 0.09161 0.0031 1.239099 1.069379 2.237888 2.391085 2.237888 h 10.156101 c 1.320202 0 2.388079 -1.000291 2.388079 -2.237888 0 -1.234591 -1.067877 -2.236383 -2.388079 -2.239387 h -4.858767 l 8.995101 -8.9921 c 0.871126 -0.874127 0.871126 -2.293459 0 -3.167586 -0.875628 -0.877132 -2.291957 -0.877132 -3.169087 -1.52e-4%27 id=%27path598%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 84.649572 25.978033 9.041662 -9.041664 v 4.881298 c 0 1.299176 1.010806 2.350532 2.240891 2.355037 1.240601 0 2.23939 -1.055861 2.23939 -2.355037 V 11.798242 c 0 -0.04356 -0.009 -0.08862 -0.0134 -0.127671 0.0044 -0.03153 0.009 -0.06157 0.0134 -0.09313 -0.0044 -1.240598 -1.069379 -2.2393873 -2.391085 -2.2393873 h -10.1546 c -1.323205 0 -2.38958 0.9987893 -2.38958 2.2393873 0 1.233091 1.066375 2.237887 2.38958 2.240891 h 4.858768 l -8.995102 8.9921 c -0.874129 0.872625 -0.874129 2.288954 0 3.161578 0.874127 0.880137 2.288951 0.880137 3.16308 1.5e-4%27 id=%27path600%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 17.264988 13.822853 h 4.857265 c 1.320202 -0.0031 2.388079 -1.0078 2.388079 -2.240889 0 -1.240601 -1.067877 -2.2393893 -2.388079 -2.2393893 H 11.967654 c -1.321707 0 -2.388082 0.9987883 -2.391085 2.2393893 0.0031 0.03153 0.009 0.06157 0.01211 0.09313 -0.0031 0.03905 -0.0015 0.08262 -0.0015 0.127671 l 0.0031 10.020926 c 0 1.299176 1.00029 2.355038 2.237887 2.355038 1.233092 -0.0044 2.242393 -1.055862 2.242393 -2.355038 v -4.881295 l 9.026644 9.041661 c 0.877132 0.878635 2.293459 0.878635 3.169087 0 0.871125 -0.872624 0.871125 -2.288953 0 -3.161577 l -8.995282 -8.993616%27 id=%27path602%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3C/svg%3E":l=>{l.exports="data:image/svg+xml,%3C%3Fxml version=%271.0%27 encoding=%27UTF-8%27 standalone=%27no%27%3F%3E%3Csvg width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27 version=%271.1%27 id=%27svg320%27 sodipodi:docname=%27fullscreen-aframe.svg%27 xml:space=%27preserve%27 inkscape:version=%271.2.1 %289c6d41e  2022-07-14%29%27 xmlns:inkscape=%27http://www.inkscape.org/namespaces/inkscape%27 xmlns:sodipodi=%27http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd%27 xmlns=%27http://www.w3.org/2000/svg%27 xmlns:svg=%27http://www.w3.org/2000/svg%27 xmlns:rdf=%27http://www.w3.org/1999/02/22-rdf-syntax-ns%23%27 xmlns:cc=%27http://creativecommons.org/ns%23%27 xmlns:dc=%27http://purl.org/dc/elements/1.1/%27%3E%3Cdefs id=%27defs324%27 /%3E%3Csodipodi:namedview id=%27namedview322%27 pagecolor=%27%23ffffff%27 bordercolor=%27%23000000%27 borderopacity=%270.25%27 inkscape:showpageshadow=%272%27 inkscape:pageopacity=%270.0%27 inkscape:pagecheckerboard=%270%27 inkscape:deskcolor=%27%23d1d1d1%27 showgrid=%27false%27 inkscape:zoom=%273.8064516%27 inkscape:cx=%2791.423729%27 inkscape:cy=%27-1.4449153%27 inkscape:window-width=%271440%27 inkscape:window-height=%27847%27 inkscape:window-x=%2732%27 inkscape:window-y=%2725%27 inkscape:window-maximized=%270%27 inkscape:current-layer=%27svg320%27 /%3E%3Ctitle id=%27title312%27%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M96 0H12A12 12 0 0 0 0 12V50A12 12 0 0 0 12 62H96a12 12 0 0 0 12-12V12A12 12 0 0 0 96 0Zm8 50a8 8 0 0 1-8 8H12a8 8 0 0 1-8-8V12a8 8 0 0 1 8-8H96a8 8 0 0 1 8 8Z%27 fill=%27%23fff%27 id=%27path314%27 style=%27fill:%23ffffff%27 /%3E%3Cg id=%27g356%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g358%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g360%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g362%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g364%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g366%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g368%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g370%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g372%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g374%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g376%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g378%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g380%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g382%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g384%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cmetadata id=%27metadata561%27%3E%3Crdf:RDF%3E%3Ccc:Work rdf:about=%27%27%3E%3Cdc:title%3Eaframe-armode-noborder-reduced-tracking%3C/dc:title%3E%3C/cc:Work%3E%3C/rdf:RDF%3E%3C/metadata%3E%3Cpath d=%27m 98.168511 40.083649 c 0 -1.303681 -0.998788 -2.358041 -2.239389 -2.358041 -1.230088 0.0031 -2.240892 1.05436 -2.240892 2.358041 v 4.881296 l -9.041661 -9.041662 c -0.874129 -0.875631 -2.288954 -0.875631 -3.16308 0 -0.874129 0.874126 -0.874129 2.293459 0 3.167585 l 8.995101 8.992101 h -4.858767 c -1.323206 0.0031 -2.389583 1.004796 -2.389583 2.239386 0 1.237598 1.066377 2.237888 2.389583 2.237888 h 10.154599 c 1.323206 0 2.388082 -0.998789 2.392587 -2.237888 -0.0044 -0.03305 -0.009 -0.05858 -0.0134 -0.09161 0.0046 -0.04207 0.0134 -0.08712 0.0134 -0.13066 V 40.085172 h -1.52e-4%27 id=%27path596%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 23.091002 35.921781 -9.026643 9.041662 v -4.881296 c 0 -1.303681 -1.009302 -2.355037 -2.242393 -2.358041 -1.237598 0 -2.237888 1.05436 -2.237888 2.358041 l -0.0031 10.016421 c 0 0.04356 0.01211 0.08862 0.0015 0.130659 -0.0031 0.03153 -0.009 0.05709 -0.01211 0.09161 0.0031 1.239099 1.069379 2.237888 2.391085 2.237888 h 10.156101 c 1.320202 0 2.388079 -1.000291 2.388079 -2.237888 0 -1.234591 -1.067877 -2.236383 -2.388079 -2.239387 h -4.858767 l 8.995101 -8.9921 c 0.871126 -0.874127 0.871126 -2.293459 0 -3.167586 -0.875628 -0.877132 -2.291957 -0.877132 -3.169087 -1.52e-4%27 id=%27path598%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 84.649572 25.978033 9.041662 -9.041664 v 4.881298 c 0 1.299176 1.010806 2.350532 2.240891 2.355037 1.240601 0 2.23939 -1.055861 2.23939 -2.355037 V 11.798242 c 0 -0.04356 -0.009 -0.08862 -0.0134 -0.127671 0.0044 -0.03153 0.009 -0.06157 0.0134 -0.09313 -0.0044 -1.240598 -1.069379 -2.2393873 -2.391085 -2.2393873 h -10.1546 c -1.323205 0 -2.38958 0.9987893 -2.38958 2.2393873 0 1.233091 1.066375 2.237887 2.38958 2.240891 h 4.858768 l -8.995102 8.9921 c -0.874129 0.872625 -0.874129 2.288954 0 3.161578 0.874127 0.880137 2.288951 0.880137 3.16308 1.5e-4%27 id=%27path600%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 17.264988 13.822853 h 4.857265 c 1.320202 -0.0031 2.388079 -1.0078 2.388079 -2.240889 0 -1.240601 -1.067877 -2.2393893 -2.388079 -2.2393893 H 11.967654 c -1.321707 0 -2.388082 0.9987883 -2.391085 2.2393893 0.0031 0.03153 0.009 0.06157 0.01211 0.09313 -0.0031 0.03905 -0.0015 0.08262 -0.0015 0.127671 l 0.0031 10.020926 c 0 1.299176 1.00029 2.355038 2.237887 2.355038 1.233092 -0.0044 2.242393 -1.055862 2.242393 -2.355038 v -4.881295 l 9.026644 9.041661 c 0.877132 0.878635 2.293459 0.878635 3.169087 0 0.871125 -0.872624 0.871125 -2.288953 0 -3.161577 l -8.995282 -8.993616%27 id=%27path602%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3C/svg%3E"},"data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27%3E%3Ctitle%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0Zm8,50a8,8,0,0,1-8,8H12a8,8,0,0,1-8-8V12a8,8,0,0,1,8-8H96a8,8,0,0,1,8,8Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M43.35,39.82H32.51L30.45,46H23.88L35,16h5.73L52,46H45.43Zm-9.17-5h7.5L37.91,23.58Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M68.11,35H63.18V46H57V16H68.15q5.31,0,8.2,2.37a8.18,8.18,0,0,1,2.88,6.7,9.22,9.22,0,0,1-1.33,5.12,9.09,9.09,0,0,1-4,3.26l6.49,12.26V46H73.73Zm-4.93-5h5a5.09,5.09,0,0,0,3.6-1.18,4.21,4.21,0,0,0,1.28-3.27,4.56,4.56,0,0,0-1.2-3.34A5,5,0,0,0,68.15,21h-5Z%27 fill=%27%23fff%27/%3E%3C/svg%3E":l=>{l.exports="data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27%3E%3Ctitle%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0Zm8,50a8,8,0,0,1-8,8H12a8,8,0,0,1-8-8V12a8,8,0,0,1,8-8H96a8,8,0,0,1,8,8Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M43.35,39.82H32.51L30.45,46H23.88L35,16h5.73L52,46H45.43Zm-9.17-5h7.5L37.91,23.58Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M68.11,35H63.18V46H57V16H68.15q5.31,0,8.2,2.37a8.18,8.18,0,0,1,2.88,6.7,9.22,9.22,0,0,1-1.33,5.12,9.09,9.09,0,0,1-4,3.26l6.49,12.26V46H73.73Zm-4.93-5h5a5.09,5.09,0,0,0,3.6-1.18,4.21,4.21,0,0,0,1.28-3.27,4.56,4.56,0,0,0-1.2-3.34A5,5,0,0,0,68.15,21h-5Z%27 fill=%27%23fff%27/%3E%3C/svg%3E"},"data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27%3E%3Ctitle%3Eaframe-vrmode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M68.81,21.56H64.23v8.27h4.58a4.13,4.13,0,0,0,3.1-1.09,4.2,4.2,0,0,0,1-3,4.24,4.24,0,0,0-1-3A4.05,4.05,0,0,0,68.81,21.56Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0ZM41.9,46H34L24,16h8l6,21.84,6-21.84H52Zm39.29,0H73.44L68.15,35.39H64.23V46H57V16H68.81q5.32,0,8.34,2.37a8,8,0,0,1,3,6.69,9.68,9.68,0,0,1-1.27,5.18,8.9,8.9,0,0,1-4,3.34l6.26,12.11Z%27 fill=%27%23fff%27/%3E%3C/svg%3E":l=>{l.exports="data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27%3E%3Ctitle%3Eaframe-vrmode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M68.81,21.56H64.23v8.27h4.58a4.13,4.13,0,0,0,3.1-1.09,4.2,4.2,0,0,0,1-3,4.24,4.24,0,0,0-1-3A4.05,4.05,0,0,0,68.81,21.56Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0ZM41.9,46H34L24,16h8l6,21.84,6-21.84H52Zm39.29,0H73.44L68.15,35.39H64.23V46H57V16H68.81q5.32,0,8.34,2.37a8,8,0,0,1,3,6.69,9.68,9.68,0,0,1-1.27,5.18,8.9,8.9,0,0,1-4,3.34l6.26,12.11Z%27 fill=%27%23fff%27/%3E%3C/svg%3E"},"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%20100%20100%22%20enable-background%3D%22new%200%200%20100%20100%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpath%20fill%3D%22%23000000%22%20d%3D%22M55.209%2C50l17.803-17.803c1.416-1.416%2C1.416-3.713%2C0-5.129c-1.416-1.417-3.713-1.417-5.129%2C0L50.08%2C44.872%20%20L32.278%2C27.069c-1.416-1.417-3.714-1.417-5.129%2C0c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129L44.951%2C50L27.149%2C67.803%20%20c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129c0.708%2C0.708%2C1.636%2C1.062%2C2.564%2C1.062c0.928%2C0%2C1.856-0.354%2C2.564-1.062L50.08%2C55.13l17.803%2C17.802%20%20c0.708%2C0.708%2C1.637%2C1.062%2C2.564%2C1.062s1.856-0.354%2C2.564-1.062c1.416-1.416%2C1.416-3.713%2C0-5.129L55.209%2C50z%22%3E%3C/path%3E%3C/svg%3E":l=>{l.exports="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%20100%20100%22%20enable-background%3D%22new%200%200%20100%20100%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpath%20fill%3D%22%23000000%22%20d%3D%22M55.209%2C50l17.803-17.803c1.416-1.416%2C1.416-3.713%2C0-5.129c-1.416-1.417-3.713-1.417-5.129%2C0L50.08%2C44.872%20%20L32.278%2C27.069c-1.416-1.417-3.714-1.417-5.129%2C0c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129L44.951%2C50L27.149%2C67.803%20%20c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129c0.708%2C0.708%2C1.636%2C1.062%2C2.564%2C1.062c0.928%2C0%2C1.856-0.354%2C2.564-1.062L50.08%2C55.13l17.803%2C17.802%20%20c0.708%2C0.708%2C1.637%2C1.062%2C2.564%2C1.062s1.856-0.354%2C2.564-1.062c1.416-1.416%2C1.416-3.713%2C0-5.129L55.209%2C50z%22%3E%3C/path%3E%3C/svg%3E"},"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%2090%2090%22%20enable-background%3D%22new%200%200%2090%2090%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpolygon%20points%3D%220%2C0%200%2C0%200%2C0%20%22%3E%3C/polygon%3E%3Cg%3E%3Cpath%20d%3D%22M71.545%2C48.145h-31.98V20.743c0-2.627-2.138-4.765-4.765-4.765H18.456c-2.628%2C0-4.767%2C2.138-4.767%2C4.765v42.789%20%20%20c0%2C2.628%2C2.138%2C4.766%2C4.767%2C4.766h5.535v0.959c0%2C2.628%2C2.138%2C4.765%2C4.766%2C4.765h42.788c2.628%2C0%2C4.766-2.137%2C4.766-4.765V52.914%20%20%20C76.311%2C50.284%2C74.173%2C48.145%2C71.545%2C48.145z%20M18.455%2C16.935h16.344c2.1%2C0%2C3.808%2C1.708%2C3.808%2C3.808v27.401H37.25V22.636%20%20%20c0-0.264-0.215-0.478-0.479-0.478H16.482c-0.264%2C0-0.479%2C0.214-0.479%2C0.478v36.585c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h7.507v7.644%20%20%20h-5.534c-2.101%2C0-3.81-1.709-3.81-3.81V20.743C14.645%2C18.643%2C16.354%2C16.935%2C18.455%2C16.935z%20M16.96%2C23.116h19.331v25.031h-7.535%20%20%20c-2.628%2C0-4.766%2C2.139-4.766%2C4.768v5.828h-7.03V23.116z%20M71.545%2C73.064H28.757c-2.101%2C0-3.81-1.708-3.81-3.808V52.914%20%20%20c0-2.102%2C1.709-3.812%2C3.81-3.812h42.788c2.1%2C0%2C3.809%2C1.71%2C3.809%2C3.812v16.343C75.354%2C71.356%2C73.645%2C73.064%2C71.545%2C73.064z%22%3E%3C/path%3E%3Cpath%20d%3D%22M28.919%2C58.424c-1.466%2C0-2.659%2C1.193-2.659%2C2.66c0%2C1.466%2C1.193%2C2.658%2C2.659%2C2.658c1.468%2C0%2C2.662-1.192%2C2.662-2.658%20%20%20C31.581%2C59.617%2C30.387%2C58.424%2C28.919%2C58.424z%20M28.919%2C62.786c-0.939%2C0-1.703-0.764-1.703-1.702c0-0.939%2C0.764-1.704%2C1.703-1.704%20%20%20c0.94%2C0%2C1.705%2C0.765%2C1.705%2C1.704C30.623%2C62.022%2C29.858%2C62.786%2C28.919%2C62.786z%22%3E%3C/path%3E%3Cpath%20d%3D%22M69.654%2C50.461H33.069c-0.264%2C0-0.479%2C0.215-0.479%2C0.479v20.288c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h36.585%20%20%20c0.263%2C0%2C0.477-0.214%2C0.477-0.478V50.939C70.131%2C50.676%2C69.917%2C50.461%2C69.654%2C50.461z%20M69.174%2C51.417V70.75H33.548V51.417H69.174z%22%3E%3C/path%3E%3Cpath%20d%3D%22M45.201%2C30.296c6.651%2C0%2C12.233%2C5.351%2C12.551%2C11.977l-3.033-2.638c-0.193-0.165-0.507-0.142-0.675%2C0.048%20%20%20c-0.174%2C0.198-0.153%2C0.501%2C0.045%2C0.676l3.883%2C3.375c0.09%2C0.075%2C0.198%2C0.115%2C0.312%2C0.115c0.141%2C0%2C0.273-0.061%2C0.362-0.166%20%20%20l3.371-3.877c0.173-0.2%2C0.151-0.502-0.047-0.675c-0.194-0.166-0.508-0.144-0.676%2C0.048l-2.592%2C2.979%20%20%20c-0.18-3.417-1.629-6.605-4.099-9.001c-2.538-2.461-5.877-3.817-9.404-3.817c-0.264%2C0-0.479%2C0.215-0.479%2C0.479%20%20%20C44.72%2C30.083%2C44.936%2C30.296%2C45.201%2C30.296z%22%3E%3C/path%3E%3C/g%3E%3C/svg%3E":l=>{l.exports="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%2090%2090%22%20enable-background%3D%22new%200%200%2090%2090%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpolygon%20points%3D%220%2C0%200%2C0%200%2C0%20%22%3E%3C/polygon%3E%3Cg%3E%3Cpath%20d%3D%22M71.545%2C48.145h-31.98V20.743c0-2.627-2.138-4.765-4.765-4.765H18.456c-2.628%2C0-4.767%2C2.138-4.767%2C4.765v42.789%20%20%20c0%2C2.628%2C2.138%2C4.766%2C4.767%2C4.766h5.535v0.959c0%2C2.628%2C2.138%2C4.765%2C4.766%2C4.765h42.788c2.628%2C0%2C4.766-2.137%2C4.766-4.765V52.914%20%20%20C76.311%2C50.284%2C74.173%2C48.145%2C71.545%2C48.145z%20M18.455%2C16.935h16.344c2.1%2C0%2C3.808%2C1.708%2C3.808%2C3.808v27.401H37.25V22.636%20%20%20c0-0.264-0.215-0.478-0.479-0.478H16.482c-0.264%2C0-0.479%2C0.214-0.479%2C0.478v36.585c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h7.507v7.644%20%20%20h-5.534c-2.101%2C0-3.81-1.709-3.81-3.81V20.743C14.645%2C18.643%2C16.354%2C16.935%2C18.455%2C16.935z%20M16.96%2C23.116h19.331v25.031h-7.535%20%20%20c-2.628%2C0-4.766%2C2.139-4.766%2C4.768v5.828h-7.03V23.116z%20M71.545%2C73.064H28.757c-2.101%2C0-3.81-1.708-3.81-3.808V52.914%20%20%20c0-2.102%2C1.709-3.812%2C3.81-3.812h42.788c2.1%2C0%2C3.809%2C1.71%2C3.809%2C3.812v16.343C75.354%2C71.356%2C73.645%2C73.064%2C71.545%2C73.064z%22%3E%3C/path%3E%3Cpath%20d%3D%22M28.919%2C58.424c-1.466%2C0-2.659%2C1.193-2.659%2C2.66c0%2C1.466%2C1.193%2C2.658%2C2.659%2C2.658c1.468%2C0%2C2.662-1.192%2C2.662-2.658%20%20%20C31.581%2C59.617%2C30.387%2C58.424%2C28.919%2C58.424z%20M28.919%2C62.786c-0.939%2C0-1.703-0.764-1.703-1.702c0-0.939%2C0.764-1.704%2C1.703-1.704%20%20%20c0.94%2C0%2C1.705%2C0.765%2C1.705%2C1.704C30.623%2C62.022%2C29.858%2C62.786%2C28.919%2C62.786z%22%3E%3C/path%3E%3Cpath%20d%3D%22M69.654%2C50.461H33.069c-0.264%2C0-0.479%2C0.215-0.479%2C0.479v20.288c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h36.585%20%20%20c0.263%2C0%2C0.477-0.214%2C0.477-0.478V50.939C70.131%2C50.676%2C69.917%2C50.461%2C69.654%2C50.461z%20M69.174%2C51.417V70.75H33.548V51.417H69.174z%22%3E%3C/path%3E%3Cpath%20d%3D%22M45.201%2C30.296c6.651%2C0%2C12.233%2C5.351%2C12.551%2C11.977l-3.033-2.638c-0.193-0.165-0.507-0.142-0.675%2C0.048%20%20%20c-0.174%2C0.198-0.153%2C0.501%2C0.045%2C0.676l3.883%2C3.375c0.09%2C0.075%2C0.198%2C0.115%2C0.312%2C0.115c0.141%2C0%2C0.273-0.061%2C0.362-0.166%20%20%20l3.371-3.877c0.173-0.2%2C0.151-0.502-0.047-0.675c-0.194-0.166-0.508-0.144-0.676%2C0.048l-2.592%2C2.979%20%20%20c-0.18-3.417-1.629-6.605-4.099-9.001c-2.538-2.461-5.877-3.817-9.404-3.817c-0.264%2C0-0.479%2C0.215-0.479%2C0.479%20%20%20C44.72%2C30.083%2C44.936%2C30.296%2C45.201%2C30.296z%22%3E%3C/path%3E%3C/g%3E%3C/svg%3E"},"./node_modules/three/build/three.module.js":(l,u,c)=>{c.r(u),c.d(u,{ACESFilmicToneMapping:()=>vt,AddEquation:()=>H,AddOperation:()=>At,AdditiveAnimationBlendMode:()=>Dr,AdditiveBlending:()=>L,AgXToneMapping:()=>ve,AlphaFormat:()=>Ie,AlwaysCompare:()=>kE,AlwaysDepth:()=>$e,AlwaysStencilFunc:()=>fv,AmbientLight:()=>lH,AnimationAction:()=>wH,AnimationClip:()=>qv,AnimationLoader:()=>bIe,AnimationMixer:()=>KIe,AnimationObjectGroup:()=>qIe,AnimationUtils:()=>gIe,ArcCurve:()=>wV,ArrayCamera:()=>ON,ArrowHelper:()=>ABe,AttachedBindMode:()=>Te,Audio:()=>xH,AudioAnalyser:()=>kIe,AudioContext:()=>mL,AudioListener:()=>DIe,AudioLoader:()=>BIe,AxesHelper:()=>yBe,BackSide:()=>R,BasicDepthPacking:()=>su,BasicShadowMap:()=>v,BatchedMesh:()=>mV,Bone:()=>jN,BooleanKeyframeTrack:()=>Lf,Box2:()=>rBe,Box3:()=>Ls,Box3Helper:()=>mBe,BoxGeometry:()=>xf,BoxHelper:()=>fBe,BufferAttribute:()=>as,BufferGeometry:()=>pn,BufferGeometryLoader:()=>pH,ByteType:()=>Ns,Cache:()=>Bh,Camera:()=>aw,CameraHelper:()=>pBe,CanvasTexture:()=>zRe,CapsuleGeometry:()=>Ow,CatmullRomCurve3:()=>CV,CineonToneMapping:()=>yi,CircleGeometry:()=>Pw,ClampToEdgeWrapping:()=>je,Clock:()=>yH,Color:()=>lr,ColorKeyframeTrack:()=>cL,ColorManagement:()=>Yn,CompressedArrayTexture:()=>FRe,CompressedCubeTexture:()=>URe,CompressedTexture:()=>Bw,CompressedTextureLoader:()=>xIe,ConeGeometry:()=>kw,ConstantAlphaFactor:()=>qt,ConstantColorFactor:()=>dt,CubeCamera:()=>AG,CubeReflectionMapping:()=>U,CubeRefractionMapping:()=>$,CubeTexture:()=>Cv,CubeTextureLoader:()=>_Ie,CubeUVReflectionMapping:()=>ce,CubicBezierCurve:()=>JN,CubicBezierCurve3:()=>TV,CubicInterpolant:()=>JV,CullFaceBack:()=>m,CullFaceFront:()=>y,CullFaceFrontBack:()=>b,CullFaceNone:()=>g,Curve:()=>kc,CurvePath:()=>RV,CustomBlending:()=>q,CustomToneMapping:()=>ye,CylinderGeometry:()=>D0,Cylindrical:()=>iBe,Data3DTexture:()=>Kr,DataArrayTexture:()=>o0,DataTexture:()=>qd,DataTextureLoader:()=>EIe,DataUtils:()=>pSe,DecrementStencilOp:()=>SB,DecrementWrapStencilOp:()=>MB,DefaultLoadingManager:()=>eH,DepthFormat:()=>Ye,DepthStencilFormat:()=>lt,DepthTexture:()=>IN,DetachedBindMode:()=>ke,DirectionalLight:()=>oH,DirectionalLightHelper:()=>dBe,DiscreteInterpolant:()=>ZV,DisplayP3ColorSpace:()=>r0,DodecahedronGeometry:()=>Fw,DoubleSide:()=>B,DstAlphaFactor:()=>me,DstColorFactor:()=>Xe,DynamicCopyUsage:()=>VB,DynamicDrawUsage:()=>kB,DynamicReadUsage:()=>zB,EdgesGeometry:()=>IV,EllipseCurve:()=>Nw,EqualCompare:()=>LE,EqualDepth:()=>Ri,EqualStencilFunc:()=>NB,EquirectangularReflectionMapping:()=>re,EquirectangularRefractionMapping:()=>Re,Euler:()=>Rl,EventDispatcher:()=>Bo,ExtrudeGeometry:()=>Ww,FileLoader:()=>Lh,Float16BufferAttribute:()=>vSe,Float32BufferAttribute:()=>br,FloatType:()=>Tt,Fog:()=>fw,FogExp2:()=>pw,FramebufferTexture:()=>kRe,FrontSide:()=>T,Frustum:()=>Sv,GLBufferAttribute:()=>$Ie,GLSL1:()=>WB,GLSL3:()=>gv,GreaterCompare:()=>DE,GreaterDepth:()=>Zi,GreaterEqualCompare:()=>PE,GreaterEqualDepth:()=>Si,GreaterEqualStencilFunc:()=>PB,GreaterStencilFunc:()=>DB,GridHelper:()=>uBe,Group:()=>Sf,HalfFloatType:()=>Jt,HemisphereLight:()=>tH,HemisphereLightHelper:()=>cBe,IcosahedronGeometry:()=>Qw,ImageBitmapLoader:()=>IIe,ImageLoader:()=>Xv,ImageUtils:()=>zd,IncrementStencilOp:()=>CB,IncrementWrapStencilOp:()=>TB,InstancedBufferAttribute:()=>B0,InstancedBufferGeometry:()=>dH,InstancedInterleavedBuffer:()=>ZIe,InstancedMesh:()=>dV,Int16BufferAttribute:()=>ASe,Int32BufferAttribute:()=>ySe,Int8BufferAttribute:()=>fSe,IntType:()=>pe,InterleavedBuffer:()=>mw,InterleavedBufferAttribute:()=>Mf,Interpolant:()=>Hv,InterpolateDiscrete:()=>wr,InterpolateLinear:()=>Tr,InterpolateSmooth:()=>Fr,InvertStencilOp:()=>RB,KeepStencilOp:()=>_h,KeyframeTrack:()=>Fc,LOD:()=>iV,LatheGeometry:()=>Fv,Layers:()=>XE,LessCompare:()=>NE,LessDepth:()=>Ui,LessEqualCompare:()=>mv,LessEqualDepth:()=>hi,LessEqualStencilFunc:()=>LB,LessStencilFunc:()=>BB,Light:()=>Jd,LightProbe:()=>hH,Line:()=>Kd,Line3:()=>nBe,LineBasicMaterial:()=>Po,LineCurve:()=>ZN,LineCurve3:()=>MV,LineDashedMaterial:()=>XV,LineLoop:()=>bV,LineSegments:()=>uu,LinearDisplayP3ColorSpace:()=>df,LinearFilter:()=>Fi,LinearInterpolant:()=>lL,LinearMipMapLinearFilter:()=>vs,LinearMipMapNearestFilter:()=>kr,LinearMipmapLinearFilter:()=>nn,LinearMipmapNearestFilter:()=>gn,LinearSRGBColorSpace:()=>Lc,LinearToneMapping:()=>$t,LinearTransfer:()=>pf,Loader:()=>ol,LoaderUtils:()=>fL,LoadingManager:()=>uL,LoopOnce:()=>pr,LoopPingPong:()=>Qi,LoopRepeat:()=>fr,LuminanceAlphaFormat:()=>Fe,LuminanceFormat:()=>Be,MOUSE:()=>p,Material:()=>fo,MaterialLoader:()=>$w,MathUtils:()=>lN,Matrix3:()=>Xr,Matrix4:()=>mr,MaxEquation:()=>V,Mesh:()=>ua,MeshBasicMaterial:()=>Hd,MeshDepthMaterial:()=>LN,MeshDistanceMaterial:()=>DN,MeshLambertMaterial:()=>QV,MeshMatcapMaterial:()=>qV,MeshNormalMaterial:()=>WV,MeshPhongMaterial:()=>VV,MeshPhysicalMaterial:()=>GV,MeshStandardMaterial:()=>sL,MeshToonMaterial:()=>HV,MinEquation:()=>Q,MirroredRepeatWrapping:()=>pt,MixOperation:()=>Ce,MultiplyBlending:()=>F,MultiplyOperation:()=>Ge,NearestFilter:()=>Lt,NearestMipMapLinearFilter:()=>_r,NearestMipMapNearestFilter:()=>Gt,NearestMipmapLinearFilter:()=>mi,NearestMipmapNearestFilter:()=>xt,NeutralToneMapping:()=>Ne,NeverCompare:()=>BE,NeverDepth:()=>Ei,NeverStencilFunc:()=>IB,NoBlending:()=>I,NoColorSpace:()=>Xa,NoToneMapping:()=>Pt,NormalAnimationBlendMode:()=>hs,NormalBlending:()=>D,NotEqualCompare:()=>OE,NotEqualDepth:()=>Vi,NotEqualStencilFunc:()=>OB,NumberKeyframeTrack:()=>Wv,Object3D:()=>Hn,ObjectLoader:()=>MIe,ObjectSpaceNormalMap:()=>ou,OctahedronGeometry:()=>Gv,OneFactor:()=>te,OneMinusConstantAlphaFactor:()=>yt,OneMinusConstantColorFactor:()=>wt,OneMinusDstAlphaFactor:()=>Pe,OneMinusDstColorFactor:()=>Je,OneMinusSrcAlphaFactor:()=>_e,OneMinusSrcColorFactor:()=>ae,OrthographicCamera:()=>cw,P3Primaries:()=>mf,PCFShadowMap:()=>_,PCFSoftShadowMap:()=>C,PMREMGenerator:()=>MN,Path:()=>kv,PerspectiveCamera:()=>va,Plane:()=>Qd,PlaneGeometry:()=>E0,PlaneHelper:()=>gBe,PointLight:()=>aH,PointLightHelper:()=>oBe,Points:()=>_V,PointsMaterial:()=>WN,PolarGridHelper:()=>hBe,PolyhedronGeometry:()=>Yd,PositionalAudio:()=>PIe,PropertyBinding:()=>zn,PropertyMixer:()=>EH,QuadraticBezierCurve:()=>$N,QuadraticBezierCurve3:()=>eL,Quaternion:()=>Vn,QuaternionKeyframeTrack:()=>P0,QuaternionLinearInterpolant:()=>$V,RED_GREEN_RGTC2_Format:()=>Li,RED_RGTC1_Format:()=>vi,REVISION:()=>h,RGBADepthPacking:()=>au,RGBAFormat:()=>fe,RGBAIntegerFormat:()=>ni,RGBA_ASTC_10x10_Format:()=>be,RGBA_ASTC_10x5_Format:()=>he,RGBA_ASTC_10x6_Format:()=>le,RGBA_ASTC_10x8_Format:()=>de,RGBA_ASTC_12x10_Format:()=>Ee,RGBA_ASTC_12x12_Format:()=>at,RGBA_ASTC_4x4_Format:()=>qr,RGBA_ASTC_5x4_Format:()=>W,RGBA_ASTC_5x5_Format:()=>ue,RGBA_ASTC_6x5_Format:()=>ge,RGBA_ASTC_6x6_Format:()=>Se,RGBA_ASTC_8x5_Format:()=>We,RGBA_ASTC_8x6_Format:()=>Ke,RGBA_ASTC_8x8_Format:()=>mt,RGBA_BPTC_Format:()=>St,RGBA_ETC2_EAC_Format:()=>dn,RGBA_PVRTC_2BPPV1_Format:()=>Kn,RGBA_PVRTC_4BPPV1_Format:()=>Rn,RGBA_S3TC_DXT1_Format:()=>zi,RGBA_S3TC_DXT3_Format:()=>Sr,RGBA_S3TC_DXT5_Format:()=>hr,RGBFormat:()=>se,RGB_BPTC_SIGNED_Format:()=>Qt,RGB_BPTC_UNSIGNED_Format:()=>si,RGB_ETC1_Format:()=>Bi,RGB_ETC2_Format:()=>or,RGB_PVRTC_2BPPV1_Format:()=>_i,RGB_PVRTC_4BPPV1_Format:()=>er,RGB_S3TC_DXT1_Format:()=>wi,RGFormat:()=>ei,RGIntegerFormat:()=>Bt,RawShaderMaterial:()=>jV,Ray:()=>ya,Raycaster:()=>eBe,Rec709Primaries:()=>ff,RectAreaLight:()=>cH,RedFormat:()=>Ct,RedIntegerFormat:()=>Yt,ReinhardToneMapping:()=>Mt,RenderTarget:()=>a0,RepeatWrapping:()=>Ue,ReplaceStencilOp:()=>wB,ReverseSubtractEquation:()=>J,RingGeometry:()=>qw,SIGNED_RED_GREEN_RGTC2_Format:()=>vr,SIGNED_RED_RGTC1_Format:()=>Xt,SRGBColorSpace:()=>On,SRGBTransfer:()=>cs,Scene:()=>YG,ShaderChunk:()=>on,ShaderLib:()=>Pc,ShaderMaterial:()=>Oc,ShadowMaterial:()=>zV,Shape:()=>If,ShapeGeometry:()=>Xw,ShapePath:()=>vBe,ShapeUtils:()=>hu,ShortType:()=>ts,Skeleton:()=>xw,SkeletonHelper:()=>aBe,SkinnedMesh:()=>lV,Source:()=>xs,Sphere:()=>Aa,SphereGeometry:()=>Vv,Spherical:()=>tBe,SphericalHarmonics3:()=>uH,SplineCurve:()=>tL,SpotLight:()=>nH,SpotLightHelper:()=>sBe,Sprite:()=>eV,SpriteMaterial:()=>kN,SrcAlphaFactor:()=>Ae,SrcAlphaSaturateFactor:()=>tt,SrcColorFactor:()=>K,StaticCopyUsage:()=>GB,StaticDrawUsage:()=>gf,StaticReadUsage:()=>UB,StereoCamera:()=>NIe,StreamCopyUsage:()=>HB,StreamDrawUsage:()=>FB,StreamReadUsage:()=>jB,StringKeyframeTrack:()=>Df,SubtractEquation:()=>G,SubtractiveBlending:()=>O,TOUCH:()=>f,TangentSpaceNormalMap:()=>uo,TetrahedronGeometry:()=>Kw,Texture:()=>ds,TextureLoader:()=>wIe,TorusGeometry:()=>Yw,TorusKnotGeometry:()=>Jw,Triangle:()=>Il,TriangleFanDrawMode:()=>Nc,TriangleStripDrawMode:()=>il,TrianglesDrawMode:()=>Cl,TubeGeometry:()=>Zw,UVMapping:()=>Oe,Uint16BufferAttribute:()=>AN,Uint32BufferAttribute:()=>yN,Uint8BufferAttribute:()=>mSe,Uint8ClampedBufferAttribute:()=>gSe,Uniform:()=>yL,UniformsGroup:()=>JIe,UniformsLib:()=>qi,UniformsUtils:()=>fG,UnsignedByteType:()=>An,UnsignedInt248Type:()=>Di,UnsignedInt5999Type:()=>ki,UnsignedIntType:()=>ct,UnsignedShort4444Type:()=>Ni,UnsignedShort5551Type:()=>ar,UnsignedShortType:()=>bs,VSMShadowMap:()=>E,Vector2:()=>oi,Vector3:()=>He,Vector4:()=>Un,VectorKeyframeTrack:()=>Qv,VideoTexture:()=>PRe,WebGL3DRenderTarget:()=>Bn,WebGLArrayRenderTarget:()=>dr,WebGLCoordinateSystem:()=>Wl,WebGLCubeRenderTarget:()=>yG,WebGLMultipleRenderTargets:()=>bBe,WebGLRenderTarget:()=>rl,WebGLRenderer:()=>TRe,WebGLUtils:()=>WG,WebGPUCoordinateSystem:()=>Af,WireframeGeometry:()=>kV,WrapAroundEnding:()=>jr,ZeroCurvatureEnding:()=>Gr,ZeroFactor:()=>z,ZeroSlopeEnding:()=>xn,ZeroStencilOp:()=>EB,createCanvasElement:()=>zE});/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const h="164",p={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},f={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},g=0,m=1,y=2,b=3,v=0,_=1,C=2,E=3,T=0,R=1,B=2,I=0,D=1,L=2,O=3,F=4,q=5,H=100,G=101,J=102,Q=103,V=104,z=200,te=201,K=202,ae=203,Ae=204,_e=205,me=206,Pe=207,Xe=208,Je=209,tt=210,dt=211,wt=212,qt=213,yt=214,Ei=0,$e=1,Ui=2,hi=3,Ri=4,Si=5,Zi=6,Vi=7,Ge=0,Ce=1,At=2,Pt=0,$t=1,Mt=2,yi=3,vt=4,ye=5,ve=6,Ne=7,Te="attached",ke="detached",Oe=300,U=301,$=302,re=303,Re=304,ce=306,Ue=1e3,je=1001,pt=1002,Lt=1003,xt=1004,Gt=1004,mi=1005,_r=1005,Fi=1006,gn=1007,kr=1007,nn=1008,vs=1008,An=1009,Ns=1010,ts=1011,bs=1012,pe=1013,ct=1014,Tt=1015,Jt=1016,Ni=1017,ar=1018,Di=1020,ki=35902,Ie=1021,se=1022,fe=1023,Be=1024,Fe=1025,Ye=1026,lt=1027,Ct=1028,Yt=1029,ei=1030,Bt=1031,ni=1033,wi=33776,zi=33777,Sr=33778,hr=33779,er=35840,_i=35841,Rn=35842,Kn=35843,Bi=36196,or=37492,dn=37496,qr=37808,W=37809,ue=37810,ge=37811,Se=37812,We=37813,Ke=37814,mt=37815,he=37816,le=37817,de=37818,be=37819,Ee=37820,at=37821,St=36492,Qt=36494,si=36495,vi=36283,Xt=36284,Li=36285,vr=36286,pr=2200,fr=2201,Qi=2202,wr=2300,Tr=2301,Fr=2302,Gr=2400,xn=2401,jr=2402,hs=2500,Dr=2501,Cl=0,il=1,Nc=2,su=3200,au=3201,uo=0,ou=1,Xa="",On="srgb",Lc="srgb-linear",r0="display-p3",df="display-p3-linear",pf="linear",cs="srgb",ff="rec709",mf="p3",EB=0,_h=7680,wB=7681,CB=7682,SB=7683,TB=34055,MB=34056,RB=5386,IB=512,BB=513,NB=514,LB=515,DB=516,OB=517,PB=518,fv=519,BE=512,NE=513,LE=514,mv=515,DE=516,OE=517,PE=518,kE=519,gf=35044,kB=35048,FB=35040,UB=35045,zB=35049,jB=35041,GB=35046,VB=35050,HB=35042,WB="100",gv="300 es",Wl=2e3,Af=2001;class Bo{addEventListener(a,d){this._listeners===void 0&&(this._listeners={});const A=this._listeners;A[a]===void 0&&(A[a]=[]),A[a].indexOf(d)===-1&&A[a].push(d)}hasEventListener(a,d){if(this._listeners===void 0)return!1;const A=this._listeners;return A[a]!==void 0&&A[a].indexOf(d)!==-1}removeEventListener(a,d){if(this._listeners===void 0)return;const A=this._listeners[a];if(A!==void 0){const x=A.indexOf(d);x!==-1&&A.splice(x,1)}}dispatchEvent(a){if(this._listeners===void 0)return;const d=this._listeners[a.type];if(d!==void 0){a.target=this;const A=d.slice(0);for(let x=0,w=A.length;x<w;x++)A[x].call(this,a);a.target=null}}}const La=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let FE=1234567;const Eh=Math.PI/180,kd=180/Math.PI;function No(){const S=Math.random()*4294967295|0,a=Math.random()*4294967295|0,d=Math.random()*4294967295|0,A=Math.random()*4294967295|0;return(La[S&255]+La[S>>8&255]+La[S>>16&255]+La[S>>24&255]+"-"+La[a&255]+La[a>>8&255]+"-"+La[a>>16&15|64]+La[a>>24&255]+"-"+La[d&63|128]+La[d>>8&255]+"-"+La[d>>16&255]+La[d>>24&255]+La[A&255]+La[A>>8&255]+La[A>>16&255]+La[A>>24&255]).toLowerCase()}function Ts(S,a,d){return Math.max(a,Math.min(d,S))}function Av(S,a){return(S%a+a)%a}function QB(S,a,d,A,x){return A+(S-a)*(x-A)/(d-a)}function qB(S,a,d){return S!==a?(d-S)/(a-S):0}function yf(S,a,d){return(1-d)*S+d*a}function XB(S,a,d,A){return yf(S,a,1-Math.exp(-d*A))}function KB(S,a=1){return a-Math.abs(Av(S,a*2)-a)}function YB(S,a,d){return S<=a?0:S>=d?1:(S=(S-a)/(d-a),S*S*(3-2*S))}function JB(S,a,d){return S<=a?0:S>=d?1:(S=(S-a)/(d-a),S*S*S*(S*(S*6-15)+10))}function ZB(S,a){return S+Math.floor(Math.random()*(a-S+1))}function $B(S,a){return S+Math.random()*(a-S)}function eN(S){return S*(.5-Math.random())}function tN(S){S!==void 0&&(FE=S);let a=FE+=1831565813;return a=Math.imul(a^a>>>15,a|1),a^=a+Math.imul(a^a>>>7,a|61),((a^a>>>14)>>>0)/4294967296}function iN(S){return S*Eh}function rN(S){return S*kd}function nN(S){return(S&S-1)===0&&S!==0}function sN(S){return Math.pow(2,Math.ceil(Math.log(S)/Math.LN2))}function aN(S){return Math.pow(2,Math.floor(Math.log(S)/Math.LN2))}function oN(S,a,d,A,x){const w=Math.cos,M=Math.sin,N=w(d/2),P=M(d/2),k=w((a+A)/2),j=M((a+A)/2),Y=w((a-A)/2),X=M((a-A)/2),Z=w((A-a)/2),ie=M((A-a)/2);switch(x){case"XYX":S.set(N*j,P*Y,P*X,N*k);break;case"YZY":S.set(P*X,N*j,P*Y,N*k);break;case"ZXZ":S.set(P*Y,P*X,N*j,N*k);break;case"XZX":S.set(N*j,P*ie,P*Z,N*k);break;case"YXY":S.set(P*Z,N*j,P*ie,N*k);break;case"ZYZ":S.set(P*ie,P*Z,N*j,N*k);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+x)}}function Ka(S,a){switch(a.constructor){case Float32Array:return S;case Uint32Array:return S/4294967295;case Uint16Array:return S/65535;case Uint8Array:return S/255;case Int32Array:return Math.max(S/2147483647,-1);case Int16Array:return Math.max(S/32767,-1);case Int8Array:return Math.max(S/127,-1);default:throw new Error("Invalid component type.")}}function Yr(S,a){switch(a.constructor){case Float32Array:return S;case Uint32Array:return Math.round(S*4294967295);case Uint16Array:return Math.round(S*65535);case Uint8Array:return Math.round(S*255);case Int32Array:return Math.round(S*2147483647);case Int16Array:return Math.round(S*32767);case Int8Array:return Math.round(S*127);default:throw new Error("Invalid component type.")}}const lN={DEG2RAD:Eh,RAD2DEG:kd,generateUUID:No,clamp:Ts,euclideanModulo:Av,mapLinear:QB,inverseLerp:qB,lerp:yf,damp:XB,pingpong:KB,smoothstep:YB,smootherstep:JB,randInt:ZB,randFloat:$B,randFloatSpread:eN,seededRandom:tN,degToRad:iN,radToDeg:rN,isPowerOfTwo:nN,ceilPowerOfTwo:sN,floorPowerOfTwo:aN,setQuaternionFromProperEuler:oN,normalize:Yr,denormalize:Ka};class oi{constructor(a=0,d=0){oi.prototype.isVector2=!0,this.x=a,this.y=d}get width(){return this.x}set width(a){this.x=a}get height(){return this.y}set height(a){this.y=a}set(a,d){return this.x=a,this.y=d,this}setScalar(a){return this.x=a,this.y=a,this}setX(a){return this.x=a,this}setY(a){return this.y=a,this}setComponent(a,d){switch(a){case 0:this.x=d;break;case 1:this.y=d;break;default:throw new Error("index is out of range: "+a)}return this}getComponent(a){switch(a){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+a)}}clone(){return new this.constructor(this.x,this.y)}copy(a){return this.x=a.x,this.y=a.y,this}add(a){return this.x+=a.x,this.y+=a.y,this}addScalar(a){return this.x+=a,this.y+=a,this}addVectors(a,d){return this.x=a.x+d.x,this.y=a.y+d.y,this}addScaledVector(a,d){return this.x+=a.x*d,this.y+=a.y*d,this}sub(a){return this.x-=a.x,this.y-=a.y,this}subScalar(a){return this.x-=a,this.y-=a,this}subVectors(a,d){return this.x=a.x-d.x,this.y=a.y-d.y,this}multiply(a){return this.x*=a.x,this.y*=a.y,this}multiplyScalar(a){return this.x*=a,this.y*=a,this}divide(a){return this.x/=a.x,this.y/=a.y,this}divideScalar(a){return this.multiplyScalar(1/a)}applyMatrix3(a){const d=this.x,A=this.y,x=a.elements;return this.x=x[0]*d+x[3]*A+x[6],this.y=x[1]*d+x[4]*A+x[7],this}min(a){return this.x=Math.min(this.x,a.x),this.y=Math.min(this.y,a.y),this}max(a){return this.x=Math.max(this.x,a.x),this.y=Math.max(this.y,a.y),this}clamp(a,d){return this.x=Math.max(a.x,Math.min(d.x,this.x)),this.y=Math.max(a.y,Math.min(d.y,this.y)),this}clampScalar(a,d){return this.x=Math.max(a,Math.min(d,this.x)),this.y=Math.max(a,Math.min(d,this.y)),this}clampLength(a,d){const A=this.length();return this.divideScalar(A||1).multiplyScalar(Math.max(a,Math.min(d,A)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(a){return this.x*a.x+this.y*a.y}cross(a){return this.x*a.y-this.y*a.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(a){const d=Math.sqrt(this.lengthSq()*a.lengthSq());if(d===0)return Math.PI/2;const A=this.dot(a)/d;return Math.acos(Ts(A,-1,1))}distanceTo(a){return Math.sqrt(this.distanceToSquared(a))}distanceToSquared(a){const d=this.x-a.x,A=this.y-a.y;return d*d+A*A}manhattanDistanceTo(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)}setLength(a){return this.normalize().multiplyScalar(a)}lerp(a,d){return this.x+=(a.x-this.x)*d,this.y+=(a.y-this.y)*d,this}lerpVectors(a,d,A){return this.x=a.x+(d.x-a.x)*A,this.y=a.y+(d.y-a.y)*A,this}equals(a){return a.x===this.x&&a.y===this.y}fromArray(a,d=0){return this.x=a[d],this.y=a[d+1],this}toArray(a=[],d=0){return a[d]=this.x,a[d+1]=this.y,a}fromBufferAttribute(a,d){return this.x=a.getX(d),this.y=a.getY(d),this}rotateAround(a,d){const A=Math.cos(d),x=Math.sin(d),w=this.x-a.x,M=this.y-a.y;return this.x=w*A-M*x+a.x,this.y=w*x+M*A+a.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Xr{constructor(a,d,A,x,w,M,N,P,k){Xr.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],a!==void 0&&this.set(a,d,A,x,w,M,N,P,k)}set(a,d,A,x,w,M,N,P,k){const j=this.elements;return j[0]=a,j[1]=x,j[2]=N,j[3]=d,j[4]=w,j[5]=P,j[6]=A,j[7]=M,j[8]=k,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(a){const d=this.elements,A=a.elements;return d[0]=A[0],d[1]=A[1],d[2]=A[2],d[3]=A[3],d[4]=A[4],d[5]=A[5],d[6]=A[6],d[7]=A[7],d[8]=A[8],this}extractBasis(a,d,A){return a.setFromMatrix3Column(this,0),d.setFromMatrix3Column(this,1),A.setFromMatrix3Column(this,2),this}setFromMatrix4(a){const d=a.elements;return this.set(d[0],d[4],d[8],d[1],d[5],d[9],d[2],d[6],d[10]),this}multiply(a){return this.multiplyMatrices(this,a)}premultiply(a){return this.multiplyMatrices(a,this)}multiplyMatrices(a,d){const A=a.elements,x=d.elements,w=this.elements,M=A[0],N=A[3],P=A[6],k=A[1],j=A[4],Y=A[7],X=A[2],Z=A[5],ie=A[8],oe=x[0],ne=x[3],ee=x[6],Me=x[1],we=x[4],xe=x[7],st=x[2],Qe=x[5],Ze=x[8];return w[0]=M*oe+N*Me+P*st,w[3]=M*ne+N*we+P*Qe,w[6]=M*ee+N*xe+P*Ze,w[1]=k*oe+j*Me+Y*st,w[4]=k*ne+j*we+Y*Qe,w[7]=k*ee+j*xe+Y*Ze,w[2]=X*oe+Z*Me+ie*st,w[5]=X*ne+Z*we+ie*Qe,w[8]=X*ee+Z*xe+ie*Ze,this}multiplyScalar(a){const d=this.elements;return d[0]*=a,d[3]*=a,d[6]*=a,d[1]*=a,d[4]*=a,d[7]*=a,d[2]*=a,d[5]*=a,d[8]*=a,this}determinant(){const a=this.elements,d=a[0],A=a[1],x=a[2],w=a[3],M=a[4],N=a[5],P=a[6],k=a[7],j=a[8];return d*M*j-d*N*k-A*w*j+A*N*P+x*w*k-x*M*P}invert(){const a=this.elements,d=a[0],A=a[1],x=a[2],w=a[3],M=a[4],N=a[5],P=a[6],k=a[7],j=a[8],Y=j*M-N*k,X=N*P-j*w,Z=k*w-M*P,ie=d*Y+A*X+x*Z;if(ie===0)return this.set(0,0,0,0,0,0,0,0,0);const oe=1/ie;return a[0]=Y*oe,a[1]=(x*k-j*A)*oe,a[2]=(N*A-x*M)*oe,a[3]=X*oe,a[4]=(j*d-x*P)*oe,a[5]=(x*w-N*d)*oe,a[6]=Z*oe,a[7]=(A*P-k*d)*oe,a[8]=(M*d-A*w)*oe,this}transpose(){let a;const d=this.elements;return a=d[1],d[1]=d[3],d[3]=a,a=d[2],d[2]=d[6],d[6]=a,a=d[5],d[5]=d[7],d[7]=a,this}getNormalMatrix(a){return this.setFromMatrix4(a).invert().transpose()}transposeIntoArray(a){const d=this.elements;return a[0]=d[0],a[1]=d[3],a[2]=d[6],a[3]=d[1],a[4]=d[4],a[5]=d[7],a[6]=d[2],a[7]=d[5],a[8]=d[8],this}setUvTransform(a,d,A,x,w,M,N){const P=Math.cos(w),k=Math.sin(w);return this.set(A*P,A*k,-A*(P*M+k*N)+M+a,-x*k,x*P,-x*(-k*M+P*N)+N+d,0,0,1),this}scale(a,d){return this.premultiply(yv.makeScale(a,d)),this}rotate(a){return this.premultiply(yv.makeRotation(-a)),this}translate(a,d){return this.premultiply(yv.makeTranslation(a,d)),this}makeTranslation(a,d){return a.isVector2?this.set(1,0,a.x,0,1,a.y,0,0,1):this.set(1,0,a,0,1,d,0,0,1),this}makeRotation(a){const d=Math.cos(a),A=Math.sin(a);return this.set(d,-A,0,A,d,0,0,0,1),this}makeScale(a,d){return this.set(a,0,0,0,d,0,0,0,1),this}equals(a){const d=this.elements,A=a.elements;for(let x=0;x<9;x++)if(d[x]!==A[x])return!1;return!0}fromArray(a,d=0){for(let A=0;A<9;A++)this.elements[A]=a[A+d];return this}toArray(a=[],d=0){const A=this.elements;return a[d]=A[0],a[d+1]=A[1],a[d+2]=A[2],a[d+3]=A[3],a[d+4]=A[4],a[d+5]=A[5],a[d+6]=A[6],a[d+7]=A[7],a[d+8]=A[8],a}clone(){return new this.constructor().fromArray(this.elements)}}const yv=new Xr;function UE(S){for(let a=S.length-1;a>=0;--a)if(S[a]>=65535)return!0;return!1}const cN={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Fd(S,a){return new cN[S](a)}function vf(S){return document.createElementNS("http://www.w3.org/1999/xhtml",S)}function zE(){const S=vf("canvas");return S.style.display="block",S}const jE={};function GE(S){S in jE||(jE[S]=!0,console.warn(S))}const VE=new Xr().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),HE=new Xr().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),n0={[Lc]:{transfer:pf,primaries:ff,toReference:S=>S,fromReference:S=>S},[On]:{transfer:cs,primaries:ff,toReference:S=>S.convertSRGBToLinear(),fromReference:S=>S.convertLinearToSRGB()},[df]:{transfer:pf,primaries:mf,toReference:S=>S.applyMatrix3(HE),fromReference:S=>S.applyMatrix3(VE)},[r0]:{transfer:cs,primaries:mf,toReference:S=>S.convertSRGBToLinear().applyMatrix3(HE),fromReference:S=>S.applyMatrix3(VE).convertLinearToSRGB()}},uN=new Set([Lc,df]),Yn={enabled:!0,_workingColorSpace:Lc,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(S){if(!uN.has(S))throw new Error(`Unsupported working color space, "${S}".`);this._workingColorSpace=S},convert:function(S,a,d){if(this.enabled===!1||a===d||!a||!d)return S;const A=n0[a].toReference,x=n0[d].fromReference;return x(A(S))},fromWorkingColorSpace:function(S,a){return this.convert(S,this._workingColorSpace,a)},toWorkingColorSpace:function(S,a){return this.convert(S,a,this._workingColorSpace)},getPrimaries:function(S){return n0[S].primaries},getTransfer:function(S){return S===Xa?pf:n0[S].transfer}};function Ud(S){return S<.04045?S*.0773993808:Math.pow(S*.9478672986+.0521327014,2.4)}function vv(S){return S<.0031308?S*12.92:1.055*Math.pow(S,.41666)-.055}let wh;class zd{static getDataURL(a){if(/^data:/i.test(a.src)||typeof HTMLCanvasElement>"u")return a.src;let d;if(a instanceof HTMLCanvasElement)d=a;else{wh===void 0&&(wh=vf("canvas")),wh.width=a.width,wh.height=a.height;const A=wh.getContext("2d");a instanceof ImageData?A.putImageData(a,0,0):A.drawImage(a,0,0,a.width,a.height),d=wh}return d.width>2048||d.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",a),d.toDataURL("image/jpeg",.6)):d.toDataURL("image/png")}static sRGBToLinear(a){if(typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&a instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&a instanceof ImageBitmap){const d=vf("canvas");d.width=a.width,d.height=a.height;const A=d.getContext("2d");A.drawImage(a,0,0,a.width,a.height);const x=A.getImageData(0,0,a.width,a.height),w=x.data;for(let M=0;M<w.length;M++)w[M]=Ud(w[M]/255)*255;return A.putImageData(x,0,0),d}else if(a.data){const d=a.data.slice(0);for(let A=0;A<d.length;A++)d instanceof Uint8Array||d instanceof Uint8ClampedArray?d[A]=Math.floor(Ud(d[A]/255)*255):d[A]=Ud(d[A]);return{data:d,width:a.width,height:a.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),a}}let WE=0;class xs{constructor(a=null){this.isSource=!0,Object.defineProperty(this,"id",{value:WE++}),this.uuid=No(),this.data=a,this.dataReady=!0,this.version=0}set needsUpdate(a){a===!0&&this.version++}toJSON(a){const d=a===void 0||typeof a=="string";if(!d&&a.images[this.uuid]!==void 0)return a.images[this.uuid];const A={uuid:this.uuid,url:""},x=this.data;if(x!==null){let w;if(Array.isArray(x)){w=[];for(let M=0,N=x.length;M<N;M++)x[M].isDataTexture?w.push(s0(x[M].image)):w.push(s0(x[M]))}else w=s0(x);A.url=w}return d||(a.images[this.uuid]=A),A}}function s0(S){return typeof HTMLImageElement<"u"&&S instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&S instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&S instanceof ImageBitmap?zd.getDataURL(S):S.data?{data:Array.from(S.data),width:S.width,height:S.height,type:S.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let QE=0;class ds extends Bo{constructor(a=ds.DEFAULT_IMAGE,d=ds.DEFAULT_MAPPING,A=je,x=je,w=Fi,M=nn,N=fe,P=An,k=ds.DEFAULT_ANISOTROPY,j=Xa){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:QE++}),this.uuid=No(),this.name="",this.source=new xs(a),this.mipmaps=[],this.mapping=d,this.channel=0,this.wrapS=A,this.wrapT=x,this.magFilter=w,this.minFilter=M,this.anisotropy=k,this.format=N,this.internalFormat=null,this.type=P,this.offset=new oi(0,0),this.repeat=new oi(1,1),this.center=new oi(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Xr,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=j,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(a=null){this.source.data=a}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(a){return this.name=a.name,this.source=a.source,this.mipmaps=a.mipmaps.slice(0),this.mapping=a.mapping,this.channel=a.channel,this.wrapS=a.wrapS,this.wrapT=a.wrapT,this.magFilter=a.magFilter,this.minFilter=a.minFilter,this.anisotropy=a.anisotropy,this.format=a.format,this.internalFormat=a.internalFormat,this.type=a.type,this.offset.copy(a.offset),this.repeat.copy(a.repeat),this.center.copy(a.center),this.rotation=a.rotation,this.matrixAutoUpdate=a.matrixAutoUpdate,this.matrix.copy(a.matrix),this.generateMipmaps=a.generateMipmaps,this.premultiplyAlpha=a.premultiplyAlpha,this.flipY=a.flipY,this.unpackAlignment=a.unpackAlignment,this.colorSpace=a.colorSpace,this.userData=JSON.parse(JSON.stringify(a.userData)),this.needsUpdate=!0,this}toJSON(a){const d=a===void 0||typeof a=="string";if(!d&&a.textures[this.uuid]!==void 0)return a.textures[this.uuid];const A={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(a).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(A.userData=this.userData),d||(a.textures[this.uuid]=A),A}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(a){if(this.mapping!==Oe)return a;if(a.applyMatrix3(this.matrix),a.x<0||a.x>1)switch(this.wrapS){case Ue:a.x=a.x-Math.floor(a.x);break;case je:a.x=a.x<0?0:1;break;case pt:Math.abs(Math.floor(a.x)%2)===1?a.x=Math.ceil(a.x)-a.x:a.x=a.x-Math.floor(a.x);break}if(a.y<0||a.y>1)switch(this.wrapT){case Ue:a.y=a.y-Math.floor(a.y);break;case je:a.y=a.y<0?0:1;break;case pt:Math.abs(Math.floor(a.y)%2)===1?a.y=Math.ceil(a.y)-a.y:a.y=a.y-Math.floor(a.y);break}return this.flipY&&(a.y=1-a.y),a}set needsUpdate(a){a===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(a){a===!0&&this.pmremVersion++}}ds.DEFAULT_IMAGE=null,ds.DEFAULT_MAPPING=Oe,ds.DEFAULT_ANISOTROPY=1;class Un{constructor(a=0,d=0,A=0,x=1){Un.prototype.isVector4=!0,this.x=a,this.y=d,this.z=A,this.w=x}get width(){return this.z}set width(a){this.z=a}get height(){return this.w}set height(a){this.w=a}set(a,d,A,x){return this.x=a,this.y=d,this.z=A,this.w=x,this}setScalar(a){return this.x=a,this.y=a,this.z=a,this.w=a,this}setX(a){return this.x=a,this}setY(a){return this.y=a,this}setZ(a){return this.z=a,this}setW(a){return this.w=a,this}setComponent(a,d){switch(a){case 0:this.x=d;break;case 1:this.y=d;break;case 2:this.z=d;break;case 3:this.w=d;break;default:throw new Error("index is out of range: "+a)}return this}getComponent(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+a)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(a){return this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w!==void 0?a.w:1,this}add(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this.w+=a.w,this}addScalar(a){return this.x+=a,this.y+=a,this.z+=a,this.w+=a,this}addVectors(a,d){return this.x=a.x+d.x,this.y=a.y+d.y,this.z=a.z+d.z,this.w=a.w+d.w,this}addScaledVector(a,d){return this.x+=a.x*d,this.y+=a.y*d,this.z+=a.z*d,this.w+=a.w*d,this}sub(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this.w-=a.w,this}subScalar(a){return this.x-=a,this.y-=a,this.z-=a,this.w-=a,this}subVectors(a,d){return this.x=a.x-d.x,this.y=a.y-d.y,this.z=a.z-d.z,this.w=a.w-d.w,this}multiply(a){return this.x*=a.x,this.y*=a.y,this.z*=a.z,this.w*=a.w,this}multiplyScalar(a){return this.x*=a,this.y*=a,this.z*=a,this.w*=a,this}applyMatrix4(a){const d=this.x,A=this.y,x=this.z,w=this.w,M=a.elements;return this.x=M[0]*d+M[4]*A+M[8]*x+M[12]*w,this.y=M[1]*d+M[5]*A+M[9]*x+M[13]*w,this.z=M[2]*d+M[6]*A+M[10]*x+M[14]*w,this.w=M[3]*d+M[7]*A+M[11]*x+M[15]*w,this}divideScalar(a){return this.multiplyScalar(1/a)}setAxisAngleFromQuaternion(a){this.w=2*Math.acos(a.w);const d=Math.sqrt(1-a.w*a.w);return d<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=a.x/d,this.y=a.y/d,this.z=a.z/d),this}setAxisAngleFromRotationMatrix(a){let d,A,x,w;const M=a.elements,N=M[0],P=M[4],k=M[8],j=M[1],Y=M[5],X=M[9],Z=M[2],ie=M[6],oe=M[10];if(Math.abs(P-j)<.01&&Math.abs(k-Z)<.01&&Math.abs(X-ie)<.01){if(Math.abs(P+j)<.1&&Math.abs(k+Z)<.1&&Math.abs(X+ie)<.1&&Math.abs(N+Y+oe-3)<.1)return this.set(1,0,0,0),this;d=Math.PI;const ee=(N+1)/2,Me=(Y+1)/2,we=(oe+1)/2,xe=(P+j)/4,st=(k+Z)/4,Qe=(X+ie)/4;return ee>Me&&ee>we?ee<.01?(A=0,x=.707106781,w=.707106781):(A=Math.sqrt(ee),x=xe/A,w=st/A):Me>we?Me<.01?(A=.707106781,x=0,w=.707106781):(x=Math.sqrt(Me),A=xe/x,w=Qe/x):we<.01?(A=.707106781,x=.707106781,w=0):(w=Math.sqrt(we),A=st/w,x=Qe/w),this.set(A,x,w,d),this}let ne=Math.sqrt((ie-X)*(ie-X)+(k-Z)*(k-Z)+(j-P)*(j-P));return Math.abs(ne)<.001&&(ne=1),this.x=(ie-X)/ne,this.y=(k-Z)/ne,this.z=(j-P)/ne,this.w=Math.acos((N+Y+oe-1)/2),this}min(a){return this.x=Math.min(this.x,a.x),this.y=Math.min(this.y,a.y),this.z=Math.min(this.z,a.z),this.w=Math.min(this.w,a.w),this}max(a){return this.x=Math.max(this.x,a.x),this.y=Math.max(this.y,a.y),this.z=Math.max(this.z,a.z),this.w=Math.max(this.w,a.w),this}clamp(a,d){return this.x=Math.max(a.x,Math.min(d.x,this.x)),this.y=Math.max(a.y,Math.min(d.y,this.y)),this.z=Math.max(a.z,Math.min(d.z,this.z)),this.w=Math.max(a.w,Math.min(d.w,this.w)),this}clampScalar(a,d){return this.x=Math.max(a,Math.min(d,this.x)),this.y=Math.max(a,Math.min(d,this.y)),this.z=Math.max(a,Math.min(d,this.z)),this.w=Math.max(a,Math.min(d,this.w)),this}clampLength(a,d){const A=this.length();return this.divideScalar(A||1).multiplyScalar(Math.max(a,Math.min(d,A)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(a){return this.normalize().multiplyScalar(a)}lerp(a,d){return this.x+=(a.x-this.x)*d,this.y+=(a.y-this.y)*d,this.z+=(a.z-this.z)*d,this.w+=(a.w-this.w)*d,this}lerpVectors(a,d,A){return this.x=a.x+(d.x-a.x)*A,this.y=a.y+(d.y-a.y)*A,this.z=a.z+(d.z-a.z)*A,this.w=a.w+(d.w-a.w)*A,this}equals(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w}fromArray(a,d=0){return this.x=a[d],this.y=a[d+1],this.z=a[d+2],this.w=a[d+3],this}toArray(a=[],d=0){return a[d]=this.x,a[d+1]=this.y,a[d+2]=this.z,a[d+3]=this.w,a}fromBufferAttribute(a,d){return this.x=a.getX(d),this.y=a.getY(d),this.z=a.getZ(d),this.w=a.getW(d),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class a0 extends Bo{constructor(a=1,d=1,A={}){super(),this.isRenderTarget=!0,this.width=a,this.height=d,this.depth=1,this.scissor=new Un(0,0,a,d),this.scissorTest=!1,this.viewport=new Un(0,0,a,d);const x={width:a,height:d,depth:1};A=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Fi,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},A);const w=new ds(x,A.mapping,A.wrapS,A.wrapT,A.magFilter,A.minFilter,A.format,A.type,A.anisotropy,A.colorSpace);w.flipY=!1,w.generateMipmaps=A.generateMipmaps,w.internalFormat=A.internalFormat,this.textures=[];const M=A.count;for(let N=0;N<M;N++)this.textures[N]=w.clone(),this.textures[N].isRenderTargetTexture=!0;this.depthBuffer=A.depthBuffer,this.stencilBuffer=A.stencilBuffer,this.resolveDepthBuffer=A.resolveDepthBuffer,this.resolveStencilBuffer=A.resolveStencilBuffer,this.depthTexture=A.depthTexture,this.samples=A.samples}get texture(){return this.textures[0]}set texture(a){this.textures[0]=a}setSize(a,d,A=1){if(this.width!==a||this.height!==d||this.depth!==A){this.width=a,this.height=d,this.depth=A;for(let x=0,w=this.textures.length;x<w;x++)this.textures[x].image.width=a,this.textures[x].image.height=d,this.textures[x].image.depth=A;this.dispose()}this.viewport.set(0,0,a,d),this.scissor.set(0,0,a,d)}clone(){return new this.constructor().copy(this)}copy(a){this.width=a.width,this.height=a.height,this.depth=a.depth,this.scissor.copy(a.scissor),this.scissorTest=a.scissorTest,this.viewport.copy(a.viewport),this.textures.length=0;for(let A=0,x=a.textures.length;A<x;A++)this.textures[A]=a.textures[A].clone(),this.textures[A].isRenderTargetTexture=!0;const d=Object.assign({},a.texture.image);return this.texture.source=new xs(d),this.depthBuffer=a.depthBuffer,this.stencilBuffer=a.stencilBuffer,this.resolveDepthBuffer=a.resolveDepthBuffer,this.resolveStencilBuffer=a.resolveStencilBuffer,a.depthTexture!==null&&(this.depthTexture=a.depthTexture.clone()),this.samples=a.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class rl extends a0{constructor(a=1,d=1,A={}){super(a,d,A),this.isWebGLRenderTarget=!0}}class o0 extends ds{constructor(a=null,d=1,A=1,x=1){super(null),this.isDataArrayTexture=!0,this.image={data:a,width:d,height:A,depth:x},this.magFilter=Lt,this.minFilter=Lt,this.wrapR=je,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class dr extends rl{constructor(a=1,d=1,A=1,x={}){super(a,d,x),this.isWebGLArrayRenderTarget=!0,this.depth=A,this.texture=new o0(null,a,d,A),this.texture.isRenderTargetTexture=!0}}class Kr extends ds{constructor(a=null,d=1,A=1,x=1){super(null),this.isData3DTexture=!0,this.image={data:a,width:d,height:A,depth:x},this.magFilter=Lt,this.minFilter=Lt,this.wrapR=je,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Bn extends rl{constructor(a=1,d=1,A=1,x={}){super(a,d,x),this.isWebGL3DRenderTarget=!0,this.depth=A,this.texture=new Kr(null,a,d,A),this.texture.isRenderTargetTexture=!0}}class Vn{constructor(a=0,d=0,A=0,x=1){this.isQuaternion=!0,this._x=a,this._y=d,this._z=A,this._w=x}static slerpFlat(a,d,A,x,w,M,N){let P=A[x+0],k=A[x+1],j=A[x+2],Y=A[x+3];const X=w[M+0],Z=w[M+1],ie=w[M+2],oe=w[M+3];if(N===0){a[d+0]=P,a[d+1]=k,a[d+2]=j,a[d+3]=Y;return}if(N===1){a[d+0]=X,a[d+1]=Z,a[d+2]=ie,a[d+3]=oe;return}if(Y!==oe||P!==X||k!==Z||j!==ie){let ne=1-N;const ee=P*X+k*Z+j*ie+Y*oe,Me=ee>=0?1:-1,we=1-ee*ee;if(we>Number.EPSILON){const st=Math.sqrt(we),Qe=Math.atan2(st,ee*Me);ne=Math.sin(ne*Qe)/st,N=Math.sin(N*Qe)/st}const xe=N*Me;if(P=P*ne+X*xe,k=k*ne+Z*xe,j=j*ne+ie*xe,Y=Y*ne+oe*xe,ne===1-N){const st=1/Math.sqrt(P*P+k*k+j*j+Y*Y);P*=st,k*=st,j*=st,Y*=st}}a[d]=P,a[d+1]=k,a[d+2]=j,a[d+3]=Y}static multiplyQuaternionsFlat(a,d,A,x,w,M){const N=A[x],P=A[x+1],k=A[x+2],j=A[x+3],Y=w[M],X=w[M+1],Z=w[M+2],ie=w[M+3];return a[d]=N*ie+j*Y+P*Z-k*X,a[d+1]=P*ie+j*X+k*Y-N*Z,a[d+2]=k*ie+j*Z+N*X-P*Y,a[d+3]=j*ie-N*Y-P*X-k*Z,a}get x(){return this._x}set x(a){this._x=a,this._onChangeCallback()}get y(){return this._y}set y(a){this._y=a,this._onChangeCallback()}get z(){return this._z}set z(a){this._z=a,this._onChangeCallback()}get w(){return this._w}set w(a){this._w=a,this._onChangeCallback()}set(a,d,A,x){return this._x=a,this._y=d,this._z=A,this._w=x,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(a){return this._x=a.x,this._y=a.y,this._z=a.z,this._w=a.w,this._onChangeCallback(),this}setFromEuler(a,d=!0){const A=a._x,x=a._y,w=a._z,M=a._order,N=Math.cos,P=Math.sin,k=N(A/2),j=N(x/2),Y=N(w/2),X=P(A/2),Z=P(x/2),ie=P(w/2);switch(M){case"XYZ":this._x=X*j*Y+k*Z*ie,this._y=k*Z*Y-X*j*ie,this._z=k*j*ie+X*Z*Y,this._w=k*j*Y-X*Z*ie;break;case"YXZ":this._x=X*j*Y+k*Z*ie,this._y=k*Z*Y-X*j*ie,this._z=k*j*ie-X*Z*Y,this._w=k*j*Y+X*Z*ie;break;case"ZXY":this._x=X*j*Y-k*Z*ie,this._y=k*Z*Y+X*j*ie,this._z=k*j*ie+X*Z*Y,this._w=k*j*Y-X*Z*ie;break;case"ZYX":this._x=X*j*Y-k*Z*ie,this._y=k*Z*Y+X*j*ie,this._z=k*j*ie-X*Z*Y,this._w=k*j*Y+X*Z*ie;break;case"YZX":this._x=X*j*Y+k*Z*ie,this._y=k*Z*Y+X*j*ie,this._z=k*j*ie-X*Z*Y,this._w=k*j*Y-X*Z*ie;break;case"XZY":this._x=X*j*Y-k*Z*ie,this._y=k*Z*Y-X*j*ie,this._z=k*j*ie+X*Z*Y,this._w=k*j*Y+X*Z*ie;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+M)}return d===!0&&this._onChangeCallback(),this}setFromAxisAngle(a,d){const A=d/2,x=Math.sin(A);return this._x=a.x*x,this._y=a.y*x,this._z=a.z*x,this._w=Math.cos(A),this._onChangeCallback(),this}setFromRotationMatrix(a){const d=a.elements,A=d[0],x=d[4],w=d[8],M=d[1],N=d[5],P=d[9],k=d[2],j=d[6],Y=d[10],X=A+N+Y;if(X>0){const Z=.5/Math.sqrt(X+1);this._w=.25/Z,this._x=(j-P)*Z,this._y=(w-k)*Z,this._z=(M-x)*Z}else if(A>N&&A>Y){const Z=2*Math.sqrt(1+A-N-Y);this._w=(j-P)/Z,this._x=.25*Z,this._y=(x+M)/Z,this._z=(w+k)/Z}else if(N>Y){const Z=2*Math.sqrt(1+N-A-Y);this._w=(w-k)/Z,this._x=(x+M)/Z,this._y=.25*Z,this._z=(P+j)/Z}else{const Z=2*Math.sqrt(1+Y-A-N);this._w=(M-x)/Z,this._x=(w+k)/Z,this._y=(P+j)/Z,this._z=.25*Z}return this._onChangeCallback(),this}setFromUnitVectors(a,d){let A=a.dot(d)+1;return A<Number.EPSILON?(A=0,Math.abs(a.x)>Math.abs(a.z)?(this._x=-a.y,this._y=a.x,this._z=0,this._w=A):(this._x=0,this._y=-a.z,this._z=a.y,this._w=A)):(this._x=a.y*d.z-a.z*d.y,this._y=a.z*d.x-a.x*d.z,this._z=a.x*d.y-a.y*d.x,this._w=A),this.normalize()}angleTo(a){return 2*Math.acos(Math.abs(Ts(this.dot(a),-1,1)))}rotateTowards(a,d){const A=this.angleTo(a);if(A===0)return this;const x=Math.min(1,d/A);return this.slerp(a,x),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(a){return this._x*a._x+this._y*a._y+this._z*a._z+this._w*a._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let a=this.length();return a===0?(this._x=0,this._y=0,this._z=0,this._w=1):(a=1/a,this._x=this._x*a,this._y=this._y*a,this._z=this._z*a,this._w=this._w*a),this._onChangeCallback(),this}multiply(a){return this.multiplyQuaternions(this,a)}premultiply(a){return this.multiplyQuaternions(a,this)}multiplyQuaternions(a,d){const A=a._x,x=a._y,w=a._z,M=a._w,N=d._x,P=d._y,k=d._z,j=d._w;return this._x=A*j+M*N+x*k-w*P,this._y=x*j+M*P+w*N-A*k,this._z=w*j+M*k+A*P-x*N,this._w=M*j-A*N-x*P-w*k,this._onChangeCallback(),this}slerp(a,d){if(d===0)return this;if(d===1)return this.copy(a);const A=this._x,x=this._y,w=this._z,M=this._w;let N=M*a._w+A*a._x+x*a._y+w*a._z;if(N<0?(this._w=-a._w,this._x=-a._x,this._y=-a._y,this._z=-a._z,N=-N):this.copy(a),N>=1)return this._w=M,this._x=A,this._y=x,this._z=w,this;const P=1-N*N;if(P<=Number.EPSILON){const Z=1-d;return this._w=Z*M+d*this._w,this._x=Z*A+d*this._x,this._y=Z*x+d*this._y,this._z=Z*w+d*this._z,this.normalize(),this}const k=Math.sqrt(P),j=Math.atan2(k,N),Y=Math.sin((1-d)*j)/k,X=Math.sin(d*j)/k;return this._w=M*Y+this._w*X,this._x=A*Y+this._x*X,this._y=x*Y+this._y*X,this._z=w*Y+this._z*X,this._onChangeCallback(),this}slerpQuaternions(a,d,A){return this.copy(a).slerp(d,A)}random(){const a=2*Math.PI*Math.random(),d=2*Math.PI*Math.random(),A=Math.random(),x=Math.sqrt(1-A),w=Math.sqrt(A);return this.set(x*Math.sin(a),x*Math.cos(a),w*Math.sin(d),w*Math.cos(d))}equals(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w}fromArray(a,d=0){return this._x=a[d],this._y=a[d+1],this._z=a[d+2],this._w=a[d+3],this._onChangeCallback(),this}toArray(a=[],d=0){return a[d]=this._x,a[d+1]=this._y,a[d+2]=this._z,a[d+3]=this._w,a}fromBufferAttribute(a,d){return this._x=a.getX(d),this._y=a.getY(d),this._z=a.getZ(d),this._w=a.getW(d),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(a){return this._onChangeCallback=a,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class He{constructor(a=0,d=0,A=0){He.prototype.isVector3=!0,this.x=a,this.y=d,this.z=A}set(a,d,A){return A===void 0&&(A=this.z),this.x=a,this.y=d,this.z=A,this}setScalar(a){return this.x=a,this.y=a,this.z=a,this}setX(a){return this.x=a,this}setY(a){return this.y=a,this}setZ(a){return this.z=a,this}setComponent(a,d){switch(a){case 0:this.x=d;break;case 1:this.y=d;break;case 2:this.z=d;break;default:throw new Error("index is out of range: "+a)}return this}getComponent(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+a)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(a){return this.x=a.x,this.y=a.y,this.z=a.z,this}add(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this}addScalar(a){return this.x+=a,this.y+=a,this.z+=a,this}addVectors(a,d){return this.x=a.x+d.x,this.y=a.y+d.y,this.z=a.z+d.z,this}addScaledVector(a,d){return this.x+=a.x*d,this.y+=a.y*d,this.z+=a.z*d,this}sub(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this}subScalar(a){return this.x-=a,this.y-=a,this.z-=a,this}subVectors(a,d){return this.x=a.x-d.x,this.y=a.y-d.y,this.z=a.z-d.z,this}multiply(a){return this.x*=a.x,this.y*=a.y,this.z*=a.z,this}multiplyScalar(a){return this.x*=a,this.y*=a,this.z*=a,this}multiplyVectors(a,d){return this.x=a.x*d.x,this.y=a.y*d.y,this.z=a.z*d.z,this}applyEuler(a){return this.applyQuaternion(zs.setFromEuler(a))}applyAxisAngle(a,d){return this.applyQuaternion(zs.setFromAxisAngle(a,d))}applyMatrix3(a){const d=this.x,A=this.y,x=this.z,w=a.elements;return this.x=w[0]*d+w[3]*A+w[6]*x,this.y=w[1]*d+w[4]*A+w[7]*x,this.z=w[2]*d+w[5]*A+w[8]*x,this}applyNormalMatrix(a){return this.applyMatrix3(a).normalize()}applyMatrix4(a){const d=this.x,A=this.y,x=this.z,w=a.elements,M=1/(w[3]*d+w[7]*A+w[11]*x+w[15]);return this.x=(w[0]*d+w[4]*A+w[8]*x+w[12])*M,this.y=(w[1]*d+w[5]*A+w[9]*x+w[13])*M,this.z=(w[2]*d+w[6]*A+w[10]*x+w[14])*M,this}applyQuaternion(a){const d=this.x,A=this.y,x=this.z,w=a.x,M=a.y,N=a.z,P=a.w,k=2*(M*x-N*A),j=2*(N*d-w*x),Y=2*(w*A-M*d);return this.x=d+P*k+M*Y-N*j,this.y=A+P*j+N*k-w*Y,this.z=x+P*Y+w*j-M*k,this}project(a){return this.applyMatrix4(a.matrixWorldInverse).applyMatrix4(a.projectionMatrix)}unproject(a){return this.applyMatrix4(a.projectionMatrixInverse).applyMatrix4(a.matrixWorld)}transformDirection(a){const d=this.x,A=this.y,x=this.z,w=a.elements;return this.x=w[0]*d+w[4]*A+w[8]*x,this.y=w[1]*d+w[5]*A+w[9]*x,this.z=w[2]*d+w[6]*A+w[10]*x,this.normalize()}divide(a){return this.x/=a.x,this.y/=a.y,this.z/=a.z,this}divideScalar(a){return this.multiplyScalar(1/a)}min(a){return this.x=Math.min(this.x,a.x),this.y=Math.min(this.y,a.y),this.z=Math.min(this.z,a.z),this}max(a){return this.x=Math.max(this.x,a.x),this.y=Math.max(this.y,a.y),this.z=Math.max(this.z,a.z),this}clamp(a,d){return this.x=Math.max(a.x,Math.min(d.x,this.x)),this.y=Math.max(a.y,Math.min(d.y,this.y)),this.z=Math.max(a.z,Math.min(d.z,this.z)),this}clampScalar(a,d){return this.x=Math.max(a,Math.min(d,this.x)),this.y=Math.max(a,Math.min(d,this.y)),this.z=Math.max(a,Math.min(d,this.z)),this}clampLength(a,d){const A=this.length();return this.divideScalar(A||1).multiplyScalar(Math.max(a,Math.min(d,A)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(a){return this.x*a.x+this.y*a.y+this.z*a.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(a){return this.normalize().multiplyScalar(a)}lerp(a,d){return this.x+=(a.x-this.x)*d,this.y+=(a.y-this.y)*d,this.z+=(a.z-this.z)*d,this}lerpVectors(a,d,A){return this.x=a.x+(d.x-a.x)*A,this.y=a.y+(d.y-a.y)*A,this.z=a.z+(d.z-a.z)*A,this}cross(a){return this.crossVectors(this,a)}crossVectors(a,d){const A=a.x,x=a.y,w=a.z,M=d.x,N=d.y,P=d.z;return this.x=x*P-w*N,this.y=w*M-A*P,this.z=A*N-x*M,this}projectOnVector(a){const d=a.lengthSq();if(d===0)return this.set(0,0,0);const A=a.dot(this)/d;return this.copy(a).multiplyScalar(A)}projectOnPlane(a){return Sl.copy(this).projectOnVector(a),this.sub(Sl)}reflect(a){return this.sub(Sl.copy(a).multiplyScalar(2*this.dot(a)))}angleTo(a){const d=Math.sqrt(this.lengthSq()*a.lengthSq());if(d===0)return Math.PI/2;const A=this.dot(a)/d;return Math.acos(Ts(A,-1,1))}distanceTo(a){return Math.sqrt(this.distanceToSquared(a))}distanceToSquared(a){const d=this.x-a.x,A=this.y-a.y,x=this.z-a.z;return d*d+A*A+x*x}manhattanDistanceTo(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)+Math.abs(this.z-a.z)}setFromSpherical(a){return this.setFromSphericalCoords(a.radius,a.phi,a.theta)}setFromSphericalCoords(a,d,A){const x=Math.sin(d)*a;return this.x=x*Math.sin(A),this.y=Math.cos(d)*a,this.z=x*Math.cos(A),this}setFromCylindrical(a){return this.setFromCylindricalCoords(a.radius,a.theta,a.y)}setFromCylindricalCoords(a,d,A){return this.x=a*Math.sin(d),this.y=A,this.z=a*Math.cos(d),this}setFromMatrixPosition(a){const d=a.elements;return this.x=d[12],this.y=d[13],this.z=d[14],this}setFromMatrixScale(a){const d=this.setFromMatrixColumn(a,0).length(),A=this.setFromMatrixColumn(a,1).length(),x=this.setFromMatrixColumn(a,2).length();return this.x=d,this.y=A,this.z=x,this}setFromMatrixColumn(a,d){return this.fromArray(a.elements,d*4)}setFromMatrix3Column(a,d){return this.fromArray(a.elements,d*3)}setFromEuler(a){return this.x=a._x,this.y=a._y,this.z=a._z,this}setFromColor(a){return this.x=a.r,this.y=a.g,this.z=a.b,this}equals(a){return a.x===this.x&&a.y===this.y&&a.z===this.z}fromArray(a,d=0){return this.x=a[d],this.y=a[d+1],this.z=a[d+2],this}toArray(a=[],d=0){return a[d]=this.x,a[d+1]=this.y,a[d+2]=this.z,a}fromBufferAttribute(a,d){return this.x=a.getX(d),this.y=a.getY(d),this.z=a.getZ(d),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const a=Math.random()*Math.PI*2,d=Math.random()*2-1,A=Math.sqrt(1-d*d);return this.x=A*Math.cos(a),this.y=d,this.z=A*Math.sin(a),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Sl=new He,zs=new Vn;class Ls{constructor(a=new He(1/0,1/0,1/0),d=new He(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=a,this.max=d}set(a,d){return this.min.copy(a),this.max.copy(d),this}setFromArray(a){this.makeEmpty();for(let d=0,A=a.length;d<A;d+=3)this.expandByPoint(ho.fromArray(a,d));return this}setFromBufferAttribute(a){this.makeEmpty();for(let d=0,A=a.count;d<A;d++)this.expandByPoint(ho.fromBufferAttribute(a,d));return this}setFromPoints(a){this.makeEmpty();for(let d=0,A=a.length;d<A;d++)this.expandByPoint(a[d]);return this}setFromCenterAndSize(a,d){const A=ho.copy(d).multiplyScalar(.5);return this.min.copy(a).sub(A),this.max.copy(a).add(A),this}setFromObject(a,d=!1){return this.makeEmpty(),this.expandByObject(a,d)}clone(){return new this.constructor().copy(this)}copy(a){return this.min.copy(a.min),this.max.copy(a.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(a){return this.isEmpty()?a.set(0,0,0):a.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(a){return this.isEmpty()?a.set(0,0,0):a.subVectors(this.max,this.min)}expandByPoint(a){return this.min.min(a),this.max.max(a),this}expandByVector(a){return this.min.sub(a),this.max.add(a),this}expandByScalar(a){return this.min.addScalar(-a),this.max.addScalar(a),this}expandByObject(a,d=!1){a.updateWorldMatrix(!1,!1);const A=a.geometry;if(A!==void 0){const w=A.getAttribute("position");if(d===!0&&w!==void 0&&a.isInstancedMesh!==!0)for(let M=0,N=w.count;M<N;M++)a.isMesh===!0?a.getVertexPosition(M,ho):ho.fromBufferAttribute(w,M),ho.applyMatrix4(a.matrixWorld),this.expandByPoint(ho);else a.boundingBox!==void 0?(a.boundingBox===null&&a.computeBoundingBox(),lu.copy(a.boundingBox)):(A.boundingBox===null&&A.computeBoundingBox(),lu.copy(A.boundingBox)),lu.applyMatrix4(a.matrixWorld),this.union(lu)}const x=a.children;for(let w=0,M=x.length;w<M;w++)this.expandByObject(x[w],d);return this}containsPoint(a){return!(a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<this.min.z||a.z>this.max.z)}containsBox(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z}getParameter(a,d){return d.set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(a){return!(a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<this.min.z||a.min.z>this.max.z)}intersectsSphere(a){return this.clampPoint(a.center,ho),ho.distanceToSquared(a.center)<=a.radius*a.radius}intersectsPlane(a){let d,A;return a.normal.x>0?(d=a.normal.x*this.min.x,A=a.normal.x*this.max.x):(d=a.normal.x*this.max.x,A=a.normal.x*this.min.x),a.normal.y>0?(d+=a.normal.y*this.min.y,A+=a.normal.y*this.max.y):(d+=a.normal.y*this.max.y,A+=a.normal.y*this.min.y),a.normal.z>0?(d+=a.normal.z*this.min.z,A+=a.normal.z*this.max.z):(d+=a.normal.z*this.max.z,A+=a.normal.z*this.min.z),d<=-a.constant&&A>=-a.constant}intersectsTriangle(a){if(this.isEmpty())return!1;this.getCenter(Pn),ss.subVectors(this.max,Pn),nl.subVectors(a.a,Pn),Da.subVectors(a.b,Pn),sn.subVectors(a.c,Pn),Ya.subVectors(Da,nl),Tl.subVectors(sn,Da),Oa.subVectors(nl,sn);let d=[0,-Ya.z,Ya.y,0,-Tl.z,Tl.y,0,-Oa.z,Oa.y,Ya.z,0,-Ya.x,Tl.z,0,-Tl.x,Oa.z,0,-Oa.x,-Ya.y,Ya.x,0,-Tl.y,Tl.x,0,-Oa.y,Oa.x,0];return!Lo(d,nl,Da,sn,ss)||(d=[1,0,0,0,1,0,0,0,1],!Lo(d,nl,Da,sn,ss))?!1:(an.crossVectors(Ya,Tl),d=[an.x,an.y,an.z],Lo(d,nl,Da,sn,ss))}clampPoint(a,d){return d.copy(a).clamp(this.min,this.max)}distanceToPoint(a){return this.clampPoint(a,ho).distanceTo(a)}getBoundingSphere(a){return this.isEmpty()?a.makeEmpty():(this.getCenter(a.center),a.radius=this.getSize(ho).length()*.5),a}intersect(a){return this.min.max(a.min),this.max.min(a.max),this.isEmpty()&&this.makeEmpty(),this}union(a){return this.min.min(a.min),this.max.max(a.max),this}applyMatrix4(a){return this.isEmpty()?this:(wn[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(a),wn[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(a),wn[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(a),wn[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(a),wn[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(a),wn[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(a),wn[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(a),wn[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(a),this.setFromPoints(wn),this)}translate(a){return this.min.add(a),this.max.add(a),this}equals(a){return a.min.equals(this.min)&&a.max.equals(this.max)}}const wn=[new He,new He,new He,new He,new He,new He,new He,new He],ho=new He,lu=new Ls,nl=new He,Da=new He,sn=new He,Ya=new He,Tl=new He,Oa=new He,Pn=new He,ss=new He,an=new He,kn=new He;function Lo(S,a,d,A,x){for(let w=0,M=S.length-3;w<=M;w+=3){kn.fromArray(S,w);const N=x.x*Math.abs(kn.x)+x.y*Math.abs(kn.y)+x.z*Math.abs(kn.z),P=a.dot(kn),k=d.dot(kn),j=A.dot(kn);if(Math.max(-Math.max(P,k,j),Math.min(P,k,j))>N)return!1}return!0}const jd=new Ls,Ch=new He,l0=new He;class Aa{constructor(a=new He,d=-1){this.isSphere=!0,this.center=a,this.radius=d}set(a,d){return this.center.copy(a),this.radius=d,this}setFromPoints(a,d){const A=this.center;d!==void 0?A.copy(d):jd.setFromPoints(a).getCenter(A);let x=0;for(let w=0,M=a.length;w<M;w++)x=Math.max(x,A.distanceToSquared(a[w]));return this.radius=Math.sqrt(x),this}copy(a){return this.center.copy(a.center),this.radius=a.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(a){return a.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(a){return a.distanceTo(this.center)-this.radius}intersectsSphere(a){const d=this.radius+a.radius;return a.center.distanceToSquared(this.center)<=d*d}intersectsBox(a){return a.intersectsSphere(this)}intersectsPlane(a){return Math.abs(a.distanceToPoint(this.center))<=this.radius}clampPoint(a,d){const A=this.center.distanceToSquared(a);return d.copy(a),A>this.radius*this.radius&&(d.sub(this.center).normalize(),d.multiplyScalar(this.radius).add(this.center)),d}getBoundingBox(a){return this.isEmpty()?(a.makeEmpty(),a):(a.set(this.center,this.center),a.expandByScalar(this.radius),a)}applyMatrix4(a){return this.center.applyMatrix4(a),this.radius=this.radius*a.getMaxScaleOnAxis(),this}translate(a){return this.center.add(a),this}expandByPoint(a){if(this.isEmpty())return this.center.copy(a),this.radius=0,this;Ch.subVectors(a,this.center);const d=Ch.lengthSq();if(d>this.radius*this.radius){const A=Math.sqrt(d),x=(A-this.radius)*.5;this.center.addScaledVector(Ch,x/A),this.radius+=x}return this}union(a){return a.isEmpty()?this:this.isEmpty()?(this.copy(a),this):(this.center.equals(a.center)===!0?this.radius=Math.max(this.radius,a.radius):(l0.subVectors(a.center,this.center).setLength(a.radius),this.expandByPoint(Ch.copy(a.center).add(l0)),this.expandByPoint(Ch.copy(a.center).sub(l0))),this)}equals(a){return a.center.equals(this.center)&&a.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Ql=new He,c0=new He,u0=new He,cu=new He,bv=new He,h0=new He,xv=new He;class ya{constructor(a=new He,d=new He(0,0,-1)){this.origin=a,this.direction=d}set(a,d){return this.origin.copy(a),this.direction.copy(d),this}copy(a){return this.origin.copy(a.origin),this.direction.copy(a.direction),this}at(a,d){return d.copy(this.origin).addScaledVector(this.direction,a)}lookAt(a){return this.direction.copy(a).sub(this.origin).normalize(),this}recast(a){return this.origin.copy(this.at(a,Ql)),this}closestPointToPoint(a,d){d.subVectors(a,this.origin);const A=d.dot(this.direction);return A<0?d.copy(this.origin):d.copy(this.origin).addScaledVector(this.direction,A)}distanceToPoint(a){return Math.sqrt(this.distanceSqToPoint(a))}distanceSqToPoint(a){const d=Ql.subVectors(a,this.origin).dot(this.direction);return d<0?this.origin.distanceToSquared(a):(Ql.copy(this.origin).addScaledVector(this.direction,d),Ql.distanceToSquared(a))}distanceSqToSegment(a,d,A,x){c0.copy(a).add(d).multiplyScalar(.5),u0.copy(d).sub(a).normalize(),cu.copy(this.origin).sub(c0);const w=a.distanceTo(d)*.5,M=-this.direction.dot(u0),N=cu.dot(this.direction),P=-cu.dot(u0),k=cu.lengthSq(),j=Math.abs(1-M*M);let Y,X,Z,ie;if(j>0)if(Y=M*P-N,X=M*N-P,ie=w*j,Y>=0)if(X>=-ie)if(X<=ie){const oe=1/j;Y*=oe,X*=oe,Z=Y*(Y+M*X+2*N)+X*(M*Y+X+2*P)+k}else X=w,Y=Math.max(0,-(M*X+N)),Z=-Y*Y+X*(X+2*P)+k;else X=-w,Y=Math.max(0,-(M*X+N)),Z=-Y*Y+X*(X+2*P)+k;else X<=-ie?(Y=Math.max(0,-(-M*w+N)),X=Y>0?-w:Math.min(Math.max(-w,-P),w),Z=-Y*Y+X*(X+2*P)+k):X<=ie?(Y=0,X=Math.min(Math.max(-w,-P),w),Z=X*(X+2*P)+k):(Y=Math.max(0,-(M*w+N)),X=Y>0?w:Math.min(Math.max(-w,-P),w),Z=-Y*Y+X*(X+2*P)+k);else X=M>0?-w:w,Y=Math.max(0,-(M*X+N)),Z=-Y*Y+X*(X+2*P)+k;return A&&A.copy(this.origin).addScaledVector(this.direction,Y),x&&x.copy(c0).addScaledVector(u0,X),Z}intersectSphere(a,d){Ql.subVectors(a.center,this.origin);const A=Ql.dot(this.direction),x=Ql.dot(Ql)-A*A,w=a.radius*a.radius;if(x>w)return null;const M=Math.sqrt(w-x),N=A-M,P=A+M;return P<0?null:N<0?this.at(P,d):this.at(N,d)}intersectsSphere(a){return this.distanceSqToPoint(a.center)<=a.radius*a.radius}distanceToPlane(a){const d=a.normal.dot(this.direction);if(d===0)return a.distanceToPoint(this.origin)===0?0:null;const A=-(this.origin.dot(a.normal)+a.constant)/d;return A>=0?A:null}intersectPlane(a,d){const A=this.distanceToPlane(a);return A===null?null:this.at(A,d)}intersectsPlane(a){const d=a.distanceToPoint(this.origin);return d===0||a.normal.dot(this.direction)*d<0}intersectBox(a,d){let A,x,w,M,N,P;const k=1/this.direction.x,j=1/this.direction.y,Y=1/this.direction.z,X=this.origin;return k>=0?(A=(a.min.x-X.x)*k,x=(a.max.x-X.x)*k):(A=(a.max.x-X.x)*k,x=(a.min.x-X.x)*k),j>=0?(w=(a.min.y-X.y)*j,M=(a.max.y-X.y)*j):(w=(a.max.y-X.y)*j,M=(a.min.y-X.y)*j),A>M||w>x||((w>A||isNaN(A))&&(A=w),(M<x||isNaN(x))&&(x=M),Y>=0?(N=(a.min.z-X.z)*Y,P=(a.max.z-X.z)*Y):(N=(a.max.z-X.z)*Y,P=(a.min.z-X.z)*Y),A>P||N>x)||((N>A||A!==A)&&(A=N),(P<x||x!==x)&&(x=P),x<0)?null:this.at(A>=0?A:x,d)}intersectsBox(a){return this.intersectBox(a,Ql)!==null}intersectTriangle(a,d,A,x,w){bv.subVectors(d,a),h0.subVectors(A,a),xv.crossVectors(bv,h0);let M=this.direction.dot(xv),N;if(M>0){if(x)return null;N=1}else if(M<0)N=-1,M=-M;else return null;cu.subVectors(this.origin,a);const P=N*this.direction.dot(h0.crossVectors(cu,h0));if(P<0)return null;const k=N*this.direction.dot(bv.cross(cu));if(k<0||P+k>M)return null;const j=-N*cu.dot(xv);return j<0?null:this.at(j/M,w)}applyMatrix4(a){return this.origin.applyMatrix4(a),this.direction.transformDirection(a),this}equals(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class mr{constructor(a,d,A,x,w,M,N,P,k,j,Y,X,Z,ie,oe,ne){mr.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],a!==void 0&&this.set(a,d,A,x,w,M,N,P,k,j,Y,X,Z,ie,oe,ne)}set(a,d,A,x,w,M,N,P,k,j,Y,X,Z,ie,oe,ne){const ee=this.elements;return ee[0]=a,ee[4]=d,ee[8]=A,ee[12]=x,ee[1]=w,ee[5]=M,ee[9]=N,ee[13]=P,ee[2]=k,ee[6]=j,ee[10]=Y,ee[14]=X,ee[3]=Z,ee[7]=ie,ee[11]=oe,ee[15]=ne,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new mr().fromArray(this.elements)}copy(a){const d=this.elements,A=a.elements;return d[0]=A[0],d[1]=A[1],d[2]=A[2],d[3]=A[3],d[4]=A[4],d[5]=A[5],d[6]=A[6],d[7]=A[7],d[8]=A[8],d[9]=A[9],d[10]=A[10],d[11]=A[11],d[12]=A[12],d[13]=A[13],d[14]=A[14],d[15]=A[15],this}copyPosition(a){const d=this.elements,A=a.elements;return d[12]=A[12],d[13]=A[13],d[14]=A[14],this}setFromMatrix3(a){const d=a.elements;return this.set(d[0],d[3],d[6],0,d[1],d[4],d[7],0,d[2],d[5],d[8],0,0,0,0,1),this}extractBasis(a,d,A){return a.setFromMatrixColumn(this,0),d.setFromMatrixColumn(this,1),A.setFromMatrixColumn(this,2),this}makeBasis(a,d,A){return this.set(a.x,d.x,A.x,0,a.y,d.y,A.y,0,a.z,d.z,A.z,0,0,0,0,1),this}extractRotation(a){const d=this.elements,A=a.elements,x=1/Sh.setFromMatrixColumn(a,0).length(),w=1/Sh.setFromMatrixColumn(a,1).length(),M=1/Sh.setFromMatrixColumn(a,2).length();return d[0]=A[0]*x,d[1]=A[1]*x,d[2]=A[2]*x,d[3]=0,d[4]=A[4]*w,d[5]=A[5]*w,d[6]=A[6]*w,d[7]=0,d[8]=A[8]*M,d[9]=A[9]*M,d[10]=A[10]*M,d[11]=0,d[12]=0,d[13]=0,d[14]=0,d[15]=1,this}makeRotationFromEuler(a){const d=this.elements,A=a.x,x=a.y,w=a.z,M=Math.cos(A),N=Math.sin(A),P=Math.cos(x),k=Math.sin(x),j=Math.cos(w),Y=Math.sin(w);if(a.order==="XYZ"){const X=M*j,Z=M*Y,ie=N*j,oe=N*Y;d[0]=P*j,d[4]=-P*Y,d[8]=k,d[1]=Z+ie*k,d[5]=X-oe*k,d[9]=-N*P,d[2]=oe-X*k,d[6]=ie+Z*k,d[10]=M*P}else if(a.order==="YXZ"){const X=P*j,Z=P*Y,ie=k*j,oe=k*Y;d[0]=X+oe*N,d[4]=ie*N-Z,d[8]=M*k,d[1]=M*Y,d[5]=M*j,d[9]=-N,d[2]=Z*N-ie,d[6]=oe+X*N,d[10]=M*P}else if(a.order==="ZXY"){const X=P*j,Z=P*Y,ie=k*j,oe=k*Y;d[0]=X-oe*N,d[4]=-M*Y,d[8]=ie+Z*N,d[1]=Z+ie*N,d[5]=M*j,d[9]=oe-X*N,d[2]=-M*k,d[6]=N,d[10]=M*P}else if(a.order==="ZYX"){const X=M*j,Z=M*Y,ie=N*j,oe=N*Y;d[0]=P*j,d[4]=ie*k-Z,d[8]=X*k+oe,d[1]=P*Y,d[5]=oe*k+X,d[9]=Z*k-ie,d[2]=-k,d[6]=N*P,d[10]=M*P}else if(a.order==="YZX"){const X=M*P,Z=M*k,ie=N*P,oe=N*k;d[0]=P*j,d[4]=oe-X*Y,d[8]=ie*Y+Z,d[1]=Y,d[5]=M*j,d[9]=-N*j,d[2]=-k*j,d[6]=Z*Y+ie,d[10]=X-oe*Y}else if(a.order==="XZY"){const X=M*P,Z=M*k,ie=N*P,oe=N*k;d[0]=P*j,d[4]=-Y,d[8]=k*j,d[1]=X*Y+oe,d[5]=M*j,d[9]=Z*Y-ie,d[2]=ie*Y-Z,d[6]=N*j,d[10]=oe*Y+X}return d[3]=0,d[7]=0,d[11]=0,d[12]=0,d[13]=0,d[14]=0,d[15]=1,this}makeRotationFromQuaternion(a){return this.compose(sSe,a,aSe)}lookAt(a,d,A){const x=this.elements;return Ml.subVectors(a,d),Ml.lengthSq()===0&&(Ml.z=1),Ml.normalize(),Gd.crossVectors(A,Ml),Gd.lengthSq()===0&&(Math.abs(A.z)===1?Ml.x+=1e-4:Ml.z+=1e-4,Ml.normalize(),Gd.crossVectors(A,Ml)),Gd.normalize(),qE.crossVectors(Ml,Gd),x[0]=Gd.x,x[4]=qE.x,x[8]=Ml.x,x[1]=Gd.y,x[5]=qE.y,x[9]=Ml.y,x[2]=Gd.z,x[6]=qE.z,x[10]=Ml.z,this}multiply(a){return this.multiplyMatrices(this,a)}premultiply(a){return this.multiplyMatrices(a,this)}multiplyMatrices(a,d){const A=a.elements,x=d.elements,w=this.elements,M=A[0],N=A[4],P=A[8],k=A[12],j=A[1],Y=A[5],X=A[9],Z=A[13],ie=A[2],oe=A[6],ne=A[10],ee=A[14],Me=A[3],we=A[7],xe=A[11],st=A[15],Qe=x[0],Ze=x[4],rt=x[8],ze=x[12],De=x[1],nt=x[5],gt=x[9],ft=x[13],Rt=x[2],Ut=x[6],fi=x[10],Oi=x[14],zt=x[3],bi=x[7],Pi=x[11],Ur=x[15];return w[0]=M*Qe+N*De+P*Rt+k*zt,w[4]=M*Ze+N*nt+P*Ut+k*bi,w[8]=M*rt+N*gt+P*fi+k*Pi,w[12]=M*ze+N*ft+P*Oi+k*Ur,w[1]=j*Qe+Y*De+X*Rt+Z*zt,w[5]=j*Ze+Y*nt+X*Ut+Z*bi,w[9]=j*rt+Y*gt+X*fi+Z*Pi,w[13]=j*ze+Y*ft+X*Oi+Z*Ur,w[2]=ie*Qe+oe*De+ne*Rt+ee*zt,w[6]=ie*Ze+oe*nt+ne*Ut+ee*bi,w[10]=ie*rt+oe*gt+ne*fi+ee*Pi,w[14]=ie*ze+oe*ft+ne*Oi+ee*Ur,w[3]=Me*Qe+we*De+xe*Rt+st*zt,w[7]=Me*Ze+we*nt+xe*Ut+st*bi,w[11]=Me*rt+we*gt+xe*fi+st*Pi,w[15]=Me*ze+we*ft+xe*Oi+st*Ur,this}multiplyScalar(a){const d=this.elements;return d[0]*=a,d[4]*=a,d[8]*=a,d[12]*=a,d[1]*=a,d[5]*=a,d[9]*=a,d[13]*=a,d[2]*=a,d[6]*=a,d[10]*=a,d[14]*=a,d[3]*=a,d[7]*=a,d[11]*=a,d[15]*=a,this}determinant(){const a=this.elements,d=a[0],A=a[4],x=a[8],w=a[12],M=a[1],N=a[5],P=a[9],k=a[13],j=a[2],Y=a[6],X=a[10],Z=a[14],ie=a[3],oe=a[7],ne=a[11],ee=a[15];return ie*(+w*P*Y-x*k*Y-w*N*X+A*k*X+x*N*Z-A*P*Z)+oe*(+d*P*Z-d*k*X+w*M*X-x*M*Z+x*k*j-w*P*j)+ne*(+d*k*Y-d*N*Z-w*M*Y+A*M*Z+w*N*j-A*k*j)+ee*(-x*N*j-d*P*Y+d*N*X+x*M*Y-A*M*X+A*P*j)}transpose(){const a=this.elements;let d;return d=a[1],a[1]=a[4],a[4]=d,d=a[2],a[2]=a[8],a[8]=d,d=a[6],a[6]=a[9],a[9]=d,d=a[3],a[3]=a[12],a[12]=d,d=a[7],a[7]=a[13],a[13]=d,d=a[11],a[11]=a[14],a[14]=d,this}setPosition(a,d,A){const x=this.elements;return a.isVector3?(x[12]=a.x,x[13]=a.y,x[14]=a.z):(x[12]=a,x[13]=d,x[14]=A),this}invert(){const a=this.elements,d=a[0],A=a[1],x=a[2],w=a[3],M=a[4],N=a[5],P=a[6],k=a[7],j=a[8],Y=a[9],X=a[10],Z=a[11],ie=a[12],oe=a[13],ne=a[14],ee=a[15],Me=Y*ne*k-oe*X*k+oe*P*Z-N*ne*Z-Y*P*ee+N*X*ee,we=ie*X*k-j*ne*k-ie*P*Z+M*ne*Z+j*P*ee-M*X*ee,xe=j*oe*k-ie*Y*k+ie*N*Z-M*oe*Z-j*N*ee+M*Y*ee,st=ie*Y*P-j*oe*P-ie*N*X+M*oe*X+j*N*ne-M*Y*ne,Qe=d*Me+A*we+x*xe+w*st;if(Qe===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const Ze=1/Qe;return a[0]=Me*Ze,a[1]=(oe*X*w-Y*ne*w-oe*x*Z+A*ne*Z+Y*x*ee-A*X*ee)*Ze,a[2]=(N*ne*w-oe*P*w+oe*x*k-A*ne*k-N*x*ee+A*P*ee)*Ze,a[3]=(Y*P*w-N*X*w-Y*x*k+A*X*k+N*x*Z-A*P*Z)*Ze,a[4]=we*Ze,a[5]=(j*ne*w-ie*X*w+ie*x*Z-d*ne*Z-j*x*ee+d*X*ee)*Ze,a[6]=(ie*P*w-M*ne*w-ie*x*k+d*ne*k+M*x*ee-d*P*ee)*Ze,a[7]=(M*X*w-j*P*w+j*x*k-d*X*k-M*x*Z+d*P*Z)*Ze,a[8]=xe*Ze,a[9]=(ie*Y*w-j*oe*w-ie*A*Z+d*oe*Z+j*A*ee-d*Y*ee)*Ze,a[10]=(M*oe*w-ie*N*w+ie*A*k-d*oe*k-M*A*ee+d*N*ee)*Ze,a[11]=(j*N*w-M*Y*w-j*A*k+d*Y*k+M*A*Z-d*N*Z)*Ze,a[12]=st*Ze,a[13]=(j*oe*x-ie*Y*x+ie*A*X-d*oe*X-j*A*ne+d*Y*ne)*Ze,a[14]=(ie*N*x-M*oe*x-ie*A*P+d*oe*P+M*A*ne-d*N*ne)*Ze,a[15]=(M*Y*x-j*N*x+j*A*P-d*Y*P-M*A*X+d*N*X)*Ze,this}scale(a){const d=this.elements,A=a.x,x=a.y,w=a.z;return d[0]*=A,d[4]*=x,d[8]*=w,d[1]*=A,d[5]*=x,d[9]*=w,d[2]*=A,d[6]*=x,d[10]*=w,d[3]*=A,d[7]*=x,d[11]*=w,this}getMaxScaleOnAxis(){const a=this.elements,d=a[0]*a[0]+a[1]*a[1]+a[2]*a[2],A=a[4]*a[4]+a[5]*a[5]+a[6]*a[6],x=a[8]*a[8]+a[9]*a[9]+a[10]*a[10];return Math.sqrt(Math.max(d,A,x))}makeTranslation(a,d,A){return a.isVector3?this.set(1,0,0,a.x,0,1,0,a.y,0,0,1,a.z,0,0,0,1):this.set(1,0,0,a,0,1,0,d,0,0,1,A,0,0,0,1),this}makeRotationX(a){const d=Math.cos(a),A=Math.sin(a);return this.set(1,0,0,0,0,d,-A,0,0,A,d,0,0,0,0,1),this}makeRotationY(a){const d=Math.cos(a),A=Math.sin(a);return this.set(d,0,A,0,0,1,0,0,-A,0,d,0,0,0,0,1),this}makeRotationZ(a){const d=Math.cos(a),A=Math.sin(a);return this.set(d,-A,0,0,A,d,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(a,d){const A=Math.cos(d),x=Math.sin(d),w=1-A,M=a.x,N=a.y,P=a.z,k=w*M,j=w*N;return this.set(k*M+A,k*N-x*P,k*P+x*N,0,k*N+x*P,j*N+A,j*P-x*M,0,k*P-x*N,j*P+x*M,w*P*P+A,0,0,0,0,1),this}makeScale(a,d,A){return this.set(a,0,0,0,0,d,0,0,0,0,A,0,0,0,0,1),this}makeShear(a,d,A,x,w,M){return this.set(1,A,w,0,a,1,M,0,d,x,1,0,0,0,0,1),this}compose(a,d,A){const x=this.elements,w=d._x,M=d._y,N=d._z,P=d._w,k=w+w,j=M+M,Y=N+N,X=w*k,Z=w*j,ie=w*Y,oe=M*j,ne=M*Y,ee=N*Y,Me=P*k,we=P*j,xe=P*Y,st=A.x,Qe=A.y,Ze=A.z;return x[0]=(1-(oe+ee))*st,x[1]=(Z+xe)*st,x[2]=(ie-we)*st,x[3]=0,x[4]=(Z-xe)*Qe,x[5]=(1-(X+ee))*Qe,x[6]=(ne+Me)*Qe,x[7]=0,x[8]=(ie+we)*Ze,x[9]=(ne-Me)*Ze,x[10]=(1-(X+oe))*Ze,x[11]=0,x[12]=a.x,x[13]=a.y,x[14]=a.z,x[15]=1,this}decompose(a,d,A){const x=this.elements;let w=Sh.set(x[0],x[1],x[2]).length();const M=Sh.set(x[4],x[5],x[6]).length(),N=Sh.set(x[8],x[9],x[10]).length();this.determinant()<0&&(w=-w),a.x=x[12],a.y=x[13],a.z=x[14],sl.copy(this);const P=1/w,k=1/M,j=1/N;return sl.elements[0]*=P,sl.elements[1]*=P,sl.elements[2]*=P,sl.elements[4]*=k,sl.elements[5]*=k,sl.elements[6]*=k,sl.elements[8]*=j,sl.elements[9]*=j,sl.elements[10]*=j,d.setFromRotationMatrix(sl),A.x=w,A.y=M,A.z=N,this}makePerspective(a,d,A,x,w,M,N=Wl){const P=this.elements,k=2*w/(d-a),j=2*w/(A-x),Y=(d+a)/(d-a),X=(A+x)/(A-x);let Z,ie;if(N===Wl)Z=-(M+w)/(M-w),ie=-2*M*w/(M-w);else if(N===Af)Z=-M/(M-w),ie=-M*w/(M-w);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+N);return P[0]=k,P[4]=0,P[8]=Y,P[12]=0,P[1]=0,P[5]=j,P[9]=X,P[13]=0,P[2]=0,P[6]=0,P[10]=Z,P[14]=ie,P[3]=0,P[7]=0,P[11]=-1,P[15]=0,this}makeOrthographic(a,d,A,x,w,M,N=Wl){const P=this.elements,k=1/(d-a),j=1/(A-x),Y=1/(M-w),X=(d+a)*k,Z=(A+x)*j;let ie,oe;if(N===Wl)ie=(M+w)*Y,oe=-2*Y;else if(N===Af)ie=w*Y,oe=-1*Y;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+N);return P[0]=2*k,P[4]=0,P[8]=0,P[12]=-X,P[1]=0,P[5]=2*j,P[9]=0,P[13]=-Z,P[2]=0,P[6]=0,P[10]=oe,P[14]=-ie,P[3]=0,P[7]=0,P[11]=0,P[15]=1,this}equals(a){const d=this.elements,A=a.elements;for(let x=0;x<16;x++)if(d[x]!==A[x])return!1;return!0}fromArray(a,d=0){for(let A=0;A<16;A++)this.elements[A]=a[A+d];return this}toArray(a=[],d=0){const A=this.elements;return a[d]=A[0],a[d+1]=A[1],a[d+2]=A[2],a[d+3]=A[3],a[d+4]=A[4],a[d+5]=A[5],a[d+6]=A[6],a[d+7]=A[7],a[d+8]=A[8],a[d+9]=A[9],a[d+10]=A[10],a[d+11]=A[11],a[d+12]=A[12],a[d+13]=A[13],a[d+14]=A[14],a[d+15]=A[15],a}}const Sh=new He,sl=new mr,sSe=new He(0,0,0),aSe=new He(1,1,1),Gd=new He,qE=new He,Ml=new He,$j=new mr,eG=new Vn;class Rl{constructor(a=0,d=0,A=0,x=Rl.DEFAULT_ORDER){this.isEuler=!0,this._x=a,this._y=d,this._z=A,this._order=x}get x(){return this._x}set x(a){this._x=a,this._onChangeCallback()}get y(){return this._y}set y(a){this._y=a,this._onChangeCallback()}get z(){return this._z}set z(a){this._z=a,this._onChangeCallback()}get order(){return this._order}set order(a){this._order=a,this._onChangeCallback()}set(a,d,A,x=this._order){return this._x=a,this._y=d,this._z=A,this._order=x,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(a){return this._x=a._x,this._y=a._y,this._z=a._z,this._order=a._order,this._onChangeCallback(),this}setFromRotationMatrix(a,d=this._order,A=!0){const x=a.elements,w=x[0],M=x[4],N=x[8],P=x[1],k=x[5],j=x[9],Y=x[2],X=x[6],Z=x[10];switch(d){case"XYZ":this._y=Math.asin(Ts(N,-1,1)),Math.abs(N)<.9999999?(this._x=Math.atan2(-j,Z),this._z=Math.atan2(-M,w)):(this._x=Math.atan2(X,k),this._z=0);break;case"YXZ":this._x=Math.asin(-Ts(j,-1,1)),Math.abs(j)<.9999999?(this._y=Math.atan2(N,Z),this._z=Math.atan2(P,k)):(this._y=Math.atan2(-Y,w),this._z=0);break;case"ZXY":this._x=Math.asin(Ts(X,-1,1)),Math.abs(X)<.9999999?(this._y=Math.atan2(-Y,Z),this._z=Math.atan2(-M,k)):(this._y=0,this._z=Math.atan2(P,w));break;case"ZYX":this._y=Math.asin(-Ts(Y,-1,1)),Math.abs(Y)<.9999999?(this._x=Math.atan2(X,Z),this._z=Math.atan2(P,w)):(this._x=0,this._z=Math.atan2(-M,k));break;case"YZX":this._z=Math.asin(Ts(P,-1,1)),Math.abs(P)<.9999999?(this._x=Math.atan2(-j,k),this._y=Math.atan2(-Y,w)):(this._x=0,this._y=Math.atan2(N,Z));break;case"XZY":this._z=Math.asin(-Ts(M,-1,1)),Math.abs(M)<.9999999?(this._x=Math.atan2(X,k),this._y=Math.atan2(N,w)):(this._x=Math.atan2(-j,Z),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+d)}return this._order=d,A===!0&&this._onChangeCallback(),this}setFromQuaternion(a,d,A){return $j.makeRotationFromQuaternion(a),this.setFromRotationMatrix($j,d,A)}setFromVector3(a,d=this._order){return this.set(a.x,a.y,a.z,d)}reorder(a){return eG.setFromEuler(this),this.setFromQuaternion(eG,a)}equals(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._order===this._order}fromArray(a){return this._x=a[0],this._y=a[1],this._z=a[2],a[3]!==void 0&&(this._order=a[3]),this._onChangeCallback(),this}toArray(a=[],d=0){return a[d]=this._x,a[d+1]=this._y,a[d+2]=this._z,a[d+3]=this._order,a}_onChange(a){return this._onChangeCallback=a,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Rl.DEFAULT_ORDER="XYZ";class XE{constructor(){this.mask=1}set(a){this.mask=(1<<a|0)>>>0}enable(a){this.mask|=1<<a|0}enableAll(){this.mask=-1}toggle(a){this.mask^=1<<a|0}disable(a){this.mask&=~(1<<a|0)}disableAll(){this.mask=0}test(a){return(this.mask&a.mask)!==0}isEnabled(a){return(this.mask&(1<<a|0))!==0}}let oSe=0;const tG=new He,d0=new Vn,Th=new mr,KE=new He,_v=new He,lSe=new He,cSe=new Vn,iG=new He(1,0,0),rG=new He(0,1,0),nG=new He(0,0,1),sG={type:"added"},uSe={type:"removed"},p0={type:"childadded",child:null},hN={type:"childremoved",child:null};class Hn extends Bo{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:oSe++}),this.uuid=No(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Hn.DEFAULT_UP.clone();const a=new He,d=new Rl,A=new Vn,x=new He(1,1,1);function w(){A.setFromEuler(d,!1)}function M(){d.setFromQuaternion(A,void 0,!1)}d._onChange(w),A._onChange(M),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:a},rotation:{configurable:!0,enumerable:!0,value:d},quaternion:{configurable:!0,enumerable:!0,value:A},scale:{configurable:!0,enumerable:!0,value:x},modelViewMatrix:{value:new mr},normalMatrix:{value:new Xr}}),this.matrix=new mr,this.matrixWorld=new mr,this.matrixAutoUpdate=Hn.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Hn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new XE,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(a){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(a),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(a){return this.quaternion.premultiply(a),this}setRotationFromAxisAngle(a,d){this.quaternion.setFromAxisAngle(a,d)}setRotationFromEuler(a){this.quaternion.setFromEuler(a,!0)}setRotationFromMatrix(a){this.quaternion.setFromRotationMatrix(a)}setRotationFromQuaternion(a){this.quaternion.copy(a)}rotateOnAxis(a,d){return d0.setFromAxisAngle(a,d),this.quaternion.multiply(d0),this}rotateOnWorldAxis(a,d){return d0.setFromAxisAngle(a,d),this.quaternion.premultiply(d0),this}rotateX(a){return this.rotateOnAxis(iG,a)}rotateY(a){return this.rotateOnAxis(rG,a)}rotateZ(a){return this.rotateOnAxis(nG,a)}translateOnAxis(a,d){return tG.copy(a).applyQuaternion(this.quaternion),this.position.add(tG.multiplyScalar(d)),this}translateX(a){return this.translateOnAxis(iG,a)}translateY(a){return this.translateOnAxis(rG,a)}translateZ(a){return this.translateOnAxis(nG,a)}localToWorld(a){return this.updateWorldMatrix(!0,!1),a.applyMatrix4(this.matrixWorld)}worldToLocal(a){return this.updateWorldMatrix(!0,!1),a.applyMatrix4(Th.copy(this.matrixWorld).invert())}lookAt(a,d,A){a.isVector3?KE.copy(a):KE.set(a,d,A);const x=this.parent;this.updateWorldMatrix(!0,!1),_v.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Th.lookAt(_v,KE,this.up):Th.lookAt(KE,_v,this.up),this.quaternion.setFromRotationMatrix(Th),x&&(Th.extractRotation(x.matrixWorld),d0.setFromRotationMatrix(Th),this.quaternion.premultiply(d0.invert()))}add(a){if(arguments.length>1){for(let d=0;d<arguments.length;d++)this.add(arguments[d]);return this}return a===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",a),this):(a&&a.isObject3D?(a.removeFromParent(),a.parent=this,this.children.push(a),a.dispatchEvent(sG),p0.child=a,this.dispatchEvent(p0),p0.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",a),this)}remove(a){if(arguments.length>1){for(let A=0;A<arguments.length;A++)this.remove(arguments[A]);return this}const d=this.children.indexOf(a);return d!==-1&&(a.parent=null,this.children.splice(d,1),a.dispatchEvent(uSe),hN.child=a,this.dispatchEvent(hN),hN.child=null),this}removeFromParent(){const a=this.parent;return a!==null&&a.remove(this),this}clear(){return this.remove(...this.children)}attach(a){return this.updateWorldMatrix(!0,!1),Th.copy(this.matrixWorld).invert(),a.parent!==null&&(a.parent.updateWorldMatrix(!0,!1),Th.multiply(a.parent.matrixWorld)),a.applyMatrix4(Th),a.removeFromParent(),a.parent=this,this.children.push(a),a.updateWorldMatrix(!1,!0),a.dispatchEvent(sG),p0.child=a,this.dispatchEvent(p0),p0.child=null,this}getObjectById(a){return this.getObjectByProperty("id",a)}getObjectByName(a){return this.getObjectByProperty("name",a)}getObjectByProperty(a,d){if(this[a]===d)return this;for(let A=0,x=this.children.length;A<x;A++){const w=this.children[A].getObjectByProperty(a,d);if(w!==void 0)return w}}getObjectsByProperty(a,d,A=[]){this[a]===d&&A.push(this);const x=this.children;for(let w=0,M=x.length;w<M;w++)x[w].getObjectsByProperty(a,d,A);return A}getWorldPosition(a){return this.updateWorldMatrix(!0,!1),a.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(a){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_v,a,lSe),a}getWorldScale(a){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_v,cSe,a),a}getWorldDirection(a){this.updateWorldMatrix(!0,!1);const d=this.matrixWorld.elements;return a.set(d[8],d[9],d[10]).normalize()}raycast(){}traverse(a){a(this);const d=this.children;for(let A=0,x=d.length;A<x;A++)d[A].traverse(a)}traverseVisible(a){if(this.visible===!1)return;a(this);const d=this.children;for(let A=0,x=d.length;A<x;A++)d[A].traverseVisible(a)}traverseAncestors(a){const d=this.parent;d!==null&&(a(d),d.traverseAncestors(a))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(a){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||a)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0);const d=this.children;for(let A=0,x=d.length;A<x;A++){const w=d[A];(w.matrixWorldAutoUpdate===!0||a===!0)&&w.updateMatrixWorld(a)}}updateWorldMatrix(a,d){const A=this.parent;if(a===!0&&A!==null&&A.matrixWorldAutoUpdate===!0&&A.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),d===!0){const x=this.children;for(let w=0,M=x.length;w<M;w++){const N=x[w];N.matrixWorldAutoUpdate===!0&&N.updateWorldMatrix(!1,!0)}}}toJSON(a){const d=a===void 0||typeof a=="string",A={};d&&(a={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},A.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const x={};x.uuid=this.uuid,x.type=this.type,this.name!==""&&(x.name=this.name),this.castShadow===!0&&(x.castShadow=!0),this.receiveShadow===!0&&(x.receiveShadow=!0),this.visible===!1&&(x.visible=!1),this.frustumCulled===!1&&(x.frustumCulled=!1),this.renderOrder!==0&&(x.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(x.userData=this.userData),x.layers=this.layers.mask,x.matrix=this.matrix.toArray(),x.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(x.matrixAutoUpdate=!1),this.isInstancedMesh&&(x.type="InstancedMesh",x.count=this.count,x.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(x.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(x.type="BatchedMesh",x.perObjectFrustumCulled=this.perObjectFrustumCulled,x.sortObjects=this.sortObjects,x.drawRanges=this._drawRanges,x.reservedRanges=this._reservedRanges,x.visibility=this._visibility,x.active=this._active,x.bounds=this._bounds.map(N=>({boxInitialized:N.boxInitialized,boxMin:N.box.min.toArray(),boxMax:N.box.max.toArray(),sphereInitialized:N.sphereInitialized,sphereRadius:N.sphere.radius,sphereCenter:N.sphere.center.toArray()})),x.maxGeometryCount=this._maxGeometryCount,x.maxVertexCount=this._maxVertexCount,x.maxIndexCount=this._maxIndexCount,x.geometryInitialized=this._geometryInitialized,x.geometryCount=this._geometryCount,x.matricesTexture=this._matricesTexture.toJSON(a),this.boundingSphere!==null&&(x.boundingSphere={center:x.boundingSphere.center.toArray(),radius:x.boundingSphere.radius}),this.boundingBox!==null&&(x.boundingBox={min:x.boundingBox.min.toArray(),max:x.boundingBox.max.toArray()}));function w(N,P){return N[P.uuid]===void 0&&(N[P.uuid]=P.toJSON(a)),P.uuid}if(this.isScene)this.background&&(this.background.isColor?x.background=this.background.toJSON():this.background.isTexture&&(x.background=this.background.toJSON(a).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(x.environment=this.environment.toJSON(a).uuid);else if(this.isMesh||this.isLine||this.isPoints){x.geometry=w(a.geometries,this.geometry);const N=this.geometry.parameters;if(N!==void 0&&N.shapes!==void 0){const P=N.shapes;if(Array.isArray(P))for(let k=0,j=P.length;k<j;k++){const Y=P[k];w(a.shapes,Y)}else w(a.shapes,P)}}if(this.isSkinnedMesh&&(x.bindMode=this.bindMode,x.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(w(a.skeletons,this.skeleton),x.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const N=[];for(let P=0,k=this.material.length;P<k;P++)N.push(w(a.materials,this.material[P]));x.material=N}else x.material=w(a.materials,this.material);if(this.children.length>0){x.children=[];for(let N=0;N<this.children.length;N++)x.children.push(this.children[N].toJSON(a).object)}if(this.animations.length>0){x.animations=[];for(let N=0;N<this.animations.length;N++){const P=this.animations[N];x.animations.push(w(a.animations,P))}}if(d){const N=M(a.geometries),P=M(a.materials),k=M(a.textures),j=M(a.images),Y=M(a.shapes),X=M(a.skeletons),Z=M(a.animations),ie=M(a.nodes);N.length>0&&(A.geometries=N),P.length>0&&(A.materials=P),k.length>0&&(A.textures=k),j.length>0&&(A.images=j),Y.length>0&&(A.shapes=Y),X.length>0&&(A.skeletons=X),Z.length>0&&(A.animations=Z),ie.length>0&&(A.nodes=ie)}return A.object=x,A;function M(N){const P=[];for(const k in N){const j=N[k];delete j.metadata,P.push(j)}return P}}clone(a){return new this.constructor().copy(this,a)}copy(a,d=!0){if(this.name=a.name,this.up.copy(a.up),this.position.copy(a.position),this.rotation.order=a.rotation.order,this.quaternion.copy(a.quaternion),this.scale.copy(a.scale),this.matrix.copy(a.matrix),this.matrixWorld.copy(a.matrixWorld),this.matrixAutoUpdate=a.matrixAutoUpdate,this.matrixWorldAutoUpdate=a.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=a.matrixWorldNeedsUpdate,this.layers.mask=a.layers.mask,this.visible=a.visible,this.castShadow=a.castShadow,this.receiveShadow=a.receiveShadow,this.frustumCulled=a.frustumCulled,this.renderOrder=a.renderOrder,this.animations=a.animations.slice(),this.userData=JSON.parse(JSON.stringify(a.userData)),d===!0)for(let A=0;A<a.children.length;A++){const x=a.children[A];this.add(x.clone())}return this}}Hn.DEFAULT_UP=new He(0,1,0),Hn.DEFAULT_MATRIX_AUTO_UPDATE=!0,Hn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Dc=new He,Mh=new He,dN=new He,Rh=new He,f0=new He,m0=new He,aG=new He,pN=new He,fN=new He,mN=new He;class Il{constructor(a=new He,d=new He,A=new He){this.a=a,this.b=d,this.c=A}static getNormal(a,d,A,x){x.subVectors(A,d),Dc.subVectors(a,d),x.cross(Dc);const w=x.lengthSq();return w>0?x.multiplyScalar(1/Math.sqrt(w)):x.set(0,0,0)}static getBarycoord(a,d,A,x,w){Dc.subVectors(x,d),Mh.subVectors(A,d),dN.subVectors(a,d);const M=Dc.dot(Dc),N=Dc.dot(Mh),P=Dc.dot(dN),k=Mh.dot(Mh),j=Mh.dot(dN),Y=M*k-N*N;if(Y===0)return w.set(0,0,0),null;const X=1/Y,Z=(k*P-N*j)*X,ie=(M*j-N*P)*X;return w.set(1-Z-ie,ie,Z)}static containsPoint(a,d,A,x){return this.getBarycoord(a,d,A,x,Rh)===null?!1:Rh.x>=0&&Rh.y>=0&&Rh.x+Rh.y<=1}static getInterpolation(a,d,A,x,w,M,N,P){return this.getBarycoord(a,d,A,x,Rh)===null?(P.x=0,P.y=0,"z"in P&&(P.z=0),"w"in P&&(P.w=0),null):(P.setScalar(0),P.addScaledVector(w,Rh.x),P.addScaledVector(M,Rh.y),P.addScaledVector(N,Rh.z),P)}static isFrontFacing(a,d,A,x){return Dc.subVectors(A,d),Mh.subVectors(a,d),Dc.cross(Mh).dot(x)<0}set(a,d,A){return this.a.copy(a),this.b.copy(d),this.c.copy(A),this}setFromPointsAndIndices(a,d,A,x){return this.a.copy(a[d]),this.b.copy(a[A]),this.c.copy(a[x]),this}setFromAttributeAndIndices(a,d,A,x){return this.a.fromBufferAttribute(a,d),this.b.fromBufferAttribute(a,A),this.c.fromBufferAttribute(a,x),this}clone(){return new this.constructor().copy(this)}copy(a){return this.a.copy(a.a),this.b.copy(a.b),this.c.copy(a.c),this}getArea(){return Dc.subVectors(this.c,this.b),Mh.subVectors(this.a,this.b),Dc.cross(Mh).length()*.5}getMidpoint(a){return a.addVectors(this.a,this.b).add(this.c).multiplyScalar(.3333333333333333)}getNormal(a){return Il.getNormal(this.a,this.b,this.c,a)}getPlane(a){return a.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(a,d){return Il.getBarycoord(a,this.a,this.b,this.c,d)}getInterpolation(a,d,A,x,w){return Il.getInterpolation(a,this.a,this.b,this.c,d,A,x,w)}containsPoint(a){return Il.containsPoint(a,this.a,this.b,this.c)}isFrontFacing(a){return Il.isFrontFacing(this.a,this.b,this.c,a)}intersectsBox(a){return a.intersectsTriangle(this)}closestPointToPoint(a,d){const A=this.a,x=this.b,w=this.c;let M,N;f0.subVectors(x,A),m0.subVectors(w,A),pN.subVectors(a,A);const P=f0.dot(pN),k=m0.dot(pN);if(P<=0&&k<=0)return d.copy(A);fN.subVectors(a,x);const j=f0.dot(fN),Y=m0.dot(fN);if(j>=0&&Y<=j)return d.copy(x);const X=P*Y-j*k;if(X<=0&&P>=0&&j<=0)return M=P/(P-j),d.copy(A).addScaledVector(f0,M);mN.subVectors(a,w);const Z=f0.dot(mN),ie=m0.dot(mN);if(ie>=0&&Z<=ie)return d.copy(w);const oe=Z*k-P*ie;if(oe<=0&&k>=0&&ie<=0)return N=k/(k-ie),d.copy(A).addScaledVector(m0,N);const ne=j*ie-Z*Y;if(ne<=0&&Y-j>=0&&Z-ie>=0)return aG.subVectors(w,x),N=(Y-j)/(Y-j+(Z-ie)),d.copy(x).addScaledVector(aG,N);const ee=1/(ne+oe+X);return M=oe*ee,N=X*ee,d.copy(A).addScaledVector(f0,M).addScaledVector(m0,N)}equals(a){return a.a.equals(this.a)&&a.b.equals(this.b)&&a.c.equals(this.c)}}const oG={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Vd={h:0,s:0,l:0},YE={h:0,s:0,l:0};function gN(S,a,d){return d<0&&(d+=1),d>1&&(d-=1),d<.16666666666666666?S+(a-S)*6*d:d<.5?a:d<.6666666666666666?S+(a-S)*6*(.6666666666666666-d):S}class lr{constructor(a,d,A){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(a,d,A)}set(a,d,A){if(d===void 0&&A===void 0){const x=a;x&&x.isColor?this.copy(x):typeof x=="number"?this.setHex(x):typeof x=="string"&&this.setStyle(x)}else this.setRGB(a,d,A);return this}setScalar(a){return this.r=a,this.g=a,this.b=a,this}setHex(a,d=On){return a=Math.floor(a),this.r=(a>>16&255)/255,this.g=(a>>8&255)/255,this.b=(a&255)/255,Yn.toWorkingColorSpace(this,d),this}setRGB(a,d,A,x=Yn.workingColorSpace){return this.r=a,this.g=d,this.b=A,Yn.toWorkingColorSpace(this,x),this}setHSL(a,d,A,x=Yn.workingColorSpace){if(a=Av(a,1),d=Ts(d,0,1),A=Ts(A,0,1),d===0)this.r=this.g=this.b=A;else{const w=A<=.5?A*(1+d):A+d-A*d,M=2*A-w;this.r=gN(M,w,a+.3333333333333333),this.g=gN(M,w,a),this.b=gN(M,w,a-.3333333333333333)}return Yn.toWorkingColorSpace(this,x),this}setStyle(a,d=On){function A(w){w!==void 0&&parseFloat(w)<1&&console.warn("THREE.Color: Alpha component of "+a+" will be ignored.")}let x;if(x=/^(\w+)\(([^\)]*)\)/.exec(a)){let w;const M=x[1],N=x[2];switch(M){case"rgb":case"rgba":if(w=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(N))return A(w[4]),this.setRGB(Math.min(255,parseInt(w[1],10))/255,Math.min(255,parseInt(w[2],10))/255,Math.min(255,parseInt(w[3],10))/255,d);if(w=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(N))return A(w[4]),this.setRGB(Math.min(100,parseInt(w[1],10))/100,Math.min(100,parseInt(w[2],10))/100,Math.min(100,parseInt(w[3],10))/100,d);break;case"hsl":case"hsla":if(w=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(N))return A(w[4]),this.setHSL(parseFloat(w[1])/360,parseFloat(w[2])/100,parseFloat(w[3])/100,d);break;default:console.warn("THREE.Color: Unknown color model "+a)}}else if(x=/^\#([A-Fa-f\d]+)$/.exec(a)){const w=x[1],M=w.length;if(M===3)return this.setRGB(parseInt(w.charAt(0),16)/15,parseInt(w.charAt(1),16)/15,parseInt(w.charAt(2),16)/15,d);if(M===6)return this.setHex(parseInt(w,16),d);console.warn("THREE.Color: Invalid hex color "+a)}else if(a&&a.length>0)return this.setColorName(a,d);return this}setColorName(a,d=On){const A=oG[a.toLowerCase()];return A!==void 0?this.setHex(A,d):console.warn("THREE.Color: Unknown color "+a),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(a){return this.r=a.r,this.g=a.g,this.b=a.b,this}copySRGBToLinear(a){return this.r=Ud(a.r),this.g=Ud(a.g),this.b=Ud(a.b),this}copyLinearToSRGB(a){return this.r=vv(a.r),this.g=vv(a.g),this.b=vv(a.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(a=On){return Yn.fromWorkingColorSpace(po.copy(this),a),Math.round(Ts(po.r*255,0,255))*65536+Math.round(Ts(po.g*255,0,255))*256+Math.round(Ts(po.b*255,0,255))}getHexString(a=On){return("000000"+this.getHex(a).toString(16)).slice(-6)}getHSL(a,d=Yn.workingColorSpace){Yn.fromWorkingColorSpace(po.copy(this),d);const A=po.r,x=po.g,w=po.b,M=Math.max(A,x,w),N=Math.min(A,x,w);let P,k;const j=(N+M)/2;if(N===M)P=0,k=0;else{const Y=M-N;switch(k=j<=.5?Y/(M+N):Y/(2-M-N),M){case A:P=(x-w)/Y+(x<w?6:0);break;case x:P=(w-A)/Y+2;break;case w:P=(A-x)/Y+4;break}P/=6}return a.h=P,a.s=k,a.l=j,a}getRGB(a,d=Yn.workingColorSpace){return Yn.fromWorkingColorSpace(po.copy(this),d),a.r=po.r,a.g=po.g,a.b=po.b,a}getStyle(a=On){Yn.fromWorkingColorSpace(po.copy(this),a);const d=po.r,A=po.g,x=po.b;return a!==On?`color(${a} ${d.toFixed(3)} ${A.toFixed(3)} ${x.toFixed(3)})`:`rgb(${Math.round(d*255)},${Math.round(A*255)},${Math.round(x*255)})`}offsetHSL(a,d,A){return this.getHSL(Vd),this.setHSL(Vd.h+a,Vd.s+d,Vd.l+A)}add(a){return this.r+=a.r,this.g+=a.g,this.b+=a.b,this}addColors(a,d){return this.r=a.r+d.r,this.g=a.g+d.g,this.b=a.b+d.b,this}addScalar(a){return this.r+=a,this.g+=a,this.b+=a,this}sub(a){return this.r=Math.max(0,this.r-a.r),this.g=Math.max(0,this.g-a.g),this.b=Math.max(0,this.b-a.b),this}multiply(a){return this.r*=a.r,this.g*=a.g,this.b*=a.b,this}multiplyScalar(a){return this.r*=a,this.g*=a,this.b*=a,this}lerp(a,d){return this.r+=(a.r-this.r)*d,this.g+=(a.g-this.g)*d,this.b+=(a.b-this.b)*d,this}lerpColors(a,d,A){return this.r=a.r+(d.r-a.r)*A,this.g=a.g+(d.g-a.g)*A,this.b=a.b+(d.b-a.b)*A,this}lerpHSL(a,d){this.getHSL(Vd),a.getHSL(YE);const A=yf(Vd.h,YE.h,d),x=yf(Vd.s,YE.s,d),w=yf(Vd.l,YE.l,d);return this.setHSL(A,x,w),this}setFromVector3(a){return this.r=a.x,this.g=a.y,this.b=a.z,this}applyMatrix3(a){const d=this.r,A=this.g,x=this.b,w=a.elements;return this.r=w[0]*d+w[3]*A+w[6]*x,this.g=w[1]*d+w[4]*A+w[7]*x,this.b=w[2]*d+w[5]*A+w[8]*x,this}equals(a){return a.r===this.r&&a.g===this.g&&a.b===this.b}fromArray(a,d=0){return this.r=a[d],this.g=a[d+1],this.b=a[d+2],this}toArray(a=[],d=0){return a[d]=this.r,a[d+1]=this.g,a[d+2]=this.b,a}fromBufferAttribute(a,d){return this.r=a.getX(d),this.g=a.getY(d),this.b=a.getZ(d),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const po=new lr;lr.NAMES=oG;let hSe=0;class fo extends Bo{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:hSe++}),this.uuid=No(),this.name="",this.type="Material",this.blending=D,this.side=T,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=Ae,this.blendDst=_e,this.blendEquation=H,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new lr(0,0,0),this.blendAlpha=0,this.depthFunc=hi,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=fv,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=_h,this.stencilZFail=_h,this.stencilZPass=_h,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(a){this._alphaTest>0!=a>0&&this.version++,this._alphaTest=a}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(a){if(a!==void 0)for(const d in a){const A=a[d];if(A===void 0){console.warn(`THREE.Material: parameter '${d}' has value of undefined.`);continue}const x=this[d];if(x===void 0){console.warn(`THREE.Material: '${d}' is not a property of THREE.${this.type}.`);continue}x&&x.isColor?x.set(A):x&&x.isVector3&&A&&A.isVector3?x.copy(A):this[d]=A}}toJSON(a){const d=a===void 0||typeof a=="string";d&&(a={textures:{},images:{}});const A={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};A.uuid=this.uuid,A.type=this.type,this.name!==""&&(A.name=this.name),this.color&&this.color.isColor&&(A.color=this.color.getHex()),this.roughness!==void 0&&(A.roughness=this.roughness),this.metalness!==void 0&&(A.metalness=this.metalness),this.sheen!==void 0&&(A.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(A.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(A.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(A.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(A.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(A.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(A.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(A.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(A.shininess=this.shininess),this.clearcoat!==void 0&&(A.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(A.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(A.clearcoatMap=this.clearcoatMap.toJSON(a).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(A.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(a).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(A.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(a).uuid,A.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(A.dispersion=this.dispersion),this.iridescence!==void 0&&(A.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(A.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(A.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(A.iridescenceMap=this.iridescenceMap.toJSON(a).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(A.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(a).uuid),this.anisotropy!==void 0&&(A.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(A.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(A.anisotropyMap=this.anisotropyMap.toJSON(a).uuid),this.map&&this.map.isTexture&&(A.map=this.map.toJSON(a).uuid),this.matcap&&this.matcap.isTexture&&(A.matcap=this.matcap.toJSON(a).uuid),this.alphaMap&&this.alphaMap.isTexture&&(A.alphaMap=this.alphaMap.toJSON(a).uuid),this.lightMap&&this.lightMap.isTexture&&(A.lightMap=this.lightMap.toJSON(a).uuid,A.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(A.aoMap=this.aoMap.toJSON(a).uuid,A.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(A.bumpMap=this.bumpMap.toJSON(a).uuid,A.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(A.normalMap=this.normalMap.toJSON(a).uuid,A.normalMapType=this.normalMapType,A.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(A.displacementMap=this.displacementMap.toJSON(a).uuid,A.displacementScale=this.displacementScale,A.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(A.roughnessMap=this.roughnessMap.toJSON(a).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(A.metalnessMap=this.metalnessMap.toJSON(a).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(A.emissiveMap=this.emissiveMap.toJSON(a).uuid),this.specularMap&&this.specularMap.isTexture&&(A.specularMap=this.specularMap.toJSON(a).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(A.specularIntensityMap=this.specularIntensityMap.toJSON(a).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(A.specularColorMap=this.specularColorMap.toJSON(a).uuid),this.envMap&&this.envMap.isTexture&&(A.envMap=this.envMap.toJSON(a).uuid,this.combine!==void 0&&(A.combine=this.combine)),this.envMapRotation!==void 0&&(A.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(A.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(A.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(A.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(A.gradientMap=this.gradientMap.toJSON(a).uuid),this.transmission!==void 0&&(A.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(A.transmissionMap=this.transmissionMap.toJSON(a).uuid),this.thickness!==void 0&&(A.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(A.thicknessMap=this.thicknessMap.toJSON(a).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(A.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(A.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(A.size=this.size),this.shadowSide!==null&&(A.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(A.sizeAttenuation=this.sizeAttenuation),this.blending!==D&&(A.blending=this.blending),this.side!==T&&(A.side=this.side),this.vertexColors===!0&&(A.vertexColors=!0),this.opacity<1&&(A.opacity=this.opacity),this.transparent===!0&&(A.transparent=!0),this.blendSrc!==Ae&&(A.blendSrc=this.blendSrc),this.blendDst!==_e&&(A.blendDst=this.blendDst),this.blendEquation!==H&&(A.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(A.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(A.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(A.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(A.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(A.blendAlpha=this.blendAlpha),this.depthFunc!==hi&&(A.depthFunc=this.depthFunc),this.depthTest===!1&&(A.depthTest=this.depthTest),this.depthWrite===!1&&(A.depthWrite=this.depthWrite),this.colorWrite===!1&&(A.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(A.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==fv&&(A.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(A.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(A.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==_h&&(A.stencilFail=this.stencilFail),this.stencilZFail!==_h&&(A.stencilZFail=this.stencilZFail),this.stencilZPass!==_h&&(A.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(A.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(A.rotation=this.rotation),this.polygonOffset===!0&&(A.polygonOffset=!0),this.polygonOffsetFactor!==0&&(A.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(A.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(A.linewidth=this.linewidth),this.dashSize!==void 0&&(A.dashSize=this.dashSize),this.gapSize!==void 0&&(A.gapSize=this.gapSize),this.scale!==void 0&&(A.scale=this.scale),this.dithering===!0&&(A.dithering=!0),this.alphaTest>0&&(A.alphaTest=this.alphaTest),this.alphaHash===!0&&(A.alphaHash=!0),this.alphaToCoverage===!0&&(A.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(A.premultipliedAlpha=!0),this.forceSinglePass===!0&&(A.forceSinglePass=!0),this.wireframe===!0&&(A.wireframe=!0),this.wireframeLinewidth>1&&(A.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(A.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(A.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(A.flatShading=!0),this.visible===!1&&(A.visible=!1),this.toneMapped===!1&&(A.toneMapped=!1),this.fog===!1&&(A.fog=!1),Object.keys(this.userData).length>0&&(A.userData=this.userData);function x(w){const M=[];for(const N in w){const P=w[N];delete P.metadata,M.push(P)}return M}if(d){const w=x(a.textures),M=x(a.images);w.length>0&&(A.textures=w),M.length>0&&(A.images=M)}return A}clone(){return new this.constructor().copy(this)}copy(a){this.name=a.name,this.blending=a.blending,this.side=a.side,this.vertexColors=a.vertexColors,this.opacity=a.opacity,this.transparent=a.transparent,this.blendSrc=a.blendSrc,this.blendDst=a.blendDst,this.blendEquation=a.blendEquation,this.blendSrcAlpha=a.blendSrcAlpha,this.blendDstAlpha=a.blendDstAlpha,this.blendEquationAlpha=a.blendEquationAlpha,this.blendColor.copy(a.blendColor),this.blendAlpha=a.blendAlpha,this.depthFunc=a.depthFunc,this.depthTest=a.depthTest,this.depthWrite=a.depthWrite,this.stencilWriteMask=a.stencilWriteMask,this.stencilFunc=a.stencilFunc,this.stencilRef=a.stencilRef,this.stencilFuncMask=a.stencilFuncMask,this.stencilFail=a.stencilFail,this.stencilZFail=a.stencilZFail,this.stencilZPass=a.stencilZPass,this.stencilWrite=a.stencilWrite;const d=a.clippingPlanes;let A=null;if(d!==null){const x=d.length;A=new Array(x);for(let w=0;w!==x;++w)A[w]=d[w].clone()}return this.clippingPlanes=A,this.clipIntersection=a.clipIntersection,this.clipShadows=a.clipShadows,this.shadowSide=a.shadowSide,this.colorWrite=a.colorWrite,this.precision=a.precision,this.polygonOffset=a.polygonOffset,this.polygonOffsetFactor=a.polygonOffsetFactor,this.polygonOffsetUnits=a.polygonOffsetUnits,this.dithering=a.dithering,this.alphaTest=a.alphaTest,this.alphaHash=a.alphaHash,this.alphaToCoverage=a.alphaToCoverage,this.premultipliedAlpha=a.premultipliedAlpha,this.forceSinglePass=a.forceSinglePass,this.visible=a.visible,this.toneMapped=a.toneMapped,this.userData=JSON.parse(JSON.stringify(a.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(a){a===!0&&this.version++}}class Hd extends fo{constructor(a){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new lr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Rl,this.combine=Ge,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.map=a.map,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.specularMap=a.specularMap,this.alphaMap=a.alphaMap,this.envMap=a.envMap,this.envMapRotation.copy(a.envMapRotation),this.combine=a.combine,this.reflectivity=a.reflectivity,this.refractionRatio=a.refractionRatio,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.fog=a.fog,this}}const Ih=dSe();function dSe(){const S=new ArrayBuffer(4),a=new Float32Array(S),d=new Uint32Array(S),A=new Uint32Array(512),x=new Uint32Array(512);for(let P=0;P<256;++P){const k=P-127;k<-27?(A[P]=0,A[P|256]=32768,x[P]=24,x[P|256]=24):k<-14?(A[P]=1024>>-k-14,A[P|256]=1024>>-k-14|32768,x[P]=-k-1,x[P|256]=-k-1):k<=15?(A[P]=k+15<<10,A[P|256]=k+15<<10|32768,x[P]=13,x[P|256]=13):k<128?(A[P]=31744,A[P|256]=64512,x[P]=24,x[P|256]=24):(A[P]=31744,A[P|256]=64512,x[P]=13,x[P|256]=13)}const w=new Uint32Array(2048),M=new Uint32Array(64),N=new Uint32Array(64);for(let P=1;P<1024;++P){let k=P<<13,j=0;for(;!(k&8388608);)k<<=1,j-=8388608;k&=-8388609,j+=947912704,w[P]=k|j}for(let P=1024;P<2048;++P)w[P]=939524096+(P-1024<<13);for(let P=1;P<31;++P)M[P]=P<<23;M[31]=1199570944,M[32]=2147483648;for(let P=33;P<63;++P)M[P]=2147483648+(P-32<<23);M[63]=3347054592;for(let P=1;P<64;++P)P!==32&&(N[P]=1024);return{floatView:a,uint32View:d,baseTable:A,shiftTable:x,mantissaTable:w,exponentTable:M,offsetTable:N}}function al(S){Math.abs(S)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),S=Ts(S,-65504,65504),Ih.floatView[0]=S;const a=Ih.uint32View[0],d=a>>23&511;return Ih.baseTable[d]+((a&8388607)>>Ih.shiftTable[d])}function Ev(S){const a=S>>10;return Ih.uint32View[0]=Ih.mantissaTable[Ih.offsetTable[a]+(S&1023)]+Ih.exponentTable[a],Ih.floatView[0]}const pSe={toHalfFloat:al,fromHalfFloat:Ev},ca=new He,JE=new oi;class as{constructor(a,d,A=!1){if(Array.isArray(a))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=a,this.itemSize=d,this.count=a!==void 0?a.length/d:0,this.normalized=A,this.usage=gf,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=Tt,this.version=0}onUploadCallback(){}set needsUpdate(a){a===!0&&this.version++}get updateRange(){return GE("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(a){return this.usage=a,this}addUpdateRange(a,d){this.updateRanges.push({start:a,count:d})}clearUpdateRanges(){this.updateRanges.length=0}copy(a){return this.name=a.name,this.array=new a.array.constructor(a.array),this.itemSize=a.itemSize,this.count=a.count,this.normalized=a.normalized,this.usage=a.usage,this.gpuType=a.gpuType,this}copyAt(a,d,A){a*=this.itemSize,A*=d.itemSize;for(let x=0,w=this.itemSize;x<w;x++)this.array[a+x]=d.array[A+x];return this}copyArray(a){return this.array.set(a),this}applyMatrix3(a){if(this.itemSize===2)for(let d=0,A=this.count;d<A;d++)JE.fromBufferAttribute(this,d),JE.applyMatrix3(a),this.setXY(d,JE.x,JE.y);else if(this.itemSize===3)for(let d=0,A=this.count;d<A;d++)ca.fromBufferAttribute(this,d),ca.applyMatrix3(a),this.setXYZ(d,ca.x,ca.y,ca.z);return this}applyMatrix4(a){for(let d=0,A=this.count;d<A;d++)ca.fromBufferAttribute(this,d),ca.applyMatrix4(a),this.setXYZ(d,ca.x,ca.y,ca.z);return this}applyNormalMatrix(a){for(let d=0,A=this.count;d<A;d++)ca.fromBufferAttribute(this,d),ca.applyNormalMatrix(a),this.setXYZ(d,ca.x,ca.y,ca.z);return this}transformDirection(a){for(let d=0,A=this.count;d<A;d++)ca.fromBufferAttribute(this,d),ca.transformDirection(a),this.setXYZ(d,ca.x,ca.y,ca.z);return this}set(a,d=0){return this.array.set(a,d),this}getComponent(a,d){let A=this.array[a*this.itemSize+d];return this.normalized&&(A=Ka(A,this.array)),A}setComponent(a,d,A){return this.normalized&&(A=Yr(A,this.array)),this.array[a*this.itemSize+d]=A,this}getX(a){let d=this.array[a*this.itemSize];return this.normalized&&(d=Ka(d,this.array)),d}setX(a,d){return this.normalized&&(d=Yr(d,this.array)),this.array[a*this.itemSize]=d,this}getY(a){let d=this.array[a*this.itemSize+1];return this.normalized&&(d=Ka(d,this.array)),d}setY(a,d){return this.normalized&&(d=Yr(d,this.array)),this.array[a*this.itemSize+1]=d,this}getZ(a){let d=this.array[a*this.itemSize+2];return this.normalized&&(d=Ka(d,this.array)),d}setZ(a,d){return this.normalized&&(d=Yr(d,this.array)),this.array[a*this.itemSize+2]=d,this}getW(a){let d=this.array[a*this.itemSize+3];return this.normalized&&(d=Ka(d,this.array)),d}setW(a,d){return this.normalized&&(d=Yr(d,this.array)),this.array[a*this.itemSize+3]=d,this}setXY(a,d,A){return a*=this.itemSize,this.normalized&&(d=Yr(d,this.array),A=Yr(A,this.array)),this.array[a+0]=d,this.array[a+1]=A,this}setXYZ(a,d,A,x){return a*=this.itemSize,this.normalized&&(d=Yr(d,this.array),A=Yr(A,this.array),x=Yr(x,this.array)),this.array[a+0]=d,this.array[a+1]=A,this.array[a+2]=x,this}setXYZW(a,d,A,x,w){return a*=this.itemSize,this.normalized&&(d=Yr(d,this.array),A=Yr(A,this.array),x=Yr(x,this.array),w=Yr(w,this.array)),this.array[a+0]=d,this.array[a+1]=A,this.array[a+2]=x,this.array[a+3]=w,this}onUpload(a){return this.onUploadCallback=a,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const a={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(a.name=this.name),this.usage!==gf&&(a.usage=this.usage),a}}class fSe extends as{constructor(a,d,A){super(new Int8Array(a),d,A)}}class mSe extends as{constructor(a,d,A){super(new Uint8Array(a),d,A)}}class gSe extends as{constructor(a,d,A){super(new Uint8ClampedArray(a),d,A)}}class ASe extends as{constructor(a,d,A){super(new Int16Array(a),d,A)}}class AN extends as{constructor(a,d,A){super(new Uint16Array(a),d,A)}}class ySe extends as{constructor(a,d,A){super(new Int32Array(a),d,A)}}class yN extends as{constructor(a,d,A){super(new Uint32Array(a),d,A)}}class vSe extends as{constructor(a,d,A){super(new Uint16Array(a),d,A),this.isFloat16BufferAttribute=!0}getX(a){let d=Ev(this.array[a*this.itemSize]);return this.normalized&&(d=Ka(d,this.array)),d}setX(a,d){return this.normalized&&(d=Yr(d,this.array)),this.array[a*this.itemSize]=al(d),this}getY(a){let d=Ev(this.array[a*this.itemSize+1]);return this.normalized&&(d=Ka(d,this.array)),d}setY(a,d){return this.normalized&&(d=Yr(d,this.array)),this.array[a*this.itemSize+1]=al(d),this}getZ(a){let d=Ev(this.array[a*this.itemSize+2]);return this.normalized&&(d=Ka(d,this.array)),d}setZ(a,d){return this.normalized&&(d=Yr(d,this.array)),this.array[a*this.itemSize+2]=al(d),this}getW(a){let d=Ev(this.array[a*this.itemSize+3]);return this.normalized&&(d=Ka(d,this.array)),d}setW(a,d){return this.normalized&&(d=Yr(d,this.array)),this.array[a*this.itemSize+3]=al(d),this}setXY(a,d,A){return a*=this.itemSize,this.normalized&&(d=Yr(d,this.array),A=Yr(A,this.array)),this.array[a+0]=al(d),this.array[a+1]=al(A),this}setXYZ(a,d,A,x){return a*=this.itemSize,this.normalized&&(d=Yr(d,this.array),A=Yr(A,this.array),x=Yr(x,this.array)),this.array[a+0]=al(d),this.array[a+1]=al(A),this.array[a+2]=al(x),this}setXYZW(a,d,A,x,w){return a*=this.itemSize,this.normalized&&(d=Yr(d,this.array),A=Yr(A,this.array),x=Yr(x,this.array),w=Yr(w,this.array)),this.array[a+0]=al(d),this.array[a+1]=al(A),this.array[a+2]=al(x),this.array[a+3]=al(w),this}}class br extends as{constructor(a,d,A){super(new Float32Array(a),d,A)}}let bSe=0;const ql=new mr,vN=new Hn,g0=new He,Bl=new Ls,wv=new Ls,Pa=new He;class pn extends Bo{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:bSe++}),this.uuid=No(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(a){return Array.isArray(a)?this.index=new(UE(a)?yN:AN)(a,1):this.index=a,this}getAttribute(a){return this.attributes[a]}setAttribute(a,d){return this.attributes[a]=d,this}deleteAttribute(a){return delete this.attributes[a],this}hasAttribute(a){return this.attributes[a]!==void 0}addGroup(a,d,A=0){this.groups.push({start:a,count:d,materialIndex:A})}clearGroups(){this.groups=[]}setDrawRange(a,d){this.drawRange.start=a,this.drawRange.count=d}applyMatrix4(a){const d=this.attributes.position;d!==void 0&&(d.applyMatrix4(a),d.needsUpdate=!0);const A=this.attributes.normal;if(A!==void 0){const w=new Xr().getNormalMatrix(a);A.applyNormalMatrix(w),A.needsUpdate=!0}const x=this.attributes.tangent;return x!==void 0&&(x.transformDirection(a),x.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(a){return ql.makeRotationFromQuaternion(a),this.applyMatrix4(ql),this}rotateX(a){return ql.makeRotationX(a),this.applyMatrix4(ql),this}rotateY(a){return ql.makeRotationY(a),this.applyMatrix4(ql),this}rotateZ(a){return ql.makeRotationZ(a),this.applyMatrix4(ql),this}translate(a,d,A){return ql.makeTranslation(a,d,A),this.applyMatrix4(ql),this}scale(a,d,A){return ql.makeScale(a,d,A),this.applyMatrix4(ql),this}lookAt(a){return vN.lookAt(a),vN.updateMatrix(),this.applyMatrix4(vN.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(g0).negate(),this.translate(g0.x,g0.y,g0.z),this}setFromPoints(a){const d=[];for(let A=0,x=a.length;A<x;A++){const w=a[A];d.push(w.x,w.y,w.z||0)}return this.setAttribute("position",new br(d,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ls);const a=this.attributes.position,d=this.morphAttributes.position;if(a&&a.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new He(-1/0,-1/0,-1/0),new He(1/0,1/0,1/0));return}if(a!==void 0){if(this.boundingBox.setFromBufferAttribute(a),d)for(let A=0,x=d.length;A<x;A++){const w=d[A];Bl.setFromBufferAttribute(w),this.morphTargetsRelative?(Pa.addVectors(this.boundingBox.min,Bl.min),this.boundingBox.expandByPoint(Pa),Pa.addVectors(this.boundingBox.max,Bl.max),this.boundingBox.expandByPoint(Pa)):(this.boundingBox.expandByPoint(Bl.min),this.boundingBox.expandByPoint(Bl.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Aa);const a=this.attributes.position,d=this.morphAttributes.position;if(a&&a.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new He,1/0);return}if(a){const A=this.boundingSphere.center;if(Bl.setFromBufferAttribute(a),d)for(let w=0,M=d.length;w<M;w++){const N=d[w];wv.setFromBufferAttribute(N),this.morphTargetsRelative?(Pa.addVectors(Bl.min,wv.min),Bl.expandByPoint(Pa),Pa.addVectors(Bl.max,wv.max),Bl.expandByPoint(Pa)):(Bl.expandByPoint(wv.min),Bl.expandByPoint(wv.max))}Bl.getCenter(A);let x=0;for(let w=0,M=a.count;w<M;w++)Pa.fromBufferAttribute(a,w),x=Math.max(x,A.distanceToSquared(Pa));if(d)for(let w=0,M=d.length;w<M;w++){const N=d[w],P=this.morphTargetsRelative;for(let k=0,j=N.count;k<j;k++)Pa.fromBufferAttribute(N,k),P&&(g0.fromBufferAttribute(a,k),Pa.add(g0)),x=Math.max(x,A.distanceToSquared(Pa))}this.boundingSphere.radius=Math.sqrt(x),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const a=this.index,d=this.attributes;if(a===null||d.position===void 0||d.normal===void 0||d.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const A=d.position,x=d.normal,w=d.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new as(new Float32Array(4*A.count),4));const M=this.getAttribute("tangent"),N=[],P=[];for(let rt=0;rt<A.count;rt++)N[rt]=new He,P[rt]=new He;const k=new He,j=new He,Y=new He,X=new oi,Z=new oi,ie=new oi,oe=new He,ne=new He;function ee(rt,ze,De){k.fromBufferAttribute(A,rt),j.fromBufferAttribute(A,ze),Y.fromBufferAttribute(A,De),X.fromBufferAttribute(w,rt),Z.fromBufferAttribute(w,ze),ie.fromBufferAttribute(w,De),j.sub(k),Y.sub(k),Z.sub(X),ie.sub(X);const nt=1/(Z.x*ie.y-ie.x*Z.y);isFinite(nt)&&(oe.copy(j).multiplyScalar(ie.y).addScaledVector(Y,-Z.y).multiplyScalar(nt),ne.copy(Y).multiplyScalar(Z.x).addScaledVector(j,-ie.x).multiplyScalar(nt),N[rt].add(oe),N[ze].add(oe),N[De].add(oe),P[rt].add(ne),P[ze].add(ne),P[De].add(ne))}let Me=this.groups;Me.length===0&&(Me=[{start:0,count:a.count}]);for(let rt=0,ze=Me.length;rt<ze;++rt){const De=Me[rt],nt=De.start,gt=De.count;for(let ft=nt,Rt=nt+gt;ft<Rt;ft+=3)ee(a.getX(ft+0),a.getX(ft+1),a.getX(ft+2))}const we=new He,xe=new He,st=new He,Qe=new He;function Ze(rt){st.fromBufferAttribute(x,rt),Qe.copy(st);const ze=N[rt];we.copy(ze),we.sub(st.multiplyScalar(st.dot(ze))).normalize(),xe.crossVectors(Qe,ze);const De=xe.dot(P[rt])<0?-1:1;M.setXYZW(rt,we.x,we.y,we.z,De)}for(let rt=0,ze=Me.length;rt<ze;++rt){const De=Me[rt],nt=De.start,gt=De.count;for(let ft=nt,Rt=nt+gt;ft<Rt;ft+=3)Ze(a.getX(ft+0)),Ze(a.getX(ft+1)),Ze(a.getX(ft+2))}}computeVertexNormals(){const a=this.index,d=this.getAttribute("position");if(d!==void 0){let A=this.getAttribute("normal");if(A===void 0)A=new as(new Float32Array(d.count*3),3),this.setAttribute("normal",A);else for(let X=0,Z=A.count;X<Z;X++)A.setXYZ(X,0,0,0);const x=new He,w=new He,M=new He,N=new He,P=new He,k=new He,j=new He,Y=new He;if(a)for(let X=0,Z=a.count;X<Z;X+=3){const ie=a.getX(X+0),oe=a.getX(X+1),ne=a.getX(X+2);x.fromBufferAttribute(d,ie),w.fromBufferAttribute(d,oe),M.fromBufferAttribute(d,ne),j.subVectors(M,w),Y.subVectors(x,w),j.cross(Y),N.fromBufferAttribute(A,ie),P.fromBufferAttribute(A,oe),k.fromBufferAttribute(A,ne),N.add(j),P.add(j),k.add(j),A.setXYZ(ie,N.x,N.y,N.z),A.setXYZ(oe,P.x,P.y,P.z),A.setXYZ(ne,k.x,k.y,k.z)}else for(let X=0,Z=d.count;X<Z;X+=3)x.fromBufferAttribute(d,X+0),w.fromBufferAttribute(d,X+1),M.fromBufferAttribute(d,X+2),j.subVectors(M,w),Y.subVectors(x,w),j.cross(Y),A.setXYZ(X+0,j.x,j.y,j.z),A.setXYZ(X+1,j.x,j.y,j.z),A.setXYZ(X+2,j.x,j.y,j.z);this.normalizeNormals(),A.needsUpdate=!0}}normalizeNormals(){const a=this.attributes.normal;for(let d=0,A=a.count;d<A;d++)Pa.fromBufferAttribute(a,d),Pa.normalize(),a.setXYZ(d,Pa.x,Pa.y,Pa.z)}toNonIndexed(){function a(N,P){const k=N.array,j=N.itemSize,Y=N.normalized,X=new k.constructor(P.length*j);let Z=0,ie=0;for(let oe=0,ne=P.length;oe<ne;oe++){N.isInterleavedBufferAttribute?Z=P[oe]*N.data.stride+N.offset:Z=P[oe]*j;for(let ee=0;ee<j;ee++)X[ie++]=k[Z++]}return new as(X,j,Y)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const d=new pn,A=this.index.array,x=this.attributes;for(const N in x){const P=x[N],k=a(P,A);d.setAttribute(N,k)}const w=this.morphAttributes;for(const N in w){const P=[],k=w[N];for(let j=0,Y=k.length;j<Y;j++){const X=k[j],Z=a(X,A);P.push(Z)}d.morphAttributes[N]=P}d.morphTargetsRelative=this.morphTargetsRelative;const M=this.groups;for(let N=0,P=M.length;N<P;N++){const k=M[N];d.addGroup(k.start,k.count,k.materialIndex)}return d}toJSON(){const a={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(a.uuid=this.uuid,a.type=this.type,this.name!==""&&(a.name=this.name),Object.keys(this.userData).length>0&&(a.userData=this.userData),this.parameters!==void 0){const P=this.parameters;for(const k in P)P[k]!==void 0&&(a[k]=P[k]);return a}a.data={attributes:{}};const d=this.index;d!==null&&(a.data.index={type:d.array.constructor.name,array:Array.prototype.slice.call(d.array)});const A=this.attributes;for(const P in A){const k=A[P];a.data.attributes[P]=k.toJSON(a.data)}const x={};let w=!1;for(const P in this.morphAttributes){const k=this.morphAttributes[P],j=[];for(let Y=0,X=k.length;Y<X;Y++){const Z=k[Y];j.push(Z.toJSON(a.data))}j.length>0&&(x[P]=j,w=!0)}w&&(a.data.morphAttributes=x,a.data.morphTargetsRelative=this.morphTargetsRelative);const M=this.groups;M.length>0&&(a.data.groups=JSON.parse(JSON.stringify(M)));const N=this.boundingSphere;return N!==null&&(a.data.boundingSphere={center:N.center.toArray(),radius:N.radius}),a}clone(){return new this.constructor().copy(this)}copy(a){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const d={};this.name=a.name;const A=a.index;A!==null&&this.setIndex(A.clone(d));const x=a.attributes;for(const k in x){const j=x[k];this.setAttribute(k,j.clone(d))}const w=a.morphAttributes;for(const k in w){const j=[],Y=w[k];for(let X=0,Z=Y.length;X<Z;X++)j.push(Y[X].clone(d));this.morphAttributes[k]=j}this.morphTargetsRelative=a.morphTargetsRelative;const M=a.groups;for(let k=0,j=M.length;k<j;k++){const Y=M[k];this.addGroup(Y.start,Y.count,Y.materialIndex)}const N=a.boundingBox;N!==null&&(this.boundingBox=N.clone());const P=a.boundingSphere;return P!==null&&(this.boundingSphere=P.clone()),this.drawRange.start=a.drawRange.start,this.drawRange.count=a.drawRange.count,this.userData=a.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const lG=new mr,bf=new ya,ZE=new Aa,cG=new He,A0=new He,y0=new He,v0=new He,bN=new He,$E=new He,ew=new oi,tw=new oi,iw=new oi,uG=new He,hG=new He,dG=new He,rw=new He,nw=new He;class ua extends Hn{constructor(a=new pn,d=new Hd){super(),this.isMesh=!0,this.type="Mesh",this.geometry=a,this.material=d,this.updateMorphTargets()}copy(a,d){return super.copy(a,d),a.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=a.morphTargetInfluences.slice()),a.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},a.morphTargetDictionary)),this.material=Array.isArray(a.material)?a.material.slice():a.material,this.geometry=a.geometry,this}updateMorphTargets(){const a=this.geometry.morphAttributes,d=Object.keys(a);if(d.length>0){const A=a[d[0]];if(A!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let x=0,w=A.length;x<w;x++){const M=A[x].name||String(x);this.morphTargetInfluences.push(0),this.morphTargetDictionary[M]=x}}}}getVertexPosition(a,d){const A=this.geometry,x=A.attributes.position,w=A.morphAttributes.position,M=A.morphTargetsRelative;d.fromBufferAttribute(x,a);const N=this.morphTargetInfluences;if(w&&N){$E.set(0,0,0);for(let P=0,k=w.length;P<k;P++){const j=N[P],Y=w[P];j!==0&&(bN.fromBufferAttribute(Y,a),M?$E.addScaledVector(bN,j):$E.addScaledVector(bN.sub(d),j))}d.add($E)}return d}raycast(a,d){const A=this.geometry,x=this.material,w=this.matrixWorld;x!==void 0&&(A.boundingSphere===null&&A.computeBoundingSphere(),ZE.copy(A.boundingSphere),ZE.applyMatrix4(w),bf.copy(a.ray).recast(a.near),!(ZE.containsPoint(bf.origin)===!1&&(bf.intersectSphere(ZE,cG)===null||bf.origin.distanceToSquared(cG)>(a.far-a.near)**2))&&(lG.copy(w).invert(),bf.copy(a.ray).applyMatrix4(lG),!(A.boundingBox!==null&&bf.intersectsBox(A.boundingBox)===!1)&&this._computeIntersections(a,d,bf)))}_computeIntersections(a,d,A){let x;const w=this.geometry,M=this.material,N=w.index,P=w.attributes.position,k=w.attributes.uv,j=w.attributes.uv1,Y=w.attributes.normal,X=w.groups,Z=w.drawRange;if(N!==null)if(Array.isArray(M))for(let ie=0,oe=X.length;ie<oe;ie++){const ne=X[ie],ee=M[ne.materialIndex],Me=Math.max(ne.start,Z.start),we=Math.min(N.count,Math.min(ne.start+ne.count,Z.start+Z.count));for(let xe=Me,st=we;xe<st;xe+=3){const Qe=N.getX(xe),Ze=N.getX(xe+1),rt=N.getX(xe+2);x=sw(this,ee,a,A,k,j,Y,Qe,Ze,rt),x&&(x.faceIndex=Math.floor(xe/3),x.face.materialIndex=ne.materialIndex,d.push(x))}}else{const ie=Math.max(0,Z.start),oe=Math.min(N.count,Z.start+Z.count);for(let ne=ie,ee=oe;ne<ee;ne+=3){const Me=N.getX(ne),we=N.getX(ne+1),xe=N.getX(ne+2);x=sw(this,M,a,A,k,j,Y,Me,we,xe),x&&(x.faceIndex=Math.floor(ne/3),d.push(x))}}else if(P!==void 0)if(Array.isArray(M))for(let ie=0,oe=X.length;ie<oe;ie++){const ne=X[ie],ee=M[ne.materialIndex],Me=Math.max(ne.start,Z.start),we=Math.min(P.count,Math.min(ne.start+ne.count,Z.start+Z.count));for(let xe=Me,st=we;xe<st;xe+=3){const Qe=xe,Ze=xe+1,rt=xe+2;x=sw(this,ee,a,A,k,j,Y,Qe,Ze,rt),x&&(x.faceIndex=Math.floor(xe/3),x.face.materialIndex=ne.materialIndex,d.push(x))}}else{const ie=Math.max(0,Z.start),oe=Math.min(P.count,Z.start+Z.count);for(let ne=ie,ee=oe;ne<ee;ne+=3){const Me=ne,we=ne+1,xe=ne+2;x=sw(this,M,a,A,k,j,Y,Me,we,xe),x&&(x.faceIndex=Math.floor(ne/3),d.push(x))}}}}function xSe(S,a,d,A,x,w,M,N){let P;if(a.side===R?P=A.intersectTriangle(M,w,x,!0,N):P=A.intersectTriangle(x,w,M,a.side===T,N),P===null)return null;nw.copy(N),nw.applyMatrix4(S.matrixWorld);const k=d.ray.origin.distanceTo(nw);return k<d.near||k>d.far?null:{distance:k,point:nw.clone(),object:S}}function sw(S,a,d,A,x,w,M,N,P,k){S.getVertexPosition(N,A0),S.getVertexPosition(P,y0),S.getVertexPosition(k,v0);const j=xSe(S,a,d,A,A0,y0,v0,rw);if(j){x&&(ew.fromBufferAttribute(x,N),tw.fromBufferAttribute(x,P),iw.fromBufferAttribute(x,k),j.uv=Il.getInterpolation(rw,A0,y0,v0,ew,tw,iw,new oi)),w&&(ew.fromBufferAttribute(w,N),tw.fromBufferAttribute(w,P),iw.fromBufferAttribute(w,k),j.uv1=Il.getInterpolation(rw,A0,y0,v0,ew,tw,iw,new oi)),M&&(uG.fromBufferAttribute(M,N),hG.fromBufferAttribute(M,P),dG.fromBufferAttribute(M,k),j.normal=Il.getInterpolation(rw,A0,y0,v0,uG,hG,dG,new He),j.normal.dot(A.direction)>0&&j.normal.multiplyScalar(-1));const Y={a:N,b:P,c:k,normal:new He,materialIndex:0};Il.getNormal(A0,y0,v0,Y.normal),j.face=Y}return j}class xf extends pn{constructor(a=1,d=1,A=1,x=1,w=1,M=1){super(),this.type="BoxGeometry",this.parameters={width:a,height:d,depth:A,widthSegments:x,heightSegments:w,depthSegments:M};const N=this;x=Math.floor(x),w=Math.floor(w),M=Math.floor(M);const P=[],k=[],j=[],Y=[];let X=0,Z=0;ie("z","y","x",-1,-1,A,d,a,M,w,0),ie("z","y","x",1,-1,A,d,-a,M,w,1),ie("x","z","y",1,1,a,A,d,x,M,2),ie("x","z","y",1,-1,a,A,-d,x,M,3),ie("x","y","z",1,-1,a,d,A,x,w,4),ie("x","y","z",-1,-1,a,d,-A,x,w,5),this.setIndex(P),this.setAttribute("position",new br(k,3)),this.setAttribute("normal",new br(j,3)),this.setAttribute("uv",new br(Y,2));function ie(oe,ne,ee,Me,we,xe,st,Qe,Ze,rt,ze){const De=xe/Ze,nt=st/rt,gt=xe/2,ft=st/2,Rt=Qe/2,Ut=Ze+1,fi=rt+1;let Oi=0,zt=0;const bi=new He;for(let Pi=0;Pi<fi;Pi++){const Ur=Pi*nt-ft;for(let _n=0;_n<Ut;_n++){const is=_n*De-gt;bi[oe]=is*Me,bi[ne]=Ur*we,bi[ee]=Rt,k.push(bi.x,bi.y,bi.z),bi[oe]=0,bi[ne]=0,bi[ee]=Qe>0?1:-1,j.push(bi.x,bi.y,bi.z),Y.push(_n/Ze),Y.push(1-Pi/rt),Oi+=1}}for(let Pi=0;Pi<rt;Pi++)for(let Ur=0;Ur<Ze;Ur++){const _n=X+Ur+Ut*Pi,is=X+Ur+Ut*(Pi+1),ps=X+(Ur+1)+Ut*(Pi+1),jn=X+(Ur+1)+Ut*Pi;P.push(_n,is,jn),P.push(is,ps,jn),zt+=6}N.addGroup(Z,zt,ze),Z+=zt,X+=Oi}}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new xf(a.width,a.height,a.depth,a.widthSegments,a.heightSegments,a.depthSegments)}}function b0(S){const a={};for(const d in S){a[d]={};for(const A in S[d]){const x=S[d][A];x&&(x.isColor||x.isMatrix3||x.isMatrix4||x.isVector2||x.isVector3||x.isVector4||x.isTexture||x.isQuaternion)?x.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),a[d][A]=null):a[d][A]=x.clone():Array.isArray(x)?a[d][A]=x.slice():a[d][A]=x}}return a}function Do(S){const a={};for(let d=0;d<S.length;d++){const A=b0(S[d]);for(const x in A)a[x]=A[x]}return a}function _Se(S){const a=[];for(let d=0;d<S.length;d++)a.push(S[d].clone());return a}function pG(S){const a=S.getRenderTarget();return a===null?S.outputColorSpace:a.isXRRenderTarget===!0?a.texture.colorSpace:Yn.workingColorSpace}const fG={clone:b0,merge:Do};var ESe=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,wSe=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Oc extends fo{constructor(a){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=ESe,this.fragmentShader=wSe,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,a!==void 0&&this.setValues(a)}copy(a){return super.copy(a),this.fragmentShader=a.fragmentShader,this.vertexShader=a.vertexShader,this.uniforms=b0(a.uniforms),this.uniformsGroups=_Se(a.uniformsGroups),this.defines=Object.assign({},a.defines),this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.fog=a.fog,this.lights=a.lights,this.clipping=a.clipping,this.extensions=Object.assign({},a.extensions),this.glslVersion=a.glslVersion,this}toJSON(a){const d=super.toJSON(a);d.glslVersion=this.glslVersion,d.uniforms={};for(const x in this.uniforms){const w=this.uniforms[x].value;w&&w.isTexture?d.uniforms[x]={type:"t",value:w.toJSON(a).uuid}:w&&w.isColor?d.uniforms[x]={type:"c",value:w.getHex()}:w&&w.isVector2?d.uniforms[x]={type:"v2",value:w.toArray()}:w&&w.isVector3?d.uniforms[x]={type:"v3",value:w.toArray()}:w&&w.isVector4?d.uniforms[x]={type:"v4",value:w.toArray()}:w&&w.isMatrix3?d.uniforms[x]={type:"m3",value:w.toArray()}:w&&w.isMatrix4?d.uniforms[x]={type:"m4",value:w.toArray()}:d.uniforms[x]={value:w}}Object.keys(this.defines).length>0&&(d.defines=this.defines),d.vertexShader=this.vertexShader,d.fragmentShader=this.fragmentShader,d.lights=this.lights,d.clipping=this.clipping;const A={};for(const x in this.extensions)this.extensions[x]===!0&&(A[x]=!0);return Object.keys(A).length>0&&(d.extensions=A),d}}class aw extends Hn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new mr,this.projectionMatrix=new mr,this.projectionMatrixInverse=new mr,this.coordinateSystem=Wl}copy(a,d){return super.copy(a,d),this.matrixWorldInverse.copy(a.matrixWorldInverse),this.projectionMatrix.copy(a.projectionMatrix),this.projectionMatrixInverse.copy(a.projectionMatrixInverse),this.coordinateSystem=a.coordinateSystem,this}getWorldDirection(a){return super.getWorldDirection(a).negate()}updateMatrixWorld(a){super.updateMatrixWorld(a),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(a,d){super.updateWorldMatrix(a,d),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const Wd=new He,mG=new oi,gG=new oi;class va extends aw{constructor(a=50,d=1,A=.1,x=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=a,this.zoom=1,this.near=A,this.far=x,this.focus=10,this.aspect=d,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(a,d){return super.copy(a,d),this.fov=a.fov,this.zoom=a.zoom,this.near=a.near,this.far=a.far,this.focus=a.focus,this.aspect=a.aspect,this.view=a.view===null?null:Object.assign({},a.view),this.filmGauge=a.filmGauge,this.filmOffset=a.filmOffset,this}setFocalLength(a){const d=.5*this.getFilmHeight()/a;this.fov=kd*2*Math.atan(d),this.updateProjectionMatrix()}getFocalLength(){const a=Math.tan(Eh*.5*this.fov);return .5*this.getFilmHeight()/a}getEffectiveFOV(){return kd*2*Math.atan(Math.tan(Eh*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(a,d,A){Wd.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),d.set(Wd.x,Wd.y).multiplyScalar(-a/Wd.z),Wd.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),A.set(Wd.x,Wd.y).multiplyScalar(-a/Wd.z)}getViewSize(a,d){return this.getViewBounds(a,mG,gG),d.subVectors(gG,mG)}setViewOffset(a,d,A,x,w,M){this.aspect=a/d,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=a,this.view.fullHeight=d,this.view.offsetX=A,this.view.offsetY=x,this.view.width=w,this.view.height=M,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const a=this.near;let d=a*Math.tan(Eh*.5*this.fov)/this.zoom,A=2*d,x=this.aspect*A,w=-.5*x;const M=this.view;if(this.view!==null&&this.view.enabled){const P=M.fullWidth,k=M.fullHeight;w+=M.offsetX*x/P,d-=M.offsetY*A/k,x*=M.width/P,A*=M.height/k}const N=this.filmOffset;N!==0&&(w+=a*N/this.getFilmWidth()),this.projectionMatrix.makePerspective(w,w+x,d,d-A,a,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(a){const d=super.toJSON(a);return d.object.fov=this.fov,d.object.zoom=this.zoom,d.object.near=this.near,d.object.far=this.far,d.object.focus=this.focus,d.object.aspect=this.aspect,this.view!==null&&(d.object.view=Object.assign({},this.view)),d.object.filmGauge=this.filmGauge,d.object.filmOffset=this.filmOffset,d}}const x0=-90,_0=1;class AG extends Hn{constructor(a,d,A){super(),this.type="CubeCamera",this.renderTarget=A,this.coordinateSystem=null,this.activeMipmapLevel=0;const x=new va(x0,_0,a,d);x.layers=this.layers,this.add(x);const w=new va(x0,_0,a,d);w.layers=this.layers,this.add(w);const M=new va(x0,_0,a,d);M.layers=this.layers,this.add(M);const N=new va(x0,_0,a,d);N.layers=this.layers,this.add(N);const P=new va(x0,_0,a,d);P.layers=this.layers,this.add(P);const k=new va(x0,_0,a,d);k.layers=this.layers,this.add(k)}updateCoordinateSystem(){const a=this.coordinateSystem,d=this.children.concat(),[A,x,w,M,N,P]=d;for(const k of d)this.remove(k);if(a===Wl)A.up.set(0,1,0),A.lookAt(1,0,0),x.up.set(0,1,0),x.lookAt(-1,0,0),w.up.set(0,0,-1),w.lookAt(0,1,0),M.up.set(0,0,1),M.lookAt(0,-1,0),N.up.set(0,1,0),N.lookAt(0,0,1),P.up.set(0,1,0),P.lookAt(0,0,-1);else if(a===Af)A.up.set(0,-1,0),A.lookAt(-1,0,0),x.up.set(0,-1,0),x.lookAt(1,0,0),w.up.set(0,0,1),w.lookAt(0,1,0),M.up.set(0,0,-1),M.lookAt(0,-1,0),N.up.set(0,-1,0),N.lookAt(0,0,1),P.up.set(0,-1,0),P.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+a);for(const k of d)this.add(k),k.updateMatrixWorld()}update(a,d){this.parent===null&&this.updateMatrixWorld();const{renderTarget:A,activeMipmapLevel:x}=this;this.coordinateSystem!==a.coordinateSystem&&(this.coordinateSystem=a.coordinateSystem,this.updateCoordinateSystem());const[w,M,N,P,k,j]=this.children,Y=a.getRenderTarget(),X=a.getActiveCubeFace(),Z=a.getActiveMipmapLevel(),ie=a.xr.enabled;a.xr.enabled=!1;const oe=A.texture.generateMipmaps;A.texture.generateMipmaps=!1,a.setRenderTarget(A,0,x),a.render(d,w),a.setRenderTarget(A,1,x),a.render(d,M),a.setRenderTarget(A,2,x),a.render(d,N),a.setRenderTarget(A,3,x),a.render(d,P),a.setRenderTarget(A,4,x),a.render(d,k),A.texture.generateMipmaps=oe,a.setRenderTarget(A,5,x),a.render(d,j),a.setRenderTarget(Y,X,Z),a.xr.enabled=ie,A.texture.needsPMREMUpdate=!0}}class Cv extends ds{constructor(a,d,A,x,w,M,N,P,k,j){a=a!==void 0?a:[],d=d!==void 0?d:U,super(a,d,A,x,w,M,N,P,k,j),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(a){this.image=a}}class yG extends rl{constructor(a=1,d={}){super(a,a,d),this.isWebGLCubeRenderTarget=!0;const A={width:a,height:a,depth:1},x=[A,A,A,A,A,A];this.texture=new Cv(x,d.mapping,d.wrapS,d.wrapT,d.magFilter,d.minFilter,d.format,d.type,d.anisotropy,d.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=d.generateMipmaps!==void 0?d.generateMipmaps:!1,this.texture.minFilter=d.minFilter!==void 0?d.minFilter:Fi}fromEquirectangularTexture(a,d){this.texture.type=d.type,this.texture.colorSpace=d.colorSpace,this.texture.generateMipmaps=d.generateMipmaps,this.texture.minFilter=d.minFilter,this.texture.magFilter=d.magFilter;const A={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},x=new xf(5,5,5),w=new Oc({name:"CubemapFromEquirect",uniforms:b0(A.uniforms),vertexShader:A.vertexShader,fragmentShader:A.fragmentShader,side:R,blending:I});w.uniforms.tEquirect.value=d;const M=new ua(x,w),N=d.minFilter;return d.minFilter===nn&&(d.minFilter=Fi),new AG(1,10,this).update(a,M),d.minFilter=N,M.geometry.dispose(),M.material.dispose(),this}clear(a,d,A,x){const w=a.getRenderTarget();for(let M=0;M<6;M++)a.setRenderTarget(this,M),a.clear(d,A,x);a.setRenderTarget(w)}}const xN=new He,CSe=new He,SSe=new Xr;class Qd{constructor(a=new He(1,0,0),d=0){this.isPlane=!0,this.normal=a,this.constant=d}set(a,d){return this.normal.copy(a),this.constant=d,this}setComponents(a,d,A,x){return this.normal.set(a,d,A),this.constant=x,this}setFromNormalAndCoplanarPoint(a,d){return this.normal.copy(a),this.constant=-d.dot(this.normal),this}setFromCoplanarPoints(a,d,A){const x=xN.subVectors(A,d).cross(CSe.subVectors(a,d)).normalize();return this.setFromNormalAndCoplanarPoint(x,a),this}copy(a){return this.normal.copy(a.normal),this.constant=a.constant,this}normalize(){const a=1/this.normal.length();return this.normal.multiplyScalar(a),this.constant*=a,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(a){return this.normal.dot(a)+this.constant}distanceToSphere(a){return this.distanceToPoint(a.center)-a.radius}projectPoint(a,d){return d.copy(a).addScaledVector(this.normal,-this.distanceToPoint(a))}intersectLine(a,d){const A=a.delta(xN),x=this.normal.dot(A);if(x===0)return this.distanceToPoint(a.start)===0?d.copy(a.start):null;const w=-(a.start.dot(this.normal)+this.constant)/x;return w<0||w>1?null:d.copy(a.start).addScaledVector(A,w)}intersectsLine(a){const d=this.distanceToPoint(a.start),A=this.distanceToPoint(a.end);return d<0&&A>0||A<0&&d>0}intersectsBox(a){return a.intersectsPlane(this)}intersectsSphere(a){return a.intersectsPlane(this)}coplanarPoint(a){return a.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(a,d){const A=d||SSe.getNormalMatrix(a),x=this.coplanarPoint(xN).applyMatrix4(a),w=this.normal.applyMatrix3(A).normalize();return this.constant=-x.dot(w),this}translate(a){return this.constant-=a.dot(this.normal),this}equals(a){return a.normal.equals(this.normal)&&a.constant===this.constant}clone(){return new this.constructor().copy(this)}}const _f=new Aa,ow=new He;class Sv{constructor(a=new Qd,d=new Qd,A=new Qd,x=new Qd,w=new Qd,M=new Qd){this.planes=[a,d,A,x,w,M]}set(a,d,A,x,w,M){const N=this.planes;return N[0].copy(a),N[1].copy(d),N[2].copy(A),N[3].copy(x),N[4].copy(w),N[5].copy(M),this}copy(a){const d=this.planes;for(let A=0;A<6;A++)d[A].copy(a.planes[A]);return this}setFromProjectionMatrix(a,d=Wl){const A=this.planes,x=a.elements,w=x[0],M=x[1],N=x[2],P=x[3],k=x[4],j=x[5],Y=x[6],X=x[7],Z=x[8],ie=x[9],oe=x[10],ne=x[11],ee=x[12],Me=x[13],we=x[14],xe=x[15];if(A[0].setComponents(P-w,X-k,ne-Z,xe-ee).normalize(),A[1].setComponents(P+w,X+k,ne+Z,xe+ee).normalize(),A[2].setComponents(P+M,X+j,ne+ie,xe+Me).normalize(),A[3].setComponents(P-M,X-j,ne-ie,xe-Me).normalize(),A[4].setComponents(P-N,X-Y,ne-oe,xe-we).normalize(),d===Wl)A[5].setComponents(P+N,X+Y,ne+oe,xe+we).normalize();else if(d===Af)A[5].setComponents(N,Y,oe,we).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+d);return this}intersectsObject(a){if(a.boundingSphere!==void 0)a.boundingSphere===null&&a.computeBoundingSphere(),_f.copy(a.boundingSphere).applyMatrix4(a.matrixWorld);else{const d=a.geometry;d.boundingSphere===null&&d.computeBoundingSphere(),_f.copy(d.boundingSphere).applyMatrix4(a.matrixWorld)}return this.intersectsSphere(_f)}intersectsSprite(a){return _f.center.set(0,0,0),_f.radius=.7071067811865476,_f.applyMatrix4(a.matrixWorld),this.intersectsSphere(_f)}intersectsSphere(a){const d=this.planes,A=a.center,x=-a.radius;for(let w=0;w<6;w++)if(d[w].distanceToPoint(A)<x)return!1;return!0}intersectsBox(a){const d=this.planes;for(let A=0;A<6;A++){const x=d[A];if(ow.x=x.normal.x>0?a.max.x:a.min.x,ow.y=x.normal.y>0?a.max.y:a.min.y,ow.z=x.normal.z>0?a.max.z:a.min.z,x.distanceToPoint(ow)<0)return!1}return!0}containsPoint(a){const d=this.planes;for(let A=0;A<6;A++)if(d[A].distanceToPoint(a)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function _N(){let S=null,a=!1,d=null,A=null;function x(w,M){d(w,M),A=S.requestAnimationFrame(x)}return{start:function(){a!==!0&&d!==null&&(A=S.requestAnimationFrame(x),a=!0)},stop:function(){S.cancelAnimationFrame(A),a=!1},setAnimationLoop:function(w){d=w},setContext:function(w){S=w}}}function TSe(S){const a=new WeakMap;function d(N,P){const k=N.array,j=N.usage,Y=k.byteLength,X=S.createBuffer();S.bindBuffer(P,X),S.bufferData(P,k,j),N.onUploadCallback();let Z;if(k instanceof Float32Array)Z=S.FLOAT;else if(k instanceof Uint16Array)N.isFloat16BufferAttribute?Z=S.HALF_FLOAT:Z=S.UNSIGNED_SHORT;else if(k instanceof Int16Array)Z=S.SHORT;else if(k instanceof Uint32Array)Z=S.UNSIGNED_INT;else if(k instanceof Int32Array)Z=S.INT;else if(k instanceof Int8Array)Z=S.BYTE;else if(k instanceof Uint8Array)Z=S.UNSIGNED_BYTE;else if(k instanceof Uint8ClampedArray)Z=S.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+k);return{buffer:X,type:Z,bytesPerElement:k.BYTES_PER_ELEMENT,version:N.version,size:Y}}function A(N,P,k){const j=P.array,Y=P._updateRange,X=P.updateRanges;if(S.bindBuffer(k,N),Y.count===-1&&X.length===0&&S.bufferSubData(k,0,j),X.length!==0){for(let Z=0,ie=X.length;Z<ie;Z++){const oe=X[Z];S.bufferSubData(k,oe.start*j.BYTES_PER_ELEMENT,j,oe.start,oe.count)}P.clearUpdateRanges()}Y.count!==-1&&(S.bufferSubData(k,Y.offset*j.BYTES_PER_ELEMENT,j,Y.offset,Y.count),Y.count=-1),P.onUploadCallback()}function x(N){return N.isInterleavedBufferAttribute&&(N=N.data),a.get(N)}function w(N){N.isInterleavedBufferAttribute&&(N=N.data);const P=a.get(N);P&&(S.deleteBuffer(P.buffer),a.delete(N))}function M(N,P){if(N.isGLBufferAttribute){const j=a.get(N);(!j||j.version<N.version)&&a.set(N,{buffer:N.buffer,type:N.type,bytesPerElement:N.elementSize,version:N.version});return}N.isInterleavedBufferAttribute&&(N=N.data);const k=a.get(N);if(k===void 0)a.set(N,d(N,P));else if(k.version<N.version){if(k.size!==N.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");A(k.buffer,N,P),k.version=N.version}}return{get:x,remove:w,update:M}}class E0 extends pn{constructor(a=1,d=1,A=1,x=1){super(),this.type="PlaneGeometry",this.parameters={width:a,height:d,widthSegments:A,heightSegments:x};const w=a/2,M=d/2,N=Math.floor(A),P=Math.floor(x),k=N+1,j=P+1,Y=a/N,X=d/P,Z=[],ie=[],oe=[],ne=[];for(let ee=0;ee<j;ee++){const Me=ee*X-M;for(let we=0;we<k;we++){const xe=we*Y-w;ie.push(xe,-Me,0),oe.push(0,0,1),ne.push(we/N),ne.push(1-ee/P)}}for(let ee=0;ee<P;ee++)for(let Me=0;Me<N;Me++){const we=Me+k*ee,xe=Me+k*(ee+1),st=Me+1+k*(ee+1),Qe=Me+1+k*ee;Z.push(we,xe,Qe),Z.push(xe,st,Qe)}this.setIndex(Z),this.setAttribute("position",new br(ie,3)),this.setAttribute("normal",new br(oe,3)),this.setAttribute("uv",new br(ne,2))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new E0(a.width,a.height,a.widthSegments,a.heightSegments)}}var MSe=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,RSe=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,ISe=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,BSe=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,NSe=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,LSe=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,DSe=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,OSe=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,PSe=`#ifdef USE_BATCHING
	attribute float batchId;
	uniform highp sampler2D batchingTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,kSe=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( batchId );
#endif`,FSe=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,USe=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,zSe=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,jSe=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,GSe=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,VSe=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,HSe=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,WSe=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,QSe=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,qSe=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,XSe=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,KSe=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,YSe=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,JSe=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,ZSe=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,$Se=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,eTe=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,tTe=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,iTe=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,rTe=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,nTe="gl_FragColor = linearToOutputTexel( gl_FragColor );",sTe=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return sRGBTransferOETF( value );
}`,aTe=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,oTe=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,lTe=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,cTe=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,uTe=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,hTe=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,dTe=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,pTe=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fTe=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,mTe=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,gTe=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,ATe=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,yTe=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,vTe=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,bTe=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,xTe=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,_Te=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,ETe=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,wTe=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,CTe=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,STe=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,TTe=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,MTe=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,RTe=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,ITe=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,BTe=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,NTe=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,LTe=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,DTe=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,OTe=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,PTe=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,kTe=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,FTe=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,UTe=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,zTe=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[MORPHTARGETS_COUNT];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,jTe=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,GTe=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,VTe=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
	#endif
	#ifdef MORPHTARGETS_TEXTURE
		#ifndef USE_INSTANCING_MORPH
			uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		#endif
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,HTe=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,WTe=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,QTe=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,qTe=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,XTe=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,KTe=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,YTe=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,JTe=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,ZTe=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,$Te=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,eMe=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,tMe=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,iMe=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,rMe=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,nMe=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,sMe=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,aMe=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,oMe=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,lMe=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,cMe=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return shadow;
	}
#endif`,uMe=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,hMe=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,dMe=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,pMe=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,fMe=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,mMe=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,gMe=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,AMe=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,yMe=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,vMe=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,bMe=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,xMe=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,_Me=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
		
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
		
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		
		#else
		
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,EMe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,wMe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,CMe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,SMe=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const on={alphahash_fragment:MSe,alphahash_pars_fragment:RSe,alphamap_fragment:ISe,alphamap_pars_fragment:BSe,alphatest_fragment:NSe,alphatest_pars_fragment:LSe,aomap_fragment:DSe,aomap_pars_fragment:OSe,batching_pars_vertex:PSe,batching_vertex:kSe,begin_vertex:FSe,beginnormal_vertex:USe,bsdfs:zSe,iridescence_fragment:jSe,bumpmap_pars_fragment:GSe,clipping_planes_fragment:VSe,clipping_planes_pars_fragment:HSe,clipping_planes_pars_vertex:WSe,clipping_planes_vertex:QSe,color_fragment:qSe,color_pars_fragment:XSe,color_pars_vertex:KSe,color_vertex:YSe,common:JSe,cube_uv_reflection_fragment:ZSe,defaultnormal_vertex:$Se,displacementmap_pars_vertex:eTe,displacementmap_vertex:tTe,emissivemap_fragment:iTe,emissivemap_pars_fragment:rTe,colorspace_fragment:nTe,colorspace_pars_fragment:sTe,envmap_fragment:aTe,envmap_common_pars_fragment:oTe,envmap_pars_fragment:lTe,envmap_pars_vertex:cTe,envmap_physical_pars_fragment:bTe,envmap_vertex:uTe,fog_vertex:hTe,fog_pars_vertex:dTe,fog_fragment:pTe,fog_pars_fragment:fTe,gradientmap_pars_fragment:mTe,lightmap_pars_fragment:gTe,lights_lambert_fragment:ATe,lights_lambert_pars_fragment:yTe,lights_pars_begin:vTe,lights_toon_fragment:xTe,lights_toon_pars_fragment:_Te,lights_phong_fragment:ETe,lights_phong_pars_fragment:wTe,lights_physical_fragment:CTe,lights_physical_pars_fragment:STe,lights_fragment_begin:TTe,lights_fragment_maps:MTe,lights_fragment_end:RTe,logdepthbuf_fragment:ITe,logdepthbuf_pars_fragment:BTe,logdepthbuf_pars_vertex:NTe,logdepthbuf_vertex:LTe,map_fragment:DTe,map_pars_fragment:OTe,map_particle_fragment:PTe,map_particle_pars_fragment:kTe,metalnessmap_fragment:FTe,metalnessmap_pars_fragment:UTe,morphinstance_vertex:zTe,morphcolor_vertex:jTe,morphnormal_vertex:GTe,morphtarget_pars_vertex:VTe,morphtarget_vertex:HTe,normal_fragment_begin:WTe,normal_fragment_maps:QTe,normal_pars_fragment:qTe,normal_pars_vertex:XTe,normal_vertex:KTe,normalmap_pars_fragment:YTe,clearcoat_normal_fragment_begin:JTe,clearcoat_normal_fragment_maps:ZTe,clearcoat_pars_fragment:$Te,iridescence_pars_fragment:eMe,opaque_fragment:tMe,packing:iMe,premultiplied_alpha_fragment:rMe,project_vertex:nMe,dithering_fragment:sMe,dithering_pars_fragment:aMe,roughnessmap_fragment:oMe,roughnessmap_pars_fragment:lMe,shadowmap_pars_fragment:cMe,shadowmap_pars_vertex:uMe,shadowmap_vertex:hMe,shadowmask_pars_fragment:dMe,skinbase_vertex:pMe,skinning_pars_vertex:fMe,skinning_vertex:mMe,skinnormal_vertex:gMe,specularmap_fragment:AMe,specularmap_pars_fragment:yMe,tonemapping_fragment:vMe,tonemapping_pars_fragment:bMe,transmission_fragment:xMe,transmission_pars_fragment:_Me,uv_pars_fragment:EMe,uv_pars_vertex:wMe,uv_vertex:CMe,worldpos_vertex:SMe,background_vert:`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,background_frag:`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,backgroundCube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,backgroundCube_frag:`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,cube_frag:`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,depth_vert:`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,meshbasic_vert:`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshnormal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,meshnormal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,shadow_vert:`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`},qi={common:{diffuse:{value:new lr(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Xr},alphaMap:{value:null},alphaMapTransform:{value:new Xr},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Xr}},envmap:{envMap:{value:null},envMapRotation:{value:new Xr},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Xr}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Xr}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Xr},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Xr},normalScale:{value:new oi(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Xr},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Xr}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Xr}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Xr}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new lr(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new lr(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Xr},alphaTest:{value:0},uvTransform:{value:new Xr}},sprite:{diffuse:{value:new lr(16777215)},opacity:{value:1},center:{value:new oi(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Xr},alphaMap:{value:null},alphaMapTransform:{value:new Xr},alphaTest:{value:0}}},Pc={basic:{uniforms:Do([qi.common,qi.specularmap,qi.envmap,qi.aomap,qi.lightmap,qi.fog]),vertexShader:on.meshbasic_vert,fragmentShader:on.meshbasic_frag},lambert:{uniforms:Do([qi.common,qi.specularmap,qi.envmap,qi.aomap,qi.lightmap,qi.emissivemap,qi.bumpmap,qi.normalmap,qi.displacementmap,qi.fog,qi.lights,{emissive:{value:new lr(0)}}]),vertexShader:on.meshlambert_vert,fragmentShader:on.meshlambert_frag},phong:{uniforms:Do([qi.common,qi.specularmap,qi.envmap,qi.aomap,qi.lightmap,qi.emissivemap,qi.bumpmap,qi.normalmap,qi.displacementmap,qi.fog,qi.lights,{emissive:{value:new lr(0)},specular:{value:new lr(1118481)},shininess:{value:30}}]),vertexShader:on.meshphong_vert,fragmentShader:on.meshphong_frag},standard:{uniforms:Do([qi.common,qi.envmap,qi.aomap,qi.lightmap,qi.emissivemap,qi.bumpmap,qi.normalmap,qi.displacementmap,qi.roughnessmap,qi.metalnessmap,qi.fog,qi.lights,{emissive:{value:new lr(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:on.meshphysical_vert,fragmentShader:on.meshphysical_frag},toon:{uniforms:Do([qi.common,qi.aomap,qi.lightmap,qi.emissivemap,qi.bumpmap,qi.normalmap,qi.displacementmap,qi.gradientmap,qi.fog,qi.lights,{emissive:{value:new lr(0)}}]),vertexShader:on.meshtoon_vert,fragmentShader:on.meshtoon_frag},matcap:{uniforms:Do([qi.common,qi.bumpmap,qi.normalmap,qi.displacementmap,qi.fog,{matcap:{value:null}}]),vertexShader:on.meshmatcap_vert,fragmentShader:on.meshmatcap_frag},points:{uniforms:Do([qi.points,qi.fog]),vertexShader:on.points_vert,fragmentShader:on.points_frag},dashed:{uniforms:Do([qi.common,qi.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:on.linedashed_vert,fragmentShader:on.linedashed_frag},depth:{uniforms:Do([qi.common,qi.displacementmap]),vertexShader:on.depth_vert,fragmentShader:on.depth_frag},normal:{uniforms:Do([qi.common,qi.bumpmap,qi.normalmap,qi.displacementmap,{opacity:{value:1}}]),vertexShader:on.meshnormal_vert,fragmentShader:on.meshnormal_frag},sprite:{uniforms:Do([qi.sprite,qi.fog]),vertexShader:on.sprite_vert,fragmentShader:on.sprite_frag},background:{uniforms:{uvTransform:{value:new Xr},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:on.background_vert,fragmentShader:on.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Xr}},vertexShader:on.backgroundCube_vert,fragmentShader:on.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:on.cube_vert,fragmentShader:on.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:on.equirect_vert,fragmentShader:on.equirect_frag},distanceRGBA:{uniforms:Do([qi.common,qi.displacementmap,{referencePosition:{value:new He},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:on.distanceRGBA_vert,fragmentShader:on.distanceRGBA_frag},shadow:{uniforms:Do([qi.lights,qi.fog,{color:{value:new lr(0)},opacity:{value:1}}]),vertexShader:on.shadow_vert,fragmentShader:on.shadow_frag}};Pc.physical={uniforms:Do([Pc.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Xr},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Xr},clearcoatNormalScale:{value:new oi(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Xr},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Xr},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Xr},sheen:{value:0},sheenColor:{value:new lr(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Xr},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Xr},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Xr},transmissionSamplerSize:{value:new oi},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Xr},attenuationDistance:{value:0},attenuationColor:{value:new lr(0)},specularColor:{value:new lr(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Xr},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Xr},anisotropyVector:{value:new oi},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Xr}}]),vertexShader:on.meshphysical_vert,fragmentShader:on.meshphysical_frag};const lw={r:0,b:0,g:0},Ef=new Rl,TMe=new mr;function MMe(S,a,d,A,x,w,M){const N=new lr(0);let P=w===!0?0:1,k,j,Y=null,X=0,Z=null;function ie(Me){let we=Me.isScene===!0?Me.background:null;return we&&we.isTexture&&(we=(Me.backgroundBlurriness>0?d:a).get(we)),we}function oe(Me){let we=!1;const xe=ie(Me);xe===null?ee(N,P):xe&&xe.isColor&&(ee(xe,1),we=!0);const st=S.xr.getEnvironmentBlendMode();st==="additive"?A.buffers.color.setClear(0,0,0,1,M):st==="alpha-blend"&&A.buffers.color.setClear(0,0,0,0,M),(S.autoClear||we)&&S.clear(S.autoClearColor,S.autoClearDepth,S.autoClearStencil)}function ne(Me,we){const xe=ie(we);xe&&(xe.isCubeTexture||xe.mapping===ce)?(j===void 0&&(j=new ua(new xf(1e4,1e4,1e4),new Oc({name:"BackgroundCubeMaterial",uniforms:b0(Pc.backgroundCube.uniforms),vertexShader:Pc.backgroundCube.vertexShader,fragmentShader:Pc.backgroundCube.fragmentShader,side:R,depthTest:!1,depthWrite:!1,fog:!1})),j.geometry.deleteAttribute("normal"),j.geometry.deleteAttribute("uv"),j.onBeforeRender=function(st,Qe,Ze){this.matrixWorld.copyPosition(Ze.matrixWorld)},Object.defineProperty(j.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),x.update(j)),Ef.copy(we.backgroundRotation),Ef.x*=-1,Ef.y*=-1,Ef.z*=-1,xe.isCubeTexture&&xe.isRenderTargetTexture===!1&&(Ef.y*=-1,Ef.z*=-1),j.material.uniforms.envMap.value=xe,j.material.uniforms.flipEnvMap.value=xe.isCubeTexture&&xe.isRenderTargetTexture===!1?-1:1,j.material.uniforms.backgroundBlurriness.value=we.backgroundBlurriness,j.material.uniforms.backgroundIntensity.value=we.backgroundIntensity,j.material.uniforms.backgroundRotation.value.setFromMatrix4(TMe.makeRotationFromEuler(Ef)),j.material.toneMapped=Yn.getTransfer(xe.colorSpace)!==cs,(Y!==xe||X!==xe.version||Z!==S.toneMapping)&&(j.material.needsUpdate=!0,Y=xe,X=xe.version,Z=S.toneMapping),j.layers.enableAll(),Me.unshift(j,j.geometry,j.material,0,0,null)):xe&&xe.isTexture&&(k===void 0&&(k=new ua(new E0(2,2),new Oc({name:"BackgroundMaterial",uniforms:b0(Pc.background.uniforms),vertexShader:Pc.background.vertexShader,fragmentShader:Pc.background.fragmentShader,side:T,depthTest:!1,depthWrite:!1,fog:!1})),k.geometry.deleteAttribute("normal"),Object.defineProperty(k.material,"map",{get:function(){return this.uniforms.t2D.value}}),x.update(k)),k.material.uniforms.t2D.value=xe,k.material.uniforms.backgroundIntensity.value=we.backgroundIntensity,k.material.toneMapped=Yn.getTransfer(xe.colorSpace)!==cs,xe.matrixAutoUpdate===!0&&xe.updateMatrix(),k.material.uniforms.uvTransform.value.copy(xe.matrix),(Y!==xe||X!==xe.version||Z!==S.toneMapping)&&(k.material.needsUpdate=!0,Y=xe,X=xe.version,Z=S.toneMapping),k.layers.enableAll(),Me.unshift(k,k.geometry,k.material,0,0,null))}function ee(Me,we){Me.getRGB(lw,pG(S)),A.buffers.color.setClear(lw.r,lw.g,lw.b,we,M)}return{getClearColor:function(){return N},setClearColor:function(Me,we=1){N.set(Me),P=we,ee(N,P)},getClearAlpha:function(){return P},setClearAlpha:function(Me){P=Me,ee(N,P)},render:oe,addToRenderList:ne}}function RMe(S,a){const d=S.getParameter(S.MAX_VERTEX_ATTRIBS),A={},x=X(null);let w=x,M=!1;function N(De,nt,gt,ft,Rt){let Ut=!1;const fi=Y(ft,gt,nt);w!==fi&&(w=fi,k(w.object)),Ut=Z(De,ft,gt,Rt),Ut&&ie(De,ft,gt,Rt),Rt!==null&&a.update(Rt,S.ELEMENT_ARRAY_BUFFER),(Ut||M)&&(M=!1,xe(De,nt,gt,ft),Rt!==null&&S.bindBuffer(S.ELEMENT_ARRAY_BUFFER,a.get(Rt).buffer))}function P(){return S.createVertexArray()}function k(De){return S.bindVertexArray(De)}function j(De){return S.deleteVertexArray(De)}function Y(De,nt,gt){const ft=gt.wireframe===!0;let Rt=A[De.id];Rt===void 0&&(Rt={},A[De.id]=Rt);let Ut=Rt[nt.id];Ut===void 0&&(Ut={},Rt[nt.id]=Ut);let fi=Ut[ft];return fi===void 0&&(fi=X(P()),Ut[ft]=fi),fi}function X(De){const nt=[],gt=[],ft=[];for(let Rt=0;Rt<d;Rt++)nt[Rt]=0,gt[Rt]=0,ft[Rt]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:nt,enabledAttributes:gt,attributeDivisors:ft,object:De,attributes:{},index:null}}function Z(De,nt,gt,ft){const Rt=w.attributes,Ut=nt.attributes;let fi=0;const Oi=gt.getAttributes();for(const zt in Oi)if(Oi[zt].location>=0){const bi=Rt[zt];let Pi=Ut[zt];if(Pi===void 0&&(zt==="instanceMatrix"&&De.instanceMatrix&&(Pi=De.instanceMatrix),zt==="instanceColor"&&De.instanceColor&&(Pi=De.instanceColor)),bi===void 0||bi.attribute!==Pi||Pi&&bi.data!==Pi.data)return!0;fi++}return w.attributesNum!==fi||w.index!==ft}function ie(De,nt,gt,ft){const Rt={},Ut=nt.attributes;let fi=0;const Oi=gt.getAttributes();for(const zt in Oi)if(Oi[zt].location>=0){let bi=Ut[zt];bi===void 0&&(zt==="instanceMatrix"&&De.instanceMatrix&&(bi=De.instanceMatrix),zt==="instanceColor"&&De.instanceColor&&(bi=De.instanceColor));const Pi={};Pi.attribute=bi,bi&&bi.data&&(Pi.data=bi.data),Rt[zt]=Pi,fi++}w.attributes=Rt,w.attributesNum=fi,w.index=ft}function oe(){const De=w.newAttributes;for(let nt=0,gt=De.length;nt<gt;nt++)De[nt]=0}function ne(De){ee(De,0)}function ee(De,nt){const gt=w.newAttributes,ft=w.enabledAttributes,Rt=w.attributeDivisors;gt[De]=1,ft[De]===0&&(S.enableVertexAttribArray(De),ft[De]=1),Rt[De]!==nt&&(S.vertexAttribDivisor(De,nt),Rt[De]=nt)}function Me(){const De=w.newAttributes,nt=w.enabledAttributes;for(let gt=0,ft=nt.length;gt<ft;gt++)nt[gt]!==De[gt]&&(S.disableVertexAttribArray(gt),nt[gt]=0)}function we(De,nt,gt,ft,Rt,Ut,fi){fi===!0?S.vertexAttribIPointer(De,nt,gt,Rt,Ut):S.vertexAttribPointer(De,nt,gt,ft,Rt,Ut)}function xe(De,nt,gt,ft){oe();const Rt=ft.attributes,Ut=gt.getAttributes(),fi=nt.defaultAttributeValues;for(const Oi in Ut){const zt=Ut[Oi];if(zt.location>=0){let bi=Rt[Oi];if(bi===void 0&&(Oi==="instanceMatrix"&&De.instanceMatrix&&(bi=De.instanceMatrix),Oi==="instanceColor"&&De.instanceColor&&(bi=De.instanceColor)),bi!==void 0){const Pi=bi.normalized,Ur=bi.itemSize,_n=a.get(bi);if(_n===void 0)continue;const is=_n.buffer,ps=_n.type,jn=_n.bytesPerElement,Nn=ps===S.INT||ps===S.UNSIGNED_INT||bi.gpuType===pe;if(bi.isInterleavedBufferAttribute){const Cr=bi.data,di=Cr.stride,Ci=bi.offset;if(Cr.isInstancedInterleavedBuffer){for(let Xi=0;Xi<zt.locationSize;Xi++)ee(zt.location+Xi,Cr.meshPerAttribute);De.isInstancedMesh!==!0&&ft._maxInstanceCount===void 0&&(ft._maxInstanceCount=Cr.meshPerAttribute*Cr.count)}else for(let Xi=0;Xi<zt.locationSize;Xi++)ne(zt.location+Xi);S.bindBuffer(S.ARRAY_BUFFER,is);for(let Xi=0;Xi<zt.locationSize;Xi++)we(zt.location+Xi,Ur/zt.locationSize,ps,Pi,di*jn,(Ci+Ur/zt.locationSize*Xi)*jn,Nn)}else{if(bi.isInstancedBufferAttribute){for(let Cr=0;Cr<zt.locationSize;Cr++)ee(zt.location+Cr,bi.meshPerAttribute);De.isInstancedMesh!==!0&&ft._maxInstanceCount===void 0&&(ft._maxInstanceCount=bi.meshPerAttribute*bi.count)}else for(let Cr=0;Cr<zt.locationSize;Cr++)ne(zt.location+Cr);S.bindBuffer(S.ARRAY_BUFFER,is);for(let Cr=0;Cr<zt.locationSize;Cr++)we(zt.location+Cr,Ur/zt.locationSize,ps,Pi,Ur*jn,Ur/zt.locationSize*Cr*jn,Nn)}}else if(fi!==void 0){const Pi=fi[Oi];if(Pi!==void 0)switch(Pi.length){case 2:S.vertexAttrib2fv(zt.location,Pi);break;case 3:S.vertexAttrib3fv(zt.location,Pi);break;case 4:S.vertexAttrib4fv(zt.location,Pi);break;default:S.vertexAttrib1fv(zt.location,Pi)}}}}Me()}function st(){rt();for(const De in A){const nt=A[De];for(const gt in nt){const ft=nt[gt];for(const Rt in ft)j(ft[Rt].object),delete ft[Rt];delete nt[gt]}delete A[De]}}function Qe(De){if(A[De.id]===void 0)return;const nt=A[De.id];for(const gt in nt){const ft=nt[gt];for(const Rt in ft)j(ft[Rt].object),delete ft[Rt];delete nt[gt]}delete A[De.id]}function Ze(De){for(const nt in A){const gt=A[nt];if(gt[De.id]===void 0)continue;const ft=gt[De.id];for(const Rt in ft)j(ft[Rt].object),delete ft[Rt];delete gt[De.id]}}function rt(){ze(),M=!0,w!==x&&(w=x,k(w.object))}function ze(){x.geometry=null,x.program=null,x.wireframe=!1}return{setup:N,reset:rt,resetDefaultState:ze,dispose:st,releaseStatesOfGeometry:Qe,releaseStatesOfProgram:Ze,initAttributes:oe,enableAttribute:ne,disableUnusedAttributes:Me}}function IMe(S,a,d){let A;function x(k){A=k}function w(k,j){S.drawArrays(A,k,j),d.update(j,A,1)}function M(k,j,Y){Y!==0&&(S.drawArraysInstanced(A,k,j,Y),d.update(j,A,Y))}function N(k,j,Y){if(Y===0)return;const X=a.get("WEBGL_multi_draw");if(X===null)for(let Z=0;Z<Y;Z++)this.render(k[Z],j[Z]);else{X.multiDrawArraysWEBGL(A,k,0,j,0,Y);let Z=0;for(let ie=0;ie<Y;ie++)Z+=j[ie];d.update(Z,A,1)}}function P(k,j,Y,X){if(Y===0)return;const Z=a.get("WEBGL_multi_draw");if(Z===null)for(let ie=0;ie<k.length;ie++)M(k[ie],j[ie],X[ie]);else{Z.multiDrawArraysInstancedWEBGL(A,k,0,j,0,X,0,Y);let ie=0;for(let oe=0;oe<Y;oe++)ie+=j[oe];for(let oe=0;oe<X.length;oe++)d.update(ie,A,X[oe])}}this.setMode=x,this.render=w,this.renderInstances=M,this.renderMultiDraw=N,this.renderMultiDrawInstances=P}function BMe(S,a,d,A){let x;function w(){if(x!==void 0)return x;if(a.has("EXT_texture_filter_anisotropic")===!0){const Qe=a.get("EXT_texture_filter_anisotropic");x=S.getParameter(Qe.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else x=0;return x}function M(Qe){return!(Qe!==fe&&A.convert(Qe)!==S.getParameter(S.IMPLEMENTATION_COLOR_READ_FORMAT))}function N(Qe){const Ze=Qe===Jt&&(a.has("EXT_color_buffer_half_float")||a.has("EXT_color_buffer_float"));return!(Qe!==An&&A.convert(Qe)!==S.getParameter(S.IMPLEMENTATION_COLOR_READ_TYPE)&&Qe!==Tt&&!Ze)}function P(Qe){if(Qe==="highp"){if(S.getShaderPrecisionFormat(S.VERTEX_SHADER,S.HIGH_FLOAT).precision>0&&S.getShaderPrecisionFormat(S.FRAGMENT_SHADER,S.HIGH_FLOAT).precision>0)return"highp";Qe="mediump"}return Qe==="mediump"&&S.getShaderPrecisionFormat(S.VERTEX_SHADER,S.MEDIUM_FLOAT).precision>0&&S.getShaderPrecisionFormat(S.FRAGMENT_SHADER,S.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let k=d.precision!==void 0?d.precision:"highp";const j=P(k);j!==k&&(console.warn("THREE.WebGLRenderer:",k,"not supported, using",j,"instead."),k=j);const Y=d.logarithmicDepthBuffer===!0,X=S.getParameter(S.MAX_TEXTURE_IMAGE_UNITS),Z=S.getParameter(S.MAX_VERTEX_TEXTURE_IMAGE_UNITS),ie=S.getParameter(S.MAX_TEXTURE_SIZE),oe=S.getParameter(S.MAX_CUBE_MAP_TEXTURE_SIZE),ne=S.getParameter(S.MAX_VERTEX_ATTRIBS),ee=S.getParameter(S.MAX_VERTEX_UNIFORM_VECTORS),Me=S.getParameter(S.MAX_VARYING_VECTORS),we=S.getParameter(S.MAX_FRAGMENT_UNIFORM_VECTORS),xe=Z>0,st=S.getParameter(S.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:w,getMaxPrecision:P,textureFormatReadable:M,textureTypeReadable:N,precision:k,logarithmicDepthBuffer:Y,maxTextures:X,maxVertexTextures:Z,maxTextureSize:ie,maxCubemapSize:oe,maxAttributes:ne,maxVertexUniforms:ee,maxVaryings:Me,maxFragmentUniforms:we,vertexTextures:xe,maxSamples:st}}function NMe(S){const a=this;let d=null,A=0,x=!1,w=!1;const M=new Qd,N=new Xr,P={value:null,needsUpdate:!1};this.uniform=P,this.numPlanes=0,this.numIntersection=0,this.init=function(Y,X){const Z=Y.length!==0||X||A!==0||x;return x=X,A=Y.length,Z},this.beginShadows=function(){w=!0,j(null)},this.endShadows=function(){w=!1},this.setGlobalState=function(Y,X){d=j(Y,X,0)},this.setState=function(Y,X,Z){const ie=Y.clippingPlanes,oe=Y.clipIntersection,ne=Y.clipShadows,ee=S.get(Y);if(!x||ie===null||ie.length===0||w&&!ne)w?j(null):k();else{const Me=w?0:A,we=Me*4;let xe=ee.clippingState||null;P.value=xe,xe=j(ie,X,we,Z);for(let st=0;st!==we;++st)xe[st]=d[st];ee.clippingState=xe,this.numIntersection=oe?this.numPlanes:0,this.numPlanes+=Me}};function k(){P.value!==d&&(P.value=d,P.needsUpdate=A>0),a.numPlanes=A,a.numIntersection=0}function j(Y,X,Z,ie){const oe=Y!==null?Y.length:0;let ne=null;if(oe!==0){if(ne=P.value,ie!==!0||ne===null){const ee=Z+oe*4,Me=X.matrixWorldInverse;N.getNormalMatrix(Me),(ne===null||ne.length<ee)&&(ne=new Float32Array(ee));for(let we=0,xe=Z;we!==oe;++we,xe+=4)M.copy(Y[we]).applyMatrix4(Me,N),M.normal.toArray(ne,xe),ne[xe+3]=M.constant}P.value=ne,P.needsUpdate=!0}return a.numPlanes=oe,a.numIntersection=0,ne}}function LMe(S){let a=new WeakMap;function d(M,N){return N===re?M.mapping=U:N===Re&&(M.mapping=$),M}function A(M){if(M&&M.isTexture){const N=M.mapping;if(N===re||N===Re)if(a.has(M)){const P=a.get(M).texture;return d(P,M.mapping)}else{const P=M.image;if(P&&P.height>0){const k=new yG(P.height);return k.fromEquirectangularTexture(S,M),a.set(M,k),M.addEventListener("dispose",x),d(k.texture,M.mapping)}else return null}}return M}function x(M){const N=M.target;N.removeEventListener("dispose",x);const P=a.get(N);P!==void 0&&(a.delete(N),P.dispose())}function w(){a=new WeakMap}return{get:A,dispose:w}}class cw extends aw{constructor(a=-1,d=1,A=1,x=-1,w=.1,M=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=a,this.right=d,this.top=A,this.bottom=x,this.near=w,this.far=M,this.updateProjectionMatrix()}copy(a,d){return super.copy(a,d),this.left=a.left,this.right=a.right,this.top=a.top,this.bottom=a.bottom,this.near=a.near,this.far=a.far,this.zoom=a.zoom,this.view=a.view===null?null:Object.assign({},a.view),this}setViewOffset(a,d,A,x,w,M){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=a,this.view.fullHeight=d,this.view.offsetX=A,this.view.offsetY=x,this.view.width=w,this.view.height=M,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const a=(this.right-this.left)/(2*this.zoom),d=(this.top-this.bottom)/(2*this.zoom),A=(this.right+this.left)/2,x=(this.top+this.bottom)/2;let w=A-a,M=A+a,N=x+d,P=x-d;if(this.view!==null&&this.view.enabled){const k=(this.right-this.left)/this.view.fullWidth/this.zoom,j=(this.top-this.bottom)/this.view.fullHeight/this.zoom;w+=k*this.view.offsetX,M=w+k*this.view.width,N-=j*this.view.offsetY,P=N-j*this.view.height}this.projectionMatrix.makeOrthographic(w,M,N,P,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(a){const d=super.toJSON(a);return d.object.zoom=this.zoom,d.object.left=this.left,d.object.right=this.right,d.object.top=this.top,d.object.bottom=this.bottom,d.object.near=this.near,d.object.far=this.far,this.view!==null&&(d.object.view=Object.assign({},this.view)),d}}const w0=4,vG=[.125,.215,.35,.446,.526,.582],wf=20,EN=new cw,bG=new lr;let wN=null,CN=0,SN=0,TN=!1;const Cf=(1+Math.sqrt(5))/2,C0=1/Cf,xG=[new He(-Cf,C0,0),new He(Cf,C0,0),new He(-C0,0,Cf),new He(C0,0,Cf),new He(0,Cf,-C0),new He(0,Cf,C0),new He(-1,1,-1),new He(1,1,-1),new He(-1,1,1),new He(1,1,1)];class MN{constructor(a){this._renderer=a,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(a,d=0,A=.1,x=100){wN=this._renderer.getRenderTarget(),CN=this._renderer.getActiveCubeFace(),SN=this._renderer.getActiveMipmapLevel(),TN=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const w=this._allocateTargets();return w.depthBuffer=!0,this._sceneToCubeUV(a,A,x,w),d>0&&this._blur(w,0,0,d),this._applyPMREM(w),this._cleanup(w),w}fromEquirectangular(a,d=null){return this._fromTexture(a,d)}fromCubemap(a,d=null){return this._fromTexture(a,d)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=wG(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=EG(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(a){this._lodMax=Math.floor(Math.log2(a)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let a=0;a<this._lodPlanes.length;a++)this._lodPlanes[a].dispose()}_cleanup(a){this._renderer.setRenderTarget(wN,CN,SN),this._renderer.xr.enabled=TN,a.scissorTest=!1,uw(a,0,0,a.width,a.height)}_fromTexture(a,d){a.mapping===U||a.mapping===$?this._setSize(a.image.length===0?16:a.image[0].width||a.image[0].image.width):this._setSize(a.image.width/4),wN=this._renderer.getRenderTarget(),CN=this._renderer.getActiveCubeFace(),SN=this._renderer.getActiveMipmapLevel(),TN=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const A=d||this._allocateTargets();return this._textureToCubeUV(a,A),this._applyPMREM(A),this._cleanup(A),A}_allocateTargets(){const a=3*Math.max(this._cubeSize,112),d=4*this._cubeSize,A={magFilter:Fi,minFilter:Fi,generateMipmaps:!1,type:Jt,format:fe,colorSpace:Lc,depthBuffer:!1},x=_G(a,d,A);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==a||this._pingPongRenderTarget.height!==d){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=_G(a,d,A);const{_lodMax:w}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=DMe(w)),this._blurMaterial=OMe(w,a,d)}return x}_compileMaterial(a){const d=new ua(this._lodPlanes[0],a);this._renderer.compile(d,EN)}_sceneToCubeUV(a,d,A,x){const w=new va(90,1,d,A),M=[1,-1,1,1,1,1],N=[1,1,1,-1,-1,-1],P=this._renderer,k=P.autoClear,j=P.toneMapping;P.getClearColor(bG),P.toneMapping=Pt,P.autoClear=!1;const Y=new Hd({name:"PMREM.Background",side:R,depthWrite:!1,depthTest:!1}),X=new ua(new xf,Y);let Z=!1;const ie=a.background;ie?ie.isColor&&(Y.color.copy(ie),a.background=null,Z=!0):(Y.color.copy(bG),Z=!0);for(let oe=0;oe<6;oe++){const ne=oe%3;ne===0?(w.up.set(0,M[oe],0),w.lookAt(N[oe],0,0)):ne===1?(w.up.set(0,0,M[oe]),w.lookAt(0,N[oe],0)):(w.up.set(0,M[oe],0),w.lookAt(0,0,N[oe]));const ee=this._cubeSize;uw(x,ne*ee,oe>2?ee:0,ee,ee),P.setRenderTarget(x),Z&&P.render(X,w),P.render(a,w)}X.geometry.dispose(),X.material.dispose(),P.toneMapping=j,P.autoClear=k,a.background=ie}_textureToCubeUV(a,d){const A=this._renderer,x=a.mapping===U||a.mapping===$;x?(this._cubemapMaterial===null&&(this._cubemapMaterial=wG()),this._cubemapMaterial.uniforms.flipEnvMap.value=a.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=EG());const w=x?this._cubemapMaterial:this._equirectMaterial,M=new ua(this._lodPlanes[0],w),N=w.uniforms;N.envMap.value=a;const P=this._cubeSize;uw(d,0,0,3*P,2*P),A.setRenderTarget(d),A.render(M,EN)}_applyPMREM(a){const d=this._renderer,A=d.autoClear;d.autoClear=!1;const x=this._lodPlanes.length;for(let w=1;w<x;w++){const M=Math.sqrt(this._sigmas[w]*this._sigmas[w]-this._sigmas[w-1]*this._sigmas[w-1]),N=xG[(x-w-1)%xG.length];this._blur(a,w-1,w,M,N)}d.autoClear=A}_blur(a,d,A,x,w){const M=this._pingPongRenderTarget;this._halfBlur(a,M,d,A,x,"latitudinal",w),this._halfBlur(M,a,A,A,x,"longitudinal",w)}_halfBlur(a,d,A,x,w,M,N){const P=this._renderer,k=this._blurMaterial;M!=="latitudinal"&&M!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const j=3,Y=new ua(this._lodPlanes[x],k),X=k.uniforms,Z=this._sizeLods[A]-1,ie=isFinite(w)?Math.PI/(2*Z):2*Math.PI/(2*wf-1),oe=w/ie,ne=isFinite(w)?1+Math.floor(j*oe):wf;ne>wf&&console.warn(`sigmaRadians, ${w}, is too large and will clip, as it requested ${ne} samples when the maximum is set to ${wf}`);const ee=[];let Me=0;for(let Ze=0;Ze<wf;++Ze){const rt=Ze/oe,ze=Math.exp(-rt*rt/2);ee.push(ze),Ze===0?Me+=ze:Ze<ne&&(Me+=2*ze)}for(let Ze=0;Ze<ee.length;Ze++)ee[Ze]=ee[Ze]/Me;X.envMap.value=a.texture,X.samples.value=ne,X.weights.value=ee,X.latitudinal.value=M==="latitudinal",N&&(X.poleAxis.value=N);const{_lodMax:we}=this;X.dTheta.value=ie,X.mipInt.value=we-A;const xe=this._sizeLods[x],st=3*xe*(x>we-w0?x-we+w0:0),Qe=4*(this._cubeSize-xe);uw(d,st,Qe,3*xe,2*xe),P.setRenderTarget(d),P.render(Y,EN)}}function DMe(S){const a=[],d=[],A=[];let x=S;const w=S-w0+1+vG.length;for(let M=0;M<w;M++){const N=Math.pow(2,x);d.push(N);let P=1/N;M>S-w0?P=vG[M-S+w0-1]:M===0&&(P=0),A.push(P);const k=1/(N-2),j=-k,Y=1+k,X=[j,j,Y,j,Y,Y,j,j,Y,Y,j,Y],Z=6,ie=6,oe=3,ne=2,ee=1,Me=new Float32Array(oe*ie*Z),we=new Float32Array(ne*ie*Z),xe=new Float32Array(ee*ie*Z);for(let Qe=0;Qe<Z;Qe++){const Ze=Qe%3*2/3-1,rt=Qe>2?0:-1,ze=[Ze,rt,0,Ze+2/3,rt,0,Ze+2/3,rt+1,0,Ze,rt,0,Ze+2/3,rt+1,0,Ze,rt+1,0];Me.set(ze,oe*ie*Qe),we.set(X,ne*ie*Qe);const De=[Qe,Qe,Qe,Qe,Qe,Qe];xe.set(De,ee*ie*Qe)}const st=new pn;st.setAttribute("position",new as(Me,oe)),st.setAttribute("uv",new as(we,ne)),st.setAttribute("faceIndex",new as(xe,ee)),a.push(st),x>w0&&x--}return{lodPlanes:a,sizeLods:d,sigmas:A}}function _G(S,a,d){const A=new rl(S,a,d);return A.texture.mapping=ce,A.texture.name="PMREM.cubeUv",A.scissorTest=!0,A}function uw(S,a,d,A,x){S.viewport.set(a,d,A,x),S.scissor.set(a,d,A,x)}function OMe(S,a,d){const A=new Float32Array(wf),x=new He(0,1,0);return new Oc({name:"SphericalGaussianBlur",defines:{n:wf,CUBEUV_TEXEL_WIDTH:1/a,CUBEUV_TEXEL_HEIGHT:1/d,CUBEUV_MAX_MIP:`${S}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:A},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:x}},vertexShader:RN(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:I,depthTest:!1,depthWrite:!1})}function EG(){return new Oc({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:RN(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:I,depthTest:!1,depthWrite:!1})}function wG(){return new Oc({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:RN(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:I,depthTest:!1,depthWrite:!1})}function RN(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function PMe(S){let a=new WeakMap,d=null;function A(N){if(N&&N.isTexture){const P=N.mapping,k=P===re||P===Re,j=P===U||P===$;if(k||j){let Y=a.get(N);const X=Y!==void 0?Y.texture.pmremVersion:0;if(N.isRenderTargetTexture&&N.pmremVersion!==X)return d===null&&(d=new MN(S)),Y=k?d.fromEquirectangular(N,Y):d.fromCubemap(N,Y),Y.texture.pmremVersion=N.pmremVersion,a.set(N,Y),Y.texture;if(Y!==void 0)return Y.texture;{const Z=N.image;return k&&Z&&Z.height>0||j&&Z&&x(Z)?(d===null&&(d=new MN(S)),Y=k?d.fromEquirectangular(N):d.fromCubemap(N),Y.texture.pmremVersion=N.pmremVersion,a.set(N,Y),N.addEventListener("dispose",w),Y.texture):null}}}return N}function x(N){let P=0;const k=6;for(let j=0;j<k;j++)N[j]!==void 0&&P++;return P===k}function w(N){const P=N.target;P.removeEventListener("dispose",w);const k=a.get(P);k!==void 0&&(a.delete(P),k.dispose())}function M(){a=new WeakMap,d!==null&&(d.dispose(),d=null)}return{get:A,dispose:M}}function kMe(S){const a={};function d(A){if(a[A]!==void 0)return a[A];let x;switch(A){case"WEBGL_depth_texture":x=S.getExtension("WEBGL_depth_texture")||S.getExtension("MOZ_WEBGL_depth_texture")||S.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":x=S.getExtension("EXT_texture_filter_anisotropic")||S.getExtension("MOZ_EXT_texture_filter_anisotropic")||S.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":x=S.getExtension("WEBGL_compressed_texture_s3tc")||S.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||S.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":x=S.getExtension("WEBGL_compressed_texture_pvrtc")||S.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:x=S.getExtension(A)}return a[A]=x,x}return{has:function(A){return d(A)!==null},init:function(){d("EXT_color_buffer_float"),d("WEBGL_clip_cull_distance"),d("OES_texture_float_linear"),d("EXT_color_buffer_half_float"),d("WEBGL_multisampled_render_to_texture"),d("WEBGL_render_shared_exponent")},get:function(A){const x=d(A);return x===null&&console.warn("THREE.WebGLRenderer: "+A+" extension not supported."),x}}}function FMe(S,a,d,A){const x={},w=new WeakMap;function M(Y){const X=Y.target;X.index!==null&&a.remove(X.index);for(const ie in X.attributes)a.remove(X.attributes[ie]);for(const ie in X.morphAttributes){const oe=X.morphAttributes[ie];for(let ne=0,ee=oe.length;ne<ee;ne++)a.remove(oe[ne])}X.removeEventListener("dispose",M),delete x[X.id];const Z=w.get(X);Z&&(a.remove(Z),w.delete(X)),A.releaseStatesOfGeometry(X),X.isInstancedBufferGeometry===!0&&delete X._maxInstanceCount,d.memory.geometries--}function N(Y,X){return x[X.id]===!0||(X.addEventListener("dispose",M),x[X.id]=!0,d.memory.geometries++),X}function P(Y){const X=Y.attributes;for(const ie in X)a.update(X[ie],S.ARRAY_BUFFER);const Z=Y.morphAttributes;for(const ie in Z){const oe=Z[ie];for(let ne=0,ee=oe.length;ne<ee;ne++)a.update(oe[ne],S.ARRAY_BUFFER)}}function k(Y){const X=[],Z=Y.index,ie=Y.attributes.position;let oe=0;if(Z!==null){const Me=Z.array;oe=Z.version;for(let we=0,xe=Me.length;we<xe;we+=3){const st=Me[we+0],Qe=Me[we+1],Ze=Me[we+2];X.push(st,Qe,Qe,Ze,Ze,st)}}else if(ie!==void 0){const Me=ie.array;oe=ie.version;for(let we=0,xe=Me.length/3-1;we<xe;we+=3){const st=we+0,Qe=we+1,Ze=we+2;X.push(st,Qe,Qe,Ze,Ze,st)}}else return;const ne=new(UE(X)?yN:AN)(X,1);ne.version=oe;const ee=w.get(Y);ee&&a.remove(ee),w.set(Y,ne)}function j(Y){const X=w.get(Y);if(X){const Z=Y.index;Z!==null&&X.version<Z.version&&k(Y)}else k(Y);return w.get(Y)}return{get:N,update:P,getWireframeAttribute:j}}function UMe(S,a,d){let A;function x(X){A=X}let w,M;function N(X){w=X.type,M=X.bytesPerElement}function P(X,Z){S.drawElements(A,Z,w,X*M),d.update(Z,A,1)}function k(X,Z,ie){ie!==0&&(S.drawElementsInstanced(A,Z,w,X*M,ie),d.update(Z,A,ie))}function j(X,Z,ie){if(ie===0)return;const oe=a.get("WEBGL_multi_draw");if(oe===null)for(let ne=0;ne<ie;ne++)this.render(X[ne]/M,Z[ne]);else{oe.multiDrawElementsWEBGL(A,Z,0,w,X,0,ie);let ne=0;for(let ee=0;ee<ie;ee++)ne+=Z[ee];d.update(ne,A,1)}}function Y(X,Z,ie,oe){if(ie===0)return;const ne=a.get("WEBGL_multi_draw");if(ne===null)for(let ee=0;ee<X.length;ee++)k(X[ee]/M,Z[ee],oe[ee]);else{ne.multiDrawElementsInstancedWEBGL(A,Z,0,w,X,0,oe,0,ie);let ee=0;for(let Me=0;Me<ie;Me++)ee+=Z[Me];for(let Me=0;Me<oe.length;Me++)d.update(ee,A,oe[Me])}}this.setMode=x,this.setIndex=N,this.render=P,this.renderInstances=k,this.renderMultiDraw=j,this.renderMultiDrawInstances=Y}function zMe(S){const a={geometries:0,textures:0},d={frame:0,calls:0,triangles:0,points:0,lines:0};function A(w,M,N){switch(d.calls++,M){case S.TRIANGLES:d.triangles+=N*(w/3);break;case S.LINES:d.lines+=N*(w/2);break;case S.LINE_STRIP:d.lines+=N*(w-1);break;case S.LINE_LOOP:d.lines+=N*w;break;case S.POINTS:d.points+=N*w;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",M);break}}function x(){d.calls=0,d.triangles=0,d.points=0,d.lines=0}return{memory:a,render:d,programs:null,autoReset:!0,reset:x,update:A}}function jMe(S,a,d){const A=new WeakMap,x=new Un;function w(M,N,P){const k=M.morphTargetInfluences,j=N.morphAttributes.position||N.morphAttributes.normal||N.morphAttributes.color,Y=j!==void 0?j.length:0;let X=A.get(N);if(X===void 0||X.count!==Y){let Z=function(){rt.dispose(),A.delete(N),N.removeEventListener("dispose",Z)};X!==void 0&&X.texture.dispose();const ie=N.morphAttributes.position!==void 0,oe=N.morphAttributes.normal!==void 0,ne=N.morphAttributes.color!==void 0,ee=N.morphAttributes.position||[],Me=N.morphAttributes.normal||[],we=N.morphAttributes.color||[];let xe=0;ie===!0&&(xe=1),oe===!0&&(xe=2),ne===!0&&(xe=3);let st=N.attributes.position.count*xe,Qe=1;st>a.maxTextureSize&&(Qe=Math.ceil(st/a.maxTextureSize),st=a.maxTextureSize);const Ze=new Float32Array(st*Qe*4*Y),rt=new o0(Ze,st,Qe,Y);rt.type=Tt,rt.needsUpdate=!0;const ze=xe*4;for(let De=0;De<Y;De++){const nt=ee[De],gt=Me[De],ft=we[De],Rt=st*Qe*4*De;for(let Ut=0;Ut<nt.count;Ut++){const fi=Ut*ze;ie===!0&&(x.fromBufferAttribute(nt,Ut),Ze[Rt+fi+0]=x.x,Ze[Rt+fi+1]=x.y,Ze[Rt+fi+2]=x.z,Ze[Rt+fi+3]=0),oe===!0&&(x.fromBufferAttribute(gt,Ut),Ze[Rt+fi+4]=x.x,Ze[Rt+fi+5]=x.y,Ze[Rt+fi+6]=x.z,Ze[Rt+fi+7]=0),ne===!0&&(x.fromBufferAttribute(ft,Ut),Ze[Rt+fi+8]=x.x,Ze[Rt+fi+9]=x.y,Ze[Rt+fi+10]=x.z,Ze[Rt+fi+11]=ft.itemSize===4?x.w:1)}}X={count:Y,texture:rt,size:new oi(st,Qe)},A.set(N,X),N.addEventListener("dispose",Z)}if(M.isInstancedMesh===!0&&M.morphTexture!==null)P.getUniforms().setValue(S,"morphTexture",M.morphTexture,d);else{let Z=0;for(let oe=0;oe<k.length;oe++)Z+=k[oe];const ie=N.morphTargetsRelative?1:1-Z;P.getUniforms().setValue(S,"morphTargetBaseInfluence",ie),P.getUniforms().setValue(S,"morphTargetInfluences",k)}P.getUniforms().setValue(S,"morphTargetsTexture",X.texture,d),P.getUniforms().setValue(S,"morphTargetsTextureSize",X.size)}return{update:w}}class GMe{constructor(a,d,A){if(this.renderer=a,this.DEFAULT_NUMVIEWS=2,this.maxNumViews=0,this.gl=A,this.extensions=d,this.available=this.extensions.has("OCULUS_multiview"),this.available){const w=this.extensions.get("OCULUS_multiview");this.maxNumViews=this.gl.getParameter(w.MAX_VIEWS_OVR),this.mat4=[],this.mat3=[],this.cameraArray=[];for(var x=0;x<this.maxNumViews;x++)this.mat4[x]=new mr,this.mat3[x]=new Xr}}getCameraArray(a){return a.isArrayCamera?a.cameras:(this.cameraArray[0]=a,this.cameraArray)}updateCameraProjectionMatricesUniform(a,d){for(var A=this.getCameraArray(a),x=0;x<A.length;x++)this.mat4[x].copy(A[x].projectionMatrix);d.setValue(this.gl,"projectionMatrices",this.mat4)}updateCameraViewMatricesUniform(a,d){for(var A=this.getCameraArray(a),x=0;x<A.length;x++)this.mat4[x].copy(A[x].matrixWorldInverse);d.setValue(this.gl,"viewMatrices",this.mat4)}updateObjectMatricesUniforms(a,d,A){for(var x=this.getCameraArray(d),w=0;w<x.length;w++)this.mat4[w].multiplyMatrices(x[w].matrixWorldInverse,a.matrixWorld),this.mat3[w].getNormalMatrix(this.mat4[w]);A.setValue(this.gl,"modelViewMatrices",this.mat4),A.setValue(this.gl,"normalMatrices",this.mat3)}}function VMe(S,a,d,A){let x=new WeakMap;function w(P){const k=A.render.frame,j=P.geometry,Y=a.get(P,j);if(x.get(Y)!==k&&(a.update(Y),x.set(Y,k)),P.isInstancedMesh&&(P.hasEventListener("dispose",N)===!1&&P.addEventListener("dispose",N),x.get(P)!==k&&(d.update(P.instanceMatrix,S.ARRAY_BUFFER),P.instanceColor!==null&&d.update(P.instanceColor,S.ARRAY_BUFFER),x.set(P,k))),P.isSkinnedMesh){const X=P.skeleton;x.get(X)!==k&&(X.update(),x.set(X,k))}return Y}function M(){x=new WeakMap}function N(P){const k=P.target;k.removeEventListener("dispose",N),d.remove(k.instanceMatrix),k.instanceColor!==null&&d.remove(k.instanceColor)}return{update:w,dispose:M}}class IN extends ds{constructor(a,d,A,x,w,M,N,P,k,j){if(j=j!==void 0?j:Ye,j!==Ye&&j!==lt)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");A===void 0&&j===Ye&&(A=ct),A===void 0&&j===lt&&(A=Di),super(null,x,w,M,N,P,j,A,k),this.isDepthTexture=!0,this.image={width:a,height:d},this.magFilter=N!==void 0?N:Lt,this.minFilter=P!==void 0?P:Lt,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(a){return super.copy(a),this.compareFunction=a.compareFunction,this}toJSON(a){const d=super.toJSON(a);return this.compareFunction!==null&&(d.compareFunction=this.compareFunction),d}}const CG=new ds,SG=new IN(1,1);SG.compareFunction=mv;const TG=new o0,MG=new Kr,RG=new Cv,IG=[],BG=[],NG=new Float32Array(16),LG=new Float32Array(9),DG=new Float32Array(4);function S0(S,a,d){const A=S[0];if(A<=0||A>0)return S;const x=a*d;let w=IG[x];if(w===void 0&&(w=new Float32Array(x),IG[x]=w),a!==0){A.toArray(w,0);for(let M=1,N=0;M!==a;++M)N+=d,S[M].toArray(w,N)}return w}function ba(S,a){if(S.length!==a.length)return!1;for(let d=0,A=S.length;d<A;d++)if(S[d]!==a[d])return!1;return!0}function xa(S,a){for(let d=0,A=a.length;d<A;d++)S[d]=a[d]}function hw(S,a){let d=BG[a];d===void 0&&(d=new Int32Array(a),BG[a]=d);for(let A=0;A!==a;++A)d[A]=S.allocateTextureUnit();return d}function HMe(S,a){const d=this.cache;d[0]!==a&&(S.uniform1f(this.addr,a),d[0]=a)}function WMe(S,a){const d=this.cache;if(a.x!==void 0)(d[0]!==a.x||d[1]!==a.y)&&(S.uniform2f(this.addr,a.x,a.y),d[0]=a.x,d[1]=a.y);else{if(ba(d,a))return;S.uniform2fv(this.addr,a),xa(d,a)}}function QMe(S,a){const d=this.cache;if(a.x!==void 0)(d[0]!==a.x||d[1]!==a.y||d[2]!==a.z)&&(S.uniform3f(this.addr,a.x,a.y,a.z),d[0]=a.x,d[1]=a.y,d[2]=a.z);else if(a.r!==void 0)(d[0]!==a.r||d[1]!==a.g||d[2]!==a.b)&&(S.uniform3f(this.addr,a.r,a.g,a.b),d[0]=a.r,d[1]=a.g,d[2]=a.b);else{if(ba(d,a))return;S.uniform3fv(this.addr,a),xa(d,a)}}function qMe(S,a){const d=this.cache;if(a.x!==void 0)(d[0]!==a.x||d[1]!==a.y||d[2]!==a.z||d[3]!==a.w)&&(S.uniform4f(this.addr,a.x,a.y,a.z,a.w),d[0]=a.x,d[1]=a.y,d[2]=a.z,d[3]=a.w);else{if(ba(d,a))return;S.uniform4fv(this.addr,a),xa(d,a)}}function XMe(S,a){const d=this.cache,A=a.elements;if(A===void 0){if(ba(d,a))return;S.uniformMatrix2fv(this.addr,!1,a),xa(d,a)}else{if(ba(d,A))return;DG.set(A),S.uniformMatrix2fv(this.addr,!1,DG),xa(d,A)}}function KMe(S,a){const d=this.cache,A=a.elements;if(A===void 0){if(ba(d,a))return;S.uniformMatrix3fv(this.addr,!1,a),xa(d,a)}else{if(ba(d,A))return;LG.set(A),S.uniformMatrix3fv(this.addr,!1,LG),xa(d,A)}}function YMe(S,a){const d=this.cache,A=a.elements;if(A===void 0){if(ba(d,a))return;S.uniformMatrix4fv(this.addr,!1,a),xa(d,a)}else{if(ba(d,A))return;NG.set(A),S.uniformMatrix4fv(this.addr,!1,NG),xa(d,A)}}function JMe(S,a){const d=this.cache;d[0]!==a&&(S.uniform1i(this.addr,a),d[0]=a)}function ZMe(S,a){const d=this.cache;if(a.x!==void 0)(d[0]!==a.x||d[1]!==a.y)&&(S.uniform2i(this.addr,a.x,a.y),d[0]=a.x,d[1]=a.y);else{if(ba(d,a))return;S.uniform2iv(this.addr,a),xa(d,a)}}function $Me(S,a){const d=this.cache;if(a.x!==void 0)(d[0]!==a.x||d[1]!==a.y||d[2]!==a.z)&&(S.uniform3i(this.addr,a.x,a.y,a.z),d[0]=a.x,d[1]=a.y,d[2]=a.z);else{if(ba(d,a))return;S.uniform3iv(this.addr,a),xa(d,a)}}function e3e(S,a){const d=this.cache;if(a.x!==void 0)(d[0]!==a.x||d[1]!==a.y||d[2]!==a.z||d[3]!==a.w)&&(S.uniform4i(this.addr,a.x,a.y,a.z,a.w),d[0]=a.x,d[1]=a.y,d[2]=a.z,d[3]=a.w);else{if(ba(d,a))return;S.uniform4iv(this.addr,a),xa(d,a)}}function t3e(S,a){const d=this.cache;d[0]!==a&&(S.uniform1ui(this.addr,a),d[0]=a)}function i3e(S,a){const d=this.cache;if(a.x!==void 0)(d[0]!==a.x||d[1]!==a.y)&&(S.uniform2ui(this.addr,a.x,a.y),d[0]=a.x,d[1]=a.y);else{if(ba(d,a))return;S.uniform2uiv(this.addr,a),xa(d,a)}}function r3e(S,a){const d=this.cache;if(a.x!==void 0)(d[0]!==a.x||d[1]!==a.y||d[2]!==a.z)&&(S.uniform3ui(this.addr,a.x,a.y,a.z),d[0]=a.x,d[1]=a.y,d[2]=a.z);else{if(ba(d,a))return;S.uniform3uiv(this.addr,a),xa(d,a)}}function n3e(S,a){const d=this.cache;if(a.x!==void 0)(d[0]!==a.x||d[1]!==a.y||d[2]!==a.z||d[3]!==a.w)&&(S.uniform4ui(this.addr,a.x,a.y,a.z,a.w),d[0]=a.x,d[1]=a.y,d[2]=a.z,d[3]=a.w);else{if(ba(d,a))return;S.uniform4uiv(this.addr,a),xa(d,a)}}function s3e(S,a,d){const A=this.cache,x=d.allocateTextureUnit();A[0]!==x&&(S.uniform1i(this.addr,x),A[0]=x);const w=this.type===S.SAMPLER_2D_SHADOW?SG:CG;d.setTexture2D(a||w,x)}function a3e(S,a,d){const A=this.cache,x=d.allocateTextureUnit();A[0]!==x&&(S.uniform1i(this.addr,x),A[0]=x),d.setTexture3D(a||MG,x)}function o3e(S,a,d){const A=this.cache,x=d.allocateTextureUnit();A[0]!==x&&(S.uniform1i(this.addr,x),A[0]=x),d.setTextureCube(a||RG,x)}function l3e(S,a,d){const A=this.cache,x=d.allocateTextureUnit();A[0]!==x&&(S.uniform1i(this.addr,x),A[0]=x),d.setTexture2DArray(a||TG,x)}function c3e(S){switch(S){case 5126:return HMe;case 35664:return WMe;case 35665:return QMe;case 35666:return qMe;case 35674:return XMe;case 35675:return KMe;case 35676:return YMe;case 5124:case 35670:return JMe;case 35667:case 35671:return ZMe;case 35668:case 35672:return $Me;case 35669:case 35673:return e3e;case 5125:return t3e;case 36294:return i3e;case 36295:return r3e;case 36296:return n3e;case 35678:case 36198:case 36298:case 36306:case 35682:return s3e;case 35679:case 36299:case 36307:return a3e;case 35680:case 36300:case 36308:case 36293:return o3e;case 36289:case 36303:case 36311:case 36292:return l3e}}function u3e(S,a){S.uniform1fv(this.addr,a)}function h3e(S,a){const d=S0(a,this.size,2);S.uniform2fv(this.addr,d)}function d3e(S,a){const d=S0(a,this.size,3);S.uniform3fv(this.addr,d)}function p3e(S,a){const d=S0(a,this.size,4);S.uniform4fv(this.addr,d)}function f3e(S,a){const d=S0(a,this.size,4);S.uniformMatrix2fv(this.addr,!1,d)}function m3e(S,a){const d=S0(a,this.size,9);S.uniformMatrix3fv(this.addr,!1,d)}function g3e(S,a){const d=S0(a,this.size,16);S.uniformMatrix4fv(this.addr,!1,d)}function A3e(S,a){S.uniform1iv(this.addr,a)}function y3e(S,a){S.uniform2iv(this.addr,a)}function v3e(S,a){S.uniform3iv(this.addr,a)}function b3e(S,a){S.uniform4iv(this.addr,a)}function x3e(S,a){S.uniform1uiv(this.addr,a)}function _3e(S,a){S.uniform2uiv(this.addr,a)}function E3e(S,a){S.uniform3uiv(this.addr,a)}function w3e(S,a){S.uniform4uiv(this.addr,a)}function C3e(S,a,d){const A=this.cache,x=a.length,w=hw(d,x);ba(A,w)||(S.uniform1iv(this.addr,w),xa(A,w));for(let M=0;M!==x;++M)d.setTexture2D(a[M]||CG,w[M])}function S3e(S,a,d){const A=this.cache,x=a.length,w=hw(d,x);ba(A,w)||(S.uniform1iv(this.addr,w),xa(A,w));for(let M=0;M!==x;++M)d.setTexture3D(a[M]||MG,w[M])}function T3e(S,a,d){const A=this.cache,x=a.length,w=hw(d,x);ba(A,w)||(S.uniform1iv(this.addr,w),xa(A,w));for(let M=0;M!==x;++M)d.setTextureCube(a[M]||RG,w[M])}function M3e(S,a,d){const A=this.cache,x=a.length,w=hw(d,x);ba(A,w)||(S.uniform1iv(this.addr,w),xa(A,w));for(let M=0;M!==x;++M)d.setTexture2DArray(a[M]||TG,w[M])}function R3e(S){switch(S){case 5126:return u3e;case 35664:return h3e;case 35665:return d3e;case 35666:return p3e;case 35674:return f3e;case 35675:return m3e;case 35676:return g3e;case 5124:case 35670:return A3e;case 35667:case 35671:return y3e;case 35668:case 35672:return v3e;case 35669:case 35673:return b3e;case 5125:return x3e;case 36294:return _3e;case 36295:return E3e;case 36296:return w3e;case 35678:case 36198:case 36298:case 36306:case 35682:return C3e;case 35679:case 36299:case 36307:return S3e;case 35680:case 36300:case 36308:case 36293:return T3e;case 36289:case 36303:case 36311:case 36292:return M3e}}class I3e{constructor(a,d,A){this.id=a,this.addr=A,this.cache=[],this.type=d.type,this.setValue=c3e(d.type)}}class B3e{constructor(a,d,A){this.id=a,this.addr=A,this.cache=[],this.type=d.type,this.size=d.size,this.setValue=R3e(d.type)}}class N3e{constructor(a){this.id=a,this.seq=[],this.map={}}setValue(a,d,A){const x=this.seq;for(let w=0,M=x.length;w!==M;++w){const N=x[w];N.setValue(a,d[N.id],A)}}}const BN=/(\w+)(\])?(\[|\.)?/g;function OG(S,a){S.seq.push(a),S.map[a.id]=a}function L3e(S,a,d){const A=S.name,x=A.length;for(BN.lastIndex=0;;){const w=BN.exec(A),M=BN.lastIndex;let N=w[1];const P=w[2]==="]",k=w[3];if(P&&(N=N|0),k===void 0||k==="["&&M+2===x){OG(d,k===void 0?new I3e(N,S,a):new B3e(N,S,a));break}else{let j=d.map[N];j===void 0&&(j=new N3e(N),OG(d,j)),d=j}}}class dw{constructor(a,d){this.seq=[],this.map={};const A=a.getProgramParameter(d,a.ACTIVE_UNIFORMS);for(let x=0;x<A;++x){const w=a.getActiveUniform(d,x),M=a.getUniformLocation(d,w.name);L3e(w,M,this)}}setValue(a,d,A,x){const w=this.map[d];w!==void 0&&w.setValue(a,A,x)}setOptional(a,d,A){const x=d[A];x!==void 0&&this.setValue(a,A,x)}static upload(a,d,A,x){for(let w=0,M=d.length;w!==M;++w){const N=d[w],P=A[N.id];P.needsUpdate!==!1&&N.setValue(a,P.value,x)}}static seqWithValue(a,d){const A=[];for(let x=0,w=a.length;x!==w;++x){const M=a[x];M.id in d&&A.push(M)}return A}}function PG(S,a,d){const A=S.createShader(a);return S.shaderSource(A,d),S.compileShader(A),A}const D3e=37297;let O3e=0;function P3e(S,a){const d=S.split(`
`),A=[],x=Math.max(a-6,0),w=Math.min(a+6,d.length);for(let M=x;M<w;M++){const N=M+1;A.push(`${N===a?">":" "} ${N}: ${d[M]}`)}return A.join(`
`)}function k3e(S){const a=Yn.getPrimaries(Yn.workingColorSpace),d=Yn.getPrimaries(S);let A;switch(a===d?A="":a===mf&&d===ff?A="LinearDisplayP3ToLinearSRGB":a===ff&&d===mf&&(A="LinearSRGBToLinearDisplayP3"),S){case Lc:case df:return[A,"LinearTransferOETF"];case On:case r0:return[A,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",S),[A,"LinearTransferOETF"]}}function kG(S,a,d){const A=S.getShaderParameter(a,S.COMPILE_STATUS),x=S.getShaderInfoLog(a).trim();if(A&&x==="")return"";const w=/ERROR: 0:(\d+)/.exec(x);if(w){const M=parseInt(w[1]);return d.toUpperCase()+`

`+x+`

`+P3e(S.getShaderSource(a),M)}else return x}function F3e(S,a){const d=k3e(a);return`vec4 ${S}( vec4 value ) { return ${d[0]}( ${d[1]}( value ) ); }`}function U3e(S,a){let d;switch(a){case $t:d="Linear";break;case Mt:d="Reinhard";break;case yi:d="OptimizedCineon";break;case vt:d="ACESFilmic";break;case ve:d="AgX";break;case Ne:d="Neutral";break;case ye:d="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",a),d="Linear"}return"vec3 "+S+"( vec3 color ) { return "+d+"ToneMapping( color ); }"}function z3e(S){return[S.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",S.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(Tv).join(`
`)}function j3e(S){const a=[];for(const d in S){const A=S[d];A!==!1&&a.push("#define "+d+" "+A)}return a.join(`
`)}function G3e(S,a){const d={},A=S.getProgramParameter(a,S.ACTIVE_ATTRIBUTES);for(let x=0;x<A;x++){const w=S.getActiveAttrib(a,x),M=w.name;let N=1;w.type===S.FLOAT_MAT2&&(N=2),w.type===S.FLOAT_MAT3&&(N=3),w.type===S.FLOAT_MAT4&&(N=4),d[M]={type:w.type,location:S.getAttribLocation(a,M),locationSize:N}}return d}function Tv(S){return S!==""}function FG(S,a){const d=a.numSpotLightShadows+a.numSpotLightMaps-a.numSpotLightShadowsWithMaps;return S.replace(/NUM_DIR_LIGHTS/g,a.numDirLights).replace(/NUM_SPOT_LIGHTS/g,a.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,a.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,d).replace(/NUM_RECT_AREA_LIGHTS/g,a.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,a.numPointLights).replace(/NUM_HEMI_LIGHTS/g,a.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,a.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,a.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,a.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,a.numPointLightShadows)}function UG(S,a){return S.replace(/NUM_CLIPPING_PLANES/g,a.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,a.numClippingPlanes-a.numClipIntersection)}const V3e=/^[ \t]*#include +<([\w\d./]+)>/gm;function NN(S){return S.replace(V3e,W3e)}const H3e=new Map;function W3e(S,a){let d=on[a];if(d===void 0){const A=H3e.get(a);if(A!==void 0)d=on[A],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',a,A);else throw new Error("Can not resolve #include <"+a+">")}return NN(d)}const Q3e=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function zG(S){return S.replace(Q3e,q3e)}function q3e(S,a,d,A){let x="";for(let w=parseInt(a);w<parseInt(d);w++)x+=A.replace(/\[\s*i\s*\]/g,"[ "+w+" ]").replace(/UNROLLED_LOOP_INDEX/g,w);return x}function jG(S){let a=`precision ${S.precision} float;
	precision ${S.precision} int;
	precision ${S.precision} sampler2D;
	precision ${S.precision} samplerCube;
	precision ${S.precision} sampler3D;
	precision ${S.precision} sampler2DArray;
	precision ${S.precision} sampler2DShadow;
	precision ${S.precision} samplerCubeShadow;
	precision ${S.precision} sampler2DArrayShadow;
	precision ${S.precision} isampler2D;
	precision ${S.precision} isampler3D;
	precision ${S.precision} isamplerCube;
	precision ${S.precision} isampler2DArray;
	precision ${S.precision} usampler2D;
	precision ${S.precision} usampler3D;
	precision ${S.precision} usamplerCube;
	precision ${S.precision} usampler2DArray;
	`;return S.precision==="highp"?a+=`
#define HIGH_PRECISION`:S.precision==="mediump"?a+=`
#define MEDIUM_PRECISION`:S.precision==="lowp"&&(a+=`
#define LOW_PRECISION`),a}function X3e(S){let a="SHADOWMAP_TYPE_BASIC";return S.shadowMapType===_?a="SHADOWMAP_TYPE_PCF":S.shadowMapType===C?a="SHADOWMAP_TYPE_PCF_SOFT":S.shadowMapType===E&&(a="SHADOWMAP_TYPE_VSM"),a}function K3e(S){let a="ENVMAP_TYPE_CUBE";if(S.envMap)switch(S.envMapMode){case U:case $:a="ENVMAP_TYPE_CUBE";break;case ce:a="ENVMAP_TYPE_CUBE_UV";break}return a}function Y3e(S){let a="ENVMAP_MODE_REFLECTION";if(S.envMap)switch(S.envMapMode){case $:a="ENVMAP_MODE_REFRACTION";break}return a}function J3e(S){let a="ENVMAP_BLENDING_NONE";if(S.envMap)switch(S.combine){case Ge:a="ENVMAP_BLENDING_MULTIPLY";break;case Ce:a="ENVMAP_BLENDING_MIX";break;case At:a="ENVMAP_BLENDING_ADD";break}return a}function Z3e(S){const a=S.envMapCubeUVHeight;if(a===null)return null;const d=Math.log2(a)-2,A=1/a;return{texelWidth:1/(3*Math.max(Math.pow(2,d),112)),texelHeight:A,maxMip:d}}function $3e(S,a,d,A){const x=S.getContext(),w=d.defines;let M=d.vertexShader,N=d.fragmentShader;const P=X3e(d),k=K3e(d),j=Y3e(d),Y=J3e(d),X=Z3e(d),Z=z3e(d),ie=j3e(w),oe=x.createProgram();let ne,ee,Me=d.glslVersion?"#version "+d.glslVersion+`
`:"";const we=d.numMultiviewViews;d.isRawShaderMaterial?(ne=["#define SHADER_TYPE "+d.shaderType,"#define SHADER_NAME "+d.shaderName,ie].filter(Tv).join(`
`),ne.length>0&&(ne+=`
`),ee=["#define SHADER_TYPE "+d.shaderType,"#define SHADER_NAME "+d.shaderName,ie].filter(Tv).join(`
`),ee.length>0&&(ee+=`
`)):(ne=[jG(d),"#define SHADER_TYPE "+d.shaderType,"#define SHADER_NAME "+d.shaderName,ie,d.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",d.batching?"#define USE_BATCHING":"",d.instancing?"#define USE_INSTANCING":"",d.instancingColor?"#define USE_INSTANCING_COLOR":"",d.instancingMorph?"#define USE_INSTANCING_MORPH":"",d.useFog&&d.fog?"#define USE_FOG":"",d.useFog&&d.fogExp2?"#define FOG_EXP2":"",d.map?"#define USE_MAP":"",d.envMap?"#define USE_ENVMAP":"",d.envMap?"#define "+j:"",d.lightMap?"#define USE_LIGHTMAP":"",d.aoMap?"#define USE_AOMAP":"",d.bumpMap?"#define USE_BUMPMAP":"",d.normalMap?"#define USE_NORMALMAP":"",d.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",d.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",d.displacementMap?"#define USE_DISPLACEMENTMAP":"",d.emissiveMap?"#define USE_EMISSIVEMAP":"",d.anisotropy?"#define USE_ANISOTROPY":"",d.anisotropyMap?"#define USE_ANISOTROPYMAP":"",d.clearcoatMap?"#define USE_CLEARCOATMAP":"",d.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",d.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",d.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",d.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",d.specularMap?"#define USE_SPECULARMAP":"",d.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",d.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",d.roughnessMap?"#define USE_ROUGHNESSMAP":"",d.metalnessMap?"#define USE_METALNESSMAP":"",d.alphaMap?"#define USE_ALPHAMAP":"",d.alphaHash?"#define USE_ALPHAHASH":"",d.transmission?"#define USE_TRANSMISSION":"",d.transmissionMap?"#define USE_TRANSMISSIONMAP":"",d.thicknessMap?"#define USE_THICKNESSMAP":"",d.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",d.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",d.mapUv?"#define MAP_UV "+d.mapUv:"",d.alphaMapUv?"#define ALPHAMAP_UV "+d.alphaMapUv:"",d.lightMapUv?"#define LIGHTMAP_UV "+d.lightMapUv:"",d.aoMapUv?"#define AOMAP_UV "+d.aoMapUv:"",d.emissiveMapUv?"#define EMISSIVEMAP_UV "+d.emissiveMapUv:"",d.bumpMapUv?"#define BUMPMAP_UV "+d.bumpMapUv:"",d.normalMapUv?"#define NORMALMAP_UV "+d.normalMapUv:"",d.displacementMapUv?"#define DISPLACEMENTMAP_UV "+d.displacementMapUv:"",d.metalnessMapUv?"#define METALNESSMAP_UV "+d.metalnessMapUv:"",d.roughnessMapUv?"#define ROUGHNESSMAP_UV "+d.roughnessMapUv:"",d.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+d.anisotropyMapUv:"",d.clearcoatMapUv?"#define CLEARCOATMAP_UV "+d.clearcoatMapUv:"",d.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+d.clearcoatNormalMapUv:"",d.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+d.clearcoatRoughnessMapUv:"",d.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+d.iridescenceMapUv:"",d.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+d.iridescenceThicknessMapUv:"",d.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+d.sheenColorMapUv:"",d.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+d.sheenRoughnessMapUv:"",d.specularMapUv?"#define SPECULARMAP_UV "+d.specularMapUv:"",d.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+d.specularColorMapUv:"",d.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+d.specularIntensityMapUv:"",d.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+d.transmissionMapUv:"",d.thicknessMapUv?"#define THICKNESSMAP_UV "+d.thicknessMapUv:"",d.vertexTangents&&d.flatShading===!1?"#define USE_TANGENT":"",d.vertexColors?"#define USE_COLOR":"",d.vertexAlphas?"#define USE_COLOR_ALPHA":"",d.vertexUv1s?"#define USE_UV1":"",d.vertexUv2s?"#define USE_UV2":"",d.vertexUv3s?"#define USE_UV3":"",d.pointsUvs?"#define USE_POINTS_UV":"",d.flatShading?"#define FLAT_SHADED":"",d.skinning?"#define USE_SKINNING":"",d.morphTargets?"#define USE_MORPHTARGETS":"",d.morphNormals&&d.flatShading===!1?"#define USE_MORPHNORMALS":"",d.morphColors?"#define USE_MORPHCOLORS":"",d.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE":"",d.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+d.morphTextureStride:"",d.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+d.morphTargetsCount:"",d.doubleSided?"#define DOUBLE_SIDED":"",d.flipSided?"#define FLIP_SIDED":"",d.shadowMapEnabled?"#define USE_SHADOWMAP":"",d.shadowMapEnabled?"#define "+P:"",d.sizeAttenuation?"#define USE_SIZEATTENUATION":"",d.numLightProbes>0?"#define USE_LIGHT_PROBES":"",d.useLegacyLights?"#define LEGACY_LIGHTS":"",d.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Tv).join(`
`),ee=[jG(d),"#define SHADER_TYPE "+d.shaderType,"#define SHADER_NAME "+d.shaderName,ie,d.useFog&&d.fog?"#define USE_FOG":"",d.useFog&&d.fogExp2?"#define FOG_EXP2":"",d.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",d.map?"#define USE_MAP":"",d.matcap?"#define USE_MATCAP":"",d.envMap?"#define USE_ENVMAP":"",d.envMap?"#define "+k:"",d.envMap?"#define "+j:"",d.envMap?"#define "+Y:"",X?"#define CUBEUV_TEXEL_WIDTH "+X.texelWidth:"",X?"#define CUBEUV_TEXEL_HEIGHT "+X.texelHeight:"",X?"#define CUBEUV_MAX_MIP "+X.maxMip+".0":"",d.lightMap?"#define USE_LIGHTMAP":"",d.aoMap?"#define USE_AOMAP":"",d.bumpMap?"#define USE_BUMPMAP":"",d.normalMap?"#define USE_NORMALMAP":"",d.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",d.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",d.emissiveMap?"#define USE_EMISSIVEMAP":"",d.anisotropy?"#define USE_ANISOTROPY":"",d.anisotropyMap?"#define USE_ANISOTROPYMAP":"",d.clearcoat?"#define USE_CLEARCOAT":"",d.clearcoatMap?"#define USE_CLEARCOATMAP":"",d.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",d.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",d.dispersion?"#define USE_DISPERSION":"",d.iridescence?"#define USE_IRIDESCENCE":"",d.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",d.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",d.specularMap?"#define USE_SPECULARMAP":"",d.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",d.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",d.roughnessMap?"#define USE_ROUGHNESSMAP":"",d.metalnessMap?"#define USE_METALNESSMAP":"",d.alphaMap?"#define USE_ALPHAMAP":"",d.alphaTest?"#define USE_ALPHATEST":"",d.alphaHash?"#define USE_ALPHAHASH":"",d.sheen?"#define USE_SHEEN":"",d.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",d.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",d.transmission?"#define USE_TRANSMISSION":"",d.transmissionMap?"#define USE_TRANSMISSIONMAP":"",d.thicknessMap?"#define USE_THICKNESSMAP":"",d.vertexTangents&&d.flatShading===!1?"#define USE_TANGENT":"",d.vertexColors||d.instancingColor?"#define USE_COLOR":"",d.vertexAlphas?"#define USE_COLOR_ALPHA":"",d.vertexUv1s?"#define USE_UV1":"",d.vertexUv2s?"#define USE_UV2":"",d.vertexUv3s?"#define USE_UV3":"",d.pointsUvs?"#define USE_POINTS_UV":"",d.gradientMap?"#define USE_GRADIENTMAP":"",d.flatShading?"#define FLAT_SHADED":"",d.doubleSided?"#define DOUBLE_SIDED":"",d.flipSided?"#define FLIP_SIDED":"",d.shadowMapEnabled?"#define USE_SHADOWMAP":"",d.shadowMapEnabled?"#define "+P:"",d.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",d.numLightProbes>0?"#define USE_LIGHT_PROBES":"",d.useLegacyLights?"#define LEGACY_LIGHTS":"",d.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",d.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",d.toneMapping!==Pt?"#define TONE_MAPPING":"",d.toneMapping!==Pt?on.tonemapping_pars_fragment:"",d.toneMapping!==Pt?U3e("toneMapping",d.toneMapping):"",d.dithering?"#define DITHERING":"",d.opaque?"#define OPAQUE":"",on.colorspace_pars_fragment,F3e("linearToOutputTexel",d.outputColorSpace),d.useDepthPacking?"#define DEPTH_PACKING "+d.depthPacking:"",`
`].filter(Tv).join(`
`)),M=NN(M),M=FG(M,d),M=UG(M,d),N=NN(N),N=FG(N,d),N=UG(N,d),M=zG(M),N=zG(N),d.isRawShaderMaterial!==!0&&(Me=`#version 300 es
`,ne=[Z,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+ne,ee=["#define varying in",d.glslVersion===gv?"":"layout(location = 0) out highp vec4 pc_fragColor;",d.glslVersion===gv?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+ee,we>0&&(ne=["#extension GL_OVR_multiview : require","layout(num_views = "+we+") in;","#define VIEW_ID gl_ViewID_OVR"].join(`
`)+`
`+ne,ne=ne.replace(["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;"].join(`
`),["uniform mat4 modelViewMatrices["+we+"];","uniform mat4 projectionMatrices["+we+"];","uniform mat4 viewMatrices["+we+"];","uniform mat3 normalMatrices["+we+"];","#define modelViewMatrix modelViewMatrices[VIEW_ID]","#define projectionMatrix projectionMatrices[VIEW_ID]","#define viewMatrix viewMatrices[VIEW_ID]","#define normalMatrix normalMatrices[VIEW_ID]"].join(`
`)),ee=["#extension GL_OVR_multiview : require","#define VIEW_ID gl_ViewID_OVR"].join(`
`)+`
`+ee,ee=ee.replace("uniform mat4 viewMatrix;",["uniform mat4 viewMatrices["+we+"];","#define viewMatrix viewMatrices[VIEW_ID]"].join(`
`))));const xe=Me+ne+M,st=Me+ee+N,Qe=PG(x,x.VERTEX_SHADER,xe),Ze=PG(x,x.FRAGMENT_SHADER,st);x.attachShader(oe,Qe),x.attachShader(oe,Ze),d.index0AttributeName!==void 0?x.bindAttribLocation(oe,0,d.index0AttributeName):d.morphTargets===!0&&x.bindAttribLocation(oe,0,"position"),x.linkProgram(oe);function rt(gt){if(S.debug.checkShaderErrors){const ft=x.getProgramInfoLog(oe).trim(),Rt=x.getShaderInfoLog(Qe).trim(),Ut=x.getShaderInfoLog(Ze).trim();let fi=!0,Oi=!0;if(x.getProgramParameter(oe,x.LINK_STATUS)===!1)if(fi=!1,typeof S.debug.onShaderError=="function")S.debug.onShaderError(x,oe,Qe,Ze);else{const zt=kG(x,Qe,"vertex"),bi=kG(x,Ze,"fragment");console.error("THREE.WebGLProgram: Shader Error "+x.getError()+" - VALIDATE_STATUS "+x.getProgramParameter(oe,x.VALIDATE_STATUS)+`

Material Name: `+gt.name+`
Material Type: `+gt.type+`

Program Info Log: `+ft+`
`+zt+`
`+bi)}else ft!==""?console.warn("THREE.WebGLProgram: Program Info Log:",ft):(Rt===""||Ut==="")&&(Oi=!1);Oi&&(gt.diagnostics={runnable:fi,programLog:ft,vertexShader:{log:Rt,prefix:ne},fragmentShader:{log:Ut,prefix:ee}})}x.deleteShader(Qe),x.deleteShader(Ze),ze=new dw(x,oe),De=G3e(x,oe)}let ze;this.getUniforms=function(){return ze===void 0&&rt(this),ze};let De;this.getAttributes=function(){return De===void 0&&rt(this),De};let nt=d.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return nt===!1&&(nt=x.getProgramParameter(oe,D3e)),nt},this.destroy=function(){A.releaseStatesOfProgram(this),x.deleteProgram(oe),this.program=void 0},this.type=d.shaderType,this.name=d.shaderName,this.id=O3e++,this.cacheKey=a,this.usedTimes=1,this.program=oe,this.vertexShader=Qe,this.fragmentShader=Ze,this.numMultiviewViews=we,this}let eRe=0;class tRe{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(a){const d=a.vertexShader,A=a.fragmentShader,x=this._getShaderStage(d),w=this._getShaderStage(A),M=this._getShaderCacheForMaterial(a);return M.has(x)===!1&&(M.add(x),x.usedTimes++),M.has(w)===!1&&(M.add(w),w.usedTimes++),this}remove(a){const d=this.materialCache.get(a);for(const A of d)A.usedTimes--,A.usedTimes===0&&this.shaderCache.delete(A.code);return this.materialCache.delete(a),this}getVertexShaderID(a){return this._getShaderStage(a.vertexShader).id}getFragmentShaderID(a){return this._getShaderStage(a.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(a){const d=this.materialCache;let A=d.get(a);return A===void 0&&(A=new Set,d.set(a,A)),A}_getShaderStage(a){const d=this.shaderCache;let A=d.get(a);return A===void 0&&(A=new iRe(a),d.set(a,A)),A}}class iRe{constructor(a){this.id=eRe++,this.code=a,this.usedTimes=0}}function rRe(S,a,d,A,x,w,M){const N=new XE,P=new tRe,k=new Set,j=[],Y=x.logarithmicDepthBuffer,X=x.vertexTextures;let Z=x.precision;const ie={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function oe(ze){return k.add(ze),ze===0?"uv":`uv${ze}`}function ne(ze,De,nt,gt,ft){const Rt=gt.fog,Ut=ft.geometry,fi=ze.isMeshStandardMaterial?gt.environment:null,Oi=(ze.isMeshStandardMaterial?d:a).get(ze.envMap||fi),zt=Oi&&Oi.mapping===ce?Oi.image.height:null,bi=ie[ze.type];ze.precision!==null&&(Z=x.getMaxPrecision(ze.precision),Z!==ze.precision&&console.warn("THREE.WebGLProgram.getParameters:",ze.precision,"not supported, using",Z,"instead."));const Pi=Ut.morphAttributes.position||Ut.morphAttributes.normal||Ut.morphAttributes.color,Ur=Pi!==void 0?Pi.length:0;let _n=0;Ut.morphAttributes.position!==void 0&&(_n=1),Ut.morphAttributes.normal!==void 0&&(_n=2),Ut.morphAttributes.color!==void 0&&(_n=3);let is,ps,jn,Nn;if(bi){const Xl=Pc[bi];is=Xl.vertexShader,ps=Xl.fragmentShader}else is=ze.vertexShader,ps=ze.fragmentShader,P.update(ze),jn=P.getVertexShaderID(ze),Nn=P.getFragmentShaderID(ze);const Cr=S.getRenderTarget(),di=Cr&&Cr.isWebGLMultiviewRenderTarget?Cr.numViews:0,Ci=ft.isInstancedMesh===!0,Xi=ft.isBatchedMesh===!0,it=!!ze.map,gi=!!ze.matcap,ii=!!Oi,tr=!!ze.aoMap,ci=!!ze.lightMap,rr=!!ze.bumpMap,ir=!!ze.normalMap,yr=!!ze.displacementMap,yn=!!ze.emissiveMap,Wr=!!ze.metalnessMap,ha=!!ze.roughnessMap,Xs=ze.anisotropy>0,Wn=ze.clearcoat>0,et=ze.dispersion>0,Le=ze.iridescence>0,jt=ze.sheen>0,pi=ze.transmission>0,Ai=Xs&&!!ze.anisotropyMap,li=Wn&&!!ze.clearcoatMap,Rr=Wn&&!!ze.clearcoatNormalMap,ji=Wn&&!!ze.clearcoatRoughnessMap,ur=Le&&!!ze.iridescenceMap,Qn=Le&&!!ze.iridescenceThicknessMap,cr=jt&&!!ze.sheenColorMap,Er=jt&&!!ze.sheenRoughnessMap,En=!!ze.specularMap,zr=!!ze.specularColorMap,ut=!!ze.specularIntensityMap,xi=pi&&!!ze.transmissionMap,Ii=pi&&!!ze.thicknessMap,Mr=!!ze.gradientMap,nr=!!ze.alphaMap,ln=ze.alphaTest>0,sr=!!ze.alphaHash,$i=!!ze.extensions;let vn=Pt;ze.toneMapped&&(Cr===null||Cr.isXRRenderTarget===!0)&&(vn=S.toneMapping);const Ir={shaderID:bi,shaderType:ze.type,shaderName:ze.name,vertexShader:is,fragmentShader:ps,defines:ze.defines,customVertexShaderID:jn,customFragmentShaderID:Nn,isRawShaderMaterial:ze.isRawShaderMaterial===!0,glslVersion:ze.glslVersion,precision:Z,batching:Xi,instancing:Ci,instancingColor:Ci&&ft.instanceColor!==null,instancingMorph:Ci&&ft.morphTexture!==null,supportsVertexTextures:X,numMultiviewViews:di,outputColorSpace:Cr===null?S.outputColorSpace:Cr.isXRRenderTarget===!0?Cr.texture.colorSpace:Lc,alphaToCoverage:!!ze.alphaToCoverage,map:it,matcap:gi,envMap:ii,envMapMode:ii&&Oi.mapping,envMapCubeUVHeight:zt,aoMap:tr,lightMap:ci,bumpMap:rr,normalMap:ir,displacementMap:X&&yr,emissiveMap:yn,normalMapObjectSpace:ir&&ze.normalMapType===ou,normalMapTangentSpace:ir&&ze.normalMapType===uo,metalnessMap:Wr,roughnessMap:ha,anisotropy:Xs,anisotropyMap:Ai,clearcoat:Wn,clearcoatMap:li,clearcoatNormalMap:Rr,clearcoatRoughnessMap:ji,dispersion:et,iridescence:Le,iridescenceMap:ur,iridescenceThicknessMap:Qn,sheen:jt,sheenColorMap:cr,sheenRoughnessMap:Er,specularMap:En,specularColorMap:zr,specularIntensityMap:ut,transmission:pi,transmissionMap:xi,thicknessMap:Ii,gradientMap:Mr,opaque:ze.transparent===!1&&ze.blending===D&&ze.alphaToCoverage===!1,alphaMap:nr,alphaTest:ln,alphaHash:sr,combine:ze.combine,mapUv:it&&oe(ze.map.channel),aoMapUv:tr&&oe(ze.aoMap.channel),lightMapUv:ci&&oe(ze.lightMap.channel),bumpMapUv:rr&&oe(ze.bumpMap.channel),normalMapUv:ir&&oe(ze.normalMap.channel),displacementMapUv:yr&&oe(ze.displacementMap.channel),emissiveMapUv:yn&&oe(ze.emissiveMap.channel),metalnessMapUv:Wr&&oe(ze.metalnessMap.channel),roughnessMapUv:ha&&oe(ze.roughnessMap.channel),anisotropyMapUv:Ai&&oe(ze.anisotropyMap.channel),clearcoatMapUv:li&&oe(ze.clearcoatMap.channel),clearcoatNormalMapUv:Rr&&oe(ze.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:ji&&oe(ze.clearcoatRoughnessMap.channel),iridescenceMapUv:ur&&oe(ze.iridescenceMap.channel),iridescenceThicknessMapUv:Qn&&oe(ze.iridescenceThicknessMap.channel),sheenColorMapUv:cr&&oe(ze.sheenColorMap.channel),sheenRoughnessMapUv:Er&&oe(ze.sheenRoughnessMap.channel),specularMapUv:En&&oe(ze.specularMap.channel),specularColorMapUv:zr&&oe(ze.specularColorMap.channel),specularIntensityMapUv:ut&&oe(ze.specularIntensityMap.channel),transmissionMapUv:xi&&oe(ze.transmissionMap.channel),thicknessMapUv:Ii&&oe(ze.thicknessMap.channel),alphaMapUv:nr&&oe(ze.alphaMap.channel),vertexTangents:!!Ut.attributes.tangent&&(ir||Xs),vertexColors:ze.vertexColors,vertexAlphas:ze.vertexColors===!0&&!!Ut.attributes.color&&Ut.attributes.color.itemSize===4,pointsUvs:ft.isPoints===!0&&!!Ut.attributes.uv&&(it||nr),fog:!!Rt,useFog:ze.fog===!0,fogExp2:!!Rt&&Rt.isFogExp2,flatShading:ze.flatShading===!0,sizeAttenuation:ze.sizeAttenuation===!0,logarithmicDepthBuffer:Y,skinning:ft.isSkinnedMesh===!0,morphTargets:Ut.morphAttributes.position!==void 0,morphNormals:Ut.morphAttributes.normal!==void 0,morphColors:Ut.morphAttributes.color!==void 0,morphTargetsCount:Ur,morphTextureStride:_n,numDirLights:De.directional.length,numPointLights:De.point.length,numSpotLights:De.spot.length,numSpotLightMaps:De.spotLightMap.length,numRectAreaLights:De.rectArea.length,numHemiLights:De.hemi.length,numDirLightShadows:De.directionalShadowMap.length,numPointLightShadows:De.pointShadowMap.length,numSpotLightShadows:De.spotShadowMap.length,numSpotLightShadowsWithMaps:De.numSpotLightShadowsWithMaps,numLightProbes:De.numLightProbes,numClippingPlanes:M.numPlanes,numClipIntersection:M.numIntersection,dithering:ze.dithering,shadowMapEnabled:S.shadowMap.enabled&&nt.length>0,shadowMapType:S.shadowMap.type,toneMapping:vn,useLegacyLights:S._useLegacyLights,decodeVideoTexture:it&&ze.map.isVideoTexture===!0&&Yn.getTransfer(ze.map.colorSpace)===cs,premultipliedAlpha:ze.premultipliedAlpha,doubleSided:ze.side===B,flipSided:ze.side===R,useDepthPacking:ze.depthPacking>=0,depthPacking:ze.depthPacking||0,index0AttributeName:ze.index0AttributeName,extensionClipCullDistance:$i&&ze.extensions.clipCullDistance===!0&&A.has("WEBGL_clip_cull_distance"),extensionMultiDraw:$i&&ze.extensions.multiDraw===!0&&A.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:A.has("KHR_parallel_shader_compile"),customProgramCacheKey:ze.customProgramCacheKey()};return Ir.vertexUv1s=k.has(1),Ir.vertexUv2s=k.has(2),Ir.vertexUv3s=k.has(3),k.clear(),Ir}function ee(ze){const De=[];if(ze.shaderID?De.push(ze.shaderID):(De.push(ze.customVertexShaderID),De.push(ze.customFragmentShaderID)),ze.defines!==void 0)for(const nt in ze.defines)De.push(nt),De.push(ze.defines[nt]);return ze.isRawShaderMaterial===!1&&(Me(De,ze),we(De,ze),De.push(S.outputColorSpace)),De.push(ze.customProgramCacheKey),De.join()}function Me(ze,De){ze.push(De.precision),ze.push(De.outputColorSpace),ze.push(De.envMapMode),ze.push(De.envMapCubeUVHeight),ze.push(De.mapUv),ze.push(De.alphaMapUv),ze.push(De.lightMapUv),ze.push(De.aoMapUv),ze.push(De.bumpMapUv),ze.push(De.normalMapUv),ze.push(De.displacementMapUv),ze.push(De.emissiveMapUv),ze.push(De.metalnessMapUv),ze.push(De.roughnessMapUv),ze.push(De.anisotropyMapUv),ze.push(De.clearcoatMapUv),ze.push(De.clearcoatNormalMapUv),ze.push(De.clearcoatRoughnessMapUv),ze.push(De.iridescenceMapUv),ze.push(De.iridescenceThicknessMapUv),ze.push(De.sheenColorMapUv),ze.push(De.sheenRoughnessMapUv),ze.push(De.specularMapUv),ze.push(De.specularColorMapUv),ze.push(De.specularIntensityMapUv),ze.push(De.transmissionMapUv),ze.push(De.thicknessMapUv),ze.push(De.combine),ze.push(De.fogExp2),ze.push(De.sizeAttenuation),ze.push(De.morphTargetsCount),ze.push(De.morphAttributeCount),ze.push(De.numDirLights),ze.push(De.numPointLights),ze.push(De.numSpotLights),ze.push(De.numSpotLightMaps),ze.push(De.numHemiLights),ze.push(De.numRectAreaLights),ze.push(De.numDirLightShadows),ze.push(De.numPointLightShadows),ze.push(De.numSpotLightShadows),ze.push(De.numSpotLightShadowsWithMaps),ze.push(De.numLightProbes),ze.push(De.shadowMapType),ze.push(De.toneMapping),ze.push(De.numClippingPlanes),ze.push(De.numClipIntersection),ze.push(De.depthPacking)}function we(ze,De){N.disableAll(),De.supportsVertexTextures&&N.enable(0),De.instancing&&N.enable(1),De.instancingColor&&N.enable(2),De.instancingMorph&&N.enable(3),De.matcap&&N.enable(4),De.envMap&&N.enable(5),De.normalMapObjectSpace&&N.enable(6),De.normalMapTangentSpace&&N.enable(7),De.clearcoat&&N.enable(8),De.iridescence&&N.enable(9),De.alphaTest&&N.enable(10),De.vertexColors&&N.enable(11),De.vertexAlphas&&N.enable(12),De.vertexUv1s&&N.enable(13),De.vertexUv2s&&N.enable(14),De.vertexUv3s&&N.enable(15),De.vertexTangents&&N.enable(16),De.anisotropy&&N.enable(17),De.alphaHash&&N.enable(18),De.batching&&N.enable(19),De.dispersion&&N.enable(20),ze.push(N.mask),N.disableAll(),De.fog&&N.enable(0),De.useFog&&N.enable(1),De.flatShading&&N.enable(2),De.logarithmicDepthBuffer&&N.enable(3),De.skinning&&N.enable(4),De.morphTargets&&N.enable(5),De.morphNormals&&N.enable(6),De.morphColors&&N.enable(7),De.premultipliedAlpha&&N.enable(8),De.shadowMapEnabled&&N.enable(9),De.useLegacyLights&&N.enable(10),De.doubleSided&&N.enable(11),De.flipSided&&N.enable(12),De.useDepthPacking&&N.enable(13),De.dithering&&N.enable(14),De.transmission&&N.enable(15),De.sheen&&N.enable(16),De.opaque&&N.enable(17),De.pointsUvs&&N.enable(18),De.decodeVideoTexture&&N.enable(19),De.alphaToCoverage&&N.enable(20),De.numMultiviewViews&&N.enable(21),ze.push(N.mask)}function xe(ze){const De=ie[ze.type];let nt;if(De){const gt=Pc[De];nt=fG.clone(gt.uniforms)}else nt=ze.uniforms;return nt}function st(ze,De){let nt;for(let gt=0,ft=j.length;gt<ft;gt++){const Rt=j[gt];if(Rt.cacheKey===De){nt=Rt,++nt.usedTimes;break}}return nt===void 0&&(nt=new $3e(S,De,ze,w),j.push(nt)),nt}function Qe(ze){if(--ze.usedTimes===0){const De=j.indexOf(ze);j[De]=j[j.length-1],j.pop(),ze.destroy()}}function Ze(ze){P.remove(ze)}function rt(){P.dispose()}return{getParameters:ne,getProgramCacheKey:ee,getUniforms:xe,acquireProgram:st,releaseProgram:Qe,releaseShaderCache:Ze,programs:j,dispose:rt}}function nRe(){let S=new WeakMap;function a(w){let M=S.get(w);return M===void 0&&(M={},S.set(w,M)),M}function d(w){S.delete(w)}function A(w,M,N){S.get(w)[M]=N}function x(){S=new WeakMap}return{get:a,remove:d,update:A,dispose:x}}function sRe(S,a){return S.groupOrder!==a.groupOrder?S.groupOrder-a.groupOrder:S.renderOrder!==a.renderOrder?S.renderOrder-a.renderOrder:S.material.id!==a.material.id?S.material.id-a.material.id:S.z!==a.z?S.z-a.z:S.id-a.id}function GG(S,a){return S.groupOrder!==a.groupOrder?S.groupOrder-a.groupOrder:S.renderOrder!==a.renderOrder?S.renderOrder-a.renderOrder:S.z!==a.z?a.z-S.z:S.id-a.id}function VG(){const S=[];let a=0;const d=[],A=[],x=[];function w(){a=0,d.length=0,A.length=0,x.length=0}function M(Y,X,Z,ie,oe,ne){let ee=S[a];return ee===void 0?(ee={id:Y.id,object:Y,geometry:X,material:Z,groupOrder:ie,renderOrder:Y.renderOrder,z:oe,group:ne},S[a]=ee):(ee.id=Y.id,ee.object=Y,ee.geometry=X,ee.material=Z,ee.groupOrder=ie,ee.renderOrder=Y.renderOrder,ee.z=oe,ee.group=ne),a++,ee}function N(Y,X,Z,ie,oe,ne){const ee=M(Y,X,Z,ie,oe,ne);Z.transmission>0?A.push(ee):Z.transparent===!0?x.push(ee):d.push(ee)}function P(Y,X,Z,ie,oe,ne){const ee=M(Y,X,Z,ie,oe,ne);Z.transmission>0?A.unshift(ee):Z.transparent===!0?x.unshift(ee):d.unshift(ee)}function k(Y,X){d.length>1&&d.sort(Y||sRe),A.length>1&&A.sort(X||GG),x.length>1&&x.sort(X||GG)}function j(){for(let Y=a,X=S.length;Y<X;Y++){const Z=S[Y];if(Z.id===null)break;Z.id=null,Z.object=null,Z.geometry=null,Z.material=null,Z.group=null}}return{opaque:d,transmissive:A,transparent:x,init:w,push:N,unshift:P,finish:j,sort:k}}function aRe(){let S=new WeakMap;function a(A,x){const w=S.get(A);let M;return w===void 0?(M=new VG,S.set(A,[M])):x>=w.length?(M=new VG,w.push(M)):M=w[x],M}function d(){S=new WeakMap}return{get:a,dispose:d}}function oRe(){const S={};return{get:function(a){if(S[a.id]!==void 0)return S[a.id];let d;switch(a.type){case"DirectionalLight":d={direction:new He,color:new lr};break;case"SpotLight":d={position:new He,direction:new He,color:new lr,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":d={position:new He,color:new lr,distance:0,decay:0};break;case"HemisphereLight":d={direction:new He,skyColor:new lr,groundColor:new lr};break;case"RectAreaLight":d={color:new lr,position:new He,halfWidth:new He,halfHeight:new He};break}return S[a.id]=d,d}}}function lRe(){const S={};return{get:function(a){if(S[a.id]!==void 0)return S[a.id];let d;switch(a.type){case"DirectionalLight":d={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new oi};break;case"SpotLight":d={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new oi};break;case"PointLight":d={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new oi,shadowCameraNear:1,shadowCameraFar:1e3};break}return S[a.id]=d,d}}}let cRe=0;function uRe(S,a){return(a.castShadow?2:0)-(S.castShadow?2:0)+(a.map?1:0)-(S.map?1:0)}function hRe(S){const a=new oRe,d=lRe(),A={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let k=0;k<9;k++)A.probe.push(new He);const x=new He,w=new mr,M=new mr;function N(k,j){let Y=0,X=0,Z=0;for(let nt=0;nt<9;nt++)A.probe[nt].set(0,0,0);let ie=0,oe=0,ne=0,ee=0,Me=0,we=0,xe=0,st=0,Qe=0,Ze=0,rt=0;k.sort(uRe);const ze=j===!0?Math.PI:1;for(let nt=0,gt=k.length;nt<gt;nt++){const ft=k[nt],Rt=ft.color,Ut=ft.intensity,fi=ft.distance,Oi=ft.shadow&&ft.shadow.map?ft.shadow.map.texture:null;if(ft.isAmbientLight)Y+=Rt.r*Ut*ze,X+=Rt.g*Ut*ze,Z+=Rt.b*Ut*ze;else if(ft.isLightProbe){for(let zt=0;zt<9;zt++)A.probe[zt].addScaledVector(ft.sh.coefficients[zt],Ut);rt++}else if(ft.isDirectionalLight){const zt=a.get(ft);if(zt.color.copy(ft.color).multiplyScalar(ft.intensity*ze),ft.castShadow){const bi=ft.shadow,Pi=d.get(ft);Pi.shadowBias=bi.bias,Pi.shadowNormalBias=bi.normalBias,Pi.shadowRadius=bi.radius,Pi.shadowMapSize=bi.mapSize,A.directionalShadow[ie]=Pi,A.directionalShadowMap[ie]=Oi,A.directionalShadowMatrix[ie]=ft.shadow.matrix,we++}A.directional[ie]=zt,ie++}else if(ft.isSpotLight){const zt=a.get(ft);zt.position.setFromMatrixPosition(ft.matrixWorld),zt.color.copy(Rt).multiplyScalar(Ut*ze),zt.distance=fi,zt.coneCos=Math.cos(ft.angle),zt.penumbraCos=Math.cos(ft.angle*(1-ft.penumbra)),zt.decay=ft.decay,A.spot[ne]=zt;const bi=ft.shadow;if(ft.map&&(A.spotLightMap[Qe]=ft.map,Qe++,bi.updateMatrices(ft),ft.castShadow&&Ze++),A.spotLightMatrix[ne]=bi.matrix,ft.castShadow){const Pi=d.get(ft);Pi.shadowBias=bi.bias,Pi.shadowNormalBias=bi.normalBias,Pi.shadowRadius=bi.radius,Pi.shadowMapSize=bi.mapSize,A.spotShadow[ne]=Pi,A.spotShadowMap[ne]=Oi,st++}ne++}else if(ft.isRectAreaLight){const zt=a.get(ft);zt.color.copy(Rt).multiplyScalar(Ut),zt.halfWidth.set(ft.width*.5,0,0),zt.halfHeight.set(0,ft.height*.5,0),A.rectArea[ee]=zt,ee++}else if(ft.isPointLight){const zt=a.get(ft);if(zt.color.copy(ft.color).multiplyScalar(ft.intensity*ze),zt.distance=ft.distance,zt.decay=ft.decay,ft.castShadow){const bi=ft.shadow,Pi=d.get(ft);Pi.shadowBias=bi.bias,Pi.shadowNormalBias=bi.normalBias,Pi.shadowRadius=bi.radius,Pi.shadowMapSize=bi.mapSize,Pi.shadowCameraNear=bi.camera.near,Pi.shadowCameraFar=bi.camera.far,A.pointShadow[oe]=Pi,A.pointShadowMap[oe]=Oi,A.pointShadowMatrix[oe]=ft.shadow.matrix,xe++}A.point[oe]=zt,oe++}else if(ft.isHemisphereLight){const zt=a.get(ft);zt.skyColor.copy(ft.color).multiplyScalar(Ut*ze),zt.groundColor.copy(ft.groundColor).multiplyScalar(Ut*ze),A.hemi[Me]=zt,Me++}}ee>0&&(S.has("OES_texture_float_linear")===!0?(A.rectAreaLTC1=qi.LTC_FLOAT_1,A.rectAreaLTC2=qi.LTC_FLOAT_2):(A.rectAreaLTC1=qi.LTC_HALF_1,A.rectAreaLTC2=qi.LTC_HALF_2)),A.ambient[0]=Y,A.ambient[1]=X,A.ambient[2]=Z;const De=A.hash;(De.directionalLength!==ie||De.pointLength!==oe||De.spotLength!==ne||De.rectAreaLength!==ee||De.hemiLength!==Me||De.numDirectionalShadows!==we||De.numPointShadows!==xe||De.numSpotShadows!==st||De.numSpotMaps!==Qe||De.numLightProbes!==rt)&&(A.directional.length=ie,A.spot.length=ne,A.rectArea.length=ee,A.point.length=oe,A.hemi.length=Me,A.directionalShadow.length=we,A.directionalShadowMap.length=we,A.pointShadow.length=xe,A.pointShadowMap.length=xe,A.spotShadow.length=st,A.spotShadowMap.length=st,A.directionalShadowMatrix.length=we,A.pointShadowMatrix.length=xe,A.spotLightMatrix.length=st+Qe-Ze,A.spotLightMap.length=Qe,A.numSpotLightShadowsWithMaps=Ze,A.numLightProbes=rt,De.directionalLength=ie,De.pointLength=oe,De.spotLength=ne,De.rectAreaLength=ee,De.hemiLength=Me,De.numDirectionalShadows=we,De.numPointShadows=xe,De.numSpotShadows=st,De.numSpotMaps=Qe,De.numLightProbes=rt,A.version=cRe++)}function P(k,j){let Y=0,X=0,Z=0,ie=0,oe=0;const ne=j.matrixWorldInverse;for(let ee=0,Me=k.length;ee<Me;ee++){const we=k[ee];if(we.isDirectionalLight){const xe=A.directional[Y];xe.direction.setFromMatrixPosition(we.matrixWorld),x.setFromMatrixPosition(we.target.matrixWorld),xe.direction.sub(x),xe.direction.transformDirection(ne),Y++}else if(we.isSpotLight){const xe=A.spot[Z];xe.position.setFromMatrixPosition(we.matrixWorld),xe.position.applyMatrix4(ne),xe.direction.setFromMatrixPosition(we.matrixWorld),x.setFromMatrixPosition(we.target.matrixWorld),xe.direction.sub(x),xe.direction.transformDirection(ne),Z++}else if(we.isRectAreaLight){const xe=A.rectArea[ie];xe.position.setFromMatrixPosition(we.matrixWorld),xe.position.applyMatrix4(ne),M.identity(),w.copy(we.matrixWorld),w.premultiply(ne),M.extractRotation(w),xe.halfWidth.set(we.width*.5,0,0),xe.halfHeight.set(0,we.height*.5,0),xe.halfWidth.applyMatrix4(M),xe.halfHeight.applyMatrix4(M),ie++}else if(we.isPointLight){const xe=A.point[X];xe.position.setFromMatrixPosition(we.matrixWorld),xe.position.applyMatrix4(ne),X++}else if(we.isHemisphereLight){const xe=A.hemi[oe];xe.direction.setFromMatrixPosition(we.matrixWorld),xe.direction.transformDirection(ne),oe++}}}return{setup:N,setupView:P,state:A}}function HG(S){const a=new hRe(S),d=[],A=[];function x(j){k.camera=j,d.length=0,A.length=0}function w(j){d.push(j)}function M(j){A.push(j)}function N(j){a.setup(d,j)}function P(j){a.setupView(d,j)}const k={lightsArray:d,shadowsArray:A,camera:null,lights:a,transmissionRenderTarget:{}};return{init:x,state:k,setupLights:N,setupLightsView:P,pushLight:w,pushShadow:M}}function dRe(S){let a=new WeakMap;function d(x,w=0){const M=a.get(x);let N;return M===void 0?(N=new HG(S),a.set(x,[N])):w>=M.length?(N=new HG(S),M.push(N)):N=M[w],N}function A(){a=new WeakMap}return{get:d,dispose:A}}class LN extends fo{constructor(a){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=su,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(a)}copy(a){return super.copy(a),this.depthPacking=a.depthPacking,this.map=a.map,this.alphaMap=a.alphaMap,this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this}}class DN extends fo{constructor(a){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(a)}copy(a){return super.copy(a),this.map=a.map,this.alphaMap=a.alphaMap,this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this}}const pRe=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,fRe=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function mRe(S,a,d){let A=new Sv;const x=new oi,w=new oi,M=new Un,N=new LN({depthPacking:au}),P=new DN,k={},j=d.maxTextureSize,Y={[T]:R,[R]:T,[B]:B},X=new Oc({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new oi},radius:{value:4}},vertexShader:pRe,fragmentShader:fRe}),Z=X.clone();Z.defines.HORIZONTAL_PASS=1;const ie=new pn;ie.setAttribute("position",new as(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const oe=new ua(ie,X),ne=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=_;let ee=this.type;this.render=function(Qe,Ze,rt){if(ne.enabled===!1||ne.autoUpdate===!1&&ne.needsUpdate===!1||Qe.length===0)return;const ze=S.getRenderTarget(),De=S.getActiveCubeFace(),nt=S.getActiveMipmapLevel(),gt=S.state;gt.setBlending(I),gt.buffers.color.setClear(1,1,1,1),gt.buffers.depth.setTest(!0),gt.setScissorTest(!1);const ft=ee!==E&&this.type===E,Rt=ee===E&&this.type!==E;for(let Ut=0,fi=Qe.length;Ut<fi;Ut++){const Oi=Qe[Ut],zt=Oi.shadow;if(zt===void 0){console.warn("THREE.WebGLShadowMap:",Oi,"has no shadow.");continue}if(zt.autoUpdate===!1&&zt.needsUpdate===!1)continue;x.copy(zt.mapSize);const bi=zt.getFrameExtents();if(x.multiply(bi),w.copy(zt.mapSize),(x.x>j||x.y>j)&&(x.x>j&&(w.x=Math.floor(j/bi.x),x.x=w.x*bi.x,zt.mapSize.x=w.x),x.y>j&&(w.y=Math.floor(j/bi.y),x.y=w.y*bi.y,zt.mapSize.y=w.y)),zt.map===null||ft===!0||Rt===!0){const Ur=this.type!==E?{minFilter:Lt,magFilter:Lt}:{};zt.map!==null&&zt.map.dispose(),zt.map=new rl(x.x,x.y,Ur),zt.map.texture.name=Oi.name+".shadowMap",zt.camera.updateProjectionMatrix()}S.setRenderTarget(zt.map),S.clear();const Pi=zt.getViewportCount();for(let Ur=0;Ur<Pi;Ur++){const _n=zt.getViewport(Ur);M.set(w.x*_n.x,w.y*_n.y,w.x*_n.z,w.y*_n.w),gt.viewport(M),zt.updateMatrices(Oi,Ur),A=zt.getFrustum(),xe(Ze,rt,zt.camera,Oi,this.type)}zt.isPointLightShadow!==!0&&this.type===E&&Me(zt,rt),zt.needsUpdate=!1}ee=this.type,ne.needsUpdate=!1,S.setRenderTarget(ze,De,nt)};function Me(Qe,Ze){const rt=a.update(oe);X.defines.VSM_SAMPLES!==Qe.blurSamples&&(X.defines.VSM_SAMPLES=Qe.blurSamples,Z.defines.VSM_SAMPLES=Qe.blurSamples,X.needsUpdate=!0,Z.needsUpdate=!0),Qe.mapPass===null&&(Qe.mapPass=new rl(x.x,x.y)),X.uniforms.shadow_pass.value=Qe.map.texture,X.uniforms.resolution.value=Qe.mapSize,X.uniforms.radius.value=Qe.radius,S.setRenderTarget(Qe.mapPass),S.clear(),S.renderBufferDirect(Ze,null,rt,X,oe,null),Z.uniforms.shadow_pass.value=Qe.mapPass.texture,Z.uniforms.resolution.value=Qe.mapSize,Z.uniforms.radius.value=Qe.radius,S.setRenderTarget(Qe.map),S.clear(),S.renderBufferDirect(Ze,null,rt,Z,oe,null)}function we(Qe,Ze,rt,ze){let De=null;const nt=rt.isPointLight===!0?Qe.customDistanceMaterial:Qe.customDepthMaterial;if(nt!==void 0)De=nt;else if(De=rt.isPointLight===!0?P:N,S.localClippingEnabled&&Ze.clipShadows===!0&&Array.isArray(Ze.clippingPlanes)&&Ze.clippingPlanes.length!==0||Ze.displacementMap&&Ze.displacementScale!==0||Ze.alphaMap&&Ze.alphaTest>0||Ze.map&&Ze.alphaTest>0){const gt=De.uuid,ft=Ze.uuid;let Rt=k[gt];Rt===void 0&&(Rt={},k[gt]=Rt);let Ut=Rt[ft];Ut===void 0&&(Ut=De.clone(),Rt[ft]=Ut,Ze.addEventListener("dispose",st)),De=Ut}if(De.visible=Ze.visible,De.wireframe=Ze.wireframe,ze===E?De.side=Ze.shadowSide!==null?Ze.shadowSide:Ze.side:De.side=Ze.shadowSide!==null?Ze.shadowSide:Y[Ze.side],De.alphaMap=Ze.alphaMap,De.alphaTest=Ze.alphaTest,De.map=Ze.map,De.clipShadows=Ze.clipShadows,De.clippingPlanes=Ze.clippingPlanes,De.clipIntersection=Ze.clipIntersection,De.displacementMap=Ze.displacementMap,De.displacementScale=Ze.displacementScale,De.displacementBias=Ze.displacementBias,De.wireframeLinewidth=Ze.wireframeLinewidth,De.linewidth=Ze.linewidth,rt.isPointLight===!0&&De.isMeshDistanceMaterial===!0){const gt=S.properties.get(De);gt.light=rt}return De}function xe(Qe,Ze,rt,ze,De){if(Qe.visible===!1)return;if(Qe.layers.test(Ze.layers)&&(Qe.isMesh||Qe.isLine||Qe.isPoints)&&(Qe.castShadow||Qe.receiveShadow&&De===E)&&(!Qe.frustumCulled||A.intersectsObject(Qe))){Qe.modelViewMatrix.multiplyMatrices(rt.matrixWorldInverse,Qe.matrixWorld);const gt=a.update(Qe),ft=Qe.material;if(Array.isArray(ft)){const Rt=gt.groups;for(let Ut=0,fi=Rt.length;Ut<fi;Ut++){const Oi=Rt[Ut],zt=ft[Oi.materialIndex];if(zt&&zt.visible){const bi=we(Qe,zt,ze,De);Qe.onBeforeShadow(S,Qe,Ze,rt,gt,bi,Oi),S.renderBufferDirect(rt,null,gt,bi,Qe,Oi),Qe.onAfterShadow(S,Qe,Ze,rt,gt,bi,Oi)}}}else if(ft.visible){const Rt=we(Qe,ft,ze,De);Qe.onBeforeShadow(S,Qe,Ze,rt,gt,Rt,null),S.renderBufferDirect(rt,null,gt,Rt,Qe,null),Qe.onAfterShadow(S,Qe,Ze,rt,gt,Rt,null)}}const nt=Qe.children;for(let gt=0,ft=nt.length;gt<ft;gt++)xe(nt[gt],Ze,rt,ze,De)}function st(Qe){Qe.target.removeEventListener("dispose",st);for(const Ze in k){const rt=k[Ze],ze=Qe.target.uuid;ze in rt&&(rt[ze].dispose(),delete rt[ze])}}}function gRe(S){function a(){let ut=!1;const xi=new Un;let Ii=null;const Mr=new Un(0,0,0,0);return{setMask:function(nr){Ii!==nr&&!ut&&(S.colorMask(nr,nr,nr,nr),Ii=nr)},setLocked:function(nr){ut=nr},setClear:function(nr,ln,sr,$i,vn){vn===!0&&(nr*=$i,ln*=$i,sr*=$i),xi.set(nr,ln,sr,$i),Mr.equals(xi)===!1&&(S.clearColor(nr,ln,sr,$i),Mr.copy(xi))},reset:function(){ut=!1,Ii=null,Mr.set(-1,0,0,0)}}}function d(){let ut=!1,xi=null,Ii=null,Mr=null;return{setTest:function(nr){nr?Nn(S.DEPTH_TEST):Cr(S.DEPTH_TEST)},setMask:function(nr){xi!==nr&&!ut&&(S.depthMask(nr),xi=nr)},setFunc:function(nr){if(Ii!==nr){switch(nr){case Ei:S.depthFunc(S.NEVER);break;case $e:S.depthFunc(S.ALWAYS);break;case Ui:S.depthFunc(S.LESS);break;case hi:S.depthFunc(S.LEQUAL);break;case Ri:S.depthFunc(S.EQUAL);break;case Si:S.depthFunc(S.GEQUAL);break;case Zi:S.depthFunc(S.GREATER);break;case Vi:S.depthFunc(S.NOTEQUAL);break;default:S.depthFunc(S.LEQUAL)}Ii=nr}},setLocked:function(nr){ut=nr},setClear:function(nr){Mr!==nr&&(S.clearDepth(nr),Mr=nr)},reset:function(){ut=!1,xi=null,Ii=null,Mr=null}}}function A(){let ut=!1,xi=null,Ii=null,Mr=null,nr=null,ln=null,sr=null,$i=null,vn=null;return{setTest:function(Ir){ut||(Ir?Nn(S.STENCIL_TEST):Cr(S.STENCIL_TEST))},setMask:function(Ir){xi!==Ir&&!ut&&(S.stencilMask(Ir),xi=Ir)},setFunc:function(Ir,Xl,du){(Ii!==Ir||Mr!==Xl||nr!==du)&&(S.stencilFunc(Ir,Xl,du),Ii=Ir,Mr=Xl,nr=du)},setOp:function(Ir,Xl,du){(ln!==Ir||sr!==Xl||$i!==du)&&(S.stencilOp(Ir,Xl,du),ln=Ir,sr=Xl,$i=du)},setLocked:function(Ir){ut=Ir},setClear:function(Ir){vn!==Ir&&(S.clearStencil(Ir),vn=Ir)},reset:function(){ut=!1,xi=null,Ii=null,Mr=null,nr=null,ln=null,sr=null,$i=null,vn=null}}}const x=new a,w=new d,M=new A,N=new WeakMap,P=new WeakMap;let k={},j={},Y=new WeakMap,X=[],Z=null,ie=!1,oe=null,ne=null,ee=null,Me=null,we=null,xe=null,st=null,Qe=new lr(0,0,0),Ze=0,rt=!1,ze=null,De=null,nt=null,gt=null,ft=null;const Rt=S.getParameter(S.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let Ut=!1,fi=0;const Oi=S.getParameter(S.VERSION);Oi.indexOf("WebGL")!==-1?(fi=parseFloat(/^WebGL (\d)/.exec(Oi)[1]),Ut=fi>=1):Oi.indexOf("OpenGL ES")!==-1&&(fi=parseFloat(/^OpenGL ES (\d)/.exec(Oi)[1]),Ut=fi>=2);let zt=null,bi={};const Pi=S.getParameter(S.SCISSOR_BOX),Ur=S.getParameter(S.VIEWPORT),_n=new Un().fromArray(Pi),is=new Un().fromArray(Ur);function ps(ut,xi,Ii,Mr){const nr=new Uint8Array(4),ln=S.createTexture();S.bindTexture(ut,ln),S.texParameteri(ut,S.TEXTURE_MIN_FILTER,S.NEAREST),S.texParameteri(ut,S.TEXTURE_MAG_FILTER,S.NEAREST);for(let sr=0;sr<Ii;sr++)ut===S.TEXTURE_3D||ut===S.TEXTURE_2D_ARRAY?S.texImage3D(xi,0,S.RGBA,1,1,Mr,0,S.RGBA,S.UNSIGNED_BYTE,nr):S.texImage2D(xi+sr,0,S.RGBA,1,1,0,S.RGBA,S.UNSIGNED_BYTE,nr);return ln}const jn={};jn[S.TEXTURE_2D]=ps(S.TEXTURE_2D,S.TEXTURE_2D,1),jn[S.TEXTURE_CUBE_MAP]=ps(S.TEXTURE_CUBE_MAP,S.TEXTURE_CUBE_MAP_POSITIVE_X,6),jn[S.TEXTURE_2D_ARRAY]=ps(S.TEXTURE_2D_ARRAY,S.TEXTURE_2D_ARRAY,1,1),jn[S.TEXTURE_3D]=ps(S.TEXTURE_3D,S.TEXTURE_3D,1,1),x.setClear(0,0,0,1),w.setClear(1),M.setClear(0),Nn(S.DEPTH_TEST),w.setFunc(hi),ci(!1),rr(m),Nn(S.CULL_FACE),ii(I);function Nn(ut){k[ut]!==!0&&(S.enable(ut),k[ut]=!0)}function Cr(ut){k[ut]!==!1&&(S.disable(ut),k[ut]=!1)}function di(ut,xi){return j[ut]!==xi?(S.bindFramebuffer(ut,xi),j[ut]=xi,ut===S.DRAW_FRAMEBUFFER&&(j[S.FRAMEBUFFER]=xi),ut===S.FRAMEBUFFER&&(j[S.DRAW_FRAMEBUFFER]=xi),!0):!1}function Ci(ut,xi){let Ii=X,Mr=!1;if(ut){Ii=Y.get(xi),Ii===void 0&&(Ii=[],Y.set(xi,Ii));const nr=ut.textures;if(Ii.length!==nr.length||Ii[0]!==S.COLOR_ATTACHMENT0){for(let ln=0,sr=nr.length;ln<sr;ln++)Ii[ln]=S.COLOR_ATTACHMENT0+ln;Ii.length=nr.length,Mr=!0}}else Ii[0]!==S.BACK&&(Ii[0]=S.BACK,Mr=!0);Mr&&S.drawBuffers(Ii)}function Xi(ut){return Z!==ut?(S.useProgram(ut),Z=ut,!0):!1}const it={[H]:S.FUNC_ADD,[G]:S.FUNC_SUBTRACT,[J]:S.FUNC_REVERSE_SUBTRACT};it[Q]=S.MIN,it[V]=S.MAX;const gi={[z]:S.ZERO,[te]:S.ONE,[K]:S.SRC_COLOR,[Ae]:S.SRC_ALPHA,[tt]:S.SRC_ALPHA_SATURATE,[Xe]:S.DST_COLOR,[me]:S.DST_ALPHA,[ae]:S.ONE_MINUS_SRC_COLOR,[_e]:S.ONE_MINUS_SRC_ALPHA,[Je]:S.ONE_MINUS_DST_COLOR,[Pe]:S.ONE_MINUS_DST_ALPHA,[dt]:S.CONSTANT_COLOR,[wt]:S.ONE_MINUS_CONSTANT_COLOR,[qt]:S.CONSTANT_ALPHA,[yt]:S.ONE_MINUS_CONSTANT_ALPHA};function ii(ut,xi,Ii,Mr,nr,ln,sr,$i,vn,Ir){if(ut===I){ie===!0&&(Cr(S.BLEND),ie=!1);return}if(ie===!1&&(Nn(S.BLEND),ie=!0),ut!==q){if(ut!==oe||Ir!==rt){if((ne!==H||we!==H)&&(S.blendEquation(S.FUNC_ADD),ne=H,we=H),Ir)switch(ut){case D:S.blendFuncSeparate(S.ONE,S.ONE_MINUS_SRC_ALPHA,S.ONE,S.ONE_MINUS_SRC_ALPHA);break;case L:S.blendFunc(S.ONE,S.ONE);break;case O:S.blendFuncSeparate(S.ZERO,S.ONE_MINUS_SRC_COLOR,S.ZERO,S.ONE);break;case F:S.blendFuncSeparate(S.ZERO,S.SRC_COLOR,S.ZERO,S.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",ut);break}else switch(ut){case D:S.blendFuncSeparate(S.SRC_ALPHA,S.ONE_MINUS_SRC_ALPHA,S.ONE,S.ONE_MINUS_SRC_ALPHA);break;case L:S.blendFunc(S.SRC_ALPHA,S.ONE);break;case O:S.blendFuncSeparate(S.ZERO,S.ONE_MINUS_SRC_COLOR,S.ZERO,S.ONE);break;case F:S.blendFunc(S.ZERO,S.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",ut);break}ee=null,Me=null,xe=null,st=null,Qe.set(0,0,0),Ze=0,oe=ut,rt=Ir}return}nr=nr||xi,ln=ln||Ii,sr=sr||Mr,(xi!==ne||nr!==we)&&(S.blendEquationSeparate(it[xi],it[nr]),ne=xi,we=nr),(Ii!==ee||Mr!==Me||ln!==xe||sr!==st)&&(S.blendFuncSeparate(gi[Ii],gi[Mr],gi[ln],gi[sr]),ee=Ii,Me=Mr,xe=ln,st=sr),($i.equals(Qe)===!1||vn!==Ze)&&(S.blendColor($i.r,$i.g,$i.b,vn),Qe.copy($i),Ze=vn),oe=ut,rt=!1}function tr(ut,xi){ut.side===B?Cr(S.CULL_FACE):Nn(S.CULL_FACE);let Ii=ut.side===R;xi&&(Ii=!Ii),ci(Ii),ut.blending===D&&ut.transparent===!1?ii(I):ii(ut.blending,ut.blendEquation,ut.blendSrc,ut.blendDst,ut.blendEquationAlpha,ut.blendSrcAlpha,ut.blendDstAlpha,ut.blendColor,ut.blendAlpha,ut.premultipliedAlpha),w.setFunc(ut.depthFunc),w.setTest(ut.depthTest),w.setMask(ut.depthWrite),x.setMask(ut.colorWrite);const Mr=ut.stencilWrite;M.setTest(Mr),Mr&&(M.setMask(ut.stencilWriteMask),M.setFunc(ut.stencilFunc,ut.stencilRef,ut.stencilFuncMask),M.setOp(ut.stencilFail,ut.stencilZFail,ut.stencilZPass)),yr(ut.polygonOffset,ut.polygonOffsetFactor,ut.polygonOffsetUnits),ut.alphaToCoverage===!0?Nn(S.SAMPLE_ALPHA_TO_COVERAGE):Cr(S.SAMPLE_ALPHA_TO_COVERAGE)}function ci(ut){ze!==ut&&(ut?S.frontFace(S.CW):S.frontFace(S.CCW),ze=ut)}function rr(ut){ut!==g?(Nn(S.CULL_FACE),ut!==De&&(ut===m?S.cullFace(S.BACK):ut===y?S.cullFace(S.FRONT):S.cullFace(S.FRONT_AND_BACK))):Cr(S.CULL_FACE),De=ut}function ir(ut){ut!==nt&&(Ut&&S.lineWidth(ut),nt=ut)}function yr(ut,xi,Ii){ut?(Nn(S.POLYGON_OFFSET_FILL),(gt!==xi||ft!==Ii)&&(S.polygonOffset(xi,Ii),gt=xi,ft=Ii)):Cr(S.POLYGON_OFFSET_FILL)}function yn(ut){ut?Nn(S.SCISSOR_TEST):Cr(S.SCISSOR_TEST)}function Wr(ut){ut===void 0&&(ut=S.TEXTURE0+Rt-1),zt!==ut&&(S.activeTexture(ut),zt=ut)}function ha(ut,xi,Ii){Ii===void 0&&(zt===null?Ii=S.TEXTURE0+Rt-1:Ii=zt);let Mr=bi[Ii];Mr===void 0&&(Mr={type:void 0,texture:void 0},bi[Ii]=Mr),(Mr.type!==ut||Mr.texture!==xi)&&(zt!==Ii&&(S.activeTexture(Ii),zt=Ii),S.bindTexture(ut,xi||jn[ut]),Mr.type=ut,Mr.texture=xi)}function Xs(){const ut=bi[zt];ut!==void 0&&ut.type!==void 0&&(S.bindTexture(ut.type,null),ut.type=void 0,ut.texture=void 0)}function Wn(){try{S.compressedTexImage2D.apply(S,arguments)}catch(ut){console.error("THREE.WebGLState:",ut)}}function et(){try{S.compressedTexImage3D.apply(S,arguments)}catch(ut){console.error("THREE.WebGLState:",ut)}}function Le(){try{S.texSubImage2D.apply(S,arguments)}catch(ut){console.error("THREE.WebGLState:",ut)}}function jt(){try{S.texSubImage3D.apply(S,arguments)}catch(ut){console.error("THREE.WebGLState:",ut)}}function pi(){try{S.compressedTexSubImage2D.apply(S,arguments)}catch(ut){console.error("THREE.WebGLState:",ut)}}function Ai(){try{S.compressedTexSubImage3D.apply(S,arguments)}catch(ut){console.error("THREE.WebGLState:",ut)}}function li(){try{S.texStorage2D.apply(S,arguments)}catch(ut){console.error("THREE.WebGLState:",ut)}}function Rr(){try{S.texStorage3D.apply(S,arguments)}catch(ut){console.error("THREE.WebGLState:",ut)}}function ji(){try{S.texImage2D.apply(S,arguments)}catch(ut){console.error("THREE.WebGLState:",ut)}}function ur(){try{S.texImage3D.apply(S,arguments)}catch(ut){console.error("THREE.WebGLState:",ut)}}function Qn(ut){_n.equals(ut)===!1&&(S.scissor(ut.x,ut.y,ut.z,ut.w),_n.copy(ut))}function cr(ut){is.equals(ut)===!1&&(S.viewport(ut.x,ut.y,ut.z,ut.w),is.copy(ut))}function Er(ut,xi){let Ii=P.get(xi);Ii===void 0&&(Ii=new WeakMap,P.set(xi,Ii));let Mr=Ii.get(ut);Mr===void 0&&(Mr=S.getUniformBlockIndex(xi,ut.name),Ii.set(ut,Mr))}function En(ut,xi){const Ii=P.get(xi).get(ut);N.get(xi)!==Ii&&(S.uniformBlockBinding(xi,Ii,ut.__bindingPointIndex),N.set(xi,Ii))}function zr(){S.disable(S.BLEND),S.disable(S.CULL_FACE),S.disable(S.DEPTH_TEST),S.disable(S.POLYGON_OFFSET_FILL),S.disable(S.SCISSOR_TEST),S.disable(S.STENCIL_TEST),S.disable(S.SAMPLE_ALPHA_TO_COVERAGE),S.blendEquation(S.FUNC_ADD),S.blendFunc(S.ONE,S.ZERO),S.blendFuncSeparate(S.ONE,S.ZERO,S.ONE,S.ZERO),S.blendColor(0,0,0,0),S.colorMask(!0,!0,!0,!0),S.clearColor(0,0,0,0),S.depthMask(!0),S.depthFunc(S.LESS),S.clearDepth(1),S.stencilMask(4294967295),S.stencilFunc(S.ALWAYS,0,4294967295),S.stencilOp(S.KEEP,S.KEEP,S.KEEP),S.clearStencil(0),S.cullFace(S.BACK),S.frontFace(S.CCW),S.polygonOffset(0,0),S.activeTexture(S.TEXTURE0),S.bindFramebuffer(S.FRAMEBUFFER,null),S.bindFramebuffer(S.DRAW_FRAMEBUFFER,null),S.bindFramebuffer(S.READ_FRAMEBUFFER,null),S.useProgram(null),S.lineWidth(1),S.scissor(0,0,S.canvas.width,S.canvas.height),S.viewport(0,0,S.canvas.width,S.canvas.height),k={},zt=null,bi={},j={},Y=new WeakMap,X=[],Z=null,ie=!1,oe=null,ne=null,ee=null,Me=null,we=null,xe=null,st=null,Qe=new lr(0,0,0),Ze=0,rt=!1,ze=null,De=null,nt=null,gt=null,ft=null,_n.set(0,0,S.canvas.width,S.canvas.height),is.set(0,0,S.canvas.width,S.canvas.height),x.reset(),w.reset(),M.reset()}return{buffers:{color:x,depth:w,stencil:M},enable:Nn,disable:Cr,bindFramebuffer:di,drawBuffers:Ci,useProgram:Xi,setBlending:ii,setMaterial:tr,setFlipSided:ci,setCullFace:rr,setLineWidth:ir,setPolygonOffset:yr,setScissorTest:yn,activeTexture:Wr,bindTexture:ha,unbindTexture:Xs,compressedTexImage2D:Wn,compressedTexImage3D:et,texImage2D:ji,texImage3D:ur,updateUBOMapping:Er,uniformBlockBinding:En,texStorage2D:li,texStorage3D:Rr,texSubImage2D:Le,texSubImage3D:jt,compressedTexSubImage2D:pi,compressedTexSubImage3D:Ai,scissor:Qn,viewport:cr,reset:zr}}function ARe(S,a,d,A,x,w,M){const N=a.has("WEBGL_multisampled_render_to_texture")?a.get("WEBGL_multisampled_render_to_texture"):null,P=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),k=a.has("OCULUS_multiview")?a.get("OCULUS_multiview"):null,j=new oi,Y=new WeakMap;let X;const Z=new WeakMap;let ie=[],oe=!1,ne=!1;try{ne=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function ee(et,Le){return ne?new OffscreenCanvas(et,Le):vf("canvas")}function Me(et,Le,jt){let pi=1;const Ai=Wn(et);if((Ai.width>jt||Ai.height>jt)&&(pi=jt/Math.max(Ai.width,Ai.height)),pi<1)if(typeof HTMLImageElement<"u"&&et instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&et instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&et instanceof ImageBitmap||typeof VideoFrame<"u"&&et instanceof VideoFrame){const li=Math.floor(pi*Ai.width),Rr=Math.floor(pi*Ai.height);X===void 0&&(X=ee(li,Rr));const ji=Le?ee(li,Rr):X;return ji.width=li,ji.height=Rr,ji.getContext("2d").drawImage(et,0,0,li,Rr),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Ai.width+"x"+Ai.height+") to ("+li+"x"+Rr+")."),ji}else return"data"in et&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Ai.width+"x"+Ai.height+")."),et;return et}function we(et){return et.generateMipmaps&&et.minFilter!==Lt&&et.minFilter!==Fi}function xe(et){S.generateMipmap(et)}function st(et,Le,jt,pi,Ai=!1){if(et!==null){if(S[et]!==void 0)return S[et];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+et+"'")}let li=Le;if(Le===S.RED&&(jt===S.FLOAT&&(li=S.R32F),jt===S.HALF_FLOAT&&(li=S.R16F),jt===S.UNSIGNED_BYTE&&(li=S.R8)),Le===S.RED_INTEGER&&(jt===S.UNSIGNED_BYTE&&(li=S.R8UI),jt===S.UNSIGNED_SHORT&&(li=S.R16UI),jt===S.UNSIGNED_INT&&(li=S.R32UI),jt===S.BYTE&&(li=S.R8I),jt===S.SHORT&&(li=S.R16I),jt===S.INT&&(li=S.R32I)),Le===S.RG&&(jt===S.FLOAT&&(li=S.RG32F),jt===S.HALF_FLOAT&&(li=S.RG16F),jt===S.UNSIGNED_BYTE&&(li=S.RG8)),Le===S.RG_INTEGER&&(jt===S.UNSIGNED_BYTE&&(li=S.RG8UI),jt===S.UNSIGNED_SHORT&&(li=S.RG16UI),jt===S.UNSIGNED_INT&&(li=S.RG32UI),jt===S.BYTE&&(li=S.RG8I),jt===S.SHORT&&(li=S.RG16I),jt===S.INT&&(li=S.RG32I)),Le===S.RGB&&jt===S.UNSIGNED_INT_5_9_9_9_REV&&(li=S.RGB9_E5),Le===S.RGBA){const Rr=Ai?pf:Yn.getTransfer(pi);jt===S.FLOAT&&(li=S.RGBA32F),jt===S.HALF_FLOAT&&(li=S.RGBA16F),jt===S.UNSIGNED_BYTE&&(li=Rr===cs?S.SRGB8_ALPHA8:S.RGBA8),jt===S.UNSIGNED_SHORT_4_4_4_4&&(li=S.RGBA4),jt===S.UNSIGNED_SHORT_5_5_5_1&&(li=S.RGB5_A1)}return(li===S.R16F||li===S.R32F||li===S.RG16F||li===S.RG32F||li===S.RGBA16F||li===S.RGBA32F)&&a.get("EXT_color_buffer_float"),li}function Qe(et,Le){return we(et)===!0||et.isFramebufferTexture&&et.minFilter!==Lt&&et.minFilter!==Fi?Math.log2(Math.max(Le.width,Le.height))+1:et.mipmaps!==void 0&&et.mipmaps.length>0?et.mipmaps.length:et.isCompressedTexture&&Array.isArray(et.image)?Le.mipmaps.length:1}function Ze(et){const Le=et.target;Le.removeEventListener("dispose",Ze),ze(Le),Le.isVideoTexture&&Y.delete(Le)}function rt(et){const Le=et.target;Le.removeEventListener("dispose",rt),nt(Le)}function ze(et){const Le=A.get(et);if(Le.__webglInit===void 0)return;const jt=et.source,pi=Z.get(jt);if(pi){const Ai=pi[Le.__cacheKey];Ai.usedTimes--,Ai.usedTimes===0&&De(et),Object.keys(pi).length===0&&Z.delete(jt)}A.remove(et)}function De(et){const Le=A.get(et);S.deleteTexture(Le.__webglTexture);const jt=et.source,pi=Z.get(jt);delete pi[Le.__cacheKey],M.memory.textures--}function nt(et){const Le=A.get(et);if(et.depthTexture&&et.depthTexture.dispose(),et.isWebGLCubeRenderTarget)for(let pi=0;pi<6;pi++){if(Array.isArray(Le.__webglFramebuffer[pi]))for(let Ai=0;Ai<Le.__webglFramebuffer[pi].length;Ai++)S.deleteFramebuffer(Le.__webglFramebuffer[pi][Ai]);else S.deleteFramebuffer(Le.__webglFramebuffer[pi]);Le.__webglDepthbuffer&&S.deleteRenderbuffer(Le.__webglDepthbuffer[pi])}else{if(Array.isArray(Le.__webglFramebuffer))for(let pi=0;pi<Le.__webglFramebuffer.length;pi++)S.deleteFramebuffer(Le.__webglFramebuffer[pi]);else S.deleteFramebuffer(Le.__webglFramebuffer);if(Le.__webglDepthbuffer&&S.deleteRenderbuffer(Le.__webglDepthbuffer),Le.__webglMultisampledFramebuffer&&S.deleteFramebuffer(Le.__webglMultisampledFramebuffer),Le.__webglColorRenderbuffer)for(let pi=0;pi<Le.__webglColorRenderbuffer.length;pi++)Le.__webglColorRenderbuffer[pi]&&S.deleteRenderbuffer(Le.__webglColorRenderbuffer[pi]);Le.__webglDepthRenderbuffer&&S.deleteRenderbuffer(Le.__webglDepthRenderbuffer)}const jt=et.textures;for(let pi=0,Ai=jt.length;pi<Ai;pi++){const li=A.get(jt[pi]);li.__webglTexture&&(S.deleteTexture(li.__webglTexture),M.memory.textures--),A.remove(jt[pi])}A.remove(et)}let gt=0;function ft(){gt=0}function Rt(){const et=gt;return et>=x.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+et+" texture units while this GPU supports only "+x.maxTextures),gt+=1,et}function Ut(et){const Le=[];return Le.push(et.wrapS),Le.push(et.wrapT),Le.push(et.wrapR||0),Le.push(et.magFilter),Le.push(et.minFilter),Le.push(et.anisotropy),Le.push(et.internalFormat),Le.push(et.format),Le.push(et.type),Le.push(et.generateMipmaps),Le.push(et.premultiplyAlpha),Le.push(et.flipY),Le.push(et.unpackAlignment),Le.push(et.colorSpace),Le.join()}function fi(et,Le){const jt=A.get(et);if(et.isVideoTexture&&ha(et),et.isRenderTargetTexture===!1&&et.version>0&&jt.__version!==et.version){const pi=et.image;if(pi===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(pi.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else if(Cr(jt,et,Le))return}d.bindTexture(S.TEXTURE_2D,jt.__webglTexture,S.TEXTURE0+Le)}function Oi(et,Le){const jt=A.get(et);if(et.version>0&&jt.__version!==et.version){Cr(jt,et,Le);return}d.bindTexture(S.TEXTURE_2D_ARRAY,jt.__webglTexture,S.TEXTURE0+Le)}function zt(et,Le){const jt=A.get(et);if(et.version>0&&jt.__version!==et.version){Cr(jt,et,Le);return}d.bindTexture(S.TEXTURE_3D,jt.__webglTexture,S.TEXTURE0+Le)}function bi(et,Le){const jt=A.get(et);if(et.version>0&&jt.__version!==et.version){di(jt,et,Le);return}d.bindTexture(S.TEXTURE_CUBE_MAP,jt.__webglTexture,S.TEXTURE0+Le)}const Pi={[Ue]:S.REPEAT,[je]:S.CLAMP_TO_EDGE,[pt]:S.MIRRORED_REPEAT},Ur={[Lt]:S.NEAREST,[xt]:S.NEAREST_MIPMAP_NEAREST,[mi]:S.NEAREST_MIPMAP_LINEAR,[Fi]:S.LINEAR,[gn]:S.LINEAR_MIPMAP_NEAREST,[nn]:S.LINEAR_MIPMAP_LINEAR},_n={[BE]:S.NEVER,[kE]:S.ALWAYS,[NE]:S.LESS,[mv]:S.LEQUAL,[LE]:S.EQUAL,[PE]:S.GEQUAL,[DE]:S.GREATER,[OE]:S.NOTEQUAL};function is(et,Le){if(Le.type===Tt&&a.has("OES_texture_float_linear")===!1&&(Le.magFilter===Fi||Le.magFilter===gn||Le.magFilter===mi||Le.magFilter===nn||Le.minFilter===Fi||Le.minFilter===gn||Le.minFilter===mi||Le.minFilter===nn)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),S.texParameteri(et,S.TEXTURE_WRAP_S,Pi[Le.wrapS]),S.texParameteri(et,S.TEXTURE_WRAP_T,Pi[Le.wrapT]),(et===S.TEXTURE_3D||et===S.TEXTURE_2D_ARRAY)&&S.texParameteri(et,S.TEXTURE_WRAP_R,Pi[Le.wrapR]),S.texParameteri(et,S.TEXTURE_MAG_FILTER,Ur[Le.magFilter]),S.texParameteri(et,S.TEXTURE_MIN_FILTER,Ur[Le.minFilter]),Le.compareFunction&&(S.texParameteri(et,S.TEXTURE_COMPARE_MODE,S.COMPARE_REF_TO_TEXTURE),S.texParameteri(et,S.TEXTURE_COMPARE_FUNC,_n[Le.compareFunction])),a.has("EXT_texture_filter_anisotropic")===!0){if(Le.magFilter===Lt||Le.minFilter!==mi&&Le.minFilter!==nn||Le.type===Tt&&a.has("OES_texture_float_linear")===!1)return;if(Le.anisotropy>1||A.get(Le).__currentAnisotropy){const jt=a.get("EXT_texture_filter_anisotropic");S.texParameterf(et,jt.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Le.anisotropy,x.getMaxAnisotropy())),A.get(Le).__currentAnisotropy=Le.anisotropy}}}function ps(et,Le){let jt=!1;et.__webglInit===void 0&&(et.__webglInit=!0,Le.addEventListener("dispose",Ze));const pi=Le.source;let Ai=Z.get(pi);Ai===void 0&&(Ai={},Z.set(pi,Ai));const li=Ut(Le);if(li!==et.__cacheKey){Ai[li]===void 0&&(Ai[li]={texture:S.createTexture(),usedTimes:0},M.memory.textures++,jt=!0),Ai[li].usedTimes++;const Rr=Ai[et.__cacheKey];Rr!==void 0&&(Ai[et.__cacheKey].usedTimes--,Rr.usedTimes===0&&De(Le)),et.__cacheKey=li,et.__webglTexture=Ai[li].texture}return jt}function jn(et){oe=et}function Nn(){const et=oe;oe=!1;for(const Le of ie)Cr(Le.textureProperties,Le.texture,Le.slot),Le.texture.isPendingDeferredUpload=!1;ie=[],oe=et}function Cr(et,Le,jt){if(oe)return Le.isPendingDeferredUpload||(Le.isPendingDeferredUpload=!0,ie.push({textureProperties:et,texture:Le,slot:jt})),!1;let pi=S.TEXTURE_2D;(Le.isDataArrayTexture||Le.isCompressedArrayTexture)&&(pi=S.TEXTURE_2D_ARRAY),Le.isData3DTexture&&(pi=S.TEXTURE_3D);const Ai=ps(et,Le),li=Le.source;d.bindTexture(pi,et.__webglTexture,S.TEXTURE0+jt);const Rr=A.get(li);if(li.version!==Rr.__version||Ai===!0){d.activeTexture(S.TEXTURE0+jt);const ji=Yn.getPrimaries(Yn.workingColorSpace),ur=Le.colorSpace===Xa?null:Yn.getPrimaries(Le.colorSpace),Qn=Le.colorSpace===Xa||ji===ur?S.NONE:S.BROWSER_DEFAULT_WEBGL;S.pixelStorei(S.UNPACK_FLIP_Y_WEBGL,Le.flipY),S.pixelStorei(S.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Le.premultiplyAlpha),S.pixelStorei(S.UNPACK_ALIGNMENT,Le.unpackAlignment),S.pixelStorei(S.UNPACK_COLORSPACE_CONVERSION_WEBGL,Qn);let cr=Me(Le.image,!1,x.maxTextureSize);cr=Xs(Le,cr);const Er=w.convert(Le.format,Le.colorSpace),En=w.convert(Le.type);let zr=st(Le.internalFormat,Er,En,Le.colorSpace,Le.isVideoTexture);is(pi,Le);let ut;const xi=Le.mipmaps,Ii=Le.isVideoTexture!==!0,Mr=Rr.__version===void 0||Ai===!0,nr=li.dataReady,ln=Qe(Le,cr);if(Le.isDepthTexture)zr=S.DEPTH_COMPONENT16,Le.type===Tt?zr=S.DEPTH_COMPONENT32F:Le.type===ct?zr=S.DEPTH_COMPONENT24:Le.type===Di&&(zr=S.DEPTH24_STENCIL8),Mr&&(Ii?d.texStorage2D(S.TEXTURE_2D,1,zr,cr.width,cr.height):d.texImage2D(S.TEXTURE_2D,0,zr,cr.width,cr.height,0,Er,En,null));else if(Le.isDataTexture)if(xi.length>0){Ii&&Mr&&d.texStorage2D(S.TEXTURE_2D,ln,zr,xi[0].width,xi[0].height);for(let sr=0,$i=xi.length;sr<$i;sr++)ut=xi[sr],Ii?nr&&d.texSubImage2D(S.TEXTURE_2D,sr,0,0,ut.width,ut.height,Er,En,ut.data):d.texImage2D(S.TEXTURE_2D,sr,zr,ut.width,ut.height,0,Er,En,ut.data);Le.generateMipmaps=!1}else Ii?(Mr&&d.texStorage2D(S.TEXTURE_2D,ln,zr,cr.width,cr.height),nr&&d.texSubImage2D(S.TEXTURE_2D,0,0,0,cr.width,cr.height,Er,En,cr.data)):d.texImage2D(S.TEXTURE_2D,0,zr,cr.width,cr.height,0,Er,En,cr.data);else if(Le.isCompressedTexture)if(Le.isCompressedArrayTexture){Ii&&Mr&&d.texStorage3D(S.TEXTURE_2D_ARRAY,ln,zr,xi[0].width,xi[0].height,cr.depth);for(let sr=0,$i=xi.length;sr<$i;sr++)ut=xi[sr],Le.format!==fe?Er!==null?Ii?nr&&d.compressedTexSubImage3D(S.TEXTURE_2D_ARRAY,sr,0,0,0,ut.width,ut.height,cr.depth,Er,ut.data,0,0):d.compressedTexImage3D(S.TEXTURE_2D_ARRAY,sr,zr,ut.width,ut.height,cr.depth,0,ut.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ii?nr&&d.texSubImage3D(S.TEXTURE_2D_ARRAY,sr,0,0,0,ut.width,ut.height,cr.depth,Er,En,ut.data):d.texImage3D(S.TEXTURE_2D_ARRAY,sr,zr,ut.width,ut.height,cr.depth,0,Er,En,ut.data)}else{Ii&&Mr&&d.texStorage2D(S.TEXTURE_2D,ln,zr,xi[0].width,xi[0].height);for(let sr=0,$i=xi.length;sr<$i;sr++)ut=xi[sr],Le.format!==fe?Er!==null?Ii?nr&&d.compressedTexSubImage2D(S.TEXTURE_2D,sr,0,0,ut.width,ut.height,Er,ut.data):d.compressedTexImage2D(S.TEXTURE_2D,sr,zr,ut.width,ut.height,0,ut.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ii?nr&&d.texSubImage2D(S.TEXTURE_2D,sr,0,0,ut.width,ut.height,Er,En,ut.data):d.texImage2D(S.TEXTURE_2D,sr,zr,ut.width,ut.height,0,Er,En,ut.data)}else if(Le.isDataArrayTexture)Ii?(Mr&&d.texStorage3D(S.TEXTURE_2D_ARRAY,ln,zr,cr.width,cr.height,cr.depth),nr&&d.texSubImage3D(S.TEXTURE_2D_ARRAY,0,0,0,0,cr.width,cr.height,cr.depth,Er,En,cr.data)):d.texImage3D(S.TEXTURE_2D_ARRAY,0,zr,cr.width,cr.height,cr.depth,0,Er,En,cr.data);else if(Le.isData3DTexture)Ii?(Mr&&d.texStorage3D(S.TEXTURE_3D,ln,zr,cr.width,cr.height,cr.depth),nr&&d.texSubImage3D(S.TEXTURE_3D,0,0,0,0,cr.width,cr.height,cr.depth,Er,En,cr.data)):d.texImage3D(S.TEXTURE_3D,0,zr,cr.width,cr.height,cr.depth,0,Er,En,cr.data);else if(Le.isFramebufferTexture){if(Mr)if(Ii)d.texStorage2D(S.TEXTURE_2D,ln,zr,cr.width,cr.height);else{let sr=cr.width,$i=cr.height;for(let vn=0;vn<ln;vn++)d.texImage2D(S.TEXTURE_2D,vn,zr,sr,$i,0,Er,En,null),sr>>=1,$i>>=1}}else if(xi.length>0){if(Ii&&Mr){const sr=Wn(xi[0]);d.texStorage2D(S.TEXTURE_2D,ln,zr,sr.width,sr.height)}for(let sr=0,$i=xi.length;sr<$i;sr++)ut=xi[sr],Ii?nr&&d.texSubImage2D(S.TEXTURE_2D,sr,0,0,Er,En,ut):d.texImage2D(S.TEXTURE_2D,sr,zr,Er,En,ut);Le.generateMipmaps=!1}else if(Ii){if(Mr){const sr=Wn(cr);d.texStorage2D(S.TEXTURE_2D,ln,zr,sr.width,sr.height)}nr&&d.texSubImage2D(S.TEXTURE_2D,0,0,0,Er,En,cr)}else d.texImage2D(S.TEXTURE_2D,0,zr,Er,En,cr);we(Le)&&xe(pi),Rr.__version=li.version,Le.onUpdate&&Le.onUpdate(Le)}return et.__version=Le.version,!0}function di(et,Le,jt){if(Le.image.length!==6)return;const pi=ps(et,Le),Ai=Le.source;d.bindTexture(S.TEXTURE_CUBE_MAP,et.__webglTexture,S.TEXTURE0+jt);const li=A.get(Ai);if(Ai.version!==li.__version||pi===!0){d.activeTexture(S.TEXTURE0+jt);const Rr=Yn.getPrimaries(Yn.workingColorSpace),ji=Le.colorSpace===Xa?null:Yn.getPrimaries(Le.colorSpace),ur=Le.colorSpace===Xa||Rr===ji?S.NONE:S.BROWSER_DEFAULT_WEBGL;S.pixelStorei(S.UNPACK_FLIP_Y_WEBGL,Le.flipY),S.pixelStorei(S.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Le.premultiplyAlpha),S.pixelStorei(S.UNPACK_ALIGNMENT,Le.unpackAlignment),S.pixelStorei(S.UNPACK_COLORSPACE_CONVERSION_WEBGL,ur);const Qn=Le.isCompressedTexture||Le.image[0].isCompressedTexture,cr=Le.image[0]&&Le.image[0].isDataTexture,Er=[];for(let $i=0;$i<6;$i++)!Qn&&!cr?Er[$i]=Me(Le.image[$i],!0,x.maxCubemapSize):Er[$i]=cr?Le.image[$i].image:Le.image[$i],Er[$i]=Xs(Le,Er[$i]);const En=Er[0],zr=w.convert(Le.format,Le.colorSpace),ut=w.convert(Le.type),xi=st(Le.internalFormat,zr,ut,Le.colorSpace),Ii=Le.isVideoTexture!==!0,Mr=li.__version===void 0||pi===!0,nr=Ai.dataReady;let ln=Qe(Le,En);is(S.TEXTURE_CUBE_MAP,Le);let sr;if(Qn){Ii&&Mr&&d.texStorage2D(S.TEXTURE_CUBE_MAP,ln,xi,En.width,En.height);for(let $i=0;$i<6;$i++){sr=Er[$i].mipmaps;for(let vn=0;vn<sr.length;vn++){const Ir=sr[vn];Le.format!==fe?zr!==null?Ii?nr&&d.compressedTexSubImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+$i,vn,0,0,Ir.width,Ir.height,zr,Ir.data):d.compressedTexImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+$i,vn,xi,Ir.width,Ir.height,0,Ir.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Ii?nr&&d.texSubImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+$i,vn,0,0,Ir.width,Ir.height,zr,ut,Ir.data):d.texImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+$i,vn,xi,Ir.width,Ir.height,0,zr,ut,Ir.data)}}}else{if(sr=Le.mipmaps,Ii&&Mr){sr.length>0&&ln++;const $i=Wn(Er[0]);d.texStorage2D(S.TEXTURE_CUBE_MAP,ln,xi,$i.width,$i.height)}for(let $i=0;$i<6;$i++)if(cr){Ii?nr&&d.texSubImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+$i,0,0,0,Er[$i].width,Er[$i].height,zr,ut,Er[$i].data):d.texImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+$i,0,xi,Er[$i].width,Er[$i].height,0,zr,ut,Er[$i].data);for(let vn=0;vn<sr.length;vn++){const Ir=sr[vn].image[$i].image;Ii?nr&&d.texSubImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+$i,vn+1,0,0,Ir.width,Ir.height,zr,ut,Ir.data):d.texImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+$i,vn+1,xi,Ir.width,Ir.height,0,zr,ut,Ir.data)}}else{Ii?nr&&d.texSubImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+$i,0,0,0,zr,ut,Er[$i]):d.texImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+$i,0,xi,zr,ut,Er[$i]);for(let vn=0;vn<sr.length;vn++){const Ir=sr[vn];Ii?nr&&d.texSubImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+$i,vn+1,0,0,zr,ut,Ir.image[$i]):d.texImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+$i,vn+1,xi,zr,ut,Ir.image[$i])}}}we(Le)&&xe(S.TEXTURE_CUBE_MAP),li.__version=Ai.version,Le.onUpdate&&Le.onUpdate(Le)}et.__version=Le.version}function Ci(et,Le,jt,pi,Ai,li){const Rr=w.convert(jt.format,jt.colorSpace),ji=w.convert(jt.type),ur=st(jt.internalFormat,Rr,ji,jt.colorSpace);if(!A.get(Le).__hasExternalTextures){const cr=Math.max(1,Le.width>>li),Er=Math.max(1,Le.height>>li);Le.isWebGLMultiviewRenderTarget===!0?d.texStorage3D(S.TEXTURE_2D_ARRAY,0,ur,Le.width,Le.height,Le.numViews):Ai===S.TEXTURE_3D||Ai===S.TEXTURE_2D_ARRAY?d.texImage3D(Ai,li,ur,cr,Er,Le.depth,0,Rr,ji,null):d.texImage2D(Ai,li,ur,cr,Er,0,Rr,ji,null)}d.bindFramebuffer(S.FRAMEBUFFER,et);const Qn=Wr(Le);Le.isWebGLMultiviewRenderTarget===!0?Qn?k.framebufferTextureMultisampleMultiviewOVR(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,A.get(jt).__webglTexture,0,yn(Le),0,Le.numViews):k.framebufferTextureMultiviewOVR(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,A.get(jt).__webglTexture,0,0,Le.numViews):(Ai===S.TEXTURE_2D||Ai>=S.TEXTURE_CUBE_MAP_POSITIVE_X&&Ai<=S.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&(Qn?N.framebufferTexture2DMultisampleEXT(S.FRAMEBUFFER,pi,Ai,A.get(jt).__webglTexture,0,yn(Le)):S.framebufferTexture2D(S.FRAMEBUFFER,pi,Ai,A.get(jt).__webglTexture,li)),d.bindFramebuffer(S.FRAMEBUFFER,null)}function Xi(et,Le,jt){if(S.bindRenderbuffer(S.RENDERBUFFER,et),Le.isWebGLMultiviewRenderTarget===!0){const pi=Wr(Le),Ai=Le.numViews,li=Le.depthTexture;let Rr=S.DEPTH_COMPONENT24,ji=S.DEPTH_ATTACHMENT;li&&li.isDepthTexture&&(li.type===Tt?Rr=S.DEPTH_COMPONENT32F:li.type===Di&&(Rr=S.DEPTH24_STENCIL8,ji=S.DEPTH_STENCIL_ATTACHMENT));let ur=A.get(Le.depthTexture).__webglTexture;ur===void 0&&(ur=S.createTexture(),S.bindTexture(S.TEXTURE_2D_ARRAY,ur),S.texStorage3D(S.TEXTURE_2D_ARRAY,1,Rr,Le.width,Le.height,Ai)),pi?k.framebufferTextureMultisampleMultiviewOVR(S.FRAMEBUFFER,ji,ur,0,yn(Le),0,Ai):k.framebufferTextureMultiviewOVR(S.FRAMEBUFFER,ji,ur,0,0,Ai)}else if(Le.depthBuffer&&!Le.stencilBuffer){let pi=S.DEPTH_COMPONENT24;if(jt||Wr(Le)){const Ai=Le.depthTexture;Ai&&Ai.isDepthTexture&&(Ai.type===Tt?pi=S.DEPTH_COMPONENT32F:Ai.type===ct&&(pi=S.DEPTH_COMPONENT24));const li=yn(Le);Wr(Le)?N.renderbufferStorageMultisampleEXT(S.RENDERBUFFER,li,pi,Le.width,Le.height):S.renderbufferStorageMultisample(S.RENDERBUFFER,li,pi,Le.width,Le.height)}else S.renderbufferStorage(S.RENDERBUFFER,pi,Le.width,Le.height);S.framebufferRenderbuffer(S.FRAMEBUFFER,S.DEPTH_ATTACHMENT,S.RENDERBUFFER,et)}else if(Le.depthBuffer&&Le.stencilBuffer){const pi=yn(Le);jt&&Wr(Le)===!1?S.renderbufferStorageMultisample(S.RENDERBUFFER,pi,S.DEPTH24_STENCIL8,Le.width,Le.height):Wr(Le)?N.renderbufferStorageMultisampleEXT(S.RENDERBUFFER,pi,S.DEPTH24_STENCIL8,Le.width,Le.height):S.renderbufferStorage(S.RENDERBUFFER,S.DEPTH_STENCIL,Le.width,Le.height),S.framebufferRenderbuffer(S.FRAMEBUFFER,S.DEPTH_STENCIL_ATTACHMENT,S.RENDERBUFFER,et)}else{const pi=Le.textures;for(let Ai=0;Ai<pi.length;Ai++){const li=pi[Ai],Rr=w.convert(li.format,li.colorSpace),ji=w.convert(li.type),ur=st(li.internalFormat,Rr,ji,li.colorSpace),Qn=yn(Le);jt&&Wr(Le)===!1?S.renderbufferStorageMultisample(S.RENDERBUFFER,Qn,ur,Le.width,Le.height):Wr(Le)?N.renderbufferStorageMultisampleEXT(S.RENDERBUFFER,Qn,ur,Le.width,Le.height):S.renderbufferStorage(S.RENDERBUFFER,ur,Le.width,Le.height)}}S.bindRenderbuffer(S.RENDERBUFFER,null)}function it(et,Le){if(Le&&Le.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(d.bindFramebuffer(S.FRAMEBUFFER,et),!(Le.depthTexture&&Le.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!A.get(Le.depthTexture).__webglTexture||Le.depthTexture.image.width!==Le.width||Le.depthTexture.image.height!==Le.height)&&(Le.depthTexture.image.width=Le.width,Le.depthTexture.image.height=Le.height,Le.depthTexture.needsUpdate=!0),fi(Le.depthTexture,0),Le.depthTexture.image.depth!=1?Oi(Le.depthTexture,0):fi(Le.depthTexture,0);const jt=A.get(Le.depthTexture).__webglTexture,pi=yn(Le);if(Le.isWebGLMultiviewRenderTarget===!0){const Ai=Wr(Le),li=Le.numViews;if(Le.depthTexture.format===Ye)Ai?k.framebufferTextureMultisampleMultiviewOVR(S.FRAMEBUFFER,S.DEPTH_ATTACHMENT,jt,0,pi,0,li):k.framebufferTextureMultiviewOVR(S.FRAMEBUFFER,S.DEPTH_ATTACHMENT,jt,0,0,li);else if(Le.depthTexture.format===lt)Ai?k.framebufferTextureMultisampleMultiviewOVR(S.FRAMEBUFFER,S.DEPTH_STENCIL_ATTACHMENT,jt,0,pi,0,li):k.framebufferTextureMultiviewOVR(S.FRAMEBUFFER,S.DEPTH_STENCIL_ATTACHMENT,jt,0,0,li);else throw new Error("Unknown depthTexture format")}else if(Le.depthTexture.format===Ye)Wr(Le)?N.framebufferTexture2DMultisampleEXT(S.FRAMEBUFFER,S.DEPTH_ATTACHMENT,S.TEXTURE_2D,jt,0,pi):S.framebufferTexture2D(S.FRAMEBUFFER,S.DEPTH_ATTACHMENT,S.TEXTURE_2D,jt,0);else if(Le.depthTexture.format===lt)Wr(Le)?N.framebufferTexture2DMultisampleEXT(S.FRAMEBUFFER,S.DEPTH_STENCIL_ATTACHMENT,S.TEXTURE_2D,jt,0,pi):S.framebufferTexture2D(S.FRAMEBUFFER,S.DEPTH_STENCIL_ATTACHMENT,S.TEXTURE_2D,jt,0);else throw new Error("Unknown depthTexture format")}function gi(et){const Le=A.get(et),jt=et.isWebGLCubeRenderTarget===!0;if(et.depthTexture&&!Le.__autoAllocateDepthBuffer){if(jt)throw new Error("target.depthTexture not supported in Cube render targets");it(Le.__webglFramebuffer,et)}else if(jt){Le.__webglDepthbuffer=[];for(let pi=0;pi<6;pi++)d.bindFramebuffer(S.FRAMEBUFFER,Le.__webglFramebuffer[pi]),Le.__webglDepthbuffer[pi]=S.createRenderbuffer(),Xi(Le.__webglDepthbuffer[pi],et,!1)}else d.bindFramebuffer(S.FRAMEBUFFER,Le.__webglFramebuffer),Le.__webglDepthbuffer=S.createRenderbuffer(),Xi(Le.__webglDepthbuffer,et,!1);d.bindFramebuffer(S.FRAMEBUFFER,null)}function ii(et,Le,jt){const pi=A.get(et);Le!==void 0&&Ci(pi.__webglFramebuffer,et,et.texture,S.COLOR_ATTACHMENT0,S.TEXTURE_2D,0),jt!==void 0&&gi(et)}function tr(et){const Le=et.texture,jt=A.get(et),pi=A.get(Le);et.addEventListener("dispose",rt);const Ai=et.textures,li=et.isWebGLCubeRenderTarget===!0,Rr=Ai.length>1;if(Rr||(pi.__webglTexture===void 0&&(pi.__webglTexture=S.createTexture()),pi.__version=Le.version,M.memory.textures++),li){jt.__webglFramebuffer=[];for(let ji=0;ji<6;ji++)if(Le.mipmaps&&Le.mipmaps.length>0){jt.__webglFramebuffer[ji]=[];for(let ur=0;ur<Le.mipmaps.length;ur++)jt.__webglFramebuffer[ji][ur]=S.createFramebuffer()}else jt.__webglFramebuffer[ji]=S.createFramebuffer()}else{if(Le.mipmaps&&Le.mipmaps.length>0){jt.__webglFramebuffer=[];for(let ji=0;ji<Le.mipmaps.length;ji++)jt.__webglFramebuffer[ji]=S.createFramebuffer()}else jt.__webglFramebuffer=S.createFramebuffer();if(Rr)for(let ji=0,ur=Ai.length;ji<ur;ji++){const Qn=A.get(Ai[ji]);Qn.__webglTexture===void 0&&(Qn.__webglTexture=S.createTexture(),M.memory.textures++)}if(et.samples>0&&Wr(et)===!1){jt.__webglMultisampledFramebuffer=S.createFramebuffer(),jt.__webglColorRenderbuffer=[],d.bindFramebuffer(S.FRAMEBUFFER,jt.__webglMultisampledFramebuffer);for(let ji=0;ji<Ai.length;ji++){const ur=Ai[ji];jt.__webglColorRenderbuffer[ji]=S.createRenderbuffer(),S.bindRenderbuffer(S.RENDERBUFFER,jt.__webglColorRenderbuffer[ji]);const Qn=w.convert(ur.format,ur.colorSpace),cr=w.convert(ur.type),Er=st(ur.internalFormat,Qn,cr,ur.colorSpace,et.isXRRenderTarget===!0),En=yn(et);S.renderbufferStorageMultisample(S.RENDERBUFFER,En,Er,et.width,et.height),S.framebufferRenderbuffer(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0+ji,S.RENDERBUFFER,jt.__webglColorRenderbuffer[ji])}S.bindRenderbuffer(S.RENDERBUFFER,null),et.depthBuffer&&(jt.__webglDepthRenderbuffer=S.createRenderbuffer(),Xi(jt.__webglDepthRenderbuffer,et,!0)),d.bindFramebuffer(S.FRAMEBUFFER,null)}}if(li){d.bindTexture(S.TEXTURE_CUBE_MAP,pi.__webglTexture),is(S.TEXTURE_CUBE_MAP,Le);for(let ji=0;ji<6;ji++)if(Le.mipmaps&&Le.mipmaps.length>0)for(let ur=0;ur<Le.mipmaps.length;ur++)Ci(jt.__webglFramebuffer[ji][ur],et,Le,S.COLOR_ATTACHMENT0,S.TEXTURE_CUBE_MAP_POSITIVE_X+ji,ur);else Ci(jt.__webglFramebuffer[ji],et,Le,S.COLOR_ATTACHMENT0,S.TEXTURE_CUBE_MAP_POSITIVE_X+ji,0);we(Le)&&xe(S.TEXTURE_CUBE_MAP),d.unbindTexture()}else if(Rr){for(let ji=0,ur=Ai.length;ji<ur;ji++){const Qn=Ai[ji],cr=A.get(Qn);d.bindTexture(S.TEXTURE_2D,cr.__webglTexture),is(S.TEXTURE_2D,Qn),Ci(jt.__webglFramebuffer,et,Qn,S.COLOR_ATTACHMENT0+ji,S.TEXTURE_2D,0),we(Qn)&&xe(S.TEXTURE_2D)}d.unbindTexture()}else{let ji=S.TEXTURE_2D;if((et.isWebGL3DRenderTarget||et.isWebGLArrayRenderTarget)&&(ji=et.isWebGL3DRenderTarget?S.TEXTURE_3D:S.TEXTURE_2D_ARRAY),et.isWebGLMultiviewRenderTarget===!0&&(ji=S.TEXTURE_2D_ARRAY),d.bindTexture(ji,pi.__webglTexture),is(ji,Le),Le.mipmaps&&Le.mipmaps.length>0)for(let ur=0;ur<Le.mipmaps.length;ur++)Ci(jt.__webglFramebuffer[ur],et,Le,S.COLOR_ATTACHMENT0,ji,ur);else Ci(jt.__webglFramebuffer,et,Le,S.COLOR_ATTACHMENT0,ji,0);we(Le)&&xe(ji),d.unbindTexture()}(et.depthBuffer||et.isWebGLMultiviewRenderTarget===!0)&&this.setupDepthRenderbuffer(et)}function ci(et){const Le=et.textures;for(let jt=0,pi=Le.length;jt<pi;jt++){const Ai=Le[jt];if(we(Ai)){const li=et.isWebGLCubeRenderTarget?S.TEXTURE_CUBE_MAP:S.TEXTURE_2D,Rr=A.get(Ai).__webglTexture;d.bindTexture(li,Rr),xe(li),d.unbindTexture()}}}const rr=[],ir=[];function yr(et){if(et.samples>0){if(Wr(et)===!1){const Le=et.textures,jt=et.width,pi=et.height;let Ai=S.COLOR_BUFFER_BIT;const li=et.stencilBuffer?S.DEPTH_STENCIL_ATTACHMENT:S.DEPTH_ATTACHMENT,Rr=A.get(et),ji=Le.length>1;if(ji)for(let ur=0;ur<Le.length;ur++)d.bindFramebuffer(S.FRAMEBUFFER,Rr.__webglMultisampledFramebuffer),S.framebufferRenderbuffer(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0+ur,S.RENDERBUFFER,null),d.bindFramebuffer(S.FRAMEBUFFER,Rr.__webglFramebuffer),S.framebufferTexture2D(S.DRAW_FRAMEBUFFER,S.COLOR_ATTACHMENT0+ur,S.TEXTURE_2D,null,0);d.bindFramebuffer(S.READ_FRAMEBUFFER,Rr.__webglMultisampledFramebuffer),d.bindFramebuffer(S.DRAW_FRAMEBUFFER,Rr.__webglFramebuffer);for(let ur=0;ur<Le.length;ur++){if(et.resolveDepthBuffer&&(et.depthBuffer&&(Ai|=S.DEPTH_BUFFER_BIT),et.stencilBuffer&&et.resolveStencilBuffer&&(Ai|=S.STENCIL_BUFFER_BIT)),ji){S.framebufferRenderbuffer(S.READ_FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.RENDERBUFFER,Rr.__webglColorRenderbuffer[ur]);const Qn=A.get(Le[ur]).__webglTexture;S.framebufferTexture2D(S.DRAW_FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_2D,Qn,0)}S.blitFramebuffer(0,0,jt,pi,0,0,jt,pi,Ai,S.NEAREST),P===!0&&(rr.length=0,ir.length=0,rr.push(S.COLOR_ATTACHMENT0+ur),et.depthBuffer&&et.resolveDepthBuffer===!1&&(rr.push(li),ir.push(li),S.invalidateFramebuffer(S.DRAW_FRAMEBUFFER,ir)),S.invalidateFramebuffer(S.READ_FRAMEBUFFER,rr))}if(d.bindFramebuffer(S.READ_FRAMEBUFFER,null),d.bindFramebuffer(S.DRAW_FRAMEBUFFER,null),ji)for(let ur=0;ur<Le.length;ur++){d.bindFramebuffer(S.FRAMEBUFFER,Rr.__webglMultisampledFramebuffer),S.framebufferRenderbuffer(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0+ur,S.RENDERBUFFER,Rr.__webglColorRenderbuffer[ur]);const Qn=A.get(Le[ur]).__webglTexture;d.bindFramebuffer(S.FRAMEBUFFER,Rr.__webglFramebuffer),S.framebufferTexture2D(S.DRAW_FRAMEBUFFER,S.COLOR_ATTACHMENT0+ur,S.TEXTURE_2D,Qn,0)}d.bindFramebuffer(S.DRAW_FRAMEBUFFER,Rr.__webglMultisampledFramebuffer)}else if(et.depthBuffer&&et.resolveDepthBuffer===!1&&P){const Le=et.stencilBuffer?S.DEPTH_STENCIL_ATTACHMENT:S.DEPTH_ATTACHMENT;S.invalidateFramebuffer(S.DRAW_FRAMEBUFFER,[Le])}}}function yn(et){return Math.min(x.maxSamples,et.samples)}function Wr(et){const Le=A.get(et);return et.samples>0&&a.has("WEBGL_multisampled_render_to_texture")===!0&&Le.__useRenderToTexture!==!1}function ha(et){const Le=M.render.frame;Y.get(et)!==Le&&(Y.set(et,Le),et.update())}function Xs(et,Le){const jt=et.colorSpace,pi=et.format,Ai=et.type;return et.isCompressedTexture===!0||et.isVideoTexture===!0||jt!==Lc&&jt!==Xa&&(Yn.getTransfer(jt)===cs?(pi!==fe||Ai!==An)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",jt)),Le}function Wn(et){return typeof HTMLImageElement<"u"&&et instanceof HTMLImageElement?(j.width=et.naturalWidth||et.width,j.height=et.naturalHeight||et.height):typeof VideoFrame<"u"&&et instanceof VideoFrame?(j.width=et.displayWidth,j.height=et.displayHeight):(j.width=et.width,j.height=et.height),j}this.allocateTextureUnit=Rt,this.resetTextureUnits=ft,this.setTexture2D=fi,this.setTexture2DArray=Oi,this.setTexture3D=zt,this.setTextureCube=bi,this.rebindTextures=ii,this.uploadTexture=Cr,this.setupRenderTarget=tr,this.updateRenderTargetMipmap=ci,this.updateMultisampleRenderTarget=yr,this.setupDepthTexture=it,this.setupDepthRenderbuffer=gi,this.setupFrameBufferTexture=Ci,this.useMultisampledRTT=Wr,this.runDeferredUploads=Nn,this.setDeferTextureUploads=jn}function WG(S,a){function d(A,x=Xa){let w;const M=Yn.getTransfer(x);if(A===An)return S.UNSIGNED_BYTE;if(A===Ni)return S.UNSIGNED_SHORT_4_4_4_4;if(A===ar)return S.UNSIGNED_SHORT_5_5_5_1;if(A===ki)return S.UNSIGNED_INT_5_9_9_9_REV;if(A===Ns)return S.BYTE;if(A===ts)return S.SHORT;if(A===bs)return S.UNSIGNED_SHORT;if(A===pe)return S.INT;if(A===ct)return S.UNSIGNED_INT;if(A===Tt)return S.FLOAT;if(A===Jt)return S.HALF_FLOAT;if(A===Ie)return S.ALPHA;if(A===se)return S.RGB;if(A===fe)return S.RGBA;if(A===Be)return S.LUMINANCE;if(A===Fe)return S.LUMINANCE_ALPHA;if(A===Ye)return S.DEPTH_COMPONENT;if(A===lt)return S.DEPTH_STENCIL;if(A===Ct)return S.RED;if(A===Yt)return S.RED_INTEGER;if(A===ei)return S.RG;if(A===Bt)return S.RG_INTEGER;if(A===ni)return S.RGBA_INTEGER;if(A===wi||A===zi||A===Sr||A===hr)if(M===cs)if(w=a.get("WEBGL_compressed_texture_s3tc_srgb"),w!==null){if(A===wi)return w.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(A===zi)return w.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(A===Sr)return w.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(A===hr)return w.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(w=a.get("WEBGL_compressed_texture_s3tc"),w!==null){if(A===wi)return w.COMPRESSED_RGB_S3TC_DXT1_EXT;if(A===zi)return w.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(A===Sr)return w.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(A===hr)return w.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(A===er||A===_i||A===Rn||A===Kn)if(w=a.get("WEBGL_compressed_texture_pvrtc"),w!==null){if(A===er)return w.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(A===_i)return w.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(A===Rn)return w.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(A===Kn)return w.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(A===Bi||A===or||A===dn)if(w=a.get("WEBGL_compressed_texture_etc"),w!==null){if(A===Bi||A===or)return M===cs?w.COMPRESSED_SRGB8_ETC2:w.COMPRESSED_RGB8_ETC2;if(A===dn)return M===cs?w.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:w.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(A===qr||A===W||A===ue||A===ge||A===Se||A===We||A===Ke||A===mt||A===he||A===le||A===de||A===be||A===Ee||A===at)if(w=a.get("WEBGL_compressed_texture_astc"),w!==null){if(A===qr)return M===cs?w.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:w.COMPRESSED_RGBA_ASTC_4x4_KHR;if(A===W)return M===cs?w.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:w.COMPRESSED_RGBA_ASTC_5x4_KHR;if(A===ue)return M===cs?w.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:w.COMPRESSED_RGBA_ASTC_5x5_KHR;if(A===ge)return M===cs?w.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:w.COMPRESSED_RGBA_ASTC_6x5_KHR;if(A===Se)return M===cs?w.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:w.COMPRESSED_RGBA_ASTC_6x6_KHR;if(A===We)return M===cs?w.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:w.COMPRESSED_RGBA_ASTC_8x5_KHR;if(A===Ke)return M===cs?w.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:w.COMPRESSED_RGBA_ASTC_8x6_KHR;if(A===mt)return M===cs?w.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:w.COMPRESSED_RGBA_ASTC_8x8_KHR;if(A===he)return M===cs?w.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:w.COMPRESSED_RGBA_ASTC_10x5_KHR;if(A===le)return M===cs?w.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:w.COMPRESSED_RGBA_ASTC_10x6_KHR;if(A===de)return M===cs?w.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:w.COMPRESSED_RGBA_ASTC_10x8_KHR;if(A===be)return M===cs?w.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:w.COMPRESSED_RGBA_ASTC_10x10_KHR;if(A===Ee)return M===cs?w.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:w.COMPRESSED_RGBA_ASTC_12x10_KHR;if(A===at)return M===cs?w.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:w.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(A===St||A===Qt||A===si)if(w=a.get("EXT_texture_compression_bptc"),w!==null){if(A===St)return M===cs?w.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:w.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(A===Qt)return w.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(A===si)return w.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(A===vi||A===Xt||A===Li||A===vr)if(w=a.get("EXT_texture_compression_rgtc"),w!==null){if(A===St)return w.COMPRESSED_RED_RGTC1_EXT;if(A===Xt)return w.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(A===Li)return w.COMPRESSED_RED_GREEN_RGTC2_EXT;if(A===vr)return w.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return A===Di?S.UNSIGNED_INT_24_8:S[A]!==void 0?S[A]:null}return{convert:d}}class Sf extends Hn{constructor(){super(),this.isGroup=!0,this.type="Group"}}class ON extends va{constructor(a=[]){super(),this.isArrayCamera=!0,this.cameras=a}}var QG=new He,qG=new He;function yRe(S,a,d){QG.setFromMatrixPosition(a.matrixWorld),qG.setFromMatrixPosition(d.matrixWorld);var A=QG.distanceTo(qG),x=a.projectionMatrix.elements,w=d.projectionMatrix.elements,M=x[14]/(x[10]-1),N=x[14]/(x[10]+1),P=(x[9]+1)/x[5],k=(x[9]-1)/x[5],j=(x[8]-1)/x[0],Y=(w[8]+1)/w[0],X=M*j,Z=M*Y,ie=A/(-j+Y),oe=ie*-j;a.matrixWorld.decompose(S.position,S.quaternion,S.scale),S.translateX(oe),S.translateZ(ie),S.matrixWorld.compose(S.position,S.quaternion,S.scale),S.matrixWorldInverse.copy(S.matrixWorld).invert();var ne=M+ie,ee=N+ie,Me=X-oe,we=Z+(A-oe),xe=P*N/ee*ne,st=k*N/ee*ne;S.projectionMatrix.makePerspective(Me,we,xe,st,ne,ee)}function XG(S){var a,d,A=this,x=null,w=null,M=null,N=[],P=new mr,k=new mr,j=1,Y="local-floor";typeof window<"u"&&"VRFrameData"in window&&(w=new window.VRFrameData,window.addEventListener("vrdisplaypresentchange",xe,!1));var X=new mr,Z=new Vn,ie=new He,oe=new va;oe.viewport=new Un,oe.layers.enable(1);var ne=new va;ne.viewport=new Un,ne.layers.enable(2);var ee=new ON([oe,ne]);ee.layers.enable(1),ee.layers.enable(2);var Me=new oi,we;function xe(){var nt=A.isPresenting=x!==null&&x.isPresenting===!0;if(nt){var gt=x.getEyeParameters("left");a=2*gt.renderWidth*j,d=gt.renderHeight*j,we=S.getPixelRatio(),S.getSize(Me),S.setDrawingBufferSize(a,d,1),oe.viewport.set(0,0,a/2,d),ne.viewport.set(a/2,0,a/2,d),De.start(),A.dispatchEvent({type:"sessionstart"})}else A.enabled&&S.setDrawingBufferSize(Me.width,Me.height,we),De.stop(),A.dispatchEvent({type:"sessionend"})}var st=[],Qe=[];function Ze(nt){for(var gt=navigator.getGamepads&&navigator.getGamepads(),ft=0,Rt=gt.length;ft<Rt;ft++){var Ut=gt[ft];if(Ut&&(Ut.id==="Daydream Controller"||Ut.id==="Gear VR Controller"||Ut.id==="Oculus Go Controller"||Ut.id==="OpenVR Gamepad"||Ut.id.startsWith("Oculus Touch")||Ut.id.startsWith("HTC Vive Focus")||Ut.id.startsWith("Spatial Controller"))){var fi=Ut.hand;if(nt===0&&(fi===""||fi==="right")||nt===1&&fi==="left")return Ut}}}function rt(){for(var nt=0;nt<N.length;nt++){var gt=N[nt],ft=Ze(nt);if(ft!==void 0&&ft.pose!==void 0){if(ft.pose===null)return;var Rt=ft.pose;Rt.hasPosition===!1&&gt.position.set(.2,-.6,-.05),Rt.position!==null&&gt.position.fromArray(Rt.position),Rt.orientation!==null&&gt.quaternion.fromArray(Rt.orientation),gt.matrix.compose(gt.position,gt.quaternion,gt.scale),gt.matrix.premultiply(P),gt.matrix.decompose(gt.position,gt.quaternion,gt.scale),gt.matrixWorldNeedsUpdate=!0,gt.visible=!0;var Ut=ft.id==="Daydream Controller"?0:1;st[nt]===void 0&&(st[nt]=!1),st[nt]!==ft.buttons[Ut].pressed&&(st[nt]=ft.buttons[Ut].pressed,st[nt]===!0?gt.dispatchEvent({type:"selectstart"}):(gt.dispatchEvent({type:"selectend"}),gt.dispatchEvent({type:"select"}))),Ut=2,Qe[nt]===void 0&&(Qe[nt]=!1),ft.buttons[Ut]!==void 0&&Qe[nt]!==ft.buttons[Ut].pressed&&(Qe[nt]=ft.buttons[Ut].pressed,Qe[nt]===!0?gt.dispatchEvent({type:"squeezestart"}):(gt.dispatchEvent({type:"squeezeend"}),gt.dispatchEvent({type:"squeeze"})))}else gt.visible=!1}}function ze(nt,gt){gt!==null&&gt.length===4&&nt.set(gt[0]*a,gt[1]*d,gt[2]*a,gt[3]*d)}this.enabled=!1,this.getController=function(nt){var gt=N[nt];return gt===void 0&&(gt=new Sf,gt.matrixAutoUpdate=!1,gt.visible=!1,N[nt]=gt),gt},this.getDevice=function(){return x},this.setDevice=function(nt){nt!==void 0&&(x=nt),De.setContext(nt)},this.setFramebufferScaleFactor=function(nt){j=nt},this.setReferenceSpaceType=function(nt){Y=nt},this.setPoseTarget=function(nt){nt!==void 0&&(M=nt)},this.cameraAutoUpdate=!0,this.updateCamera=function(nt){var gt=Y==="local-floor"?1.6:0;if(x.depthNear=nt.near,x.depthFar=nt.far,x.getFrameData(w),Y==="local-floor"){var ft=x.stageParameters;ft?P.fromArray(ft.sittingToStandingTransform):P.makeTranslation(0,gt,0)}var Rt=w.pose,Ut=M!==null?M:nt;Ut.matrix.copy(P),Ut.matrix.decompose(Ut.position,Ut.quaternion,Ut.scale),Rt.orientation!==null&&(Z.fromArray(Rt.orientation),Ut.quaternion.multiply(Z)),Rt.position!==null&&(Z.setFromRotationMatrix(P),ie.fromArray(Rt.position),ie.applyQuaternion(Z),Ut.position.add(ie)),Ut.updateMatrixWorld();for(var fi=Ut.children,Oi=0,zt=fi.length;Oi<zt;Oi++)fi[Oi].updateMatrixWorld(!0);oe.near=nt.near,ne.near=nt.near,oe.far=nt.far,ne.far=nt.far,oe.matrixWorldInverse.fromArray(w.leftViewMatrix),ne.matrixWorldInverse.fromArray(w.rightViewMatrix),k.copy(P).invert(),Y==="local-floor"&&(oe.matrixWorldInverse.multiply(k),ne.matrixWorldInverse.multiply(k));var bi=Ut.parent;bi!==null&&(X.copy(bi.matrixWorld).invert(),oe.matrixWorldInverse.multiply(X),ne.matrixWorldInverse.multiply(X)),oe.matrixWorld.copy(oe.matrixWorldInverse).invert(),ne.matrixWorld.copy(ne.matrixWorldInverse).invert(),oe.projectionMatrix.fromArray(w.leftProjectionMatrix),ne.projectionMatrix.fromArray(w.rightProjectionMatrix),yRe(ee,oe,ne);var Pi=x.getLayers();if(Pi.length){var Ur=Pi[0];ze(oe.viewport,Ur.leftBounds),ze(ne.viewport,Ur.rightBounds)}return rt(),ee},this.getCamera=function(){return ee},this.getFoveation=function(){return 1},this.setFoveation=function(nt){nt!==1&&console.warn("THREE.WebVRManager: setFoveation() not used in WebVR.")},this.getEnvironmentBlendMode=function(){if(A.isPresenting)return"opaque"},this.getStandingMatrix=function(){return P},this.isPresenting=!1;var De=new _N;this.setAnimationLoop=function(nt){De.setAnimationLoop(nt),this.isPresenting&&De.start()},this.submitFrame=function(){this.isPresenting&&x.submitFrame()},this.dispose=function(){typeof window<"u"&&window.removeEventListener("vrdisplaypresentchange",xe)},this.setFrameOfReferenceType=function(){console.warn("THREE.WebVRManager: setFrameOfReferenceType() has been deprecated.")}}Object.assign(XG.prototype,{addEventListener:Bo.prototype.addEventListener,hasEventListener:Bo.prototype.hasEventListener,removeEventListener:Bo.prototype.removeEventListener,dispatchEvent:Bo.prototype.dispatchEvent});class KG extends rl{constructor(a,d,A,x={}){super(a,d,x),this.depthBuffer=!1,this.stencilBuffer=!1,this.numViews=A}copy(a){return super.copy(a),this.numViews=a.numViews,this}}KG.prototype.isWebGLMultiviewRenderTarget=!0;const vRe={type:"move"};class PN{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Sf,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Sf,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new He,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new He),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Sf,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new He,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new He),this._grip}dispatchEvent(a){return this._targetRay!==null&&this._targetRay.dispatchEvent(a),this._grip!==null&&this._grip.dispatchEvent(a),this._hand!==null&&this._hand.dispatchEvent(a),this}connect(a){if(a&&a.hand){const d=this._hand;if(d)for(const A of a.hand.values())this._getHandJoint(d,A)}return this.dispatchEvent({type:"connected",data:a}),this}disconnect(a){return this.dispatchEvent({type:"disconnected",data:a}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(a,d,A){let x=null,w=null,M=null;const N=this._targetRay,P=this._grip,k=this._hand;if(a&&d.session.visibilityState!=="visible-blurred"){if(k&&a.hand){M=!0;for(const oe of a.hand.values()){const ne=d.getJointPose(oe,A),ee=this._getHandJoint(k,oe);ne!==null&&(ee.matrix.fromArray(ne.transform.matrix),ee.matrix.decompose(ee.position,ee.rotation,ee.scale),ee.matrixWorldNeedsUpdate=!0,ee.jointRadius=ne.radius),ee.visible=ne!==null}const j=k.joints["index-finger-tip"],Y=k.joints["thumb-tip"],X=j.position.distanceTo(Y.position),Z=.02,ie=.005;k.inputState.pinching&&X>Z+ie?(k.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:a.handedness,target:this})):!k.inputState.pinching&&X<=Z-ie&&(k.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:a.handedness,target:this}))}else P!==null&&a.gripSpace&&(w=d.getPose(a.gripSpace,A),w!==null&&(P.matrix.fromArray(w.transform.matrix),P.matrix.decompose(P.position,P.rotation,P.scale),P.matrixWorldNeedsUpdate=!0,w.linearVelocity?(P.hasLinearVelocity=!0,P.linearVelocity.copy(w.linearVelocity)):P.hasLinearVelocity=!1,w.angularVelocity?(P.hasAngularVelocity=!0,P.angularVelocity.copy(w.angularVelocity)):P.hasAngularVelocity=!1));N!==null&&(x=d.getPose(a.targetRaySpace,A),x===null&&w!==null&&(x=w),x!==null&&(N.matrix.fromArray(x.transform.matrix),N.matrix.decompose(N.position,N.rotation,N.scale),N.matrixWorldNeedsUpdate=!0,x.linearVelocity?(N.hasLinearVelocity=!0,N.linearVelocity.copy(x.linearVelocity)):N.hasLinearVelocity=!1,x.angularVelocity?(N.hasAngularVelocity=!0,N.angularVelocity.copy(x.angularVelocity)):N.hasAngularVelocity=!1,this.dispatchEvent(vRe)))}return N!==null&&(N.visible=x!==null),P!==null&&(P.visible=w!==null),k!==null&&(k.visible=M!==null),this}_getHandJoint(a,d){if(a.joints[d.jointName]===void 0){const A=new Sf;A.matrixAutoUpdate=!1,A.visible=!1,a.joints[d.jointName]=A,a.add(A)}return a.joints[d.jointName]}}const bRe=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,xRe=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class _Re{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(a,d,A){if(this.texture===null){const x=new ds,w=a.properties.get(x);w.__webglTexture=d.texture,(d.depthNear!=A.depthNear||d.depthFar!=A.depthFar)&&(this.depthNear=d.depthNear,this.depthFar=d.depthFar),this.texture=x}}render(a,d){if(this.texture!==null){if(this.mesh===null){const A=d.cameras[0].viewport,x=new Oc({vertexShader:bRe,fragmentShader:xRe,uniforms:{depthColor:{value:this.texture},depthWidth:{value:A.z},depthHeight:{value:A.w}}});this.mesh=new ua(new E0(20,20),x)}a.render(this.mesh,d)}}reset(){this.texture=null,this.mesh=null}}class ERe extends Bo{constructor(a,d,A,x){super();const w=this;let M=null,N=1;var P=null;let k=null,j="local-floor",Y=1,X=null,Z=null;var ie=[];let oe=null,ne=null,ee=null,Me=null;const we=new _Re,xe=d.getContextAttributes();let st=null,Qe=null;const Ze=[],rt=[],ze=new oi;let De=null;const nt=new va;nt.layers.enable(1),nt.viewport=new Un;const gt=new va;gt.layers.enable(2),gt.viewport=new Un;const ft=[nt,gt],Rt=new ON;Rt.layers.enable(1),Rt.layers.enable(2);let Ut=null,fi=null;this.cameraAutoUpdate=!0,this.layersEnabled=!1,this.enabled=!1,this.isPresenting=!1,this.isMultiview=!1,this.getCameraPose=function(){return Z},this.getController=function(di){let Ci=Ze[di];return Ci===void 0&&(Ci=new PN,Ze[di]=Ci),Ci.getTargetRaySpace()},this.getControllerGrip=function(di){let Ci=Ze[di];return Ci===void 0&&(Ci=new PN,Ze[di]=Ci),Ci.getGripSpace()},this.getHand=function(di){let Ci=Ze[di];return Ci===void 0&&(Ci=new PN,Ze[di]=Ci),Ci.getHandSpace()};function Oi(di){const Ci=rt.indexOf(di.inputSource);if(Ci===-1)return;const Xi=Ze[Ci];Xi!==void 0&&(Xi.update(di.inputSource,di.frame,X||k),Xi.dispatchEvent({type:di.type,data:di.inputSource}))}function zt(){M.removeEventListener("select",Oi),M.removeEventListener("selectstart",Oi),M.removeEventListener("selectend",Oi),M.removeEventListener("squeeze",Oi),M.removeEventListener("squeezestart",Oi),M.removeEventListener("squeezeend",Oi),M.removeEventListener("end",zt),M.removeEventListener("inputsourceschange",bi);for(let di=0;di<Ze.length;di++){const Ci=rt[di];Ci!==null&&(rt[di]=null,Ze[di].disconnect(Ci))}Ut=null,fi=null,we.reset(),a.setRenderTarget(st),ee=null,ne=null,oe=null,M=null,Qe=null,Cr.stop(),w.isPresenting=!1,a.setPixelRatio(De),a.setSize(ze.width,ze.height,!1),w.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(di){N=di,w.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(di){j=di,w.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return X||k},this.setReferenceSpace=function(di){X=di},this.getBaseLayer=function(){return ne!==null?ne:ee},this.getBinding=function(){return oe},this.getFrame=function(){return Me},this.getSession=function(){return M},this.setSession=async function(di){if(M=di,M!==null){if(st=a.getRenderTarget(),M.addEventListener("select",Oi),M.addEventListener("selectstart",Oi),M.addEventListener("selectend",Oi),M.addEventListener("squeeze",Oi),M.addEventListener("squeezestart",Oi),M.addEventListener("squeezeend",Oi),M.addEventListener("end",zt),M.addEventListener("inputsourceschange",bi),xe.xrCompatible!==!0&&await d.makeXRCompatible(),De=a.getPixelRatio(),a.getSize(ze),M.renderState.layers===void 0){const Ci={antialias:xe.antialias,alpha:!0,depth:xe.depth,stencil:xe.stencil,framebufferScaleFactor:N};ee=new XRWebGLLayer(M,d,Ci),M.updateRenderState({baseLayer:ee}),a.setPixelRatio(1),a.setSize(ee.framebufferWidth,ee.framebufferHeight,!1),Qe=new rl(ee.framebufferWidth,ee.framebufferHeight,{format:fe,type:An,colorSpace:a.outputColorSpace,stencilBuffer:xe.stencil})}else{let Ci=null,Xi=null,it=null;xe.depth&&(it=xe.stencil?d.DEPTH24_STENCIL8:d.DEPTH_COMPONENT24,Ci=xe.stencil?lt:Ye,Xi=xe.stencil?Di:ct),w.isMultiview=x&&A.has("OCULUS_multiview");const gi={colorFormat:d.RGBA8,depthFormat:it,scaleFactor:N};w.isMultiview&&(gi.textureType="texture-array"),oe=new XRWebGLBinding(M,d),ne=oe.createProjectionLayer(gi),M.updateRenderState({layers:[ne]}),a.setPixelRatio(1),a.setSize(ne.textureWidth,ne.textureHeight,!1);const ii={format:fe,type:An,depthTexture:new IN(ne.textureWidth,ne.textureHeight,Xi,void 0,void 0,void 0,void 0,void 0,void 0,Ci),stencilBuffer:xe.stencil,colorSpace:a.outputColorSpace,samples:xe.antialias?4:0,resolveDepthBuffer:ne.ignoreDepthValues===!1};if(w.isMultiview){const tr=A.get("OCULUS_multiview");this.maxNumViews=d.getParameter(tr.MAX_VIEWS_OVR),Qe=new KG(ne.textureWidth,ne.textureHeight,2,ii)}else Qe=new rl(ne.textureWidth,ne.textureHeight,ii)}Qe.isXRRenderTarget=!0,this.setFoveation(Y),X=null,k=await M.requestReferenceSpace(j),Cr.setContext(M),Cr.start(),w.isPresenting=!0,w.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(M!==null)return M.environmentBlendMode},this.addLayer=function(di){!window.XRWebGLBinding||!this.layersEnabled||!M||(ie.push(di),this.updateLayers())},this.removeLayer=function(di){ie.splice(ie.indexOf(di),1),!(!window.XRWebGLBinding||!this.layersEnabled||!M)&&this.updateLayers()},this.updateLayers=function(){var di=ie.map(function(Ci){return Ci});di.unshift(M.renderState.layers[0]),M.updateRenderState({layers:di})};function bi(di){for(let Ci=0;Ci<di.removed.length;Ci++){const Xi=di.removed[Ci],it=rt.indexOf(Xi);it>=0&&(rt[it]=null,Ze[it].disconnect(Xi))}for(let Ci=0;Ci<di.added.length;Ci++){const Xi=di.added[Ci];let it=rt.indexOf(Xi);if(it===-1){for(let ii=0;ii<Ze.length;ii++)if(ii>=rt.length){rt.push(Xi),it=ii;break}else if(rt[ii]===null){rt[ii]=Xi,it=ii;break}if(it===-1)break}const gi=Ze[it];gi&&gi.connect(Xi)}}const Pi=new He,Ur=new He;function _n(di,Ci,Xi){Pi.setFromMatrixPosition(Ci.matrixWorld),Ur.setFromMatrixPosition(Xi.matrixWorld);const it=Pi.distanceTo(Ur),gi=Ci.projectionMatrix.elements,ii=Xi.projectionMatrix.elements,tr=gi[14]/(gi[10]-1),ci=gi[14]/(gi[10]+1),rr=(gi[9]+1)/gi[5],ir=(gi[9]-1)/gi[5],yr=(gi[8]-1)/gi[0],yn=(ii[8]+1)/ii[0],Wr=tr*yr,ha=tr*yn,Xs=it/(-yr+yn),Wn=Xs*-yr;Ci.matrixWorld.decompose(di.position,di.quaternion,di.scale),di.translateX(Wn),di.translateZ(Xs),di.matrixWorld.compose(di.position,di.quaternion,di.scale),di.matrixWorldInverse.copy(di.matrixWorld).invert();const et=tr+Xs,Le=ci+Xs,jt=Wr-Wn,pi=ha+(it-Wn),Ai=rr*ci/Le*et,li=ir*ci/Le*et;di.projectionMatrix.makePerspective(jt,pi,Ai,li,et,Le),di.projectionMatrixInverse.copy(di.projectionMatrix).invert()}function is(di,Ci){Ci===null?di.matrixWorld.copy(di.matrix):di.matrixWorld.multiplyMatrices(Ci.matrixWorld,di.matrix),di.matrixWorldInverse.copy(di.matrixWorld).invert()}this.setPoseTarget=function(di){di!==void 0&&(P=di)},this.updateCamera=function(di){if(M===null)return;we.texture!==null&&(di.near=we.depthNear,di.far=we.depthFar),Rt.near=gt.near=nt.near=di.near,Rt.far=gt.far=nt.far=di.far,(Ut!==Rt.near||fi!==Rt.far)&&(M.updateRenderState({depthNear:Rt.near,depthFar:Rt.far}),Ut=Rt.near,fi=Rt.far,nt.near=Ut,nt.far=fi,gt.near=Ut,gt.far=fi,nt.updateProjectionMatrix(),gt.updateProjectionMatrix(),di.updateProjectionMatrix());const Ci=Rt.cameras;var Xi=P||di;const it=Xi.parent;is(Rt,it);for(let gi=0;gi<Ci.length;gi++)is(Ci[gi],it);Ci.length===2?_n(Rt,nt,gt):Rt.projectionMatrix.copy(nt.projectionMatrix),ps(di,Rt,Xi)};function ps(di,Ci,Xi){Ci.matrixWorld.decompose(Ci.position,Ci.quaternion,Ci.scale),Xi.parent===null?Xi.matrix.copy(Ci.matrixWorld):(Xi.matrix.copy(Xi.parent.matrixWorld),Xi.matrix.invert(),Xi.matrix.multiply(Ci.matrixWorld)),Xi.matrix.decompose(Xi.position,Xi.quaternion,Xi.scale),Xi.updateMatrixWorld(!0),di.projectionMatrix.copy(Ci.projectionMatrix),di.projectionMatrixInverse.copy(Ci.projectionMatrixInverse),di.isPerspectiveCamera&&(di.fov=kd*2*Math.atan(1/di.projectionMatrix.elements[5]),di.zoom=1)}this.getCamera=function(){return Rt},this.getFoveation=function(){if(!(ne===null&&ee===null))return Y},this.setFoveation=function(di){Y=di,ne!==null&&(ne.fixedFoveation=di),ee!==null&&ee.fixedFoveation!==void 0&&(ee.fixedFoveation=di)},this.hasDepthSensing=function(){return we.texture!==null};let jn=null;function Nn(di,Ci){if(Z=Ci.getViewerPose(X||k),Me=Ci,Z!==null){const Xi=Z.views;ee!==null&&(a.setRenderTargetFramebuffer(Qe,ee.framebuffer),a.setRenderTarget(Qe));let it=!1;Xi.length!==Rt.cameras.length&&(Rt.cameras.length=0,it=!0);for(let ii=0;ii<Xi.length;ii++){const tr=Xi[ii];let ci=null;if(ee!==null)ci=ee.getViewport(tr);else{const ir=oe.getViewSubImage(ne,tr);ci=ir.viewport,ii===0&&(a.setRenderTargetTextures(Qe,ir.colorTexture,ne.ignoreDepthValues?void 0:ir.depthStencilTexture),a.setRenderTarget(Qe))}let rr=ft[ii];rr===void 0&&(rr=new va,rr.layers.enable(ii),rr.viewport=new Un,ft[ii]=rr),rr.matrix.fromArray(tr.transform.matrix),rr.matrix.decompose(rr.position,rr.quaternion,rr.scale),rr.projectionMatrix.fromArray(tr.projectionMatrix),rr.projectionMatrixInverse.copy(rr.projectionMatrix).invert(),rr.viewport.set(ci.x,ci.y,ci.width,ci.height),ii===0&&(Rt.matrix.copy(rr.matrix),Rt.matrix.decompose(Rt.position,Rt.quaternion,Rt.scale)),it===!0&&Rt.cameras.push(rr)}const gi=M.enabledFeatures;if(gi&&gi.includes("depth-sensing")){const ii=oe.getDepthInformation(Xi[0]);ii&&ii.isValid&&ii.texture&&we.init(a,ii,M.renderState)}}for(let Xi=0;Xi<Ze.length;Xi++){const it=rt[Xi],gi=Ze[Xi];it!==null&&gi!==void 0&&gi.update(it,Ci,X||k)}we.render(a,Rt),jn&&jn(di,Ci),Ci.detectedPlanes&&w.dispatchEvent({type:"planesdetected",data:Ci}),Me=null}const Cr=new _N;Cr.setAnimationLoop(Nn),this.setAnimationLoop=function(di){jn=di},this.dispose=function(){}}}const Tf=new Rl,wRe=new mr;function CRe(S,a){function d(ne,ee){ne.matrixAutoUpdate===!0&&ne.updateMatrix(),ee.value.copy(ne.matrix)}function A(ne,ee){ee.color.getRGB(ne.fogColor.value,pG(S)),ee.isFog?(ne.fogNear.value=ee.near,ne.fogFar.value=ee.far):ee.isFogExp2&&(ne.fogDensity.value=ee.density)}function x(ne,ee,Me,we,xe){ee.isMeshBasicMaterial||ee.isMeshLambertMaterial?w(ne,ee):ee.isMeshToonMaterial?(w(ne,ee),Y(ne,ee)):ee.isMeshPhongMaterial?(w(ne,ee),j(ne,ee)):ee.isMeshStandardMaterial?(w(ne,ee),X(ne,ee),ee.isMeshPhysicalMaterial&&Z(ne,ee,xe)):ee.isMeshMatcapMaterial?(w(ne,ee),ie(ne,ee)):ee.isMeshDepthMaterial?w(ne,ee):ee.isMeshDistanceMaterial?(w(ne,ee),oe(ne,ee)):ee.isMeshNormalMaterial?w(ne,ee):ee.isLineBasicMaterial?(M(ne,ee),ee.isLineDashedMaterial&&N(ne,ee)):ee.isPointsMaterial?P(ne,ee,Me,we):ee.isSpriteMaterial?k(ne,ee):ee.isShadowMaterial?(ne.color.value.copy(ee.color),ne.opacity.value=ee.opacity):ee.isShaderMaterial&&(ee.uniformsNeedUpdate=!1)}function w(ne,ee){ne.opacity.value=ee.opacity,ee.color&&ne.diffuse.value.copy(ee.color),ee.emissive&&ne.emissive.value.copy(ee.emissive).multiplyScalar(ee.emissiveIntensity),ee.map&&(ne.map.value=ee.map,d(ee.map,ne.mapTransform)),ee.alphaMap&&(ne.alphaMap.value=ee.alphaMap,d(ee.alphaMap,ne.alphaMapTransform)),ee.bumpMap&&(ne.bumpMap.value=ee.bumpMap,d(ee.bumpMap,ne.bumpMapTransform),ne.bumpScale.value=ee.bumpScale,ee.side===R&&(ne.bumpScale.value*=-1)),ee.normalMap&&(ne.normalMap.value=ee.normalMap,d(ee.normalMap,ne.normalMapTransform),ne.normalScale.value.copy(ee.normalScale),ee.side===R&&ne.normalScale.value.negate()),ee.displacementMap&&(ne.displacementMap.value=ee.displacementMap,d(ee.displacementMap,ne.displacementMapTransform),ne.displacementScale.value=ee.displacementScale,ne.displacementBias.value=ee.displacementBias),ee.emissiveMap&&(ne.emissiveMap.value=ee.emissiveMap,d(ee.emissiveMap,ne.emissiveMapTransform)),ee.specularMap&&(ne.specularMap.value=ee.specularMap,d(ee.specularMap,ne.specularMapTransform)),ee.alphaTest>0&&(ne.alphaTest.value=ee.alphaTest);const Me=a.get(ee),we=Me.envMap,xe=Me.envMapRotation;if(we&&(ne.envMap.value=we,Tf.copy(xe),Tf.x*=-1,Tf.y*=-1,Tf.z*=-1,we.isCubeTexture&&we.isRenderTargetTexture===!1&&(Tf.y*=-1,Tf.z*=-1),ne.envMapRotation.value.setFromMatrix4(wRe.makeRotationFromEuler(Tf)),ne.flipEnvMap.value=we.isCubeTexture&&we.isRenderTargetTexture===!1?-1:1,ne.reflectivity.value=ee.reflectivity,ne.ior.value=ee.ior,ne.refractionRatio.value=ee.refractionRatio),ee.lightMap){ne.lightMap.value=ee.lightMap;const st=S._useLegacyLights===!0?Math.PI:1;ne.lightMapIntensity.value=ee.lightMapIntensity*st,d(ee.lightMap,ne.lightMapTransform)}ee.aoMap&&(ne.aoMap.value=ee.aoMap,ne.aoMapIntensity.value=ee.aoMapIntensity,d(ee.aoMap,ne.aoMapTransform))}function M(ne,ee){ne.diffuse.value.copy(ee.color),ne.opacity.value=ee.opacity,ee.map&&(ne.map.value=ee.map,d(ee.map,ne.mapTransform))}function N(ne,ee){ne.dashSize.value=ee.dashSize,ne.totalSize.value=ee.dashSize+ee.gapSize,ne.scale.value=ee.scale}function P(ne,ee,Me,we){ne.diffuse.value.copy(ee.color),ne.opacity.value=ee.opacity,ne.size.value=ee.size*Me,ne.scale.value=we*.5,ee.map&&(ne.map.value=ee.map,d(ee.map,ne.uvTransform)),ee.alphaMap&&(ne.alphaMap.value=ee.alphaMap,d(ee.alphaMap,ne.alphaMapTransform)),ee.alphaTest>0&&(ne.alphaTest.value=ee.alphaTest)}function k(ne,ee){ne.diffuse.value.copy(ee.color),ne.opacity.value=ee.opacity,ne.rotation.value=ee.rotation,ee.map&&(ne.map.value=ee.map,d(ee.map,ne.mapTransform)),ee.alphaMap&&(ne.alphaMap.value=ee.alphaMap,d(ee.alphaMap,ne.alphaMapTransform)),ee.alphaTest>0&&(ne.alphaTest.value=ee.alphaTest)}function j(ne,ee){ne.specular.value.copy(ee.specular),ne.shininess.value=Math.max(ee.shininess,1e-4)}function Y(ne,ee){ee.gradientMap&&(ne.gradientMap.value=ee.gradientMap)}function X(ne,ee){ne.metalness.value=ee.metalness,ee.metalnessMap&&(ne.metalnessMap.value=ee.metalnessMap,d(ee.metalnessMap,ne.metalnessMapTransform)),ne.roughness.value=ee.roughness,ee.roughnessMap&&(ne.roughnessMap.value=ee.roughnessMap,d(ee.roughnessMap,ne.roughnessMapTransform)),ee.envMap&&(ne.envMapIntensity.value=ee.envMapIntensity)}function Z(ne,ee,Me){ne.ior.value=ee.ior,ee.sheen>0&&(ne.sheenColor.value.copy(ee.sheenColor).multiplyScalar(ee.sheen),ne.sheenRoughness.value=ee.sheenRoughness,ee.sheenColorMap&&(ne.sheenColorMap.value=ee.sheenColorMap,d(ee.sheenColorMap,ne.sheenColorMapTransform)),ee.sheenRoughnessMap&&(ne.sheenRoughnessMap.value=ee.sheenRoughnessMap,d(ee.sheenRoughnessMap,ne.sheenRoughnessMapTransform))),ee.clearcoat>0&&(ne.clearcoat.value=ee.clearcoat,ne.clearcoatRoughness.value=ee.clearcoatRoughness,ee.clearcoatMap&&(ne.clearcoatMap.value=ee.clearcoatMap,d(ee.clearcoatMap,ne.clearcoatMapTransform)),ee.clearcoatRoughnessMap&&(ne.clearcoatRoughnessMap.value=ee.clearcoatRoughnessMap,d(ee.clearcoatRoughnessMap,ne.clearcoatRoughnessMapTransform)),ee.clearcoatNormalMap&&(ne.clearcoatNormalMap.value=ee.clearcoatNormalMap,d(ee.clearcoatNormalMap,ne.clearcoatNormalMapTransform),ne.clearcoatNormalScale.value.copy(ee.clearcoatNormalScale),ee.side===R&&ne.clearcoatNormalScale.value.negate())),ee.dispersion>0&&(ne.dispersion.value=ee.dispersion),ee.iridescence>0&&(ne.iridescence.value=ee.iridescence,ne.iridescenceIOR.value=ee.iridescenceIOR,ne.iridescenceThicknessMinimum.value=ee.iridescenceThicknessRange[0],ne.iridescenceThicknessMaximum.value=ee.iridescenceThicknessRange[1],ee.iridescenceMap&&(ne.iridescenceMap.value=ee.iridescenceMap,d(ee.iridescenceMap,ne.iridescenceMapTransform)),ee.iridescenceThicknessMap&&(ne.iridescenceThicknessMap.value=ee.iridescenceThicknessMap,d(ee.iridescenceThicknessMap,ne.iridescenceThicknessMapTransform))),ee.transmission>0&&(ne.transmission.value=ee.transmission,ne.transmissionSamplerMap.value=Me.texture,ne.transmissionSamplerSize.value.set(Me.width,Me.height),ee.transmissionMap&&(ne.transmissionMap.value=ee.transmissionMap,d(ee.transmissionMap,ne.transmissionMapTransform)),ne.thickness.value=ee.thickness,ee.thicknessMap&&(ne.thicknessMap.value=ee.thicknessMap,d(ee.thicknessMap,ne.thicknessMapTransform)),ne.attenuationDistance.value=ee.attenuationDistance,ne.attenuationColor.value.copy(ee.attenuationColor)),ee.anisotropy>0&&(ne.anisotropyVector.value.set(ee.anisotropy*Math.cos(ee.anisotropyRotation),ee.anisotropy*Math.sin(ee.anisotropyRotation)),ee.anisotropyMap&&(ne.anisotropyMap.value=ee.anisotropyMap,d(ee.anisotropyMap,ne.anisotropyMapTransform))),ne.specularIntensity.value=ee.specularIntensity,ne.specularColor.value.copy(ee.specularColor),ee.specularColorMap&&(ne.specularColorMap.value=ee.specularColorMap,d(ee.specularColorMap,ne.specularColorMapTransform)),ee.specularIntensityMap&&(ne.specularIntensityMap.value=ee.specularIntensityMap,d(ee.specularIntensityMap,ne.specularIntensityMapTransform))}function ie(ne,ee){ee.matcap&&(ne.matcap.value=ee.matcap)}function oe(ne,ee){const Me=a.get(ee).light;ne.referencePosition.value.setFromMatrixPosition(Me.matrixWorld),ne.nearDistance.value=Me.shadow.camera.near,ne.farDistance.value=Me.shadow.camera.far}return{refreshFogUniforms:A,refreshMaterialUniforms:x}}function SRe(S,a,d,A){let x={},w={},M=[];const N=S.getParameter(S.MAX_UNIFORM_BUFFER_BINDINGS);function P(Me,we){const xe=we.program;A.uniformBlockBinding(Me,xe)}function k(Me,we){let xe=x[Me.id];xe===void 0&&(ie(Me),xe=j(Me),x[Me.id]=xe,Me.addEventListener("dispose",ne));const st=we.program;A.updateUBOMapping(Me,st);const Qe=a.render.frame;w[Me.id]!==Qe&&(X(Me),w[Me.id]=Qe)}function j(Me){const we=Y();Me.__bindingPointIndex=we;const xe=S.createBuffer(),st=Me.__size,Qe=Me.usage;return S.bindBuffer(S.UNIFORM_BUFFER,xe),S.bufferData(S.UNIFORM_BUFFER,st,Qe),S.bindBuffer(S.UNIFORM_BUFFER,null),S.bindBufferBase(S.UNIFORM_BUFFER,we,xe),xe}function Y(){for(let Me=0;Me<N;Me++)if(M.indexOf(Me)===-1)return M.push(Me),Me;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function X(Me){const we=x[Me.id],xe=Me.uniforms,st=Me.__cache;S.bindBuffer(S.UNIFORM_BUFFER,we);for(let Qe=0,Ze=xe.length;Qe<Ze;Qe++){const rt=Array.isArray(xe[Qe])?xe[Qe]:[xe[Qe]];for(let ze=0,De=rt.length;ze<De;ze++){const nt=rt[ze];if(Z(nt,Qe,ze,st)===!0){const gt=nt.__offset,ft=Array.isArray(nt.value)?nt.value:[nt.value];let Rt=0;for(let Ut=0;Ut<ft.length;Ut++){const fi=ft[Ut],Oi=oe(fi);typeof fi=="number"||typeof fi=="boolean"?(nt.__data[0]=fi,S.bufferSubData(S.UNIFORM_BUFFER,gt+Rt,nt.__data)):fi.isMatrix3?(nt.__data[0]=fi.elements[0],nt.__data[1]=fi.elements[1],nt.__data[2]=fi.elements[2],nt.__data[3]=0,nt.__data[4]=fi.elements[3],nt.__data[5]=fi.elements[4],nt.__data[6]=fi.elements[5],nt.__data[7]=0,nt.__data[8]=fi.elements[6],nt.__data[9]=fi.elements[7],nt.__data[10]=fi.elements[8],nt.__data[11]=0):(fi.toArray(nt.__data,Rt),Rt+=Oi.storage/Float32Array.BYTES_PER_ELEMENT)}S.bufferSubData(S.UNIFORM_BUFFER,gt,nt.__data)}}}S.bindBuffer(S.UNIFORM_BUFFER,null)}function Z(Me,we,xe,st){const Qe=Me.value,Ze=we+"_"+xe;if(st[Ze]===void 0)return typeof Qe=="number"||typeof Qe=="boolean"?st[Ze]=Qe:st[Ze]=Qe.clone(),!0;{const rt=st[Ze];if(typeof Qe=="number"||typeof Qe=="boolean"){if(rt!==Qe)return st[Ze]=Qe,!0}else if(rt.equals(Qe)===!1)return rt.copy(Qe),!0}return!1}function ie(Me){const we=Me.uniforms;let xe=0;const st=16;for(let Ze=0,rt=we.length;Ze<rt;Ze++){const ze=Array.isArray(we[Ze])?we[Ze]:[we[Ze]];for(let De=0,nt=ze.length;De<nt;De++){const gt=ze[De],ft=Array.isArray(gt.value)?gt.value:[gt.value];for(let Rt=0,Ut=ft.length;Rt<Ut;Rt++){const fi=ft[Rt],Oi=oe(fi),zt=xe%st;zt!==0&&st-zt<Oi.boundary&&(xe+=st-zt),gt.__data=new Float32Array(Oi.storage/Float32Array.BYTES_PER_ELEMENT),gt.__offset=xe,xe+=Oi.storage}}}const Qe=xe%st;return Qe>0&&(xe+=st-Qe),Me.__size=xe,Me.__cache={},this}function oe(Me){const we={boundary:0,storage:0};return typeof Me=="number"||typeof Me=="boolean"?(we.boundary=4,we.storage=4):Me.isVector2?(we.boundary=8,we.storage=8):Me.isVector3||Me.isColor?(we.boundary=16,we.storage=12):Me.isVector4?(we.boundary=16,we.storage=16):Me.isMatrix3?(we.boundary=48,we.storage=48):Me.isMatrix4?(we.boundary=64,we.storage=64):Me.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",Me),we}function ne(Me){const we=Me.target;we.removeEventListener("dispose",ne);const xe=M.indexOf(we.__bindingPointIndex);M.splice(xe,1),S.deleteBuffer(x[we.id]),delete x[we.id],delete w[we.id]}function ee(){for(const Me in x)S.deleteBuffer(x[Me]);M=[],x={},w={}}return{bind:P,update:k,dispose:ee}}class TRe{constructor(a={}){const{canvas:d=zE(),context:A=null,depth:x=!0,stencil:w=!1,alpha:M=!1,antialias:N=!1,premultipliedAlpha:P=!0,preserveDrawingBuffer:k=!1,powerPreference:j="default",failIfMajorPerformanceCaveat:Y=!1,multiviewStereo:X=!1}=a;this.isWebGLRenderer=!0;let Z;if(A!==null){if(typeof WebGLRenderingContext<"u"&&A instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");Z=A.getContextAttributes().alpha}else Z=M;const ie=new Uint32Array(4),oe=new Int32Array(4);let ne=null,ee=null;const Me=[],we=[];this.domElement=d,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=On,this._useLegacyLights=!1,this.toneMapping=Pt,this.toneMappingExposure=1;const xe=this;let st=!1,Qe=0,Ze=0,rt=null,ze=-1,De=null;const nt=new Un,gt=new Un;let ft=null;const Rt=new lr(0);let Ut=0,fi=d.width,Oi=d.height,zt=1,bi=null,Pi=null;const Ur=new Un(0,0,fi,Oi),_n=new Un(0,0,fi,Oi);let is=!1;const ps=new Sv;let jn=!1,Nn=!1;const Cr=new mr,di=new He,Ci={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Xi(){return rt===null?zt:1}let it=A;function gi(Ve,Et){return d.getContext(Ve,Et)}try{const Ve={alpha:!0,depth:x,stencil:w,antialias:N,premultipliedAlpha:P,preserveDrawingBuffer:k,powerPreference:j,failIfMajorPerformanceCaveat:Y};if("setAttribute"in d&&d.setAttribute("data-engine",`three.js r${h}`),d.addEventListener("webglcontextlost",Ii,!1),d.addEventListener("webglcontextrestored",Mr,!1),d.addEventListener("webglcontextcreationerror",nr,!1),it===null){const Et="webgl2";if(it=gi(Et,Ve),it===null)throw gi(Et)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(Ve){throw console.error("THREE.WebGLRenderer: "+Ve.message),Ve}let ii,tr,ci,rr,ir,yr,yn,Wr,ha,Xs,Wn,et,Le,jt,pi,Ai,li,Rr,ji,ur,Qn,cr,Er,En,zr;function ut(){ii=new kMe(it),ii.init(),Er=new WG(it,ii),tr=new BMe(it,ii,a,Er),ci=new gRe(it),rr=new zMe(it),ir=new nRe,yr=new ARe(it,ii,ci,ir,tr,Er,rr),yn=new LMe(xe),Wr=new PMe(xe),ha=new TSe(it),En=new RMe(it,ha),Xs=new FMe(it,ha,rr,En),Wn=new VMe(it,Xs,ha,rr),ur=new jMe(it,tr,yr),Ai=new NMe(ir),et=new rRe(xe,yn,Wr,ii,tr,En,Ai),Le=new CRe(xe,ir),jt=new aRe,pi=new dRe(ii),ji=new MMe(xe,yn,Wr,ci,Wn,Z,P),Rr=new GMe(xe,ii,it),li=new mRe(xe,Wn,tr),zr=new SRe(it,rr,tr,ci),Qn=new IMe(it,ii,rr),cr=new UMe(it,ii,rr),rr.programs=et.programs,xe.capabilities=tr,xe.extensions=ii,xe.properties=ir,xe.renderLists=jt,xe.shadowMap=li,xe.state=ci,xe.info=rr}ut();const xi=typeof navigator<"u"&&"xr"in navigator?new ERe(xe,it,ii,X):new XG(xe);this.xr=xi,this.getContext=function(){return it},this.getContextAttributes=function(){return it.getContextAttributes()},this.forceContextLoss=function(){const Ve=ii.get("WEBGL_lose_context");Ve&&Ve.loseContext()},this.forceContextRestore=function(){const Ve=ii.get("WEBGL_lose_context");Ve&&Ve.restoreContext()},this.getPixelRatio=function(){return zt},this.setPixelRatio=function(Ve){Ve!==void 0&&(zt=Ve,this.setSize(fi,Oi,!1))},this.getSize=function(Ve){return Ve.set(fi,Oi)},this.setSize=function(Ve,Et,Vt=!0){if(xi.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}fi=Ve,Oi=Et,d.width=Math.floor(Ve*zt),d.height=Math.floor(Et*zt),Vt===!0&&(d.style.width=Ve+"px",d.style.height=Et+"px"),this.setViewport(0,0,Ve,Et)},this.getDrawingBufferSize=function(Ve){return Ve.set(fi*zt,Oi*zt).floor()},this.setDrawingBufferSize=function(Ve,Et,Vt){fi=Ve,Oi=Et,zt=Vt,d.width=Math.floor(Ve*Vt),d.height=Math.floor(Et*Vt),this.setViewport(0,0,Ve,Et)},this.getCurrentViewport=function(Ve){return Ve.copy(nt)},this.getViewport=function(Ve){return Ve.copy(Ur)},this.setViewport=function(Ve,Et,Vt,Ft){Ve.isVector4?Ur.set(Ve.x,Ve.y,Ve.z,Ve.w):Ur.set(Ve,Et,Vt,Ft),ci.viewport(nt.copy(Ur).multiplyScalar(zt).round())},this.getScissor=function(Ve){return Ve.copy(_n)},this.setScissor=function(Ve,Et,Vt,Ft){Ve.isVector4?_n.set(Ve.x,Ve.y,Ve.z,Ve.w):_n.set(Ve,Et,Vt,Ft),ci.scissor(gt.copy(_n).multiplyScalar(zt).round())},this.getScissorTest=function(){return is},this.setScissorTest=function(Ve){ci.setScissorTest(is=Ve)},this.setOpaqueSort=function(Ve){bi=Ve},this.setTransparentSort=function(Ve){Pi=Ve},this.getClearColor=function(Ve){return Ve.copy(ji.getClearColor())},this.setClearColor=function(){ji.setClearColor.apply(ji,arguments)},this.getClearAlpha=function(){return ji.getClearAlpha()},this.setClearAlpha=function(){ji.setClearAlpha.apply(ji,arguments)},this.clear=function(Ve=!0,Et=!0,Vt=!0){let Ft=0;if(Ve){let Ot=!1;if(rt!==null){const Wi=rt.texture.format;Ot=Wi===ni||Wi===Bt||Wi===Yt}if(Ot){const Wi=rt.texture.type,Nr=Wi===An||Wi===ct||Wi===bs||Wi===Di||Wi===Ni||Wi===ar,Br=ji.getClearColor(),Vr=ji.getClearAlpha(),cn=Br.r,Ln=Br.g,In=Br.b;Nr?(ie[0]=cn,ie[1]=Ln,ie[2]=In,ie[3]=Vr,it.clearBufferuiv(it.COLOR,0,ie)):(oe[0]=cn,oe[1]=Ln,oe[2]=In,oe[3]=Vr,it.clearBufferiv(it.COLOR,0,oe))}else Ft|=it.COLOR_BUFFER_BIT}Et&&(Ft|=it.DEPTH_BUFFER_BIT),Vt&&(Ft|=it.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),it.clear(Ft)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){d.removeEventListener("webglcontextlost",Ii,!1),d.removeEventListener("webglcontextrestored",Mr,!1),d.removeEventListener("webglcontextcreationerror",nr,!1),jt.dispose(),pi.dispose(),ir.dispose(),yn.dispose(),Wr.dispose(),Wn.dispose(),En.dispose(),zr.dispose(),et.dispose(),xi.dispose(),xi.removeEventListener("sessionstart",du),xi.removeEventListener("sessionend",PH),zf.stop()};function Ii(Ve){Ve.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),st=!0}function Mr(){console.log("THREE.WebGLRenderer: Context Restored."),st=!1;const Ve=rr.autoReset,Et=li.enabled,Vt=li.autoUpdate,Ft=li.needsUpdate,Ot=li.type;ut(),rr.autoReset=Ve,li.enabled=Et,li.autoUpdate=Vt,li.needsUpdate=Ft,li.type=Ot}function nr(Ve){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",Ve.statusMessage)}function ln(Ve){const Et=Ve.target;Et.removeEventListener("dispose",ln),sr(Et)}function sr(Ve){$i(Ve),ir.remove(Ve)}function $i(Ve){const Et=ir.get(Ve).programs;Et!==void 0&&(Et.forEach(function(Vt){et.releaseProgram(Vt)}),Ve.isShaderMaterial&&et.releaseShaderCache(Ve))}this.renderBufferDirect=function(Ve,Et,Vt,Ft,Ot,Wi){Et===null&&(Et=Ci);const Nr=Ot.isMesh&&Ot.matrixWorld.determinant()<0,Br=xBe(Ve,Et,Vt,Ft,Ot);ci.setMaterial(Ft,Nr);let Vr=Vt.index,cn=1;if(Ft.wireframe===!0){if(Vr=Xs.getWireframeAttribute(Vt),Vr===void 0)return;cn=2}const Ln=Vt.drawRange,In=Vt.attributes.position;let _a=Ln.start*cn,ll=(Ln.start+Ln.count)*cn;Wi!==null&&(_a=Math.max(_a,Wi.start*cn),ll=Math.min(ll,(Wi.start+Wi.count)*cn)),Vr!==null?(_a=Math.max(_a,0),ll=Math.min(ll,Vr.count)):In!=null&&(_a=Math.max(_a,0),ll=Math.min(ll,In.count));const Kl=ll-_a;if(Kl<0||Kl===1/0)return;En.setup(Ot,Ft,Br,Vt,Vr);let cl,_s=Qn;if(Vr!==null&&(cl=ha.get(Vr),_s=cr,_s.setIndex(cl)),Ot.isMesh)Ft.wireframe===!0?(ci.setLineWidth(Ft.wireframeLinewidth*Xi()),_s.setMode(it.LINES)):_s.setMode(it.TRIANGLES);else if(Ot.isLine){let Dh=Ft.linewidth;Dh===void 0&&(Dh=1),ci.setLineWidth(Dh*Xi()),Ot.isLineSegments?_s.setMode(it.LINES):Ot.isLineLoop?_s.setMode(it.LINE_LOOP):_s.setMode(it.LINE_STRIP)}else Ot.isPoints?_s.setMode(it.POINTS):Ot.isSprite&&_s.setMode(it.TRIANGLES);if(Ot.isBatchedMesh)Ot._multiDrawInstances!==null?_s.renderMultiDrawInstances(Ot._multiDrawStarts,Ot._multiDrawCounts,Ot._multiDrawCount,Ot._multiDrawInstances):_s.renderMultiDraw(Ot._multiDrawStarts,Ot._multiDrawCounts,Ot._multiDrawCount);else if(Ot.isInstancedMesh)_s.renderInstances(_a,Kl,Ot.count);else if(Vt.isInstancedBufferGeometry){const Dh=Vt._maxInstanceCount!==void 0?Vt._maxInstanceCount:1/0,Cn=Math.min(Vt.instanceCount,Dh);_s.renderInstances(_a,Kl,Cn)}else _s.render(_a,Kl)};function vn(Ve,Et,Vt){Ve.transparent===!0&&Ve.side===B&&Ve.forceSinglePass===!1?(Ve.side=R,Ve.needsUpdate=!0,l2(Ve,Et,Vt),Ve.side=T,Ve.needsUpdate=!0,l2(Ve,Et,Vt),Ve.side=B):l2(Ve,Et,Vt)}this.compile=function(Ve,Et,Vt=null){Vt===null&&(Vt=Ve),ee=pi.get(Vt),ee.init(Et),we.push(ee),Vt.traverseVisible(function(Ot){Ot.isLight&&Ot.layers.test(Et.layers)&&(ee.pushLight(Ot),Ot.castShadow&&ee.pushShadow(Ot))}),Ve!==Vt&&Ve.traverseVisible(function(Ot){Ot.isLight&&Ot.layers.test(Et.layers)&&(ee.pushLight(Ot),Ot.castShadow&&ee.pushShadow(Ot))}),ee.setupLights(xe._useLegacyLights);const Ft=new Set;return Ve.traverse(function(Ot){const Wi=Ot.material;if(Wi)if(Array.isArray(Wi))for(let Nr=0;Nr<Wi.length;Nr++){const Br=Wi[Nr];vn(Br,Vt,Ot),Ft.add(Br)}else vn(Wi,Vt,Ot),Ft.add(Wi)}),we.pop(),ee=null,Ft},this.compileAsync=function(Ve,Et,Vt=null){const Ft=this.compile(Ve,Et,Vt);return new Promise(Ot=>{function Wi(){if(Ft.forEach(function(Nr){ir.get(Nr).currentProgram.isReady()&&Ft.delete(Nr)}),Ft.size===0){Ot(Ve);return}setTimeout(Wi,10)}ii.get("KHR_parallel_shader_compile")!==null?Wi():setTimeout(Wi,10)})};let Ir=null;function Xl(Ve){Ir&&Ir(Ve)}function du(){zf.stop()}function PH(){zf.start()}const zf=new _N;zf.setAnimationLoop(Xl),typeof self<"u"&&zf.setContext(self),this.setAnimationLoop=function(Ve){Ir=Ve,xi.setAnimationLoop(Ve),Ve===null?zf.stop():zf.start()},xi.addEventListener("sessionstart",du),xi.addEventListener("sessionend",PH),this.render=function(Ve,Et){if(Et!==void 0&&Et.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(st===!0)return;Ve.matrixWorldAutoUpdate===!0&&Ve.updateMatrixWorld(),Et.parent===null&&Et.matrixWorldAutoUpdate===!0&&Et.updateMatrixWorld(),xi.enabled===!0&&xi.isPresenting===!0&&(xi.cameraAutoUpdate===!0&&xi.updateCamera(Et),Et=xi.getCamera()),Ve.isScene===!0&&Ve.onBeforeRender(xe,Ve,Et,rt),ee=pi.get(Ve,we.length),ee.init(Et),we.push(ee),Cr.multiplyMatrices(Et.projectionMatrix,Et.matrixWorldInverse),ps.setFromProjectionMatrix(Cr),Nn=this.localClippingEnabled,jn=Ai.init(this.clippingPlanes,Nn),ne=jt.get(Ve,Me.length),ne.init(),Me.push(ne),kH(Ve,Et,0,xe.sortObjects),ne.finish(),xe.sortObjects===!0&&ne.sort(bi,Pi);const Vt=xi.enabled===!1||xi.isPresenting===!1||xi.hasDepthSensing()===!1;Vt&&ji.addToRenderList(ne,Ve),this.info.render.frame++,jn===!0&&Ai.beginShadows();const Ft=ee.state.shadowsArray;li.render(Ft,Ve,Et),jn===!0&&Ai.endShadows(),this.info.autoReset===!0&&this.info.reset();const Ot=ne.opaque,Wi=ne.transmissive;if(ee.setupLights(xe._useLegacyLights),Et.isArrayCamera){const Nr=Et.cameras;if(Wi.length>0)for(let Br=0,Vr=Nr.length;Br<Vr;Br++){const cn=Nr[Br];FH(Ot,Wi,Ve,cn)}if(Vt&&ji.render(Ve),xi.enabled&&xi.isMultiview)yr.setDeferTextureUploads(!0),_L(ne,Ve,Et,Et.cameras[0].viewport);else for(let Br=0,Vr=Nr.length;Br<Vr;Br++){const cn=Nr[Br];_L(ne,Ve,cn,cn.viewport)}}else Wi.length>0&&FH(Ot,Wi,Ve,Et),Vt&&ji.render(Ve),_L(ne,Ve,Et);rt!==null&&(yr.updateMultisampleRenderTarget(rt),yr.updateRenderTargetMipmap(rt)),Ve.isScene===!0&&Ve.onAfterRender(xe,Ve,Et),yr.runDeferredUploads(),xi.enabled&&xi.submitFrame&&xi.submitFrame(),En.resetDefaultState(),ze=-1,De=null,we.pop(),we.length>0?(ee=we[we.length-1],jn===!0&&Ai.setGlobalState(xe.clippingPlanes,ee.state.camera)):ee=null,Me.pop(),Me.length>0?ne=Me[Me.length-1]:ne=null};function kH(Ve,Et,Vt,Ft){if(Ve.visible===!1)return;if(Ve.layers.test(Et.layers)){if(Ve.isGroup)Vt=Ve.renderOrder;else if(Ve.isLOD)Ve.autoUpdate===!0&&Ve.update(Et);else if(Ve.isLight)ee.pushLight(Ve),Ve.castShadow&&ee.pushShadow(Ve);else if(Ve.isSprite){if(!Ve.frustumCulled||ps.intersectsSprite(Ve)){Ft&&di.setFromMatrixPosition(Ve.matrixWorld).applyMatrix4(Cr);const Wi=Wn.update(Ve),Nr=Ve.material;Nr.visible&&ne.push(Ve,Wi,Nr,Vt,di.z,null)}}else if((Ve.isMesh||Ve.isLine||Ve.isPoints)&&(!Ve.frustumCulled||ps.intersectsObject(Ve))){const Wi=Wn.update(Ve),Nr=Ve.material;if(Ft&&(Ve.boundingSphere!==void 0?(Ve.boundingSphere===null&&Ve.computeBoundingSphere(),di.copy(Ve.boundingSphere.center)):(Wi.boundingSphere===null&&Wi.computeBoundingSphere(),di.copy(Wi.boundingSphere.center)),di.applyMatrix4(Ve.matrixWorld).applyMatrix4(Cr)),Array.isArray(Nr)){const Br=Wi.groups;for(let Vr=0,cn=Br.length;Vr<cn;Vr++){const Ln=Br[Vr],In=Nr[Ln.materialIndex];In&&In.visible&&ne.push(Ve,Wi,In,Vt,di.z,Ln)}}else Nr.visible&&ne.push(Ve,Wi,Nr,Vt,di.z,null)}}const Ot=Ve.children;for(let Wi=0,Nr=Ot.length;Wi<Nr;Wi++)kH(Ot[Wi],Et,Vt,Ft)}function _L(Ve,Et,Vt,Ft){const Ot=Ve.opaque,Wi=Ve.transmissive,Nr=Ve.transparent;ee.setupLightsView(Vt),jn===!0&&Ai.setGlobalState(xe.clippingPlanes,Vt),Ft&&ci.viewport(nt.copy(Ft)),Ot.length>0&&o2(Ot,Et,Vt),Wi.length>0&&o2(Wi,Et,Vt),Nr.length>0&&o2(Nr,Et,Vt),ci.buffers.depth.setTest(!0),ci.buffers.depth.setMask(!0),ci.buffers.color.setMask(!0),ci.setPolygonOffset(!1)}function FH(Ve,Et,Vt,Ft){if((Vt.isScene===!0?Vt.overrideMaterial:null)!==null)return;ee.state.transmissionRenderTarget[Ft.id]===void 0&&(ee.state.transmissionRenderTarget[Ft.id]=new rl(1,1,{generateMipmaps:!0,type:ii.has("EXT_color_buffer_half_float")||ii.has("EXT_color_buffer_float")?Jt:An,minFilter:nn,samples:4,stencilBuffer:w,resolveDepthBuffer:!1,resolveStencilBuffer:!1}));const Ot=ee.state.transmissionRenderTarget[Ft.id],Wi=Ft.viewport||nt;Ot.setSize(Wi.z,Wi.w);const Nr=xe.getRenderTarget();xe.setRenderTarget(Ot),xe.getClearColor(Rt),Ut=xe.getClearAlpha(),Ut<1&&xe.setClearColor(16777215,.5),xe.clear();const Br=xe.toneMapping;xe.toneMapping=Pt;const Vr=Ft.viewport;if(Ft.viewport!==void 0&&(Ft.viewport=void 0),ee.setupLightsView(Ft),jn===!0&&Ai.setGlobalState(xe.clippingPlanes,Ft),o2(Ve,Vt,Ft),yr.updateMultisampleRenderTarget(Ot),yr.updateRenderTargetMipmap(Ot),ii.has("WEBGL_multisampled_render_to_texture")===!1){let cn=!1;for(let Ln=0,In=Et.length;Ln<In;Ln++){const _a=Et[Ln],ll=_a.object,Kl=_a.geometry,cl=_a.material,_s=_a.group;if(cl.side===B&&ll.layers.test(Ft.layers)){const Dh=cl.side;cl.side=R,cl.needsUpdate=!0,UH(ll,Vt,Ft,Kl,cl,_s),cl.side=Dh,cl.needsUpdate=!0,cn=!0}}cn===!0&&(yr.updateMultisampleRenderTarget(Ot),yr.updateRenderTargetMipmap(Ot))}xe.setRenderTarget(Nr),xe.setClearColor(Rt,Ut),Vr!==void 0&&(Ft.viewport=Vr),xe.toneMapping=Br}function o2(Ve,Et,Vt){const Ft=Et.isScene===!0?Et.overrideMaterial:null;for(let Ot=0,Wi=Ve.length;Ot<Wi;Ot++){const Nr=Ve[Ot],Br=Nr.object,Vr=Nr.geometry,cn=Ft===null?Nr.material:Ft,Ln=Nr.group;Br.layers.test(Vt.layers)&&UH(Br,Et,Vt,Vr,cn,Ln)}}function UH(Ve,Et,Vt,Ft,Ot,Wi){Ve.onBeforeRender(xe,Et,Vt,Ft,Ot,Wi),Ve.modelViewMatrix.multiplyMatrices(Vt.matrixWorldInverse,Ve.matrixWorld),Ve.normalMatrix.getNormalMatrix(Ve.modelViewMatrix),Ot.onBeforeRender(xe,Et,Vt,Ft,Ve,Wi),Ot.transparent===!0&&Ot.side===B&&Ot.forceSinglePass===!1?(Ot.side=R,Ot.needsUpdate=!0,xe.renderBufferDirect(Vt,Et,Ft,Ot,Ve,Wi),Ot.side=T,Ot.needsUpdate=!0,xe.renderBufferDirect(Vt,Et,Ft,Ot,Ve,Wi),Ot.side=B):xe.renderBufferDirect(Vt,Et,Ft,Ot,Ve,Wi),Ve.onAfterRender(xe,Et,Vt,Ft,Ot,Wi)}function l2(Ve,Et,Vt){Et.isScene!==!0&&(Et=Ci);const Ft=ir.get(Ve),Ot=ee.state.lights,Wi=ee.state.shadowsArray,Nr=Ot.state.version,Br=et.getParameters(Ve,Ot.state,Wi,Et,Vt),Vr=et.getProgramCacheKey(Br);let cn=Ft.programs;Ft.environment=Ve.isMeshStandardMaterial?Et.environment:null,Ft.fog=Et.fog,Ft.envMap=(Ve.isMeshStandardMaterial?Wr:yn).get(Ve.envMap||Ft.environment),Ft.envMapRotation=Ft.environment!==null&&Ve.envMap===null?Et.environmentRotation:Ve.envMapRotation,cn===void 0&&(Ve.addEventListener("dispose",ln),cn=new Map,Ft.programs=cn);let Ln=cn.get(Vr);if(Ln!==void 0){if(Ft.currentProgram===Ln&&Ft.lightsStateVersion===Nr)return jH(Ve,Br),Ln}else Br.uniforms=et.getUniforms(Ve),Ve.onBuild(Vt,Br,xe),Ve.onBeforeCompile(Br,xe),Ln=et.acquireProgram(Br,Vr),cn.set(Vr,Ln),Ft.uniforms=Br.uniforms;const In=Ft.uniforms;return(!Ve.isShaderMaterial&&!Ve.isRawShaderMaterial||Ve.clipping===!0)&&(In.clippingPlanes=Ai.uniform),jH(Ve,Br),Ft.needsLights=EBe(Ve),Ft.lightsStateVersion=Nr,Ft.needsLights&&(In.ambientLightColor.value=Ot.state.ambient,In.lightProbe.value=Ot.state.probe,In.directionalLights.value=Ot.state.directional,In.directionalLightShadows.value=Ot.state.directionalShadow,In.spotLights.value=Ot.state.spot,In.spotLightShadows.value=Ot.state.spotShadow,In.rectAreaLights.value=Ot.state.rectArea,In.ltc_1.value=Ot.state.rectAreaLTC1,In.ltc_2.value=Ot.state.rectAreaLTC2,In.pointLights.value=Ot.state.point,In.pointLightShadows.value=Ot.state.pointShadow,In.hemisphereLights.value=Ot.state.hemi,In.directionalShadowMap.value=Ot.state.directionalShadowMap,In.directionalShadowMatrix.value=Ot.state.directionalShadowMatrix,In.spotShadowMap.value=Ot.state.spotShadowMap,In.spotLightMatrix.value=Ot.state.spotLightMatrix,In.spotLightMap.value=Ot.state.spotLightMap,In.pointShadowMap.value=Ot.state.pointShadowMap,In.pointShadowMatrix.value=Ot.state.pointShadowMatrix),Ft.currentProgram=Ln,Ft.uniformsList=null,Ln}function zH(Ve){if(Ve.uniformsList===null){const Et=Ve.currentProgram.getUniforms();Ve.uniformsList=dw.seqWithValue(Et.seq,Ve.uniforms)}return Ve.uniformsList}function jH(Ve,Et){const Vt=ir.get(Ve);Vt.outputColorSpace=Et.outputColorSpace,Vt.batching=Et.batching,Vt.instancing=Et.instancing,Vt.instancingColor=Et.instancingColor,Vt.instancingMorph=Et.instancingMorph,Vt.skinning=Et.skinning,Vt.morphTargets=Et.morphTargets,Vt.morphNormals=Et.morphNormals,Vt.morphColors=Et.morphColors,Vt.morphTargetsCount=Et.morphTargetsCount,Vt.numClippingPlanes=Et.numClippingPlanes,Vt.numIntersection=Et.numClipIntersection,Vt.vertexAlphas=Et.vertexAlphas,Vt.vertexTangents=Et.vertexTangents,Vt.toneMapping=Et.toneMapping,Vt.numMultiviewViews=Et.numMultiviewViews}function xBe(Ve,Et,Vt,Ft,Ot){Et.isScene!==!0&&(Et=Ci),yr.resetTextureUnits();const Wi=Et.fog,Nr=Ft.isMeshStandardMaterial?Et.environment:null,Br=rt===null?xe.outputColorSpace:rt.isXRRenderTarget===!0?rt.texture.colorSpace:Lc,Vr=(Ft.isMeshStandardMaterial?Wr:yn).get(Ft.envMap||Nr),cn=Ft.vertexColors===!0&&!!Vt.attributes.color&&Vt.attributes.color.itemSize===4,Ln=!!Vt.attributes.tangent&&(!!Ft.normalMap||Ft.anisotropy>0),In=!!Vt.morphAttributes.position,_a=!!Vt.morphAttributes.normal,ll=!!Vt.morphAttributes.color;let Kl=Pt;Ft.toneMapped&&(rt===null||rt.isXRRenderTarget===!0)&&(Kl=xe.toneMapping);const cl=rt&&rt.isWebGLMultiviewRenderTarget?rt.numViews:0,_s=Vt.morphAttributes.position||Vt.morphAttributes.normal||Vt.morphAttributes.color,Dh=_s!==void 0?_s.length:0,Cn=ir.get(Ft),wBe=ee.state.lights;if(jn===!0&&(Nn===!0||Ve!==De)){const Yl=Ve===De&&Ft.id===ze;Ai.setState(Ft,Ve,Yl)}let EL=!1;Ft.version===Cn.__version?(Cn.needsLights&&Cn.lightsStateVersion!==wBe.state.version||Cn.outputColorSpace!==Br||Ot.isBatchedMesh&&Cn.batching===!1||!Ot.isBatchedMesh&&Cn.batching===!0||Ot.isInstancedMesh&&Cn.instancing===!1||!Ot.isInstancedMesh&&Cn.instancing===!0||Ot.isSkinnedMesh&&Cn.skinning===!1||!Ot.isSkinnedMesh&&Cn.skinning===!0||Ot.isInstancedMesh&&Cn.instancingColor===!0&&Ot.instanceColor===null||Ot.isInstancedMesh&&Cn.instancingColor===!1&&Ot.instanceColor!==null||Ot.isInstancedMesh&&Cn.instancingMorph===!0&&Ot.morphTexture===null||Ot.isInstancedMesh&&Cn.instancingMorph===!1&&Ot.morphTexture!==null||Cn.envMap!==Vr||Ft.fog===!0&&Cn.fog!==Wi||Cn.numClippingPlanes!==void 0&&(Cn.numClippingPlanes!==Ai.numPlanes||Cn.numIntersection!==Ai.numIntersection)||Cn.vertexAlphas!==cn||Cn.vertexTangents!==Ln||Cn.morphTargets!==In||Cn.morphNormals!==_a||Cn.morphColors!==ll||Cn.toneMapping!==Kl||Cn.morphTargetsCount!==Dh||Cn.numMultiviewViews!==cl)&&(EL=!0):(EL=!0,Cn.__version=Ft.version);let Oh=Cn.currentProgram;EL===!0&&(Oh=l2(Ft,Et,Ot));let GH=!1,Yv=!1,wL=!1;const Ea=Oh.getUniforms(),$d=Cn.uniforms;if(ci.useProgram(Oh.program)&&(GH=!0,Yv=!0,wL=!0),Ft.id!==ze&&(ze=Ft.id,Yv=!0),GH||De!==Ve){Oh.numMultiviewViews>0?(Rr.updateCameraProjectionMatricesUniform(Ve,Ea),Rr.updateCameraViewMatricesUniform(Ve,Ea)):(Ea.setValue(it,"projectionMatrix",Ve.projectionMatrix),Ea.setValue(it,"viewMatrix",Ve.matrixWorldInverse));const Yl=Ea.map.cameraPosition;Yl!==void 0&&Yl.setValue(it,di.setFromMatrixPosition(Ve.matrixWorld)),tr.logarithmicDepthBuffer&&Ea.setValue(it,"logDepthBufFC",2/(Math.log(Ve.far+1)/Math.LN2)),(Ft.isMeshPhongMaterial||Ft.isMeshToonMaterial||Ft.isMeshLambertMaterial||Ft.isMeshBasicMaterial||Ft.isMeshStandardMaterial||Ft.isShaderMaterial)&&Ea.setValue(it,"isOrthographic",Ve.isOrthographicCamera===!0),De!==Ve&&(De=Ve,Yv=!0,wL=!0)}if(Ot.isSkinnedMesh){Ea.setOptional(it,Ot,"bindMatrix"),Ea.setOptional(it,Ot,"bindMatrixInverse");const Yl=Ot.skeleton;Yl&&(Yl.boneTexture===null&&Yl.computeBoneTexture(),Ea.setValue(it,"boneTexture",Yl.boneTexture,yr))}Ot.isBatchedMesh&&(Ea.setOptional(it,Ot,"batchingTexture"),Ea.setValue(it,"batchingTexture",Ot._matricesTexture,yr));const CL=Vt.morphAttributes;if((CL.position!==void 0||CL.normal!==void 0||CL.color!==void 0)&&ur.update(Ot,Vt,Oh),(Yv||Cn.receiveShadow!==Ot.receiveShadow)&&(Cn.receiveShadow=Ot.receiveShadow,Ea.setValue(it,"receiveShadow",Ot.receiveShadow)),Ft.isMeshGouraudMaterial&&Ft.envMap!==null&&($d.envMap.value=Vr,$d.flipEnvMap.value=Vr.isCubeTexture&&Vr.isRenderTargetTexture===!1?-1:1),Ft.isMeshStandardMaterial&&Ft.envMap===null&&Et.environment!==null&&($d.envMapIntensity.value=Et.environmentIntensity),Yv&&(Ea.setValue(it,"toneMappingExposure",xe.toneMappingExposure),Cn.needsLights&&_Be($d,wL),Wi&&Ft.fog===!0&&Le.refreshFogUniforms($d,Wi),Le.refreshMaterialUniforms($d,Ft,zt,Oi,ee.state.transmissionRenderTarget[Ve.id]),dw.upload(it,zH(Cn),$d,yr)),Ft.isShaderMaterial&&Ft.uniformsNeedUpdate===!0&&(dw.upload(it,zH(Cn),$d,yr),Ft.uniformsNeedUpdate=!1),Ft.isSpriteMaterial&&Ea.setValue(it,"center",Ot.center),Oh.numMultiviewViews>0?Rr.updateObjectMatricesUniforms(Ot,Ve,Ea):(Ea.setValue(it,"modelViewMatrix",Ot.modelViewMatrix),Ea.setValue(it,"normalMatrix",Ot.normalMatrix)),Ea.setValue(it,"modelMatrix",Ot.matrixWorld),Ft.isShaderMaterial||Ft.isRawShaderMaterial){const Yl=Ft.uniformsGroups;for(let SL=0,CBe=Yl.length;SL<CBe;SL++){const VH=Yl[SL];zr.update(VH,Oh),zr.bind(VH,Oh)}}return Oh}function _Be(Ve,Et){Ve.ambientLightColor.needsUpdate=Et,Ve.lightProbe.needsUpdate=Et,Ve.directionalLights.needsUpdate=Et,Ve.directionalLightShadows.needsUpdate=Et,Ve.pointLights.needsUpdate=Et,Ve.pointLightShadows.needsUpdate=Et,Ve.spotLights.needsUpdate=Et,Ve.spotLightShadows.needsUpdate=Et,Ve.rectAreaLights.needsUpdate=Et,Ve.hemisphereLights.needsUpdate=Et}function EBe(Ve){return Ve.isMeshLambertMaterial||Ve.isMeshToonMaterial||Ve.isMeshPhongMaterial||Ve.isMeshStandardMaterial||Ve.isShadowMaterial||Ve.isShaderMaterial&&Ve.lights===!0}this.setTexture2D=function(){var Ve=!1;return function(Et,Vt){Et&&Et.isWebGLRenderTarget&&(Ve||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),Ve=!0),Et=Et.texture),yr.setTexture2D(Et,Vt)}}(),this.getActiveCubeFace=function(){return Qe},this.getActiveMipmapLevel=function(){return Ze},this.getRenderTarget=function(){return rt},this.setRenderTargetTextures=function(Ve,Et,Vt){ir.get(Ve.texture).__webglTexture=Et,ir.get(Ve.depthTexture).__webglTexture=Vt;const Ft=ir.get(Ve);Ft.__hasExternalTextures=!0,Ft.__autoAllocateDepthBuffer=Vt===void 0,!Ft.__autoAllocateDepthBuffer&&(!rt||!rt.isWebGLMultiviewRenderTarget)&&ii.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Ft.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(Ve,Et){const Vt=ir.get(Ve);Vt.__webglFramebuffer=Et,Vt.__useDefaultFramebuffer=Et===void 0},this.setRenderTarget=function(Ve,Et=0,Vt=0){rt=Ve,Qe=Et,Ze=Vt;let Ft=!0,Ot=null,Wi=!1,Nr=!1;if(Ve){const Br=ir.get(Ve);Br.__useDefaultFramebuffer!==void 0?(ci.bindFramebuffer(it.FRAMEBUFFER,null),Ft=!1):Br.__webglFramebuffer===void 0?yr.setupRenderTarget(Ve):Br.__hasExternalTextures&&yr.rebindTextures(Ve,ir.get(Ve.texture).__webglTexture,ir.get(Ve.depthTexture).__webglTexture);const Vr=Ve.texture;(Vr.isData3DTexture||Vr.isDataArrayTexture||Vr.isCompressedArrayTexture)&&(Nr=!0);const cn=ir.get(Ve).__webglFramebuffer;Ve.isWebGLCubeRenderTarget?(Array.isArray(cn[Et])?Ot=cn[Et][Vt]:Ot=cn[Et],Wi=!0):Ve.samples>0&&yr.useMultisampledRTT(Ve)===!1?Ot=ir.get(Ve).__webglMultisampledFramebuffer:Array.isArray(cn)?Ot=cn[Vt]:Ot=cn,nt.copy(Ve.viewport),gt.copy(Ve.scissor),ft=Ve.scissorTest}else nt.copy(Ur).multiplyScalar(zt).floor(),gt.copy(_n).multiplyScalar(zt).floor(),ft=is;if(ci.bindFramebuffer(it.FRAMEBUFFER,Ot)&&Ft&&ci.drawBuffers(Ve,Ot),ci.viewport(nt),ci.scissor(gt),ci.setScissorTest(ft),Wi){const Br=ir.get(Ve.texture);it.framebufferTexture2D(it.FRAMEBUFFER,it.COLOR_ATTACHMENT0,it.TEXTURE_CUBE_MAP_POSITIVE_X+Et,Br.__webglTexture,Vt)}else if(Nr){const Br=ir.get(Ve.texture),Vr=Et||0;it.framebufferTextureLayer(it.FRAMEBUFFER,it.COLOR_ATTACHMENT0,Br.__webglTexture,Vt||0,Vr)}ze=-1},this.readRenderTargetPixels=function(Ve,Et,Vt,Ft,Ot,Wi,Nr){if(!(Ve&&Ve.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Br=ir.get(Ve).__webglFramebuffer;if(Ve.isWebGLCubeRenderTarget&&Nr!==void 0&&(Br=Br[Nr]),Br){ci.bindFramebuffer(it.FRAMEBUFFER,Br);try{const Vr=Ve.texture,cn=Vr.format,Ln=Vr.type;if(!tr.textureFormatReadable(cn)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!tr.textureTypeReadable(Ln)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Et>=0&&Et<=Ve.width-Ft&&Vt>=0&&Vt<=Ve.height-Ot&&it.readPixels(Et,Vt,Ft,Ot,Er.convert(cn),Er.convert(Ln),Wi)}finally{const Vr=rt!==null?ir.get(rt).__webglFramebuffer:null;ci.bindFramebuffer(it.FRAMEBUFFER,Vr)}}},this.copyFramebufferToTexture=function(Ve,Et,Vt=0){const Ft=Math.pow(2,-Vt),Ot=Math.floor(Et.image.width*Ft),Wi=Math.floor(Et.image.height*Ft);yr.setTexture2D(Et,0),it.copyTexSubImage2D(it.TEXTURE_2D,Vt,0,0,Ve.x,Ve.y,Ot,Wi),ci.unbindTexture()},this.copyTextureToTexture=function(Ve,Et,Vt,Ft=0){const Ot=Et.image.width,Wi=Et.image.height,Nr=Er.convert(Vt.format),Br=Er.convert(Vt.type);yr.setTexture2D(Vt,0),it.pixelStorei(it.UNPACK_FLIP_Y_WEBGL,Vt.flipY),it.pixelStorei(it.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Vt.premultiplyAlpha),it.pixelStorei(it.UNPACK_ALIGNMENT,Vt.unpackAlignment),Et.isDataTexture?it.texSubImage2D(it.TEXTURE_2D,Ft,Ve.x,Ve.y,Ot,Wi,Nr,Br,Et.image.data):Et.isCompressedTexture?it.compressedTexSubImage2D(it.TEXTURE_2D,Ft,Ve.x,Ve.y,Et.mipmaps[0].width,Et.mipmaps[0].height,Nr,Et.mipmaps[0].data):it.texSubImage2D(it.TEXTURE_2D,Ft,Ve.x,Ve.y,Nr,Br,Et.image),Ft===0&&Vt.generateMipmaps&&it.generateMipmap(it.TEXTURE_2D),ci.unbindTexture()},this.copyTextureToTexture3D=function(Ve,Et,Vt,Ft,Ot=0){const Wi=Ve.max.x-Ve.min.x,Nr=Ve.max.y-Ve.min.y,Br=Ve.max.z-Ve.min.z,Vr=Er.convert(Ft.format),cn=Er.convert(Ft.type);let Ln;if(Ft.isData3DTexture)yr.setTexture3D(Ft,0),Ln=it.TEXTURE_3D;else if(Ft.isDataArrayTexture||Ft.isCompressedArrayTexture)yr.setTexture2DArray(Ft,0),Ln=it.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}it.pixelStorei(it.UNPACK_FLIP_Y_WEBGL,Ft.flipY),it.pixelStorei(it.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ft.premultiplyAlpha),it.pixelStorei(it.UNPACK_ALIGNMENT,Ft.unpackAlignment);const In=it.getParameter(it.UNPACK_ROW_LENGTH),_a=it.getParameter(it.UNPACK_IMAGE_HEIGHT),ll=it.getParameter(it.UNPACK_SKIP_PIXELS),Kl=it.getParameter(it.UNPACK_SKIP_ROWS),cl=it.getParameter(it.UNPACK_SKIP_IMAGES),_s=Vt.isCompressedTexture?Vt.mipmaps[Ot]:Vt.image;it.pixelStorei(it.UNPACK_ROW_LENGTH,_s.width),it.pixelStorei(it.UNPACK_IMAGE_HEIGHT,_s.height),it.pixelStorei(it.UNPACK_SKIP_PIXELS,Ve.min.x),it.pixelStorei(it.UNPACK_SKIP_ROWS,Ve.min.y),it.pixelStorei(it.UNPACK_SKIP_IMAGES,Ve.min.z),Vt.isDataTexture||Vt.isData3DTexture?it.texSubImage3D(Ln,Ot,Et.x,Et.y,Et.z,Wi,Nr,Br,Vr,cn,_s.data):Ft.isCompressedArrayTexture?it.compressedTexSubImage3D(Ln,Ot,Et.x,Et.y,Et.z,Wi,Nr,Br,Vr,_s.data):it.texSubImage3D(Ln,Ot,Et.x,Et.y,Et.z,Wi,Nr,Br,Vr,cn,_s),it.pixelStorei(it.UNPACK_ROW_LENGTH,In),it.pixelStorei(it.UNPACK_IMAGE_HEIGHT,_a),it.pixelStorei(it.UNPACK_SKIP_PIXELS,ll),it.pixelStorei(it.UNPACK_SKIP_ROWS,Kl),it.pixelStorei(it.UNPACK_SKIP_IMAGES,cl),Ot===0&&Ft.generateMipmaps&&it.generateMipmap(Ln),ci.unbindTexture()},this.initTexture=function(Ve){Ve.isCubeTexture?yr.setTextureCube(Ve,0):Ve.isData3DTexture?yr.setTexture3D(Ve,0):Ve.isDataArrayTexture||Ve.isCompressedArrayTexture?yr.setTexture2DArray(Ve,0):yr.setTexture2D(Ve,0),ci.unbindTexture()},this.resetState=function(){Qe=0,Ze=0,rt=null,ci.reset(),En.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Wl}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(a){this._outputColorSpace=a;const d=this.getContext();d.drawingBufferColorSpace=a===r0?"display-p3":"srgb",d.unpackColorSpace=Yn.workingColorSpace===df?"display-p3":"srgb"}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(a){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=a}}class pw{constructor(a,d=25e-5){this.isFogExp2=!0,this.name="",this.color=new lr(a),this.density=d}clone(){return new pw(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class fw{constructor(a,d=1,A=1e3){this.isFog=!0,this.name="",this.color=new lr(a),this.near=d,this.far=A}clone(){return new fw(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class YG extends Hn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Rl,this.environmentIntensity=1,this.environmentRotation=new Rl,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(a,d){return super.copy(a,d),a.background!==null&&(this.background=a.background.clone()),a.environment!==null&&(this.environment=a.environment.clone()),a.fog!==null&&(this.fog=a.fog.clone()),this.backgroundBlurriness=a.backgroundBlurriness,this.backgroundIntensity=a.backgroundIntensity,this.backgroundRotation.copy(a.backgroundRotation),this.environmentIntensity=a.environmentIntensity,this.environmentRotation.copy(a.environmentRotation),a.overrideMaterial!==null&&(this.overrideMaterial=a.overrideMaterial.clone()),this.matrixAutoUpdate=a.matrixAutoUpdate,this}toJSON(a){const d=super.toJSON(a);return this.fog!==null&&(d.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(d.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(d.object.backgroundIntensity=this.backgroundIntensity),d.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(d.object.environmentIntensity=this.environmentIntensity),d.object.environmentRotation=this.environmentRotation.toArray(),d}}class mw{constructor(a,d){this.isInterleavedBuffer=!0,this.array=a,this.stride=d,this.count=a!==void 0?a.length/d:0,this.usage=gf,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=No()}onUploadCallback(){}set needsUpdate(a){a===!0&&this.version++}get updateRange(){return GE("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(a){return this.usage=a,this}addUpdateRange(a,d){this.updateRanges.push({start:a,count:d})}clearUpdateRanges(){this.updateRanges.length=0}copy(a){return this.array=new a.array.constructor(a.array),this.count=a.count,this.stride=a.stride,this.usage=a.usage,this}copyAt(a,d,A){a*=this.stride,A*=d.stride;for(let x=0,w=this.stride;x<w;x++)this.array[a+x]=d.array[A+x];return this}set(a,d=0){return this.array.set(a,d),this}clone(a){a.arrayBuffers===void 0&&(a.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=No()),a.arrayBuffers[this.array.buffer._uuid]===void 0&&(a.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const d=new this.array.constructor(a.arrayBuffers[this.array.buffer._uuid]),A=new this.constructor(d,this.stride);return A.setUsage(this.usage),A}onUpload(a){return this.onUploadCallback=a,this}toJSON(a){return a.arrayBuffers===void 0&&(a.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=No()),a.arrayBuffers[this.array.buffer._uuid]===void 0&&(a.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Oo=new He;class Mf{constructor(a,d,A,x=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=a,this.itemSize=d,this.offset=A,this.normalized=x}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(a){this.data.needsUpdate=a}applyMatrix4(a){for(let d=0,A=this.data.count;d<A;d++)Oo.fromBufferAttribute(this,d),Oo.applyMatrix4(a),this.setXYZ(d,Oo.x,Oo.y,Oo.z);return this}applyNormalMatrix(a){for(let d=0,A=this.count;d<A;d++)Oo.fromBufferAttribute(this,d),Oo.applyNormalMatrix(a),this.setXYZ(d,Oo.x,Oo.y,Oo.z);return this}transformDirection(a){for(let d=0,A=this.count;d<A;d++)Oo.fromBufferAttribute(this,d),Oo.transformDirection(a),this.setXYZ(d,Oo.x,Oo.y,Oo.z);return this}getComponent(a,d){let A=this.array[a*this.data.stride+this.offset+d];return this.normalized&&(A=Ka(A,this.array)),A}setComponent(a,d,A){return this.normalized&&(A=Yr(A,this.array)),this.data.array[a*this.data.stride+this.offset+d]=A,this}setX(a,d){return this.normalized&&(d=Yr(d,this.array)),this.data.array[a*this.data.stride+this.offset]=d,this}setY(a,d){return this.normalized&&(d=Yr(d,this.array)),this.data.array[a*this.data.stride+this.offset+1]=d,this}setZ(a,d){return this.normalized&&(d=Yr(d,this.array)),this.data.array[a*this.data.stride+this.offset+2]=d,this}setW(a,d){return this.normalized&&(d=Yr(d,this.array)),this.data.array[a*this.data.stride+this.offset+3]=d,this}getX(a){let d=this.data.array[a*this.data.stride+this.offset];return this.normalized&&(d=Ka(d,this.array)),d}getY(a){let d=this.data.array[a*this.data.stride+this.offset+1];return this.normalized&&(d=Ka(d,this.array)),d}getZ(a){let d=this.data.array[a*this.data.stride+this.offset+2];return this.normalized&&(d=Ka(d,this.array)),d}getW(a){let d=this.data.array[a*this.data.stride+this.offset+3];return this.normalized&&(d=Ka(d,this.array)),d}setXY(a,d,A){return a=a*this.data.stride+this.offset,this.normalized&&(d=Yr(d,this.array),A=Yr(A,this.array)),this.data.array[a+0]=d,this.data.array[a+1]=A,this}setXYZ(a,d,A,x){return a=a*this.data.stride+this.offset,this.normalized&&(d=Yr(d,this.array),A=Yr(A,this.array),x=Yr(x,this.array)),this.data.array[a+0]=d,this.data.array[a+1]=A,this.data.array[a+2]=x,this}setXYZW(a,d,A,x,w){return a=a*this.data.stride+this.offset,this.normalized&&(d=Yr(d,this.array),A=Yr(A,this.array),x=Yr(x,this.array),w=Yr(w,this.array)),this.data.array[a+0]=d,this.data.array[a+1]=A,this.data.array[a+2]=x,this.data.array[a+3]=w,this}clone(a){if(a===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const d=[];for(let A=0;A<this.count;A++){const x=A*this.data.stride+this.offset;for(let w=0;w<this.itemSize;w++)d.push(this.data.array[x+w])}return new as(new this.array.constructor(d),this.itemSize,this.normalized)}else return a.interleavedBuffers===void 0&&(a.interleavedBuffers={}),a.interleavedBuffers[this.data.uuid]===void 0&&(a.interleavedBuffers[this.data.uuid]=this.data.clone(a)),new Mf(a.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(a){if(a===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const d=[];for(let A=0;A<this.count;A++){const x=A*this.data.stride+this.offset;for(let w=0;w<this.itemSize;w++)d.push(this.data.array[x+w])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:d,normalized:this.normalized}}else return a.interleavedBuffers===void 0&&(a.interleavedBuffers={}),a.interleavedBuffers[this.data.uuid]===void 0&&(a.interleavedBuffers[this.data.uuid]=this.data.toJSON(a)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class kN extends fo{constructor(a){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new lr(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.map=a.map,this.alphaMap=a.alphaMap,this.rotation=a.rotation,this.sizeAttenuation=a.sizeAttenuation,this.fog=a.fog,this}}let T0;const Mv=new He,M0=new He,R0=new He,I0=new oi,Rv=new oi,JG=new mr,gw=new He,Iv=new He,Aw=new He,ZG=new oi,FN=new oi,$G=new oi;class eV extends Hn{constructor(a=new kN){if(super(),this.isSprite=!0,this.type="Sprite",T0===void 0){T0=new pn;const d=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),A=new mw(d,5);T0.setIndex([0,1,2,0,2,3]),T0.setAttribute("position",new Mf(A,3,0,!1)),T0.setAttribute("uv",new Mf(A,2,3,!1))}this.geometry=T0,this.material=a,this.center=new oi(.5,.5)}raycast(a,d){a.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),M0.setFromMatrixScale(this.matrixWorld),JG.copy(a.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(a.camera.matrixWorldInverse,this.matrixWorld),R0.setFromMatrixPosition(this.modelViewMatrix),a.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&M0.multiplyScalar(-R0.z);const A=this.material.rotation;let x,w;A!==0&&(w=Math.cos(A),x=Math.sin(A));const M=this.center;yw(gw.set(-.5,-.5,0),R0,M,M0,x,w),yw(Iv.set(.5,-.5,0),R0,M,M0,x,w),yw(Aw.set(.5,.5,0),R0,M,M0,x,w),ZG.set(0,0),FN.set(1,0),$G.set(1,1);let N=a.ray.intersectTriangle(gw,Iv,Aw,!1,Mv);if(N===null&&(yw(Iv.set(-.5,.5,0),R0,M,M0,x,w),FN.set(0,1),N=a.ray.intersectTriangle(gw,Aw,Iv,!1,Mv),N===null))return;const P=a.ray.origin.distanceTo(Mv);P<a.near||P>a.far||d.push({distance:P,point:Mv.clone(),uv:Il.getInterpolation(Mv,gw,Iv,Aw,ZG,FN,$G,new oi),face:null,object:this})}copy(a,d){return super.copy(a,d),a.center!==void 0&&this.center.copy(a.center),this.material=a.material,this}}function yw(S,a,d,A,x,w){I0.subVectors(S,d).addScalar(.5).multiply(A),x!==void 0?(Rv.x=w*I0.x-x*I0.y,Rv.y=x*I0.x+w*I0.y):Rv.copy(I0),S.copy(a),S.x+=Rv.x,S.y+=Rv.y,S.applyMatrix4(JG)}const vw=new He,tV=new He;class iV extends Hn{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(a){super.copy(a,!1);const d=a.levels;for(let A=0,x=d.length;A<x;A++){const w=d[A];this.addLevel(w.object.clone(),w.distance,w.hysteresis)}return this.autoUpdate=a.autoUpdate,this}addLevel(a,d=0,A=0){d=Math.abs(d);const x=this.levels;let w;for(w=0;w<x.length&&!(d<x[w].distance);w++);return x.splice(w,0,{distance:d,hysteresis:A,object:a}),this.add(a),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(a){const d=this.levels;if(d.length>0){let A,x;for(A=1,x=d.length;A<x;A++){let w=d[A].distance;if(d[A].object.visible&&(w-=w*d[A].hysteresis),a<w)break}return d[A-1].object}return null}raycast(a,d){if(this.levels.length>0){vw.setFromMatrixPosition(this.matrixWorld);const A=a.ray.origin.distanceTo(vw);this.getObjectForDistance(A).raycast(a,d)}}update(a){const d=this.levels;if(d.length>1){vw.setFromMatrixPosition(a.matrixWorld),tV.setFromMatrixPosition(this.matrixWorld);const A=vw.distanceTo(tV)/a.zoom;d[0].object.visible=!0;let x,w;for(x=1,w=d.length;x<w;x++){let M=d[x].distance;if(d[x].object.visible&&(M-=M*d[x].hysteresis),A>=M)d[x-1].object.visible=!1,d[x].object.visible=!0;else break}for(this._currentLevel=x-1;x<w;x++)d[x].object.visible=!1}}toJSON(a){const d=super.toJSON(a);this.autoUpdate===!1&&(d.object.autoUpdate=!1),d.object.levels=[];const A=this.levels;for(let x=0,w=A.length;x<w;x++){const M=A[x];d.object.levels.push({object:M.object.uuid,distance:M.distance,hysteresis:M.hysteresis})}return d}}const rV=new He,nV=new Un,sV=new Un,MRe=new He,aV=new mr,bw=new He,UN=new Aa,oV=new mr,zN=new ya;class lV extends ua{constructor(a,d){super(a,d),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=Te,this.bindMatrix=new mr,this.bindMatrixInverse=new mr,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const a=this.geometry;this.boundingBox===null&&(this.boundingBox=new Ls),this.boundingBox.makeEmpty();const d=a.getAttribute("position");for(let A=0;A<d.count;A++)this.getVertexPosition(A,bw),this.boundingBox.expandByPoint(bw)}computeBoundingSphere(){const a=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Aa),this.boundingSphere.makeEmpty();const d=a.getAttribute("position");for(let A=0;A<d.count;A++)this.getVertexPosition(A,bw),this.boundingSphere.expandByPoint(bw)}copy(a,d){return super.copy(a,d),this.bindMode=a.bindMode,this.bindMatrix.copy(a.bindMatrix),this.bindMatrixInverse.copy(a.bindMatrixInverse),this.skeleton=a.skeleton,a.boundingBox!==null&&(this.boundingBox=a.boundingBox.clone()),a.boundingSphere!==null&&(this.boundingSphere=a.boundingSphere.clone()),this}raycast(a,d){const A=this.material,x=this.matrixWorld;A!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),UN.copy(this.boundingSphere),UN.applyMatrix4(x),a.ray.intersectsSphere(UN)!==!1&&(oV.copy(x).invert(),zN.copy(a.ray).applyMatrix4(oV),!(this.boundingBox!==null&&zN.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(a,d,zN)))}getVertexPosition(a,d){return super.getVertexPosition(a,d),this.applyBoneTransform(a,d),d}bind(a,d){this.skeleton=a,d===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),d=this.matrixWorld),this.bindMatrix.copy(d),this.bindMatrixInverse.copy(d).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const a=new Un,d=this.geometry.attributes.skinWeight;for(let A=0,x=d.count;A<x;A++){a.fromBufferAttribute(d,A);const w=1/a.manhattanLength();w!==1/0?a.multiplyScalar(w):a.set(1,0,0,0),d.setXYZW(A,a.x,a.y,a.z,a.w)}}updateMatrixWorld(a){super.updateMatrixWorld(a),this.bindMode===Te?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===ke?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(a,d){const A=this.skeleton,x=this.geometry;nV.fromBufferAttribute(x.attributes.skinIndex,a),sV.fromBufferAttribute(x.attributes.skinWeight,a),rV.copy(d).applyMatrix4(this.bindMatrix),d.set(0,0,0);for(let w=0;w<4;w++){const M=sV.getComponent(w);if(M!==0){const N=nV.getComponent(w);aV.multiplyMatrices(A.bones[N].matrixWorld,A.boneInverses[N]),d.addScaledVector(MRe.copy(rV).applyMatrix4(aV),M)}}return d.applyMatrix4(this.bindMatrixInverse)}}class jN extends Hn{constructor(){super(),this.isBone=!0,this.type="Bone"}}class qd extends ds{constructor(a=null,d=1,A=1,x,w,M,N,P,k=Lt,j=Lt,Y,X){super(null,M,N,P,k,j,x,w,Y,X),this.isDataTexture=!0,this.image={data:a,width:d,height:A},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const cV=new mr,RRe=new mr;class xw{constructor(a=[],d=[]){this.uuid=No(),this.bones=a.slice(0),this.boneInverses=d,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const a=this.bones,d=this.boneInverses;if(this.boneMatrices=new Float32Array(a.length*16),d.length===0)this.calculateInverses();else if(a.length!==d.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let A=0,x=this.bones.length;A<x;A++)this.boneInverses.push(new mr)}}calculateInverses(){this.boneInverses.length=0;for(let a=0,d=this.bones.length;a<d;a++){const A=new mr;this.bones[a]&&A.copy(this.bones[a].matrixWorld).invert(),this.boneInverses.push(A)}}pose(){for(let a=0,d=this.bones.length;a<d;a++){const A=this.bones[a];A&&A.matrixWorld.copy(this.boneInverses[a]).invert()}for(let a=0,d=this.bones.length;a<d;a++){const A=this.bones[a];A&&(A.parent&&A.parent.isBone?(A.matrix.copy(A.parent.matrixWorld).invert(),A.matrix.multiply(A.matrixWorld)):A.matrix.copy(A.matrixWorld),A.matrix.decompose(A.position,A.quaternion,A.scale))}}update(){const a=this.bones,d=this.boneInverses,A=this.boneMatrices,x=this.boneTexture;for(let w=0,M=a.length;w<M;w++){const N=a[w]?a[w].matrixWorld:RRe;cV.multiplyMatrices(N,d[w]),cV.toArray(A,w*16)}x!==null&&(x.needsUpdate=!0)}clone(){return new xw(this.bones,this.boneInverses)}computeBoneTexture(){let a=Math.sqrt(this.bones.length*4);a=Math.ceil(a/4)*4,a=Math.max(a,4);const d=new Float32Array(a*a*4);d.set(this.boneMatrices);const A=new qd(d,a,a,fe,Tt);return A.needsUpdate=!0,this.boneMatrices=d,this.boneTexture=A,this}getBoneByName(a){for(let d=0,A=this.bones.length;d<A;d++){const x=this.bones[d];if(x.name===a)return x}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(a,d){this.uuid=a.uuid;for(let A=0,x=a.bones.length;A<x;A++){const w=a.bones[A];let M=d[w];M===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",w),M=new jN),this.bones.push(M),this.boneInverses.push(new mr().fromArray(a.boneInverses[A]))}return this.init(),this}toJSON(){const a={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};a.uuid=this.uuid;const d=this.bones,A=this.boneInverses;for(let x=0,w=d.length;x<w;x++){const M=d[x];a.bones.push(M.uuid);const N=A[x];a.boneInverses.push(N.toArray())}return a}}class B0 extends as{constructor(a,d,A,x=1){super(a,d,A),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=x}copy(a){return super.copy(a),this.meshPerAttribute=a.meshPerAttribute,this}toJSON(){const a=super.toJSON();return a.meshPerAttribute=this.meshPerAttribute,a.isInstancedBufferAttribute=!0,a}}const N0=new mr,uV=new mr,_w=[],hV=new Ls,IRe=new mr,Bv=new ua,Nv=new Aa;class dV extends ua{constructor(a,d,A){super(a,d),this.isInstancedMesh=!0,this.instanceMatrix=new B0(new Float32Array(A*16),16),this.instanceColor=null,this.morphTexture=null,this.count=A,this.boundingBox=null,this.boundingSphere=null;for(let x=0;x<A;x++)this.setMatrixAt(x,IRe)}computeBoundingBox(){const a=this.geometry,d=this.count;this.boundingBox===null&&(this.boundingBox=new Ls),a.boundingBox===null&&a.computeBoundingBox(),this.boundingBox.makeEmpty();for(let A=0;A<d;A++)this.getMatrixAt(A,N0),hV.copy(a.boundingBox).applyMatrix4(N0),this.boundingBox.union(hV)}computeBoundingSphere(){const a=this.geometry,d=this.count;this.boundingSphere===null&&(this.boundingSphere=new Aa),a.boundingSphere===null&&a.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let A=0;A<d;A++)this.getMatrixAt(A,N0),Nv.copy(a.boundingSphere).applyMatrix4(N0),this.boundingSphere.union(Nv)}copy(a,d){return super.copy(a,d),this.instanceMatrix.copy(a.instanceMatrix),a.morphTexture!==null&&(this.morphTexture=a.morphTexture.clone()),a.instanceColor!==null&&(this.instanceColor=a.instanceColor.clone()),this.count=a.count,a.boundingBox!==null&&(this.boundingBox=a.boundingBox.clone()),a.boundingSphere!==null&&(this.boundingSphere=a.boundingSphere.clone()),this}getColorAt(a,d){d.fromArray(this.instanceColor.array,a*3)}getMatrixAt(a,d){d.fromArray(this.instanceMatrix.array,a*16)}getMorphAt(a,d){const A=d.morphTargetInfluences,x=this.morphTexture.source.data.data,w=A.length+1,M=a*w+1;for(let N=0;N<A.length;N++)A[N]=x[M+N]}raycast(a,d){const A=this.matrixWorld,x=this.count;if(Bv.geometry=this.geometry,Bv.material=this.material,Bv.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Nv.copy(this.boundingSphere),Nv.applyMatrix4(A),a.ray.intersectsSphere(Nv)!==!1))for(let w=0;w<x;w++){this.getMatrixAt(w,N0),uV.multiplyMatrices(A,N0),Bv.matrixWorld=uV,Bv.raycast(a,_w);for(let M=0,N=_w.length;M<N;M++){const P=_w[M];P.instanceId=w,P.object=this,d.push(P)}_w.length=0}}setColorAt(a,d){this.instanceColor===null&&(this.instanceColor=new B0(new Float32Array(this.instanceMatrix.count*3),3)),d.toArray(this.instanceColor.array,a*3)}setMatrixAt(a,d){d.toArray(this.instanceMatrix.array,a*16)}setMorphAt(a,d){const A=d.morphTargetInfluences,x=A.length+1;this.morphTexture===null&&(this.morphTexture=new qd(new Float32Array(x*this.count),x,this.count,Ct,Tt));const w=this.morphTexture.source.data.data;let M=0;for(let k=0;k<A.length;k++)M+=A[k];const N=this.geometry.morphTargetsRelative?1:1-M,P=x*a;w[P]=N,w.set(A,P+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}}function BRe(S,a){return S.z-a.z}function NRe(S,a){return a.z-S.z}class LRe{constructor(){this.index=0,this.pool=[],this.list=[]}push(a,d){const A=this.pool,x=this.list;this.index>=A.length&&A.push({start:-1,count:-1,z:-1});const w=A[this.index];x.push(w),this.index++,w.start=a.start,w.count=a.count,w.z=d}reset(){this.list.length=0,this.index=0}}const L0="batchId",Xd=new mr,pV=new mr,DRe=new mr,fV=new mr,GN=new Sv,Ew=new Ls,Rf=new Aa,Lv=new He,VN=new LRe,mo=new ua,ww=[];function ORe(S,a,d=0){const A=a.itemSize;if(S.isInterleavedBufferAttribute||S.array.constructor!==a.array.constructor){const x=S.count;for(let w=0;w<x;w++)for(let M=0;M<A;M++)a.setComponent(w+d,M,S.getComponent(w,M))}else a.array.set(S.array,d*A);a.needsUpdate=!0}class mV extends ua{get maxGeometryCount(){return this._maxGeometryCount}constructor(a,d,A=d*2,x){super(new pn,x),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._drawRanges=[],this._reservedRanges=[],this._visibility=[],this._active=[],this._bounds=[],this._maxGeometryCount=a,this._maxVertexCount=d,this._maxIndexCount=A,this._geometryInitialized=!1,this._geometryCount=0,this._multiDrawCounts=new Int32Array(a),this._multiDrawStarts=new Int32Array(a),this._multiDrawCount=0,this._multiDrawInstances=null,this._visibilityChanged=!0,this._matricesTexture=null,this._initMatricesTexture()}_initMatricesTexture(){let a=Math.sqrt(this._maxGeometryCount*4);a=Math.ceil(a/4)*4,a=Math.max(a,4);const d=new Float32Array(a*a*4),A=new qd(d,a,a,fe,Tt);this._matricesTexture=A}_initializeGeometry(a){const d=this.geometry,A=this._maxVertexCount,x=this._maxGeometryCount,w=this._maxIndexCount;if(this._geometryInitialized===!1){for(const N in a.attributes){const P=a.getAttribute(N),{array:k,itemSize:j,normalized:Y}=P,X=new k.constructor(A*j),Z=new as(X,j,Y);d.setAttribute(N,Z)}if(a.getIndex()!==null){const N=A>65536?new Uint32Array(w):new Uint16Array(w);d.setIndex(new as(N,1))}const M=x>65536?new Uint32Array(A):new Uint16Array(A);d.setAttribute(L0,new as(M,1)),this._geometryInitialized=!0}}_validateGeometry(a){if(a.getAttribute(L0))throw new Error(`BatchedMesh: Geometry cannot use attribute "${L0}"`);const d=this.geometry;if(!!a.getIndex()!=!!d.getIndex())throw new Error('BatchedMesh: All geometries must consistently have "index".');for(const A in d.attributes){if(A===L0)continue;if(!a.hasAttribute(A))throw new Error(`BatchedMesh: Added geometry missing "${A}". All geometries must have consistent attributes.`);const x=a.getAttribute(A),w=d.getAttribute(A);if(x.itemSize!==w.itemSize||x.normalized!==w.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(a){return this.customSort=a,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ls);const a=this._geometryCount,d=this.boundingBox,A=this._active;d.makeEmpty();for(let x=0;x<a;x++)A[x]!==!1&&(this.getMatrixAt(x,Xd),this.getBoundingBoxAt(x,Ew).applyMatrix4(Xd),d.union(Ew))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Aa);const a=this._geometryCount,d=this.boundingSphere,A=this._active;d.makeEmpty();for(let x=0;x<a;x++)A[x]!==!1&&(this.getMatrixAt(x,Xd),this.getBoundingSphereAt(x,Rf).applyMatrix4(Xd),d.union(Rf))}addGeometry(a,d=-1,A=-1){if(this._initializeGeometry(a),this._validateGeometry(a),this._geometryCount>=this._maxGeometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");const x={vertexStart:-1,vertexCount:-1,indexStart:-1,indexCount:-1};let w=null;const M=this._reservedRanges,N=this._drawRanges,P=this._bounds;this._geometryCount!==0&&(w=M[M.length-1]),d===-1?x.vertexCount=a.getAttribute("position").count:x.vertexCount=d,w===null?x.vertexStart=0:x.vertexStart=w.vertexStart+w.vertexCount;const k=a.getIndex(),j=k!==null;if(j&&(A===-1?x.indexCount=k.count:x.indexCount=A,w===null?x.indexStart=0:x.indexStart=w.indexStart+w.indexCount),x.indexStart!==-1&&x.indexStart+x.indexCount>this._maxIndexCount||x.vertexStart+x.vertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");const Y=this._visibility,X=this._active,Z=this._matricesTexture,ie=this._matricesTexture.image.data;Y.push(!0),X.push(!0);const oe=this._geometryCount;this._geometryCount++,DRe.toArray(ie,oe*16),Z.needsUpdate=!0,M.push(x),N.push({start:j?x.indexStart:x.vertexStart,count:-1}),P.push({boxInitialized:!1,box:new Ls,sphereInitialized:!1,sphere:new Aa});const ne=this.geometry.getAttribute(L0);for(let ee=0;ee<x.vertexCount;ee++)ne.setX(x.vertexStart+ee,oe);return ne.needsUpdate=!0,this.setGeometryAt(oe,a),oe}setGeometryAt(a,d){if(a>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(d);const A=this.geometry,x=A.getIndex()!==null,w=A.getIndex(),M=d.getIndex(),N=this._reservedRanges[a];if(x&&M.count>N.indexCount||d.attributes.position.count>N.vertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");const P=N.vertexStart,k=N.vertexCount;for(const Z in A.attributes){if(Z===L0)continue;const ie=d.getAttribute(Z),oe=A.getAttribute(Z);ORe(ie,oe,P);const ne=ie.itemSize;for(let ee=ie.count,Me=k;ee<Me;ee++){const we=P+ee;for(let xe=0;xe<ne;xe++)oe.setComponent(we,xe,0)}oe.needsUpdate=!0,oe.addUpdateRange(P*ne,k*ne)}if(x){const Z=N.indexStart;for(let ie=0;ie<M.count;ie++)w.setX(Z+ie,P+M.getX(ie));for(let ie=M.count,oe=N.indexCount;ie<oe;ie++)w.setX(Z+ie,P);w.needsUpdate=!0,w.addUpdateRange(Z,N.indexCount)}const j=this._bounds[a];d.boundingBox!==null?(j.box.copy(d.boundingBox),j.boxInitialized=!0):j.boxInitialized=!1,d.boundingSphere!==null?(j.sphere.copy(d.boundingSphere),j.sphereInitialized=!0):j.sphereInitialized=!1;const Y=this._drawRanges[a],X=d.getAttribute("position");return Y.count=x?M.count:X.count,this._visibilityChanged=!0,a}deleteGeometry(a){const d=this._active;return a>=d.length||d[a]===!1?this:(d[a]=!1,this._visibilityChanged=!0,this)}getInstanceCountAt(a){return this._multiDrawInstances===null?null:this._multiDrawInstances[a]}setInstanceCountAt(a,d){return this._multiDrawInstances===null&&(this._multiDrawInstances=new Int32Array(this._maxGeometryCount).fill(1)),this._multiDrawInstances[a]=d,a}getBoundingBoxAt(a,d){if(this._active[a]===!1)return null;const A=this._bounds[a],x=A.box,w=this.geometry;if(A.boxInitialized===!1){x.makeEmpty();const M=w.index,N=w.attributes.position,P=this._drawRanges[a];for(let k=P.start,j=P.start+P.count;k<j;k++){let Y=k;M&&(Y=M.getX(Y)),x.expandByPoint(Lv.fromBufferAttribute(N,Y))}A.boxInitialized=!0}return d.copy(x),d}getBoundingSphereAt(a,d){if(this._active[a]===!1)return null;const A=this._bounds[a],x=A.sphere,w=this.geometry;if(A.sphereInitialized===!1){x.makeEmpty(),this.getBoundingBoxAt(a,Ew),Ew.getCenter(x.center);const M=w.index,N=w.attributes.position,P=this._drawRanges[a];let k=0;for(let j=P.start,Y=P.start+P.count;j<Y;j++){let X=j;M&&(X=M.getX(X)),Lv.fromBufferAttribute(N,X),k=Math.max(k,x.center.distanceToSquared(Lv))}x.radius=Math.sqrt(k),A.sphereInitialized=!0}return d.copy(x),d}setMatrixAt(a,d){const A=this._active,x=this._matricesTexture,w=this._matricesTexture.image.data,M=this._geometryCount;return a>=M||A[a]===!1?this:(d.toArray(w,a*16),x.needsUpdate=!0,this)}getMatrixAt(a,d){const A=this._active,x=this._matricesTexture.image.data,w=this._geometryCount;return a>=w||A[a]===!1?null:d.fromArray(x,a*16)}setVisibleAt(a,d){const A=this._visibility,x=this._active,w=this._geometryCount;return a>=w||x[a]===!1||A[a]===d?this:(A[a]=d,this._visibilityChanged=!0,this)}getVisibleAt(a){const d=this._visibility,A=this._active,x=this._geometryCount;return a>=x||A[a]===!1?!1:d[a]}raycast(a,d){const A=this._visibility,x=this._active,w=this._drawRanges,M=this._geometryCount,N=this.matrixWorld,P=this.geometry;mo.material=this.material,mo.geometry.index=P.index,mo.geometry.attributes=P.attributes,mo.geometry.boundingBox===null&&(mo.geometry.boundingBox=new Ls),mo.geometry.boundingSphere===null&&(mo.geometry.boundingSphere=new Aa);for(let k=0;k<M;k++){if(!A[k]||!x[k])continue;const j=w[k];mo.geometry.setDrawRange(j.start,j.count),this.getMatrixAt(k,mo.matrixWorld).premultiply(N),this.getBoundingBoxAt(k,mo.geometry.boundingBox),this.getBoundingSphereAt(k,mo.geometry.boundingSphere),mo.raycast(a,ww);for(let Y=0,X=ww.length;Y<X;Y++){const Z=ww[Y];Z.object=this,Z.batchId=k,d.push(Z)}ww.length=0}mo.material=null,mo.geometry.index=null,mo.geometry.attributes={},mo.geometry.setDrawRange(0,1/0)}copy(a){return super.copy(a),this.geometry=a.geometry.clone(),this.perObjectFrustumCulled=a.perObjectFrustumCulled,this.sortObjects=a.sortObjects,this.boundingBox=a.boundingBox!==null?a.boundingBox.clone():null,this.boundingSphere=a.boundingSphere!==null?a.boundingSphere.clone():null,this._drawRanges=a._drawRanges.map(d=>({...d})),this._reservedRanges=a._reservedRanges.map(d=>({...d})),this._visibility=a._visibility.slice(),this._active=a._active.slice(),this._bounds=a._bounds.map(d=>({boxInitialized:d.boxInitialized,box:d.box.clone(),sphereInitialized:d.sphereInitialized,sphere:d.sphere.clone()})),this._maxGeometryCount=a._maxGeometryCount,this._maxVertexCount=a._maxVertexCount,this._maxIndexCount=a._maxIndexCount,this._geometryInitialized=a._geometryInitialized,this._geometryCount=a._geometryCount,this._multiDrawCounts=a._multiDrawCounts.slice(),this._multiDrawStarts=a._multiDrawStarts.slice(),this._matricesTexture=a._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.slice(),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this}onBeforeRender(a,d,A,x,w){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const M=x.getIndex(),N=M===null?1:M.array.BYTES_PER_ELEMENT,P=this._active,k=this._visibility,j=this._multiDrawStarts,Y=this._multiDrawCounts,X=this._drawRanges,Z=this.perObjectFrustumCulled;Z&&(fV.multiplyMatrices(A.projectionMatrix,A.matrixWorldInverse).multiply(this.matrixWorld),GN.setFromProjectionMatrix(fV,a.coordinateSystem));let ie=0;if(this.sortObjects){pV.copy(this.matrixWorld).invert(),Lv.setFromMatrixPosition(A.matrixWorld).applyMatrix4(pV);for(let ee=0,Me=k.length;ee<Me;ee++)if(k[ee]&&P[ee]){this.getMatrixAt(ee,Xd),this.getBoundingSphereAt(ee,Rf).applyMatrix4(Xd);let we=!1;if(Z&&(we=!GN.intersectsSphere(Rf)),!we){const xe=Lv.distanceTo(Rf.center);VN.push(X[ee],xe)}}const oe=VN.list,ne=this.customSort;ne===null?oe.sort(w.transparent?NRe:BRe):ne.call(this,oe,A);for(let ee=0,Me=oe.length;ee<Me;ee++){const we=oe[ee];j[ie]=we.start*N,Y[ie]=we.count,ie++}VN.reset()}else for(let oe=0,ne=k.length;oe<ne;oe++)if(k[oe]&&P[oe]){let ee=!1;if(Z&&(this.getMatrixAt(oe,Xd),this.getBoundingSphereAt(oe,Rf).applyMatrix4(Xd),ee=!GN.intersectsSphere(Rf)),!ee){const Me=X[oe];j[ie]=Me.start*N,Y[ie]=Me.count,ie++}}this._multiDrawCount=ie,this._visibilityChanged=!1}onBeforeShadow(a,d,A,x,w,M){this.onBeforeRender(a,null,x,w,M)}}class Po extends fo{constructor(a){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new lr(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.map=a.map,this.linewidth=a.linewidth,this.linecap=a.linecap,this.linejoin=a.linejoin,this.fog=a.fog,this}}const Cw=new He,Sw=new He,gV=new mr,Dv=new ya,Tw=new Aa,HN=new He,AV=new He;class Kd extends Hn{constructor(a=new pn,d=new Po){super(),this.isLine=!0,this.type="Line",this.geometry=a,this.material=d,this.updateMorphTargets()}copy(a,d){return super.copy(a,d),this.material=Array.isArray(a.material)?a.material.slice():a.material,this.geometry=a.geometry,this}computeLineDistances(){const a=this.geometry;if(a.index===null){const d=a.attributes.position,A=[0];for(let x=1,w=d.count;x<w;x++)Cw.fromBufferAttribute(d,x-1),Sw.fromBufferAttribute(d,x),A[x]=A[x-1],A[x]+=Cw.distanceTo(Sw);a.setAttribute("lineDistance",new br(A,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(a,d){const A=this.geometry,x=this.matrixWorld,w=a.params.Line.threshold,M=A.drawRange;if(A.boundingSphere===null&&A.computeBoundingSphere(),Tw.copy(A.boundingSphere),Tw.applyMatrix4(x),Tw.radius+=w,a.ray.intersectsSphere(Tw)===!1)return;gV.copy(x).invert(),Dv.copy(a.ray).applyMatrix4(gV);const N=w/((this.scale.x+this.scale.y+this.scale.z)/3),P=N*N,k=this.isLineSegments?2:1,j=A.index,Y=A.attributes.position;if(j!==null){const X=Math.max(0,M.start),Z=Math.min(j.count,M.start+M.count);for(let ie=X,oe=Z-1;ie<oe;ie+=k){const ne=j.getX(ie),ee=j.getX(ie+1),Me=Mw(this,a,Dv,P,ne,ee);Me&&d.push(Me)}if(this.isLineLoop){const ie=j.getX(Z-1),oe=j.getX(X),ne=Mw(this,a,Dv,P,ie,oe);ne&&d.push(ne)}}else{const X=Math.max(0,M.start),Z=Math.min(Y.count,M.start+M.count);for(let ie=X,oe=Z-1;ie<oe;ie+=k){const ne=Mw(this,a,Dv,P,ie,ie+1);ne&&d.push(ne)}if(this.isLineLoop){const ie=Mw(this,a,Dv,P,Z-1,X);ie&&d.push(ie)}}}updateMorphTargets(){const a=this.geometry.morphAttributes,d=Object.keys(a);if(d.length>0){const A=a[d[0]];if(A!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let x=0,w=A.length;x<w;x++){const M=A[x].name||String(x);this.morphTargetInfluences.push(0),this.morphTargetDictionary[M]=x}}}}}function Mw(S,a,d,A,x,w){const M=S.geometry.attributes.position;if(Cw.fromBufferAttribute(M,x),Sw.fromBufferAttribute(M,w),d.distanceSqToSegment(Cw,Sw,HN,AV)>A)return;HN.applyMatrix4(S.matrixWorld);const N=a.ray.origin.distanceTo(HN);if(!(N<a.near||N>a.far))return{distance:N,point:AV.clone().applyMatrix4(S.matrixWorld),index:x,face:null,faceIndex:null,object:S}}const yV=new He,vV=new He;class uu extends Kd{constructor(a,d){super(a,d),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const a=this.geometry;if(a.index===null){const d=a.attributes.position,A=[];for(let x=0,w=d.count;x<w;x+=2)yV.fromBufferAttribute(d,x),vV.fromBufferAttribute(d,x+1),A[x]=x===0?0:A[x-1],A[x+1]=A[x]+yV.distanceTo(vV);a.setAttribute("lineDistance",new br(A,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class bV extends Kd{constructor(a,d){super(a,d),this.isLineLoop=!0,this.type="LineLoop"}}class WN extends fo{constructor(a){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new lr(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.map=a.map,this.alphaMap=a.alphaMap,this.size=a.size,this.sizeAttenuation=a.sizeAttenuation,this.fog=a.fog,this}}const xV=new mr,QN=new ya,Rw=new Aa,Iw=new He;class _V extends Hn{constructor(a=new pn,d=new WN){super(),this.isPoints=!0,this.type="Points",this.geometry=a,this.material=d,this.updateMorphTargets()}copy(a,d){return super.copy(a,d),this.material=Array.isArray(a.material)?a.material.slice():a.material,this.geometry=a.geometry,this}raycast(a,d){const A=this.geometry,x=this.matrixWorld,w=a.params.Points.threshold,M=A.drawRange;if(A.boundingSphere===null&&A.computeBoundingSphere(),Rw.copy(A.boundingSphere),Rw.applyMatrix4(x),Rw.radius+=w,a.ray.intersectsSphere(Rw)===!1)return;xV.copy(x).invert(),QN.copy(a.ray).applyMatrix4(xV);const N=w/((this.scale.x+this.scale.y+this.scale.z)/3),P=N*N,k=A.index,j=A.attributes.position;if(k!==null){const Y=Math.max(0,M.start),X=Math.min(k.count,M.start+M.count);for(let Z=Y,ie=X;Z<ie;Z++){const oe=k.getX(Z);Iw.fromBufferAttribute(j,oe),EV(Iw,oe,P,x,a,d,this)}}else{const Y=Math.max(0,M.start),X=Math.min(j.count,M.start+M.count);for(let Z=Y,ie=X;Z<ie;Z++)Iw.fromBufferAttribute(j,Z),EV(Iw,Z,P,x,a,d,this)}}updateMorphTargets(){const a=this.geometry.morphAttributes,d=Object.keys(a);if(d.length>0){const A=a[d[0]];if(A!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let x=0,w=A.length;x<w;x++){const M=A[x].name||String(x);this.morphTargetInfluences.push(0),this.morphTargetDictionary[M]=x}}}}}function EV(S,a,d,A,x,w,M){const N=QN.distanceSqToPoint(S);if(N<d){const P=new He;QN.closestPointToPoint(S,P),P.applyMatrix4(A);const k=x.ray.origin.distanceTo(P);if(k<x.near||k>x.far)return;w.push({distance:k,distanceToRay:Math.sqrt(N),point:P,index:a,face:null,object:M})}}class PRe extends ds{constructor(a,d,A,x,w,M,N,P,k){super(a,d,A,x,w,M,N,P,k),this.isVideoTexture=!0,this.minFilter=M!==void 0?M:Fi,this.magFilter=w!==void 0?w:Fi,this.generateMipmaps=!1;const j=this;function Y(){j.needsUpdate=!0,a.requestVideoFrameCallback(Y)}"requestVideoFrameCallback"in a&&a.requestVideoFrameCallback(Y)}clone(){return new this.constructor(this.image).copy(this)}update(){const a=this.image;!("requestVideoFrameCallback"in a)&&a.readyState>=a.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class kRe extends ds{constructor(a,d){super({width:a,height:d}),this.isFramebufferTexture=!0,this.magFilter=Lt,this.minFilter=Lt,this.generateMipmaps=!1,this.needsUpdate=!0}}class Bw extends ds{constructor(a,d,A,x,w,M,N,P,k,j,Y,X){super(null,M,N,P,k,j,x,w,Y,X),this.isCompressedTexture=!0,this.image={width:d,height:A},this.mipmaps=a,this.flipY=!1,this.generateMipmaps=!1}}class FRe extends Bw{constructor(a,d,A,x,w,M){super(a,d,A,w,M),this.isCompressedArrayTexture=!0,this.image.depth=x,this.wrapR=je}}class URe extends Bw{constructor(a,d,A){super(void 0,a[0].width,a[0].height,d,A,U),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=a}}class zRe extends ds{constructor(a,d,A,x,w,M,N,P,k){super(a,d,A,x,w,M,N,P,k),this.isCanvasTexture=!0,this.needsUpdate=!0}}class kc{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(a,d){const A=this.getUtoTmapping(a);return this.getPoint(A,d)}getPoints(a=5){const d=[];for(let A=0;A<=a;A++)d.push(this.getPoint(A/a));return d}getSpacedPoints(a=5){const d=[];for(let A=0;A<=a;A++)d.push(this.getPointAt(A/a));return d}getLength(){const a=this.getLengths();return a[a.length-1]}getLengths(a=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===a+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const d=[];let A,x=this.getPoint(0),w=0;d.push(0);for(let M=1;M<=a;M++)A=this.getPoint(M/a),w+=A.distanceTo(x),d.push(w),x=A;return this.cacheArcLengths=d,d}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(a,d){const A=this.getLengths();let x=0;const w=A.length;let M;d?M=d:M=a*A[w-1];let N=0,P=w-1,k;for(;N<=P;)if(x=Math.floor(N+(P-N)/2),k=A[x]-M,k<0)N=x+1;else if(k>0)P=x-1;else{P=x;break}if(x=P,A[x]===M)return x/(w-1);const j=A[x],Y=A[x+1]-j,X=(M-j)/Y;return(x+X)/(w-1)}getTangent(a,d){let A=a-1e-4,x=a+1e-4;A<0&&(A=0),x>1&&(x=1);const w=this.getPoint(A),M=this.getPoint(x),N=d||(w.isVector2?new oi:new He);return N.copy(M).sub(w).normalize(),N}getTangentAt(a,d){const A=this.getUtoTmapping(a);return this.getTangent(A,d)}computeFrenetFrames(a,d){const A=new He,x=[],w=[],M=[],N=new He,P=new mr;for(let Z=0;Z<=a;Z++){const ie=Z/a;x[Z]=this.getTangentAt(ie,new He)}w[0]=new He,M[0]=new He;let k=Number.MAX_VALUE;const j=Math.abs(x[0].x),Y=Math.abs(x[0].y),X=Math.abs(x[0].z);j<=k&&(k=j,A.set(1,0,0)),Y<=k&&(k=Y,A.set(0,1,0)),X<=k&&A.set(0,0,1),N.crossVectors(x[0],A).normalize(),w[0].crossVectors(x[0],N),M[0].crossVectors(x[0],w[0]);for(let Z=1;Z<=a;Z++){if(w[Z]=w[Z-1].clone(),M[Z]=M[Z-1].clone(),N.crossVectors(x[Z-1],x[Z]),N.length()>Number.EPSILON){N.normalize();const ie=Math.acos(Ts(x[Z-1].dot(x[Z]),-1,1));w[Z].applyMatrix4(P.makeRotationAxis(N,ie))}M[Z].crossVectors(x[Z],w[Z])}if(d===!0){let Z=Math.acos(Ts(w[0].dot(w[a]),-1,1));Z/=a,x[0].dot(N.crossVectors(w[0],w[a]))>0&&(Z=-Z);for(let ie=1;ie<=a;ie++)w[ie].applyMatrix4(P.makeRotationAxis(x[ie],Z*ie)),M[ie].crossVectors(x[ie],w[ie])}return{tangents:x,normals:w,binormals:M}}clone(){return new this.constructor().copy(this)}copy(a){return this.arcLengthDivisions=a.arcLengthDivisions,this}toJSON(){const a={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return a.arcLengthDivisions=this.arcLengthDivisions,a.type=this.type,a}fromJSON(a){return this.arcLengthDivisions=a.arcLengthDivisions,this}}class Nw extends kc{constructor(a=0,d=0,A=1,x=1,w=0,M=Math.PI*2,N=!1,P=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=a,this.aY=d,this.xRadius=A,this.yRadius=x,this.aStartAngle=w,this.aEndAngle=M,this.aClockwise=N,this.aRotation=P}getPoint(a,d=new oi){const A=d,x=Math.PI*2;let w=this.aEndAngle-this.aStartAngle;const M=Math.abs(w)<Number.EPSILON;for(;w<0;)w+=x;for(;w>x;)w-=x;w<Number.EPSILON&&(M?w=0:w=x),this.aClockwise===!0&&!M&&(w===x?w=-x:w=w-x);const N=this.aStartAngle+a*w;let P=this.aX+this.xRadius*Math.cos(N),k=this.aY+this.yRadius*Math.sin(N);if(this.aRotation!==0){const j=Math.cos(this.aRotation),Y=Math.sin(this.aRotation),X=P-this.aX,Z=k-this.aY;P=X*j-Z*Y+this.aX,k=X*Y+Z*j+this.aY}return A.set(P,k)}copy(a){return super.copy(a),this.aX=a.aX,this.aY=a.aY,this.xRadius=a.xRadius,this.yRadius=a.yRadius,this.aStartAngle=a.aStartAngle,this.aEndAngle=a.aEndAngle,this.aClockwise=a.aClockwise,this.aRotation=a.aRotation,this}toJSON(){const a=super.toJSON();return a.aX=this.aX,a.aY=this.aY,a.xRadius=this.xRadius,a.yRadius=this.yRadius,a.aStartAngle=this.aStartAngle,a.aEndAngle=this.aEndAngle,a.aClockwise=this.aClockwise,a.aRotation=this.aRotation,a}fromJSON(a){return super.fromJSON(a),this.aX=a.aX,this.aY=a.aY,this.xRadius=a.xRadius,this.yRadius=a.yRadius,this.aStartAngle=a.aStartAngle,this.aEndAngle=a.aEndAngle,this.aClockwise=a.aClockwise,this.aRotation=a.aRotation,this}}class wV extends Nw{constructor(a,d,A,x,w,M){super(a,d,A,A,x,w,M),this.isArcCurve=!0,this.type="ArcCurve"}}function qN(){let S=0,a=0,d=0,A=0;function x(w,M,N,P){S=w,a=N,d=-3*w+3*M-2*N-P,A=2*w-2*M+N+P}return{initCatmullRom:function(w,M,N,P,k){x(M,N,k*(N-w),k*(P-M))},initNonuniformCatmullRom:function(w,M,N,P,k,j,Y){let X=(M-w)/k-(N-w)/(k+j)+(N-M)/j,Z=(N-M)/j-(P-M)/(j+Y)+(P-N)/Y;X*=j,Z*=j,x(M,N,X,Z)},calc:function(w){const M=w*w,N=M*w;return S+a*w+d*M+A*N}}}const Lw=new He,XN=new qN,KN=new qN,YN=new qN;class CV extends kc{constructor(a=[],d=!1,A="centripetal",x=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=a,this.closed=d,this.curveType=A,this.tension=x}getPoint(a,d=new He){const A=d,x=this.points,w=x.length,M=(w-(this.closed?0:1))*a;let N=Math.floor(M),P=M-N;this.closed?N+=N>0?0:(Math.floor(Math.abs(N)/w)+1)*w:P===0&&N===w-1&&(N=w-2,P=1);let k,j;this.closed||N>0?k=x[(N-1)%w]:(Lw.subVectors(x[0],x[1]).add(x[0]),k=Lw);const Y=x[N%w],X=x[(N+1)%w];if(this.closed||N+2<w?j=x[(N+2)%w]:(Lw.subVectors(x[w-1],x[w-2]).add(x[w-1]),j=Lw),this.curveType==="centripetal"||this.curveType==="chordal"){const Z=this.curveType==="chordal"?.5:.25;let ie=Math.pow(k.distanceToSquared(Y),Z),oe=Math.pow(Y.distanceToSquared(X),Z),ne=Math.pow(X.distanceToSquared(j),Z);oe<1e-4&&(oe=1),ie<1e-4&&(ie=oe),ne<1e-4&&(ne=oe),XN.initNonuniformCatmullRom(k.x,Y.x,X.x,j.x,ie,oe,ne),KN.initNonuniformCatmullRom(k.y,Y.y,X.y,j.y,ie,oe,ne),YN.initNonuniformCatmullRom(k.z,Y.z,X.z,j.z,ie,oe,ne)}else this.curveType==="catmullrom"&&(XN.initCatmullRom(k.x,Y.x,X.x,j.x,this.tension),KN.initCatmullRom(k.y,Y.y,X.y,j.y,this.tension),YN.initCatmullRom(k.z,Y.z,X.z,j.z,this.tension));return A.set(XN.calc(P),KN.calc(P),YN.calc(P)),A}copy(a){super.copy(a),this.points=[];for(let d=0,A=a.points.length;d<A;d++){const x=a.points[d];this.points.push(x.clone())}return this.closed=a.closed,this.curveType=a.curveType,this.tension=a.tension,this}toJSON(){const a=super.toJSON();a.points=[];for(let d=0,A=this.points.length;d<A;d++){const x=this.points[d];a.points.push(x.toArray())}return a.closed=this.closed,a.curveType=this.curveType,a.tension=this.tension,a}fromJSON(a){super.fromJSON(a),this.points=[];for(let d=0,A=a.points.length;d<A;d++){const x=a.points[d];this.points.push(new He().fromArray(x))}return this.closed=a.closed,this.curveType=a.curveType,this.tension=a.tension,this}}function SV(S,a,d,A,x){const w=(A-a)*.5,M=(x-d)*.5,N=S*S,P=S*N;return(2*d-2*A+w+M)*P+(-3*d+3*A-2*w-M)*N+w*S+d}function jRe(S,a){const d=1-S;return d*d*a}function GRe(S,a){return 2*(1-S)*S*a}function VRe(S,a){return S*S*a}function Ov(S,a,d,A){return jRe(S,a)+GRe(S,d)+VRe(S,A)}function HRe(S,a){const d=1-S;return d*d*d*a}function WRe(S,a){const d=1-S;return 3*d*d*S*a}function QRe(S,a){return 3*(1-S)*S*S*a}function qRe(S,a){return S*S*S*a}function Pv(S,a,d,A,x){return HRe(S,a)+WRe(S,d)+QRe(S,A)+qRe(S,x)}class JN extends kc{constructor(a=new oi,d=new oi,A=new oi,x=new oi){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=a,this.v1=d,this.v2=A,this.v3=x}getPoint(a,d=new oi){const A=d,x=this.v0,w=this.v1,M=this.v2,N=this.v3;return A.set(Pv(a,x.x,w.x,M.x,N.x),Pv(a,x.y,w.y,M.y,N.y)),A}copy(a){return super.copy(a),this.v0.copy(a.v0),this.v1.copy(a.v1),this.v2.copy(a.v2),this.v3.copy(a.v3),this}toJSON(){const a=super.toJSON();return a.v0=this.v0.toArray(),a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a.v3=this.v3.toArray(),a}fromJSON(a){return super.fromJSON(a),this.v0.fromArray(a.v0),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this.v3.fromArray(a.v3),this}}class TV extends kc{constructor(a=new He,d=new He,A=new He,x=new He){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=a,this.v1=d,this.v2=A,this.v3=x}getPoint(a,d=new He){const A=d,x=this.v0,w=this.v1,M=this.v2,N=this.v3;return A.set(Pv(a,x.x,w.x,M.x,N.x),Pv(a,x.y,w.y,M.y,N.y),Pv(a,x.z,w.z,M.z,N.z)),A}copy(a){return super.copy(a),this.v0.copy(a.v0),this.v1.copy(a.v1),this.v2.copy(a.v2),this.v3.copy(a.v3),this}toJSON(){const a=super.toJSON();return a.v0=this.v0.toArray(),a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a.v3=this.v3.toArray(),a}fromJSON(a){return super.fromJSON(a),this.v0.fromArray(a.v0),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this.v3.fromArray(a.v3),this}}class ZN extends kc{constructor(a=new oi,d=new oi){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=a,this.v2=d}getPoint(a,d=new oi){const A=d;return a===1?A.copy(this.v2):(A.copy(this.v2).sub(this.v1),A.multiplyScalar(a).add(this.v1)),A}getPointAt(a,d){return this.getPoint(a,d)}getTangent(a,d=new oi){return d.subVectors(this.v2,this.v1).normalize()}getTangentAt(a,d){return this.getTangent(a,d)}copy(a){return super.copy(a),this.v1.copy(a.v1),this.v2.copy(a.v2),this}toJSON(){const a=super.toJSON();return a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a}fromJSON(a){return super.fromJSON(a),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this}}class MV extends kc{constructor(a=new He,d=new He){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=a,this.v2=d}getPoint(a,d=new He){const A=d;return a===1?A.copy(this.v2):(A.copy(this.v2).sub(this.v1),A.multiplyScalar(a).add(this.v1)),A}getPointAt(a,d){return this.getPoint(a,d)}getTangent(a,d=new He){return d.subVectors(this.v2,this.v1).normalize()}getTangentAt(a,d){return this.getTangent(a,d)}copy(a){return super.copy(a),this.v1.copy(a.v1),this.v2.copy(a.v2),this}toJSON(){const a=super.toJSON();return a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a}fromJSON(a){return super.fromJSON(a),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this}}class $N extends kc{constructor(a=new oi,d=new oi,A=new oi){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=a,this.v1=d,this.v2=A}getPoint(a,d=new oi){const A=d,x=this.v0,w=this.v1,M=this.v2;return A.set(Ov(a,x.x,w.x,M.x),Ov(a,x.y,w.y,M.y)),A}copy(a){return super.copy(a),this.v0.copy(a.v0),this.v1.copy(a.v1),this.v2.copy(a.v2),this}toJSON(){const a=super.toJSON();return a.v0=this.v0.toArray(),a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a}fromJSON(a){return super.fromJSON(a),this.v0.fromArray(a.v0),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this}}class eL extends kc{constructor(a=new He,d=new He,A=new He){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=a,this.v1=d,this.v2=A}getPoint(a,d=new He){const A=d,x=this.v0,w=this.v1,M=this.v2;return A.set(Ov(a,x.x,w.x,M.x),Ov(a,x.y,w.y,M.y),Ov(a,x.z,w.z,M.z)),A}copy(a){return super.copy(a),this.v0.copy(a.v0),this.v1.copy(a.v1),this.v2.copy(a.v2),this}toJSON(){const a=super.toJSON();return a.v0=this.v0.toArray(),a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a}fromJSON(a){return super.fromJSON(a),this.v0.fromArray(a.v0),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this}}class tL extends kc{constructor(a=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=a}getPoint(a,d=new oi){const A=d,x=this.points,w=(x.length-1)*a,M=Math.floor(w),N=w-M,P=x[M===0?M:M-1],k=x[M],j=x[M>x.length-2?x.length-1:M+1],Y=x[M>x.length-3?x.length-1:M+2];return A.set(SV(N,P.x,k.x,j.x,Y.x),SV(N,P.y,k.y,j.y,Y.y)),A}copy(a){super.copy(a),this.points=[];for(let d=0,A=a.points.length;d<A;d++){const x=a.points[d];this.points.push(x.clone())}return this}toJSON(){const a=super.toJSON();a.points=[];for(let d=0,A=this.points.length;d<A;d++){const x=this.points[d];a.points.push(x.toArray())}return a}fromJSON(a){super.fromJSON(a),this.points=[];for(let d=0,A=a.points.length;d<A;d++){const x=a.points[d];this.points.push(new oi().fromArray(x))}return this}}var Dw=Object.freeze({__proto__:null,ArcCurve:wV,CatmullRomCurve3:CV,CubicBezierCurve:JN,CubicBezierCurve3:TV,EllipseCurve:Nw,LineCurve:ZN,LineCurve3:MV,QuadraticBezierCurve:$N,QuadraticBezierCurve3:eL,SplineCurve:tL});class RV extends kc{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(a){this.curves.push(a)}closePath(){const a=this.curves[0].getPoint(0),d=this.curves[this.curves.length-1].getPoint(1);if(!a.equals(d)){const A=a.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new Dw[A](d,a))}return this}getPoint(a,d){const A=a*this.getLength(),x=this.getCurveLengths();let w=0;for(;w<x.length;){if(x[w]>=A){const M=x[w]-A,N=this.curves[w],P=N.getLength(),k=P===0?0:1-M/P;return N.getPointAt(k,d)}w++}return null}getLength(){const a=this.getCurveLengths();return a[a.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const a=[];let d=0;for(let A=0,x=this.curves.length;A<x;A++)d+=this.curves[A].getLength(),a.push(d);return this.cacheLengths=a,a}getSpacedPoints(a=40){const d=[];for(let A=0;A<=a;A++)d.push(this.getPoint(A/a));return this.autoClose&&d.push(d[0]),d}getPoints(a=12){const d=[];let A;for(let x=0,w=this.curves;x<w.length;x++){const M=w[x],N=M.isEllipseCurve?a*2:M.isLineCurve||M.isLineCurve3?1:M.isSplineCurve?a*M.points.length:a,P=M.getPoints(N);for(let k=0;k<P.length;k++){const j=P[k];A&&A.equals(j)||(d.push(j),A=j)}}return this.autoClose&&d.length>1&&!d[d.length-1].equals(d[0])&&d.push(d[0]),d}copy(a){super.copy(a),this.curves=[];for(let d=0,A=a.curves.length;d<A;d++){const x=a.curves[d];this.curves.push(x.clone())}return this.autoClose=a.autoClose,this}toJSON(){const a=super.toJSON();a.autoClose=this.autoClose,a.curves=[];for(let d=0,A=this.curves.length;d<A;d++){const x=this.curves[d];a.curves.push(x.toJSON())}return a}fromJSON(a){super.fromJSON(a),this.autoClose=a.autoClose,this.curves=[];for(let d=0,A=a.curves.length;d<A;d++){const x=a.curves[d];this.curves.push(new Dw[x.type]().fromJSON(x))}return this}}class kv extends RV{constructor(a){super(),this.type="Path",this.currentPoint=new oi,a&&this.setFromPoints(a)}setFromPoints(a){this.moveTo(a[0].x,a[0].y);for(let d=1,A=a.length;d<A;d++)this.lineTo(a[d].x,a[d].y);return this}moveTo(a,d){return this.currentPoint.set(a,d),this}lineTo(a,d){const A=new ZN(this.currentPoint.clone(),new oi(a,d));return this.curves.push(A),this.currentPoint.set(a,d),this}quadraticCurveTo(a,d,A,x){const w=new $N(this.currentPoint.clone(),new oi(a,d),new oi(A,x));return this.curves.push(w),this.currentPoint.set(A,x),this}bezierCurveTo(a,d,A,x,w,M){const N=new JN(this.currentPoint.clone(),new oi(a,d),new oi(A,x),new oi(w,M));return this.curves.push(N),this.currentPoint.set(w,M),this}splineThru(a){const d=[this.currentPoint.clone()].concat(a),A=new tL(d);return this.curves.push(A),this.currentPoint.copy(a[a.length-1]),this}arc(a,d,A,x,w,M){const N=this.currentPoint.x,P=this.currentPoint.y;return this.absarc(a+N,d+P,A,x,w,M),this}absarc(a,d,A,x,w,M){return this.absellipse(a,d,A,A,x,w,M),this}ellipse(a,d,A,x,w,M,N,P){const k=this.currentPoint.x,j=this.currentPoint.y;return this.absellipse(a+k,d+j,A,x,w,M,N,P),this}absellipse(a,d,A,x,w,M,N,P){const k=new Nw(a,d,A,x,w,M,N,P);if(this.curves.length>0){const Y=k.getPoint(0);Y.equals(this.currentPoint)||this.lineTo(Y.x,Y.y)}this.curves.push(k);const j=k.getPoint(1);return this.currentPoint.copy(j),this}copy(a){return super.copy(a),this.currentPoint.copy(a.currentPoint),this}toJSON(){const a=super.toJSON();return a.currentPoint=this.currentPoint.toArray(),a}fromJSON(a){return super.fromJSON(a),this.currentPoint.fromArray(a.currentPoint),this}}class Fv extends pn{constructor(a=[new oi(0,-.5),new oi(.5,0),new oi(0,.5)],d=12,A=0,x=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:a,segments:d,phiStart:A,phiLength:x},d=Math.floor(d),x=Ts(x,0,Math.PI*2);const w=[],M=[],N=[],P=[],k=[],j=1/d,Y=new He,X=new oi,Z=new He,ie=new He,oe=new He;let ne=0,ee=0;for(let Me=0;Me<=a.length-1;Me++)switch(Me){case 0:ne=a[Me+1].x-a[Me].x,ee=a[Me+1].y-a[Me].y,Z.x=ee*1,Z.y=-ne,Z.z=ee*0,oe.copy(Z),Z.normalize(),P.push(Z.x,Z.y,Z.z);break;case a.length-1:P.push(oe.x,oe.y,oe.z);break;default:ne=a[Me+1].x-a[Me].x,ee=a[Me+1].y-a[Me].y,Z.x=ee*1,Z.y=-ne,Z.z=ee*0,ie.copy(Z),Z.x+=oe.x,Z.y+=oe.y,Z.z+=oe.z,Z.normalize(),P.push(Z.x,Z.y,Z.z),oe.copy(ie)}for(let Me=0;Me<=d;Me++){const we=A+Me*j*x,xe=Math.sin(we),st=Math.cos(we);for(let Qe=0;Qe<=a.length-1;Qe++){Y.x=a[Qe].x*xe,Y.y=a[Qe].y,Y.z=a[Qe].x*st,M.push(Y.x,Y.y,Y.z),X.x=Me/d,X.y=Qe/(a.length-1),N.push(X.x,X.y);const Ze=P[3*Qe+0]*xe,rt=P[3*Qe+1],ze=P[3*Qe+0]*st;k.push(Ze,rt,ze)}}for(let Me=0;Me<d;Me++)for(let we=0;we<a.length-1;we++){const xe=we+Me*a.length,st=xe,Qe=xe+a.length,Ze=xe+a.length+1,rt=xe+1;w.push(st,Qe,rt),w.push(Ze,rt,Qe)}this.setIndex(w),this.setAttribute("position",new br(M,3)),this.setAttribute("uv",new br(N,2)),this.setAttribute("normal",new br(k,3))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new Fv(a.points,a.segments,a.phiStart,a.phiLength)}}class Ow extends Fv{constructor(a=1,d=1,A=4,x=8){const w=new kv;w.absarc(0,-d/2,a,Math.PI*1.5,0),w.absarc(0,d/2,a,0,Math.PI*.5),super(w.getPoints(A),x),this.type="CapsuleGeometry",this.parameters={radius:a,length:d,capSegments:A,radialSegments:x}}static fromJSON(a){return new Ow(a.radius,a.length,a.capSegments,a.radialSegments)}}class Pw extends pn{constructor(a=1,d=32,A=0,x=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:a,segments:d,thetaStart:A,thetaLength:x},d=Math.max(3,d);const w=[],M=[],N=[],P=[],k=new He,j=new oi;M.push(0,0,0),N.push(0,0,1),P.push(.5,.5);for(let Y=0,X=3;Y<=d;Y++,X+=3){const Z=A+Y/d*x;k.x=a*Math.cos(Z),k.y=a*Math.sin(Z),M.push(k.x,k.y,k.z),N.push(0,0,1),j.x=(M[X]/a+1)/2,j.y=(M[X+1]/a+1)/2,P.push(j.x,j.y)}for(let Y=1;Y<=d;Y++)w.push(Y,Y+1,0);this.setIndex(w),this.setAttribute("position",new br(M,3)),this.setAttribute("normal",new br(N,3)),this.setAttribute("uv",new br(P,2))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new Pw(a.radius,a.segments,a.thetaStart,a.thetaLength)}}class D0 extends pn{constructor(a=1,d=1,A=1,x=32,w=1,M=!1,N=0,P=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:a,radiusBottom:d,height:A,radialSegments:x,heightSegments:w,openEnded:M,thetaStart:N,thetaLength:P};const k=this;x=Math.floor(x),w=Math.floor(w);const j=[],Y=[],X=[],Z=[];let ie=0;const oe=[],ne=A/2;let ee=0;Me(),M===!1&&(a>0&&we(!0),d>0&&we(!1)),this.setIndex(j),this.setAttribute("position",new br(Y,3)),this.setAttribute("normal",new br(X,3)),this.setAttribute("uv",new br(Z,2));function Me(){const xe=new He,st=new He;let Qe=0;const Ze=(d-a)/A;for(let rt=0;rt<=w;rt++){const ze=[],De=rt/w,nt=De*(d-a)+a;for(let gt=0;gt<=x;gt++){const ft=gt/x,Rt=ft*P+N,Ut=Math.sin(Rt),fi=Math.cos(Rt);st.x=nt*Ut,st.y=-De*A+ne,st.z=nt*fi,Y.push(st.x,st.y,st.z),xe.set(Ut,Ze,fi).normalize(),X.push(xe.x,xe.y,xe.z),Z.push(ft,1-De),ze.push(ie++)}oe.push(ze)}for(let rt=0;rt<x;rt++)for(let ze=0;ze<w;ze++){const De=oe[ze][rt],nt=oe[ze+1][rt],gt=oe[ze+1][rt+1],ft=oe[ze][rt+1];j.push(De,nt,ft),j.push(nt,gt,ft),Qe+=6}k.addGroup(ee,Qe,0),ee+=Qe}function we(xe){const st=ie,Qe=new oi,Ze=new He;let rt=0;const ze=xe===!0?a:d,De=xe===!0?1:-1;for(let gt=1;gt<=x;gt++)Y.push(0,ne*De,0),X.push(0,De,0),Z.push(.5,.5),ie++;const nt=ie;for(let gt=0;gt<=x;gt++){const ft=gt/x*P+N,Rt=Math.cos(ft),Ut=Math.sin(ft);Ze.x=ze*Ut,Ze.y=ne*De,Ze.z=ze*Rt,Y.push(Ze.x,Ze.y,Ze.z),X.push(0,De,0),Qe.x=Rt*.5+.5,Qe.y=Ut*.5*De+.5,Z.push(Qe.x,Qe.y),ie++}for(let gt=0;gt<x;gt++){const ft=st+gt,Rt=nt+gt;xe===!0?j.push(Rt,Rt+1,ft):j.push(Rt+1,Rt,ft),rt+=3}k.addGroup(ee,rt,xe===!0?1:2),ee+=rt}}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new D0(a.radiusTop,a.radiusBottom,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength)}}class kw extends D0{constructor(a=1,d=1,A=32,x=1,w=!1,M=0,N=Math.PI*2){super(0,a,d,A,x,w,M,N),this.type="ConeGeometry",this.parameters={radius:a,height:d,radialSegments:A,heightSegments:x,openEnded:w,thetaStart:M,thetaLength:N}}static fromJSON(a){return new kw(a.radius,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength)}}class Yd extends pn{constructor(a=[],d=[],A=1,x=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:a,indices:d,radius:A,detail:x};const w=[],M=[];N(x),k(A),j(),this.setAttribute("position",new br(w,3)),this.setAttribute("normal",new br(w.slice(),3)),this.setAttribute("uv",new br(M,2)),x===0?this.computeVertexNormals():this.normalizeNormals();function N(Me){const we=new He,xe=new He,st=new He;for(let Qe=0;Qe<d.length;Qe+=3)Z(d[Qe+0],we),Z(d[Qe+1],xe),Z(d[Qe+2],st),P(we,xe,st,Me)}function P(Me,we,xe,st){const Qe=st+1,Ze=[];for(let rt=0;rt<=Qe;rt++){Ze[rt]=[];const ze=Me.clone().lerp(xe,rt/Qe),De=we.clone().lerp(xe,rt/Qe),nt=Qe-rt;for(let gt=0;gt<=nt;gt++)gt===0&&rt===Qe?Ze[rt][gt]=ze:Ze[rt][gt]=ze.clone().lerp(De,gt/nt)}for(let rt=0;rt<Qe;rt++)for(let ze=0;ze<2*(Qe-rt)-1;ze++){const De=Math.floor(ze/2);ze%2===0?(X(Ze[rt][De+1]),X(Ze[rt+1][De]),X(Ze[rt][De])):(X(Ze[rt][De+1]),X(Ze[rt+1][De+1]),X(Ze[rt+1][De]))}}function k(Me){const we=new He;for(let xe=0;xe<w.length;xe+=3)we.x=w[xe+0],we.y=w[xe+1],we.z=w[xe+2],we.normalize().multiplyScalar(Me),w[xe+0]=we.x,w[xe+1]=we.y,w[xe+2]=we.z}function j(){const Me=new He;for(let we=0;we<w.length;we+=3){Me.x=w[we+0],Me.y=w[we+1],Me.z=w[we+2];const xe=ne(Me)/2/Math.PI+.5,st=ee(Me)/Math.PI+.5;M.push(xe,1-st)}ie(),Y()}function Y(){for(let Me=0;Me<M.length;Me+=6){const we=M[Me+0],xe=M[Me+2],st=M[Me+4],Qe=Math.max(we,xe,st),Ze=Math.min(we,xe,st);Qe>.9&&Ze<.1&&(we<.2&&(M[Me+0]+=1),xe<.2&&(M[Me+2]+=1),st<.2&&(M[Me+4]+=1))}}function X(Me){w.push(Me.x,Me.y,Me.z)}function Z(Me,we){const xe=Me*3;we.x=a[xe+0],we.y=a[xe+1],we.z=a[xe+2]}function ie(){const Me=new He,we=new He,xe=new He,st=new He,Qe=new oi,Ze=new oi,rt=new oi;for(let ze=0,De=0;ze<w.length;ze+=9,De+=6){Me.set(w[ze+0],w[ze+1],w[ze+2]),we.set(w[ze+3],w[ze+4],w[ze+5]),xe.set(w[ze+6],w[ze+7],w[ze+8]),Qe.set(M[De+0],M[De+1]),Ze.set(M[De+2],M[De+3]),rt.set(M[De+4],M[De+5]),st.copy(Me).add(we).add(xe).divideScalar(3);const nt=ne(st);oe(Qe,De+0,Me,nt),oe(Ze,De+2,we,nt),oe(rt,De+4,xe,nt)}}function oe(Me,we,xe,st){st<0&&Me.x===1&&(M[we]=Me.x-1),xe.x===0&&xe.z===0&&(M[we]=st/2/Math.PI+.5)}function ne(Me){return Math.atan2(Me.z,-Me.x)}function ee(Me){return Math.atan2(-Me.y,Math.sqrt(Me.x*Me.x+Me.z*Me.z))}}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new Yd(a.vertices,a.indices,a.radius,a.details)}}class Fw extends Yd{constructor(a=1,d=0){const A=(1+Math.sqrt(5))/2,x=1/A,w=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-x,-A,0,-x,A,0,x,-A,0,x,A,-x,-A,0,-x,A,0,x,-A,0,x,A,0,-A,0,-x,A,0,-x,-A,0,x,A,0,x],M=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(w,M,a,d),this.type="DodecahedronGeometry",this.parameters={radius:a,detail:d}}static fromJSON(a){return new Fw(a.radius,a.detail)}}const Uw=new He,zw=new He,iL=new He,jw=new Il;class IV extends pn{constructor(a=null,d=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:a,thresholdAngle:d},a!==null){const A=Math.pow(10,4),x=Math.cos(Eh*d),w=a.getIndex(),M=a.getAttribute("position"),N=w?w.count:M.count,P=[0,0,0],k=["a","b","c"],j=new Array(3),Y={},X=[];for(let Z=0;Z<N;Z+=3){w?(P[0]=w.getX(Z),P[1]=w.getX(Z+1),P[2]=w.getX(Z+2)):(P[0]=Z,P[1]=Z+1,P[2]=Z+2);const{a:ie,b:oe,c:ne}=jw;if(ie.fromBufferAttribute(M,P[0]),oe.fromBufferAttribute(M,P[1]),ne.fromBufferAttribute(M,P[2]),jw.getNormal(iL),j[0]=`${Math.round(ie.x*A)},${Math.round(ie.y*A)},${Math.round(ie.z*A)}`,j[1]=`${Math.round(oe.x*A)},${Math.round(oe.y*A)},${Math.round(oe.z*A)}`,j[2]=`${Math.round(ne.x*A)},${Math.round(ne.y*A)},${Math.round(ne.z*A)}`,!(j[0]===j[1]||j[1]===j[2]||j[2]===j[0]))for(let ee=0;ee<3;ee++){const Me=(ee+1)%3,we=j[ee],xe=j[Me],st=jw[k[ee]],Qe=jw[k[Me]],Ze=`${we}_${xe}`,rt=`${xe}_${we}`;rt in Y&&Y[rt]?(iL.dot(Y[rt].normal)<=x&&(X.push(st.x,st.y,st.z),X.push(Qe.x,Qe.y,Qe.z)),Y[rt]=null):Ze in Y||(Y[Ze]={index0:P[ee],index1:P[Me],normal:iL.clone()})}}for(const Z in Y)if(Y[Z]){const{index0:ie,index1:oe}=Y[Z];Uw.fromBufferAttribute(M,ie),zw.fromBufferAttribute(M,oe),X.push(Uw.x,Uw.y,Uw.z),X.push(zw.x,zw.y,zw.z)}this.setAttribute("position",new br(X,3))}}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}}class If extends kv{constructor(a){super(a),this.uuid=No(),this.type="Shape",this.holes=[]}getPointsHoles(a){const d=[];for(let A=0,x=this.holes.length;A<x;A++)d[A]=this.holes[A].getPoints(a);return d}extractPoints(a){return{shape:this.getPoints(a),holes:this.getPointsHoles(a)}}copy(a){super.copy(a),this.holes=[];for(let d=0,A=a.holes.length;d<A;d++){const x=a.holes[d];this.holes.push(x.clone())}return this}toJSON(){const a=super.toJSON();a.uuid=this.uuid,a.holes=[];for(let d=0,A=this.holes.length;d<A;d++){const x=this.holes[d];a.holes.push(x.toJSON())}return a}fromJSON(a){super.fromJSON(a),this.uuid=a.uuid,this.holes=[];for(let d=0,A=a.holes.length;d<A;d++){const x=a.holes[d];this.holes.push(new kv().fromJSON(x))}return this}}const XRe={triangulate:function(S,a,d=2){const A=a&&a.length,x=A?a[0]*d:S.length;let w=BV(S,0,x,d,!0);const M=[];if(!w||w.next===w.prev)return M;let N,P,k,j,Y,X,Z;if(A&&(w=$Re(S,a,w,d)),S.length>80*d){N=k=S[0],P=j=S[1];for(let ie=d;ie<x;ie+=d)Y=S[ie],X=S[ie+1],Y<N&&(N=Y),X<P&&(P=X),Y>k&&(k=Y),X>j&&(j=X);Z=Math.max(k-N,j-P),Z=Z!==0?32767/Z:0}return Uv(w,M,d,N,P,Z,0),M}};function BV(S,a,d,A,x){let w,M;if(x===uIe(S,a,d,A)>0)for(w=a;w<d;w+=A)M=DV(w,S[w],S[w+1],M);else for(w=d-A;w>=a;w-=A)M=DV(w,S[w],S[w+1],M);return M&&Gw(M,M.next)&&(jv(M),M=M.next),M}function Bf(S,a){if(!S)return S;a||(a=S);let d=S,A;do if(A=!1,!d.steiner&&(Gw(d,d.next)||Ds(d.prev,d,d.next)===0)){if(jv(d),d=a=d.prev,d===d.next)break;A=!0}else d=d.next;while(A||d!==a);return a}function Uv(S,a,d,A,x,w,M){if(!S)return;!M&&w&&nIe(S,A,x,w);let N=S,P,k;for(;S.prev!==S.next;){if(P=S.prev,k=S.next,w?YRe(S,A,x,w):KRe(S)){a.push(P.i/d|0),a.push(S.i/d|0),a.push(k.i/d|0),jv(S),S=k.next,N=k.next;continue}if(S=k,S===N){M?M===1?(S=JRe(Bf(S),a,d),Uv(S,a,d,A,x,w,2)):M===2&&ZRe(S,a,d,A,x,w):Uv(Bf(S),a,d,A,x,w,1);break}}}function KRe(S){const a=S.prev,d=S,A=S.next;if(Ds(a,d,A)>=0)return!1;const x=a.x,w=d.x,M=A.x,N=a.y,P=d.y,k=A.y,j=x<w?x<M?x:M:w<M?w:M,Y=N<P?N<k?N:k:P<k?P:k,X=x>w?x>M?x:M:w>M?w:M,Z=N>P?N>k?N:k:P>k?P:k;let ie=A.next;for(;ie!==a;){if(ie.x>=j&&ie.x<=X&&ie.y>=Y&&ie.y<=Z&&O0(x,N,w,P,M,k,ie.x,ie.y)&&Ds(ie.prev,ie,ie.next)>=0)return!1;ie=ie.next}return!0}function YRe(S,a,d,A){const x=S.prev,w=S,M=S.next;if(Ds(x,w,M)>=0)return!1;const N=x.x,P=w.x,k=M.x,j=x.y,Y=w.y,X=M.y,Z=N<P?N<k?N:k:P<k?P:k,ie=j<Y?j<X?j:X:Y<X?Y:X,oe=N>P?N>k?N:k:P>k?P:k,ne=j>Y?j>X?j:X:Y>X?Y:X,ee=rL(Z,ie,a,d,A),Me=rL(oe,ne,a,d,A);let we=S.prevZ,xe=S.nextZ;for(;we&&we.z>=ee&&xe&&xe.z<=Me;){if(we.x>=Z&&we.x<=oe&&we.y>=ie&&we.y<=ne&&we!==x&&we!==M&&O0(N,j,P,Y,k,X,we.x,we.y)&&Ds(we.prev,we,we.next)>=0||(we=we.prevZ,xe.x>=Z&&xe.x<=oe&&xe.y>=ie&&xe.y<=ne&&xe!==x&&xe!==M&&O0(N,j,P,Y,k,X,xe.x,xe.y)&&Ds(xe.prev,xe,xe.next)>=0))return!1;xe=xe.nextZ}for(;we&&we.z>=ee;){if(we.x>=Z&&we.x<=oe&&we.y>=ie&&we.y<=ne&&we!==x&&we!==M&&O0(N,j,P,Y,k,X,we.x,we.y)&&Ds(we.prev,we,we.next)>=0)return!1;we=we.prevZ}for(;xe&&xe.z<=Me;){if(xe.x>=Z&&xe.x<=oe&&xe.y>=ie&&xe.y<=ne&&xe!==x&&xe!==M&&O0(N,j,P,Y,k,X,xe.x,xe.y)&&Ds(xe.prev,xe,xe.next)>=0)return!1;xe=xe.nextZ}return!0}function JRe(S,a,d){let A=S;do{const x=A.prev,w=A.next.next;!Gw(x,w)&&NV(x,A,A.next,w)&&zv(x,w)&&zv(w,x)&&(a.push(x.i/d|0),a.push(A.i/d|0),a.push(w.i/d|0),jv(A),jv(A.next),A=S=w),A=A.next}while(A!==S);return Bf(A)}function ZRe(S,a,d,A,x,w){let M=S;do{let N=M.next.next;for(;N!==M.prev;){if(M.i!==N.i&&oIe(M,N)){let P=LV(M,N);M=Bf(M,M.next),P=Bf(P,P.next),Uv(M,a,d,A,x,w,0),Uv(P,a,d,A,x,w,0);return}N=N.next}M=M.next}while(M!==S)}function $Re(S,a,d,A){const x=[];let w,M,N,P,k;for(w=0,M=a.length;w<M;w++)N=a[w]*A,P=w<M-1?a[w+1]*A:S.length,k=BV(S,N,P,A,!1),k===k.next&&(k.steiner=!0),x.push(aIe(k));for(x.sort(eIe),w=0;w<x.length;w++)d=tIe(x[w],d);return d}function eIe(S,a){return S.x-a.x}function tIe(S,a){const d=iIe(S,a);if(!d)return a;const A=LV(d,S);return Bf(A,A.next),Bf(d,d.next)}function iIe(S,a){let d=a,A=-1/0,x;const w=S.x,M=S.y;do{if(M<=d.y&&M>=d.next.y&&d.next.y!==d.y){const X=d.x+(M-d.y)*(d.next.x-d.x)/(d.next.y-d.y);if(X<=w&&X>A&&(A=X,x=d.x<d.next.x?d:d.next,X===w))return x}d=d.next}while(d!==a);if(!x)return null;const N=x,P=x.x,k=x.y;let j=1/0,Y;d=x;do w>=d.x&&d.x>=P&&w!==d.x&&O0(M<k?w:A,M,P,k,M<k?A:w,M,d.x,d.y)&&(Y=Math.abs(M-d.y)/(w-d.x),zv(d,S)&&(Y<j||Y===j&&(d.x>x.x||d.x===x.x&&rIe(x,d)))&&(x=d,j=Y)),d=d.next;while(d!==N);return x}function rIe(S,a){return Ds(S.prev,S,a.prev)<0&&Ds(a.next,S,S.next)<0}function nIe(S,a,d,A){let x=S;do x.z===0&&(x.z=rL(x.x,x.y,a,d,A)),x.prevZ=x.prev,x.nextZ=x.next,x=x.next;while(x!==S);x.prevZ.nextZ=null,x.prevZ=null,sIe(x)}function sIe(S){let a,d,A,x,w,M,N,P,k=1;do{for(d=S,S=null,w=null,M=0;d;){for(M++,A=d,N=0,a=0;a<k&&(N++,A=A.nextZ,!!A);a++);for(P=k;N>0||P>0&&A;)N!==0&&(P===0||!A||d.z<=A.z)?(x=d,d=d.nextZ,N--):(x=A,A=A.nextZ,P--),w?w.nextZ=x:S=x,x.prevZ=w,w=x;d=A}w.nextZ=null,k*=2}while(M>1);return S}function rL(S,a,d,A,x){return S=(S-d)*x|0,a=(a-A)*x|0,S=(S|S<<8)&16711935,S=(S|S<<4)&252645135,S=(S|S<<2)&858993459,S=(S|S<<1)&1431655765,a=(a|a<<8)&16711935,a=(a|a<<4)&252645135,a=(a|a<<2)&858993459,a=(a|a<<1)&1431655765,S|a<<1}function aIe(S){let a=S,d=S;do(a.x<d.x||a.x===d.x&&a.y<d.y)&&(d=a),a=a.next;while(a!==S);return d}function O0(S,a,d,A,x,w,M,N){return(x-M)*(a-N)>=(S-M)*(w-N)&&(S-M)*(A-N)>=(d-M)*(a-N)&&(d-M)*(w-N)>=(x-M)*(A-N)}function oIe(S,a){return S.next.i!==a.i&&S.prev.i!==a.i&&!lIe(S,a)&&(zv(S,a)&&zv(a,S)&&cIe(S,a)&&(Ds(S.prev,S,a.prev)||Ds(S,a.prev,a))||Gw(S,a)&&Ds(S.prev,S,S.next)>0&&Ds(a.prev,a,a.next)>0)}function Ds(S,a,d){return(a.y-S.y)*(d.x-a.x)-(a.x-S.x)*(d.y-a.y)}function Gw(S,a){return S.x===a.x&&S.y===a.y}function NV(S,a,d,A){const x=Hw(Ds(S,a,d)),w=Hw(Ds(S,a,A)),M=Hw(Ds(d,A,S)),N=Hw(Ds(d,A,a));return!!(x!==w&&M!==N||x===0&&Vw(S,d,a)||w===0&&Vw(S,A,a)||M===0&&Vw(d,S,A)||N===0&&Vw(d,a,A))}function Vw(S,a,d){return a.x<=Math.max(S.x,d.x)&&a.x>=Math.min(S.x,d.x)&&a.y<=Math.max(S.y,d.y)&&a.y>=Math.min(S.y,d.y)}function Hw(S){return S>0?1:S<0?-1:0}function lIe(S,a){let d=S;do{if(d.i!==S.i&&d.next.i!==S.i&&d.i!==a.i&&d.next.i!==a.i&&NV(d,d.next,S,a))return!0;d=d.next}while(d!==S);return!1}function zv(S,a){return Ds(S.prev,S,S.next)<0?Ds(S,a,S.next)>=0&&Ds(S,S.prev,a)>=0:Ds(S,a,S.prev)<0||Ds(S,S.next,a)<0}function cIe(S,a){let d=S,A=!1;const x=(S.x+a.x)/2,w=(S.y+a.y)/2;do d.y>w!=d.next.y>w&&d.next.y!==d.y&&x<(d.next.x-d.x)*(w-d.y)/(d.next.y-d.y)+d.x&&(A=!A),d=d.next;while(d!==S);return A}function LV(S,a){const d=new nL(S.i,S.x,S.y),A=new nL(a.i,a.x,a.y),x=S.next,w=a.prev;return S.next=a,a.prev=S,d.next=x,x.prev=d,A.next=d,d.prev=A,w.next=A,A.prev=w,A}function DV(S,a,d,A){const x=new nL(S,a,d);return A?(x.next=A.next,x.prev=A,A.next.prev=x,A.next=x):(x.prev=x,x.next=x),x}function jv(S){S.next.prev=S.prev,S.prev.next=S.next,S.prevZ&&(S.prevZ.nextZ=S.nextZ),S.nextZ&&(S.nextZ.prevZ=S.prevZ)}function nL(S,a,d){this.i=S,this.x=a,this.y=d,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function uIe(S,a,d,A){let x=0;for(let w=a,M=d-A;w<d;w+=A)x+=(S[M]-S[w])*(S[w+1]+S[M+1]),M=w;return x}class hu{static area(a){const d=a.length;let A=0;for(let x=d-1,w=0;w<d;x=w++)A+=a[x].x*a[w].y-a[w].x*a[x].y;return A*.5}static isClockWise(a){return hu.area(a)<0}static triangulateShape(a,d){const A=[],x=[],w=[];OV(a),PV(A,a);let M=a.length;d.forEach(OV);for(let P=0;P<d.length;P++)x.push(M),M+=d[P].length,PV(A,d[P]);const N=XRe.triangulate(A,x);for(let P=0;P<N.length;P+=3)w.push(N.slice(P,P+3));return w}}function OV(S){const a=S.length;a>2&&S[a-1].equals(S[0])&&S.pop()}function PV(S,a){for(let d=0;d<a.length;d++)S.push(a[d].x),S.push(a[d].y)}class Ww extends pn{constructor(a=new If([new oi(.5,.5),new oi(-.5,.5),new oi(-.5,-.5),new oi(.5,-.5)]),d={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:a,options:d},a=Array.isArray(a)?a:[a];const A=this,x=[],w=[];for(let N=0,P=a.length;N<P;N++){const k=a[N];M(k)}this.setAttribute("position",new br(x,3)),this.setAttribute("uv",new br(w,2)),this.computeVertexNormals();function M(N){const P=[],k=d.curveSegments!==void 0?d.curveSegments:12,j=d.steps!==void 0?d.steps:1,Y=d.depth!==void 0?d.depth:1;let X=d.bevelEnabled!==void 0?d.bevelEnabled:!0,Z=d.bevelThickness!==void 0?d.bevelThickness:.2,ie=d.bevelSize!==void 0?d.bevelSize:Z-.1,oe=d.bevelOffset!==void 0?d.bevelOffset:0,ne=d.bevelSegments!==void 0?d.bevelSegments:3;const ee=d.extrudePath,Me=d.UVGenerator!==void 0?d.UVGenerator:hIe;let we,xe=!1,st,Qe,Ze,rt;ee&&(we=ee.getSpacedPoints(j),xe=!0,X=!1,st=ee.computeFrenetFrames(j,!1),Qe=new He,Ze=new He,rt=new He),X||(ne=0,Z=0,ie=0,oe=0);const ze=N.extractPoints(k);let De=ze.shape;const nt=ze.holes;if(!hu.isClockWise(De)){De=De.reverse();for(let it=0,gi=nt.length;it<gi;it++){const ii=nt[it];hu.isClockWise(ii)&&(nt[it]=ii.reverse())}}const gt=hu.triangulateShape(De,nt),ft=De;for(let it=0,gi=nt.length;it<gi;it++){const ii=nt[it];De=De.concat(ii)}function Rt(it,gi,ii){return gi||console.error("THREE.ExtrudeGeometry: vec does not exist"),it.clone().addScaledVector(gi,ii)}const Ut=De.length,fi=gt.length;function Oi(it,gi,ii){let tr,ci,rr;const ir=it.x-gi.x,yr=it.y-gi.y,yn=ii.x-it.x,Wr=ii.y-it.y,ha=ir*ir+yr*yr,Xs=ir*Wr-yr*yn;if(Math.abs(Xs)>Number.EPSILON){const Wn=Math.sqrt(ha),et=Math.sqrt(yn*yn+Wr*Wr),Le=gi.x-yr/Wn,jt=gi.y+ir/Wn,pi=ii.x-Wr/et,Ai=ii.y+yn/et,li=((pi-Le)*Wr-(Ai-jt)*yn)/(ir*Wr-yr*yn);tr=Le+ir*li-it.x,ci=jt+yr*li-it.y;const Rr=tr*tr+ci*ci;if(Rr<=2)return new oi(tr,ci);rr=Math.sqrt(Rr/2)}else{let Wn=!1;ir>Number.EPSILON?yn>Number.EPSILON&&(Wn=!0):ir<-Number.EPSILON?yn<-Number.EPSILON&&(Wn=!0):Math.sign(yr)===Math.sign(Wr)&&(Wn=!0),Wn?(tr=-yr,ci=ir,rr=Math.sqrt(ha)):(tr=ir,ci=yr,rr=Math.sqrt(ha/2))}return new oi(tr/rr,ci/rr)}const zt=[];for(let it=0,gi=ft.length,ii=gi-1,tr=it+1;it<gi;it++,ii++,tr++)ii===gi&&(ii=0),tr===gi&&(tr=0),zt[it]=Oi(ft[it],ft[ii],ft[tr]);const bi=[];let Pi,Ur=zt.concat();for(let it=0,gi=nt.length;it<gi;it++){const ii=nt[it];Pi=[];for(let tr=0,ci=ii.length,rr=ci-1,ir=tr+1;tr<ci;tr++,rr++,ir++)rr===ci&&(rr=0),ir===ci&&(ir=0),Pi[tr]=Oi(ii[tr],ii[rr],ii[ir]);bi.push(Pi),Ur=Ur.concat(Pi)}for(let it=0;it<ne;it++){const gi=it/ne,ii=Z*Math.cos(gi*Math.PI/2),tr=ie*Math.sin(gi*Math.PI/2)+oe;for(let ci=0,rr=ft.length;ci<rr;ci++){const ir=Rt(ft[ci],zt[ci],tr);Nn(ir.x,ir.y,-ii)}for(let ci=0,rr=nt.length;ci<rr;ci++){const ir=nt[ci];Pi=bi[ci];for(let yr=0,yn=ir.length;yr<yn;yr++){const Wr=Rt(ir[yr],Pi[yr],tr);Nn(Wr.x,Wr.y,-ii)}}}const _n=ie+oe;for(let it=0;it<Ut;it++){const gi=X?Rt(De[it],Ur[it],_n):De[it];xe?(Ze.copy(st.normals[0]).multiplyScalar(gi.x),Qe.copy(st.binormals[0]).multiplyScalar(gi.y),rt.copy(we[0]).add(Ze).add(Qe),Nn(rt.x,rt.y,rt.z)):Nn(gi.x,gi.y,0)}for(let it=1;it<=j;it++)for(let gi=0;gi<Ut;gi++){const ii=X?Rt(De[gi],Ur[gi],_n):De[gi];xe?(Ze.copy(st.normals[it]).multiplyScalar(ii.x),Qe.copy(st.binormals[it]).multiplyScalar(ii.y),rt.copy(we[it]).add(Ze).add(Qe),Nn(rt.x,rt.y,rt.z)):Nn(ii.x,ii.y,Y/j*it)}for(let it=ne-1;it>=0;it--){const gi=it/ne,ii=Z*Math.cos(gi*Math.PI/2),tr=ie*Math.sin(gi*Math.PI/2)+oe;for(let ci=0,rr=ft.length;ci<rr;ci++){const ir=Rt(ft[ci],zt[ci],tr);Nn(ir.x,ir.y,Y+ii)}for(let ci=0,rr=nt.length;ci<rr;ci++){const ir=nt[ci];Pi=bi[ci];for(let yr=0,yn=ir.length;yr<yn;yr++){const Wr=Rt(ir[yr],Pi[yr],tr);xe?Nn(Wr.x,Wr.y+we[j-1].y,we[j-1].x+ii):Nn(Wr.x,Wr.y,Y+ii)}}}is(),ps();function is(){const it=x.length/3;if(X){let gi=0,ii=Ut*gi;for(let tr=0;tr<fi;tr++){const ci=gt[tr];Cr(ci[2]+ii,ci[1]+ii,ci[0]+ii)}gi=j+ne*2,ii=Ut*gi;for(let tr=0;tr<fi;tr++){const ci=gt[tr];Cr(ci[0]+ii,ci[1]+ii,ci[2]+ii)}}else{for(let gi=0;gi<fi;gi++){const ii=gt[gi];Cr(ii[2],ii[1],ii[0])}for(let gi=0;gi<fi;gi++){const ii=gt[gi];Cr(ii[0]+Ut*j,ii[1]+Ut*j,ii[2]+Ut*j)}}A.addGroup(it,x.length/3-it,0)}function ps(){const it=x.length/3;let gi=0;jn(ft,gi),gi+=ft.length;for(let ii=0,tr=nt.length;ii<tr;ii++){const ci=nt[ii];jn(ci,gi),gi+=ci.length}A.addGroup(it,x.length/3-it,1)}function jn(it,gi){let ii=it.length;for(;--ii>=0;){const tr=ii;let ci=ii-1;ci<0&&(ci=it.length-1);for(let rr=0,ir=j+ne*2;rr<ir;rr++){const yr=Ut*rr,yn=Ut*(rr+1),Wr=gi+tr+yr,ha=gi+ci+yr,Xs=gi+ci+yn,Wn=gi+tr+yn;di(Wr,ha,Xs,Wn)}}}function Nn(it,gi,ii){P.push(it),P.push(gi),P.push(ii)}function Cr(it,gi,ii){Ci(it),Ci(gi),Ci(ii);const tr=x.length/3,ci=Me.generateTopUV(A,x,tr-3,tr-2,tr-1);Xi(ci[0]),Xi(ci[1]),Xi(ci[2])}function di(it,gi,ii,tr){Ci(it),Ci(gi),Ci(tr),Ci(gi),Ci(ii),Ci(tr);const ci=x.length/3,rr=Me.generateSideWallUV(A,x,ci-6,ci-3,ci-2,ci-1);Xi(rr[0]),Xi(rr[1]),Xi(rr[3]),Xi(rr[1]),Xi(rr[2]),Xi(rr[3])}function Ci(it){x.push(P[it*3+0]),x.push(P[it*3+1]),x.push(P[it*3+2])}function Xi(it){w.push(it.x),w.push(it.y)}}}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}toJSON(){const a=super.toJSON(),d=this.parameters.shapes,A=this.parameters.options;return dIe(d,A,a)}static fromJSON(a,d){const A=[];for(let w=0,M=a.shapes.length;w<M;w++){const N=d[a.shapes[w]];A.push(N)}const x=a.options.extrudePath;return x!==void 0&&(a.options.extrudePath=new Dw[x.type]().fromJSON(x)),new Ww(A,a.options)}}const hIe={generateTopUV:function(S,a,d,A,x){const w=a[d*3],M=a[d*3+1],N=a[A*3],P=a[A*3+1],k=a[x*3],j=a[x*3+1];return[new oi(w,M),new oi(N,P),new oi(k,j)]},generateSideWallUV:function(S,a,d,A,x,w){const M=a[d*3],N=a[d*3+1],P=a[d*3+2],k=a[A*3],j=a[A*3+1],Y=a[A*3+2],X=a[x*3],Z=a[x*3+1],ie=a[x*3+2],oe=a[w*3],ne=a[w*3+1],ee=a[w*3+2];return Math.abs(N-j)<Math.abs(M-k)?[new oi(M,1-P),new oi(k,1-Y),new oi(X,1-ie),new oi(oe,1-ee)]:[new oi(N,1-P),new oi(j,1-Y),new oi(Z,1-ie),new oi(ne,1-ee)]}};function dIe(S,a,d){if(d.shapes=[],Array.isArray(S))for(let A=0,x=S.length;A<x;A++){const w=S[A];d.shapes.push(w.uuid)}else d.shapes.push(S.uuid);return d.options=Object.assign({},a),a.extrudePath!==void 0&&(d.options.extrudePath=a.extrudePath.toJSON()),d}class Qw extends Yd{constructor(a=1,d=0){const A=(1+Math.sqrt(5))/2,x=[-1,A,0,1,A,0,-1,-A,0,1,-A,0,0,-1,A,0,1,A,0,-1,-A,0,1,-A,A,0,-1,A,0,1,-A,0,-1,-A,0,1],w=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(x,w,a,d),this.type="IcosahedronGeometry",this.parameters={radius:a,detail:d}}static fromJSON(a){return new Qw(a.radius,a.detail)}}class Gv extends Yd{constructor(a=1,d=0){const A=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],x=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(A,x,a,d),this.type="OctahedronGeometry",this.parameters={radius:a,detail:d}}static fromJSON(a){return new Gv(a.radius,a.detail)}}class qw extends pn{constructor(a=.5,d=1,A=32,x=1,w=0,M=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:a,outerRadius:d,thetaSegments:A,phiSegments:x,thetaStart:w,thetaLength:M},A=Math.max(3,A),x=Math.max(1,x);const N=[],P=[],k=[],j=[];let Y=a;const X=(d-a)/x,Z=new He,ie=new oi;for(let oe=0;oe<=x;oe++){for(let ne=0;ne<=A;ne++){const ee=w+ne/A*M;Z.x=Y*Math.cos(ee),Z.y=Y*Math.sin(ee),P.push(Z.x,Z.y,Z.z),k.push(0,0,1),ie.x=(Z.x/d+1)/2,ie.y=(Z.y/d+1)/2,j.push(ie.x,ie.y)}Y+=X}for(let oe=0;oe<x;oe++){const ne=oe*(A+1);for(let ee=0;ee<A;ee++){const Me=ee+ne,we=Me,xe=Me+A+1,st=Me+A+2,Qe=Me+1;N.push(we,xe,Qe),N.push(xe,st,Qe)}}this.setIndex(N),this.setAttribute("position",new br(P,3)),this.setAttribute("normal",new br(k,3)),this.setAttribute("uv",new br(j,2))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new qw(a.innerRadius,a.outerRadius,a.thetaSegments,a.phiSegments,a.thetaStart,a.thetaLength)}}class Xw extends pn{constructor(a=new If([new oi(0,.5),new oi(-.5,-.5),new oi(.5,-.5)]),d=12){super(),this.type="ShapeGeometry",this.parameters={shapes:a,curveSegments:d};const A=[],x=[],w=[],M=[];let N=0,P=0;if(Array.isArray(a)===!1)k(a);else for(let j=0;j<a.length;j++)k(a[j]),this.addGroup(N,P,j),N+=P,P=0;this.setIndex(A),this.setAttribute("position",new br(x,3)),this.setAttribute("normal",new br(w,3)),this.setAttribute("uv",new br(M,2));function k(j){const Y=x.length/3,X=j.extractPoints(d);let Z=X.shape;const ie=X.holes;hu.isClockWise(Z)===!1&&(Z=Z.reverse());for(let ne=0,ee=ie.length;ne<ee;ne++){const Me=ie[ne];hu.isClockWise(Me)===!0&&(ie[ne]=Me.reverse())}const oe=hu.triangulateShape(Z,ie);for(let ne=0,ee=ie.length;ne<ee;ne++){const Me=ie[ne];Z=Z.concat(Me)}for(let ne=0,ee=Z.length;ne<ee;ne++){const Me=Z[ne];x.push(Me.x,Me.y,0),w.push(0,0,1),M.push(Me.x,Me.y)}for(let ne=0,ee=oe.length;ne<ee;ne++){const Me=oe[ne],we=Me[0]+Y,xe=Me[1]+Y,st=Me[2]+Y;A.push(we,xe,st),P+=3}}}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}toJSON(){const a=super.toJSON(),d=this.parameters.shapes;return pIe(d,a)}static fromJSON(a,d){const A=[];for(let x=0,w=a.shapes.length;x<w;x++){const M=d[a.shapes[x]];A.push(M)}return new Xw(A,a.curveSegments)}}function pIe(S,a){if(a.shapes=[],Array.isArray(S))for(let d=0,A=S.length;d<A;d++){const x=S[d];a.shapes.push(x.uuid)}else a.shapes.push(S.uuid);return a}class Vv extends pn{constructor(a=1,d=32,A=16,x=0,w=Math.PI*2,M=0,N=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:a,widthSegments:d,heightSegments:A,phiStart:x,phiLength:w,thetaStart:M,thetaLength:N},d=Math.max(3,Math.floor(d)),A=Math.max(2,Math.floor(A));const P=Math.min(M+N,Math.PI);let k=0;const j=[],Y=new He,X=new He,Z=[],ie=[],oe=[],ne=[];for(let ee=0;ee<=A;ee++){const Me=[],we=ee/A;let xe=0;ee===0&&M===0?xe=.5/d:ee===A&&P===Math.PI&&(xe=-.5/d);for(let st=0;st<=d;st++){const Qe=st/d;Y.x=-a*Math.cos(x+Qe*w)*Math.sin(M+we*N),Y.y=a*Math.cos(M+we*N),Y.z=a*Math.sin(x+Qe*w)*Math.sin(M+we*N),ie.push(Y.x,Y.y,Y.z),X.copy(Y).normalize(),oe.push(X.x,X.y,X.z),ne.push(Qe+xe,1-we),Me.push(k++)}j.push(Me)}for(let ee=0;ee<A;ee++)for(let Me=0;Me<d;Me++){const we=j[ee][Me+1],xe=j[ee][Me],st=j[ee+1][Me],Qe=j[ee+1][Me+1];(ee!==0||M>0)&&Z.push(we,xe,Qe),(ee!==A-1||P<Math.PI)&&Z.push(xe,st,Qe)}this.setIndex(Z),this.setAttribute("position",new br(ie,3)),this.setAttribute("normal",new br(oe,3)),this.setAttribute("uv",new br(ne,2))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new Vv(a.radius,a.widthSegments,a.heightSegments,a.phiStart,a.phiLength,a.thetaStart,a.thetaLength)}}class Kw extends Yd{constructor(a=1,d=0){const A=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],x=[2,1,0,0,3,2,1,3,0,2,3,1];super(A,x,a,d),this.type="TetrahedronGeometry",this.parameters={radius:a,detail:d}}static fromJSON(a){return new Kw(a.radius,a.detail)}}class Yw extends pn{constructor(a=1,d=.4,A=12,x=48,w=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:a,tube:d,radialSegments:A,tubularSegments:x,arc:w},A=Math.floor(A),x=Math.floor(x);const M=[],N=[],P=[],k=[],j=new He,Y=new He,X=new He;for(let Z=0;Z<=A;Z++)for(let ie=0;ie<=x;ie++){const oe=ie/x*w,ne=Z/A*Math.PI*2;Y.x=(a+d*Math.cos(ne))*Math.cos(oe),Y.y=(a+d*Math.cos(ne))*Math.sin(oe),Y.z=d*Math.sin(ne),N.push(Y.x,Y.y,Y.z),j.x=a*Math.cos(oe),j.y=a*Math.sin(oe),X.subVectors(Y,j).normalize(),P.push(X.x,X.y,X.z),k.push(ie/x),k.push(Z/A)}for(let Z=1;Z<=A;Z++)for(let ie=1;ie<=x;ie++){const oe=(x+1)*Z+ie-1,ne=(x+1)*(Z-1)+ie-1,ee=(x+1)*(Z-1)+ie,Me=(x+1)*Z+ie;M.push(oe,ne,Me),M.push(ne,ee,Me)}this.setIndex(M),this.setAttribute("position",new br(N,3)),this.setAttribute("normal",new br(P,3)),this.setAttribute("uv",new br(k,2))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new Yw(a.radius,a.tube,a.radialSegments,a.tubularSegments,a.arc)}}class Jw extends pn{constructor(a=1,d=.4,A=64,x=8,w=2,M=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:a,tube:d,tubularSegments:A,radialSegments:x,p:w,q:M},A=Math.floor(A),x=Math.floor(x);const N=[],P=[],k=[],j=[],Y=new He,X=new He,Z=new He,ie=new He,oe=new He,ne=new He,ee=new He;for(let we=0;we<=A;++we){const xe=we/A*w*Math.PI*2;Me(xe,w,M,a,Z),Me(xe+.01,w,M,a,ie),ne.subVectors(ie,Z),ee.addVectors(ie,Z),oe.crossVectors(ne,ee),ee.crossVectors(oe,ne),oe.normalize(),ee.normalize();for(let st=0;st<=x;++st){const Qe=st/x*Math.PI*2,Ze=-d*Math.cos(Qe),rt=d*Math.sin(Qe);Y.x=Z.x+(Ze*ee.x+rt*oe.x),Y.y=Z.y+(Ze*ee.y+rt*oe.y),Y.z=Z.z+(Ze*ee.z+rt*oe.z),P.push(Y.x,Y.y,Y.z),X.subVectors(Y,Z).normalize(),k.push(X.x,X.y,X.z),j.push(we/A),j.push(st/x)}}for(let we=1;we<=A;we++)for(let xe=1;xe<=x;xe++){const st=(x+1)*(we-1)+(xe-1),Qe=(x+1)*we+(xe-1),Ze=(x+1)*we+xe,rt=(x+1)*(we-1)+xe;N.push(st,Qe,rt),N.push(Qe,Ze,rt)}this.setIndex(N),this.setAttribute("position",new br(P,3)),this.setAttribute("normal",new br(k,3)),this.setAttribute("uv",new br(j,2));function Me(we,xe,st,Qe,Ze){const rt=Math.cos(we),ze=Math.sin(we),De=st/xe*we,nt=Math.cos(De);Ze.x=Qe*(2+nt)*.5*rt,Ze.y=Qe*(2+nt)*ze*.5,Ze.z=Qe*Math.sin(De)*.5}}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new Jw(a.radius,a.tube,a.tubularSegments,a.radialSegments,a.p,a.q)}}class Zw extends pn{constructor(a=new eL(new He(-1,-1,0),new He(-1,1,0),new He(1,1,0)),d=64,A=1,x=8,w=!1){super(),this.type="TubeGeometry",this.parameters={path:a,tubularSegments:d,radius:A,radialSegments:x,closed:w};const M=a.computeFrenetFrames(d,w);this.tangents=M.tangents,this.normals=M.normals,this.binormals=M.binormals;const N=new He,P=new He,k=new oi;let j=new He;const Y=[],X=[],Z=[],ie=[];oe(),this.setIndex(ie),this.setAttribute("position",new br(Y,3)),this.setAttribute("normal",new br(X,3)),this.setAttribute("uv",new br(Z,2));function oe(){for(let we=0;we<d;we++)ne(we);ne(w===!1?d:0),Me(),ee()}function ne(we){j=a.getPointAt(we/d,j);const xe=M.normals[we],st=M.binormals[we];for(let Qe=0;Qe<=x;Qe++){const Ze=Qe/x*Math.PI*2,rt=Math.sin(Ze),ze=-Math.cos(Ze);P.x=ze*xe.x+rt*st.x,P.y=ze*xe.y+rt*st.y,P.z=ze*xe.z+rt*st.z,P.normalize(),X.push(P.x,P.y,P.z),N.x=j.x+A*P.x,N.y=j.y+A*P.y,N.z=j.z+A*P.z,Y.push(N.x,N.y,N.z)}}function ee(){for(let we=1;we<=d;we++)for(let xe=1;xe<=x;xe++){const st=(x+1)*(we-1)+(xe-1),Qe=(x+1)*we+(xe-1),Ze=(x+1)*we+xe,rt=(x+1)*(we-1)+xe;ie.push(st,Qe,rt),ie.push(Qe,Ze,rt)}}function Me(){for(let we=0;we<=d;we++)for(let xe=0;xe<=x;xe++)k.x=we/d,k.y=xe/x,Z.push(k.x,k.y)}}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}toJSON(){const a=super.toJSON();return a.path=this.parameters.path.toJSON(),a}static fromJSON(a){return new Zw(new Dw[a.path.type]().fromJSON(a.path),a.tubularSegments,a.radius,a.radialSegments,a.closed)}}class kV extends pn{constructor(a=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:a},a!==null){const d=[],A=new Set,x=new He,w=new He;if(a.index!==null){const M=a.attributes.position,N=a.index;let P=a.groups;P.length===0&&(P=[{start:0,count:N.count,materialIndex:0}]);for(let k=0,j=P.length;k<j;++k){const Y=P[k],X=Y.start,Z=Y.count;for(let ie=X,oe=X+Z;ie<oe;ie+=3)for(let ne=0;ne<3;ne++){const ee=N.getX(ie+ne),Me=N.getX(ie+(ne+1)%3);x.fromBufferAttribute(M,ee),w.fromBufferAttribute(M,Me),FV(x,w,A)===!0&&(d.push(x.x,x.y,x.z),d.push(w.x,w.y,w.z))}}}else{const M=a.attributes.position;for(let N=0,P=M.count/3;N<P;N++)for(let k=0;k<3;k++){const j=3*N+k,Y=3*N+(k+1)%3;x.fromBufferAttribute(M,j),w.fromBufferAttribute(M,Y),FV(x,w,A)===!0&&(d.push(x.x,x.y,x.z),d.push(w.x,w.y,w.z))}}this.setAttribute("position",new br(d,3))}}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}}function FV(S,a,d){const A=`${S.x},${S.y},${S.z}-${a.x},${a.y},${a.z}`,x=`${a.x},${a.y},${a.z}-${S.x},${S.y},${S.z}`;return d.has(A)===!0||d.has(x)===!0?!1:(d.add(A),d.add(x),!0)}var UV=Object.freeze({__proto__:null,BoxGeometry:xf,CapsuleGeometry:Ow,CircleGeometry:Pw,ConeGeometry:kw,CylinderGeometry:D0,DodecahedronGeometry:Fw,EdgesGeometry:IV,ExtrudeGeometry:Ww,IcosahedronGeometry:Qw,LatheGeometry:Fv,OctahedronGeometry:Gv,PlaneGeometry:E0,PolyhedronGeometry:Yd,RingGeometry:qw,ShapeGeometry:Xw,SphereGeometry:Vv,TetrahedronGeometry:Kw,TorusGeometry:Yw,TorusKnotGeometry:Jw,TubeGeometry:Zw,WireframeGeometry:kV});class zV extends fo{constructor(a){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new lr(0),this.transparent=!0,this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.fog=a.fog,this}}class jV extends Oc{constructor(a){super(a),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class sL extends fo{constructor(a){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new lr(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new lr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=uo,this.normalScale=new oi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Rl,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.defines={STANDARD:""},this.color.copy(a.color),this.roughness=a.roughness,this.metalness=a.metalness,this.map=a.map,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.emissive.copy(a.emissive),this.emissiveMap=a.emissiveMap,this.emissiveIntensity=a.emissiveIntensity,this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.roughnessMap=a.roughnessMap,this.metalnessMap=a.metalnessMap,this.alphaMap=a.alphaMap,this.envMap=a.envMap,this.envMapRotation.copy(a.envMapRotation),this.envMapIntensity=a.envMapIntensity,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.flatShading=a.flatShading,this.fog=a.fog,this}}class GV extends sL{constructor(a){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new oi(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Ts(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(d){this.ior=(1+.4*d)/(1-.4*d)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new lr(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new lr(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new lr(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(a)}get anisotropy(){return this._anisotropy}set anisotropy(a){this._anisotropy>0!=a>0&&this.version++,this._anisotropy=a}get clearcoat(){return this._clearcoat}set clearcoat(a){this._clearcoat>0!=a>0&&this.version++,this._clearcoat=a}get iridescence(){return this._iridescence}set iridescence(a){this._iridescence>0!=a>0&&this.version++,this._iridescence=a}get dispersion(){return this._dispersion}set dispersion(a){this._dispersion>0!=a>0&&this.version++,this._dispersion=a}get sheen(){return this._sheen}set sheen(a){this._sheen>0!=a>0&&this.version++,this._sheen=a}get transmission(){return this._transmission}set transmission(a){this._transmission>0!=a>0&&this.version++,this._transmission=a}copy(a){return super.copy(a),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=a.anisotropy,this.anisotropyRotation=a.anisotropyRotation,this.anisotropyMap=a.anisotropyMap,this.clearcoat=a.clearcoat,this.clearcoatMap=a.clearcoatMap,this.clearcoatRoughness=a.clearcoatRoughness,this.clearcoatRoughnessMap=a.clearcoatRoughnessMap,this.clearcoatNormalMap=a.clearcoatNormalMap,this.clearcoatNormalScale.copy(a.clearcoatNormalScale),this.dispersion=a.dispersion,this.ior=a.ior,this.iridescence=a.iridescence,this.iridescenceMap=a.iridescenceMap,this.iridescenceIOR=a.iridescenceIOR,this.iridescenceThicknessRange=[...a.iridescenceThicknessRange],this.iridescenceThicknessMap=a.iridescenceThicknessMap,this.sheen=a.sheen,this.sheenColor.copy(a.sheenColor),this.sheenColorMap=a.sheenColorMap,this.sheenRoughness=a.sheenRoughness,this.sheenRoughnessMap=a.sheenRoughnessMap,this.transmission=a.transmission,this.transmissionMap=a.transmissionMap,this.thickness=a.thickness,this.thicknessMap=a.thicknessMap,this.attenuationDistance=a.attenuationDistance,this.attenuationColor.copy(a.attenuationColor),this.specularIntensity=a.specularIntensity,this.specularIntensityMap=a.specularIntensityMap,this.specularColor.copy(a.specularColor),this.specularColorMap=a.specularColorMap,this}}class VV extends fo{constructor(a){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new lr(16777215),this.specular=new lr(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new lr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=uo,this.normalScale=new oi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Rl,this.combine=Ge,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.specular.copy(a.specular),this.shininess=a.shininess,this.map=a.map,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.emissive.copy(a.emissive),this.emissiveMap=a.emissiveMap,this.emissiveIntensity=a.emissiveIntensity,this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.specularMap=a.specularMap,this.alphaMap=a.alphaMap,this.envMap=a.envMap,this.envMapRotation.copy(a.envMapRotation),this.combine=a.combine,this.reflectivity=a.reflectivity,this.refractionRatio=a.refractionRatio,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.flatShading=a.flatShading,this.fog=a.fog,this}}class HV extends fo{constructor(a){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new lr(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new lr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=uo,this.normalScale=new oi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.map=a.map,this.gradientMap=a.gradientMap,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.emissive.copy(a.emissive),this.emissiveMap=a.emissiveMap,this.emissiveIntensity=a.emissiveIntensity,this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.alphaMap=a.alphaMap,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.fog=a.fog,this}}class WV extends fo{constructor(a){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=uo,this.normalScale=new oi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(a)}copy(a){return super.copy(a),this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.flatShading=a.flatShading,this}}class QV extends fo{constructor(a){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new lr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new lr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=uo,this.normalScale=new oi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Rl,this.combine=Ge,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.map=a.map,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.emissive.copy(a.emissive),this.emissiveMap=a.emissiveMap,this.emissiveIntensity=a.emissiveIntensity,this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.specularMap=a.specularMap,this.alphaMap=a.alphaMap,this.envMap=a.envMap,this.envMapRotation.copy(a.envMapRotation),this.combine=a.combine,this.reflectivity=a.reflectivity,this.refractionRatio=a.refractionRatio,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.flatShading=a.flatShading,this.fog=a.fog,this}}class qV extends fo{constructor(a){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new lr(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=uo,this.normalScale=new oi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.defines={MATCAP:""},this.color.copy(a.color),this.matcap=a.matcap,this.map=a.map,this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.alphaMap=a.alphaMap,this.flatShading=a.flatShading,this.fog=a.fog,this}}class XV extends Po{constructor(a){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(a)}copy(a){return super.copy(a),this.scale=a.scale,this.dashSize=a.dashSize,this.gapSize=a.gapSize,this}}function Nf(S,a,d){return!S||!d&&S.constructor===a?S:typeof a.BYTES_PER_ELEMENT=="number"?new a(S):Array.prototype.slice.call(S)}function KV(S){return ArrayBuffer.isView(S)&&!(S instanceof DataView)}function YV(S){function a(x,w){return S[x]-S[w]}const d=S.length,A=new Array(d);for(let x=0;x!==d;++x)A[x]=x;return A.sort(a),A}function aL(S,a,d){const A=S.length,x=new S.constructor(A);for(let w=0,M=0;M!==A;++w){const N=d[w]*a;for(let P=0;P!==a;++P)x[M++]=S[N+P]}return x}function oL(S,a,d,A){let x=1,w=S[0];for(;w!==void 0&&w[A]===void 0;)w=S[x++];if(w===void 0)return;let M=w[A];if(M!==void 0)if(Array.isArray(M))do M=w[A],M!==void 0&&(a.push(w.time),d.push.apply(d,M)),w=S[x++];while(w!==void 0);else if(M.toArray!==void 0)do M=w[A],M!==void 0&&(a.push(w.time),M.toArray(d,d.length)),w=S[x++];while(w!==void 0);else do M=w[A],M!==void 0&&(a.push(w.time),d.push(M)),w=S[x++];while(w!==void 0)}function fIe(S,a,d,A,x=30){const w=S.clone();w.name=a;const M=[];for(let P=0;P<w.tracks.length;++P){const k=w.tracks[P],j=k.getValueSize(),Y=[],X=[];for(let Z=0;Z<k.times.length;++Z){const ie=k.times[Z]*x;if(!(ie<d||ie>=A)){Y.push(k.times[Z]);for(let oe=0;oe<j;++oe)X.push(k.values[Z*j+oe])}}Y.length!==0&&(k.times=Nf(Y,k.times.constructor),k.values=Nf(X,k.values.constructor),M.push(k))}w.tracks=M;let N=1/0;for(let P=0;P<w.tracks.length;++P)N>w.tracks[P].times[0]&&(N=w.tracks[P].times[0]);for(let P=0;P<w.tracks.length;++P)w.tracks[P].shift(-1*N);return w.resetDuration(),w}function mIe(S,a=0,d=S,A=30){A<=0&&(A=30);const x=d.tracks.length,w=a/A;for(let M=0;M<x;++M){const N=d.tracks[M],P=N.ValueTypeName;if(P==="bool"||P==="string")continue;const k=S.tracks.find(function(ee){return ee.name===N.name&&ee.ValueTypeName===P});if(k===void 0)continue;let j=0;const Y=N.getValueSize();N.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(j=Y/3);let X=0;const Z=k.getValueSize();k.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(X=Z/3);const ie=N.times.length-1;let oe;if(w<=N.times[0]){const ee=j,Me=Y-j;oe=N.values.slice(ee,Me)}else if(w>=N.times[ie]){const ee=ie*Y+j,Me=ee+Y-j;oe=N.values.slice(ee,Me)}else{const ee=N.createInterpolant(),Me=j,we=Y-j;ee.evaluate(w),oe=ee.resultBuffer.slice(Me,we)}P==="quaternion"&&new Vn().fromArray(oe).normalize().conjugate().toArray(oe);const ne=k.times.length;for(let ee=0;ee<ne;++ee){const Me=ee*Z+X;if(P==="quaternion")Vn.multiplyQuaternionsFlat(k.values,Me,oe,0,k.values,Me);else{const we=Z-X*2;for(let xe=0;xe<we;++xe)k.values[Me+xe]-=oe[xe]}}}return S.blendMode=Dr,S}const gIe={convertArray:Nf,isTypedArray:KV,getKeyframeOrder:YV,sortedArray:aL,flattenJSON:oL,subclip:fIe,makeClipAdditive:mIe};class Hv{constructor(a,d,A,x){this.parameterPositions=a,this._cachedIndex=0,this.resultBuffer=x!==void 0?x:new d.constructor(A),this.sampleValues=d,this.valueSize=A,this.settings=null,this.DefaultSettings_={}}evaluate(a){const d=this.parameterPositions;let A=this._cachedIndex,x=d[A],w=d[A-1];i:{e:{let M;t:{r:if(!(a<x)){for(let N=A+2;;){if(x===void 0){if(a<w)break r;return A=d.length,this._cachedIndex=A,this.copySampleValue_(A-1)}if(A===N)break;if(w=x,x=d[++A],a<x)break e}M=d.length;break t}if(!(a>=w)){const N=d[1];a<N&&(A=2,w=N);for(let P=A-2;;){if(w===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(A===P)break;if(x=w,w=d[--A-1],a>=w)break e}M=A,A=0;break t}break i}for(;A<M;){const N=A+M>>>1;a<d[N]?M=N:A=N+1}if(x=d[A],w=d[A-1],w===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(x===void 0)return A=d.length,this._cachedIndex=A,this.copySampleValue_(A-1)}this._cachedIndex=A,this.intervalChanged_(A,w,x)}return this.interpolate_(A,w,a,x)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(a){const d=this.resultBuffer,A=this.sampleValues,x=this.valueSize,w=a*x;for(let M=0;M!==x;++M)d[M]=A[w+M];return d}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class JV extends Hv{constructor(a,d,A,x){super(a,d,A,x),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Gr,endingEnd:Gr}}intervalChanged_(a,d,A){const x=this.parameterPositions;let w=a-2,M=a+1,N=x[w],P=x[M];if(N===void 0)switch(this.getSettings_().endingStart){case xn:w=a,N=2*d-A;break;case jr:w=x.length-2,N=d+x[w]-x[w+1];break;default:w=a,N=A}if(P===void 0)switch(this.getSettings_().endingEnd){case xn:M=a,P=2*A-d;break;case jr:M=1,P=A+x[1]-x[0];break;default:M=a-1,P=d}const k=(A-d)*.5,j=this.valueSize;this._weightPrev=k/(d-N),this._weightNext=k/(P-A),this._offsetPrev=w*j,this._offsetNext=M*j}interpolate_(a,d,A,x){const w=this.resultBuffer,M=this.sampleValues,N=this.valueSize,P=a*N,k=P-N,j=this._offsetPrev,Y=this._offsetNext,X=this._weightPrev,Z=this._weightNext,ie=(A-d)/(x-d),oe=ie*ie,ne=oe*ie,ee=-X*ne+2*X*oe-X*ie,Me=(1+X)*ne+(-1.5-2*X)*oe+(-.5+X)*ie+1,we=(-1-Z)*ne+(1.5+Z)*oe+.5*ie,xe=Z*ne-Z*oe;for(let st=0;st!==N;++st)w[st]=ee*M[j+st]+Me*M[k+st]+we*M[P+st]+xe*M[Y+st];return w}}class lL extends Hv{constructor(a,d,A,x){super(a,d,A,x)}interpolate_(a,d,A,x){const w=this.resultBuffer,M=this.sampleValues,N=this.valueSize,P=a*N,k=P-N,j=(A-d)/(x-d),Y=1-j;for(let X=0;X!==N;++X)w[X]=M[k+X]*Y+M[P+X]*j;return w}}class ZV extends Hv{constructor(a,d,A,x){super(a,d,A,x)}interpolate_(a){return this.copySampleValue_(a-1)}}class Fc{constructor(a,d,A,x){if(a===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(d===void 0||d.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+a);this.name=a,this.times=Nf(d,this.TimeBufferType),this.values=Nf(A,this.ValueBufferType),this.setInterpolation(x||this.DefaultInterpolation)}static toJSON(a){const d=a.constructor;let A;if(d.toJSON!==this.toJSON)A=d.toJSON(a);else{A={name:a.name,times:Nf(a.times,Array),values:Nf(a.values,Array)};const x=a.getInterpolation();x!==a.DefaultInterpolation&&(A.interpolation=x)}return A.type=a.ValueTypeName,A}InterpolantFactoryMethodDiscrete(a){return new ZV(this.times,this.values,this.getValueSize(),a)}InterpolantFactoryMethodLinear(a){return new lL(this.times,this.values,this.getValueSize(),a)}InterpolantFactoryMethodSmooth(a){return new JV(this.times,this.values,this.getValueSize(),a)}setInterpolation(a){let d;switch(a){case wr:d=this.InterpolantFactoryMethodDiscrete;break;case Tr:d=this.InterpolantFactoryMethodLinear;break;case Fr:d=this.InterpolantFactoryMethodSmooth;break}if(d===void 0){const A="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(a!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(A);return console.warn("THREE.KeyframeTrack:",A),this}return this.createInterpolant=d,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return wr;case this.InterpolantFactoryMethodLinear:return Tr;case this.InterpolantFactoryMethodSmooth:return Fr}}getValueSize(){return this.values.length/this.times.length}shift(a){if(a!==0){const d=this.times;for(let A=0,x=d.length;A!==x;++A)d[A]+=a}return this}scale(a){if(a!==1){const d=this.times;for(let A=0,x=d.length;A!==x;++A)d[A]*=a}return this}trim(a,d){const A=this.times,x=A.length;let w=0,M=x-1;for(;w!==x&&A[w]<a;)++w;for(;M!==-1&&A[M]>d;)--M;if(++M,w!==0||M!==x){w>=M&&(M=Math.max(M,1),w=M-1);const N=this.getValueSize();this.times=A.slice(w,M),this.values=this.values.slice(w*N,M*N)}return this}validate(){let a=!0;const d=this.getValueSize();d-Math.floor(d)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),a=!1);const A=this.times,x=this.values,w=A.length;w===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),a=!1);let M=null;for(let N=0;N!==w;N++){const P=A[N];if(typeof P=="number"&&isNaN(P)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,N,P),a=!1;break}if(M!==null&&M>P){console.error("THREE.KeyframeTrack: Out of order keys.",this,N,P,M),a=!1;break}M=P}if(x!==void 0&&KV(x))for(let N=0,P=x.length;N!==P;++N){const k=x[N];if(isNaN(k)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,N,k),a=!1;break}}return a}optimize(){const a=this.times.slice(),d=this.values.slice(),A=this.getValueSize(),x=this.getInterpolation()===Fr,w=a.length-1;let M=1;for(let N=1;N<w;++N){let P=!1;const k=a[N],j=a[N+1];if(k!==j&&(N!==1||k!==a[0]))if(x)P=!0;else{const Y=N*A,X=Y-A,Z=Y+A;for(let ie=0;ie!==A;++ie){const oe=d[Y+ie];if(oe!==d[X+ie]||oe!==d[Z+ie]){P=!0;break}}}if(P){if(N!==M){a[M]=a[N];const Y=N*A,X=M*A;for(let Z=0;Z!==A;++Z)d[X+Z]=d[Y+Z]}++M}}if(w>0){a[M]=a[w];for(let N=w*A,P=M*A,k=0;k!==A;++k)d[P+k]=d[N+k];++M}return M!==a.length?(this.times=a.slice(0,M),this.values=d.slice(0,M*A)):(this.times=a,this.values=d),this}clone(){const a=this.times.slice(),d=this.values.slice(),A=this.constructor,x=new A(this.name,a,d);return x.createInterpolant=this.createInterpolant,x}}Fc.prototype.TimeBufferType=Float32Array,Fc.prototype.ValueBufferType=Float32Array,Fc.prototype.DefaultInterpolation=Tr;class Lf extends Fc{}Lf.prototype.ValueTypeName="bool",Lf.prototype.ValueBufferType=Array,Lf.prototype.DefaultInterpolation=wr,Lf.prototype.InterpolantFactoryMethodLinear=void 0,Lf.prototype.InterpolantFactoryMethodSmooth=void 0;class cL extends Fc{}cL.prototype.ValueTypeName="color";class Wv extends Fc{}Wv.prototype.ValueTypeName="number";class $V extends Hv{constructor(a,d,A,x){super(a,d,A,x)}interpolate_(a,d,A,x){const w=this.resultBuffer,M=this.sampleValues,N=this.valueSize,P=(A-d)/(x-d);let k=a*N;for(let j=k+N;k!==j;k+=4)Vn.slerpFlat(w,0,M,k-N,M,k,P);return w}}class P0 extends Fc{InterpolantFactoryMethodLinear(a){return new $V(this.times,this.values,this.getValueSize(),a)}}P0.prototype.ValueTypeName="quaternion",P0.prototype.DefaultInterpolation=Tr,P0.prototype.InterpolantFactoryMethodSmooth=void 0;class Df extends Fc{}Df.prototype.ValueTypeName="string",Df.prototype.ValueBufferType=Array,Df.prototype.DefaultInterpolation=wr,Df.prototype.InterpolantFactoryMethodLinear=void 0,Df.prototype.InterpolantFactoryMethodSmooth=void 0;class Qv extends Fc{}Qv.prototype.ValueTypeName="vector";class qv{constructor(a="",d=-1,A=[],x=hs){this.name=a,this.tracks=A,this.duration=d,this.blendMode=x,this.uuid=No(),this.duration<0&&this.resetDuration()}static parse(a){const d=[],A=a.tracks,x=1/(a.fps||1);for(let M=0,N=A.length;M!==N;++M)d.push(yIe(A[M]).scale(x));const w=new this(a.name,a.duration,d,a.blendMode);return w.uuid=a.uuid,w}static toJSON(a){const d=[],A=a.tracks,x={name:a.name,duration:a.duration,tracks:d,uuid:a.uuid,blendMode:a.blendMode};for(let w=0,M=A.length;w!==M;++w)d.push(Fc.toJSON(A[w]));return x}static CreateFromMorphTargetSequence(a,d,A,x){const w=d.length,M=[];for(let N=0;N<w;N++){let P=[],k=[];P.push((N+w-1)%w,N,(N+1)%w),k.push(0,1,0);const j=YV(P);P=aL(P,1,j),k=aL(k,1,j),!x&&P[0]===0&&(P.push(w),k.push(k[0])),M.push(new Wv(".morphTargetInfluences["+d[N].name+"]",P,k).scale(1/A))}return new this(a,-1,M)}static findByName(a,d){let A=a;if(!Array.isArray(a)){const x=a;A=x.geometry&&x.geometry.animations||x.animations}for(let x=0;x<A.length;x++)if(A[x].name===d)return A[x];return null}static CreateClipsFromMorphTargetSequences(a,d,A){const x={},w=/^([\w-]*?)([\d]+)$/;for(let N=0,P=a.length;N<P;N++){const k=a[N],j=k.name.match(w);if(j&&j.length>1){const Y=j[1];let X=x[Y];X||(x[Y]=X=[]),X.push(k)}}const M=[];for(const N in x)M.push(this.CreateFromMorphTargetSequence(N,x[N],d,A));return M}static parseAnimation(a,d){if(!a)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const A=function(j,Y,X,Z,ie){if(X.length!==0){const oe=[],ne=[];oL(X,oe,ne,Z),oe.length!==0&&ie.push(new j(Y,oe,ne))}},x=[],w=a.name||"default",M=a.fps||30,N=a.blendMode;let P=a.length||-1;const k=a.hierarchy||[];for(let j=0;j<k.length;j++){const Y=k[j].keys;if(!(!Y||Y.length===0))if(Y[0].morphTargets){const X={};let Z;for(Z=0;Z<Y.length;Z++)if(Y[Z].morphTargets)for(let ie=0;ie<Y[Z].morphTargets.length;ie++)X[Y[Z].morphTargets[ie]]=-1;for(const ie in X){const oe=[],ne=[];for(let ee=0;ee!==Y[Z].morphTargets.length;++ee){const Me=Y[Z];oe.push(Me.time),ne.push(Me.morphTarget===ie?1:0)}x.push(new Wv(".morphTargetInfluence["+ie+"]",oe,ne))}P=X.length*M}else{const X=".bones["+d[j].name+"]";A(Qv,X+".position",Y,"pos",x),A(P0,X+".quaternion",Y,"rot",x),A(Qv,X+".scale",Y,"scl",x)}}return x.length===0?null:new this(w,P,x,N)}resetDuration(){const a=this.tracks;let d=0;for(let A=0,x=a.length;A!==x;++A){const w=this.tracks[A];d=Math.max(d,w.times[w.times.length-1])}return this.duration=d,this}trim(){for(let a=0;a<this.tracks.length;a++)this.tracks[a].trim(0,this.duration);return this}validate(){let a=!0;for(let d=0;d<this.tracks.length;d++)a=a&&this.tracks[d].validate();return a}optimize(){for(let a=0;a<this.tracks.length;a++)this.tracks[a].optimize();return this}clone(){const a=[];for(let d=0;d<this.tracks.length;d++)a.push(this.tracks[d].clone());return new this.constructor(this.name,this.duration,a,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function AIe(S){switch(S.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Wv;case"vector":case"vector2":case"vector3":case"vector4":return Qv;case"color":return cL;case"quaternion":return P0;case"bool":case"boolean":return Lf;case"string":return Df}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+S)}function yIe(S){if(S.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const a=AIe(S.type);if(S.times===void 0){const d=[],A=[];oL(S.keys,d,A,"value"),S.times=d,S.values=A}return a.parse!==void 0?a.parse(S):new a(S.name,S.times,S.values,S.interpolation)}const Bh={enabled:!1,files:{},add:function(S,a){this.enabled!==!1&&(this.files[S]=a)},get:function(S){if(this.enabled!==!1)return this.files[S]},remove:function(S){delete this.files[S]},clear:function(){this.files={}}};class uL{constructor(a,d,A){const x=this;let w=!1,M=0,N=0,P;const k=[];this.onStart=void 0,this.onLoad=a,this.onProgress=d,this.onError=A,this.itemStart=function(j){N++,w===!1&&x.onStart!==void 0&&x.onStart(j,M,N),w=!0},this.itemEnd=function(j){M++,x.onProgress!==void 0&&x.onProgress(j,M,N),M===N&&(w=!1,x.onLoad!==void 0&&x.onLoad())},this.itemError=function(j){x.onError!==void 0&&x.onError(j)},this.resolveURL=function(j){return P?P(j):j},this.setURLModifier=function(j){return P=j,this},this.addHandler=function(j,Y){return k.push(j,Y),this},this.removeHandler=function(j){const Y=k.indexOf(j);return Y!==-1&&k.splice(Y,2),this},this.getHandler=function(j){for(let Y=0,X=k.length;Y<X;Y+=2){const Z=k[Y],ie=k[Y+1];if(Z.global&&(Z.lastIndex=0),Z.test(j))return ie}return null}}}const eH=new uL;class ol{constructor(a){this.manager=a!==void 0?a:eH,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(a,d){const A=this;return new Promise(function(x,w){A.load(a,x,d,w)})}parse(){}setCrossOrigin(a){return this.crossOrigin=a,this}setWithCredentials(a){return this.withCredentials=a,this}setPath(a){return this.path=a,this}setResourcePath(a){return this.resourcePath=a,this}setRequestHeader(a){return this.requestHeader=a,this}}ol.DEFAULT_MATERIAL_NAME="__DEFAULT";const Nh={};class vIe extends Error{constructor(a,d){super(a),this.response=d}}class Lh extends ol{constructor(a){super(a)}load(a,d,A,x){a===void 0&&(a=""),this.path!==void 0&&(a=this.path+a),a=this.manager.resolveURL(a);const w=Bh.get(a);if(w!==void 0)return this.manager.itemStart(a),setTimeout(()=>{d&&d(w),this.manager.itemEnd(a)},0),w;if(Nh[a]!==void 0){Nh[a].push({onLoad:d,onProgress:A,onError:x});return}Nh[a]=[],Nh[a].push({onLoad:d,onProgress:A,onError:x});const M=new Request(a,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),N=this.mimeType,P=this.responseType;fetch(M).then(k=>{if(k.status===200||k.status===0){if(k.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||k.body===void 0||k.body.getReader===void 0)return k;const j=Nh[a],Y=k.body.getReader(),X=k.headers.get("X-File-Size")||k.headers.get("Content-Length"),Z=X?parseInt(X):0,ie=Z!==0;let oe=0;const ne=new ReadableStream({start(ee){Me();function Me(){Y.read().then(({done:we,value:xe})=>{if(we)ee.close();else{oe+=xe.byteLength;const st=new ProgressEvent("progress",{lengthComputable:ie,loaded:oe,total:Z});for(let Qe=0,Ze=j.length;Qe<Ze;Qe++){const rt=j[Qe];rt.onProgress&&rt.onProgress(st)}ee.enqueue(xe),Me()}})}}});return new Response(ne)}else throw new vIe(`fetch for "${k.url}" responded with ${k.status}: ${k.statusText}`,k)}).then(k=>{switch(P){case"arraybuffer":return k.arrayBuffer();case"blob":return k.blob();case"document":return k.text().then(j=>new DOMParser().parseFromString(j,N));case"json":return k.json();default:if(N===void 0)return k.text();{const j=/charset="?([^;"\s]*)"?/i.exec(N),Y=j&&j[1]?j[1].toLowerCase():void 0,X=new TextDecoder(Y);return k.arrayBuffer().then(Z=>X.decode(Z))}}}).then(k=>{Bh.add(a,k);const j=Nh[a];delete Nh[a];for(let Y=0,X=j.length;Y<X;Y++){const Z=j[Y];Z.onLoad&&Z.onLoad(k)}}).catch(k=>{const j=Nh[a];if(j===void 0)throw this.manager.itemError(a),k;delete Nh[a];for(let Y=0,X=j.length;Y<X;Y++){const Z=j[Y];Z.onError&&Z.onError(k)}this.manager.itemError(a)}).finally(()=>{this.manager.itemEnd(a)}),this.manager.itemStart(a)}setResponseType(a){return this.responseType=a,this}setMimeType(a){return this.mimeType=a,this}}class bIe extends ol{constructor(a){super(a)}load(a,d,A,x){const w=this,M=new Lh(this.manager);M.setPath(this.path),M.setRequestHeader(this.requestHeader),M.setWithCredentials(this.withCredentials),M.load(a,function(N){try{d(w.parse(JSON.parse(N)))}catch(P){x?x(P):console.error(P),w.manager.itemError(a)}},A,x)}parse(a){const d=[];for(let A=0;A<a.length;A++){const x=qv.parse(a[A]);d.push(x)}return d}}class xIe extends ol{constructor(a){super(a)}load(a,d,A,x){const w=this,M=[],N=new Bw,P=new Lh(this.manager);P.setPath(this.path),P.setResponseType("arraybuffer"),P.setRequestHeader(this.requestHeader),P.setWithCredentials(w.withCredentials);let k=0;function j(Y){P.load(a[Y],function(X){const Z=w.parse(X,!0);M[Y]={width:Z.width,height:Z.height,format:Z.format,mipmaps:Z.mipmaps},k+=1,k===6&&(Z.mipmapCount===1&&(N.minFilter=Fi),N.image=M,N.format=Z.format,N.needsUpdate=!0,d&&d(N))},A,x)}if(Array.isArray(a))for(let Y=0,X=a.length;Y<X;++Y)j(Y);else P.load(a,function(Y){const X=w.parse(Y,!0);if(X.isCubemap){const Z=X.mipmaps.length/X.mipmapCount;for(let ie=0;ie<Z;ie++){M[ie]={mipmaps:[]};for(let oe=0;oe<X.mipmapCount;oe++)M[ie].mipmaps.push(X.mipmaps[ie*X.mipmapCount+oe]),M[ie].format=X.format,M[ie].width=X.width,M[ie].height=X.height}N.image=M}else N.image.width=X.width,N.image.height=X.height,N.mipmaps=X.mipmaps;X.mipmapCount===1&&(N.minFilter=Fi),N.format=X.format,N.needsUpdate=!0,d&&d(N)},A,x);return N}}class Xv extends ol{constructor(a){super(a)}load(a,d,A,x){this.path!==void 0&&(a=this.path+a),a=this.manager.resolveURL(a);const w=this,M=Bh.get(a);if(M!==void 0)return w.manager.itemStart(a),setTimeout(function(){d&&d(M),w.manager.itemEnd(a)},0),M;const N=vf("img");function P(){j(),Bh.add(a,this),d&&d(this),w.manager.itemEnd(a)}function k(Y){j(),x&&x(Y),w.manager.itemError(a),w.manager.itemEnd(a)}function j(){N.removeEventListener("load",P,!1),N.removeEventListener("error",k,!1)}return N.addEventListener("load",P,!1),N.addEventListener("error",k,!1),a.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(N.crossOrigin=this.crossOrigin),w.manager.itemStart(a),N.src=a,N}}class _Ie extends ol{constructor(a){super(a)}load(a,d,A,x){const w=new Cv;w.colorSpace=On;const M=new Xv(this.manager);M.setCrossOrigin(this.crossOrigin),M.setPath(this.path);let N=0;function P(k){M.load(a[k],function(j){w.images[k]=j,N++,N===6&&(w.needsUpdate=!0,d&&d(w))},void 0,x)}for(let k=0;k<a.length;++k)P(k);return w}}class EIe extends ol{constructor(a){super(a)}load(a,d,A,x){const w=this,M=new qd,N=new Lh(this.manager);return N.setResponseType("arraybuffer"),N.setRequestHeader(this.requestHeader),N.setPath(this.path),N.setWithCredentials(w.withCredentials),N.load(a,function(P){let k;try{k=w.parse(P)}catch(j){if(x!==void 0)x(j);else{console.error(j);return}}k.image!==void 0?M.image=k.image:k.data!==void 0&&(M.image.width=k.width,M.image.height=k.height,M.image.data=k.data),M.wrapS=k.wrapS!==void 0?k.wrapS:je,M.wrapT=k.wrapT!==void 0?k.wrapT:je,M.magFilter=k.magFilter!==void 0?k.magFilter:Fi,M.minFilter=k.minFilter!==void 0?k.minFilter:Fi,M.anisotropy=k.anisotropy!==void 0?k.anisotropy:1,k.colorSpace!==void 0&&(M.colorSpace=k.colorSpace),k.flipY!==void 0&&(M.flipY=k.flipY),k.format!==void 0&&(M.format=k.format),k.type!==void 0&&(M.type=k.type),k.mipmaps!==void 0&&(M.mipmaps=k.mipmaps,M.minFilter=nn),k.mipmapCount===1&&(M.minFilter=Fi),k.generateMipmaps!==void 0&&(M.generateMipmaps=k.generateMipmaps),M.needsUpdate=!0,d&&d(M,k)},A,x),M}}class wIe extends ol{constructor(a){super(a)}load(a,d,A,x){const w=new ds,M=new Xv(this.manager);return M.setCrossOrigin(this.crossOrigin),M.setPath(this.path),M.load(a,function(N){w.image=N,w.needsUpdate=!0,d!==void 0&&d(w)},A,x),w}}class Jd extends Hn{constructor(a,d=1){super(),this.isLight=!0,this.type="Light",this.color=new lr(a),this.intensity=d}dispose(){}copy(a,d){return super.copy(a,d),this.color.copy(a.color),this.intensity=a.intensity,this}toJSON(a){const d=super.toJSON(a);return d.object.color=this.color.getHex(),d.object.intensity=this.intensity,this.groundColor!==void 0&&(d.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(d.object.distance=this.distance),this.angle!==void 0&&(d.object.angle=this.angle),this.decay!==void 0&&(d.object.decay=this.decay),this.penumbra!==void 0&&(d.object.penumbra=this.penumbra),this.shadow!==void 0&&(d.object.shadow=this.shadow.toJSON()),d}}class tH extends Jd{constructor(a,d,A){super(a,A),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Hn.DEFAULT_UP),this.updateMatrix(),this.groundColor=new lr(d)}copy(a,d){return super.copy(a,d),this.groundColor.copy(a.groundColor),this}}const hL=new mr,iH=new He,rH=new He;class dL{constructor(a){this.camera=a,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new oi(512,512),this.map=null,this.mapPass=null,this.matrix=new mr,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Sv,this._frameExtents=new oi(1,1),this._viewportCount=1,this._viewports=[new Un(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(a){const d=this.camera,A=this.matrix;iH.setFromMatrixPosition(a.matrixWorld),d.position.copy(iH),rH.setFromMatrixPosition(a.target.matrixWorld),d.lookAt(rH),d.updateMatrixWorld(),hL.multiplyMatrices(d.projectionMatrix,d.matrixWorldInverse),this._frustum.setFromProjectionMatrix(hL),A.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),A.multiply(hL)}getViewport(a){return this._viewports[a]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(a){return this.camera=a.camera.clone(),this.bias=a.bias,this.radius=a.radius,this.mapSize.copy(a.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const a={};return this.bias!==0&&(a.bias=this.bias),this.normalBias!==0&&(a.normalBias=this.normalBias),this.radius!==1&&(a.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(a.mapSize=this.mapSize.toArray()),a.camera=this.camera.toJSON(!1).object,delete a.camera.matrix,a}}class CIe extends dL{constructor(){super(new va(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(a){const d=this.camera,A=kd*2*a.angle*this.focus,x=this.mapSize.width/this.mapSize.height,w=a.distance||d.far;(A!==d.fov||x!==d.aspect||w!==d.far)&&(d.fov=A,d.aspect=x,d.far=w,d.updateProjectionMatrix()),super.updateMatrices(a)}copy(a){return super.copy(a),this.focus=a.focus,this}}class nH extends Jd{constructor(a,d,A=0,x=Math.PI/3,w=0,M=2){super(a,d),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Hn.DEFAULT_UP),this.updateMatrix(),this.target=new Hn,this.distance=A,this.angle=x,this.penumbra=w,this.decay=M,this.map=null,this.shadow=new CIe}get power(){return this.intensity*Math.PI}set power(a){this.intensity=a/Math.PI}dispose(){this.shadow.dispose()}copy(a,d){return super.copy(a,d),this.distance=a.distance,this.angle=a.angle,this.penumbra=a.penumbra,this.decay=a.decay,this.target=a.target.clone(),this.shadow=a.shadow.clone(),this}}const sH=new mr,Kv=new He,pL=new He;class SIe extends dL{constructor(){super(new va(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new oi(4,2),this._viewportCount=6,this._viewports=[new Un(2,1,1,1),new Un(0,1,1,1),new Un(3,1,1,1),new Un(1,1,1,1),new Un(3,0,1,1),new Un(1,0,1,1)],this._cubeDirections=[new He(1,0,0),new He(-1,0,0),new He(0,0,1),new He(0,0,-1),new He(0,1,0),new He(0,-1,0)],this._cubeUps=[new He(0,1,0),new He(0,1,0),new He(0,1,0),new He(0,1,0),new He(0,0,1),new He(0,0,-1)]}updateMatrices(a,d=0){const A=this.camera,x=this.matrix,w=a.distance||A.far;w!==A.far&&(A.far=w,A.updateProjectionMatrix()),Kv.setFromMatrixPosition(a.matrixWorld),A.position.copy(Kv),pL.copy(A.position),pL.add(this._cubeDirections[d]),A.up.copy(this._cubeUps[d]),A.lookAt(pL),A.updateMatrixWorld(),x.makeTranslation(-Kv.x,-Kv.y,-Kv.z),sH.multiplyMatrices(A.projectionMatrix,A.matrixWorldInverse),this._frustum.setFromProjectionMatrix(sH)}}class aH extends Jd{constructor(a,d,A=0,x=2){super(a,d),this.isPointLight=!0,this.type="PointLight",this.distance=A,this.decay=x,this.shadow=new SIe}get power(){return this.intensity*4*Math.PI}set power(a){this.intensity=a/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(a,d){return super.copy(a,d),this.distance=a.distance,this.decay=a.decay,this.shadow=a.shadow.clone(),this}}class TIe extends dL{constructor(){super(new cw(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class oH extends Jd{constructor(a,d){super(a,d),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Hn.DEFAULT_UP),this.updateMatrix(),this.target=new Hn,this.shadow=new TIe}dispose(){this.shadow.dispose()}copy(a){return super.copy(a),this.target=a.target.clone(),this.shadow=a.shadow.clone(),this}}class lH extends Jd{constructor(a,d){super(a,d),this.isAmbientLight=!0,this.type="AmbientLight"}}class cH extends Jd{constructor(a,d,A=10,x=10){super(a,d),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=A,this.height=x}get power(){return this.intensity*this.width*this.height*Math.PI}set power(a){this.intensity=a/(this.width*this.height*Math.PI)}copy(a){return super.copy(a),this.width=a.width,this.height=a.height,this}toJSON(a){const d=super.toJSON(a);return d.object.width=this.width,d.object.height=this.height,d}}class uH{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let a=0;a<9;a++)this.coefficients.push(new He)}set(a){for(let d=0;d<9;d++)this.coefficients[d].copy(a[d]);return this}zero(){for(let a=0;a<9;a++)this.coefficients[a].set(0,0,0);return this}getAt(a,d){const A=a.x,x=a.y,w=a.z,M=this.coefficients;return d.copy(M[0]).multiplyScalar(.282095),d.addScaledVector(M[1],.488603*x),d.addScaledVector(M[2],.488603*w),d.addScaledVector(M[3],.488603*A),d.addScaledVector(M[4],1.092548*(A*x)),d.addScaledVector(M[5],1.092548*(x*w)),d.addScaledVector(M[6],.315392*(3*w*w-1)),d.addScaledVector(M[7],1.092548*(A*w)),d.addScaledVector(M[8],.546274*(A*A-x*x)),d}getIrradianceAt(a,d){const A=a.x,x=a.y,w=a.z,M=this.coefficients;return d.copy(M[0]).multiplyScalar(.886227),d.addScaledVector(M[1],1.023328*x),d.addScaledVector(M[2],1.023328*w),d.addScaledVector(M[3],1.023328*A),d.addScaledVector(M[4],.858086*A*x),d.addScaledVector(M[5],.858086*x*w),d.addScaledVector(M[6],.743125*w*w-.247708),d.addScaledVector(M[7],.858086*A*w),d.addScaledVector(M[8],.429043*(A*A-x*x)),d}add(a){for(let d=0;d<9;d++)this.coefficients[d].add(a.coefficients[d]);return this}addScaledSH(a,d){for(let A=0;A<9;A++)this.coefficients[A].addScaledVector(a.coefficients[A],d);return this}scale(a){for(let d=0;d<9;d++)this.coefficients[d].multiplyScalar(a);return this}lerp(a,d){for(let A=0;A<9;A++)this.coefficients[A].lerp(a.coefficients[A],d);return this}equals(a){for(let d=0;d<9;d++)if(!this.coefficients[d].equals(a.coefficients[d]))return!1;return!0}copy(a){return this.set(a.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(a,d=0){const A=this.coefficients;for(let x=0;x<9;x++)A[x].fromArray(a,d+x*3);return this}toArray(a=[],d=0){const A=this.coefficients;for(let x=0;x<9;x++)A[x].toArray(a,d+x*3);return a}static getBasisAt(a,d){const A=a.x,x=a.y,w=a.z;d[0]=.282095,d[1]=.488603*x,d[2]=.488603*w,d[3]=.488603*A,d[4]=1.092548*A*x,d[5]=1.092548*x*w,d[6]=.315392*(3*w*w-1),d[7]=1.092548*A*w,d[8]=.546274*(A*A-x*x)}}class hH extends Jd{constructor(a=new uH,d=1){super(void 0,d),this.isLightProbe=!0,this.sh=a}copy(a){return super.copy(a),this.sh.copy(a.sh),this}fromJSON(a){return this.intensity=a.intensity,this.sh.fromArray(a.sh),this}toJSON(a){const d=super.toJSON(a);return d.object.sh=this.sh.toArray(),d}}class $w extends ol{constructor(a){super(a),this.textures={}}load(a,d,A,x){const w=this,M=new Lh(w.manager);M.setPath(w.path),M.setRequestHeader(w.requestHeader),M.setWithCredentials(w.withCredentials),M.load(a,function(N){try{d(w.parse(JSON.parse(N)))}catch(P){x?x(P):console.error(P),w.manager.itemError(a)}},A,x)}parse(a){const d=this.textures;function A(w){return d[w]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",w),d[w]}const x=$w.createMaterialFromType(a.type);if(a.uuid!==void 0&&(x.uuid=a.uuid),a.name!==void 0&&(x.name=a.name),a.color!==void 0&&x.color!==void 0&&x.color.setHex(a.color),a.roughness!==void 0&&(x.roughness=a.roughness),a.metalness!==void 0&&(x.metalness=a.metalness),a.sheen!==void 0&&(x.sheen=a.sheen),a.sheenColor!==void 0&&(x.sheenColor=new lr().setHex(a.sheenColor)),a.sheenRoughness!==void 0&&(x.sheenRoughness=a.sheenRoughness),a.emissive!==void 0&&x.emissive!==void 0&&x.emissive.setHex(a.emissive),a.specular!==void 0&&x.specular!==void 0&&x.specular.setHex(a.specular),a.specularIntensity!==void 0&&(x.specularIntensity=a.specularIntensity),a.specularColor!==void 0&&x.specularColor!==void 0&&x.specularColor.setHex(a.specularColor),a.shininess!==void 0&&(x.shininess=a.shininess),a.clearcoat!==void 0&&(x.clearcoat=a.clearcoat),a.clearcoatRoughness!==void 0&&(x.clearcoatRoughness=a.clearcoatRoughness),a.dispersion!==void 0&&(x.dispersion=a.dispersion),a.iridescence!==void 0&&(x.iridescence=a.iridescence),a.iridescenceIOR!==void 0&&(x.iridescenceIOR=a.iridescenceIOR),a.iridescenceThicknessRange!==void 0&&(x.iridescenceThicknessRange=a.iridescenceThicknessRange),a.transmission!==void 0&&(x.transmission=a.transmission),a.thickness!==void 0&&(x.thickness=a.thickness),a.attenuationDistance!==void 0&&(x.attenuationDistance=a.attenuationDistance),a.attenuationColor!==void 0&&x.attenuationColor!==void 0&&x.attenuationColor.setHex(a.attenuationColor),a.anisotropy!==void 0&&(x.anisotropy=a.anisotropy),a.anisotropyRotation!==void 0&&(x.anisotropyRotation=a.anisotropyRotation),a.fog!==void 0&&(x.fog=a.fog),a.flatShading!==void 0&&(x.flatShading=a.flatShading),a.blending!==void 0&&(x.blending=a.blending),a.combine!==void 0&&(x.combine=a.combine),a.side!==void 0&&(x.side=a.side),a.shadowSide!==void 0&&(x.shadowSide=a.shadowSide),a.opacity!==void 0&&(x.opacity=a.opacity),a.transparent!==void 0&&(x.transparent=a.transparent),a.alphaTest!==void 0&&(x.alphaTest=a.alphaTest),a.alphaHash!==void 0&&(x.alphaHash=a.alphaHash),a.depthFunc!==void 0&&(x.depthFunc=a.depthFunc),a.depthTest!==void 0&&(x.depthTest=a.depthTest),a.depthWrite!==void 0&&(x.depthWrite=a.depthWrite),a.colorWrite!==void 0&&(x.colorWrite=a.colorWrite),a.blendSrc!==void 0&&(x.blendSrc=a.blendSrc),a.blendDst!==void 0&&(x.blendDst=a.blendDst),a.blendEquation!==void 0&&(x.blendEquation=a.blendEquation),a.blendSrcAlpha!==void 0&&(x.blendSrcAlpha=a.blendSrcAlpha),a.blendDstAlpha!==void 0&&(x.blendDstAlpha=a.blendDstAlpha),a.blendEquationAlpha!==void 0&&(x.blendEquationAlpha=a.blendEquationAlpha),a.blendColor!==void 0&&x.blendColor!==void 0&&x.blendColor.setHex(a.blendColor),a.blendAlpha!==void 0&&(x.blendAlpha=a.blendAlpha),a.stencilWriteMask!==void 0&&(x.stencilWriteMask=a.stencilWriteMask),a.stencilFunc!==void 0&&(x.stencilFunc=a.stencilFunc),a.stencilRef!==void 0&&(x.stencilRef=a.stencilRef),a.stencilFuncMask!==void 0&&(x.stencilFuncMask=a.stencilFuncMask),a.stencilFail!==void 0&&(x.stencilFail=a.stencilFail),a.stencilZFail!==void 0&&(x.stencilZFail=a.stencilZFail),a.stencilZPass!==void 0&&(x.stencilZPass=a.stencilZPass),a.stencilWrite!==void 0&&(x.stencilWrite=a.stencilWrite),a.wireframe!==void 0&&(x.wireframe=a.wireframe),a.wireframeLinewidth!==void 0&&(x.wireframeLinewidth=a.wireframeLinewidth),a.wireframeLinecap!==void 0&&(x.wireframeLinecap=a.wireframeLinecap),a.wireframeLinejoin!==void 0&&(x.wireframeLinejoin=a.wireframeLinejoin),a.rotation!==void 0&&(x.rotation=a.rotation),a.linewidth!==void 0&&(x.linewidth=a.linewidth),a.dashSize!==void 0&&(x.dashSize=a.dashSize),a.gapSize!==void 0&&(x.gapSize=a.gapSize),a.scale!==void 0&&(x.scale=a.scale),a.polygonOffset!==void 0&&(x.polygonOffset=a.polygonOffset),a.polygonOffsetFactor!==void 0&&(x.polygonOffsetFactor=a.polygonOffsetFactor),a.polygonOffsetUnits!==void 0&&(x.polygonOffsetUnits=a.polygonOffsetUnits),a.dithering!==void 0&&(x.dithering=a.dithering),a.alphaToCoverage!==void 0&&(x.alphaToCoverage=a.alphaToCoverage),a.premultipliedAlpha!==void 0&&(x.premultipliedAlpha=a.premultipliedAlpha),a.forceSinglePass!==void 0&&(x.forceSinglePass=a.forceSinglePass),a.visible!==void 0&&(x.visible=a.visible),a.toneMapped!==void 0&&(x.toneMapped=a.toneMapped),a.userData!==void 0&&(x.userData=a.userData),a.vertexColors!==void 0&&(typeof a.vertexColors=="number"?x.vertexColors=a.vertexColors>0:x.vertexColors=a.vertexColors),a.uniforms!==void 0)for(const w in a.uniforms){const M=a.uniforms[w];switch(x.uniforms[w]={},M.type){case"t":x.uniforms[w].value=A(M.value);break;case"c":x.uniforms[w].value=new lr().setHex(M.value);break;case"v2":x.uniforms[w].value=new oi().fromArray(M.value);break;case"v3":x.uniforms[w].value=new He().fromArray(M.value);break;case"v4":x.uniforms[w].value=new Un().fromArray(M.value);break;case"m3":x.uniforms[w].value=new Xr().fromArray(M.value);break;case"m4":x.uniforms[w].value=new mr().fromArray(M.value);break;default:x.uniforms[w].value=M.value}}if(a.defines!==void 0&&(x.defines=a.defines),a.vertexShader!==void 0&&(x.vertexShader=a.vertexShader),a.fragmentShader!==void 0&&(x.fragmentShader=a.fragmentShader),a.glslVersion!==void 0&&(x.glslVersion=a.glslVersion),a.extensions!==void 0)for(const w in a.extensions)x.extensions[w]=a.extensions[w];if(a.lights!==void 0&&(x.lights=a.lights),a.clipping!==void 0&&(x.clipping=a.clipping),a.size!==void 0&&(x.size=a.size),a.sizeAttenuation!==void 0&&(x.sizeAttenuation=a.sizeAttenuation),a.map!==void 0&&(x.map=A(a.map)),a.matcap!==void 0&&(x.matcap=A(a.matcap)),a.alphaMap!==void 0&&(x.alphaMap=A(a.alphaMap)),a.bumpMap!==void 0&&(x.bumpMap=A(a.bumpMap)),a.bumpScale!==void 0&&(x.bumpScale=a.bumpScale),a.normalMap!==void 0&&(x.normalMap=A(a.normalMap)),a.normalMapType!==void 0&&(x.normalMapType=a.normalMapType),a.normalScale!==void 0){let w=a.normalScale;Array.isArray(w)===!1&&(w=[w,w]),x.normalScale=new oi().fromArray(w)}return a.displacementMap!==void 0&&(x.displacementMap=A(a.displacementMap)),a.displacementScale!==void 0&&(x.displacementScale=a.displacementScale),a.displacementBias!==void 0&&(x.displacementBias=a.displacementBias),a.roughnessMap!==void 0&&(x.roughnessMap=A(a.roughnessMap)),a.metalnessMap!==void 0&&(x.metalnessMap=A(a.metalnessMap)),a.emissiveMap!==void 0&&(x.emissiveMap=A(a.emissiveMap)),a.emissiveIntensity!==void 0&&(x.emissiveIntensity=a.emissiveIntensity),a.specularMap!==void 0&&(x.specularMap=A(a.specularMap)),a.specularIntensityMap!==void 0&&(x.specularIntensityMap=A(a.specularIntensityMap)),a.specularColorMap!==void 0&&(x.specularColorMap=A(a.specularColorMap)),a.envMap!==void 0&&(x.envMap=A(a.envMap)),a.envMapRotation!==void 0&&x.envMapRotation.fromArray(a.envMapRotation),a.envMapIntensity!==void 0&&(x.envMapIntensity=a.envMapIntensity),a.reflectivity!==void 0&&(x.reflectivity=a.reflectivity),a.refractionRatio!==void 0&&(x.refractionRatio=a.refractionRatio),a.lightMap!==void 0&&(x.lightMap=A(a.lightMap)),a.lightMapIntensity!==void 0&&(x.lightMapIntensity=a.lightMapIntensity),a.aoMap!==void 0&&(x.aoMap=A(a.aoMap)),a.aoMapIntensity!==void 0&&(x.aoMapIntensity=a.aoMapIntensity),a.gradientMap!==void 0&&(x.gradientMap=A(a.gradientMap)),a.clearcoatMap!==void 0&&(x.clearcoatMap=A(a.clearcoatMap)),a.clearcoatRoughnessMap!==void 0&&(x.clearcoatRoughnessMap=A(a.clearcoatRoughnessMap)),a.clearcoatNormalMap!==void 0&&(x.clearcoatNormalMap=A(a.clearcoatNormalMap)),a.clearcoatNormalScale!==void 0&&(x.clearcoatNormalScale=new oi().fromArray(a.clearcoatNormalScale)),a.iridescenceMap!==void 0&&(x.iridescenceMap=A(a.iridescenceMap)),a.iridescenceThicknessMap!==void 0&&(x.iridescenceThicknessMap=A(a.iridescenceThicknessMap)),a.transmissionMap!==void 0&&(x.transmissionMap=A(a.transmissionMap)),a.thicknessMap!==void 0&&(x.thicknessMap=A(a.thicknessMap)),a.anisotropyMap!==void 0&&(x.anisotropyMap=A(a.anisotropyMap)),a.sheenColorMap!==void 0&&(x.sheenColorMap=A(a.sheenColorMap)),a.sheenRoughnessMap!==void 0&&(x.sheenRoughnessMap=A(a.sheenRoughnessMap)),x}setTextures(a){return this.textures=a,this}static createMaterialFromType(a){const d={ShadowMaterial:zV,SpriteMaterial:kN,RawShaderMaterial:jV,ShaderMaterial:Oc,PointsMaterial:WN,MeshPhysicalMaterial:GV,MeshStandardMaterial:sL,MeshPhongMaterial:VV,MeshToonMaterial:HV,MeshNormalMaterial:WV,MeshLambertMaterial:QV,MeshDepthMaterial:LN,MeshDistanceMaterial:DN,MeshBasicMaterial:Hd,MeshMatcapMaterial:qV,LineDashedMaterial:XV,LineBasicMaterial:Po,Material:fo};return new d[a]}}class fL{static decodeText(a){if(typeof TextDecoder<"u")return new TextDecoder().decode(a);let d="";for(let A=0,x=a.length;A<x;A++)d+=String.fromCharCode(a[A]);try{return decodeURIComponent(escape(d))}catch{return d}}static extractUrlBase(a){const d=a.lastIndexOf("/");return d===-1?"./":a.slice(0,d+1)}static resolveURL(a,d){return typeof a!="string"||a===""?"":(/^https?:\/\//i.test(d)&&/^\//.test(a)&&(d=d.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(a)||/^data:.*,.*$/i.test(a)||/^blob:.*$/i.test(a)?a:d+a)}}class dH extends pn{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(a){return super.copy(a),this.instanceCount=a.instanceCount,this}toJSON(){const a=super.toJSON();return a.instanceCount=this.instanceCount,a.isInstancedBufferGeometry=!0,a}}class pH extends ol{constructor(a){super(a)}load(a,d,A,x){const w=this,M=new Lh(w.manager);M.setPath(w.path),M.setRequestHeader(w.requestHeader),M.setWithCredentials(w.withCredentials),M.load(a,function(N){try{d(w.parse(JSON.parse(N)))}catch(P){x?x(P):console.error(P),w.manager.itemError(a)}},A,x)}parse(a){const d={},A={};function x(X,Z){if(d[Z]!==void 0)return d[Z];const ie=X.interleavedBuffers[Z],oe=w(X,ie.buffer),ne=Fd(ie.type,oe),ee=new mw(ne,ie.stride);return ee.uuid=ie.uuid,d[Z]=ee,ee}function w(X,Z){if(A[Z]!==void 0)return A[Z];const ie=X.arrayBuffers[Z],oe=new Uint32Array(ie).buffer;return A[Z]=oe,oe}const M=a.isInstancedBufferGeometry?new dH:new pn,N=a.data.index;if(N!==void 0){const X=Fd(N.type,N.array);M.setIndex(new as(X,1))}const P=a.data.attributes;for(const X in P){const Z=P[X];let ie;if(Z.isInterleavedBufferAttribute){const oe=x(a.data,Z.data);ie=new Mf(oe,Z.itemSize,Z.offset,Z.normalized)}else{const oe=Fd(Z.type,Z.array),ne=Z.isInstancedBufferAttribute?B0:as;ie=new ne(oe,Z.itemSize,Z.normalized)}Z.name!==void 0&&(ie.name=Z.name),Z.usage!==void 0&&ie.setUsage(Z.usage),M.setAttribute(X,ie)}const k=a.data.morphAttributes;if(k)for(const X in k){const Z=k[X],ie=[];for(let oe=0,ne=Z.length;oe<ne;oe++){const ee=Z[oe];let Me;if(ee.isInterleavedBufferAttribute){const we=x(a.data,ee.data);Me=new Mf(we,ee.itemSize,ee.offset,ee.normalized)}else{const we=Fd(ee.type,ee.array);Me=new as(we,ee.itemSize,ee.normalized)}ee.name!==void 0&&(Me.name=ee.name),ie.push(Me)}M.morphAttributes[X]=ie}a.data.morphTargetsRelative&&(M.morphTargetsRelative=!0);const j=a.data.groups||a.data.drawcalls||a.data.offsets;if(j!==void 0)for(let X=0,Z=j.length;X!==Z;++X){const ie=j[X];M.addGroup(ie.start,ie.count,ie.materialIndex)}const Y=a.data.boundingSphere;if(Y!==void 0){const X=new He;Y.center!==void 0&&X.fromArray(Y.center),M.boundingSphere=new Aa(X,Y.radius)}return a.name&&(M.name=a.name),a.userData&&(M.userData=a.userData),M}}class MIe extends ol{constructor(a){super(a)}load(a,d,A,x){const w=this,M=this.path===""?fL.extractUrlBase(a):this.path;this.resourcePath=this.resourcePath||M;const N=new Lh(this.manager);N.setPath(this.path),N.setRequestHeader(this.requestHeader),N.setWithCredentials(this.withCredentials),N.load(a,function(P){let k=null;try{k=JSON.parse(P)}catch(Y){x!==void 0&&x(Y),console.error("THREE:ObjectLoader: Can't parse "+a+".",Y.message);return}const j=k.metadata;if(j===void 0||j.type===void 0||j.type.toLowerCase()==="geometry"){x!==void 0&&x(new Error("THREE.ObjectLoader: Can't load "+a)),console.error("THREE.ObjectLoader: Can't load "+a);return}w.parse(k,d)},A,x)}async loadAsync(a,d){const A=this,x=this.path===""?fL.extractUrlBase(a):this.path;this.resourcePath=this.resourcePath||x;const w=new Lh(this.manager);w.setPath(this.path),w.setRequestHeader(this.requestHeader),w.setWithCredentials(this.withCredentials);const M=await w.loadAsync(a,d),N=JSON.parse(M),P=N.metadata;if(P===void 0||P.type===void 0||P.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+a);return await A.parseAsync(N)}parse(a,d){const A=this.parseAnimations(a.animations),x=this.parseShapes(a.shapes),w=this.parseGeometries(a.geometries,x),M=this.parseImages(a.images,function(){d!==void 0&&d(k)}),N=this.parseTextures(a.textures,M),P=this.parseMaterials(a.materials,N),k=this.parseObject(a.object,w,P,N,A),j=this.parseSkeletons(a.skeletons,k);if(this.bindSkeletons(k,j),d!==void 0){let Y=!1;for(const X in M)if(M[X].data instanceof HTMLImageElement){Y=!0;break}Y===!1&&d(k)}return k}async parseAsync(a){const d=this.parseAnimations(a.animations),A=this.parseShapes(a.shapes),x=this.parseGeometries(a.geometries,A),w=await this.parseImagesAsync(a.images),M=this.parseTextures(a.textures,w),N=this.parseMaterials(a.materials,M),P=this.parseObject(a.object,x,N,M,d),k=this.parseSkeletons(a.skeletons,P);return this.bindSkeletons(P,k),P}parseShapes(a){const d={};if(a!==void 0)for(let A=0,x=a.length;A<x;A++){const w=new If().fromJSON(a[A]);d[w.uuid]=w}return d}parseSkeletons(a,d){const A={},x={};if(d.traverse(function(w){w.isBone&&(x[w.uuid]=w)}),a!==void 0)for(let w=0,M=a.length;w<M;w++){const N=new xw().fromJSON(a[w],x);A[N.uuid]=N}return A}parseGeometries(a,d){const A={};if(a!==void 0){const w=new pH;for(let M=0,N=a.length;M<N;M++){let P;const k=a[M];switch(k.type){case"BufferGeometry":case"InstancedBufferGeometry":P=w.parse(k);break;case"Geometry":if("THREE"in window&&"LegacyJSONLoader"in THREE){var x=new THREE.LegacyJSONLoader;P=x.parse(k,this.resourcePath).geometry}else console.error('THREE.ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type "Geometry".');break;default:k.type in UV?P=UV[k.type].fromJSON(k,d):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${k.type}"`)}P.uuid=k.uuid,k.name!==void 0&&(P.name=k.name),k.userData!==void 0&&(P.userData=k.userData),A[k.uuid]=P}}return A}parseMaterials(a,d){const A={},x={};if(a!==void 0){const w=new $w;w.setTextures(d);for(let M=0,N=a.length;M<N;M++){const P=a[M];A[P.uuid]===void 0&&(A[P.uuid]=w.parse(P)),x[P.uuid]=A[P.uuid]}}return x}parseAnimations(a){const d={};if(a!==void 0)for(let A=0;A<a.length;A++){const x=a[A],w=qv.parse(x);d[w.uuid]=w}return d}parseImages(a,d){const A=this,x={};let w;function M(P){return A.manager.itemStart(P),w.load(P,function(){A.manager.itemEnd(P)},void 0,function(){A.manager.itemError(P),A.manager.itemEnd(P)})}function N(P){if(typeof P=="string"){const k=P,j=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(k)?k:A.resourcePath+k;return M(j)}else return P.data?{data:Fd(P.type,P.data),width:P.width,height:P.height}:null}if(a!==void 0&&a.length>0){const P=new uL(d);w=new Xv(P),w.setCrossOrigin(this.crossOrigin);for(let k=0,j=a.length;k<j;k++){const Y=a[k],X=Y.url;if(Array.isArray(X)){const Z=[];for(let ie=0,oe=X.length;ie<oe;ie++){const ne=X[ie],ee=N(ne);ee!==null&&(ee instanceof HTMLImageElement?Z.push(ee):Z.push(new qd(ee.data,ee.width,ee.height)))}x[Y.uuid]=new xs(Z)}else{const Z=N(Y.url);x[Y.uuid]=new xs(Z)}}}return x}async parseImagesAsync(a){const d=this,A={};let x;async function w(M){if(typeof M=="string"){const N=M,P=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(N)?N:d.resourcePath+N;return await x.loadAsync(P)}else return M.data?{data:Fd(M.type,M.data),width:M.width,height:M.height}:null}if(a!==void 0&&a.length>0){x=new Xv(this.manager),x.setCrossOrigin(this.crossOrigin);for(let M=0,N=a.length;M<N;M++){const P=a[M],k=P.url;if(Array.isArray(k)){const j=[];for(let Y=0,X=k.length;Y<X;Y++){const Z=k[Y],ie=await w(Z);ie!==null&&(ie instanceof HTMLImageElement?j.push(ie):j.push(new qd(ie.data,ie.width,ie.height)))}A[P.uuid]=new xs(j)}else{const j=await w(P.url);A[P.uuid]=new xs(j)}}}return A}parseTextures(a,d){function A(w,M){return typeof w=="number"?w:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",w),M[w])}const x={};if(a!==void 0)for(let w=0,M=a.length;w<M;w++){const N=a[w];N.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',N.uuid),d[N.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",N.image);const P=d[N.image],k=P.data;let j;Array.isArray(k)?(j=new Cv,k.length===6&&(j.needsUpdate=!0)):(k&&k.data?j=new qd:j=new ds,k&&(j.needsUpdate=!0)),j.source=P,j.uuid=N.uuid,N.name!==void 0&&(j.name=N.name),N.mapping!==void 0&&(j.mapping=A(N.mapping,RIe)),N.channel!==void 0&&(j.channel=N.channel),N.offset!==void 0&&j.offset.fromArray(N.offset),N.repeat!==void 0&&j.repeat.fromArray(N.repeat),N.center!==void 0&&j.center.fromArray(N.center),N.rotation!==void 0&&(j.rotation=N.rotation),N.wrap!==void 0&&(j.wrapS=A(N.wrap[0],fH),j.wrapT=A(N.wrap[1],fH)),N.format!==void 0&&(j.format=N.format),N.internalFormat!==void 0&&(j.internalFormat=N.internalFormat),N.type!==void 0&&(j.type=N.type),N.colorSpace!==void 0&&(j.colorSpace=N.colorSpace),N.minFilter!==void 0&&(j.minFilter=A(N.minFilter,mH)),N.magFilter!==void 0&&(j.magFilter=A(N.magFilter,mH)),N.anisotropy!==void 0&&(j.anisotropy=N.anisotropy),N.flipY!==void 0&&(j.flipY=N.flipY),N.generateMipmaps!==void 0&&(j.generateMipmaps=N.generateMipmaps),N.premultiplyAlpha!==void 0&&(j.premultiplyAlpha=N.premultiplyAlpha),N.unpackAlignment!==void 0&&(j.unpackAlignment=N.unpackAlignment),N.compareFunction!==void 0&&(j.compareFunction=N.compareFunction),N.userData!==void 0&&(j.userData=N.userData),x[N.uuid]=j}return x}parseObject(a,d,A,x,w){let M;function N(X){return d[X]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",X),d[X]}function P(X){if(X!==void 0){if(Array.isArray(X)){const Z=[];for(let ie=0,oe=X.length;ie<oe;ie++){const ne=X[ie];A[ne]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",ne),Z.push(A[ne])}return Z}return A[X]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",X),A[X]}}function k(X){return x[X]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",X),x[X]}let j,Y;switch(a.type){case"Scene":M=new YG,a.background!==void 0&&(Number.isInteger(a.background)?M.background=new lr(a.background):M.background=k(a.background)),a.environment!==void 0&&(M.environment=k(a.environment)),a.fog!==void 0&&(a.fog.type==="Fog"?M.fog=new fw(a.fog.color,a.fog.near,a.fog.far):a.fog.type==="FogExp2"&&(M.fog=new pw(a.fog.color,a.fog.density)),a.fog.name!==""&&(M.fog.name=a.fog.name)),a.backgroundBlurriness!==void 0&&(M.backgroundBlurriness=a.backgroundBlurriness),a.backgroundIntensity!==void 0&&(M.backgroundIntensity=a.backgroundIntensity),a.backgroundRotation!==void 0&&M.backgroundRotation.fromArray(a.backgroundRotation),a.environmentIntensity!==void 0&&(M.environmentIntensity=a.environmentIntensity),a.environmentRotation!==void 0&&M.environmentRotation.fromArray(a.environmentRotation);break;case"PerspectiveCamera":M=new va(a.fov,a.aspect,a.near,a.far),a.focus!==void 0&&(M.focus=a.focus),a.zoom!==void 0&&(M.zoom=a.zoom),a.filmGauge!==void 0&&(M.filmGauge=a.filmGauge),a.filmOffset!==void 0&&(M.filmOffset=a.filmOffset),a.view!==void 0&&(M.view=Object.assign({},a.view));break;case"OrthographicCamera":M=new cw(a.left,a.right,a.top,a.bottom,a.near,a.far),a.zoom!==void 0&&(M.zoom=a.zoom),a.view!==void 0&&(M.view=Object.assign({},a.view));break;case"AmbientLight":M=new lH(a.color,a.intensity);break;case"DirectionalLight":M=new oH(a.color,a.intensity);break;case"PointLight":M=new aH(a.color,a.intensity,a.distance,a.decay);break;case"RectAreaLight":M=new cH(a.color,a.intensity,a.width,a.height);break;case"SpotLight":M=new nH(a.color,a.intensity,a.distance,a.angle,a.penumbra,a.decay);break;case"HemisphereLight":M=new tH(a.color,a.groundColor,a.intensity);break;case"LightProbe":M=new hH().fromJSON(a);break;case"SkinnedMesh":j=N(a.geometry),Y=P(a.material),M=new lV(j,Y),a.bindMode!==void 0&&(M.bindMode=a.bindMode),a.bindMatrix!==void 0&&M.bindMatrix.fromArray(a.bindMatrix),a.skeleton!==void 0&&(M.skeleton=a.skeleton);break;case"Mesh":j=N(a.geometry),Y=P(a.material),M=new ua(j,Y);break;case"InstancedMesh":j=N(a.geometry),Y=P(a.material);const X=a.count,Z=a.instanceMatrix,ie=a.instanceColor;M=new dV(j,Y,X),M.instanceMatrix=new B0(new Float32Array(Z.array),16),ie!==void 0&&(M.instanceColor=new B0(new Float32Array(ie.array),ie.itemSize));break;case"BatchedMesh":j=N(a.geometry),Y=P(a.material),M=new mV(a.maxGeometryCount,a.maxVertexCount,a.maxIndexCount,Y),M.geometry=j,M.perObjectFrustumCulled=a.perObjectFrustumCulled,M.sortObjects=a.sortObjects,M._drawRanges=a.drawRanges,M._reservedRanges=a.reservedRanges,M._visibility=a.visibility,M._active=a.active,M._bounds=a.bounds.map(oe=>{const ne=new Ls;ne.min.fromArray(oe.boxMin),ne.max.fromArray(oe.boxMax);const ee=new Aa;return ee.radius=oe.sphereRadius,ee.center.fromArray(oe.sphereCenter),{boxInitialized:oe.boxInitialized,box:ne,sphereInitialized:oe.sphereInitialized,sphere:ee}}),M._maxGeometryCount=a.maxGeometryCount,M._maxVertexCount=a.maxVertexCount,M._maxIndexCount=a.maxIndexCount,M._geometryInitialized=a.geometryInitialized,M._geometryCount=a.geometryCount,M._matricesTexture=k(a.matricesTexture.uuid);break;case"LOD":M=new iV;break;case"Line":M=new Kd(N(a.geometry),P(a.material));break;case"LineLoop":M=new bV(N(a.geometry),P(a.material));break;case"LineSegments":M=new uu(N(a.geometry),P(a.material));break;case"PointCloud":case"Points":M=new _V(N(a.geometry),P(a.material));break;case"Sprite":M=new eV(P(a.material));break;case"Group":M=new Sf;break;case"Bone":M=new jN;break;default:M=new Hn}if(M.uuid=a.uuid,a.name!==void 0&&(M.name=a.name),a.matrix!==void 0?(M.matrix.fromArray(a.matrix),a.matrixAutoUpdate!==void 0&&(M.matrixAutoUpdate=a.matrixAutoUpdate),M.matrixAutoUpdate&&M.matrix.decompose(M.position,M.quaternion,M.scale)):(a.position!==void 0&&M.position.fromArray(a.position),a.rotation!==void 0&&M.rotation.fromArray(a.rotation),a.quaternion!==void 0&&M.quaternion.fromArray(a.quaternion),a.scale!==void 0&&M.scale.fromArray(a.scale)),a.up!==void 0&&M.up.fromArray(a.up),a.castShadow!==void 0&&(M.castShadow=a.castShadow),a.receiveShadow!==void 0&&(M.receiveShadow=a.receiveShadow),a.shadow&&(a.shadow.bias!==void 0&&(M.shadow.bias=a.shadow.bias),a.shadow.normalBias!==void 0&&(M.shadow.normalBias=a.shadow.normalBias),a.shadow.radius!==void 0&&(M.shadow.radius=a.shadow.radius),a.shadow.mapSize!==void 0&&M.shadow.mapSize.fromArray(a.shadow.mapSize),a.shadow.camera!==void 0&&(M.shadow.camera=this.parseObject(a.shadow.camera))),a.visible!==void 0&&(M.visible=a.visible),a.frustumCulled!==void 0&&(M.frustumCulled=a.frustumCulled),a.renderOrder!==void 0&&(M.renderOrder=a.renderOrder),a.userData!==void 0&&(M.userData=a.userData),a.layers!==void 0&&(M.layers.mask=a.layers),a.children!==void 0){const X=a.children;for(let Z=0;Z<X.length;Z++)M.add(this.parseObject(X[Z],d,A,x,w))}if(a.animations!==void 0){const X=a.animations;for(let Z=0;Z<X.length;Z++){const ie=X[Z];M.animations.push(w[ie])}}if(a.type==="LOD"){a.autoUpdate!==void 0&&(M.autoUpdate=a.autoUpdate);const X=a.levels;for(let Z=0;Z<X.length;Z++){const ie=X[Z],oe=M.getObjectByProperty("uuid",ie.object);oe!==void 0&&M.addLevel(oe,ie.distance,ie.hysteresis)}}return M}bindSkeletons(a,d){Object.keys(d).length!==0&&a.traverse(function(A){if(A.isSkinnedMesh===!0&&A.skeleton!==void 0){const x=d[A.skeleton];x===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",A.skeleton):A.bind(x,A.bindMatrix)}})}}const RIe={UVMapping:Oe,CubeReflectionMapping:U,CubeRefractionMapping:$,EquirectangularReflectionMapping:re,EquirectangularRefractionMapping:Re,CubeUVReflectionMapping:ce},fH={RepeatWrapping:Ue,ClampToEdgeWrapping:je,MirroredRepeatWrapping:pt},mH={NearestFilter:Lt,NearestMipmapNearestFilter:xt,NearestMipmapLinearFilter:mi,LinearFilter:Fi,LinearMipmapNearestFilter:gn,LinearMipmapLinearFilter:nn};class IIe extends ol{constructor(a){super(a),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(a){return this.options=a,this}load(a,d,A,x){a===void 0&&(a=""),this.path!==void 0&&(a=this.path+a),a=this.manager.resolveURL(a);const w=this,M=Bh.get(a);if(M!==void 0){if(w.manager.itemStart(a),M.then){M.then(k=>{d&&d(k),w.manager.itemEnd(a)}).catch(k=>{x&&x(k)});return}return setTimeout(function(){d&&d(M),w.manager.itemEnd(a)},0),M}const N={};N.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",N.headers=this.requestHeader;const P=fetch(a,N).then(function(k){return k.blob()}).then(function(k){return createImageBitmap(k,Object.assign(w.options,{colorSpaceConversion:"none"}))}).then(function(k){return Bh.add(a,k),d&&d(k),w.manager.itemEnd(a),k}).catch(function(k){x&&x(k),Bh.remove(a),w.manager.itemError(a),w.manager.itemEnd(a)});Bh.add(a,P),w.manager.itemStart(a)}}let e2;class mL{static getContext(){return e2===void 0&&(e2=new(window.AudioContext||window.webkitAudioContext)),e2}static setContext(a){e2=a}}class BIe extends ol{constructor(a){super(a)}load(a,d,A,x){const w=this,M=new Lh(this.manager);M.setResponseType("arraybuffer"),M.setPath(this.path),M.setRequestHeader(this.requestHeader),M.setWithCredentials(this.withCredentials),M.load(a,function(P){try{const k=P.slice(0);mL.getContext().decodeAudioData(k,function(j){d(j)}).catch(N)}catch(k){N(k)}},A,x);function N(P){x?x(P):console.error(P),w.manager.itemError(a)}}}const gH=new mr,AH=new mr,Of=new mr;class NIe{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new va,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new va,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(a){const d=this._cache;if(d.focus!==a.focus||d.fov!==a.fov||d.aspect!==a.aspect*this.aspect||d.near!==a.near||d.far!==a.far||d.zoom!==a.zoom||d.eyeSep!==this.eyeSep){d.focus=a.focus,d.fov=a.fov,d.aspect=a.aspect*this.aspect,d.near=a.near,d.far=a.far,d.zoom=a.zoom,d.eyeSep=this.eyeSep,Of.copy(a.projectionMatrix);const A=d.eyeSep/2,x=A*d.near/d.focus,w=d.near*Math.tan(Eh*d.fov*.5)/d.zoom;let M,N;AH.elements[12]=-A,gH.elements[12]=A,M=-w*d.aspect+x,N=w*d.aspect+x,Of.elements[0]=2*d.near/(N-M),Of.elements[8]=(N+M)/(N-M),this.cameraL.projectionMatrix.copy(Of),M=-w*d.aspect-x,N=w*d.aspect-x,Of.elements[0]=2*d.near/(N-M),Of.elements[8]=(N+M)/(N-M),this.cameraR.projectionMatrix.copy(Of)}this.cameraL.matrixWorld.copy(a.matrixWorld).multiply(AH),this.cameraR.matrixWorld.copy(a.matrixWorld).multiply(gH)}}class yH{constructor(a=!0){this.autoStart=a,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=vH(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let a=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const d=vH();a=(d-this.oldTime)/1e3,this.oldTime=d,this.elapsedTime+=a}return a}}function vH(){return(typeof performance>"u"?Date:performance).now()}const Pf=new He,bH=new Vn,LIe=new He,kf=new He;class DIe extends Hn{constructor(){super(),this.type="AudioListener",this.context=mL.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new yH}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(a){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=a,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(a){return this.gain.gain.setTargetAtTime(a,this.context.currentTime,.01),this}updateMatrixWorld(a){super.updateMatrixWorld(a);const d=this.context.listener,A=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Pf,bH,LIe),kf.set(0,0,-1).applyQuaternion(bH),d.positionX){const x=this.context.currentTime+this.timeDelta;d.positionX.linearRampToValueAtTime(Pf.x,x),d.positionY.linearRampToValueAtTime(Pf.y,x),d.positionZ.linearRampToValueAtTime(Pf.z,x),d.forwardX.linearRampToValueAtTime(kf.x,x),d.forwardY.linearRampToValueAtTime(kf.y,x),d.forwardZ.linearRampToValueAtTime(kf.z,x),d.upX.linearRampToValueAtTime(A.x,x),d.upY.linearRampToValueAtTime(A.y,x),d.upZ.linearRampToValueAtTime(A.z,x)}else d.setPosition(Pf.x,Pf.y,Pf.z),d.setOrientation(kf.x,kf.y,kf.z,A.x,A.y,A.z)}}class xH extends Hn{constructor(a){super(),this.type="Audio",this.listener=a,this.context=a.context,this.gain=this.context.createGain(),this.gain.connect(a.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(a){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=a,this.connect(),this}setMediaElementSource(a){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(a),this.connect(),this}setMediaStreamSource(a){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(a),this.connect(),this}setBuffer(a){return this.buffer=a,this.sourceType="buffer",this.autoplay&&this.play(),this}play(a=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+a;const d=this.context.createBufferSource();return d.buffer=this.buffer,d.loop=this.loop,d.loopStart=this.loopStart,d.loopEnd=this.loopEnd,d.onended=this.onEnded.bind(this),d.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=d,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let a=1,d=this.filters.length;a<d;a++)this.filters[a-1].connect(this.filters[a]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let a=1,d=this.filters.length;a<d;a++)this.filters[a-1].disconnect(this.filters[a]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(a){return a||(a=[]),this._connected===!0?(this.disconnect(),this.filters=a.slice(),this.connect()):this.filters=a.slice(),this}setDetune(a){return this.detune=a,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(a){return this.setFilters(a?[a]:[])}setPlaybackRate(a){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=a,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(a){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=a,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(a){return this.loopStart=a,this}setLoopEnd(a){return this.loopEnd=a,this}getVolume(){return this.gain.gain.value}setVolume(a){return this.gain.gain.setTargetAtTime(a,this.context.currentTime,.01),this}}const Ff=new He,_H=new Vn,OIe=new He,Uf=new He;class PIe extends xH{constructor(a){super(a),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(a){return this.panner.refDistance=a,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(a){return this.panner.rolloffFactor=a,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(a){return this.panner.distanceModel=a,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(a){return this.panner.maxDistance=a,this}setDirectionalCone(a,d,A){return this.panner.coneInnerAngle=a,this.panner.coneOuterAngle=d,this.panner.coneOuterGain=A,this}updateMatrixWorld(a){if(super.updateMatrixWorld(a),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Ff,_H,OIe),Uf.set(0,0,1).applyQuaternion(_H);const d=this.panner;if(d.positionX){const A=this.context.currentTime+this.listener.timeDelta;d.positionX.linearRampToValueAtTime(Ff.x,A),d.positionY.linearRampToValueAtTime(Ff.y,A),d.positionZ.linearRampToValueAtTime(Ff.z,A),d.orientationX.linearRampToValueAtTime(Uf.x,A),d.orientationY.linearRampToValueAtTime(Uf.y,A),d.orientationZ.linearRampToValueAtTime(Uf.z,A)}else d.setPosition(Ff.x,Ff.y,Ff.z),d.setOrientation(Uf.x,Uf.y,Uf.z)}}class kIe{constructor(a,d=2048){this.analyser=a.context.createAnalyser(),this.analyser.fftSize=d,this.data=new Uint8Array(this.analyser.frequencyBinCount),a.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let a=0;const d=this.getFrequencyData();for(let A=0;A<d.length;A++)a+=d[A];return a/d.length}}class EH{constructor(a,d,A){this.binding=a,this.valueSize=A;let x,w,M;switch(d){case"quaternion":x=this._slerp,w=this._slerpAdditive,M=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(A*6),this._workIndex=5;break;case"string":case"bool":x=this._select,w=this._select,M=this._setAdditiveIdentityOther,this.buffer=new Array(A*5);break;default:x=this._lerp,w=this._lerpAdditive,M=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(A*5)}this._mixBufferRegion=x,this._mixBufferRegionAdditive=w,this._setIdentity=M,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(a,d){const A=this.buffer,x=this.valueSize,w=a*x+x;let M=this.cumulativeWeight;if(M===0){for(let N=0;N!==x;++N)A[w+N]=A[N];M=d}else{M+=d;const N=d/M;this._mixBufferRegion(A,w,0,N,x)}this.cumulativeWeight=M}accumulateAdditive(a){const d=this.buffer,A=this.valueSize,x=A*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(d,x,0,a,A),this.cumulativeWeightAdditive+=a}apply(a){const d=this.valueSize,A=this.buffer,x=a*d+d,w=this.cumulativeWeight,M=this.cumulativeWeightAdditive,N=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,w<1){const P=d*this._origIndex;this._mixBufferRegion(A,x,P,1-w,d)}M>0&&this._mixBufferRegionAdditive(A,x,this._addIndex*d,1,d);for(let P=d,k=d+d;P!==k;++P)if(A[P]!==A[P+d]){N.setValue(A,x);break}}saveOriginalState(){const a=this.binding,d=this.buffer,A=this.valueSize,x=A*this._origIndex;a.getValue(d,x);for(let w=A,M=x;w!==M;++w)d[w]=d[x+w%A];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const a=this.valueSize*3;this.binding.setValue(this.buffer,a)}_setAdditiveIdentityNumeric(){const a=this._addIndex*this.valueSize,d=a+this.valueSize;for(let A=a;A<d;A++)this.buffer[A]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const a=this._origIndex*this.valueSize,d=this._addIndex*this.valueSize;for(let A=0;A<this.valueSize;A++)this.buffer[d+A]=this.buffer[a+A]}_select(a,d,A,x,w){if(x>=.5)for(let M=0;M!==w;++M)a[d+M]=a[A+M]}_slerp(a,d,A,x){Vn.slerpFlat(a,d,a,d,a,A,x)}_slerpAdditive(a,d,A,x,w){const M=this._workIndex*w;Vn.multiplyQuaternionsFlat(a,M,a,d,a,A),Vn.slerpFlat(a,d,a,d,a,M,x)}_lerp(a,d,A,x,w){const M=1-x;for(let N=0;N!==w;++N){const P=d+N;a[P]=a[P]*M+a[A+N]*x}}_lerpAdditive(a,d,A,x,w){for(let M=0;M!==w;++M){const N=d+M;a[N]=a[N]+a[A+M]*x}}}const gL="\\[\\]\\.:\\/",FIe=new RegExp("["+gL+"]","g"),AL="[^"+gL+"]",UIe="[^"+gL.replace("\\.","")+"]",zIe=/((?:WC+[\/:])*)/.source.replace("WC",AL),jIe=/(WCOD+)?/.source.replace("WCOD",UIe),GIe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",AL),VIe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",AL),HIe=new RegExp("^"+zIe+jIe+GIe+VIe+"$"),WIe=["material","materials","bones","map"];class QIe{constructor(a,d,A){const x=A||zn.parseTrackName(d);this._targetGroup=a,this._bindings=a.subscribe_(d,x)}getValue(a,d){this.bind();const A=this._targetGroup.nCachedObjects_,x=this._bindings[A];x!==void 0&&x.getValue(a,d)}setValue(a,d){const A=this._bindings;for(let x=this._targetGroup.nCachedObjects_,w=A.length;x!==w;++x)A[x].setValue(a,d)}bind(){const a=this._bindings;for(let d=this._targetGroup.nCachedObjects_,A=a.length;d!==A;++d)a[d].bind()}unbind(){const a=this._bindings;for(let d=this._targetGroup.nCachedObjects_,A=a.length;d!==A;++d)a[d].unbind()}}class zn{constructor(a,d,A){this.path=d,this.parsedPath=A||zn.parseTrackName(d),this.node=zn.findNode(a,this.parsedPath.nodeName),this.rootNode=a,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(a,d,A){return a&&a.isAnimationObjectGroup?new zn.Composite(a,d,A):new zn(a,d,A)}static sanitizeNodeName(a){return a.replace(/\s/g,"_").replace(FIe,"")}static parseTrackName(a){const d=HIe.exec(a);if(d===null)throw new Error("PropertyBinding: Cannot parse trackName: "+a);const A={nodeName:d[2],objectName:d[3],objectIndex:d[4],propertyName:d[5],propertyIndex:d[6]},x=A.nodeName&&A.nodeName.lastIndexOf(".");if(x!==void 0&&x!==-1){const w=A.nodeName.substring(x+1);WIe.indexOf(w)!==-1&&(A.nodeName=A.nodeName.substring(0,x),A.objectName=w)}if(A.propertyName===null||A.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+a);return A}static findNode(a,d){if(d===void 0||d===""||d==="."||d===-1||d===a.name||d===a.uuid)return a;if(a.skeleton){const A=a.skeleton.getBoneByName(d);if(A!==void 0)return A}if(a.children){const A=function(w){for(let M=0;M<w.length;M++){const N=w[M];if(N.name===d||N.uuid===d)return N;const P=A(N.children);if(P)return P}return null},x=A(a.children);if(x)return x}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(a,d){a[d]=this.targetObject[this.propertyName]}_getValue_array(a,d){const A=this.resolvedProperty;for(let x=0,w=A.length;x!==w;++x)a[d++]=A[x]}_getValue_arrayElement(a,d){a[d]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(a,d){this.resolvedProperty.toArray(a,d)}_setValue_direct(a,d){this.targetObject[this.propertyName]=a[d]}_setValue_direct_setNeedsUpdate(a,d){this.targetObject[this.propertyName]=a[d],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(a,d){this.targetObject[this.propertyName]=a[d],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(a,d){const A=this.resolvedProperty;for(let x=0,w=A.length;x!==w;++x)A[x]=a[d++]}_setValue_array_setNeedsUpdate(a,d){const A=this.resolvedProperty;for(let x=0,w=A.length;x!==w;++x)A[x]=a[d++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(a,d){const A=this.resolvedProperty;for(let x=0,w=A.length;x!==w;++x)A[x]=a[d++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(a,d){this.resolvedProperty[this.propertyIndex]=a[d]}_setValue_arrayElement_setNeedsUpdate(a,d){this.resolvedProperty[this.propertyIndex]=a[d],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(a,d){this.resolvedProperty[this.propertyIndex]=a[d],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(a,d){this.resolvedProperty.fromArray(a,d)}_setValue_fromArray_setNeedsUpdate(a,d){this.resolvedProperty.fromArray(a,d),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(a,d){this.resolvedProperty.fromArray(a,d),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(a,d){this.bind(),this.getValue(a,d)}_setValue_unbound(a,d){this.bind(),this.setValue(a,d)}bind(){let a=this.node;const d=this.parsedPath,A=d.objectName,x=d.propertyName;let w=d.propertyIndex;if(a||(a=zn.findNode(this.rootNode,d.nodeName),this.node=a),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!a){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(A){let k=d.objectIndex;switch(A){case"materials":if(!a.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!a.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}a=a.material.materials;break;case"bones":if(!a.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}a=a.skeleton.bones;for(let j=0;j<a.length;j++)if(a[j].name===k){k=j;break}break;case"map":if("map"in a){a=a.map;break}if(!a.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!a.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}a=a.material.map;break;default:if(a[A]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}a=a[A]}if(k!==void 0){if(a[k]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,a);return}a=a[k]}}const M=a[x];if(M===void 0){const k=d.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+k+"."+x+" but it wasn't found.",a);return}let N=this.Versioning.None;this.targetObject=a,a.needsUpdate!==void 0?N=this.Versioning.NeedsUpdate:a.matrixWorldNeedsUpdate!==void 0&&(N=this.Versioning.MatrixWorldNeedsUpdate);let P=this.BindingType.Direct;if(w!==void 0){if(x==="morphTargetInfluences"){if(!a.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!a.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}a.morphTargetDictionary[w]!==void 0&&(w=a.morphTargetDictionary[w])}P=this.BindingType.ArrayElement,this.resolvedProperty=M,this.propertyIndex=w}else M.fromArray!==void 0&&M.toArray!==void 0?(P=this.BindingType.HasFromToArray,this.resolvedProperty=M):Array.isArray(M)?(P=this.BindingType.EntireArray,this.resolvedProperty=M):this.propertyName=x;this.getValue=this.GetterByBindingType[P],this.setValue=this.SetterByBindingTypeAndVersioning[P][N]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}zn.Composite=QIe,zn.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},zn.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},zn.prototype.GetterByBindingType=[zn.prototype._getValue_direct,zn.prototype._getValue_array,zn.prototype._getValue_arrayElement,zn.prototype._getValue_toArray],zn.prototype.SetterByBindingTypeAndVersioning=[[zn.prototype._setValue_direct,zn.prototype._setValue_direct_setNeedsUpdate,zn.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[zn.prototype._setValue_array,zn.prototype._setValue_array_setNeedsUpdate,zn.prototype._setValue_array_setMatrixWorldNeedsUpdate],[zn.prototype._setValue_arrayElement,zn.prototype._setValue_arrayElement_setNeedsUpdate,zn.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[zn.prototype._setValue_fromArray,zn.prototype._setValue_fromArray_setNeedsUpdate,zn.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class qIe{constructor(){this.isAnimationObjectGroup=!0,this.uuid=No(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const a={};this._indicesByUUID=a;for(let A=0,x=arguments.length;A!==x;++A)a[arguments[A].uuid]=A;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const d=this;this.stats={objects:{get total(){return d._objects.length},get inUse(){return this.total-d.nCachedObjects_}},get bindingsPerObject(){return d._bindings.length}}}add(){const a=this._objects,d=this._indicesByUUID,A=this._paths,x=this._parsedPaths,w=this._bindings,M=w.length;let N,P=a.length,k=this.nCachedObjects_;for(let j=0,Y=arguments.length;j!==Y;++j){const X=arguments[j],Z=X.uuid;let ie=d[Z];if(ie===void 0){ie=P++,d[Z]=ie,a.push(X);for(let oe=0,ne=M;oe!==ne;++oe)w[oe].push(new zn(X,A[oe],x[oe]))}else if(ie<k){N=a[ie];const oe=--k,ne=a[oe];d[ne.uuid]=ie,a[ie]=ne,d[Z]=oe,a[oe]=X;for(let ee=0,Me=M;ee!==Me;++ee){const we=w[ee],xe=we[oe];let st=we[ie];we[ie]=xe,st===void 0&&(st=new zn(X,A[ee],x[ee])),we[oe]=st}}else a[ie]!==N&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=k}remove(){const a=this._objects,d=this._indicesByUUID,A=this._bindings,x=A.length;let w=this.nCachedObjects_;for(let M=0,N=arguments.length;M!==N;++M){const P=arguments[M],k=P.uuid,j=d[k];if(j!==void 0&&j>=w){const Y=w++,X=a[Y];d[X.uuid]=j,a[j]=X,d[k]=Y,a[Y]=P;for(let Z=0,ie=x;Z!==ie;++Z){const oe=A[Z],ne=oe[Y],ee=oe[j];oe[j]=ne,oe[Y]=ee}}}this.nCachedObjects_=w}uncache(){const a=this._objects,d=this._indicesByUUID,A=this._bindings,x=A.length;let w=this.nCachedObjects_,M=a.length;for(let N=0,P=arguments.length;N!==P;++N){const k=arguments[N],j=k.uuid,Y=d[j];if(Y!==void 0)if(delete d[j],Y<w){const X=--w,Z=a[X],ie=--M,oe=a[ie];d[Z.uuid]=Y,a[Y]=Z,d[oe.uuid]=X,a[X]=oe,a.pop();for(let ne=0,ee=x;ne!==ee;++ne){const Me=A[ne],we=Me[X],xe=Me[ie];Me[Y]=we,Me[X]=xe,Me.pop()}}else{const X=--M,Z=a[X];X>0&&(d[Z.uuid]=Y),a[Y]=Z,a.pop();for(let ie=0,oe=x;ie!==oe;++ie){const ne=A[ie];ne[Y]=ne[X],ne.pop()}}}this.nCachedObjects_=w}subscribe_(a,d){const A=this._bindingsIndicesByPath;let x=A[a];const w=this._bindings;if(x!==void 0)return w[x];const M=this._paths,N=this._parsedPaths,P=this._objects,k=P.length,j=this.nCachedObjects_,Y=new Array(k);x=w.length,A[a]=x,M.push(a),N.push(d),w.push(Y);for(let X=j,Z=P.length;X!==Z;++X){const ie=P[X];Y[X]=new zn(ie,a,d)}return Y}unsubscribe_(a){const d=this._bindingsIndicesByPath,A=d[a];if(A!==void 0){const x=this._paths,w=this._parsedPaths,M=this._bindings,N=M.length-1,P=M[N],k=a[N];d[k]=A,M[A]=P,M.pop(),w[A]=w[N],w.pop(),x[A]=x[N],x.pop()}}}class wH{constructor(a,d,A=null,x=d.blendMode){this._mixer=a,this._clip=d,this._localRoot=A,this.blendMode=x;const w=d.tracks,M=w.length,N=new Array(M),P={endingStart:Gr,endingEnd:Gr};for(let k=0;k!==M;++k){const j=w[k].createInterpolant(null);N[k]=j,j.settings=P}this._interpolantSettings=P,this._interpolants=N,this._propertyBindings=new Array(M),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=fr,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(a){return this._startTime=a,this}setLoop(a,d){return this.loop=a,this.repetitions=d,this}setEffectiveWeight(a){return this.weight=a,this._effectiveWeight=this.enabled?a:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(a){return this._scheduleFading(a,0,1)}fadeOut(a){return this._scheduleFading(a,1,0)}crossFadeFrom(a,d,A){if(a.fadeOut(d),this.fadeIn(d),A){const x=this._clip.duration,w=a._clip.duration,M=w/x,N=x/w;a.warp(1,M,d),this.warp(N,1,d)}return this}crossFadeTo(a,d,A){return a.crossFadeFrom(this,d,A)}stopFading(){const a=this._weightInterpolant;return a!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(a)),this}setEffectiveTimeScale(a){return this.timeScale=a,this._effectiveTimeScale=this.paused?0:a,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(a){return this.timeScale=this._clip.duration/a,this.stopWarping()}syncWith(a){return this.time=a.time,this.timeScale=a.timeScale,this.stopWarping()}halt(a){return this.warp(this._effectiveTimeScale,0,a)}warp(a,d,A){const x=this._mixer,w=x.time,M=this.timeScale;let N=this._timeScaleInterpolant;N===null&&(N=x._lendControlInterpolant(),this._timeScaleInterpolant=N);const P=N.parameterPositions,k=N.sampleValues;return P[0]=w,P[1]=w+A,k[0]=a/M,k[1]=d/M,this}stopWarping(){const a=this._timeScaleInterpolant;return a!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(a)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(a,d,A,x){if(!this.enabled){this._updateWeight(a);return}const w=this._startTime;if(w!==null){const P=(a-w)*A;P<0||A===0?d=0:(this._startTime=null,d=A*P)}d*=this._updateTimeScale(a);const M=this._updateTime(d),N=this._updateWeight(a);if(N>0){const P=this._interpolants,k=this._propertyBindings;switch(this.blendMode){case Dr:for(let j=0,Y=P.length;j!==Y;++j)P[j].evaluate(M),k[j].accumulateAdditive(N);break;case hs:default:for(let j=0,Y=P.length;j!==Y;++j)P[j].evaluate(M),k[j].accumulate(x,N)}}}_updateWeight(a){let d=0;if(this.enabled){d=this.weight;const A=this._weightInterpolant;if(A!==null){const x=A.evaluate(a)[0];d*=x,a>A.parameterPositions[1]&&(this.stopFading(),x===0&&(this.enabled=!1))}}return this._effectiveWeight=d,d}_updateTimeScale(a){let d=0;if(!this.paused){d=this.timeScale;const A=this._timeScaleInterpolant;if(A!==null){const x=A.evaluate(a)[0];d*=x,a>A.parameterPositions[1]&&(this.stopWarping(),d===0?this.paused=!0:this.timeScale=d)}}return this._effectiveTimeScale=d,d}_updateTime(a){const d=this._clip.duration,A=this.loop;let x=this.time+a,w=this._loopCount;const M=A===Qi;if(a===0)return w===-1?x:M&&(w&1)===1?d-x:x;if(A===pr){w===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));i:{if(x>=d)x=d;else if(x<0)x=0;else{this.time=x;break i}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=x,this._mixer.dispatchEvent({type:"finished",action:this,direction:a<0?-1:1})}}else{if(w===-1&&(a>=0?(w=0,this._setEndings(!0,this.repetitions===0,M)):this._setEndings(this.repetitions===0,!0,M)),x>=d||x<0){const N=Math.floor(x/d);x-=d*N,w+=Math.abs(N);const P=this.repetitions-w;if(P<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,x=a>0?d:0,this.time=x,this._mixer.dispatchEvent({type:"finished",action:this,direction:a>0?1:-1});else{if(P===1){const k=a<0;this._setEndings(k,!k,M)}else this._setEndings(!1,!1,M);this._loopCount=w,this.time=x,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:N})}}else this.time=x;if(M&&(w&1)===1)return d-x}return x}_setEndings(a,d,A){const x=this._interpolantSettings;A?(x.endingStart=xn,x.endingEnd=xn):(a?x.endingStart=this.zeroSlopeAtStart?xn:Gr:x.endingStart=jr,d?x.endingEnd=this.zeroSlopeAtEnd?xn:Gr:x.endingEnd=jr)}_scheduleFading(a,d,A){const x=this._mixer,w=x.time;let M=this._weightInterpolant;M===null&&(M=x._lendControlInterpolant(),this._weightInterpolant=M);const N=M.parameterPositions,P=M.sampleValues;return N[0]=w,P[0]=d,N[1]=w+a,P[1]=A,this}}const XIe=new Float32Array(1);class KIe extends Bo{constructor(a){super(),this._root=a,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(a,d){const A=a._localRoot||this._root,x=a._clip.tracks,w=x.length,M=a._propertyBindings,N=a._interpolants,P=A.uuid,k=this._bindingsByRootAndName;let j=k[P];j===void 0&&(j={},k[P]=j);for(let Y=0;Y!==w;++Y){const X=x[Y],Z=X.name;let ie=j[Z];if(ie!==void 0)++ie.referenceCount,M[Y]=ie;else{if(ie=M[Y],ie!==void 0){ie._cacheIndex===null&&(++ie.referenceCount,this._addInactiveBinding(ie,P,Z));continue}const oe=d&&d._propertyBindings[Y].binding.parsedPath;ie=new EH(zn.create(A,Z,oe),X.ValueTypeName,X.getValueSize()),++ie.referenceCount,this._addInactiveBinding(ie,P,Z),M[Y]=ie}N[Y].resultBuffer=ie.buffer}}_activateAction(a){if(!this._isActiveAction(a)){if(a._cacheIndex===null){const A=(a._localRoot||this._root).uuid,x=a._clip.uuid,w=this._actionsByClip[x];this._bindAction(a,w&&w.knownActions[0]),this._addInactiveAction(a,x,A)}const d=a._propertyBindings;for(let A=0,x=d.length;A!==x;++A){const w=d[A];w.useCount++===0&&(this._lendBinding(w),w.saveOriginalState())}this._lendAction(a)}}_deactivateAction(a){if(this._isActiveAction(a)){const d=a._propertyBindings;for(let A=0,x=d.length;A!==x;++A){const w=d[A];--w.useCount===0&&(w.restoreOriginalState(),this._takeBackBinding(w))}this._takeBackAction(a)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const a=this;this.stats={actions:{get total(){return a._actions.length},get inUse(){return a._nActiveActions}},bindings:{get total(){return a._bindings.length},get inUse(){return a._nActiveBindings}},controlInterpolants:{get total(){return a._controlInterpolants.length},get inUse(){return a._nActiveControlInterpolants}}}}_isActiveAction(a){const d=a._cacheIndex;return d!==null&&d<this._nActiveActions}_addInactiveAction(a,d,A){const x=this._actions,w=this._actionsByClip;let M=w[d];if(M===void 0)M={knownActions:[a],actionByRoot:{}},a._byClipCacheIndex=0,w[d]=M;else{const N=M.knownActions;a._byClipCacheIndex=N.length,N.push(a)}a._cacheIndex=x.length,x.push(a),M.actionByRoot[A]=a}_removeInactiveAction(a){const d=this._actions,A=d[d.length-1],x=a._cacheIndex;A._cacheIndex=x,d[x]=A,d.pop(),a._cacheIndex=null;const w=a._clip.uuid,M=this._actionsByClip,N=M[w],P=N.knownActions,k=P[P.length-1],j=a._byClipCacheIndex;k._byClipCacheIndex=j,P[j]=k,P.pop(),a._byClipCacheIndex=null;const Y=N.actionByRoot,X=(a._localRoot||this._root).uuid;delete Y[X],P.length===0&&delete M[w],this._removeInactiveBindingsForAction(a)}_removeInactiveBindingsForAction(a){const d=a._propertyBindings;for(let A=0,x=d.length;A!==x;++A){const w=d[A];--w.referenceCount===0&&this._removeInactiveBinding(w)}}_lendAction(a){const d=this._actions,A=a._cacheIndex,x=this._nActiveActions++,w=d[x];a._cacheIndex=x,d[x]=a,w._cacheIndex=A,d[A]=w}_takeBackAction(a){const d=this._actions,A=a._cacheIndex,x=--this._nActiveActions,w=d[x];a._cacheIndex=x,d[x]=a,w._cacheIndex=A,d[A]=w}_addInactiveBinding(a,d,A){const x=this._bindingsByRootAndName,w=this._bindings;let M=x[d];M===void 0&&(M={},x[d]=M),M[A]=a,a._cacheIndex=w.length,w.push(a)}_removeInactiveBinding(a){const d=this._bindings,A=a.binding,x=A.rootNode.uuid,w=A.path,M=this._bindingsByRootAndName,N=M[x],P=d[d.length-1],k=a._cacheIndex;P._cacheIndex=k,d[k]=P,d.pop(),delete N[w],Object.keys(N).length===0&&delete M[x]}_lendBinding(a){const d=this._bindings,A=a._cacheIndex,x=this._nActiveBindings++,w=d[x];a._cacheIndex=x,d[x]=a,w._cacheIndex=A,d[A]=w}_takeBackBinding(a){const d=this._bindings,A=a._cacheIndex,x=--this._nActiveBindings,w=d[x];a._cacheIndex=x,d[x]=a,w._cacheIndex=A,d[A]=w}_lendControlInterpolant(){const a=this._controlInterpolants,d=this._nActiveControlInterpolants++;let A=a[d];return A===void 0&&(A=new lL(new Float32Array(2),new Float32Array(2),1,XIe),A.__cacheIndex=d,a[d]=A),A}_takeBackControlInterpolant(a){const d=this._controlInterpolants,A=a.__cacheIndex,x=--this._nActiveControlInterpolants,w=d[x];a.__cacheIndex=x,d[x]=a,w.__cacheIndex=A,d[A]=w}clipAction(a,d,A){const x=d||this._root,w=x.uuid;let M=typeof a=="string"?qv.findByName(x,a):a;const N=M!==null?M.uuid:a,P=this._actionsByClip[N];let k=null;if(A===void 0&&(M!==null?A=M.blendMode:A=hs),P!==void 0){const Y=P.actionByRoot[w];if(Y!==void 0&&Y.blendMode===A)return Y;k=P.knownActions[0],M===null&&(M=k._clip)}if(M===null)return null;const j=new wH(this,M,d,A);return this._bindAction(j,k),this._addInactiveAction(j,N,w),j}existingAction(a,d){const A=d||this._root,x=A.uuid,w=typeof a=="string"?qv.findByName(A,a):a,M=w?w.uuid:a,N=this._actionsByClip[M];return N!==void 0&&N.actionByRoot[x]||null}stopAllAction(){const a=this._actions,d=this._nActiveActions;for(let A=d-1;A>=0;--A)a[A].stop();return this}update(a){a*=this.timeScale;const d=this._actions,A=this._nActiveActions,x=this.time+=a,w=Math.sign(a),M=this._accuIndex^=1;for(let k=0;k!==A;++k)d[k]._update(x,a,w,M);const N=this._bindings,P=this._nActiveBindings;for(let k=0;k!==P;++k)N[k].apply(M);return this}setTime(a){this.time=0;for(let d=0;d<this._actions.length;d++)this._actions[d].time=0;return this.update(a)}getRoot(){return this._root}uncacheClip(a){const d=this._actions,A=a.uuid,x=this._actionsByClip,w=x[A];if(w!==void 0){const M=w.knownActions;for(let N=0,P=M.length;N!==P;++N){const k=M[N];this._deactivateAction(k);const j=k._cacheIndex,Y=d[d.length-1];k._cacheIndex=null,k._byClipCacheIndex=null,Y._cacheIndex=j,d[j]=Y,d.pop(),this._removeInactiveBindingsForAction(k)}delete x[A]}}uncacheRoot(a){const d=a.uuid,A=this._actionsByClip;for(const M in A){const N=A[M].actionByRoot,P=N[d];P!==void 0&&(this._deactivateAction(P),this._removeInactiveAction(P))}const x=this._bindingsByRootAndName,w=x[d];if(w!==void 0)for(const M in w){const N=w[M];N.restoreOriginalState(),this._removeInactiveBinding(N)}}uncacheAction(a,d){const A=this.existingAction(a,d);A!==null&&(this._deactivateAction(A),this._removeInactiveAction(A))}}class yL{constructor(a){this.value=a}clone(){return new yL(this.value.clone===void 0?this.value:this.value.clone())}}let YIe=0;class JIe extends Bo{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:YIe++}),this.name="",this.usage=gf,this.uniforms=[]}add(a){return this.uniforms.push(a),this}remove(a){const d=this.uniforms.indexOf(a);return d!==-1&&this.uniforms.splice(d,1),this}setName(a){return this.name=a,this}setUsage(a){return this.usage=a,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(a){this.name=a.name,this.usage=a.usage;const d=a.uniforms;this.uniforms.length=0;for(let A=0,x=d.length;A<x;A++){const w=Array.isArray(d[A])?d[A]:[d[A]];for(let M=0;M<w.length;M++)this.uniforms.push(w[M].clone())}return this}clone(){return new this.constructor().copy(this)}}class ZIe extends mw{constructor(a,d,A=1){super(a,d),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=A}copy(a){return super.copy(a),this.meshPerAttribute=a.meshPerAttribute,this}clone(a){const d=super.clone(a);return d.meshPerAttribute=this.meshPerAttribute,d}toJSON(a){const d=super.toJSON(a);return d.isInstancedInterleavedBuffer=!0,d.meshPerAttribute=this.meshPerAttribute,d}}class $Ie{constructor(a,d,A,x,w){this.isGLBufferAttribute=!0,this.name="",this.buffer=a,this.type=d,this.itemSize=A,this.elementSize=x,this.count=w,this.version=0}set needsUpdate(a){a===!0&&this.version++}setBuffer(a){return this.buffer=a,this}setType(a,d){return this.type=a,this.elementSize=d,this}setItemSize(a){return this.itemSize=a,this}setCount(a){return this.count=a,this}}const CH=new mr;class eBe{constructor(a,d,A=0,x=1/0){this.ray=new ya(a,d),this.near=A,this.far=x,this.camera=null,this.layers=new XE,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(a,d){this.ray.set(a,d)}setFromCamera(a,d){d.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(d.matrixWorld),this.ray.direction.set(a.x,a.y,.5).unproject(d).sub(this.ray.origin).normalize(),this.camera=d):d.isOrthographicCamera?(this.ray.origin.set(a.x,a.y,(d.near+d.far)/(d.near-d.far)).unproject(d),this.ray.direction.set(0,0,-1).transformDirection(d.matrixWorld),this.camera=d):console.error("THREE.Raycaster: Unsupported camera type: "+d.type)}setFromXRController(a){return CH.identity().extractRotation(a.matrixWorld),this.ray.origin.setFromMatrixPosition(a.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(CH),this}intersectObject(a,d=!0,A=[]){return vL(a,this,A,d),A.sort(SH),A}intersectObjects(a,d=!0,A=[]){for(let x=0,w=a.length;x<w;x++)vL(a[x],this,A,d);return A.sort(SH),A}}function SH(S,a){return S.distance-a.distance}function vL(S,a,d,A){if(S.layers.test(a.layers)&&S.raycast(a,d),A===!0){const x=S.children;for(let w=0,M=x.length;w<M;w++)vL(x[w],a,d,!0)}}class tBe{constructor(a=1,d=0,A=0){return this.radius=a,this.phi=d,this.theta=A,this}set(a,d,A){return this.radius=a,this.phi=d,this.theta=A,this}copy(a){return this.radius=a.radius,this.phi=a.phi,this.theta=a.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(a){return this.setFromCartesianCoords(a.x,a.y,a.z)}setFromCartesianCoords(a,d,A){return this.radius=Math.sqrt(a*a+d*d+A*A),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(a,A),this.phi=Math.acos(Ts(d/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class iBe{constructor(a=1,d=0,A=0){return this.radius=a,this.theta=d,this.y=A,this}set(a,d,A){return this.radius=a,this.theta=d,this.y=A,this}copy(a){return this.radius=a.radius,this.theta=a.theta,this.y=a.y,this}setFromVector3(a){return this.setFromCartesianCoords(a.x,a.y,a.z)}setFromCartesianCoords(a,d,A){return this.radius=Math.sqrt(a*a+A*A),this.theta=Math.atan2(a,A),this.y=d,this}clone(){return new this.constructor().copy(this)}}const TH=new oi;class rBe{constructor(a=new oi(1/0,1/0),d=new oi(-1/0,-1/0)){this.isBox2=!0,this.min=a,this.max=d}set(a,d){return this.min.copy(a),this.max.copy(d),this}setFromPoints(a){this.makeEmpty();for(let d=0,A=a.length;d<A;d++)this.expandByPoint(a[d]);return this}setFromCenterAndSize(a,d){const A=TH.copy(d).multiplyScalar(.5);return this.min.copy(a).sub(A),this.max.copy(a).add(A),this}clone(){return new this.constructor().copy(this)}copy(a){return this.min.copy(a.min),this.max.copy(a.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(a){return this.isEmpty()?a.set(0,0):a.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(a){return this.isEmpty()?a.set(0,0):a.subVectors(this.max,this.min)}expandByPoint(a){return this.min.min(a),this.max.max(a),this}expandByVector(a){return this.min.sub(a),this.max.add(a),this}expandByScalar(a){return this.min.addScalar(-a),this.max.addScalar(a),this}containsPoint(a){return!(a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y)}containsBox(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y}getParameter(a,d){return d.set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(a){return!(a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y)}clampPoint(a,d){return d.copy(a).clamp(this.min,this.max)}distanceToPoint(a){return this.clampPoint(a,TH).distanceTo(a)}intersect(a){return this.min.max(a.min),this.max.min(a.max),this.isEmpty()&&this.makeEmpty(),this}union(a){return this.min.min(a.min),this.max.max(a.max),this}translate(a){return this.min.add(a),this.max.add(a),this}equals(a){return a.min.equals(this.min)&&a.max.equals(this.max)}}const MH=new He,t2=new He;class nBe{constructor(a=new He,d=new He){this.start=a,this.end=d}set(a,d){return this.start.copy(a),this.end.copy(d),this}copy(a){return this.start.copy(a.start),this.end.copy(a.end),this}getCenter(a){return a.addVectors(this.start,this.end).multiplyScalar(.5)}delta(a){return a.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(a,d){return this.delta(d).multiplyScalar(a).add(this.start)}closestPointToPointParameter(a,d){MH.subVectors(a,this.start),t2.subVectors(this.end,this.start);const A=t2.dot(t2);let x=t2.dot(MH)/A;return d&&(x=Ts(x,0,1)),x}closestPointToPoint(a,d,A){const x=this.closestPointToPointParameter(a,d);return this.delta(A).multiplyScalar(x).add(this.start)}applyMatrix4(a){return this.start.applyMatrix4(a),this.end.applyMatrix4(a),this}equals(a){return a.start.equals(this.start)&&a.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const RH=new He;class sBe extends Hn{constructor(a,d){super(),this.light=a,this.matrixAutoUpdate=!1,this.color=d,this.type="SpotLightHelper";const A=new pn,x=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let M=0,N=1,P=32;M<P;M++,N++){const k=M/P*Math.PI*2,j=N/P*Math.PI*2;x.push(Math.cos(k),Math.sin(k),1,Math.cos(j),Math.sin(j),1)}A.setAttribute("position",new br(x,3));const w=new Po({fog:!1,toneMapped:!1});this.cone=new uu(A,w),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const a=this.light.distance?this.light.distance:1e3,d=a*Math.tan(this.light.angle);this.cone.scale.set(d,d,a),RH.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(RH),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Zd=new He,i2=new mr,bL=new mr;class aBe extends uu{constructor(a){const d=IH(a),A=new pn,x=[],w=[],M=new lr(0,0,1),N=new lr(0,1,0);for(let k=0;k<d.length;k++){const j=d[k];j.parent&&j.parent.isBone&&(x.push(0,0,0),x.push(0,0,0),w.push(M.r,M.g,M.b),w.push(N.r,N.g,N.b))}A.setAttribute("position",new br(x,3)),A.setAttribute("color",new br(w,3));const P=new Po({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(A,P),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=a,this.bones=d,this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(a){const d=this.bones,A=this.geometry,x=A.getAttribute("position");bL.copy(this.root.matrixWorld).invert();for(let w=0,M=0;w<d.length;w++){const N=d[w];N.parent&&N.parent.isBone&&(i2.multiplyMatrices(bL,N.matrixWorld),Zd.setFromMatrixPosition(i2),x.setXYZ(M,Zd.x,Zd.y,Zd.z),i2.multiplyMatrices(bL,N.parent.matrixWorld),Zd.setFromMatrixPosition(i2),x.setXYZ(M+1,Zd.x,Zd.y,Zd.z),M+=2)}A.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(a)}dispose(){this.geometry.dispose(),this.material.dispose()}}function IH(S){const a=[];S.isBone===!0&&a.push(S);for(let d=0;d<S.children.length;d++)a.push.apply(a,IH(S.children[d]));return a}class oBe extends ua{constructor(a,d,A){const x=new Vv(d,4,2),w=new Hd({wireframe:!0,fog:!1,toneMapped:!1});super(x,w),this.light=a,this.color=A,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const lBe=new He,BH=new lr,NH=new lr;class cBe extends Hn{constructor(a,d,A){super(),this.light=a,this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1,this.color=A,this.type="HemisphereLightHelper";const x=new Gv(d);x.rotateY(Math.PI*.5),this.material=new Hd({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const w=x.getAttribute("position"),M=new Float32Array(w.count*3);x.setAttribute("color",new as(M,3)),this.add(new ua(x,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const a=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const d=a.geometry.getAttribute("color");BH.copy(this.light.color),NH.copy(this.light.groundColor);for(let A=0,x=d.count;A<x;A++){const w=A<x/2?BH:NH;d.setXYZ(A,w.r,w.g,w.b)}d.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),a.lookAt(lBe.setFromMatrixPosition(this.light.matrixWorld).negate())}}class uBe extends uu{constructor(a=10,d=10,A=4473924,x=8947848){A=new lr(A),x=new lr(x);const w=d/2,M=a/d,N=a/2,P=[],k=[];for(let X=0,Z=0,ie=-N;X<=d;X++,ie+=M){P.push(-N,0,ie,N,0,ie),P.push(ie,0,-N,ie,0,N);const oe=X===w?A:x;oe.toArray(k,Z),Z+=3,oe.toArray(k,Z),Z+=3,oe.toArray(k,Z),Z+=3,oe.toArray(k,Z),Z+=3}const j=new pn;j.setAttribute("position",new br(P,3)),j.setAttribute("color",new br(k,3));const Y=new Po({vertexColors:!0,toneMapped:!1});super(j,Y),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class hBe extends uu{constructor(a=10,d=16,A=8,x=64,w=4473924,M=8947848){w=new lr(w),M=new lr(M);const N=[],P=[];if(d>1)for(let Y=0;Y<d;Y++){const X=Y/d*(Math.PI*2),Z=Math.sin(X)*a,ie=Math.cos(X)*a;N.push(0,0,0),N.push(Z,0,ie);const oe=Y&1?w:M;P.push(oe.r,oe.g,oe.b),P.push(oe.r,oe.g,oe.b)}for(let Y=0;Y<A;Y++){const X=Y&1?w:M,Z=a-a/A*Y;for(let ie=0;ie<x;ie++){let oe=ie/x*(Math.PI*2),ne=Math.sin(oe)*Z,ee=Math.cos(oe)*Z;N.push(ne,0,ee),P.push(X.r,X.g,X.b),oe=(ie+1)/x*(Math.PI*2),ne=Math.sin(oe)*Z,ee=Math.cos(oe)*Z,N.push(ne,0,ee),P.push(X.r,X.g,X.b)}}const k=new pn;k.setAttribute("position",new br(N,3)),k.setAttribute("color",new br(P,3));const j=new Po({vertexColors:!0,toneMapped:!1});super(k,j),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const LH=new He,r2=new He,DH=new He;class dBe extends Hn{constructor(a,d,A){super(),this.light=a,this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1,this.color=A,this.type="DirectionalLightHelper",d===void 0&&(d=1);let x=new pn;x.setAttribute("position",new br([-d,d,0,d,d,0,d,-d,0,-d,-d,0,-d,d,0],3));const w=new Po({fog:!1,toneMapped:!1});this.lightPlane=new Kd(x,w),this.add(this.lightPlane),x=new pn,x.setAttribute("position",new br([0,0,0,0,0,1],3)),this.targetLine=new Kd(x,w),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),LH.setFromMatrixPosition(this.light.matrixWorld),r2.setFromMatrixPosition(this.light.target.matrixWorld),DH.subVectors(r2,LH),this.lightPlane.lookAt(r2),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(r2),this.targetLine.scale.z=DH.length()}}const n2=new He,js=new aw;class pBe extends uu{constructor(a){const d=new pn,A=new Po({color:16777215,vertexColors:!0,toneMapped:!1}),x=[],w=[],M={};N("n1","n2"),N("n2","n4"),N("n4","n3"),N("n3","n1"),N("f1","f2"),N("f2","f4"),N("f4","f3"),N("f3","f1"),N("n1","f1"),N("n2","f2"),N("n3","f3"),N("n4","f4"),N("p","n1"),N("p","n2"),N("p","n3"),N("p","n4"),N("u1","u2"),N("u2","u3"),N("u3","u1"),N("c","t"),N("p","c"),N("cn1","cn2"),N("cn3","cn4"),N("cf1","cf2"),N("cf3","cf4");function N(ie,oe){P(ie),P(oe)}function P(ie){x.push(0,0,0),w.push(0,0,0),M[ie]===void 0&&(M[ie]=[]),M[ie].push(x.length/3-1)}d.setAttribute("position",new br(x,3)),d.setAttribute("color",new br(w,3)),super(d,A),this.type="CameraHelper",this.camera=a,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=M,this.update();const k=new lr(16755200),j=new lr(16711680),Y=new lr(43775),X=new lr(16777215),Z=new lr(3355443);this.setColors(k,j,Y,X,Z)}setColors(a,d,A,x,w){const M=this.geometry.getAttribute("color");M.setXYZ(0,a.r,a.g,a.b),M.setXYZ(1,a.r,a.g,a.b),M.setXYZ(2,a.r,a.g,a.b),M.setXYZ(3,a.r,a.g,a.b),M.setXYZ(4,a.r,a.g,a.b),M.setXYZ(5,a.r,a.g,a.b),M.setXYZ(6,a.r,a.g,a.b),M.setXYZ(7,a.r,a.g,a.b),M.setXYZ(8,a.r,a.g,a.b),M.setXYZ(9,a.r,a.g,a.b),M.setXYZ(10,a.r,a.g,a.b),M.setXYZ(11,a.r,a.g,a.b),M.setXYZ(12,a.r,a.g,a.b),M.setXYZ(13,a.r,a.g,a.b),M.setXYZ(14,a.r,a.g,a.b),M.setXYZ(15,a.r,a.g,a.b),M.setXYZ(16,a.r,a.g,a.b),M.setXYZ(17,a.r,a.g,a.b),M.setXYZ(18,a.r,a.g,a.b),M.setXYZ(19,a.r,a.g,a.b),M.setXYZ(20,a.r,a.g,a.b),M.setXYZ(21,a.r,a.g,a.b),M.setXYZ(22,a.r,a.g,a.b),M.setXYZ(23,a.r,a.g,a.b),M.setXYZ(24,d.r,d.g,d.b),M.setXYZ(25,d.r,d.g,d.b),M.setXYZ(26,d.r,d.g,d.b),M.setXYZ(27,d.r,d.g,d.b),M.setXYZ(28,d.r,d.g,d.b),M.setXYZ(29,d.r,d.g,d.b),M.setXYZ(30,d.r,d.g,d.b),M.setXYZ(31,d.r,d.g,d.b),M.setXYZ(32,A.r,A.g,A.b),M.setXYZ(33,A.r,A.g,A.b),M.setXYZ(34,A.r,A.g,A.b),M.setXYZ(35,A.r,A.g,A.b),M.setXYZ(36,A.r,A.g,A.b),M.setXYZ(37,A.r,A.g,A.b),M.setXYZ(38,x.r,x.g,x.b),M.setXYZ(39,x.r,x.g,x.b),M.setXYZ(40,w.r,w.g,w.b),M.setXYZ(41,w.r,w.g,w.b),M.setXYZ(42,w.r,w.g,w.b),M.setXYZ(43,w.r,w.g,w.b),M.setXYZ(44,w.r,w.g,w.b),M.setXYZ(45,w.r,w.g,w.b),M.setXYZ(46,w.r,w.g,w.b),M.setXYZ(47,w.r,w.g,w.b),M.setXYZ(48,w.r,w.g,w.b),M.setXYZ(49,w.r,w.g,w.b),M.needsUpdate=!0}update(){const a=this.geometry,d=this.pointMap,A=1,x=1;js.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),qs("c",d,a,js,0,0,-1),qs("t",d,a,js,0,0,1),qs("n1",d,a,js,-1,-1,-1),qs("n2",d,a,js,A,-1,-1),qs("n3",d,a,js,-1,x,-1),qs("n4",d,a,js,A,x,-1),qs("f1",d,a,js,-1,-1,1),qs("f2",d,a,js,A,-1,1),qs("f3",d,a,js,-1,x,1),qs("f4",d,a,js,A,x,1),qs("u1",d,a,js,A*.7,x*1.1,-1),qs("u2",d,a,js,-.7,x*1.1,-1),qs("u3",d,a,js,0,x*2,-1),qs("cf1",d,a,js,-1,0,1),qs("cf2",d,a,js,A,0,1),qs("cf3",d,a,js,0,-1,1),qs("cf4",d,a,js,0,x,1),qs("cn1",d,a,js,-1,0,-1),qs("cn2",d,a,js,A,0,-1),qs("cn3",d,a,js,0,-1,-1),qs("cn4",d,a,js,0,x,-1),a.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function qs(S,a,d,A,x,w,M){n2.set(x,w,M).unproject(A);const N=a[S];if(N!==void 0){const P=d.getAttribute("position");for(let k=0,j=N.length;k<j;k++)P.setXYZ(N[k],n2.x,n2.y,n2.z)}}const s2=new Ls;class fBe extends uu{constructor(a,d=16776960){const A=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),x=new Float32Array(8*3),w=new pn;w.setIndex(new as(A,1)),w.setAttribute("position",new as(x,3)),super(w,new Po({color:d,toneMapped:!1})),this.object=a,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(a){if(a!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&s2.setFromObject(this.object),s2.isEmpty())return;const d=s2.min,A=s2.max,x=this.geometry.attributes.position,w=x.array;w[0]=A.x,w[1]=A.y,w[2]=A.z,w[3]=d.x,w[4]=A.y,w[5]=A.z,w[6]=d.x,w[7]=d.y,w[8]=A.z,w[9]=A.x,w[10]=d.y,w[11]=A.z,w[12]=A.x,w[13]=A.y,w[14]=d.z,w[15]=d.x,w[16]=A.y,w[17]=d.z,w[18]=d.x,w[19]=d.y,w[20]=d.z,w[21]=A.x,w[22]=d.y,w[23]=d.z,x.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(a){return this.object=a,this.update(),this}copy(a,d){return super.copy(a,d),this.object=a.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class mBe extends uu{constructor(a,d=16776960){const A=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),x=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],w=new pn;w.setIndex(new as(A,1)),w.setAttribute("position",new br(x,3)),super(w,new Po({color:d,toneMapped:!1})),this.box=a,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(a){const d=this.box;d.isEmpty()||(d.getCenter(this.position),d.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(a))}dispose(){this.geometry.dispose(),this.material.dispose()}}class gBe extends Kd{constructor(a,d=1,A=16776960){const x=A,w=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],M=new pn;M.setAttribute("position",new br(w,3)),M.computeBoundingSphere(),super(M,new Po({color:x,toneMapped:!1})),this.type="PlaneHelper",this.plane=a,this.size=d;const N=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],P=new pn;P.setAttribute("position",new br(N,3)),P.computeBoundingSphere(),this.add(new ua(P,new Hd({color:x,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(a){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(a)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const OH=new He;let a2,xL;class ABe extends Hn{constructor(a=new He(0,0,1),d=new He(0,0,0),A=1,x=16776960,w=A*.2,M=w*.2){super(),this.type="ArrowHelper",a2===void 0&&(a2=new pn,a2.setAttribute("position",new br([0,0,0,0,1,0],3)),xL=new D0(0,.5,1,5,1),xL.translate(0,-.5,0)),this.position.copy(d),this.line=new Kd(a2,new Po({color:x,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new ua(xL,new Hd({color:x,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(a),this.setLength(A,w,M)}setDirection(a){if(a.y>.99999)this.quaternion.set(0,0,0,1);else if(a.y<-.99999)this.quaternion.set(1,0,0,0);else{OH.set(a.z,0,-a.x).normalize();const d=Math.acos(a.y);this.quaternion.setFromAxisAngle(OH,d)}}setLength(a,d=a*.2,A=d*.2){this.line.scale.set(1,Math.max(1e-4,a-d),1),this.line.updateMatrix(),this.cone.scale.set(A,d,A),this.cone.position.y=a,this.cone.updateMatrix()}setColor(a){this.line.material.color.set(a),this.cone.material.color.set(a)}copy(a){return super.copy(a,!1),this.line.copy(a.line),this.cone.copy(a.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class yBe extends uu{constructor(a=1){const d=[0,0,0,a,0,0,0,0,0,0,a,0,0,0,0,0,0,a],A=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],x=new pn;x.setAttribute("position",new br(d,3)),x.setAttribute("color",new br(A,3));const w=new Po({vertexColors:!0,toneMapped:!1});super(x,w),this.type="AxesHelper"}setColors(a,d,A){const x=new lr,w=this.geometry.attributes.color.array;return x.set(a),x.toArray(w,0),x.toArray(w,3),x.set(d),x.toArray(w,6),x.toArray(w,9),x.set(A),x.toArray(w,12),x.toArray(w,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class vBe{constructor(){this.type="ShapePath",this.color=new lr,this.subPaths=[],this.currentPath=null}moveTo(a,d){return this.currentPath=new kv,this.subPaths.push(this.currentPath),this.currentPath.moveTo(a,d),this}lineTo(a,d){return this.currentPath.lineTo(a,d),this}quadraticCurveTo(a,d,A,x){return this.currentPath.quadraticCurveTo(a,d,A,x),this}bezierCurveTo(a,d,A,x,w,M){return this.currentPath.bezierCurveTo(a,d,A,x,w,M),this}splineThru(a){return this.currentPath.splineThru(a),this}toShapes(a){function d(ee){const Me=[];for(let we=0,xe=ee.length;we<xe;we++){const st=ee[we],Qe=new If;Qe.curves=st.curves,Me.push(Qe)}return Me}function A(ee,Me){const we=Me.length;let xe=!1;for(let st=we-1,Qe=0;Qe<we;st=Qe++){let Ze=Me[st],rt=Me[Qe],ze=rt.x-Ze.x,De=rt.y-Ze.y;if(Math.abs(De)>Number.EPSILON){if(De<0&&(Ze=Me[Qe],ze=-ze,rt=Me[st],De=-De),ee.y<Ze.y||ee.y>rt.y)continue;if(ee.y===Ze.y){if(ee.x===Ze.x)return!0}else{const nt=De*(ee.x-Ze.x)-ze*(ee.y-Ze.y);if(nt===0)return!0;if(nt<0)continue;xe=!xe}}else{if(ee.y!==Ze.y)continue;if(rt.x<=ee.x&&ee.x<=Ze.x||Ze.x<=ee.x&&ee.x<=rt.x)return!0}}return xe}const x=hu.isClockWise,w=this.subPaths;if(w.length===0)return[];let M,N,P;const k=[];if(w.length===1)return N=w[0],P=new If,P.curves=N.curves,k.push(P),k;let j=!x(w[0].getPoints());j=a?!j:j;const Y=[],X=[];let Z=[],ie=0,oe;X[ie]=void 0,Z[ie]=[];for(let ee=0,Me=w.length;ee<Me;ee++)N=w[ee],oe=N.getPoints(),M=x(oe),M=a?!M:M,M?(!j&&X[ie]&&ie++,X[ie]={s:new If,p:oe},X[ie].s.curves=N.curves,j&&ie++,Z[ie]=[]):Z[ie].push({h:N,p:oe[0]});if(!X[0])return d(w);if(X.length>1){let ee=!1,Me=0;for(let we=0,xe=X.length;we<xe;we++)Y[we]=[];for(let we=0,xe=X.length;we<xe;we++){const st=Z[we];for(let Qe=0;Qe<st.length;Qe++){const Ze=st[Qe];let rt=!0;for(let ze=0;ze<X.length;ze++)A(Ze.p,X[ze].p)&&(we!==ze&&Me++,rt?(rt=!1,Y[ze].push(Ze)):ee=!0);rt&&Y[we].push(Ze)}}Me>0&&ee===!1&&(Z=Y)}let ne;for(let ee=0,Me=X.length;ee<Me;ee++){P=X[ee].s,k.push(P),ne=Z[ee];for(let we=0,xe=ne.length;we<xe;we++)P.holes.push(ne[we].h)}return k}}class bBe extends rl{constructor(a=1,d=1,A=1,x={}){console.warn('THREE.WebGLMultipleRenderTargets has been deprecated and will be removed in r172. Use THREE.WebGLRenderTarget and set the "count" parameter to enable MRT.'),super(a,d,{...x,count:A}),this.isWebGLMultipleRenderTargets=!0}get texture(){return this.textures}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:h}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=h)},"./node_modules/three/examples/jsm/libs/ktx-parse.module.js":(l,u,c)=>{c.r(u),c.d(u,{KHR_DF_CHANNEL_RGBSDA_ALPHA:()=>$t,KHR_DF_CHANNEL_RGBSDA_BLUE:()=>Ce,KHR_DF_CHANNEL_RGBSDA_DEPTH:()=>Pt,KHR_DF_CHANNEL_RGBSDA_GREEN:()=>Ge,KHR_DF_CHANNEL_RGBSDA_RED:()=>Vi,KHR_DF_CHANNEL_RGBSDA_STENCIL:()=>At,KHR_DF_FLAG_ALPHA_PREMULTIPLIED:()=>D,KHR_DF_FLAG_ALPHA_STRAIGHT:()=>I,KHR_DF_KHR_DESCRIPTORTYPE_BASICFORMAT:()=>y,KHR_DF_MODEL_ASTC:()=>R,KHR_DF_MODEL_ETC1:()=>E,KHR_DF_MODEL_ETC1S:()=>B,KHR_DF_MODEL_ETC2:()=>T,KHR_DF_MODEL_RGBSDA:()=>C,KHR_DF_MODEL_UNSPECIFIED:()=>_,KHR_DF_PRIMARIES_ACES:()=>$e,KHR_DF_PRIMARIES_ACESCC:()=>Ui,KHR_DF_PRIMARIES_ADOBERGB:()=>Zi,KHR_DF_PRIMARIES_BT2020:()=>yt,KHR_DF_PRIMARIES_BT601_EBU:()=>wt,KHR_DF_PRIMARIES_BT601_SMPTE:()=>qt,KHR_DF_PRIMARIES_BT709:()=>dt,KHR_DF_PRIMARIES_CIEXYZ:()=>Ei,KHR_DF_PRIMARIES_DISPLAYP3:()=>Si,KHR_DF_PRIMARIES_NTSC1953:()=>hi,KHR_DF_PRIMARIES_PAL525:()=>Ri,KHR_DF_PRIMARIES_UNSPECIFIED:()=>tt,KHR_DF_SAMPLE_DATATYPE_EXPONENT:()=>vt,KHR_DF_SAMPLE_DATATYPE_FLOAT:()=>Mt,KHR_DF_SAMPLE_DATATYPE_LINEAR:()=>ye,KHR_DF_SAMPLE_DATATYPE_SIGNED:()=>yi,KHR_DF_TRANSFER_ACESCC:()=>Pe,KHR_DF_TRANSFER_ACESCCT:()=>Xe,KHR_DF_TRANSFER_ADOBERGB:()=>Je,KHR_DF_TRANSFER_BT1886:()=>Q,KHR_DF_TRANSFER_DCIP3:()=>ae,KHR_DF_TRANSFER_HLG_EOTF:()=>z,KHR_DF_TRANSFER_HLG_OETF:()=>V,KHR_DF_TRANSFER_ITU:()=>q,KHR_DF_TRANSFER_LINEAR:()=>O,KHR_DF_TRANSFER_NTSC:()=>H,KHR_DF_TRANSFER_PAL625_EOTF:()=>_e,KHR_DF_TRANSFER_PAL_OETF:()=>Ae,KHR_DF_TRANSFER_PQ_EOTF:()=>te,KHR_DF_TRANSFER_PQ_OETF:()=>K,KHR_DF_TRANSFER_SLOG:()=>G,KHR_DF_TRANSFER_SLOG2:()=>J,KHR_DF_TRANSFER_SRGB:()=>F,KHR_DF_TRANSFER_ST240:()=>me,KHR_DF_TRANSFER_UNSPECIFIED:()=>L,KHR_DF_VENDORID_KHRONOS:()=>b,KHR_DF_VERSION:()=>v,KHR_SUPERCOMPRESSION_BASISLZ:()=>f,KHR_SUPERCOMPRESSION_NONE:()=>p,KHR_SUPERCOMPRESSION_ZLIB:()=>m,KHR_SUPERCOMPRESSION_ZSTD:()=>g,KTX2Container:()=>wh,VK_FORMAT_A1R5G5B5_UNORM_PACK16:()=>Re,VK_FORMAT_A2B10G10R10_SINT_PACK32:()=>ni,VK_FORMAT_A2B10G10R10_SNORM_PACK32:()=>ei,VK_FORMAT_A2B10G10R10_UINT_PACK32:()=>Bt,VK_FORMAT_A2B10G10R10_UNORM_PACK32:()=>Yt,VK_FORMAT_A2R10G10B10_SINT_PACK32:()=>Ct,VK_FORMAT_A2R10G10B10_SNORM_PACK32:()=>Ye,VK_FORMAT_A2R10G10B10_UINT_PACK32:()=>lt,VK_FORMAT_A2R10G10B10_UNORM_PACK32:()=>Fe,VK_FORMAT_A4B4G4R4_UNORM_PACK16_EXT:()=>vv,VK_FORMAT_A4R4G4B4_UNORM_PACK16_EXT:()=>Ud,VK_FORMAT_ASTC_10x10_SFLOAT_BLOCK_EXT:()=>n0,VK_FORMAT_ASTC_10x10_SRGB_BLOCK:()=>Ts,VK_FORMAT_ASTC_10x10_UNORM_BLOCK:()=>No,VK_FORMAT_ASTC_10x5_SFLOAT_BLOCK_EXT:()=>GE,VK_FORMAT_ASTC_10x5_SRGB_BLOCK:()=>Bo,VK_FORMAT_ASTC_10x5_UNORM_BLOCK:()=>Af,VK_FORMAT_ASTC_10x6_SFLOAT_BLOCK_EXT:()=>VE,VK_FORMAT_ASTC_10x6_SRGB_BLOCK:()=>FE,VK_FORMAT_ASTC_10x6_UNORM_BLOCK:()=>La,VK_FORMAT_ASTC_10x8_SFLOAT_BLOCK_EXT:()=>HE,VK_FORMAT_ASTC_10x8_SRGB_BLOCK:()=>kd,VK_FORMAT_ASTC_10x8_UNORM_BLOCK:()=>Eh,VK_FORMAT_ASTC_12x10_SFLOAT_BLOCK_EXT:()=>uN,VK_FORMAT_ASTC_12x10_SRGB_BLOCK:()=>QB,VK_FORMAT_ASTC_12x10_UNORM_BLOCK:()=>Av,VK_FORMAT_ASTC_12x12_SFLOAT_BLOCK_EXT:()=>Yn,VK_FORMAT_ASTC_12x12_SRGB_BLOCK:()=>yf,VK_FORMAT_ASTC_12x12_UNORM_BLOCK:()=>qB,VK_FORMAT_ASTC_4x4_SFLOAT_BLOCK_EXT:()=>Xr,VK_FORMAT_ASTC_4x4_SRGB_BLOCK:()=>OE,VK_FORMAT_ASTC_4x4_UNORM_BLOCK:()=>DE,VK_FORMAT_ASTC_5x4_SFLOAT_BLOCK_EXT:()=>yv,VK_FORMAT_ASTC_5x4_SRGB_BLOCK:()=>kE,VK_FORMAT_ASTC_5x4_UNORM_BLOCK:()=>PE,VK_FORMAT_ASTC_5x5_SFLOAT_BLOCK_EXT:()=>UE,VK_FORMAT_ASTC_5x5_SRGB_BLOCK:()=>kB,VK_FORMAT_ASTC_5x5_UNORM_BLOCK:()=>gf,VK_FORMAT_ASTC_6x5_SFLOAT_BLOCK_EXT:()=>cN,VK_FORMAT_ASTC_6x5_SRGB_BLOCK:()=>UB,VK_FORMAT_ASTC_6x5_UNORM_BLOCK:()=>FB,VK_FORMAT_ASTC_6x6_SFLOAT_BLOCK_EXT:()=>Fd,VK_FORMAT_ASTC_6x6_SRGB_BLOCK:()=>jB,VK_FORMAT_ASTC_6x6_UNORM_BLOCK:()=>zB,VK_FORMAT_ASTC_8x5_SFLOAT_BLOCK_EXT:()=>vf,VK_FORMAT_ASTC_8x5_SRGB_BLOCK:()=>VB,VK_FORMAT_ASTC_8x5_UNORM_BLOCK:()=>GB,VK_FORMAT_ASTC_8x6_SFLOAT_BLOCK_EXT:()=>zE,VK_FORMAT_ASTC_8x6_SRGB_BLOCK:()=>WB,VK_FORMAT_ASTC_8x6_UNORM_BLOCK:()=>HB,VK_FORMAT_ASTC_8x8_SFLOAT_BLOCK_EXT:()=>jE,VK_FORMAT_ASTC_8x8_SRGB_BLOCK:()=>Wl,VK_FORMAT_ASTC_8x8_UNORM_BLOCK:()=>gv,VK_FORMAT_B10G11R11_UFLOAT_PACK32:()=>il,VK_FORMAT_B10X6G10X6R10X6G10X6_422_UNORM_4PACK16:()=>ZB,VK_FORMAT_B12X4G12X4R12X4G12X4_422_UNORM_4PACK16:()=>rN,VK_FORMAT_B4G4R4A4_UNORM_PACK16:()=>ke,VK_FORMAT_B5G5R5A1_UNORM_PACK16:()=>re,VK_FORMAT_B5G6R5_UNORM_PACK16:()=>U,VK_FORMAT_B8G8R8A8_SINT:()=>fe,VK_FORMAT_B8G8R8A8_SNORM:()=>Ie,VK_FORMAT_B8G8R8A8_SRGB:()=>Be,VK_FORMAT_B8G8R8A8_UINT:()=>se,VK_FORMAT_B8G8R8A8_UNORM:()=>ki,VK_FORMAT_B8G8R8_SINT:()=>pe,VK_FORMAT_B8G8R8_SNORM:()=>ts,VK_FORMAT_B8G8R8_SRGB:()=>ct,VK_FORMAT_B8G8R8_UINT:()=>bs,VK_FORMAT_B8G8R8_UNORM:()=>Ns,VK_FORMAT_BC1_RGBA_SRGB_BLOCK:()=>cs,VK_FORMAT_BC1_RGBA_UNORM_BLOCK:()=>pf,VK_FORMAT_BC1_RGB_SRGB_BLOCK:()=>df,VK_FORMAT_BC1_RGB_UNORM_BLOCK:()=>r0,VK_FORMAT_BC2_SRGB_BLOCK:()=>mf,VK_FORMAT_BC2_UNORM_BLOCK:()=>ff,VK_FORMAT_BC3_SRGB_BLOCK:()=>_h,VK_FORMAT_BC3_UNORM_BLOCK:()=>EB,VK_FORMAT_BC4_SNORM_BLOCK:()=>CB,VK_FORMAT_BC4_UNORM_BLOCK:()=>wB,VK_FORMAT_BC5_SNORM_BLOCK:()=>TB,VK_FORMAT_BC5_UNORM_BLOCK:()=>SB,VK_FORMAT_BC6H_SFLOAT_BLOCK:()=>RB,VK_FORMAT_BC6H_UFLOAT_BLOCK:()=>MB,VK_FORMAT_BC7_SRGB_BLOCK:()=>BB,VK_FORMAT_BC7_UNORM_BLOCK:()=>IB,VK_FORMAT_D16_UNORM:()=>su,VK_FORMAT_D16_UNORM_S8_UINT:()=>Xa,VK_FORMAT_D24_UNORM_S8_UINT:()=>On,VK_FORMAT_D32_SFLOAT:()=>uo,VK_FORMAT_D32_SFLOAT_S8_UINT:()=>Lc,VK_FORMAT_E5B9G9R9_UFLOAT_PACK32:()=>Nc,VK_FORMAT_EAC_R11G11_SNORM_BLOCK:()=>mv,VK_FORMAT_EAC_R11G11_UNORM_BLOCK:()=>LE,VK_FORMAT_EAC_R11_SNORM_BLOCK:()=>NE,VK_FORMAT_EAC_R11_UNORM_BLOCK:()=>BE,VK_FORMAT_ETC2_R8G8B8A1_SRGB_BLOCK:()=>OB,VK_FORMAT_ETC2_R8G8B8A1_UNORM_BLOCK:()=>DB,VK_FORMAT_ETC2_R8G8B8A8_SRGB_BLOCK:()=>fv,VK_FORMAT_ETC2_R8G8B8A8_UNORM_BLOCK:()=>PB,VK_FORMAT_ETC2_R8G8B8_SRGB_BLOCK:()=>LB,VK_FORMAT_ETC2_R8G8B8_UNORM_BLOCK:()=>NB,VK_FORMAT_G10X6B10X6G10X6R10X6_422_UNORM_4PACK16:()=>JB,VK_FORMAT_G12X4B12X4G12X4R12X4_422_UNORM_4PACK16:()=>iN,VK_FORMAT_PVRTC1_2BPP_SRGB_BLOCK_IMG:()=>Ka,VK_FORMAT_PVRTC1_2BPP_UNORM_BLOCK_IMG:()=>nN,VK_FORMAT_PVRTC1_4BPP_SRGB_BLOCK_IMG:()=>Yr,VK_FORMAT_PVRTC1_4BPP_UNORM_BLOCK_IMG:()=>sN,VK_FORMAT_PVRTC2_2BPP_SRGB_BLOCK_IMG:()=>lN,VK_FORMAT_PVRTC2_2BPP_UNORM_BLOCK_IMG:()=>aN,VK_FORMAT_PVRTC2_4BPP_SRGB_BLOCK_IMG:()=>oi,VK_FORMAT_PVRTC2_4BPP_UNORM_BLOCK_IMG:()=>oN,VK_FORMAT_R10X6G10X6B10X6A10X6_UNORM_4PACK16:()=>YB,VK_FORMAT_R10X6G10X6_UNORM_2PACK16:()=>KB,VK_FORMAT_R10X6_UNORM_PACK16:()=>XB,VK_FORMAT_R12X4G12X4B12X4A12X4_UNORM_4PACK16:()=>tN,VK_FORMAT_R12X4G12X4_UNORM_2PACK16:()=>eN,VK_FORMAT_R12X4_UNORM_PACK16:()=>$B,VK_FORMAT_R16G16B16A16_SFLOAT:()=>he,VK_FORMAT_R16G16B16A16_SINT:()=>mt,VK_FORMAT_R16G16B16A16_SNORM:()=>We,VK_FORMAT_R16G16B16A16_UINT:()=>Ke,VK_FORMAT_R16G16B16A16_UNORM:()=>Se,VK_FORMAT_R16G16B16_SFLOAT:()=>ge,VK_FORMAT_R16G16B16_SINT:()=>ue,VK_FORMAT_R16G16B16_SNORM:()=>qr,VK_FORMAT_R16G16B16_UINT:()=>W,VK_FORMAT_R16G16B16_UNORM:()=>dn,VK_FORMAT_R16G16_SFLOAT:()=>or,VK_FORMAT_R16G16_SINT:()=>Bi,VK_FORMAT_R16G16_SNORM:()=>Rn,VK_FORMAT_R16G16_UINT:()=>Kn,VK_FORMAT_R16G16_UNORM:()=>_i,VK_FORMAT_R16_SFLOAT:()=>er,VK_FORMAT_R16_SINT:()=>hr,VK_FORMAT_R16_SNORM:()=>zi,VK_FORMAT_R16_UINT:()=>Sr,VK_FORMAT_R16_UNORM:()=>wi,VK_FORMAT_R32G32B32A32_SFLOAT:()=>vr,VK_FORMAT_R32G32B32A32_SINT:()=>Li,VK_FORMAT_R32G32B32A32_UINT:()=>Xt,VK_FORMAT_R32G32B32_SFLOAT:()=>vi,VK_FORMAT_R32G32B32_SINT:()=>si,VK_FORMAT_R32G32B32_UINT:()=>Qt,VK_FORMAT_R32G32_SFLOAT:()=>St,VK_FORMAT_R32G32_SINT:()=>at,VK_FORMAT_R32G32_UINT:()=>Ee,VK_FORMAT_R32_SFLOAT:()=>be,VK_FORMAT_R32_SINT:()=>de,VK_FORMAT_R32_UINT:()=>le,VK_FORMAT_R4G4B4A4_UNORM_PACK16:()=>Te,VK_FORMAT_R4G4_UNORM_PACK8:()=>Ne,VK_FORMAT_R5G5B5A1_UNORM_PACK16:()=>$,VK_FORMAT_R5G6B5_UNORM_PACK16:()=>Oe,VK_FORMAT_R64G64B64A64_SFLOAT:()=>Cl,VK_FORMAT_R64G64B64A64_SINT:()=>Dr,VK_FORMAT_R64G64B64A64_UINT:()=>hs,VK_FORMAT_R64G64B64_SFLOAT:()=>jr,VK_FORMAT_R64G64B64_SINT:()=>xn,VK_FORMAT_R64G64B64_UINT:()=>Gr,VK_FORMAT_R64G64_SFLOAT:()=>Fr,VK_FORMAT_R64G64_SINT:()=>Tr,VK_FORMAT_R64G64_UINT:()=>wr,VK_FORMAT_R64_SFLOAT:()=>Qi,VK_FORMAT_R64_SINT:()=>fr,VK_FORMAT_R64_UINT:()=>pr,VK_FORMAT_R8G8B8A8_SINT:()=>ar,VK_FORMAT_R8G8B8A8_SNORM:()=>Jt,VK_FORMAT_R8G8B8A8_SRGB:()=>Di,VK_FORMAT_R8G8B8A8_UINT:()=>Ni,VK_FORMAT_R8G8B8A8_UNORM:()=>Tt,VK_FORMAT_R8G8B8_SINT:()=>vs,VK_FORMAT_R8G8B8_SNORM:()=>kr,VK_FORMAT_R8G8B8_SRGB:()=>An,VK_FORMAT_R8G8B8_UINT:()=>nn,VK_FORMAT_R8G8B8_UNORM:()=>gn,VK_FORMAT_R8G8_SINT:()=>_r,VK_FORMAT_R8G8_SNORM:()=>Gt,VK_FORMAT_R8G8_SRGB:()=>Fi,VK_FORMAT_R8G8_UINT:()=>mi,VK_FORMAT_R8G8_UNORM:()=>xt,VK_FORMAT_R8_SINT:()=>pt,VK_FORMAT_R8_SNORM:()=>Ue,VK_FORMAT_R8_SRGB:()=>Lt,VK_FORMAT_R8_UINT:()=>je,VK_FORMAT_R8_UNORM:()=>ce,VK_FORMAT_S8_UINT:()=>ou,VK_FORMAT_UNDEFINED:()=>ve,VK_FORMAT_X8_D24_UNORM_PACK32:()=>au,read:()=>Un,write:()=>o0});var h=c("./node_modules/buffer/index.js").Buffer;const p=0,f=1,g=2,m=3,y=0,b=0,v=2,_=0,C=1,E=160,T=161,R=162,B=163,I=0,D=1,L=0,O=1,F=2,q=3,H=4,G=5,J=6,Q=7,V=8,z=9,te=10,K=11,ae=12,Ae=13,_e=14,me=15,Pe=16,Xe=17,Je=18,tt=0,dt=1,wt=2,qt=3,yt=4,Ei=5,$e=6,Ui=7,hi=8,Ri=9,Si=10,Zi=11,Vi=0,Ge=1,Ce=2,At=13,Pt=14,$t=15,Mt=128,yi=64,vt=32,ye=16,ve=0,Ne=1,Te=2,ke=3,Oe=4,U=5,$=6,re=7,Re=8,ce=9,Ue=10,je=13,pt=14,Lt=15,xt=16,Gt=17,mi=20,_r=21,Fi=22,gn=23,kr=24,nn=27,vs=28,An=29,Ns=30,ts=31,bs=34,pe=35,ct=36,Tt=37,Jt=38,Ni=41,ar=42,Di=43,ki=44,Ie=45,se=48,fe=49,Be=50,Fe=58,Ye=59,lt=62,Ct=63,Yt=64,ei=65,Bt=68,ni=69,wi=70,zi=71,Sr=74,hr=75,er=76,_i=77,Rn=78,Kn=81,Bi=82,or=83,dn=84,qr=85,W=88,ue=89,ge=90,Se=91,We=92,Ke=95,mt=96,he=97,le=98,de=99,be=100,Ee=101,at=102,St=103,Qt=104,si=105,vi=106,Xt=107,Li=108,vr=109,pr=110,fr=111,Qi=112,wr=113,Tr=114,Fr=115,Gr=116,xn=117,jr=118,hs=119,Dr=120,Cl=121,il=122,Nc=123,su=124,au=125,uo=126,ou=127,Xa=128,On=129,Lc=130,r0=131,df=132,pf=133,cs=134,ff=135,mf=136,EB=137,_h=138,wB=139,CB=140,SB=141,TB=142,MB=143,RB=144,IB=145,BB=146,NB=147,LB=148,DB=149,OB=150,PB=151,fv=152,BE=153,NE=154,LE=155,mv=156,DE=157,OE=158,PE=159,kE=160,gf=161,kB=162,FB=163,UB=164,zB=165,jB=166,GB=167,VB=168,HB=169,WB=170,gv=171,Wl=172,Af=173,Bo=174,La=175,FE=176,Eh=177,kd=178,No=179,Ts=180,Av=181,QB=182,qB=183,yf=184,XB=1000156007,KB=1000156008,YB=1000156009,JB=1000156010,ZB=1000156011,$B=1000156017,eN=1000156018,tN=1000156019,iN=1000156020,rN=1000156021,nN=1000054e3,sN=1000054001,aN=1000054002,oN=1000054003,Ka=1000054004,Yr=1000054005,lN=1000054006,oi=1000054007,Xr=1000066e3,yv=1000066001,UE=1000066002,cN=1000066003,Fd=1000066004,vf=1000066005,zE=1000066006,jE=1000066007,GE=1000066008,VE=1000066009,HE=1000066010,n0=1000066011,uN=1000066012,Yn=1000066013,Ud=100034e4,vv=1000340001;class wh{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class zd{constructor(Kr,Bn,Vn,He){this._dataView=new DataView(Kr.buffer,Kr.byteOffset+Bn,Vn),this._littleEndian=He,this._offset=0}_nextUint8(){const Kr=this._dataView.getUint8(this._offset);return this._offset+=1,Kr}_nextUint16(){const Kr=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,Kr}_nextUint32(){const Kr=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,Kr}_nextUint64(){const Kr=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,Kr}_nextInt32(){const Kr=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,Kr}_skip(Kr){return this._offset+=Kr,this}_scan(Kr,Bn=0){const Vn=this._offset;let He=0;for(;this._dataView.getUint8(this._offset)!==Bn&&He<Kr;)He++,this._offset++;return He<Kr&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+Vn,He)}}const WE=new Uint8Array([0]),xs=[171,75,84,88,32,50,48,187,13,10,26,10];function s0(dr){return typeof TextEncoder<"u"?new TextEncoder().encode(dr):h.from(dr)}function QE(dr){return typeof TextDecoder<"u"?new TextDecoder().decode(dr):h.from(dr).toString("utf8")}function ds(dr){let Kr=0;for(const He of dr)Kr+=He.byteLength;const Bn=new Uint8Array(Kr);let Vn=0;for(const He of dr)Bn.set(new Uint8Array(He),Vn),Vn+=He.byteLength;return Bn}function Un(dr){const Kr=new Uint8Array(dr.buffer,dr.byteOffset,xs.length);if(Kr[0]!==xs[0]||Kr[1]!==xs[1]||Kr[2]!==xs[2]||Kr[3]!==xs[3]||Kr[4]!==xs[4]||Kr[5]!==xs[5]||Kr[6]!==xs[6]||Kr[7]!==xs[7]||Kr[8]!==xs[8]||Kr[9]!==xs[9]||Kr[10]!==xs[10]||Kr[11]!==xs[11])throw new Error("Missing KTX 2.0 identifier.");const Bn=new wh,Vn=17*Uint32Array.BYTES_PER_ELEMENT,He=new zd(dr,xs.length,Vn,!0);Bn.vkFormat=He._nextUint32(),Bn.typeSize=He._nextUint32(),Bn.pixelWidth=He._nextUint32(),Bn.pixelHeight=He._nextUint32(),Bn.pixelDepth=He._nextUint32(),Bn.layerCount=He._nextUint32(),Bn.faceCount=He._nextUint32();const Sl=He._nextUint32();Bn.supercompressionScheme=He._nextUint32();const zs=He._nextUint32(),Ls=He._nextUint32(),wn=He._nextUint32(),ho=He._nextUint32(),lu=He._nextUint64(),nl=He._nextUint64(),Da=new zd(dr,xs.length+Vn,3*Sl*8,!0);for(let ya=0;ya<Sl;ya++)Bn.levels.push({levelData:new Uint8Array(dr.buffer,dr.byteOffset+Da._nextUint64(),Da._nextUint64()),uncompressedByteLength:Da._nextUint64()});const sn=new zd(dr,zs,Ls,!0),Ya={vendorId:sn._skip(4)._nextUint16(),descriptorType:sn._nextUint16(),versionNumber:sn._nextUint16(),descriptorBlockSize:sn._nextUint16(),colorModel:sn._nextUint8(),colorPrimaries:sn._nextUint8(),transferFunction:sn._nextUint8(),flags:sn._nextUint8(),texelBlockDimension:[sn._nextUint8(),sn._nextUint8(),sn._nextUint8(),sn._nextUint8()],bytesPlane:[sn._nextUint8(),sn._nextUint8(),sn._nextUint8(),sn._nextUint8(),sn._nextUint8(),sn._nextUint8(),sn._nextUint8(),sn._nextUint8()],samples:[]},Tl=(Ya.descriptorBlockSize/4-6)/4;for(let ya=0;ya<Tl;ya++){const mr={bitOffset:sn._nextUint16(),bitLength:sn._nextUint8(),channelType:sn._nextUint8(),samplePosition:[sn._nextUint8(),sn._nextUint8(),sn._nextUint8(),sn._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&mr.channelType?(mr.sampleLower=sn._nextInt32(),mr.sampleUpper=sn._nextInt32()):(mr.sampleLower=sn._nextUint32(),mr.sampleUpper=sn._nextUint32()),Ya.samples[ya]=mr}Bn.dataFormatDescriptor.length=0,Bn.dataFormatDescriptor.push(Ya);const Oa=new zd(dr,wn,ho,!0);for(;Oa._offset<ho;){const ya=Oa._nextUint32(),mr=Oa._scan(ya),Sh=QE(mr),sl=Oa._scan(ya-mr.byteLength);Bn.keyValue[Sh]=Sh.match(/^ktx/i)?QE(sl):sl,Oa._offset%4&&Oa._skip(4-Oa._offset%4)}if(nl<=0)return Bn;const Pn=new zd(dr,lu,nl,!0),ss=Pn._nextUint16(),an=Pn._nextUint16(),kn=Pn._nextUint32(),Lo=Pn._nextUint32(),jd=Pn._nextUint32(),Ch=Pn._nextUint32(),l0=[];for(let ya=0;ya<Sl;ya++)l0.push({imageFlags:Pn._nextUint32(),rgbSliceByteOffset:Pn._nextUint32(),rgbSliceByteLength:Pn._nextUint32(),alphaSliceByteOffset:Pn._nextUint32(),alphaSliceByteLength:Pn._nextUint32()});const Aa=lu+Pn._offset,Ql=Aa+kn,c0=Ql+Lo,u0=c0+jd,cu=new Uint8Array(dr.buffer,dr.byteOffset+Aa,kn),bv=new Uint8Array(dr.buffer,dr.byteOffset+Ql,Lo),h0=new Uint8Array(dr.buffer,dr.byteOffset+c0,jd),xv=new Uint8Array(dr.buffer,dr.byteOffset+u0,Ch);return Bn.globalData={endpointCount:ss,selectorCount:an,imageDescs:l0,endpointsData:cu,selectorsData:bv,tablesData:h0,extendedData:xv},Bn}function a0(){return(a0=Object.assign||function(dr){for(var Kr=1;Kr<arguments.length;Kr++){var Bn=arguments[Kr];for(var Vn in Bn)Object.prototype.hasOwnProperty.call(Bn,Vn)&&(dr[Vn]=Bn[Vn])}return dr}).apply(this,arguments)}const rl={keepWriter:!1};function o0(dr,Kr={}){Kr=a0({},rl,Kr);let Bn=new ArrayBuffer(0);if(dr.globalData){const ss=new ArrayBuffer(20+5*dr.globalData.imageDescs.length*4),an=new DataView(ss);an.setUint16(0,dr.globalData.endpointCount,!0),an.setUint16(2,dr.globalData.selectorCount,!0),an.setUint32(4,dr.globalData.endpointsData.byteLength,!0),an.setUint32(8,dr.globalData.selectorsData.byteLength,!0),an.setUint32(12,dr.globalData.tablesData.byteLength,!0),an.setUint32(16,dr.globalData.extendedData.byteLength,!0);for(let kn=0;kn<dr.globalData.imageDescs.length;kn++){const Lo=dr.globalData.imageDescs[kn];an.setUint32(20+5*kn*4+0,Lo.imageFlags,!0),an.setUint32(20+5*kn*4+4,Lo.rgbSliceByteOffset,!0),an.setUint32(20+5*kn*4+8,Lo.rgbSliceByteLength,!0),an.setUint32(20+5*kn*4+12,Lo.alphaSliceByteOffset,!0),an.setUint32(20+5*kn*4+16,Lo.alphaSliceByteLength,!0)}Bn=ds([ss,dr.globalData.endpointsData,dr.globalData.selectorsData,dr.globalData.tablesData,dr.globalData.extendedData])}const Vn=[];let He=dr.keyValue;Kr.keepWriter||(He=a0({},dr.keyValue,{KTXwriter:"KTX-Parse v0.3.1"}));for(const ss in He){const an=He[ss],kn=s0(ss),Lo=typeof an=="string"?s0(an):an,jd=kn.byteLength+1+Lo.byteLength+1,Ch=jd%4?4-jd%4:0;Vn.push(ds([new Uint32Array([jd]),kn,WE,Lo,WE,new Uint8Array(Ch).fill(0)]))}const Sl=ds(Vn);if(dr.dataFormatDescriptor.length!==1||dr.dataFormatDescriptor[0].descriptorType!==0)throw new Error("Only BASICFORMAT Data Format Descriptor output supported.");const zs=dr.dataFormatDescriptor[0],Ls=new ArrayBuffer(28+16*zs.samples.length),wn=new DataView(Ls),ho=24+16*zs.samples.length;if(wn.setUint32(0,Ls.byteLength,!0),wn.setUint16(4,zs.vendorId,!0),wn.setUint16(6,zs.descriptorType,!0),wn.setUint16(8,zs.versionNumber,!0),wn.setUint16(10,ho,!0),wn.setUint8(12,zs.colorModel),wn.setUint8(13,zs.colorPrimaries),wn.setUint8(14,zs.transferFunction),wn.setUint8(15,zs.flags),!Array.isArray(zs.texelBlockDimension))throw new Error("texelBlockDimension is now an array. For dimensionality `d`, set `d - 1`.");wn.setUint8(16,zs.texelBlockDimension[0]),wn.setUint8(17,zs.texelBlockDimension[1]),wn.setUint8(18,zs.texelBlockDimension[2]),wn.setUint8(19,zs.texelBlockDimension[3]);for(let ss=0;ss<8;ss++)wn.setUint8(20+ss,zs.bytesPlane[ss]);for(let ss=0;ss<zs.samples.length;ss++){const an=zs.samples[ss],kn=28+16*ss;if(an.channelID)throw new Error("channelID has been renamed to channelType.");wn.setUint16(kn+0,an.bitOffset,!0),wn.setUint8(kn+2,an.bitLength),wn.setUint8(kn+3,an.channelType),wn.setUint8(kn+4,an.samplePosition[0]),wn.setUint8(kn+5,an.samplePosition[1]),wn.setUint8(kn+6,an.samplePosition[2]),wn.setUint8(kn+7,an.samplePosition[3]),64&an.channelType?(wn.setInt32(kn+8,an.sampleLower,!0),wn.setInt32(kn+12,an.sampleUpper,!0)):(wn.setUint32(kn+8,an.sampleLower,!0),wn.setUint32(kn+12,an.sampleUpper,!0))}const lu=xs.length+68+3*dr.levels.length*8,nl=lu+Ls.byteLength;let Da=Bn.byteLength>0?nl+Sl.byteLength:0;Da%8&&(Da+=8-Da%8);const sn=[],Ya=new DataView(new ArrayBuffer(3*dr.levels.length*8));let Tl=(Da||nl+Sl.byteLength)+Bn.byteLength;for(let ss=0;ss<dr.levels.length;ss++){const an=dr.levels[ss];sn.push(an.levelData),Ya.setBigUint64(24*ss+0,BigInt(Tl),!0),Ya.setBigUint64(24*ss+8,BigInt(an.levelData.byteLength),!0),Ya.setBigUint64(24*ss+16,BigInt(an.uncompressedByteLength),!0),Tl+=an.levelData.byteLength}const Oa=new ArrayBuffer(68),Pn=new DataView(Oa);return Pn.setUint32(0,dr.vkFormat,!0),Pn.setUint32(4,dr.typeSize,!0),Pn.setUint32(8,dr.pixelWidth,!0),Pn.setUint32(12,dr.pixelHeight,!0),Pn.setUint32(16,dr.pixelDepth,!0),Pn.setUint32(20,dr.layerCount,!0),Pn.setUint32(24,dr.faceCount,!0),Pn.setUint32(28,dr.levels.length,!0),Pn.setUint32(32,dr.supercompressionScheme,!0),Pn.setUint32(36,lu,!0),Pn.setUint32(40,Ls.byteLength,!0),Pn.setUint32(44,nl,!0),Pn.setUint32(48,Sl.byteLength,!0),Pn.setBigUint64(52,BigInt(Bn.byteLength>0?Da:0),!0),Pn.setBigUint64(60,BigInt(Bn.byteLength),!0),new Uint8Array(ds([new Uint8Array(xs).buffer,Oa,Ya.buffer,Ls,Sl,Da>0?new ArrayBuffer(Da-(nl+Sl.byteLength)):new ArrayBuffer(0),Bn,...sn]))}},"./node_modules/three/examples/jsm/libs/zstddec.module.js":(l,u,c)=>{c.r(u),c.d(u,{ZSTDDecoder:()=>y});var h=c("./node_modules/buffer/index.js").Buffer;let p,f,g;const m={env:{emscripten_notify_memory_growth:function(v){g=new Uint8Array(f.exports.memory.buffer)}}};class y{init(){return p||(p=typeof fetch<"u"?fetch("data:application/wasm;base64,"+b).then(_=>_.arrayBuffer()).then(_=>WebAssembly.instantiate(_,m)).then(this._init):WebAssembly.instantiate(h.from(b,"base64"),m).then(this._init),p)}_init(_){f=_.instance,m.env.emscripten_notify_memory_growth(0)}decode(_,C=0){if(!f)throw new Error("ZSTDDecoder: Await .init() before decoding.");const E=_.byteLength,T=f.exports.malloc(E);g.set(_,T),C=C||Number(f.exports.ZSTD_findDecompressedSize(T,E));const R=f.exports.malloc(C),B=f.exports.ZSTD_decompress(R,C,T,E),I=g.slice(R,R+B);return f.exports.free(T),f.exports.free(R),I}}const b="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ"},"./node_modules/three/examples/jsm/lights/LightProbeGenerator.js":(l,u,c)=>{c.r(u),c.d(u,{LightProbeGenerator:()=>p});var h=c("./node_modules/three/build/three.module.js");class p{static fromCubeTexture(m){let y=0;const b=new h.Vector3,v=new h.Vector3,_=new h.Color,C=[0,0,0,0,0,0,0,0,0],E=new h.SphericalHarmonics3,T=E.coefficients;for(let B=0;B<6;B++){const I=m.image[B],D=I.width,L=I.height,O=document.createElement("canvas");O.width=D,O.height=L;const F=O.getContext("2d");F.drawImage(I,0,0,D,L);const q=F.getImageData(0,0,D,L),H=q.data,G=q.width,J=2/G;for(let Q=0,V=H.length;Q<V;Q+=4){_.setRGB(H[Q]/255,H[Q+1]/255,H[Q+2]/255),f(_,m.colorSpace);const z=Q/4,te=-1+(z%G+.5)*J,K=1-(Math.floor(z/G)+.5)*J;switch(B){case 0:b.set(-1,K,-te);break;case 1:b.set(1,K,te);break;case 2:b.set(-te,1,-K);break;case 3:b.set(-te,-1,K);break;case 4:b.set(-te,K,1);break;case 5:b.set(te,K,-1);break}const ae=b.lengthSq(),Ae=4/(Math.sqrt(ae)*ae);y+=Ae,v.copy(b).normalize(),h.SphericalHarmonics3.getBasisAt(v,C);for(let _e=0;_e<9;_e++)T[_e].x+=C[_e]*_.r*Ae,T[_e].y+=C[_e]*_.g*Ae,T[_e].z+=C[_e]*_.b*Ae}}const R=4*Math.PI/y;for(let B=0;B<9;B++)T[B].x*=R,T[B].y*=R,T[B].z*=R;return new h.LightProbe(E)}static fromCubeRenderTarget(m,y){let b=0;const v=new h.Vector3,_=new h.Vector3,C=new h.Color,E=[0,0,0,0,0,0,0,0,0],T=new h.SphericalHarmonics3,R=T.coefficients,B=y.texture.type;for(let D=0;D<6;D++){const L=y.width;let O;B===h.HalfFloatType?O=new Uint16Array(L*L*4):O=new Uint8Array(L*L*4),m.readRenderTargetPixels(y,0,0,L,L,O,D);const F=2/L;for(let q=0,H=O.length;q<H;q+=4){let G,J,Q;B===h.HalfFloatType?(G=h.DataUtils.fromHalfFloat(O[q]),J=h.DataUtils.fromHalfFloat(O[q+1]),Q=h.DataUtils.fromHalfFloat(O[q+2])):(G=O[q]/255,J=O[q+1]/255,Q=O[q+2]/255),C.setRGB(G,J,Q),f(C,y.texture.colorSpace);const V=q/4,z=-1+(V%L+.5)*F,te=1-(Math.floor(V/L)+.5)*F;switch(D){case 0:v.set(1,te,-z);break;case 1:v.set(-1,te,z);break;case 2:v.set(z,1,-te);break;case 3:v.set(z,-1,te);break;case 4:v.set(z,te,1);break;case 5:v.set(-z,te,-1);break}const K=v.lengthSq(),ae=4/(Math.sqrt(K)*K);b+=ae,_.copy(v).normalize(),h.SphericalHarmonics3.getBasisAt(_,E);for(let Ae=0;Ae<9;Ae++)R[Ae].x+=E[Ae]*C.r*ae,R[Ae].y+=E[Ae]*C.g*ae,R[Ae].z+=E[Ae]*C.b*ae}}const I=4*Math.PI/b;for(let D=0;D<9;D++)R[D].x*=I,R[D].y*=I,R[D].z*=I;return new h.LightProbe(T)}}function f(g,m){switch(m){case h.SRGBColorSpace:g.convertSRGBToLinear();break;case h.LinearSRGBColorSpace:case h.NoColorSpace:break;default:console.warn("WARNING: LightProbeGenerator convertColorToLinear() encountered an unsupported color space.");break}return g}},"./node_modules/three/examples/jsm/loaders/DRACOLoader.js":(l,u,c)=>{c.r(u),c.d(u,{DRACOLoader:()=>f});var h=c("./node_modules/three/build/three.module.js");const p=new WeakMap;class f extends h.Loader{constructor(y){super(y),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(y){return this.decoderPath=y,this}setDecoderConfig(y){return this.decoderConfig=y,this}setWorkerLimit(y){return this.workerLimit=y,this}load(y,b,v,_){const C=new h.FileLoader(this.manager);C.setPath(this.path),C.setResponseType("arraybuffer"),C.setRequestHeader(this.requestHeader),C.setWithCredentials(this.withCredentials),C.load(y,E=>{this.parse(E,b,_)},v,_)}parse(y,b,v=()=>{}){this.decodeDracoFile(y,b,null,null,h.SRGBColorSpace).catch(v)}decodeDracoFile(y,b,v,_,C=h.LinearSRGBColorSpace,E=()=>{}){const T={attributeIDs:v||this.defaultAttributeIDs,attributeTypes:_||this.defaultAttributeTypes,useUniqueIDs:!!v,vertexColorSpace:C};return this.decodeGeometry(y,T).then(b).catch(E)}decodeGeometry(y,b){const v=JSON.stringify(b);if(p.has(y)){const R=p.get(y);if(R.key===v)return R.promise;if(y.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let _;const C=this.workerNextTaskID++,E=y.byteLength,T=this._getWorker(C,E).then(R=>(_=R,new Promise((B,I)=>{_._callbacks[C]={resolve:B,reject:I},_.postMessage({type:"decode",id:C,taskConfig:b,buffer:y},[y])}))).then(R=>this._createGeometry(R.geometry));return T.catch(()=>!0).then(()=>{_&&C&&this._releaseTask(_,C)}),p.set(y,{key:v,promise:T}),T}_createGeometry(y){const b=new h.BufferGeometry;y.index&&b.setIndex(new h.BufferAttribute(y.index.array,1));for(let v=0;v<y.attributes.length;v++){const _=y.attributes[v],C=_.name,E=_.array,T=_.itemSize,R=new h.BufferAttribute(E,T);C==="color"&&(this._assignVertexColorSpace(R,_.vertexColorSpace),R.normalized=!(E instanceof Float32Array)),b.setAttribute(C,R)}return b}_assignVertexColorSpace(y,b){if(b!==h.SRGBColorSpace)return;const v=new h.Color;for(let _=0,C=y.count;_<C;_++)v.fromBufferAttribute(y,_).convertSRGBToLinear(),y.setXYZ(_,v.r,v.g,v.b)}_loadLibrary(y,b){const v=new h.FileLoader(this.manager);return v.setPath(this.decoderPath),v.setResponseType(b),v.setWithCredentials(this.withCredentials),new Promise((_,C)=>{v.load(y,_,void 0,C)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const y=typeof WebAssembly!="object"||this.decoderConfig.type==="js",b=[];return y?b.push(this._loadLibrary("draco_decoder.js","text")):(b.push(this._loadLibrary("draco_wasm_wrapper.js","text")),b.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(b).then(v=>{const _=v[0];y||(this.decoderConfig.wasmBinary=v[1]);const C=g.toString(),E=["/* draco decoder */",_,"","/* worker */",C.substring(C.indexOf("{")+1,C.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([E]))}),this.decoderPending}_getWorker(y,b){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const _=new Worker(this.workerSourceURL);_._callbacks={},_._taskCosts={},_._taskLoad=0,_.postMessage({type:"init",decoderConfig:this.decoderConfig}),_.onmessage=function(C){const E=C.data;switch(E.type){case"decode":_._callbacks[E.id].resolve(E);break;case"error":_._callbacks[E.id].reject(E);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+E.type+'"')}},this.workerPool.push(_)}else this.workerPool.sort(function(_,C){return _._taskLoad>C._taskLoad?-1:1});const v=this.workerPool[this.workerPool.length-1];return v._taskCosts[y]=b,v._taskLoad+=b,v})}_releaseTask(y,b){y._taskLoad-=y._taskCosts[b],delete y._callbacks[b],delete y._taskCosts[b]}debug(){console.log("Task load: ",this.workerPool.map(y=>y._taskLoad))}dispose(){for(let y=0;y<this.workerPool.length;++y)this.workerPool[y].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function g(){let m,y;onmessage=function(E){const T=E.data;switch(T.type){case"init":m=T.decoderConfig,y=new Promise(function(I){m.onModuleLoaded=function(D){I({draco:D})},DracoDecoderModule(m)});break;case"decode":const R=T.buffer,B=T.taskConfig;y.then(I=>{const D=I.draco,L=new D.Decoder;try{const O=b(D,L,new Int8Array(R),B),F=O.attributes.map(q=>q.array.buffer);O.index&&F.push(O.index.array.buffer),self.postMessage({type:"decode",id:T.id,geometry:O},F)}catch(O){console.error(O),self.postMessage({type:"error",id:T.id,error:O.message})}finally{D.destroy(L)}});break}};function b(E,T,R,B){const I=B.attributeIDs,D=B.attributeTypes;let L,O;const F=T.GetEncodedGeometryType(R);if(F===E.TRIANGULAR_MESH)L=new E.Mesh,O=T.DecodeArrayToMesh(R,R.byteLength,L);else if(F===E.POINT_CLOUD)L=new E.PointCloud,O=T.DecodeArrayToPointCloud(R,R.byteLength,L);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!O.ok()||L.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+O.error_msg());const q={index:null,attributes:[]};for(const H in I){const G=self[D[H]];let J,Q;if(B.useUniqueIDs)Q=I[H],J=T.GetAttributeByUniqueId(L,Q);else{if(Q=T.GetAttributeId(L,E[I[H]]),Q===-1)continue;J=T.GetAttribute(L,Q)}const V=_(E,T,L,H,G,J);H==="color"&&(V.vertexColorSpace=B.vertexColorSpace),q.attributes.push(V)}return F===E.TRIANGULAR_MESH&&(q.index=v(E,T,L)),E.destroy(L),q}function v(E,T,R){const B=R.num_faces()*3,I=B*4,D=E._malloc(I);T.GetTrianglesUInt32Array(R,I,D);const L=new Uint32Array(E.HEAPF32.buffer,D,B).slice();return E._free(D),{array:L,itemSize:1}}function _(E,T,R,B,I,D){const L=D.num_components(),O=R.num_points()*L,F=O*I.BYTES_PER_ELEMENT,q=C(E,I),H=E._malloc(F);T.GetAttributeDataArrayForAllPoints(R,D,q,F,H);const G=new I(E.HEAPF32.buffer,H,O).slice();return E._free(H),{name:B,array:G,itemSize:L}}function C(E,T){switch(T){case Float32Array:return E.DT_FLOAT32;case Int8Array:return E.DT_INT8;case Int16Array:return E.DT_INT16;case Int32Array:return E.DT_INT32;case Uint8Array:return E.DT_UINT8;case Uint16Array:return E.DT_UINT16;case Uint32Array:return E.DT_UINT32}}}},"./node_modules/three/examples/jsm/loaders/GLTFLoader.js":(l,u,c)=>{c.r(u),c.d(u,{GLTFLoader:()=>f});var h=c("./node_modules/three/build/three.module.js"),p=c("./node_modules/three/examples/jsm/utils/BufferGeometryUtils.js");class f extends h.Loader{constructor(ye){super(ye),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(ve){return new _(ve)}),this.register(function(ve){return new C(ve)}),this.register(function(ve){return new F(ve)}),this.register(function(ve){return new q(ve)}),this.register(function(ve){return new H(ve)}),this.register(function(ve){return new T(ve)}),this.register(function(ve){return new R(ve)}),this.register(function(ve){return new B(ve)}),this.register(function(ve){return new I(ve)}),this.register(function(ve){return new v(ve)}),this.register(function(ve){return new D(ve)}),this.register(function(ve){return new E(ve)}),this.register(function(ve){return new O(ve)}),this.register(function(ve){return new L(ve)}),this.register(function(ve){return new y(ve)}),this.register(function(ve){return new G(ve)}),this.register(function(ve){return new J(ve)})}load(ye,ve,Ne,Te){const ke=this;let Oe;if(this.resourcePath!=="")Oe=this.resourcePath;else if(this.path!==""){const re=h.LoaderUtils.extractUrlBase(ye);Oe=h.LoaderUtils.resolveURL(re,this.path)}else Oe=h.LoaderUtils.extractUrlBase(ye);this.manager.itemStart(ye);const U=function(re){Te?Te(re):console.error(re),ke.manager.itemError(ye),ke.manager.itemEnd(ye)},$=new h.FileLoader(this.manager);$.setPath(this.path),$.setResponseType("arraybuffer"),$.setRequestHeader(this.requestHeader),$.setWithCredentials(this.withCredentials),$.load(ye,function(re){try{ke.parse(re,Oe,function(Re){ve(Re),ke.manager.itemEnd(ye)},U)}catch(Re){U(Re)}},Ne,U)}setDRACOLoader(ye){return this.dracoLoader=ye,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(ye){return this.ktx2Loader=ye,this}setMeshoptDecoder(ye){return this.meshoptDecoder=ye,this}register(ye){return this.pluginCallbacks.indexOf(ye)===-1&&this.pluginCallbacks.push(ye),this}unregister(ye){return this.pluginCallbacks.indexOf(ye)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(ye),1),this}parse(ye,ve,Ne,Te){let ke;const Oe={},U={},$=new TextDecoder;if(typeof ye=="string")ke=JSON.parse(ye);else if(ye instanceof ArrayBuffer)if($.decode(new Uint8Array(ye,0,4))===Q){try{Oe[m.KHR_BINARY_GLTF]=new te(ye)}catch(Re){Te&&Te(Re);return}ke=JSON.parse(Oe[m.KHR_BINARY_GLTF].content)}else ke=JSON.parse($.decode(ye));else ke=ye;if(ke.asset===void 0||ke.asset.version[0]<2){Te&&Te(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const re=new $t(ke,{path:ve||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});re.fileLoader.setRequestHeader(this.requestHeader);for(let Re=0;Re<this.pluginCallbacks.length;Re++){const ce=this.pluginCallbacks[Re](re);ce.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),U[ce.name]=ce,Oe[ce.name]=!0}if(ke.extensionsUsed)for(let Re=0;Re<ke.extensionsUsed.length;++Re){const ce=ke.extensionsUsed[Re],Ue=ke.extensionsRequired||[];switch(ce){case m.KHR_MATERIALS_UNLIT:Oe[ce]=new b;break;case m.KHR_DRACO_MESH_COMPRESSION:Oe[ce]=new K(ke,this.dracoLoader);break;case m.KHR_TEXTURE_TRANSFORM:Oe[ce]=new ae;break;case m.KHR_MESH_QUANTIZATION:Oe[ce]=new Ae;break;default:Ue.indexOf(ce)>=0&&U[ce]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+ce+'".')}}re.setExtensions(Oe),re.setPlugins(U),re.parse(Ne,Te)}parseAsync(ye,ve){const Ne=this;return new Promise(function(Te,ke){Ne.parse(ye,ve,Te,ke)})}}function g(){let vt={};return{get:function(ye){return vt[ye]},add:function(ye,ve){vt[ye]=ve},remove:function(ye){delete vt[ye]},removeAll:function(){vt={}}}}const m={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class y{constructor(ye){this.parser=ye,this.name=m.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const ye=this.parser,ve=this.parser.json.nodes||[];for(let Ne=0,Te=ve.length;Ne<Te;Ne++){const ke=ve[Ne];ke.extensions&&ke.extensions[this.name]&&ke.extensions[this.name].light!==void 0&&ye._addNodeRef(this.cache,ke.extensions[this.name].light)}}_loadLight(ye){const ve=this.parser,Ne="light:"+ye;let Te=ve.cache.get(Ne);if(Te)return Te;const ke=ve.json,Oe=((ke.extensions&&ke.extensions[this.name]||{}).lights||[])[ye];let U;const $=new h.Color(16777215);Oe.color!==void 0&&$.setRGB(Oe.color[0],Oe.color[1],Oe.color[2],h.LinearSRGBColorSpace);const re=Oe.range!==void 0?Oe.range:0;switch(Oe.type){case"directional":U=new h.DirectionalLight($),U.target.position.set(0,0,-1),U.add(U.target);break;case"point":U=new h.PointLight($),U.distance=re;break;case"spot":U=new h.SpotLight($),U.distance=re,Oe.spot=Oe.spot||{},Oe.spot.innerConeAngle=Oe.spot.innerConeAngle!==void 0?Oe.spot.innerConeAngle:0,Oe.spot.outerConeAngle=Oe.spot.outerConeAngle!==void 0?Oe.spot.outerConeAngle:Math.PI/4,U.angle=Oe.spot.outerConeAngle,U.penumbra=1-Oe.spot.innerConeAngle/Oe.spot.outerConeAngle,U.target.position.set(0,0,-1),U.add(U.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+Oe.type)}return U.position.set(0,0,0),U.decay=2,Ri(U,Oe),Oe.intensity!==void 0&&(U.intensity=Oe.intensity),U.name=ve.createUniqueName(Oe.name||"light_"+ye),Te=Promise.resolve(U),ve.cache.add(Ne,Te),Te}getDependency(ye,ve){if(ye==="light")return this._loadLight(ve)}createNodeAttachment(ye){const ve=this,Ne=this.parser,Te=Ne.json.nodes[ye],ke=(Te.extensions&&Te.extensions[this.name]||{}).light;return ke===void 0?null:this._loadLight(ke).then(function(Oe){return Ne._getNodeRef(ve.cache,ke,Oe)})}}class b{constructor(){this.name=m.KHR_MATERIALS_UNLIT}getMaterialType(){return h.MeshBasicMaterial}extendParams(ye,ve,Ne){const Te=[];ye.color=new h.Color(1,1,1),ye.opacity=1;const ke=ve.pbrMetallicRoughness;if(ke){if(Array.isArray(ke.baseColorFactor)){const Oe=ke.baseColorFactor;ye.color.setRGB(Oe[0],Oe[1],Oe[2],h.LinearSRGBColorSpace),ye.opacity=Oe[3]}ke.baseColorTexture!==void 0&&Te.push(Ne.assignTexture(ye,"map",ke.baseColorTexture,h.SRGBColorSpace))}return Promise.all(Te)}}class v{constructor(ye){this.parser=ye,this.name=m.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(ye,ve){const Ne=this.parser.json.materials[ye];if(!Ne.extensions||!Ne.extensions[this.name])return Promise.resolve();const Te=Ne.extensions[this.name].emissiveStrength;return Te!==void 0&&(ve.emissiveIntensity=Te),Promise.resolve()}}class _{constructor(ye){this.parser=ye,this.name=m.KHR_MATERIALS_CLEARCOAT}getMaterialType(ye){const ve=this.parser.json.materials[ye];return!ve.extensions||!ve.extensions[this.name]?null:h.MeshPhysicalMaterial}extendMaterialParams(ye,ve){const Ne=this.parser,Te=Ne.json.materials[ye];if(!Te.extensions||!Te.extensions[this.name])return Promise.resolve();const ke=[],Oe=Te.extensions[this.name];if(Oe.clearcoatFactor!==void 0&&(ve.clearcoat=Oe.clearcoatFactor),Oe.clearcoatTexture!==void 0&&ke.push(Ne.assignTexture(ve,"clearcoatMap",Oe.clearcoatTexture)),Oe.clearcoatRoughnessFactor!==void 0&&(ve.clearcoatRoughness=Oe.clearcoatRoughnessFactor),Oe.clearcoatRoughnessTexture!==void 0&&ke.push(Ne.assignTexture(ve,"clearcoatRoughnessMap",Oe.clearcoatRoughnessTexture)),Oe.clearcoatNormalTexture!==void 0&&(ke.push(Ne.assignTexture(ve,"clearcoatNormalMap",Oe.clearcoatNormalTexture)),Oe.clearcoatNormalTexture.scale!==void 0)){const U=Oe.clearcoatNormalTexture.scale;ve.clearcoatNormalScale=new h.Vector2(U,U)}return Promise.all(ke)}}class C{constructor(ye){this.parser=ye,this.name=m.KHR_MATERIALS_DISPERSION}getMaterialType(ye){const ve=this.parser.json.materials[ye];return!ve.extensions||!ve.extensions[this.name]?null:h.MeshPhysicalMaterial}extendMaterialParams(ye,ve){const Ne=this.parser.json.materials[ye];if(!Ne.extensions||!Ne.extensions[this.name])return Promise.resolve();const Te=Ne.extensions[this.name];return ve.dispersion=Te.dispersion!==void 0?Te.dispersion:0,Promise.resolve()}}class E{constructor(ye){this.parser=ye,this.name=m.KHR_MATERIALS_IRIDESCENCE}getMaterialType(ye){const ve=this.parser.json.materials[ye];return!ve.extensions||!ve.extensions[this.name]?null:h.MeshPhysicalMaterial}extendMaterialParams(ye,ve){const Ne=this.parser,Te=Ne.json.materials[ye];if(!Te.extensions||!Te.extensions[this.name])return Promise.resolve();const ke=[],Oe=Te.extensions[this.name];return Oe.iridescenceFactor!==void 0&&(ve.iridescence=Oe.iridescenceFactor),Oe.iridescenceTexture!==void 0&&ke.push(Ne.assignTexture(ve,"iridescenceMap",Oe.iridescenceTexture)),Oe.iridescenceIor!==void 0&&(ve.iridescenceIOR=Oe.iridescenceIor),ve.iridescenceThicknessRange===void 0&&(ve.iridescenceThicknessRange=[100,400]),Oe.iridescenceThicknessMinimum!==void 0&&(ve.iridescenceThicknessRange[0]=Oe.iridescenceThicknessMinimum),Oe.iridescenceThicknessMaximum!==void 0&&(ve.iridescenceThicknessRange[1]=Oe.iridescenceThicknessMaximum),Oe.iridescenceThicknessTexture!==void 0&&ke.push(Ne.assignTexture(ve,"iridescenceThicknessMap",Oe.iridescenceThicknessTexture)),Promise.all(ke)}}class T{constructor(ye){this.parser=ye,this.name=m.KHR_MATERIALS_SHEEN}getMaterialType(ye){const ve=this.parser.json.materials[ye];return!ve.extensions||!ve.extensions[this.name]?null:h.MeshPhysicalMaterial}extendMaterialParams(ye,ve){const Ne=this.parser,Te=Ne.json.materials[ye];if(!Te.extensions||!Te.extensions[this.name])return Promise.resolve();const ke=[];ve.sheenColor=new h.Color(0,0,0),ve.sheenRoughness=0,ve.sheen=1;const Oe=Te.extensions[this.name];if(Oe.sheenColorFactor!==void 0){const U=Oe.sheenColorFactor;ve.sheenColor.setRGB(U[0],U[1],U[2],h.LinearSRGBColorSpace)}return Oe.sheenRoughnessFactor!==void 0&&(ve.sheenRoughness=Oe.sheenRoughnessFactor),Oe.sheenColorTexture!==void 0&&ke.push(Ne.assignTexture(ve,"sheenColorMap",Oe.sheenColorTexture,h.SRGBColorSpace)),Oe.sheenRoughnessTexture!==void 0&&ke.push(Ne.assignTexture(ve,"sheenRoughnessMap",Oe.sheenRoughnessTexture)),Promise.all(ke)}}class R{constructor(ye){this.parser=ye,this.name=m.KHR_MATERIALS_TRANSMISSION}getMaterialType(ye){const ve=this.parser.json.materials[ye];return!ve.extensions||!ve.extensions[this.name]?null:h.MeshPhysicalMaterial}extendMaterialParams(ye,ve){const Ne=this.parser,Te=Ne.json.materials[ye];if(!Te.extensions||!Te.extensions[this.name])return Promise.resolve();const ke=[],Oe=Te.extensions[this.name];return Oe.transmissionFactor!==void 0&&(ve.transmission=Oe.transmissionFactor),Oe.transmissionTexture!==void 0&&ke.push(Ne.assignTexture(ve,"transmissionMap",Oe.transmissionTexture)),Promise.all(ke)}}class B{constructor(ye){this.parser=ye,this.name=m.KHR_MATERIALS_VOLUME}getMaterialType(ye){const ve=this.parser.json.materials[ye];return!ve.extensions||!ve.extensions[this.name]?null:h.MeshPhysicalMaterial}extendMaterialParams(ye,ve){const Ne=this.parser,Te=Ne.json.materials[ye];if(!Te.extensions||!Te.extensions[this.name])return Promise.resolve();const ke=[],Oe=Te.extensions[this.name];ve.thickness=Oe.thicknessFactor!==void 0?Oe.thicknessFactor:0,Oe.thicknessTexture!==void 0&&ke.push(Ne.assignTexture(ve,"thicknessMap",Oe.thicknessTexture)),ve.attenuationDistance=Oe.attenuationDistance||1/0;const U=Oe.attenuationColor||[1,1,1];return ve.attenuationColor=new h.Color().setRGB(U[0],U[1],U[2],h.LinearSRGBColorSpace),Promise.all(ke)}}class I{constructor(ye){this.parser=ye,this.name=m.KHR_MATERIALS_IOR}getMaterialType(ye){const ve=this.parser.json.materials[ye];return!ve.extensions||!ve.extensions[this.name]?null:h.MeshPhysicalMaterial}extendMaterialParams(ye,ve){const Ne=this.parser.json.materials[ye];if(!Ne.extensions||!Ne.extensions[this.name])return Promise.resolve();const Te=Ne.extensions[this.name];return ve.ior=Te.ior!==void 0?Te.ior:1.5,Promise.resolve()}}class D{constructor(ye){this.parser=ye,this.name=m.KHR_MATERIALS_SPECULAR}getMaterialType(ye){const ve=this.parser.json.materials[ye];return!ve.extensions||!ve.extensions[this.name]?null:h.MeshPhysicalMaterial}extendMaterialParams(ye,ve){const Ne=this.parser,Te=Ne.json.materials[ye];if(!Te.extensions||!Te.extensions[this.name])return Promise.resolve();const ke=[],Oe=Te.extensions[this.name];ve.specularIntensity=Oe.specularFactor!==void 0?Oe.specularFactor:1,Oe.specularTexture!==void 0&&ke.push(Ne.assignTexture(ve,"specularIntensityMap",Oe.specularTexture));const U=Oe.specularColorFactor||[1,1,1];return ve.specularColor=new h.Color().setRGB(U[0],U[1],U[2],h.LinearSRGBColorSpace),Oe.specularColorTexture!==void 0&&ke.push(Ne.assignTexture(ve,"specularColorMap",Oe.specularColorTexture,h.SRGBColorSpace)),Promise.all(ke)}}class L{constructor(ye){this.parser=ye,this.name=m.EXT_MATERIALS_BUMP}getMaterialType(ye){const ve=this.parser.json.materials[ye];return!ve.extensions||!ve.extensions[this.name]?null:h.MeshPhysicalMaterial}extendMaterialParams(ye,ve){const Ne=this.parser,Te=Ne.json.materials[ye];if(!Te.extensions||!Te.extensions[this.name])return Promise.resolve();const ke=[],Oe=Te.extensions[this.name];return ve.bumpScale=Oe.bumpFactor!==void 0?Oe.bumpFactor:1,Oe.bumpTexture!==void 0&&ke.push(Ne.assignTexture(ve,"bumpMap",Oe.bumpTexture)),Promise.all(ke)}}class O{constructor(ye){this.parser=ye,this.name=m.KHR_MATERIALS_ANISOTROPY}getMaterialType(ye){const ve=this.parser.json.materials[ye];return!ve.extensions||!ve.extensions[this.name]?null:h.MeshPhysicalMaterial}extendMaterialParams(ye,ve){const Ne=this.parser,Te=Ne.json.materials[ye];if(!Te.extensions||!Te.extensions[this.name])return Promise.resolve();const ke=[],Oe=Te.extensions[this.name];return Oe.anisotropyStrength!==void 0&&(ve.anisotropy=Oe.anisotropyStrength),Oe.anisotropyRotation!==void 0&&(ve.anisotropyRotation=Oe.anisotropyRotation),Oe.anisotropyTexture!==void 0&&ke.push(Ne.assignTexture(ve,"anisotropyMap",Oe.anisotropyTexture)),Promise.all(ke)}}class F{constructor(ye){this.parser=ye,this.name=m.KHR_TEXTURE_BASISU}loadTexture(ye){const ve=this.parser,Ne=ve.json,Te=Ne.textures[ye];if(!Te.extensions||!Te.extensions[this.name])return null;const ke=Te.extensions[this.name],Oe=ve.options.ktx2Loader;if(!Oe){if(Ne.extensionsRequired&&Ne.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return ve.loadTextureImage(ye,ke.source,Oe)}}class q{constructor(ye){this.parser=ye,this.name=m.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(ye){const ve=this.name,Ne=this.parser,Te=Ne.json,ke=Te.textures[ye];if(!ke.extensions||!ke.extensions[ve])return null;const Oe=ke.extensions[ve],U=Te.images[Oe.source];let $=Ne.textureLoader;if(U.uri){const re=Ne.options.manager.getHandler(U.uri);re!==null&&($=re)}return this.detectSupport().then(function(re){if(re)return Ne.loadTextureImage(ye,Oe.source,$);if(Te.extensionsRequired&&Te.extensionsRequired.indexOf(ve)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return Ne.loadTexture(ye)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(ye){const ve=new Image;ve.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",ve.onload=ve.onerror=function(){ye(ve.height===1)}})),this.isSupported}}class H{constructor(ye){this.parser=ye,this.name=m.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(ye){const ve=this.name,Ne=this.parser,Te=Ne.json,ke=Te.textures[ye];if(!ke.extensions||!ke.extensions[ve])return null;const Oe=ke.extensions[ve],U=Te.images[Oe.source];let $=Ne.textureLoader;if(U.uri){const re=Ne.options.manager.getHandler(U.uri);re!==null&&($=re)}return this.detectSupport().then(function(re){if(re)return Ne.loadTextureImage(ye,Oe.source,$);if(Te.extensionsRequired&&Te.extensionsRequired.indexOf(ve)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return Ne.loadTexture(ye)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(ye){const ve=new Image;ve.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",ve.onload=ve.onerror=function(){ye(ve.height===1)}})),this.isSupported}}class G{constructor(ye){this.name=m.EXT_MESHOPT_COMPRESSION,this.parser=ye}loadBufferView(ye){const ve=this.parser.json,Ne=ve.bufferViews[ye];if(Ne.extensions&&Ne.extensions[this.name]){const Te=Ne.extensions[this.name],ke=this.parser.getDependency("buffer",Te.buffer),Oe=this.parser.options.meshoptDecoder;if(!Oe||!Oe.supported){if(ve.extensionsRequired&&ve.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return ke.then(function(U){const $=Te.byteOffset||0,re=Te.byteLength||0,Re=Te.count,ce=Te.byteStride,Ue=new Uint8Array(U,$,re);return Oe.decodeGltfBufferAsync?Oe.decodeGltfBufferAsync(Re,ce,Ue,Te.mode,Te.filter).then(function(je){return je.buffer}):Oe.ready.then(function(){const je=new ArrayBuffer(Re*ce);return Oe.decodeGltfBuffer(new Uint8Array(je),Re,ce,Ue,Te.mode,Te.filter),je})})}else return null}}class J{constructor(ye){this.name=m.EXT_MESH_GPU_INSTANCING,this.parser=ye}createNodeMesh(ye){const ve=this.parser.json,Ne=ve.nodes[ye];if(!Ne.extensions||!Ne.extensions[this.name]||Ne.mesh===void 0)return null;const Te=ve.meshes[Ne.mesh];for(const $ of Te.primitives)if($.mode!==Xe.TRIANGLES&&$.mode!==Xe.TRIANGLE_STRIP&&$.mode!==Xe.TRIANGLE_FAN&&$.mode!==void 0)return null;const ke=Ne.extensions[this.name].attributes,Oe=[],U={};for(const $ in ke)Oe.push(this.parser.getDependency("accessor",ke[$]).then(re=>(U[$]=re,U[$])));return Oe.length<1?null:(Oe.push(this.parser.createNodeMesh(ye)),Promise.all(Oe).then($=>{const re=$.pop(),Re=re.isGroup?re.children:[re],ce=$[0].count,Ue=[];for(const je of Re){const pt=new h.Matrix4,Lt=new h.Vector3,xt=new h.Quaternion,Gt=new h.Vector3(1,1,1),mi=new h.InstancedMesh(je.geometry,je.material,ce);for(let _r=0;_r<ce;_r++)U.TRANSLATION&&Lt.fromBufferAttribute(U.TRANSLATION,_r),U.ROTATION&&xt.fromBufferAttribute(U.ROTATION,_r),U.SCALE&&Gt.fromBufferAttribute(U.SCALE,_r),mi.setMatrixAt(_r,pt.compose(Lt,xt,Gt));for(const _r in U)if(_r==="_COLOR_0"){const Fi=U[_r];mi.instanceColor=new h.InstancedBufferAttribute(Fi.array,Fi.itemSize,Fi.normalized)}else _r!=="TRANSLATION"&&_r!=="ROTATION"&&_r!=="SCALE"&&je.geometry.setAttribute(_r,U[_r]);h.Object3D.prototype.copy.call(mi,je),this.parser.assignFinalMaterial(mi),Ue.push(mi)}return re.isGroup?(re.clear(),re.add(...Ue),re):Ue[0]}))}}const Q="glTF",V=12,z={JSON:1313821514,BIN:5130562};class te{constructor(ye){this.name=m.KHR_BINARY_GLTF,this.content=null,this.body=null;const ve=new DataView(ye,0,V),Ne=new TextDecoder;if(this.header={magic:Ne.decode(new Uint8Array(ye.slice(0,4))),version:ve.getUint32(4,!0),length:ve.getUint32(8,!0)},this.header.magic!==Q)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const Te=this.header.length-V,ke=new DataView(ye,V);let Oe=0;for(;Oe<Te;){const U=ke.getUint32(Oe,!0);Oe+=4;const $=ke.getUint32(Oe,!0);if(Oe+=4,$===z.JSON){const re=new Uint8Array(ye,V+Oe,U);this.content=Ne.decode(re)}else if($===z.BIN){const re=V+Oe;this.body=ye.slice(re,re+U)}Oe+=U}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class K{constructor(ye,ve){if(!ve)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=m.KHR_DRACO_MESH_COMPRESSION,this.json=ye,this.dracoLoader=ve,this.dracoLoader.preload()}decodePrimitive(ye,ve){const Ne=this.json,Te=this.dracoLoader,ke=ye.extensions[this.name].bufferView,Oe=ye.extensions[this.name].attributes,U={},$={},re={};for(const Re in Oe){const ce=qt[Re]||Re.toLowerCase();U[ce]=Oe[Re]}for(const Re in ye.attributes){const ce=qt[Re]||Re.toLowerCase();if(Oe[Re]!==void 0){const Ue=Ne.accessors[ye.attributes[Re]],je=Je[Ue.componentType];re[ce]=je.name,$[ce]=Ue.normalized===!0}}return ve.getDependency("bufferView",ke).then(function(Re){return new Promise(function(ce,Ue){Te.decodeDracoFile(Re,function(je){for(const pt in je.attributes){const Lt=je.attributes[pt],xt=$[pt];xt!==void 0&&(Lt.normalized=xt)}ce(je)},U,re,h.LinearSRGBColorSpace,Ue)})})}}class ae{constructor(){this.name=m.KHR_TEXTURE_TRANSFORM}extendTexture(ye,ve){return(ve.texCoord===void 0||ve.texCoord===ye.channel)&&ve.offset===void 0&&ve.rotation===void 0&&ve.scale===void 0||(ye=ye.clone(),ve.texCoord!==void 0&&(ye.channel=ve.texCoord),ve.offset!==void 0&&ye.offset.fromArray(ve.offset),ve.rotation!==void 0&&(ye.rotation=ve.rotation),ve.scale!==void 0&&ye.repeat.fromArray(ve.scale),ye.needsUpdate=!0),ye}}class Ae{constructor(){this.name=m.KHR_MESH_QUANTIZATION}}class _e extends h.Interpolant{constructor(ye,ve,Ne,Te){super(ye,ve,Ne,Te)}copySampleValue_(ye){const ve=this.resultBuffer,Ne=this.sampleValues,Te=this.valueSize,ke=ye*Te*3+Te;for(let Oe=0;Oe!==Te;Oe++)ve[Oe]=Ne[ke+Oe];return ve}interpolate_(ye,ve,Ne,Te){const ke=this.resultBuffer,Oe=this.sampleValues,U=this.valueSize,$=U*2,re=U*3,Re=Te-ve,ce=(Ne-ve)/Re,Ue=ce*ce,je=Ue*ce,pt=ye*re,Lt=pt-re,xt=-2*je+3*Ue,Gt=je-Ue,mi=1-xt,_r=Gt-Ue+ce;for(let Fi=0;Fi!==U;Fi++){const gn=Oe[Lt+Fi+U],kr=Oe[Lt+Fi+$]*Re,nn=Oe[pt+Fi+U],vs=Oe[pt+Fi]*Re;ke[Fi]=mi*gn+_r*kr+xt*nn+Gt*vs}return ke}}const me=new h.Quaternion;class Pe extends _e{interpolate_(ye,ve,Ne,Te){const ke=super.interpolate_(ye,ve,Ne,Te);return me.fromArray(ke).normalize().toArray(ke),ke}}const Xe={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Je={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},tt={9728:h.NearestFilter,9729:h.LinearFilter,9984:h.NearestMipmapNearestFilter,9985:h.LinearMipmapNearestFilter,9986:h.NearestMipmapLinearFilter,9987:h.LinearMipmapLinearFilter},dt={33071:h.ClampToEdgeWrapping,33648:h.MirroredRepeatWrapping,10497:h.RepeatWrapping},wt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},qt={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},yt={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Ei={CUBICSPLINE:void 0,LINEAR:h.InterpolateLinear,STEP:h.InterpolateDiscrete},$e={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Ui(vt){return vt.DefaultMaterial===void 0&&(vt.DefaultMaterial=new h.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:h.FrontSide})),vt.DefaultMaterial}function hi(vt,ye,ve){for(const Ne in ve.extensions)vt[Ne]===void 0&&(ye.userData.gltfExtensions=ye.userData.gltfExtensions||{},ye.userData.gltfExtensions[Ne]=ve.extensions[Ne])}function Ri(vt,ye){ye.extras!==void 0&&(typeof ye.extras=="object"?Object.assign(vt.userData,ye.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+ye.extras))}function Si(vt,ye,ve){let Ne=!1,Te=!1,ke=!1;for(let re=0,Re=ye.length;re<Re;re++){const ce=ye[re];if(ce.POSITION!==void 0&&(Ne=!0),ce.NORMAL!==void 0&&(Te=!0),ce.COLOR_0!==void 0&&(ke=!0),Ne&&Te&&ke)break}if(!Ne&&!Te&&!ke)return Promise.resolve(vt);const Oe=[],U=[],$=[];for(let re=0,Re=ye.length;re<Re;re++){const ce=ye[re];if(Ne){const Ue=ce.POSITION!==void 0?ve.getDependency("accessor",ce.POSITION):vt.attributes.position;Oe.push(Ue)}if(Te){const Ue=ce.NORMAL!==void 0?ve.getDependency("accessor",ce.NORMAL):vt.attributes.normal;U.push(Ue)}if(ke){const Ue=ce.COLOR_0!==void 0?ve.getDependency("accessor",ce.COLOR_0):vt.attributes.color;$.push(Ue)}}return Promise.all([Promise.all(Oe),Promise.all(U),Promise.all($)]).then(function(re){const Re=re[0],ce=re[1],Ue=re[2];return Ne&&(vt.morphAttributes.position=Re),Te&&(vt.morphAttributes.normal=ce),ke&&(vt.morphAttributes.color=Ue),vt.morphTargetsRelative=!0,vt})}function Zi(vt,ye){if(vt.updateMorphTargets(),ye.weights!==void 0)for(let ve=0,Ne=ye.weights.length;ve<Ne;ve++)vt.morphTargetInfluences[ve]=ye.weights[ve];if(ye.extras&&Array.isArray(ye.extras.targetNames)){const ve=ye.extras.targetNames;if(vt.morphTargetInfluences.length===ve.length){vt.morphTargetDictionary={};for(let Ne=0,Te=ve.length;Ne<Te;Ne++)vt.morphTargetDictionary[ve[Ne]]=Ne}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Vi(vt){let ye;const ve=vt.extensions&&vt.extensions[m.KHR_DRACO_MESH_COMPRESSION];if(ve?ye="draco:"+ve.bufferView+":"+ve.indices+":"+Ge(ve.attributes):ye=vt.indices+":"+Ge(vt.attributes)+":"+vt.mode,vt.targets!==void 0)for(let Ne=0,Te=vt.targets.length;Ne<Te;Ne++)ye+=":"+Ge(vt.targets[Ne]);return ye}function Ge(vt){let ye="";const ve=Object.keys(vt).sort();for(let Ne=0,Te=ve.length;Ne<Te;Ne++)ye+=ve[Ne]+":"+vt[ve[Ne]]+";";return ye}function Ce(vt){switch(vt){case Int8Array:return .007874015748031496;case Uint8Array:return .00392156862745098;case Int16Array:return 3051850947599719e-20;case Uint16Array:return 15259021896696422e-21;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function At(vt){return vt.search(/\.jpe?g($|\?)/i)>0||vt.search(/^data\:image\/jpeg/)===0?"image/jpeg":vt.search(/\.webp($|\?)/i)>0||vt.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const Pt=new h.Matrix4;class $t{constructor(ye={},ve={}){this.json=ye,this.extensions={},this.plugins={},this.options=ve,this.cache=new g,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let Ne=!1,Te=!1,ke=-1;typeof navigator<"u"&&(Ne=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,Te=navigator.userAgent.indexOf("Firefox")>-1,ke=Te?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||Ne||Te&&ke<98?this.textureLoader=new h.TextureLoader(this.options.manager):this.textureLoader=new h.ImageBitmapLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new h.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(ye){this.extensions=ye}setPlugins(ye){this.plugins=ye}parse(ye,ve){const Ne=this,Te=this.json,ke=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(Oe){return Oe._markDefs&&Oe._markDefs()}),Promise.all(this._invokeAll(function(Oe){return Oe.beforeRoot&&Oe.beforeRoot()})).then(function(){return Promise.all([Ne.getDependencies("scene"),Ne.getDependencies("animation"),Ne.getDependencies("camera")])}).then(function(Oe){const U={scene:Oe[0][Te.scene||0],scenes:Oe[0],animations:Oe[1],cameras:Oe[2],asset:Te.asset,parser:Ne,userData:{}};return hi(ke,U,Te),Ri(U,Te),Promise.all(Ne._invokeAll(function($){return $.afterRoot&&$.afterRoot(U)})).then(function(){for(const $ of U.scenes)$.updateMatrixWorld();ye(U)})}).catch(ve)}_markDefs(){const ye=this.json.nodes||[],ve=this.json.skins||[],Ne=this.json.meshes||[];for(let Te=0,ke=ve.length;Te<ke;Te++){const Oe=ve[Te].joints;for(let U=0,$=Oe.length;U<$;U++)ye[Oe[U]].isBone=!0}for(let Te=0,ke=ye.length;Te<ke;Te++){const Oe=ye[Te];Oe.mesh!==void 0&&(this._addNodeRef(this.meshCache,Oe.mesh),Oe.skin!==void 0&&(Ne[Oe.mesh].isSkinnedMesh=!0)),Oe.camera!==void 0&&this._addNodeRef(this.cameraCache,Oe.camera)}}_addNodeRef(ye,ve){ve!==void 0&&(ye.refs[ve]===void 0&&(ye.refs[ve]=ye.uses[ve]=0),ye.refs[ve]++)}_getNodeRef(ye,ve,Ne){if(ye.refs[ve]<=1)return Ne;const Te=Ne.clone(),ke=(Oe,U)=>{const $=this.associations.get(Oe);$!=null&&this.associations.set(U,$);for(const[re,Re]of Oe.children.entries())ke(Re,U.children[re])};return ke(Ne,Te),Te.name+="_instance_"+ye.uses[ve]++,Te}_invokeOne(ye){const ve=Object.values(this.plugins);ve.push(this);for(let Ne=0;Ne<ve.length;Ne++){const Te=ye(ve[Ne]);if(Te)return Te}return null}_invokeAll(ye){const ve=Object.values(this.plugins);ve.unshift(this);const Ne=[];for(let Te=0;Te<ve.length;Te++){const ke=ye(ve[Te]);ke&&Ne.push(ke)}return Ne}getDependency(ye,ve){const Ne=ye+":"+ve;let Te=this.cache.get(Ne);if(!Te){switch(ye){case"scene":Te=this.loadScene(ve);break;case"node":Te=this._invokeOne(function(ke){return ke.loadNode&&ke.loadNode(ve)});break;case"mesh":Te=this._invokeOne(function(ke){return ke.loadMesh&&ke.loadMesh(ve)});break;case"accessor":Te=this.loadAccessor(ve);break;case"bufferView":Te=this._invokeOne(function(ke){return ke.loadBufferView&&ke.loadBufferView(ve)});break;case"buffer":Te=this.loadBuffer(ve);break;case"material":Te=this._invokeOne(function(ke){return ke.loadMaterial&&ke.loadMaterial(ve)});break;case"texture":Te=this._invokeOne(function(ke){return ke.loadTexture&&ke.loadTexture(ve)});break;case"skin":Te=this.loadSkin(ve);break;case"animation":Te=this._invokeOne(function(ke){return ke.loadAnimation&&ke.loadAnimation(ve)});break;case"camera":Te=this.loadCamera(ve);break;default:if(Te=this._invokeOne(function(ke){return ke!=this&&ke.getDependency&&ke.getDependency(ye,ve)}),!Te)throw new Error("Unknown type: "+ye);break}this.cache.add(Ne,Te)}return Te}getDependencies(ye){let ve=this.cache.get(ye);if(!ve){const Ne=this,Te=this.json[ye+(ye==="mesh"?"es":"s")]||[];ve=Promise.all(Te.map(function(ke,Oe){return Ne.getDependency(ye,Oe)})),this.cache.add(ye,ve)}return ve}loadBuffer(ye){const ve=this.json.buffers[ye],Ne=this.fileLoader;if(ve.type&&ve.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+ve.type+" buffer type is not supported.");if(ve.uri===void 0&&ye===0)return Promise.resolve(this.extensions[m.KHR_BINARY_GLTF].body);const Te=this.options;return new Promise(function(ke,Oe){Ne.load(h.LoaderUtils.resolveURL(ve.uri,Te.path),ke,void 0,function(){Oe(new Error('THREE.GLTFLoader: Failed to load buffer "'+ve.uri+'".'))})})}loadBufferView(ye){const ve=this.json.bufferViews[ye];return this.getDependency("buffer",ve.buffer).then(function(Ne){const Te=ve.byteLength||0,ke=ve.byteOffset||0;return Ne.slice(ke,ke+Te)})}loadAccessor(ye){const ve=this,Ne=this.json,Te=this.json.accessors[ye];if(Te.bufferView===void 0&&Te.sparse===void 0){const Oe=wt[Te.type],U=Je[Te.componentType],$=Te.normalized===!0,re=new U(Te.count*Oe);return Promise.resolve(new h.BufferAttribute(re,Oe,$))}const ke=[];return Te.bufferView!==void 0?ke.push(this.getDependency("bufferView",Te.bufferView)):ke.push(null),Te.sparse!==void 0&&(ke.push(this.getDependency("bufferView",Te.sparse.indices.bufferView)),ke.push(this.getDependency("bufferView",Te.sparse.values.bufferView))),Promise.all(ke).then(function(Oe){const U=Oe[0],$=wt[Te.type],re=Je[Te.componentType],Re=re.BYTES_PER_ELEMENT,ce=Re*$,Ue=Te.byteOffset||0,je=Te.bufferView!==void 0?Ne.bufferViews[Te.bufferView].byteStride:void 0,pt=Te.normalized===!0;let Lt,xt;if(je&&je!==ce){const Gt=Math.floor(Ue/je),mi="InterleavedBuffer:"+Te.bufferView+":"+Te.componentType+":"+Gt+":"+Te.count;let _r=ve.cache.get(mi);_r||(Lt=new re(U,Gt*je,Te.count*je/Re),_r=new h.InterleavedBuffer(Lt,je/Re),ve.cache.add(mi,_r)),xt=new h.InterleavedBufferAttribute(_r,$,Ue%je/Re,pt)}else U===null?Lt=new re(Te.count*$):Lt=new re(U,Ue,Te.count*$),xt=new h.BufferAttribute(Lt,$,pt);if(Te.sparse!==void 0){const Gt=wt.SCALAR,mi=Je[Te.sparse.indices.componentType],_r=Te.sparse.indices.byteOffset||0,Fi=Te.sparse.values.byteOffset||0,gn=new mi(Oe[1],_r,Te.sparse.count*Gt),kr=new re(Oe[2],Fi,Te.sparse.count*$);U!==null&&(xt=new h.BufferAttribute(xt.array.slice(),xt.itemSize,xt.normalized));for(let nn=0,vs=gn.length;nn<vs;nn++){const An=gn[nn];if(xt.setX(An,kr[nn*$]),$>=2&&xt.setY(An,kr[nn*$+1]),$>=3&&xt.setZ(An,kr[nn*$+2]),$>=4&&xt.setW(An,kr[nn*$+3]),$>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return xt})}loadTexture(ye){const ve=this.json,Ne=this.options,Te=ve.textures[ye].source,ke=ve.images[Te];let Oe=this.textureLoader;if(ke.uri){const U=Ne.manager.getHandler(ke.uri);U!==null&&(Oe=U)}return this.loadTextureImage(ye,Te,Oe)}loadTextureImage(ye,ve,Ne){const Te=this,ke=this.json,Oe=ke.textures[ye],U=ke.images[ve],$=(U.uri||U.bufferView)+":"+Oe.sampler;if(this.textureCache[$])return this.textureCache[$];const re=this.loadImageSource(ve,Ne).then(function(Re){Re.flipY=!1,Re.name=Oe.name||U.name||"",Re.name===""&&typeof U.uri=="string"&&U.uri.startsWith("data:image/")===!1&&(Re.name=U.uri);const ce=(ke.samplers||{})[Oe.sampler]||{};return Re.magFilter=tt[ce.magFilter]||h.LinearFilter,Re.minFilter=tt[ce.minFilter]||h.LinearMipmapLinearFilter,Re.wrapS=dt[ce.wrapS]||h.RepeatWrapping,Re.wrapT=dt[ce.wrapT]||h.RepeatWrapping,Te.associations.set(Re,{textures:ye}),Re}).catch(function(){return null});return this.textureCache[$]=re,re}loadImageSource(ye,ve){const Ne=this,Te=this.json,ke=this.options;if(this.sourceCache[ye]!==void 0)return this.sourceCache[ye].then(ce=>ce.clone());const Oe=Te.images[ye],U=self.URL||self.webkitURL;let $=Oe.uri||"",re=!1;if(Oe.bufferView!==void 0)$=Ne.getDependency("bufferView",Oe.bufferView).then(function(ce){re=!0;const Ue=new Blob([ce],{type:Oe.mimeType});return $=U.createObjectURL(Ue),$});else if(Oe.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+ye+" is missing URI and bufferView");const Re=Promise.resolve($).then(function(ce){return new Promise(function(Ue,je){let pt=Ue;ve.isImageBitmapLoader===!0&&(pt=function(Lt){const xt=new h.Texture(Lt);xt.needsUpdate=!0,Ue(xt)}),ve.load(h.LoaderUtils.resolveURL(ce,ke.path),pt,void 0,je)})}).then(function(ce){return re===!0&&U.revokeObjectURL($),ce.userData.mimeType=Oe.mimeType||At(Oe.uri),ce}).catch(function(ce){throw console.error("THREE.GLTFLoader: Couldn't load texture",$),ce});return this.sourceCache[ye]=Re,Re}assignTexture(ye,ve,Ne,Te){const ke=this;return this.getDependency("texture",Ne.index).then(function(Oe){if(!Oe)return null;if(Ne.texCoord!==void 0&&Ne.texCoord>0&&(Oe=Oe.clone(),Oe.channel=Ne.texCoord),ke.extensions[m.KHR_TEXTURE_TRANSFORM]){const U=Ne.extensions!==void 0?Ne.extensions[m.KHR_TEXTURE_TRANSFORM]:void 0;if(U){const $=ke.associations.get(Oe);Oe=ke.extensions[m.KHR_TEXTURE_TRANSFORM].extendTexture(Oe,U),ke.associations.set(Oe,$)}}return Te!==void 0&&(Oe.colorSpace=Te),ye[ve]=Oe,Oe})}assignFinalMaterial(ye){const ve=ye.geometry;let Ne=ye.material;const Te=ve.attributes.tangent===void 0,ke=ve.attributes.color!==void 0,Oe=ve.attributes.normal===void 0;if(ye.isPoints){const U="PointsMaterial:"+Ne.uuid;let $=this.cache.get(U);$||($=new h.PointsMaterial,h.Material.prototype.copy.call($,Ne),$.color.copy(Ne.color),$.map=Ne.map,$.sizeAttenuation=!1,this.cache.add(U,$)),Ne=$}else if(ye.isLine){const U="LineBasicMaterial:"+Ne.uuid;let $=this.cache.get(U);$||($=new h.LineBasicMaterial,h.Material.prototype.copy.call($,Ne),$.color.copy(Ne.color),$.map=Ne.map,this.cache.add(U,$)),Ne=$}if(Te||ke||Oe){let U="ClonedMaterial:"+Ne.uuid+":";Te&&(U+="derivative-tangents:"),ke&&(U+="vertex-colors:"),Oe&&(U+="flat-shading:");let $=this.cache.get(U);$||($=Ne.clone(),ke&&($.vertexColors=!0),Oe&&($.flatShading=!0),Te&&($.normalScale&&($.normalScale.y*=-1),$.clearcoatNormalScale&&($.clearcoatNormalScale.y*=-1)),this.cache.add(U,$),this.associations.set($,this.associations.get(Ne))),Ne=$}ye.material=Ne}getMaterialType(){return h.MeshStandardMaterial}loadMaterial(ye){const ve=this,Ne=this.json,Te=this.extensions,ke=Ne.materials[ye];let Oe;const U={},$=ke.extensions||{},re=[];if($[m.KHR_MATERIALS_UNLIT]){const ce=Te[m.KHR_MATERIALS_UNLIT];Oe=ce.getMaterialType(),re.push(ce.extendParams(U,ke,ve))}else{const ce=ke.pbrMetallicRoughness||{};if(U.color=new h.Color(1,1,1),U.opacity=1,Array.isArray(ce.baseColorFactor)){const Ue=ce.baseColorFactor;U.color.setRGB(Ue[0],Ue[1],Ue[2],h.LinearSRGBColorSpace),U.opacity=Ue[3]}ce.baseColorTexture!==void 0&&re.push(ve.assignTexture(U,"map",ce.baseColorTexture,h.SRGBColorSpace)),U.metalness=ce.metallicFactor!==void 0?ce.metallicFactor:1,U.roughness=ce.roughnessFactor!==void 0?ce.roughnessFactor:1,ce.metallicRoughnessTexture!==void 0&&(re.push(ve.assignTexture(U,"metalnessMap",ce.metallicRoughnessTexture)),re.push(ve.assignTexture(U,"roughnessMap",ce.metallicRoughnessTexture))),Oe=this._invokeOne(function(Ue){return Ue.getMaterialType&&Ue.getMaterialType(ye)}),re.push(Promise.all(this._invokeAll(function(Ue){return Ue.extendMaterialParams&&Ue.extendMaterialParams(ye,U)})))}ke.doubleSided===!0&&(U.side=h.DoubleSide);const Re=ke.alphaMode||$e.OPAQUE;if(Re===$e.BLEND?(U.transparent=!0,U.depthWrite=!1):(U.transparent=!1,Re===$e.MASK&&(U.alphaTest=ke.alphaCutoff!==void 0?ke.alphaCutoff:.5)),ke.normalTexture!==void 0&&Oe!==h.MeshBasicMaterial&&(re.push(ve.assignTexture(U,"normalMap",ke.normalTexture)),U.normalScale=new h.Vector2(1,1),ke.normalTexture.scale!==void 0)){const ce=ke.normalTexture.scale;U.normalScale.set(ce,ce)}if(ke.occlusionTexture!==void 0&&Oe!==h.MeshBasicMaterial&&(re.push(ve.assignTexture(U,"aoMap",ke.occlusionTexture)),ke.occlusionTexture.strength!==void 0&&(U.aoMapIntensity=ke.occlusionTexture.strength)),ke.emissiveFactor!==void 0&&Oe!==h.MeshBasicMaterial){const ce=ke.emissiveFactor;U.emissive=new h.Color().setRGB(ce[0],ce[1],ce[2],h.LinearSRGBColorSpace)}return ke.emissiveTexture!==void 0&&Oe!==h.MeshBasicMaterial&&re.push(ve.assignTexture(U,"emissiveMap",ke.emissiveTexture,h.SRGBColorSpace)),Promise.all(re).then(function(){const ce=new Oe(U);return ke.name&&(ce.name=ke.name),Ri(ce,ke),ve.associations.set(ce,{materials:ye}),ke.extensions&&hi(Te,ce,ke),ce})}createUniqueName(ye){const ve=h.PropertyBinding.sanitizeNodeName(ye||"");return ve in this.nodeNamesUsed?ve+"_"+ ++this.nodeNamesUsed[ve]:(this.nodeNamesUsed[ve]=0,ve)}loadGeometries(ye){const ve=this,Ne=this.extensions,Te=this.primitiveCache;function ke(U){return Ne[m.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(U,ve).then(function($){return yi($,U,ve)})}const Oe=[];for(let U=0,$=ye.length;U<$;U++){const re=ye[U],Re=Vi(re),ce=Te[Re];if(ce)Oe.push(ce.promise);else{let Ue;re.extensions&&re.extensions[m.KHR_DRACO_MESH_COMPRESSION]?Ue=ke(re):Ue=yi(new h.BufferGeometry,re,ve),Te[Re]={primitive:re,promise:Ue},Oe.push(Ue)}}return Promise.all(Oe)}loadMesh(ye){const ve=this,Ne=this.json,Te=this.extensions,ke=Ne.meshes[ye],Oe=ke.primitives,U=[];for(let $=0,re=Oe.length;$<re;$++){const Re=Oe[$].material===void 0?Ui(this.cache):this.getDependency("material",Oe[$].material);U.push(Re)}return U.push(ve.loadGeometries(Oe)),Promise.all(U).then(function($){const re=$.slice(0,$.length-1),Re=$[$.length-1],ce=[];for(let je=0,pt=Re.length;je<pt;je++){const Lt=Re[je],xt=Oe[je];let Gt;const mi=re[je];if(xt.mode===Xe.TRIANGLES||xt.mode===Xe.TRIANGLE_STRIP||xt.mode===Xe.TRIANGLE_FAN||xt.mode===void 0)Gt=ke.isSkinnedMesh===!0?new h.SkinnedMesh(Lt,mi):new h.Mesh(Lt,mi),Gt.isSkinnedMesh===!0&&Gt.normalizeSkinWeights(),xt.mode===Xe.TRIANGLE_STRIP?Gt.geometry=(0,p.toTrianglesDrawMode)(Gt.geometry,h.TriangleStripDrawMode):xt.mode===Xe.TRIANGLE_FAN&&(Gt.geometry=(0,p.toTrianglesDrawMode)(Gt.geometry,h.TriangleFanDrawMode));else if(xt.mode===Xe.LINES)Gt=new h.LineSegments(Lt,mi);else if(xt.mode===Xe.LINE_STRIP)Gt=new h.Line(Lt,mi);else if(xt.mode===Xe.LINE_LOOP)Gt=new h.LineLoop(Lt,mi);else if(xt.mode===Xe.POINTS)Gt=new h.Points(Lt,mi);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+xt.mode);Object.keys(Gt.geometry.morphAttributes).length>0&&Zi(Gt,ke),Gt.name=ve.createUniqueName(ke.name||"mesh_"+ye),Ri(Gt,ke),xt.extensions&&hi(Te,Gt,xt),ve.assignFinalMaterial(Gt),ce.push(Gt)}for(let je=0,pt=ce.length;je<pt;je++)ve.associations.set(ce[je],{meshes:ye,primitives:je});if(ce.length===1)return ke.extensions&&hi(Te,ce[0],ke),ce[0];const Ue=new h.Group;ke.extensions&&hi(Te,Ue,ke),ve.associations.set(Ue,{meshes:ye});for(let je=0,pt=ce.length;je<pt;je++)Ue.add(ce[je]);return Ue})}loadCamera(ye){let ve;const Ne=this.json.cameras[ye],Te=Ne[Ne.type];if(!Te){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return Ne.type==="perspective"?ve=new h.PerspectiveCamera(h.MathUtils.radToDeg(Te.yfov),Te.aspectRatio||1,Te.znear||1,Te.zfar||2e6):Ne.type==="orthographic"&&(ve=new h.OrthographicCamera(-Te.xmag,Te.xmag,Te.ymag,-Te.ymag,Te.znear,Te.zfar)),Ne.name&&(ve.name=this.createUniqueName(Ne.name)),Ri(ve,Ne),Promise.resolve(ve)}loadSkin(ye){const ve=this.json.skins[ye],Ne=[];for(let Te=0,ke=ve.joints.length;Te<ke;Te++)Ne.push(this._loadNodeShallow(ve.joints[Te]));return ve.inverseBindMatrices!==void 0?Ne.push(this.getDependency("accessor",ve.inverseBindMatrices)):Ne.push(null),Promise.all(Ne).then(function(Te){const ke=Te.pop(),Oe=Te,U=[],$=[];for(let re=0,Re=Oe.length;re<Re;re++){const ce=Oe[re];if(ce){U.push(ce);const Ue=new h.Matrix4;ke!==null&&Ue.fromArray(ke.array,re*16),$.push(Ue)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',ve.joints[re])}return new h.Skeleton(U,$)})}loadAnimation(ye){const ve=this.json,Ne=this,Te=ve.animations[ye],ke=Te.name?Te.name:"animation_"+ye,Oe=[],U=[],$=[],re=[],Re=[];for(let ce=0,Ue=Te.channels.length;ce<Ue;ce++){const je=Te.channels[ce],pt=Te.samplers[je.sampler],Lt=je.target,xt=Lt.node,Gt=Te.parameters!==void 0?Te.parameters[pt.input]:pt.input,mi=Te.parameters!==void 0?Te.parameters[pt.output]:pt.output;Lt.node!==void 0&&(Oe.push(this.getDependency("node",xt)),U.push(this.getDependency("accessor",Gt)),$.push(this.getDependency("accessor",mi)),re.push(pt),Re.push(Lt))}return Promise.all([Promise.all(Oe),Promise.all(U),Promise.all($),Promise.all(re),Promise.all(Re)]).then(function(ce){const Ue=ce[0],je=ce[1],pt=ce[2],Lt=ce[3],xt=ce[4],Gt=[];for(let mi=0,_r=Ue.length;mi<_r;mi++){const Fi=Ue[mi],gn=je[mi],kr=pt[mi],nn=Lt[mi],vs=xt[mi];if(Fi===void 0)continue;Fi.updateMatrix&&Fi.updateMatrix();const An=Ne._createAnimationTracks(Fi,gn,kr,nn,vs);if(An)for(let Ns=0;Ns<An.length;Ns++)Gt.push(An[Ns])}return new h.AnimationClip(ke,void 0,Gt)})}createNodeMesh(ye){const ve=this.json,Ne=this,Te=ve.nodes[ye];return Te.mesh===void 0?null:Ne.getDependency("mesh",Te.mesh).then(function(ke){const Oe=Ne._getNodeRef(Ne.meshCache,Te.mesh,ke);return Te.weights!==void 0&&Oe.traverse(function(U){if(U.isMesh)for(let $=0,re=Te.weights.length;$<re;$++)U.morphTargetInfluences[$]=Te.weights[$]}),Oe})}loadNode(ye){const ve=this.json,Ne=this,Te=ve.nodes[ye],ke=Ne._loadNodeShallow(ye),Oe=[],U=Te.children||[];for(let re=0,Re=U.length;re<Re;re++)Oe.push(Ne.getDependency("node",U[re]));const $=Te.skin===void 0?Promise.resolve(null):Ne.getDependency("skin",Te.skin);return Promise.all([ke,Promise.all(Oe),$]).then(function(re){const Re=re[0],ce=re[1],Ue=re[2];Ue!==null&&Re.traverse(function(je){je.isSkinnedMesh&&je.bind(Ue,Pt)});for(let je=0,pt=ce.length;je<pt;je++)Re.add(ce[je]);return Re})}_loadNodeShallow(ye){const ve=this.json,Ne=this.extensions,Te=this;if(this.nodeCache[ye]!==void 0)return this.nodeCache[ye];const ke=ve.nodes[ye],Oe=ke.name?Te.createUniqueName(ke.name):"",U=[],$=Te._invokeOne(function(re){return re.createNodeMesh&&re.createNodeMesh(ye)});return $&&U.push($),ke.camera!==void 0&&U.push(Te.getDependency("camera",ke.camera).then(function(re){return Te._getNodeRef(Te.cameraCache,ke.camera,re)})),Te._invokeAll(function(re){return re.createNodeAttachment&&re.createNodeAttachment(ye)}).forEach(function(re){U.push(re)}),this.nodeCache[ye]=Promise.all(U).then(function(re){let Re;if(ke.isBone===!0?Re=new h.Bone:re.length>1?Re=new h.Group:re.length===1?Re=re[0]:Re=new h.Object3D,Re!==re[0])for(let ce=0,Ue=re.length;ce<Ue;ce++)Re.add(re[ce]);if(ke.name&&(Re.userData.name=ke.name,Re.name=Oe),Ri(Re,ke),ke.extensions&&hi(Ne,Re,ke),ke.matrix!==void 0){const ce=new h.Matrix4;ce.fromArray(ke.matrix),Re.applyMatrix4(ce)}else ke.translation!==void 0&&Re.position.fromArray(ke.translation),ke.rotation!==void 0&&Re.quaternion.fromArray(ke.rotation),ke.scale!==void 0&&Re.scale.fromArray(ke.scale);return Te.associations.has(Re)||Te.associations.set(Re,{}),Te.associations.get(Re).nodes=ye,Re}),this.nodeCache[ye]}loadScene(ye){const ve=this.extensions,Ne=this.json.scenes[ye],Te=this,ke=new h.Group;Ne.name&&(ke.name=Te.createUniqueName(Ne.name)),Ri(ke,Ne),Ne.extensions&&hi(ve,ke,Ne);const Oe=Ne.nodes||[],U=[];for(let $=0,re=Oe.length;$<re;$++)U.push(Te.getDependency("node",Oe[$]));return Promise.all(U).then(function($){for(let Re=0,ce=$.length;Re<ce;Re++)ke.add($[Re]);const re=Re=>{const ce=new Map;for(const[Ue,je]of Te.associations)(Ue instanceof h.Material||Ue instanceof h.Texture)&&ce.set(Ue,je);return Re.traverse(Ue=>{const je=Te.associations.get(Ue);je!=null&&ce.set(Ue,je)}),ce};return Te.associations=re(ke),ke})}_createAnimationTracks(ye,ve,Ne,Te,ke){const Oe=[],U=ye.name?ye.name:ye.uuid,$=[];yt[ke.path]===yt.weights?ye.traverse(function(Ue){Ue.morphTargetInfluences&&$.push(Ue.name?Ue.name:Ue.uuid)}):$.push(U);let re;switch(yt[ke.path]){case yt.weights:re=h.NumberKeyframeTrack;break;case yt.rotation:re=h.QuaternionKeyframeTrack;break;case yt.position:case yt.scale:re=h.VectorKeyframeTrack;break;default:switch(Ne.itemSize){case 1:re=h.NumberKeyframeTrack;break;case 2:case 3:default:re=h.VectorKeyframeTrack;break}break}const Re=Te.interpolation!==void 0?Ei[Te.interpolation]:h.InterpolateLinear,ce=this._getArrayFromAccessor(Ne);for(let Ue=0,je=$.length;Ue<je;Ue++){const pt=new re($[Ue]+"."+yt[ke.path],ve.array,ce,Re);Te.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(pt),Oe.push(pt)}return Oe}_getArrayFromAccessor(ye){let ve=ye.array;if(ye.normalized){const Ne=Ce(ve.constructor),Te=new Float32Array(ve.length);for(let ke=0,Oe=ve.length;ke<Oe;ke++)Te[ke]=ve[ke]*Ne;ve=Te}return ve}_createCubicSplineTrackInterpolant(ye){ye.createInterpolant=function(ve){const Ne=this instanceof h.QuaternionKeyframeTrack?Pe:_e;return new Ne(this.times,this.values,this.getValueSize()/3,ve)},ye.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Mt(vt,ye,ve){const Ne=ye.attributes,Te=new h.Box3;if(Ne.POSITION!==void 0){const U=ve.json.accessors[Ne.POSITION],$=U.min,re=U.max;if($!==void 0&&re!==void 0){if(Te.set(new h.Vector3($[0],$[1],$[2]),new h.Vector3(re[0],re[1],re[2])),U.normalized){const Re=Ce(Je[U.componentType]);Te.min.multiplyScalar(Re),Te.max.multiplyScalar(Re)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const ke=ye.targets;if(ke!==void 0){const U=new h.Vector3,$=new h.Vector3;for(let re=0,Re=ke.length;re<Re;re++){const ce=ke[re];if(ce.POSITION!==void 0){const Ue=ve.json.accessors[ce.POSITION],je=Ue.min,pt=Ue.max;if(je!==void 0&&pt!==void 0){if($.setX(Math.max(Math.abs(je[0]),Math.abs(pt[0]))),$.setY(Math.max(Math.abs(je[1]),Math.abs(pt[1]))),$.setZ(Math.max(Math.abs(je[2]),Math.abs(pt[2]))),Ue.normalized){const Lt=Ce(Je[Ue.componentType]);$.multiplyScalar(Lt)}U.max($)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}Te.expandByVector(U)}vt.boundingBox=Te;const Oe=new h.Sphere;Te.getCenter(Oe.center),Oe.radius=Te.min.distanceTo(Te.max)/2,vt.boundingSphere=Oe}function yi(vt,ye,ve){const Ne=ye.attributes,Te=[];function ke(Oe,U){return ve.getDependency("accessor",Oe).then(function($){vt.setAttribute(U,$)})}for(const Oe in Ne){const U=qt[Oe]||Oe.toLowerCase();U in vt.attributes||Te.push(ke(Ne[Oe],U))}if(ye.indices!==void 0&&!vt.index){const Oe=ve.getDependency("accessor",ye.indices).then(function(U){vt.setIndex(U)});Te.push(Oe)}return h.ColorManagement.workingColorSpace!==h.LinearSRGBColorSpace&&"COLOR_0"in Ne&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${h.ColorManagement.workingColorSpace}" not supported.`),Ri(vt,ye),Mt(vt,ye,ve),Promise.all(Te).then(function(){return ye.targets!==void 0?Si(vt,ye.targets,ve):vt})}},"./node_modules/three/examples/jsm/loaders/KTX2Loader.js":(l,u,c)=>{c.r(u),c.d(u,{KTX2Loader:()=>v});var h=c("./node_modules/three/build/three.module.js"),p=c("./node_modules/three/examples/jsm/utils/WorkerPool.js"),f=c("./node_modules/three/examples/jsm/libs/ktx-parse.module.js"),g=c("./node_modules/three/examples/jsm/libs/zstddec.module.js");const m=new WeakMap;let y=0,b;class v extends h.Loader{constructor(I){super(I),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new p.WorkerPool,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(I){return this.transcoderPath=I,this}setWorkerLimit(I){return this.workerPool.setWorkerLimit(I),this}async detectSupportAsync(I){return this.workerConfig={astcSupported:await I.hasFeatureAsync("texture-compression-astc"),etc1Supported:await I.hasFeatureAsync("texture-compression-etc1"),etc2Supported:await I.hasFeatureAsync("texture-compression-etc2"),dxtSupported:await I.hasFeatureAsync("texture-compression-bc"),bptcSupported:await I.hasFeatureAsync("texture-compression-bptc"),pvrtcSupported:await I.hasFeatureAsync("texture-compression-pvrtc")},this}detectSupport(I){return I.isWebGPURenderer===!0?this.workerConfig={astcSupported:I.hasFeature("texture-compression-astc"),etc1Supported:I.hasFeature("texture-compression-etc1"),etc2Supported:I.hasFeature("texture-compression-etc2"),dxtSupported:I.hasFeature("texture-compression-bc"),bptcSupported:I.hasFeature("texture-compression-bptc"),pvrtcSupported:I.hasFeature("texture-compression-pvrtc")}:this.workerConfig={astcSupported:I.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:I.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:I.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:I.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:I.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:I.extensions.has("WEBGL_compressed_texture_pvrtc")||I.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}init(){if(!this.transcoderPending){const I=new h.FileLoader(this.manager);I.setPath(this.transcoderPath),I.setWithCredentials(this.withCredentials);const D=I.loadAsync("basis_transcoder.js"),L=new h.FileLoader(this.manager);L.setPath(this.transcoderPath),L.setResponseType("arraybuffer"),L.setWithCredentials(this.withCredentials);const O=L.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([D,O]).then(([F,q])=>{const H=v.BasisWorker.toString(),G=["/* constants */","let _EngineFormat = "+JSON.stringify(v.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(v.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(v.BasisFormat),"/* basis_transcoder.js */",F,"/* worker */",H.substring(H.indexOf("{")+1,H.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([G])),this.transcoderBinary=q,this.workerPool.setWorkerCreator(()=>{const J=new Worker(this.workerSourceURL),Q=this.transcoderBinary.slice(0);return J.postMessage({type:"init",config:this.workerConfig,transcoderBinary:Q},[Q]),J})}),y>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),y++}return this.transcoderPending}load(I,D,L,O){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const F=new h.FileLoader(this.manager);F.setResponseType("arraybuffer"),F.setWithCredentials(this.withCredentials),F.load(I,q=>{if(m.has(q))return m.get(q).promise.then(D).catch(O);this._createTexture(q).then(H=>D?D(H):null).catch(O)},L,O)}_createTextureFrom(I,D){const{faces:L,width:O,height:F,format:q,type:H,error:G,dfdFlags:J}=I;if(H==="error")return Promise.reject(G);let Q;if(D.faceCount===6)Q=new h.CompressedCubeTexture(L,q,h.UnsignedByteType);else{const V=L[0].mipmaps;Q=D.layerCount>1?new h.CompressedArrayTexture(V,O,F,D.layerCount,q,h.UnsignedByteType):new h.CompressedTexture(V,O,F,q,h.UnsignedByteType)}return Q.minFilter=L[0].mipmaps.length===1?h.LinearFilter:h.LinearMipmapLinearFilter,Q.magFilter=h.LinearFilter,Q.generateMipmaps=!1,Q.needsUpdate=!0,Q.colorSpace=R(D),Q.premultiplyAlpha=!!(J&f.KHR_DF_FLAG_ALPHA_PREMULTIPLIED),Q}async _createTexture(I,D={}){const L=(0,f.read)(new Uint8Array(I));if(L.vkFormat!==f.VK_FORMAT_UNDEFINED)return T(L);const O=D,F=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:I,taskConfig:O},[I])).then(q=>this._createTextureFrom(q.data,L));return m.set(I,{promise:F}),F}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),y--,this}}v.BasisFormat={ETC1S:0,UASTC_4x4:1},v.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},v.EngineFormat={RGBAFormat:h.RGBAFormat,RGBA_ASTC_4x4_Format:h.RGBA_ASTC_4x4_Format,RGBA_BPTC_Format:h.RGBA_BPTC_Format,RGBA_ETC2_EAC_Format:h.RGBA_ETC2_EAC_Format,RGBA_PVRTC_4BPPV1_Format:h.RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT5_Format:h.RGBA_S3TC_DXT5_Format,RGB_ETC1_Format:h.RGB_ETC1_Format,RGB_ETC2_Format:h.RGB_ETC2_Format,RGB_PVRTC_4BPPV1_Format:h.RGB_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT1_Format:h.RGBA_S3TC_DXT1_Format},v.BasisWorker=function(){let B,I,D;const L=_EngineFormat,O=_TranscoderFormat,F=_BasisFormat;self.addEventListener("message",function(K){const ae=K.data;switch(ae.type){case"init":B=ae.config,q(ae.transcoderBinary);break;case"transcode":I.then(()=>{try{const{faces:Ae,buffers:_e,width:me,height:Pe,hasAlpha:Xe,format:Je,dfdFlags:tt}=H(ae.buffer);self.postMessage({type:"transcode",id:ae.id,faces:Ae,width:me,height:Pe,hasAlpha:Xe,format:Je,dfdFlags:tt},_e)}catch(Ae){console.error(Ae),self.postMessage({type:"error",id:ae.id,error:Ae.message})}});break}});function q(K){I=new Promise(ae=>{D={wasmBinary:K,onRuntimeInitialized:ae},BASIS(D)}).then(()=>{D.initializeBasis(),D.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function H(K){const ae=new D.KTX2File(new Uint8Array(K));function Ae(){ae.close(),ae.delete()}if(!ae.isValid())throw Ae(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");const _e=ae.isUASTC()?F.UASTC_4x4:F.ETC1S,me=ae.getWidth(),Pe=ae.getHeight(),Xe=ae.getLayers()||1,Je=ae.getLevels(),tt=ae.getFaces(),dt=ae.getHasAlpha(),wt=ae.getDFDFlags(),{transcoderFormat:qt,engineFormat:yt}=V(_e,me,Pe,dt);if(!me||!Pe||!Je)throw Ae(),new Error("THREE.KTX2Loader:	Invalid texture");if(!ae.startTranscoding())throw Ae(),new Error("THREE.KTX2Loader: .startTranscoding failed");const Ei=[],$e=[];for(let Ui=0;Ui<tt;Ui++){const hi=[];for(let Ri=0;Ri<Je;Ri++){const Si=[];let Zi,Vi;for(let Ce=0;Ce<Xe;Ce++){const At=ae.getImageLevelInfo(Ri,Ce,Ui);Ui===0&&Ri===0&&Ce===0&&(At.origWidth%4!==0||At.origHeight%4!==0)&&console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),Je>1?(Zi=At.origWidth,Vi=At.origHeight):(Zi=At.width,Vi=At.height);const Pt=new Uint8Array(ae.getImageTranscodedSizeInBytes(Ri,Ce,0,qt));if(!ae.transcodeImage(Pt,Ri,Ce,Ui,qt,0,-1,-1))throw Ae(),new Error("THREE.KTX2Loader: .transcodeImage failed.");Si.push(Pt)}const Ge=te(Si);hi.push({data:Ge,width:Zi,height:Vi}),$e.push(Ge.buffer)}Ei.push({mipmaps:hi,width:me,height:Pe,format:yt})}return Ae(),{faces:Ei,buffers:$e,width:me,height:Pe,hasAlpha:dt,format:yt,dfdFlags:wt}}const G=[{if:"astcSupported",basisFormat:[F.UASTC_4x4],transcoderFormat:[O.ASTC_4x4,O.ASTC_4x4],engineFormat:[L.RGBA_ASTC_4x4_Format,L.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[F.ETC1S,F.UASTC_4x4],transcoderFormat:[O.BC7_M5,O.BC7_M5],engineFormat:[L.RGBA_BPTC_Format,L.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[F.ETC1S,F.UASTC_4x4],transcoderFormat:[O.BC1,O.BC3],engineFormat:[L.RGBA_S3TC_DXT1_Format,L.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[F.ETC1S,F.UASTC_4x4],transcoderFormat:[O.ETC1,O.ETC2],engineFormat:[L.RGB_ETC2_Format,L.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[F.ETC1S,F.UASTC_4x4],transcoderFormat:[O.ETC1],engineFormat:[L.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[F.ETC1S,F.UASTC_4x4],transcoderFormat:[O.PVRTC1_4_RGB,O.PVRTC1_4_RGBA],engineFormat:[L.RGB_PVRTC_4BPPV1_Format,L.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],J=G.sort(function(K,ae){return K.priorityETC1S-ae.priorityETC1S}),Q=G.sort(function(K,ae){return K.priorityUASTC-ae.priorityUASTC});function V(K,ae,Ae,_e){let me,Pe;const Xe=K===F.ETC1S?J:Q;for(let Je=0;Je<Xe.length;Je++){const tt=Xe[Je];if(B[tt.if]&&tt.basisFormat.includes(K)&&!(_e&&tt.transcoderFormat.length<2)&&!(tt.needsPowerOfTwo&&!(z(ae)&&z(Ae))))return me=tt.transcoderFormat[_e?1:0],Pe=tt.engineFormat[_e?1:0],{transcoderFormat:me,engineFormat:Pe}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),me=O.RGBA32,Pe=L.RGBAFormat,{transcoderFormat:me,engineFormat:Pe}}function z(K){return K<=2?!0:(K&K-1)===0&&K!==0}function te(K){if(K.length===1)return K[0];let ae=0;for(let me=0;me<K.length;me++){const Pe=K[me];ae+=Pe.byteLength}const Ae=new Uint8Array(ae);let _e=0;for(let me=0;me<K.length;me++){const Pe=K[me];Ae.set(Pe,_e),_e+=Pe.byteLength}return Ae}};const _=new Set([h.RGBAFormat,h.RGFormat,h.RedFormat]),C={[f.VK_FORMAT_R32G32B32A32_SFLOAT]:h.RGBAFormat,[f.VK_FORMAT_R16G16B16A16_SFLOAT]:h.RGBAFormat,[f.VK_FORMAT_R8G8B8A8_UNORM]:h.RGBAFormat,[f.VK_FORMAT_R8G8B8A8_SRGB]:h.RGBAFormat,[f.VK_FORMAT_R32G32_SFLOAT]:h.RGFormat,[f.VK_FORMAT_R16G16_SFLOAT]:h.RGFormat,[f.VK_FORMAT_R8G8_UNORM]:h.RGFormat,[f.VK_FORMAT_R8G8_SRGB]:h.RGFormat,[f.VK_FORMAT_R32_SFLOAT]:h.RedFormat,[f.VK_FORMAT_R16_SFLOAT]:h.RedFormat,[f.VK_FORMAT_R8_SRGB]:h.RedFormat,[f.VK_FORMAT_R8_UNORM]:h.RedFormat,[f.VK_FORMAT_ASTC_6x6_SRGB_BLOCK]:h.RGBA_ASTC_6x6_Format,[f.VK_FORMAT_ASTC_6x6_UNORM_BLOCK]:h.RGBA_ASTC_6x6_Format},E={[f.VK_FORMAT_R32G32B32A32_SFLOAT]:h.FloatType,[f.VK_FORMAT_R16G16B16A16_SFLOAT]:h.HalfFloatType,[f.VK_FORMAT_R8G8B8A8_UNORM]:h.UnsignedByteType,[f.VK_FORMAT_R8G8B8A8_SRGB]:h.UnsignedByteType,[f.VK_FORMAT_R32G32_SFLOAT]:h.FloatType,[f.VK_FORMAT_R16G16_SFLOAT]:h.HalfFloatType,[f.VK_FORMAT_R8G8_UNORM]:h.UnsignedByteType,[f.VK_FORMAT_R8G8_SRGB]:h.UnsignedByteType,[f.VK_FORMAT_R32_SFLOAT]:h.FloatType,[f.VK_FORMAT_R16_SFLOAT]:h.HalfFloatType,[f.VK_FORMAT_R8_SRGB]:h.UnsignedByteType,[f.VK_FORMAT_R8_UNORM]:h.UnsignedByteType,[f.VK_FORMAT_ASTC_6x6_SRGB_BLOCK]:h.UnsignedByteType,[f.VK_FORMAT_ASTC_6x6_UNORM_BLOCK]:h.UnsignedByteType};async function T(B){const{vkFormat:I}=B;if(C[I]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let D;B.supercompressionScheme===f.KHR_SUPERCOMPRESSION_ZSTD&&(b||(b=new Promise(async F=>{const q=new g.ZSTDDecoder;await q.init(),F(q)})),D=await b);const L=[];for(let F=0;F<B.levels.length;F++){const q=Math.max(1,B.pixelWidth>>F),H=Math.max(1,B.pixelHeight>>F),G=B.pixelDepth?Math.max(1,B.pixelDepth>>F):0,J=B.levels[F];let Q;if(B.supercompressionScheme===f.KHR_SUPERCOMPRESSION_NONE)Q=J.levelData;else if(B.supercompressionScheme===f.KHR_SUPERCOMPRESSION_ZSTD)Q=D.decode(J.levelData,J.uncompressedByteLength);else throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");let V;E[I]===h.FloatType?V=new Float32Array(Q.buffer,Q.byteOffset,Q.byteLength/Float32Array.BYTES_PER_ELEMENT):E[I]===h.HalfFloatType?V=new Uint16Array(Q.buffer,Q.byteOffset,Q.byteLength/Uint16Array.BYTES_PER_ELEMENT):V=Q,L.push({data:V,width:q,height:H,depth:G})}let O;if(_.has(C[I]))O=B.pixelDepth===0?new h.DataTexture(L[0].data,B.pixelWidth,B.pixelHeight):new h.Data3DTexture(L[0].data,B.pixelWidth,B.pixelHeight,B.pixelDepth);else{if(B.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");O=new h.CompressedTexture(L,B.pixelWidth,B.pixelHeight)}return O.mipmaps=L,O.type=E[I],O.format=C[I],O.colorSpace=R(B),O.needsUpdate=!0,Promise.resolve(O)}function R(B){const I=B.dataFormatDescriptor[0];return I.colorPrimaries===f.KHR_DF_PRIMARIES_BT709?I.transferFunction===f.KHR_DF_TRANSFER_SRGB?h.SRGBColorSpace:h.LinearSRGBColorSpace:I.colorPrimaries===f.KHR_DF_PRIMARIES_DISPLAYP3?I.transferFunction===f.KHR_DF_TRANSFER_SRGB?h.DisplayP3ColorSpace:h.LinearDisplayP3ColorSpace:(I.colorPrimaries===f.KHR_DF_PRIMARIES_UNSPECIFIED||console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${I.colorPrimaries}"`),h.NoColorSpace)}},"./node_modules/three/examples/jsm/loaders/MTLLoader.js":(l,u,c)=>{c.r(u),c.d(u,{MTLLoader:()=>p});var h=c("./node_modules/three/build/three.module.js");class p extends h.Loader{constructor(m){super(m)}load(m,y,b,v){const _=this,C=this.path===""?h.LoaderUtils.extractUrlBase(m):this.path,E=new h.FileLoader(this.manager);E.setPath(this.path),E.setRequestHeader(this.requestHeader),E.setWithCredentials(this.withCredentials),E.load(m,function(T){try{y(_.parse(T,C))}catch(R){v?v(R):console.error(R),_.manager.itemError(m)}},b,v)}setMaterialOptions(m){return this.materialOptions=m,this}parse(m,y){const b=m.split(`
`);let v={};const _=/\s+/,C={};for(let T=0;T<b.length;T++){let R=b[T];if(R=R.trim(),R.length===0||R.charAt(0)==="#")continue;const B=R.indexOf(" ");let I=B>=0?R.substring(0,B):R;I=I.toLowerCase();let D=B>=0?R.substring(B+1):"";if(D=D.trim(),I==="newmtl")v={name:D},C[D]=v;else if(I==="ka"||I==="kd"||I==="ks"||I==="ke"){const L=D.split(_,3);v[I]=[parseFloat(L[0]),parseFloat(L[1]),parseFloat(L[2])]}else v[I]=D}const E=new f(this.resourcePath||y,this.materialOptions);return E.setCrossOrigin(this.crossOrigin),E.setManager(this.manager),E.setMaterials(C),E}}class f{constructor(m="",y={}){this.baseUrl=m,this.options=y,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:h.FrontSide,this.wrap=this.options.wrap!==void 0?this.options.wrap:h.RepeatWrapping}setCrossOrigin(m){return this.crossOrigin=m,this}setManager(m){this.manager=m}setMaterials(m){this.materialsInfo=this.convert(m),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(m){if(!this.options)return m;const y={};for(const b in m){const v=m[b],_={};y[b]=_;for(const C in v){let E=!0,T=v[C];const R=C.toLowerCase();switch(R){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(T=[T[0]/255,T[1]/255,T[2]/255]),this.options&&this.options.ignoreZeroRGBs&&T[0]===0&&T[1]===0&&T[2]===0&&(E=!1);break}E&&(_[R]=T)}}return y}preload(){for(const m in this.materialsInfo)this.create(m)}getIndex(m){return this.nameLookup[m]}getAsArray(){let m=0;for(const y in this.materialsInfo)this.materialsArray[m]=this.create(y),this.nameLookup[y]=m,m++;return this.materialsArray}create(m){return this.materials[m]===void 0&&this.createMaterial_(m),this.materials[m]}createMaterial_(m){const y=this,b=this.materialsInfo[m],v={name:m,side:this.side};function _(E,T){return typeof T!="string"||T===""?"":/^https?:\/\//i.test(T)?T:E+T}function C(E,T){if(v[E])return;const R=y.getTextureParams(T,v),B=y.loadTexture(_(y.baseUrl,R.url));B.repeat.copy(R.scale),B.offset.copy(R.offset),B.wrapS=y.wrap,B.wrapT=y.wrap,(E==="map"||E==="emissiveMap")&&(B.colorSpace=h.SRGBColorSpace),v[E]=B}for(const E in b){const T=b[E];let R;if(T!=="")switch(E.toLowerCase()){case"kd":v.color=new h.Color().fromArray(T).convertSRGBToLinear();break;case"ks":v.specular=new h.Color().fromArray(T).convertSRGBToLinear();break;case"ke":v.emissive=new h.Color().fromArray(T).convertSRGBToLinear();break;case"map_kd":C("map",T);break;case"map_ks":C("specularMap",T);break;case"map_ke":C("emissiveMap",T);break;case"norm":C("normalMap",T);break;case"map_bump":case"bump":C("bumpMap",T);break;case"map_d":C("alphaMap",T),v.transparent=!0;break;case"ns":v.shininess=parseFloat(T);break;case"d":R=parseFloat(T),R<1&&(v.opacity=R,v.transparent=!0);break;case"tr":R=parseFloat(T),this.options&&this.options.invertTrProperty&&(R=1-R),R>0&&(v.opacity=1-R,v.transparent=!0);break}}return this.materials[m]=new h.MeshPhongMaterial(v),this.materials[m]}getTextureParams(m,y){const b={scale:new h.Vector2(1,1),offset:new h.Vector2(0,0)},v=m.split(/\s+/);let _;return _=v.indexOf("-bm"),_>=0&&(y.bumpScale=parseFloat(v[_+1]),v.splice(_,2)),_=v.indexOf("-s"),_>=0&&(b.scale.set(parseFloat(v[_+1]),parseFloat(v[_+2])),v.splice(_,4)),_=v.indexOf("-o"),_>=0&&(b.offset.set(parseFloat(v[_+1]),parseFloat(v[_+2])),v.splice(_,4)),b.url=v.join(" ").trim(),b}loadTexture(m,y,b,v,_){const C=this.manager!==void 0?this.manager:h.DefaultLoadingManager;let E=C.getHandler(m);E===null&&(E=new h.TextureLoader(C)),E.setCrossOrigin&&E.setCrossOrigin(this.crossOrigin);const T=E.load(m,b,v,_);return y!==void 0&&(T.mapping=y),T}}},"./node_modules/three/examples/jsm/loaders/OBJLoader.js":(l,u,c)=>{c.r(u),c.d(u,{OBJLoader:()=>B});var h=c("./node_modules/three/build/three.module.js");const p=/^[og]\s*(.+)?/,f=/^mtllib /,g=/^usemtl /,m=/^usemap /,y=/\s+/,b=new h.Vector3,v=new h.Vector3,_=new h.Vector3,C=new h.Vector3,E=new h.Vector3,T=new h.Color;function R(){const I={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(D,L){if(this.object&&this.object.fromDeclaration===!1){this.object.name=D,this.object.fromDeclaration=L!==!1;return}const O=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:D||"",fromDeclaration:L!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(F,q){const H=this._finalize(!1);H&&(H.inherited||H.groupCount<=0)&&this.materials.splice(H.index,1);const G={index:this.materials.length,name:F||"",mtllib:Array.isArray(q)&&q.length>0?q[q.length-1]:"",smooth:H!==void 0?H.smooth:this.smooth,groupStart:H!==void 0?H.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(J){const Q={index:typeof J=="number"?J:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return Q.clone=this.clone.bind(Q),Q}};return this.materials.push(G),G},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(F){const q=this.currentMaterial();if(q&&q.groupEnd===-1&&(q.groupEnd=this.geometry.vertices.length/3,q.groupCount=q.groupEnd-q.groupStart,q.inherited=!1),F&&this.materials.length>1)for(let H=this.materials.length-1;H>=0;H--)this.materials[H].groupCount<=0&&this.materials.splice(H,1);return F&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),q}},O&&O.name&&typeof O.clone=="function"){const F=O.clone(0);F.inherited=!0,this.object.materials.push(F)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(D,L){const O=parseInt(D,10);return(O>=0?O-1:O+L/3)*3},parseNormalIndex:function(D,L){const O=parseInt(D,10);return(O>=0?O-1:O+L/3)*3},parseUVIndex:function(D,L){const O=parseInt(D,10);return(O>=0?O-1:O+L/2)*2},addVertex:function(D,L,O){const F=this.vertices,q=this.object.geometry.vertices;q.push(F[D+0],F[D+1],F[D+2]),q.push(F[L+0],F[L+1],F[L+2]),q.push(F[O+0],F[O+1],F[O+2])},addVertexPoint:function(D){const L=this.vertices;this.object.geometry.vertices.push(L[D+0],L[D+1],L[D+2])},addVertexLine:function(D){const L=this.vertices;this.object.geometry.vertices.push(L[D+0],L[D+1],L[D+2])},addNormal:function(D,L,O){const F=this.normals,q=this.object.geometry.normals;q.push(F[D+0],F[D+1],F[D+2]),q.push(F[L+0],F[L+1],F[L+2]),q.push(F[O+0],F[O+1],F[O+2])},addFaceNormal:function(D,L,O){const F=this.vertices,q=this.object.geometry.normals;b.fromArray(F,D),v.fromArray(F,L),_.fromArray(F,O),E.subVectors(_,v),C.subVectors(b,v),E.cross(C),E.normalize(),q.push(E.x,E.y,E.z),q.push(E.x,E.y,E.z),q.push(E.x,E.y,E.z)},addColor:function(D,L,O){const F=this.colors,q=this.object.geometry.colors;F[D]!==void 0&&q.push(F[D+0],F[D+1],F[D+2]),F[L]!==void 0&&q.push(F[L+0],F[L+1],F[L+2]),F[O]!==void 0&&q.push(F[O+0],F[O+1],F[O+2])},addUV:function(D,L,O){const F=this.uvs,q=this.object.geometry.uvs;q.push(F[D+0],F[D+1]),q.push(F[L+0],F[L+1]),q.push(F[O+0],F[O+1])},addDefaultUV:function(){const D=this.object.geometry.uvs;D.push(0,0),D.push(0,0),D.push(0,0)},addUVLine:function(D){const L=this.uvs;this.object.geometry.uvs.push(L[D+0],L[D+1])},addFace:function(D,L,O,F,q,H,G,J,Q){const V=this.vertices.length;let z=this.parseVertexIndex(D,V),te=this.parseVertexIndex(L,V),K=this.parseVertexIndex(O,V);if(this.addVertex(z,te,K),this.addColor(z,te,K),G!==void 0&&G!==""){const ae=this.normals.length;z=this.parseNormalIndex(G,ae),te=this.parseNormalIndex(J,ae),K=this.parseNormalIndex(Q,ae),this.addNormal(z,te,K)}else this.addFaceNormal(z,te,K);if(F!==void 0&&F!==""){const ae=this.uvs.length;z=this.parseUVIndex(F,ae),te=this.parseUVIndex(q,ae),K=this.parseUVIndex(H,ae),this.addUV(z,te,K),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(D){this.object.geometry.type="Points";const L=this.vertices.length;for(let O=0,F=D.length;O<F;O++){const q=this.parseVertexIndex(D[O],L);this.addVertexPoint(q),this.addColor(q)}},addLineGeometry:function(D,L){this.object.geometry.type="Line";const O=this.vertices.length,F=this.uvs.length;for(let q=0,H=D.length;q<H;q++)this.addVertexLine(this.parseVertexIndex(D[q],O));for(let q=0,H=L.length;q<H;q++)this.addUVLine(this.parseUVIndex(L[q],F))}};return I.startObject("",!1),I}class B extends h.Loader{constructor(D){super(D),this.materials=null}load(D,L,O,F){const q=this,H=new h.FileLoader(this.manager);H.setPath(this.path),H.setRequestHeader(this.requestHeader),H.setWithCredentials(this.withCredentials),H.load(D,function(G){try{L(q.parse(G))}catch(J){F?F(J):console.error(J),q.manager.itemError(D)}},O,F)}setMaterials(D){return this.materials=D,this}parse(D){const L=new R;D.indexOf(`\r
`)!==-1&&(D=D.replace(/\r\n/g,`
`)),D.indexOf(`\\
`)!==-1&&(D=D.replace(/\\\n/g,""));const O=D.split(`
`);let F=[];for(let H=0,G=O.length;H<G;H++){const J=O[H].trimStart();if(J.length===0)continue;const Q=J.charAt(0);if(Q!=="#")if(Q==="v"){const V=J.split(y);switch(V[0]){case"v":L.vertices.push(parseFloat(V[1]),parseFloat(V[2]),parseFloat(V[3])),V.length>=7?(T.setRGB(parseFloat(V[4]),parseFloat(V[5]),parseFloat(V[6])).convertSRGBToLinear(),L.colors.push(T.r,T.g,T.b)):L.colors.push(void 0,void 0,void 0);break;case"vn":L.normals.push(parseFloat(V[1]),parseFloat(V[2]),parseFloat(V[3]));break;case"vt":L.uvs.push(parseFloat(V[1]),parseFloat(V[2]));break}}else if(Q==="f"){const V=J.slice(1).trim().split(y),z=[];for(let K=0,ae=V.length;K<ae;K++){const Ae=V[K];if(Ae.length>0){const _e=Ae.split("/");z.push(_e)}}const te=z[0];for(let K=1,ae=z.length-1;K<ae;K++){const Ae=z[K],_e=z[K+1];L.addFace(te[0],Ae[0],_e[0],te[1],Ae[1],_e[1],te[2],Ae[2],_e[2])}}else if(Q==="l"){const V=J.substring(1).trim().split(" ");let z=[];const te=[];if(J.indexOf("/")===-1)z=V;else for(let K=0,ae=V.length;K<ae;K++){const Ae=V[K].split("/");Ae[0]!==""&&z.push(Ae[0]),Ae[1]!==""&&te.push(Ae[1])}L.addLineGeometry(z,te)}else if(Q==="p"){const V=J.slice(1).trim().split(" ");L.addPointGeometry(V)}else if((F=p.exec(J))!==null){const V=(" "+F[0].slice(1).trim()).slice(1);L.startObject(V)}else if(g.test(J))L.object.startMaterial(J.substring(7).trim(),L.materialLibraries);else if(f.test(J))L.materialLibraries.push(J.substring(7).trim());else if(m.test(J))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(Q==="s"){if(F=J.split(" "),F.length>1){const z=F[1].trim().toLowerCase();L.object.smooth=z!=="0"&&z!=="off"}else L.object.smooth=!0;const V=L.object.currentMaterial();V&&(V.smooth=L.object.smooth)}else{if(J==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+J+'"')}}L.finalize();const q=new h.Group;if(q.materialLibraries=[].concat(L.materialLibraries),!(L.objects.length===1&&L.objects[0].geometry.vertices.length===0))for(let H=0,G=L.objects.length;H<G;H++){const J=L.objects[H],Q=J.geometry,V=J.materials,z=Q.type==="Line",te=Q.type==="Points";let K=!1;if(Q.vertices.length===0)continue;const ae=new h.BufferGeometry;ae.setAttribute("position",new h.Float32BufferAttribute(Q.vertices,3)),Q.normals.length>0&&ae.setAttribute("normal",new h.Float32BufferAttribute(Q.normals,3)),Q.colors.length>0&&(K=!0,ae.setAttribute("color",new h.Float32BufferAttribute(Q.colors,3))),Q.hasUVIndices===!0&&ae.setAttribute("uv",new h.Float32BufferAttribute(Q.uvs,2));const Ae=[];for(let me=0,Pe=V.length;me<Pe;me++){const Xe=V[me],Je=Xe.name+"_"+Xe.smooth+"_"+K;let tt=L.materials[Je];if(this.materials!==null){if(tt=this.materials.create(Xe.name),z&&tt&&!(tt instanceof h.LineBasicMaterial)){const dt=new h.LineBasicMaterial;h.Material.prototype.copy.call(dt,tt),dt.color.copy(tt.color),tt=dt}else if(te&&tt&&!(tt instanceof h.PointsMaterial)){const dt=new h.PointsMaterial({size:10,sizeAttenuation:!1});h.Material.prototype.copy.call(dt,tt),dt.color.copy(tt.color),dt.map=tt.map,tt=dt}}tt===void 0&&(z?tt=new h.LineBasicMaterial:te?tt=new h.PointsMaterial({size:1,sizeAttenuation:!1}):tt=new h.MeshPhongMaterial,tt.name=Xe.name,tt.flatShading=!Xe.smooth,tt.vertexColors=K,L.materials[Je]=tt),Ae.push(tt)}let _e;if(Ae.length>1){for(let me=0,Pe=V.length;me<Pe;me++){const Xe=V[me];ae.addGroup(Xe.groupStart,Xe.groupCount,me)}z?_e=new h.LineSegments(ae,Ae):te?_e=new h.Points(ae,Ae):_e=new h.Mesh(ae,Ae)}else z?_e=new h.LineSegments(ae,Ae[0]):te?_e=new h.Points(ae,Ae[0]):_e=new h.Mesh(ae,Ae[0]);_e.name=J.name,q.add(_e)}else if(L.vertices.length>0){const H=new h.PointsMaterial({size:1,sizeAttenuation:!1}),G=new h.BufferGeometry;G.setAttribute("position",new h.Float32BufferAttribute(L.vertices,3)),L.colors.length>0&&L.colors[0]!==void 0&&(G.setAttribute("color",new h.Float32BufferAttribute(L.colors,3)),H.vertexColors=!0);const J=new h.Points(G,H);q.add(J)}return q}}},"./node_modules/three/examples/jsm/math/OBB.js":(l,u,c)=>{c.r(u),c.d(u,{OBB:()=>O});var h=c("./node_modules/three/build/three.module.js");const p={c:null,u:[new h.Vector3,new h.Vector3,new h.Vector3],e:[]},f={c:null,u:[new h.Vector3,new h.Vector3,new h.Vector3],e:[]},g=[[],[],[]],m=[[],[],[]],y=[],b=new h.Vector3,v=new h.Vector3,_=new h.Vector3,C=new h.Vector3,E=new h.Vector3,T=new h.Vector3,R=new h.Matrix3,B=new h.Box3,I=new h.Matrix4,D=new h.Matrix4,L=new h.Ray;class O{constructor(H=new h.Vector3,G=new h.Vector3,J=new h.Matrix3){this.center=H,this.halfSize=G,this.rotation=J}set(H,G,J){return this.center=H,this.halfSize=G,this.rotation=J,this}copy(H){return this.center.copy(H.center),this.halfSize.copy(H.halfSize),this.rotation.copy(H.rotation),this}clone(){return new this.constructor().copy(this)}getSize(H){return H.copy(this.halfSize).multiplyScalar(2)}clampPoint(H,G){const J=this.halfSize;C.subVectors(H,this.center),this.rotation.extractBasis(b,v,_),G.copy(this.center);const Q=h.MathUtils.clamp(C.dot(b),-J.x,J.x);G.add(b.multiplyScalar(Q));const V=h.MathUtils.clamp(C.dot(v),-J.y,J.y);G.add(v.multiplyScalar(V));const z=h.MathUtils.clamp(C.dot(_),-J.z,J.z);return G.add(_.multiplyScalar(z)),G}containsPoint(H){return C.subVectors(H,this.center),this.rotation.extractBasis(b,v,_),Math.abs(C.dot(b))<=this.halfSize.x&&Math.abs(C.dot(v))<=this.halfSize.y&&Math.abs(C.dot(_))<=this.halfSize.z}intersectsBox3(H){return this.intersectsOBB(F.fromBox3(H))}intersectsSphere(H){return this.clampPoint(H.center,T),T.distanceToSquared(H.center)<=H.radius*H.radius}intersectsOBB(H,G=Number.EPSILON){p.c=this.center,p.e[0]=this.halfSize.x,p.e[1]=this.halfSize.y,p.e[2]=this.halfSize.z,this.rotation.extractBasis(p.u[0],p.u[1],p.u[2]),f.c=H.center,f.e[0]=H.halfSize.x,f.e[1]=H.halfSize.y,f.e[2]=H.halfSize.z,H.rotation.extractBasis(f.u[0],f.u[1],f.u[2]);for(let V=0;V<3;V++)for(let z=0;z<3;z++)g[V][z]=p.u[V].dot(f.u[z]);C.subVectors(f.c,p.c),y[0]=C.dot(p.u[0]),y[1]=C.dot(p.u[1]),y[2]=C.dot(p.u[2]);for(let V=0;V<3;V++)for(let z=0;z<3;z++)m[V][z]=Math.abs(g[V][z])+G;let J,Q;for(let V=0;V<3;V++)if(J=p.e[V],Q=f.e[0]*m[V][0]+f.e[1]*m[V][1]+f.e[2]*m[V][2],Math.abs(y[V])>J+Q)return!1;for(let V=0;V<3;V++)if(J=p.e[0]*m[0][V]+p.e[1]*m[1][V]+p.e[2]*m[2][V],Q=f.e[V],Math.abs(y[0]*g[0][V]+y[1]*g[1][V]+y[2]*g[2][V])>J+Q)return!1;return J=p.e[1]*m[2][0]+p.e[2]*m[1][0],Q=f.e[1]*m[0][2]+f.e[2]*m[0][1],!(Math.abs(y[2]*g[1][0]-y[1]*g[2][0])>J+Q||(J=p.e[1]*m[2][1]+p.e[2]*m[1][1],Q=f.e[0]*m[0][2]+f.e[2]*m[0][0],Math.abs(y[2]*g[1][1]-y[1]*g[2][1])>J+Q)||(J=p.e[1]*m[2][2]+p.e[2]*m[1][2],Q=f.e[0]*m[0][1]+f.e[1]*m[0][0],Math.abs(y[2]*g[1][2]-y[1]*g[2][2])>J+Q)||(J=p.e[0]*m[2][0]+p.e[2]*m[0][0],Q=f.e[1]*m[1][2]+f.e[2]*m[1][1],Math.abs(y[0]*g[2][0]-y[2]*g[0][0])>J+Q)||(J=p.e[0]*m[2][1]+p.e[2]*m[0][1],Q=f.e[0]*m[1][2]+f.e[2]*m[1][0],Math.abs(y[0]*g[2][1]-y[2]*g[0][1])>J+Q)||(J=p.e[0]*m[2][2]+p.e[2]*m[0][2],Q=f.e[0]*m[1][1]+f.e[1]*m[1][0],Math.abs(y[0]*g[2][2]-y[2]*g[0][2])>J+Q)||(J=p.e[0]*m[1][0]+p.e[1]*m[0][0],Q=f.e[1]*m[2][2]+f.e[2]*m[2][1],Math.abs(y[1]*g[0][0]-y[0]*g[1][0])>J+Q)||(J=p.e[0]*m[1][1]+p.e[1]*m[0][1],Q=f.e[0]*m[2][2]+f.e[2]*m[2][0],Math.abs(y[1]*g[0][1]-y[0]*g[1][1])>J+Q)||(J=p.e[0]*m[1][2]+p.e[1]*m[0][2],Q=f.e[0]*m[2][1]+f.e[1]*m[2][0],Math.abs(y[1]*g[0][2]-y[0]*g[1][2])>J+Q))}intersectsPlane(H){this.rotation.extractBasis(b,v,_);const G=this.halfSize.x*Math.abs(H.normal.dot(b))+this.halfSize.y*Math.abs(H.normal.dot(v))+this.halfSize.z*Math.abs(H.normal.dot(_)),J=H.normal.dot(this.center)-H.constant;return Math.abs(J)<=G}intersectRay(H,G){return this.getSize(E),B.setFromCenterAndSize(C.set(0,0,0),E),I.setFromMatrix3(this.rotation),I.setPosition(this.center),D.copy(I).invert(),L.copy(H).applyMatrix4(D),L.intersectBox(B,G)?G.applyMatrix4(I):null}intersectsRay(H){return this.intersectRay(H,C)!==null}fromBox3(H){return H.getCenter(this.center),H.getSize(this.halfSize).multiplyScalar(.5),this.rotation.identity(),this}equals(H){return H.center.equals(this.center)&&H.halfSize.equals(this.halfSize)&&H.rotation.equals(this.rotation)}applyMatrix4(H){const G=H.elements;let J=C.set(G[0],G[1],G[2]).length();const Q=C.set(G[4],G[5],G[6]).length(),V=C.set(G[8],G[9],G[10]).length();H.determinant()<0&&(J=-J),R.setFromMatrix4(H);const z=1/J,te=1/Q,K=1/V;return R.elements[0]*=z,R.elements[1]*=z,R.elements[2]*=z,R.elements[3]*=te,R.elements[4]*=te,R.elements[5]*=te,R.elements[6]*=K,R.elements[7]*=K,R.elements[8]*=K,this.rotation.multiply(R),this.halfSize.x*=J,this.halfSize.y*=Q,this.halfSize.z*=V,C.setFromMatrixPosition(H),this.center.add(C),this}}const F=new O},"./node_modules/three/examples/jsm/utils/BufferGeometryUtils.js":(l,u,c)=>{c.r(u),c.d(u,{computeMikkTSpaceTangents:()=>p,computeMorphedAttributes:()=>T,deepCloneAttribute:()=>m,deinterleaveAttribute:()=>b,deinterleaveGeometry:()=>v,estimateBytesUsed:()=>_,interleaveAttributes:()=>y,mergeAttributes:()=>g,mergeGeometries:()=>f,mergeGroups:()=>R,mergeVertices:()=>C,toCreasedNormals:()=>B,toTrianglesDrawMode:()=>E});var h=c("./node_modules/three/build/three.module.js");function p(I,D,L=!0){if(!D||!D.isReady)throw new Error("BufferGeometryUtils: Initialized MikkTSpace library required.");if(!I.hasAttribute("position")||!I.hasAttribute("normal")||!I.hasAttribute("uv"))throw new Error('BufferGeometryUtils: Tangents require "position", "normal", and "uv" attributes.');function O(H){if(H.normalized||H.isInterleavedBufferAttribute){const G=new Float32Array(H.count*H.itemSize);for(let J=0,Q=0;J<H.count;J++)G[Q++]=H.getX(J),G[Q++]=H.getY(J),H.itemSize>2&&(G[Q++]=H.getZ(J));return G}return H.array instanceof Float32Array?H.array:new Float32Array(H.array)}const F=I.index?I.toNonIndexed():I,q=D.generateTangents(O(F.attributes.position),O(F.attributes.normal),O(F.attributes.uv));if(L)for(let H=3;H<q.length;H+=4)q[H]*=-1;return F.setAttribute("tangent",new h.BufferAttribute(q,4)),I!==F&&I.copy(F),I}function f(I,D=!1){const L=I[0].index!==null,O=new Set(Object.keys(I[0].attributes)),F=new Set(Object.keys(I[0].morphAttributes)),q={},H={},G=I[0].morphTargetsRelative,J=new h.BufferGeometry;let Q=0;for(let V=0;V<I.length;++V){const z=I[V];let te=0;if(L!==(z.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+V+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const K in z.attributes){if(!O.has(K))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+V+'. All geometries must have compatible attributes; make sure "'+K+'" attribute exists among all geometries, or in none of them.'),null;q[K]===void 0&&(q[K]=[]),q[K].push(z.attributes[K]),te++}if(te!==O.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+V+". Make sure all geometries have the same number of attributes."),null;if(G!==z.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+V+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const K in z.morphAttributes){if(!F.has(K))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+V+".  .morphAttributes must be consistent throughout all geometries."),null;H[K]===void 0&&(H[K]=[]),H[K].push(z.morphAttributes[K])}if(D){let K;if(L)K=z.index.count;else if(z.attributes.position!==void 0)K=z.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+V+". The geometry must have either an index or a position attribute"),null;J.addGroup(Q,K,V),Q+=K}}if(L){let V=0;const z=[];for(let te=0;te<I.length;++te){const K=I[te].index;for(let ae=0;ae<K.count;++ae)z.push(K.getX(ae)+V);V+=I[te].attributes.position.count}J.setIndex(z)}for(const V in q){const z=g(q[V]);if(!z)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+V+" attribute."),null;J.setAttribute(V,z)}for(const V in H){const z=H[V][0].length;if(z===0)break;J.morphAttributes=J.morphAttributes||{},J.morphAttributes[V]=[];for(let te=0;te<z;++te){const K=[];for(let Ae=0;Ae<H[V].length;++Ae)K.push(H[V][Ae][te]);const ae=g(K);if(!ae)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+V+" morphAttribute."),null;J.morphAttributes[V].push(ae)}}return J}function g(I){let D,L,O,F=-1,q=0;for(let Q=0;Q<I.length;++Q){const V=I[Q];if(D===void 0&&(D=V.array.constructor),D!==V.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(L===void 0&&(L=V.itemSize),L!==V.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(O===void 0&&(O=V.normalized),O!==V.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(F===-1&&(F=V.gpuType),F!==V.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;q+=V.count*L}const H=new D(q),G=new h.BufferAttribute(H,L,O);let J=0;for(let Q=0;Q<I.length;++Q){const V=I[Q];if(V.isInterleavedBufferAttribute){const z=J/L;for(let te=0,K=V.count;te<K;te++)for(let ae=0;ae<L;ae++){const Ae=V.getComponent(te,ae);G.setComponent(te+z,ae,Ae)}}else H.set(V.array,J);J+=V.count*L}return F!==void 0&&(G.gpuType=F),G}function m(I){return I.isInstancedInterleavedBufferAttribute||I.isInterleavedBufferAttribute?b(I):I.isInstancedBufferAttribute?new h.InstancedBufferAttribute().copy(I):new h.BufferAttribute().copy(I)}function y(I){let D,L=0,O=0;for(let Q=0,V=I.length;Q<V;++Q){const z=I[Q];if(D===void 0&&(D=z.array.constructor),D!==z.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;L+=z.array.length,O+=z.itemSize}const F=new h.InterleavedBuffer(new D(L),O);let q=0;const H=[],G=["getX","getY","getZ","getW"],J=["setX","setY","setZ","setW"];for(let Q=0,V=I.length;Q<V;Q++){const z=I[Q],te=z.itemSize,K=z.count,ae=new h.InterleavedBufferAttribute(F,te,q,z.normalized);H.push(ae),q+=te;for(let Ae=0;Ae<K;Ae++)for(let _e=0;_e<te;_e++)ae[J[_e]](Ae,z[G[_e]](Ae))}return H}function b(I){const D=I.data.array.constructor,L=I.count,O=I.itemSize,F=I.normalized,q=new D(L*O);let H;I.isInstancedInterleavedBufferAttribute?H=new h.InstancedBufferAttribute(q,O,F,I.meshPerAttribute):H=new h.BufferAttribute(q,O,F);for(let G=0;G<L;G++)H.setX(G,I.getX(G)),O>=2&&H.setY(G,I.getY(G)),O>=3&&H.setZ(G,I.getZ(G)),O>=4&&H.setW(G,I.getW(G));return H}function v(I){const D=I.attributes,L=I.morphTargets,O=new Map;for(const F in D){const q=D[F];q.isInterleavedBufferAttribute&&(O.has(q)||O.set(q,b(q)),D[F]=O.get(q))}for(const F in L){const q=L[F];q.isInterleavedBufferAttribute&&(O.has(q)||O.set(q,b(q)),L[F]=O.get(q))}}function _(I){let D=0;for(const O in I.attributes){const F=I.getAttribute(O);D+=F.count*F.itemSize*F.array.BYTES_PER_ELEMENT}const L=I.getIndex();return D+=L?L.count*L.itemSize*L.array.BYTES_PER_ELEMENT:0,D}function C(I,D=1e-4){D=Math.max(D,Number.EPSILON);const L={},O=I.getIndex(),F=I.getAttribute("position"),q=O?O.count:F.count;let H=0;const G=Object.keys(I.attributes),J={},Q={},V=[],z=["getX","getY","getZ","getW"],te=["setX","setY","setZ","setW"];for(let Pe=0,Xe=G.length;Pe<Xe;Pe++){const Je=G[Pe],tt=I.attributes[Je];J[Je]=new h.BufferAttribute(new tt.array.constructor(tt.count*tt.itemSize),tt.itemSize,tt.normalized);const dt=I.morphAttributes[Je];dt&&(Q[Je]=new h.BufferAttribute(new dt.array.constructor(dt.count*dt.itemSize),dt.itemSize,dt.normalized))}const K=D*.5,ae=Math.log10(1/D),Ae=Math.pow(10,ae),_e=K*Ae;for(let Pe=0;Pe<q;Pe++){const Xe=O?O.getX(Pe):Pe;let Je="";for(let tt=0,dt=G.length;tt<dt;tt++){const wt=G[tt],qt=I.getAttribute(wt),yt=qt.itemSize;for(let Ei=0;Ei<yt;Ei++)Je+=`${~~(qt[z[Ei]](Xe)*Ae+_e)},`}if(Je in L)V.push(L[Je]);else{for(let tt=0,dt=G.length;tt<dt;tt++){const wt=G[tt],qt=I.getAttribute(wt),yt=I.morphAttributes[wt],Ei=qt.itemSize,$e=J[wt],Ui=Q[wt];for(let hi=0;hi<Ei;hi++){const Ri=z[hi],Si=te[hi];if($e[Si](H,qt[Ri](Xe)),yt)for(let Zi=0,Vi=yt.length;Zi<Vi;Zi++)Ui[Zi][Si](H,yt[Zi][Ri](Xe))}}L[Je]=H,V.push(H),H++}}const me=I.clone();for(const Pe in I.attributes){const Xe=J[Pe];if(me.setAttribute(Pe,new h.BufferAttribute(Xe.array.slice(0,H*Xe.itemSize),Xe.itemSize,Xe.normalized)),Pe in Q)for(let Je=0;Je<Q[Pe].length;Je++){const tt=Q[Pe][Je];me.morphAttributes[Pe][Je]=new h.BufferAttribute(tt.array.slice(0,H*tt.itemSize),tt.itemSize,tt.normalized)}}return me.setIndex(V),me}function E(I,D){if(D===h.TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),I;if(D===h.TriangleFanDrawMode||D===h.TriangleStripDrawMode){let L=I.getIndex();if(L===null){const H=[],G=I.getAttribute("position");if(G!==void 0){for(let J=0;J<G.count;J++)H.push(J);I.setIndex(H),L=I.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),I}const O=L.count-2,F=[];if(D===h.TriangleFanDrawMode)for(let H=1;H<=O;H++)F.push(L.getX(0)),F.push(L.getX(H)),F.push(L.getX(H+1));else for(let H=0;H<O;H++)H%2===0?(F.push(L.getX(H)),F.push(L.getX(H+1)),F.push(L.getX(H+2))):(F.push(L.getX(H+2)),F.push(L.getX(H+1)),F.push(L.getX(H)));F.length/3!==O&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const q=I.clone();return q.setIndex(F),q.clearGroups(),q}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",D),I}function T(I){const D=new h.Vector3,L=new h.Vector3,O=new h.Vector3,F=new h.Vector3,q=new h.Vector3,H=new h.Vector3,G=new h.Vector3,J=new h.Vector3,Q=new h.Vector3;function V(Ce,At,Pt,$t,Mt,yi,vt,ye){D.fromBufferAttribute(At,Mt),L.fromBufferAttribute(At,yi),O.fromBufferAttribute(At,vt);const ve=Ce.morphTargetInfluences;if(Pt&&ve){G.set(0,0,0),J.set(0,0,0),Q.set(0,0,0);for(let Ne=0,Te=Pt.length;Ne<Te;Ne++){const ke=ve[Ne],Oe=Pt[Ne];ke!==0&&(F.fromBufferAttribute(Oe,Mt),q.fromBufferAttribute(Oe,yi),H.fromBufferAttribute(Oe,vt),$t?(G.addScaledVector(F,ke),J.addScaledVector(q,ke),Q.addScaledVector(H,ke)):(G.addScaledVector(F.sub(D),ke),J.addScaledVector(q.sub(L),ke),Q.addScaledVector(H.sub(O),ke)))}D.add(G),L.add(J),O.add(Q)}Ce.isSkinnedMesh&&(Ce.applyBoneTransform(Mt,D),Ce.applyBoneTransform(yi,L),Ce.applyBoneTransform(vt,O)),ye[Mt*3+0]=D.x,ye[Mt*3+1]=D.y,ye[Mt*3+2]=D.z,ye[yi*3+0]=L.x,ye[yi*3+1]=L.y,ye[yi*3+2]=L.z,ye[vt*3+0]=O.x,ye[vt*3+1]=O.y,ye[vt*3+2]=O.z}const z=I.geometry,te=I.material;let K,ae,Ae;const _e=z.index,me=z.attributes.position,Pe=z.morphAttributes.position,Xe=z.morphTargetsRelative,Je=z.attributes.normal,tt=z.morphAttributes.position,dt=z.groups,wt=z.drawRange;let qt,yt,Ei,$e,Ui,hi,Ri;const Si=new Float32Array(me.count*me.itemSize),Zi=new Float32Array(Je.count*Je.itemSize);if(_e!==null)if(Array.isArray(te))for(qt=0,Ei=dt.length;qt<Ei;qt++)for(Ui=dt[qt],hi=Math.max(Ui.start,wt.start),Ri=Math.min(Ui.start+Ui.count,wt.start+wt.count),yt=hi,$e=Ri;yt<$e;yt+=3)K=_e.getX(yt),ae=_e.getX(yt+1),Ae=_e.getX(yt+2),V(I,me,Pe,Xe,K,ae,Ae,Si),V(I,Je,tt,Xe,K,ae,Ae,Zi);else for(hi=Math.max(0,wt.start),Ri=Math.min(_e.count,wt.start+wt.count),qt=hi,Ei=Ri;qt<Ei;qt+=3)K=_e.getX(qt),ae=_e.getX(qt+1),Ae=_e.getX(qt+2),V(I,me,Pe,Xe,K,ae,Ae,Si),V(I,Je,tt,Xe,K,ae,Ae,Zi);else if(Array.isArray(te))for(qt=0,Ei=dt.length;qt<Ei;qt++)for(Ui=dt[qt],hi=Math.max(Ui.start,wt.start),Ri=Math.min(Ui.start+Ui.count,wt.start+wt.count),yt=hi,$e=Ri;yt<$e;yt+=3)K=yt,ae=yt+1,Ae=yt+2,V(I,me,Pe,Xe,K,ae,Ae,Si),V(I,Je,tt,Xe,K,ae,Ae,Zi);else for(hi=Math.max(0,wt.start),Ri=Math.min(me.count,wt.start+wt.count),qt=hi,Ei=Ri;qt<Ei;qt+=3)K=qt,ae=qt+1,Ae=qt+2,V(I,me,Pe,Xe,K,ae,Ae,Si),V(I,Je,tt,Xe,K,ae,Ae,Zi);const Vi=new h.Float32BufferAttribute(Si,3),Ge=new h.Float32BufferAttribute(Zi,3);return{positionAttribute:me,normalAttribute:Je,morphedPositionAttribute:Vi,morphedNormalAttribute:Ge}}function R(I){if(I.groups.length===0)return console.warn("THREE.BufferGeometryUtils.mergeGroups(): No groups are defined. Nothing to merge."),I;let D=I.groups;if(D=D.sort((H,G)=>H.materialIndex!==G.materialIndex?H.materialIndex-G.materialIndex:H.start-G.start),I.getIndex()===null){const H=I.getAttribute("position"),G=[];for(let J=0;J<H.count;J+=3)G.push(J,J+1,J+2);I.setIndex(G)}const L=I.getIndex(),O=[];for(let H=0;H<D.length;H++){const G=D[H],J=G.start,Q=J+G.count;for(let V=J;V<Q;V++)O.push(L.getX(V))}I.dispose(),I.setIndex(O);let F=0;for(let H=0;H<D.length;H++){const G=D[H];G.start=F,F+=G.count}let q=D[0];I.groups=[q];for(let H=1;H<D.length;H++){const G=D[H];q.materialIndex===G.materialIndex?q.count+=G.count:(q=G,I.groups.push(q))}return I}function B(I,D=Math.PI/3){const L=Math.cos(D),O=(1+1e-10)*100,F=[new h.Vector3,new h.Vector3,new h.Vector3],q=new h.Vector3,H=new h.Vector3,G=new h.Vector3,J=new h.Vector3;function Q(Ae){const _e=~~(Ae.x*O),me=~~(Ae.y*O),Pe=~~(Ae.z*O);return`${_e},${me},${Pe}`}const V=I.index?I.toNonIndexed():I,z=V.attributes.position,te={};for(let Ae=0,_e=z.count/3;Ae<_e;Ae++){const me=3*Ae,Pe=F[0].fromBufferAttribute(z,me+0),Xe=F[1].fromBufferAttribute(z,me+1),Je=F[2].fromBufferAttribute(z,me+2);q.subVectors(Je,Xe),H.subVectors(Pe,Xe);const tt=new h.Vector3().crossVectors(q,H).normalize();for(let dt=0;dt<3;dt++){const wt=F[dt],qt=Q(wt);qt in te||(te[qt]=[]),te[qt].push(tt)}}const K=new Float32Array(z.count*3),ae=new h.BufferAttribute(K,3,!1);for(let Ae=0,_e=z.count/3;Ae<_e;Ae++){const me=3*Ae,Pe=F[0].fromBufferAttribute(z,me+0),Xe=F[1].fromBufferAttribute(z,me+1),Je=F[2].fromBufferAttribute(z,me+2);q.subVectors(Je,Xe),H.subVectors(Pe,Xe),G.crossVectors(q,H).normalize();for(let tt=0;tt<3;tt++){const dt=F[tt],wt=Q(dt),qt=te[wt];J.set(0,0,0);for(let yt=0,Ei=qt.length;yt<Ei;yt++){const $e=qt[yt];G.dot($e)>L&&J.add($e)}J.normalize(),ae.setXYZ(me+tt,J.x,J.y,J.z)}}return V.setAttribute("normal",ae),V}},"./node_modules/three/examples/jsm/utils/WorkerPool.js":(l,u,c)=>{c.r(u),c.d(u,{WorkerPool:()=>h});class h{constructor(f=4){this.pool=f,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(f){if(!this.workers[f]){const g=this.workerCreator();g.addEventListener("message",this._onMessage.bind(this,f)),this.workers[f]=g}}_getIdleWorker(){for(let f=0;f<this.pool;f++)if(!(this.workerStatus&1<<f))return f;return-1}_onMessage(f,g){const m=this.workersResolve[f];if(m&&m(g),this.queue.length){const{resolve:y,msg:b,transfer:v}=this.queue.shift();this.workersResolve[f]=y,this.workers[f].postMessage(b,v)}else this.workerStatus^=1<<f}setWorkerCreator(f){this.workerCreator=f}setWorkerLimit(f){this.pool=f}postMessage(f,g){return new Promise(m=>{const y=this._getIdleWorker();y!==-1?(this._initWorker(y),this.workerStatus|=1<<y,this.workersResolve[y]=m,this.workers[y].postMessage(f,g)):this.queue.push({resolve:m,msg:f,transfer:g})})}dispose(){this.workers.forEach(f=>f.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}},"./src/lib/three.mjs":(l,u,c)=>{c.r(u),c.d(u,{default:()=>E});var h=c("./node_modules/three/build/three.module.js"),p=c("./node_modules/three/examples/jsm/loaders/DRACOLoader.js"),f=c("./node_modules/three/examples/jsm/loaders/GLTFLoader.js"),g=c("./node_modules/three/examples/jsm/loaders/KTX2Loader.js"),m=c("./node_modules/three/examples/jsm/math/OBB.js"),y=c("./node_modules/three/examples/jsm/loaders/OBJLoader.js"),b=c("./node_modules/three/examples/jsm/loaders/MTLLoader.js"),v=c("./node_modules/three/examples/jsm/utils/BufferGeometryUtils.js"),_=c("./node_modules/three/examples/jsm/lights/LightProbeGenerator.js"),C={...h};C.DRACOLoader=p.DRACOLoader,C.GLTFLoader=f.GLTFLoader,C.KTX2Loader=g.KTX2Loader,C.OBJLoader=y.OBJLoader,C.MTLLoader=b.MTLLoader,C.OBB=m.OBB,C.BufferGeometryUtils=v,C.LightProbeGenerator=_.LightProbeGenerator;const E=C},"./package.json":l=>{l.exports=JSON.parse('{"name":"aframe","version":"1.6.0","description":"A web framework for building virtual reality experiences.","homepage":"https://aframe.io/","main":"dist/aframe-master.js","scripts":{"dev":"cross-env INSPECTOR_VERSION=dev webpack serve --port 8080","dist":"node scripts/updateVersionLog.js && npm run dist:min && npm run dist:max","dist:max":"webpack --config webpack.config.js","dist:min":"webpack --config webpack.prod.config.js","docs":"markserv --dir docs --port 9001","preghpages":"node ./scripts/preghpages.js","ghpages":"ghpages -p gh-pages/","lint":"standardx -v | snazzy","lint:fix":"standardx --fix","precommit":"npm run lint","prepush":"node scripts/testOnlyCheck.js","prerelease":"node scripts/release.js 1.5.0 1.6.0","start":"npm run dev","start:https":"npm run dev -- --server-type https","test":"karma start ./tests/karma.conf.js","test:docs":"node scripts/docsLint.js","test:firefox":"npm test -- --browsers Firefox","test:chrome":"npm test -- --browsers Chrome","test:nobrowser":"NO_BROWSER=true npm test","test:node":"node --experimental-require-module ./node_modules/mocha/bin/mocha --ui tdd tests/node"},"repository":"aframevr/aframe","license":"MIT","files":["dist/*","docs/**/*","src/**/*","vendor/**/*"],"dependencies":{"buffer":"^6.0.3","debug":"^4.3.4","deep-assign":"^2.0.0","load-bmfont":"^1.2.3","super-animejs":"^3.1.0","three":"npm:super-three@0.164.0","three-bmfont-text":"dmarcos/three-bmfont-text#eed4878795be9b3e38cf6aec6b903f56acd1f695","webvr-polyfill":"^0.10.12"},"devDependencies":{"@babel/core":"^7.17.10","babel-loader":"^8.2.5","babel-plugin-istanbul":"^6.1.1","chai":"^4.3.6","chai-shallow-deep-equal":"^1.4.0","chalk":"^1.1.3","cross-env":"^7.0.3","css-loader":"^6.7.1","eslint":"^8.45.0","eslint-config-semistandard":"^17.0.0","eslint-config-standard-jsx":"^11.0.0","ghpages":"0.0.8","git-rev":"^0.2.1","glob":"^8.0.3","husky":"^0.11.7","jsdom":"^24.0.0","jsdom-global":"^3.0.2","karma":"^6.4.0","karma-chai-shallow-deep-equal":"0.0.4","karma-chrome-launcher":"^3.1.1","karma-coverage":"^2.2.0","karma-env-preprocessor":"^0.1.1","karma-firefox-launcher":"^2.1.2","karma-mocha":"^2.0.1","karma-mocha-reporter":"^2.2.5","karma-sinon-chai":"^2.0.2","karma-webpack":"^5.0.0","markserv":"github:sukima/markserv#feature/fix-broken-websoketio-link","mocha":"^10.0.0","replace-in-file":"^2.5.3","shelljs":"^0.7.7","shx":"^0.2.2","sinon":"<12.0.0","sinon-chai":"^3.7.0","snazzy":"^5.0.0","standardx":"^7.0.0","style-loader":"^3.3.1","too-wordy":"ngokevin/too-wordy","webpack":"^5.73.0","webpack-cli":"^4.10.0","webpack-dev-server":"^4.11.0","webpack-merge":"^5.8.0","write-good":"^1.0.8"},"link":true,"standardx":{"ignore":["build/**","dist/**","examples/**/shaders/*.js","**/vendor/**"]},"keywords":["3d","aframe","cardboard","components","oculus","three","three.js","rift","vive","vr","quest","meta","web-components","webvr","webxr"],"engines":{"node":">= 4.6.0","npm":">= 2.15.9"}}')}},n={};function s(l){var u=n[l];if(u!==void 0)return u.exports;var c=n[l]={id:l,exports:{}};return i[l].call(c.exports,c,c.exports,s),c.exports}s.m=i,s.n=l=>{var u=l&&l.__esModule?()=>l.default:()=>l;return s.d(u,{a:u}),u},s.d=(l,u)=>{for(var c in u)s.o(u,c)&&!s.o(l,c)&&Object.defineProperty(l,c,{enumerable:!0,get:u[c]})},s.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),s.o=(l,u)=>Object.prototype.hasOwnProperty.call(l,u),s.r=l=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(l,"__esModule",{value:!0})},s.b=document.baseURI||self.location.href,s.nc=void 0;var o=s("./src/index.js");return o})())})(Lq);const zD=.1;AFRAME.registerComponent("checkpoint-controls",{schema:{enabled:{default:!0},mode:{default:"teleport",oneOf:["teleport","animate"]},animateSpeed:{default:3}},init:function(){this.active=!0,this.checkpoint=null,this.isNavMeshConstrained=!1,this.offset=new THREE.Vector3,this.position=new THREE.Vector3,this.targetPosition=new THREE.Vector3},play:function(){this.active=!0},pause:function(){this.active=!1},setCheckpoint:function(r){const e=this.el;if(this.active&&this.checkpoint!==r){if(this.checkpoint&&e.emit("navigation-end",{checkpoint:this.checkpoint}),this.checkpoint=r,this.sync(),this.position.distanceTo(this.targetPosition)<zD){this.checkpoint=null;return}e.emit("navigation-start",{checkpoint:r}),this.data.mode==="teleport"&&(this.el.setAttribute("position",this.targetPosition),this.checkpoint=null,e.emit("navigation-end",{checkpoint:r}),e.components["movement-controls"].updateNavLocation())}},isVelocityActive:function(){return!!(this.active&&this.checkpoint)},getVelocity:function(){if(!this.active)return;const r=this.data,e=this.offset,i=this.position,n=this.targetPosition,s=this.checkpoint;return this.sync(),i.distanceTo(n)<zD?(this.checkpoint=null,this.el.emit("navigation-end",{checkpoint:s}),e.set(0,0,0)):(e.setLength(r.animateSpeed),e)},sync:function(){const r=this.offset,e=this.position,i=this.targetPosition;e.copy(this.el.getAttribute("position")),this.checkpoint.object3D.getWorldPosition(i),i.add(this.checkpoint.components.checkpoint.getOffset()),r.copy(i).sub(e)}});var Dq=Object.assign(function(){},{FACE_1:0,FACE_2:1,FACE_3:2,FACE_4:3,L_SHOULDER_1:4,R_SHOULDER_1:5,L_SHOULDER_2:6,R_SHOULDER_2:7,SELECT:8,START:9,DPAD_UP:12,DPAD_DOWN:13,DPAD_LEFT:14,DPAD_RIGHT:15,VENDOR:16});function Oq(r,e,i){this.type=r,this.index=e,this.pressed=i.pressed,this.value=i.value}var Pq=Oq;const Hf=Dq,F2=Pq,Ph=.2,fu={LEFT:"left",RIGHT:"right"},mu={MOVEMENT:1,ROTATION:2};AFRAME.registerComponent("gamepad-controls",{GamepadButton:Hf,schema:{enabled:{default:!0},rotationSensitivity:{default:2}},init:function(){const r=this.el.sceneEl;this.system=r.systems["tracked-controls-webxr"]||{controllers:[]},this.prevTime=window.performance.now(),this.buttons={};const e=this.el.object3D.rotation;this.pitch=new THREE.Object3D,this.pitch.rotation.x=e.x,this.yaw=new THREE.Object3D,this.yaw.position.y=10,this.yaw.rotation.y=e.y,this.yaw.add(this.pitch),this._lookVector=new THREE.Vector2,this._moveVector=new THREE.Vector2,this._dpadVector=new THREE.Vector2,r.addBehavior(this)},update:function(){this.tick()},tick:function(r,e){this.updateButtonState(),this.updateRotation(e)},remove:function(){},isVelocityActive:function(){if(!this.data.enabled||!this.isConnected())return!1;const r=this._dpadVector,e=this._moveVector;this.getDpad(r),this.getJoystick(mu.MOVEMENT,e);const i=r.x||e.x,n=r.y||e.y;return Math.abs(i)>Ph||Math.abs(n)>Ph},getVelocityDelta:function(){const r=this._dpadVector,e=this._moveVector;this.getDpad(r),this.getJoystick(mu.MOVEMENT,e);const i=r.x||e.x,n=r.y||e.y,s=new THREE.Vector3;return Math.abs(i)>Ph&&(s.x+=i),Math.abs(n)>Ph&&(s.z+=n),s},isRotationActive:function(){if(!this.data.enabled||!this.isConnected())return!1;const r=this._lookVector;return this.getJoystick(mu.ROTATION,r),Math.abs(r.x)>Ph||Math.abs(r.y)>Ph},updateRotation:function(r){if(!this.isRotationActive())return;const e=this.data,i=this.yaw,n=this.pitch;i.rotation.y=this.el.object3D.rotation.y,n.rotation.x=this.el.object3D.rotation.x;const s=this._lookVector;this.getJoystick(mu.ROTATION,s),Math.abs(s.x)<=Ph&&(s.x=0),Math.abs(s.y)<=Ph&&(s.y=0),s.multiplyScalar(e.rotationSensitivity*r/1e3),i.rotation.y-=s.x,n.rotation.x-=s.y,n.rotation.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,n.rotation.x)),this.el.object3D.rotation.set(n.rotation.x,i.rotation.y,0)},updateButtonState:function(){const r=this.getGamepad(fu.RIGHT);if(this.data.enabled&&r)for(var e=0;e<r.buttons.length;e++)r.buttons[e].pressed&&!this.buttons[e]?this.emit(new F2("gamepadbuttondown",e,r.buttons[e])):!r.buttons[e].pressed&&this.buttons[e]&&this.emit(new F2("gamepadbuttonup",e,r.buttons[e])),this.buttons[e]=r.buttons[e].pressed;else for(const i in this.buttons)this.buttons[i]=!1},emit:function(r){this.el.emit(r.type,r),this.el.emit(r.type+":"+r.index,new F2(r.type,r.index,r))},getGamepad:function(){const r=[],e=[];return function(i){const n=this.el.sceneEl.components["proxy-controls"],s=n&&n.isConnected()&&n.getGamepad(0);if(s)return s;r.length=0;for(let l=0;l<this.system.controllers.length;l++){const u=this.system.controllers[l],c=u?u.gamepad:null;if(r.push(c),c&&u.handedness===i)return c}const o=navigator.getGamepads?navigator.getGamepads():e;for(let l=0;l<o.length;l++){const u=o[l];if(u&&u.hand===i)return u}return r[0]||o[0]}}(),getButton:function(r){return this.getGamepad(fu.RIGHT).buttons[r]},getAxis:function(r){return this.getGamepad(r>1?fu.RIGHT:fu.LEFT).axes[r]},getJoystick:function(r,e){const i=this.getGamepad(r===mu.MOVEMENT?fu.LEFT:fu.RIGHT);if(!i)return e.set(0,0);if(i.mapping==="xr-standard")switch(r){case mu.MOVEMENT:return e.set(i.axes[2],i.axes[3]);case mu.ROTATION:return e.set(i.axes[2],0)}else switch(r){case mu.MOVEMENT:return e.set(i.axes[0],i.axes[1]);case mu.ROTATION:return e.set(i.axes[2],i.axes[3])}throw new Error('Unexpected joystick index "%d".',r)},getDpad:function(r){const e=this.getGamepad(fu.LEFT);return!e||!e.buttons[Hf.DPAD_RIGHT]?r.set(0,0):r.set((e.buttons[Hf.DPAD_RIGHT].pressed?1:0)+(e.buttons[Hf.DPAD_LEFT].pressed?-1:0),(e.buttons[Hf.DPAD_UP].pressed?-1:0)+(e.buttons[Hf.DPAD_DOWN].pressed?1:0))},isConnected:function(){const r=this.getGamepad(fu.LEFT);return!!(r&&r.connected)},getID:function(){return this.getGamepad(fu.LEFT).id}}),function(r){var e="KeyboardEvent"in r;e||(r.KeyboardEvent=function(){throw TypeError("Illegal constructor")}),"DOM_KEY_LOCATION_STANDARD"in r.KeyboardEvent||(r.KeyboardEvent.DOM_KEY_LOCATION_STANDARD=0),"DOM_KEY_LOCATION_LEFT"in r.KeyboardEvent||(r.KeyboardEvent.DOM_KEY_LOCATION_LEFT=1),"DOM_KEY_LOCATION_RIGHT"in r.KeyboardEvent||(r.KeyboardEvent.DOM_KEY_LOCATION_RIGHT=2),"DOM_KEY_LOCATION_NUMPAD"in r.KeyboardEvent||(r.KeyboardEvent.DOM_KEY_LOCATION_NUMPAD=3);var i=window.KeyboardEvent.DOM_KEY_LOCATION_STANDARD,n=window.KeyboardEvent.DOM_KEY_LOCATION_LEFT,s=window.KeyboardEvent.DOM_KEY_LOCATION_RIGHT,o=window.KeyboardEvent.DOM_KEY_LOCATION_NUMPAD;function l(R,B){return String(R).indexOf(B)!==-1}var u=function(){return l(navigator.platform,"Win")?"win":l(navigator.platform,"Mac")?"mac":l(navigator.platform,"CrOS")?"cros":l(navigator.platform,"Linux")?"linux":l(navigator.userAgent,"iPad")||l(navigator.platform,"iPod")||l(navigator.platform,"iPhone")?"ios":""}(),c=function(){return l(navigator.userAgent,"Chrome/")?"chrome":l(navigator.vendor,"Apple")?"safari":l(navigator.userAgent,"MSIE")?"ie":l(navigator.userAgent,"Gecko/")?"moz":l(navigator.userAgent,"Opera/")?"opera":""}(),h=c+"-"+u;function p(R,B,I){(h===B||c===B||u===B)&&Object.keys(I).forEach(function(D){R[D]=I[D]})}function f(R,B){var I={};return Object.keys(R).forEach(function(D){var L=R[D];B in L&&(I[L[B]]=L)}),I}var g={3:{code:"Cancel"},6:{code:"Help"},8:{code:"Backspace"},9:{code:"Tab"},12:{code:"Clear"},13:{code:"Enter"},16:{code:"Shift"},17:{code:"Control"},18:{code:"Alt"},19:{code:"Pause"},20:{code:"CapsLock"},21:{code:"KanaMode"},22:{code:"HangulMode"},23:{code:"JunjaMode"},24:{code:"FinalMode"},25:{code:"KanjiMode"},27:{code:"Escape"},28:{code:"Convert"},29:{code:"NonConvert"},30:{code:"Accept"},31:{code:"ModeChange"},32:{code:"Space"},33:{code:"PageUp"},34:{code:"PageDown"},35:{code:"End"},36:{code:"Home"},37:{code:"ArrowLeft"},38:{code:"ArrowUp"},39:{code:"ArrowRight"},40:{code:"ArrowDown"},41:{code:"Select"},42:{code:"Print"},43:{code:"Execute"},44:{code:"PrintScreen"},45:{code:"Insert"},46:{code:"Delete"},47:{code:"Help"},48:{code:"Digit0",keyCap:"0"},49:{code:"Digit1",keyCap:"1"},50:{code:"Digit2",keyCap:"2"},51:{code:"Digit3",keyCap:"3"},52:{code:"Digit4",keyCap:"4"},53:{code:"Digit5",keyCap:"5"},54:{code:"Digit6",keyCap:"6"},55:{code:"Digit7",keyCap:"7"},56:{code:"Digit8",keyCap:"8"},57:{code:"Digit9",keyCap:"9"},65:{code:"KeyA",keyCap:"a"},66:{code:"KeyB",keyCap:"b"},67:{code:"KeyC",keyCap:"c"},68:{code:"KeyD",keyCap:"d"},69:{code:"KeyE",keyCap:"e"},70:{code:"KeyF",keyCap:"f"},71:{code:"KeyG",keyCap:"g"},72:{code:"KeyH",keyCap:"h"},73:{code:"KeyI",keyCap:"i"},74:{code:"KeyJ",keyCap:"j"},75:{code:"KeyK",keyCap:"k"},76:{code:"KeyL",keyCap:"l"},77:{code:"KeyM",keyCap:"m"},78:{code:"KeyN",keyCap:"n"},79:{code:"KeyO",keyCap:"o"},80:{code:"KeyP",keyCap:"p"},81:{code:"KeyQ",keyCap:"q"},82:{code:"KeyR",keyCap:"r"},83:{code:"KeyS",keyCap:"s"},84:{code:"KeyT",keyCap:"t"},85:{code:"KeyU",keyCap:"u"},86:{code:"KeyV",keyCap:"v"},87:{code:"KeyW",keyCap:"w"},88:{code:"KeyX",keyCap:"x"},89:{code:"KeyY",keyCap:"y"},90:{code:"KeyZ",keyCap:"z"},91:{code:"OSLeft",location:n},92:{code:"OSRight",location:s},93:{code:"ContextMenu"},95:{code:"Standby"},96:{code:"Numpad0",keyCap:"0",location:o},97:{code:"Numpad1",keyCap:"1",location:o},98:{code:"Numpad2",keyCap:"2",location:o},99:{code:"Numpad3",keyCap:"3",location:o},100:{code:"Numpad4",keyCap:"4",location:o},101:{code:"Numpad5",keyCap:"5",location:o},102:{code:"Numpad6",keyCap:"6",location:o},103:{code:"Numpad7",keyCap:"7",location:o},104:{code:"Numpad8",keyCap:"8",location:o},105:{code:"Numpad9",keyCap:"9",location:o},106:{code:"NumpadMultiply",keyCap:"*",location:o},107:{code:"NumpadAdd",keyCap:"+",location:o},108:{code:"NumpadComma",keyCap:",",location:o},109:{code:"NumpadSubtract",keyCap:"-",location:o},110:{code:"NumpadDecimal",keyCap:".",location:o},111:{code:"NumpadDivide",keyCap:"/",location:o},112:{code:"F1"},113:{code:"F2"},114:{code:"F3"},115:{code:"F4"},116:{code:"F5"},117:{code:"F6"},118:{code:"F7"},119:{code:"F8"},120:{code:"F9"},121:{code:"F10"},122:{code:"F11"},123:{code:"F12"},124:{code:"F13"},125:{code:"F14"},126:{code:"F15"},127:{code:"F16"},128:{code:"F17"},129:{code:"F18"},130:{code:"F19"},131:{code:"F20"},132:{code:"F21"},133:{code:"F22"},134:{code:"F23"},135:{code:"F24"},144:{code:"NumLock",location:o},145:{code:"ScrollLock"},160:{code:"ShiftLeft",location:n},161:{code:"ShiftRight",location:s},162:{code:"ControlLeft",location:n},163:{code:"ControlRight",location:s},164:{code:"AltLeft",location:n},165:{code:"AltRight",location:s},166:{code:"BrowserBack"},167:{code:"BrowserForward"},168:{code:"BrowserRefresh"},169:{code:"BrowserStop"},170:{code:"BrowserSearch"},171:{code:"BrowserFavorites"},172:{code:"BrowserHome"},173:{code:"VolumeMute"},174:{code:"VolumeDown"},175:{code:"VolumeUp"},176:{code:"MediaTrackNext"},177:{code:"MediaTrackPrevious"},178:{code:"MediaStop"},179:{code:"MediaPlayPause"},180:{code:"LaunchMail"},181:{code:"MediaSelect"},182:{code:"LaunchApp1"},183:{code:"LaunchApp2"},186:{code:"Semicolon",keyCap:";"},187:{code:"Equal",keyCap:"="},188:{code:"Comma",keyCap:","},189:{code:"Minus",keyCap:"-"},190:{code:"Period",keyCap:"."},191:{code:"Slash",keyCap:"/"},192:{code:"Backquote",keyCap:"`"},219:{code:"BracketLeft",keyCap:"["},220:{code:"Backslash",keyCap:"\\"},221:{code:"BracketRight",keyCap:"]"},222:{code:"Quote",keyCap:"'"},226:{code:"IntlBackslash",keyCap:"\\"},229:{code:"Process"},246:{code:"Attn"},247:{code:"CrSel"},248:{code:"ExSel"},249:{code:"EraseEof"},250:{code:"Play"},251:{code:"ZoomToggle"},254:{code:"Clear"}};p(g,"moz",{59:{code:"Semicolon",keyCap:";"},61:{code:"Equal",keyCap:"="},107:{code:"Equal",keyCap:"="},109:{code:"Minus",keyCap:"-"},187:{code:"NumpadAdd",keyCap:"+",location:o},189:{code:"NumpadSubtract",keyCap:"-",location:o}}),p(g,"moz-mac",{12:{code:"NumLock",location:o},173:{code:"Minus",keyCap:"-"}}),p(g,"moz-win",{173:{code:"Minus",keyCap:"-"}}),p(g,"chrome-mac",{93:{code:"OSRight",location:s}}),p(g,"safari",{3:{code:"Enter"},25:{code:"Tab"}}),p(g,"ios",{10:{code:"Enter",location:i}}),p(g,"safari-mac",{91:{code:"OSLeft",location:n},93:{code:"OSRight",location:s},229:{code:"KeyQ",keyCap:"Q"}});var m={};u==="cros"&&(m["U+00A0"]={code:"ShiftLeft",location:n},m["U+00A1"]={code:"ShiftRight",location:s},m["U+00A2"]={code:"ControlLeft",location:n},m["U+00A3"]={code:"ControlRight",location:s},m["U+00A4"]={code:"AltLeft",location:n},m["U+00A5"]={code:"AltRight",location:s}),h==="chrome-mac"&&(m["U+0010"]={code:"ContextMenu"}),h==="safari-mac"&&(m["U+0010"]={code:"ContextMenu"}),u==="ios"&&(m["U+0010"]={code:"Function"},m["U+001C"]={code:"ArrowLeft"},m["U+001D"]={code:"ArrowRight"},m["U+001E"]={code:"ArrowUp"},m["U+001F"]={code:"ArrowDown"},m["U+0001"]={code:"Home"},m["U+0004"]={code:"End"},m["U+000B"]={code:"PageUp"},m["U+000C"]={code:"PageDown"});var y=[];y[n]={16:{code:"ShiftLeft",location:n},17:{code:"ControlLeft",location:n},18:{code:"AltLeft",location:n}},y[s]={16:{code:"ShiftRight",location:s},17:{code:"ControlRight",location:s},18:{code:"AltRight",location:s}},y[o]={13:{code:"NumpadEnter",location:o}},p(y[o],"moz",{109:{code:"NumpadSubtract",location:o},107:{code:"NumpadAdd",location:o}}),p(y[n],"moz-mac",{224:{code:"OSLeft",location:n}}),p(y[s],"moz-mac",{224:{code:"OSRight",location:s}}),p(y[s],"moz-win",{91:{code:"OSRight",location:s}}),p(y[s],"mac",{93:{code:"OSRight",location:s}}),p(y[o],"chrome-mac",{12:{code:"NumLock",location:o}}),p(y[o],"safari-mac",{12:{code:"NumLock",location:o},187:{code:"NumpadAdd",location:o},189:{code:"NumpadSubtract",location:o},190:{code:"NumpadDecimal",location:o},191:{code:"NumpadDivide",location:o}});var b={ShiftLeft:{key:"Shift"},ShiftRight:{key:"Shift"},ControlLeft:{key:"Control"},ControlRight:{key:"Control"},AltLeft:{key:"Alt"},AltRight:{key:"Alt"},OSLeft:{key:"OS"},OSRight:{key:"OS"},NumpadEnter:{key:"Enter"},Space:{key:" "},Digit0:{key:"0",shiftKey:")"},Digit1:{key:"1",shiftKey:"!"},Digit2:{key:"2",shiftKey:"@"},Digit3:{key:"3",shiftKey:"#"},Digit4:{key:"4",shiftKey:"$"},Digit5:{key:"5",shiftKey:"%"},Digit6:{key:"6",shiftKey:"^"},Digit7:{key:"7",shiftKey:"&"},Digit8:{key:"8",shiftKey:"*"},Digit9:{key:"9",shiftKey:"("},KeyA:{key:"a",shiftKey:"A"},KeyB:{key:"b",shiftKey:"B"},KeyC:{key:"c",shiftKey:"C"},KeyD:{key:"d",shiftKey:"D"},KeyE:{key:"e",shiftKey:"E"},KeyF:{key:"f",shiftKey:"F"},KeyG:{key:"g",shiftKey:"G"},KeyH:{key:"h",shiftKey:"H"},KeyI:{key:"i",shiftKey:"I"},KeyJ:{key:"j",shiftKey:"J"},KeyK:{key:"k",shiftKey:"K"},KeyL:{key:"l",shiftKey:"L"},KeyM:{key:"m",shiftKey:"M"},KeyN:{key:"n",shiftKey:"N"},KeyO:{key:"o",shiftKey:"O"},KeyP:{key:"p",shiftKey:"P"},KeyQ:{key:"q",shiftKey:"Q"},KeyR:{key:"r",shiftKey:"R"},KeyS:{key:"s",shiftKey:"S"},KeyT:{key:"t",shiftKey:"T"},KeyU:{key:"u",shiftKey:"U"},KeyV:{key:"v",shiftKey:"V"},KeyW:{key:"w",shiftKey:"W"},KeyX:{key:"x",shiftKey:"X"},KeyY:{key:"y",shiftKey:"Y"},KeyZ:{key:"z",shiftKey:"Z"},Numpad0:{key:"0"},Numpad1:{key:"1"},Numpad2:{key:"2"},Numpad3:{key:"3"},Numpad4:{key:"4"},Numpad5:{key:"5"},Numpad6:{key:"6"},Numpad7:{key:"7"},Numpad8:{key:"8"},Numpad9:{key:"9"},NumpadMultiply:{key:"*"},NumpadAdd:{key:"+"},NumpadComma:{key:","},NumpadSubtract:{key:"-"},NumpadDecimal:{key:"."},NumpadDivide:{key:"/"},Semicolon:{key:";",shiftKey:":"},Equal:{key:"=",shiftKey:"+"},Comma:{key:",",shiftKey:"<"},Minus:{key:"-",shiftKey:"_"},Period:{key:".",shiftKey:">"},Slash:{key:"/",shiftKey:"?"},Backquote:{key:"`",shiftKey:"~"},BracketLeft:{key:"[",shiftKey:"{"},Backslash:{key:"\\",shiftKey:"|"},BracketRight:{key:"]",shiftKey:"}"},Quote:{key:"'",shiftKey:'"'},IntlBackslash:{key:"\\",shiftKey:"|"}};p(b,"mac",{OSLeft:{key:"Meta"},OSRight:{key:"Meta"}});var v={Esc:"Escape",Nonconvert:"NonConvert",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Menu:"ContextMenu",MediaNextTrack:"MediaTrackNext",MediaPreviousTrack:"MediaTrackPrevious",SelectMedia:"MediaSelect",HalfWidth:"Hankaku",FullWidth:"Zenkaku",RomanCharacters:"Romaji",Crsel:"CrSel",Exsel:"ExSel",Zoom:"ZoomToggle"},_=f(g,"code");try{var C=e&&"location"in new KeyboardEvent("")}catch{}function E(R){var B="keyCode"in R?R.keyCode:"which"in R?R.which:0,I=function(){if(C||"keyLocation"in R){var L=C?R.location:R.keyLocation;if(L&&B in y[L])return y[L][B]}return"keyIdentifier"in R&&R.keyIdentifier in m?m[R.keyIdentifier]:B in g?g[B]:null}();if(!I)return null;var D=function(){var L=b[I.code];return L?R.shiftKey&&"shiftKey"in L?L.shiftKey:L.key:I.code}();return{code:I.code,key:D,location:I.location,keyCap:I.keyCap}}function T(R,B){if(R=String(R),!_.hasOwnProperty(R))return"Undefined";if(B&&String(B).toLowerCase()!=="en-us")throw Error("Unsupported locale");var I=_[R];return I.keyCap||I.code||"Undefined"}"KeyboardEvent"in r&&"defineProperty"in Object&&function(){function R(I,D,L){D in I||Object.defineProperty(I,D,L)}if(R(KeyboardEvent.prototype,"code",{get:function(){var I=E(this);return I?I.code:""}}),"key"in KeyboardEvent.prototype){var B=Object.getOwnPropertyDescriptor(KeyboardEvent.prototype,"key");Object.defineProperty(KeyboardEvent.prototype,"key",{get:function(){var I=B.get.call(this);return v.hasOwnProperty(I)?v[I]:I}})}R(KeyboardEvent.prototype,"key",{get:function(){var I=E(this);return I&&"key"in I?I.key:"Unidentified"}}),R(KeyboardEvent.prototype,"location",{get:function(){var I=E(this);return I&&"location"in I?I.location:i}}),R(KeyboardEvent.prototype,"locale",{get:function(){return""}})}(),"queryKeyCap"in r.KeyboardEvent||(r.KeyboardEvent.queryKeyCap=T),r.identifyKey=function(R){if(!("code"in R)){var B=E(R);R.code=B?B.code:"",R.key=B&&"key"in B?B.key:"Unidentified",R.location="location"in R?R.location:"keyLocation"in R?R.keyLocation:B&&"location"in B?B.location:i,R.locale=""}}}(window);const kq="__keyboard-controls-proxy",Fq=window.KeyboardEvent;AFRAME.registerComponent("keyboard-controls",{schema:{enabled:{default:!0},debug:{default:!1}},init:function(){this.dVelocity=new THREE.Vector3,this.localKeys={},this.listeners={keydown:this.onKeyDown.bind(this),keyup:this.onKeyUp.bind(this),blur:this.onBlur.bind(this),onContextMenu:this.onContextMenu.bind(this)}},isVelocityActive:function(){return this.data.enabled&&!!Object.keys(this.getKeys()).length},getVelocityDelta:function(){const r=this.data,e=this.getKeys();return this.dVelocity.set(0,0,0),r.enabled&&((e.KeyW||e.ArrowUp)&&(this.dVelocity.z-=1),(e.KeyA||e.ArrowLeft)&&(this.dVelocity.x-=1),(e.KeyS||e.ArrowDown)&&(this.dVelocity.z+=1),(e.KeyD||e.ArrowRight)&&(this.dVelocity.x+=1),e.ShiftLeft&&(this.dVelocity=this.dVelocity.multiplyScalar(2))),this.dVelocity.clone()},play:function(){this.attachEventListeners()},pause:function(){this.removeEventListeners()},attachEventListeners:function(){window.addEventListener("contextmenu",this.listeners.onContextMenu,!1),window.addEventListener("keydown",this.listeners.keydown,!1),window.addEventListener("keyup",this.listeners.keyup,!1),window.addEventListener("blur",this.listeners.blur,!1)},onContextMenu:function(){for(const r in this.localKeys)this.localKeys.hasOwnProperty(r)&&delete this.localKeys[r]},removeEventListeners:function(){window.removeEventListener("keydown",this.listeners.keydown),window.removeEventListener("keyup",this.listeners.keyup),window.removeEventListener("blur",this.listeners.blur)},onKeyDown:function(r){AFRAME.utils.shouldCaptureKeyEvent(r)&&(this.localKeys[r.code]=!0,this.emit(r))},onKeyUp:function(r){AFRAME.utils.shouldCaptureKeyEvent(r)&&(delete this.localKeys[r.code],this.emit(r))},onBlur:function(){for(const r in this.localKeys)this.localKeys.hasOwnProperty(r)&&delete this.localKeys[r]},emit:function(r){kq in r&&this.el.emit(r.type,r),this.el.emit(r.type+":"+r.code,new Fq(r.type,r)),this.data.debug&&console.log(r.type+":"+r.code)},isPressed:function(r){return r in this.getKeys()},getKeys:function(){return this.isProxied()?this.el.sceneEl.components["proxy-controls"].getKeyboard():this.localKeys},isProxied:function(){const r=this.el.sceneEl.components["proxy-controls"];return r&&r.isConnected()}}),AFRAME.registerComponent("touch-controls",{schema:{enabled:{default:!0},reverseEnabled:{default:!0}},init:function(){this.dVelocity=new THREE.Vector3,this.bindMethods(),this.direction=0},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.dVelocity.set(0,0,0)},remove:function(){this.pause()},addEventListeners:function(){const r=this.el.sceneEl,e=r.canvas;if(!e){r.addEventListener("render-target-loaded",this.addEventListeners.bind(this));return}e.addEventListener("touchstart",this.onTouchStart,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd,{passive:!0});const i=r.getAttribute("vr-mode-ui");i&&i.cardboardModeEnabled&&r.addEventListener("enter-vr",this.onEnterVR)},removeEventListeners:function(){const r=this.el.sceneEl&&this.el.sceneEl.canvas;r&&(r.removeEventListener("touchstart",this.onTouchStart),r.removeEventListener("touchend",this.onTouchEnd),this.el.sceneEl.removeEventListener("enter-vr",this.onEnterVR))},isVelocityActive:function(){return this.data.enabled&&!!this.direction},getVelocityDelta:function(){return this.dVelocity.z=this.direction,this.dVelocity.clone()},bindMethods:function(){this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onEnterVR=this.onEnterVR.bind(this)},onTouchStart:function(r){this.direction=-1,this.data.reverseEnabled&&r.touches&&r.touches.length===2&&(this.direction=1),r.preventDefault()},onTouchEnd:function(r){this.direction=0,r.preventDefault()},onEnterVR:function(){const r=this.el.sceneEl.xrSession;r&&(r.addEventListener("selectstart",this.onTouchStart),r.addEventListener("selectend",this.onTouchEnd))}});const U2="-controls",Uq=.2,zq=1e-5,jq="moved";AFRAME.registerComponent("movement-controls",{dependencies:["rotation"],schema:{enabled:{default:!0},controls:{default:["gamepad","trackpad","keyboard","touch"]},speed:{default:.3,min:0},fly:{default:!1},constrainToNavMesh:{default:!1},camera:{default:"[movement-controls] [camera]",type:"selector"}},init:function(){const r=this.el;this.data.camera||(this.data.camera=r.querySelector("[camera]")),this.velocityCtrl=null,this.velocity=new THREE.Vector3,this.heading=new THREE.Quaternion,this.eventDetail={},this.navGroup=null,this.navNode=null,r.sceneEl.hasLoaded?this.injectControls():r.sceneEl.addEventListener("loaded",this.injectControls.bind(this))},update:function(r){const e=this.el,i=this.data,n=e.sceneEl.systems.nav;if(e.sceneEl.hasLoaded&&this.injectControls(),n&&i.constrainToNavMesh!==r.constrainToNavMesh&&(i.constrainToNavMesh?n.addAgent(this):n.removeAgent(this)),i.enabled!==r.enabled)for(let s=0;s<i.controls.length;s++){const o=i.controls[s]+U2;this.el.setAttribute(o,{enabled:this.data.enabled})}},injectControls:function(){const r=this.data;for(let e=0;e<r.controls.length;e++){const i=r.controls[e]+U2;this.el.setAttribute(i,{enabled:this.data.enabled})}},updateNavLocation:function(){this.navGroup=null,this.navNode=null},tick:function(){const r=new THREE.Vector3,e=new THREE.Vector3,i=new THREE.Vector3;return function(n,s){if(!s)return;const o=this.el,l=this.data;if(!l.enabled)return;this.updateVelocityCtrl();const u=this.velocityCtrl,c=this.velocity;if(u)if(s/1e3>Uq?c.set(0,0,0):this.updateVelocity(s),l.constrainToNavMesh&&u.isNavMeshConstrained!==!1){if(c.lengthSq()<zq)return;r.copy(o.object3D.position),e.copy(c).multiplyScalar(s/1e3).add(r);const h=o.sceneEl.systems.nav;this.navGroup=this.navGroup===null?h.getGroup(r):this.navGroup,this.navNode=this.navNode||h.getNode(r,this.navGroup),this.navNode=h.clampStep(r,e,this.navGroup,this.navNode,i),o.object3D.position.copy(i)}else o.hasAttribute("velocity")?o.setAttribute("velocity",c):(o.object3D.position.x+=c.x*s/1e3,o.object3D.position.y+=c.y*s/1e3,o.object3D.position.z+=c.z*s/1e3)}}(),updateVelocityCtrl:function(){const r=this.data;if(r.enabled){for(let e=0,i=r.controls.length;e<i;e++){const n=this.el.components[r.controls[e]+U2];if(n&&n.isVelocityActive()){this.velocityCtrl=n;return}}this.velocityCtrl=null}},updateVelocity:function(){const r=new THREE.Vector2,e=new THREE.Quaternion;return function(i){let n;const s=this.el,o=this.velocityCtrl,l=this.velocity,u=this.data;if(o)if(o.getVelocityDelta)n=o.getVelocityDelta(i);else if(o.getVelocity){l.copy(o.getVelocity());return}else if(o.getPositionDelta){l.copy(o.getPositionDelta(i).multiplyScalar(1e3/i));return}else throw new Error("Incompatible movement controls: ",o);if(s.hasAttribute("velocity")&&!u.constrainToNavMesh&&l.copy(this.el.getAttribute("velocity")),n&&u.enabled){const c=u.camera;e.copy(c.object3D.quaternion),e.premultiply(s.object3D.quaternion),n.applyQuaternion(e);const h=n.length();u.fly?(l.copy(n),l.multiplyScalar(this.data.speed*16.66667)):(r.set(n.x,n.z),r.setLength(h*this.data.speed*16.66667),l.x=r.x,l.y=0,l.z=r.y),(l.x!==0||l.y!==0||l.z!==0)&&(this.eventDetail.velocity=l,this.el.emit(jq,this.eventDetail))}}}()}),AFRAME.registerComponent("trackpad-controls",{schema:{enabled:{default:!0},enableNegX:{default:!0},enablePosX:{default:!0},enableNegZ:{default:!0},enablePosZ:{default:!0},mode:{default:"touch",oneOf:["swipe","touch","press"]}},init:function(){this.dVelocity=new THREE.Vector3,this.zVel=0,this.xVel=0,this.bindMethods()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.dVelocity.set(0,0,0)},remove:function(){this.pause()},addEventListeners:function(){const r=this.data,e=this.el.sceneEl;switch(e.addEventListener("axismove",this.onAxisMove),r.mode){case"swipe":case"touch":e.addEventListener("trackpadtouchstart",this.onTouchStart),e.addEventListener("trackpadtouchend",this.onTouchEnd);break;case"press":e.addEventListener("trackpaddown",this.onTouchStart),e.addEventListener("trackpadup",this.onTouchEnd);break}},removeEventListeners:function(){const r=this.el.sceneEl;r.removeEventListener("axismove",this.onAxisMove),r.removeEventListener("trackpadtouchstart",this.onTouchStart),r.removeEventListener("trackpadtouchend",this.onTouchEnd),r.removeEventListener("trackpaddown",this.onTouchStart),r.removeEventListener("trackpadup",this.onTouchEnd)},isVelocityActive:function(){return this.data.enabled&&this.isMoving},getVelocityDelta:function(){return this.dVelocity.z=this.isMoving?-this.zVel:1,this.dVelocity.x=this.isMoving?this.xVel:1,this.dVelocity.clone()},bindMethods:function(){this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onAxisMove=this.onAxisMove.bind(this)},onTouchStart:function(r){switch(this.data.mode){case"swipe":this.canRecordAxis=!0,this.startingAxisData=[];break;case"touch":this.isMoving=!0;break;case"press":this.isMoving=!0;break}r.preventDefault()},onTouchEnd:function(r){this.data.mode=="swipe"&&(this.startingAxisData=[]),this.isMoving=!1,r.preventDefault()},onAxisMove:function(r){switch(this.data.mode){case"swipe":return this.handleSwipeAxis(r);case"touch":case"press":return this.handleTouchAxis(r)}},handleSwipeAxis:function(r){const e=this.data,i=r.detail.axis;if(this.startingAxisData.length===0&&this.canRecordAxis&&(this.canRecordAxis=!1,this.startingAxisData[0]=i[0],this.startingAxisData[1]=i[1]),this.startingAxisData.length>0){let n=0,s=0;e.enableNegX&&i[0]<this.startingAxisData[0]&&(n=-1),e.enablePosX&&i[0]>this.startingAxisData[0]&&(n=1),e.enablePosZ&&i[1]>this.startingAxisData[1]&&(s=-1),e.enableNegZ&&i[1]<this.startingAxisData[1]&&(s=1);const o=Math.abs(this.startingAxisData[1]-i[1]);Math.abs(this.startingAxisData[0]-i[0])>o?(this.zVel=0,this.xVel=n,this.isMoving=!0):(this.xVel=0,this.zVel=s,this.isMoving=!0)}},handleTouchAxis:function(r){const e=this.data,i=r.detail.axis;let n=0,s=0;e.enableNegX&&i[0]<0&&(n=-1),e.enablePosX&&i[0]>0&&(n=1),e.enablePosZ&&i[1]>0&&(s=-1),e.enableNegZ&&i[1]<0&&(s=1),Math.abs(i[0])>Math.abs(i[1])?(this.zVel=0,this.xVel=n):(this.xVel=0,this.zVel=s)}});const pb=(r,e)=>{const i=e.x-r.x,n=e.y-r.y;return Math.sqrt(i*i+n*n)},Gq=(r,e)=>{const i=e.x-r.x,n=e.y-r.y;return Hq(Math.atan2(n,i))},Vq=(r,e,i)=>{const n={x:0,y:0};return i=z2(i),n.x=r.x-e*Math.cos(i),n.y=r.y-e*Math.sin(i),n},z2=r=>r*(Math.PI/180),Hq=r=>r*(180/Math.PI),Wq=r=>isNaN(r.buttons)?r.pressure!==0:r.buttons!==0,j2=new Map,jD=r=>{j2.has(r)&&clearTimeout(j2.get(r)),j2.set(r,setTimeout(r,100))},fb=(r,e,i)=>{const n=e.split(/[ ,]+/g);let s;for(let o=0;o<n.length;o+=1)s=n[o],r.addEventListener?r.addEventListener(s,i,!1):r.attachEvent&&r.attachEvent(s,i)},GD=(r,e,i)=>{const n=e.split(/[ ,]+/g);let s;for(let o=0;o<n.length;o+=1)s=n[o],r.removeEventListener?r.removeEventListener(s,i):r.detachEvent&&r.detachEvent(s,i)},VD=r=>(r.preventDefault(),r.type.match(/^touch/)?r.changedTouches:r),HD=()=>{const r=window.pageXOffset!==void 0?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,e=window.pageYOffset!==void 0?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return{x:r,y:e}},WD=(r,e)=>{e.top||e.right||e.bottom||e.left?(r.style.top=e.top,r.style.right=e.right,r.style.bottom=e.bottom,r.style.left=e.left):(r.style.left=e.x+"px",r.style.top=e.y+"px")},G2=(r,e,i)=>{const n=QD(r);for(let s in n)if(n.hasOwnProperty(s))if(typeof e=="string")n[s]=e+" "+i;else{let o="";for(let l=0,u=e.length;l<u;l+=1)o+=e[l]+" "+i+", ";n[s]=o.slice(0,-2)}return n},Qq=(r,e)=>{const i=QD(r);for(let n in i)i.hasOwnProperty(n)&&(i[n]=e);return i},QD=r=>{const e={};return e[r]="",["webkit","Moz","o"].forEach(function(i){e[i+r.charAt(0).toUpperCase()+r.slice(1)]=""}),e},V2=(r,e)=>{for(let i in e)e.hasOwnProperty(i)&&(r[i]=e[i]);return r},qq=(r,e)=>{const i={};for(let n in r)r.hasOwnProperty(n)&&e.hasOwnProperty(n)?i[n]=e[n]:r.hasOwnProperty(n)&&(i[n]=r[n]);return i},H2=(r,e)=>{if(r.length)for(let i=0,n=r.length;i<n;i+=1)e(r[i]);else e(r)},Xq=(r,e,i)=>({x:Math.min(Math.max(r.x,e.x-i),e.x+i),y:Math.min(Math.max(r.y,e.y-i),e.y+i)});var Kq="ontouchstart"in window,Yq=!!window.PointerEvent,Jq=!!window.MSPointerEvent,Y0={touch:{start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},pointer:{start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"},MSPointer:{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}},Wf,J0={};Yq?Wf=Y0.pointer:Jq?Wf=Y0.MSPointer:Kq?(Wf=Y0.touch,J0=Y0.mouse):Wf=Y0.mouse;function gu(){}gu.prototype.on=function(r,e){var i=this,n=r.split(/[ ,]+/g),s;i._handlers_=i._handlers_||{};for(var o=0;o<n.length;o+=1)s=n[o],i._handlers_[s]=i._handlers_[s]||[],i._handlers_[s].push(e);return i},gu.prototype.off=function(r,e){var i=this;return i._handlers_=i._handlers_||{},r===void 0?i._handlers_={}:e===void 0?i._handlers_[r]=null:i._handlers_[r]&&i._handlers_[r].indexOf(e)>=0&&i._handlers_[r].splice(i._handlers_[r].indexOf(e),1),i},gu.prototype.trigger=function(r,e){var i=this,n=r.split(/[ ,]+/g),s;i._handlers_=i._handlers_||{};for(var o=0;o<n.length;o+=1)s=n[o],i._handlers_[s]&&i._handlers_[s].length&&i._handlers_[s].forEach(function(l){l.call(i,{type:s,target:i},e)})},gu.prototype.config=function(r){var e=this;e.options=e.defaults||{},r&&(e.options=qq(e.options,r))},gu.prototype.bindEvt=function(r,e){var i=this;return i._domHandlers_=i._domHandlers_||{},i._domHandlers_[e]=function(){typeof i["on"+e]=="function"?i["on"+e].apply(i,arguments):console.warn('[WARNING] : Missing "on'+e+'" handler.')},fb(r,Wf[e],i._domHandlers_[e]),J0[e]&&fb(r,J0[e],i._domHandlers_[e]),i},gu.prototype.unbindEvt=function(r,e){var i=this;return i._domHandlers_=i._domHandlers_||{},GD(r,Wf[e],i._domHandlers_[e]),J0[e]&&GD(r,J0[e],i._domHandlers_[e]),delete i._domHandlers_[e],this};function da(r,e){return this.identifier=e.identifier,this.position=e.position,this.frontPosition=e.frontPosition,this.collection=r,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(e),this.options.mode==="dynamic"&&(this.options.restOpacity=0),this.id=da.id,da.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}da.prototype=new gu,da.constructor=da,da.id=0,da.prototype.buildEl=function(r){return this.ui={},this.options.dataOnly?this:(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front),this)},da.prototype.stylize=function(){if(this.options.dataOnly)return this;var r=this.options.fadeTime+"ms",e=Qq("borderRadius","50%"),i=G2("transition","opacity",r),n={};return n.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},n.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",left:0,marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},n.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",left:0,marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},V2(n.el,i),this.options.shape==="circle"&&V2(n.back,e),V2(n.front,e),this.applyStyles(n),this},da.prototype.applyStyles=function(r){for(var e in this.ui)if(this.ui.hasOwnProperty(e))for(var i in r[e])this.ui[e].style[i]=r[e][i];return this},da.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)?this:(this.options.zone.appendChild(this.ui.el),this)},da.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)?this:(this.options.zone.removeChild(this.ui.el),this)},da.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},da.prototype.show=function(r){var e=this;return e.options.dataOnly||(clearTimeout(e.removeTimeout),clearTimeout(e.showTimeout),clearTimeout(e.restTimeout),e.addToDom(),e.restCallback(),setTimeout(function(){e.ui.el.style.opacity=1},0),e.showTimeout=setTimeout(function(){e.trigger("shown",e.instance),typeof r=="function"&&r.call(this)},e.options.fadeTime)),e},da.prototype.hide=function(r){var e=this;if(e.options.dataOnly)return e;if(e.ui.el.style.opacity=e.options.restOpacity,clearTimeout(e.removeTimeout),clearTimeout(e.showTimeout),clearTimeout(e.restTimeout),e.removeTimeout=setTimeout(function(){var i=e.options.mode==="dynamic"?"none":"block";e.ui.el.style.display=i,typeof r=="function"&&r.call(e),e.trigger("hidden",e.instance)},e.options.fadeTime),e.options.restJoystick){const i=e.options.restJoystick,n={};n.x=i===!0||i.x!==!1?0:e.instance.frontPosition.x,n.y=i===!0||i.y!==!1?0:e.instance.frontPosition.y,e.setPosition(r,n)}return e},da.prototype.setPosition=function(r,e){var i=this;i.frontPosition={x:e.x,y:e.y};var n=i.options.fadeTime+"ms",s={};s.front=G2("transition",["transform"],n);var o={front:{}};o.front={transform:"translate("+i.frontPosition.x+"px,"+i.frontPosition.y+"px)"},i.applyStyles(s),i.applyStyles(o),i.restTimeout=setTimeout(function(){typeof r=="function"&&r.call(i),i.restCallback()},i.options.fadeTime)},da.prototype.restCallback=function(){var r=this,e={};e.front=G2("transition","none",""),r.applyStyles(e),r.trigger("rested",r.instance)},da.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},da.prototype.computeDirection=function(r){var e=r.angle.radian,i=Math.PI/4,n=Math.PI/2,s,o,l;if(e>i&&e<i*3&&!r.lockX?s="up":e>-i&&e<=i&&!r.lockY?s="left":e>-i*3&&e<=-i&&!r.lockX?s="down":r.lockY||(s="right"),r.lockY||(e>-n&&e<n?o="left":o="right"),r.lockX||(e>0?l="up":l="down"),r.force>this.options.threshold){var u={},c;for(c in this.direction)this.direction.hasOwnProperty(c)&&(u[c]=this.direction[c]);var h={};this.direction={x:o,y:l,angle:s},r.direction=this.direction;for(c in u)u[c]===this.direction[c]&&(h[c]=!0);if(h.x&&h.y&&h.angle)return r;(!h.x||!h.y)&&this.trigger("plain",r),h.x||this.trigger("plain:"+o,r),h.y||this.trigger("plain:"+l,r),h.angle||this.trigger("dir dir:"+s,r)}else this.resetDirection();return r};function Gs(r,e){var i=this;i.nipples=[],i.idles=[],i.actives=[],i.ids=[],i.pressureIntervals={},i.manager=r,i.id=Gs.id,Gs.id+=1,i.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},i.config(e),(i.options.mode==="static"||i.options.mode==="semi")&&(i.options.multitouch=!1),i.options.multitouch||(i.options.maxNumberOfNipples=1);const n=getComputedStyle(i.options.zone.parentElement);return n&&n.display==="flex"&&(i.parentIsFlex=!0),i.updateBox(),i.prepareNipples(),i.bindings(),i.begin(),i.nipples}Gs.prototype=new gu,Gs.constructor=Gs,Gs.id=0,Gs.prototype.prepareNipples=function(){var r=this,e=r.nipples;e.on=r.on.bind(r),e.off=r.off.bind(r),e.options=r.options,e.destroy=r.destroy.bind(r),e.ids=r.ids,e.id=r.id,e.processOnMove=r.processOnMove.bind(r),e.processOnEnd=r.processOnEnd.bind(r),e.get=function(i){if(i===void 0)return e[0];for(var n=0,s=e.length;n<s;n+=1)if(e[n].identifier===i)return e[n];return!1}},Gs.prototype.bindings=function(){var r=this;r.bindEvt(r.options.zone,"start"),r.options.zone.style.touchAction="none",r.options.zone.style.msTouchAction="none"},Gs.prototype.begin=function(){var r=this,e=r.options;if(e.mode==="static"){var i=r.createNipple(e.position,r.manager.getIdentifier());i.add(),r.idles.push(i)}},Gs.prototype.createNipple=function(r,e){var i=this,n=i.manager.scroll,s={},o=i.options,l={x:i.parentIsFlex?n.x:n.x+i.box.left,y:i.parentIsFlex?n.y:n.y+i.box.top};if(r.x&&r.y)s={x:r.x-l.x,y:r.y-l.y};else if(r.top||r.right||r.bottom||r.left){var u=document.createElement("DIV");u.style.display="hidden",u.style.top=r.top,u.style.right=r.right,u.style.bottom=r.bottom,u.style.left=r.left,u.style.position="absolute",o.zone.appendChild(u);var c=u.getBoundingClientRect();o.zone.removeChild(u),s=r,r={x:c.left+n.x,y:c.top+n.y}}var h=new da(i,{color:o.color,size:o.size,threshold:o.threshold,fadeTime:o.fadeTime,dataOnly:o.dataOnly,restJoystick:o.restJoystick,restOpacity:o.restOpacity,mode:o.mode,identifier:e,position:r,zone:o.zone,frontPosition:{x:0,y:0},shape:o.shape});return o.dataOnly||(WD(h.ui.el,s),WD(h.ui.front,h.frontPosition)),i.nipples.push(h),i.trigger("added "+h.identifier+":added",h),i.manager.trigger("added "+h.identifier+":added",h),i.bindNipple(h),h},Gs.prototype.updateBox=function(){var r=this;r.box=r.options.zone.getBoundingClientRect()},Gs.prototype.bindNipple=function(r){var e=this,i,n=function(s,o){i=s.type+" "+o.id+":"+s.type,e.trigger(i,o)};r.on("destroyed",e.onDestroyed.bind(e)),r.on("shown hidden rested dir plain",n),r.on("dir:up dir:right dir:down dir:left",n),r.on("plain:up plain:right plain:down plain:left",n)},Gs.prototype.pressureFn=function(r,e,i){var n=this,s=0;clearInterval(n.pressureIntervals[i]),n.pressureIntervals[i]=setInterval((function(){var o=r.force||r.pressure||r.webkitForce||0;o!==s&&(e.trigger("pressure",o),n.trigger("pressure "+e.identifier+":pressure",o),s=o)}).bind(n),100)},Gs.prototype.onstart=function(r){var e=this,i=e.options,n=r;r=VD(r),e.updateBox();var s=function(o){e.actives.length<i.maxNumberOfNipples?e.processOnStart(o):n.type.match(/^touch/)&&(Object.keys(e.manager.ids).forEach(function(l){if(Object.values(n.touches).findIndex(function(c){return c.identifier===l})<0){var u=[r[0]];u.identifier=l,e.processOnEnd(u)}}),e.actives.length<i.maxNumberOfNipples&&e.processOnStart(o))};return H2(r,s),e.manager.bindDocument(),!1},Gs.prototype.processOnStart=function(r){var e=this,i=e.options,n,s=e.manager.getIdentifier(r),o=r.force||r.pressure||r.webkitForce||0,l={x:r.pageX,y:r.pageY},u=e.getOrCreate(s,l);u.identifier!==s&&e.manager.removeIdentifier(u.identifier),u.identifier=s;var c=function(p){p.trigger("start",p),e.trigger("start "+p.id+":start",p),p.show(),o>0&&e.pressureFn(r,p,p.identifier),e.processOnMove(r)};if((n=e.idles.indexOf(u))>=0&&e.idles.splice(n,1),e.actives.push(u),e.ids.push(u.identifier),i.mode!=="semi")c(u);else{var h=pb(l,u.position);if(h<=i.catchDistance)c(u);else{u.destroy(),e.processOnStart(r);return}}return u},Gs.prototype.getOrCreate=function(r,e){var i=this,n=i.options,s;return/(semi|static)/.test(n.mode)?(s=i.idles[0],s?(i.idles.splice(0,1),s):n.mode==="semi"?i.createNipple(e,r):(console.warn("Coudln't find the needed nipple."),!1)):(s=i.createNipple(e,r),s)},Gs.prototype.processOnMove=function(r){var e=this,i=e.options,n=e.manager.getIdentifier(r),s=e.nipples.get(n),o=e.manager.scroll;if(!Wq(r)){this.processOnEnd(r);return}if(!s){console.error("Found zombie joystick with ID "+n),e.manager.removeIdentifier(n);return}if(i.dynamicPage){var l=s.el.getBoundingClientRect();s.position={x:o.x+l.left,y:o.y+l.top}}s.identifier=n;var u=s.options.size/2,c={x:r.pageX,y:r.pageY};i.lockX&&(c.y=s.position.y),i.lockY&&(c.x=s.position.x);var h=pb(c,s.position),p=Gq(c,s.position),f=z2(p),g=h/u,m={distance:h,position:c},y,b;if(s.options.shape==="circle"?(y=Math.min(h,u),b=Vq(s.position,y,p)):(b=Xq(c,s.position,u),y=pb(b,s.position)),i.follow){if(h>u){let E=c.x-b.x,T=c.y-b.y;s.position.x+=E,s.position.y+=T,s.el.style.top=s.position.y-(e.box.top+o.y)+"px",s.el.style.left=s.position.x-(e.box.left+o.x)+"px",h=pb(c,s.position)}}else c=b,h=y;var v=c.x-s.position.x,_=c.y-s.position.y;s.frontPosition={x:v,y:_},i.dataOnly||(s.ui.front.style.transform="translate("+v+"px,"+_+"px)");var C={identifier:s.identifier,position:c,force:g,pressure:r.force||r.pressure||r.webkitForce||0,distance:h,angle:{radian:f,degree:p},vector:{x:v/u,y:-_/u},raw:m,instance:s,lockX:i.lockX,lockY:i.lockY};C=s.computeDirection(C),C.angle={radian:z2(180-p),degree:180-p},s.trigger("move",C),e.trigger("move "+s.id+":move",C)},Gs.prototype.processOnEnd=function(r){var e=this,i=e.options,n=e.manager.getIdentifier(r),s=e.nipples.get(n),o=e.manager.removeIdentifier(s.identifier);s&&(i.dataOnly||s.hide(function(){i.mode==="dynamic"&&(s.trigger("removed",s),e.trigger("removed "+s.id+":removed",s),e.manager.trigger("removed "+s.id+":removed",s),s.destroy())}),clearInterval(e.pressureIntervals[s.identifier]),s.resetDirection(),s.trigger("end",s),e.trigger("end "+s.id+":end",s),e.ids.indexOf(s.identifier)>=0&&e.ids.splice(e.ids.indexOf(s.identifier),1),e.actives.indexOf(s)>=0&&e.actives.splice(e.actives.indexOf(s),1),/(semi|static)/.test(i.mode)?e.idles.push(s):e.nipples.indexOf(s)>=0&&e.nipples.splice(e.nipples.indexOf(s),1),e.manager.unbindDocument(),/(semi|static)/.test(i.mode)&&(e.manager.ids[o.id]=o.identifier))},Gs.prototype.onDestroyed=function(r,e){var i=this;i.nipples.indexOf(e)>=0&&i.nipples.splice(i.nipples.indexOf(e),1),i.actives.indexOf(e)>=0&&i.actives.splice(i.actives.indexOf(e),1),i.idles.indexOf(e)>=0&&i.idles.splice(i.idles.indexOf(e),1),i.ids.indexOf(e.identifier)>=0&&i.ids.splice(i.ids.indexOf(e.identifier),1),i.manager.removeIdentifier(e.identifier),i.manager.unbindDocument()},Gs.prototype.destroy=function(){var r=this;r.unbindEvt(r.options.zone,"start"),r.nipples.forEach(function(i){i.destroy()});for(var e in r.pressureIntervals)r.pressureIntervals.hasOwnProperty(e)&&clearInterval(r.pressureIntervals[e]);r.trigger("destroyed",r.nipples),r.manager.unbindDocument(),r.off()};function Ca(r){var e=this;e.ids={},e.index=0,e.collections=[],e.scroll=HD(),e.config(r),e.prepareCollections();var i=function(){var s;e.collections.forEach(function(o){o.forEach(function(l){s=l.el.getBoundingClientRect(),l.position={x:e.scroll.x+s.left,y:e.scroll.y+s.top}})})};fb(window,"resize",function(){jD(i)});var n=function(){e.scroll=HD()};return fb(window,"scroll",function(){jD(n)}),e.collections}Ca.prototype=new gu,Ca.constructor=Ca,Ca.prototype.prepareCollections=function(){var r=this;r.collections.create=r.create.bind(r),r.collections.on=r.on.bind(r),r.collections.off=r.off.bind(r),r.collections.destroy=r.destroy.bind(r),r.collections.get=function(e){var i;return r.collections.every(function(n){return i=n.get(e),!i}),i}},Ca.prototype.create=function(r){return this.createCollection(r)},Ca.prototype.createCollection=function(r){var e=this,i=new Gs(e,r);return e.bindCollection(i),e.collections.push(i),i},Ca.prototype.bindCollection=function(r){var e=this,i,n=function(s,o){i=s.type+" "+o.id+":"+s.type,e.trigger(i,o)};r.on("destroyed",e.onDestroyed.bind(e)),r.on("shown hidden rested dir plain",n),r.on("dir:up dir:right dir:down dir:left",n),r.on("plain:up plain:right plain:down plain:left",n)},Ca.prototype.bindDocument=function(){var r=this;r.binded||(r.bindEvt(document,"move").bindEvt(document,"end"),r.binded=!0)},Ca.prototype.unbindDocument=function(r){var e=this;(!Object.keys(e.ids).length||r===!0)&&(e.unbindEvt(document,"move").unbindEvt(document,"end"),e.binded=!1)},Ca.prototype.getIdentifier=function(r){var e;return r?(e=r.identifier===void 0?r.pointerId:r.identifier,e===void 0&&(e=this.latest||0)):e=this.index,this.ids[e]===void 0&&(this.ids[e]=this.index,this.index+=1),this.latest=e,this.ids[e]},Ca.prototype.removeIdentifier=function(r){var e={};for(var i in this.ids)if(this.ids[i]===r){e.id=i,e.identifier=this.ids[i],delete this.ids[i];break}return e},Ca.prototype.onmove=function(r){var e=this;return e.onAny("move",r),!1},Ca.prototype.onend=function(r){var e=this;return e.onAny("end",r),!1},Ca.prototype.oncancel=function(r){var e=this;return e.onAny("end",r),!1},Ca.prototype.onAny=function(r,e){var i=this,n,s="processOn"+r.charAt(0).toUpperCase()+r.slice(1);e=VD(e);var o=function(u,c,h){h.ids.indexOf(c)>=0&&(h[s](u),u._found_=!0)},l=function(u){n=i.getIdentifier(u),H2(i.collections,o.bind(null,u,n)),u._found_||i.removeIdentifier(n)};return H2(e,l),!1},Ca.prototype.destroy=function(){var r=this;r.unbindDocument(!0),r.ids={},r.index=0,r.collections.forEach(function(e){e.destroy()}),r.off()},Ca.prototype.onDestroyed=function(r,e){var i=this;if(i.collections.indexOf(e)<0)return!1;i.collections.splice(i.collections.indexOf(e),1)};const qD=new Ca,XD={create:function(r){return qD.create(r)},factory:qD};AFRAME.registerComponent("nipple-controls",{schema:{enabled:{default:!0},mode:{default:"dynamic",oneOf:["static","semi","dynamic"]},rotationSensitivity:{default:1},moveJoystickEnabled:{default:!0},lookJoystickEnabled:{default:!0},sideMargin:{default:"30px"},bottomMargin:{default:"70px"},moveJoystickPosition:{default:"left",oneOf:["left","right"]},lookJoystickPosition:{default:"right",oneOf:["left","right"]}},init(){this.dVelocity=new THREE.Vector3,this.lookVector=new THREE.Vector2;const r=this.el.querySelector("[look-controls]").components["look-controls"];this.pitchObject=r.pitchObject,this.yawObject=r.yawObject,this.rigRotation=this.el.object3D.rotation,this.moveData=void 0,this.lookData=void 0,this.moving=!1,this.rotating=!1},update(r){(this.data.moveJoystickPosition!==r.moveJoystickPosition||this.data.sideMargin!==r.sideMargin||this.data.bottomMargin!==r.bottomMargin||this.data.mode!==r.mode)&&this.removeMoveJoystick(),(this.data.lookJoystickPosition!==r.lookJoystickPosition||this.data.sideMargin!==r.sideMargin||this.data.bottomMargin!==r.bottomMargin||this.data.mode!==r.mode)&&this.removeLookJoystick(),this.data.enabled&&this.data.moveJoystickEnabled?this.createMoveJoystick():this.removeMoveJoystick(),this.data.enabled&&this.data.lookJoystickEnabled?this.createLookJoystick():this.removeLookJoystick()},pause(){this.moving=!1,this.rotating=!1},remove(){this.removeMoveJoystick(),this.removeLookJoystick()},isVelocityActive(){return this.data.enabled&&this.moving},getVelocityDelta(){if(this.dVelocity.set(0,0,0),this.isVelocityActive()){const r=this.moveData.force<1?this.moveData.force:1,e=this.moveData.angle.radian,i=Math.cos(e)*r,n=-Math.sin(e)*r;this.dVelocity.set(i,0,n)}return this.dVelocity},isRotationActive(){return this.data.enabled&&this.rotating},updateRotation(r){if(!this.isRotationActive())return;const e=this.lookData.force<1?this.lookData.force:1,i=this.lookData.angle.radian,n=this.lookVector;n.x=Math.cos(i)*e,n.y=Math.sin(i)*e,n.multiplyScalar(this.data.rotationSensitivity*r/1e3),this.yawObject.rotation.y-=n.x;let s=this.pitchObject.rotation.x+n.y;s=Math.max(-Math.PI/2,Math.min(Math.PI/2,s)),this.pitchObject.rotation.x=s},tick:function(r,e){this.updateRotation(e)},initLeftZone(){const r=document.createElement("div");r.setAttribute("id","joystickLeftZone"),r.setAttribute("style",`position:absolute;${this.data.moveJoystickPosition}:${this.data.sideMargin};bottom:${this.data.bottomMargin};z-index:1`),document.body.appendChild(r),this.leftZone=r},initRightZone(){const r=document.createElement("div");r.setAttribute("id","joystickRightZone"),r.setAttribute("style",`position:absolute;${this.data.lookJoystickPosition}:${this.data.sideMargin};bottom:${this.data.bottomMargin};z-index:1`),document.body.appendChild(r),this.rightZone=r},createMoveJoystick(){if(this.moveJoystick)return;this.initLeftZone();const r={mode:this.data.mode,zone:this.leftZone,color:"white",fadeTime:0};this.leftZone.style.width="100px",this.data.mode==="static"?(this.leftZone.style.height="100px",r.position={left:"50%",bottom:"50%"}):this.leftZone.style.height="400px",this.moveJoystick=XD.create(r),this.moveJoystick.on("move",(e,i)=>{this.moveData=i,this.moving=!0}),this.moveJoystick.on("end",(e,i)=>{this.moving=!1})},createLookJoystick(){if(this.lookJoystick)return;this.initRightZone();const r={mode:this.data.mode,zone:this.rightZone,color:"white",fadeTime:0};this.rightZone.style.width="100px",this.data.mode==="static"?(this.rightZone.style.height="100px",r.position={left:"50%",bottom:"50%"}):this.rightZone.style.height="400px",this.lookJoystick=XD.create(r),this.lookJoystick.on("move",(e,i)=>{this.lookData=i,this.rotating=!0}),this.lookJoystick.on("end",(e,i)=>{this.rotating=!1})},removeMoveJoystick(){this.moveJoystick&&(this.moveJoystick.destroy(),this.moveJoystick=void 0),this.moveData=void 0,this.leftZone&&this.leftZone.parentNode&&(this.leftZone.remove(),this.leftZone=void 0)},removeLookJoystick(){this.lookJoystick&&(this.lookJoystick.destroy(),this.lookJoystick=void 0),this.lookData=void 0,this.rightZone&&this.rightZone.parentNode&&(this.rightZone.remove(),this.rightZone=void 0)}});const W2={once:THREE.LoopOnce,repeat:THREE.LoopRepeat,pingpong:THREE.LoopPingPong};AFRAME.registerComponent("animation-mixer",{schema:{clip:{default:"*"},useRegExp:{default:!1},duration:{default:0},clampWhenFinished:{default:!1,type:"boolean"},crossFadeDuration:{default:0},loop:{default:"repeat",oneOf:Object.keys(W2)},repetitions:{default:1/0,min:0},timeScale:{default:1},startAt:{default:0}},init:function(){this.model=null,this.mixer=null,this.activeActions=[];const r=this.el.getObject3D("mesh");r?this.load(r):this.el.addEventListener("model-loaded",e=>{this.load(e.detail.model)})},load:function(r){const e=this.el;this.model=r,this.mixer=new THREE.AnimationMixer(r),this.mixer.addEventListener("loop",i=>{e.emit("animation-loop",{action:i.action,loopDelta:i.loopDelta})}),this.mixer.addEventListener("finished",i=>{e.emit("animation-finished",{action:i.action,direction:i.direction})}),this.data.clip&&this.update({})},remove:function(){this.mixer&&this.mixer.stopAllAction()},update:function(r){if(!r)return;const e=this.data,i=AFRAME.utils.diff(e,r);if("clip"in i){this.stopAction(),e.clip&&this.playAction();return}this.activeActions.forEach(n=>{"duration"in i&&e.duration&&n.setDuration(e.duration),"clampWhenFinished"in i&&(n.clampWhenFinished=e.clampWhenFinished),("loop"in i||"repetitions"in i)&&n.setLoop(W2[e.loop],e.repetitions),"timeScale"in i&&n.setEffectiveTimeScale(e.timeScale)})},stopAction:function(){const r=this.data;for(let e=0;e<this.activeActions.length;e++)r.crossFadeDuration?this.activeActions[e].fadeOut(r.crossFadeDuration):this.activeActions[e].stop();this.activeActions.length=0},playAction:function(){if(!this.mixer)return;const r=this.model,e=this.data,i=r.animations||(r.geometry||{}).animations||[];if(!i.length)return;const n=e.useRegExp?e.clip:Zq(e.clip);for(let s,o=0;s=i[o];o++)if(s.name.match(n)){const l=this.mixer.clipAction(s,r);l.enabled=!0,l.clampWhenFinished=e.clampWhenFinished,e.duration&&l.setDuration(e.duration),e.timeScale!==1&&l.setEffectiveTimeScale(e.timeScale),l.startAt(this.mixer.time-e.startAt/1e3),l.setLoop(W2[e.loop],e.repetitions).fadeIn(e.crossFadeDuration).play(),this.activeActions.push(l)}},tick:function(r,e){this.mixer&&!isNaN(e)&&this.mixer.update(e/1e3)}});function Zq(r){return new RegExp("^"+r.split(/\*+/).map($q).join(".*")+"$")}function $q(r){return r.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")}var eX=THREE.ColladaLoader=function(r){this.manager=r!==void 0?r:THREE.DefaultLoadingManager};THREE.ColladaLoader.prototype={constructor:THREE.ColladaLoader,crossOrigin:"anonymous",load:function(r,e,i,n){var s=this,o=s.path===void 0?THREE.LoaderUtils.extractUrlBase(r):s.path,l=new THREE.FileLoader(s.manager);l.setPath(s.path),l.load(r,function(u){e(s.parse(u,o))},i,n)},setPath:function(r){return this.path=r,this},setResourcePath:function(r){return this.resourcePath=r,this},options:{set convertUpAxis(r){console.warn("THREE.ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.")}},setCrossOrigin:function(r){return this.crossOrigin=r,this},parse:function(r,e){function i(he,le){for(var de=[],be=he.childNodes,Ee=0,at=be.length;Ee<at;Ee++){var St=be[Ee];St.nodeName===le&&de.push(St)}return de}function n(he){if(he.length===0)return[];for(var le=he.trim().split(/\s+/),de=new Array(le.length),be=0,Ee=le.length;be<Ee;be++)de[be]=le[be];return de}function s(he){if(he.length===0)return[];for(var le=he.trim().split(/\s+/),de=new Array(le.length),be=0,Ee=le.length;be<Ee;be++)de[be]=parseFloat(le[be]);return de}function o(he){if(he.length===0)return[];for(var le=he.trim().split(/\s+/),de=new Array(le.length),be=0,Ee=le.length;be<Ee;be++)de[be]=parseInt(le[be]);return de}function l(he){return he.substring(1)}function u(){return"three_default_"+We++}function c(he){return Object.keys(he).length===0}function h(he){return{unit:p(i(he,"unit")[0]),upAxis:f(i(he,"up_axis")[0])}}function p(he){return he!==void 0&&he.hasAttribute("meter")===!0?parseFloat(he.getAttribute("meter")):1}function f(he){return he!==void 0?he.textContent:"Y_UP"}function g(he,le,de,be){var Ee=i(he,le)[0];if(Ee!==void 0)for(var at=i(Ee,de),St=0;St<at.length;St++)be(at[St])}function m(he,le){for(var de in he){var be=he[de];be.build=le(he[de])}}function y(he,le){return he.build!==void 0||(he.build=le(he)),he.build}function b(he){for(var le={sources:{},samplers:{},channels:{}},de=0,be=he.childNodes.length;de<be;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1){var at;switch(Ee.nodeName){case"source":at=Ee.getAttribute("id"),le.sources[at]=ce(Ee);break;case"sampler":at=Ee.getAttribute("id"),le.samplers[at]=v(Ee);break;case"channel":at=Ee.getAttribute("target"),le.channels[at]=_(Ee);break;default:console.log(Ee)}}}Ke.animations[he.getAttribute("id")]=le}function v(he){for(var le={inputs:{}},de=0,be=he.childNodes.length;de<be;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"input":var at=l(Ee.getAttribute("source")),St=Ee.getAttribute("semantic");le.inputs[St]=at;break}}return le}function _(he){var le={},de=he.getAttribute("target"),be=de.split("/"),Ee=be.shift(),at=be.shift(),St=at.indexOf("(")!==-1,Qt=at.indexOf(".")!==-1;if(Qt)be=at.split("."),at=be.shift(),le.member=be.shift();else if(St){var si=at.split("(");at=si.shift();for(var vi=0;vi<si.length;vi++)si[vi]=parseInt(si[vi].replace(/\)/,""));le.indices=si}return le.id=Ee,le.sid=at,le.arraySyntax=St,le.memberSyntax=Qt,le.sampler=l(he.getAttribute("source")),le}function C(he){var le=[],de=he.channels,be=he.samplers,Ee=he.sources;for(var at in de)if(de.hasOwnProperty(at)){var St=de[at],Qt=be[St.sampler],si=Qt.inputs.INPUT,vi=Qt.inputs.OUTPUT,Xt=Ee[si],Li=Ee[vi],vr=T(St,Xt,Li);L(vr,le)}return le}function E(he){return y(Ke.animations[he],C)}function T(he,le,de){var be=Ke.nodes[he.id],Ee=zi(be.id),at=be.transforms[he.sid],St=be.matrix.clone().transpose(),Qt,si,vi,Xt,Li,vr,pr={};switch(at){case"matrix":for(vi=0,Xt=le.array.length;vi<Xt;vi++)if(Qt=le.array[vi],si=vi*de.stride,pr[Qt]===void 0&&(pr[Qt]={}),he.arraySyntax===!0){var fr=de.array[si],Qi=he.indices[0]+4*he.indices[1];pr[Qt][Qi]=fr}else for(Li=0,vr=de.stride;Li<vr;Li++)pr[Qt][Li]=de.array[si+Li];break;case"translate":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',at);break;case"rotate":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',at);break;case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',at);break}var wr=R(pr,St),Tr={name:Ee.uuid,keyframes:wr};return Tr}function R(he,le){var de=[];for(var be in he)de.push({time:parseFloat(be),value:he[be]});de.sort(at);for(var Ee=0;Ee<16;Ee++)O(de,Ee,le.elements[Ee]);return de;function at(St,Qt){return St.time-Qt.time}}var B=new THREE.Vector3,I=new THREE.Vector3,D=new THREE.Quaternion;function L(he,le){for(var de=he.keyframes,be=he.name,Ee=[],at=[],St=[],Qt=[],si=0,vi=de.length;si<vi;si++){var Xt=de[si],Li=Xt.time,vr=Xt.value;fe.fromArray(vr).transpose(),fe.decompose(B,D,I),Ee.push(Li),at.push(B.x,B.y,B.z),St.push(D.x,D.y,D.z,D.w),Qt.push(I.x,I.y,I.z)}return at.length>0&&le.push(new THREE.VectorKeyframeTrack(be+".position",Ee,at)),St.length>0&&le.push(new THREE.QuaternionKeyframeTrack(be+".quaternion",Ee,St)),Qt.length>0&&le.push(new THREE.VectorKeyframeTrack(be+".scale",Ee,Qt)),le}function O(he,le,de){var be,Ee=!0,at,St;for(at=0,St=he.length;at<St;at++)be=he[at],be.value[le]===void 0?be.value[le]=null:Ee=!1;if(Ee===!0)for(at=0,St=he.length;at<St;at++)be=he[at],be.value[le]=de;else F(he,le)}function F(he,le){for(var de,be,Ee=0,at=he.length;Ee<at;Ee++){var St=he[Ee];if(St.value[le]===null){if(de=q(he,Ee,le),be=H(he,Ee,le),de===null){St.value[le]=be.value[le];continue}if(be===null){St.value[le]=de.value[le];continue}G(St,de,be,le)}}}function q(he,le,de){for(;le>=0;){var be=he[le];if(be.value[de]!==null)return be;le--}return null}function H(he,le,de){for(;le<he.length;){var be=he[le];if(be.value[de]!==null)return be;le++}return null}function G(he,le,de,be){if(de.time-le.time===0){he.value[be]=le.value[be];return}he.value[be]=(he.time-le.time)*(de.value[be]-le.value[be])/(de.time-le.time)+le.value[be]}function J(he){for(var le={name:he.getAttribute("id")||"default",start:parseFloat(he.getAttribute("start")||0),end:parseFloat(he.getAttribute("end")||0),animations:[]},de=0,be=he.childNodes.length;de<be;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"instance_animation":le.animations.push(l(Ee.getAttribute("url")));break}}Ke.clips[he.getAttribute("id")]=le}function Q(he){for(var le=[],de=he.name,be=he.end-he.start||-1,Ee=he.animations,at=0,St=Ee.length;at<St;at++)for(var Qt=E(Ee[at]),si=0,vi=Qt.length;si<vi;si++)le.push(Qt[si]);return new THREE.AnimationClip(de,be,le)}function V(he){return y(Ke.clips[he],Q)}function z(he){for(var le={},de=0,be=he.childNodes.length;de<be;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"skin":le.id=l(Ee.getAttribute("source")),le.skin=te(Ee);break;case"morph":le.id=l(Ee.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.");break}}Ke.controllers[he.getAttribute("id")]=le}function te(he){for(var le={sources:{}},de=0,be=he.childNodes.length;de<be;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"bind_shape_matrix":le.bindShapeMatrix=s(Ee.textContent);break;case"source":var at=Ee.getAttribute("id");le.sources[at]=ce(Ee);break;case"joints":le.joints=K(Ee);break;case"vertex_weights":le.vertexWeights=ae(Ee);break}}return le}function K(he){for(var le={inputs:{}},de=0,be=he.childNodes.length;de<be;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"input":var at=Ee.getAttribute("semantic"),St=l(Ee.getAttribute("source"));le.inputs[at]=St;break}}return le}function ae(he){for(var le={inputs:{}},de=0,be=he.childNodes.length;de<be;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"input":var at=Ee.getAttribute("semantic"),St=l(Ee.getAttribute("source")),Qt=parseInt(Ee.getAttribute("offset"));le.inputs[at]={id:St,offset:Qt};break;case"vcount":le.vcount=o(Ee.textContent);break;case"v":le.v=o(Ee.textContent);break}}return le}function Ae(he){var le={id:he.id},de=Ke.geometries[le.id];return he.skin!==void 0&&(le.skin=_e(he.skin),de.sources.skinIndices=le.skin.indices,de.sources.skinWeights=le.skin.weights),le}function _e(he){var le=4,de={joints:[],indices:{array:[],stride:le},weights:{array:[],stride:le}},be=he.sources,Ee=he.vertexWeights,at=Ee.vcount,St=Ee.v,Qt=Ee.inputs.JOINT.offset,si=Ee.inputs.WEIGHT.offset,vi=he.sources[he.joints.inputs.JOINT],Xt=he.sources[he.joints.inputs.INV_BIND_MATRIX],Li=be[Ee.inputs.WEIGHT.id].array,vr=0,pr,fr,Qi;for(pr=0,Qi=at.length;pr<Qi;pr++){var wr=at[pr],Tr=[];for(fr=0;fr<wr;fr++){var Fr=St[vr+Qt],Gr=St[vr+si],xn=Li[Gr];Tr.push({index:Fr,weight:xn}),vr+=2}for(Tr.sort(Cl),fr=0;fr<le;fr++){var jr=Tr[fr];jr!==void 0?(de.indices.array.push(jr.index),de.weights.array.push(jr.weight)):(de.indices.array.push(0),de.weights.array.push(0))}}for(he.bindShapeMatrix?de.bindMatrix=new THREE.Matrix4().fromArray(he.bindShapeMatrix).transpose():de.bindMatrix=new THREE.Matrix4().identity(),pr=0,Qi=vi.array.length;pr<Qi;pr++){var hs=vi.array[pr],Dr=new THREE.Matrix4().fromArray(Xt.array,pr*Xt.stride).transpose();de.joints.push({name:hs,boneInverse:Dr})}return de;function Cl(il,Nc){return Nc.weight-il.weight}}function me(he){return y(Ke.controllers[he],Ae)}function Pe(he){var le={init_from:i(he,"init_from")[0].textContent};Ke.images[he.getAttribute("id")]=le}function Xe(he){return he.build!==void 0?he.build:he.init_from}function Je(he){var le=Ke.images[he];return le!==void 0?y(le,Xe):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",he),null)}function tt(he){for(var le={},de=0,be=he.childNodes.length;de<be;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"profile_COMMON":le.profile=dt(Ee);break}}Ke.effects[he.getAttribute("id")]=le}function dt(he){for(var le={surfaces:{},samplers:{}},de=0,be=he.childNodes.length;de<be;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"newparam":wt(Ee,le);break;case"technique":le.technique=Ei(Ee);break;case"extra":le.extra=Zi(Ee);break}}return le}function wt(he,le){for(var de=he.getAttribute("sid"),be=0,Ee=he.childNodes.length;be<Ee;be++){var at=he.childNodes[be];if(at.nodeType===1)switch(at.nodeName){case"surface":le.surfaces[de]=qt(at);break;case"sampler2D":le.samplers[de]=yt(at);break}}}function qt(he){for(var le={},de=0,be=he.childNodes.length;de<be;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"init_from":le.init_from=Ee.textContent;break}}return le}function yt(he){for(var le={},de=0,be=he.childNodes.length;de<be;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"source":le.source=Ee.textContent;break}}return le}function Ei(he){for(var le={},de=0,be=he.childNodes.length;de<be;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"constant":case"lambert":case"blinn":case"phong":le.type=Ee.nodeName,le.parameters=$e(Ee);break}}return le}function $e(he){for(var le={},de=0,be=he.childNodes.length;de<be;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":le[Ee.nodeName]=Ui(Ee);break;case"transparent":le[Ee.nodeName]={opaque:Ee.getAttribute("opaque"),data:Ui(Ee)};break}}return le}function Ui(he){for(var le={},de=0,be=he.childNodes.length;de<be;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"color":le[Ee.nodeName]=s(Ee.textContent);break;case"float":le[Ee.nodeName]=parseFloat(Ee.textContent);break;case"texture":le[Ee.nodeName]={id:Ee.getAttribute("texture"),extra:hi(Ee)};break}}return le}function hi(he){for(var le={technique:{}},de=0,be=he.childNodes.length;de<be;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"extra":Ri(Ee,le);break}}return le}function Ri(he,le){for(var de=0,be=he.childNodes.length;de<be;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"technique":Si(Ee,le);break}}}function Si(he,le){for(var de=0,be=he.childNodes.length;de<be;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":le.technique[Ee.nodeName]=parseFloat(Ee.textContent);break;case"wrapU":case"wrapV":Ee.textContent.toUpperCase()==="TRUE"?le.technique[Ee.nodeName]=1:Ee.textContent.toUpperCase()==="FALSE"?le.technique[Ee.nodeName]=0:le.technique[Ee.nodeName]=parseInt(Ee.textContent);break}}}function Zi(he){for(var le={},de=0,be=he.childNodes.length;de<be;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"technique":le.technique=Vi(Ee);break}}return le}function Vi(he){for(var le={},de=0,be=he.childNodes.length;de<be;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"double_sided":le[Ee.nodeName]=parseInt(Ee.textContent);break}}return le}function Ge(he){return he}function Ce(he){return y(Ke.effects[he],Ge)}function At(he){for(var le={name:he.getAttribute("name")},de=0,be=he.childNodes.length;de<be;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"instance_effect":le.url=l(Ee.getAttribute("url"));break}}Ke.materials[he.getAttribute("id")]=le}function Pt(he){var le,de=he.slice((he.lastIndexOf(".")-1>>>0)+2);switch(de=de.toLowerCase(),de){case"tga":le=ue;break;default:le=W}return le}function $t(he){var le=Ce(he.url),de=le.profile.technique,be=le.profile.extra,Ee;switch(de.type){case"phong":case"blinn":Ee=new THREE.MeshPhongMaterial;break;case"lambert":Ee=new THREE.MeshLambertMaterial;break;default:Ee=new THREE.MeshBasicMaterial;break}Ee.name=he.name;function at(vr){var pr=le.profile.samplers[vr.id],fr=null;if(pr!==void 0){var Qi=le.profile.surfaces[pr.source];fr=Je(Qi.init_from)}else console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),fr=Je(vr.id);if(fr!==null){var wr=Pt(fr);if(wr!==void 0){var Tr=wr.load(fr),Fr=vr.extra;if(Fr!==void 0&&Fr.technique!==void 0&&c(Fr.technique)===!1){var Gr=Fr.technique;Tr.wrapS=Gr.wrapU?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,Tr.wrapT=Gr.wrapV?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,Tr.offset.set(Gr.offsetU||0,Gr.offsetV||0),Tr.repeat.set(Gr.repeatU||1,Gr.repeatV||1)}else Tr.wrapS=THREE.RepeatWrapping,Tr.wrapT=THREE.RepeatWrapping;return Tr}else return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",fr),null}else return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",vr.id),null}var St=de.parameters;for(var Qt in St){var si=St[Qt];switch(Qt){case"diffuse":si.color&&Ee.color.fromArray(si.color),si.texture&&(Ee.map=at(si.texture));break;case"specular":si.color&&Ee.specular&&Ee.specular.fromArray(si.color),si.texture&&(Ee.specularMap=at(si.texture));break;case"bump":si.texture&&(Ee.normalMap=at(si.texture));break;case"ambient":si.texture&&(Ee.lightMap=at(si.texture));break;case"shininess":si.float&&Ee.shininess&&(Ee.shininess=si.float);break;case"emission":si.color&&Ee.emissive&&Ee.emissive.fromArray(si.color),si.texture&&(Ee.emissiveMap=at(si.texture));break}}var vi=St.transparent,Xt=St.transparency;if(Xt===void 0&&vi&&(Xt={float:1}),vi===void 0&&Xt&&(vi={opaque:"A_ONE",data:{color:[1,1,1,1]}}),vi&&Xt)if(vi.data.texture)Ee.transparent=!0;else{var Li=vi.data.color;switch(vi.opaque){case"A_ONE":Ee.opacity=Li[3]*Xt.float;break;case"RGB_ZERO":Ee.opacity=1-Li[0]*Xt.float;break;case"A_ZERO":Ee.opacity=1-Li[3]*Xt.float;break;case"RGB_ONE":Ee.opacity=Li[0]*Xt.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',vi.opaque)}Ee.opacity<1&&(Ee.transparent=!0)}return be!==void 0&&be.technique!==void 0&&be.technique.double_sided===1&&(Ee.side=THREE.DoubleSide),Ee}function Mt(he){return y(Ke.materials[he],$t)}function yi(he){for(var le={name:he.getAttribute("name")},de=0,be=he.childNodes.length;de<be;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"optics":le.optics=vt(Ee);break}}Ke.cameras[he.getAttribute("id")]=le}function vt(he){for(var le=0;le<he.childNodes.length;le++){var de=he.childNodes[le];switch(de.nodeName){case"technique_common":return ye(de)}}return{}}function ye(he){for(var le={},de=0;de<he.childNodes.length;de++){var be=he.childNodes[de];switch(be.nodeName){case"perspective":case"orthographic":le.technique=be.nodeName,le.parameters=ve(be);break}}return le}function ve(he){for(var le={},de=0;de<he.childNodes.length;de++){var be=he.childNodes[de];switch(be.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":le[be.nodeName]=parseFloat(be.textContent);break}}return le}function Ne(he){var le;switch(he.optics.technique){case"perspective":le=new THREE.PerspectiveCamera(he.optics.parameters.yfov,he.optics.parameters.aspect_ratio,he.optics.parameters.znear,he.optics.parameters.zfar);break;case"orthographic":var de=he.optics.parameters.ymag,be=he.optics.parameters.xmag,Ee=he.optics.parameters.aspect_ratio;be=be===void 0?de*Ee:be,de=de===void 0?be/Ee:de,be*=.5,de*=.5,le=new THREE.OrthographicCamera(-be,be,de,-de,he.optics.parameters.znear,he.optics.parameters.zfar);break;default:le=new THREE.PerspectiveCamera;break}return le.name=he.name,le}function Te(he){var le=Ke.cameras[he];return le!==void 0?y(le,Ne):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",he),null)}function ke(he){for(var le={},de=0,be=he.childNodes.length;de<be;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"technique_common":le=Oe(Ee);break}}Ke.lights[he.getAttribute("id")]=le}function Oe(he){for(var le={},de=0,be=he.childNodes.length;de<be;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"directional":case"point":case"spot":case"ambient":le.technique=Ee.nodeName,le.parameters=U(Ee)}}return le}function U(he){for(var le={},de=0,be=he.childNodes.length;de<be;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"color":var at=s(Ee.textContent);le.color=new THREE.Color().fromArray(at);break;case"falloff_angle":le.falloffAngle=parseFloat(Ee.textContent);break;case"quadratic_attenuation":var St=parseFloat(Ee.textContent);le.distance=St?Math.sqrt(1/St):0;break}}return le}function $(he){var le;switch(he.technique){case"directional":le=new THREE.DirectionalLight;break;case"point":le=new THREE.PointLight;break;case"spot":le=new THREE.SpotLight;break;case"ambient":le=new THREE.AmbientLight;break}return he.parameters.color&&le.color.copy(he.parameters.color),he.parameters.distance&&(le.distance=he.parameters.distance),le}function re(he){var le=Ke.lights[he];return le!==void 0?y(le,$):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",he),null)}function Re(he){var le={name:he.getAttribute("name"),sources:{},vertices:{},primitives:[]},de=i(he,"mesh")[0];if(de!==void 0){for(var be=0;be<de.childNodes.length;be++){var Ee=de.childNodes[be];if(Ee.nodeType===1){var at=Ee.getAttribute("id");switch(Ee.nodeName){case"source":le.sources[at]=ce(Ee);break;case"vertices":le.vertices=Ue(Ee);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",Ee.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":le.primitives.push(je(Ee));break;default:console.log(Ee)}}}Ke.geometries[he.getAttribute("id")]=le}}function ce(he){for(var le={array:[],stride:3},de=0;de<he.childNodes.length;de++){var be=he.childNodes[de];if(be.nodeType===1)switch(be.nodeName){case"float_array":le.array=s(be.textContent);break;case"Name_array":le.array=n(be.textContent);break;case"technique_common":var Ee=i(be,"accessor")[0];Ee!==void 0&&(le.stride=parseInt(Ee.getAttribute("stride")));break}}return le}function Ue(he){for(var le={},de=0;de<he.childNodes.length;de++){var be=he.childNodes[de];be.nodeType===1&&(le[be.getAttribute("semantic")]=l(be.getAttribute("source")))}return le}function je(he){for(var le={type:he.nodeName,material:he.getAttribute("material"),count:parseInt(he.getAttribute("count")),inputs:{},stride:0,hasUV:!1},de=0,be=he.childNodes.length;de<be;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"input":var at=l(Ee.getAttribute("source")),St=Ee.getAttribute("semantic"),Qt=parseInt(Ee.getAttribute("offset")),si=parseInt(Ee.getAttribute("set")),vi=si>0?St+si:St;le.inputs[vi]={id:at,offset:Qt},le.stride=Math.max(le.stride,Qt+1),St==="TEXCOORD"&&(le.hasUV=!0);break;case"vcount":le.vcount=o(Ee.textContent);break;case"p":le.p=o(Ee.textContent);break}}return le}function pt(he){for(var le={},de=0;de<he.length;de++){var be=he[de];le[be.type]===void 0&&(le[be.type]=[]),le[be.type].push(be)}return le}function Lt(he){for(var le=0,de=0,be=he.length;de<be;de++){var Ee=he[de];Ee.hasUV===!0&&le++}le>0&&le<he.length&&(he.uvsNeedsFix=!0)}function xt(he){var le={},de=he.sources,be=he.vertices,Ee=he.primitives;if(Ee.length===0)return{};var at=pt(Ee);for(var St in at){var Qt=at[St];Lt(Qt),le[St]=Gt(Qt,de,be)}return le}function Gt(he,le,de){for(var be={},Ee={array:[],stride:0},at={array:[],stride:0},St={array:[],stride:0},Qt={array:[],stride:0},si={array:[],stride:0},vi={array:[],stride:4},Xt={array:[],stride:4},Li=new THREE.BufferGeometry,vr=[],pr=0,fr=0;fr<he.length;fr++){var Qi=he[fr],wr=Qi.inputs,Tr=0;switch(Qi.type){case"lines":case"linestrips":Tr=Qi.count*2;break;case"triangles":Tr=Qi.count*3;break;case"polylist":for(var Fr=0;Fr<Qi.count;Fr++){var Gr=Qi.vcount[Fr];switch(Gr){case 3:Tr+=3;break;case 4:Tr+=6;break;default:Tr+=(Gr-2)*3;break}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",Qi.type)}Li.addGroup(pr,Tr,fr),pr+=Tr,Qi.material&&vr.push(Qi.material);for(var xn in wr){var jr=wr[xn];switch(xn){case"VERTEX":for(var hs in de){var Dr=de[hs];switch(hs){case"POSITION":var Cl=Ee.array.length;if(mi(Qi,le[Dr],jr.offset,Ee.array),Ee.stride=le[Dr].stride,le.skinWeights&&le.skinIndices&&(mi(Qi,le.skinIndices,jr.offset,vi.array),mi(Qi,le.skinWeights,jr.offset,Xt.array)),Qi.hasUV===!1&&he.uvsNeedsFix===!0)for(var Tr=(Ee.array.length-Cl)/Ee.stride,il=0;il<Tr;il++)St.array.push(0,0);break;case"NORMAL":mi(Qi,le[Dr],jr.offset,at.array),at.stride=le[Dr].stride;break;case"COLOR":mi(Qi,le[Dr],jr.offset,si.array),si.stride=le[Dr].stride;break;case"TEXCOORD":mi(Qi,le[Dr],jr.offset,St.array),St.stride=le[Dr].stride;break;case"TEXCOORD1":mi(Qi,le[Dr],jr.offset,Qt.array),St.stride=le[Dr].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',hs)}}break;case"NORMAL":mi(Qi,le[jr.id],jr.offset,at.array),at.stride=le[jr.id].stride;break;case"COLOR":mi(Qi,le[jr.id],jr.offset,si.array),si.stride=le[jr.id].stride;break;case"TEXCOORD":mi(Qi,le[jr.id],jr.offset,St.array),St.stride=le[jr.id].stride;break;case"TEXCOORD1":mi(Qi,le[jr.id],jr.offset,Qt.array),Qt.stride=le[jr.id].stride;break}}}return Ee.array.length>0&&Li.addAttribute("position",new THREE.Float32BufferAttribute(Ee.array,Ee.stride)),at.array.length>0&&Li.addAttribute("normal",new THREE.Float32BufferAttribute(at.array,at.stride)),si.array.length>0&&Li.addAttribute("color",new THREE.Float32BufferAttribute(si.array,si.stride)),St.array.length>0&&Li.addAttribute("uv",new THREE.Float32BufferAttribute(St.array,St.stride)),Qt.array.length>0&&Li.addAttribute("uv2",new THREE.Float32BufferAttribute(Qt.array,Qt.stride)),vi.array.length>0&&Li.addAttribute("skinIndex",new THREE.Float32BufferAttribute(vi.array,vi.stride)),Xt.array.length>0&&Li.addAttribute("skinWeight",new THREE.Float32BufferAttribute(Xt.array,Xt.stride)),be.data=Li,be.type=he[0].type,be.materialKeys=vr,be}function mi(he,le,de,be){var Ee=he.p,at=he.stride,St=he.vcount;function Qt(xn){for(var jr=Ee[xn+de]*vi,hs=jr+vi;jr<hs;jr++)be.push(si[jr])}var si=le.array,vi=le.stride;if(he.vcount!==void 0)for(var Xt=0,Li=0,vr=St.length;Li<vr;Li++){var pr=St[Li];if(pr===4){var fr=Xt+at*0,Qi=Xt+at*1,wr=Xt+at*2,Tr=Xt+at*3;Qt(fr),Qt(Qi),Qt(Tr),Qt(Qi),Qt(wr),Qt(Tr)}else if(pr===3){var fr=Xt+at*0,Qi=Xt+at*1,wr=Xt+at*2;Qt(fr),Qt(Qi),Qt(wr)}else if(pr>4)for(var Fr=1,Gr=pr-2;Fr<=Gr;Fr++){var fr=Xt+at*0,Qi=Xt+at*Fr,wr=Xt+at*(Fr+1);Qt(fr),Qt(Qi),Qt(wr)}Xt+=at*pr}else for(var Li=0,vr=Ee.length;Li<vr;Li+=at)Qt(Li)}function _r(he){return y(Ke.geometries[he],xt)}function Fi(he){for(var le={name:he.getAttribute("name")||"",joints:{},links:[]},de=0;de<he.childNodes.length;de++){var be=he.childNodes[de];if(be.nodeType===1)switch(be.nodeName){case"technique_common":nn(be,le);break}}Ke.kinematicsModels[he.getAttribute("id")]=le}function gn(he){return he.build!==void 0?he.build:he}function kr(he){return y(Ke.kinematicsModels[he],gn)}function nn(he,le){for(var de=0;de<he.childNodes.length;de++){var be=he.childNodes[de];if(be.nodeType===1)switch(be.nodeName){case"joint":le.joints[be.getAttribute("sid")]=vs(be);break;case"link":le.links.push(Ns(be));break}}}function vs(he){for(var le,de=0;de<he.childNodes.length;de++){var be=he.childNodes[de];if(be.nodeType===1)switch(be.nodeName){case"prismatic":case"revolute":le=An(be);break}}return le}function An(he,le){for(var le={sid:he.getAttribute("sid"),name:he.getAttribute("name")||"",axis:new THREE.Vector3,limits:{min:0,max:0},type:he.nodeName,static:!1,zeroPosition:0,middlePosition:0},de=0;de<he.childNodes.length;de++){var be=he.childNodes[de];if(be.nodeType===1)switch(be.nodeName){case"axis":var Ee=s(be.textContent);le.axis.fromArray(Ee);break;case"limits":var at=be.getElementsByTagName("max")[0],St=be.getElementsByTagName("min")[0];le.limits.max=parseFloat(at.textContent),le.limits.min=parseFloat(St.textContent);break}}return le.limits.min>=le.limits.max&&(le.static=!0),le.middlePosition=(le.limits.min+le.limits.max)/2,le}function Ns(he){for(var le={sid:he.getAttribute("sid"),name:he.getAttribute("name")||"",attachments:[],transforms:[]},de=0;de<he.childNodes.length;de++){var be=he.childNodes[de];if(be.nodeType===1)switch(be.nodeName){case"attachment_full":le.attachments.push(ts(be));break;case"matrix":case"translate":case"rotate":le.transforms.push(bs(be));break}}return le}function ts(he){for(var le={joint:he.getAttribute("joint").split("/").pop(),transforms:[],links:[]},de=0;de<he.childNodes.length;de++){var be=he.childNodes[de];if(be.nodeType===1)switch(be.nodeName){case"link":le.links.push(Ns(be));break;case"matrix":case"translate":case"rotate":le.transforms.push(bs(be));break}}return le}function bs(he){var le={type:he.nodeName},de=s(he.textContent);switch(le.type){case"matrix":le.obj=new THREE.Matrix4,le.obj.fromArray(de).transpose();break;case"translate":le.obj=new THREE.Vector3,le.obj.fromArray(de);break;case"rotate":le.obj=new THREE.Vector3,le.obj.fromArray(de),le.angle=THREE.MathUtils.degToRad(de[3]);break}return le}function pe(he){for(var le={name:he.getAttribute("name")||"",rigidBodies:{}},de=0;de<he.childNodes.length;de++){var be=he.childNodes[de];if(be.nodeType===1)switch(be.nodeName){case"rigid_body":le.rigidBodies[be.getAttribute("name")]={},ct(be,le.rigidBodies[be.getAttribute("name")]);break}}Ke.physicsModels[he.getAttribute("id")]=le}function ct(he,le){for(var de=0;de<he.childNodes.length;de++){var be=he.childNodes[de];if(be.nodeType===1)switch(be.nodeName){case"technique_common":Tt(be,le);break}}}function Tt(he,le){for(var de=0;de<he.childNodes.length;de++){var be=he.childNodes[de];if(be.nodeType===1)switch(be.nodeName){case"inertia":le.inertia=s(be.textContent);break;case"mass":le.mass=s(be.textContent)[0];break}}}function Jt(he){for(var le={bindJointAxis:[]},de=0;de<he.childNodes.length;de++){var be=he.childNodes[de];if(be.nodeType===1)switch(be.nodeName){case"bind_joint_axis":le.bindJointAxis.push(Ni(be));break}}Ke.kinematicsScenes[l(he.getAttribute("url"))]=le}function Ni(he){for(var le={target:he.getAttribute("target").split("/").pop()},de=0;de<he.childNodes.length;de++){var be=he.childNodes[de];if(be.nodeType===1)switch(be.nodeName){case"axis":var Ee=be.getElementsByTagName("param")[0];le.axis=Ee.textContent;var at=le.axis.split("inst_").pop().split("axis")[0];le.jointIndex=at.substr(0,at.length-1);break}}return le}function ar(he){return he.build!==void 0?he.build:he}function Di(he){return y(Ke.kinematicsScenes[he],ar)}function ki(){var he=Object.keys(Ke.kinematicsModels)[0],le=Object.keys(Ke.kinematicsScenes)[0],de=Object.keys(Ke.visualScenes)[0];if(he===void 0||le===void 0)return;for(var be=kr(he),Ee=Di(le),at=_i(de),St=Ee.bindJointAxis,Qt={},si=0,vi=St.length;si<vi;si++){var Xt=St[si],Li=or.querySelector('[sid="'+Xt.target+'"]');if(Li){var vr=Li.parentElement;pr(Xt.jointIndex,vr)}}function pr(Qi,wr){var Tr=wr.getAttribute("name"),Fr=be.joints[Qi];at.traverse(function(Gr){Gr.name===Tr&&(Qt[Qi]={object:Gr,transforms:Ie(wr),joint:Fr,position:Fr.zeroPosition})})}var fr=new THREE.Matrix4;Se={joints:be&&be.joints,getJointValue:function(Qi){var wr=Qt[Qi];if(wr)return wr.position;console.warn("THREE.ColladaLoader: Joint "+Qi+" doesn't exist.")},setJointValue:function(Qi,wr){var Tr=Qt[Qi];if(Tr){var Fr=Tr.joint;if(wr>Fr.limits.max||wr<Fr.limits.min)console.warn("THREE.ColladaLoader: Joint "+Qi+" value "+wr+" outside of limits (min: "+Fr.limits.min+", max: "+Fr.limits.max+").");else if(Fr.static)console.warn("THREE.ColladaLoader: Joint "+Qi+" is static.");else{var Gr=Tr.object,xn=Fr.axis,jr=Tr.transforms;fe.identity();for(var hs=0;hs<jr.length;hs++){var Dr=jr[hs];if(Dr.sid&&Dr.sid.indexOf(Qi)!==-1)switch(Fr.type){case"revolute":fe.multiply(fr.makeRotationAxis(xn,THREE.MathUtils.degToRad(wr)));break;case"prismatic":fe.multiply(fr.makeTranslation(xn.x*wr,xn.y*wr,xn.z*wr));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+Fr.type);break}else switch(Dr.type){case"matrix":fe.multiply(Dr.obj);break;case"translate":fe.multiply(fr.makeTranslation(Dr.obj.x,Dr.obj.y,Dr.obj.z));break;case"scale":fe.scale(Dr.obj);break;case"rotate":fe.multiply(fr.makeRotationAxis(Dr.obj,Dr.angle));break}}Gr.matrix.copy(fe),Gr.matrix.decompose(Gr.position,Gr.quaternion,Gr.scale),Qt[Qi].position=wr}}else console.log("THREE.ColladaLoader: "+Qi+" does not exist.")}}}function Ie(he){for(var le=[],de=or.querySelector('[id="'+he.id+'"]'),be=0;be<de.childNodes.length;be++){var Ee=de.childNodes[be];if(Ee.nodeType===1)switch(Ee.nodeName){case"matrix":var St=s(Ee.textContent),at=new THREE.Matrix4().fromArray(St).transpose();le.push({sid:Ee.getAttribute("sid"),type:Ee.nodeName,obj:at});break;case"translate":case"scale":var St=s(Ee.textContent),Qt=new THREE.Vector3().fromArray(St);le.push({sid:Ee.getAttribute("sid"),type:Ee.nodeName,obj:Qt});break;case"rotate":var St=s(Ee.textContent),Qt=new THREE.Vector3().fromArray(St),si=THREE.MathUtils.degToRad(St[3]);le.push({sid:Ee.getAttribute("sid"),type:Ee.nodeName,obj:Qt,angle:si});break}}return le}function se(he){for(var le=he.getElementsByTagName("node"),de=0;de<le.length;de++){var be=le[de];be.hasAttribute("id")===!1&&be.setAttribute("id",u())}}var fe=new THREE.Matrix4,Be=new THREE.Vector3;function Fe(he){for(var le={name:he.getAttribute("name")||"",type:he.getAttribute("type"),id:he.getAttribute("id"),sid:he.getAttribute("sid"),matrix:new THREE.Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}},de=0;de<he.childNodes.length;de++){var be=he.childNodes[de];if(be.nodeType===1)switch(be.nodeName){case"node":le.nodes.push(be.getAttribute("id")),Fe(be);break;case"instance_camera":le.instanceCameras.push(l(be.getAttribute("url")));break;case"instance_controller":le.instanceControllers.push(Ye(be));break;case"instance_light":le.instanceLights.push(l(be.getAttribute("url")));break;case"instance_geometry":le.instanceGeometries.push(Ye(be));break;case"instance_node":le.instanceNodes.push(l(be.getAttribute("url")));break;case"matrix":var at=s(be.textContent);le.matrix.multiply(fe.fromArray(at).transpose()),le.transforms[be.getAttribute("sid")]=be.nodeName;break;case"translate":var at=s(be.textContent);Be.fromArray(at),le.matrix.multiply(fe.makeTranslation(Be.x,Be.y,Be.z)),le.transforms[be.getAttribute("sid")]=be.nodeName;break;case"rotate":var at=s(be.textContent),Ee=THREE.MathUtils.degToRad(at[3]);le.matrix.multiply(fe.makeRotationAxis(Be.fromArray(at),Ee)),le.transforms[be.getAttribute("sid")]=be.nodeName;break;case"scale":var at=s(be.textContent);le.matrix.scale(Be.fromArray(at)),le.transforms[be.getAttribute("sid")]=be.nodeName;break;case"extra":break;default:console.log(be)}}return wi(le.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",le.id):Ke.nodes[le.id]=le,le}function Ye(he){for(var le={id:l(he.getAttribute("url")),materials:{},skeletons:[]},de=0;de<he.childNodes.length;de++){var be=he.childNodes[de];switch(be.nodeName){case"bind_material":for(var Ee=be.getElementsByTagName("instance_material"),at=0;at<Ee.length;at++){var St=Ee[at],Qt=St.getAttribute("symbol"),si=St.getAttribute("target");le.materials[Qt]=l(si)}break;case"skeleton":le.skeletons.push(l(be.textContent));break}}return le}function lt(he,le){var de=[],be=[],Ee,at,St;for(Ee=0;Ee<he.length;Ee++){var Qt=he[Ee],si;if(wi(Qt))si=zi(Qt),Ct(si,le,de);else if(er(Qt))for(var vi=Ke.visualScenes[Qt],Xt=vi.children,at=0;at<Xt.length;at++){var Li=Xt[at];if(Li.type==="JOINT"){var si=zi(Li.id);Ct(si,le,de)}}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",Qt)}for(Ee=0;Ee<le.length;Ee++)for(at=0;at<de.length;at++)if(St=de[at],St.bone.name===le[Ee].name){be[Ee]=St,St.processed=!0;break}for(Ee=0;Ee<de.length;Ee++)St=de[Ee],St.processed===!1&&(be.push(St),St.processed=!0);var vr=[],pr=[];for(Ee=0;Ee<be.length;Ee++)St=be[Ee],vr.push(St.bone),pr.push(St.boneInverse);return new THREE.Skeleton(vr,pr)}function Ct(he,le,de){he.traverse(function(be){if(be.isBone===!0){for(var Ee,at=0;at<le.length;at++){var St=le[at];if(St.name===be.name){Ee=St.boneInverse;break}}Ee===void 0&&(Ee=new THREE.Matrix4),de.push({bone:be,boneInverse:Ee,processed:!1})}})}function Yt(he){for(var le=[],de=he.matrix,be=he.nodes,Ee=he.type,at=he.instanceCameras,St=he.instanceControllers,Qt=he.instanceLights,si=he.instanceGeometries,vi=he.instanceNodes,Xt=0,Li=be.length;Xt<Li;Xt++)le.push(zi(be[Xt]));for(var Xt=0,Li=at.length;Xt<Li;Xt++){var vr=Te(at[Xt]);vr!==null&&le.push(vr.clone())}for(var Xt=0,Li=St.length;Xt<Li;Xt++)for(var pr=St[Xt],fr=me(pr.id),Qi=_r(fr.id),wr=ni(Qi,pr.materials),Tr=pr.skeletons,Fr=fr.skin.joints,Gr=lt(Tr,Fr),xn=0,jr=wr.length;xn<jr;xn++){var Dr=wr[xn];Dr.isSkinnedMesh&&(Dr.bind(Gr,fr.skin.bindMatrix),Dr.normalizeSkinWeights()),le.push(Dr)}for(var Xt=0,Li=Qt.length;Xt<Li;Xt++){var hs=re(Qt[Xt]);hs!==null&&le.push(hs.clone())}for(var Xt=0,Li=si.length;Xt<Li;Xt++)for(var pr=si[Xt],Qi=_r(pr.id),wr=ni(Qi,pr.materials),xn=0,jr=wr.length;xn<jr;xn++)le.push(wr[xn]);for(var Xt=0,Li=vi.length;Xt<Li;Xt++)le.push(zi(vi[Xt]).clone());var Dr;if(be.length===0&&le.length===1)Dr=le[0];else{Dr=Ee==="JOINT"?new THREE.Bone:new THREE.Group;for(var Xt=0;Xt<le.length;Xt++)Dr.add(le[Xt])}return Dr.name===""&&(Dr.name=Ee==="JOINT"?he.sid:he.name),Dr.matrix.copy(de),Dr.matrix.decompose(Dr.position,Dr.quaternion,Dr.scale),Dr}var ei=new THREE.MeshBasicMaterial({color:16711935});function Bt(he,le){for(var de=[],be=0,Ee=he.length;be<Ee;be++){var at=le[he[be]];at===void 0?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",he[be]),de.push(ei)):de.push(Mt(at))}return de}function ni(he,le){var de=[];for(var be in he){var Ee=he[be],at=Bt(Ee.materialKeys,le);at.length===0&&(be==="lines"||be==="linestrips"?at.push(new THREE.LineBasicMaterial):at.push(new THREE.MeshPhongMaterial));var St=Ee.data.attributes.skinIndex!==void 0;if(St)for(var Qt=0,si=at.length;Qt<si;Qt++)at[Qt].skinning=!0;var vi=at.length===1?at[0]:at,Xt;switch(be){case"lines":Xt=new THREE.LineSegments(Ee.data,vi);break;case"linestrips":Xt=new THREE.Line(Ee.data,vi);break;case"triangles":case"polylist":St?Xt=new THREE.SkinnedMesh(Ee.data,vi):Xt=new THREE.Mesh(Ee.data,vi);break}de.push(Xt)}return de}function wi(he){return Ke.nodes[he]!==void 0}function zi(he){return y(Ke.nodes[he],Yt)}function Sr(he){var le={name:he.getAttribute("name"),children:[]};se(he);for(var de=i(he,"node"),be=0;be<de.length;be++)le.children.push(Fe(de[be]));Ke.visualScenes[he.getAttribute("id")]=le}function hr(he){var le=new THREE.Group;le.name=he.name;for(var de=he.children,be=0;be<de.length;be++){var Ee=de[be];le.add(zi(Ee.id))}return le}function er(he){return Ke.visualScenes[he]!==void 0}function _i(he){return y(Ke.visualScenes[he],hr)}function Rn(he){var le=i(he,"instance_visual_scene")[0];return _i(l(le.getAttribute("url")))}function Kn(){var he=Ke.clips;if(c(he)===!0){if(c(Ke.animations)===!1){var le=[];for(var de in Ke.animations)for(var be=E(de),Ee=0,at=be.length;Ee<at;Ee++)le.push(be[Ee]);ge.push(new THREE.AnimationClip("default",-1,le))}}else for(var de in he)ge.push(V(de))}if(r.length===0)return{scene:new THREE.Scene};var Bi=new DOMParser().parseFromString(r,"application/xml"),or=i(Bi,"COLLADA")[0],dn=or.getAttribute("version");console.log("THREE.ColladaLoader: File version",dn);var qr=h(i(or,"asset")[0]),W=new THREE.TextureLoader(this.manager);W.setPath(this.resourcePath||e).setCrossOrigin(this.crossOrigin);var ue;THREE.TGALoader&&(ue=new THREE.TGALoader(this.manager),ue.setPath(this.resourcePath||e));var ge=[],Se={},We=0,Ke={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};g(or,"library_animations","animation",b),g(or,"library_animation_clips","animation_clip",J),g(or,"library_controllers","controller",z),g(or,"library_images","image",Pe),g(or,"library_effects","effect",tt),g(or,"library_materials","material",At),g(or,"library_cameras","camera",yi),g(or,"library_lights","light",ke),g(or,"library_geometries","geometry",Re),g(or,"library_nodes","node",Fe),g(or,"library_visual_scenes","visual_scene",Sr),g(or,"library_kinematics_models","kinematics_model",Fi),g(or,"library_physics_models","physics_model",pe),g(or,"scene","instance_kinematics_scene",Jt),m(Ke.animations,C),m(Ke.clips,Q),m(Ke.controllers,Ae),m(Ke.images,Xe),m(Ke.effects,Ge),m(Ke.materials,$t),m(Ke.cameras,Ne),m(Ke.lights,$),m(Ke.geometries,xt),m(Ke.visualScenes,hr),Kn(),ki();var mt=Rn(i(or,"scene")[0]);return qr.upAxis==="Z_UP"&&mt.quaternion.setFromEuler(new THREE.Euler(-Math.PI/2,0,0)),mt.scale.multiplyScalar(qr.unit),{animations:ge,kinematics:Se,library:Ke,scene:mt}}},THREE.ColladaLoader=eX,AFRAME.registerComponent("collada-model-legacy",{schema:{type:"asset"},init:function(){this.model=null,this.loader=new THREE.ColladaLoader},update:function(){var r=this,e=this.el,i=this.data,n=this.el.sceneEl.systems.renderer;i&&(this.remove(),this.loader.load(i,function(s){r.model=s.scene,r.model.traverse(function(o){if(o.isMesh){var l=o.material;l.color&&n.applyColorCorrection(l.color),l.map&&n.applyColorCorrection(l.map),l.emissive&&n.applyColorCorrection(l.emissive),l.emissiveMap&&n.applyColorCorrection(l.emissiveMap)}}),e.setObject3D("mesh",r.model),e.emit("model-loaded",{format:"collada",model:r.model})}))},remove:function(){this.model&&this.el.removeObject3D("mesh")}});/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const KD="164",Q2=0,tX=1,YD=1,JD=100,ZD=204,$D=205,eO=3,q2=0,tO="attached",iX="detached",iO=300,rX=303,mb=1e3,Qf=1001,rO=1002,gb=1003,nX=1006,sX=1008,aX=1009,oX=1014,nO=1015,lX=1020,sO=1023,X2=1026,aO=1027,Ab=2300,yb=2301,K2=2302,oO=2400,lO=2401,cO=2402,cX=2500,uO=0,hO="",Nl="srgb",Y2="srgb-linear",uX="display-p3",dO="display-p3-linear",J2="linear",pO="srgb",fO="rec709",mO="p3",qf=7680,gO=519,hX=515,AO=35044,np=2e3,Z2=2001;let vb=class{addEventListener(r,e){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[r]===void 0&&(i[r]=[]),i[r].indexOf(e)===-1&&i[r].push(e)}hasEventListener(r,e){if(this._listeners===void 0)return!1;const i=this._listeners;return i[r]!==void 0&&i[r].indexOf(e)!==-1}removeEventListener(r,e){if(this._listeners===void 0)return;const i=this._listeners[r];if(i!==void 0){const n=i.indexOf(e);n!==-1&&i.splice(n,1)}}dispatchEvent(r){if(this._listeners===void 0)return;const e=this._listeners[r.type];if(e!==void 0){r.target=this;const i=e.slice(0);for(let n=0,s=i.length;n<s;n++)i[n].call(this,r);r.target=null}}};const Za=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let yO=1234567;const Z0=Math.PI/180,$0=180/Math.PI;function kh(){const r=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(Za[r&255]+Za[r>>8&255]+Za[r>>16&255]+Za[r>>24&255]+"-"+Za[e&255]+Za[e>>8&255]+"-"+Za[e>>16&15|64]+Za[e>>24&255]+"-"+Za[i&63|128]+Za[i>>8&255]+"-"+Za[i>>16&255]+Za[i>>24&255]+Za[n&255]+Za[n>>8&255]+Za[n>>16&255]+Za[n>>24&255]).toLowerCase()}function ka(r,e,i){return Math.max(e,Math.min(i,r))}function $2(r,e){return(r%e+e)%e}function dX(r,e,i,n,s){return n+(r-e)*(s-n)/(i-e)}function pX(r,e,i){return r!==e?(i-r)/(e-r):0}function eA(r,e,i){return(1-i)*r+i*e}function fX(r,e,i,n){return eA(r,e,1-Math.exp(-i*n))}function mX(r,e=1){return e-Math.abs($2(r,e*2)-e)}function gX(r,e,i){return r<=e?0:r>=i?1:(r=(r-e)/(i-e),r*r*(3-2*r))}function AX(r,e,i){return r<=e?0:r>=i?1:(r=(r-e)/(i-e),r*r*r*(r*(r*6-15)+10))}function yX(r,e){return r+Math.floor(Math.random()*(e-r+1))}function vX(r,e){return r+Math.random()*(e-r)}function bX(r){return r*(.5-Math.random())}function xX(r){r!==void 0&&(yO=r);let e=yO+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function _X(r){return r*Z0}function EX(r){return r*$0}function wX(r){return(r&r-1)===0&&r!==0}function CX(r){return Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function SX(r){return Math.pow(2,Math.floor(Math.log(r)/Math.LN2))}function TX(r,e,i,n,s){const o=Math.cos,l=Math.sin,u=o(i/2),c=l(i/2),h=o((e+n)/2),p=l((e+n)/2),f=o((e-n)/2),g=l((e-n)/2),m=o((n-e)/2),y=l((n-e)/2);switch(s){case"XYX":r.set(u*p,c*f,c*g,u*h);break;case"YZY":r.set(c*g,u*p,c*f,u*h);break;case"ZXZ":r.set(c*f,c*g,u*p,u*h);break;case"XZX":r.set(u*p,c*y,c*m,u*h);break;case"YXY":r.set(c*m,u*p,c*y,u*h);break;case"ZYZ":r.set(c*y,c*m,u*p,u*h);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function Xf(r,e){switch(e.constructor){case Float32Array:return r;case Uint32Array:return r/4294967295;case Uint16Array:return r/65535;case Uint8Array:return r/255;case Int32Array:return Math.max(r/2147483647,-1);case Int16Array:return Math.max(r/32767,-1);case Int8Array:return Math.max(r/127,-1);default:throw new Error("Invalid component type.")}}function go(r,e){switch(e.constructor){case Float32Array:return r;case Uint32Array:return Math.round(r*4294967295);case Uint16Array:return Math.round(r*65535);case Uint8Array:return Math.round(r*255);case Int32Array:return Math.round(r*2147483647);case Int16Array:return Math.round(r*32767);case Int8Array:return Math.round(r*127);default:throw new Error("Invalid component type.")}}const Ao={DEG2RAD:Z0,RAD2DEG:$0,generateUUID:kh,clamp:ka,euclideanModulo:$2,mapLinear:dX,inverseLerp:pX,lerp:eA,damp:fX,pingpong:mX,smoothstep:gX,smootherstep:AX,randInt:yX,randFloat:vX,randFloatSpread:bX,seededRandom:xX,degToRad:_X,radToDeg:EX,isPowerOfTwo:wX,ceilPowerOfTwo:CX,floorPowerOfTwo:SX,setQuaternionFromProperEuler:TX,normalize:go,denormalize:Xf};let Vs=class WH{constructor(e=0,i=0){WH.prototype.isVector2=!0,this.x=e,this.y=i}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,i){return this.x=e,this.y=i,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const i=this.x,n=this.y,s=e.elements;return this.x=s[0]*i+s[3]*n+s[6],this.y=s[1]*i+s[4]*n+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this}clampLength(e,i){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(i,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const n=this.dot(e)/i;return Math.acos(ka(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,n=this.y-e.y;return i*i+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this}lerpVectors(e,i,n){return this.x=e.x+(i.x-e.x)*n,this.y=e.y+(i.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this}rotateAround(e,i){const n=Math.cos(i),s=Math.sin(i),o=this.x-e.x,l=this.y-e.y;return this.x=o*n-l*s+e.x,this.y=o*s+l*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},Fh=class QH{constructor(e,i,n,s,o,l,u,c,h){QH.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,i,n,s,o,l,u,c,h)}set(e,i,n,s,o,l,u,c,h){const p=this.elements;return p[0]=e,p[1]=s,p[2]=u,p[3]=i,p[4]=o,p[5]=c,p[6]=n,p[7]=l,p[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const i=this.elements,n=e.elements;return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],this}extractBasis(e,i,n){return e.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const i=e.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const n=e.elements,s=i.elements,o=this.elements,l=n[0],u=n[3],c=n[6],h=n[1],p=n[4],f=n[7],g=n[2],m=n[5],y=n[8],b=s[0],v=s[3],_=s[6],C=s[1],E=s[4],T=s[7],R=s[2],B=s[5],I=s[8];return o[0]=l*b+u*C+c*R,o[3]=l*v+u*E+c*B,o[6]=l*_+u*T+c*I,o[1]=h*b+p*C+f*R,o[4]=h*v+p*E+f*B,o[7]=h*_+p*T+f*I,o[2]=g*b+m*C+y*R,o[5]=g*v+m*E+y*B,o[8]=g*_+m*T+y*I,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=e,i[4]*=e,i[7]*=e,i[2]*=e,i[5]*=e,i[8]*=e,this}determinant(){const e=this.elements,i=e[0],n=e[1],s=e[2],o=e[3],l=e[4],u=e[5],c=e[6],h=e[7],p=e[8];return i*l*p-i*u*h-n*o*p+n*u*c+s*o*h-s*l*c}invert(){const e=this.elements,i=e[0],n=e[1],s=e[2],o=e[3],l=e[4],u=e[5],c=e[6],h=e[7],p=e[8],f=p*l-u*h,g=u*c-p*o,m=h*o-l*c,y=i*f+n*g+s*m;if(y===0)return this.set(0,0,0,0,0,0,0,0,0);const b=1/y;return e[0]=f*b,e[1]=(s*h-p*n)*b,e[2]=(u*n-s*l)*b,e[3]=g*b,e[4]=(p*i-s*c)*b,e[5]=(s*o-u*i)*b,e[6]=m*b,e[7]=(n*c-h*i)*b,e[8]=(l*i-n*o)*b,this}transpose(){let e;const i=this.elements;return e=i[1],i[1]=i[3],i[3]=e,e=i[2],i[2]=i[6],i[6]=e,e=i[5],i[5]=i[7],i[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const i=this.elements;return e[0]=i[0],e[1]=i[3],e[2]=i[6],e[3]=i[1],e[4]=i[4],e[5]=i[7],e[6]=i[2],e[7]=i[5],e[8]=i[8],this}setUvTransform(e,i,n,s,o,l,u){const c=Math.cos(o),h=Math.sin(o);return this.set(n*c,n*h,-n*(c*l+h*u)+l+e,-s*h,s*c,-s*(-h*l+c*u)+u+i,0,0,1),this}scale(e,i){return this.premultiply(eC.makeScale(e,i)),this}rotate(e){return this.premultiply(eC.makeRotation(-e)),this}translate(e,i){return this.premultiply(eC.makeTranslation(e,i)),this}makeTranslation(e,i){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,i,0,0,1),this}makeRotation(e){const i=Math.cos(e),n=Math.sin(e);return this.set(i,-n,0,n,i,0,0,0,1),this}makeScale(e,i){return this.set(e,0,0,0,i,0,0,0,1),this}equals(e){const i=this.elements,n=e.elements;for(let s=0;s<9;s++)if(i[s]!==n[s])return!1;return!0}fromArray(e,i=0){for(let n=0;n<9;n++)this.elements[n]=e[n+i];return this}toArray(e=[],i=0){const n=this.elements;return e[i]=n[0],e[i+1]=n[1],e[i+2]=n[2],e[i+3]=n[3],e[i+4]=n[4],e[i+5]=n[5],e[i+6]=n[6],e[i+7]=n[7],e[i+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}};const eC=new Fh;function MX(r){for(let e=r.length-1;e>=0;--e)if(r[e]>=65535)return!0;return!1}function tC(r){return document.createElementNS("http://www.w3.org/1999/xhtml",r)}const vO={};function RX(r){r in vO||(vO[r]=!0,console.warn(r))}const bO=new Fh().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),xO=new Fh().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),bb={[Y2]:{transfer:J2,primaries:fO,toReference:r=>r,fromReference:r=>r},[Nl]:{transfer:pO,primaries:fO,toReference:r=>r.convertSRGBToLinear(),fromReference:r=>r.convertLinearToSRGB()},[dO]:{transfer:J2,primaries:mO,toReference:r=>r.applyMatrix3(xO),fromReference:r=>r.applyMatrix3(bO)},[uX]:{transfer:pO,primaries:mO,toReference:r=>r.convertSRGBToLinear().applyMatrix3(xO),fromReference:r=>r.applyMatrix3(bO).convertLinearToSRGB()}},IX=new Set([Y2,dO]),Zl={enabled:!0,_workingColorSpace:Y2,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(r){if(!IX.has(r))throw new Error(`Unsupported working color space, "${r}".`);this._workingColorSpace=r},convert:function(r,e,i){if(this.enabled===!1||e===i||!e||!i)return r;const n=bb[e].toReference,s=bb[i].fromReference;return s(n(r))},fromWorkingColorSpace:function(r,e){return this.convert(r,this._workingColorSpace,e)},toWorkingColorSpace:function(r,e){return this.convert(r,e,this._workingColorSpace)},getPrimaries:function(r){return bb[r].primaries},getTransfer:function(r){return r===hO?J2:bb[r].transfer}};function Kf(r){return r<.04045?r*.0773993808:Math.pow(r*.9478672986+.0521327014,2.4)}function iC(r){return r<.0031308?r*12.92:1.055*Math.pow(r,.41666)-.055}let Yf,BX=class{static getDataURL(r){if(/^data:/i.test(r.src)||typeof HTMLCanvasElement>"u")return r.src;let e;if(r instanceof HTMLCanvasElement)e=r;else{Yf===void 0&&(Yf=tC("canvas")),Yf.width=r.width,Yf.height=r.height;const i=Yf.getContext("2d");r instanceof ImageData?i.putImageData(r,0,0):i.drawImage(r,0,0,r.width,r.height),e=Yf}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",r),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(r){if(typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap){const e=tC("canvas");e.width=r.width,e.height=r.height;const i=e.getContext("2d");i.drawImage(r,0,0,r.width,r.height);const n=i.getImageData(0,0,r.width,r.height),s=n.data;for(let o=0;o<s.length;o++)s[o]=Kf(s[o]/255)*255;return i.putImageData(n,0,0),e}else if(r.data){const e=r.data.slice(0);for(let i=0;i<e.length;i++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[i]=Math.floor(Kf(e[i]/255)*255):e[i]=Kf(e[i]);return{data:e,width:r.width,height:r.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),r}},NX=0,LX=class{constructor(r=null){this.isSource=!0,Object.defineProperty(this,"id",{value:NX++}),this.uuid=kh(),this.data=r,this.dataReady=!0,this.version=0}set needsUpdate(r){r===!0&&this.version++}toJSON(r){const e=r===void 0||typeof r=="string";if(!e&&r.images[this.uuid]!==void 0)return r.images[this.uuid];const i={uuid:this.uuid,url:""},n=this.data;if(n!==null){let s;if(Array.isArray(n)){s=[];for(let o=0,l=n.length;o<l;o++)n[o].isDataTexture?s.push(rC(n[o].image)):s.push(rC(n[o]))}else s=rC(n);i.url=s}return e||(r.images[this.uuid]=i),i}};function rC(r){return typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap?BX.getDataURL(r):r.data?{data:Array.from(r.data),width:r.width,height:r.height,type:r.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let DX=0,Au=class c2 extends vb{constructor(e=c2.DEFAULT_IMAGE,i=c2.DEFAULT_MAPPING,n=Qf,s=Qf,o=nX,l=sX,u=sO,c=aX,h=c2.DEFAULT_ANISOTROPY,p=hO){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:DX++}),this.uuid=kh(),this.name="",this.source=new LX(e),this.mipmaps=[],this.mapping=i,this.channel=0,this.wrapS=n,this.wrapT=s,this.magFilter=o,this.minFilter=l,this.anisotropy=h,this.format=u,this.internalFormat=null,this.type=c,this.offset=new Vs(0,0),this.repeat=new Vs(1,1),this.center=new Vs(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Fh,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=p,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),i||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==iO)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case mb:e.x=e.x-Math.floor(e.x);break;case Qf:e.x=e.x<0?0:1;break;case rO:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case mb:e.y=e.y-Math.floor(e.y);break;case Qf:e.y=e.y<0?0:1;break;case rO:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}};Au.DEFAULT_IMAGE=null,Au.DEFAULT_MAPPING=iO,Au.DEFAULT_ANISOTROPY=1;let Uo=class qH{constructor(e=0,i=0,n=0,s=1){qH.prototype.isVector4=!0,this.x=e,this.y=i,this.z=n,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,i,n,s){return this.x=e,this.y=i,this.z=n,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this.w=e.w+i.w,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this.w+=e.w*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this.w=e.w-i.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const i=this.x,n=this.y,s=this.z,o=this.w,l=e.elements;return this.x=l[0]*i+l[4]*n+l[8]*s+l[12]*o,this.y=l[1]*i+l[5]*n+l[9]*s+l[13]*o,this.z=l[2]*i+l[6]*n+l[10]*s+l[14]*o,this.w=l[3]*i+l[7]*n+l[11]*s+l[15]*o,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const i=Math.sqrt(1-e.w*e.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/i,this.y=e.y/i,this.z=e.z/i),this}setAxisAngleFromRotationMatrix(e){let i,n,s,o;const l=e.elements,u=l[0],c=l[4],h=l[8],p=l[1],f=l[5],g=l[9],m=l[2],y=l[6],b=l[10];if(Math.abs(c-p)<.01&&Math.abs(h-m)<.01&&Math.abs(g-y)<.01){if(Math.abs(c+p)<.1&&Math.abs(h+m)<.1&&Math.abs(g+y)<.1&&Math.abs(u+f+b-3)<.1)return this.set(1,0,0,0),this;i=Math.PI;const _=(u+1)/2,C=(f+1)/2,E=(b+1)/2,T=(c+p)/4,R=(h+m)/4,B=(g+y)/4;return _>C&&_>E?_<.01?(n=0,s=.707106781,o=.707106781):(n=Math.sqrt(_),s=T/n,o=R/n):C>E?C<.01?(n=.707106781,s=0,o=.707106781):(s=Math.sqrt(C),n=T/s,o=B/s):E<.01?(n=.707106781,s=.707106781,o=0):(o=Math.sqrt(E),n=R/o,s=B/o),this.set(n,s,o,i),this}let v=Math.sqrt((y-g)*(y-g)+(h-m)*(h-m)+(p-c)*(p-c));return Math.abs(v)<.001&&(v=1),this.x=(y-g)/v,this.y=(h-m)/v,this.z=(p-c)/v,this.w=Math.acos((u+f+b-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this.w=Math.max(e.w,Math.min(i.w,this.w)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this.w=Math.max(e,Math.min(i,this.w)),this}clampLength(e,i){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(i,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this.w+=(e.w-this.w)*i,this}lerpVectors(e,i,n){return this.x=e.x+(i.x-e.x)*n,this.y=e.y+(i.y-e.y)*n,this.z=e.z+(i.z-e.z)*n,this.w=e.w+(i.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this.w=e[i+3],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e[i+3]=this.w,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this.w=e.getW(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},zo=class{constructor(r=0,e=0,i=0,n=1){this.isQuaternion=!0,this._x=r,this._y=e,this._z=i,this._w=n}static slerpFlat(r,e,i,n,s,o,l){let u=i[n+0],c=i[n+1],h=i[n+2],p=i[n+3];const f=s[o+0],g=s[o+1],m=s[o+2],y=s[o+3];if(l===0){r[e+0]=u,r[e+1]=c,r[e+2]=h,r[e+3]=p;return}if(l===1){r[e+0]=f,r[e+1]=g,r[e+2]=m,r[e+3]=y;return}if(p!==y||u!==f||c!==g||h!==m){let b=1-l;const v=u*f+c*g+h*m+p*y,_=v>=0?1:-1,C=1-v*v;if(C>Number.EPSILON){const T=Math.sqrt(C),R=Math.atan2(T,v*_);b=Math.sin(b*R)/T,l=Math.sin(l*R)/T}const E=l*_;if(u=u*b+f*E,c=c*b+g*E,h=h*b+m*E,p=p*b+y*E,b===1-l){const T=1/Math.sqrt(u*u+c*c+h*h+p*p);u*=T,c*=T,h*=T,p*=T}}r[e]=u,r[e+1]=c,r[e+2]=h,r[e+3]=p}static multiplyQuaternionsFlat(r,e,i,n,s,o){const l=i[n],u=i[n+1],c=i[n+2],h=i[n+3],p=s[o],f=s[o+1],g=s[o+2],m=s[o+3];return r[e]=l*m+h*p+u*g-c*f,r[e+1]=u*m+h*f+c*p-l*g,r[e+2]=c*m+h*g+l*f-u*p,r[e+3]=h*m-l*p-u*f-c*g,r}get x(){return this._x}set x(r){this._x=r,this._onChangeCallback()}get y(){return this._y}set y(r){this._y=r,this._onChangeCallback()}get z(){return this._z}set z(r){this._z=r,this._onChangeCallback()}get w(){return this._w}set w(r){this._w=r,this._onChangeCallback()}set(r,e,i,n){return this._x=r,this._y=e,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(r){return this._x=r.x,this._y=r.y,this._z=r.z,this._w=r.w,this._onChangeCallback(),this}setFromEuler(r,e=!0){const i=r._x,n=r._y,s=r._z,o=r._order,l=Math.cos,u=Math.sin,c=l(i/2),h=l(n/2),p=l(s/2),f=u(i/2),g=u(n/2),m=u(s/2);switch(o){case"XYZ":this._x=f*h*p+c*g*m,this._y=c*g*p-f*h*m,this._z=c*h*m+f*g*p,this._w=c*h*p-f*g*m;break;case"YXZ":this._x=f*h*p+c*g*m,this._y=c*g*p-f*h*m,this._z=c*h*m-f*g*p,this._w=c*h*p+f*g*m;break;case"ZXY":this._x=f*h*p-c*g*m,this._y=c*g*p+f*h*m,this._z=c*h*m+f*g*p,this._w=c*h*p-f*g*m;break;case"ZYX":this._x=f*h*p-c*g*m,this._y=c*g*p+f*h*m,this._z=c*h*m-f*g*p,this._w=c*h*p+f*g*m;break;case"YZX":this._x=f*h*p+c*g*m,this._y=c*g*p+f*h*m,this._z=c*h*m-f*g*p,this._w=c*h*p-f*g*m;break;case"XZY":this._x=f*h*p-c*g*m,this._y=c*g*p-f*h*m,this._z=c*h*m+f*g*p,this._w=c*h*p+f*g*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return e===!0&&this._onChangeCallback(),this}setFromAxisAngle(r,e){const i=e/2,n=Math.sin(i);return this._x=r.x*n,this._y=r.y*n,this._z=r.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(r){const e=r.elements,i=e[0],n=e[4],s=e[8],o=e[1],l=e[5],u=e[9],c=e[2],h=e[6],p=e[10],f=i+l+p;if(f>0){const g=.5/Math.sqrt(f+1);this._w=.25/g,this._x=(h-u)*g,this._y=(s-c)*g,this._z=(o-n)*g}else if(i>l&&i>p){const g=2*Math.sqrt(1+i-l-p);this._w=(h-u)/g,this._x=.25*g,this._y=(n+o)/g,this._z=(s+c)/g}else if(l>p){const g=2*Math.sqrt(1+l-i-p);this._w=(s-c)/g,this._x=(n+o)/g,this._y=.25*g,this._z=(u+h)/g}else{const g=2*Math.sqrt(1+p-i-l);this._w=(o-n)/g,this._x=(s+c)/g,this._y=(u+h)/g,this._z=.25*g}return this._onChangeCallback(),this}setFromUnitVectors(r,e){let i=r.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(r.x)>Math.abs(r.z)?(this._x=-r.y,this._y=r.x,this._z=0,this._w=i):(this._x=0,this._y=-r.z,this._z=r.y,this._w=i)):(this._x=r.y*e.z-r.z*e.y,this._y=r.z*e.x-r.x*e.z,this._z=r.x*e.y-r.y*e.x,this._w=i),this.normalize()}angleTo(r){return 2*Math.acos(Math.abs(ka(this.dot(r),-1,1)))}rotateTowards(r,e){const i=this.angleTo(r);if(i===0)return this;const n=Math.min(1,e/i);return this.slerp(r,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(r){return this._x*r._x+this._y*r._y+this._z*r._z+this._w*r._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let r=this.length();return r===0?(this._x=0,this._y=0,this._z=0,this._w=1):(r=1/r,this._x=this._x*r,this._y=this._y*r,this._z=this._z*r,this._w=this._w*r),this._onChangeCallback(),this}multiply(r){return this.multiplyQuaternions(this,r)}premultiply(r){return this.multiplyQuaternions(r,this)}multiplyQuaternions(r,e){const i=r._x,n=r._y,s=r._z,o=r._w,l=e._x,u=e._y,c=e._z,h=e._w;return this._x=i*h+o*l+n*c-s*u,this._y=n*h+o*u+s*l-i*c,this._z=s*h+o*c+i*u-n*l,this._w=o*h-i*l-n*u-s*c,this._onChangeCallback(),this}slerp(r,e){if(e===0)return this;if(e===1)return this.copy(r);const i=this._x,n=this._y,s=this._z,o=this._w;let l=o*r._w+i*r._x+n*r._y+s*r._z;if(l<0?(this._w=-r._w,this._x=-r._x,this._y=-r._y,this._z=-r._z,l=-l):this.copy(r),l>=1)return this._w=o,this._x=i,this._y=n,this._z=s,this;const u=1-l*l;if(u<=Number.EPSILON){const g=1-e;return this._w=g*o+e*this._w,this._x=g*i+e*this._x,this._y=g*n+e*this._y,this._z=g*s+e*this._z,this.normalize(),this}const c=Math.sqrt(u),h=Math.atan2(c,l),p=Math.sin((1-e)*h)/c,f=Math.sin(e*h)/c;return this._w=o*p+this._w*f,this._x=i*p+this._x*f,this._y=n*p+this._y*f,this._z=s*p+this._z*f,this._onChangeCallback(),this}slerpQuaternions(r,e,i){return this.copy(r).slerp(e,i)}random(){const r=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),i=Math.random(),n=Math.sqrt(1-i),s=Math.sqrt(i);return this.set(n*Math.sin(r),n*Math.cos(r),s*Math.sin(e),s*Math.cos(e))}equals(r){return r._x===this._x&&r._y===this._y&&r._z===this._z&&r._w===this._w}fromArray(r,e=0){return this._x=r[e],this._y=r[e+1],this._z=r[e+2],this._w=r[e+3],this._onChangeCallback(),this}toArray(r=[],e=0){return r[e]=this._x,r[e+1]=this._y,r[e+2]=this._z,r[e+3]=this._w,r}fromBufferAttribute(r,e){return this._x=r.getX(e),this._y=r.getY(e),this._z=r.getZ(e),this._w=r.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(r){return this._onChangeCallback=r,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},kt=class XH{constructor(e=0,i=0,n=0){XH.prototype.isVector3=!0,this.x=e,this.y=i,this.z=n}set(e,i,n){return n===void 0&&(n=this.z),this.x=e,this.y=i,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,i){return this.x=e.x*i.x,this.y=e.y*i.y,this.z=e.z*i.z,this}applyEuler(e){return this.applyQuaternion(_O.setFromEuler(e))}applyAxisAngle(e,i){return this.applyQuaternion(_O.setFromAxisAngle(e,i))}applyMatrix3(e){const i=this.x,n=this.y,s=this.z,o=e.elements;return this.x=o[0]*i+o[3]*n+o[6]*s,this.y=o[1]*i+o[4]*n+o[7]*s,this.z=o[2]*i+o[5]*n+o[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const i=this.x,n=this.y,s=this.z,o=e.elements,l=1/(o[3]*i+o[7]*n+o[11]*s+o[15]);return this.x=(o[0]*i+o[4]*n+o[8]*s+o[12])*l,this.y=(o[1]*i+o[5]*n+o[9]*s+o[13])*l,this.z=(o[2]*i+o[6]*n+o[10]*s+o[14])*l,this}applyQuaternion(e){const i=this.x,n=this.y,s=this.z,o=e.x,l=e.y,u=e.z,c=e.w,h=2*(l*s-u*n),p=2*(u*i-o*s),f=2*(o*n-l*i);return this.x=i+c*h+l*f-u*p,this.y=n+c*p+u*h-o*f,this.z=s+c*f+o*p-l*h,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const i=this.x,n=this.y,s=this.z,o=e.elements;return this.x=o[0]*i+o[4]*n+o[8]*s,this.y=o[1]*i+o[5]*n+o[9]*s,this.z=o[2]*i+o[6]*n+o[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this}clampLength(e,i){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(i,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this}lerpVectors(e,i,n){return this.x=e.x+(i.x-e.x)*n,this.y=e.y+(i.y-e.y)*n,this.z=e.z+(i.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,i){const n=e.x,s=e.y,o=e.z,l=i.x,u=i.y,c=i.z;return this.x=s*c-o*u,this.y=o*l-n*c,this.z=n*u-s*l,this}projectOnVector(e){const i=e.lengthSq();if(i===0)return this.set(0,0,0);const n=e.dot(this)/i;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return nC.copy(this).projectOnVector(e),this.sub(nC)}reflect(e){return this.sub(nC.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const n=this.dot(e)/i;return Math.acos(ka(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,n=this.y-e.y,s=this.z-e.z;return i*i+n*n+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,i,n){const s=Math.sin(i)*e;return this.x=s*Math.sin(n),this.y=Math.cos(i)*e,this.z=s*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,i,n){return this.x=e*Math.sin(i),this.y=n,this.z=e*Math.cos(i),this}setFromMatrixPosition(e){const i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(e){const i=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=i,this.y=n,this.z=s,this}setFromMatrixColumn(e,i){return this.fromArray(e.elements,i*4)}setFromMatrix3Column(e,i){return this.fromArray(e.elements,i*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,i=Math.random()*2-1,n=Math.sqrt(1-i*i);return this.x=n*Math.cos(e),this.y=i,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};const nC=new kt,_O=new zo;let Jf=class{constructor(r=new kt(1/0,1/0,1/0),e=new kt(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=r,this.max=e}set(r,e){return this.min.copy(r),this.max.copy(e),this}setFromArray(r){this.makeEmpty();for(let e=0,i=r.length;e<i;e+=3)this.expandByPoint($l.fromArray(r,e));return this}setFromBufferAttribute(r){this.makeEmpty();for(let e=0,i=r.count;e<i;e++)this.expandByPoint($l.fromBufferAttribute(r,e));return this}setFromPoints(r){this.makeEmpty();for(let e=0,i=r.length;e<i;e++)this.expandByPoint(r[e]);return this}setFromCenterAndSize(r,e){const i=$l.copy(e).multiplyScalar(.5);return this.min.copy(r).sub(i),this.max.copy(r).add(i),this}setFromObject(r,e=!1){return this.makeEmpty(),this.expandByObject(r,e)}clone(){return new this.constructor().copy(this)}copy(r){return this.min.copy(r.min),this.max.copy(r.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(r){return this.isEmpty()?r.set(0,0,0):r.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(r){return this.isEmpty()?r.set(0,0,0):r.subVectors(this.max,this.min)}expandByPoint(r){return this.min.min(r),this.max.max(r),this}expandByVector(r){return this.min.sub(r),this.max.add(r),this}expandByScalar(r){return this.min.addScalar(-r),this.max.addScalar(r),this}expandByObject(r,e=!1){r.updateWorldMatrix(!1,!1);const i=r.geometry;if(i!==void 0){const s=i.getAttribute("position");if(e===!0&&s!==void 0&&r.isInstancedMesh!==!0)for(let o=0,l=s.count;o<l;o++)r.isMesh===!0?r.getVertexPosition(o,$l):$l.fromBufferAttribute(s,o),$l.applyMatrix4(r.matrixWorld),this.expandByPoint($l);else r.boundingBox!==void 0?(r.boundingBox===null&&r.computeBoundingBox(),xb.copy(r.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),xb.copy(i.boundingBox)),xb.applyMatrix4(r.matrixWorld),this.union(xb)}const n=r.children;for(let s=0,o=n.length;s<o;s++)this.expandByObject(n[s],e);return this}containsPoint(r){return!(r.x<this.min.x||r.x>this.max.x||r.y<this.min.y||r.y>this.max.y||r.z<this.min.z||r.z>this.max.z)}containsBox(r){return this.min.x<=r.min.x&&r.max.x<=this.max.x&&this.min.y<=r.min.y&&r.max.y<=this.max.y&&this.min.z<=r.min.z&&r.max.z<=this.max.z}getParameter(r,e){return e.set((r.x-this.min.x)/(this.max.x-this.min.x),(r.y-this.min.y)/(this.max.y-this.min.y),(r.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(r){return!(r.max.x<this.min.x||r.min.x>this.max.x||r.max.y<this.min.y||r.min.y>this.max.y||r.max.z<this.min.z||r.min.z>this.max.z)}intersectsSphere(r){return this.clampPoint(r.center,$l),$l.distanceToSquared(r.center)<=r.radius*r.radius}intersectsPlane(r){let e,i;return r.normal.x>0?(e=r.normal.x*this.min.x,i=r.normal.x*this.max.x):(e=r.normal.x*this.max.x,i=r.normal.x*this.min.x),r.normal.y>0?(e+=r.normal.y*this.min.y,i+=r.normal.y*this.max.y):(e+=r.normal.y*this.max.y,i+=r.normal.y*this.min.y),r.normal.z>0?(e+=r.normal.z*this.min.z,i+=r.normal.z*this.max.z):(e+=r.normal.z*this.max.z,i+=r.normal.z*this.min.z),e<=-r.constant&&i>=-r.constant}intersectsTriangle(r){if(this.isEmpty())return!1;this.getCenter(tA),_b.subVectors(this.max,tA),Zf.subVectors(r.a,tA),$f.subVectors(r.b,tA),em.subVectors(r.c,tA),Uh.subVectors($f,Zf),zh.subVectors(em,$f),sp.subVectors(Zf,em);let e=[0,-Uh.z,Uh.y,0,-zh.z,zh.y,0,-sp.z,sp.y,Uh.z,0,-Uh.x,zh.z,0,-zh.x,sp.z,0,-sp.x,-Uh.y,Uh.x,0,-zh.y,zh.x,0,-sp.y,sp.x,0];return!sC(e,Zf,$f,em,_b)||(e=[1,0,0,0,1,0,0,0,1],!sC(e,Zf,$f,em,_b))?!1:(Eb.crossVectors(Uh,zh),e=[Eb.x,Eb.y,Eb.z],sC(e,Zf,$f,em,_b))}clampPoint(r,e){return e.copy(r).clamp(this.min,this.max)}distanceToPoint(r){return this.clampPoint(r,$l).distanceTo(r)}getBoundingSphere(r){return this.isEmpty()?r.makeEmpty():(this.getCenter(r.center),r.radius=this.getSize($l).length()*.5),r}intersect(r){return this.min.max(r.min),this.max.min(r.max),this.isEmpty()&&this.makeEmpty(),this}union(r){return this.min.min(r.min),this.max.max(r.max),this}applyMatrix4(r){return this.isEmpty()?this:(yu[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(r),yu[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(r),yu[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(r),yu[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(r),yu[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(r),yu[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(r),yu[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(r),yu[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(r),this.setFromPoints(yu),this)}translate(r){return this.min.add(r),this.max.add(r),this}equals(r){return r.min.equals(this.min)&&r.max.equals(this.max)}};const yu=[new kt,new kt,new kt,new kt,new kt,new kt,new kt,new kt],$l=new kt,xb=new Jf,Zf=new kt,$f=new kt,em=new kt,Uh=new kt,zh=new kt,sp=new kt,tA=new kt,_b=new kt,Eb=new kt,ap=new kt;function sC(r,e,i,n,s){for(let o=0,l=r.length-3;o<=l;o+=3){ap.fromArray(r,o);const u=s.x*Math.abs(ap.x)+s.y*Math.abs(ap.y)+s.z*Math.abs(ap.z),c=e.dot(ap),h=i.dot(ap),p=n.dot(ap);if(Math.max(-Math.max(c,h,p),Math.min(c,h,p))>u)return!1}return!0}const OX=new Jf,iA=new kt,aC=new kt;let tm=class{constructor(r=new kt,e=-1){this.isSphere=!0,this.center=r,this.radius=e}set(r,e){return this.center.copy(r),this.radius=e,this}setFromPoints(r,e){const i=this.center;e!==void 0?i.copy(e):OX.setFromPoints(r).getCenter(i);let n=0;for(let s=0,o=r.length;s<o;s++)n=Math.max(n,i.distanceToSquared(r[s]));return this.radius=Math.sqrt(n),this}copy(r){return this.center.copy(r.center),this.radius=r.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(r){return r.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(r){return r.distanceTo(this.center)-this.radius}intersectsSphere(r){const e=this.radius+r.radius;return r.center.distanceToSquared(this.center)<=e*e}intersectsBox(r){return r.intersectsSphere(this)}intersectsPlane(r){return Math.abs(r.distanceToPoint(this.center))<=this.radius}clampPoint(r,e){const i=this.center.distanceToSquared(r);return e.copy(r),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(r){return this.isEmpty()?(r.makeEmpty(),r):(r.set(this.center,this.center),r.expandByScalar(this.radius),r)}applyMatrix4(r){return this.center.applyMatrix4(r),this.radius=this.radius*r.getMaxScaleOnAxis(),this}translate(r){return this.center.add(r),this}expandByPoint(r){if(this.isEmpty())return this.center.copy(r),this.radius=0,this;iA.subVectors(r,this.center);const e=iA.lengthSq();if(e>this.radius*this.radius){const i=Math.sqrt(e),n=(i-this.radius)*.5;this.center.addScaledVector(iA,n/i),this.radius+=n}return this}union(r){return r.isEmpty()?this:this.isEmpty()?(this.copy(r),this):(this.center.equals(r.center)===!0?this.radius=Math.max(this.radius,r.radius):(aC.subVectors(r.center,this.center).setLength(r.radius),this.expandByPoint(iA.copy(r.center).add(aC)),this.expandByPoint(iA.copy(r.center).sub(aC))),this)}equals(r){return r.center.equals(this.center)&&r.radius===this.radius}clone(){return new this.constructor().copy(this)}};const vu=new kt,oC=new kt,wb=new kt,jh=new kt,lC=new kt,Cb=new kt,cC=new kt;let uC=class{constructor(r=new kt,e=new kt(0,0,-1)){this.origin=r,this.direction=e}set(r,e){return this.origin.copy(r),this.direction.copy(e),this}copy(r){return this.origin.copy(r.origin),this.direction.copy(r.direction),this}at(r,e){return e.copy(this.origin).addScaledVector(this.direction,r)}lookAt(r){return this.direction.copy(r).sub(this.origin).normalize(),this}recast(r){return this.origin.copy(this.at(r,vu)),this}closestPointToPoint(r,e){e.subVectors(r,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(r){return Math.sqrt(this.distanceSqToPoint(r))}distanceSqToPoint(r){const e=vu.subVectors(r,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(r):(vu.copy(this.origin).addScaledVector(this.direction,e),vu.distanceToSquared(r))}distanceSqToSegment(r,e,i,n){oC.copy(r).add(e).multiplyScalar(.5),wb.copy(e).sub(r).normalize(),jh.copy(this.origin).sub(oC);const s=r.distanceTo(e)*.5,o=-this.direction.dot(wb),l=jh.dot(this.direction),u=-jh.dot(wb),c=jh.lengthSq(),h=Math.abs(1-o*o);let p,f,g,m;if(h>0)if(p=o*u-l,f=o*l-u,m=s*h,p>=0)if(f>=-m)if(f<=m){const y=1/h;p*=y,f*=y,g=p*(p+o*f+2*l)+f*(o*p+f+2*u)+c}else f=s,p=Math.max(0,-(o*f+l)),g=-p*p+f*(f+2*u)+c;else f=-s,p=Math.max(0,-(o*f+l)),g=-p*p+f*(f+2*u)+c;else f<=-m?(p=Math.max(0,-(-o*s+l)),f=p>0?-s:Math.min(Math.max(-s,-u),s),g=-p*p+f*(f+2*u)+c):f<=m?(p=0,f=Math.min(Math.max(-s,-u),s),g=f*(f+2*u)+c):(p=Math.max(0,-(o*s+l)),f=p>0?s:Math.min(Math.max(-s,-u),s),g=-p*p+f*(f+2*u)+c);else f=o>0?-s:s,p=Math.max(0,-(o*f+l)),g=-p*p+f*(f+2*u)+c;return i&&i.copy(this.origin).addScaledVector(this.direction,p),n&&n.copy(oC).addScaledVector(wb,f),g}intersectSphere(r,e){vu.subVectors(r.center,this.origin);const i=vu.dot(this.direction),n=vu.dot(vu)-i*i,s=r.radius*r.radius;if(n>s)return null;const o=Math.sqrt(s-n),l=i-o,u=i+o;return u<0?null:l<0?this.at(u,e):this.at(l,e)}intersectsSphere(r){return this.distanceSqToPoint(r.center)<=r.radius*r.radius}distanceToPlane(r){const e=r.normal.dot(this.direction);if(e===0)return r.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(r.normal)+r.constant)/e;return i>=0?i:null}intersectPlane(r,e){const i=this.distanceToPlane(r);return i===null?null:this.at(i,e)}intersectsPlane(r){const e=r.distanceToPoint(this.origin);return e===0||r.normal.dot(this.direction)*e<0}intersectBox(r,e){let i,n,s,o,l,u;const c=1/this.direction.x,h=1/this.direction.y,p=1/this.direction.z,f=this.origin;return c>=0?(i=(r.min.x-f.x)*c,n=(r.max.x-f.x)*c):(i=(r.max.x-f.x)*c,n=(r.min.x-f.x)*c),h>=0?(s=(r.min.y-f.y)*h,o=(r.max.y-f.y)*h):(s=(r.max.y-f.y)*h,o=(r.min.y-f.y)*h),i>o||s>n||((s>i||isNaN(i))&&(i=s),(o<n||isNaN(n))&&(n=o),p>=0?(l=(r.min.z-f.z)*p,u=(r.max.z-f.z)*p):(l=(r.max.z-f.z)*p,u=(r.min.z-f.z)*p),i>u||l>n)||((l>i||i!==i)&&(i=l),(u<n||n!==n)&&(n=u),n<0)?null:this.at(i>=0?i:n,e)}intersectsBox(r){return this.intersectBox(r,vu)!==null}intersectTriangle(r,e,i,n,s){lC.subVectors(e,r),Cb.subVectors(i,r),cC.crossVectors(lC,Cb);let o=this.direction.dot(cC),l;if(o>0){if(n)return null;l=1}else if(o<0)l=-1,o=-o;else return null;jh.subVectors(this.origin,r);const u=l*this.direction.dot(Cb.crossVectors(jh,Cb));if(u<0)return null;const c=l*this.direction.dot(lC.cross(jh));if(c<0||u+c>o)return null;const h=-l*jh.dot(cC);return h<0?null:this.at(h/o,s)}applyMatrix4(r){return this.origin.applyMatrix4(r),this.direction.transformDirection(r),this}equals(r){return r.origin.equals(this.origin)&&r.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},Hr=class TL{constructor(e,i,n,s,o,l,u,c,h,p,f,g,m,y,b,v){TL.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,i,n,s,o,l,u,c,h,p,f,g,m,y,b,v)}set(e,i,n,s,o,l,u,c,h,p,f,g,m,y,b,v){const _=this.elements;return _[0]=e,_[4]=i,_[8]=n,_[12]=s,_[1]=o,_[5]=l,_[9]=u,_[13]=c,_[2]=h,_[6]=p,_[10]=f,_[14]=g,_[3]=m,_[7]=y,_[11]=b,_[15]=v,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new TL().fromArray(this.elements)}copy(e){const i=this.elements,n=e.elements;return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],this}copyPosition(e){const i=this.elements,n=e.elements;return i[12]=n[12],i[13]=n[13],i[14]=n[14],this}setFromMatrix3(e){const i=e.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(e,i,n){return e.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,i,n){return this.set(e.x,i.x,n.x,0,e.y,i.y,n.y,0,e.z,i.z,n.z,0,0,0,0,1),this}extractRotation(e){const i=this.elements,n=e.elements,s=1/im.setFromMatrixColumn(e,0).length(),o=1/im.setFromMatrixColumn(e,1).length(),l=1/im.setFromMatrixColumn(e,2).length();return i[0]=n[0]*s,i[1]=n[1]*s,i[2]=n[2]*s,i[3]=0,i[4]=n[4]*o,i[5]=n[5]*o,i[6]=n[6]*o,i[7]=0,i[8]=n[8]*l,i[9]=n[9]*l,i[10]=n[10]*l,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(e){const i=this.elements,n=e.x,s=e.y,o=e.z,l=Math.cos(n),u=Math.sin(n),c=Math.cos(s),h=Math.sin(s),p=Math.cos(o),f=Math.sin(o);if(e.order==="XYZ"){const g=l*p,m=l*f,y=u*p,b=u*f;i[0]=c*p,i[4]=-c*f,i[8]=h,i[1]=m+y*h,i[5]=g-b*h,i[9]=-u*c,i[2]=b-g*h,i[6]=y+m*h,i[10]=l*c}else if(e.order==="YXZ"){const g=c*p,m=c*f,y=h*p,b=h*f;i[0]=g+b*u,i[4]=y*u-m,i[8]=l*h,i[1]=l*f,i[5]=l*p,i[9]=-u,i[2]=m*u-y,i[6]=b+g*u,i[10]=l*c}else if(e.order==="ZXY"){const g=c*p,m=c*f,y=h*p,b=h*f;i[0]=g-b*u,i[4]=-l*f,i[8]=y+m*u,i[1]=m+y*u,i[5]=l*p,i[9]=b-g*u,i[2]=-l*h,i[6]=u,i[10]=l*c}else if(e.order==="ZYX"){const g=l*p,m=l*f,y=u*p,b=u*f;i[0]=c*p,i[4]=y*h-m,i[8]=g*h+b,i[1]=c*f,i[5]=b*h+g,i[9]=m*h-y,i[2]=-h,i[6]=u*c,i[10]=l*c}else if(e.order==="YZX"){const g=l*c,m=l*h,y=u*c,b=u*h;i[0]=c*p,i[4]=b-g*f,i[8]=y*f+m,i[1]=f,i[5]=l*p,i[9]=-u*p,i[2]=-h*p,i[6]=m*f+y,i[10]=g-b*f}else if(e.order==="XZY"){const g=l*c,m=l*h,y=u*c,b=u*h;i[0]=c*p,i[4]=-f,i[8]=h*p,i[1]=g*f+b,i[5]=l*p,i[9]=m*f-y,i[2]=y*f-m,i[6]=u*p,i[10]=b*f+g}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(e){return this.compose(PX,e,kX)}lookAt(e,i,n){const s=this.elements;return ul.subVectors(e,i),ul.lengthSq()===0&&(ul.z=1),ul.normalize(),Gh.crossVectors(n,ul),Gh.lengthSq()===0&&(Math.abs(n.z)===1?ul.x+=1e-4:ul.z+=1e-4,ul.normalize(),Gh.crossVectors(n,ul)),Gh.normalize(),Sb.crossVectors(ul,Gh),s[0]=Gh.x,s[4]=Sb.x,s[8]=ul.x,s[1]=Gh.y,s[5]=Sb.y,s[9]=ul.y,s[2]=Gh.z,s[6]=Sb.z,s[10]=ul.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const n=e.elements,s=i.elements,o=this.elements,l=n[0],u=n[4],c=n[8],h=n[12],p=n[1],f=n[5],g=n[9],m=n[13],y=n[2],b=n[6],v=n[10],_=n[14],C=n[3],E=n[7],T=n[11],R=n[15],B=s[0],I=s[4],D=s[8],L=s[12],O=s[1],F=s[5],q=s[9],H=s[13],G=s[2],J=s[6],Q=s[10],V=s[14],z=s[3],te=s[7],K=s[11],ae=s[15];return o[0]=l*B+u*O+c*G+h*z,o[4]=l*I+u*F+c*J+h*te,o[8]=l*D+u*q+c*Q+h*K,o[12]=l*L+u*H+c*V+h*ae,o[1]=p*B+f*O+g*G+m*z,o[5]=p*I+f*F+g*J+m*te,o[9]=p*D+f*q+g*Q+m*K,o[13]=p*L+f*H+g*V+m*ae,o[2]=y*B+b*O+v*G+_*z,o[6]=y*I+b*F+v*J+_*te,o[10]=y*D+b*q+v*Q+_*K,o[14]=y*L+b*H+v*V+_*ae,o[3]=C*B+E*O+T*G+R*z,o[7]=C*I+E*F+T*J+R*te,o[11]=C*D+E*q+T*Q+R*K,o[15]=C*L+E*H+T*V+R*ae,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[4]*=e,i[8]*=e,i[12]*=e,i[1]*=e,i[5]*=e,i[9]*=e,i[13]*=e,i[2]*=e,i[6]*=e,i[10]*=e,i[14]*=e,i[3]*=e,i[7]*=e,i[11]*=e,i[15]*=e,this}determinant(){const e=this.elements,i=e[0],n=e[4],s=e[8],o=e[12],l=e[1],u=e[5],c=e[9],h=e[13],p=e[2],f=e[6],g=e[10],m=e[14],y=e[3],b=e[7],v=e[11],_=e[15];return y*(+o*c*f-s*h*f-o*u*g+n*h*g+s*u*m-n*c*m)+b*(+i*c*m-i*h*g+o*l*g-s*l*m+s*h*p-o*c*p)+v*(+i*h*f-i*u*m-o*l*f+n*l*m+o*u*p-n*h*p)+_*(-s*u*p-i*c*f+i*u*g+s*l*f-n*l*g+n*c*p)}transpose(){const e=this.elements;let i;return i=e[1],e[1]=e[4],e[4]=i,i=e[2],e[2]=e[8],e[8]=i,i=e[6],e[6]=e[9],e[9]=i,i=e[3],e[3]=e[12],e[12]=i,i=e[7],e[7]=e[13],e[13]=i,i=e[11],e[11]=e[14],e[14]=i,this}setPosition(e,i,n){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=i,s[14]=n),this}invert(){const e=this.elements,i=e[0],n=e[1],s=e[2],o=e[3],l=e[4],u=e[5],c=e[6],h=e[7],p=e[8],f=e[9],g=e[10],m=e[11],y=e[12],b=e[13],v=e[14],_=e[15],C=f*v*h-b*g*h+b*c*m-u*v*m-f*c*_+u*g*_,E=y*g*h-p*v*h-y*c*m+l*v*m+p*c*_-l*g*_,T=p*b*h-y*f*h+y*u*m-l*b*m-p*u*_+l*f*_,R=y*f*c-p*b*c-y*u*g+l*b*g+p*u*v-l*f*v,B=i*C+n*E+s*T+o*R;if(B===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const I=1/B;return e[0]=C*I,e[1]=(b*g*o-f*v*o-b*s*m+n*v*m+f*s*_-n*g*_)*I,e[2]=(u*v*o-b*c*o+b*s*h-n*v*h-u*s*_+n*c*_)*I,e[3]=(f*c*o-u*g*o-f*s*h+n*g*h+u*s*m-n*c*m)*I,e[4]=E*I,e[5]=(p*v*o-y*g*o+y*s*m-i*v*m-p*s*_+i*g*_)*I,e[6]=(y*c*o-l*v*o-y*s*h+i*v*h+l*s*_-i*c*_)*I,e[7]=(l*g*o-p*c*o+p*s*h-i*g*h-l*s*m+i*c*m)*I,e[8]=T*I,e[9]=(y*f*o-p*b*o-y*n*m+i*b*m+p*n*_-i*f*_)*I,e[10]=(l*b*o-y*u*o+y*n*h-i*b*h-l*n*_+i*u*_)*I,e[11]=(p*u*o-l*f*o-p*n*h+i*f*h+l*n*m-i*u*m)*I,e[12]=R*I,e[13]=(p*b*s-y*f*s+y*n*g-i*b*g-p*n*v+i*f*v)*I,e[14]=(y*u*s-l*b*s-y*n*c+i*b*c+l*n*v-i*u*v)*I,e[15]=(l*f*s-p*u*s+p*n*c-i*f*c-l*n*g+i*u*g)*I,this}scale(e){const i=this.elements,n=e.x,s=e.y,o=e.z;return i[0]*=n,i[4]*=s,i[8]*=o,i[1]*=n,i[5]*=s,i[9]*=o,i[2]*=n,i[6]*=s,i[10]*=o,i[3]*=n,i[7]*=s,i[11]*=o,this}getMaxScaleOnAxis(){const e=this.elements,i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(i,n,s))}makeTranslation(e,i,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,i,0,0,1,n,0,0,0,1),this}makeRotationX(e){const i=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,i,-n,0,0,n,i,0,0,0,0,1),this}makeRotationY(e){const i=Math.cos(e),n=Math.sin(e);return this.set(i,0,n,0,0,1,0,0,-n,0,i,0,0,0,0,1),this}makeRotationZ(e){const i=Math.cos(e),n=Math.sin(e);return this.set(i,-n,0,0,n,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,i){const n=Math.cos(i),s=Math.sin(i),o=1-n,l=e.x,u=e.y,c=e.z,h=o*l,p=o*u;return this.set(h*l+n,h*u-s*c,h*c+s*u,0,h*u+s*c,p*u+n,p*c-s*l,0,h*c-s*u,p*c+s*l,o*c*c+n,0,0,0,0,1),this}makeScale(e,i,n){return this.set(e,0,0,0,0,i,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,i,n,s,o,l){return this.set(1,n,o,0,e,1,l,0,i,s,1,0,0,0,0,1),this}compose(e,i,n){const s=this.elements,o=i._x,l=i._y,u=i._z,c=i._w,h=o+o,p=l+l,f=u+u,g=o*h,m=o*p,y=o*f,b=l*p,v=l*f,_=u*f,C=c*h,E=c*p,T=c*f,R=n.x,B=n.y,I=n.z;return s[0]=(1-(b+_))*R,s[1]=(m+T)*R,s[2]=(y-E)*R,s[3]=0,s[4]=(m-T)*B,s[5]=(1-(g+_))*B,s[6]=(v+C)*B,s[7]=0,s[8]=(y+E)*I,s[9]=(v-C)*I,s[10]=(1-(g+b))*I,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,i,n){const s=this.elements;let o=im.set(s[0],s[1],s[2]).length();const l=im.set(s[4],s[5],s[6]).length(),u=im.set(s[8],s[9],s[10]).length();this.determinant()<0&&(o=-o),e.x=s[12],e.y=s[13],e.z=s[14],ec.copy(this);const c=1/o,h=1/l,p=1/u;return ec.elements[0]*=c,ec.elements[1]*=c,ec.elements[2]*=c,ec.elements[4]*=h,ec.elements[5]*=h,ec.elements[6]*=h,ec.elements[8]*=p,ec.elements[9]*=p,ec.elements[10]*=p,i.setFromRotationMatrix(ec),n.x=o,n.y=l,n.z=u,this}makePerspective(e,i,n,s,o,l,u=np){const c=this.elements,h=2*o/(i-e),p=2*o/(n-s),f=(i+e)/(i-e),g=(n+s)/(n-s);let m,y;if(u===np)m=-(l+o)/(l-o),y=-2*l*o/(l-o);else if(u===Z2)m=-l/(l-o),y=-l*o/(l-o);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+u);return c[0]=h,c[4]=0,c[8]=f,c[12]=0,c[1]=0,c[5]=p,c[9]=g,c[13]=0,c[2]=0,c[6]=0,c[10]=m,c[14]=y,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,i,n,s,o,l,u=np){const c=this.elements,h=1/(i-e),p=1/(n-s),f=1/(l-o),g=(i+e)*h,m=(n+s)*p;let y,b;if(u===np)y=(l+o)*f,b=-2*f;else if(u===Z2)y=o*f,b=-1*f;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+u);return c[0]=2*h,c[4]=0,c[8]=0,c[12]=-g,c[1]=0,c[5]=2*p,c[9]=0,c[13]=-m,c[2]=0,c[6]=0,c[10]=b,c[14]=-y,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const i=this.elements,n=e.elements;for(let s=0;s<16;s++)if(i[s]!==n[s])return!1;return!0}fromArray(e,i=0){for(let n=0;n<16;n++)this.elements[n]=e[n+i];return this}toArray(e=[],i=0){const n=this.elements;return e[i]=n[0],e[i+1]=n[1],e[i+2]=n[2],e[i+3]=n[3],e[i+4]=n[4],e[i+5]=n[5],e[i+6]=n[6],e[i+7]=n[7],e[i+8]=n[8],e[i+9]=n[9],e[i+10]=n[10],e[i+11]=n[11],e[i+12]=n[12],e[i+13]=n[13],e[i+14]=n[14],e[i+15]=n[15],e}};const im=new kt,ec=new Hr,PX=new kt(0,0,0),kX=new kt(1,1,1),Gh=new kt,Sb=new kt,ul=new kt,EO=new Hr,wO=new zo;let yo=class KH{constructor(e=0,i=0,n=0,s=KH.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=i,this._z=n,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,i,n,s=this._order){return this._x=e,this._y=i,this._z=n,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,i=this._order,n=!0){const s=e.elements,o=s[0],l=s[4],u=s[8],c=s[1],h=s[5],p=s[9],f=s[2],g=s[6],m=s[10];switch(i){case"XYZ":this._y=Math.asin(ka(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-p,m),this._z=Math.atan2(-l,o)):(this._x=Math.atan2(g,h),this._z=0);break;case"YXZ":this._x=Math.asin(-ka(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(u,m),this._z=Math.atan2(c,h)):(this._y=Math.atan2(-f,o),this._z=0);break;case"ZXY":this._x=Math.asin(ka(g,-1,1)),Math.abs(g)<.9999999?(this._y=Math.atan2(-f,m),this._z=Math.atan2(-l,h)):(this._y=0,this._z=Math.atan2(c,o));break;case"ZYX":this._y=Math.asin(-ka(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(g,m),this._z=Math.atan2(c,o)):(this._x=0,this._z=Math.atan2(-l,h));break;case"YZX":this._z=Math.asin(ka(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-p,h),this._y=Math.atan2(-f,o)):(this._x=0,this._y=Math.atan2(u,m));break;case"XZY":this._z=Math.asin(-ka(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(g,h),this._y=Math.atan2(u,o)):(this._x=Math.atan2(-p,m),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,i,n){return EO.makeRotationFromQuaternion(e),this.setFromRotationMatrix(EO,i,n)}setFromVector3(e,i=this._order){return this.set(e.x,e.y,e.z,i)}reorder(e){return wO.setFromEuler(this),this.setFromQuaternion(wO,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};yo.DEFAULT_ORDER="XYZ";let FX=class{constructor(){this.mask=1}set(r){this.mask=(1<<r|0)>>>0}enable(r){this.mask|=1<<r|0}enableAll(){this.mask=-1}toggle(r){this.mask^=1<<r|0}disable(r){this.mask&=~(1<<r|0)}disableAll(){this.mask=0}test(r){return(this.mask&r.mask)!==0}isEnabled(r){return(this.mask&(1<<r|0))!==0}},UX=0;const CO=new kt,rm=new zo,bu=new Hr,Tb=new kt,rA=new kt,zX=new kt,jX=new zo,SO=new kt(1,0,0),TO=new kt(0,1,0),MO=new kt(0,0,1),RO={type:"added"},GX={type:"removed"},nm={type:"childadded",child:null},hC={type:"childremoved",child:null};let Fa=class u2 extends vb{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:UX++}),this.uuid=kh(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=u2.DEFAULT_UP.clone();const e=new kt,i=new yo,n=new zo,s=new kt(1,1,1);function o(){n.setFromEuler(i,!1)}function l(){i.setFromQuaternion(n,void 0,!1)}i._onChange(o),n._onChange(l),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new Hr},normalMatrix:{value:new Fh}}),this.matrix=new Hr,this.matrixWorld=new Hr,this.matrixAutoUpdate=u2.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=u2.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new FX,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,i){this.quaternion.setFromAxisAngle(e,i)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,i){return rm.setFromAxisAngle(e,i),this.quaternion.multiply(rm),this}rotateOnWorldAxis(e,i){return rm.setFromAxisAngle(e,i),this.quaternion.premultiply(rm),this}rotateX(e){return this.rotateOnAxis(SO,e)}rotateY(e){return this.rotateOnAxis(TO,e)}rotateZ(e){return this.rotateOnAxis(MO,e)}translateOnAxis(e,i){return CO.copy(e).applyQuaternion(this.quaternion),this.position.add(CO.multiplyScalar(i)),this}translateX(e){return this.translateOnAxis(SO,e)}translateY(e){return this.translateOnAxis(TO,e)}translateZ(e){return this.translateOnAxis(MO,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(bu.copy(this.matrixWorld).invert())}lookAt(e,i,n){e.isVector3?Tb.copy(e):Tb.set(e,i,n);const s=this.parent;this.updateWorldMatrix(!0,!1),rA.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?bu.lookAt(rA,Tb,this.up):bu.lookAt(Tb,rA,this.up),this.quaternion.setFromRotationMatrix(bu),s&&(bu.extractRotation(s.matrixWorld),rm.setFromRotationMatrix(bu),this.quaternion.premultiply(rm.invert()))}add(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(RO),nm.child=e,this.dispatchEvent(nm),nm.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const i=this.children.indexOf(e);return i!==-1&&(e.parent=null,this.children.splice(i,1),e.dispatchEvent(GX),hC.child=e,this.dispatchEvent(hC),hC.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),bu.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),bu.multiply(e.parent.matrixWorld)),e.applyMatrix4(bu),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(RO),nm.child=e,this.dispatchEvent(nm),nm.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,i){if(this[e]===i)return this;for(let n=0,s=this.children.length;n<s;n++){const o=this.children[n].getObjectByProperty(e,i);if(o!==void 0)return o}}getObjectsByProperty(e,i,n=[]){this[e]===i&&n.push(this);const s=this.children;for(let o=0,l=s.length;o<l;o++)s[o].getObjectsByProperty(e,i,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(rA,e,zX),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(rA,jX,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return e.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(e){e(this);const i=this.children;for(let n=0,s=i.length;n<s;n++)i[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const i=this.children;for(let n=0,s=i.length;n<s;n++)i[n].traverseVisible(e)}traverseAncestors(e){const i=this.parent;i!==null&&(e(i),i.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const i=this.children;for(let n=0,s=i.length;n<s;n++){const o=i[n];(o.matrixWorldAutoUpdate===!0||e===!0)&&o.updateMatrixWorld(e)}}updateWorldMatrix(e,i){const n=this.parent;if(e===!0&&n!==null&&n.matrixWorldAutoUpdate===!0&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),i===!0){const s=this.children;for(let o=0,l=s.length;o<l;o++){const u=s[o];u.matrixWorldAutoUpdate===!0&&u.updateWorldMatrix(!1,!0)}}}toJSON(e){const i=e===void 0||typeof e=="string",n={};i&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.visibility=this._visibility,s.active=this._active,s.bounds=this._bounds.map(u=>({boxInitialized:u.boxInitialized,boxMin:u.box.min.toArray(),boxMax:u.box.max.toArray(),sphereInitialized:u.sphereInitialized,sphereRadius:u.sphere.radius,sphereCenter:u.sphere.center.toArray()})),s.maxGeometryCount=this._maxGeometryCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.geometryCount=this._geometryCount,s.matricesTexture=this._matricesTexture.toJSON(e),this.boundingSphere!==null&&(s.boundingSphere={center:s.boundingSphere.center.toArray(),radius:s.boundingSphere.radius}),this.boundingBox!==null&&(s.boundingBox={min:s.boundingBox.min.toArray(),max:s.boundingBox.max.toArray()}));function o(u,c){return u[c.uuid]===void 0&&(u[c.uuid]=c.toJSON(e)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=o(e.geometries,this.geometry);const u=this.geometry.parameters;if(u!==void 0&&u.shapes!==void 0){const c=u.shapes;if(Array.isArray(c))for(let h=0,p=c.length;h<p;h++){const f=c[h];o(e.shapes,f)}else o(e.shapes,c)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(o(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const u=[];for(let c=0,h=this.material.length;c<h;c++)u.push(o(e.materials,this.material[c]));s.material=u}else s.material=o(e.materials,this.material);if(this.children.length>0){s.children=[];for(let u=0;u<this.children.length;u++)s.children.push(this.children[u].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let u=0;u<this.animations.length;u++){const c=this.animations[u];s.animations.push(o(e.animations,c))}}if(i){const u=l(e.geometries),c=l(e.materials),h=l(e.textures),p=l(e.images),f=l(e.shapes),g=l(e.skeletons),m=l(e.animations),y=l(e.nodes);u.length>0&&(n.geometries=u),c.length>0&&(n.materials=c),h.length>0&&(n.textures=h),p.length>0&&(n.images=p),f.length>0&&(n.shapes=f),g.length>0&&(n.skeletons=g),m.length>0&&(n.animations=m),y.length>0&&(n.nodes=y)}return n.object=s,n;function l(u){const c=[];for(const h in u){const p=u[h];delete p.metadata,c.push(p)}return c}}clone(e){return new this.constructor().copy(this,e)}copy(e,i=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),i===!0)for(let n=0;n<e.children.length;n++){const s=e.children[n];this.add(s.clone())}return this}};Fa.DEFAULT_UP=new kt(0,1,0),Fa.DEFAULT_MATRIX_AUTO_UPDATE=!0,Fa.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const tc=new kt,xu=new kt,dC=new kt,_u=new kt,sm=new kt,am=new kt,IO=new kt,pC=new kt,fC=new kt,mC=new kt;let Mb=class k0{constructor(e=new kt,i=new kt,n=new kt){this.a=e,this.b=i,this.c=n}static getNormal(e,i,n,s){s.subVectors(n,i),tc.subVectors(e,i),s.cross(tc);const o=s.lengthSq();return o>0?s.multiplyScalar(1/Math.sqrt(o)):s.set(0,0,0)}static getBarycoord(e,i,n,s,o){tc.subVectors(s,i),xu.subVectors(n,i),dC.subVectors(e,i);const l=tc.dot(tc),u=tc.dot(xu),c=tc.dot(dC),h=xu.dot(xu),p=xu.dot(dC),f=l*h-u*u;if(f===0)return o.set(0,0,0),null;const g=1/f,m=(h*c-u*p)*g,y=(l*p-u*c)*g;return o.set(1-m-y,y,m)}static containsPoint(e,i,n,s){return this.getBarycoord(e,i,n,s,_u)===null?!1:_u.x>=0&&_u.y>=0&&_u.x+_u.y<=1}static getInterpolation(e,i,n,s,o,l,u,c){return this.getBarycoord(e,i,n,s,_u)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(o,_u.x),c.addScaledVector(l,_u.y),c.addScaledVector(u,_u.z),c)}static isFrontFacing(e,i,n,s){return tc.subVectors(n,i),xu.subVectors(e,i),tc.cross(xu).dot(s)<0}set(e,i,n){return this.a.copy(e),this.b.copy(i),this.c.copy(n),this}setFromPointsAndIndices(e,i,n,s){return this.a.copy(e[i]),this.b.copy(e[n]),this.c.copy(e[s]),this}setFromAttributeAndIndices(e,i,n,s){return this.a.fromBufferAttribute(e,i),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return tc.subVectors(this.c,this.b),xu.subVectors(this.a,this.b),tc.cross(xu).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return k0.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,i){return k0.getBarycoord(e,this.a,this.b,this.c,i)}getInterpolation(e,i,n,s,o){return k0.getInterpolation(e,this.a,this.b,this.c,i,n,s,o)}containsPoint(e){return k0.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return k0.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,i){const n=this.a,s=this.b,o=this.c;let l,u;sm.subVectors(s,n),am.subVectors(o,n),pC.subVectors(e,n);const c=sm.dot(pC),h=am.dot(pC);if(c<=0&&h<=0)return i.copy(n);fC.subVectors(e,s);const p=sm.dot(fC),f=am.dot(fC);if(p>=0&&f<=p)return i.copy(s);const g=c*f-p*h;if(g<=0&&c>=0&&p<=0)return l=c/(c-p),i.copy(n).addScaledVector(sm,l);mC.subVectors(e,o);const m=sm.dot(mC),y=am.dot(mC);if(y>=0&&m<=y)return i.copy(o);const b=m*h-c*y;if(b<=0&&h>=0&&y<=0)return u=h/(h-y),i.copy(n).addScaledVector(am,u);const v=p*y-m*f;if(v<=0&&f-p>=0&&m-y>=0)return IO.subVectors(o,s),u=(f-p)/(f-p+(m-y)),i.copy(s).addScaledVector(IO,u);const _=1/(v+b+g);return l=b*_,u=g*_,i.copy(n).addScaledVector(sm,l).addScaledVector(am,u)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}};const BO={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Vh={h:0,s:0,l:0},Rb={h:0,s:0,l:0};function gC(r,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?r+(e-r)*6*i:i<1/2?e:i<2/3?r+(e-r)*6*(2/3-i):r}let Ys=class{constructor(r,e,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(r,e,i)}set(r,e,i){if(e===void 0&&i===void 0){const n=r;n&&n.isColor?this.copy(n):typeof n=="number"?this.setHex(n):typeof n=="string"&&this.setStyle(n)}else this.setRGB(r,e,i);return this}setScalar(r){return this.r=r,this.g=r,this.b=r,this}setHex(r,e=Nl){return r=Math.floor(r),this.r=(r>>16&255)/255,this.g=(r>>8&255)/255,this.b=(r&255)/255,Zl.toWorkingColorSpace(this,e),this}setRGB(r,e,i,n=Zl.workingColorSpace){return this.r=r,this.g=e,this.b=i,Zl.toWorkingColorSpace(this,n),this}setHSL(r,e,i,n=Zl.workingColorSpace){if(r=$2(r,1),e=ka(e,0,1),i=ka(i,0,1),e===0)this.r=this.g=this.b=i;else{const s=i<=.5?i*(1+e):i+e-i*e,o=2*i-s;this.r=gC(o,s,r+1/3),this.g=gC(o,s,r),this.b=gC(o,s,r-1/3)}return Zl.toWorkingColorSpace(this,n),this}setStyle(r,e=Nl){function i(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+r+" will be ignored.")}let n;if(n=/^(\w+)\(([^\)]*)\)/.exec(r)){let s;const o=n[1],l=n[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return i(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,e);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return i(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,e);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return i(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+r)}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(r)){const s=n[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,e);if(o===6)return this.setHex(parseInt(s,16),e);console.warn("THREE.Color: Invalid hex color "+r)}else if(r&&r.length>0)return this.setColorName(r,e);return this}setColorName(r,e=Nl){const i=BO[r.toLowerCase()];return i!==void 0?this.setHex(i,e):console.warn("THREE.Color: Unknown color "+r),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(r){return this.r=r.r,this.g=r.g,this.b=r.b,this}copySRGBToLinear(r){return this.r=Kf(r.r),this.g=Kf(r.g),this.b=Kf(r.b),this}copyLinearToSRGB(r){return this.r=iC(r.r),this.g=iC(r.g),this.b=iC(r.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(r=Nl){return Zl.fromWorkingColorSpace($a.copy(this),r),Math.round(ka($a.r*255,0,255))*65536+Math.round(ka($a.g*255,0,255))*256+Math.round(ka($a.b*255,0,255))}getHexString(r=Nl){return("000000"+this.getHex(r).toString(16)).slice(-6)}getHSL(r,e=Zl.workingColorSpace){Zl.fromWorkingColorSpace($a.copy(this),e);const i=$a.r,n=$a.g,s=$a.b,o=Math.max(i,n,s),l=Math.min(i,n,s);let u,c;const h=(l+o)/2;if(l===o)u=0,c=0;else{const p=o-l;switch(c=h<=.5?p/(o+l):p/(2-o-l),o){case i:u=(n-s)/p+(n<s?6:0);break;case n:u=(s-i)/p+2;break;case s:u=(i-n)/p+4;break}u/=6}return r.h=u,r.s=c,r.l=h,r}getRGB(r,e=Zl.workingColorSpace){return Zl.fromWorkingColorSpace($a.copy(this),e),r.r=$a.r,r.g=$a.g,r.b=$a.b,r}getStyle(r=Nl){Zl.fromWorkingColorSpace($a.copy(this),r);const e=$a.r,i=$a.g,n=$a.b;return r!==Nl?`color(${r} ${e.toFixed(3)} ${i.toFixed(3)} ${n.toFixed(3)})`:`rgb(${Math.round(e*255)},${Math.round(i*255)},${Math.round(n*255)})`}offsetHSL(r,e,i){return this.getHSL(Vh),this.setHSL(Vh.h+r,Vh.s+e,Vh.l+i)}add(r){return this.r+=r.r,this.g+=r.g,this.b+=r.b,this}addColors(r,e){return this.r=r.r+e.r,this.g=r.g+e.g,this.b=r.b+e.b,this}addScalar(r){return this.r+=r,this.g+=r,this.b+=r,this}sub(r){return this.r=Math.max(0,this.r-r.r),this.g=Math.max(0,this.g-r.g),this.b=Math.max(0,this.b-r.b),this}multiply(r){return this.r*=r.r,this.g*=r.g,this.b*=r.b,this}multiplyScalar(r){return this.r*=r,this.g*=r,this.b*=r,this}lerp(r,e){return this.r+=(r.r-this.r)*e,this.g+=(r.g-this.g)*e,this.b+=(r.b-this.b)*e,this}lerpColors(r,e,i){return this.r=r.r+(e.r-r.r)*i,this.g=r.g+(e.g-r.g)*i,this.b=r.b+(e.b-r.b)*i,this}lerpHSL(r,e){this.getHSL(Vh),r.getHSL(Rb);const i=eA(Vh.h,Rb.h,e),n=eA(Vh.s,Rb.s,e),s=eA(Vh.l,Rb.l,e);return this.setHSL(i,n,s),this}setFromVector3(r){return this.r=r.x,this.g=r.y,this.b=r.z,this}applyMatrix3(r){const e=this.r,i=this.g,n=this.b,s=r.elements;return this.r=s[0]*e+s[3]*i+s[6]*n,this.g=s[1]*e+s[4]*i+s[7]*n,this.b=s[2]*e+s[5]*i+s[8]*n,this}equals(r){return r.r===this.r&&r.g===this.g&&r.b===this.b}fromArray(r,e=0){return this.r=r[e],this.g=r[e+1],this.b=r[e+2],this}toArray(r=[],e=0){return r[e]=this.r,r[e+1]=this.g,r[e+2]=this.b,r}fromBufferAttribute(r,e){return this.r=r.getX(e),this.g=r.getY(e),this.b=r.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const $a=new Ys;Ys.NAMES=BO;let VX=0,Ib=class extends vb{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:VX++}),this.uuid=kh(),this.name="",this.type="Material",this.blending=YD,this.side=Q2,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=ZD,this.blendDst=$D,this.blendEquation=JD,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Ys(0,0,0),this.blendAlpha=0,this.depthFunc=eO,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=gO,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=qf,this.stencilZFail=qf,this.stencilZPass=qf,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(r){this._alphaTest>0!=r>0&&this.version++,this._alphaTest=r}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(r){if(r!==void 0)for(const e in r){const i=r[e];if(i===void 0){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}const n=this[e];if(n===void 0){console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`);continue}n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[e]=i}}toJSON(r){const e=r===void 0||typeof r=="string";e&&(r={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(r).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(r).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(r).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(i.dispersion=this.dispersion),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(r).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(r).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(r).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(r).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(r).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(r).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(r).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(r).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(r).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(r).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(r).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(r).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(r).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(r).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(r).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(r).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(r).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(r).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(r).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(r).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(r).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==YD&&(i.blending=this.blending),this.side!==Q2&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==ZD&&(i.blendSrc=this.blendSrc),this.blendDst!==$D&&(i.blendDst=this.blendDst),this.blendEquation!==JD&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==eO&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==gO&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==qf&&(i.stencilFail=this.stencilFail),this.stencilZFail!==qf&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==qf&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function n(s){const o=[];for(const l in s){const u=s[l];delete u.metadata,o.push(u)}return o}if(e){const s=n(r.textures),o=n(r.images);s.length>0&&(i.textures=s),o.length>0&&(i.images=o)}return i}clone(){return new this.constructor().copy(this)}copy(r){this.name=r.name,this.blending=r.blending,this.side=r.side,this.vertexColors=r.vertexColors,this.opacity=r.opacity,this.transparent=r.transparent,this.blendSrc=r.blendSrc,this.blendDst=r.blendDst,this.blendEquation=r.blendEquation,this.blendSrcAlpha=r.blendSrcAlpha,this.blendDstAlpha=r.blendDstAlpha,this.blendEquationAlpha=r.blendEquationAlpha,this.blendColor.copy(r.blendColor),this.blendAlpha=r.blendAlpha,this.depthFunc=r.depthFunc,this.depthTest=r.depthTest,this.depthWrite=r.depthWrite,this.stencilWriteMask=r.stencilWriteMask,this.stencilFunc=r.stencilFunc,this.stencilRef=r.stencilRef,this.stencilFuncMask=r.stencilFuncMask,this.stencilFail=r.stencilFail,this.stencilZFail=r.stencilZFail,this.stencilZPass=r.stencilZPass,this.stencilWrite=r.stencilWrite;const e=r.clippingPlanes;let i=null;if(e!==null){const n=e.length;i=new Array(n);for(let s=0;s!==n;++s)i[s]=e[s].clone()}return this.clippingPlanes=i,this.clipIntersection=r.clipIntersection,this.clipShadows=r.clipShadows,this.shadowSide=r.shadowSide,this.colorWrite=r.colorWrite,this.precision=r.precision,this.polygonOffset=r.polygonOffset,this.polygonOffsetFactor=r.polygonOffsetFactor,this.polygonOffsetUnits=r.polygonOffsetUnits,this.dithering=r.dithering,this.alphaTest=r.alphaTest,this.alphaHash=r.alphaHash,this.alphaToCoverage=r.alphaToCoverage,this.premultipliedAlpha=r.premultipliedAlpha,this.forceSinglePass=r.forceSinglePass,this.visible=r.visible,this.toneMapped=r.toneMapped,this.userData=JSON.parse(JSON.stringify(r.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(r){r===!0&&this.version++}},HX=class extends Ib{constructor(r){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Ys(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new yo,this.combine=q2,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.lightMap=r.lightMap,this.lightMapIntensity=r.lightMapIntensity,this.aoMap=r.aoMap,this.aoMapIntensity=r.aoMapIntensity,this.specularMap=r.specularMap,this.alphaMap=r.alphaMap,this.envMap=r.envMap,this.envMapRotation.copy(r.envMapRotation),this.combine=r.combine,this.reflectivity=r.reflectivity,this.refractionRatio=r.refractionRatio,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.wireframeLinecap=r.wireframeLinecap,this.wireframeLinejoin=r.wireframeLinejoin,this.fog=r.fog,this}};const Js=new kt,Bb=new Vs;let om=class{constructor(r,e,i=!1){if(Array.isArray(r))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=r,this.itemSize=e,this.count=r!==void 0?r.length/e:0,this.normalized=i,this.usage=AO,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=nO,this.version=0}onUploadCallback(){}set needsUpdate(r){r===!0&&this.version++}get updateRange(){return RX("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(r){return this.usage=r,this}addUpdateRange(r,e){this.updateRanges.push({start:r,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(r){return this.name=r.name,this.array=new r.array.constructor(r.array),this.itemSize=r.itemSize,this.count=r.count,this.normalized=r.normalized,this.usage=r.usage,this.gpuType=r.gpuType,this}copyAt(r,e,i){r*=this.itemSize,i*=e.itemSize;for(let n=0,s=this.itemSize;n<s;n++)this.array[r+n]=e.array[i+n];return this}copyArray(r){return this.array.set(r),this}applyMatrix3(r){if(this.itemSize===2)for(let e=0,i=this.count;e<i;e++)Bb.fromBufferAttribute(this,e),Bb.applyMatrix3(r),this.setXY(e,Bb.x,Bb.y);else if(this.itemSize===3)for(let e=0,i=this.count;e<i;e++)Js.fromBufferAttribute(this,e),Js.applyMatrix3(r),this.setXYZ(e,Js.x,Js.y,Js.z);return this}applyMatrix4(r){for(let e=0,i=this.count;e<i;e++)Js.fromBufferAttribute(this,e),Js.applyMatrix4(r),this.setXYZ(e,Js.x,Js.y,Js.z);return this}applyNormalMatrix(r){for(let e=0,i=this.count;e<i;e++)Js.fromBufferAttribute(this,e),Js.applyNormalMatrix(r),this.setXYZ(e,Js.x,Js.y,Js.z);return this}transformDirection(r){for(let e=0,i=this.count;e<i;e++)Js.fromBufferAttribute(this,e),Js.transformDirection(r),this.setXYZ(e,Js.x,Js.y,Js.z);return this}set(r,e=0){return this.array.set(r,e),this}getComponent(r,e){let i=this.array[r*this.itemSize+e];return this.normalized&&(i=Xf(i,this.array)),i}setComponent(r,e,i){return this.normalized&&(i=go(i,this.array)),this.array[r*this.itemSize+e]=i,this}getX(r){let e=this.array[r*this.itemSize];return this.normalized&&(e=Xf(e,this.array)),e}setX(r,e){return this.normalized&&(e=go(e,this.array)),this.array[r*this.itemSize]=e,this}getY(r){let e=this.array[r*this.itemSize+1];return this.normalized&&(e=Xf(e,this.array)),e}setY(r,e){return this.normalized&&(e=go(e,this.array)),this.array[r*this.itemSize+1]=e,this}getZ(r){let e=this.array[r*this.itemSize+2];return this.normalized&&(e=Xf(e,this.array)),e}setZ(r,e){return this.normalized&&(e=go(e,this.array)),this.array[r*this.itemSize+2]=e,this}getW(r){let e=this.array[r*this.itemSize+3];return this.normalized&&(e=Xf(e,this.array)),e}setW(r,e){return this.normalized&&(e=go(e,this.array)),this.array[r*this.itemSize+3]=e,this}setXY(r,e,i){return r*=this.itemSize,this.normalized&&(e=go(e,this.array),i=go(i,this.array)),this.array[r+0]=e,this.array[r+1]=i,this}setXYZ(r,e,i,n){return r*=this.itemSize,this.normalized&&(e=go(e,this.array),i=go(i,this.array),n=go(n,this.array)),this.array[r+0]=e,this.array[r+1]=i,this.array[r+2]=n,this}setXYZW(r,e,i,n,s){return r*=this.itemSize,this.normalized&&(e=go(e,this.array),i=go(i,this.array),n=go(n,this.array),s=go(s,this.array)),this.array[r+0]=e,this.array[r+1]=i,this.array[r+2]=n,this.array[r+3]=s,this}onUpload(r){return this.onUploadCallback=r,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const r={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(r.name=this.name),this.usage!==AO&&(r.usage=this.usage),r}},NO=class extends om{constructor(r,e,i){super(new Uint16Array(r),e,i)}},WX=class extends om{constructor(r,e,i){super(new Uint32Array(r),e,i)}},Hh=class extends om{constructor(r,e,i){super(new Float32Array(r),e,i)}},QX=0;const Ll=new Hr,AC=new Fa,lm=new kt,hl=new Jf,nA=new Jf,Sa=new kt;let sA=class YH extends vb{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:QX++}),this.uuid=kh(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(MX(e)?WX:NO)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,i){return this.attributes[e]=i,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,i,n=0){this.groups.push({start:e,count:i,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,i){this.drawRange.start=e,this.drawRange.count=i}applyMatrix4(e){const i=this.attributes.position;i!==void 0&&(i.applyMatrix4(e),i.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const o=new Fh().getNormalMatrix(e);n.applyNormalMatrix(o),n.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(e),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Ll.makeRotationFromQuaternion(e),this.applyMatrix4(Ll),this}rotateX(e){return Ll.makeRotationX(e),this.applyMatrix4(Ll),this}rotateY(e){return Ll.makeRotationY(e),this.applyMatrix4(Ll),this}rotateZ(e){return Ll.makeRotationZ(e),this.applyMatrix4(Ll),this}translate(e,i,n){return Ll.makeTranslation(e,i,n),this.applyMatrix4(Ll),this}scale(e,i,n){return Ll.makeScale(e,i,n),this.applyMatrix4(Ll),this}lookAt(e){return AC.lookAt(e),AC.updateMatrix(),this.applyMatrix4(AC.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(lm).negate(),this.translate(lm.x,lm.y,lm.z),this}setFromPoints(e){const i=[];for(let n=0,s=e.length;n<s;n++){const o=e[n];i.push(o.x,o.y,o.z||0)}return this.setAttribute("position",new Hh(i,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Jf);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new kt(-1/0,-1/0,-1/0),new kt(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),i)for(let n=0,s=i.length;n<s;n++){const o=i[n];hl.setFromBufferAttribute(o),this.morphTargetsRelative?(Sa.addVectors(this.boundingBox.min,hl.min),this.boundingBox.expandByPoint(Sa),Sa.addVectors(this.boundingBox.max,hl.max),this.boundingBox.expandByPoint(Sa)):(this.boundingBox.expandByPoint(hl.min),this.boundingBox.expandByPoint(hl.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new tm);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new kt,1/0);return}if(e){const n=this.boundingSphere.center;if(hl.setFromBufferAttribute(e),i)for(let o=0,l=i.length;o<l;o++){const u=i[o];nA.setFromBufferAttribute(u),this.morphTargetsRelative?(Sa.addVectors(hl.min,nA.min),hl.expandByPoint(Sa),Sa.addVectors(hl.max,nA.max),hl.expandByPoint(Sa)):(hl.expandByPoint(nA.min),hl.expandByPoint(nA.max))}hl.getCenter(n);let s=0;for(let o=0,l=e.count;o<l;o++)Sa.fromBufferAttribute(e,o),s=Math.max(s,n.distanceToSquared(Sa));if(i)for(let o=0,l=i.length;o<l;o++){const u=i[o],c=this.morphTargetsRelative;for(let h=0,p=u.count;h<p;h++)Sa.fromBufferAttribute(u,h),c&&(lm.fromBufferAttribute(e,h),Sa.add(lm)),s=Math.max(s,n.distanceToSquared(Sa))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,i=this.attributes;if(e===null||i.position===void 0||i.normal===void 0||i.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=i.position,s=i.normal,o=i.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new om(new Float32Array(4*n.count),4));const l=this.getAttribute("tangent"),u=[],c=[];for(let D=0;D<n.count;D++)u[D]=new kt,c[D]=new kt;const h=new kt,p=new kt,f=new kt,g=new Vs,m=new Vs,y=new Vs,b=new kt,v=new kt;function _(D,L,O){h.fromBufferAttribute(n,D),p.fromBufferAttribute(n,L),f.fromBufferAttribute(n,O),g.fromBufferAttribute(o,D),m.fromBufferAttribute(o,L),y.fromBufferAttribute(o,O),p.sub(h),f.sub(h),m.sub(g),y.sub(g);const F=1/(m.x*y.y-y.x*m.y);isFinite(F)&&(b.copy(p).multiplyScalar(y.y).addScaledVector(f,-m.y).multiplyScalar(F),v.copy(f).multiplyScalar(m.x).addScaledVector(p,-y.x).multiplyScalar(F),u[D].add(b),u[L].add(b),u[O].add(b),c[D].add(v),c[L].add(v),c[O].add(v))}let C=this.groups;C.length===0&&(C=[{start:0,count:e.count}]);for(let D=0,L=C.length;D<L;++D){const O=C[D],F=O.start,q=O.count;for(let H=F,G=F+q;H<G;H+=3)_(e.getX(H+0),e.getX(H+1),e.getX(H+2))}const E=new kt,T=new kt,R=new kt,B=new kt;function I(D){R.fromBufferAttribute(s,D),B.copy(R);const L=u[D];E.copy(L),E.sub(R.multiplyScalar(R.dot(L))).normalize(),T.crossVectors(B,L);const O=T.dot(c[D])<0?-1:1;l.setXYZW(D,E.x,E.y,E.z,O)}for(let D=0,L=C.length;D<L;++D){const O=C[D],F=O.start,q=O.count;for(let H=F,G=F+q;H<G;H+=3)I(e.getX(H+0)),I(e.getX(H+1)),I(e.getX(H+2))}}computeVertexNormals(){const e=this.index,i=this.getAttribute("position");if(i!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new om(new Float32Array(i.count*3),3),this.setAttribute("normal",n);else for(let g=0,m=n.count;g<m;g++)n.setXYZ(g,0,0,0);const s=new kt,o=new kt,l=new kt,u=new kt,c=new kt,h=new kt,p=new kt,f=new kt;if(e)for(let g=0,m=e.count;g<m;g+=3){const y=e.getX(g+0),b=e.getX(g+1),v=e.getX(g+2);s.fromBufferAttribute(i,y),o.fromBufferAttribute(i,b),l.fromBufferAttribute(i,v),p.subVectors(l,o),f.subVectors(s,o),p.cross(f),u.fromBufferAttribute(n,y),c.fromBufferAttribute(n,b),h.fromBufferAttribute(n,v),u.add(p),c.add(p),h.add(p),n.setXYZ(y,u.x,u.y,u.z),n.setXYZ(b,c.x,c.y,c.z),n.setXYZ(v,h.x,h.y,h.z)}else for(let g=0,m=i.count;g<m;g+=3)s.fromBufferAttribute(i,g+0),o.fromBufferAttribute(i,g+1),l.fromBufferAttribute(i,g+2),p.subVectors(l,o),f.subVectors(s,o),p.cross(f),n.setXYZ(g+0,p.x,p.y,p.z),n.setXYZ(g+1,p.x,p.y,p.z),n.setXYZ(g+2,p.x,p.y,p.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let i=0,n=e.count;i<n;i++)Sa.fromBufferAttribute(e,i),Sa.normalize(),e.setXYZ(i,Sa.x,Sa.y,Sa.z)}toNonIndexed(){function e(u,c){const h=u.array,p=u.itemSize,f=u.normalized,g=new h.constructor(c.length*p);let m=0,y=0;for(let b=0,v=c.length;b<v;b++){u.isInterleavedBufferAttribute?m=c[b]*u.data.stride+u.offset:m=c[b]*p;for(let _=0;_<p;_++)g[y++]=h[m++]}return new om(g,p,f)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const i=new YH,n=this.index.array,s=this.attributes;for(const u in s){const c=s[u],h=e(c,n);i.setAttribute(u,h)}const o=this.morphAttributes;for(const u in o){const c=[],h=o[u];for(let p=0,f=h.length;p<f;p++){const g=h[p],m=e(g,n);c.push(m)}i.morphAttributes[u]=c}i.morphTargetsRelative=this.morphTargetsRelative;const l=this.groups;for(let u=0,c=l.length;u<c;u++){const h=l[u];i.addGroup(h.start,h.count,h.materialIndex)}return i}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const h in c)c[h]!==void 0&&(e[h]=c[h]);return e}e.data={attributes:{}};const i=this.index;i!==null&&(e.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});const n=this.attributes;for(const c in n){const h=n[c];e.data.attributes[c]=h.toJSON(e.data)}const s={};let o=!1;for(const c in this.morphAttributes){const h=this.morphAttributes[c],p=[];for(let f=0,g=h.length;f<g;f++){const m=h[f];p.push(m.toJSON(e.data))}p.length>0&&(s[c]=p,o=!0)}o&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);const l=this.groups;l.length>0&&(e.data.groups=JSON.parse(JSON.stringify(l)));const u=this.boundingSphere;return u!==null&&(e.data.boundingSphere={center:u.center.toArray(),radius:u.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const i={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone(i));const s=e.attributes;for(const h in s){const p=s[h];this.setAttribute(h,p.clone(i))}const o=e.morphAttributes;for(const h in o){const p=[],f=o[h];for(let g=0,m=f.length;g<m;g++)p.push(f[g].clone(i));this.morphAttributes[h]=p}this.morphTargetsRelative=e.morphTargetsRelative;const l=e.groups;for(let h=0,p=l.length;h<p;h++){const f=l[h];this.addGroup(f.start,f.count,f.materialIndex)}const u=e.boundingBox;u!==null&&(this.boundingBox=u.clone());const c=e.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}};const LO=new Hr,op=new uC,Nb=new tm,DO=new kt,cm=new kt,um=new kt,hm=new kt,yC=new kt,Lb=new kt,Db=new Vs,Ob=new Vs,Pb=new Vs,OO=new kt,PO=new kt,kO=new kt,kb=new kt,Fb=new kt;let FO=class extends Fa{constructor(r=new sA,e=new HX){super(),this.isMesh=!0,this.type="Mesh",this.geometry=r,this.material=e,this.updateMorphTargets()}copy(r,e){return super.copy(r,e),r.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=r.morphTargetInfluences.slice()),r.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},r.morphTargetDictionary)),this.material=Array.isArray(r.material)?r.material.slice():r.material,this.geometry=r.geometry,this}updateMorphTargets(){const r=this.geometry.morphAttributes,e=Object.keys(r);if(e.length>0){const i=r[e[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let n=0,s=i.length;n<s;n++){const o=i[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=n}}}}getVertexPosition(r,e){const i=this.geometry,n=i.attributes.position,s=i.morphAttributes.position,o=i.morphTargetsRelative;e.fromBufferAttribute(n,r);const l=this.morphTargetInfluences;if(s&&l){Lb.set(0,0,0);for(let u=0,c=s.length;u<c;u++){const h=l[u],p=s[u];h!==0&&(yC.fromBufferAttribute(p,r),o?Lb.addScaledVector(yC,h):Lb.addScaledVector(yC.sub(e),h))}e.add(Lb)}return e}raycast(r,e){const i=this.geometry,n=this.material,s=this.matrixWorld;n!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),Nb.copy(i.boundingSphere),Nb.applyMatrix4(s),op.copy(r.ray).recast(r.near),!(Nb.containsPoint(op.origin)===!1&&(op.intersectSphere(Nb,DO)===null||op.origin.distanceToSquared(DO)>(r.far-r.near)**2))&&(LO.copy(s).invert(),op.copy(r.ray).applyMatrix4(LO),!(i.boundingBox!==null&&op.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(r,e,op)))}_computeIntersections(r,e,i){let n;const s=this.geometry,o=this.material,l=s.index,u=s.attributes.position,c=s.attributes.uv,h=s.attributes.uv1,p=s.attributes.normal,f=s.groups,g=s.drawRange;if(l!==null)if(Array.isArray(o))for(let m=0,y=f.length;m<y;m++){const b=f[m],v=o[b.materialIndex],_=Math.max(b.start,g.start),C=Math.min(l.count,Math.min(b.start+b.count,g.start+g.count));for(let E=_,T=C;E<T;E+=3){const R=l.getX(E),B=l.getX(E+1),I=l.getX(E+2);n=Ub(this,v,r,i,c,h,p,R,B,I),n&&(n.faceIndex=Math.floor(E/3),n.face.materialIndex=b.materialIndex,e.push(n))}}else{const m=Math.max(0,g.start),y=Math.min(l.count,g.start+g.count);for(let b=m,v=y;b<v;b+=3){const _=l.getX(b),C=l.getX(b+1),E=l.getX(b+2);n=Ub(this,o,r,i,c,h,p,_,C,E),n&&(n.faceIndex=Math.floor(b/3),e.push(n))}}else if(u!==void 0)if(Array.isArray(o))for(let m=0,y=f.length;m<y;m++){const b=f[m],v=o[b.materialIndex],_=Math.max(b.start,g.start),C=Math.min(u.count,Math.min(b.start+b.count,g.start+g.count));for(let E=_,T=C;E<T;E+=3){const R=E,B=E+1,I=E+2;n=Ub(this,v,r,i,c,h,p,R,B,I),n&&(n.faceIndex=Math.floor(E/3),n.face.materialIndex=b.materialIndex,e.push(n))}}else{const m=Math.max(0,g.start),y=Math.min(u.count,g.start+g.count);for(let b=m,v=y;b<v;b+=3){const _=b,C=b+1,E=b+2;n=Ub(this,o,r,i,c,h,p,_,C,E),n&&(n.faceIndex=Math.floor(b/3),e.push(n))}}}};function qX(r,e,i,n,s,o,l,u){let c;if(e.side===tX?c=n.intersectTriangle(l,o,s,!0,u):c=n.intersectTriangle(s,o,l,e.side===Q2,u),c===null)return null;Fb.copy(u),Fb.applyMatrix4(r.matrixWorld);const h=i.ray.origin.distanceTo(Fb);return h<i.near||h>i.far?null:{distance:h,point:Fb.clone(),object:r}}function Ub(r,e,i,n,s,o,l,u,c,h){r.getVertexPosition(u,cm),r.getVertexPosition(c,um),r.getVertexPosition(h,hm);const p=qX(r,e,i,n,cm,um,hm,kb);if(p){s&&(Db.fromBufferAttribute(s,u),Ob.fromBufferAttribute(s,c),Pb.fromBufferAttribute(s,h),p.uv=Mb.getInterpolation(kb,cm,um,hm,Db,Ob,Pb,new Vs)),o&&(Db.fromBufferAttribute(o,u),Ob.fromBufferAttribute(o,c),Pb.fromBufferAttribute(o,h),p.uv1=Mb.getInterpolation(kb,cm,um,hm,Db,Ob,Pb,new Vs)),l&&(OO.fromBufferAttribute(l,u),PO.fromBufferAttribute(l,c),kO.fromBufferAttribute(l,h),p.normal=Mb.getInterpolation(kb,cm,um,hm,OO,PO,kO,new kt),p.normal.dot(n.direction)>0&&p.normal.multiplyScalar(-1));const f={a:u,b:c,c:h,normal:new kt,materialIndex:0};Mb.getNormal(cm,um,hm,f.normal),p.face=f}return p}let UO=class extends Fa{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Hr,this.projectionMatrix=new Hr,this.projectionMatrixInverse=new Hr,this.coordinateSystem=np}copy(r,e){return super.copy(r,e),this.matrixWorldInverse.copy(r.matrixWorldInverse),this.projectionMatrix.copy(r.projectionMatrix),this.projectionMatrixInverse.copy(r.projectionMatrixInverse),this.coordinateSystem=r.coordinateSystem,this}getWorldDirection(r){return super.getWorldDirection(r).negate()}updateMatrixWorld(r){super.updateMatrixWorld(r),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(r,e){super.updateWorldMatrix(r,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}};const Wh=new kt,zO=new Vs,jO=new Vs;let vC=class extends UO{constructor(r=50,e=1,i=.1,n=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=r,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(r,e){return super.copy(r,e),this.fov=r.fov,this.zoom=r.zoom,this.near=r.near,this.far=r.far,this.focus=r.focus,this.aspect=r.aspect,this.view=r.view===null?null:Object.assign({},r.view),this.filmGauge=r.filmGauge,this.filmOffset=r.filmOffset,this}setFocalLength(r){const e=.5*this.getFilmHeight()/r;this.fov=$0*2*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const r=Math.tan(Z0*.5*this.fov);return .5*this.getFilmHeight()/r}getEffectiveFOV(){return $0*2*Math.atan(Math.tan(Z0*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(r,e,i){Wh.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),e.set(Wh.x,Wh.y).multiplyScalar(-r/Wh.z),Wh.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(Wh.x,Wh.y).multiplyScalar(-r/Wh.z)}getViewSize(r,e){return this.getViewBounds(r,zO,jO),e.subVectors(jO,zO)}setViewOffset(r,e,i,n,s,o){this.aspect=r/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=r,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const r=this.near;let e=r*Math.tan(Z0*.5*this.fov)/this.zoom,i=2*e,n=this.aspect*i,s=-.5*n;const o=this.view;if(this.view!==null&&this.view.enabled){const u=o.fullWidth,c=o.fullHeight;s+=o.offsetX*n/u,e-=o.offsetY*i/c,n*=o.width/u,i*=o.height/c}const l=this.filmOffset;l!==0&&(s+=r*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+n,e,e-i,r,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(r){const e=super.toJSON(r);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}};const bC=new kt,XX=new kt,KX=new Fh;let dm=class{constructor(r=new kt(1,0,0),e=0){this.isPlane=!0,this.normal=r,this.constant=e}set(r,e){return this.normal.copy(r),this.constant=e,this}setComponents(r,e,i,n){return this.normal.set(r,e,i),this.constant=n,this}setFromNormalAndCoplanarPoint(r,e){return this.normal.copy(r),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(r,e,i){const n=bC.subVectors(i,e).cross(XX.subVectors(r,e)).normalize();return this.setFromNormalAndCoplanarPoint(n,r),this}copy(r){return this.normal.copy(r.normal),this.constant=r.constant,this}normalize(){const r=1/this.normal.length();return this.normal.multiplyScalar(r),this.constant*=r,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(r){return this.normal.dot(r)+this.constant}distanceToSphere(r){return this.distanceToPoint(r.center)-r.radius}projectPoint(r,e){return e.copy(r).addScaledVector(this.normal,-this.distanceToPoint(r))}intersectLine(r,e){const i=r.delta(bC),n=this.normal.dot(i);if(n===0)return this.distanceToPoint(r.start)===0?e.copy(r.start):null;const s=-(r.start.dot(this.normal)+this.constant)/n;return s<0||s>1?null:e.copy(r.start).addScaledVector(i,s)}intersectsLine(r){const e=this.distanceToPoint(r.start),i=this.distanceToPoint(r.end);return e<0&&i>0||i<0&&e>0}intersectsBox(r){return r.intersectsPlane(this)}intersectsSphere(r){return r.intersectsPlane(this)}coplanarPoint(r){return r.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(r,e){const i=e||KX.getNormalMatrix(r),n=this.coplanarPoint(bC).applyMatrix4(r),s=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(s),this}translate(r){return this.constant-=r.dot(this.normal),this}equals(r){return r.normal.equals(this.normal)&&r.constant===this.constant}clone(){return new this.constructor().copy(this)}};const lp=new tm,zb=new kt;let YX=class{constructor(r=new dm,e=new dm,i=new dm,n=new dm,s=new dm,o=new dm){this.planes=[r,e,i,n,s,o]}set(r,e,i,n,s,o){const l=this.planes;return l[0].copy(r),l[1].copy(e),l[2].copy(i),l[3].copy(n),l[4].copy(s),l[5].copy(o),this}copy(r){const e=this.planes;for(let i=0;i<6;i++)e[i].copy(r.planes[i]);return this}setFromProjectionMatrix(r,e=np){const i=this.planes,n=r.elements,s=n[0],o=n[1],l=n[2],u=n[3],c=n[4],h=n[5],p=n[6],f=n[7],g=n[8],m=n[9],y=n[10],b=n[11],v=n[12],_=n[13],C=n[14],E=n[15];if(i[0].setComponents(u-s,f-c,b-g,E-v).normalize(),i[1].setComponents(u+s,f+c,b+g,E+v).normalize(),i[2].setComponents(u+o,f+h,b+m,E+_).normalize(),i[3].setComponents(u-o,f-h,b-m,E-_).normalize(),i[4].setComponents(u-l,f-p,b-y,E-C).normalize(),e===np)i[5].setComponents(u+l,f+p,b+y,E+C).normalize();else if(e===Z2)i[5].setComponents(l,p,y,C).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);return this}intersectsObject(r){if(r.boundingSphere!==void 0)r.boundingSphere===null&&r.computeBoundingSphere(),lp.copy(r.boundingSphere).applyMatrix4(r.matrixWorld);else{const e=r.geometry;e.boundingSphere===null&&e.computeBoundingSphere(),lp.copy(e.boundingSphere).applyMatrix4(r.matrixWorld)}return this.intersectsSphere(lp)}intersectsSprite(r){return lp.center.set(0,0,0),lp.radius=.7071067811865476,lp.applyMatrix4(r.matrixWorld),this.intersectsSphere(lp)}intersectsSphere(r){const e=this.planes,i=r.center,n=-r.radius;for(let s=0;s<6;s++)if(e[s].distanceToPoint(i)<n)return!1;return!0}intersectsBox(r){const e=this.planes;for(let i=0;i<6;i++){const n=e[i];if(zb.x=n.normal.x>0?r.max.x:r.min.x,zb.y=n.normal.y>0?r.max.y:r.min.y,zb.z=n.normal.z>0?r.max.z:r.min.z,n.distanceToPoint(zb)<0)return!1}return!0}containsPoint(r){const e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(r)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}},GO=class extends UO{constructor(r=-1,e=1,i=1,n=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=r,this.right=e,this.top=i,this.bottom=n,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(r,e){return super.copy(r,e),this.left=r.left,this.right=r.right,this.top=r.top,this.bottom=r.bottom,this.near=r.near,this.far=r.far,this.zoom=r.zoom,this.view=r.view===null?null:Object.assign({},r.view),this}setViewOffset(r,e,i,n,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=r,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const r=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let s=i-r,o=i+r,l=n+e,u=n-e;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=c*this.view.offsetX,o=s+c*this.view.width,l-=h*this.view.offsetY,u=l-h*this.view.height}this.projectionMatrix.makeOrthographic(s,o,l,u,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(r){const e=super.toJSON(r);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}},JX=class extends Au{constructor(r,e,i,n,s,o,l,u,c,h){if(h=h!==void 0?h:X2,h!==X2&&h!==aO)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&h===X2&&(i=oX),i===void 0&&h===aO&&(i=lX),super(null,n,s,o,l,u,h,i,c),this.isDepthTexture=!0,this.image={width:r,height:e},this.magFilter=l!==void 0?l:gb,this.minFilter=u!==void 0?u:gb,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(r){return super.copy(r),this.compareFunction=r.compareFunction,this}toJSON(r){const e=super.toJSON(r);return this.compareFunction!==null&&(e.compareFunction=this.compareFunction),e}};const ZX=new JX(1,1);ZX.compareFunction=hX;let VO=class extends Fa{constructor(){super(),this.isGroup=!0,this.type="Group"}};const HO=new kt,WO=new Uo,QO=new Uo,$X=new kt,qO=new Hr,jb=new kt,xC=new tm,XO=new Hr,_C=new uC;class eK extends FO{constructor(e,i){super(e,i),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=tO,this.bindMatrix=new Hr,this.bindMatrixInverse=new Hr,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new Jf),this.boundingBox.makeEmpty();const i=e.getAttribute("position");for(let n=0;n<i.count;n++)this.getVertexPosition(n,jb),this.boundingBox.expandByPoint(jb)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new tm),this.boundingSphere.makeEmpty();const i=e.getAttribute("position");for(let n=0;n<i.count;n++)this.getVertexPosition(n,jb),this.boundingSphere.expandByPoint(jb)}copy(e,i){return super.copy(e,i),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,i){const n=this.material,s=this.matrixWorld;n!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),xC.copy(this.boundingSphere),xC.applyMatrix4(s),e.ray.intersectsSphere(xC)!==!1&&(XO.copy(s).invert(),_C.copy(e.ray).applyMatrix4(XO),!(this.boundingBox!==null&&_C.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,i,_C)))}getVertexPosition(e,i){return super.getVertexPosition(e,i),this.applyBoneTransform(e,i),i}bind(e,i){this.skeleton=e,i===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),i=this.matrixWorld),this.bindMatrix.copy(i),this.bindMatrixInverse.copy(i).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Uo,i=this.geometry.attributes.skinWeight;for(let n=0,s=i.count;n<s;n++){e.fromBufferAttribute(i,n);const o=1/e.manhattanLength();o!==1/0?e.multiplyScalar(o):e.set(1,0,0,0),i.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===tO?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===iX?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,i){const n=this.skeleton,s=this.geometry;WO.fromBufferAttribute(s.attributes.skinIndex,e),QO.fromBufferAttribute(s.attributes.skinWeight,e),HO.copy(i).applyMatrix4(this.bindMatrix),i.set(0,0,0);for(let o=0;o<4;o++){const l=QO.getComponent(o);if(l!==0){const u=WO.getComponent(o);qO.multiplyMatrices(n.bones[u].matrixWorld,n.boneInverses[u]),i.addScaledVector($X.copy(HO).applyMatrix4(qO),l)}}return i.applyMatrix4(this.bindMatrixInverse)}}class EC extends Fa{constructor(){super(),this.isBone=!0,this.type="Bone"}}let tK=class extends Au{constructor(r=null,e=1,i=1,n,s,o,l,u,c=gb,h=gb,p,f){super(null,o,l,u,c,h,n,s,p,f),this.isDataTexture=!0,this.image={data:r,width:e,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};const KO=new Hr,iK=new Hr;class wC{constructor(e=[],i=[]){this.uuid=kh(),this.bones=e.slice(0),this.boneInverses=i,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,i=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),i.length===0)this.calculateInverses();else if(e.length!==i.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let n=0,s=this.bones.length;n<s;n++)this.boneInverses.push(new Hr)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,i=this.bones.length;e<i;e++){const n=new Hr;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}pose(){for(let e=0,i=this.bones.length;e<i;e++){const n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,i=this.bones.length;e<i;e++){const n=this.bones[e];n&&(n.parent&&n.parent.isBone?(n.matrix.copy(n.parent.matrixWorld).invert(),n.matrix.multiply(n.matrixWorld)):n.matrix.copy(n.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale))}}update(){const e=this.bones,i=this.boneInverses,n=this.boneMatrices,s=this.boneTexture;for(let o=0,l=e.length;o<l;o++){const u=e[o]?e[o].matrixWorld:iK;KO.multiplyMatrices(u,i[o]),KO.toArray(n,o*16)}s!==null&&(s.needsUpdate=!0)}clone(){return new wC(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const i=new Float32Array(e*e*4);i.set(this.boneMatrices);const n=new tK(i,e,e,sO,nO);return n.needsUpdate=!0,this.boneMatrices=i,this.boneTexture=n,this}getBoneByName(e){for(let i=0,n=this.bones.length;i<n;i++){const s=this.bones[i];if(s.name===e)return s}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,i){this.uuid=e.uuid;for(let n=0,s=e.bones.length;n<s;n++){const o=e.bones[n];let l=i[o];l===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",o),l=new EC),this.bones.push(l),this.boneInverses.push(new Hr().fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const i=this.bones,n=this.boneInverses;for(let s=0,o=i.length;s<o;s++){const l=i[s];e.bones.push(l.uuid);const u=n[s];e.boneInverses.push(u.toArray())}return e}}let YO=class extends Ib{constructor(r){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Ys(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.linewidth=r.linewidth,this.linecap=r.linecap,this.linejoin=r.linejoin,this.fog=r.fog,this}};const Gb=new kt,Vb=new kt,JO=new Hr,aA=new uC,Hb=new tm,CC=new kt,ZO=new kt;let rK=class extends Fa{constructor(r=new sA,e=new YO){super(),this.isLine=!0,this.type="Line",this.geometry=r,this.material=e,this.updateMorphTargets()}copy(r,e){return super.copy(r,e),this.material=Array.isArray(r.material)?r.material.slice():r.material,this.geometry=r.geometry,this}computeLineDistances(){const r=this.geometry;if(r.index===null){const e=r.attributes.position,i=[0];for(let n=1,s=e.count;n<s;n++)Gb.fromBufferAttribute(e,n-1),Vb.fromBufferAttribute(e,n),i[n]=i[n-1],i[n]+=Gb.distanceTo(Vb);r.setAttribute("lineDistance",new Hh(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(r,e){const i=this.geometry,n=this.matrixWorld,s=r.params.Line.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),Hb.copy(i.boundingSphere),Hb.applyMatrix4(n),Hb.radius+=s,r.ray.intersectsSphere(Hb)===!1)return;JO.copy(n).invert(),aA.copy(r.ray).applyMatrix4(JO);const l=s/((this.scale.x+this.scale.y+this.scale.z)/3),u=l*l,c=this.isLineSegments?2:1,h=i.index,p=i.attributes.position;if(h!==null){const f=Math.max(0,o.start),g=Math.min(h.count,o.start+o.count);for(let m=f,y=g-1;m<y;m+=c){const b=h.getX(m),v=h.getX(m+1),_=Wb(this,r,aA,u,b,v);_&&e.push(_)}if(this.isLineLoop){const m=h.getX(g-1),y=h.getX(f),b=Wb(this,r,aA,u,m,y);b&&e.push(b)}}else{const f=Math.max(0,o.start),g=Math.min(p.count,o.start+o.count);for(let m=f,y=g-1;m<y;m+=c){const b=Wb(this,r,aA,u,m,m+1);b&&e.push(b)}if(this.isLineLoop){const m=Wb(this,r,aA,u,g-1,f);m&&e.push(m)}}}updateMorphTargets(){const r=this.geometry.morphAttributes,e=Object.keys(r);if(e.length>0){const i=r[e[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let n=0,s=i.length;n<s;n++){const o=i[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=n}}}}};function Wb(r,e,i,n,s,o){const l=r.geometry.attributes.position;if(Gb.fromBufferAttribute(l,s),Vb.fromBufferAttribute(l,o),i.distanceSqToSegment(Gb,Vb,CC,ZO)>n)return;CC.applyMatrix4(r.matrixWorld);const u=e.ray.origin.distanceTo(CC);if(!(u<e.near||u>e.far))return{distance:u,point:ZO.clone().applyMatrix4(r.matrixWorld),index:s,face:null,faceIndex:null,object:r}}let nK=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(r,e){const i=this.getUtoTmapping(r);return this.getPoint(i,e)}getPoints(r=5){const e=[];for(let i=0;i<=r;i++)e.push(this.getPoint(i/r));return e}getSpacedPoints(r=5){const e=[];for(let i=0;i<=r;i++)e.push(this.getPointAt(i/r));return e}getLength(){const r=this.getLengths();return r[r.length-1]}getLengths(r=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===r+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let i,n=this.getPoint(0),s=0;e.push(0);for(let o=1;o<=r;o++)i=this.getPoint(o/r),s+=i.distanceTo(n),e.push(s),n=i;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(r,e){const i=this.getLengths();let n=0;const s=i.length;let o;e?o=e:o=r*i[s-1];let l=0,u=s-1,c;for(;l<=u;)if(n=Math.floor(l+(u-l)/2),c=i[n]-o,c<0)l=n+1;else if(c>0)u=n-1;else{u=n;break}if(n=u,i[n]===o)return n/(s-1);const h=i[n],p=i[n+1]-h,f=(o-h)/p;return(n+f)/(s-1)}getTangent(r,e){let i=r-1e-4,n=r+1e-4;i<0&&(i=0),n>1&&(n=1);const s=this.getPoint(i),o=this.getPoint(n),l=e||(s.isVector2?new Vs:new kt);return l.copy(o).sub(s).normalize(),l}getTangentAt(r,e){const i=this.getUtoTmapping(r);return this.getTangent(i,e)}computeFrenetFrames(r,e){const i=new kt,n=[],s=[],o=[],l=new kt,u=new Hr;for(let g=0;g<=r;g++){const m=g/r;n[g]=this.getTangentAt(m,new kt)}s[0]=new kt,o[0]=new kt;let c=Number.MAX_VALUE;const h=Math.abs(n[0].x),p=Math.abs(n[0].y),f=Math.abs(n[0].z);h<=c&&(c=h,i.set(1,0,0)),p<=c&&(c=p,i.set(0,1,0)),f<=c&&i.set(0,0,1),l.crossVectors(n[0],i).normalize(),s[0].crossVectors(n[0],l),o[0].crossVectors(n[0],s[0]);for(let g=1;g<=r;g++){if(s[g]=s[g-1].clone(),o[g]=o[g-1].clone(),l.crossVectors(n[g-1],n[g]),l.length()>Number.EPSILON){l.normalize();const m=Math.acos(ka(n[g-1].dot(n[g]),-1,1));s[g].applyMatrix4(u.makeRotationAxis(l,m))}o[g].crossVectors(n[g],s[g])}if(e===!0){let g=Math.acos(ka(s[0].dot(s[r]),-1,1));g/=r,n[0].dot(l.crossVectors(s[0],s[r]))>0&&(g=-g);for(let m=1;m<=r;m++)s[m].applyMatrix4(u.makeRotationAxis(n[m],g*m)),o[m].crossVectors(n[m],s[m])}return{tangents:n,normals:s,binormals:o}}clone(){return new this.constructor().copy(this)}copy(r){return this.arcLengthDivisions=r.arcLengthDivisions,this}toJSON(){const r={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return r.arcLengthDivisions=this.arcLengthDivisions,r.type=this.type,r}fromJSON(r){return this.arcLengthDivisions=r.arcLengthDivisions,this}};const sK={triangulate:function(r,e,i=2){const n=e&&e.length,s=n?e[0]*i:r.length;let o=$O(r,0,s,i,!0);const l=[];if(!o||o.next===o.prev)return l;let u,c,h,p,f,g,m;if(n&&(o=uK(r,e,o,i)),r.length>80*i){u=h=r[0],c=p=r[1];for(let y=i;y<s;y+=i)f=r[y],g=r[y+1],f<u&&(u=f),g<c&&(c=g),f>h&&(h=f),g>p&&(p=g);m=Math.max(h-u,p-c),m=m!==0?32767/m:0}return oA(o,l,i,u,c,m,0),l}};function $O(r,e,i,n,s){let o,l;if(s===xK(r,e,i,n)>0)for(o=e;o<i;o+=n)l=iP(o,r[o],r[o+1],l);else for(o=i-n;o>=e;o-=n)l=iP(o,r[o],r[o+1],l);return l&&Qb(l,l.next)&&(cA(l),l=l.next),l}function cp(r,e){if(!r)return r;e||(e=r);let i=r,n;do if(n=!1,!i.steiner&&(Qb(i,i.next)||Rs(i.prev,i,i.next)===0)){if(cA(i),i=e=i.prev,i===i.next)break;n=!0}else i=i.next;while(n||i!==e);return e}function oA(r,e,i,n,s,o,l){if(!r)return;!l&&o&&mK(r,n,s,o);let u=r,c,h;for(;r.prev!==r.next;){if(c=r.prev,h=r.next,o?oK(r,n,s,o):aK(r)){e.push(c.i/i|0),e.push(r.i/i|0),e.push(h.i/i|0),cA(r),r=h.next,u=h.next;continue}if(r=h,r===u){l?l===1?(r=lK(cp(r),e,i),oA(r,e,i,n,s,o,2)):l===2&&cK(r,e,i,n,s,o):oA(cp(r),e,i,n,s,o,1);break}}}function aK(r){const e=r.prev,i=r,n=r.next;if(Rs(e,i,n)>=0)return!1;const s=e.x,o=i.x,l=n.x,u=e.y,c=i.y,h=n.y,p=s<o?s<l?s:l:o<l?o:l,f=u<c?u<h?u:h:c<h?c:h,g=s>o?s>l?s:l:o>l?o:l,m=u>c?u>h?u:h:c>h?c:h;let y=n.next;for(;y!==e;){if(y.x>=p&&y.x<=g&&y.y>=f&&y.y<=m&&pm(s,u,o,c,l,h,y.x,y.y)&&Rs(y.prev,y,y.next)>=0)return!1;y=y.next}return!0}function oK(r,e,i,n){const s=r.prev,o=r,l=r.next;if(Rs(s,o,l)>=0)return!1;const u=s.x,c=o.x,h=l.x,p=s.y,f=o.y,g=l.y,m=u<c?u<h?u:h:c<h?c:h,y=p<f?p<g?p:g:f<g?f:g,b=u>c?u>h?u:h:c>h?c:h,v=p>f?p>g?p:g:f>g?f:g,_=SC(m,y,e,i,n),C=SC(b,v,e,i,n);let E=r.prevZ,T=r.nextZ;for(;E&&E.z>=_&&T&&T.z<=C;){if(E.x>=m&&E.x<=b&&E.y>=y&&E.y<=v&&E!==s&&E!==l&&pm(u,p,c,f,h,g,E.x,E.y)&&Rs(E.prev,E,E.next)>=0||(E=E.prevZ,T.x>=m&&T.x<=b&&T.y>=y&&T.y<=v&&T!==s&&T!==l&&pm(u,p,c,f,h,g,T.x,T.y)&&Rs(T.prev,T,T.next)>=0))return!1;T=T.nextZ}for(;E&&E.z>=_;){if(E.x>=m&&E.x<=b&&E.y>=y&&E.y<=v&&E!==s&&E!==l&&pm(u,p,c,f,h,g,E.x,E.y)&&Rs(E.prev,E,E.next)>=0)return!1;E=E.prevZ}for(;T&&T.z<=C;){if(T.x>=m&&T.x<=b&&T.y>=y&&T.y<=v&&T!==s&&T!==l&&pm(u,p,c,f,h,g,T.x,T.y)&&Rs(T.prev,T,T.next)>=0)return!1;T=T.nextZ}return!0}function lK(r,e,i){let n=r;do{const s=n.prev,o=n.next.next;!Qb(s,o)&&eP(s,n,n.next,o)&&lA(s,o)&&lA(o,s)&&(e.push(s.i/i|0),e.push(n.i/i|0),e.push(o.i/i|0),cA(n),cA(n.next),n=r=o),n=n.next}while(n!==r);return cp(n)}function cK(r,e,i,n,s,o){let l=r;do{let u=l.next.next;for(;u!==l.prev;){if(l.i!==u.i&&yK(l,u)){let c=tP(l,u);l=cp(l,l.next),c=cp(c,c.next),oA(l,e,i,n,s,o,0),oA(c,e,i,n,s,o,0);return}u=u.next}l=l.next}while(l!==r)}function uK(r,e,i,n){const s=[];let o,l,u,c,h;for(o=0,l=e.length;o<l;o++)u=e[o]*n,c=o<l-1?e[o+1]*n:r.length,h=$O(r,u,c,n,!1),h===h.next&&(h.steiner=!0),s.push(AK(h));for(s.sort(hK),o=0;o<s.length;o++)i=dK(s[o],i);return i}function hK(r,e){return r.x-e.x}function dK(r,e){const i=pK(r,e);if(!i)return e;const n=tP(i,r);return cp(n,n.next),cp(i,i.next)}function pK(r,e){let i=e,n=-1/0,s;const o=r.x,l=r.y;do{if(l<=i.y&&l>=i.next.y&&i.next.y!==i.y){const g=i.x+(l-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(g<=o&&g>n&&(n=g,s=i.x<i.next.x?i:i.next,g===o))return s}i=i.next}while(i!==e);if(!s)return null;const u=s,c=s.x,h=s.y;let p=1/0,f;i=s;do o>=i.x&&i.x>=c&&o!==i.x&&pm(l<h?o:n,l,c,h,l<h?n:o,l,i.x,i.y)&&(f=Math.abs(l-i.y)/(o-i.x),lA(i,r)&&(f<p||f===p&&(i.x>s.x||i.x===s.x&&fK(s,i)))&&(s=i,p=f)),i=i.next;while(i!==u);return s}function fK(r,e){return Rs(r.prev,r,e.prev)<0&&Rs(e.next,r,r.next)<0}function mK(r,e,i,n){let s=r;do s.z===0&&(s.z=SC(s.x,s.y,e,i,n)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==r);s.prevZ.nextZ=null,s.prevZ=null,gK(s)}function gK(r){let e,i,n,s,o,l,u,c,h=1;do{for(i=r,r=null,o=null,l=0;i;){for(l++,n=i,u=0,e=0;e<h&&(u++,n=n.nextZ,!!n);e++);for(c=h;u>0||c>0&&n;)u!==0&&(c===0||!n||i.z<=n.z)?(s=i,i=i.nextZ,u--):(s=n,n=n.nextZ,c--),o?o.nextZ=s:r=s,s.prevZ=o,o=s;i=n}o.nextZ=null,h*=2}while(l>1);return r}function SC(r,e,i,n,s){return r=(r-i)*s|0,e=(e-n)*s|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,r|e<<1}function AK(r){let e=r,i=r;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==r);return i}function pm(r,e,i,n,s,o,l,u){return(s-l)*(e-u)>=(r-l)*(o-u)&&(r-l)*(n-u)>=(i-l)*(e-u)&&(i-l)*(o-u)>=(s-l)*(n-u)}function yK(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!vK(r,e)&&(lA(r,e)&&lA(e,r)&&bK(r,e)&&(Rs(r.prev,r,e.prev)||Rs(r,e.prev,e))||Qb(r,e)&&Rs(r.prev,r,r.next)>0&&Rs(e.prev,e,e.next)>0)}function Rs(r,e,i){return(e.y-r.y)*(i.x-e.x)-(e.x-r.x)*(i.y-e.y)}function Qb(r,e){return r.x===e.x&&r.y===e.y}function eP(r,e,i,n){const s=Xb(Rs(r,e,i)),o=Xb(Rs(r,e,n)),l=Xb(Rs(i,n,r)),u=Xb(Rs(i,n,e));return!!(s!==o&&l!==u||s===0&&qb(r,i,e)||o===0&&qb(r,n,e)||l===0&&qb(i,r,n)||u===0&&qb(i,e,n))}function qb(r,e,i){return e.x<=Math.max(r.x,i.x)&&e.x>=Math.min(r.x,i.x)&&e.y<=Math.max(r.y,i.y)&&e.y>=Math.min(r.y,i.y)}function Xb(r){return r>0?1:r<0?-1:0}function vK(r,e){let i=r;do{if(i.i!==r.i&&i.next.i!==r.i&&i.i!==e.i&&i.next.i!==e.i&&eP(i,i.next,r,e))return!0;i=i.next}while(i!==r);return!1}function lA(r,e){return Rs(r.prev,r,r.next)<0?Rs(r,e,r.next)>=0&&Rs(r,r.prev,e)>=0:Rs(r,e,r.prev)<0||Rs(r,r.next,e)<0}function bK(r,e){let i=r,n=!1;const s=(r.x+e.x)/2,o=(r.y+e.y)/2;do i.y>o!=i.next.y>o&&i.next.y!==i.y&&s<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next;while(i!==r);return n}function tP(r,e){const i=new TC(r.i,r.x,r.y),n=new TC(e.i,e.x,e.y),s=r.next,o=e.prev;return r.next=e,e.prev=r,i.next=s,s.prev=i,n.next=i,i.prev=n,o.next=n,n.prev=o,n}function iP(r,e,i,n){const s=new TC(r,e,i);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s}function cA(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function TC(r,e,i){this.i=r,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function xK(r,e,i,n){let s=0;for(let o=e,l=i-n;o<i;o+=n)s+=(r[l]-r[o])*(r[o+1]+r[l+1]),l=o;return s}class MC{static area(e){const i=e.length;let n=0;for(let s=i-1,o=0;o<i;s=o++)n+=e[s].x*e[o].y-e[o].x*e[s].y;return n*.5}static isClockWise(e){return MC.area(e)<0}static triangulateShape(e,i){const n=[],s=[],o=[];rP(e),nP(n,e);let l=e.length;i.forEach(rP);for(let c=0;c<i.length;c++)s.push(l),l+=i[c].length,nP(n,i[c]);const u=sK.triangulate(n,s);for(let c=0;c<u.length;c+=3)o.push(u.slice(c,c+3));return o}}function rP(r){const e=r.length;e>2&&r[e-1].equals(r[0])&&r.pop()}function nP(r,e){for(let i=0;i<e.length;i++)r.push(e[i].x),r.push(e[i].y)}let RC=class extends Ib{constructor(r){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Ys(16777215),this.specular=new Ys(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ys(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=uO,this.normalScale=new Vs(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new yo,this.combine=q2,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.specular.copy(r.specular),this.shininess=r.shininess,this.map=r.map,this.lightMap=r.lightMap,this.lightMapIntensity=r.lightMapIntensity,this.aoMap=r.aoMap,this.aoMapIntensity=r.aoMapIntensity,this.emissive.copy(r.emissive),this.emissiveMap=r.emissiveMap,this.emissiveIntensity=r.emissiveIntensity,this.bumpMap=r.bumpMap,this.bumpScale=r.bumpScale,this.normalMap=r.normalMap,this.normalMapType=r.normalMapType,this.normalScale.copy(r.normalScale),this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.specularMap=r.specularMap,this.alphaMap=r.alphaMap,this.envMap=r.envMap,this.envMapRotation.copy(r.envMapRotation),this.combine=r.combine,this.reflectivity=r.reflectivity,this.refractionRatio=r.refractionRatio,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.wireframeLinecap=r.wireframeLinecap,this.wireframeLinejoin=r.wireframeLinejoin,this.flatShading=r.flatShading,this.fog=r.fog,this}},_K=class extends Ib{constructor(r){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Ys(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ys(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=uO,this.normalScale=new Vs(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new yo,this.combine=q2,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.lightMap=r.lightMap,this.lightMapIntensity=r.lightMapIntensity,this.aoMap=r.aoMap,this.aoMapIntensity=r.aoMapIntensity,this.emissive.copy(r.emissive),this.emissiveMap=r.emissiveMap,this.emissiveIntensity=r.emissiveIntensity,this.bumpMap=r.bumpMap,this.bumpScale=r.bumpScale,this.normalMap=r.normalMap,this.normalMapType=r.normalMapType,this.normalScale.copy(r.normalScale),this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.specularMap=r.specularMap,this.alphaMap=r.alphaMap,this.envMap=r.envMap,this.envMapRotation.copy(r.envMapRotation),this.combine=r.combine,this.reflectivity=r.reflectivity,this.refractionRatio=r.refractionRatio,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.wireframeLinecap=r.wireframeLinecap,this.wireframeLinejoin=r.wireframeLinejoin,this.flatShading=r.flatShading,this.fog=r.fog,this}};function Kb(r,e,i){return!r||r.constructor===e?r:typeof e.BYTES_PER_ELEMENT=="number"?new e(r):Array.prototype.slice.call(r)}function EK(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function wK(r){function e(s,o){return r[s]-r[o]}const i=r.length,n=new Array(i);for(let s=0;s!==i;++s)n[s]=s;return n.sort(e),n}function sP(r,e,i){const n=r.length,s=new r.constructor(n);for(let o=0,l=0;l!==n;++o){const u=i[o]*e;for(let c=0;c!==e;++c)s[l++]=r[u+c]}return s}function aP(r,e,i,n){let s=1,o=r[0];for(;o!==void 0&&o[n]===void 0;)o=r[s++];if(o===void 0)return;let l=o[n];if(l!==void 0)if(Array.isArray(l))do l=o[n],l!==void 0&&(e.push(o.time),i.push.apply(i,l)),o=r[s++];while(o!==void 0);else if(l.toArray!==void 0)do l=o[n],l!==void 0&&(e.push(o.time),l.toArray(i,i.length)),o=r[s++];while(o!==void 0);else do l=o[n],l!==void 0&&(e.push(o.time),i.push(l)),o=r[s++];while(o!==void 0)}class Yb{constructor(e,i,n,s){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=s!==void 0?s:new i.constructor(n),this.sampleValues=i,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const i=this.parameterPositions;let n=this._cachedIndex,s=i[n],o=i[n-1];i:{e:{let l;t:{r:if(!(e<s)){for(let u=n+2;;){if(s===void 0){if(e<o)break r;return n=i.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===u)break;if(o=s,s=i[++n],e<s)break e}l=i.length;break t}if(!(e>=o)){const u=i[1];e<u&&(n=2,o=u);for(let c=n-2;;){if(o===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===c)break;if(s=o,o=i[--n-1],e>=o)break e}l=n,n=0;break t}break i}for(;n<l;){const u=n+l>>>1;e<i[u]?l=u:n=u+1}if(s=i[n],o=i[n-1],o===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(s===void 0)return n=i.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,o,s)}return this.interpolate_(n,o,e,s)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const i=this.resultBuffer,n=this.sampleValues,s=this.valueSize,o=e*s;for(let l=0;l!==s;++l)i[l]=n[o+l];return i}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class CK extends Yb{constructor(e,i,n,s){super(e,i,n,s),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:oO,endingEnd:oO}}intervalChanged_(e,i,n){const s=this.parameterPositions;let o=e-2,l=e+1,u=s[o],c=s[l];if(u===void 0)switch(this.getSettings_().endingStart){case lO:o=e,u=2*i-n;break;case cO:o=s.length-2,u=i+s[o]-s[o+1];break;default:o=e,u=n}if(c===void 0)switch(this.getSettings_().endingEnd){case lO:l=e,c=2*n-i;break;case cO:l=1,c=n+s[1]-s[0];break;default:l=e-1,c=i}const h=(n-i)*.5,p=this.valueSize;this._weightPrev=h/(i-u),this._weightNext=h/(c-n),this._offsetPrev=o*p,this._offsetNext=l*p}interpolate_(e,i,n,s){const o=this.resultBuffer,l=this.sampleValues,u=this.valueSize,c=e*u,h=c-u,p=this._offsetPrev,f=this._offsetNext,g=this._weightPrev,m=this._weightNext,y=(n-i)/(s-i),b=y*y,v=b*y,_=-g*v+2*g*b-g*y,C=(1+g)*v+(-1.5-2*g)*b+(-.5+g)*y+1,E=(-1-m)*v+(1.5+m)*b+.5*y,T=m*v-m*b;for(let R=0;R!==u;++R)o[R]=_*l[p+R]+C*l[h+R]+E*l[c+R]+T*l[f+R];return o}}class SK extends Yb{constructor(e,i,n,s){super(e,i,n,s)}interpolate_(e,i,n,s){const o=this.resultBuffer,l=this.sampleValues,u=this.valueSize,c=e*u,h=c-u,p=(n-i)/(s-i),f=1-p;for(let g=0;g!==u;++g)o[g]=l[h+g]*f+l[c+g]*p;return o}}class TK extends Yb{constructor(e,i,n,s){super(e,i,n,s)}interpolate_(e){return this.copySampleValue_(e-1)}}class Gc{constructor(e,i,n,s){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(i===void 0||i.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Kb(i,this.TimeBufferType),this.values=Kb(n,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}static toJSON(e){const i=e.constructor;let n;if(i.toJSON!==this.toJSON)n=i.toJSON(e);else{n={name:e.name,times:Kb(e.times,Array),values:Kb(e.values,Array)};const s=e.getInterpolation();s!==e.DefaultInterpolation&&(n.interpolation=s)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new TK(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new SK(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new CK(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let i;switch(e){case Ab:i=this.InterpolantFactoryMethodDiscrete;break;case yb:i=this.InterpolantFactoryMethodLinear;break;case K2:i=this.InterpolantFactoryMethodSmooth;break}if(i===void 0){const n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=i,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Ab;case this.InterpolantFactoryMethodLinear:return yb;case this.InterpolantFactoryMethodSmooth:return K2}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const i=this.times;for(let n=0,s=i.length;n!==s;++n)i[n]+=e}return this}scale(e){if(e!==1){const i=this.times;for(let n=0,s=i.length;n!==s;++n)i[n]*=e}return this}trim(e,i){const n=this.times,s=n.length;let o=0,l=s-1;for(;o!==s&&n[o]<e;)++o;for(;l!==-1&&n[l]>i;)--l;if(++l,o!==0||l!==s){o>=l&&(l=Math.max(l,1),o=l-1);const u=this.getValueSize();this.times=n.slice(o,l),this.values=this.values.slice(o*u,l*u)}return this}validate(){let e=!0;const i=this.getValueSize();i-Math.floor(i)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,s=this.values,o=n.length;o===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let l=null;for(let u=0;u!==o;u++){const c=n[u];if(typeof c=="number"&&isNaN(c)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,u,c),e=!1;break}if(l!==null&&l>c){console.error("THREE.KeyframeTrack: Out of order keys.",this,u,c,l),e=!1;break}l=c}if(s!==void 0&&EK(s))for(let u=0,c=s.length;u!==c;++u){const h=s[u];if(isNaN(h)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,u,h),e=!1;break}}return e}optimize(){const e=this.times.slice(),i=this.values.slice(),n=this.getValueSize(),s=this.getInterpolation()===K2,o=e.length-1;let l=1;for(let u=1;u<o;++u){let c=!1;const h=e[u],p=e[u+1];if(h!==p&&(u!==1||h!==e[0]))if(s)c=!0;else{const f=u*n,g=f-n,m=f+n;for(let y=0;y!==n;++y){const b=i[f+y];if(b!==i[g+y]||b!==i[m+y]){c=!0;break}}}if(c){if(u!==l){e[l]=e[u];const f=u*n,g=l*n;for(let m=0;m!==n;++m)i[g+m]=i[f+m]}++l}}if(o>0){e[l]=e[o];for(let u=o*n,c=l*n,h=0;h!==n;++h)i[c+h]=i[u+h];++l}return l!==e.length?(this.times=e.slice(0,l),this.values=i.slice(0,l*n)):(this.times=e,this.values=i),this}clone(){const e=this.times.slice(),i=this.values.slice(),n=this.constructor,s=new n(this.name,e,i);return s.createInterpolant=this.createInterpolant,s}}Gc.prototype.TimeBufferType=Float32Array,Gc.prototype.ValueBufferType=Float32Array,Gc.prototype.DefaultInterpolation=yb;class fm extends Gc{}fm.prototype.ValueTypeName="bool",fm.prototype.ValueBufferType=Array,fm.prototype.DefaultInterpolation=Ab,fm.prototype.InterpolantFactoryMethodLinear=void 0,fm.prototype.InterpolantFactoryMethodSmooth=void 0;class oP extends Gc{}oP.prototype.ValueTypeName="color";class uA extends Gc{}uA.prototype.ValueTypeName="number";class MK extends Yb{constructor(e,i,n,s){super(e,i,n,s)}interpolate_(e,i,n,s){const o=this.resultBuffer,l=this.sampleValues,u=this.valueSize,c=(n-i)/(s-i);let h=e*u;for(let p=h+u;h!==p;h+=4)zo.slerpFlat(o,0,l,h-u,l,h,c);return o}}class up extends Gc{InterpolantFactoryMethodLinear(e){return new MK(this.times,this.values,this.getValueSize(),e)}}up.prototype.ValueTypeName="quaternion",up.prototype.DefaultInterpolation=yb,up.prototype.InterpolantFactoryMethodSmooth=void 0;class mm extends Gc{}mm.prototype.ValueTypeName="string",mm.prototype.ValueBufferType=Array,mm.prototype.DefaultInterpolation=Ab,mm.prototype.InterpolantFactoryMethodLinear=void 0,mm.prototype.InterpolantFactoryMethodSmooth=void 0;class hA extends Gc{}hA.prototype.ValueTypeName="vector";class RK{constructor(e="",i=-1,n=[],s=cX){this.name=e,this.tracks=n,this.duration=i,this.blendMode=s,this.uuid=kh(),this.duration<0&&this.resetDuration()}static parse(e){const i=[],n=e.tracks,s=1/(e.fps||1);for(let l=0,u=n.length;l!==u;++l)i.push(BK(n[l]).scale(s));const o=new this(e.name,e.duration,i,e.blendMode);return o.uuid=e.uuid,o}static toJSON(e){const i=[],n=e.tracks,s={name:e.name,duration:e.duration,tracks:i,uuid:e.uuid,blendMode:e.blendMode};for(let o=0,l=n.length;o!==l;++o)i.push(Gc.toJSON(n[o]));return s}static CreateFromMorphTargetSequence(e,i,n,s){const o=i.length,l=[];for(let u=0;u<o;u++){let c=[],h=[];c.push((u+o-1)%o,u,(u+1)%o),h.push(0,1,0);const p=wK(c);c=sP(c,1,p),h=sP(h,1,p),!s&&c[0]===0&&(c.push(o),h.push(h[0])),l.push(new uA(".morphTargetInfluences["+i[u].name+"]",c,h).scale(1/n))}return new this(e,-1,l)}static findByName(e,i){let n=e;if(!Array.isArray(e)){const s=e;n=s.geometry&&s.geometry.animations||s.animations}for(let s=0;s<n.length;s++)if(n[s].name===i)return n[s];return null}static CreateClipsFromMorphTargetSequences(e,i,n){const s={},o=/^([\w-]*?)([\d]+)$/;for(let u=0,c=e.length;u<c;u++){const h=e[u],p=h.name.match(o);if(p&&p.length>1){const f=p[1];let g=s[f];g||(s[f]=g=[]),g.push(h)}}const l=[];for(const u in s)l.push(this.CreateFromMorphTargetSequence(u,s[u],i,n));return l}static parseAnimation(e,i){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(p,f,g,m,y){if(g.length!==0){const b=[],v=[];aP(g,b,v,m),b.length!==0&&y.push(new p(f,b,v))}},s=[],o=e.name||"default",l=e.fps||30,u=e.blendMode;let c=e.length||-1;const h=e.hierarchy||[];for(let p=0;p<h.length;p++){const f=h[p].keys;if(!(!f||f.length===0))if(f[0].morphTargets){const g={};let m;for(m=0;m<f.length;m++)if(f[m].morphTargets)for(let y=0;y<f[m].morphTargets.length;y++)g[f[m].morphTargets[y]]=-1;for(const y in g){const b=[],v=[];for(let _=0;_!==f[m].morphTargets.length;++_){const C=f[m];b.push(C.time),v.push(C.morphTarget===y?1:0)}s.push(new uA(".morphTargetInfluence["+y+"]",b,v))}c=g.length*l}else{const g=".bones["+i[p].name+"]";n(hA,g+".position",f,"pos",s),n(up,g+".quaternion",f,"rot",s),n(hA,g+".scale",f,"scl",s)}}return s.length===0?null:new this(o,c,s,u)}resetDuration(){const e=this.tracks;let i=0;for(let n=0,s=e.length;n!==s;++n){const o=this.tracks[n];i=Math.max(i,o.times[o.times.length-1])}return this.duration=i,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let i=0;i<this.tracks.length;i++)e=e&&this.tracks[i].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let i=0;i<this.tracks.length;i++)e.push(this.tracks[i].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function IK(r){switch(r.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return uA;case"vector":case"vector2":case"vector3":case"vector4":return hA;case"color":return oP;case"quaternion":return up;case"bool":case"boolean":return fm;case"string":return mm}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+r)}function BK(r){if(r.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=IK(r.type);if(r.times===void 0){const i=[],n=[];aP(r.keys,i,n,"value"),r.times=i,r.values=n}return e.parse!==void 0?e.parse(r):new e(r.name,r.times,r.values,r.interpolation)}const Jb={enabled:!1,files:{},add:function(r,e){this.enabled!==!1&&(this.files[r]=e)},get:function(r){if(this.enabled!==!1)return this.files[r]},remove:function(r){delete this.files[r]},clear:function(){this.files={}}};let NK=class{constructor(r,e,i){const n=this;let s=!1,o=0,l=0,u;const c=[];this.onStart=void 0,this.onLoad=r,this.onProgress=e,this.onError=i,this.itemStart=function(h){l++,s===!1&&n.onStart!==void 0&&n.onStart(h,o,l),s=!0},this.itemEnd=function(h){o++,n.onProgress!==void 0&&n.onProgress(h,o,l),o===l&&(s=!1,n.onLoad!==void 0&&n.onLoad())},this.itemError=function(h){n.onError!==void 0&&n.onError(h)},this.resolveURL=function(h){return u?u(h):h},this.setURLModifier=function(h){return u=h,this},this.addHandler=function(h,p){return c.push(h,p),this},this.removeHandler=function(h){const p=c.indexOf(h);return p!==-1&&c.splice(p,2),this},this.getHandler=function(h){for(let p=0,f=c.length;p<f;p+=2){const g=c[p],m=c[p+1];if(g.global&&(g.lastIndex=0),g.test(h))return m}return null}}};const LK=new NK;let hp=class{constructor(r){this.manager=r!==void 0?r:LK,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(r,e){const i=this;return new Promise(function(n,s){i.load(r,n,e,s)})}parse(){}setCrossOrigin(r){return this.crossOrigin=r,this}setWithCredentials(r){return this.withCredentials=r,this}setPath(r){return this.path=r,this}setResourcePath(r){return this.resourcePath=r,this}setRequestHeader(r){return this.requestHeader=r,this}};hp.DEFAULT_MATERIAL_NAME="__DEFAULT";const Eu={};class DK extends Error{constructor(e,i){super(e),this.response=i}}class OK extends hp{constructor(e){super(e)}load(e,i,n,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=Jb.get(e);if(o!==void 0)return this.manager.itemStart(e),setTimeout(()=>{i&&i(o),this.manager.itemEnd(e)},0),o;if(Eu[e]!==void 0){Eu[e].push({onLoad:i,onProgress:n,onError:s});return}Eu[e]=[],Eu[e].push({onLoad:i,onProgress:n,onError:s});const l=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),u=this.mimeType,c=this.responseType;fetch(l).then(h=>{if(h.status===200||h.status===0){if(h.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||h.body===void 0||h.body.getReader===void 0)return h;const p=Eu[e],f=h.body.getReader(),g=h.headers.get("X-File-Size")||h.headers.get("Content-Length"),m=g?parseInt(g):0,y=m!==0;let b=0;const v=new ReadableStream({start(_){C();function C(){f.read().then(({done:E,value:T})=>{if(E)_.close();else{b+=T.byteLength;const R=new ProgressEvent("progress",{lengthComputable:y,loaded:b,total:m});for(let B=0,I=p.length;B<I;B++){const D=p[B];D.onProgress&&D.onProgress(R)}_.enqueue(T),C()}})}}});return new Response(v)}else throw new DK(`fetch for "${h.url}" responded with ${h.status}: ${h.statusText}`,h)}).then(h=>{switch(c){case"arraybuffer":return h.arrayBuffer();case"blob":return h.blob();case"document":return h.text().then(p=>new DOMParser().parseFromString(p,u));case"json":return h.json();default:if(u===void 0)return h.text();{const p=/charset="?([^;"\s]*)"?/i.exec(u),f=p&&p[1]?p[1].toLowerCase():void 0,g=new TextDecoder(f);return h.arrayBuffer().then(m=>g.decode(m))}}}).then(h=>{Jb.add(e,h);const p=Eu[e];delete Eu[e];for(let f=0,g=p.length;f<g;f++){const m=p[f];m.onLoad&&m.onLoad(h)}}).catch(h=>{const p=Eu[e];if(p===void 0)throw this.manager.itemError(e),h;delete Eu[e];for(let f=0,g=p.length;f<g;f++){const m=p[f];m.onError&&m.onError(h)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}let PK=class extends hp{constructor(r){super(r)}load(r,e,i,n){this.path!==void 0&&(r=this.path+r),r=this.manager.resolveURL(r);const s=this,o=Jb.get(r);if(o!==void 0)return s.manager.itemStart(r),setTimeout(function(){e&&e(o),s.manager.itemEnd(r)},0),o;const l=tC("img");function u(){h(),Jb.add(r,this),e&&e(this),s.manager.itemEnd(r)}function c(p){h(),n&&n(p),s.manager.itemError(r),s.manager.itemEnd(r)}function h(){l.removeEventListener("load",u,!1),l.removeEventListener("error",c,!1)}return l.addEventListener("load",u,!1),l.addEventListener("error",c,!1),r.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(l.crossOrigin=this.crossOrigin),s.manager.itemStart(r),l.src=r,l}},kK=class extends hp{constructor(r){super(r)}load(r,e,i,n){const s=new Au,o=new PK(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(r,function(l){s.image=l,s.needsUpdate=!0,e!==void 0&&e(s)},i,n),s}},Zb=class extends Fa{constructor(r,e=1){super(),this.isLight=!0,this.type="Light",this.color=new Ys(r),this.intensity=e}dispose(){}copy(r,e){return super.copy(r,e),this.color.copy(r.color),this.intensity=r.intensity,this}toJSON(r){const e=super.toJSON(r);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,this.groundColor!==void 0&&(e.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(e.object.distance=this.distance),this.angle!==void 0&&(e.object.angle=this.angle),this.decay!==void 0&&(e.object.decay=this.decay),this.penumbra!==void 0&&(e.object.penumbra=this.penumbra),this.shadow!==void 0&&(e.object.shadow=this.shadow.toJSON()),e}};const IC=new Hr,lP=new kt,cP=new kt;let BC=class{constructor(r){this.camera=r,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Vs(512,512),this.map=null,this.mapPass=null,this.matrix=new Hr,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new YX,this._frameExtents=new Vs(1,1),this._viewportCount=1,this._viewports=[new Uo(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(r){const e=this.camera,i=this.matrix;lP.setFromMatrixPosition(r.matrixWorld),e.position.copy(lP),cP.setFromMatrixPosition(r.target.matrixWorld),e.lookAt(cP),e.updateMatrixWorld(),IC.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(IC),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(IC)}getViewport(r){return this._viewports[r]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(r){return this.camera=r.camera.clone(),this.bias=r.bias,this.radius=r.radius,this.mapSize.copy(r.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const r={};return this.bias!==0&&(r.bias=this.bias),this.normalBias!==0&&(r.normalBias=this.normalBias),this.radius!==1&&(r.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(r.mapSize=this.mapSize.toArray()),r.camera=this.camera.toJSON(!1).object,delete r.camera.matrix,r}},FK=class extends BC{constructor(){super(new vC(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(r){const e=this.camera,i=$0*2*r.angle*this.focus,n=this.mapSize.width/this.mapSize.height,s=r.distance||e.far;(i!==e.fov||n!==e.aspect||s!==e.far)&&(e.fov=i,e.aspect=n,e.far=s,e.updateProjectionMatrix()),super.updateMatrices(r)}copy(r){return super.copy(r),this.focus=r.focus,this}},UK=class extends Zb{constructor(r,e,i=0,n=Math.PI/3,s=0,o=2){super(r,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Fa.DEFAULT_UP),this.updateMatrix(),this.target=new Fa,this.distance=i,this.angle=n,this.penumbra=s,this.decay=o,this.map=null,this.shadow=new FK}get power(){return this.intensity*Math.PI}set power(r){this.intensity=r/Math.PI}dispose(){this.shadow.dispose()}copy(r,e){return super.copy(r,e),this.distance=r.distance,this.angle=r.angle,this.penumbra=r.penumbra,this.decay=r.decay,this.target=r.target.clone(),this.shadow=r.shadow.clone(),this}};const uP=new Hr,dA=new kt,NC=new kt;let zK=class extends BC{constructor(){super(new vC(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Vs(4,2),this._viewportCount=6,this._viewports=[new Uo(2,1,1,1),new Uo(0,1,1,1),new Uo(3,1,1,1),new Uo(1,1,1,1),new Uo(3,0,1,1),new Uo(1,0,1,1)],this._cubeDirections=[new kt(1,0,0),new kt(-1,0,0),new kt(0,0,1),new kt(0,0,-1),new kt(0,1,0),new kt(0,-1,0)],this._cubeUps=[new kt(0,1,0),new kt(0,1,0),new kt(0,1,0),new kt(0,1,0),new kt(0,0,1),new kt(0,0,-1)]}updateMatrices(r,e=0){const i=this.camera,n=this.matrix,s=r.distance||i.far;s!==i.far&&(i.far=s,i.updateProjectionMatrix()),dA.setFromMatrixPosition(r.matrixWorld),i.position.copy(dA),NC.copy(i.position),NC.add(this._cubeDirections[e]),i.up.copy(this._cubeUps[e]),i.lookAt(NC),i.updateMatrixWorld(),n.makeTranslation(-dA.x,-dA.y,-dA.z),uP.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(uP)}},hP=class extends Zb{constructor(r,e,i=0,n=2){super(r,e),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=n,this.shadow=new zK}get power(){return this.intensity*4*Math.PI}set power(r){this.intensity=r/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(r,e){return super.copy(r,e),this.distance=r.distance,this.decay=r.decay,this.shadow=r.shadow.clone(),this}},jK=class extends BC{constructor(){super(new GO(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},GK=class extends Zb{constructor(r,e){super(r,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Fa.DEFAULT_UP),this.updateMatrix(),this.target=new Fa,this.shadow=new jK}dispose(){this.shadow.dispose()}copy(r){return super.copy(r),this.target=r.target.clone(),this.shadow=r.shadow.clone(),this}},VK=class extends Zb{constructor(r,e){super(r,e),this.isAmbientLight=!0,this.type="AmbientLight"}};class HK{static decodeText(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let i="";for(let n=0,s=e.length;n<s;n++)i+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(i))}catch{return i}}static extractUrlBase(e){const i=e.lastIndexOf("/");return i===-1?"./":e.slice(0,i+1)}static resolveURL(e,i){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(i)&&/^\//.test(e)&&(i=i.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:i+e)}}const LC="\\[\\]\\.:\\/",WK=new RegExp("["+LC+"]","g"),DC="[^"+LC+"]",QK="[^"+LC.replace("\\.","")+"]",qK=/((?:WC+[\/:])*)/.source.replace("WC",DC),XK=/(WCOD+)?/.source.replace("WCOD",QK),KK=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",DC),YK=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",DC),JK=new RegExp("^"+qK+XK+KK+YK+"$"),ZK=["material","materials","bones","map"];class $K{constructor(e,i,n){const s=n||Gn.parseTrackName(i);this._targetGroup=e,this._bindings=e.subscribe_(i,s)}getValue(e,i){this.bind();const n=this._targetGroup.nCachedObjects_,s=this._bindings[n];s!==void 0&&s.getValue(e,i)}setValue(e,i){const n=this._bindings;for(let s=this._targetGroup.nCachedObjects_,o=n.length;s!==o;++s)n[s].setValue(e,i)}bind(){const e=this._bindings;for(let i=this._targetGroup.nCachedObjects_,n=e.length;i!==n;++i)e[i].bind()}unbind(){const e=this._bindings;for(let i=this._targetGroup.nCachedObjects_,n=e.length;i!==n;++i)e[i].unbind()}}class Gn{constructor(e,i,n){this.path=i,this.parsedPath=n||Gn.parseTrackName(i),this.node=Gn.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,i,n){return e&&e.isAnimationObjectGroup?new Gn.Composite(e,i,n):new Gn(e,i,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(WK,"")}static parseTrackName(e){const i=JK.exec(e);if(i===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},s=n.nodeName&&n.nodeName.lastIndexOf(".");if(s!==void 0&&s!==-1){const o=n.nodeName.substring(s+1);ZK.indexOf(o)!==-1&&(n.nodeName=n.nodeName.substring(0,s),n.objectName=o)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,i){if(i===void 0||i===""||i==="."||i===-1||i===e.name||i===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(i);if(n!==void 0)return n}if(e.children){const n=function(o){for(let l=0;l<o.length;l++){const u=o[l];if(u.name===i||u.uuid===i)return u;const c=n(u.children);if(c)return c}return null},s=n(e.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,i){e[i]=this.targetObject[this.propertyName]}_getValue_array(e,i){const n=this.resolvedProperty;for(let s=0,o=n.length;s!==o;++s)e[i++]=n[s]}_getValue_arrayElement(e,i){e[i]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,i){this.resolvedProperty.toArray(e,i)}_setValue_direct(e,i){this.targetObject[this.propertyName]=e[i]}_setValue_direct_setNeedsUpdate(e,i){this.targetObject[this.propertyName]=e[i],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,i){this.targetObject[this.propertyName]=e[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,i){const n=this.resolvedProperty;for(let s=0,o=n.length;s!==o;++s)n[s]=e[i++]}_setValue_array_setNeedsUpdate(e,i){const n=this.resolvedProperty;for(let s=0,o=n.length;s!==o;++s)n[s]=e[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,i){const n=this.resolvedProperty;for(let s=0,o=n.length;s!==o;++s)n[s]=e[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,i){this.resolvedProperty[this.propertyIndex]=e[i]}_setValue_arrayElement_setNeedsUpdate(e,i){this.resolvedProperty[this.propertyIndex]=e[i],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,i){this.resolvedProperty[this.propertyIndex]=e[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,i){this.resolvedProperty.fromArray(e,i)}_setValue_fromArray_setNeedsUpdate(e,i){this.resolvedProperty.fromArray(e,i),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,i){this.resolvedProperty.fromArray(e,i),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,i){this.bind(),this.getValue(e,i)}_setValue_unbound(e,i){this.bind(),this.setValue(e,i)}bind(){let e=this.node;const i=this.parsedPath,n=i.objectName,s=i.propertyName;let o=i.propertyIndex;if(e||(e=Gn.findNode(this.rootNode,i.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(n){let h=i.objectIndex;switch(n){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let p=0;p<e.length;p++)if(e[p].name===h){h=p;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[n]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[n]}if(h!==void 0){if(e[h]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[h]}}const l=e[s];if(l===void 0){const h=i.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+h+"."+s+" but it wasn't found.",e);return}let u=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?u=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(u=this.Versioning.MatrixWorldNeedsUpdate);let c=this.BindingType.Direct;if(o!==void 0){if(s==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[o]!==void 0&&(o=e.morphTargetDictionary[o])}c=this.BindingType.ArrayElement,this.resolvedProperty=l,this.propertyIndex=o}else l.fromArray!==void 0&&l.toArray!==void 0?(c=this.BindingType.HasFromToArray,this.resolvedProperty=l):Array.isArray(l)?(c=this.BindingType.EntireArray,this.resolvedProperty=l):this.propertyName=s;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][u]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Gn.Composite=$K,Gn.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Gn.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Gn.prototype.GetterByBindingType=[Gn.prototype._getValue_direct,Gn.prototype._getValue_array,Gn.prototype._getValue_arrayElement,Gn.prototype._getValue_toArray],Gn.prototype.SetterByBindingTypeAndVersioning=[[Gn.prototype._setValue_direct,Gn.prototype._setValue_direct_setNeedsUpdate,Gn.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Gn.prototype._setValue_array,Gn.prototype._setValue_array_setNeedsUpdate,Gn.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Gn.prototype._setValue_arrayElement,Gn.prototype._setValue_arrayElement_setNeedsUpdate,Gn.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Gn.prototype._setValue_fromArray,Gn.prototype._setValue_fromArray_setNeedsUpdate,Gn.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]],typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:KD}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=KD);/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.8.2
*/var Dl=Uint8Array,pA=Uint16Array,eY=Int32Array,dP=new Dl([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),pP=new Dl([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),tY=new Dl([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),fP=function(r,e){for(var i=new pA(31),n=0;n<31;++n)i[n]=e+=1<<r[n-1];for(var s=new eY(i[30]),n=1;n<30;++n)for(var o=i[n];o<i[n+1];++o)s[o]=o-i[n]<<5|n;return{b:i,r:s}},mP=fP(dP,2),gP=mP.b,iY=mP.r;gP[28]=258,iY[258]=28;for(var rY=fP(pP,0),nY=rY.b,AP=new pA(32768),ms=0;ms<32768;++ms){var Qh=(ms&43690)>>1|(ms&21845)<<1;Qh=(Qh&52428)>>2|(Qh&13107)<<2,Qh=(Qh&61680)>>4|(Qh&3855)<<4,AP[ms]=((Qh&65280)>>8|(Qh&255)<<8)>>1}for(var fA=function(r,e,i){for(var n=r.length,s=0,o=new pA(e);s<n;++s)r[s]&&++o[r[s]-1];var l=new pA(e);for(s=1;s<e;++s)l[s]=l[s-1]+o[s-1]<<1;var u;{u=new pA(1<<e);var c=15-e;for(s=0;s<n;++s)if(r[s])for(var h=s<<4|r[s],p=e-r[s],f=l[r[s]-1]++<<p,g=f|(1<<p)-1;f<=g;++f)u[AP[f]>>c]=h}return u},mA=new Dl(288),ms=0;ms<144;++ms)mA[ms]=8;for(var ms=144;ms<256;++ms)mA[ms]=9;for(var ms=256;ms<280;++ms)mA[ms]=7;for(var ms=280;ms<288;++ms)mA[ms]=8;for(var yP=new Dl(32),ms=0;ms<32;++ms)yP[ms]=5;var sY=fA(mA,9),aY=fA(yP,5),OC=function(r){for(var e=r[0],i=1;i<r.length;++i)r[i]>e&&(e=r[i]);return e},ic=function(r,e,i){var n=e/8|0;return(r[n]|r[n+1]<<8)>>(e&7)&i},PC=function(r,e){var i=e/8|0;return(r[i]|r[i+1]<<8|r[i+2]<<16)>>(e&7)},oY=function(r){return(r+7)/8|0},lY=function(r,e,i){return(i==null||i>r.length)&&(i=r.length),new Dl(r.subarray(e,i))},cY=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],rc=function(r,e,i){var n=new Error(e||cY[r]);if(n.code=r,Error.captureStackTrace&&Error.captureStackTrace(n,rc),!i)throw n;return n},uY=function(r,e,i,n){var s=r.length,o=0;if(!s||e.f&&!e.l)return i||new Dl(0);var l=!i,u=l||e.i!=2,c=e.i;l&&(i=new Dl(s*3));var h=function(qt){var yt=i.length;if(qt>yt){var Ei=new Dl(Math.max(yt*2,qt));Ei.set(i),i=Ei}},p=e.f||0,f=e.p||0,g=e.b||0,m=e.l,y=e.d,b=e.m,v=e.n,_=s*8;do{if(!m){p=ic(r,f,1);var C=ic(r,f+1,3);if(f+=3,C)if(C==1)m=sY,y=aY,b=9,v=5;else if(C==2){var E=ic(r,f,31)+257,T=ic(r,f+10,15)+4,R=E+ic(r,f+5,31)+1;f+=14;for(var B=new Dl(R),I=new Dl(19),D=0;D<T;++D)I[tY[D]]=ic(r,f+D*3,7);f+=T*3;for(var L=OC(I),O=(1<<L)-1,F=fA(I,L),D=0;D<R;){var q=F[ic(r,f,O)];f+=q&15;var H=q>>4;if(H<16)B[D++]=H;else{var G=0,J=0;for(H==16?(J=3+ic(r,f,3),f+=2,G=B[D-1]):H==17?(J=3+ic(r,f,7),f+=3):H==18&&(J=11+ic(r,f,127),f+=7);J--;)B[D++]=G}}var Q=B.subarray(0,E),V=B.subarray(E);b=OC(Q),v=OC(V),m=fA(Q,b),y=fA(V,v)}else rc(1);else{var H=oY(f)+4,z=r[H-4]|r[H-3]<<8,te=H+z;if(te>s){c&&rc(0);break}u&&h(g+z),i.set(r.subarray(H,te),g),e.b=g+=z,e.p=f=te*8,e.f=p;continue}if(f>_){c&&rc(0);break}}u&&h(g+131072);for(var K=(1<<b)-1,ae=(1<<v)-1,Ae=f;;Ae=f){var G=m[PC(r,f)&K],_e=G>>4;if(f+=G&15,f>_){c&&rc(0);break}if(G||rc(2),_e<256)i[g++]=_e;else if(_e==256){Ae=f,m=null;break}else{var me=_e-254;if(_e>264){var D=_e-257,Pe=dP[D];me=ic(r,f,(1<<Pe)-1)+gP[D],f+=Pe}var Xe=y[PC(r,f)&ae],Je=Xe>>4;Xe||rc(3),f+=Xe&15;var V=nY[Je];if(Je>3){var Pe=pP[Je];V+=PC(r,f)&(1<<Pe)-1,f+=Pe}if(f>_){c&&rc(0);break}u&&h(g+131072);var tt=g+me;if(g<V){var dt=o-V,wt=Math.min(V,tt);for(dt+g<0&&rc(3);g<wt;++g)i[g]=n[dt+g]}for(;g<tt;++g)i[g]=i[g-V]}}e.l=m,e.p=Ae,e.b=g,e.f=p,m&&(p=1,e.m=b,e.d=y,e.n=v)}while(!p);return g!=i.length&&l?lY(i,0,g):i.subarray(0,g)},hY=new Dl(0),dY=function(r,e){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&rc(6,"invalid zlib data"),(r[1]>>5&1)==1&&rc(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2};function pY(r,e){return uY(r.subarray(dY(r),-4),{i:2},e,e)}var fY=typeof TextDecoder<"u"&&new TextDecoder,mY=0;try{fY.decode(hY,{stream:!0}),mY=1}catch{}function vP(r,e,i){const n=i.length-r-1;if(e>=i[n])return n-1;if(e<=i[r])return r;let s=r,o=n,l=Math.floor((s+o)/2);for(;e<i[l]||e>=i[l+1];)e<i[l]?o=l:s=l,l=Math.floor((s+o)/2);return l}function gY(r,e,i,n){const s=[],o=[],l=[];s[0]=1;for(let u=1;u<=i;++u){o[u]=e-n[r+1-u],l[u]=n[r+u]-e;let c=0;for(let h=0;h<u;++h){const p=l[h+1],f=o[u-h],g=s[h]/(p+f);s[h]=c+p*g,c=f*g}s[u]=c}return s}function AY(r,e,i,n){const s=vP(r,n,e),o=gY(s,n,r,e),l=new Uo(0,0,0,0);for(let u=0;u<=r;++u){const c=i[s-r+u],h=o[u],p=c.w*h;l.x+=c.x*p,l.y+=c.y*p,l.z+=c.z*p,l.w+=c.w*h}return l}function yY(r,e,i,n,s){const o=[];for(let f=0;f<=i;++f)o[f]=0;const l=[];for(let f=0;f<=n;++f)l[f]=o.slice(0);const u=[];for(let f=0;f<=i;++f)u[f]=o.slice(0);u[0][0]=1;const c=o.slice(0),h=o.slice(0);for(let f=1;f<=i;++f){c[f]=e-s[r+1-f],h[f]=s[r+f]-e;let g=0;for(let m=0;m<f;++m){const y=h[m+1],b=c[f-m];u[f][m]=y+b;const v=u[m][f-1]/u[f][m];u[m][f]=g+y*v,g=b*v}u[f][f]=g}for(let f=0;f<=i;++f)l[0][f]=u[f][i];for(let f=0;f<=i;++f){let g=0,m=1;const y=[];for(let b=0;b<=i;++b)y[b]=o.slice(0);y[0][0]=1;for(let b=1;b<=n;++b){let v=0;const _=f-b,C=i-b;f>=b&&(y[m][0]=y[g][0]/u[C+1][_],v=y[m][0]*u[_][C]);const E=_>=-1?1:-_,T=f-1<=C?b-1:i-f;for(let B=E;B<=T;++B)y[m][B]=(y[g][B]-y[g][B-1])/u[C+1][_+B],v+=y[m][B]*u[_+B][C];f<=C&&(y[m][b]=-y[g][b-1]/u[C+1][f],v+=y[m][b]*u[f][C]),l[b][f]=v;const R=g;g=m,m=R}}let p=i;for(let f=1;f<=n;++f){for(let g=0;g<=i;++g)l[f][g]*=p;p*=i-f}return l}function vY(r,e,i,n,s){const o=s<r?s:r,l=[],u=vP(r,n,e),c=yY(u,n,r,o,e),h=[];for(let p=0;p<i.length;++p){const f=i[p].clone(),g=f.w;f.x*=g,f.y*=g,f.z*=g,h[p]=f}for(let p=0;p<=o;++p){const f=h[u-r].clone().multiplyScalar(c[p][0]);for(let g=1;g<=r;++g)f.add(h[u-r+g].clone().multiplyScalar(c[p][g]));l[p]=f}for(let p=o+1;p<=s+1;++p)l[p]=new Uo(0,0,0);return l}function bY(r,e){let i=1;for(let s=2;s<=r;++s)i*=s;let n=1;for(let s=2;s<=e;++s)n*=s;for(let s=2;s<=r-e;++s)n*=s;return i/n}function xY(r){const e=r.length,i=[],n=[];for(let o=0;o<e;++o){const l=r[o];i[o]=new kt(l.x,l.y,l.z),n[o]=l.w}const s=[];for(let o=0;o<e;++o){const l=i[o].clone();for(let u=1;u<=o;++u)l.sub(s[o-u].clone().multiplyScalar(bY(o,u)*n[u]));s[o]=l.divideScalar(n[0])}return s}function _Y(r,e,i,n,s){const o=vY(r,e,i,n,s);return xY(o)}class EY extends nK{constructor(e,i,n,s,o){super(),this.degree=e,this.knots=i,this.controlPoints=[],this.startKnot=s||0,this.endKnot=o||this.knots.length-1;for(let l=0;l<n.length;++l){const u=n[l];this.controlPoints[l]=new Uo(u.x,u.y,u.z,u.w)}}getPoint(e,i=new kt){const n=i,s=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),o=AY(this.degree,this.knots,this.controlPoints,s);return o.w!==1&&o.divideScalar(o.w),n.set(o.x,o.y,o.z)}getTangent(e,i=new kt){const n=i,s=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),o=_Y(this.degree,this.knots,this.controlPoints,s,1);return n.copy(o[1]).normalize(),n}}let fn,Hs,vo;class wY extends hp{constructor(e){super(e)}load(e,i,n,s){const o=this,l=o.path===""?HK.extractUrlBase(e):o.path,u=new OK(this.manager);u.setPath(o.path),u.setResponseType("arraybuffer"),u.setRequestHeader(o.requestHeader),u.setWithCredentials(o.withCredentials),u.load(e,function(c){try{i(o.parse(c,l))}catch(h){s?s(h):console.error(h),o.manager.itemError(e)}},n,s)}parse(e,i){if(IY(e))fn=new RY().parse(e);else{const s=CP(e);if(!BY(s))throw new Error("THREE.FBXLoader: Unknown format.");if(_P(s)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+_P(s));fn=new MY().parse(s)}const n=new kK(this.manager).setPath(this.resourcePath||i).setCrossOrigin(this.crossOrigin);return new CY(n,this.manager).parse(fn)}}class CY{constructor(e,i){this.textureLoader=e,this.manager=i}parse(){Hs=this.parseConnections();const e=this.parseImages(),i=this.parseTextures(e),n=this.parseMaterials(i),s=this.parseDeformers(),o=new SY().parse(s);return this.parseScene(s,o,n),vo}parseConnections(){const e=new Map;return"Connections"in fn&&fn.Connections.connections.forEach(function(i){const n=i[0],s=i[1],o=i[2];e.has(n)||e.set(n,{parents:[],children:[]});const l={ID:s,relationship:o};e.get(n).parents.push(l),e.has(s)||e.set(s,{parents:[],children:[]});const u={ID:n,relationship:o};e.get(s).children.push(u)}),e}parseImages(){const e={},i={};if("Video"in fn.Objects){const n=fn.Objects.Video;for(const s in n){const o=n[s],l=parseInt(s);if(e[l]=o.RelativeFilename||o.Filename,"Content"in o){const u=o.Content instanceof ArrayBuffer&&o.Content.byteLength>0,c=typeof o.Content=="string"&&o.Content!=="";if(u||c){const h=this.parseImage(n[s]);i[o.RelativeFilename||o.Filename]=h}}}}for(const n in e){const s=e[n];i[s]!==void 0?e[n]=i[s]:e[n]=e[n].split("\\").pop()}return e}parseImage(e){const i=e.Content,n=e.RelativeFilename||e.Filename,s=n.slice(n.lastIndexOf(".")+1).toLowerCase();let o;switch(s){case"bmp":o="image/bmp";break;case"jpg":case"jpeg":o="image/jpeg";break;case"png":o="image/png";break;case"tif":o="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",n),o="image/tga";break;default:console.warn('FBXLoader: Image type "'+s+'" is not supported.');return}if(typeof i=="string")return"data:"+o+";base64,"+i;{const l=new Uint8Array(i);return window.URL.createObjectURL(new Blob([l],{type:o}))}}parseTextures(e){const i=new Map;if("Texture"in fn.Objects){const n=fn.Objects.Texture;for(const s in n){const o=this.parseTexture(n[s],e);i.set(parseInt(s),o)}}return i}parseTexture(e,i){const n=this.loadTexture(e,i);n.ID=e.id,n.name=e.attrName;const s=e.WrapModeU,o=e.WrapModeV,l=s!==void 0?s.value:0,u=o!==void 0?o.value:0;if(n.wrapS=l===0?mb:Qf,n.wrapT=u===0?mb:Qf,"Scaling"in e){const c=e.Scaling.value;n.repeat.x=c[0],n.repeat.y=c[1]}if("Translation"in e){const c=e.Translation.value;n.offset.x=c[0],n.offset.y=c[1]}return n}loadTexture(e,i){let n;const s=this.textureLoader.path,o=Hs.get(e.id).children;o!==void 0&&o.length>0&&i[o[0].ID]!==void 0&&(n=i[o[0].ID],(n.indexOf("blob:")===0||n.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let l;const u=e.FileName.slice(-3).toLowerCase();if(u==="tga"){const c=this.manager.getHandler(".tga");c===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),l=new Au):(c.setPath(this.textureLoader.path),l=c.load(n))}else if(u==="dds"){const c=this.manager.getHandler(".dds");c===null?(console.warn("FBXLoader: DDS loader not found, creating placeholder texture for",e.RelativeFilename),l=new Au):(c.setPath(this.textureLoader.path),l=c.load(n))}else u==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),l=new Au):l=this.textureLoader.load(n);return this.textureLoader.setPath(s),l}parseMaterials(e){const i=new Map;if("Material"in fn.Objects){const n=fn.Objects.Material;for(const s in n){const o=this.parseMaterial(n[s],e);o!==null&&i.set(parseInt(s),o)}}return i}parseMaterial(e,i){const n=e.id,s=e.attrName;let o=e.ShadingModel;if(typeof o=="object"&&(o=o.value),!Hs.has(n))return null;const l=this.parseParameters(e,i,n);let u;switch(o.toLowerCase()){case"phong":u=new RC;break;case"lambert":u=new _K;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',o),u=new RC;break}return u.setValues(l),u.name=s,u}parseParameters(e,i,n){const s={};e.BumpFactor&&(s.bumpScale=e.BumpFactor.value),e.Diffuse?s.color=new Ys().fromArray(e.Diffuse.value).convertSRGBToLinear():e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(s.color=new Ys().fromArray(e.DiffuseColor.value).convertSRGBToLinear()),e.DisplacementFactor&&(s.displacementScale=e.DisplacementFactor.value),e.Emissive?s.emissive=new Ys().fromArray(e.Emissive.value).convertSRGBToLinear():e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(s.emissive=new Ys().fromArray(e.EmissiveColor.value).convertSRGBToLinear()),e.EmissiveFactor&&(s.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(s.opacity=parseFloat(e.Opacity.value)),s.opacity<1&&(s.transparent=!0),e.ReflectionFactor&&(s.reflectivity=e.ReflectionFactor.value),e.Shininess&&(s.shininess=e.Shininess.value),e.Specular?s.specular=new Ys().fromArray(e.Specular.value).convertSRGBToLinear():e.SpecularColor&&e.SpecularColor.type==="Color"&&(s.specular=new Ys().fromArray(e.SpecularColor.value).convertSRGBToLinear());const o=this;return Hs.get(n).children.forEach(function(l){const u=l.relationship;switch(u){case"Bump":s.bumpMap=o.getTexture(i,l.ID);break;case"Maya|TEX_ao_map":s.aoMap=o.getTexture(i,l.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":s.map=o.getTexture(i,l.ID),s.map!==void 0&&(s.map.colorSpace=Nl);break;case"DisplacementColor":s.displacementMap=o.getTexture(i,l.ID);break;case"EmissiveColor":s.emissiveMap=o.getTexture(i,l.ID),s.emissiveMap!==void 0&&(s.emissiveMap.colorSpace=Nl);break;case"NormalMap":case"Maya|TEX_normal_map":s.normalMap=o.getTexture(i,l.ID);break;case"ReflectionColor":s.envMap=o.getTexture(i,l.ID),s.envMap!==void 0&&(s.envMap.mapping=rX,s.envMap.colorSpace=Nl);break;case"SpecularColor":s.specularMap=o.getTexture(i,l.ID),s.specularMap!==void 0&&(s.specularMap.colorSpace=Nl);break;case"TransparentColor":case"TransparencyFactor":s.alphaMap=o.getTexture(i,l.ID),s.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",u);break}}),s}getTexture(e,i){return"LayeredTexture"in fn.Objects&&i in fn.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),i=Hs.get(i).children[0].ID),e.get(i)}parseDeformers(){const e={},i={};if("Deformer"in fn.Objects){const n=fn.Objects.Deformer;for(const s in n){const o=n[s],l=Hs.get(parseInt(s));if(o.attrType==="Skin"){const u=this.parseSkeleton(l,n);u.ID=s,l.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),u.geometryID=l.parents[0].ID,e[s]=u}else if(o.attrType==="BlendShape"){const u={id:s};u.rawTargets=this.parseMorphTargets(l,n),u.id=s,l.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),i[s]=u}}}return{skeletons:e,morphTargets:i}}parseSkeleton(e,i){const n=[];return e.children.forEach(function(s){const o=i[s.ID];if(o.attrType!=="Cluster")return;const l={ID:s.ID,indices:[],weights:[],transformLink:new Hr().fromArray(o.TransformLink.a)};"Indexes"in o&&(l.indices=o.Indexes.a,l.weights=o.Weights.a),n.push(l)}),{rawBones:n,bones:[]}}parseMorphTargets(e,i){const n=[];for(let s=0;s<e.children.length;s++){const o=e.children[s],l=i[o.ID],u={name:l.attrName,initialWeight:l.DeformPercent,id:l.id,fullWeights:l.FullWeights.a};if(l.attrType!=="BlendShapeChannel")return;u.geoID=Hs.get(parseInt(o.ID)).children.filter(function(c){return c.relationship===void 0})[0].ID,n.push(u)}return n}parseScene(e,i,n){vo=new VO;const s=this.parseModels(e.skeletons,i,n),o=fn.Objects.Model,l=this;s.forEach(function(c){const h=o[c.ID];l.setLookAtProperties(c,h),Hs.get(c.ID).parents.forEach(function(p){const f=s.get(p.ID);f!==void 0&&f.add(c)}),c.parent===null&&vo.add(c)}),this.bindSkeleton(e.skeletons,i,s),this.addGlobalSceneSettings(),vo.traverse(function(c){if(c.userData.transformData){c.parent&&(c.userData.transformData.parentMatrix=c.parent.matrix,c.userData.transformData.parentMatrixWorld=c.parent.matrixWorld);const h=EP(c.userData.transformData);c.applyMatrix4(h),c.updateWorldMatrix()}});const u=new TY().parse();vo.children.length===1&&vo.children[0].isGroup&&(vo.children[0].animations=u,vo=vo.children[0]),vo.animations=u}parseModels(e,i,n){const s=new Map,o=fn.Objects.Model;for(const l in o){const u=parseInt(l),c=o[l],h=Hs.get(u);let p=this.buildSkeleton(h,e,u,c.attrName);if(!p){switch(c.attrType){case"Camera":p=this.createCamera(h);break;case"Light":p=this.createLight(h);break;case"Mesh":p=this.createMesh(h,i,n);break;case"NurbsCurve":p=this.createCurve(h,i);break;case"LimbNode":case"Root":p=new EC;break;case"Null":default:p=new VO;break}p.name=c.attrName?Gn.sanitizeNodeName(c.attrName):"",p.userData.originalName=c.attrName,p.ID=u}this.getTransformData(p,c),s.set(u,p)}return s}buildSkeleton(e,i,n,s){let o=null;return e.parents.forEach(function(l){for(const u in i){const c=i[u];c.rawBones.forEach(function(h,p){if(h.ID===l.ID){const f=o;o=new EC,o.matrixWorld.copy(h.transformLink),o.name=s?Gn.sanitizeNodeName(s):"",o.userData.originalName=s,o.ID=n,c.bones[p]=o,f!==null&&o.add(f)}})}}),o}createCamera(e){let i,n;if(e.children.forEach(function(s){const o=fn.Objects.NodeAttribute[s.ID];o!==void 0&&(n=o)}),n===void 0)i=new Fa;else{let s=0;n.CameraProjectionType!==void 0&&n.CameraProjectionType.value===1&&(s=1);let o=1;n.NearPlane!==void 0&&(o=n.NearPlane.value/1e3);let l=1e3;n.FarPlane!==void 0&&(l=n.FarPlane.value/1e3);let u=window.innerWidth,c=window.innerHeight;n.AspectWidth!==void 0&&n.AspectHeight!==void 0&&(u=n.AspectWidth.value,c=n.AspectHeight.value);const h=u/c;let p=45;n.FieldOfView!==void 0&&(p=n.FieldOfView.value);const f=n.FocalLength?n.FocalLength.value:null;switch(s){case 0:i=new vC(p,h,o,l),f!==null&&i.setFocalLength(f);break;case 1:i=new GO(-u/2,u/2,c/2,-c/2,o,l);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+s+"."),i=new Fa;break}}return i}createLight(e){let i,n;if(e.children.forEach(function(s){const o=fn.Objects.NodeAttribute[s.ID];o!==void 0&&(n=o)}),n===void 0)i=new Fa;else{let s;n.LightType===void 0?s=0:s=n.LightType.value;let o=16777215;n.Color!==void 0&&(o=new Ys().fromArray(n.Color.value).convertSRGBToLinear());let l=n.Intensity===void 0?1:n.Intensity.value/100;n.CastLightOnObject!==void 0&&n.CastLightOnObject.value===0&&(l=0);let u=0;n.FarAttenuationEnd!==void 0&&(n.EnableFarAttenuation!==void 0&&n.EnableFarAttenuation.value===0?u=0:u=n.FarAttenuationEnd.value);const c=1;switch(s){case 0:i=new hP(o,l,u,c);break;case 1:i=new GK(o,l);break;case 2:let h=Math.PI/3;n.InnerAngle!==void 0&&(h=Ao.degToRad(n.InnerAngle.value));let p=0;n.OuterAngle!==void 0&&(p=Ao.degToRad(n.OuterAngle.value),p=Math.max(p,1)),i=new UK(o,l,u,h,p,c);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),i=new hP(o,l);break}n.CastShadows!==void 0&&n.CastShadows.value===1&&(i.castShadow=!0)}return i}createMesh(e,i,n){let s,o=null,l=null;const u=[];return e.children.forEach(function(c){i.has(c.ID)&&(o=i.get(c.ID)),n.has(c.ID)&&u.push(n.get(c.ID))}),u.length>1?l=u:u.length>0?l=u[0]:(l=new RC({name:hp.DEFAULT_MATERIAL_NAME,color:13421772}),u.push(l)),"color"in o.attributes&&u.forEach(function(c){c.vertexColors=!0}),o.FBX_Deformer?(s=new eK(o,l),s.normalizeSkinWeights()):s=new FO(o,l),s}createCurve(e,i){const n=e.children.reduce(function(o,l){return i.has(l.ID)&&(o=i.get(l.ID)),o},null),s=new YO({name:hp.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new rK(n,s)}getTransformData(e,i){const n={};"InheritType"in i&&(n.inheritType=parseInt(i.InheritType.value)),"RotationOrder"in i?n.eulerOrder=wP(i.RotationOrder.value):n.eulerOrder="ZYX","Lcl_Translation"in i&&(n.translation=i.Lcl_Translation.value),"PreRotation"in i&&(n.preRotation=i.PreRotation.value),"Lcl_Rotation"in i&&(n.rotation=i.Lcl_Rotation.value),"PostRotation"in i&&(n.postRotation=i.PostRotation.value),"Lcl_Scaling"in i&&(n.scale=i.Lcl_Scaling.value),"ScalingOffset"in i&&(n.scalingOffset=i.ScalingOffset.value),"ScalingPivot"in i&&(n.scalingPivot=i.ScalingPivot.value),"RotationOffset"in i&&(n.rotationOffset=i.RotationOffset.value),"RotationPivot"in i&&(n.rotationPivot=i.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(e,i){"LookAtProperty"in i&&Hs.get(e.ID).children.forEach(function(n){if(n.relationship==="LookAtProperty"){const s=fn.Objects.Model[n.ID];if("Lcl_Translation"in s){const o=s.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(o),vo.add(e.target)):e.lookAt(new kt().fromArray(o))}}})}bindSkeleton(e,i,n){const s=this.parsePoseNodes();for(const o in e){const l=e[o];Hs.get(parseInt(l.ID)).parents.forEach(function(u){if(i.has(u.ID)){const c=u.ID;Hs.get(c).parents.forEach(function(h){n.has(h.ID)&&n.get(h.ID).bind(new wC(l.bones),s[h.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in fn.Objects){const i=fn.Objects.Pose;for(const n in i)if(i[n].attrType==="BindPose"&&i[n].NbPoseNodes>0){const s=i[n].PoseNode;Array.isArray(s)?s.forEach(function(o){e[o.Node]=new Hr().fromArray(o.Matrix.a)}):e[s.Node]=new Hr().fromArray(s.Matrix.a)}}return e}addGlobalSceneSettings(){if("GlobalSettings"in fn){if("AmbientColor"in fn.GlobalSettings){const e=fn.GlobalSettings.AmbientColor.value,i=e[0],n=e[1],s=e[2];if(i!==0||n!==0||s!==0){const o=new Ys(i,n,s).convertSRGBToLinear();vo.add(new VK(o,1))}}"UnitScaleFactor"in fn.GlobalSettings&&(vo.userData.unitScaleFactor=fn.GlobalSettings.UnitScaleFactor.value)}}}class SY{constructor(){this.negativeMaterialIndices=!1}parse(e){const i=new Map;if("Geometry"in fn.Objects){const n=fn.Objects.Geometry;for(const s in n){const o=Hs.get(parseInt(s)),l=this.parseGeometry(o,n[s],e);i.set(parseInt(s),l)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),i}parseGeometry(e,i,n){switch(i.attrType){case"Mesh":return this.parseMeshGeometry(e,i,n);case"NurbsCurve":return this.parseNurbsGeometry(i)}}parseMeshGeometry(e,i,n){const s=n.skeletons,o=[],l=e.parents.map(function(f){return fn.Objects.Model[f.ID]});if(l.length===0)return;const u=e.children.reduce(function(f,g){return s[g.ID]!==void 0&&(f=s[g.ID]),f},null);e.children.forEach(function(f){n.morphTargets[f.ID]!==void 0&&o.push(n.morphTargets[f.ID])});const c=l[0],h={};"RotationOrder"in c&&(h.eulerOrder=wP(c.RotationOrder.value)),"InheritType"in c&&(h.inheritType=parseInt(c.InheritType.value)),"GeometricTranslation"in c&&(h.translation=c.GeometricTranslation.value),"GeometricRotation"in c&&(h.rotation=c.GeometricRotation.value),"GeometricScaling"in c&&(h.scale=c.GeometricScaling.value);const p=EP(h);return this.genGeometry(i,u,o,p)}genGeometry(e,i,n,s){const o=new sA;e.attrName&&(o.name=e.attrName);const l=this.parseGeoNode(e,i),u=this.genBuffers(l),c=new Hh(u.vertex,3);if(c.applyMatrix4(s),o.setAttribute("position",c),u.colors.length>0&&o.setAttribute("color",new Hh(u.colors,3)),i&&(o.setAttribute("skinIndex",new NO(u.weightsIndices,4)),o.setAttribute("skinWeight",new Hh(u.vertexWeights,4)),o.FBX_Deformer=i),u.normal.length>0){const h=new Fh().getNormalMatrix(s),p=new Hh(u.normal,3);p.applyNormalMatrix(h),o.setAttribute("normal",p)}if(u.uvs.forEach(function(h,p){const f=p===0?"uv":`uv${p}`;o.setAttribute(f,new Hh(u.uvs[p],2))}),l.material&&l.material.mappingType!=="AllSame"){let h=u.materialIndex[0],p=0;if(u.materialIndex.forEach(function(f,g){f!==h&&(o.addGroup(p,g-p,h),h=f,p=g)}),o.groups.length>0){const f=o.groups[o.groups.length-1],g=f.start+f.count;g!==u.materialIndex.length&&o.addGroup(g,u.materialIndex.length-g,h)}o.groups.length===0&&o.addGroup(0,u.materialIndex.length,u.materialIndex[0])}return this.addMorphTargets(o,e,n,s),o}parseGeoNode(e,i){const n={};if(n.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],n.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let s=0;for(;e.LayerElementUV[s];)e.LayerElementUV[s].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[s])),s++}return n.weightTable={},i!==null&&(n.skeleton=i,i.rawBones.forEach(function(s,o){s.indices.forEach(function(l,u){n.weightTable[l]===void 0&&(n.weightTable[l]=[]),n.weightTable[l].push({id:o,weight:s.weights[u]})})})),n}genBuffers(e){const i={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,s=0,o=!1,l=[],u=[],c=[],h=[],p=[],f=[];const g=this;return e.vertexIndices.forEach(function(m,y){let b,v=!1;m<0&&(m=m^-1,v=!0);let _=[],C=[];if(l.push(m*3,m*3+1,m*3+2),e.color){const E=$b(y,n,m,e.color);c.push(E[0],E[1],E[2])}if(e.skeleton){if(e.weightTable[m]!==void 0&&e.weightTable[m].forEach(function(E){C.push(E.weight),_.push(E.id)}),C.length>4){o||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),o=!0);const E=[0,0,0,0],T=[0,0,0,0];C.forEach(function(R,B){let I=R,D=_[B];T.forEach(function(L,O,F){if(I>L){F[O]=I,I=L;const q=E[O];E[O]=D,D=q}})}),_=E,C=T}for(;C.length<4;)C.push(0),_.push(0);for(let E=0;E<4;++E)p.push(C[E]),f.push(_[E])}if(e.normal){const E=$b(y,n,m,e.normal);u.push(E[0],E[1],E[2])}e.material&&e.material.mappingType!=="AllSame"&&(b=$b(y,n,m,e.material)[0],b<0&&(g.negativeMaterialIndices=!0,b=0)),e.uv&&e.uv.forEach(function(E,T){const R=$b(y,n,m,E);h[T]===void 0&&(h[T]=[]),h[T].push(R[0]),h[T].push(R[1])}),s++,v&&(g.genFace(i,e,l,b,u,c,h,p,f,s),n++,s=0,l=[],u=[],c=[],h=[],p=[],f=[])}),i}getNormalNewell(e){const i=new kt(0,0,0);for(let n=0;n<e.length;n++){const s=e[n],o=e[(n+1)%e.length];i.x+=(s.y-o.y)*(s.z+o.z),i.y+=(s.z-o.z)*(s.x+o.x),i.z+=(s.x-o.x)*(s.y+o.y)}return i.normalize(),i}getNormalTangentAndBitangent(e){const i=this.getNormalNewell(e),n=(Math.abs(i.z)>.5?new kt(0,1,0):new kt(0,0,1)).cross(i).normalize(),s=i.clone().cross(n).normalize();return{normal:i,tangent:n,bitangent:s}}flattenVertex(e,i,n){return new Vs(e.dot(i),e.dot(n))}genFace(e,i,n,s,o,l,u,c,h,p){let f;if(p>3){const g=[];for(let v=0;v<n.length;v+=3)g.push(new kt(i.vertexPositions[n[v]],i.vertexPositions[n[v+1]],i.vertexPositions[n[v+2]]));const{tangent:m,bitangent:y}=this.getNormalTangentAndBitangent(g),b=[];for(const v of g)b.push(this.flattenVertex(v,m,y));f=MC.triangulateShape(b,[])}else f=[[0,1,2]];for(const[g,m,y]of f)e.vertex.push(i.vertexPositions[n[g*3]]),e.vertex.push(i.vertexPositions[n[g*3+1]]),e.vertex.push(i.vertexPositions[n[g*3+2]]),e.vertex.push(i.vertexPositions[n[m*3]]),e.vertex.push(i.vertexPositions[n[m*3+1]]),e.vertex.push(i.vertexPositions[n[m*3+2]]),e.vertex.push(i.vertexPositions[n[y*3]]),e.vertex.push(i.vertexPositions[n[y*3+1]]),e.vertex.push(i.vertexPositions[n[y*3+2]]),i.skeleton&&(e.vertexWeights.push(c[g*4]),e.vertexWeights.push(c[g*4+1]),e.vertexWeights.push(c[g*4+2]),e.vertexWeights.push(c[g*4+3]),e.vertexWeights.push(c[m*4]),e.vertexWeights.push(c[m*4+1]),e.vertexWeights.push(c[m*4+2]),e.vertexWeights.push(c[m*4+3]),e.vertexWeights.push(c[y*4]),e.vertexWeights.push(c[y*4+1]),e.vertexWeights.push(c[y*4+2]),e.vertexWeights.push(c[y*4+3]),e.weightsIndices.push(h[g*4]),e.weightsIndices.push(h[g*4+1]),e.weightsIndices.push(h[g*4+2]),e.weightsIndices.push(h[g*4+3]),e.weightsIndices.push(h[m*4]),e.weightsIndices.push(h[m*4+1]),e.weightsIndices.push(h[m*4+2]),e.weightsIndices.push(h[m*4+3]),e.weightsIndices.push(h[y*4]),e.weightsIndices.push(h[y*4+1]),e.weightsIndices.push(h[y*4+2]),e.weightsIndices.push(h[y*4+3])),i.color&&(e.colors.push(l[g*3]),e.colors.push(l[g*3+1]),e.colors.push(l[g*3+2]),e.colors.push(l[m*3]),e.colors.push(l[m*3+1]),e.colors.push(l[m*3+2]),e.colors.push(l[y*3]),e.colors.push(l[y*3+1]),e.colors.push(l[y*3+2])),i.material&&i.material.mappingType!=="AllSame"&&(e.materialIndex.push(s),e.materialIndex.push(s),e.materialIndex.push(s)),i.normal&&(e.normal.push(o[g*3]),e.normal.push(o[g*3+1]),e.normal.push(o[g*3+2]),e.normal.push(o[m*3]),e.normal.push(o[m*3+1]),e.normal.push(o[m*3+2]),e.normal.push(o[y*3]),e.normal.push(o[y*3+1]),e.normal.push(o[y*3+2])),i.uv&&i.uv.forEach(function(b,v){e.uvs[v]===void 0&&(e.uvs[v]=[]),e.uvs[v].push(u[v][g*2]),e.uvs[v].push(u[v][g*2+1]),e.uvs[v].push(u[v][m*2]),e.uvs[v].push(u[v][m*2+1]),e.uvs[v].push(u[v][y*2]),e.uvs[v].push(u[v][y*2+1])})}addMorphTargets(e,i,n,s){if(n.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const o=this;n.forEach(function(l){l.rawTargets.forEach(function(u){const c=fn.Objects.Geometry[u.geoID];c!==void 0&&o.genMorphGeometry(e,i,c,s,u.name)})})}genMorphGeometry(e,i,n,s,o){const l=i.PolygonVertexIndex!==void 0?i.PolygonVertexIndex.a:[],u=n.Vertices!==void 0?n.Vertices.a:[],c=n.Indexes!==void 0?n.Indexes.a:[],h=e.attributes.position.count*3,p=new Float32Array(h);for(let y=0;y<c.length;y++){const b=c[y]*3;p[b]=u[y*3],p[b+1]=u[y*3+1],p[b+2]=u[y*3+2]}const f={vertexIndices:l,vertexPositions:p},g=this.genBuffers(f),m=new Hh(g.vertex,3);m.name=o||n.attrName,m.applyMatrix4(s),e.morphAttributes.position.push(m)}parseNormals(e){const i=e.MappingInformationType,n=e.ReferenceInformationType,s=e.Normals.a;let o=[];return n==="IndexToDirect"&&("NormalIndex"in e?o=e.NormalIndex.a:"NormalsIndex"in e&&(o=e.NormalsIndex.a)),{dataSize:3,buffer:s,indices:o,mappingType:i,referenceType:n}}parseUVs(e){const i=e.MappingInformationType,n=e.ReferenceInformationType,s=e.UV.a;let o=[];return n==="IndexToDirect"&&(o=e.UVIndex.a),{dataSize:2,buffer:s,indices:o,mappingType:i,referenceType:n}}parseVertexColors(e){const i=e.MappingInformationType,n=e.ReferenceInformationType,s=e.Colors.a;let o=[];n==="IndexToDirect"&&(o=e.ColorIndex.a);for(let l=0,u=new Ys;l<s.length;l+=4)u.fromArray(s,l).convertSRGBToLinear().toArray(s,l);return{dataSize:4,buffer:s,indices:o,mappingType:i,referenceType:n}}parseMaterialIndices(e){const i=e.MappingInformationType,n=e.ReferenceInformationType;if(i==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const s=e.Materials.a,o=[];for(let l=0;l<s.length;++l)o.push(l);return{dataSize:1,buffer:s,indices:o,mappingType:i,referenceType:n}}parseNurbsGeometry(e){const i=parseInt(e.Order);if(isNaN(i))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new sA;const n=i-1,s=e.KnotVector.a,o=[],l=e.Points.a;for(let p=0,f=l.length;p<f;p+=4)o.push(new Uo().fromArray(l,p));let u,c;if(e.Form==="Closed")o.push(o[0]);else if(e.Form==="Periodic"){u=n,c=s.length-1-u;for(let p=0;p<n;++p)o.push(o[p])}const h=new EY(n,s,o,u,c).getPoints(o.length*12);return new sA().setFromPoints(h)}}class TY{parse(){const e=[],i=this.parseClips();if(i!==void 0)for(const n in i){const s=i[n],o=this.addClip(s);e.push(o)}return e}parseClips(){if(fn.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const i=this.parseAnimationLayers(e);return this.parseAnimStacks(i)}parseAnimationCurveNodes(){const e=fn.Objects.AnimationCurveNode,i=new Map;for(const n in e){const s=e[n];if(s.attrName.match(/S|R|T|DeformPercent/)!==null){const o={id:s.id,attr:s.attrName,curves:{}};i.set(o.id,o)}}return i}parseAnimationCurves(e){const i=fn.Objects.AnimationCurve;for(const n in i){const s={id:i[n].id,times:i[n].KeyTime.a.map(NY),values:i[n].KeyValueFloat.a},o=Hs.get(s.id);if(o!==void 0){const l=o.parents[0].ID,u=o.parents[0].relationship;u.match(/X/)?e.get(l).curves.x=s:u.match(/Y/)?e.get(l).curves.y=s:u.match(/Z/)?e.get(l).curves.z=s:u.match(/DeformPercent/)&&e.has(l)&&(e.get(l).curves.morph=s)}}}parseAnimationLayers(e){const i=fn.Objects.AnimationLayer,n=new Map;for(const s in i){const o=[],l=Hs.get(parseInt(s));l!==void 0&&(l.children.forEach(function(u,c){if(e.has(u.ID)){const h=e.get(u.ID);if(h.curves.x!==void 0||h.curves.y!==void 0||h.curves.z!==void 0){if(o[c]===void 0){const p=Hs.get(u.ID).parents.filter(function(f){return f.relationship!==void 0})[0].ID;if(p!==void 0){const f=fn.Objects.Model[p.toString()];if(f===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",u);return}const g={modelName:f.attrName?Gn.sanitizeNodeName(f.attrName):"",ID:f.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};vo.traverse(function(m){m.ID===f.id&&(g.transform=m.matrix,m.userData.transformData&&(g.eulerOrder=m.userData.transformData.eulerOrder))}),g.transform||(g.transform=new Hr),"PreRotation"in f&&(g.preRotation=f.PreRotation.value),"PostRotation"in f&&(g.postRotation=f.PostRotation.value),o[c]=g}}o[c]&&(o[c][h.attr]=h)}else if(h.curves.morph!==void 0){if(o[c]===void 0){const p=Hs.get(u.ID).parents.filter(function(v){return v.relationship!==void 0})[0].ID,f=Hs.get(p).parents[0].ID,g=Hs.get(f).parents[0].ID,m=Hs.get(g).parents[0].ID,y=fn.Objects.Model[m],b={modelName:y.attrName?Gn.sanitizeNodeName(y.attrName):"",morphName:fn.Objects.Deformer[p].attrName};o[c]=b}o[c][h.attr]=h}}}),n.set(parseInt(s),o))}return n}parseAnimStacks(e){const i=fn.Objects.AnimationStack,n={};for(const s in i){const o=Hs.get(parseInt(s)).children;o.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const l=e.get(o[0].ID);n[s]={name:i[s].attrName,layer:l}}return n}addClip(e){let i=[];const n=this;return e.layer.forEach(function(s){i=i.concat(n.generateTracks(s))}),new RK(e.name,-1,i)}generateTracks(e){const i=[];let n=new kt,s=new kt;if(e.transform&&e.transform.decompose(n,new zo,s),n=n.toArray(),s=s.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const o=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");o!==void 0&&i.push(o)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const o=this.generateRotationTrack(e.modelName,e.R.curves,e.preRotation,e.postRotation,e.eulerOrder);o!==void 0&&i.push(o)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const o=this.generateVectorTrack(e.modelName,e.S.curves,s,"scale");o!==void 0&&i.push(o)}if(e.DeformPercent!==void 0){const o=this.generateMorphTrack(e);o!==void 0&&i.push(o)}return i}generateVectorTrack(e,i,n,s){const o=this.getTimesForAllAxes(i),l=this.getKeyframeTrackValues(o,i,n);return new hA(e+"."+s,o,l)}generateRotationTrack(e,i,n,s,o){let l,u;if(i.x!==void 0&&i.y!==void 0&&i.z!==void 0){const f=this.interpolateRotations(i.x,i.y,i.z,o);l=f[0],u=f[1]}n!==void 0&&(n=n.map(Ao.degToRad),n.push(o),n=new yo().fromArray(n),n=new zo().setFromEuler(n)),s!==void 0&&(s=s.map(Ao.degToRad),s.push(o),s=new yo().fromArray(s),s=new zo().setFromEuler(s).invert());const c=new zo,h=new yo,p=[];if(!u||!l)return new up(e+".quaternion",[0],[0]);for(let f=0;f<u.length;f+=3)h.set(u[f],u[f+1],u[f+2],o),c.setFromEuler(h),n!==void 0&&c.premultiply(n),s!==void 0&&c.multiply(s),f>2&&new zo().fromArray(p,(f-3)/3*4).dot(c)<0&&c.set(-c.x,-c.y,-c.z,-c.w),c.toArray(p,f/3*4);return new up(e+".quaternion",l,p)}generateMorphTrack(e){const i=e.DeformPercent.curves.morph,n=i.values.map(function(o){return o/100}),s=vo.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new uA(e.modelName+".morphTargetInfluences["+s+"]",i.times,n)}getTimesForAllAxes(e){let i=[];if(e.x!==void 0&&(i=i.concat(e.x.times)),e.y!==void 0&&(i=i.concat(e.y.times)),e.z!==void 0&&(i=i.concat(e.z.times)),i=i.sort(function(n,s){return n-s}),i.length>1){let n=1,s=i[0];for(let o=1;o<i.length;o++){const l=i[o];l!==s&&(i[n]=l,s=l,n++)}i=i.slice(0,n)}return i}getKeyframeTrackValues(e,i,n){const s=n,o=[];let l=-1,u=-1,c=-1;return e.forEach(function(h){if(i.x&&(l=i.x.times.indexOf(h)),i.y&&(u=i.y.times.indexOf(h)),i.z&&(c=i.z.times.indexOf(h)),l!==-1){const p=i.x.values[l];o.push(p),s[0]=p}else o.push(s[0]);if(u!==-1){const p=i.y.values[u];o.push(p),s[1]=p}else o.push(s[1]);if(c!==-1){const p=i.z.values[c];o.push(p),s[2]=p}else o.push(s[2])}),o}interpolateRotations(e,i,n,s){const o=[],l=[];o.push(e.times[0]),l.push(Ao.degToRad(e.values[0])),l.push(Ao.degToRad(i.values[0])),l.push(Ao.degToRad(n.values[0]));for(let u=1;u<e.values.length;u++){const c=[e.values[u-1],i.values[u-1],n.values[u-1]];if(isNaN(c[0])||isNaN(c[1])||isNaN(c[2]))continue;const h=c.map(Ao.degToRad),p=[e.values[u],i.values[u],n.values[u]];if(isNaN(p[0])||isNaN(p[1])||isNaN(p[2]))continue;const f=p.map(Ao.degToRad),g=[p[0]-c[0],p[1]-c[1],p[2]-c[2]],m=[Math.abs(g[0]),Math.abs(g[1]),Math.abs(g[2])];if(m[0]>=180||m[1]>=180||m[2]>=180){const y=Math.max(...m)/180,b=new yo(...h,s),v=new yo(...f,s),_=new zo().setFromEuler(b),C=new zo().setFromEuler(v);_.dot(C)&&C.set(-C.x,-C.y,-C.z,-C.w);const E=e.times[u-1],T=e.times[u]-E,R=new zo,B=new yo;for(let I=0;I<1;I+=1/y)R.copy(_.clone().slerp(C.clone(),I)),o.push(E+I*T),B.setFromQuaternion(R,s),l.push(B.x),l.push(B.y),l.push(B.z)}else o.push(e.times[u]),l.push(Ao.degToRad(e.values[u])),l.push(Ao.degToRad(i.values[u])),l.push(Ao.degToRad(n.values[u]))}return[o,l]}}class MY{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,i){this.currentProp=e,this.currentPropName=i}parse(e){this.currentIndent=0,this.allNodes=new xP,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const i=this,n=e.split(/[\r\n]+/);return n.forEach(function(s,o){const l=s.match(/^[\s\t]*;/),u=s.match(/^[\s\t]*$/);if(l||u)return;const c=s.match("^\\t{"+i.currentIndent+"}(\\w+):(.*){",""),h=s.match("^\\t{"+i.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),p=s.match("^\\t{"+(i.currentIndent-1)+"}}");c?i.parseNodeBegin(s,c):h?i.parseNodeProperty(s,h,n[++o]):p?i.popStack():s.match(/^[^\s\t}]/)&&i.parseNodePropertyContinued(s)}),this.allNodes}parseNodeBegin(e,i){const n=i[1].trim().replace(/^"/,"").replace(/"$/,""),s=i[2].split(",").map(function(c){return c.trim().replace(/^"/,"").replace(/"$/,"")}),o={name:n},l=this.parseNodeAttr(s),u=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(n,o):n in u?(n==="PoseNode"?u.PoseNode.push(o):u[n].id!==void 0&&(u[n]={},u[n][u[n].id]=u[n]),l.id!==""&&(u[n][l.id]=o)):typeof l.id=="number"?(u[n]={},u[n][l.id]=o):n!=="Properties70"&&(n==="PoseNode"?u[n]=[o]:u[n]=o),typeof l.id=="number"&&(o.id=l.id),l.name!==""&&(o.attrName=l.name),l.type!==""&&(o.attrType=l.type),this.pushStack(o)}parseNodeAttr(e){let i=e[0];e[0]!==""&&(i=parseInt(e[0]),isNaN(i)&&(i=e[0]));let n="",s="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),s=e[2]),{id:i,name:n,type:s}}parseNodeProperty(e,i,n){let s=i[1].replace(/^"/,"").replace(/"$/,"").trim(),o=i[2].replace(/^"/,"").replace(/"$/,"").trim();s==="Content"&&o===","&&(o=n.replace(/"/g,"").replace(/,$/,"").trim());const l=this.getCurrentNode();if(l.name==="Properties70"){this.parseNodeSpecialProperty(e,s,o);return}if(s==="C"){const u=o.split(",").slice(1),c=parseInt(u[0]),h=parseInt(u[1]);let p=o.split(",").slice(3);p=p.map(function(f){return f.trim().replace(/^"/,"")}),s="connections",o=[c,h],DY(o,p),l[s]===void 0&&(l[s]=[])}s==="Node"&&(l.id=o),s in l&&Array.isArray(l[s])?l[s].push(o):s!=="a"?l[s]=o:l.a=o,this.setCurrentProp(l,s),s==="a"&&o.slice(-1)!==","&&(l.a=FC(o))}parseNodePropertyContinued(e){const i=this.getCurrentNode();i.a+=e,e.slice(-1)!==","&&(i.a=FC(i.a))}parseNodeSpecialProperty(e,i,n){const s=n.split('",').map(function(p){return p.trim().replace(/^\"/,"").replace(/\s/,"_")}),o=s[0],l=s[1],u=s[2],c=s[3];let h=s[4];switch(l){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":h=parseFloat(h);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":h=FC(h);break}this.getPrevNode()[o]={type:l,type2:u,flag:c,value:h},this.setCurrentProp(this.getPrevNode(),o)}}class RY{parse(e){const i=new bP(e);i.skip(23);const n=i.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const s=new xP;for(;!this.endOfContent(i);){const o=this.parseNode(i,n);o!==null&&s.add(o.name,o)}return s}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,i){const n={},s=i>=7500?e.getUint64():e.getUint32(),o=i>=7500?e.getUint64():e.getUint32();i>=7500?e.getUint64():e.getUint32();const l=e.getUint8(),u=e.getString(l);if(s===0)return null;const c=[];for(let g=0;g<o;g++)c.push(this.parseProperty(e));const h=c.length>0?c[0]:"",p=c.length>1?c[1]:"",f=c.length>2?c[2]:"";for(n.singleProperty=o===1&&e.getOffset()===s;s>e.getOffset();){const g=this.parseNode(e,i);g!==null&&this.parseSubNode(u,n,g)}return n.propertyList=c,typeof h=="number"&&(n.id=h),p!==""&&(n.attrName=p),f!==""&&(n.attrType=f),u!==""&&(n.name=u),n}parseSubNode(e,i,n){if(n.singleProperty===!0){const s=n.propertyList[0];Array.isArray(s)?(i[n.name]=n,n.a=s):i[n.name]=s}else if(e==="Connections"&&n.name==="C"){const s=[];n.propertyList.forEach(function(o,l){l!==0&&s.push(o)}),i.connections===void 0&&(i.connections=[]),i.connections.push(s)}else if(n.name==="Properties70")Object.keys(n).forEach(function(s){i[s]=n[s]});else if(e==="Properties70"&&n.name==="P"){let s=n.propertyList[0],o=n.propertyList[1];const l=n.propertyList[2],u=n.propertyList[3];let c;s.indexOf("Lcl ")===0&&(s=s.replace("Lcl ","Lcl_")),o.indexOf("Lcl ")===0&&(o=o.replace("Lcl ","Lcl_")),o==="Color"||o==="ColorRGB"||o==="Vector"||o==="Vector3D"||o.indexOf("Lcl_")===0?c=[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:c=n.propertyList[4],i[s]={type:o,type2:l,flag:u,value:c}}else i[n.name]===void 0?typeof n.id=="number"?(i[n.name]={},i[n.name][n.id]=n):i[n.name]=n:n.name==="PoseNode"?(Array.isArray(i[n.name])||(i[n.name]=[i[n.name]]),i[n.name].push(n)):i[n.name][n.id]===void 0&&(i[n.name][n.id]=n)}parseProperty(e){const i=e.getString(1);let n;switch(i){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const s=e.getUint32(),o=e.getUint32(),l=e.getUint32();if(o===0)switch(i){case"b":case"c":return e.getBooleanArray(s);case"d":return e.getFloat64Array(s);case"f":return e.getFloat32Array(s);case"i":return e.getInt32Array(s);case"l":return e.getInt64Array(s)}const u=pY(new Uint8Array(e.getArrayBuffer(l))),c=new bP(u.buffer);switch(i){case"b":case"c":return c.getBooleanArray(s);case"d":return c.getFloat64Array(s);case"f":return c.getFloat32Array(s);case"i":return c.getInt32Array(s);case"l":return c.getInt64Array(s)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+i)}}}class bP{constructor(e,i){this.dv=new DataView(e),this.offset=0,this.littleEndian=i!==void 0?i:!0,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const i=[];for(let n=0;n<e;n++)i.push(this.getBoolean());return i}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const i=[];for(let n=0;n<e;n++)i.push(this.getInt32());return i}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,i;return this.littleEndian?(e=this.getUint32(),i=this.getUint32()):(i=this.getUint32(),e=this.getUint32()),i&2147483648?(i=~i&4294967295,e=~e&4294967295,e===4294967295&&(i=i+1&4294967295),e=e+1&4294967295,-(i*4294967296+e)):i*4294967296+e}getInt64Array(e){const i=[];for(let n=0;n<e;n++)i.push(this.getInt64());return i}getUint64(){let e,i;return this.littleEndian?(e=this.getUint32(),i=this.getUint32()):(i=this.getUint32(),e=this.getUint32()),i*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const i=[];for(let n=0;n<e;n++)i.push(this.getFloat32());return i}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const i=[];for(let n=0;n<e;n++)i.push(this.getFloat64());return i}getArrayBuffer(e){const i=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,i}getString(e){const i=this.offset;let n=new Uint8Array(this.dv.buffer,i,e);this.skip(e);const s=n.indexOf(0);return s>=0&&(n=new Uint8Array(this.dv.buffer,i,s)),this._textDecoder.decode(n)}}class xP{add(e,i){this[e]=i}}function IY(r){const e="Kaydara FBX Binary  \0";return r.byteLength>=e.length&&e===CP(r,0,e.length)}function BY(r){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let i=0;function n(s){const o=r[s-1];return r=r.slice(i+s),i++,o}for(let s=0;s<e.length;++s)if(n(1)===e[s])return!1;return!0}function _P(r){const e=/FBXVersion: (\d+)/,i=r.match(e);if(i)return parseInt(i[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function NY(r){return r/46186158e3}const LY=[];function $b(r,e,i,n){let s;switch(n.mappingType){case"ByPolygonVertex":s=r;break;case"ByPolygon":s=e;break;case"ByVertice":s=i;break;case"AllSame":s=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}n.referenceType==="IndexToDirect"&&(s=n.indices[s]);const o=s*n.dataSize,l=o+n.dataSize;return OY(LY,n.buffer,o,l)}const kC=new yo,gm=new kt;function EP(r){const e=new Hr,i=new Hr,n=new Hr,s=new Hr,o=new Hr,l=new Hr,u=new Hr,c=new Hr,h=new Hr,p=new Hr,f=new Hr,g=new Hr,m=r.inheritType?r.inheritType:0;if(r.translation&&e.setPosition(gm.fromArray(r.translation)),r.preRotation){const O=r.preRotation.map(Ao.degToRad);O.push(r.eulerOrder||yo.DEFAULT_ORDER),i.makeRotationFromEuler(kC.fromArray(O))}if(r.rotation){const O=r.rotation.map(Ao.degToRad);O.push(r.eulerOrder||yo.DEFAULT_ORDER),n.makeRotationFromEuler(kC.fromArray(O))}if(r.postRotation){const O=r.postRotation.map(Ao.degToRad);O.push(r.eulerOrder||yo.DEFAULT_ORDER),s.makeRotationFromEuler(kC.fromArray(O)),s.invert()}r.scale&&o.scale(gm.fromArray(r.scale)),r.scalingOffset&&u.setPosition(gm.fromArray(r.scalingOffset)),r.scalingPivot&&l.setPosition(gm.fromArray(r.scalingPivot)),r.rotationOffset&&c.setPosition(gm.fromArray(r.rotationOffset)),r.rotationPivot&&h.setPosition(gm.fromArray(r.rotationPivot)),r.parentMatrixWorld&&(f.copy(r.parentMatrix),p.copy(r.parentMatrixWorld));const y=i.clone().multiply(n).multiply(s),b=new Hr;b.extractRotation(p);const v=new Hr;v.copyPosition(p);const _=v.clone().invert().multiply(p),C=b.clone().invert().multiply(_),E=o,T=new Hr;if(m===0)T.copy(b).multiply(y).multiply(C).multiply(E);else if(m===1)T.copy(b).multiply(C).multiply(y).multiply(E);else{const O=new Hr().scale(new kt().setFromMatrixScale(f)).clone().invert(),F=C.clone().multiply(O);T.copy(b).multiply(y).multiply(F).multiply(E)}const R=h.clone().invert(),B=l.clone().invert();let I=e.clone().multiply(c).multiply(h).multiply(i).multiply(n).multiply(s).multiply(R).multiply(u).multiply(l).multiply(o).multiply(B);const D=new Hr().copyPosition(I),L=p.clone().multiply(D);return g.copyPosition(L),I=g.clone().multiply(T),I.premultiply(p.invert()),I}function wP(r){r=r||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return r===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[r]}function FC(r){return r.split(",").map(function(e){return parseFloat(e)})}function CP(r,e,i){return e===void 0&&(e=0),i===void 0&&(i=r.byteLength),new TextDecoder().decode(new Uint8Array(r,e,i))}function DY(r,e){for(let i=0,n=r.length,s=e.length;i<s;i++,n++)r[n]=e[i]}function OY(r,e,i,n){for(let s=i,o=0;s<n;s++,o++)r[o]=e[s];return r}THREE.FBXLoader=wY,AFRAME.registerComponent("fbx-model",{schema:{src:{type:"asset"},crossorigin:{default:""}},init:function(){this.model=null},update:function(){const r=this.data;if(!r.src)return;this.remove();const e=new THREE.FBXLoader;r.crossorigin&&e.setCrossOrigin(r.crossorigin),e.load(r.src,this.load.bind(this))},load:function(r){this.model=r,this.el.setObject3D("mesh",r),this.el.emit("model-loaded",{format:"fbx",model:r})},remove:function(){this.model&&this.el.removeObject3D("mesh")}});function PY(){return"script_"+Date.now()+"_"+Math.ceil(Math.random()*1e5)}function kY(r,e){var i=document.createElement("script");return i.type="text/javascript",i.async=!0,i.id=e,i.src=r,i}function UC(r){const e=document.getElementById(r),i=e.parentNode;try{i&&i.removeChild(e)}catch{}}function FY(r){const e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(r,e)}function UY(r,e,i){return new i(function(n,s){const o=e.timeout||5e3,l=PY(),u=kY(r,l),c=setTimeout(function(){s(new Error("Script request to "+r+" timed out")),UC(l)},o),h=function(p){clearTimeout(p)};u.addEventListener("load",function(p){n({ok:!0}),h(c),UC(l)}),u.addEventListener("error",function(p){s(new Error("Script request to "+r+" failed "+p)),h(c),UC(l)}),FY(u)})}function zY(r){return r=r||{},function(e,i){return i=i||{},UY(e,i,r.Promise||Promise)}}var jY=zY;const GY=jY(),VY="https://cdn.jsdelivr.net/gh/mrdoob/three.js@r86/examples/js/loaders/GLTFLoader.js",HY=function(){let r;return function(){return r=r||GY(VY),r}}();AFRAME.registerComponent("gltf-model-legacy",{schema:{type:"model"},init:function(){this.model=null,this.loader=null,this.loaderPromise=HY().then(()=>{this.loader=new THREE.GLTFLoader,this.loader.setCrossOrigin("Anonymous")})},update:function(){const r=this,e=this.el,i=this.data;i&&(this.remove(),this.loaderPromise.then(()=>{this.loader.load(i,function(n){r.model=n.scene,r.model.animations=n.animations,e.setObject3D("mesh",r.model),e.emit("model-loaded",{format:"gltf",model:r.model})})}))},remove:function(){this.model&&this.el.removeObject3D("mesh")}}),AFRAME.registerComponent("object-model",{schema:{src:{type:"asset"},crossorigin:{default:""}},init:function(){this.model=null},update:function(){let r;const e=this.data;e.src&&(this.remove(),r=new THREE.ObjectLoader,e.crossorigin&&r.setCrossOrigin(e.crossorigin),r.load(e.src,i=>{i.traverse(n=>{n instanceof THREE.SkinnedMesh&&n.material&&(n.material.skinning=!!(n.geometry&&n.geometry.bones||[]).length)}),this.load(i)}))},load:function(r){this.model=r,this.el.setObject3D("mesh",r),this.el.emit("model-loaded",{format:"json",model:r})},remove:function(){this.model&&this.el.removeObject3D("mesh")}}),AFRAME.registerComponent("checkpoint",{schema:{offset:{default:{x:0,y:0,z:0},type:"vec3"}},init:function(){this.active=!1,this.targetEl=null,this.fire=this.fire.bind(this),this.offset=new THREE.Vector3},update:function(){this.offset.copy(this.data.offset)},play:function(){this.el.addEventListener("click",this.fire)},pause:function(){this.el.removeEventListener("click",this.fire)},remove:function(){this.pause()},fire:function(){const r=this.el.sceneEl.querySelector("[checkpoint-controls]");if(!r)throw new Error("No `checkpoint-controls` component found.");r.components["checkpoint-controls"].setCheckpoint(this.el)},getOffset:function(){return this.offset.copy(this.data.offset)}});function WY(r){return r?Array.isArray(r)?r:r.materials?r.materials:[r]:[]}function gA(r,e,i,n){r&&(e=e||[],r.traverse(s=>{s.isMesh&&WY(s.material).forEach(o=>{o&&!("envMap"in o)||e.length&&e.indexOf(o.name)===-1||(o.envMap=i,o.reflectivity=n,o.needsUpdate=!0)})}))}AFRAME.registerComponent("cube-env-map",{multiple:!0,schema:{path:{default:""},extension:{default:"jpg",oneOf:["jpg","png"]},enableBackground:{default:!1},reflectivity:{default:1,min:0,max:1},materials:{default:[]}},init:function(){const r=this.data;this.texture=new THREE.CubeTextureLoader().load([r.path+"posx."+r.extension,r.path+"negx."+r.extension,r.path+"posy."+r.extension,r.path+"negy."+r.extension,r.path+"posz."+r.extension,r.path+"negz."+r.extension]),this.texture.format=THREE.RGBAFormat,this.object3dsetHandler=()=>{const e=this.el.getObject3D("mesh"),i=this.data;gA(e,i.materials,this.texture,i.reflectivity)},this.object3dsetHandler(),this.el.addEventListener("object3dset",this.object3dsetHandler)},update:function(r){const e=this.data,i=this.el.getObject3D("mesh");let n=[],s=[];if(e.materials.length&&(r.materials?(n=e.materials.filter(o=>!r.materials.includes(o)),s=r.materials.filter(o=>!e.materials.includes(o))):n=e.materials),n.length&&gA(i,n,this.texture,e.reflectivity),s.length&&gA(i,s,null,1),r.materials&&e.reflectivity!==r.reflectivity){const o=e.materials.filter(l=>r.materials.includes(l));o.length&&gA(i,o,this.texture,e.reflectivity)}this.data.enableBackground&&!r.enableBackground?this.setBackground(this.texture):!this.data.enableBackground&&r.enableBackground&&this.setBackground(null)},remove:function(){this.el.removeEventListener("object3dset",this.object3dsetHandler);const r=this.el.getObject3D("mesh"),e=this.data;gA(r,e.materials,null,1),e.enableBackground&&this.setBackground(null)},setBackground:function(r){this.el.sceneEl.object3D.background=r}}),AFRAME.registerComponent("grab",{init:function(){this.system=this.el.sceneEl.systems.physics,this.GRABBED_STATE="grabbed",this.grabbing=!1,this.hitEl=null,this.physics=this.el.sceneEl.systems.physics,this.constraint=null,this.onHit=this.onHit.bind(this),this.onGripOpen=this.onGripOpen.bind(this),this.onGripClose=this.onGripClose.bind(this)},play:function(){const r=this.el;r.addEventListener("hit",this.onHit),r.addEventListener("gripdown",this.onGripClose),r.addEventListener("gripup",this.onGripOpen),r.addEventListener("trackpaddown",this.onGripClose),r.addEventListener("trackpadup",this.onGripOpen),r.addEventListener("triggerdown",this.onGripClose),r.addEventListener("triggerup",this.onGripOpen)},pause:function(){const r=this.el;r.removeEventListener("hit",this.onHit),r.removeEventListener("gripdown",this.onGripClose),r.removeEventListener("gripup",this.onGripOpen),r.removeEventListener("trackpaddown",this.onGripClose),r.removeEventListener("trackpadup",this.onGripOpen),r.removeEventListener("triggerdown",this.onGripClose),r.removeEventListener("triggerup",this.onGripOpen)},onGripClose:function(){this.grabbing=!0},onGripOpen:function(){const r=this.hitEl;this.grabbing=!1,r&&(r.removeState(this.GRABBED_STATE),this.hitEl=void 0,this.system.removeConstraint(this.constraint),this.constraint=null)},onHit:function(r){const e=r.detail.el;e.is(this.GRABBED_STATE)||!this.grabbing||this.hitEl||(e.addState(this.GRABBED_STATE),this.hitEl=e,this.constraint=new CANNON.LockConstraint(this.el.body,e.body),this.system.addConstraint(this.constraint))}}),AFRAME.registerComponent("normal-material",{init:function(){this.material=new THREE.MeshNormalMaterial({flatShading:!0}),this.applyMaterial=this.applyMaterial.bind(this),this.el.addEventListener("object3dset",this.applyMaterial),this.applyMaterial()},remove:function(){this.el.removeEventListener("object3dset",this.applyMaterial)},applyMaterial:function(){this.el.object3D.traverse(r=>{r.isMesh&&(r.material=this.material)})}}),AFRAME.registerComponent("sphere-collider",{schema:{enabled:{default:!0},interval:{default:80},objects:{default:""},state:{default:"collided"},radius:{default:.05},watch:{default:!0}},init:function(){this.observer=null,this.els=[],this.collisions=[],this.prevCheckTime=void 0,this.eventDetail={},this.handleHit=this.handleHit.bind(this),this.handleHitEnd=this.handleHitEnd.bind(this)},play:function(){const r=this.el.sceneEl;this.data.watch&&(this.observer=new MutationObserver(this.update.bind(this,null)),this.observer.observe(r,{childList:!0,subtree:!0}))},pause:function(){this.observer&&(this.observer.disconnect(),this.observer=null)},update:function(){const r=this.data;let e;r.objects?e=this.el.sceneEl.querySelectorAll(r.objects):e=this.el.sceneEl.children,this.els=Array.prototype.slice.call(e)},tick:function(){const r=new THREE.Vector3,e=new THREE.Vector3,i=new THREE.Vector3,n=new THREE.Vector3,s=new THREE.Box3,o=[],l=new Map;return function(u){if(!this.data.enabled)return;const c=this.prevCheckTime;if(c&&u-c<this.data.interval)return;this.prevCheckTime=u;const h=this.el,p=this.data,f=h.getObject3D("mesh");let g;if(!f)return;o.length=0,l.clear(),h.object3D.getWorldPosition(r),h.object3D.getWorldScale(i),g=p.radius*y(i),this.els.forEach(m),o.sort((b,v)=>l.get(b)>l.get(v)?1:-1).forEach(this.handleHit),this.collisions.filter(b=>!l.has(b)).forEach(this.handleHitEnd),QY(this.collisions,o);function m(b){let v,_,C,E;b.isEntity&&(_=b.getObject3D("mesh"),_&&(s.setFromObject(_).getSize(n),E=Math.max(n.x,n.y,n.z)/2,v=Math.sqrt(2*E*E),s.getCenter(e),v&&(C=r.distanceTo(e),C<v+g&&(o.push(b),l.set(b,C)))))}function y(b){return Math.max(b.x,b.y,b.z)}}}(),handleHit:function(r){r.emit("hit"),r.addState(this.data.state),this.eventDetail.el=r,this.el.emit("hit",this.eventDetail)},handleHitEnd:function(r){r.emit("hitend"),r.removeState(this.data.state),this.eventDetail.el=r,this.el.emit("hitend",this.eventDetail)}});function QY(r,e){r.length=0;for(let i=0;i<e.length;i++)r[i]=e[i]}AFRAME.registerComponent("nav-mesh",{schema:{nodeName:{type:"string"}},init:function(){this.system=this.el.sceneEl.systems.nav,this.hasLoadedNavMesh=!1,this.nodeName=this.data.nodeName,this.el.addEventListener("object3dset",this.loadNavMesh.bind(this))},play:function(){this.hasLoadedNavMesh||this.loadNavMesh()},loadNavMesh:function(){var r=this;const e=this.el.getObject3D("mesh");if(this.el.sceneEl.object3D,!e)return;let i;if(e.traverse(s=>{s.isMesh&&(!r.nodeName||s.name===r.nodeName)&&(i=s)}),!i)return;const n=i.geometry.clone();i.updateWorldMatrix(!0,!1),n.applyMatrix4(i.matrixWorld),this.system.setNavMeshGeometry(n),this.hasLoadedNavMesh=!0}}),AFRAME.registerComponent("nav-agent",{schema:{destination:{type:"vec3"},active:{default:!1},speed:{default:2}},init:function(){this.system=this.el.sceneEl.systems.nav,this.system.addAgent(this),this.group=null,this.path=[],this.raycaster=new THREE.Raycaster},remove:function(){this.system.removeAgent(this)},update:function(){this.path.length=0},updateNavLocation:function(){this.group=null,this.path=[]},tick:function(){const r=new THREE.Vector3,e=new THREE.Vector3,i=new THREE.Vector3;return function(n,s){const o=this.el,l=this.data,u=this.raycaster,c=l.speed*s/1e3;if(!l.active)return;if(!this.path.length){const y=this.el.object3D.position;this.group=this.group||this.system.getGroup(y),this.path=this.system.getPath(y,r.copy(l.destination),this.group)||[],o.emit("navigation-start")}if(!this.path.length){console.warn("[nav] Unable to find path to %o.",l.destination),this.el.setAttribute("nav-agent",{active:!1}),o.emit("navigation-end");return}const h=o.object3D.position,p=this.path[0];e.subVectors(p,h);const f=e.length();let g;if(f<c){if(this.path.shift(),!this.path.length){this.el.setAttribute("nav-agent",{active:!1}),o.emit("navigation-end");return}i.copy(h),g=this.path[0]}else i.copy(e.setLength(c)).add(h),g=p;g.y=h.y,o.object3D.lookAt(g),u.ray.origin.copy(i),u.ray.origin.y+=1.5,u.ray.direction={x:0,y:-1,z:0};const m=u.intersectObject(this.system.getNavMesh());m.length?(e.subVectors(m[0].point,h),h.add(e.setLength(c))):h.copy(i)}}()});/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const ex="170",Ua={ROTATE:0,DOLLY:1,PAN:2},wu={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},qY=0,SP=1,XY=2,TP=1,KY=2,Cu=3,qh=0,bo=1,Su=2,Tu=0,Am=1,MP=2,RP=3,IP=4,YY=5,dp=100,JY=101,ZY=102,$Y=103,eJ=104,tJ=200,iJ=201,rJ=202,nJ=203,zC=204,jC=205,sJ=206,aJ=207,oJ=208,lJ=209,cJ=210,uJ=211,hJ=212,dJ=213,pJ=214,GC=0,VC=1,HC=2,ym=3,WC=4,QC=5,qC=6,XC=7,KC=0,fJ=1,mJ=2,Xh=0,gJ=1,AJ=2,yJ=3,vJ=4,bJ=5,xJ=6,_J=7,BP=300,vm=301,bm=302,YC=303,JC=304,tx=306,ZC=1e3,pp=1001,$C=1002,nc=1003,EJ=1004,ix=1005,Vc=1006,eS=1007,fp=1008,Mu=1009,NP=1010,LP=1011,AA=1012,tS=1013,mp=1014,Ru=1015,xm=1016,iS=1017,rS=1018,_m=1020,DP=35902,OP=1021,PP=1022,sc=1023,kP=1024,FP=1025,Em=1026,wm=1027,UP=1028,nS=1029,zP=1030,sS=1031,aS=1033,rx=33776,nx=33777,sx=33778,ax=33779,oS=35840,lS=35841,cS=35842,uS=35843,hS=36196,dS=37492,pS=37496,fS=37808,mS=37809,gS=37810,AS=37811,yS=37812,vS=37813,bS=37814,xS=37815,_S=37816,ES=37817,wS=37818,CS=37819,SS=37820,TS=37821,ox=36492,MS=36494,RS=36495,jP=36283,IS=36284,BS=36285,NS=36286,wJ=3200,CJ=3201,GP=0,SJ=1,Kh="",jo="srgb",Cm="srgb-linear",lx="linear",os="srgb",Sm=7680,VP=519,TJ=512,MJ=513,RJ=514,HP=515,IJ=516,BJ=517,NJ=518,LJ=519,LS=35044,WP="300 es",Iu=2e3,cx=2001;let gp=class{addEventListener(r,e){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[r]===void 0&&(i[r]=[]),i[r].indexOf(e)===-1&&i[r].push(e)}hasEventListener(r,e){if(this._listeners===void 0)return!1;const i=this._listeners;return i[r]!==void 0&&i[r].indexOf(e)!==-1}removeEventListener(r,e){if(this._listeners===void 0)return;const i=this._listeners[r];if(i!==void 0){const n=i.indexOf(e);n!==-1&&i.splice(n,1)}}dispatchEvent(r){if(this._listeners===void 0)return;const e=this._listeners[r.type];if(e!==void 0){r.target=this;const i=e.slice(0);for(let n=0,s=i.length;n<s;n++)i[n].call(this,r);r.target=null}}};const eo=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let QP=1234567;const yA=Math.PI/180,vA=180/Math.PI;function Bu(){const r=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(eo[r&255]+eo[r>>8&255]+eo[r>>16&255]+eo[r>>24&255]+"-"+eo[e&255]+eo[e>>8&255]+"-"+eo[e>>16&15|64]+eo[e>>24&255]+"-"+eo[i&63|128]+eo[i>>8&255]+"-"+eo[i>>16&255]+eo[i>>24&255]+eo[n&255]+eo[n>>8&255]+eo[n>>16&255]+eo[n>>24&255]).toLowerCase()}function Ta(r,e,i){return Math.max(e,Math.min(i,r))}function DS(r,e){return(r%e+e)%e}function DJ(r,e,i,n,s){return n+(r-e)*(s-n)/(i-e)}function OJ(r,e,i){return r!==e?(i-r)/(e-r):0}function bA(r,e,i){return(1-i)*r+i*e}function PJ(r,e,i,n){return bA(r,e,1-Math.exp(-i*n))}function kJ(r,e=1){return e-Math.abs(DS(r,e*2)-e)}function FJ(r,e,i){return r<=e?0:r>=i?1:(r=(r-e)/(i-e),r*r*(3-2*r))}function UJ(r,e,i){return r<=e?0:r>=i?1:(r=(r-e)/(i-e),r*r*r*(r*(r*6-15)+10))}function zJ(r,e){return r+Math.floor(Math.random()*(e-r+1))}function jJ(r,e){return r+Math.random()*(e-r)}function GJ(r){return r*(.5-Math.random())}function VJ(r){r!==void 0&&(QP=r);let e=QP+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function HJ(r){return r*yA}function WJ(r){return r*vA}function QJ(r){return(r&r-1)===0&&r!==0}function qJ(r){return Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function XJ(r){return Math.pow(2,Math.floor(Math.log(r)/Math.LN2))}function KJ(r,e,i,n,s){const o=Math.cos,l=Math.sin,u=o(i/2),c=l(i/2),h=o((e+n)/2),p=l((e+n)/2),f=o((e-n)/2),g=l((e-n)/2),m=o((n-e)/2),y=l((n-e)/2);switch(s){case"XYX":r.set(u*p,c*f,c*g,u*h);break;case"YZY":r.set(c*g,u*p,c*f,u*h);break;case"ZXZ":r.set(c*f,c*g,u*p,u*h);break;case"XZX":r.set(u*p,c*y,c*m,u*h);break;case"YXY":r.set(c*m,u*p,c*y,u*h);break;case"ZYZ":r.set(c*y,c*m,u*p,u*h);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function ac(r,e){switch(e.constructor){case Float32Array:return r;case Uint32Array:return r/4294967295;case Uint16Array:return r/65535;case Uint8Array:return r/255;case Int32Array:return Math.max(r/2147483647,-1);case Int16Array:return Math.max(r/32767,-1);case Int8Array:return Math.max(r/127,-1);default:throw new Error("Invalid component type.")}}function rs(r,e){switch(e.constructor){case Float32Array:return r;case Uint32Array:return Math.round(r*4294967295);case Uint16Array:return Math.round(r*65535);case Uint8Array:return Math.round(r*255);case Int32Array:return Math.round(r*2147483647);case Int16Array:return Math.round(r*32767);case Int8Array:return Math.round(r*127);default:throw new Error("Invalid component type.")}}const OS={DEG2RAD:yA,RAD2DEG:vA,generateUUID:Bu,clamp:Ta,euclideanModulo:DS,mapLinear:DJ,inverseLerp:OJ,lerp:bA,damp:PJ,pingpong:kJ,smoothstep:FJ,smootherstep:UJ,randInt:zJ,randFloat:jJ,randFloatSpread:GJ,seededRandom:VJ,degToRad:HJ,radToDeg:WJ,isPowerOfTwo:QJ,ceilPowerOfTwo:qJ,floorPowerOfTwo:XJ,setQuaternionFromProperEuler:KJ,normalize:rs,denormalize:ac};let Gi=class JH{constructor(e=0,i=0){JH.prototype.isVector2=!0,this.x=e,this.y=i}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,i){return this.x=e,this.y=i,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const i=this.x,n=this.y,s=e.elements;return this.x=s[0]*i+s[3]*n+s[6],this.y=s[1]*i+s[4]*n+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this}clampLength(e,i){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(i,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const n=this.dot(e)/i;return Math.acos(Ta(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,n=this.y-e.y;return i*i+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this}lerpVectors(e,i,n){return this.x=e.x+(i.x-e.x)*n,this.y=e.y+(i.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this}rotateAround(e,i){const n=Math.cos(i),s=Math.sin(i),o=this.x-e.x,l=this.y-e.y;return this.x=o*n-l*s+e.x,this.y=o*s+l*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},mn=class ZH{constructor(e,i,n,s,o,l,u,c,h){ZH.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,i,n,s,o,l,u,c,h)}set(e,i,n,s,o,l,u,c,h){const p=this.elements;return p[0]=e,p[1]=s,p[2]=u,p[3]=i,p[4]=o,p[5]=c,p[6]=n,p[7]=l,p[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const i=this.elements,n=e.elements;return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],this}extractBasis(e,i,n){return e.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const i=e.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const n=e.elements,s=i.elements,o=this.elements,l=n[0],u=n[3],c=n[6],h=n[1],p=n[4],f=n[7],g=n[2],m=n[5],y=n[8],b=s[0],v=s[3],_=s[6],C=s[1],E=s[4],T=s[7],R=s[2],B=s[5],I=s[8];return o[0]=l*b+u*C+c*R,o[3]=l*v+u*E+c*B,o[6]=l*_+u*T+c*I,o[1]=h*b+p*C+f*R,o[4]=h*v+p*E+f*B,o[7]=h*_+p*T+f*I,o[2]=g*b+m*C+y*R,o[5]=g*v+m*E+y*B,o[8]=g*_+m*T+y*I,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=e,i[4]*=e,i[7]*=e,i[2]*=e,i[5]*=e,i[8]*=e,this}determinant(){const e=this.elements,i=e[0],n=e[1],s=e[2],o=e[3],l=e[4],u=e[5],c=e[6],h=e[7],p=e[8];return i*l*p-i*u*h-n*o*p+n*u*c+s*o*h-s*l*c}invert(){const e=this.elements,i=e[0],n=e[1],s=e[2],o=e[3],l=e[4],u=e[5],c=e[6],h=e[7],p=e[8],f=p*l-u*h,g=u*c-p*o,m=h*o-l*c,y=i*f+n*g+s*m;if(y===0)return this.set(0,0,0,0,0,0,0,0,0);const b=1/y;return e[0]=f*b,e[1]=(s*h-p*n)*b,e[2]=(u*n-s*l)*b,e[3]=g*b,e[4]=(p*i-s*c)*b,e[5]=(s*o-u*i)*b,e[6]=m*b,e[7]=(n*c-h*i)*b,e[8]=(l*i-n*o)*b,this}transpose(){let e;const i=this.elements;return e=i[1],i[1]=i[3],i[3]=e,e=i[2],i[2]=i[6],i[6]=e,e=i[5],i[5]=i[7],i[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const i=this.elements;return e[0]=i[0],e[1]=i[3],e[2]=i[6],e[3]=i[1],e[4]=i[4],e[5]=i[7],e[6]=i[2],e[7]=i[5],e[8]=i[8],this}setUvTransform(e,i,n,s,o,l,u){const c=Math.cos(o),h=Math.sin(o);return this.set(n*c,n*h,-n*(c*l+h*u)+l+e,-s*h,s*c,-s*(-h*l+c*u)+u+i,0,0,1),this}scale(e,i){return this.premultiply(PS.makeScale(e,i)),this}rotate(e){return this.premultiply(PS.makeRotation(-e)),this}translate(e,i){return this.premultiply(PS.makeTranslation(e,i)),this}makeTranslation(e,i){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,i,0,0,1),this}makeRotation(e){const i=Math.cos(e),n=Math.sin(e);return this.set(i,-n,0,n,i,0,0,0,1),this}makeScale(e,i){return this.set(e,0,0,0,i,0,0,0,1),this}equals(e){const i=this.elements,n=e.elements;for(let s=0;s<9;s++)if(i[s]!==n[s])return!1;return!0}fromArray(e,i=0){for(let n=0;n<9;n++)this.elements[n]=e[n+i];return this}toArray(e=[],i=0){const n=this.elements;return e[i]=n[0],e[i+1]=n[1],e[i+2]=n[2],e[i+3]=n[3],e[i+4]=n[4],e[i+5]=n[5],e[i+6]=n[6],e[i+7]=n[7],e[i+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}};const PS=new mn;function qP(r){for(let e=r.length-1;e>=0;--e)if(r[e]>=65535)return!0;return!1}function xA(r){return document.createElementNS("http://www.w3.org/1999/xhtml",r)}function YJ(){const r=xA("canvas");return r.style.display="block",r}const XP={};function _A(r){r in XP||(XP[r]=!0,console.warn(r))}function JJ(r,e,i){return new Promise(function(n,s){function o(){switch(r.clientWaitSync(e,r.SYNC_FLUSH_COMMANDS_BIT,0)){case r.WAIT_FAILED:s();break;case r.TIMEOUT_EXPIRED:setTimeout(o,i);break;default:n()}}setTimeout(o,i)})}function ZJ(r){const e=r.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}function $J(r){const e=r.elements;e[11]===-1?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=-e[14]+1)}const Fn={enabled:!0,workingColorSpace:Cm,spaces:{},convert:function(r,e,i){return this.enabled===!1||e===i||!e||!i||(this.spaces[e].transfer===os&&(r.r=Nu(r.r),r.g=Nu(r.g),r.b=Nu(r.b)),this.spaces[e].primaries!==this.spaces[i].primaries&&(r.applyMatrix3(this.spaces[e].toXYZ),r.applyMatrix3(this.spaces[i].fromXYZ)),this.spaces[i].transfer===os&&(r.r=Tm(r.r),r.g=Tm(r.g),r.b=Tm(r.b))),r},fromWorkingColorSpace:function(r,e){return this.convert(r,this.workingColorSpace,e)},toWorkingColorSpace:function(r,e){return this.convert(r,e,this.workingColorSpace)},getPrimaries:function(r){return this.spaces[r].primaries},getTransfer:function(r){return r===Kh?lx:this.spaces[r].transfer},getLuminanceCoefficients:function(r,e=this.workingColorSpace){return r.fromArray(this.spaces[e].luminanceCoefficients)},define:function(r){Object.assign(this.spaces,r)},_getMatrix:function(r,e,i){return r.copy(this.spaces[e].toXYZ).multiply(this.spaces[i].fromXYZ)},_getDrawingBufferColorSpace:function(r){return this.spaces[r].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(r=this.workingColorSpace){return this.spaces[r].workingColorSpaceConfig.unpackColorSpace}};function Nu(r){return r<.04045?r*.0773993808:Math.pow(r*.9478672986+.0521327014,2.4)}function Tm(r){return r<.0031308?r*12.92:1.055*Math.pow(r,.41666)-.055}const KP=[.64,.33,.3,.6,.15,.06],YP=[.2126,.7152,.0722],JP=[.3127,.329],ZP=new mn().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),$P=new mn().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);Fn.define({[Cm]:{primaries:KP,whitePoint:JP,transfer:lx,toXYZ:ZP,fromXYZ:$P,luminanceCoefficients:YP,workingColorSpaceConfig:{unpackColorSpace:jo},outputColorSpaceConfig:{drawingBufferColorSpace:jo}},[jo]:{primaries:KP,whitePoint:JP,transfer:os,toXYZ:ZP,fromXYZ:$P,luminanceCoefficients:YP,outputColorSpaceConfig:{drawingBufferColorSpace:jo}}});let Mm,eZ=class{static getDataURL(r){if(/^data:/i.test(r.src)||typeof HTMLCanvasElement>"u")return r.src;let e;if(r instanceof HTMLCanvasElement)e=r;else{Mm===void 0&&(Mm=xA("canvas")),Mm.width=r.width,Mm.height=r.height;const i=Mm.getContext("2d");r instanceof ImageData?i.putImageData(r,0,0):i.drawImage(r,0,0,r.width,r.height),e=Mm}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",r),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(r){if(typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap){const e=xA("canvas");e.width=r.width,e.height=r.height;const i=e.getContext("2d");i.drawImage(r,0,0,r.width,r.height);const n=i.getImageData(0,0,r.width,r.height),s=n.data;for(let o=0;o<s.length;o++)s[o]=Nu(s[o]/255)*255;return i.putImageData(n,0,0),e}else if(r.data){const e=r.data.slice(0);for(let i=0;i<e.length;i++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[i]=Math.floor(Nu(e[i]/255)*255):e[i]=Nu(e[i]);return{data:e,width:r.width,height:r.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),r}},tZ=0,e4=class{constructor(r=null){this.isSource=!0,Object.defineProperty(this,"id",{value:tZ++}),this.uuid=Bu(),this.data=r,this.dataReady=!0,this.version=0}set needsUpdate(r){r===!0&&this.version++}toJSON(r){const e=r===void 0||typeof r=="string";if(!e&&r.images[this.uuid]!==void 0)return r.images[this.uuid];const i={uuid:this.uuid,url:""},n=this.data;if(n!==null){let s;if(Array.isArray(n)){s=[];for(let o=0,l=n.length;o<l;o++)n[o].isDataTexture?s.push(kS(n[o].image)):s.push(kS(n[o]))}else s=kS(n);i.url=s}return e||(r.images[this.uuid]=i),i}};function kS(r){return typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap?eZ.getDataURL(r):r.data?{data:Array.from(r.data),width:r.width,height:r.height,type:r.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let iZ=0,Ol=class h2 extends gp{constructor(e=h2.DEFAULT_IMAGE,i=h2.DEFAULT_MAPPING,n=pp,s=pp,o=Vc,l=fp,u=sc,c=Mu,h=h2.DEFAULT_ANISOTROPY,p=Kh){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:iZ++}),this.uuid=Bu(),this.name="",this.source=new e4(e),this.mipmaps=[],this.mapping=i,this.channel=0,this.wrapS=n,this.wrapT=s,this.magFilter=o,this.minFilter=l,this.anisotropy=h,this.format=u,this.internalFormat=null,this.type=c,this.offset=new Gi(0,0),this.repeat=new Gi(1,1),this.center=new Gi(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new mn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=p,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),i||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==BP)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case ZC:e.x=e.x-Math.floor(e.x);break;case pp:e.x=e.x<0?0:1;break;case $C:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case ZC:e.y=e.y-Math.floor(e.y);break;case pp:e.y=e.y<0?0:1;break;case $C:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}};Ol.DEFAULT_IMAGE=null,Ol.DEFAULT_MAPPING=BP,Ol.DEFAULT_ANISOTROPY=1;let Zs=class $H{constructor(e=0,i=0,n=0,s=1){$H.prototype.isVector4=!0,this.x=e,this.y=i,this.z=n,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,i,n,s){return this.x=e,this.y=i,this.z=n,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this.w=e.w+i.w,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this.w+=e.w*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this.w=e.w-i.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const i=this.x,n=this.y,s=this.z,o=this.w,l=e.elements;return this.x=l[0]*i+l[4]*n+l[8]*s+l[12]*o,this.y=l[1]*i+l[5]*n+l[9]*s+l[13]*o,this.z=l[2]*i+l[6]*n+l[10]*s+l[14]*o,this.w=l[3]*i+l[7]*n+l[11]*s+l[15]*o,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const i=Math.sqrt(1-e.w*e.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/i,this.y=e.y/i,this.z=e.z/i),this}setAxisAngleFromRotationMatrix(e){let i,n,s,o;const l=e.elements,u=l[0],c=l[4],h=l[8],p=l[1],f=l[5],g=l[9],m=l[2],y=l[6],b=l[10];if(Math.abs(c-p)<.01&&Math.abs(h-m)<.01&&Math.abs(g-y)<.01){if(Math.abs(c+p)<.1&&Math.abs(h+m)<.1&&Math.abs(g+y)<.1&&Math.abs(u+f+b-3)<.1)return this.set(1,0,0,0),this;i=Math.PI;const _=(u+1)/2,C=(f+1)/2,E=(b+1)/2,T=(c+p)/4,R=(h+m)/4,B=(g+y)/4;return _>C&&_>E?_<.01?(n=0,s=.707106781,o=.707106781):(n=Math.sqrt(_),s=T/n,o=R/n):C>E?C<.01?(n=.707106781,s=0,o=.707106781):(s=Math.sqrt(C),n=T/s,o=B/s):E<.01?(n=.707106781,s=.707106781,o=0):(o=Math.sqrt(E),n=R/o,s=B/o),this.set(n,s,o,i),this}let v=Math.sqrt((y-g)*(y-g)+(h-m)*(h-m)+(p-c)*(p-c));return Math.abs(v)<.001&&(v=1),this.x=(y-g)/v,this.y=(h-m)/v,this.z=(p-c)/v,this.w=Math.acos((u+f+b-1)/2),this}setFromMatrixPosition(e){const i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this.w=i[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this.w=Math.max(e.w,Math.min(i.w,this.w)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this.w=Math.max(e,Math.min(i,this.w)),this}clampLength(e,i){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(i,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this.w+=(e.w-this.w)*i,this}lerpVectors(e,i,n){return this.x=e.x+(i.x-e.x)*n,this.y=e.y+(i.y-e.y)*n,this.z=e.z+(i.z-e.z)*n,this.w=e.w+(i.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this.w=e[i+3],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e[i+3]=this.w,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this.w=e.getW(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},rZ=class extends gp{constructor(r=1,e=1,i={}){super(),this.isRenderTarget=!0,this.width=r,this.height=e,this.depth=1,this.scissor=new Zs(0,0,r,e),this.scissorTest=!1,this.viewport=new Zs(0,0,r,e);const n={width:r,height:e,depth:1};i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Vc,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},i);const s=new Ol(n,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace);s.flipY=!1,s.generateMipmaps=i.generateMipmaps,s.internalFormat=i.internalFormat,this.textures=[];const o=i.count;for(let l=0;l<o;l++)this.textures[l]=s.clone(),this.textures[l].isRenderTargetTexture=!0;this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.resolveDepthBuffer=i.resolveDepthBuffer,this.resolveStencilBuffer=i.resolveStencilBuffer,this.depthTexture=i.depthTexture,this.samples=i.samples}get texture(){return this.textures[0]}set texture(r){this.textures[0]=r}setSize(r,e,i=1){if(this.width!==r||this.height!==e||this.depth!==i){this.width=r,this.height=e,this.depth=i;for(let n=0,s=this.textures.length;n<s;n++)this.textures[n].image.width=r,this.textures[n].image.height=e,this.textures[n].image.depth=i;this.dispose()}this.viewport.set(0,0,r,e),this.scissor.set(0,0,r,e)}clone(){return new this.constructor().copy(this)}copy(r){this.width=r.width,this.height=r.height,this.depth=r.depth,this.scissor.copy(r.scissor),this.scissorTest=r.scissorTest,this.viewport.copy(r.viewport),this.textures.length=0;for(let i=0,n=r.textures.length;i<n;i++)this.textures[i]=r.textures[i].clone(),this.textures[i].isRenderTargetTexture=!0;const e=Object.assign({},r.texture.image);return this.texture.source=new e4(e),this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.resolveDepthBuffer=r.resolveDepthBuffer,this.resolveStencilBuffer=r.resolveStencilBuffer,r.depthTexture!==null&&(this.depthTexture=r.depthTexture.clone()),this.samples=r.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}},Yh=class extends rZ{constructor(r=1,e=1,i={}){super(r,e,i),this.isWebGLRenderTarget=!0}},t4=class extends Ol{constructor(r=null,e=1,i=1,n=1){super(null),this.isDataArrayTexture=!0,this.image={data:r,width:e,height:i,depth:n},this.magFilter=nc,this.minFilter=nc,this.wrapR=pp,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(r){this.layerUpdates.add(r)}clearLayerUpdates(){this.layerUpdates.clear()}};class nZ extends Ol{constructor(e=null,i=1,n=1,s=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:i,height:n,depth:s},this.magFilter=nc,this.minFilter=nc,this.wrapR=pp,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}let Hc=class{constructor(r=0,e=0,i=0,n=1){this.isQuaternion=!0,this._x=r,this._y=e,this._z=i,this._w=n}static slerpFlat(r,e,i,n,s,o,l){let u=i[n+0],c=i[n+1],h=i[n+2],p=i[n+3];const f=s[o+0],g=s[o+1],m=s[o+2],y=s[o+3];if(l===0){r[e+0]=u,r[e+1]=c,r[e+2]=h,r[e+3]=p;return}if(l===1){r[e+0]=f,r[e+1]=g,r[e+2]=m,r[e+3]=y;return}if(p!==y||u!==f||c!==g||h!==m){let b=1-l;const v=u*f+c*g+h*m+p*y,_=v>=0?1:-1,C=1-v*v;if(C>Number.EPSILON){const T=Math.sqrt(C),R=Math.atan2(T,v*_);b=Math.sin(b*R)/T,l=Math.sin(l*R)/T}const E=l*_;if(u=u*b+f*E,c=c*b+g*E,h=h*b+m*E,p=p*b+y*E,b===1-l){const T=1/Math.sqrt(u*u+c*c+h*h+p*p);u*=T,c*=T,h*=T,p*=T}}r[e]=u,r[e+1]=c,r[e+2]=h,r[e+3]=p}static multiplyQuaternionsFlat(r,e,i,n,s,o){const l=i[n],u=i[n+1],c=i[n+2],h=i[n+3],p=s[o],f=s[o+1],g=s[o+2],m=s[o+3];return r[e]=l*m+h*p+u*g-c*f,r[e+1]=u*m+h*f+c*p-l*g,r[e+2]=c*m+h*g+l*f-u*p,r[e+3]=h*m-l*p-u*f-c*g,r}get x(){return this._x}set x(r){this._x=r,this._onChangeCallback()}get y(){return this._y}set y(r){this._y=r,this._onChangeCallback()}get z(){return this._z}set z(r){this._z=r,this._onChangeCallback()}get w(){return this._w}set w(r){this._w=r,this._onChangeCallback()}set(r,e,i,n){return this._x=r,this._y=e,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(r){return this._x=r.x,this._y=r.y,this._z=r.z,this._w=r.w,this._onChangeCallback(),this}setFromEuler(r,e=!0){const i=r._x,n=r._y,s=r._z,o=r._order,l=Math.cos,u=Math.sin,c=l(i/2),h=l(n/2),p=l(s/2),f=u(i/2),g=u(n/2),m=u(s/2);switch(o){case"XYZ":this._x=f*h*p+c*g*m,this._y=c*g*p-f*h*m,this._z=c*h*m+f*g*p,this._w=c*h*p-f*g*m;break;case"YXZ":this._x=f*h*p+c*g*m,this._y=c*g*p-f*h*m,this._z=c*h*m-f*g*p,this._w=c*h*p+f*g*m;break;case"ZXY":this._x=f*h*p-c*g*m,this._y=c*g*p+f*h*m,this._z=c*h*m+f*g*p,this._w=c*h*p-f*g*m;break;case"ZYX":this._x=f*h*p-c*g*m,this._y=c*g*p+f*h*m,this._z=c*h*m-f*g*p,this._w=c*h*p+f*g*m;break;case"YZX":this._x=f*h*p+c*g*m,this._y=c*g*p+f*h*m,this._z=c*h*m-f*g*p,this._w=c*h*p-f*g*m;break;case"XZY":this._x=f*h*p-c*g*m,this._y=c*g*p-f*h*m,this._z=c*h*m+f*g*p,this._w=c*h*p+f*g*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return e===!0&&this._onChangeCallback(),this}setFromAxisAngle(r,e){const i=e/2,n=Math.sin(i);return this._x=r.x*n,this._y=r.y*n,this._z=r.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(r){const e=r.elements,i=e[0],n=e[4],s=e[8],o=e[1],l=e[5],u=e[9],c=e[2],h=e[6],p=e[10],f=i+l+p;if(f>0){const g=.5/Math.sqrt(f+1);this._w=.25/g,this._x=(h-u)*g,this._y=(s-c)*g,this._z=(o-n)*g}else if(i>l&&i>p){const g=2*Math.sqrt(1+i-l-p);this._w=(h-u)/g,this._x=.25*g,this._y=(n+o)/g,this._z=(s+c)/g}else if(l>p){const g=2*Math.sqrt(1+l-i-p);this._w=(s-c)/g,this._x=(n+o)/g,this._y=.25*g,this._z=(u+h)/g}else{const g=2*Math.sqrt(1+p-i-l);this._w=(o-n)/g,this._x=(s+c)/g,this._y=(u+h)/g,this._z=.25*g}return this._onChangeCallback(),this}setFromUnitVectors(r,e){let i=r.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(r.x)>Math.abs(r.z)?(this._x=-r.y,this._y=r.x,this._z=0,this._w=i):(this._x=0,this._y=-r.z,this._z=r.y,this._w=i)):(this._x=r.y*e.z-r.z*e.y,this._y=r.z*e.x-r.x*e.z,this._z=r.x*e.y-r.y*e.x,this._w=i),this.normalize()}angleTo(r){return 2*Math.acos(Math.abs(Ta(this.dot(r),-1,1)))}rotateTowards(r,e){const i=this.angleTo(r);if(i===0)return this;const n=Math.min(1,e/i);return this.slerp(r,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(r){return this._x*r._x+this._y*r._y+this._z*r._z+this._w*r._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let r=this.length();return r===0?(this._x=0,this._y=0,this._z=0,this._w=1):(r=1/r,this._x=this._x*r,this._y=this._y*r,this._z=this._z*r,this._w=this._w*r),this._onChangeCallback(),this}multiply(r){return this.multiplyQuaternions(this,r)}premultiply(r){return this.multiplyQuaternions(r,this)}multiplyQuaternions(r,e){const i=r._x,n=r._y,s=r._z,o=r._w,l=e._x,u=e._y,c=e._z,h=e._w;return this._x=i*h+o*l+n*c-s*u,this._y=n*h+o*u+s*l-i*c,this._z=s*h+o*c+i*u-n*l,this._w=o*h-i*l-n*u-s*c,this._onChangeCallback(),this}slerp(r,e){if(e===0)return this;if(e===1)return this.copy(r);const i=this._x,n=this._y,s=this._z,o=this._w;let l=o*r._w+i*r._x+n*r._y+s*r._z;if(l<0?(this._w=-r._w,this._x=-r._x,this._y=-r._y,this._z=-r._z,l=-l):this.copy(r),l>=1)return this._w=o,this._x=i,this._y=n,this._z=s,this;const u=1-l*l;if(u<=Number.EPSILON){const g=1-e;return this._w=g*o+e*this._w,this._x=g*i+e*this._x,this._y=g*n+e*this._y,this._z=g*s+e*this._z,this.normalize(),this}const c=Math.sqrt(u),h=Math.atan2(c,l),p=Math.sin((1-e)*h)/c,f=Math.sin(e*h)/c;return this._w=o*p+this._w*f,this._x=i*p+this._x*f,this._y=n*p+this._y*f,this._z=s*p+this._z*f,this._onChangeCallback(),this}slerpQuaternions(r,e,i){return this.copy(r).slerp(e,i)}random(){const r=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),i=Math.random(),n=Math.sqrt(1-i),s=Math.sqrt(i);return this.set(n*Math.sin(r),n*Math.cos(r),s*Math.sin(e),s*Math.cos(e))}equals(r){return r._x===this._x&&r._y===this._y&&r._z===this._z&&r._w===this._w}fromArray(r,e=0){return this._x=r[e],this._y=r[e+1],this._z=r[e+2],this._w=r[e+3],this._onChangeCallback(),this}toArray(r=[],e=0){return r[e]=this._x,r[e+1]=this._y,r[e+2]=this._z,r[e+3]=this._w,r}fromBufferAttribute(r,e){return this._x=r.getX(e),this._y=r.getY(e),this._z=r.getZ(e),this._w=r.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(r){return this._onChangeCallback=r,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},ot=class eW{constructor(e=0,i=0,n=0){eW.prototype.isVector3=!0,this.x=e,this.y=i,this.z=n}set(e,i,n){return n===void 0&&(n=this.z),this.x=e,this.y=i,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,i){return this.x=e.x*i.x,this.y=e.y*i.y,this.z=e.z*i.z,this}applyEuler(e){return this.applyQuaternion(i4.setFromEuler(e))}applyAxisAngle(e,i){return this.applyQuaternion(i4.setFromAxisAngle(e,i))}applyMatrix3(e){const i=this.x,n=this.y,s=this.z,o=e.elements;return this.x=o[0]*i+o[3]*n+o[6]*s,this.y=o[1]*i+o[4]*n+o[7]*s,this.z=o[2]*i+o[5]*n+o[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const i=this.x,n=this.y,s=this.z,o=e.elements,l=1/(o[3]*i+o[7]*n+o[11]*s+o[15]);return this.x=(o[0]*i+o[4]*n+o[8]*s+o[12])*l,this.y=(o[1]*i+o[5]*n+o[9]*s+o[13])*l,this.z=(o[2]*i+o[6]*n+o[10]*s+o[14])*l,this}applyQuaternion(e){const i=this.x,n=this.y,s=this.z,o=e.x,l=e.y,u=e.z,c=e.w,h=2*(l*s-u*n),p=2*(u*i-o*s),f=2*(o*n-l*i);return this.x=i+c*h+l*f-u*p,this.y=n+c*p+u*h-o*f,this.z=s+c*f+o*p-l*h,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const i=this.x,n=this.y,s=this.z,o=e.elements;return this.x=o[0]*i+o[4]*n+o[8]*s,this.y=o[1]*i+o[5]*n+o[9]*s,this.z=o[2]*i+o[6]*n+o[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this}clampLength(e,i){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(i,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this}lerpVectors(e,i,n){return this.x=e.x+(i.x-e.x)*n,this.y=e.y+(i.y-e.y)*n,this.z=e.z+(i.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,i){const n=e.x,s=e.y,o=e.z,l=i.x,u=i.y,c=i.z;return this.x=s*c-o*u,this.y=o*l-n*c,this.z=n*u-s*l,this}projectOnVector(e){const i=e.lengthSq();if(i===0)return this.set(0,0,0);const n=e.dot(this)/i;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return FS.copy(this).projectOnVector(e),this.sub(FS)}reflect(e){return this.sub(FS.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const n=this.dot(e)/i;return Math.acos(Ta(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,n=this.y-e.y,s=this.z-e.z;return i*i+n*n+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,i,n){const s=Math.sin(i)*e;return this.x=s*Math.sin(n),this.y=Math.cos(i)*e,this.z=s*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,i,n){return this.x=e*Math.sin(i),this.y=n,this.z=e*Math.cos(i),this}setFromMatrixPosition(e){const i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(e){const i=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=i,this.y=n,this.z=s,this}setFromMatrixColumn(e,i){return this.fromArray(e.elements,i*4)}setFromMatrix3Column(e,i){return this.fromArray(e.elements,i*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,i=Math.random()*2-1,n=Math.sqrt(1-i*i);return this.x=n*Math.cos(e),this.y=i,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};const FS=new ot,i4=new Hc;let Ap=class{constructor(r=new ot(1/0,1/0,1/0),e=new ot(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=r,this.max=e}set(r,e){return this.min.copy(r),this.max.copy(e),this}setFromArray(r){this.makeEmpty();for(let e=0,i=r.length;e<i;e+=3)this.expandByPoint(oc.fromArray(r,e));return this}setFromBufferAttribute(r){this.makeEmpty();for(let e=0,i=r.count;e<i;e++)this.expandByPoint(oc.fromBufferAttribute(r,e));return this}setFromPoints(r){this.makeEmpty();for(let e=0,i=r.length;e<i;e++)this.expandByPoint(r[e]);return this}setFromCenterAndSize(r,e){const i=oc.copy(e).multiplyScalar(.5);return this.min.copy(r).sub(i),this.max.copy(r).add(i),this}setFromObject(r,e=!1){return this.makeEmpty(),this.expandByObject(r,e)}clone(){return new this.constructor().copy(this)}copy(r){return this.min.copy(r.min),this.max.copy(r.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(r){return this.isEmpty()?r.set(0,0,0):r.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(r){return this.isEmpty()?r.set(0,0,0):r.subVectors(this.max,this.min)}expandByPoint(r){return this.min.min(r),this.max.max(r),this}expandByVector(r){return this.min.sub(r),this.max.add(r),this}expandByScalar(r){return this.min.addScalar(-r),this.max.addScalar(r),this}expandByObject(r,e=!1){r.updateWorldMatrix(!1,!1);const i=r.geometry;if(i!==void 0){const s=i.getAttribute("position");if(e===!0&&s!==void 0&&r.isInstancedMesh!==!0)for(let o=0,l=s.count;o<l;o++)r.isMesh===!0?r.getVertexPosition(o,oc):oc.fromBufferAttribute(s,o),oc.applyMatrix4(r.matrixWorld),this.expandByPoint(oc);else r.boundingBox!==void 0?(r.boundingBox===null&&r.computeBoundingBox(),ux.copy(r.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),ux.copy(i.boundingBox)),ux.applyMatrix4(r.matrixWorld),this.union(ux)}const n=r.children;for(let s=0,o=n.length;s<o;s++)this.expandByObject(n[s],e);return this}containsPoint(r){return r.x>=this.min.x&&r.x<=this.max.x&&r.y>=this.min.y&&r.y<=this.max.y&&r.z>=this.min.z&&r.z<=this.max.z}containsBox(r){return this.min.x<=r.min.x&&r.max.x<=this.max.x&&this.min.y<=r.min.y&&r.max.y<=this.max.y&&this.min.z<=r.min.z&&r.max.z<=this.max.z}getParameter(r,e){return e.set((r.x-this.min.x)/(this.max.x-this.min.x),(r.y-this.min.y)/(this.max.y-this.min.y),(r.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(r){return r.max.x>=this.min.x&&r.min.x<=this.max.x&&r.max.y>=this.min.y&&r.min.y<=this.max.y&&r.max.z>=this.min.z&&r.min.z<=this.max.z}intersectsSphere(r){return this.clampPoint(r.center,oc),oc.distanceToSquared(r.center)<=r.radius*r.radius}intersectsPlane(r){let e,i;return r.normal.x>0?(e=r.normal.x*this.min.x,i=r.normal.x*this.max.x):(e=r.normal.x*this.max.x,i=r.normal.x*this.min.x),r.normal.y>0?(e+=r.normal.y*this.min.y,i+=r.normal.y*this.max.y):(e+=r.normal.y*this.max.y,i+=r.normal.y*this.min.y),r.normal.z>0?(e+=r.normal.z*this.min.z,i+=r.normal.z*this.max.z):(e+=r.normal.z*this.max.z,i+=r.normal.z*this.min.z),e<=-r.constant&&i>=-r.constant}intersectsTriangle(r){if(this.isEmpty())return!1;this.getCenter(EA),hx.subVectors(this.max,EA),Rm.subVectors(r.a,EA),Im.subVectors(r.b,EA),Bm.subVectors(r.c,EA),Jh.subVectors(Im,Rm),Zh.subVectors(Bm,Im),yp.subVectors(Rm,Bm);let e=[0,-Jh.z,Jh.y,0,-Zh.z,Zh.y,0,-yp.z,yp.y,Jh.z,0,-Jh.x,Zh.z,0,-Zh.x,yp.z,0,-yp.x,-Jh.y,Jh.x,0,-Zh.y,Zh.x,0,-yp.y,yp.x,0];return!US(e,Rm,Im,Bm,hx)||(e=[1,0,0,0,1,0,0,0,1],!US(e,Rm,Im,Bm,hx))?!1:(dx.crossVectors(Jh,Zh),e=[dx.x,dx.y,dx.z],US(e,Rm,Im,Bm,hx))}clampPoint(r,e){return e.copy(r).clamp(this.min,this.max)}distanceToPoint(r){return this.clampPoint(r,oc).distanceTo(r)}getBoundingSphere(r){return this.isEmpty()?r.makeEmpty():(this.getCenter(r.center),r.radius=this.getSize(oc).length()*.5),r}intersect(r){return this.min.max(r.min),this.max.min(r.max),this.isEmpty()&&this.makeEmpty(),this}union(r){return this.min.min(r.min),this.max.max(r.max),this}applyMatrix4(r){return this.isEmpty()?this:(Lu[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(r),Lu[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(r),Lu[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(r),Lu[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(r),Lu[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(r),Lu[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(r),Lu[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(r),Lu[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(r),this.setFromPoints(Lu),this)}translate(r){return this.min.add(r),this.max.add(r),this}equals(r){return r.min.equals(this.min)&&r.max.equals(this.max)}};const Lu=[new ot,new ot,new ot,new ot,new ot,new ot,new ot,new ot],oc=new ot,ux=new Ap,Rm=new ot,Im=new ot,Bm=new ot,Jh=new ot,Zh=new ot,yp=new ot,EA=new ot,hx=new ot,dx=new ot,vp=new ot;function US(r,e,i,n,s){for(let o=0,l=r.length-3;o<=l;o+=3){vp.fromArray(r,o);const u=s.x*Math.abs(vp.x)+s.y*Math.abs(vp.y)+s.z*Math.abs(vp.z),c=e.dot(vp),h=i.dot(vp),p=n.dot(vp);if(Math.max(-Math.max(c,h,p),Math.min(c,h,p))>u)return!1}return!0}const sZ=new Ap,wA=new ot,zS=new ot;let px=class{constructor(r=new ot,e=-1){this.isSphere=!0,this.center=r,this.radius=e}set(r,e){return this.center.copy(r),this.radius=e,this}setFromPoints(r,e){const i=this.center;e!==void 0?i.copy(e):sZ.setFromPoints(r).getCenter(i);let n=0;for(let s=0,o=r.length;s<o;s++)n=Math.max(n,i.distanceToSquared(r[s]));return this.radius=Math.sqrt(n),this}copy(r){return this.center.copy(r.center),this.radius=r.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(r){return r.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(r){return r.distanceTo(this.center)-this.radius}intersectsSphere(r){const e=this.radius+r.radius;return r.center.distanceToSquared(this.center)<=e*e}intersectsBox(r){return r.intersectsSphere(this)}intersectsPlane(r){return Math.abs(r.distanceToPoint(this.center))<=this.radius}clampPoint(r,e){const i=this.center.distanceToSquared(r);return e.copy(r),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(r){return this.isEmpty()?(r.makeEmpty(),r):(r.set(this.center,this.center),r.expandByScalar(this.radius),r)}applyMatrix4(r){return this.center.applyMatrix4(r),this.radius=this.radius*r.getMaxScaleOnAxis(),this}translate(r){return this.center.add(r),this}expandByPoint(r){if(this.isEmpty())return this.center.copy(r),this.radius=0,this;wA.subVectors(r,this.center);const e=wA.lengthSq();if(e>this.radius*this.radius){const i=Math.sqrt(e),n=(i-this.radius)*.5;this.center.addScaledVector(wA,n/i),this.radius+=n}return this}union(r){return r.isEmpty()?this:this.isEmpty()?(this.copy(r),this):(this.center.equals(r.center)===!0?this.radius=Math.max(this.radius,r.radius):(zS.subVectors(r.center,this.center).setLength(r.radius),this.expandByPoint(wA.copy(r.center).add(zS)),this.expandByPoint(wA.copy(r.center).sub(zS))),this)}equals(r){return r.center.equals(this.center)&&r.radius===this.radius}clone(){return new this.constructor().copy(this)}};const Du=new ot,jS=new ot,fx=new ot,$h=new ot,GS=new ot,mx=new ot,VS=new ot;let gx=class{constructor(r=new ot,e=new ot(0,0,-1)){this.origin=r,this.direction=e}set(r,e){return this.origin.copy(r),this.direction.copy(e),this}copy(r){return this.origin.copy(r.origin),this.direction.copy(r.direction),this}at(r,e){return e.copy(this.origin).addScaledVector(this.direction,r)}lookAt(r){return this.direction.copy(r).sub(this.origin).normalize(),this}recast(r){return this.origin.copy(this.at(r,Du)),this}closestPointToPoint(r,e){e.subVectors(r,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(r){return Math.sqrt(this.distanceSqToPoint(r))}distanceSqToPoint(r){const e=Du.subVectors(r,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(r):(Du.copy(this.origin).addScaledVector(this.direction,e),Du.distanceToSquared(r))}distanceSqToSegment(r,e,i,n){jS.copy(r).add(e).multiplyScalar(.5),fx.copy(e).sub(r).normalize(),$h.copy(this.origin).sub(jS);const s=r.distanceTo(e)*.5,o=-this.direction.dot(fx),l=$h.dot(this.direction),u=-$h.dot(fx),c=$h.lengthSq(),h=Math.abs(1-o*o);let p,f,g,m;if(h>0)if(p=o*u-l,f=o*l-u,m=s*h,p>=0)if(f>=-m)if(f<=m){const y=1/h;p*=y,f*=y,g=p*(p+o*f+2*l)+f*(o*p+f+2*u)+c}else f=s,p=Math.max(0,-(o*f+l)),g=-p*p+f*(f+2*u)+c;else f=-s,p=Math.max(0,-(o*f+l)),g=-p*p+f*(f+2*u)+c;else f<=-m?(p=Math.max(0,-(-o*s+l)),f=p>0?-s:Math.min(Math.max(-s,-u),s),g=-p*p+f*(f+2*u)+c):f<=m?(p=0,f=Math.min(Math.max(-s,-u),s),g=f*(f+2*u)+c):(p=Math.max(0,-(o*s+l)),f=p>0?s:Math.min(Math.max(-s,-u),s),g=-p*p+f*(f+2*u)+c);else f=o>0?-s:s,p=Math.max(0,-(o*f+l)),g=-p*p+f*(f+2*u)+c;return i&&i.copy(this.origin).addScaledVector(this.direction,p),n&&n.copy(jS).addScaledVector(fx,f),g}intersectSphere(r,e){Du.subVectors(r.center,this.origin);const i=Du.dot(this.direction),n=Du.dot(Du)-i*i,s=r.radius*r.radius;if(n>s)return null;const o=Math.sqrt(s-n),l=i-o,u=i+o;return u<0?null:l<0?this.at(u,e):this.at(l,e)}intersectsSphere(r){return this.distanceSqToPoint(r.center)<=r.radius*r.radius}distanceToPlane(r){const e=r.normal.dot(this.direction);if(e===0)return r.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(r.normal)+r.constant)/e;return i>=0?i:null}intersectPlane(r,e){const i=this.distanceToPlane(r);return i===null?null:this.at(i,e)}intersectsPlane(r){const e=r.distanceToPoint(this.origin);return e===0||r.normal.dot(this.direction)*e<0}intersectBox(r,e){let i,n,s,o,l,u;const c=1/this.direction.x,h=1/this.direction.y,p=1/this.direction.z,f=this.origin;return c>=0?(i=(r.min.x-f.x)*c,n=(r.max.x-f.x)*c):(i=(r.max.x-f.x)*c,n=(r.min.x-f.x)*c),h>=0?(s=(r.min.y-f.y)*h,o=(r.max.y-f.y)*h):(s=(r.max.y-f.y)*h,o=(r.min.y-f.y)*h),i>o||s>n||((s>i||isNaN(i))&&(i=s),(o<n||isNaN(n))&&(n=o),p>=0?(l=(r.min.z-f.z)*p,u=(r.max.z-f.z)*p):(l=(r.max.z-f.z)*p,u=(r.min.z-f.z)*p),i>u||l>n)||((l>i||i!==i)&&(i=l),(u<n||n!==n)&&(n=u),n<0)?null:this.at(i>=0?i:n,e)}intersectsBox(r){return this.intersectBox(r,Du)!==null}intersectTriangle(r,e,i,n,s){GS.subVectors(e,r),mx.subVectors(i,r),VS.crossVectors(GS,mx);let o=this.direction.dot(VS),l;if(o>0){if(n)return null;l=1}else if(o<0)l=-1,o=-o;else return null;$h.subVectors(this.origin,r);const u=l*this.direction.dot(mx.crossVectors($h,mx));if(u<0)return null;const c=l*this.direction.dot(GS.cross($h));if(c<0||u+c>o)return null;const h=-l*$h.dot(VS);return h<0?null:this.at(h/o,s)}applyMatrix4(r){return this.origin.applyMatrix4(r),this.direction.transformDirection(r),this}equals(r){return r.origin.equals(this.origin)&&r.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},gs=class ML{constructor(e,i,n,s,o,l,u,c,h,p,f,g,m,y,b,v){ML.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,i,n,s,o,l,u,c,h,p,f,g,m,y,b,v)}set(e,i,n,s,o,l,u,c,h,p,f,g,m,y,b,v){const _=this.elements;return _[0]=e,_[4]=i,_[8]=n,_[12]=s,_[1]=o,_[5]=l,_[9]=u,_[13]=c,_[2]=h,_[6]=p,_[10]=f,_[14]=g,_[3]=m,_[7]=y,_[11]=b,_[15]=v,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new ML().fromArray(this.elements)}copy(e){const i=this.elements,n=e.elements;return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],this}copyPosition(e){const i=this.elements,n=e.elements;return i[12]=n[12],i[13]=n[13],i[14]=n[14],this}setFromMatrix3(e){const i=e.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(e,i,n){return e.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,i,n){return this.set(e.x,i.x,n.x,0,e.y,i.y,n.y,0,e.z,i.z,n.z,0,0,0,0,1),this}extractRotation(e){const i=this.elements,n=e.elements,s=1/Nm.setFromMatrixColumn(e,0).length(),o=1/Nm.setFromMatrixColumn(e,1).length(),l=1/Nm.setFromMatrixColumn(e,2).length();return i[0]=n[0]*s,i[1]=n[1]*s,i[2]=n[2]*s,i[3]=0,i[4]=n[4]*o,i[5]=n[5]*o,i[6]=n[6]*o,i[7]=0,i[8]=n[8]*l,i[9]=n[9]*l,i[10]=n[10]*l,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(e){const i=this.elements,n=e.x,s=e.y,o=e.z,l=Math.cos(n),u=Math.sin(n),c=Math.cos(s),h=Math.sin(s),p=Math.cos(o),f=Math.sin(o);if(e.order==="XYZ"){const g=l*p,m=l*f,y=u*p,b=u*f;i[0]=c*p,i[4]=-c*f,i[8]=h,i[1]=m+y*h,i[5]=g-b*h,i[9]=-u*c,i[2]=b-g*h,i[6]=y+m*h,i[10]=l*c}else if(e.order==="YXZ"){const g=c*p,m=c*f,y=h*p,b=h*f;i[0]=g+b*u,i[4]=y*u-m,i[8]=l*h,i[1]=l*f,i[5]=l*p,i[9]=-u,i[2]=m*u-y,i[6]=b+g*u,i[10]=l*c}else if(e.order==="ZXY"){const g=c*p,m=c*f,y=h*p,b=h*f;i[0]=g-b*u,i[4]=-l*f,i[8]=y+m*u,i[1]=m+y*u,i[5]=l*p,i[9]=b-g*u,i[2]=-l*h,i[6]=u,i[10]=l*c}else if(e.order==="ZYX"){const g=l*p,m=l*f,y=u*p,b=u*f;i[0]=c*p,i[4]=y*h-m,i[8]=g*h+b,i[1]=c*f,i[5]=b*h+g,i[9]=m*h-y,i[2]=-h,i[6]=u*c,i[10]=l*c}else if(e.order==="YZX"){const g=l*c,m=l*h,y=u*c,b=u*h;i[0]=c*p,i[4]=b-g*f,i[8]=y*f+m,i[1]=f,i[5]=l*p,i[9]=-u*p,i[2]=-h*p,i[6]=m*f+y,i[10]=g-b*f}else if(e.order==="XZY"){const g=l*c,m=l*h,y=u*c,b=u*h;i[0]=c*p,i[4]=-f,i[8]=h*p,i[1]=g*f+b,i[5]=l*p,i[9]=m*f-y,i[2]=y*f-m,i[6]=u*p,i[10]=b*f+g}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(e){return this.compose(aZ,e,oZ)}lookAt(e,i,n){const s=this.elements;return dl.subVectors(e,i),dl.lengthSq()===0&&(dl.z=1),dl.normalize(),ed.crossVectors(n,dl),ed.lengthSq()===0&&(Math.abs(n.z)===1?dl.x+=1e-4:dl.z+=1e-4,dl.normalize(),ed.crossVectors(n,dl)),ed.normalize(),Ax.crossVectors(dl,ed),s[0]=ed.x,s[4]=Ax.x,s[8]=dl.x,s[1]=ed.y,s[5]=Ax.y,s[9]=dl.y,s[2]=ed.z,s[6]=Ax.z,s[10]=dl.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const n=e.elements,s=i.elements,o=this.elements,l=n[0],u=n[4],c=n[8],h=n[12],p=n[1],f=n[5],g=n[9],m=n[13],y=n[2],b=n[6],v=n[10],_=n[14],C=n[3],E=n[7],T=n[11],R=n[15],B=s[0],I=s[4],D=s[8],L=s[12],O=s[1],F=s[5],q=s[9],H=s[13],G=s[2],J=s[6],Q=s[10],V=s[14],z=s[3],te=s[7],K=s[11],ae=s[15];return o[0]=l*B+u*O+c*G+h*z,o[4]=l*I+u*F+c*J+h*te,o[8]=l*D+u*q+c*Q+h*K,o[12]=l*L+u*H+c*V+h*ae,o[1]=p*B+f*O+g*G+m*z,o[5]=p*I+f*F+g*J+m*te,o[9]=p*D+f*q+g*Q+m*K,o[13]=p*L+f*H+g*V+m*ae,o[2]=y*B+b*O+v*G+_*z,o[6]=y*I+b*F+v*J+_*te,o[10]=y*D+b*q+v*Q+_*K,o[14]=y*L+b*H+v*V+_*ae,o[3]=C*B+E*O+T*G+R*z,o[7]=C*I+E*F+T*J+R*te,o[11]=C*D+E*q+T*Q+R*K,o[15]=C*L+E*H+T*V+R*ae,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[4]*=e,i[8]*=e,i[12]*=e,i[1]*=e,i[5]*=e,i[9]*=e,i[13]*=e,i[2]*=e,i[6]*=e,i[10]*=e,i[14]*=e,i[3]*=e,i[7]*=e,i[11]*=e,i[15]*=e,this}determinant(){const e=this.elements,i=e[0],n=e[4],s=e[8],o=e[12],l=e[1],u=e[5],c=e[9],h=e[13],p=e[2],f=e[6],g=e[10],m=e[14],y=e[3],b=e[7],v=e[11],_=e[15];return y*(+o*c*f-s*h*f-o*u*g+n*h*g+s*u*m-n*c*m)+b*(+i*c*m-i*h*g+o*l*g-s*l*m+s*h*p-o*c*p)+v*(+i*h*f-i*u*m-o*l*f+n*l*m+o*u*p-n*h*p)+_*(-s*u*p-i*c*f+i*u*g+s*l*f-n*l*g+n*c*p)}transpose(){const e=this.elements;let i;return i=e[1],e[1]=e[4],e[4]=i,i=e[2],e[2]=e[8],e[8]=i,i=e[6],e[6]=e[9],e[9]=i,i=e[3],e[3]=e[12],e[12]=i,i=e[7],e[7]=e[13],e[13]=i,i=e[11],e[11]=e[14],e[14]=i,this}setPosition(e,i,n){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=i,s[14]=n),this}invert(){const e=this.elements,i=e[0],n=e[1],s=e[2],o=e[3],l=e[4],u=e[5],c=e[6],h=e[7],p=e[8],f=e[9],g=e[10],m=e[11],y=e[12],b=e[13],v=e[14],_=e[15],C=f*v*h-b*g*h+b*c*m-u*v*m-f*c*_+u*g*_,E=y*g*h-p*v*h-y*c*m+l*v*m+p*c*_-l*g*_,T=p*b*h-y*f*h+y*u*m-l*b*m-p*u*_+l*f*_,R=y*f*c-p*b*c-y*u*g+l*b*g+p*u*v-l*f*v,B=i*C+n*E+s*T+o*R;if(B===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const I=1/B;return e[0]=C*I,e[1]=(b*g*o-f*v*o-b*s*m+n*v*m+f*s*_-n*g*_)*I,e[2]=(u*v*o-b*c*o+b*s*h-n*v*h-u*s*_+n*c*_)*I,e[3]=(f*c*o-u*g*o-f*s*h+n*g*h+u*s*m-n*c*m)*I,e[4]=E*I,e[5]=(p*v*o-y*g*o+y*s*m-i*v*m-p*s*_+i*g*_)*I,e[6]=(y*c*o-l*v*o-y*s*h+i*v*h+l*s*_-i*c*_)*I,e[7]=(l*g*o-p*c*o+p*s*h-i*g*h-l*s*m+i*c*m)*I,e[8]=T*I,e[9]=(y*f*o-p*b*o-y*n*m+i*b*m+p*n*_-i*f*_)*I,e[10]=(l*b*o-y*u*o+y*n*h-i*b*h-l*n*_+i*u*_)*I,e[11]=(p*u*o-l*f*o-p*n*h+i*f*h+l*n*m-i*u*m)*I,e[12]=R*I,e[13]=(p*b*s-y*f*s+y*n*g-i*b*g-p*n*v+i*f*v)*I,e[14]=(y*u*s-l*b*s-y*n*c+i*b*c+l*n*v-i*u*v)*I,e[15]=(l*f*s-p*u*s+p*n*c-i*f*c-l*n*g+i*u*g)*I,this}scale(e){const i=this.elements,n=e.x,s=e.y,o=e.z;return i[0]*=n,i[4]*=s,i[8]*=o,i[1]*=n,i[5]*=s,i[9]*=o,i[2]*=n,i[6]*=s,i[10]*=o,i[3]*=n,i[7]*=s,i[11]*=o,this}getMaxScaleOnAxis(){const e=this.elements,i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(i,n,s))}makeTranslation(e,i,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,i,0,0,1,n,0,0,0,1),this}makeRotationX(e){const i=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,i,-n,0,0,n,i,0,0,0,0,1),this}makeRotationY(e){const i=Math.cos(e),n=Math.sin(e);return this.set(i,0,n,0,0,1,0,0,-n,0,i,0,0,0,0,1),this}makeRotationZ(e){const i=Math.cos(e),n=Math.sin(e);return this.set(i,-n,0,0,n,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,i){const n=Math.cos(i),s=Math.sin(i),o=1-n,l=e.x,u=e.y,c=e.z,h=o*l,p=o*u;return this.set(h*l+n,h*u-s*c,h*c+s*u,0,h*u+s*c,p*u+n,p*c-s*l,0,h*c-s*u,p*c+s*l,o*c*c+n,0,0,0,0,1),this}makeScale(e,i,n){return this.set(e,0,0,0,0,i,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,i,n,s,o,l){return this.set(1,n,o,0,e,1,l,0,i,s,1,0,0,0,0,1),this}compose(e,i,n){const s=this.elements,o=i._x,l=i._y,u=i._z,c=i._w,h=o+o,p=l+l,f=u+u,g=o*h,m=o*p,y=o*f,b=l*p,v=l*f,_=u*f,C=c*h,E=c*p,T=c*f,R=n.x,B=n.y,I=n.z;return s[0]=(1-(b+_))*R,s[1]=(m+T)*R,s[2]=(y-E)*R,s[3]=0,s[4]=(m-T)*B,s[5]=(1-(g+_))*B,s[6]=(v+C)*B,s[7]=0,s[8]=(y+E)*I,s[9]=(v-C)*I,s[10]=(1-(g+b))*I,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,i,n){const s=this.elements;let o=Nm.set(s[0],s[1],s[2]).length();const l=Nm.set(s[4],s[5],s[6]).length(),u=Nm.set(s[8],s[9],s[10]).length();this.determinant()<0&&(o=-o),e.x=s[12],e.y=s[13],e.z=s[14],lc.copy(this);const c=1/o,h=1/l,p=1/u;return lc.elements[0]*=c,lc.elements[1]*=c,lc.elements[2]*=c,lc.elements[4]*=h,lc.elements[5]*=h,lc.elements[6]*=h,lc.elements[8]*=p,lc.elements[9]*=p,lc.elements[10]*=p,i.setFromRotationMatrix(lc),n.x=o,n.y=l,n.z=u,this}makePerspective(e,i,n,s,o,l,u=Iu){const c=this.elements,h=2*o/(i-e),p=2*o/(n-s),f=(i+e)/(i-e),g=(n+s)/(n-s);let m,y;if(u===Iu)m=-(l+o)/(l-o),y=-2*l*o/(l-o);else if(u===cx)m=-l/(l-o),y=-l*o/(l-o);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+u);return c[0]=h,c[4]=0,c[8]=f,c[12]=0,c[1]=0,c[5]=p,c[9]=g,c[13]=0,c[2]=0,c[6]=0,c[10]=m,c[14]=y,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,i,n,s,o,l,u=Iu){const c=this.elements,h=1/(i-e),p=1/(n-s),f=1/(l-o),g=(i+e)*h,m=(n+s)*p;let y,b;if(u===Iu)y=(l+o)*f,b=-2*f;else if(u===cx)y=o*f,b=-1*f;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+u);return c[0]=2*h,c[4]=0,c[8]=0,c[12]=-g,c[1]=0,c[5]=2*p,c[9]=0,c[13]=-m,c[2]=0,c[6]=0,c[10]=b,c[14]=-y,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const i=this.elements,n=e.elements;for(let s=0;s<16;s++)if(i[s]!==n[s])return!1;return!0}fromArray(e,i=0){for(let n=0;n<16;n++)this.elements[n]=e[n+i];return this}toArray(e=[],i=0){const n=this.elements;return e[i]=n[0],e[i+1]=n[1],e[i+2]=n[2],e[i+3]=n[3],e[i+4]=n[4],e[i+5]=n[5],e[i+6]=n[6],e[i+7]=n[7],e[i+8]=n[8],e[i+9]=n[9],e[i+10]=n[10],e[i+11]=n[11],e[i+12]=n[12],e[i+13]=n[13],e[i+14]=n[14],e[i+15]=n[15],e}};const Nm=new ot,lc=new gs,aZ=new ot(0,0,0),oZ=new ot(1,1,1),ed=new ot,Ax=new ot,dl=new ot,r4=new gs,n4=new Hc;let td=class tW{constructor(e=0,i=0,n=0,s=tW.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=i,this._z=n,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,i,n,s=this._order){return this._x=e,this._y=i,this._z=n,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,i=this._order,n=!0){const s=e.elements,o=s[0],l=s[4],u=s[8],c=s[1],h=s[5],p=s[9],f=s[2],g=s[6],m=s[10];switch(i){case"XYZ":this._y=Math.asin(Ta(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-p,m),this._z=Math.atan2(-l,o)):(this._x=Math.atan2(g,h),this._z=0);break;case"YXZ":this._x=Math.asin(-Ta(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(u,m),this._z=Math.atan2(c,h)):(this._y=Math.atan2(-f,o),this._z=0);break;case"ZXY":this._x=Math.asin(Ta(g,-1,1)),Math.abs(g)<.9999999?(this._y=Math.atan2(-f,m),this._z=Math.atan2(-l,h)):(this._y=0,this._z=Math.atan2(c,o));break;case"ZYX":this._y=Math.asin(-Ta(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(g,m),this._z=Math.atan2(c,o)):(this._x=0,this._z=Math.atan2(-l,h));break;case"YZX":this._z=Math.asin(Ta(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-p,h),this._y=Math.atan2(-f,o)):(this._x=0,this._y=Math.atan2(u,m));break;case"XZY":this._z=Math.asin(-Ta(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(g,h),this._y=Math.atan2(u,o)):(this._x=Math.atan2(-p,m),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,i,n){return r4.makeRotationFromQuaternion(e),this.setFromRotationMatrix(r4,i,n)}setFromVector3(e,i=this._order){return this.set(e.x,e.y,e.z,i)}reorder(e){return n4.setFromEuler(this),this.setFromQuaternion(n4,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};td.DEFAULT_ORDER="XYZ";let HS=class{constructor(){this.mask=1}set(r){this.mask=(1<<r|0)>>>0}enable(r){this.mask|=1<<r|0}enableAll(){this.mask=-1}toggle(r){this.mask^=1<<r|0}disable(r){this.mask&=~(1<<r|0)}disableAll(){this.mask=0}test(r){return(this.mask&r.mask)!==0}isEnabled(r){return(this.mask&(1<<r|0))!==0}},lZ=0;const s4=new ot,Lm=new Hc,Ou=new gs,yx=new ot,CA=new ot,cZ=new ot,uZ=new Hc,a4=new ot(1,0,0),o4=new ot(0,1,0),l4=new ot(0,0,1),c4={type:"added"},hZ={type:"removed"},Dm={type:"childadded",child:null},WS={type:"childremoved",child:null};let to=class d2 extends gp{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:lZ++}),this.uuid=Bu(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=d2.DEFAULT_UP.clone();const e=new ot,i=new td,n=new Hc,s=new ot(1,1,1);function o(){n.setFromEuler(i,!1)}function l(){i.setFromQuaternion(n,void 0,!1)}i._onChange(o),n._onChange(l),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new gs},normalMatrix:{value:new mn}}),this.matrix=new gs,this.matrixWorld=new gs,this.matrixAutoUpdate=d2.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=d2.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new HS,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,i){this.quaternion.setFromAxisAngle(e,i)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,i){return Lm.setFromAxisAngle(e,i),this.quaternion.multiply(Lm),this}rotateOnWorldAxis(e,i){return Lm.setFromAxisAngle(e,i),this.quaternion.premultiply(Lm),this}rotateX(e){return this.rotateOnAxis(a4,e)}rotateY(e){return this.rotateOnAxis(o4,e)}rotateZ(e){return this.rotateOnAxis(l4,e)}translateOnAxis(e,i){return s4.copy(e).applyQuaternion(this.quaternion),this.position.add(s4.multiplyScalar(i)),this}translateX(e){return this.translateOnAxis(a4,e)}translateY(e){return this.translateOnAxis(o4,e)}translateZ(e){return this.translateOnAxis(l4,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Ou.copy(this.matrixWorld).invert())}lookAt(e,i,n){e.isVector3?yx.copy(e):yx.set(e,i,n);const s=this.parent;this.updateWorldMatrix(!0,!1),CA.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ou.lookAt(CA,yx,this.up):Ou.lookAt(yx,CA,this.up),this.quaternion.setFromRotationMatrix(Ou),s&&(Ou.extractRotation(s.matrixWorld),Lm.setFromRotationMatrix(Ou),this.quaternion.premultiply(Lm.invert()))}add(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(c4),Dm.child=e,this.dispatchEvent(Dm),Dm.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const i=this.children.indexOf(e);return i!==-1&&(e.parent=null,this.children.splice(i,1),e.dispatchEvent(hZ),WS.child=e,this.dispatchEvent(WS),WS.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Ou.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Ou.multiply(e.parent.matrixWorld)),e.applyMatrix4(Ou),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(c4),Dm.child=e,this.dispatchEvent(Dm),Dm.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,i){if(this[e]===i)return this;for(let n=0,s=this.children.length;n<s;n++){const o=this.children[n].getObjectByProperty(e,i);if(o!==void 0)return o}}getObjectsByProperty(e,i,n=[]){this[e]===i&&n.push(this);const s=this.children;for(let o=0,l=s.length;o<l;o++)s[o].getObjectsByProperty(e,i,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(CA,e,cZ),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(CA,uZ,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return e.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(e){e(this);const i=this.children;for(let n=0,s=i.length;n<s;n++)i[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const i=this.children;for(let n=0,s=i.length;n<s;n++)i[n].traverseVisible(e)}traverseAncestors(e){const i=this.parent;i!==null&&(e(i),i.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const i=this.children;for(let n=0,s=i.length;n<s;n++)i[n].updateMatrixWorld(e)}updateWorldMatrix(e,i){const n=this.parent;if(e===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),i===!0){const s=this.children;for(let o=0,l=s.length;o<l;o++)s[o].updateWorldMatrix(!1,!0)}}toJSON(e){const i=e===void 0||typeof e=="string",n={};i&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.visibility=this._visibility,s.active=this._active,s.bounds=this._bounds.map(u=>({boxInitialized:u.boxInitialized,boxMin:u.box.min.toArray(),boxMax:u.box.max.toArray(),sphereInitialized:u.sphereInitialized,sphereRadius:u.sphere.radius,sphereCenter:u.sphere.center.toArray()})),s.maxInstanceCount=this._maxInstanceCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.geometryCount=this._geometryCount,s.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(s.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(s.boundingSphere={center:s.boundingSphere.center.toArray(),radius:s.boundingSphere.radius}),this.boundingBox!==null&&(s.boundingBox={min:s.boundingBox.min.toArray(),max:s.boundingBox.max.toArray()}));function o(u,c){return u[c.uuid]===void 0&&(u[c.uuid]=c.toJSON(e)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=o(e.geometries,this.geometry);const u=this.geometry.parameters;if(u!==void 0&&u.shapes!==void 0){const c=u.shapes;if(Array.isArray(c))for(let h=0,p=c.length;h<p;h++){const f=c[h];o(e.shapes,f)}else o(e.shapes,c)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(o(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const u=[];for(let c=0,h=this.material.length;c<h;c++)u.push(o(e.materials,this.material[c]));s.material=u}else s.material=o(e.materials,this.material);if(this.children.length>0){s.children=[];for(let u=0;u<this.children.length;u++)s.children.push(this.children[u].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let u=0;u<this.animations.length;u++){const c=this.animations[u];s.animations.push(o(e.animations,c))}}if(i){const u=l(e.geometries),c=l(e.materials),h=l(e.textures),p=l(e.images),f=l(e.shapes),g=l(e.skeletons),m=l(e.animations),y=l(e.nodes);u.length>0&&(n.geometries=u),c.length>0&&(n.materials=c),h.length>0&&(n.textures=h),p.length>0&&(n.images=p),f.length>0&&(n.shapes=f),g.length>0&&(n.skeletons=g),m.length>0&&(n.animations=m),y.length>0&&(n.nodes=y)}return n.object=s,n;function l(u){const c=[];for(const h in u){const p=u[h];delete p.metadata,c.push(p)}return c}}clone(e){return new this.constructor().copy(this,e)}copy(e,i=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),i===!0)for(let n=0;n<e.children.length;n++){const s=e.children[n];this.add(s.clone())}return this}};to.DEFAULT_UP=new ot(0,1,0),to.DEFAULT_MATRIX_AUTO_UPDATE=!0,to.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const cc=new ot,Pu=new ot,QS=new ot,ku=new ot,Om=new ot,Pm=new ot,u4=new ot,qS=new ot,XS=new ot,KS=new ot,YS=new Zs,JS=new Zs,ZS=new Zs;let bp=class F0{constructor(e=new ot,i=new ot,n=new ot){this.a=e,this.b=i,this.c=n}static getNormal(e,i,n,s){s.subVectors(n,i),cc.subVectors(e,i),s.cross(cc);const o=s.lengthSq();return o>0?s.multiplyScalar(1/Math.sqrt(o)):s.set(0,0,0)}static getBarycoord(e,i,n,s,o){cc.subVectors(s,i),Pu.subVectors(n,i),QS.subVectors(e,i);const l=cc.dot(cc),u=cc.dot(Pu),c=cc.dot(QS),h=Pu.dot(Pu),p=Pu.dot(QS),f=l*h-u*u;if(f===0)return o.set(0,0,0),null;const g=1/f,m=(h*c-u*p)*g,y=(l*p-u*c)*g;return o.set(1-m-y,y,m)}static containsPoint(e,i,n,s){return this.getBarycoord(e,i,n,s,ku)===null?!1:ku.x>=0&&ku.y>=0&&ku.x+ku.y<=1}static getInterpolation(e,i,n,s,o,l,u,c){return this.getBarycoord(e,i,n,s,ku)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(o,ku.x),c.addScaledVector(l,ku.y),c.addScaledVector(u,ku.z),c)}static getInterpolatedAttribute(e,i,n,s,o,l){return YS.setScalar(0),JS.setScalar(0),ZS.setScalar(0),YS.fromBufferAttribute(e,i),JS.fromBufferAttribute(e,n),ZS.fromBufferAttribute(e,s),l.setScalar(0),l.addScaledVector(YS,o.x),l.addScaledVector(JS,o.y),l.addScaledVector(ZS,o.z),l}static isFrontFacing(e,i,n,s){return cc.subVectors(n,i),Pu.subVectors(e,i),cc.cross(Pu).dot(s)<0}set(e,i,n){return this.a.copy(e),this.b.copy(i),this.c.copy(n),this}setFromPointsAndIndices(e,i,n,s){return this.a.copy(e[i]),this.b.copy(e[n]),this.c.copy(e[s]),this}setFromAttributeAndIndices(e,i,n,s){return this.a.fromBufferAttribute(e,i),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return cc.subVectors(this.c,this.b),Pu.subVectors(this.a,this.b),cc.cross(Pu).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return F0.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,i){return F0.getBarycoord(e,this.a,this.b,this.c,i)}getInterpolation(e,i,n,s,o){return F0.getInterpolation(e,this.a,this.b,this.c,i,n,s,o)}containsPoint(e){return F0.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return F0.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,i){const n=this.a,s=this.b,o=this.c;let l,u;Om.subVectors(s,n),Pm.subVectors(o,n),qS.subVectors(e,n);const c=Om.dot(qS),h=Pm.dot(qS);if(c<=0&&h<=0)return i.copy(n);XS.subVectors(e,s);const p=Om.dot(XS),f=Pm.dot(XS);if(p>=0&&f<=p)return i.copy(s);const g=c*f-p*h;if(g<=0&&c>=0&&p<=0)return l=c/(c-p),i.copy(n).addScaledVector(Om,l);KS.subVectors(e,o);const m=Om.dot(KS),y=Pm.dot(KS);if(y>=0&&m<=y)return i.copy(o);const b=m*h-c*y;if(b<=0&&h>=0&&y<=0)return u=h/(h-y),i.copy(n).addScaledVector(Pm,u);const v=p*y-m*f;if(v<=0&&f-p>=0&&m-y>=0)return u4.subVectors(o,s),u=(f-p)/(f-p+(m-y)),i.copy(s).addScaledVector(u4,u);const _=1/(v+b+g);return l=b*_,u=g*_,i.copy(n).addScaledVector(Om,l).addScaledVector(Pm,u)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}};const h4={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},id={h:0,s:0,l:0},vx={h:0,s:0,l:0};function $S(r,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?r+(e-r)*6*i:i<1/2?e:i<2/3?r+(e-r)*6*(2/3-i):r}let Sn=class{constructor(r,e,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(r,e,i)}set(r,e,i){if(e===void 0&&i===void 0){const n=r;n&&n.isColor?this.copy(n):typeof n=="number"?this.setHex(n):typeof n=="string"&&this.setStyle(n)}else this.setRGB(r,e,i);return this}setScalar(r){return this.r=r,this.g=r,this.b=r,this}setHex(r,e=jo){return r=Math.floor(r),this.r=(r>>16&255)/255,this.g=(r>>8&255)/255,this.b=(r&255)/255,Fn.toWorkingColorSpace(this,e),this}setRGB(r,e,i,n=Fn.workingColorSpace){return this.r=r,this.g=e,this.b=i,Fn.toWorkingColorSpace(this,n),this}setHSL(r,e,i,n=Fn.workingColorSpace){if(r=DS(r,1),e=Ta(e,0,1),i=Ta(i,0,1),e===0)this.r=this.g=this.b=i;else{const s=i<=.5?i*(1+e):i+e-i*e,o=2*i-s;this.r=$S(o,s,r+1/3),this.g=$S(o,s,r),this.b=$S(o,s,r-1/3)}return Fn.toWorkingColorSpace(this,n),this}setStyle(r,e=jo){function i(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+r+" will be ignored.")}let n;if(n=/^(\w+)\(([^\)]*)\)/.exec(r)){let s;const o=n[1],l=n[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return i(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,e);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return i(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,e);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return i(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+r)}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(r)){const s=n[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,e);if(o===6)return this.setHex(parseInt(s,16),e);console.warn("THREE.Color: Invalid hex color "+r)}else if(r&&r.length>0)return this.setColorName(r,e);return this}setColorName(r,e=jo){const i=h4[r.toLowerCase()];return i!==void 0?this.setHex(i,e):console.warn("THREE.Color: Unknown color "+r),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(r){return this.r=r.r,this.g=r.g,this.b=r.b,this}copySRGBToLinear(r){return this.r=Nu(r.r),this.g=Nu(r.g),this.b=Nu(r.b),this}copyLinearToSRGB(r){return this.r=Tm(r.r),this.g=Tm(r.g),this.b=Tm(r.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(r=jo){return Fn.fromWorkingColorSpace(io.copy(this),r),Math.round(Ta(io.r*255,0,255))*65536+Math.round(Ta(io.g*255,0,255))*256+Math.round(Ta(io.b*255,0,255))}getHexString(r=jo){return("000000"+this.getHex(r).toString(16)).slice(-6)}getHSL(r,e=Fn.workingColorSpace){Fn.fromWorkingColorSpace(io.copy(this),e);const i=io.r,n=io.g,s=io.b,o=Math.max(i,n,s),l=Math.min(i,n,s);let u,c;const h=(l+o)/2;if(l===o)u=0,c=0;else{const p=o-l;switch(c=h<=.5?p/(o+l):p/(2-o-l),o){case i:u=(n-s)/p+(n<s?6:0);break;case n:u=(s-i)/p+2;break;case s:u=(i-n)/p+4;break}u/=6}return r.h=u,r.s=c,r.l=h,r}getRGB(r,e=Fn.workingColorSpace){return Fn.fromWorkingColorSpace(io.copy(this),e),r.r=io.r,r.g=io.g,r.b=io.b,r}getStyle(r=jo){Fn.fromWorkingColorSpace(io.copy(this),r);const e=io.r,i=io.g,n=io.b;return r!==jo?`color(${r} ${e.toFixed(3)} ${i.toFixed(3)} ${n.toFixed(3)})`:`rgb(${Math.round(e*255)},${Math.round(i*255)},${Math.round(n*255)})`}offsetHSL(r,e,i){return this.getHSL(id),this.setHSL(id.h+r,id.s+e,id.l+i)}add(r){return this.r+=r.r,this.g+=r.g,this.b+=r.b,this}addColors(r,e){return this.r=r.r+e.r,this.g=r.g+e.g,this.b=r.b+e.b,this}addScalar(r){return this.r+=r,this.g+=r,this.b+=r,this}sub(r){return this.r=Math.max(0,this.r-r.r),this.g=Math.max(0,this.g-r.g),this.b=Math.max(0,this.b-r.b),this}multiply(r){return this.r*=r.r,this.g*=r.g,this.b*=r.b,this}multiplyScalar(r){return this.r*=r,this.g*=r,this.b*=r,this}lerp(r,e){return this.r+=(r.r-this.r)*e,this.g+=(r.g-this.g)*e,this.b+=(r.b-this.b)*e,this}lerpColors(r,e,i){return this.r=r.r+(e.r-r.r)*i,this.g=r.g+(e.g-r.g)*i,this.b=r.b+(e.b-r.b)*i,this}lerpHSL(r,e){this.getHSL(id),r.getHSL(vx);const i=bA(id.h,vx.h,e),n=bA(id.s,vx.s,e),s=bA(id.l,vx.l,e);return this.setHSL(i,n,s),this}setFromVector3(r){return this.r=r.x,this.g=r.y,this.b=r.z,this}applyMatrix3(r){const e=this.r,i=this.g,n=this.b,s=r.elements;return this.r=s[0]*e+s[3]*i+s[6]*n,this.g=s[1]*e+s[4]*i+s[7]*n,this.b=s[2]*e+s[5]*i+s[8]*n,this}equals(r){return r.r===this.r&&r.g===this.g&&r.b===this.b}fromArray(r,e=0){return this.r=r[e],this.g=r[e+1],this.b=r[e+2],this}toArray(r=[],e=0){return r[e]=this.r,r[e+1]=this.g,r[e+2]=this.b,r}fromBufferAttribute(r,e){return this.r=r.getX(e),this.g=r.getY(e),this.b=r.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const io=new Sn;Sn.NAMES=h4;let dZ=0,xp=class extends gp{static get type(){return"Material"}get type(){return this.constructor.type}set type(r){}constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:dZ++}),this.uuid=Bu(),this.name="",this.blending=Am,this.side=qh,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=zC,this.blendDst=jC,this.blendEquation=dp,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Sn(0,0,0),this.blendAlpha=0,this.depthFunc=ym,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=VP,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Sm,this.stencilZFail=Sm,this.stencilZPass=Sm,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(r){this._alphaTest>0!=r>0&&this.version++,this._alphaTest=r}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(r){if(r!==void 0)for(const e in r){const i=r[e];if(i===void 0){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}const n=this[e];if(n===void 0){console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`);continue}n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[e]=i}}toJSON(r){const e=r===void 0||typeof r=="string";e&&(r={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(r).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(r).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(r).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(i.dispersion=this.dispersion),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(r).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(r).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(r).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(r).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(r).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(r).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(r).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(r).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(r).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(r).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(r).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(r).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(r).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(r).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(r).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(r).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(r).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(r).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(r).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(r).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(r).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==Am&&(i.blending=this.blending),this.side!==qh&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==zC&&(i.blendSrc=this.blendSrc),this.blendDst!==jC&&(i.blendDst=this.blendDst),this.blendEquation!==dp&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==ym&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==VP&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Sm&&(i.stencilFail=this.stencilFail),this.stencilZFail!==Sm&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==Sm&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function n(s){const o=[];for(const l in s){const u=s[l];delete u.metadata,o.push(u)}return o}if(e){const s=n(r.textures),o=n(r.images);s.length>0&&(i.textures=s),o.length>0&&(i.images=o)}return i}clone(){return new this.constructor().copy(this)}copy(r){this.name=r.name,this.blending=r.blending,this.side=r.side,this.vertexColors=r.vertexColors,this.opacity=r.opacity,this.transparent=r.transparent,this.blendSrc=r.blendSrc,this.blendDst=r.blendDst,this.blendEquation=r.blendEquation,this.blendSrcAlpha=r.blendSrcAlpha,this.blendDstAlpha=r.blendDstAlpha,this.blendEquationAlpha=r.blendEquationAlpha,this.blendColor.copy(r.blendColor),this.blendAlpha=r.blendAlpha,this.depthFunc=r.depthFunc,this.depthTest=r.depthTest,this.depthWrite=r.depthWrite,this.stencilWriteMask=r.stencilWriteMask,this.stencilFunc=r.stencilFunc,this.stencilRef=r.stencilRef,this.stencilFuncMask=r.stencilFuncMask,this.stencilFail=r.stencilFail,this.stencilZFail=r.stencilZFail,this.stencilZPass=r.stencilZPass,this.stencilWrite=r.stencilWrite;const e=r.clippingPlanes;let i=null;if(e!==null){const n=e.length;i=new Array(n);for(let s=0;s!==n;++s)i[s]=e[s].clone()}return this.clippingPlanes=i,this.clipIntersection=r.clipIntersection,this.clipShadows=r.clipShadows,this.shadowSide=r.shadowSide,this.colorWrite=r.colorWrite,this.precision=r.precision,this.polygonOffset=r.polygonOffset,this.polygonOffsetFactor=r.polygonOffsetFactor,this.polygonOffsetUnits=r.polygonOffsetUnits,this.dithering=r.dithering,this.alphaTest=r.alphaTest,this.alphaHash=r.alphaHash,this.alphaToCoverage=r.alphaToCoverage,this.premultipliedAlpha=r.premultipliedAlpha,this.forceSinglePass=r.forceSinglePass,this.visible=r.visible,this.toneMapped=r.toneMapped,this.userData=JSON.parse(JSON.stringify(r.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(r){r===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}},rd=class extends xp{static get type(){return"MeshBasicMaterial"}constructor(r){super(),this.isMeshBasicMaterial=!0,this.color=new Sn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new td,this.combine=KC,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.lightMap=r.lightMap,this.lightMapIntensity=r.lightMapIntensity,this.aoMap=r.aoMap,this.aoMapIntensity=r.aoMapIntensity,this.specularMap=r.specularMap,this.alphaMap=r.alphaMap,this.envMap=r.envMap,this.envMapRotation.copy(r.envMapRotation),this.combine=r.combine,this.reflectivity=r.reflectivity,this.refractionRatio=r.refractionRatio,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.wireframeLinecap=r.wireframeLinecap,this.wireframeLinejoin=r.wireframeLinejoin,this.fog=r.fog,this}};const $s=new ot,bx=new Gi;let Go=class{constructor(r,e,i=!1){if(Array.isArray(r))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=r,this.itemSize=e,this.count=r!==void 0?r.length/e:0,this.normalized=i,this.usage=LS,this.updateRanges=[],this.gpuType=Ru,this.version=0}onUploadCallback(){}set needsUpdate(r){r===!0&&this.version++}setUsage(r){return this.usage=r,this}addUpdateRange(r,e){this.updateRanges.push({start:r,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(r){return this.name=r.name,this.array=new r.array.constructor(r.array),this.itemSize=r.itemSize,this.count=r.count,this.normalized=r.normalized,this.usage=r.usage,this.gpuType=r.gpuType,this}copyAt(r,e,i){r*=this.itemSize,i*=e.itemSize;for(let n=0,s=this.itemSize;n<s;n++)this.array[r+n]=e.array[i+n];return this}copyArray(r){return this.array.set(r),this}applyMatrix3(r){if(this.itemSize===2)for(let e=0,i=this.count;e<i;e++)bx.fromBufferAttribute(this,e),bx.applyMatrix3(r),this.setXY(e,bx.x,bx.y);else if(this.itemSize===3)for(let e=0,i=this.count;e<i;e++)$s.fromBufferAttribute(this,e),$s.applyMatrix3(r),this.setXYZ(e,$s.x,$s.y,$s.z);return this}applyMatrix4(r){for(let e=0,i=this.count;e<i;e++)$s.fromBufferAttribute(this,e),$s.applyMatrix4(r),this.setXYZ(e,$s.x,$s.y,$s.z);return this}applyNormalMatrix(r){for(let e=0,i=this.count;e<i;e++)$s.fromBufferAttribute(this,e),$s.applyNormalMatrix(r),this.setXYZ(e,$s.x,$s.y,$s.z);return this}transformDirection(r){for(let e=0,i=this.count;e<i;e++)$s.fromBufferAttribute(this,e),$s.transformDirection(r),this.setXYZ(e,$s.x,$s.y,$s.z);return this}set(r,e=0){return this.array.set(r,e),this}getComponent(r,e){let i=this.array[r*this.itemSize+e];return this.normalized&&(i=ac(i,this.array)),i}setComponent(r,e,i){return this.normalized&&(i=rs(i,this.array)),this.array[r*this.itemSize+e]=i,this}getX(r){let e=this.array[r*this.itemSize];return this.normalized&&(e=ac(e,this.array)),e}setX(r,e){return this.normalized&&(e=rs(e,this.array)),this.array[r*this.itemSize]=e,this}getY(r){let e=this.array[r*this.itemSize+1];return this.normalized&&(e=ac(e,this.array)),e}setY(r,e){return this.normalized&&(e=rs(e,this.array)),this.array[r*this.itemSize+1]=e,this}getZ(r){let e=this.array[r*this.itemSize+2];return this.normalized&&(e=ac(e,this.array)),e}setZ(r,e){return this.normalized&&(e=rs(e,this.array)),this.array[r*this.itemSize+2]=e,this}getW(r){let e=this.array[r*this.itemSize+3];return this.normalized&&(e=ac(e,this.array)),e}setW(r,e){return this.normalized&&(e=rs(e,this.array)),this.array[r*this.itemSize+3]=e,this}setXY(r,e,i){return r*=this.itemSize,this.normalized&&(e=rs(e,this.array),i=rs(i,this.array)),this.array[r+0]=e,this.array[r+1]=i,this}setXYZ(r,e,i,n){return r*=this.itemSize,this.normalized&&(e=rs(e,this.array),i=rs(i,this.array),n=rs(n,this.array)),this.array[r+0]=e,this.array[r+1]=i,this.array[r+2]=n,this}setXYZW(r,e,i,n,s){return r*=this.itemSize,this.normalized&&(e=rs(e,this.array),i=rs(i,this.array),n=rs(n,this.array),s=rs(s,this.array)),this.array[r+0]=e,this.array[r+1]=i,this.array[r+2]=n,this.array[r+3]=s,this}onUpload(r){return this.onUploadCallback=r,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const r={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(r.name=this.name),this.usage!==LS&&(r.usage=this.usage),r}},d4=class extends Go{constructor(r,e,i){super(new Uint16Array(r),e,i)}},p4=class extends Go{constructor(r,e,i){super(new Uint32Array(r),e,i)}},pa=class extends Go{constructor(r,e,i){super(new Float32Array(r),e,i)}},pZ=0;const Pl=new gs,eT=new to,km=new ot,pl=new Ap,SA=new Ap,Ma=new ot;let Vo=class iW extends gp{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:pZ++}),this.uuid=Bu(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(qP(e)?p4:d4)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,i){return this.attributes[e]=i,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,i,n=0){this.groups.push({start:e,count:i,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,i){this.drawRange.start=e,this.drawRange.count=i}applyMatrix4(e){const i=this.attributes.position;i!==void 0&&(i.applyMatrix4(e),i.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const o=new mn().getNormalMatrix(e);n.applyNormalMatrix(o),n.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(e),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Pl.makeRotationFromQuaternion(e),this.applyMatrix4(Pl),this}rotateX(e){return Pl.makeRotationX(e),this.applyMatrix4(Pl),this}rotateY(e){return Pl.makeRotationY(e),this.applyMatrix4(Pl),this}rotateZ(e){return Pl.makeRotationZ(e),this.applyMatrix4(Pl),this}translate(e,i,n){return Pl.makeTranslation(e,i,n),this.applyMatrix4(Pl),this}scale(e,i,n){return Pl.makeScale(e,i,n),this.applyMatrix4(Pl),this}lookAt(e){return eT.lookAt(e),eT.updateMatrix(),this.applyMatrix4(eT.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(km).negate(),this.translate(km.x,km.y,km.z),this}setFromPoints(e){const i=this.getAttribute("position");if(i===void 0){const n=[];for(let s=0,o=e.length;s<o;s++){const l=e[s];n.push(l.x,l.y,l.z||0)}this.setAttribute("position",new pa(n,3))}else{for(let n=0,s=i.count;n<s;n++){const o=e[n];i.setXYZ(n,o.x,o.y,o.z||0)}e.length>i.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),i.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ap);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new ot(-1/0,-1/0,-1/0),new ot(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),i)for(let n=0,s=i.length;n<s;n++){const o=i[n];pl.setFromBufferAttribute(o),this.morphTargetsRelative?(Ma.addVectors(this.boundingBox.min,pl.min),this.boundingBox.expandByPoint(Ma),Ma.addVectors(this.boundingBox.max,pl.max),this.boundingBox.expandByPoint(Ma)):(this.boundingBox.expandByPoint(pl.min),this.boundingBox.expandByPoint(pl.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new px);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new ot,1/0);return}if(e){const n=this.boundingSphere.center;if(pl.setFromBufferAttribute(e),i)for(let o=0,l=i.length;o<l;o++){const u=i[o];SA.setFromBufferAttribute(u),this.morphTargetsRelative?(Ma.addVectors(pl.min,SA.min),pl.expandByPoint(Ma),Ma.addVectors(pl.max,SA.max),pl.expandByPoint(Ma)):(pl.expandByPoint(SA.min),pl.expandByPoint(SA.max))}pl.getCenter(n);let s=0;for(let o=0,l=e.count;o<l;o++)Ma.fromBufferAttribute(e,o),s=Math.max(s,n.distanceToSquared(Ma));if(i)for(let o=0,l=i.length;o<l;o++){const u=i[o],c=this.morphTargetsRelative;for(let h=0,p=u.count;h<p;h++)Ma.fromBufferAttribute(u,h),c&&(km.fromBufferAttribute(e,h),Ma.add(km)),s=Math.max(s,n.distanceToSquared(Ma))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,i=this.attributes;if(e===null||i.position===void 0||i.normal===void 0||i.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=i.position,s=i.normal,o=i.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Go(new Float32Array(4*n.count),4));const l=this.getAttribute("tangent"),u=[],c=[];for(let D=0;D<n.count;D++)u[D]=new ot,c[D]=new ot;const h=new ot,p=new ot,f=new ot,g=new Gi,m=new Gi,y=new Gi,b=new ot,v=new ot;function _(D,L,O){h.fromBufferAttribute(n,D),p.fromBufferAttribute(n,L),f.fromBufferAttribute(n,O),g.fromBufferAttribute(o,D),m.fromBufferAttribute(o,L),y.fromBufferAttribute(o,O),p.sub(h),f.sub(h),m.sub(g),y.sub(g);const F=1/(m.x*y.y-y.x*m.y);isFinite(F)&&(b.copy(p).multiplyScalar(y.y).addScaledVector(f,-m.y).multiplyScalar(F),v.copy(f).multiplyScalar(m.x).addScaledVector(p,-y.x).multiplyScalar(F),u[D].add(b),u[L].add(b),u[O].add(b),c[D].add(v),c[L].add(v),c[O].add(v))}let C=this.groups;C.length===0&&(C=[{start:0,count:e.count}]);for(let D=0,L=C.length;D<L;++D){const O=C[D],F=O.start,q=O.count;for(let H=F,G=F+q;H<G;H+=3)_(e.getX(H+0),e.getX(H+1),e.getX(H+2))}const E=new ot,T=new ot,R=new ot,B=new ot;function I(D){R.fromBufferAttribute(s,D),B.copy(R);const L=u[D];E.copy(L),E.sub(R.multiplyScalar(R.dot(L))).normalize(),T.crossVectors(B,L);const O=T.dot(c[D])<0?-1:1;l.setXYZW(D,E.x,E.y,E.z,O)}for(let D=0,L=C.length;D<L;++D){const O=C[D],F=O.start,q=O.count;for(let H=F,G=F+q;H<G;H+=3)I(e.getX(H+0)),I(e.getX(H+1)),I(e.getX(H+2))}}computeVertexNormals(){const e=this.index,i=this.getAttribute("position");if(i!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new Go(new Float32Array(i.count*3),3),this.setAttribute("normal",n);else for(let g=0,m=n.count;g<m;g++)n.setXYZ(g,0,0,0);const s=new ot,o=new ot,l=new ot,u=new ot,c=new ot,h=new ot,p=new ot,f=new ot;if(e)for(let g=0,m=e.count;g<m;g+=3){const y=e.getX(g+0),b=e.getX(g+1),v=e.getX(g+2);s.fromBufferAttribute(i,y),o.fromBufferAttribute(i,b),l.fromBufferAttribute(i,v),p.subVectors(l,o),f.subVectors(s,o),p.cross(f),u.fromBufferAttribute(n,y),c.fromBufferAttribute(n,b),h.fromBufferAttribute(n,v),u.add(p),c.add(p),h.add(p),n.setXYZ(y,u.x,u.y,u.z),n.setXYZ(b,c.x,c.y,c.z),n.setXYZ(v,h.x,h.y,h.z)}else for(let g=0,m=i.count;g<m;g+=3)s.fromBufferAttribute(i,g+0),o.fromBufferAttribute(i,g+1),l.fromBufferAttribute(i,g+2),p.subVectors(l,o),f.subVectors(s,o),p.cross(f),n.setXYZ(g+0,p.x,p.y,p.z),n.setXYZ(g+1,p.x,p.y,p.z),n.setXYZ(g+2,p.x,p.y,p.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let i=0,n=e.count;i<n;i++)Ma.fromBufferAttribute(e,i),Ma.normalize(),e.setXYZ(i,Ma.x,Ma.y,Ma.z)}toNonIndexed(){function e(u,c){const h=u.array,p=u.itemSize,f=u.normalized,g=new h.constructor(c.length*p);let m=0,y=0;for(let b=0,v=c.length;b<v;b++){u.isInterleavedBufferAttribute?m=c[b]*u.data.stride+u.offset:m=c[b]*p;for(let _=0;_<p;_++)g[y++]=h[m++]}return new Go(g,p,f)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const i=new iW,n=this.index.array,s=this.attributes;for(const u in s){const c=s[u],h=e(c,n);i.setAttribute(u,h)}const o=this.morphAttributes;for(const u in o){const c=[],h=o[u];for(let p=0,f=h.length;p<f;p++){const g=h[p],m=e(g,n);c.push(m)}i.morphAttributes[u]=c}i.morphTargetsRelative=this.morphTargetsRelative;const l=this.groups;for(let u=0,c=l.length;u<c;u++){const h=l[u];i.addGroup(h.start,h.count,h.materialIndex)}return i}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const h in c)c[h]!==void 0&&(e[h]=c[h]);return e}e.data={attributes:{}};const i=this.index;i!==null&&(e.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});const n=this.attributes;for(const c in n){const h=n[c];e.data.attributes[c]=h.toJSON(e.data)}const s={};let o=!1;for(const c in this.morphAttributes){const h=this.morphAttributes[c],p=[];for(let f=0,g=h.length;f<g;f++){const m=h[f];p.push(m.toJSON(e.data))}p.length>0&&(s[c]=p,o=!0)}o&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);const l=this.groups;l.length>0&&(e.data.groups=JSON.parse(JSON.stringify(l)));const u=this.boundingSphere;return u!==null&&(e.data.boundingSphere={center:u.center.toArray(),radius:u.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const i={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone(i));const s=e.attributes;for(const h in s){const p=s[h];this.setAttribute(h,p.clone(i))}const o=e.morphAttributes;for(const h in o){const p=[],f=o[h];for(let g=0,m=f.length;g<m;g++)p.push(f[g].clone(i));this.morphAttributes[h]=p}this.morphTargetsRelative=e.morphTargetsRelative;const l=e.groups;for(let h=0,p=l.length;h<p;h++){const f=l[h];this.addGroup(f.start,f.count,f.materialIndex)}const u=e.boundingBox;u!==null&&(this.boundingBox=u.clone());const c=e.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}};const f4=new gs,_p=new gx,xx=new px,m4=new ot,_x=new ot,Ex=new ot,wx=new ot,tT=new ot,Cx=new ot,g4=new ot,Sx=new ot;let za=class extends to{constructor(r=new Vo,e=new rd){super(),this.isMesh=!0,this.type="Mesh",this.geometry=r,this.material=e,this.updateMorphTargets()}copy(r,e){return super.copy(r,e),r.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=r.morphTargetInfluences.slice()),r.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},r.morphTargetDictionary)),this.material=Array.isArray(r.material)?r.material.slice():r.material,this.geometry=r.geometry,this}updateMorphTargets(){const r=this.geometry.morphAttributes,e=Object.keys(r);if(e.length>0){const i=r[e[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let n=0,s=i.length;n<s;n++){const o=i[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=n}}}}getVertexPosition(r,e){const i=this.geometry,n=i.attributes.position,s=i.morphAttributes.position,o=i.morphTargetsRelative;e.fromBufferAttribute(n,r);const l=this.morphTargetInfluences;if(s&&l){Cx.set(0,0,0);for(let u=0,c=s.length;u<c;u++){const h=l[u],p=s[u];h!==0&&(tT.fromBufferAttribute(p,r),o?Cx.addScaledVector(tT,h):Cx.addScaledVector(tT.sub(e),h))}e.add(Cx)}return e}raycast(r,e){const i=this.geometry,n=this.material,s=this.matrixWorld;n!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),xx.copy(i.boundingSphere),xx.applyMatrix4(s),_p.copy(r.ray).recast(r.near),!(xx.containsPoint(_p.origin)===!1&&(_p.intersectSphere(xx,m4)===null||_p.origin.distanceToSquared(m4)>(r.far-r.near)**2))&&(f4.copy(s).invert(),_p.copy(r.ray).applyMatrix4(f4),!(i.boundingBox!==null&&_p.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(r,e,_p)))}_computeIntersections(r,e,i){let n;const s=this.geometry,o=this.material,l=s.index,u=s.attributes.position,c=s.attributes.uv,h=s.attributes.uv1,p=s.attributes.normal,f=s.groups,g=s.drawRange;if(l!==null)if(Array.isArray(o))for(let m=0,y=f.length;m<y;m++){const b=f[m],v=o[b.materialIndex],_=Math.max(b.start,g.start),C=Math.min(l.count,Math.min(b.start+b.count,g.start+g.count));for(let E=_,T=C;E<T;E+=3){const R=l.getX(E),B=l.getX(E+1),I=l.getX(E+2);n=Tx(this,v,r,i,c,h,p,R,B,I),n&&(n.faceIndex=Math.floor(E/3),n.face.materialIndex=b.materialIndex,e.push(n))}}else{const m=Math.max(0,g.start),y=Math.min(l.count,g.start+g.count);for(let b=m,v=y;b<v;b+=3){const _=l.getX(b),C=l.getX(b+1),E=l.getX(b+2);n=Tx(this,o,r,i,c,h,p,_,C,E),n&&(n.faceIndex=Math.floor(b/3),e.push(n))}}else if(u!==void 0)if(Array.isArray(o))for(let m=0,y=f.length;m<y;m++){const b=f[m],v=o[b.materialIndex],_=Math.max(b.start,g.start),C=Math.min(u.count,Math.min(b.start+b.count,g.start+g.count));for(let E=_,T=C;E<T;E+=3){const R=E,B=E+1,I=E+2;n=Tx(this,v,r,i,c,h,p,R,B,I),n&&(n.faceIndex=Math.floor(E/3),n.face.materialIndex=b.materialIndex,e.push(n))}}else{const m=Math.max(0,g.start),y=Math.min(u.count,g.start+g.count);for(let b=m,v=y;b<v;b+=3){const _=b,C=b+1,E=b+2;n=Tx(this,o,r,i,c,h,p,_,C,E),n&&(n.faceIndex=Math.floor(b/3),e.push(n))}}}};function fZ(r,e,i,n,s,o,l,u){let c;if(e.side===bo?c=n.intersectTriangle(l,o,s,!0,u):c=n.intersectTriangle(s,o,l,e.side===qh,u),c===null)return null;Sx.copy(u),Sx.applyMatrix4(r.matrixWorld);const h=i.ray.origin.distanceTo(Sx);return h<i.near||h>i.far?null:{distance:h,point:Sx.clone(),object:r}}function Tx(r,e,i,n,s,o,l,u,c,h){r.getVertexPosition(u,_x),r.getVertexPosition(c,Ex),r.getVertexPosition(h,wx);const p=fZ(r,e,i,n,_x,Ex,wx,g4);if(p){const f=new ot;bp.getBarycoord(g4,_x,Ex,wx,f),s&&(p.uv=bp.getInterpolatedAttribute(s,u,c,h,f,new Gi)),o&&(p.uv1=bp.getInterpolatedAttribute(o,u,c,h,f,new Gi)),l&&(p.normal=bp.getInterpolatedAttribute(l,u,c,h,f,new ot),p.normal.dot(n.direction)>0&&p.normal.multiplyScalar(-1));const g={a:u,b:c,c:h,normal:new ot,materialIndex:0};bp.getNormal(_x,Ex,wx,g.normal),p.face=g,p.barycoord=f}return p}let Fm=class rW extends Vo{constructor(e=1,i=1,n=1,s=1,o=1,l=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:i,depth:n,widthSegments:s,heightSegments:o,depthSegments:l};const u=this;s=Math.floor(s),o=Math.floor(o),l=Math.floor(l);const c=[],h=[],p=[],f=[];let g=0,m=0;y("z","y","x",-1,-1,n,i,e,l,o,0),y("z","y","x",1,-1,n,i,-e,l,o,1),y("x","z","y",1,1,e,n,i,s,l,2),y("x","z","y",1,-1,e,n,-i,s,l,3),y("x","y","z",1,-1,e,i,n,s,o,4),y("x","y","z",-1,-1,e,i,-n,s,o,5),this.setIndex(c),this.setAttribute("position",new pa(h,3)),this.setAttribute("normal",new pa(p,3)),this.setAttribute("uv",new pa(f,2));function y(b,v,_,C,E,T,R,B,I,D,L){const O=T/I,F=R/D,q=T/2,H=R/2,G=B/2,J=I+1,Q=D+1;let V=0,z=0;const te=new ot;for(let K=0;K<Q;K++){const ae=K*F-H;for(let Ae=0;Ae<J;Ae++){const _e=Ae*O-q;te[b]=_e*C,te[v]=ae*E,te[_]=G,h.push(te.x,te.y,te.z),te[b]=0,te[v]=0,te[_]=B>0?1:-1,p.push(te.x,te.y,te.z),f.push(Ae/I),f.push(1-K/D),V+=1}}for(let K=0;K<D;K++)for(let ae=0;ae<I;ae++){const Ae=g+ae+J*K,_e=g+ae+J*(K+1),me=g+(ae+1)+J*(K+1),Pe=g+(ae+1)+J*K;c.push(Ae,_e,Pe),c.push(_e,me,Pe),z+=6}u.addGroup(m,z,L),m+=z,g+=V}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new rW(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}};function Um(r){const e={};for(const i in r){e[i]={};for(const n in r[i]){const s=r[i][n];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[i][n]=null):e[i][n]=s.clone():Array.isArray(s)?e[i][n]=s.slice():e[i][n]=s}}return e}function xo(r){const e={};for(let i=0;i<r.length;i++){const n=Um(r[i]);for(const s in n)e[s]=n[s]}return e}function mZ(r){const e=[];for(let i=0;i<r.length;i++)e.push(r[i].clone());return e}function A4(r){const e=r.getRenderTarget();return e===null?r.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:Fn.workingColorSpace}const y4={clone:Um,merge:xo};var gZ=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,AZ=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;let Wc=class extends xp{static get type(){return"ShaderMaterial"}constructor(r){super(),this.isShaderMaterial=!0,this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=gZ,this.fragmentShader=AZ,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,r!==void 0&&this.setValues(r)}copy(r){return super.copy(r),this.fragmentShader=r.fragmentShader,this.vertexShader=r.vertexShader,this.uniforms=Um(r.uniforms),this.uniformsGroups=mZ(r.uniformsGroups),this.defines=Object.assign({},r.defines),this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.fog=r.fog,this.lights=r.lights,this.clipping=r.clipping,this.extensions=Object.assign({},r.extensions),this.glslVersion=r.glslVersion,this}toJSON(r){const e=super.toJSON(r);e.glslVersion=this.glslVersion,e.uniforms={};for(const n in this.uniforms){const s=this.uniforms[n].value;s&&s.isTexture?e.uniforms[n]={type:"t",value:s.toJSON(r).uuid}:s&&s.isColor?e.uniforms[n]={type:"c",value:s.getHex()}:s&&s.isVector2?e.uniforms[n]={type:"v2",value:s.toArray()}:s&&s.isVector3?e.uniforms[n]={type:"v3",value:s.toArray()}:s&&s.isVector4?e.uniforms[n]={type:"v4",value:s.toArray()}:s&&s.isMatrix3?e.uniforms[n]={type:"m3",value:s.toArray()}:s&&s.isMatrix4?e.uniforms[n]={type:"m4",value:s.toArray()}:e.uniforms[n]={value:s}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.lights=this.lights,e.clipping=this.clipping;const i={};for(const n in this.extensions)this.extensions[n]===!0&&(i[n]=!0);return Object.keys(i).length>0&&(e.extensions=i),e}},v4=class extends to{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new gs,this.projectionMatrix=new gs,this.projectionMatrixInverse=new gs,this.coordinateSystem=Iu}copy(r,e){return super.copy(r,e),this.matrixWorldInverse.copy(r.matrixWorldInverse),this.projectionMatrix.copy(r.projectionMatrix),this.projectionMatrixInverse.copy(r.projectionMatrixInverse),this.coordinateSystem=r.coordinateSystem,this}getWorldDirection(r){return super.getWorldDirection(r).negate()}updateMatrixWorld(r){super.updateMatrixWorld(r),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(r,e){super.updateWorldMatrix(r,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}};const nd=new ot,b4=new Gi,x4=new Gi;let kl=class extends v4{constructor(r=50,e=1,i=.1,n=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=r,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(r,e){return super.copy(r,e),this.fov=r.fov,this.zoom=r.zoom,this.near=r.near,this.far=r.far,this.focus=r.focus,this.aspect=r.aspect,this.view=r.view===null?null:Object.assign({},r.view),this.filmGauge=r.filmGauge,this.filmOffset=r.filmOffset,this}setFocalLength(r){const e=.5*this.getFilmHeight()/r;this.fov=vA*2*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const r=Math.tan(yA*.5*this.fov);return .5*this.getFilmHeight()/r}getEffectiveFOV(){return vA*2*Math.atan(Math.tan(yA*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(r,e,i){nd.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),e.set(nd.x,nd.y).multiplyScalar(-r/nd.z),nd.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(nd.x,nd.y).multiplyScalar(-r/nd.z)}getViewSize(r,e){return this.getViewBounds(r,b4,x4),e.subVectors(x4,b4)}setViewOffset(r,e,i,n,s,o){this.aspect=r/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=r,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const r=this.near;let e=r*Math.tan(yA*.5*this.fov)/this.zoom,i=2*e,n=this.aspect*i,s=-.5*n;const o=this.view;if(this.view!==null&&this.view.enabled){const u=o.fullWidth,c=o.fullHeight;s+=o.offsetX*n/u,e-=o.offsetY*i/c,n*=o.width/u,i*=o.height/c}const l=this.filmOffset;l!==0&&(s+=r*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+n,e,e-i,r,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(r){const e=super.toJSON(r);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}};const zm=-90,jm=1;let yZ=class extends to{constructor(r,e,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const n=new kl(zm,jm,r,e);n.layers=this.layers,this.add(n);const s=new kl(zm,jm,r,e);s.layers=this.layers,this.add(s);const o=new kl(zm,jm,r,e);o.layers=this.layers,this.add(o);const l=new kl(zm,jm,r,e);l.layers=this.layers,this.add(l);const u=new kl(zm,jm,r,e);u.layers=this.layers,this.add(u);const c=new kl(zm,jm,r,e);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const r=this.coordinateSystem,e=this.children.concat(),[i,n,s,o,l,u]=e;for(const c of e)this.remove(c);if(r===Iu)i.up.set(0,1,0),i.lookAt(1,0,0),n.up.set(0,1,0),n.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),l.up.set(0,1,0),l.lookAt(0,0,1),u.up.set(0,1,0),u.lookAt(0,0,-1);else if(r===cx)i.up.set(0,-1,0),i.lookAt(-1,0,0),n.up.set(0,-1,0),n.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),l.up.set(0,-1,0),l.lookAt(0,0,1),u.up.set(0,-1,0),u.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+r);for(const c of e)this.add(c),c.updateMatrixWorld()}update(r,e){this.parent===null&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:n}=this;this.coordinateSystem!==r.coordinateSystem&&(this.coordinateSystem=r.coordinateSystem,this.updateCoordinateSystem());const[s,o,l,u,c,h]=this.children,p=r.getRenderTarget(),f=r.getActiveCubeFace(),g=r.getActiveMipmapLevel(),m=r.xr.enabled;r.xr.enabled=!1;const y=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,r.setRenderTarget(i,0,n),r.render(e,s),r.setRenderTarget(i,1,n),r.render(e,o),r.setRenderTarget(i,2,n),r.render(e,l),r.setRenderTarget(i,3,n),r.render(e,u),r.setRenderTarget(i,4,n),r.render(e,c),i.texture.generateMipmaps=y,r.setRenderTarget(i,5,n),r.render(e,h),r.setRenderTarget(p,f,g),r.xr.enabled=m,i.texture.needsPMREMUpdate=!0}},_4=class extends Ol{constructor(r,e,i,n,s,o,l,u,c,h){r=r!==void 0?r:[],e=e!==void 0?e:vm,super(r,e,i,n,s,o,l,u,c,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(r){this.image=r}},vZ=class extends Yh{constructor(r=1,e={}){super(r,r,e),this.isWebGLCubeRenderTarget=!0;const i={width:r,height:r,depth:1},n=[i,i,i,i,i,i];this.texture=new _4(n,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=e.generateMipmaps!==void 0?e.generateMipmaps:!1,this.texture.minFilter=e.minFilter!==void 0?e.minFilter:Vc}fromEquirectangularTexture(r,e){this.texture.type=e.type,this.texture.colorSpace=e.colorSpace,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},n=new Fm(5,5,5),s=new Wc({name:"CubemapFromEquirect",uniforms:Um(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:bo,blending:Tu});s.uniforms.tEquirect.value=e;const o=new za(n,s),l=e.minFilter;return e.minFilter===fp&&(e.minFilter=Vc),new yZ(1,10,this).update(r,o),e.minFilter=l,o.geometry.dispose(),o.material.dispose(),this}clear(r,e,i,n){const s=r.getRenderTarget();for(let o=0;o<6;o++)r.setRenderTarget(this,o),r.clear(e,i,n);r.setRenderTarget(s)}};const iT=new ot,bZ=new ot,xZ=new mn;let uc=class{constructor(r=new ot(1,0,0),e=0){this.isPlane=!0,this.normal=r,this.constant=e}set(r,e){return this.normal.copy(r),this.constant=e,this}setComponents(r,e,i,n){return this.normal.set(r,e,i),this.constant=n,this}setFromNormalAndCoplanarPoint(r,e){return this.normal.copy(r),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(r,e,i){const n=iT.subVectors(i,e).cross(bZ.subVectors(r,e)).normalize();return this.setFromNormalAndCoplanarPoint(n,r),this}copy(r){return this.normal.copy(r.normal),this.constant=r.constant,this}normalize(){const r=1/this.normal.length();return this.normal.multiplyScalar(r),this.constant*=r,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(r){return this.normal.dot(r)+this.constant}distanceToSphere(r){return this.distanceToPoint(r.center)-r.radius}projectPoint(r,e){return e.copy(r).addScaledVector(this.normal,-this.distanceToPoint(r))}intersectLine(r,e){const i=r.delta(iT),n=this.normal.dot(i);if(n===0)return this.distanceToPoint(r.start)===0?e.copy(r.start):null;const s=-(r.start.dot(this.normal)+this.constant)/n;return s<0||s>1?null:e.copy(r.start).addScaledVector(i,s)}intersectsLine(r){const e=this.distanceToPoint(r.start),i=this.distanceToPoint(r.end);return e<0&&i>0||i<0&&e>0}intersectsBox(r){return r.intersectsPlane(this)}intersectsSphere(r){return r.intersectsPlane(this)}coplanarPoint(r){return r.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(r,e){const i=e||xZ.getNormalMatrix(r),n=this.coplanarPoint(iT).applyMatrix4(r),s=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(s),this}translate(r){return this.constant-=r.dot(this.normal),this}equals(r){return r.normal.equals(this.normal)&&r.constant===this.constant}clone(){return new this.constructor().copy(this)}};const Ep=new px,Mx=new ot;let rT=class{constructor(r=new uc,e=new uc,i=new uc,n=new uc,s=new uc,o=new uc){this.planes=[r,e,i,n,s,o]}set(r,e,i,n,s,o){const l=this.planes;return l[0].copy(r),l[1].copy(e),l[2].copy(i),l[3].copy(n),l[4].copy(s),l[5].copy(o),this}copy(r){const e=this.planes;for(let i=0;i<6;i++)e[i].copy(r.planes[i]);return this}setFromProjectionMatrix(r,e=Iu){const i=this.planes,n=r.elements,s=n[0],o=n[1],l=n[2],u=n[3],c=n[4],h=n[5],p=n[6],f=n[7],g=n[8],m=n[9],y=n[10],b=n[11],v=n[12],_=n[13],C=n[14],E=n[15];if(i[0].setComponents(u-s,f-c,b-g,E-v).normalize(),i[1].setComponents(u+s,f+c,b+g,E+v).normalize(),i[2].setComponents(u+o,f+h,b+m,E+_).normalize(),i[3].setComponents(u-o,f-h,b-m,E-_).normalize(),i[4].setComponents(u-l,f-p,b-y,E-C).normalize(),e===Iu)i[5].setComponents(u+l,f+p,b+y,E+C).normalize();else if(e===cx)i[5].setComponents(l,p,y,C).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);return this}intersectsObject(r){if(r.boundingSphere!==void 0)r.boundingSphere===null&&r.computeBoundingSphere(),Ep.copy(r.boundingSphere).applyMatrix4(r.matrixWorld);else{const e=r.geometry;e.boundingSphere===null&&e.computeBoundingSphere(),Ep.copy(e.boundingSphere).applyMatrix4(r.matrixWorld)}return this.intersectsSphere(Ep)}intersectsSprite(r){return Ep.center.set(0,0,0),Ep.radius=.7071067811865476,Ep.applyMatrix4(r.matrixWorld),this.intersectsSphere(Ep)}intersectsSphere(r){const e=this.planes,i=r.center,n=-r.radius;for(let s=0;s<6;s++)if(e[s].distanceToPoint(i)<n)return!1;return!0}intersectsBox(r){const e=this.planes;for(let i=0;i<6;i++){const n=e[i];if(Mx.x=n.normal.x>0?r.max.x:r.min.x,Mx.y=n.normal.y>0?r.max.y:r.min.y,Mx.z=n.normal.z>0?r.max.z:r.min.z,n.distanceToPoint(Mx)<0)return!1}return!0}containsPoint(r){const e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(r)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};function E4(){let r=null,e=!1,i=null,n=null;function s(o,l){i(o,l),n=r.requestAnimationFrame(s)}return{start:function(){e!==!0&&i!==null&&(n=r.requestAnimationFrame(s),e=!0)},stop:function(){r.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(o){i=o},setContext:function(o){r=o}}}function _Z(r){const e=new WeakMap;function i(u,c){const h=u.array,p=u.usage,f=h.byteLength,g=r.createBuffer();r.bindBuffer(c,g),r.bufferData(c,h,p),u.onUploadCallback();let m;if(h instanceof Float32Array)m=r.FLOAT;else if(h instanceof Uint16Array)u.isFloat16BufferAttribute?m=r.HALF_FLOAT:m=r.UNSIGNED_SHORT;else if(h instanceof Int16Array)m=r.SHORT;else if(h instanceof Uint32Array)m=r.UNSIGNED_INT;else if(h instanceof Int32Array)m=r.INT;else if(h instanceof Int8Array)m=r.BYTE;else if(h instanceof Uint8Array)m=r.UNSIGNED_BYTE;else if(h instanceof Uint8ClampedArray)m=r.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+h);return{buffer:g,type:m,bytesPerElement:h.BYTES_PER_ELEMENT,version:u.version,size:f}}function n(u,c,h){const p=c.array,f=c.updateRanges;if(r.bindBuffer(h,u),f.length===0)r.bufferSubData(h,0,p);else{f.sort((m,y)=>m.start-y.start);let g=0;for(let m=1;m<f.length;m++){const y=f[g],b=f[m];b.start<=y.start+y.count+1?y.count=Math.max(y.count,b.start+b.count-y.start):(++g,f[g]=b)}f.length=g+1;for(let m=0,y=f.length;m<y;m++){const b=f[m];r.bufferSubData(h,b.start*p.BYTES_PER_ELEMENT,p,b.start,b.count)}c.clearUpdateRanges()}c.onUploadCallback()}function s(u){return u.isInterleavedBufferAttribute&&(u=u.data),e.get(u)}function o(u){u.isInterleavedBufferAttribute&&(u=u.data);const c=e.get(u);c&&(r.deleteBuffer(c.buffer),e.delete(u))}function l(u,c){if(u.isInterleavedBufferAttribute&&(u=u.data),u.isGLBufferAttribute){const p=e.get(u);(!p||p.version<u.version)&&e.set(u,{buffer:u.buffer,type:u.type,bytesPerElement:u.elementSize,version:u.version});return}const h=e.get(u);if(h===void 0)e.set(u,i(u,c));else if(h.version<u.version){if(h.size!==u.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");n(h.buffer,u,c),h.version=u.version}}return{get:s,remove:o,update:l}}class Rx extends Vo{constructor(e=1,i=1,n=1,s=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:i,widthSegments:n,heightSegments:s};const o=e/2,l=i/2,u=Math.floor(n),c=Math.floor(s),h=u+1,p=c+1,f=e/u,g=i/c,m=[],y=[],b=[],v=[];for(let _=0;_<p;_++){const C=_*g-l;for(let E=0;E<h;E++){const T=E*f-o;y.push(T,-C,0),b.push(0,0,1),v.push(E/u),v.push(1-_/c)}}for(let _=0;_<c;_++)for(let C=0;C<u;C++){const E=C+h*_,T=C+h*(_+1),R=C+1+h*(_+1),B=C+1+h*_;m.push(E,T,B),m.push(T,R,B)}this.setIndex(m),this.setAttribute("position",new pa(y,3)),this.setAttribute("normal",new pa(b,3)),this.setAttribute("uv",new pa(v,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Rx(e.width,e.height,e.widthSegments,e.heightSegments)}}var EZ=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,wZ=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,CZ=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,SZ=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,TZ=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,MZ=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,RZ=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,IZ=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,BZ=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,NZ=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,LZ=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,DZ=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,OZ=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,PZ=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,kZ=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,FZ=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,UZ=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,zZ=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,jZ=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,GZ=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,VZ=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,HZ=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,WZ=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,QZ=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,qZ=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,XZ=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,KZ=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,YZ=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,JZ=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,ZZ=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,$Z="gl_FragColor = linearToOutputTexel( gl_FragColor );",e$=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,t$=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,i$=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,r$=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,n$=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,s$=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,a$=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,o$=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,l$=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,c$=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,u$=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,h$=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,d$=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,p$=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,f$=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,m$=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,g$=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,A$=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,y$=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,v$=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,b$=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,x$=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,_$=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,E$=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,w$=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,C$=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,S$=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,T$=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,M$=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,R$=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,I$=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,B$=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,N$=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,L$=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,D$=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,O$=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,P$=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,k$=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,F$=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,U$=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,z$=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,j$=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,G$=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,V$=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,H$=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,W$=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,Q$=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,q$=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,X$=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,K$=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,Y$=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,J$=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,Z$=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,$$=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,eee=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,tee=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,iee=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,ree=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,nee=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,see=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,aee=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,oee=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,lee=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,cee=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,uee=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,hee=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,dee=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,pee=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,fee=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,mee=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,gee=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,Aee=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
		
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
		
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		
		#else
		
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,yee=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,vee=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,bee=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,xee=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const _ee=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,Eee=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,wee=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Cee=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,See=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Tee=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Mee=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,Ree=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,Iee=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,Bee=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,Nee=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,Lee=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Dee=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Oee=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Pee=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,kee=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Fee=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Uee=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,zee=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,jee=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Gee=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,Vee=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,Hee=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Wee=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Qee=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,qee=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Xee=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Kee=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Yee=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,Jee=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Zee=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,$ee=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,ete=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,tte=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,un={alphahash_fragment:EZ,alphahash_pars_fragment:wZ,alphamap_fragment:CZ,alphamap_pars_fragment:SZ,alphatest_fragment:TZ,alphatest_pars_fragment:MZ,aomap_fragment:RZ,aomap_pars_fragment:IZ,batching_pars_vertex:BZ,batching_vertex:NZ,begin_vertex:LZ,beginnormal_vertex:DZ,bsdfs:OZ,iridescence_fragment:PZ,bumpmap_pars_fragment:kZ,clipping_planes_fragment:FZ,clipping_planes_pars_fragment:UZ,clipping_planes_pars_vertex:zZ,clipping_planes_vertex:jZ,color_fragment:GZ,color_pars_fragment:VZ,color_pars_vertex:HZ,color_vertex:WZ,common:QZ,cube_uv_reflection_fragment:qZ,defaultnormal_vertex:XZ,displacementmap_pars_vertex:KZ,displacementmap_vertex:YZ,emissivemap_fragment:JZ,emissivemap_pars_fragment:ZZ,colorspace_fragment:$Z,colorspace_pars_fragment:e$,envmap_fragment:t$,envmap_common_pars_fragment:i$,envmap_pars_fragment:r$,envmap_pars_vertex:n$,envmap_physical_pars_fragment:m$,envmap_vertex:s$,fog_vertex:a$,fog_pars_vertex:o$,fog_fragment:l$,fog_pars_fragment:c$,gradientmap_pars_fragment:u$,lightmap_pars_fragment:h$,lights_lambert_fragment:d$,lights_lambert_pars_fragment:p$,lights_pars_begin:f$,lights_toon_fragment:g$,lights_toon_pars_fragment:A$,lights_phong_fragment:y$,lights_phong_pars_fragment:v$,lights_physical_fragment:b$,lights_physical_pars_fragment:x$,lights_fragment_begin:_$,lights_fragment_maps:E$,lights_fragment_end:w$,logdepthbuf_fragment:C$,logdepthbuf_pars_fragment:S$,logdepthbuf_pars_vertex:T$,logdepthbuf_vertex:M$,map_fragment:R$,map_pars_fragment:I$,map_particle_fragment:B$,map_particle_pars_fragment:N$,metalnessmap_fragment:L$,metalnessmap_pars_fragment:D$,morphinstance_vertex:O$,morphcolor_vertex:P$,morphnormal_vertex:k$,morphtarget_pars_vertex:F$,morphtarget_vertex:U$,normal_fragment_begin:z$,normal_fragment_maps:j$,normal_pars_fragment:G$,normal_pars_vertex:V$,normal_vertex:H$,normalmap_pars_fragment:W$,clearcoat_normal_fragment_begin:Q$,clearcoat_normal_fragment_maps:q$,clearcoat_pars_fragment:X$,iridescence_pars_fragment:K$,opaque_fragment:Y$,packing:J$,premultiplied_alpha_fragment:Z$,project_vertex:$$,dithering_fragment:eee,dithering_pars_fragment:tee,roughnessmap_fragment:iee,roughnessmap_pars_fragment:ree,shadowmap_pars_fragment:nee,shadowmap_pars_vertex:see,shadowmap_vertex:aee,shadowmask_pars_fragment:oee,skinbase_vertex:lee,skinning_pars_vertex:cee,skinning_vertex:uee,skinnormal_vertex:hee,specularmap_fragment:dee,specularmap_pars_fragment:pee,tonemapping_fragment:fee,tonemapping_pars_fragment:mee,transmission_fragment:gee,transmission_pars_fragment:Aee,uv_pars_fragment:yee,uv_pars_vertex:vee,uv_vertex:bee,worldpos_vertex:xee,background_vert:_ee,background_frag:Eee,backgroundCube_vert:wee,backgroundCube_frag:Cee,cube_vert:See,cube_frag:Tee,depth_vert:Mee,depth_frag:Ree,distanceRGBA_vert:Iee,distanceRGBA_frag:Bee,equirect_vert:Nee,equirect_frag:Lee,linedashed_vert:Dee,linedashed_frag:Oee,meshbasic_vert:Pee,meshbasic_frag:kee,meshlambert_vert:Fee,meshlambert_frag:Uee,meshmatcap_vert:zee,meshmatcap_frag:jee,meshnormal_vert:Gee,meshnormal_frag:Vee,meshphong_vert:Hee,meshphong_frag:Wee,meshphysical_vert:Qee,meshphysical_frag:qee,meshtoon_vert:Xee,meshtoon_frag:Kee,points_vert:Yee,points_frag:Jee,shadow_vert:Zee,shadow_frag:$ee,sprite_vert:ete,sprite_frag:tte},Ki={common:{diffuse:{value:new Sn(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new mn},alphaMap:{value:null},alphaMapTransform:{value:new mn},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new mn}},envmap:{envMap:{value:null},envMapRotation:{value:new mn},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new mn}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new mn}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new mn},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new mn},normalScale:{value:new Gi(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new mn},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new mn}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new mn}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new mn}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Sn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Sn(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new mn},alphaTest:{value:0},uvTransform:{value:new mn}},sprite:{diffuse:{value:new Sn(16777215)},opacity:{value:1},center:{value:new Gi(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new mn},alphaMap:{value:null},alphaMapTransform:{value:new mn},alphaTest:{value:0}}},Qc={basic:{uniforms:xo([Ki.common,Ki.specularmap,Ki.envmap,Ki.aomap,Ki.lightmap,Ki.fog]),vertexShader:un.meshbasic_vert,fragmentShader:un.meshbasic_frag},lambert:{uniforms:xo([Ki.common,Ki.specularmap,Ki.envmap,Ki.aomap,Ki.lightmap,Ki.emissivemap,Ki.bumpmap,Ki.normalmap,Ki.displacementmap,Ki.fog,Ki.lights,{emissive:{value:new Sn(0)}}]),vertexShader:un.meshlambert_vert,fragmentShader:un.meshlambert_frag},phong:{uniforms:xo([Ki.common,Ki.specularmap,Ki.envmap,Ki.aomap,Ki.lightmap,Ki.emissivemap,Ki.bumpmap,Ki.normalmap,Ki.displacementmap,Ki.fog,Ki.lights,{emissive:{value:new Sn(0)},specular:{value:new Sn(1118481)},shininess:{value:30}}]),vertexShader:un.meshphong_vert,fragmentShader:un.meshphong_frag},standard:{uniforms:xo([Ki.common,Ki.envmap,Ki.aomap,Ki.lightmap,Ki.emissivemap,Ki.bumpmap,Ki.normalmap,Ki.displacementmap,Ki.roughnessmap,Ki.metalnessmap,Ki.fog,Ki.lights,{emissive:{value:new Sn(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:un.meshphysical_vert,fragmentShader:un.meshphysical_frag},toon:{uniforms:xo([Ki.common,Ki.aomap,Ki.lightmap,Ki.emissivemap,Ki.bumpmap,Ki.normalmap,Ki.displacementmap,Ki.gradientmap,Ki.fog,Ki.lights,{emissive:{value:new Sn(0)}}]),vertexShader:un.meshtoon_vert,fragmentShader:un.meshtoon_frag},matcap:{uniforms:xo([Ki.common,Ki.bumpmap,Ki.normalmap,Ki.displacementmap,Ki.fog,{matcap:{value:null}}]),vertexShader:un.meshmatcap_vert,fragmentShader:un.meshmatcap_frag},points:{uniforms:xo([Ki.points,Ki.fog]),vertexShader:un.points_vert,fragmentShader:un.points_frag},dashed:{uniforms:xo([Ki.common,Ki.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:un.linedashed_vert,fragmentShader:un.linedashed_frag},depth:{uniforms:xo([Ki.common,Ki.displacementmap]),vertexShader:un.depth_vert,fragmentShader:un.depth_frag},normal:{uniforms:xo([Ki.common,Ki.bumpmap,Ki.normalmap,Ki.displacementmap,{opacity:{value:1}}]),vertexShader:un.meshnormal_vert,fragmentShader:un.meshnormal_frag},sprite:{uniforms:xo([Ki.sprite,Ki.fog]),vertexShader:un.sprite_vert,fragmentShader:un.sprite_frag},background:{uniforms:{uvTransform:{value:new mn},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:un.background_vert,fragmentShader:un.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new mn}},vertexShader:un.backgroundCube_vert,fragmentShader:un.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:un.cube_vert,fragmentShader:un.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:un.equirect_vert,fragmentShader:un.equirect_frag},distanceRGBA:{uniforms:xo([Ki.common,Ki.displacementmap,{referencePosition:{value:new ot},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:un.distanceRGBA_vert,fragmentShader:un.distanceRGBA_frag},shadow:{uniforms:xo([Ki.lights,Ki.fog,{color:{value:new Sn(0)},opacity:{value:1}}]),vertexShader:un.shadow_vert,fragmentShader:un.shadow_frag}};Qc.physical={uniforms:xo([Qc.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new mn},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new mn},clearcoatNormalScale:{value:new Gi(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new mn},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new mn},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new mn},sheen:{value:0},sheenColor:{value:new Sn(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new mn},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new mn},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new mn},transmissionSamplerSize:{value:new Gi},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new mn},attenuationDistance:{value:0},attenuationColor:{value:new Sn(0)},specularColor:{value:new Sn(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new mn},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new mn},anisotropyVector:{value:new Gi},anisotropyMap:{value:null},anisotropyMapTransform:{value:new mn}}]),vertexShader:un.meshphysical_vert,fragmentShader:un.meshphysical_frag};const Ix={r:0,b:0,g:0},wp=new td,ite=new gs;function rte(r,e,i,n,s,o,l){const u=new Sn(0);let c=o===!0?0:1,h,p,f=null,g=0,m=null;function y(C){let E=C.isScene===!0?C.background:null;return E&&E.isTexture&&(E=(C.backgroundBlurriness>0?i:e).get(E)),E}function b(C){let E=!1;const T=y(C);T===null?_(u,c):T&&T.isColor&&(_(T,1),E=!0);const R=r.xr.getEnvironmentBlendMode();R==="additive"?n.buffers.color.setClear(0,0,0,1,l):R==="alpha-blend"&&n.buffers.color.setClear(0,0,0,0,l),(r.autoClear||E)&&(n.buffers.depth.setTest(!0),n.buffers.depth.setMask(!0),n.buffers.color.setMask(!0),r.clear(r.autoClearColor,r.autoClearDepth,r.autoClearStencil))}function v(C,E){const T=y(E);T&&(T.isCubeTexture||T.mapping===tx)?(p===void 0&&(p=new za(new Fm(1,1,1),new Wc({name:"BackgroundCubeMaterial",uniforms:Um(Qc.backgroundCube.uniforms),vertexShader:Qc.backgroundCube.vertexShader,fragmentShader:Qc.backgroundCube.fragmentShader,side:bo,depthTest:!1,depthWrite:!1,fog:!1})),p.geometry.deleteAttribute("normal"),p.geometry.deleteAttribute("uv"),p.onBeforeRender=function(R,B,I){this.matrixWorld.copyPosition(I.matrixWorld)},Object.defineProperty(p.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(p)),wp.copy(E.backgroundRotation),wp.x*=-1,wp.y*=-1,wp.z*=-1,T.isCubeTexture&&T.isRenderTargetTexture===!1&&(wp.y*=-1,wp.z*=-1),p.material.uniforms.envMap.value=T,p.material.uniforms.flipEnvMap.value=T.isCubeTexture&&T.isRenderTargetTexture===!1?-1:1,p.material.uniforms.backgroundBlurriness.value=E.backgroundBlurriness,p.material.uniforms.backgroundIntensity.value=E.backgroundIntensity,p.material.uniforms.backgroundRotation.value.setFromMatrix4(ite.makeRotationFromEuler(wp)),p.material.toneMapped=Fn.getTransfer(T.colorSpace)!==os,(f!==T||g!==T.version||m!==r.toneMapping)&&(p.material.needsUpdate=!0,f=T,g=T.version,m=r.toneMapping),p.layers.enableAll(),C.unshift(p,p.geometry,p.material,0,0,null)):T&&T.isTexture&&(h===void 0&&(h=new za(new Rx(2,2),new Wc({name:"BackgroundMaterial",uniforms:Um(Qc.background.uniforms),vertexShader:Qc.background.vertexShader,fragmentShader:Qc.background.fragmentShader,side:qh,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),Object.defineProperty(h.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(h)),h.material.uniforms.t2D.value=T,h.material.uniforms.backgroundIntensity.value=E.backgroundIntensity,h.material.toneMapped=Fn.getTransfer(T.colorSpace)!==os,T.matrixAutoUpdate===!0&&T.updateMatrix(),h.material.uniforms.uvTransform.value.copy(T.matrix),(f!==T||g!==T.version||m!==r.toneMapping)&&(h.material.needsUpdate=!0,f=T,g=T.version,m=r.toneMapping),h.layers.enableAll(),C.unshift(h,h.geometry,h.material,0,0,null))}function _(C,E){C.getRGB(Ix,A4(r)),n.buffers.color.setClear(Ix.r,Ix.g,Ix.b,E,l)}return{getClearColor:function(){return u},setClearColor:function(C,E=1){u.set(C),c=E,_(u,c)},getClearAlpha:function(){return c},setClearAlpha:function(C){c=C,_(u,c)},render:b,addToRenderList:v}}function nte(r,e){const i=r.getParameter(r.MAX_VERTEX_ATTRIBS),n={},s=g(null);let o=s,l=!1;function u(O,F,q,H,G){let J=!1;const Q=f(H,q,F);o!==Q&&(o=Q,h(o.object)),J=m(O,H,q,G),J&&y(O,H,q,G),G!==null&&e.update(G,r.ELEMENT_ARRAY_BUFFER),(J||l)&&(l=!1,T(O,F,q,H),G!==null&&r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e.get(G).buffer))}function c(){return r.createVertexArray()}function h(O){return r.bindVertexArray(O)}function p(O){return r.deleteVertexArray(O)}function f(O,F,q){const H=q.wireframe===!0;let G=n[O.id];G===void 0&&(G={},n[O.id]=G);let J=G[F.id];J===void 0&&(J={},G[F.id]=J);let Q=J[H];return Q===void 0&&(Q=g(c()),J[H]=Q),Q}function g(O){const F=[],q=[],H=[];for(let G=0;G<i;G++)F[G]=0,q[G]=0,H[G]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:F,enabledAttributes:q,attributeDivisors:H,object:O,attributes:{},index:null}}function m(O,F,q,H){const G=o.attributes,J=F.attributes;let Q=0;const V=q.getAttributes();for(const z in V)if(V[z].location>=0){const te=G[z];let K=J[z];if(K===void 0&&(z==="instanceMatrix"&&O.instanceMatrix&&(K=O.instanceMatrix),z==="instanceColor"&&O.instanceColor&&(K=O.instanceColor)),te===void 0||te.attribute!==K||K&&te.data!==K.data)return!0;Q++}return o.attributesNum!==Q||o.index!==H}function y(O,F,q,H){const G={},J=F.attributes;let Q=0;const V=q.getAttributes();for(const z in V)if(V[z].location>=0){let te=J[z];te===void 0&&(z==="instanceMatrix"&&O.instanceMatrix&&(te=O.instanceMatrix),z==="instanceColor"&&O.instanceColor&&(te=O.instanceColor));const K={};K.attribute=te,te&&te.data&&(K.data=te.data),G[z]=K,Q++}o.attributes=G,o.attributesNum=Q,o.index=H}function b(){const O=o.newAttributes;for(let F=0,q=O.length;F<q;F++)O[F]=0}function v(O){_(O,0)}function _(O,F){const q=o.newAttributes,H=o.enabledAttributes,G=o.attributeDivisors;q[O]=1,H[O]===0&&(r.enableVertexAttribArray(O),H[O]=1),G[O]!==F&&(r.vertexAttribDivisor(O,F),G[O]=F)}function C(){const O=o.newAttributes,F=o.enabledAttributes;for(let q=0,H=F.length;q<H;q++)F[q]!==O[q]&&(r.disableVertexAttribArray(q),F[q]=0)}function E(O,F,q,H,G,J,Q){Q===!0?r.vertexAttribIPointer(O,F,q,G,J):r.vertexAttribPointer(O,F,q,H,G,J)}function T(O,F,q,H){b();const G=H.attributes,J=q.getAttributes(),Q=F.defaultAttributeValues;for(const V in J){const z=J[V];if(z.location>=0){let te=G[V];if(te===void 0&&(V==="instanceMatrix"&&O.instanceMatrix&&(te=O.instanceMatrix),V==="instanceColor"&&O.instanceColor&&(te=O.instanceColor)),te!==void 0){const K=te.normalized,ae=te.itemSize,Ae=e.get(te);if(Ae===void 0)continue;const _e=Ae.buffer,me=Ae.type,Pe=Ae.bytesPerElement,Xe=me===r.INT||me===r.UNSIGNED_INT||te.gpuType===tS;if(te.isInterleavedBufferAttribute){const Je=te.data,tt=Je.stride,dt=te.offset;if(Je.isInstancedInterleavedBuffer){for(let wt=0;wt<z.locationSize;wt++)_(z.location+wt,Je.meshPerAttribute);O.isInstancedMesh!==!0&&H._maxInstanceCount===void 0&&(H._maxInstanceCount=Je.meshPerAttribute*Je.count)}else for(let wt=0;wt<z.locationSize;wt++)v(z.location+wt);r.bindBuffer(r.ARRAY_BUFFER,_e);for(let wt=0;wt<z.locationSize;wt++)E(z.location+wt,ae/z.locationSize,me,K,tt*Pe,(dt+ae/z.locationSize*wt)*Pe,Xe)}else{if(te.isInstancedBufferAttribute){for(let Je=0;Je<z.locationSize;Je++)_(z.location+Je,te.meshPerAttribute);O.isInstancedMesh!==!0&&H._maxInstanceCount===void 0&&(H._maxInstanceCount=te.meshPerAttribute*te.count)}else for(let Je=0;Je<z.locationSize;Je++)v(z.location+Je);r.bindBuffer(r.ARRAY_BUFFER,_e);for(let Je=0;Je<z.locationSize;Je++)E(z.location+Je,ae/z.locationSize,me,K,ae*Pe,ae/z.locationSize*Je*Pe,Xe)}}else if(Q!==void 0){const K=Q[V];if(K!==void 0)switch(K.length){case 2:r.vertexAttrib2fv(z.location,K);break;case 3:r.vertexAttrib3fv(z.location,K);break;case 4:r.vertexAttrib4fv(z.location,K);break;default:r.vertexAttrib1fv(z.location,K)}}}}C()}function R(){D();for(const O in n){const F=n[O];for(const q in F){const H=F[q];for(const G in H)p(H[G].object),delete H[G];delete F[q]}delete n[O]}}function B(O){if(n[O.id]===void 0)return;const F=n[O.id];for(const q in F){const H=F[q];for(const G in H)p(H[G].object),delete H[G];delete F[q]}delete n[O.id]}function I(O){for(const F in n){const q=n[F];if(q[O.id]===void 0)continue;const H=q[O.id];for(const G in H)p(H[G].object),delete H[G];delete q[O.id]}}function D(){L(),l=!0,o!==s&&(o=s,h(o.object))}function L(){s.geometry=null,s.program=null,s.wireframe=!1}return{setup:u,reset:D,resetDefaultState:L,dispose:R,releaseStatesOfGeometry:B,releaseStatesOfProgram:I,initAttributes:b,enableAttribute:v,disableUnusedAttributes:C}}function ste(r,e,i){let n;function s(h){n=h}function o(h,p){r.drawArrays(n,h,p),i.update(p,n,1)}function l(h,p,f){f!==0&&(r.drawArraysInstanced(n,h,p,f),i.update(p,n,f))}function u(h,p,f){if(f===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(n,h,0,p,0,f);let g=0;for(let m=0;m<f;m++)g+=p[m];i.update(g,n,1)}function c(h,p,f,g){if(f===0)return;const m=e.get("WEBGL_multi_draw");if(m===null)for(let y=0;y<h.length;y++)l(h[y],p[y],g[y]);else{m.multiDrawArraysInstancedWEBGL(n,h,0,p,0,g,0,f);let y=0;for(let b=0;b<f;b++)y+=p[b]*g[b];i.update(y,n,1)}}this.setMode=s,this.render=o,this.renderInstances=l,this.renderMultiDraw=u,this.renderMultiDrawInstances=c}function ate(r,e,i,n){let s;function o(){if(s!==void 0)return s;if(e.has("EXT_texture_filter_anisotropic")===!0){const I=e.get("EXT_texture_filter_anisotropic");s=r.getParameter(I.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else s=0;return s}function l(I){return!(I!==sc&&n.convert(I)!==r.getParameter(r.IMPLEMENTATION_COLOR_READ_FORMAT))}function u(I){const D=I===xm&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(I!==Mu&&n.convert(I)!==r.getParameter(r.IMPLEMENTATION_COLOR_READ_TYPE)&&I!==Ru&&!D)}function c(I){if(I==="highp"){if(r.getShaderPrecisionFormat(r.VERTEX_SHADER,r.HIGH_FLOAT).precision>0&&r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT).precision>0)return"highp";I="mediump"}return I==="mediump"&&r.getShaderPrecisionFormat(r.VERTEX_SHADER,r.MEDIUM_FLOAT).precision>0&&r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let h=i.precision!==void 0?i.precision:"highp";const p=c(h);p!==h&&(console.warn("THREE.WebGLRenderer:",h,"not supported, using",p,"instead."),h=p);const f=i.logarithmicDepthBuffer===!0,g=i.reverseDepthBuffer===!0&&e.has("EXT_clip_control"),m=r.getParameter(r.MAX_TEXTURE_IMAGE_UNITS),y=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS),b=r.getParameter(r.MAX_TEXTURE_SIZE),v=r.getParameter(r.MAX_CUBE_MAP_TEXTURE_SIZE),_=r.getParameter(r.MAX_VERTEX_ATTRIBS),C=r.getParameter(r.MAX_VERTEX_UNIFORM_VECTORS),E=r.getParameter(r.MAX_VARYING_VECTORS),T=r.getParameter(r.MAX_FRAGMENT_UNIFORM_VECTORS),R=y>0,B=r.getParameter(r.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:o,getMaxPrecision:c,textureFormatReadable:l,textureTypeReadable:u,precision:h,logarithmicDepthBuffer:f,reverseDepthBuffer:g,maxTextures:m,maxVertexTextures:y,maxTextureSize:b,maxCubemapSize:v,maxAttributes:_,maxVertexUniforms:C,maxVaryings:E,maxFragmentUniforms:T,vertexTextures:R,maxSamples:B}}function ote(r){const e=this;let i=null,n=0,s=!1,o=!1;const l=new uc,u=new mn,c={value:null,needsUpdate:!1};this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(f,g){const m=f.length!==0||g||n!==0||s;return s=g,n=f.length,m},this.beginShadows=function(){o=!0,p(null)},this.endShadows=function(){o=!1},this.setGlobalState=function(f,g){i=p(f,g,0)},this.setState=function(f,g,m){const y=f.clippingPlanes,b=f.clipIntersection,v=f.clipShadows,_=r.get(f);if(!s||y===null||y.length===0||o&&!v)o?p(null):h();else{const C=o?0:n,E=C*4;let T=_.clippingState||null;c.value=T,T=p(y,g,E,m);for(let R=0;R!==E;++R)T[R]=i[R];_.clippingState=T,this.numIntersection=b?this.numPlanes:0,this.numPlanes+=C}};function h(){c.value!==i&&(c.value=i,c.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function p(f,g,m,y){const b=f!==null?f.length:0;let v=null;if(b!==0){if(v=c.value,y!==!0||v===null){const _=m+b*4,C=g.matrixWorldInverse;u.getNormalMatrix(C),(v===null||v.length<_)&&(v=new Float32Array(_));for(let E=0,T=m;E!==b;++E,T+=4)l.copy(f[E]).applyMatrix4(C,u),l.normal.toArray(v,T),v[T+3]=l.constant}c.value=v,c.needsUpdate=!0}return e.numPlanes=b,e.numIntersection=0,v}}function lte(r){let e=new WeakMap;function i(l,u){return u===YC?l.mapping=vm:u===JC&&(l.mapping=bm),l}function n(l){if(l&&l.isTexture){const u=l.mapping;if(u===YC||u===JC)if(e.has(l)){const c=e.get(l).texture;return i(c,l.mapping)}else{const c=l.image;if(c&&c.height>0){const h=new vZ(c.height);return h.fromEquirectangularTexture(r,l),e.set(l,h),l.addEventListener("dispose",s),i(h.texture,l.mapping)}else return null}}return l}function s(l){const u=l.target;u.removeEventListener("dispose",s);const c=e.get(u);c!==void 0&&(e.delete(u),c.dispose())}function o(){e=new WeakMap}return{get:n,dispose:o}}let nT=class extends v4{constructor(r=-1,e=1,i=1,n=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=r,this.right=e,this.top=i,this.bottom=n,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(r,e){return super.copy(r,e),this.left=r.left,this.right=r.right,this.top=r.top,this.bottom=r.bottom,this.near=r.near,this.far=r.far,this.zoom=r.zoom,this.view=r.view===null?null:Object.assign({},r.view),this}setViewOffset(r,e,i,n,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=r,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const r=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let s=i-r,o=i+r,l=n+e,u=n-e;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=c*this.view.offsetX,o=s+c*this.view.width,l-=h*this.view.offsetY,u=l-h*this.view.height}this.projectionMatrix.makeOrthographic(s,o,l,u,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(r){const e=super.toJSON(r);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}};const Gm=4,w4=[.125,.215,.35,.446,.526,.582],Cp=20,sT=new nT,C4=new Sn;let aT=null,oT=0,lT=0,cT=!1;const Sp=(1+Math.sqrt(5))/2,Vm=1/Sp,S4=[new ot(-Sp,Vm,0),new ot(Sp,Vm,0),new ot(-Vm,0,Sp),new ot(Vm,0,Sp),new ot(0,Sp,-Vm),new ot(0,Sp,Vm),new ot(-1,1,-1),new ot(1,1,-1),new ot(-1,1,1),new ot(1,1,1)];let T4=class{constructor(r){this._renderer=r,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(r,e=0,i=.1,n=100){aT=this._renderer.getRenderTarget(),oT=this._renderer.getActiveCubeFace(),lT=this._renderer.getActiveMipmapLevel(),cT=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(r,i,n,s),e>0&&this._blur(s,0,0,e),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(r,e=null){return this._fromTexture(r,e)}fromCubemap(r,e=null){return this._fromTexture(r,e)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=I4(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=R4(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(r){this._lodMax=Math.floor(Math.log2(r)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let r=0;r<this._lodPlanes.length;r++)this._lodPlanes[r].dispose()}_cleanup(r){this._renderer.setRenderTarget(aT,oT,lT),this._renderer.xr.enabled=cT,r.scissorTest=!1,Bx(r,0,0,r.width,r.height)}_fromTexture(r,e){r.mapping===vm||r.mapping===bm?this._setSize(r.image.length===0?16:r.image[0].width||r.image[0].image.width):this._setSize(r.image.width/4),aT=this._renderer.getRenderTarget(),oT=this._renderer.getActiveCubeFace(),lT=this._renderer.getActiveMipmapLevel(),cT=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const i=e||this._allocateTargets();return this._textureToCubeUV(r,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const r=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,i={magFilter:Vc,minFilter:Vc,generateMipmaps:!1,type:xm,format:sc,colorSpace:Cm,depthBuffer:!1},n=M4(r,e,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==r||this._pingPongRenderTarget.height!==e){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=M4(r,e,i);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=cte(s)),this._blurMaterial=ute(s,r,e)}return n}_compileMaterial(r){const e=new za(this._lodPlanes[0],r);this._renderer.compile(e,sT)}_sceneToCubeUV(r,e,i,n){const s=new kl(90,1,e,i),o=[1,-1,1,1,1,1],l=[1,1,1,-1,-1,-1],u=this._renderer,c=u.autoClear,h=u.toneMapping;u.getClearColor(C4),u.toneMapping=Xh,u.autoClear=!1;const p=new rd({name:"PMREM.Background",side:bo,depthWrite:!1,depthTest:!1}),f=new za(new Fm,p);let g=!1;const m=r.background;m?m.isColor&&(p.color.copy(m),r.background=null,g=!0):(p.color.copy(C4),g=!0);for(let y=0;y<6;y++){const b=y%3;b===0?(s.up.set(0,o[y],0),s.lookAt(l[y],0,0)):b===1?(s.up.set(0,0,o[y]),s.lookAt(0,l[y],0)):(s.up.set(0,o[y],0),s.lookAt(0,0,l[y]));const v=this._cubeSize;Bx(n,b*v,y>2?v:0,v,v),u.setRenderTarget(n),g&&u.render(f,s),u.render(r,s)}f.geometry.dispose(),f.material.dispose(),u.toneMapping=h,u.autoClear=c,r.background=m}_textureToCubeUV(r,e){const i=this._renderer,n=r.mapping===vm||r.mapping===bm;n?(this._cubemapMaterial===null&&(this._cubemapMaterial=I4()),this._cubemapMaterial.uniforms.flipEnvMap.value=r.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=R4());const s=n?this._cubemapMaterial:this._equirectMaterial,o=new za(this._lodPlanes[0],s),l=s.uniforms;l.envMap.value=r;const u=this._cubeSize;Bx(e,0,0,3*u,2*u),i.setRenderTarget(e),i.render(o,sT)}_applyPMREM(r){const e=this._renderer,i=e.autoClear;e.autoClear=!1;const n=this._lodPlanes.length;for(let s=1;s<n;s++){const o=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),l=S4[(n-s-1)%S4.length];this._blur(r,s-1,s,o,l)}e.autoClear=i}_blur(r,e,i,n,s){const o=this._pingPongRenderTarget;this._halfBlur(r,o,e,i,n,"latitudinal",s),this._halfBlur(o,r,i,i,n,"longitudinal",s)}_halfBlur(r,e,i,n,s,o,l){const u=this._renderer,c=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const h=3,p=new za(this._lodPlanes[n],c),f=c.uniforms,g=this._sizeLods[i]-1,m=isFinite(s)?Math.PI/(2*g):2*Math.PI/(2*Cp-1),y=s/m,b=isFinite(s)?1+Math.floor(h*y):Cp;b>Cp&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${b} samples when the maximum is set to ${Cp}`);const v=[];let _=0;for(let B=0;B<Cp;++B){const I=B/y,D=Math.exp(-I*I/2);v.push(D),B===0?_+=D:B<b&&(_+=2*D)}for(let B=0;B<v.length;B++)v[B]=v[B]/_;f.envMap.value=r.texture,f.samples.value=b,f.weights.value=v,f.latitudinal.value=o==="latitudinal",l&&(f.poleAxis.value=l);const{_lodMax:C}=this;f.dTheta.value=m,f.mipInt.value=C-i;const E=this._sizeLods[n],T=3*E*(n>C-Gm?n-C+Gm:0),R=4*(this._cubeSize-E);Bx(e,T,R,3*E,2*E),u.setRenderTarget(e),u.render(p,sT)}};function cte(r){const e=[],i=[],n=[];let s=r;const o=r-Gm+1+w4.length;for(let l=0;l<o;l++){const u=Math.pow(2,s);i.push(u);let c=1/u;l>r-Gm?c=w4[l-r+Gm-1]:l===0&&(c=0),n.push(c);const h=1/(u-2),p=-h,f=1+h,g=[p,p,f,p,f,f,p,p,f,f,p,f],m=6,y=6,b=3,v=2,_=1,C=new Float32Array(b*y*m),E=new Float32Array(v*y*m),T=new Float32Array(_*y*m);for(let B=0;B<m;B++){const I=B%3*2/3-1,D=B>2?0:-1,L=[I,D,0,I+2/3,D,0,I+2/3,D+1,0,I,D,0,I+2/3,D+1,0,I,D+1,0];C.set(L,b*y*B),E.set(g,v*y*B);const O=[B,B,B,B,B,B];T.set(O,_*y*B)}const R=new Vo;R.setAttribute("position",new Go(C,b)),R.setAttribute("uv",new Go(E,v)),R.setAttribute("faceIndex",new Go(T,_)),e.push(R),s>Gm&&s--}return{lodPlanes:e,sizeLods:i,sigmas:n}}function M4(r,e,i){const n=new Yh(r,e,i);return n.texture.mapping=tx,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function Bx(r,e,i,n,s){r.viewport.set(e,i,n,s),r.scissor.set(e,i,n,s)}function ute(r,e,i){const n=new Float32Array(Cp),s=new ot(0,1,0);return new Wc({name:"SphericalGaussianBlur",defines:{n:Cp,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${r}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:s}},vertexShader:uT(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Tu,depthTest:!1,depthWrite:!1})}function R4(){return new Wc({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:uT(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Tu,depthTest:!1,depthWrite:!1})}function I4(){return new Wc({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:uT(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Tu,depthTest:!1,depthWrite:!1})}function uT(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function hte(r){let e=new WeakMap,i=null;function n(u){if(u&&u.isTexture){const c=u.mapping,h=c===YC||c===JC,p=c===vm||c===bm;if(h||p){let f=e.get(u);const g=f!==void 0?f.texture.pmremVersion:0;if(u.isRenderTargetTexture&&u.pmremVersion!==g)return i===null&&(i=new T4(r)),f=h?i.fromEquirectangular(u,f):i.fromCubemap(u,f),f.texture.pmremVersion=u.pmremVersion,e.set(u,f),f.texture;if(f!==void 0)return f.texture;{const m=u.image;return h&&m&&m.height>0||p&&m&&s(m)?(i===null&&(i=new T4(r)),f=h?i.fromEquirectangular(u):i.fromCubemap(u),f.texture.pmremVersion=u.pmremVersion,e.set(u,f),u.addEventListener("dispose",o),f.texture):null}}}return u}function s(u){let c=0;const h=6;for(let p=0;p<h;p++)u[p]!==void 0&&c++;return c===h}function o(u){const c=u.target;c.removeEventListener("dispose",o);const h=e.get(c);h!==void 0&&(e.delete(c),h.dispose())}function l(){e=new WeakMap,i!==null&&(i.dispose(),i=null)}return{get:n,dispose:l}}function dte(r){const e={};function i(n){if(e[n]!==void 0)return e[n];let s;switch(n){case"WEBGL_depth_texture":s=r.getExtension("WEBGL_depth_texture")||r.getExtension("MOZ_WEBGL_depth_texture")||r.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=r.getExtension("WEBGL_compressed_texture_s3tc")||r.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=r.getExtension("WEBGL_compressed_texture_pvrtc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=r.getExtension(n)}return e[n]=s,s}return{has:function(n){return i(n)!==null},init:function(){i("EXT_color_buffer_float"),i("WEBGL_clip_cull_distance"),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture"),i("WEBGL_render_shared_exponent")},get:function(n){const s=i(n);return s===null&&_A("THREE.WebGLRenderer: "+n+" extension not supported."),s}}}function pte(r,e,i,n){const s={},o=new WeakMap;function l(f){const g=f.target;g.index!==null&&e.remove(g.index);for(const y in g.attributes)e.remove(g.attributes[y]);for(const y in g.morphAttributes){const b=g.morphAttributes[y];for(let v=0,_=b.length;v<_;v++)e.remove(b[v])}g.removeEventListener("dispose",l),delete s[g.id];const m=o.get(g);m&&(e.remove(m),o.delete(g)),n.releaseStatesOfGeometry(g),g.isInstancedBufferGeometry===!0&&delete g._maxInstanceCount,i.memory.geometries--}function u(f,g){return s[g.id]===!0||(g.addEventListener("dispose",l),s[g.id]=!0,i.memory.geometries++),g}function c(f){const g=f.attributes;for(const y in g)e.update(g[y],r.ARRAY_BUFFER);const m=f.morphAttributes;for(const y in m){const b=m[y];for(let v=0,_=b.length;v<_;v++)e.update(b[v],r.ARRAY_BUFFER)}}function h(f){const g=[],m=f.index,y=f.attributes.position;let b=0;if(m!==null){const C=m.array;b=m.version;for(let E=0,T=C.length;E<T;E+=3){const R=C[E+0],B=C[E+1],I=C[E+2];g.push(R,B,B,I,I,R)}}else if(y!==void 0){const C=y.array;b=y.version;for(let E=0,T=C.length/3-1;E<T;E+=3){const R=E+0,B=E+1,I=E+2;g.push(R,B,B,I,I,R)}}else return;const v=new(qP(g)?p4:d4)(g,1);v.version=b;const _=o.get(f);_&&e.remove(_),o.set(f,v)}function p(f){const g=o.get(f);if(g){const m=f.index;m!==null&&g.version<m.version&&h(f)}else h(f);return o.get(f)}return{get:u,update:c,getWireframeAttribute:p}}function fte(r,e,i){let n;function s(g){n=g}let o,l;function u(g){o=g.type,l=g.bytesPerElement}function c(g,m){r.drawElements(n,m,o,g*l),i.update(m,n,1)}function h(g,m,y){y!==0&&(r.drawElementsInstanced(n,m,o,g*l,y),i.update(m,n,y))}function p(g,m,y){if(y===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(n,m,0,o,g,0,y);let b=0;for(let v=0;v<y;v++)b+=m[v];i.update(b,n,1)}function f(g,m,y,b){if(y===0)return;const v=e.get("WEBGL_multi_draw");if(v===null)for(let _=0;_<g.length;_++)h(g[_]/l,m[_],b[_]);else{v.multiDrawElementsInstancedWEBGL(n,m,0,o,g,0,b,0,y);let _=0;for(let C=0;C<y;C++)_+=m[C]*b[C];i.update(_,n,1)}}this.setMode=s,this.setIndex=u,this.render=c,this.renderInstances=h,this.renderMultiDraw=p,this.renderMultiDrawInstances=f}function mte(r){const e={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function n(o,l,u){switch(i.calls++,l){case r.TRIANGLES:i.triangles+=u*(o/3);break;case r.LINES:i.lines+=u*(o/2);break;case r.LINE_STRIP:i.lines+=u*(o-1);break;case r.LINE_LOOP:i.lines+=u*o;break;case r.POINTS:i.points+=u*o;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",l);break}}function s(){i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:e,render:i,programs:null,autoReset:!0,reset:s,update:n}}function gte(r,e,i){const n=new WeakMap,s=new Zs;function o(l,u,c){const h=l.morphTargetInfluences,p=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,f=p!==void 0?p.length:0;let g=n.get(u);if(g===void 0||g.count!==f){let m=function(){D.dispose(),n.delete(u),u.removeEventListener("dispose",m)};g!==void 0&&g.texture.dispose();const y=u.morphAttributes.position!==void 0,b=u.morphAttributes.normal!==void 0,v=u.morphAttributes.color!==void 0,_=u.morphAttributes.position||[],C=u.morphAttributes.normal||[],E=u.morphAttributes.color||[];let T=0;y===!0&&(T=1),b===!0&&(T=2),v===!0&&(T=3);let R=u.attributes.position.count*T,B=1;R>e.maxTextureSize&&(B=Math.ceil(R/e.maxTextureSize),R=e.maxTextureSize);const I=new Float32Array(R*B*4*f),D=new t4(I,R,B,f);D.type=Ru,D.needsUpdate=!0;const L=T*4;for(let O=0;O<f;O++){const F=_[O],q=C[O],H=E[O],G=R*B*4*O;for(let J=0;J<F.count;J++){const Q=J*L;y===!0&&(s.fromBufferAttribute(F,J),I[G+Q+0]=s.x,I[G+Q+1]=s.y,I[G+Q+2]=s.z,I[G+Q+3]=0),b===!0&&(s.fromBufferAttribute(q,J),I[G+Q+4]=s.x,I[G+Q+5]=s.y,I[G+Q+6]=s.z,I[G+Q+7]=0),v===!0&&(s.fromBufferAttribute(H,J),I[G+Q+8]=s.x,I[G+Q+9]=s.y,I[G+Q+10]=s.z,I[G+Q+11]=H.itemSize===4?s.w:1)}}g={count:f,texture:D,size:new Gi(R,B)},n.set(u,g),u.addEventListener("dispose",m)}if(l.isInstancedMesh===!0&&l.morphTexture!==null)c.getUniforms().setValue(r,"morphTexture",l.morphTexture,i);else{let m=0;for(let b=0;b<h.length;b++)m+=h[b];const y=u.morphTargetsRelative?1:1-m;c.getUniforms().setValue(r,"morphTargetBaseInfluence",y),c.getUniforms().setValue(r,"morphTargetInfluences",h)}c.getUniforms().setValue(r,"morphTargetsTexture",g.texture,i),c.getUniforms().setValue(r,"morphTargetsTextureSize",g.size)}return{update:o}}function Ate(r,e,i,n){let s=new WeakMap;function o(c){const h=n.render.frame,p=c.geometry,f=e.get(c,p);if(s.get(f)!==h&&(e.update(f),s.set(f,h)),c.isInstancedMesh&&(c.hasEventListener("dispose",u)===!1&&c.addEventListener("dispose",u),s.get(c)!==h&&(i.update(c.instanceMatrix,r.ARRAY_BUFFER),c.instanceColor!==null&&i.update(c.instanceColor,r.ARRAY_BUFFER),s.set(c,h))),c.isSkinnedMesh){const g=c.skeleton;s.get(g)!==h&&(g.update(),s.set(g,h))}return f}function l(){s=new WeakMap}function u(c){const h=c.target;h.removeEventListener("dispose",u),i.remove(h.instanceMatrix),h.instanceColor!==null&&i.remove(h.instanceColor)}return{update:o,dispose:l}}let B4=class extends Ol{constructor(r,e,i,n,s,o,l,u,c,h=Em){if(h!==Em&&h!==wm)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&h===Em&&(i=mp),i===void 0&&h===wm&&(i=_m),super(null,n,s,o,l,u,h,i,c),this.isDepthTexture=!0,this.image={width:r,height:e},this.magFilter=l!==void 0?l:nc,this.minFilter=u!==void 0?u:nc,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(r){return super.copy(r),this.compareFunction=r.compareFunction,this}toJSON(r){const e=super.toJSON(r);return this.compareFunction!==null&&(e.compareFunction=this.compareFunction),e}};const N4=new Ol,L4=new B4(1,1),D4=new t4,O4=new nZ,P4=new _4,k4=[],F4=[],U4=new Float32Array(16),z4=new Float32Array(9),j4=new Float32Array(4);function Hm(r,e,i){const n=r[0];if(n<=0||n>0)return r;const s=e*i;let o=k4[s];if(o===void 0&&(o=new Float32Array(s),k4[s]=o),e!==0){n.toArray(o,0);for(let l=1,u=0;l!==e;++l)u+=i,r[l].toArray(o,u)}return o}function fa(r,e){if(r.length!==e.length)return!1;for(let i=0,n=r.length;i<n;i++)if(r[i]!==e[i])return!1;return!0}function ma(r,e){for(let i=0,n=e.length;i<n;i++)r[i]=e[i]}function Nx(r,e){let i=F4[e];i===void 0&&(i=new Int32Array(e),F4[e]=i);for(let n=0;n!==e;++n)i[n]=r.allocateTextureUnit();return i}function yte(r,e){const i=this.cache;i[0]!==e&&(r.uniform1f(this.addr,e),i[0]=e)}function vte(r,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(r.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(fa(i,e))return;r.uniform2fv(this.addr,e),ma(i,e)}}function bte(r,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(r.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else if(e.r!==void 0)(i[0]!==e.r||i[1]!==e.g||i[2]!==e.b)&&(r.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b);else{if(fa(i,e))return;r.uniform3fv(this.addr,e),ma(i,e)}}function xte(r,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(r.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(fa(i,e))return;r.uniform4fv(this.addr,e),ma(i,e)}}function _te(r,e){const i=this.cache,n=e.elements;if(n===void 0){if(fa(i,e))return;r.uniformMatrix2fv(this.addr,!1,e),ma(i,e)}else{if(fa(i,n))return;j4.set(n),r.uniformMatrix2fv(this.addr,!1,j4),ma(i,n)}}function Ete(r,e){const i=this.cache,n=e.elements;if(n===void 0){if(fa(i,e))return;r.uniformMatrix3fv(this.addr,!1,e),ma(i,e)}else{if(fa(i,n))return;z4.set(n),r.uniformMatrix3fv(this.addr,!1,z4),ma(i,n)}}function wte(r,e){const i=this.cache,n=e.elements;if(n===void 0){if(fa(i,e))return;r.uniformMatrix4fv(this.addr,!1,e),ma(i,e)}else{if(fa(i,n))return;U4.set(n),r.uniformMatrix4fv(this.addr,!1,U4),ma(i,n)}}function Cte(r,e){const i=this.cache;i[0]!==e&&(r.uniform1i(this.addr,e),i[0]=e)}function Ste(r,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(r.uniform2i(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(fa(i,e))return;r.uniform2iv(this.addr,e),ma(i,e)}}function Tte(r,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(r.uniform3i(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(fa(i,e))return;r.uniform3iv(this.addr,e),ma(i,e)}}function Mte(r,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(r.uniform4i(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(fa(i,e))return;r.uniform4iv(this.addr,e),ma(i,e)}}function Rte(r,e){const i=this.cache;i[0]!==e&&(r.uniform1ui(this.addr,e),i[0]=e)}function Ite(r,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(r.uniform2ui(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(fa(i,e))return;r.uniform2uiv(this.addr,e),ma(i,e)}}function Bte(r,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(r.uniform3ui(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(fa(i,e))return;r.uniform3uiv(this.addr,e),ma(i,e)}}function Nte(r,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(r.uniform4ui(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(fa(i,e))return;r.uniform4uiv(this.addr,e),ma(i,e)}}function Lte(r,e,i){const n=this.cache,s=i.allocateTextureUnit();n[0]!==s&&(r.uniform1i(this.addr,s),n[0]=s);let o;this.type===r.SAMPLER_2D_SHADOW?(L4.compareFunction=HP,o=L4):o=N4,i.setTexture2D(e||o,s)}function Dte(r,e,i){const n=this.cache,s=i.allocateTextureUnit();n[0]!==s&&(r.uniform1i(this.addr,s),n[0]=s),i.setTexture3D(e||O4,s)}function Ote(r,e,i){const n=this.cache,s=i.allocateTextureUnit();n[0]!==s&&(r.uniform1i(this.addr,s),n[0]=s),i.setTextureCube(e||P4,s)}function Pte(r,e,i){const n=this.cache,s=i.allocateTextureUnit();n[0]!==s&&(r.uniform1i(this.addr,s),n[0]=s),i.setTexture2DArray(e||D4,s)}function kte(r){switch(r){case 5126:return yte;case 35664:return vte;case 35665:return bte;case 35666:return xte;case 35674:return _te;case 35675:return Ete;case 35676:return wte;case 5124:case 35670:return Cte;case 35667:case 35671:return Ste;case 35668:case 35672:return Tte;case 35669:case 35673:return Mte;case 5125:return Rte;case 36294:return Ite;case 36295:return Bte;case 36296:return Nte;case 35678:case 36198:case 36298:case 36306:case 35682:return Lte;case 35679:case 36299:case 36307:return Dte;case 35680:case 36300:case 36308:case 36293:return Ote;case 36289:case 36303:case 36311:case 36292:return Pte}}function Fte(r,e){r.uniform1fv(this.addr,e)}function Ute(r,e){const i=Hm(e,this.size,2);r.uniform2fv(this.addr,i)}function zte(r,e){const i=Hm(e,this.size,3);r.uniform3fv(this.addr,i)}function jte(r,e){const i=Hm(e,this.size,4);r.uniform4fv(this.addr,i)}function Gte(r,e){const i=Hm(e,this.size,4);r.uniformMatrix2fv(this.addr,!1,i)}function Vte(r,e){const i=Hm(e,this.size,9);r.uniformMatrix3fv(this.addr,!1,i)}function Hte(r,e){const i=Hm(e,this.size,16);r.uniformMatrix4fv(this.addr,!1,i)}function Wte(r,e){r.uniform1iv(this.addr,e)}function Qte(r,e){r.uniform2iv(this.addr,e)}function qte(r,e){r.uniform3iv(this.addr,e)}function Xte(r,e){r.uniform4iv(this.addr,e)}function Kte(r,e){r.uniform1uiv(this.addr,e)}function Yte(r,e){r.uniform2uiv(this.addr,e)}function Jte(r,e){r.uniform3uiv(this.addr,e)}function Zte(r,e){r.uniform4uiv(this.addr,e)}function $te(r,e,i){const n=this.cache,s=e.length,o=Nx(i,s);fa(n,o)||(r.uniform1iv(this.addr,o),ma(n,o));for(let l=0;l!==s;++l)i.setTexture2D(e[l]||N4,o[l])}function eie(r,e,i){const n=this.cache,s=e.length,o=Nx(i,s);fa(n,o)||(r.uniform1iv(this.addr,o),ma(n,o));for(let l=0;l!==s;++l)i.setTexture3D(e[l]||O4,o[l])}function tie(r,e,i){const n=this.cache,s=e.length,o=Nx(i,s);fa(n,o)||(r.uniform1iv(this.addr,o),ma(n,o));for(let l=0;l!==s;++l)i.setTextureCube(e[l]||P4,o[l])}function iie(r,e,i){const n=this.cache,s=e.length,o=Nx(i,s);fa(n,o)||(r.uniform1iv(this.addr,o),ma(n,o));for(let l=0;l!==s;++l)i.setTexture2DArray(e[l]||D4,o[l])}function rie(r){switch(r){case 5126:return Fte;case 35664:return Ute;case 35665:return zte;case 35666:return jte;case 35674:return Gte;case 35675:return Vte;case 35676:return Hte;case 5124:case 35670:return Wte;case 35667:case 35671:return Qte;case 35668:case 35672:return qte;case 35669:case 35673:return Xte;case 5125:return Kte;case 36294:return Yte;case 36295:return Jte;case 36296:return Zte;case 35678:case 36198:case 36298:case 36306:case 35682:return $te;case 35679:case 36299:case 36307:return eie;case 35680:case 36300:case 36308:case 36293:return tie;case 36289:case 36303:case 36311:case 36292:return iie}}class nie{constructor(e,i,n){this.id=e,this.addr=n,this.cache=[],this.type=i.type,this.setValue=kte(i.type)}}class sie{constructor(e,i,n){this.id=e,this.addr=n,this.cache=[],this.type=i.type,this.size=i.size,this.setValue=rie(i.type)}}class aie{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,i,n){const s=this.seq;for(let o=0,l=s.length;o!==l;++o){const u=s[o];u.setValue(e,i[u.id],n)}}}const hT=/(\w+)(\])?(\[|\.)?/g;function G4(r,e){r.seq.push(e),r.map[e.id]=e}function oie(r,e,i){const n=r.name,s=n.length;for(hT.lastIndex=0;;){const o=hT.exec(n),l=hT.lastIndex;let u=o[1];const c=o[2]==="]",h=o[3];if(c&&(u=u|0),h===void 0||h==="["&&l+2===s){G4(i,h===void 0?new nie(u,r,e):new sie(u,r,e));break}else{let p=i.map[u];p===void 0&&(p=new aie(u),G4(i,p)),i=p}}}class Lx{constructor(e,i){this.seq=[],this.map={};const n=e.getProgramParameter(i,e.ACTIVE_UNIFORMS);for(let s=0;s<n;++s){const o=e.getActiveUniform(i,s),l=e.getUniformLocation(i,o.name);oie(o,l,this)}}setValue(e,i,n,s){const o=this.map[i];o!==void 0&&o.setValue(e,n,s)}setOptional(e,i,n){const s=i[n];s!==void 0&&this.setValue(e,n,s)}static upload(e,i,n,s){for(let o=0,l=i.length;o!==l;++o){const u=i[o],c=n[u.id];c.needsUpdate!==!1&&u.setValue(e,c.value,s)}}static seqWithValue(e,i){const n=[];for(let s=0,o=e.length;s!==o;++s){const l=e[s];l.id in i&&n.push(l)}return n}}function V4(r,e,i){const n=r.createShader(e);return r.shaderSource(n,i),r.compileShader(n),n}const lie=37297;let cie=0;function uie(r,e){const i=r.split(`
`),n=[],s=Math.max(e-6,0),o=Math.min(e+6,i.length);for(let l=s;l<o;l++){const u=l+1;n.push(`${u===e?">":" "} ${u}: ${i[l]}`)}return n.join(`
`)}const H4=new mn;function hie(r){Fn._getMatrix(H4,Fn.workingColorSpace,r);const e=`mat3( ${H4.elements.map(i=>i.toFixed(4))} )`;switch(Fn.getTransfer(r)){case lx:return[e,"LinearTransferOETF"];case os:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",r),[e,"LinearTransferOETF"]}}function W4(r,e,i){const n=r.getShaderParameter(e,r.COMPILE_STATUS),s=r.getShaderInfoLog(e).trim();if(n&&s==="")return"";const o=/ERROR: 0:(\d+)/.exec(s);if(o){const l=parseInt(o[1]);return i.toUpperCase()+`

`+s+`

`+uie(r.getShaderSource(e),l)}else return s}function die(r,e){const i=hie(e);return[`vec4 ${r}( vec4 value ) {`,`	return ${i[1]}( vec4( value.rgb * ${i[0]}, value.a ) );`,"}"].join(`
`)}function pie(r,e){let i;switch(e){case gJ:i="Linear";break;case AJ:i="Reinhard";break;case yJ:i="Cineon";break;case vJ:i="ACESFilmic";break;case xJ:i="AgX";break;case _J:i="Neutral";break;case bJ:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),i="Linear"}return"vec3 "+r+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}const Dx=new ot;function fie(){Fn.getLuminanceCoefficients(Dx);const r=Dx.x.toFixed(4),e=Dx.y.toFixed(4),i=Dx.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${r}, ${e}, ${i} );`,"	return dot( weights, rgb );","}"].join(`
`)}function mie(r){return[r.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",r.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(TA).join(`
`)}function gie(r){const e=[];for(const i in r){const n=r[i];n!==!1&&e.push("#define "+i+" "+n)}return e.join(`
`)}function Aie(r,e){const i={},n=r.getProgramParameter(e,r.ACTIVE_ATTRIBUTES);for(let s=0;s<n;s++){const o=r.getActiveAttrib(e,s),l=o.name;let u=1;o.type===r.FLOAT_MAT2&&(u=2),o.type===r.FLOAT_MAT3&&(u=3),o.type===r.FLOAT_MAT4&&(u=4),i[l]={type:o.type,location:r.getAttribLocation(e,l),locationSize:u}}return i}function TA(r){return r!==""}function Q4(r,e){const i=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return r.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function q4(r,e){return r.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const yie=/^[ \t]*#include +<([\w\d./]+)>/gm;function dT(r){return r.replace(yie,bie)}const vie=new Map;function bie(r,e){let i=un[e];if(i===void 0){const n=vie.get(e);if(n!==void 0)i=un[n],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,n);else throw new Error("Can not resolve #include <"+e+">")}return dT(i)}const xie=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function X4(r){return r.replace(xie,_ie)}function _ie(r,e,i,n){let s="";for(let o=parseInt(e);o<parseInt(i);o++)s+=n.replace(/\[\s*i\s*\]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return s}function K4(r){let e=`precision ${r.precision} float;
	precision ${r.precision} int;
	precision ${r.precision} sampler2D;
	precision ${r.precision} samplerCube;
	precision ${r.precision} sampler3D;
	precision ${r.precision} sampler2DArray;
	precision ${r.precision} sampler2DShadow;
	precision ${r.precision} samplerCubeShadow;
	precision ${r.precision} sampler2DArrayShadow;
	precision ${r.precision} isampler2D;
	precision ${r.precision} isampler3D;
	precision ${r.precision} isamplerCube;
	precision ${r.precision} isampler2DArray;
	precision ${r.precision} usampler2D;
	precision ${r.precision} usampler3D;
	precision ${r.precision} usamplerCube;
	precision ${r.precision} usampler2DArray;
	`;return r.precision==="highp"?e+=`
#define HIGH_PRECISION`:r.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:r.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function Eie(r){let e="SHADOWMAP_TYPE_BASIC";return r.shadowMapType===TP?e="SHADOWMAP_TYPE_PCF":r.shadowMapType===KY?e="SHADOWMAP_TYPE_PCF_SOFT":r.shadowMapType===Cu&&(e="SHADOWMAP_TYPE_VSM"),e}function wie(r){let e="ENVMAP_TYPE_CUBE";if(r.envMap)switch(r.envMapMode){case vm:case bm:e="ENVMAP_TYPE_CUBE";break;case tx:e="ENVMAP_TYPE_CUBE_UV";break}return e}function Cie(r){let e="ENVMAP_MODE_REFLECTION";if(r.envMap)switch(r.envMapMode){case bm:e="ENVMAP_MODE_REFRACTION";break}return e}function Sie(r){let e="ENVMAP_BLENDING_NONE";if(r.envMap)switch(r.combine){case KC:e="ENVMAP_BLENDING_MULTIPLY";break;case fJ:e="ENVMAP_BLENDING_MIX";break;case mJ:e="ENVMAP_BLENDING_ADD";break}return e}function Tie(r){const e=r.envMapCubeUVHeight;if(e===null)return null;const i=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,i),7*16)),texelHeight:n,maxMip:i}}function Mie(r,e,i,n){const s=r.getContext(),o=i.defines;let l=i.vertexShader,u=i.fragmentShader;const c=Eie(i),h=wie(i),p=Cie(i),f=Sie(i),g=Tie(i),m=mie(i),y=gie(o),b=s.createProgram();let v,_,C=i.glslVersion?"#version "+i.glslVersion+`
`:"";i.isRawShaderMaterial?(v=["#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,y].filter(TA).join(`
`),v.length>0&&(v+=`
`),_=["#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,y].filter(TA).join(`
`),_.length>0&&(_+=`
`)):(v=[K4(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,y,i.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",i.batching?"#define USE_BATCHING":"",i.batchingColor?"#define USE_BATCHING_COLOR":"",i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.instancingMorph?"#define USE_INSTANCING_MORPH":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+p:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.displacementMap?"#define USE_DISPLACEMENTMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.mapUv?"#define MAP_UV "+i.mapUv:"",i.alphaMapUv?"#define ALPHAMAP_UV "+i.alphaMapUv:"",i.lightMapUv?"#define LIGHTMAP_UV "+i.lightMapUv:"",i.aoMapUv?"#define AOMAP_UV "+i.aoMapUv:"",i.emissiveMapUv?"#define EMISSIVEMAP_UV "+i.emissiveMapUv:"",i.bumpMapUv?"#define BUMPMAP_UV "+i.bumpMapUv:"",i.normalMapUv?"#define NORMALMAP_UV "+i.normalMapUv:"",i.displacementMapUv?"#define DISPLACEMENTMAP_UV "+i.displacementMapUv:"",i.metalnessMapUv?"#define METALNESSMAP_UV "+i.metalnessMapUv:"",i.roughnessMapUv?"#define ROUGHNESSMAP_UV "+i.roughnessMapUv:"",i.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+i.anisotropyMapUv:"",i.clearcoatMapUv?"#define CLEARCOATMAP_UV "+i.clearcoatMapUv:"",i.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+i.clearcoatNormalMapUv:"",i.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+i.clearcoatRoughnessMapUv:"",i.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+i.iridescenceMapUv:"",i.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+i.iridescenceThicknessMapUv:"",i.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+i.sheenColorMapUv:"",i.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+i.sheenRoughnessMapUv:"",i.specularMapUv?"#define SPECULARMAP_UV "+i.specularMapUv:"",i.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+i.specularColorMapUv:"",i.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+i.specularIntensityMapUv:"",i.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+i.transmissionMapUv:"",i.thicknessMapUv?"#define THICKNESSMAP_UV "+i.thicknessMapUv:"",i.vertexTangents&&i.flatShading===!1?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.morphColors?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+c:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(TA).join(`
`),_=[K4(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,y,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+h:"",i.envMap?"#define "+p:"",i.envMap?"#define "+f:"",g?"#define CUBEUV_TEXEL_WIDTH "+g.texelWidth:"",g?"#define CUBEUV_TEXEL_HEIGHT "+g.texelHeight:"",g?"#define CUBEUV_MAX_MIP "+g.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.dispersion?"#define USE_DISPERSION":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.vertexTangents&&i.flatShading===!1?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor||i.batchingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+c:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==Xh?"#define TONE_MAPPING":"",i.toneMapping!==Xh?un.tonemapping_pars_fragment:"",i.toneMapping!==Xh?pie("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",un.colorspace_pars_fragment,die("linearToOutputTexel",i.outputColorSpace),fie(),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(TA).join(`
`)),l=dT(l),l=Q4(l,i),l=q4(l,i),u=dT(u),u=Q4(u,i),u=q4(u,i),l=X4(l),u=X4(u),i.isRawShaderMaterial!==!0&&(C=`#version 300 es
`,v=[m,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+v,_=["#define varying in",i.glslVersion===WP?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===WP?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+_);const E=C+v+l,T=C+_+u,R=V4(s,s.VERTEX_SHADER,E),B=V4(s,s.FRAGMENT_SHADER,T);s.attachShader(b,R),s.attachShader(b,B),i.index0AttributeName!==void 0?s.bindAttribLocation(b,0,i.index0AttributeName):i.morphTargets===!0&&s.bindAttribLocation(b,0,"position"),s.linkProgram(b);function I(F){if(r.debug.checkShaderErrors){const q=s.getProgramInfoLog(b).trim(),H=s.getShaderInfoLog(R).trim(),G=s.getShaderInfoLog(B).trim();let J=!0,Q=!0;if(s.getProgramParameter(b,s.LINK_STATUS)===!1)if(J=!1,typeof r.debug.onShaderError=="function")r.debug.onShaderError(s,b,R,B);else{const V=W4(s,R,"vertex"),z=W4(s,B,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(b,s.VALIDATE_STATUS)+`

Material Name: `+F.name+`
Material Type: `+F.type+`

Program Info Log: `+q+`
`+V+`
`+z)}else q!==""?console.warn("THREE.WebGLProgram: Program Info Log:",q):(H===""||G==="")&&(Q=!1);Q&&(F.diagnostics={runnable:J,programLog:q,vertexShader:{log:H,prefix:v},fragmentShader:{log:G,prefix:_}})}s.deleteShader(R),s.deleteShader(B),D=new Lx(s,b),L=Aie(s,b)}let D;this.getUniforms=function(){return D===void 0&&I(this),D};let L;this.getAttributes=function(){return L===void 0&&I(this),L};let O=i.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return O===!1&&(O=s.getProgramParameter(b,lie)),O},this.destroy=function(){n.releaseStatesOfProgram(this),s.deleteProgram(b),this.program=void 0},this.type=i.shaderType,this.name=i.shaderName,this.id=cie++,this.cacheKey=e,this.usedTimes=1,this.program=b,this.vertexShader=R,this.fragmentShader=B,this}let Rie=0;class Iie{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const i=e.vertexShader,n=e.fragmentShader,s=this._getShaderStage(i),o=this._getShaderStage(n),l=this._getShaderCacheForMaterial(e);return l.has(s)===!1&&(l.add(s),s.usedTimes++),l.has(o)===!1&&(l.add(o),o.usedTimes++),this}remove(e){const i=this.materialCache.get(e);for(const n of i)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const i=this.materialCache;let n=i.get(e);return n===void 0&&(n=new Set,i.set(e,n)),n}_getShaderStage(e){const i=this.shaderCache;let n=i.get(e);return n===void 0&&(n=new Bie(e),i.set(e,n)),n}}class Bie{constructor(e){this.id=Rie++,this.code=e,this.usedTimes=0}}function Nie(r,e,i,n,s,o,l){const u=new HS,c=new Iie,h=new Set,p=[],f=s.logarithmicDepthBuffer,g=s.vertexTextures;let m=s.precision;const y={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function b(L){return h.add(L),L===0?"uv":`uv${L}`}function v(L,O,F,q,H){const G=q.fog,J=H.geometry,Q=L.isMeshStandardMaterial?q.environment:null,V=(L.isMeshStandardMaterial?i:e).get(L.envMap||Q),z=V&&V.mapping===tx?V.image.height:null,te=y[L.type];L.precision!==null&&(m=s.getMaxPrecision(L.precision),m!==L.precision&&console.warn("THREE.WebGLProgram.getParameters:",L.precision,"not supported, using",m,"instead."));const K=J.morphAttributes.position||J.morphAttributes.normal||J.morphAttributes.color,ae=K!==void 0?K.length:0;let Ae=0;J.morphAttributes.position!==void 0&&(Ae=1),J.morphAttributes.normal!==void 0&&(Ae=2),J.morphAttributes.color!==void 0&&(Ae=3);let _e,me,Pe,Xe;if(te){const Fi=Qc[te];_e=Fi.vertexShader,me=Fi.fragmentShader}else _e=L.vertexShader,me=L.fragmentShader,c.update(L),Pe=c.getVertexShaderID(L),Xe=c.getFragmentShaderID(L);const Je=r.getRenderTarget(),tt=r.state.buffers.depth.getReversed(),dt=H.isInstancedMesh===!0,wt=H.isBatchedMesh===!0,qt=!!L.map,yt=!!L.matcap,Ei=!!V,$e=!!L.aoMap,Ui=!!L.lightMap,hi=!!L.bumpMap,Ri=!!L.normalMap,Si=!!L.displacementMap,Zi=!!L.emissiveMap,Vi=!!L.metalnessMap,Ge=!!L.roughnessMap,Ce=L.anisotropy>0,At=L.clearcoat>0,Pt=L.dispersion>0,$t=L.iridescence>0,Mt=L.sheen>0,yi=L.transmission>0,vt=Ce&&!!L.anisotropyMap,ye=At&&!!L.clearcoatMap,ve=At&&!!L.clearcoatNormalMap,Ne=At&&!!L.clearcoatRoughnessMap,Te=$t&&!!L.iridescenceMap,ke=$t&&!!L.iridescenceThicknessMap,Oe=Mt&&!!L.sheenColorMap,U=Mt&&!!L.sheenRoughnessMap,$=!!L.specularMap,re=!!L.specularColorMap,Re=!!L.specularIntensityMap,ce=yi&&!!L.transmissionMap,Ue=yi&&!!L.thicknessMap,je=!!L.gradientMap,pt=!!L.alphaMap,Lt=L.alphaTest>0,xt=!!L.alphaHash,Gt=!!L.extensions;let mi=Xh;L.toneMapped&&(Je===null||Je.isXRRenderTarget===!0)&&(mi=r.toneMapping);const _r={shaderID:te,shaderType:L.type,shaderName:L.name,vertexShader:_e,fragmentShader:me,defines:L.defines,customVertexShaderID:Pe,customFragmentShaderID:Xe,isRawShaderMaterial:L.isRawShaderMaterial===!0,glslVersion:L.glslVersion,precision:m,batching:wt,batchingColor:wt&&H._colorsTexture!==null,instancing:dt,instancingColor:dt&&H.instanceColor!==null,instancingMorph:dt&&H.morphTexture!==null,supportsVertexTextures:g,outputColorSpace:Je===null?r.outputColorSpace:Je.isXRRenderTarget===!0?Je.texture.colorSpace:Cm,alphaToCoverage:!!L.alphaToCoverage,map:qt,matcap:yt,envMap:Ei,envMapMode:Ei&&V.mapping,envMapCubeUVHeight:z,aoMap:$e,lightMap:Ui,bumpMap:hi,normalMap:Ri,displacementMap:g&&Si,emissiveMap:Zi,normalMapObjectSpace:Ri&&L.normalMapType===SJ,normalMapTangentSpace:Ri&&L.normalMapType===GP,metalnessMap:Vi,roughnessMap:Ge,anisotropy:Ce,anisotropyMap:vt,clearcoat:At,clearcoatMap:ye,clearcoatNormalMap:ve,clearcoatRoughnessMap:Ne,dispersion:Pt,iridescence:$t,iridescenceMap:Te,iridescenceThicknessMap:ke,sheen:Mt,sheenColorMap:Oe,sheenRoughnessMap:U,specularMap:$,specularColorMap:re,specularIntensityMap:Re,transmission:yi,transmissionMap:ce,thicknessMap:Ue,gradientMap:je,opaque:L.transparent===!1&&L.blending===Am&&L.alphaToCoverage===!1,alphaMap:pt,alphaTest:Lt,alphaHash:xt,combine:L.combine,mapUv:qt&&b(L.map.channel),aoMapUv:$e&&b(L.aoMap.channel),lightMapUv:Ui&&b(L.lightMap.channel),bumpMapUv:hi&&b(L.bumpMap.channel),normalMapUv:Ri&&b(L.normalMap.channel),displacementMapUv:Si&&b(L.displacementMap.channel),emissiveMapUv:Zi&&b(L.emissiveMap.channel),metalnessMapUv:Vi&&b(L.metalnessMap.channel),roughnessMapUv:Ge&&b(L.roughnessMap.channel),anisotropyMapUv:vt&&b(L.anisotropyMap.channel),clearcoatMapUv:ye&&b(L.clearcoatMap.channel),clearcoatNormalMapUv:ve&&b(L.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Ne&&b(L.clearcoatRoughnessMap.channel),iridescenceMapUv:Te&&b(L.iridescenceMap.channel),iridescenceThicknessMapUv:ke&&b(L.iridescenceThicknessMap.channel),sheenColorMapUv:Oe&&b(L.sheenColorMap.channel),sheenRoughnessMapUv:U&&b(L.sheenRoughnessMap.channel),specularMapUv:$&&b(L.specularMap.channel),specularColorMapUv:re&&b(L.specularColorMap.channel),specularIntensityMapUv:Re&&b(L.specularIntensityMap.channel),transmissionMapUv:ce&&b(L.transmissionMap.channel),thicknessMapUv:Ue&&b(L.thicknessMap.channel),alphaMapUv:pt&&b(L.alphaMap.channel),vertexTangents:!!J.attributes.tangent&&(Ri||Ce),vertexColors:L.vertexColors,vertexAlphas:L.vertexColors===!0&&!!J.attributes.color&&J.attributes.color.itemSize===4,pointsUvs:H.isPoints===!0&&!!J.attributes.uv&&(qt||pt),fog:!!G,useFog:L.fog===!0,fogExp2:!!G&&G.isFogExp2,flatShading:L.flatShading===!0,sizeAttenuation:L.sizeAttenuation===!0,logarithmicDepthBuffer:f,reverseDepthBuffer:tt,skinning:H.isSkinnedMesh===!0,morphTargets:J.morphAttributes.position!==void 0,morphNormals:J.morphAttributes.normal!==void 0,morphColors:J.morphAttributes.color!==void 0,morphTargetsCount:ae,morphTextureStride:Ae,numDirLights:O.directional.length,numPointLights:O.point.length,numSpotLights:O.spot.length,numSpotLightMaps:O.spotLightMap.length,numRectAreaLights:O.rectArea.length,numHemiLights:O.hemi.length,numDirLightShadows:O.directionalShadowMap.length,numPointLightShadows:O.pointShadowMap.length,numSpotLightShadows:O.spotShadowMap.length,numSpotLightShadowsWithMaps:O.numSpotLightShadowsWithMaps,numLightProbes:O.numLightProbes,numClippingPlanes:l.numPlanes,numClipIntersection:l.numIntersection,dithering:L.dithering,shadowMapEnabled:r.shadowMap.enabled&&F.length>0,shadowMapType:r.shadowMap.type,toneMapping:mi,decodeVideoTexture:qt&&L.map.isVideoTexture===!0&&Fn.getTransfer(L.map.colorSpace)===os,decodeVideoTextureEmissive:Zi&&L.emissiveMap.isVideoTexture===!0&&Fn.getTransfer(L.emissiveMap.colorSpace)===os,premultipliedAlpha:L.premultipliedAlpha,doubleSided:L.side===Su,flipSided:L.side===bo,useDepthPacking:L.depthPacking>=0,depthPacking:L.depthPacking||0,index0AttributeName:L.index0AttributeName,extensionClipCullDistance:Gt&&L.extensions.clipCullDistance===!0&&n.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(Gt&&L.extensions.multiDraw===!0||wt)&&n.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:L.customProgramCacheKey()};return _r.vertexUv1s=h.has(1),_r.vertexUv2s=h.has(2),_r.vertexUv3s=h.has(3),h.clear(),_r}function _(L){const O=[];if(L.shaderID?O.push(L.shaderID):(O.push(L.customVertexShaderID),O.push(L.customFragmentShaderID)),L.defines!==void 0)for(const F in L.defines)O.push(F),O.push(L.defines[F]);return L.isRawShaderMaterial===!1&&(C(O,L),E(O,L),O.push(r.outputColorSpace)),O.push(L.customProgramCacheKey),O.join()}function C(L,O){L.push(O.precision),L.push(O.outputColorSpace),L.push(O.envMapMode),L.push(O.envMapCubeUVHeight),L.push(O.mapUv),L.push(O.alphaMapUv),L.push(O.lightMapUv),L.push(O.aoMapUv),L.push(O.bumpMapUv),L.push(O.normalMapUv),L.push(O.displacementMapUv),L.push(O.emissiveMapUv),L.push(O.metalnessMapUv),L.push(O.roughnessMapUv),L.push(O.anisotropyMapUv),L.push(O.clearcoatMapUv),L.push(O.clearcoatNormalMapUv),L.push(O.clearcoatRoughnessMapUv),L.push(O.iridescenceMapUv),L.push(O.iridescenceThicknessMapUv),L.push(O.sheenColorMapUv),L.push(O.sheenRoughnessMapUv),L.push(O.specularMapUv),L.push(O.specularColorMapUv),L.push(O.specularIntensityMapUv),L.push(O.transmissionMapUv),L.push(O.thicknessMapUv),L.push(O.combine),L.push(O.fogExp2),L.push(O.sizeAttenuation),L.push(O.morphTargetsCount),L.push(O.morphAttributeCount),L.push(O.numDirLights),L.push(O.numPointLights),L.push(O.numSpotLights),L.push(O.numSpotLightMaps),L.push(O.numHemiLights),L.push(O.numRectAreaLights),L.push(O.numDirLightShadows),L.push(O.numPointLightShadows),L.push(O.numSpotLightShadows),L.push(O.numSpotLightShadowsWithMaps),L.push(O.numLightProbes),L.push(O.shadowMapType),L.push(O.toneMapping),L.push(O.numClippingPlanes),L.push(O.numClipIntersection),L.push(O.depthPacking)}function E(L,O){u.disableAll(),O.supportsVertexTextures&&u.enable(0),O.instancing&&u.enable(1),O.instancingColor&&u.enable(2),O.instancingMorph&&u.enable(3),O.matcap&&u.enable(4),O.envMap&&u.enable(5),O.normalMapObjectSpace&&u.enable(6),O.normalMapTangentSpace&&u.enable(7),O.clearcoat&&u.enable(8),O.iridescence&&u.enable(9),O.alphaTest&&u.enable(10),O.vertexColors&&u.enable(11),O.vertexAlphas&&u.enable(12),O.vertexUv1s&&u.enable(13),O.vertexUv2s&&u.enable(14),O.vertexUv3s&&u.enable(15),O.vertexTangents&&u.enable(16),O.anisotropy&&u.enable(17),O.alphaHash&&u.enable(18),O.batching&&u.enable(19),O.dispersion&&u.enable(20),O.batchingColor&&u.enable(21),L.push(u.mask),u.disableAll(),O.fog&&u.enable(0),O.useFog&&u.enable(1),O.flatShading&&u.enable(2),O.logarithmicDepthBuffer&&u.enable(3),O.reverseDepthBuffer&&u.enable(4),O.skinning&&u.enable(5),O.morphTargets&&u.enable(6),O.morphNormals&&u.enable(7),O.morphColors&&u.enable(8),O.premultipliedAlpha&&u.enable(9),O.shadowMapEnabled&&u.enable(10),O.doubleSided&&u.enable(11),O.flipSided&&u.enable(12),O.useDepthPacking&&u.enable(13),O.dithering&&u.enable(14),O.transmission&&u.enable(15),O.sheen&&u.enable(16),O.opaque&&u.enable(17),O.pointsUvs&&u.enable(18),O.decodeVideoTexture&&u.enable(19),O.decodeVideoTextureEmissive&&u.enable(20),O.alphaToCoverage&&u.enable(21),L.push(u.mask)}function T(L){const O=y[L.type];let F;if(O){const q=Qc[O];F=y4.clone(q.uniforms)}else F=L.uniforms;return F}function R(L,O){let F;for(let q=0,H=p.length;q<H;q++){const G=p[q];if(G.cacheKey===O){F=G,++F.usedTimes;break}}return F===void 0&&(F=new Mie(r,O,L,o),p.push(F)),F}function B(L){if(--L.usedTimes===0){const O=p.indexOf(L);p[O]=p[p.length-1],p.pop(),L.destroy()}}function I(L){c.remove(L)}function D(){c.dispose()}return{getParameters:v,getProgramCacheKey:_,getUniforms:T,acquireProgram:R,releaseProgram:B,releaseShaderCache:I,programs:p,dispose:D}}function Lie(){let r=new WeakMap;function e(l){return r.has(l)}function i(l){let u=r.get(l);return u===void 0&&(u={},r.set(l,u)),u}function n(l){r.delete(l)}function s(l,u,c){r.get(l)[u]=c}function o(){r=new WeakMap}return{has:e,get:i,remove:n,update:s,dispose:o}}function Die(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.material.id!==e.material.id?r.material.id-e.material.id:r.z!==e.z?r.z-e.z:r.id-e.id}function Y4(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.z!==e.z?e.z-r.z:r.id-e.id}function J4(){const r=[];let e=0;const i=[],n=[],s=[];function o(){e=0,i.length=0,n.length=0,s.length=0}function l(f,g,m,y,b,v){let _=r[e];return _===void 0?(_={id:f.id,object:f,geometry:g,material:m,groupOrder:y,renderOrder:f.renderOrder,z:b,group:v},r[e]=_):(_.id=f.id,_.object=f,_.geometry=g,_.material=m,_.groupOrder=y,_.renderOrder=f.renderOrder,_.z=b,_.group=v),e++,_}function u(f,g,m,y,b,v){const _=l(f,g,m,y,b,v);m.transmission>0?n.push(_):m.transparent===!0?s.push(_):i.push(_)}function c(f,g,m,y,b,v){const _=l(f,g,m,y,b,v);m.transmission>0?n.unshift(_):m.transparent===!0?s.unshift(_):i.unshift(_)}function h(f,g){i.length>1&&i.sort(f||Die),n.length>1&&n.sort(g||Y4),s.length>1&&s.sort(g||Y4)}function p(){for(let f=e,g=r.length;f<g;f++){const m=r[f];if(m.id===null)break;m.id=null,m.object=null,m.geometry=null,m.material=null,m.group=null}}return{opaque:i,transmissive:n,transparent:s,init:o,push:u,unshift:c,finish:p,sort:h}}function Oie(){let r=new WeakMap;function e(n,s){const o=r.get(n);let l;return o===void 0?(l=new J4,r.set(n,[l])):s>=o.length?(l=new J4,o.push(l)):l=o[s],l}function i(){r=new WeakMap}return{get:e,dispose:i}}function Pie(){const r={};return{get:function(e){if(r[e.id]!==void 0)return r[e.id];let i;switch(e.type){case"DirectionalLight":i={direction:new ot,color:new Sn};break;case"SpotLight":i={position:new ot,direction:new ot,color:new Sn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new ot,color:new Sn,distance:0,decay:0};break;case"HemisphereLight":i={direction:new ot,skyColor:new Sn,groundColor:new Sn};break;case"RectAreaLight":i={color:new Sn,position:new ot,halfWidth:new ot,halfHeight:new ot};break}return r[e.id]=i,i}}}function kie(){const r={};return{get:function(e){if(r[e.id]!==void 0)return r[e.id];let i;switch(e.type){case"DirectionalLight":i={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Gi};break;case"SpotLight":i={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Gi};break;case"PointLight":i={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Gi,shadowCameraNear:1,shadowCameraFar:1e3};break}return r[e.id]=i,i}}}let Fie=0;function Uie(r,e){return(e.castShadow?2:0)-(r.castShadow?2:0)+(e.map?1:0)-(r.map?1:0)}function zie(r){const e=new Pie,i=kie(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let h=0;h<9;h++)n.probe.push(new ot);const s=new ot,o=new gs,l=new gs;function u(h){let p=0,f=0,g=0;for(let L=0;L<9;L++)n.probe[L].set(0,0,0);let m=0,y=0,b=0,v=0,_=0,C=0,E=0,T=0,R=0,B=0,I=0;h.sort(Uie);for(let L=0,O=h.length;L<O;L++){const F=h[L],q=F.color,H=F.intensity,G=F.distance,J=F.shadow&&F.shadow.map?F.shadow.map.texture:null;if(F.isAmbientLight)p+=q.r*H,f+=q.g*H,g+=q.b*H;else if(F.isLightProbe){for(let Q=0;Q<9;Q++)n.probe[Q].addScaledVector(F.sh.coefficients[Q],H);I++}else if(F.isDirectionalLight){const Q=e.get(F);if(Q.color.copy(F.color).multiplyScalar(F.intensity),F.castShadow){const V=F.shadow,z=i.get(F);z.shadowIntensity=V.intensity,z.shadowBias=V.bias,z.shadowNormalBias=V.normalBias,z.shadowRadius=V.radius,z.shadowMapSize=V.mapSize,n.directionalShadow[m]=z,n.directionalShadowMap[m]=J,n.directionalShadowMatrix[m]=F.shadow.matrix,C++}n.directional[m]=Q,m++}else if(F.isSpotLight){const Q=e.get(F);Q.position.setFromMatrixPosition(F.matrixWorld),Q.color.copy(q).multiplyScalar(H),Q.distance=G,Q.coneCos=Math.cos(F.angle),Q.penumbraCos=Math.cos(F.angle*(1-F.penumbra)),Q.decay=F.decay,n.spot[b]=Q;const V=F.shadow;if(F.map&&(n.spotLightMap[R]=F.map,R++,V.updateMatrices(F),F.castShadow&&B++),n.spotLightMatrix[b]=V.matrix,F.castShadow){const z=i.get(F);z.shadowIntensity=V.intensity,z.shadowBias=V.bias,z.shadowNormalBias=V.normalBias,z.shadowRadius=V.radius,z.shadowMapSize=V.mapSize,n.spotShadow[b]=z,n.spotShadowMap[b]=J,T++}b++}else if(F.isRectAreaLight){const Q=e.get(F);Q.color.copy(q).multiplyScalar(H),Q.halfWidth.set(F.width*.5,0,0),Q.halfHeight.set(0,F.height*.5,0),n.rectArea[v]=Q,v++}else if(F.isPointLight){const Q=e.get(F);if(Q.color.copy(F.color).multiplyScalar(F.intensity),Q.distance=F.distance,Q.decay=F.decay,F.castShadow){const V=F.shadow,z=i.get(F);z.shadowIntensity=V.intensity,z.shadowBias=V.bias,z.shadowNormalBias=V.normalBias,z.shadowRadius=V.radius,z.shadowMapSize=V.mapSize,z.shadowCameraNear=V.camera.near,z.shadowCameraFar=V.camera.far,n.pointShadow[y]=z,n.pointShadowMap[y]=J,n.pointShadowMatrix[y]=F.shadow.matrix,E++}n.point[y]=Q,y++}else if(F.isHemisphereLight){const Q=e.get(F);Q.skyColor.copy(F.color).multiplyScalar(H),Q.groundColor.copy(F.groundColor).multiplyScalar(H),n.hemi[_]=Q,_++}}v>0&&(r.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=Ki.LTC_FLOAT_1,n.rectAreaLTC2=Ki.LTC_FLOAT_2):(n.rectAreaLTC1=Ki.LTC_HALF_1,n.rectAreaLTC2=Ki.LTC_HALF_2)),n.ambient[0]=p,n.ambient[1]=f,n.ambient[2]=g;const D=n.hash;(D.directionalLength!==m||D.pointLength!==y||D.spotLength!==b||D.rectAreaLength!==v||D.hemiLength!==_||D.numDirectionalShadows!==C||D.numPointShadows!==E||D.numSpotShadows!==T||D.numSpotMaps!==R||D.numLightProbes!==I)&&(n.directional.length=m,n.spot.length=b,n.rectArea.length=v,n.point.length=y,n.hemi.length=_,n.directionalShadow.length=C,n.directionalShadowMap.length=C,n.pointShadow.length=E,n.pointShadowMap.length=E,n.spotShadow.length=T,n.spotShadowMap.length=T,n.directionalShadowMatrix.length=C,n.pointShadowMatrix.length=E,n.spotLightMatrix.length=T+R-B,n.spotLightMap.length=R,n.numSpotLightShadowsWithMaps=B,n.numLightProbes=I,D.directionalLength=m,D.pointLength=y,D.spotLength=b,D.rectAreaLength=v,D.hemiLength=_,D.numDirectionalShadows=C,D.numPointShadows=E,D.numSpotShadows=T,D.numSpotMaps=R,D.numLightProbes=I,n.version=Fie++)}function c(h,p){let f=0,g=0,m=0,y=0,b=0;const v=p.matrixWorldInverse;for(let _=0,C=h.length;_<C;_++){const E=h[_];if(E.isDirectionalLight){const T=n.directional[f];T.direction.setFromMatrixPosition(E.matrixWorld),s.setFromMatrixPosition(E.target.matrixWorld),T.direction.sub(s),T.direction.transformDirection(v),f++}else if(E.isSpotLight){const T=n.spot[m];T.position.setFromMatrixPosition(E.matrixWorld),T.position.applyMatrix4(v),T.direction.setFromMatrixPosition(E.matrixWorld),s.setFromMatrixPosition(E.target.matrixWorld),T.direction.sub(s),T.direction.transformDirection(v),m++}else if(E.isRectAreaLight){const T=n.rectArea[y];T.position.setFromMatrixPosition(E.matrixWorld),T.position.applyMatrix4(v),l.identity(),o.copy(E.matrixWorld),o.premultiply(v),l.extractRotation(o),T.halfWidth.set(E.width*.5,0,0),T.halfHeight.set(0,E.height*.5,0),T.halfWidth.applyMatrix4(l),T.halfHeight.applyMatrix4(l),y++}else if(E.isPointLight){const T=n.point[g];T.position.setFromMatrixPosition(E.matrixWorld),T.position.applyMatrix4(v),g++}else if(E.isHemisphereLight){const T=n.hemi[b];T.direction.setFromMatrixPosition(E.matrixWorld),T.direction.transformDirection(v),b++}}}return{setup:u,setupView:c,state:n}}function Z4(r){const e=new zie(r),i=[],n=[];function s(p){h.camera=p,i.length=0,n.length=0}function o(p){i.push(p)}function l(p){n.push(p)}function u(){e.setup(i)}function c(p){e.setupView(i,p)}const h={lightsArray:i,shadowsArray:n,camera:null,lights:e,transmissionRenderTarget:{}};return{init:s,state:h,setupLights:u,setupLightsView:c,pushLight:o,pushShadow:l}}function jie(r){let e=new WeakMap;function i(s,o=0){const l=e.get(s);let u;return l===void 0?(u=new Z4(r),e.set(s,[u])):o>=l.length?(u=new Z4(r),l.push(u)):u=l[o],u}function n(){e=new WeakMap}return{get:i,dispose:n}}class Gie extends xp{static get type(){return"MeshDepthMaterial"}constructor(e){super(),this.isMeshDepthMaterial=!0,this.depthPacking=wJ,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class Vie extends xp{static get type(){return"MeshDistanceMaterial"}constructor(e){super(),this.isMeshDistanceMaterial=!0,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const Hie=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,Wie=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Qie(r,e,i){let n=new rT;const s=new Gi,o=new Gi,l=new Zs,u=new Gie({depthPacking:CJ}),c=new Vie,h={},p=i.maxTextureSize,f={[qh]:bo,[bo]:qh,[Su]:Su},g=new Wc({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Gi},radius:{value:4}},vertexShader:Hie,fragmentShader:Wie}),m=g.clone();m.defines.HORIZONTAL_PASS=1;const y=new Vo;y.setAttribute("position",new Go(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const b=new za(y,g),v=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=TP;let _=this.type;this.render=function(B,I,D){if(v.enabled===!1||v.autoUpdate===!1&&v.needsUpdate===!1||B.length===0)return;const L=r.getRenderTarget(),O=r.getActiveCubeFace(),F=r.getActiveMipmapLevel(),q=r.state;q.setBlending(Tu),q.buffers.color.setClear(1,1,1,1),q.buffers.depth.setTest(!0),q.setScissorTest(!1);const H=_!==Cu&&this.type===Cu,G=_===Cu&&this.type!==Cu;for(let J=0,Q=B.length;J<Q;J++){const V=B[J],z=V.shadow;if(z===void 0){console.warn("THREE.WebGLShadowMap:",V,"has no shadow.");continue}if(z.autoUpdate===!1&&z.needsUpdate===!1)continue;s.copy(z.mapSize);const te=z.getFrameExtents();if(s.multiply(te),o.copy(z.mapSize),(s.x>p||s.y>p)&&(s.x>p&&(o.x=Math.floor(p/te.x),s.x=o.x*te.x,z.mapSize.x=o.x),s.y>p&&(o.y=Math.floor(p/te.y),s.y=o.y*te.y,z.mapSize.y=o.y)),z.map===null||H===!0||G===!0){const ae=this.type!==Cu?{minFilter:nc,magFilter:nc}:{};z.map!==null&&z.map.dispose(),z.map=new Yh(s.x,s.y,ae),z.map.texture.name=V.name+".shadowMap",z.camera.updateProjectionMatrix()}r.setRenderTarget(z.map),r.clear();const K=z.getViewportCount();for(let ae=0;ae<K;ae++){const Ae=z.getViewport(ae);l.set(o.x*Ae.x,o.y*Ae.y,o.x*Ae.z,o.y*Ae.w),q.viewport(l),z.updateMatrices(V,ae),n=z.getFrustum(),T(I,D,z.camera,V,this.type)}z.isPointLightShadow!==!0&&this.type===Cu&&C(z,D),z.needsUpdate=!1}_=this.type,v.needsUpdate=!1,r.setRenderTarget(L,O,F)};function C(B,I){const D=e.update(b);g.defines.VSM_SAMPLES!==B.blurSamples&&(g.defines.VSM_SAMPLES=B.blurSamples,m.defines.VSM_SAMPLES=B.blurSamples,g.needsUpdate=!0,m.needsUpdate=!0),B.mapPass===null&&(B.mapPass=new Yh(s.x,s.y)),g.uniforms.shadow_pass.value=B.map.texture,g.uniforms.resolution.value=B.mapSize,g.uniforms.radius.value=B.radius,r.setRenderTarget(B.mapPass),r.clear(),r.renderBufferDirect(I,null,D,g,b,null),m.uniforms.shadow_pass.value=B.mapPass.texture,m.uniforms.resolution.value=B.mapSize,m.uniforms.radius.value=B.radius,r.setRenderTarget(B.map),r.clear(),r.renderBufferDirect(I,null,D,m,b,null)}function E(B,I,D,L){let O=null;const F=D.isPointLight===!0?B.customDistanceMaterial:B.customDepthMaterial;if(F!==void 0)O=F;else if(O=D.isPointLight===!0?c:u,r.localClippingEnabled&&I.clipShadows===!0&&Array.isArray(I.clippingPlanes)&&I.clippingPlanes.length!==0||I.displacementMap&&I.displacementScale!==0||I.alphaMap&&I.alphaTest>0||I.map&&I.alphaTest>0){const q=O.uuid,H=I.uuid;let G=h[q];G===void 0&&(G={},h[q]=G);let J=G[H];J===void 0&&(J=O.clone(),G[H]=J,I.addEventListener("dispose",R)),O=J}if(O.visible=I.visible,O.wireframe=I.wireframe,L===Cu?O.side=I.shadowSide!==null?I.shadowSide:I.side:O.side=I.shadowSide!==null?I.shadowSide:f[I.side],O.alphaMap=I.alphaMap,O.alphaTest=I.alphaTest,O.map=I.map,O.clipShadows=I.clipShadows,O.clippingPlanes=I.clippingPlanes,O.clipIntersection=I.clipIntersection,O.displacementMap=I.displacementMap,O.displacementScale=I.displacementScale,O.displacementBias=I.displacementBias,O.wireframeLinewidth=I.wireframeLinewidth,O.linewidth=I.linewidth,D.isPointLight===!0&&O.isMeshDistanceMaterial===!0){const q=r.properties.get(O);q.light=D}return O}function T(B,I,D,L,O){if(B.visible===!1)return;if(B.layers.test(I.layers)&&(B.isMesh||B.isLine||B.isPoints)&&(B.castShadow||B.receiveShadow&&O===Cu)&&(!B.frustumCulled||n.intersectsObject(B))){B.modelViewMatrix.multiplyMatrices(D.matrixWorldInverse,B.matrixWorld);const q=e.update(B),H=B.material;if(Array.isArray(H)){const G=q.groups;for(let J=0,Q=G.length;J<Q;J++){const V=G[J],z=H[V.materialIndex];if(z&&z.visible){const te=E(B,z,L,O);B.onBeforeShadow(r,B,I,D,q,te,V),r.renderBufferDirect(D,null,q,te,B,V),B.onAfterShadow(r,B,I,D,q,te,V)}}}else if(H.visible){const G=E(B,H,L,O);B.onBeforeShadow(r,B,I,D,q,G,null),r.renderBufferDirect(D,null,q,G,B,null),B.onAfterShadow(r,B,I,D,q,G,null)}}const F=B.children;for(let q=0,H=F.length;q<H;q++)T(F[q],I,D,L,O)}function R(B){B.target.removeEventListener("dispose",R);for(const I in h){const D=h[I],L=B.target.uuid;L in D&&(D[L].dispose(),delete D[L])}}}const qie={[GC]:VC,[HC]:qC,[WC]:XC,[ym]:QC,[VC]:GC,[qC]:HC,[XC]:WC,[QC]:ym};function Xie(r,e){function i(){let ce=!1;const Ue=new Zs;let je=null;const pt=new Zs(0,0,0,0);return{setMask:function(Lt){je!==Lt&&!ce&&(r.colorMask(Lt,Lt,Lt,Lt),je=Lt)},setLocked:function(Lt){ce=Lt},setClear:function(Lt,xt,Gt,mi,_r){_r===!0&&(Lt*=mi,xt*=mi,Gt*=mi),Ue.set(Lt,xt,Gt,mi),pt.equals(Ue)===!1&&(r.clearColor(Lt,xt,Gt,mi),pt.copy(Ue))},reset:function(){ce=!1,je=null,pt.set(-1,0,0,0)}}}function n(){let ce=!1,Ue=!1,je=null,pt=null,Lt=null;return{setReversed:function(xt){if(Ue!==xt){const Gt=e.get("EXT_clip_control");Ue?Gt.clipControlEXT(Gt.LOWER_LEFT_EXT,Gt.ZERO_TO_ONE_EXT):Gt.clipControlEXT(Gt.LOWER_LEFT_EXT,Gt.NEGATIVE_ONE_TO_ONE_EXT);const mi=Lt;Lt=null,this.setClear(mi)}Ue=xt},getReversed:function(){return Ue},setTest:function(xt){xt?Je(r.DEPTH_TEST):tt(r.DEPTH_TEST)},setMask:function(xt){je!==xt&&!ce&&(r.depthMask(xt),je=xt)},setFunc:function(xt){if(Ue&&(xt=qie[xt]),pt!==xt){switch(xt){case GC:r.depthFunc(r.NEVER);break;case VC:r.depthFunc(r.ALWAYS);break;case HC:r.depthFunc(r.LESS);break;case ym:r.depthFunc(r.LEQUAL);break;case WC:r.depthFunc(r.EQUAL);break;case QC:r.depthFunc(r.GEQUAL);break;case qC:r.depthFunc(r.GREATER);break;case XC:r.depthFunc(r.NOTEQUAL);break;default:r.depthFunc(r.LEQUAL)}pt=xt}},setLocked:function(xt){ce=xt},setClear:function(xt){Lt!==xt&&(Ue&&(xt=1-xt),r.clearDepth(xt),Lt=xt)},reset:function(){ce=!1,je=null,pt=null,Lt=null,Ue=!1}}}function s(){let ce=!1,Ue=null,je=null,pt=null,Lt=null,xt=null,Gt=null,mi=null,_r=null;return{setTest:function(Fi){ce||(Fi?Je(r.STENCIL_TEST):tt(r.STENCIL_TEST))},setMask:function(Fi){Ue!==Fi&&!ce&&(r.stencilMask(Fi),Ue=Fi)},setFunc:function(Fi,gn,kr){(je!==Fi||pt!==gn||Lt!==kr)&&(r.stencilFunc(Fi,gn,kr),je=Fi,pt=gn,Lt=kr)},setOp:function(Fi,gn,kr){(xt!==Fi||Gt!==gn||mi!==kr)&&(r.stencilOp(Fi,gn,kr),xt=Fi,Gt=gn,mi=kr)},setLocked:function(Fi){ce=Fi},setClear:function(Fi){_r!==Fi&&(r.clearStencil(Fi),_r=Fi)},reset:function(){ce=!1,Ue=null,je=null,pt=null,Lt=null,xt=null,Gt=null,mi=null,_r=null}}}const o=new i,l=new n,u=new s,c=new WeakMap,h=new WeakMap;let p={},f={},g=new WeakMap,m=[],y=null,b=!1,v=null,_=null,C=null,E=null,T=null,R=null,B=null,I=new Sn(0,0,0),D=0,L=!1,O=null,F=null,q=null,H=null,G=null;const J=r.getParameter(r.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let Q=!1,V=0;const z=r.getParameter(r.VERSION);z.indexOf("WebGL")!==-1?(V=parseFloat(/^WebGL (\d)/.exec(z)[1]),Q=V>=1):z.indexOf("OpenGL ES")!==-1&&(V=parseFloat(/^OpenGL ES (\d)/.exec(z)[1]),Q=V>=2);let te=null,K={};const ae=r.getParameter(r.SCISSOR_BOX),Ae=r.getParameter(r.VIEWPORT),_e=new Zs().fromArray(ae),me=new Zs().fromArray(Ae);function Pe(ce,Ue,je,pt){const Lt=new Uint8Array(4),xt=r.createTexture();r.bindTexture(ce,xt),r.texParameteri(ce,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(ce,r.TEXTURE_MAG_FILTER,r.NEAREST);for(let Gt=0;Gt<je;Gt++)ce===r.TEXTURE_3D||ce===r.TEXTURE_2D_ARRAY?r.texImage3D(Ue,0,r.RGBA,1,1,pt,0,r.RGBA,r.UNSIGNED_BYTE,Lt):r.texImage2D(Ue+Gt,0,r.RGBA,1,1,0,r.RGBA,r.UNSIGNED_BYTE,Lt);return xt}const Xe={};Xe[r.TEXTURE_2D]=Pe(r.TEXTURE_2D,r.TEXTURE_2D,1),Xe[r.TEXTURE_CUBE_MAP]=Pe(r.TEXTURE_CUBE_MAP,r.TEXTURE_CUBE_MAP_POSITIVE_X,6),Xe[r.TEXTURE_2D_ARRAY]=Pe(r.TEXTURE_2D_ARRAY,r.TEXTURE_2D_ARRAY,1,1),Xe[r.TEXTURE_3D]=Pe(r.TEXTURE_3D,r.TEXTURE_3D,1,1),o.setClear(0,0,0,1),l.setClear(1),u.setClear(0),Je(r.DEPTH_TEST),l.setFunc(ym),hi(!1),Ri(SP),Je(r.CULL_FACE),$e(Tu);function Je(ce){p[ce]!==!0&&(r.enable(ce),p[ce]=!0)}function tt(ce){p[ce]!==!1&&(r.disable(ce),p[ce]=!1)}function dt(ce,Ue){return f[ce]!==Ue?(r.bindFramebuffer(ce,Ue),f[ce]=Ue,ce===r.DRAW_FRAMEBUFFER&&(f[r.FRAMEBUFFER]=Ue),ce===r.FRAMEBUFFER&&(f[r.DRAW_FRAMEBUFFER]=Ue),!0):!1}function wt(ce,Ue){let je=m,pt=!1;if(ce){je=g.get(Ue),je===void 0&&(je=[],g.set(Ue,je));const Lt=ce.textures;if(je.length!==Lt.length||je[0]!==r.COLOR_ATTACHMENT0){for(let xt=0,Gt=Lt.length;xt<Gt;xt++)je[xt]=r.COLOR_ATTACHMENT0+xt;je.length=Lt.length,pt=!0}}else je[0]!==r.BACK&&(je[0]=r.BACK,pt=!0);pt&&r.drawBuffers(je)}function qt(ce){return y!==ce?(r.useProgram(ce),y=ce,!0):!1}const yt={[dp]:r.FUNC_ADD,[JY]:r.FUNC_SUBTRACT,[ZY]:r.FUNC_REVERSE_SUBTRACT};yt[$Y]=r.MIN,yt[eJ]=r.MAX;const Ei={[tJ]:r.ZERO,[iJ]:r.ONE,[rJ]:r.SRC_COLOR,[zC]:r.SRC_ALPHA,[cJ]:r.SRC_ALPHA_SATURATE,[oJ]:r.DST_COLOR,[sJ]:r.DST_ALPHA,[nJ]:r.ONE_MINUS_SRC_COLOR,[jC]:r.ONE_MINUS_SRC_ALPHA,[lJ]:r.ONE_MINUS_DST_COLOR,[aJ]:r.ONE_MINUS_DST_ALPHA,[uJ]:r.CONSTANT_COLOR,[hJ]:r.ONE_MINUS_CONSTANT_COLOR,[dJ]:r.CONSTANT_ALPHA,[pJ]:r.ONE_MINUS_CONSTANT_ALPHA};function $e(ce,Ue,je,pt,Lt,xt,Gt,mi,_r,Fi){if(ce===Tu){b===!0&&(tt(r.BLEND),b=!1);return}if(b===!1&&(Je(r.BLEND),b=!0),ce!==YY){if(ce!==v||Fi!==L){if((_!==dp||T!==dp)&&(r.blendEquation(r.FUNC_ADD),_=dp,T=dp),Fi)switch(ce){case Am:r.blendFuncSeparate(r.ONE,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA);break;case MP:r.blendFunc(r.ONE,r.ONE);break;case RP:r.blendFuncSeparate(r.ZERO,r.ONE_MINUS_SRC_COLOR,r.ZERO,r.ONE);break;case IP:r.blendFuncSeparate(r.ZERO,r.SRC_COLOR,r.ZERO,r.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",ce);break}else switch(ce){case Am:r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA);break;case MP:r.blendFunc(r.SRC_ALPHA,r.ONE);break;case RP:r.blendFuncSeparate(r.ZERO,r.ONE_MINUS_SRC_COLOR,r.ZERO,r.ONE);break;case IP:r.blendFunc(r.ZERO,r.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",ce);break}C=null,E=null,R=null,B=null,I.set(0,0,0),D=0,v=ce,L=Fi}return}Lt=Lt||Ue,xt=xt||je,Gt=Gt||pt,(Ue!==_||Lt!==T)&&(r.blendEquationSeparate(yt[Ue],yt[Lt]),_=Ue,T=Lt),(je!==C||pt!==E||xt!==R||Gt!==B)&&(r.blendFuncSeparate(Ei[je],Ei[pt],Ei[xt],Ei[Gt]),C=je,E=pt,R=xt,B=Gt),(mi.equals(I)===!1||_r!==D)&&(r.blendColor(mi.r,mi.g,mi.b,_r),I.copy(mi),D=_r),v=ce,L=!1}function Ui(ce,Ue){ce.side===Su?tt(r.CULL_FACE):Je(r.CULL_FACE);let je=ce.side===bo;Ue&&(je=!je),hi(je),ce.blending===Am&&ce.transparent===!1?$e(Tu):$e(ce.blending,ce.blendEquation,ce.blendSrc,ce.blendDst,ce.blendEquationAlpha,ce.blendSrcAlpha,ce.blendDstAlpha,ce.blendColor,ce.blendAlpha,ce.premultipliedAlpha),l.setFunc(ce.depthFunc),l.setTest(ce.depthTest),l.setMask(ce.depthWrite),o.setMask(ce.colorWrite);const pt=ce.stencilWrite;u.setTest(pt),pt&&(u.setMask(ce.stencilWriteMask),u.setFunc(ce.stencilFunc,ce.stencilRef,ce.stencilFuncMask),u.setOp(ce.stencilFail,ce.stencilZFail,ce.stencilZPass)),Zi(ce.polygonOffset,ce.polygonOffsetFactor,ce.polygonOffsetUnits),ce.alphaToCoverage===!0?Je(r.SAMPLE_ALPHA_TO_COVERAGE):tt(r.SAMPLE_ALPHA_TO_COVERAGE)}function hi(ce){O!==ce&&(ce?r.frontFace(r.CW):r.frontFace(r.CCW),O=ce)}function Ri(ce){ce!==qY?(Je(r.CULL_FACE),ce!==F&&(ce===SP?r.cullFace(r.BACK):ce===XY?r.cullFace(r.FRONT):r.cullFace(r.FRONT_AND_BACK))):tt(r.CULL_FACE),F=ce}function Si(ce){ce!==q&&(Q&&r.lineWidth(ce),q=ce)}function Zi(ce,Ue,je){ce?(Je(r.POLYGON_OFFSET_FILL),(H!==Ue||G!==je)&&(r.polygonOffset(Ue,je),H=Ue,G=je)):tt(r.POLYGON_OFFSET_FILL)}function Vi(ce){ce?Je(r.SCISSOR_TEST):tt(r.SCISSOR_TEST)}function Ge(ce){ce===void 0&&(ce=r.TEXTURE0+J-1),te!==ce&&(r.activeTexture(ce),te=ce)}function Ce(ce,Ue,je){je===void 0&&(te===null?je=r.TEXTURE0+J-1:je=te);let pt=K[je];pt===void 0&&(pt={type:void 0,texture:void 0},K[je]=pt),(pt.type!==ce||pt.texture!==Ue)&&(te!==je&&(r.activeTexture(je),te=je),r.bindTexture(ce,Ue||Xe[ce]),pt.type=ce,pt.texture=Ue)}function At(){const ce=K[te];ce!==void 0&&ce.type!==void 0&&(r.bindTexture(ce.type,null),ce.type=void 0,ce.texture=void 0)}function Pt(){try{r.compressedTexImage2D.apply(r,arguments)}catch(ce){console.error("THREE.WebGLState:",ce)}}function $t(){try{r.compressedTexImage3D.apply(r,arguments)}catch(ce){console.error("THREE.WebGLState:",ce)}}function Mt(){try{r.texSubImage2D.apply(r,arguments)}catch(ce){console.error("THREE.WebGLState:",ce)}}function yi(){try{r.texSubImage3D.apply(r,arguments)}catch(ce){console.error("THREE.WebGLState:",ce)}}function vt(){try{r.compressedTexSubImage2D.apply(r,arguments)}catch(ce){console.error("THREE.WebGLState:",ce)}}function ye(){try{r.compressedTexSubImage3D.apply(r,arguments)}catch(ce){console.error("THREE.WebGLState:",ce)}}function ve(){try{r.texStorage2D.apply(r,arguments)}catch(ce){console.error("THREE.WebGLState:",ce)}}function Ne(){try{r.texStorage3D.apply(r,arguments)}catch(ce){console.error("THREE.WebGLState:",ce)}}function Te(){try{r.texImage2D.apply(r,arguments)}catch(ce){console.error("THREE.WebGLState:",ce)}}function ke(){try{r.texImage3D.apply(r,arguments)}catch(ce){console.error("THREE.WebGLState:",ce)}}function Oe(ce){_e.equals(ce)===!1&&(r.scissor(ce.x,ce.y,ce.z,ce.w),_e.copy(ce))}function U(ce){me.equals(ce)===!1&&(r.viewport(ce.x,ce.y,ce.z,ce.w),me.copy(ce))}function $(ce,Ue){let je=h.get(Ue);je===void 0&&(je=new WeakMap,h.set(Ue,je));let pt=je.get(ce);pt===void 0&&(pt=r.getUniformBlockIndex(Ue,ce.name),je.set(ce,pt))}function re(ce,Ue){const je=h.get(Ue).get(ce);c.get(Ue)!==je&&(r.uniformBlockBinding(Ue,je,ce.__bindingPointIndex),c.set(Ue,je))}function Re(){r.disable(r.BLEND),r.disable(r.CULL_FACE),r.disable(r.DEPTH_TEST),r.disable(r.POLYGON_OFFSET_FILL),r.disable(r.SCISSOR_TEST),r.disable(r.STENCIL_TEST),r.disable(r.SAMPLE_ALPHA_TO_COVERAGE),r.blendEquation(r.FUNC_ADD),r.blendFunc(r.ONE,r.ZERO),r.blendFuncSeparate(r.ONE,r.ZERO,r.ONE,r.ZERO),r.blendColor(0,0,0,0),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0),r.depthMask(!0),r.depthFunc(r.LESS),l.setReversed(!1),r.clearDepth(1),r.stencilMask(4294967295),r.stencilFunc(r.ALWAYS,0,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.KEEP),r.clearStencil(0),r.cullFace(r.BACK),r.frontFace(r.CCW),r.polygonOffset(0,0),r.activeTexture(r.TEXTURE0),r.bindFramebuffer(r.FRAMEBUFFER,null),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,null),r.bindFramebuffer(r.READ_FRAMEBUFFER,null),r.useProgram(null),r.lineWidth(1),r.scissor(0,0,r.canvas.width,r.canvas.height),r.viewport(0,0,r.canvas.width,r.canvas.height),p={},te=null,K={},f={},g=new WeakMap,m=[],y=null,b=!1,v=null,_=null,C=null,E=null,T=null,R=null,B=null,I=new Sn(0,0,0),D=0,L=!1,O=null,F=null,q=null,H=null,G=null,_e.set(0,0,r.canvas.width,r.canvas.height),me.set(0,0,r.canvas.width,r.canvas.height),o.reset(),l.reset(),u.reset()}return{buffers:{color:o,depth:l,stencil:u},enable:Je,disable:tt,bindFramebuffer:dt,drawBuffers:wt,useProgram:qt,setBlending:$e,setMaterial:Ui,setFlipSided:hi,setCullFace:Ri,setLineWidth:Si,setPolygonOffset:Zi,setScissorTest:Vi,activeTexture:Ge,bindTexture:Ce,unbindTexture:At,compressedTexImage2D:Pt,compressedTexImage3D:$t,texImage2D:Te,texImage3D:ke,updateUBOMapping:$,uniformBlockBinding:re,texStorage2D:ve,texStorage3D:Ne,texSubImage2D:Mt,texSubImage3D:yi,compressedTexSubImage2D:vt,compressedTexSubImage3D:ye,scissor:Oe,viewport:U,reset:Re}}function $4(r,e,i,n){const s=Kie(n);switch(i){case OP:return r*e;case kP:return r*e;case FP:return r*e*2;case UP:return r*e/s.components*s.byteLength;case nS:return r*e/s.components*s.byteLength;case zP:return r*e*2/s.components*s.byteLength;case sS:return r*e*2/s.components*s.byteLength;case PP:return r*e*3/s.components*s.byteLength;case sc:return r*e*4/s.components*s.byteLength;case aS:return r*e*4/s.components*s.byteLength;case rx:case nx:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*8;case sx:case ax:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*16;case lS:case uS:return Math.max(r,16)*Math.max(e,8)/4;case oS:case cS:return Math.max(r,8)*Math.max(e,8)/2;case hS:case dS:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*8;case pS:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*16;case fS:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*16;case mS:return Math.floor((r+4)/5)*Math.floor((e+3)/4)*16;case gS:return Math.floor((r+4)/5)*Math.floor((e+4)/5)*16;case AS:return Math.floor((r+5)/6)*Math.floor((e+4)/5)*16;case yS:return Math.floor((r+5)/6)*Math.floor((e+5)/6)*16;case vS:return Math.floor((r+7)/8)*Math.floor((e+4)/5)*16;case bS:return Math.floor((r+7)/8)*Math.floor((e+5)/6)*16;case xS:return Math.floor((r+7)/8)*Math.floor((e+7)/8)*16;case _S:return Math.floor((r+9)/10)*Math.floor((e+4)/5)*16;case ES:return Math.floor((r+9)/10)*Math.floor((e+5)/6)*16;case wS:return Math.floor((r+9)/10)*Math.floor((e+7)/8)*16;case CS:return Math.floor((r+9)/10)*Math.floor((e+9)/10)*16;case SS:return Math.floor((r+11)/12)*Math.floor((e+9)/10)*16;case TS:return Math.floor((r+11)/12)*Math.floor((e+11)/12)*16;case ox:case MS:case RS:return Math.ceil(r/4)*Math.ceil(e/4)*16;case jP:case IS:return Math.ceil(r/4)*Math.ceil(e/4)*8;case BS:case NS:return Math.ceil(r/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${i} format.`)}function Kie(r){switch(r){case Mu:case NP:return{byteLength:1,components:1};case AA:case LP:case xm:return{byteLength:2,components:1};case iS:case rS:return{byteLength:2,components:4};case mp:case tS:case Ru:return{byteLength:4,components:1};case DP:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${r}.`)}function Yie(r,e,i,n,s,o,l){const u=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,c=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),h=new Gi,p=new WeakMap;let f;const g=new WeakMap;let m=!1;try{m=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function y(Ge,Ce){return m?new OffscreenCanvas(Ge,Ce):xA("canvas")}function b(Ge,Ce,At){let Pt=1;const $t=Vi(Ge);if(($t.width>At||$t.height>At)&&(Pt=At/Math.max($t.width,$t.height)),Pt<1)if(typeof HTMLImageElement<"u"&&Ge instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Ge instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Ge instanceof ImageBitmap||typeof VideoFrame<"u"&&Ge instanceof VideoFrame){const Mt=Math.floor(Pt*$t.width),yi=Math.floor(Pt*$t.height);f===void 0&&(f=y(Mt,yi));const vt=Ce?y(Mt,yi):f;return vt.width=Mt,vt.height=yi,vt.getContext("2d").drawImage(Ge,0,0,Mt,yi),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+$t.width+"x"+$t.height+") to ("+Mt+"x"+yi+")."),vt}else return"data"in Ge&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+$t.width+"x"+$t.height+")."),Ge;return Ge}function v(Ge){return Ge.generateMipmaps}function _(Ge){r.generateMipmap(Ge)}function C(Ge){return Ge.isWebGLCubeRenderTarget?r.TEXTURE_CUBE_MAP:Ge.isWebGL3DRenderTarget?r.TEXTURE_3D:Ge.isWebGLArrayRenderTarget||Ge.isCompressedArrayTexture?r.TEXTURE_2D_ARRAY:r.TEXTURE_2D}function E(Ge,Ce,At,Pt,$t=!1){if(Ge!==null){if(r[Ge]!==void 0)return r[Ge];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Ge+"'")}let Mt=Ce;if(Ce===r.RED&&(At===r.FLOAT&&(Mt=r.R32F),At===r.HALF_FLOAT&&(Mt=r.R16F),At===r.UNSIGNED_BYTE&&(Mt=r.R8)),Ce===r.RED_INTEGER&&(At===r.UNSIGNED_BYTE&&(Mt=r.R8UI),At===r.UNSIGNED_SHORT&&(Mt=r.R16UI),At===r.UNSIGNED_INT&&(Mt=r.R32UI),At===r.BYTE&&(Mt=r.R8I),At===r.SHORT&&(Mt=r.R16I),At===r.INT&&(Mt=r.R32I)),Ce===r.RG&&(At===r.FLOAT&&(Mt=r.RG32F),At===r.HALF_FLOAT&&(Mt=r.RG16F),At===r.UNSIGNED_BYTE&&(Mt=r.RG8)),Ce===r.RG_INTEGER&&(At===r.UNSIGNED_BYTE&&(Mt=r.RG8UI),At===r.UNSIGNED_SHORT&&(Mt=r.RG16UI),At===r.UNSIGNED_INT&&(Mt=r.RG32UI),At===r.BYTE&&(Mt=r.RG8I),At===r.SHORT&&(Mt=r.RG16I),At===r.INT&&(Mt=r.RG32I)),Ce===r.RGB_INTEGER&&(At===r.UNSIGNED_BYTE&&(Mt=r.RGB8UI),At===r.UNSIGNED_SHORT&&(Mt=r.RGB16UI),At===r.UNSIGNED_INT&&(Mt=r.RGB32UI),At===r.BYTE&&(Mt=r.RGB8I),At===r.SHORT&&(Mt=r.RGB16I),At===r.INT&&(Mt=r.RGB32I)),Ce===r.RGBA_INTEGER&&(At===r.UNSIGNED_BYTE&&(Mt=r.RGBA8UI),At===r.UNSIGNED_SHORT&&(Mt=r.RGBA16UI),At===r.UNSIGNED_INT&&(Mt=r.RGBA32UI),At===r.BYTE&&(Mt=r.RGBA8I),At===r.SHORT&&(Mt=r.RGBA16I),At===r.INT&&(Mt=r.RGBA32I)),Ce===r.RGB&&At===r.UNSIGNED_INT_5_9_9_9_REV&&(Mt=r.RGB9_E5),Ce===r.RGBA){const yi=$t?lx:Fn.getTransfer(Pt);At===r.FLOAT&&(Mt=r.RGBA32F),At===r.HALF_FLOAT&&(Mt=r.RGBA16F),At===r.UNSIGNED_BYTE&&(Mt=yi===os?r.SRGB8_ALPHA8:r.RGBA8),At===r.UNSIGNED_SHORT_4_4_4_4&&(Mt=r.RGBA4),At===r.UNSIGNED_SHORT_5_5_5_1&&(Mt=r.RGB5_A1)}return(Mt===r.R16F||Mt===r.R32F||Mt===r.RG16F||Mt===r.RG32F||Mt===r.RGBA16F||Mt===r.RGBA32F)&&e.get("EXT_color_buffer_float"),Mt}function T(Ge,Ce){let At;return Ge?Ce===null||Ce===mp||Ce===_m?At=r.DEPTH24_STENCIL8:Ce===Ru?At=r.DEPTH32F_STENCIL8:Ce===AA&&(At=r.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):Ce===null||Ce===mp||Ce===_m?At=r.DEPTH_COMPONENT24:Ce===Ru?At=r.DEPTH_COMPONENT32F:Ce===AA&&(At=r.DEPTH_COMPONENT16),At}function R(Ge,Ce){return v(Ge)===!0||Ge.isFramebufferTexture&&Ge.minFilter!==nc&&Ge.minFilter!==Vc?Math.log2(Math.max(Ce.width,Ce.height))+1:Ge.mipmaps!==void 0&&Ge.mipmaps.length>0?Ge.mipmaps.length:Ge.isCompressedTexture&&Array.isArray(Ge.image)?Ce.mipmaps.length:1}function B(Ge){const Ce=Ge.target;Ce.removeEventListener("dispose",B),D(Ce),Ce.isVideoTexture&&p.delete(Ce)}function I(Ge){const Ce=Ge.target;Ce.removeEventListener("dispose",I),O(Ce)}function D(Ge){const Ce=n.get(Ge);if(Ce.__webglInit===void 0)return;const At=Ge.source,Pt=g.get(At);if(Pt){const $t=Pt[Ce.__cacheKey];$t.usedTimes--,$t.usedTimes===0&&L(Ge),Object.keys(Pt).length===0&&g.delete(At)}n.remove(Ge)}function L(Ge){const Ce=n.get(Ge);r.deleteTexture(Ce.__webglTexture);const At=Ge.source,Pt=g.get(At);delete Pt[Ce.__cacheKey],l.memory.textures--}function O(Ge){const Ce=n.get(Ge);if(Ge.depthTexture&&(Ge.depthTexture.dispose(),n.remove(Ge.depthTexture)),Ge.isWebGLCubeRenderTarget)for(let Pt=0;Pt<6;Pt++){if(Array.isArray(Ce.__webglFramebuffer[Pt]))for(let $t=0;$t<Ce.__webglFramebuffer[Pt].length;$t++)r.deleteFramebuffer(Ce.__webglFramebuffer[Pt][$t]);else r.deleteFramebuffer(Ce.__webglFramebuffer[Pt]);Ce.__webglDepthbuffer&&r.deleteRenderbuffer(Ce.__webglDepthbuffer[Pt])}else{if(Array.isArray(Ce.__webglFramebuffer))for(let Pt=0;Pt<Ce.__webglFramebuffer.length;Pt++)r.deleteFramebuffer(Ce.__webglFramebuffer[Pt]);else r.deleteFramebuffer(Ce.__webglFramebuffer);if(Ce.__webglDepthbuffer&&r.deleteRenderbuffer(Ce.__webglDepthbuffer),Ce.__webglMultisampledFramebuffer&&r.deleteFramebuffer(Ce.__webglMultisampledFramebuffer),Ce.__webglColorRenderbuffer)for(let Pt=0;Pt<Ce.__webglColorRenderbuffer.length;Pt++)Ce.__webglColorRenderbuffer[Pt]&&r.deleteRenderbuffer(Ce.__webglColorRenderbuffer[Pt]);Ce.__webglDepthRenderbuffer&&r.deleteRenderbuffer(Ce.__webglDepthRenderbuffer)}const At=Ge.textures;for(let Pt=0,$t=At.length;Pt<$t;Pt++){const Mt=n.get(At[Pt]);Mt.__webglTexture&&(r.deleteTexture(Mt.__webglTexture),l.memory.textures--),n.remove(At[Pt])}n.remove(Ge)}let F=0;function q(){F=0}function H(){const Ge=F;return Ge>=s.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+Ge+" texture units while this GPU supports only "+s.maxTextures),F+=1,Ge}function G(Ge){const Ce=[];return Ce.push(Ge.wrapS),Ce.push(Ge.wrapT),Ce.push(Ge.wrapR||0),Ce.push(Ge.magFilter),Ce.push(Ge.minFilter),Ce.push(Ge.anisotropy),Ce.push(Ge.internalFormat),Ce.push(Ge.format),Ce.push(Ge.type),Ce.push(Ge.generateMipmaps),Ce.push(Ge.premultiplyAlpha),Ce.push(Ge.flipY),Ce.push(Ge.unpackAlignment),Ce.push(Ge.colorSpace),Ce.join()}function J(Ge,Ce){const At=n.get(Ge);if(Ge.isVideoTexture&&Si(Ge),Ge.isRenderTargetTexture===!1&&Ge.version>0&&At.__version!==Ge.version){const Pt=Ge.image;if(Pt===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Pt.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{me(At,Ge,Ce);return}}i.bindTexture(r.TEXTURE_2D,At.__webglTexture,r.TEXTURE0+Ce)}function Q(Ge,Ce){const At=n.get(Ge);if(Ge.version>0&&At.__version!==Ge.version){me(At,Ge,Ce);return}i.bindTexture(r.TEXTURE_2D_ARRAY,At.__webglTexture,r.TEXTURE0+Ce)}function V(Ge,Ce){const At=n.get(Ge);if(Ge.version>0&&At.__version!==Ge.version){me(At,Ge,Ce);return}i.bindTexture(r.TEXTURE_3D,At.__webglTexture,r.TEXTURE0+Ce)}function z(Ge,Ce){const At=n.get(Ge);if(Ge.version>0&&At.__version!==Ge.version){Pe(At,Ge,Ce);return}i.bindTexture(r.TEXTURE_CUBE_MAP,At.__webglTexture,r.TEXTURE0+Ce)}const te={[ZC]:r.REPEAT,[pp]:r.CLAMP_TO_EDGE,[$C]:r.MIRRORED_REPEAT},K={[nc]:r.NEAREST,[EJ]:r.NEAREST_MIPMAP_NEAREST,[ix]:r.NEAREST_MIPMAP_LINEAR,[Vc]:r.LINEAR,[eS]:r.LINEAR_MIPMAP_NEAREST,[fp]:r.LINEAR_MIPMAP_LINEAR},ae={[TJ]:r.NEVER,[LJ]:r.ALWAYS,[MJ]:r.LESS,[HP]:r.LEQUAL,[RJ]:r.EQUAL,[NJ]:r.GEQUAL,[IJ]:r.GREATER,[BJ]:r.NOTEQUAL};function Ae(Ge,Ce){if(Ce.type===Ru&&e.has("OES_texture_float_linear")===!1&&(Ce.magFilter===Vc||Ce.magFilter===eS||Ce.magFilter===ix||Ce.magFilter===fp||Ce.minFilter===Vc||Ce.minFilter===eS||Ce.minFilter===ix||Ce.minFilter===fp)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),r.texParameteri(Ge,r.TEXTURE_WRAP_S,te[Ce.wrapS]),r.texParameteri(Ge,r.TEXTURE_WRAP_T,te[Ce.wrapT]),(Ge===r.TEXTURE_3D||Ge===r.TEXTURE_2D_ARRAY)&&r.texParameteri(Ge,r.TEXTURE_WRAP_R,te[Ce.wrapR]),r.texParameteri(Ge,r.TEXTURE_MAG_FILTER,K[Ce.magFilter]),r.texParameteri(Ge,r.TEXTURE_MIN_FILTER,K[Ce.minFilter]),Ce.compareFunction&&(r.texParameteri(Ge,r.TEXTURE_COMPARE_MODE,r.COMPARE_REF_TO_TEXTURE),r.texParameteri(Ge,r.TEXTURE_COMPARE_FUNC,ae[Ce.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(Ce.magFilter===nc||Ce.minFilter!==ix&&Ce.minFilter!==fp||Ce.type===Ru&&e.has("OES_texture_float_linear")===!1)return;if(Ce.anisotropy>1||n.get(Ce).__currentAnisotropy){const At=e.get("EXT_texture_filter_anisotropic");r.texParameterf(Ge,At.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Ce.anisotropy,s.getMaxAnisotropy())),n.get(Ce).__currentAnisotropy=Ce.anisotropy}}}function _e(Ge,Ce){let At=!1;Ge.__webglInit===void 0&&(Ge.__webglInit=!0,Ce.addEventListener("dispose",B));const Pt=Ce.source;let $t=g.get(Pt);$t===void 0&&($t={},g.set(Pt,$t));const Mt=G(Ce);if(Mt!==Ge.__cacheKey){$t[Mt]===void 0&&($t[Mt]={texture:r.createTexture(),usedTimes:0},l.memory.textures++,At=!0),$t[Mt].usedTimes++;const yi=$t[Ge.__cacheKey];yi!==void 0&&($t[Ge.__cacheKey].usedTimes--,yi.usedTimes===0&&L(Ce)),Ge.__cacheKey=Mt,Ge.__webglTexture=$t[Mt].texture}return At}function me(Ge,Ce,At){let Pt=r.TEXTURE_2D;(Ce.isDataArrayTexture||Ce.isCompressedArrayTexture)&&(Pt=r.TEXTURE_2D_ARRAY),Ce.isData3DTexture&&(Pt=r.TEXTURE_3D);const $t=_e(Ge,Ce),Mt=Ce.source;i.bindTexture(Pt,Ge.__webglTexture,r.TEXTURE0+At);const yi=n.get(Mt);if(Mt.version!==yi.__version||$t===!0){i.activeTexture(r.TEXTURE0+At);const vt=Fn.getPrimaries(Fn.workingColorSpace),ye=Ce.colorSpace===Kh?null:Fn.getPrimaries(Ce.colorSpace),ve=Ce.colorSpace===Kh||vt===ye?r.NONE:r.BROWSER_DEFAULT_WEBGL;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,Ce.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ce.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,Ce.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,ve);let Ne=b(Ce.image,!1,s.maxTextureSize);Ne=Zi(Ce,Ne);const Te=o.convert(Ce.format,Ce.colorSpace),ke=o.convert(Ce.type);let Oe=E(Ce.internalFormat,Te,ke,Ce.colorSpace,Ce.isVideoTexture);Ae(Pt,Ce);let U;const $=Ce.mipmaps,re=Ce.isVideoTexture!==!0,Re=yi.__version===void 0||$t===!0,ce=Mt.dataReady,Ue=R(Ce,Ne);if(Ce.isDepthTexture)Oe=T(Ce.format===wm,Ce.type),Re&&(re?i.texStorage2D(r.TEXTURE_2D,1,Oe,Ne.width,Ne.height):i.texImage2D(r.TEXTURE_2D,0,Oe,Ne.width,Ne.height,0,Te,ke,null));else if(Ce.isDataTexture)if($.length>0){re&&Re&&i.texStorage2D(r.TEXTURE_2D,Ue,Oe,$[0].width,$[0].height);for(let je=0,pt=$.length;je<pt;je++)U=$[je],re?ce&&i.texSubImage2D(r.TEXTURE_2D,je,0,0,U.width,U.height,Te,ke,U.data):i.texImage2D(r.TEXTURE_2D,je,Oe,U.width,U.height,0,Te,ke,U.data);Ce.generateMipmaps=!1}else re?(Re&&i.texStorage2D(r.TEXTURE_2D,Ue,Oe,Ne.width,Ne.height),ce&&i.texSubImage2D(r.TEXTURE_2D,0,0,0,Ne.width,Ne.height,Te,ke,Ne.data)):i.texImage2D(r.TEXTURE_2D,0,Oe,Ne.width,Ne.height,0,Te,ke,Ne.data);else if(Ce.isCompressedTexture)if(Ce.isCompressedArrayTexture){re&&Re&&i.texStorage3D(r.TEXTURE_2D_ARRAY,Ue,Oe,$[0].width,$[0].height,Ne.depth);for(let je=0,pt=$.length;je<pt;je++)if(U=$[je],Ce.format!==sc)if(Te!==null)if(re){if(ce)if(Ce.layerUpdates.size>0){const Lt=$4(U.width,U.height,Ce.format,Ce.type);for(const xt of Ce.layerUpdates){const Gt=U.data.subarray(xt*Lt/U.data.BYTES_PER_ELEMENT,(xt+1)*Lt/U.data.BYTES_PER_ELEMENT);i.compressedTexSubImage3D(r.TEXTURE_2D_ARRAY,je,0,0,xt,U.width,U.height,1,Te,Gt)}Ce.clearLayerUpdates()}else i.compressedTexSubImage3D(r.TEXTURE_2D_ARRAY,je,0,0,0,U.width,U.height,Ne.depth,Te,U.data)}else i.compressedTexImage3D(r.TEXTURE_2D_ARRAY,je,Oe,U.width,U.height,Ne.depth,0,U.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else re?ce&&i.texSubImage3D(r.TEXTURE_2D_ARRAY,je,0,0,0,U.width,U.height,Ne.depth,Te,ke,U.data):i.texImage3D(r.TEXTURE_2D_ARRAY,je,Oe,U.width,U.height,Ne.depth,0,Te,ke,U.data)}else{re&&Re&&i.texStorage2D(r.TEXTURE_2D,Ue,Oe,$[0].width,$[0].height);for(let je=0,pt=$.length;je<pt;je++)U=$[je],Ce.format!==sc?Te!==null?re?ce&&i.compressedTexSubImage2D(r.TEXTURE_2D,je,0,0,U.width,U.height,Te,U.data):i.compressedTexImage2D(r.TEXTURE_2D,je,Oe,U.width,U.height,0,U.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):re?ce&&i.texSubImage2D(r.TEXTURE_2D,je,0,0,U.width,U.height,Te,ke,U.data):i.texImage2D(r.TEXTURE_2D,je,Oe,U.width,U.height,0,Te,ke,U.data)}else if(Ce.isDataArrayTexture)if(re){if(Re&&i.texStorage3D(r.TEXTURE_2D_ARRAY,Ue,Oe,Ne.width,Ne.height,Ne.depth),ce)if(Ce.layerUpdates.size>0){const je=$4(Ne.width,Ne.height,Ce.format,Ce.type);for(const pt of Ce.layerUpdates){const Lt=Ne.data.subarray(pt*je/Ne.data.BYTES_PER_ELEMENT,(pt+1)*je/Ne.data.BYTES_PER_ELEMENT);i.texSubImage3D(r.TEXTURE_2D_ARRAY,0,0,0,pt,Ne.width,Ne.height,1,Te,ke,Lt)}Ce.clearLayerUpdates()}else i.texSubImage3D(r.TEXTURE_2D_ARRAY,0,0,0,0,Ne.width,Ne.height,Ne.depth,Te,ke,Ne.data)}else i.texImage3D(r.TEXTURE_2D_ARRAY,0,Oe,Ne.width,Ne.height,Ne.depth,0,Te,ke,Ne.data);else if(Ce.isData3DTexture)re?(Re&&i.texStorage3D(r.TEXTURE_3D,Ue,Oe,Ne.width,Ne.height,Ne.depth),ce&&i.texSubImage3D(r.TEXTURE_3D,0,0,0,0,Ne.width,Ne.height,Ne.depth,Te,ke,Ne.data)):i.texImage3D(r.TEXTURE_3D,0,Oe,Ne.width,Ne.height,Ne.depth,0,Te,ke,Ne.data);else if(Ce.isFramebufferTexture){if(Re)if(re)i.texStorage2D(r.TEXTURE_2D,Ue,Oe,Ne.width,Ne.height);else{let je=Ne.width,pt=Ne.height;for(let Lt=0;Lt<Ue;Lt++)i.texImage2D(r.TEXTURE_2D,Lt,Oe,je,pt,0,Te,ke,null),je>>=1,pt>>=1}}else if($.length>0){if(re&&Re){const je=Vi($[0]);i.texStorage2D(r.TEXTURE_2D,Ue,Oe,je.width,je.height)}for(let je=0,pt=$.length;je<pt;je++)U=$[je],re?ce&&i.texSubImage2D(r.TEXTURE_2D,je,0,0,Te,ke,U):i.texImage2D(r.TEXTURE_2D,je,Oe,Te,ke,U);Ce.generateMipmaps=!1}else if(re){if(Re){const je=Vi(Ne);i.texStorage2D(r.TEXTURE_2D,Ue,Oe,je.width,je.height)}ce&&i.texSubImage2D(r.TEXTURE_2D,0,0,0,Te,ke,Ne)}else i.texImage2D(r.TEXTURE_2D,0,Oe,Te,ke,Ne);v(Ce)&&_(Pt),yi.__version=Mt.version,Ce.onUpdate&&Ce.onUpdate(Ce)}Ge.__version=Ce.version}function Pe(Ge,Ce,At){if(Ce.image.length!==6)return;const Pt=_e(Ge,Ce),$t=Ce.source;i.bindTexture(r.TEXTURE_CUBE_MAP,Ge.__webglTexture,r.TEXTURE0+At);const Mt=n.get($t);if($t.version!==Mt.__version||Pt===!0){i.activeTexture(r.TEXTURE0+At);const yi=Fn.getPrimaries(Fn.workingColorSpace),vt=Ce.colorSpace===Kh?null:Fn.getPrimaries(Ce.colorSpace),ye=Ce.colorSpace===Kh||yi===vt?r.NONE:r.BROWSER_DEFAULT_WEBGL;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,Ce.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ce.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,Ce.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,ye);const ve=Ce.isCompressedTexture||Ce.image[0].isCompressedTexture,Ne=Ce.image[0]&&Ce.image[0].isDataTexture,Te=[];for(let pt=0;pt<6;pt++)!ve&&!Ne?Te[pt]=b(Ce.image[pt],!0,s.maxCubemapSize):Te[pt]=Ne?Ce.image[pt].image:Ce.image[pt],Te[pt]=Zi(Ce,Te[pt]);const ke=Te[0],Oe=o.convert(Ce.format,Ce.colorSpace),U=o.convert(Ce.type),$=E(Ce.internalFormat,Oe,U,Ce.colorSpace),re=Ce.isVideoTexture!==!0,Re=Mt.__version===void 0||Pt===!0,ce=$t.dataReady;let Ue=R(Ce,ke);Ae(r.TEXTURE_CUBE_MAP,Ce);let je;if(ve){re&&Re&&i.texStorage2D(r.TEXTURE_CUBE_MAP,Ue,$,ke.width,ke.height);for(let pt=0;pt<6;pt++){je=Te[pt].mipmaps;for(let Lt=0;Lt<je.length;Lt++){const xt=je[Lt];Ce.format!==sc?Oe!==null?re?ce&&i.compressedTexSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+pt,Lt,0,0,xt.width,xt.height,Oe,xt.data):i.compressedTexImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+pt,Lt,$,xt.width,xt.height,0,xt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):re?ce&&i.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+pt,Lt,0,0,xt.width,xt.height,Oe,U,xt.data):i.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+pt,Lt,$,xt.width,xt.height,0,Oe,U,xt.data)}}}else{if(je=Ce.mipmaps,re&&Re){je.length>0&&Ue++;const pt=Vi(Te[0]);i.texStorage2D(r.TEXTURE_CUBE_MAP,Ue,$,pt.width,pt.height)}for(let pt=0;pt<6;pt++)if(Ne){re?ce&&i.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+pt,0,0,0,Te[pt].width,Te[pt].height,Oe,U,Te[pt].data):i.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+pt,0,$,Te[pt].width,Te[pt].height,0,Oe,U,Te[pt].data);for(let Lt=0;Lt<je.length;Lt++){const xt=je[Lt].image[pt].image;re?ce&&i.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+pt,Lt+1,0,0,xt.width,xt.height,Oe,U,xt.data):i.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+pt,Lt+1,$,xt.width,xt.height,0,Oe,U,xt.data)}}else{re?ce&&i.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+pt,0,0,0,Oe,U,Te[pt]):i.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+pt,0,$,Oe,U,Te[pt]);for(let Lt=0;Lt<je.length;Lt++){const xt=je[Lt];re?ce&&i.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+pt,Lt+1,0,0,Oe,U,xt.image[pt]):i.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+pt,Lt+1,$,Oe,U,xt.image[pt])}}}v(Ce)&&_(r.TEXTURE_CUBE_MAP),Mt.__version=$t.version,Ce.onUpdate&&Ce.onUpdate(Ce)}Ge.__version=Ce.version}function Xe(Ge,Ce,At,Pt,$t,Mt){const yi=o.convert(At.format,At.colorSpace),vt=o.convert(At.type),ye=E(At.internalFormat,yi,vt,At.colorSpace),ve=n.get(Ce),Ne=n.get(At);if(Ne.__renderTarget=Ce,!ve.__hasExternalTextures){const Te=Math.max(1,Ce.width>>Mt),ke=Math.max(1,Ce.height>>Mt);$t===r.TEXTURE_3D||$t===r.TEXTURE_2D_ARRAY?i.texImage3D($t,Mt,ye,Te,ke,Ce.depth,0,yi,vt,null):i.texImage2D($t,Mt,ye,Te,ke,0,yi,vt,null)}i.bindFramebuffer(r.FRAMEBUFFER,Ge),Ri(Ce)?u.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,Pt,$t,Ne.__webglTexture,0,hi(Ce)):($t===r.TEXTURE_2D||$t>=r.TEXTURE_CUBE_MAP_POSITIVE_X&&$t<=r.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&r.framebufferTexture2D(r.FRAMEBUFFER,Pt,$t,Ne.__webglTexture,Mt),i.bindFramebuffer(r.FRAMEBUFFER,null)}function Je(Ge,Ce,At){if(r.bindRenderbuffer(r.RENDERBUFFER,Ge),Ce.depthBuffer){const Pt=Ce.depthTexture,$t=Pt&&Pt.isDepthTexture?Pt.type:null,Mt=T(Ce.stencilBuffer,$t),yi=Ce.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,vt=hi(Ce);Ri(Ce)?u.renderbufferStorageMultisampleEXT(r.RENDERBUFFER,vt,Mt,Ce.width,Ce.height):At?r.renderbufferStorageMultisample(r.RENDERBUFFER,vt,Mt,Ce.width,Ce.height):r.renderbufferStorage(r.RENDERBUFFER,Mt,Ce.width,Ce.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,yi,r.RENDERBUFFER,Ge)}else{const Pt=Ce.textures;for(let $t=0;$t<Pt.length;$t++){const Mt=Pt[$t],yi=o.convert(Mt.format,Mt.colorSpace),vt=o.convert(Mt.type),ye=E(Mt.internalFormat,yi,vt,Mt.colorSpace),ve=hi(Ce);At&&Ri(Ce)===!1?r.renderbufferStorageMultisample(r.RENDERBUFFER,ve,ye,Ce.width,Ce.height):Ri(Ce)?u.renderbufferStorageMultisampleEXT(r.RENDERBUFFER,ve,ye,Ce.width,Ce.height):r.renderbufferStorage(r.RENDERBUFFER,ye,Ce.width,Ce.height)}}r.bindRenderbuffer(r.RENDERBUFFER,null)}function tt(Ge,Ce){if(Ce&&Ce.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(r.FRAMEBUFFER,Ge),!(Ce.depthTexture&&Ce.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const At=n.get(Ce.depthTexture);At.__renderTarget=Ce,(!At.__webglTexture||Ce.depthTexture.image.width!==Ce.width||Ce.depthTexture.image.height!==Ce.height)&&(Ce.depthTexture.image.width=Ce.width,Ce.depthTexture.image.height=Ce.height,Ce.depthTexture.needsUpdate=!0),J(Ce.depthTexture,0);const Pt=At.__webglTexture,$t=hi(Ce);if(Ce.depthTexture.format===Em)Ri(Ce)?u.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,Pt,0,$t):r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,Pt,0);else if(Ce.depthTexture.format===wm)Ri(Ce)?u.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.TEXTURE_2D,Pt,0,$t):r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.TEXTURE_2D,Pt,0);else throw new Error("Unknown depthTexture format")}function dt(Ge){const Ce=n.get(Ge),At=Ge.isWebGLCubeRenderTarget===!0;if(Ce.__boundDepthTexture!==Ge.depthTexture){const Pt=Ge.depthTexture;if(Ce.__depthDisposeCallback&&Ce.__depthDisposeCallback(),Pt){const $t=()=>{delete Ce.__boundDepthTexture,delete Ce.__depthDisposeCallback,Pt.removeEventListener("dispose",$t)};Pt.addEventListener("dispose",$t),Ce.__depthDisposeCallback=$t}Ce.__boundDepthTexture=Pt}if(Ge.depthTexture&&!Ce.__autoAllocateDepthBuffer){if(At)throw new Error("target.depthTexture not supported in Cube render targets");tt(Ce.__webglFramebuffer,Ge)}else if(At){Ce.__webglDepthbuffer=[];for(let Pt=0;Pt<6;Pt++)if(i.bindFramebuffer(r.FRAMEBUFFER,Ce.__webglFramebuffer[Pt]),Ce.__webglDepthbuffer[Pt]===void 0)Ce.__webglDepthbuffer[Pt]=r.createRenderbuffer(),Je(Ce.__webglDepthbuffer[Pt],Ge,!1);else{const $t=Ge.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,Mt=Ce.__webglDepthbuffer[Pt];r.bindRenderbuffer(r.RENDERBUFFER,Mt),r.framebufferRenderbuffer(r.FRAMEBUFFER,$t,r.RENDERBUFFER,Mt)}}else if(i.bindFramebuffer(r.FRAMEBUFFER,Ce.__webglFramebuffer),Ce.__webglDepthbuffer===void 0)Ce.__webglDepthbuffer=r.createRenderbuffer(),Je(Ce.__webglDepthbuffer,Ge,!1);else{const Pt=Ge.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,$t=Ce.__webglDepthbuffer;r.bindRenderbuffer(r.RENDERBUFFER,$t),r.framebufferRenderbuffer(r.FRAMEBUFFER,Pt,r.RENDERBUFFER,$t)}i.bindFramebuffer(r.FRAMEBUFFER,null)}function wt(Ge,Ce,At){const Pt=n.get(Ge);Ce!==void 0&&Xe(Pt.__webglFramebuffer,Ge,Ge.texture,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,0),At!==void 0&&dt(Ge)}function qt(Ge){const Ce=Ge.texture,At=n.get(Ge),Pt=n.get(Ce);Ge.addEventListener("dispose",I);const $t=Ge.textures,Mt=Ge.isWebGLCubeRenderTarget===!0,yi=$t.length>1;if(yi||(Pt.__webglTexture===void 0&&(Pt.__webglTexture=r.createTexture()),Pt.__version=Ce.version,l.memory.textures++),Mt){At.__webglFramebuffer=[];for(let vt=0;vt<6;vt++)if(Ce.mipmaps&&Ce.mipmaps.length>0){At.__webglFramebuffer[vt]=[];for(let ye=0;ye<Ce.mipmaps.length;ye++)At.__webglFramebuffer[vt][ye]=r.createFramebuffer()}else At.__webglFramebuffer[vt]=r.createFramebuffer()}else{if(Ce.mipmaps&&Ce.mipmaps.length>0){At.__webglFramebuffer=[];for(let vt=0;vt<Ce.mipmaps.length;vt++)At.__webglFramebuffer[vt]=r.createFramebuffer()}else At.__webglFramebuffer=r.createFramebuffer();if(yi)for(let vt=0,ye=$t.length;vt<ye;vt++){const ve=n.get($t[vt]);ve.__webglTexture===void 0&&(ve.__webglTexture=r.createTexture(),l.memory.textures++)}if(Ge.samples>0&&Ri(Ge)===!1){At.__webglMultisampledFramebuffer=r.createFramebuffer(),At.__webglColorRenderbuffer=[],i.bindFramebuffer(r.FRAMEBUFFER,At.__webglMultisampledFramebuffer);for(let vt=0;vt<$t.length;vt++){const ye=$t[vt];At.__webglColorRenderbuffer[vt]=r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,At.__webglColorRenderbuffer[vt]);const ve=o.convert(ye.format,ye.colorSpace),Ne=o.convert(ye.type),Te=E(ye.internalFormat,ve,Ne,ye.colorSpace,Ge.isXRRenderTarget===!0),ke=hi(Ge);r.renderbufferStorageMultisample(r.RENDERBUFFER,ke,Te,Ge.width,Ge.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+vt,r.RENDERBUFFER,At.__webglColorRenderbuffer[vt])}r.bindRenderbuffer(r.RENDERBUFFER,null),Ge.depthBuffer&&(At.__webglDepthRenderbuffer=r.createRenderbuffer(),Je(At.__webglDepthRenderbuffer,Ge,!0)),i.bindFramebuffer(r.FRAMEBUFFER,null)}}if(Mt){i.bindTexture(r.TEXTURE_CUBE_MAP,Pt.__webglTexture),Ae(r.TEXTURE_CUBE_MAP,Ce);for(let vt=0;vt<6;vt++)if(Ce.mipmaps&&Ce.mipmaps.length>0)for(let ye=0;ye<Ce.mipmaps.length;ye++)Xe(At.__webglFramebuffer[vt][ye],Ge,Ce,r.COLOR_ATTACHMENT0,r.TEXTURE_CUBE_MAP_POSITIVE_X+vt,ye);else Xe(At.__webglFramebuffer[vt],Ge,Ce,r.COLOR_ATTACHMENT0,r.TEXTURE_CUBE_MAP_POSITIVE_X+vt,0);v(Ce)&&_(r.TEXTURE_CUBE_MAP),i.unbindTexture()}else if(yi){for(let vt=0,ye=$t.length;vt<ye;vt++){const ve=$t[vt],Ne=n.get(ve);i.bindTexture(r.TEXTURE_2D,Ne.__webglTexture),Ae(r.TEXTURE_2D,ve),Xe(At.__webglFramebuffer,Ge,ve,r.COLOR_ATTACHMENT0+vt,r.TEXTURE_2D,0),v(ve)&&_(r.TEXTURE_2D)}i.unbindTexture()}else{let vt=r.TEXTURE_2D;if((Ge.isWebGL3DRenderTarget||Ge.isWebGLArrayRenderTarget)&&(vt=Ge.isWebGL3DRenderTarget?r.TEXTURE_3D:r.TEXTURE_2D_ARRAY),i.bindTexture(vt,Pt.__webglTexture),Ae(vt,Ce),Ce.mipmaps&&Ce.mipmaps.length>0)for(let ye=0;ye<Ce.mipmaps.length;ye++)Xe(At.__webglFramebuffer[ye],Ge,Ce,r.COLOR_ATTACHMENT0,vt,ye);else Xe(At.__webglFramebuffer,Ge,Ce,r.COLOR_ATTACHMENT0,vt,0);v(Ce)&&_(vt),i.unbindTexture()}Ge.depthBuffer&&dt(Ge)}function yt(Ge){const Ce=Ge.textures;for(let At=0,Pt=Ce.length;At<Pt;At++){const $t=Ce[At];if(v($t)){const Mt=C(Ge),yi=n.get($t).__webglTexture;i.bindTexture(Mt,yi),_(Mt),i.unbindTexture()}}}const Ei=[],$e=[];function Ui(Ge){if(Ge.samples>0){if(Ri(Ge)===!1){const Ce=Ge.textures,At=Ge.width,Pt=Ge.height;let $t=r.COLOR_BUFFER_BIT;const Mt=Ge.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,yi=n.get(Ge),vt=Ce.length>1;if(vt)for(let ye=0;ye<Ce.length;ye++)i.bindFramebuffer(r.FRAMEBUFFER,yi.__webglMultisampledFramebuffer),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+ye,r.RENDERBUFFER,null),i.bindFramebuffer(r.FRAMEBUFFER,yi.__webglFramebuffer),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0+ye,r.TEXTURE_2D,null,0);i.bindFramebuffer(r.READ_FRAMEBUFFER,yi.__webglMultisampledFramebuffer),i.bindFramebuffer(r.DRAW_FRAMEBUFFER,yi.__webglFramebuffer);for(let ye=0;ye<Ce.length;ye++){if(Ge.resolveDepthBuffer&&(Ge.depthBuffer&&($t|=r.DEPTH_BUFFER_BIT),Ge.stencilBuffer&&Ge.resolveStencilBuffer&&($t|=r.STENCIL_BUFFER_BIT)),vt){r.framebufferRenderbuffer(r.READ_FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,yi.__webglColorRenderbuffer[ye]);const ve=n.get(Ce[ye]).__webglTexture;r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,ve,0)}r.blitFramebuffer(0,0,At,Pt,0,0,At,Pt,$t,r.NEAREST),c===!0&&(Ei.length=0,$e.length=0,Ei.push(r.COLOR_ATTACHMENT0+ye),Ge.depthBuffer&&Ge.resolveDepthBuffer===!1&&(Ei.push(Mt),$e.push(Mt),r.invalidateFramebuffer(r.DRAW_FRAMEBUFFER,$e)),r.invalidateFramebuffer(r.READ_FRAMEBUFFER,Ei))}if(i.bindFramebuffer(r.READ_FRAMEBUFFER,null),i.bindFramebuffer(r.DRAW_FRAMEBUFFER,null),vt)for(let ye=0;ye<Ce.length;ye++){i.bindFramebuffer(r.FRAMEBUFFER,yi.__webglMultisampledFramebuffer),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+ye,r.RENDERBUFFER,yi.__webglColorRenderbuffer[ye]);const ve=n.get(Ce[ye]).__webglTexture;i.bindFramebuffer(r.FRAMEBUFFER,yi.__webglFramebuffer),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0+ye,r.TEXTURE_2D,ve,0)}i.bindFramebuffer(r.DRAW_FRAMEBUFFER,yi.__webglMultisampledFramebuffer)}else if(Ge.depthBuffer&&Ge.resolveDepthBuffer===!1&&c){const Ce=Ge.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT;r.invalidateFramebuffer(r.DRAW_FRAMEBUFFER,[Ce])}}}function hi(Ge){return Math.min(s.maxSamples,Ge.samples)}function Ri(Ge){const Ce=n.get(Ge);return Ge.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&Ce.__useRenderToTexture!==!1}function Si(Ge){const Ce=l.render.frame;p.get(Ge)!==Ce&&(p.set(Ge,Ce),Ge.update())}function Zi(Ge,Ce){const At=Ge.colorSpace,Pt=Ge.format,$t=Ge.type;return Ge.isCompressedTexture===!0||Ge.isVideoTexture===!0||At!==Cm&&At!==Kh&&(Fn.getTransfer(At)===os?(Pt!==sc||$t!==Mu)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",At)),Ce}function Vi(Ge){return typeof HTMLImageElement<"u"&&Ge instanceof HTMLImageElement?(h.width=Ge.naturalWidth||Ge.width,h.height=Ge.naturalHeight||Ge.height):typeof VideoFrame<"u"&&Ge instanceof VideoFrame?(h.width=Ge.displayWidth,h.height=Ge.displayHeight):(h.width=Ge.width,h.height=Ge.height),h}this.allocateTextureUnit=H,this.resetTextureUnits=q,this.setTexture2D=J,this.setTexture2DArray=Q,this.setTexture3D=V,this.setTextureCube=z,this.rebindTextures=wt,this.setupRenderTarget=qt,this.updateRenderTargetMipmap=yt,this.updateMultisampleRenderTarget=Ui,this.setupDepthRenderbuffer=dt,this.setupFrameBufferTexture=Xe,this.useMultisampledRTT=Ri}function Jie(r,e){function i(n,s=Kh){let o;const l=Fn.getTransfer(s);if(n===Mu)return r.UNSIGNED_BYTE;if(n===iS)return r.UNSIGNED_SHORT_4_4_4_4;if(n===rS)return r.UNSIGNED_SHORT_5_5_5_1;if(n===DP)return r.UNSIGNED_INT_5_9_9_9_REV;if(n===NP)return r.BYTE;if(n===LP)return r.SHORT;if(n===AA)return r.UNSIGNED_SHORT;if(n===tS)return r.INT;if(n===mp)return r.UNSIGNED_INT;if(n===Ru)return r.FLOAT;if(n===xm)return r.HALF_FLOAT;if(n===OP)return r.ALPHA;if(n===PP)return r.RGB;if(n===sc)return r.RGBA;if(n===kP)return r.LUMINANCE;if(n===FP)return r.LUMINANCE_ALPHA;if(n===Em)return r.DEPTH_COMPONENT;if(n===wm)return r.DEPTH_STENCIL;if(n===UP)return r.RED;if(n===nS)return r.RED_INTEGER;if(n===zP)return r.RG;if(n===sS)return r.RG_INTEGER;if(n===aS)return r.RGBA_INTEGER;if(n===rx||n===nx||n===sx||n===ax)if(l===os)if(o=e.get("WEBGL_compressed_texture_s3tc_srgb"),o!==null){if(n===rx)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===nx)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===sx)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===ax)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(o=e.get("WEBGL_compressed_texture_s3tc"),o!==null){if(n===rx)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===nx)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===sx)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===ax)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(n===oS||n===lS||n===cS||n===uS)if(o=e.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(n===oS)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===lS)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===cS)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===uS)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(n===hS||n===dS||n===pS)if(o=e.get("WEBGL_compressed_texture_etc"),o!==null){if(n===hS||n===dS)return l===os?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(n===pS)return l===os?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(n===fS||n===mS||n===gS||n===AS||n===yS||n===vS||n===bS||n===xS||n===_S||n===ES||n===wS||n===CS||n===SS||n===TS)if(o=e.get("WEBGL_compressed_texture_astc"),o!==null){if(n===fS)return l===os?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===mS)return l===os?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===gS)return l===os?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===AS)return l===os?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===yS)return l===os?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===vS)return l===os?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===bS)return l===os?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===xS)return l===os?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===_S)return l===os?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===ES)return l===os?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===wS)return l===os?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===CS)return l===os?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===SS)return l===os?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===TS)return l===os?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(n===ox||n===MS||n===RS)if(o=e.get("EXT_texture_compression_bptc"),o!==null){if(n===ox)return l===os?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===MS)return o.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===RS)return o.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(n===jP||n===IS||n===BS||n===NS)if(o=e.get("EXT_texture_compression_rgtc"),o!==null){if(n===ox)return o.COMPRESSED_RED_RGTC1_EXT;if(n===IS)return o.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===BS)return o.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===NS)return o.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return n===_m?r.UNSIGNED_INT_24_8:r[n]!==void 0?r[n]:null}return{convert:i}}class Zie extends kl{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}let Wm=class extends to{constructor(){super(),this.isGroup=!0,this.type="Group"}};const $ie={type:"move"};class pT{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Wm,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Wm,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new ot,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new ot),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Wm,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new ot,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new ot),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const i=this._hand;if(i)for(const n of e.hand.values())this._getHandJoint(i,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,i,n){let s=null,o=null,l=null;const u=this._targetRay,c=this._grip,h=this._hand;if(e&&i.session.visibilityState!=="visible-blurred"){if(h&&e.hand){l=!0;for(const b of e.hand.values()){const v=i.getJointPose(b,n),_=this._getHandJoint(h,b);v!==null&&(_.matrix.fromArray(v.transform.matrix),_.matrix.decompose(_.position,_.rotation,_.scale),_.matrixWorldNeedsUpdate=!0,_.jointRadius=v.radius),_.visible=v!==null}const p=h.joints["index-finger-tip"],f=h.joints["thumb-tip"],g=p.position.distanceTo(f.position),m=.02,y=.005;h.inputState.pinching&&g>m+y?(h.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!h.inputState.pinching&&g<=m-y&&(h.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else c!==null&&e.gripSpace&&(o=i.getPose(e.gripSpace,n),o!==null&&(c.matrix.fromArray(o.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),c.matrixWorldNeedsUpdate=!0,o.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(o.linearVelocity)):c.hasLinearVelocity=!1,o.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(o.angularVelocity)):c.hasAngularVelocity=!1));u!==null&&(s=i.getPose(e.targetRaySpace,n),s===null&&o!==null&&(s=o),s!==null&&(u.matrix.fromArray(s.transform.matrix),u.matrix.decompose(u.position,u.rotation,u.scale),u.matrixWorldNeedsUpdate=!0,s.linearVelocity?(u.hasLinearVelocity=!0,u.linearVelocity.copy(s.linearVelocity)):u.hasLinearVelocity=!1,s.angularVelocity?(u.hasAngularVelocity=!0,u.angularVelocity.copy(s.angularVelocity)):u.hasAngularVelocity=!1,this.dispatchEvent($ie)))}return u!==null&&(u.visible=s!==null),c!==null&&(c.visible=o!==null),h!==null&&(h.visible=l!==null),this}_getHandJoint(e,i){if(e.joints[i.jointName]===void 0){const n=new Wm;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[i.jointName]=n,e.add(n)}return e.joints[i.jointName]}}const ere=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,tre=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class ire{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,i,n){if(this.texture===null){const s=new Ol,o=e.properties.get(s);o.__webglTexture=i.texture,(i.depthNear!=n.depthNear||i.depthFar!=n.depthFar)&&(this.depthNear=i.depthNear,this.depthFar=i.depthFar),this.texture=s}}getMesh(e){if(this.texture!==null&&this.mesh===null){const i=e.cameras[0].viewport,n=new Wc({vertexShader:ere,fragmentShader:tre,uniforms:{depthColor:{value:this.texture},depthWidth:{value:i.z},depthHeight:{value:i.w}}});this.mesh=new za(new Rx(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class rre extends gp{constructor(e,i){super();const n=this;let s=null,o=1,l=null,u="local-floor",c=1,h=null,p=null,f=null,g=null,m=null,y=null;const b=new ire,v=i.getContextAttributes();let _=null,C=null;const E=[],T=[],R=new Gi;let B=null;const I=new kl;I.viewport=new Zs;const D=new kl;D.viewport=new Zs;const L=[I,D],O=new Zie;let F=null,q=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(me){let Pe=E[me];return Pe===void 0&&(Pe=new pT,E[me]=Pe),Pe.getTargetRaySpace()},this.getControllerGrip=function(me){let Pe=E[me];return Pe===void 0&&(Pe=new pT,E[me]=Pe),Pe.getGripSpace()},this.getHand=function(me){let Pe=E[me];return Pe===void 0&&(Pe=new pT,E[me]=Pe),Pe.getHandSpace()};function H(me){const Pe=T.indexOf(me.inputSource);if(Pe===-1)return;const Xe=E[Pe];Xe!==void 0&&(Xe.update(me.inputSource,me.frame,h||l),Xe.dispatchEvent({type:me.type,data:me.inputSource}))}function G(){s.removeEventListener("select",H),s.removeEventListener("selectstart",H),s.removeEventListener("selectend",H),s.removeEventListener("squeeze",H),s.removeEventListener("squeezestart",H),s.removeEventListener("squeezeend",H),s.removeEventListener("end",G),s.removeEventListener("inputsourceschange",J);for(let me=0;me<E.length;me++){const Pe=T[me];Pe!==null&&(T[me]=null,E[me].disconnect(Pe))}F=null,q=null,b.reset(),e.setRenderTarget(_),m=null,g=null,f=null,s=null,C=null,_e.stop(),n.isPresenting=!1,e.setPixelRatio(B),e.setSize(R.width,R.height,!1),n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(me){o=me,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(me){u=me,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return h||l},this.setReferenceSpace=function(me){h=me},this.getBaseLayer=function(){return g!==null?g:m},this.getBinding=function(){return f},this.getFrame=function(){return y},this.getSession=function(){return s},this.setSession=async function(me){if(s=me,s!==null){if(_=e.getRenderTarget(),s.addEventListener("select",H),s.addEventListener("selectstart",H),s.addEventListener("selectend",H),s.addEventListener("squeeze",H),s.addEventListener("squeezestart",H),s.addEventListener("squeezeend",H),s.addEventListener("end",G),s.addEventListener("inputsourceschange",J),v.xrCompatible!==!0&&await i.makeXRCompatible(),B=e.getPixelRatio(),e.getSize(R),s.renderState.layers===void 0){const Pe={antialias:v.antialias,alpha:!0,depth:v.depth,stencil:v.stencil,framebufferScaleFactor:o};m=new XRWebGLLayer(s,i,Pe),s.updateRenderState({baseLayer:m}),e.setPixelRatio(1),e.setSize(m.framebufferWidth,m.framebufferHeight,!1),C=new Yh(m.framebufferWidth,m.framebufferHeight,{format:sc,type:Mu,colorSpace:e.outputColorSpace,stencilBuffer:v.stencil})}else{let Pe=null,Xe=null,Je=null;v.depth&&(Je=v.stencil?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24,Pe=v.stencil?wm:Em,Xe=v.stencil?_m:mp);const tt={colorFormat:i.RGBA8,depthFormat:Je,scaleFactor:o};f=new XRWebGLBinding(s,i),g=f.createProjectionLayer(tt),s.updateRenderState({layers:[g]}),e.setPixelRatio(1),e.setSize(g.textureWidth,g.textureHeight,!1),C=new Yh(g.textureWidth,g.textureHeight,{format:sc,type:Mu,depthTexture:new B4(g.textureWidth,g.textureHeight,Xe,void 0,void 0,void 0,void 0,void 0,void 0,Pe),stencilBuffer:v.stencil,colorSpace:e.outputColorSpace,samples:v.antialias?4:0,resolveDepthBuffer:g.ignoreDepthValues===!1})}C.isXRRenderTarget=!0,this.setFoveation(c),h=null,l=await s.requestReferenceSpace(u),_e.setContext(s),_e.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(s!==null)return s.environmentBlendMode},this.getDepthTexture=function(){return b.getDepthTexture()};function J(me){for(let Pe=0;Pe<me.removed.length;Pe++){const Xe=me.removed[Pe],Je=T.indexOf(Xe);Je>=0&&(T[Je]=null,E[Je].disconnect(Xe))}for(let Pe=0;Pe<me.added.length;Pe++){const Xe=me.added[Pe];let Je=T.indexOf(Xe);if(Je===-1){for(let dt=0;dt<E.length;dt++)if(dt>=T.length){T.push(Xe),Je=dt;break}else if(T[dt]===null){T[dt]=Xe,Je=dt;break}if(Je===-1)break}const tt=E[Je];tt&&tt.connect(Xe)}}const Q=new ot,V=new ot;function z(me,Pe,Xe){Q.setFromMatrixPosition(Pe.matrixWorld),V.setFromMatrixPosition(Xe.matrixWorld);const Je=Q.distanceTo(V),tt=Pe.projectionMatrix.elements,dt=Xe.projectionMatrix.elements,wt=tt[14]/(tt[10]-1),qt=tt[14]/(tt[10]+1),yt=(tt[9]+1)/tt[5],Ei=(tt[9]-1)/tt[5],$e=(tt[8]-1)/tt[0],Ui=(dt[8]+1)/dt[0],hi=wt*$e,Ri=wt*Ui,Si=Je/(-$e+Ui),Zi=Si*-$e;if(Pe.matrixWorld.decompose(me.position,me.quaternion,me.scale),me.translateX(Zi),me.translateZ(Si),me.matrixWorld.compose(me.position,me.quaternion,me.scale),me.matrixWorldInverse.copy(me.matrixWorld).invert(),tt[10]===-1)me.projectionMatrix.copy(Pe.projectionMatrix),me.projectionMatrixInverse.copy(Pe.projectionMatrixInverse);else{const Vi=wt+Si,Ge=qt+Si,Ce=hi-Zi,At=Ri+(Je-Zi),Pt=yt*qt/Ge*Vi,$t=Ei*qt/Ge*Vi;me.projectionMatrix.makePerspective(Ce,At,Pt,$t,Vi,Ge),me.projectionMatrixInverse.copy(me.projectionMatrix).invert()}}function te(me,Pe){Pe===null?me.matrixWorld.copy(me.matrix):me.matrixWorld.multiplyMatrices(Pe.matrixWorld,me.matrix),me.matrixWorldInverse.copy(me.matrixWorld).invert()}this.updateCamera=function(me){if(s===null)return;let Pe=me.near,Xe=me.far;b.texture!==null&&(b.depthNear>0&&(Pe=b.depthNear),b.depthFar>0&&(Xe=b.depthFar)),O.near=D.near=I.near=Pe,O.far=D.far=I.far=Xe,(F!==O.near||q!==O.far)&&(s.updateRenderState({depthNear:O.near,depthFar:O.far}),F=O.near,q=O.far),I.layers.mask=me.layers.mask|2,D.layers.mask=me.layers.mask|4,O.layers.mask=I.layers.mask|D.layers.mask;const Je=me.parent,tt=O.cameras;te(O,Je);for(let dt=0;dt<tt.length;dt++)te(tt[dt],Je);tt.length===2?z(O,I,D):O.projectionMatrix.copy(I.projectionMatrix),K(me,O,Je)};function K(me,Pe,Xe){Xe===null?me.matrix.copy(Pe.matrixWorld):(me.matrix.copy(Xe.matrixWorld),me.matrix.invert(),me.matrix.multiply(Pe.matrixWorld)),me.matrix.decompose(me.position,me.quaternion,me.scale),me.updateMatrixWorld(!0),me.projectionMatrix.copy(Pe.projectionMatrix),me.projectionMatrixInverse.copy(Pe.projectionMatrixInverse),me.isPerspectiveCamera&&(me.fov=vA*2*Math.atan(1/me.projectionMatrix.elements[5]),me.zoom=1)}this.getCamera=function(){return O},this.getFoveation=function(){if(!(g===null&&m===null))return c},this.setFoveation=function(me){c=me,g!==null&&(g.fixedFoveation=me),m!==null&&m.fixedFoveation!==void 0&&(m.fixedFoveation=me)},this.hasDepthSensing=function(){return b.texture!==null},this.getDepthSensingMesh=function(){return b.getMesh(O)};let ae=null;function Ae(me,Pe){if(p=Pe.getViewerPose(h||l),y=Pe,p!==null){const Xe=p.views;m!==null&&(e.setRenderTargetFramebuffer(C,m.framebuffer),e.setRenderTarget(C));let Je=!1;Xe.length!==O.cameras.length&&(O.cameras.length=0,Je=!0);for(let dt=0;dt<Xe.length;dt++){const wt=Xe[dt];let qt=null;if(m!==null)qt=m.getViewport(wt);else{const Ei=f.getViewSubImage(g,wt);qt=Ei.viewport,dt===0&&(e.setRenderTargetTextures(C,Ei.colorTexture,g.ignoreDepthValues?void 0:Ei.depthStencilTexture),e.setRenderTarget(C))}let yt=L[dt];yt===void 0&&(yt=new kl,yt.layers.enable(dt),yt.viewport=new Zs,L[dt]=yt),yt.matrix.fromArray(wt.transform.matrix),yt.matrix.decompose(yt.position,yt.quaternion,yt.scale),yt.projectionMatrix.fromArray(wt.projectionMatrix),yt.projectionMatrixInverse.copy(yt.projectionMatrix).invert(),yt.viewport.set(qt.x,qt.y,qt.width,qt.height),dt===0&&(O.matrix.copy(yt.matrix),O.matrix.decompose(O.position,O.quaternion,O.scale)),Je===!0&&O.cameras.push(yt)}const tt=s.enabledFeatures;if(tt&&tt.includes("depth-sensing")){const dt=f.getDepthInformation(Xe[0]);dt&&dt.isValid&&dt.texture&&b.init(e,dt,s.renderState)}}for(let Xe=0;Xe<E.length;Xe++){const Je=T[Xe],tt=E[Xe];Je!==null&&tt!==void 0&&tt.update(Je,Pe,h||l)}ae&&ae(me,Pe),Pe.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:Pe}),y=null}const _e=new E4;_e.setAnimationLoop(Ae),this.setAnimationLoop=function(me){ae=me},this.dispose=function(){}}}const Tp=new td,nre=new gs;function sre(r,e){function i(v,_){v.matrixAutoUpdate===!0&&v.updateMatrix(),_.value.copy(v.matrix)}function n(v,_){_.color.getRGB(v.fogColor.value,A4(r)),_.isFog?(v.fogNear.value=_.near,v.fogFar.value=_.far):_.isFogExp2&&(v.fogDensity.value=_.density)}function s(v,_,C,E,T){_.isMeshBasicMaterial||_.isMeshLambertMaterial?o(v,_):_.isMeshToonMaterial?(o(v,_),f(v,_)):_.isMeshPhongMaterial?(o(v,_),p(v,_)):_.isMeshStandardMaterial?(o(v,_),g(v,_),_.isMeshPhysicalMaterial&&m(v,_,T)):_.isMeshMatcapMaterial?(o(v,_),y(v,_)):_.isMeshDepthMaterial?o(v,_):_.isMeshDistanceMaterial?(o(v,_),b(v,_)):_.isMeshNormalMaterial?o(v,_):_.isLineBasicMaterial?(l(v,_),_.isLineDashedMaterial&&u(v,_)):_.isPointsMaterial?c(v,_,C,E):_.isSpriteMaterial?h(v,_):_.isShadowMaterial?(v.color.value.copy(_.color),v.opacity.value=_.opacity):_.isShaderMaterial&&(_.uniformsNeedUpdate=!1)}function o(v,_){v.opacity.value=_.opacity,_.color&&v.diffuse.value.copy(_.color),_.emissive&&v.emissive.value.copy(_.emissive).multiplyScalar(_.emissiveIntensity),_.map&&(v.map.value=_.map,i(_.map,v.mapTransform)),_.alphaMap&&(v.alphaMap.value=_.alphaMap,i(_.alphaMap,v.alphaMapTransform)),_.bumpMap&&(v.bumpMap.value=_.bumpMap,i(_.bumpMap,v.bumpMapTransform),v.bumpScale.value=_.bumpScale,_.side===bo&&(v.bumpScale.value*=-1)),_.normalMap&&(v.normalMap.value=_.normalMap,i(_.normalMap,v.normalMapTransform),v.normalScale.value.copy(_.normalScale),_.side===bo&&v.normalScale.value.negate()),_.displacementMap&&(v.displacementMap.value=_.displacementMap,i(_.displacementMap,v.displacementMapTransform),v.displacementScale.value=_.displacementScale,v.displacementBias.value=_.displacementBias),_.emissiveMap&&(v.emissiveMap.value=_.emissiveMap,i(_.emissiveMap,v.emissiveMapTransform)),_.specularMap&&(v.specularMap.value=_.specularMap,i(_.specularMap,v.specularMapTransform)),_.alphaTest>0&&(v.alphaTest.value=_.alphaTest);const C=e.get(_),E=C.envMap,T=C.envMapRotation;E&&(v.envMap.value=E,Tp.copy(T),Tp.x*=-1,Tp.y*=-1,Tp.z*=-1,E.isCubeTexture&&E.isRenderTargetTexture===!1&&(Tp.y*=-1,Tp.z*=-1),v.envMapRotation.value.setFromMatrix4(nre.makeRotationFromEuler(Tp)),v.flipEnvMap.value=E.isCubeTexture&&E.isRenderTargetTexture===!1?-1:1,v.reflectivity.value=_.reflectivity,v.ior.value=_.ior,v.refractionRatio.value=_.refractionRatio),_.lightMap&&(v.lightMap.value=_.lightMap,v.lightMapIntensity.value=_.lightMapIntensity,i(_.lightMap,v.lightMapTransform)),_.aoMap&&(v.aoMap.value=_.aoMap,v.aoMapIntensity.value=_.aoMapIntensity,i(_.aoMap,v.aoMapTransform))}function l(v,_){v.diffuse.value.copy(_.color),v.opacity.value=_.opacity,_.map&&(v.map.value=_.map,i(_.map,v.mapTransform))}function u(v,_){v.dashSize.value=_.dashSize,v.totalSize.value=_.dashSize+_.gapSize,v.scale.value=_.scale}function c(v,_,C,E){v.diffuse.value.copy(_.color),v.opacity.value=_.opacity,v.size.value=_.size*C,v.scale.value=E*.5,_.map&&(v.map.value=_.map,i(_.map,v.uvTransform)),_.alphaMap&&(v.alphaMap.value=_.alphaMap,i(_.alphaMap,v.alphaMapTransform)),_.alphaTest>0&&(v.alphaTest.value=_.alphaTest)}function h(v,_){v.diffuse.value.copy(_.color),v.opacity.value=_.opacity,v.rotation.value=_.rotation,_.map&&(v.map.value=_.map,i(_.map,v.mapTransform)),_.alphaMap&&(v.alphaMap.value=_.alphaMap,i(_.alphaMap,v.alphaMapTransform)),_.alphaTest>0&&(v.alphaTest.value=_.alphaTest)}function p(v,_){v.specular.value.copy(_.specular),v.shininess.value=Math.max(_.shininess,1e-4)}function f(v,_){_.gradientMap&&(v.gradientMap.value=_.gradientMap)}function g(v,_){v.metalness.value=_.metalness,_.metalnessMap&&(v.metalnessMap.value=_.metalnessMap,i(_.metalnessMap,v.metalnessMapTransform)),v.roughness.value=_.roughness,_.roughnessMap&&(v.roughnessMap.value=_.roughnessMap,i(_.roughnessMap,v.roughnessMapTransform)),_.envMap&&(v.envMapIntensity.value=_.envMapIntensity)}function m(v,_,C){v.ior.value=_.ior,_.sheen>0&&(v.sheenColor.value.copy(_.sheenColor).multiplyScalar(_.sheen),v.sheenRoughness.value=_.sheenRoughness,_.sheenColorMap&&(v.sheenColorMap.value=_.sheenColorMap,i(_.sheenColorMap,v.sheenColorMapTransform)),_.sheenRoughnessMap&&(v.sheenRoughnessMap.value=_.sheenRoughnessMap,i(_.sheenRoughnessMap,v.sheenRoughnessMapTransform))),_.clearcoat>0&&(v.clearcoat.value=_.clearcoat,v.clearcoatRoughness.value=_.clearcoatRoughness,_.clearcoatMap&&(v.clearcoatMap.value=_.clearcoatMap,i(_.clearcoatMap,v.clearcoatMapTransform)),_.clearcoatRoughnessMap&&(v.clearcoatRoughnessMap.value=_.clearcoatRoughnessMap,i(_.clearcoatRoughnessMap,v.clearcoatRoughnessMapTransform)),_.clearcoatNormalMap&&(v.clearcoatNormalMap.value=_.clearcoatNormalMap,i(_.clearcoatNormalMap,v.clearcoatNormalMapTransform),v.clearcoatNormalScale.value.copy(_.clearcoatNormalScale),_.side===bo&&v.clearcoatNormalScale.value.negate())),_.dispersion>0&&(v.dispersion.value=_.dispersion),_.iridescence>0&&(v.iridescence.value=_.iridescence,v.iridescenceIOR.value=_.iridescenceIOR,v.iridescenceThicknessMinimum.value=_.iridescenceThicknessRange[0],v.iridescenceThicknessMaximum.value=_.iridescenceThicknessRange[1],_.iridescenceMap&&(v.iridescenceMap.value=_.iridescenceMap,i(_.iridescenceMap,v.iridescenceMapTransform)),_.iridescenceThicknessMap&&(v.iridescenceThicknessMap.value=_.iridescenceThicknessMap,i(_.iridescenceThicknessMap,v.iridescenceThicknessMapTransform))),_.transmission>0&&(v.transmission.value=_.transmission,v.transmissionSamplerMap.value=C.texture,v.transmissionSamplerSize.value.set(C.width,C.height),_.transmissionMap&&(v.transmissionMap.value=_.transmissionMap,i(_.transmissionMap,v.transmissionMapTransform)),v.thickness.value=_.thickness,_.thicknessMap&&(v.thicknessMap.value=_.thicknessMap,i(_.thicknessMap,v.thicknessMapTransform)),v.attenuationDistance.value=_.attenuationDistance,v.attenuationColor.value.copy(_.attenuationColor)),_.anisotropy>0&&(v.anisotropyVector.value.set(_.anisotropy*Math.cos(_.anisotropyRotation),_.anisotropy*Math.sin(_.anisotropyRotation)),_.anisotropyMap&&(v.anisotropyMap.value=_.anisotropyMap,i(_.anisotropyMap,v.anisotropyMapTransform))),v.specularIntensity.value=_.specularIntensity,v.specularColor.value.copy(_.specularColor),_.specularColorMap&&(v.specularColorMap.value=_.specularColorMap,i(_.specularColorMap,v.specularColorMapTransform)),_.specularIntensityMap&&(v.specularIntensityMap.value=_.specularIntensityMap,i(_.specularIntensityMap,v.specularIntensityMapTransform))}function y(v,_){_.matcap&&(v.matcap.value=_.matcap)}function b(v,_){const C=e.get(_).light;v.referencePosition.value.setFromMatrixPosition(C.matrixWorld),v.nearDistance.value=C.shadow.camera.near,v.farDistance.value=C.shadow.camera.far}return{refreshFogUniforms:n,refreshMaterialUniforms:s}}function are(r,e,i,n){let s={},o={},l=[];const u=r.getParameter(r.MAX_UNIFORM_BUFFER_BINDINGS);function c(C,E){const T=E.program;n.uniformBlockBinding(C,T)}function h(C,E){let T=s[C.id];T===void 0&&(y(C),T=p(C),s[C.id]=T,C.addEventListener("dispose",v));const R=E.program;n.updateUBOMapping(C,R);const B=e.render.frame;o[C.id]!==B&&(g(C),o[C.id]=B)}function p(C){const E=f();C.__bindingPointIndex=E;const T=r.createBuffer(),R=C.__size,B=C.usage;return r.bindBuffer(r.UNIFORM_BUFFER,T),r.bufferData(r.UNIFORM_BUFFER,R,B),r.bindBuffer(r.UNIFORM_BUFFER,null),r.bindBufferBase(r.UNIFORM_BUFFER,E,T),T}function f(){for(let C=0;C<u;C++)if(l.indexOf(C)===-1)return l.push(C),C;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function g(C){const E=s[C.id],T=C.uniforms,R=C.__cache;r.bindBuffer(r.UNIFORM_BUFFER,E);for(let B=0,I=T.length;B<I;B++){const D=Array.isArray(T[B])?T[B]:[T[B]];for(let L=0,O=D.length;L<O;L++){const F=D[L];if(m(F,B,L,R)===!0){const q=F.__offset,H=Array.isArray(F.value)?F.value:[F.value];let G=0;for(let J=0;J<H.length;J++){const Q=H[J],V=b(Q);typeof Q=="number"||typeof Q=="boolean"?(F.__data[0]=Q,r.bufferSubData(r.UNIFORM_BUFFER,q+G,F.__data)):Q.isMatrix3?(F.__data[0]=Q.elements[0],F.__data[1]=Q.elements[1],F.__data[2]=Q.elements[2],F.__data[3]=0,F.__data[4]=Q.elements[3],F.__data[5]=Q.elements[4],F.__data[6]=Q.elements[5],F.__data[7]=0,F.__data[8]=Q.elements[6],F.__data[9]=Q.elements[7],F.__data[10]=Q.elements[8],F.__data[11]=0):(Q.toArray(F.__data,G),G+=V.storage/Float32Array.BYTES_PER_ELEMENT)}r.bufferSubData(r.UNIFORM_BUFFER,q,F.__data)}}}r.bindBuffer(r.UNIFORM_BUFFER,null)}function m(C,E,T,R){const B=C.value,I=E+"_"+T;if(R[I]===void 0)return typeof B=="number"||typeof B=="boolean"?R[I]=B:R[I]=B.clone(),!0;{const D=R[I];if(typeof B=="number"||typeof B=="boolean"){if(D!==B)return R[I]=B,!0}else if(D.equals(B)===!1)return D.copy(B),!0}return!1}function y(C){const E=C.uniforms;let T=0;const R=16;for(let I=0,D=E.length;I<D;I++){const L=Array.isArray(E[I])?E[I]:[E[I]];for(let O=0,F=L.length;O<F;O++){const q=L[O],H=Array.isArray(q.value)?q.value:[q.value];for(let G=0,J=H.length;G<J;G++){const Q=H[G],V=b(Q),z=T%R,te=z%V.boundary,K=z+te;T+=te,K!==0&&R-K<V.storage&&(T+=R-K),q.__data=new Float32Array(V.storage/Float32Array.BYTES_PER_ELEMENT),q.__offset=T,T+=V.storage}}}const B=T%R;return B>0&&(T+=R-B),C.__size=T,C.__cache={},this}function b(C){const E={boundary:0,storage:0};return typeof C=="number"||typeof C=="boolean"?(E.boundary=4,E.storage=4):C.isVector2?(E.boundary=8,E.storage=8):C.isVector3||C.isColor?(E.boundary=16,E.storage=12):C.isVector4?(E.boundary=16,E.storage=16):C.isMatrix3?(E.boundary=48,E.storage=48):C.isMatrix4?(E.boundary=64,E.storage=64):C.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",C),E}function v(C){const E=C.target;E.removeEventListener("dispose",v);const T=l.indexOf(E.__bindingPointIndex);l.splice(T,1),r.deleteBuffer(s[E.id]),delete s[E.id],delete o[E.id]}function _(){for(const C in s)r.deleteBuffer(s[C]);l=[],s={},o={}}return{bind:c,update:h,dispose:_}}class ore{constructor(e={}){const{canvas:i=YJ(),context:n=null,depth:s=!0,stencil:o=!1,alpha:l=!1,antialias:u=!1,premultipliedAlpha:c=!0,preserveDrawingBuffer:h=!1,powerPreference:p="default",failIfMajorPerformanceCaveat:f=!1,reverseDepthBuffer:g=!1}=e;this.isWebGLRenderer=!0;let m;if(n!==null){if(typeof WebGLRenderingContext<"u"&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");m=n.getContextAttributes().alpha}else m=l;const y=new Uint32Array(4),b=new Int32Array(4);let v=null,_=null;const C=[],E=[];this.domElement=i,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=jo,this.toneMapping=Xh,this.toneMappingExposure=1;const T=this;let R=!1,B=0,I=0,D=null,L=-1,O=null;const F=new Zs,q=new Zs;let H=null;const G=new Sn(0);let J=0,Q=i.width,V=i.height,z=1,te=null,K=null;const ae=new Zs(0,0,Q,V),Ae=new Zs(0,0,Q,V);let _e=!1;const me=new rT;let Pe=!1,Xe=!1;const Je=new gs,tt=new gs,dt=new ot,wt=new Zs,qt={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let yt=!1;function Ei(){return D===null?z:1}let $e=n;function Ui(Ie,se){return i.getContext(Ie,se)}try{const Ie={alpha:!0,depth:s,stencil:o,antialias:u,premultipliedAlpha:c,preserveDrawingBuffer:h,powerPreference:p,failIfMajorPerformanceCaveat:f};if("setAttribute"in i&&i.setAttribute("data-engine",`three.js r${ex}`),i.addEventListener("webglcontextlost",pt,!1),i.addEventListener("webglcontextrestored",Lt,!1),i.addEventListener("webglcontextcreationerror",xt,!1),$e===null){const se="webgl2";if($e=Ui(se,Ie),$e===null)throw Ui(se)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(Ie){throw console.error("THREE.WebGLRenderer: "+Ie.message),Ie}let hi,Ri,Si,Zi,Vi,Ge,Ce,At,Pt,$t,Mt,yi,vt,ye,ve,Ne,Te,ke,Oe,U,$,re,Re,ce;function Ue(){hi=new dte($e),hi.init(),re=new Jie($e,hi),Ri=new ate($e,hi,e,re),Si=new Xie($e,hi),Ri.reverseDepthBuffer&&g&&Si.buffers.depth.setReversed(!0),Zi=new mte($e),Vi=new Lie,Ge=new Yie($e,hi,Si,Vi,Ri,re,Zi),Ce=new lte(T),At=new hte(T),Pt=new _Z($e),Re=new nte($e,Pt),$t=new pte($e,Pt,Zi,Re),Mt=new Ate($e,$t,Pt,Zi),Oe=new gte($e,Ri,Ge),Ne=new ote(Vi),yi=new Nie(T,Ce,At,hi,Ri,Re,Ne),vt=new sre(T,Vi),ye=new Oie,ve=new jie(hi),ke=new rte(T,Ce,At,Si,Mt,m,c),Te=new Qie(T,Mt,Ri),ce=new are($e,Zi,Ri,Si),U=new ste($e,hi,Zi),$=new fte($e,hi,Zi),Zi.programs=yi.programs,T.capabilities=Ri,T.extensions=hi,T.properties=Vi,T.renderLists=ye,T.shadowMap=Te,T.state=Si,T.info=Zi}Ue();const je=new rre(T,$e);this.xr=je,this.getContext=function(){return $e},this.getContextAttributes=function(){return $e.getContextAttributes()},this.forceContextLoss=function(){const Ie=hi.get("WEBGL_lose_context");Ie&&Ie.loseContext()},this.forceContextRestore=function(){const Ie=hi.get("WEBGL_lose_context");Ie&&Ie.restoreContext()},this.getPixelRatio=function(){return z},this.setPixelRatio=function(Ie){Ie!==void 0&&(z=Ie,this.setSize(Q,V,!1))},this.getSize=function(Ie){return Ie.set(Q,V)},this.setSize=function(Ie,se,fe=!0){if(je.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}Q=Ie,V=se,i.width=Math.floor(Ie*z),i.height=Math.floor(se*z),fe===!0&&(i.style.width=Ie+"px",i.style.height=se+"px"),this.setViewport(0,0,Ie,se)},this.getDrawingBufferSize=function(Ie){return Ie.set(Q*z,V*z).floor()},this.setDrawingBufferSize=function(Ie,se,fe){Q=Ie,V=se,z=fe,i.width=Math.floor(Ie*fe),i.height=Math.floor(se*fe),this.setViewport(0,0,Ie,se)},this.getCurrentViewport=function(Ie){return Ie.copy(F)},this.getViewport=function(Ie){return Ie.copy(ae)},this.setViewport=function(Ie,se,fe,Be){Ie.isVector4?ae.set(Ie.x,Ie.y,Ie.z,Ie.w):ae.set(Ie,se,fe,Be),Si.viewport(F.copy(ae).multiplyScalar(z).round())},this.getScissor=function(Ie){return Ie.copy(Ae)},this.setScissor=function(Ie,se,fe,Be){Ie.isVector4?Ae.set(Ie.x,Ie.y,Ie.z,Ie.w):Ae.set(Ie,se,fe,Be),Si.scissor(q.copy(Ae).multiplyScalar(z).round())},this.getScissorTest=function(){return _e},this.setScissorTest=function(Ie){Si.setScissorTest(_e=Ie)},this.setOpaqueSort=function(Ie){te=Ie},this.setTransparentSort=function(Ie){K=Ie},this.getClearColor=function(Ie){return Ie.copy(ke.getClearColor())},this.setClearColor=function(){ke.setClearColor.apply(ke,arguments)},this.getClearAlpha=function(){return ke.getClearAlpha()},this.setClearAlpha=function(){ke.setClearAlpha.apply(ke,arguments)},this.clear=function(Ie=!0,se=!0,fe=!0){let Be=0;if(Ie){let Fe=!1;if(D!==null){const Ye=D.texture.format;Fe=Ye===aS||Ye===sS||Ye===nS}if(Fe){const Ye=D.texture.type,lt=Ye===Mu||Ye===mp||Ye===AA||Ye===_m||Ye===iS||Ye===rS,Ct=ke.getClearColor(),Yt=ke.getClearAlpha(),ei=Ct.r,Bt=Ct.g,ni=Ct.b;lt?(y[0]=ei,y[1]=Bt,y[2]=ni,y[3]=Yt,$e.clearBufferuiv($e.COLOR,0,y)):(b[0]=ei,b[1]=Bt,b[2]=ni,b[3]=Yt,$e.clearBufferiv($e.COLOR,0,b))}else Be|=$e.COLOR_BUFFER_BIT}se&&(Be|=$e.DEPTH_BUFFER_BIT),fe&&(Be|=$e.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),$e.clear(Be)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){i.removeEventListener("webglcontextlost",pt,!1),i.removeEventListener("webglcontextrestored",Lt,!1),i.removeEventListener("webglcontextcreationerror",xt,!1),ye.dispose(),ve.dispose(),Vi.dispose(),Ce.dispose(),At.dispose(),Mt.dispose(),Re.dispose(),ce.dispose(),yi.dispose(),je.dispose(),je.removeEventListener("sessionstart",nn),je.removeEventListener("sessionend",vs),An.stop()};function pt(Ie){Ie.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),R=!0}function Lt(){console.log("THREE.WebGLRenderer: Context Restored."),R=!1;const Ie=Zi.autoReset,se=Te.enabled,fe=Te.autoUpdate,Be=Te.needsUpdate,Fe=Te.type;Ue(),Zi.autoReset=Ie,Te.enabled=se,Te.autoUpdate=fe,Te.needsUpdate=Be,Te.type=Fe}function xt(Ie){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",Ie.statusMessage)}function Gt(Ie){const se=Ie.target;se.removeEventListener("dispose",Gt),mi(se)}function mi(Ie){_r(Ie),Vi.remove(Ie)}function _r(Ie){const se=Vi.get(Ie).programs;se!==void 0&&(se.forEach(function(fe){yi.releaseProgram(fe)}),Ie.isShaderMaterial&&yi.releaseShaderCache(Ie))}this.renderBufferDirect=function(Ie,se,fe,Be,Fe,Ye){se===null&&(se=qt);const lt=Fe.isMesh&&Fe.matrixWorld.determinant()<0,Ct=ar(Ie,se,fe,Be,Fe);Si.setMaterial(Be,lt);let Yt=fe.index,ei=1;if(Be.wireframe===!0){if(Yt=$t.getWireframeAttribute(fe),Yt===void 0)return;ei=2}const Bt=fe.drawRange,ni=fe.attributes.position;let wi=Bt.start*ei,zi=(Bt.start+Bt.count)*ei;Ye!==null&&(wi=Math.max(wi,Ye.start*ei),zi=Math.min(zi,(Ye.start+Ye.count)*ei)),Yt!==null?(wi=Math.max(wi,0),zi=Math.min(zi,Yt.count)):ni!=null&&(wi=Math.max(wi,0),zi=Math.min(zi,ni.count));const Sr=zi-wi;if(Sr<0||Sr===1/0)return;Re.setup(Fe,Be,Ct,fe,Yt);let hr,er=U;if(Yt!==null&&(hr=Pt.get(Yt),er=$,er.setIndex(hr)),Fe.isMesh)Be.wireframe===!0?(Si.setLineWidth(Be.wireframeLinewidth*Ei()),er.setMode($e.LINES)):er.setMode($e.TRIANGLES);else if(Fe.isLine){let _i=Be.linewidth;_i===void 0&&(_i=1),Si.setLineWidth(_i*Ei()),Fe.isLineSegments?er.setMode($e.LINES):Fe.isLineLoop?er.setMode($e.LINE_LOOP):er.setMode($e.LINE_STRIP)}else Fe.isPoints?er.setMode($e.POINTS):Fe.isSprite&&er.setMode($e.TRIANGLES);if(Fe.isBatchedMesh)if(Fe._multiDrawInstances!==null)er.renderMultiDrawInstances(Fe._multiDrawStarts,Fe._multiDrawCounts,Fe._multiDrawCount,Fe._multiDrawInstances);else if(hi.get("WEBGL_multi_draw"))er.renderMultiDraw(Fe._multiDrawStarts,Fe._multiDrawCounts,Fe._multiDrawCount);else{const _i=Fe._multiDrawStarts,Rn=Fe._multiDrawCounts,Kn=Fe._multiDrawCount,Bi=Yt?Pt.get(Yt).bytesPerElement:1,or=Vi.get(Be).currentProgram.getUniforms();for(let dn=0;dn<Kn;dn++)or.setValue($e,"_gl_DrawID",dn),er.render(_i[dn]/Bi,Rn[dn])}else if(Fe.isInstancedMesh)er.renderInstances(wi,Sr,Fe.count);else if(fe.isInstancedBufferGeometry){const _i=fe._maxInstanceCount!==void 0?fe._maxInstanceCount:1/0,Rn=Math.min(fe.instanceCount,_i);er.renderInstances(wi,Sr,Rn)}else er.render(wi,Sr)};function Fi(Ie,se,fe){Ie.transparent===!0&&Ie.side===Su&&Ie.forceSinglePass===!1?(Ie.side=bo,Ie.needsUpdate=!0,Tt(Ie,se,fe),Ie.side=qh,Ie.needsUpdate=!0,Tt(Ie,se,fe),Ie.side=Su):Tt(Ie,se,fe)}this.compile=function(Ie,se,fe=null){fe===null&&(fe=Ie),_=ve.get(fe),_.init(se),E.push(_),fe.traverseVisible(function(Fe){Fe.isLight&&Fe.layers.test(se.layers)&&(_.pushLight(Fe),Fe.castShadow&&_.pushShadow(Fe))}),Ie!==fe&&Ie.traverseVisible(function(Fe){Fe.isLight&&Fe.layers.test(se.layers)&&(_.pushLight(Fe),Fe.castShadow&&_.pushShadow(Fe))}),_.setupLights();const Be=new Set;return Ie.traverse(function(Fe){if(!(Fe.isMesh||Fe.isPoints||Fe.isLine||Fe.isSprite))return;const Ye=Fe.material;if(Ye)if(Array.isArray(Ye))for(let lt=0;lt<Ye.length;lt++){const Ct=Ye[lt];Fi(Ct,fe,Fe),Be.add(Ct)}else Fi(Ye,fe,Fe),Be.add(Ye)}),E.pop(),_=null,Be},this.compileAsync=function(Ie,se,fe=null){const Be=this.compile(Ie,se,fe);return new Promise(Fe=>{function Ye(){if(Be.forEach(function(lt){Vi.get(lt).currentProgram.isReady()&&Be.delete(lt)}),Be.size===0){Fe(Ie);return}setTimeout(Ye,10)}hi.get("KHR_parallel_shader_compile")!==null?Ye():setTimeout(Ye,10)})};let gn=null;function kr(Ie){gn&&gn(Ie)}function nn(){An.stop()}function vs(){An.start()}const An=new E4;An.setAnimationLoop(kr),typeof self<"u"&&An.setContext(self),this.setAnimationLoop=function(Ie){gn=Ie,je.setAnimationLoop(Ie),Ie===null?An.stop():An.start()},je.addEventListener("sessionstart",nn),je.addEventListener("sessionend",vs),this.render=function(Ie,se){if(se!==void 0&&se.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(R===!0)return;if(Ie.matrixWorldAutoUpdate===!0&&Ie.updateMatrixWorld(),se.parent===null&&se.matrixWorldAutoUpdate===!0&&se.updateMatrixWorld(),je.enabled===!0&&je.isPresenting===!0&&(je.cameraAutoUpdate===!0&&je.updateCamera(se),se=je.getCamera()),Ie.isScene===!0&&Ie.onBeforeRender(T,Ie,se,D),_=ve.get(Ie,E.length),_.init(se),E.push(_),tt.multiplyMatrices(se.projectionMatrix,se.matrixWorldInverse),me.setFromProjectionMatrix(tt),Xe=this.localClippingEnabled,Pe=Ne.init(this.clippingPlanes,Xe),v=ye.get(Ie,C.length),v.init(),C.push(v),je.enabled===!0&&je.isPresenting===!0){const Ye=T.xr.getDepthSensingMesh();Ye!==null&&Ns(Ye,se,-1/0,T.sortObjects)}Ns(Ie,se,0,T.sortObjects),v.finish(),T.sortObjects===!0&&v.sort(te,K),yt=je.enabled===!1||je.isPresenting===!1||je.hasDepthSensing()===!1,yt&&ke.addToRenderList(v,Ie),this.info.render.frame++,Pe===!0&&Ne.beginShadows();const fe=_.state.shadowsArray;Te.render(fe,Ie,se),Pe===!0&&Ne.endShadows(),this.info.autoReset===!0&&this.info.reset();const Be=v.opaque,Fe=v.transmissive;if(_.setupLights(),se.isArrayCamera){const Ye=se.cameras;if(Fe.length>0)for(let lt=0,Ct=Ye.length;lt<Ct;lt++){const Yt=Ye[lt];bs(Be,Fe,Ie,Yt)}yt&&ke.render(Ie);for(let lt=0,Ct=Ye.length;lt<Ct;lt++){const Yt=Ye[lt];ts(v,Ie,Yt,Yt.viewport)}}else Fe.length>0&&bs(Be,Fe,Ie,se),yt&&ke.render(Ie),ts(v,Ie,se);D!==null&&(Ge.updateMultisampleRenderTarget(D),Ge.updateRenderTargetMipmap(D)),Ie.isScene===!0&&Ie.onAfterRender(T,Ie,se),Re.resetDefaultState(),L=-1,O=null,E.pop(),E.length>0?(_=E[E.length-1],Pe===!0&&Ne.setGlobalState(T.clippingPlanes,_.state.camera)):_=null,C.pop(),C.length>0?v=C[C.length-1]:v=null};function Ns(Ie,se,fe,Be){if(Ie.visible===!1)return;if(Ie.layers.test(se.layers)){if(Ie.isGroup)fe=Ie.renderOrder;else if(Ie.isLOD)Ie.autoUpdate===!0&&Ie.update(se);else if(Ie.isLight)_.pushLight(Ie),Ie.castShadow&&_.pushShadow(Ie);else if(Ie.isSprite){if(!Ie.frustumCulled||me.intersectsSprite(Ie)){Be&&wt.setFromMatrixPosition(Ie.matrixWorld).applyMatrix4(tt);const Ye=Mt.update(Ie),lt=Ie.material;lt.visible&&v.push(Ie,Ye,lt,fe,wt.z,null)}}else if((Ie.isMesh||Ie.isLine||Ie.isPoints)&&(!Ie.frustumCulled||me.intersectsObject(Ie))){const Ye=Mt.update(Ie),lt=Ie.material;if(Be&&(Ie.boundingSphere!==void 0?(Ie.boundingSphere===null&&Ie.computeBoundingSphere(),wt.copy(Ie.boundingSphere.center)):(Ye.boundingSphere===null&&Ye.computeBoundingSphere(),wt.copy(Ye.boundingSphere.center)),wt.applyMatrix4(Ie.matrixWorld).applyMatrix4(tt)),Array.isArray(lt)){const Ct=Ye.groups;for(let Yt=0,ei=Ct.length;Yt<ei;Yt++){const Bt=Ct[Yt],ni=lt[Bt.materialIndex];ni&&ni.visible&&v.push(Ie,Ye,ni,fe,wt.z,Bt)}}else lt.visible&&v.push(Ie,Ye,lt,fe,wt.z,null)}}const Fe=Ie.children;for(let Ye=0,lt=Fe.length;Ye<lt;Ye++)Ns(Fe[Ye],se,fe,Be)}function ts(Ie,se,fe,Be){const Fe=Ie.opaque,Ye=Ie.transmissive,lt=Ie.transparent;_.setupLightsView(fe),Pe===!0&&Ne.setGlobalState(T.clippingPlanes,fe),Be&&Si.viewport(F.copy(Be)),Fe.length>0&&pe(Fe,se,fe),Ye.length>0&&pe(Ye,se,fe),lt.length>0&&pe(lt,se,fe),Si.buffers.depth.setTest(!0),Si.buffers.depth.setMask(!0),Si.buffers.color.setMask(!0),Si.setPolygonOffset(!1)}function bs(Ie,se,fe,Be){if((fe.isScene===!0?fe.overrideMaterial:null)!==null)return;_.state.transmissionRenderTarget[Be.id]===void 0&&(_.state.transmissionRenderTarget[Be.id]=new Yh(1,1,{generateMipmaps:!0,type:hi.has("EXT_color_buffer_half_float")||hi.has("EXT_color_buffer_float")?xm:Mu,minFilter:fp,samples:4,stencilBuffer:o,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Fn.workingColorSpace}));const Fe=_.state.transmissionRenderTarget[Be.id],Ye=Be.viewport||F;Fe.setSize(Ye.z,Ye.w);const lt=T.getRenderTarget();T.setRenderTarget(Fe),T.getClearColor(G),J=T.getClearAlpha(),J<1&&T.setClearColor(16777215,.5),T.clear(),yt&&ke.render(fe);const Ct=T.toneMapping;T.toneMapping=Xh;const Yt=Be.viewport;if(Be.viewport!==void 0&&(Be.viewport=void 0),_.setupLightsView(Be),Pe===!0&&Ne.setGlobalState(T.clippingPlanes,Be),pe(Ie,fe,Be),Ge.updateMultisampleRenderTarget(Fe),Ge.updateRenderTargetMipmap(Fe),hi.has("WEBGL_multisampled_render_to_texture")===!1){let ei=!1;for(let Bt=0,ni=se.length;Bt<ni;Bt++){const wi=se[Bt],zi=wi.object,Sr=wi.geometry,hr=wi.material,er=wi.group;if(hr.side===Su&&zi.layers.test(Be.layers)){const _i=hr.side;hr.side=bo,hr.needsUpdate=!0,ct(zi,fe,Be,Sr,hr,er),hr.side=_i,hr.needsUpdate=!0,ei=!0}}ei===!0&&(Ge.updateMultisampleRenderTarget(Fe),Ge.updateRenderTargetMipmap(Fe))}T.setRenderTarget(lt),T.setClearColor(G,J),Yt!==void 0&&(Be.viewport=Yt),T.toneMapping=Ct}function pe(Ie,se,fe){const Be=se.isScene===!0?se.overrideMaterial:null;for(let Fe=0,Ye=Ie.length;Fe<Ye;Fe++){const lt=Ie[Fe],Ct=lt.object,Yt=lt.geometry,ei=Be===null?lt.material:Be,Bt=lt.group;Ct.layers.test(fe.layers)&&ct(Ct,se,fe,Yt,ei,Bt)}}function ct(Ie,se,fe,Be,Fe,Ye){Ie.onBeforeRender(T,se,fe,Be,Fe,Ye),Ie.modelViewMatrix.multiplyMatrices(fe.matrixWorldInverse,Ie.matrixWorld),Ie.normalMatrix.getNormalMatrix(Ie.modelViewMatrix),Fe.onBeforeRender(T,se,fe,Be,Ie,Ye),Fe.transparent===!0&&Fe.side===Su&&Fe.forceSinglePass===!1?(Fe.side=bo,Fe.needsUpdate=!0,T.renderBufferDirect(fe,se,Be,Fe,Ie,Ye),Fe.side=qh,Fe.needsUpdate=!0,T.renderBufferDirect(fe,se,Be,Fe,Ie,Ye),Fe.side=Su):T.renderBufferDirect(fe,se,Be,Fe,Ie,Ye),Ie.onAfterRender(T,se,fe,Be,Fe,Ye)}function Tt(Ie,se,fe){se.isScene!==!0&&(se=qt);const Be=Vi.get(Ie),Fe=_.state.lights,Ye=_.state.shadowsArray,lt=Fe.state.version,Ct=yi.getParameters(Ie,Fe.state,Ye,se,fe),Yt=yi.getProgramCacheKey(Ct);let ei=Be.programs;Be.environment=Ie.isMeshStandardMaterial?se.environment:null,Be.fog=se.fog,Be.envMap=(Ie.isMeshStandardMaterial?At:Ce).get(Ie.envMap||Be.environment),Be.envMapRotation=Be.environment!==null&&Ie.envMap===null?se.environmentRotation:Ie.envMapRotation,ei===void 0&&(Ie.addEventListener("dispose",Gt),ei=new Map,Be.programs=ei);let Bt=ei.get(Yt);if(Bt!==void 0){if(Be.currentProgram===Bt&&Be.lightsStateVersion===lt)return Ni(Ie,Ct),Bt}else Ct.uniforms=yi.getUniforms(Ie),Ie.onBeforeCompile(Ct,T),Bt=yi.acquireProgram(Ct,Yt),ei.set(Yt,Bt),Be.uniforms=Ct.uniforms;const ni=Be.uniforms;return(!Ie.isShaderMaterial&&!Ie.isRawShaderMaterial||Ie.clipping===!0)&&(ni.clippingPlanes=Ne.uniform),Ni(Ie,Ct),Be.needsLights=ki(Ie),Be.lightsStateVersion=lt,Be.needsLights&&(ni.ambientLightColor.value=Fe.state.ambient,ni.lightProbe.value=Fe.state.probe,ni.directionalLights.value=Fe.state.directional,ni.directionalLightShadows.value=Fe.state.directionalShadow,ni.spotLights.value=Fe.state.spot,ni.spotLightShadows.value=Fe.state.spotShadow,ni.rectAreaLights.value=Fe.state.rectArea,ni.ltc_1.value=Fe.state.rectAreaLTC1,ni.ltc_2.value=Fe.state.rectAreaLTC2,ni.pointLights.value=Fe.state.point,ni.pointLightShadows.value=Fe.state.pointShadow,ni.hemisphereLights.value=Fe.state.hemi,ni.directionalShadowMap.value=Fe.state.directionalShadowMap,ni.directionalShadowMatrix.value=Fe.state.directionalShadowMatrix,ni.spotShadowMap.value=Fe.state.spotShadowMap,ni.spotLightMatrix.value=Fe.state.spotLightMatrix,ni.spotLightMap.value=Fe.state.spotLightMap,ni.pointShadowMap.value=Fe.state.pointShadowMap,ni.pointShadowMatrix.value=Fe.state.pointShadowMatrix),Be.currentProgram=Bt,Be.uniformsList=null,Bt}function Jt(Ie){if(Ie.uniformsList===null){const se=Ie.currentProgram.getUniforms();Ie.uniformsList=Lx.seqWithValue(se.seq,Ie.uniforms)}return Ie.uniformsList}function Ni(Ie,se){const fe=Vi.get(Ie);fe.outputColorSpace=se.outputColorSpace,fe.batching=se.batching,fe.batchingColor=se.batchingColor,fe.instancing=se.instancing,fe.instancingColor=se.instancingColor,fe.instancingMorph=se.instancingMorph,fe.skinning=se.skinning,fe.morphTargets=se.morphTargets,fe.morphNormals=se.morphNormals,fe.morphColors=se.morphColors,fe.morphTargetsCount=se.morphTargetsCount,fe.numClippingPlanes=se.numClippingPlanes,fe.numIntersection=se.numClipIntersection,fe.vertexAlphas=se.vertexAlphas,fe.vertexTangents=se.vertexTangents,fe.toneMapping=se.toneMapping}function ar(Ie,se,fe,Be,Fe){se.isScene!==!0&&(se=qt),Ge.resetTextureUnits();const Ye=se.fog,lt=Be.isMeshStandardMaterial?se.environment:null,Ct=D===null?T.outputColorSpace:D.isXRRenderTarget===!0?D.texture.colorSpace:Cm,Yt=(Be.isMeshStandardMaterial?At:Ce).get(Be.envMap||lt),ei=Be.vertexColors===!0&&!!fe.attributes.color&&fe.attributes.color.itemSize===4,Bt=!!fe.attributes.tangent&&(!!Be.normalMap||Be.anisotropy>0),ni=!!fe.morphAttributes.position,wi=!!fe.morphAttributes.normal,zi=!!fe.morphAttributes.color;let Sr=Xh;Be.toneMapped&&(D===null||D.isXRRenderTarget===!0)&&(Sr=T.toneMapping);const hr=fe.morphAttributes.position||fe.morphAttributes.normal||fe.morphAttributes.color,er=hr!==void 0?hr.length:0,_i=Vi.get(Be),Rn=_.state.lights;if(Pe===!0&&(Xe===!0||Ie!==O)){const Se=Ie===O&&Be.id===L;Ne.setState(Be,Ie,Se)}let Kn=!1;Be.version===_i.__version?(_i.needsLights&&_i.lightsStateVersion!==Rn.state.version||_i.outputColorSpace!==Ct||Fe.isBatchedMesh&&_i.batching===!1||!Fe.isBatchedMesh&&_i.batching===!0||Fe.isBatchedMesh&&_i.batchingColor===!0&&Fe.colorTexture===null||Fe.isBatchedMesh&&_i.batchingColor===!1&&Fe.colorTexture!==null||Fe.isInstancedMesh&&_i.instancing===!1||!Fe.isInstancedMesh&&_i.instancing===!0||Fe.isSkinnedMesh&&_i.skinning===!1||!Fe.isSkinnedMesh&&_i.skinning===!0||Fe.isInstancedMesh&&_i.instancingColor===!0&&Fe.instanceColor===null||Fe.isInstancedMesh&&_i.instancingColor===!1&&Fe.instanceColor!==null||Fe.isInstancedMesh&&_i.instancingMorph===!0&&Fe.morphTexture===null||Fe.isInstancedMesh&&_i.instancingMorph===!1&&Fe.morphTexture!==null||_i.envMap!==Yt||Be.fog===!0&&_i.fog!==Ye||_i.numClippingPlanes!==void 0&&(_i.numClippingPlanes!==Ne.numPlanes||_i.numIntersection!==Ne.numIntersection)||_i.vertexAlphas!==ei||_i.vertexTangents!==Bt||_i.morphTargets!==ni||_i.morphNormals!==wi||_i.morphColors!==zi||_i.toneMapping!==Sr||_i.morphTargetsCount!==er)&&(Kn=!0):(Kn=!0,_i.__version=Be.version);let Bi=_i.currentProgram;Kn===!0&&(Bi=Tt(Be,se,Fe));let or=!1,dn=!1,qr=!1;const W=Bi.getUniforms(),ue=_i.uniforms;if(Si.useProgram(Bi.program)&&(or=!0,dn=!0,qr=!0),Be.id!==L&&(L=Be.id,dn=!0),or||O!==Ie){Si.buffers.depth.getReversed()?(Je.copy(Ie.projectionMatrix),ZJ(Je),$J(Je),W.setValue($e,"projectionMatrix",Je)):W.setValue($e,"projectionMatrix",Ie.projectionMatrix),W.setValue($e,"viewMatrix",Ie.matrixWorldInverse);const Se=W.map.cameraPosition;Se!==void 0&&Se.setValue($e,dt.setFromMatrixPosition(Ie.matrixWorld)),Ri.logarithmicDepthBuffer&&W.setValue($e,"logDepthBufFC",2/(Math.log(Ie.far+1)/Math.LN2)),(Be.isMeshPhongMaterial||Be.isMeshToonMaterial||Be.isMeshLambertMaterial||Be.isMeshBasicMaterial||Be.isMeshStandardMaterial||Be.isShaderMaterial)&&W.setValue($e,"isOrthographic",Ie.isOrthographicCamera===!0),O!==Ie&&(O=Ie,dn=!0,qr=!0)}if(Fe.isSkinnedMesh){W.setOptional($e,Fe,"bindMatrix"),W.setOptional($e,Fe,"bindMatrixInverse");const Se=Fe.skeleton;Se&&(Se.boneTexture===null&&Se.computeBoneTexture(),W.setValue($e,"boneTexture",Se.boneTexture,Ge))}Fe.isBatchedMesh&&(W.setOptional($e,Fe,"batchingTexture"),W.setValue($e,"batchingTexture",Fe._matricesTexture,Ge),W.setOptional($e,Fe,"batchingIdTexture"),W.setValue($e,"batchingIdTexture",Fe._indirectTexture,Ge),W.setOptional($e,Fe,"batchingColorTexture"),Fe._colorsTexture!==null&&W.setValue($e,"batchingColorTexture",Fe._colorsTexture,Ge));const ge=fe.morphAttributes;if((ge.position!==void 0||ge.normal!==void 0||ge.color!==void 0)&&Oe.update(Fe,fe,Bi),(dn||_i.receiveShadow!==Fe.receiveShadow)&&(_i.receiveShadow=Fe.receiveShadow,W.setValue($e,"receiveShadow",Fe.receiveShadow)),Be.isMeshGouraudMaterial&&Be.envMap!==null&&(ue.envMap.value=Yt,ue.flipEnvMap.value=Yt.isCubeTexture&&Yt.isRenderTargetTexture===!1?-1:1),Be.isMeshStandardMaterial&&Be.envMap===null&&se.environment!==null&&(ue.envMapIntensity.value=se.environmentIntensity),dn&&(W.setValue($e,"toneMappingExposure",T.toneMappingExposure),_i.needsLights&&Di(ue,qr),Ye&&Be.fog===!0&&vt.refreshFogUniforms(ue,Ye),vt.refreshMaterialUniforms(ue,Be,z,V,_.state.transmissionRenderTarget[Ie.id]),Lx.upload($e,Jt(_i),ue,Ge)),Be.isShaderMaterial&&Be.uniformsNeedUpdate===!0&&(Lx.upload($e,Jt(_i),ue,Ge),Be.uniformsNeedUpdate=!1),Be.isSpriteMaterial&&W.setValue($e,"center",Fe.center),W.setValue($e,"modelViewMatrix",Fe.modelViewMatrix),W.setValue($e,"normalMatrix",Fe.normalMatrix),W.setValue($e,"modelMatrix",Fe.matrixWorld),Be.isShaderMaterial||Be.isRawShaderMaterial){const Se=Be.uniformsGroups;for(let We=0,Ke=Se.length;We<Ke;We++){const mt=Se[We];ce.update(mt,Bi),ce.bind(mt,Bi)}}return Bi}function Di(Ie,se){Ie.ambientLightColor.needsUpdate=se,Ie.lightProbe.needsUpdate=se,Ie.directionalLights.needsUpdate=se,Ie.directionalLightShadows.needsUpdate=se,Ie.pointLights.needsUpdate=se,Ie.pointLightShadows.needsUpdate=se,Ie.spotLights.needsUpdate=se,Ie.spotLightShadows.needsUpdate=se,Ie.rectAreaLights.needsUpdate=se,Ie.hemisphereLights.needsUpdate=se}function ki(Ie){return Ie.isMeshLambertMaterial||Ie.isMeshToonMaterial||Ie.isMeshPhongMaterial||Ie.isMeshStandardMaterial||Ie.isShadowMaterial||Ie.isShaderMaterial&&Ie.lights===!0}this.getActiveCubeFace=function(){return B},this.getActiveMipmapLevel=function(){return I},this.getRenderTarget=function(){return D},this.setRenderTargetTextures=function(Ie,se,fe){Vi.get(Ie.texture).__webglTexture=se,Vi.get(Ie.depthTexture).__webglTexture=fe;const Be=Vi.get(Ie);Be.__hasExternalTextures=!0,Be.__autoAllocateDepthBuffer=fe===void 0,Be.__autoAllocateDepthBuffer||hi.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Be.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(Ie,se){const fe=Vi.get(Ie);fe.__webglFramebuffer=se,fe.__useDefaultFramebuffer=se===void 0},this.setRenderTarget=function(Ie,se=0,fe=0){D=Ie,B=se,I=fe;let Be=!0,Fe=null,Ye=!1,lt=!1;if(Ie){const Ct=Vi.get(Ie);if(Ct.__useDefaultFramebuffer!==void 0)Si.bindFramebuffer($e.FRAMEBUFFER,null),Be=!1;else if(Ct.__webglFramebuffer===void 0)Ge.setupRenderTarget(Ie);else if(Ct.__hasExternalTextures)Ge.rebindTextures(Ie,Vi.get(Ie.texture).__webglTexture,Vi.get(Ie.depthTexture).__webglTexture);else if(Ie.depthBuffer){const Bt=Ie.depthTexture;if(Ct.__boundDepthTexture!==Bt){if(Bt!==null&&Vi.has(Bt)&&(Ie.width!==Bt.image.width||Ie.height!==Bt.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");Ge.setupDepthRenderbuffer(Ie)}}const Yt=Ie.texture;(Yt.isData3DTexture||Yt.isDataArrayTexture||Yt.isCompressedArrayTexture)&&(lt=!0);const ei=Vi.get(Ie).__webglFramebuffer;Ie.isWebGLCubeRenderTarget?(Array.isArray(ei[se])?Fe=ei[se][fe]:Fe=ei[se],Ye=!0):Ie.samples>0&&Ge.useMultisampledRTT(Ie)===!1?Fe=Vi.get(Ie).__webglMultisampledFramebuffer:Array.isArray(ei)?Fe=ei[fe]:Fe=ei,F.copy(Ie.viewport),q.copy(Ie.scissor),H=Ie.scissorTest}else F.copy(ae).multiplyScalar(z).floor(),q.copy(Ae).multiplyScalar(z).floor(),H=_e;if(Si.bindFramebuffer($e.FRAMEBUFFER,Fe)&&Be&&Si.drawBuffers(Ie,Fe),Si.viewport(F),Si.scissor(q),Si.setScissorTest(H),Ye){const Ct=Vi.get(Ie.texture);$e.framebufferTexture2D($e.FRAMEBUFFER,$e.COLOR_ATTACHMENT0,$e.TEXTURE_CUBE_MAP_POSITIVE_X+se,Ct.__webglTexture,fe)}else if(lt){const Ct=Vi.get(Ie.texture),Yt=se||0;$e.framebufferTextureLayer($e.FRAMEBUFFER,$e.COLOR_ATTACHMENT0,Ct.__webglTexture,fe||0,Yt)}L=-1},this.readRenderTargetPixels=function(Ie,se,fe,Be,Fe,Ye,lt){if(!(Ie&&Ie.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Ct=Vi.get(Ie).__webglFramebuffer;if(Ie.isWebGLCubeRenderTarget&&lt!==void 0&&(Ct=Ct[lt]),Ct){Si.bindFramebuffer($e.FRAMEBUFFER,Ct);try{const Yt=Ie.texture,ei=Yt.format,Bt=Yt.type;if(!Ri.textureFormatReadable(ei)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Ri.textureTypeReadable(Bt)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}se>=0&&se<=Ie.width-Be&&fe>=0&&fe<=Ie.height-Fe&&$e.readPixels(se,fe,Be,Fe,re.convert(ei),re.convert(Bt),Ye)}finally{const Yt=D!==null?Vi.get(D).__webglFramebuffer:null;Si.bindFramebuffer($e.FRAMEBUFFER,Yt)}}},this.readRenderTargetPixelsAsync=async function(Ie,se,fe,Be,Fe,Ye,lt){if(!(Ie&&Ie.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Ct=Vi.get(Ie).__webglFramebuffer;if(Ie.isWebGLCubeRenderTarget&&lt!==void 0&&(Ct=Ct[lt]),Ct){const Yt=Ie.texture,ei=Yt.format,Bt=Yt.type;if(!Ri.textureFormatReadable(ei))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Ri.textureTypeReadable(Bt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(se>=0&&se<=Ie.width-Be&&fe>=0&&fe<=Ie.height-Fe){Si.bindFramebuffer($e.FRAMEBUFFER,Ct);const ni=$e.createBuffer();$e.bindBuffer($e.PIXEL_PACK_BUFFER,ni),$e.bufferData($e.PIXEL_PACK_BUFFER,Ye.byteLength,$e.STREAM_READ),$e.readPixels(se,fe,Be,Fe,re.convert(ei),re.convert(Bt),0);const wi=D!==null?Vi.get(D).__webglFramebuffer:null;Si.bindFramebuffer($e.FRAMEBUFFER,wi);const zi=$e.fenceSync($e.SYNC_GPU_COMMANDS_COMPLETE,0);return $e.flush(),await JJ($e,zi,4),$e.bindBuffer($e.PIXEL_PACK_BUFFER,ni),$e.getBufferSubData($e.PIXEL_PACK_BUFFER,0,Ye),$e.deleteBuffer(ni),$e.deleteSync(zi),Ye}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(Ie,se=null,fe=0){Ie.isTexture!==!0&&(_A("WebGLRenderer: copyFramebufferToTexture function signature has changed."),se=arguments[0]||null,Ie=arguments[1]);const Be=Math.pow(2,-fe),Fe=Math.floor(Ie.image.width*Be),Ye=Math.floor(Ie.image.height*Be),lt=se!==null?se.x:0,Ct=se!==null?se.y:0;Ge.setTexture2D(Ie,0),$e.copyTexSubImage2D($e.TEXTURE_2D,fe,0,0,lt,Ct,Fe,Ye),Si.unbindTexture()},this.copyTextureToTexture=function(Ie,se,fe=null,Be=null,Fe=0){Ie.isTexture!==!0&&(_A("WebGLRenderer: copyTextureToTexture function signature has changed."),Be=arguments[0]||null,Ie=arguments[1],se=arguments[2],Fe=arguments[3]||0,fe=null);let Ye,lt,Ct,Yt,ei,Bt,ni,wi,zi;const Sr=Ie.isCompressedTexture?Ie.mipmaps[Fe]:Ie.image;fe!==null?(Ye=fe.max.x-fe.min.x,lt=fe.max.y-fe.min.y,Ct=fe.isBox3?fe.max.z-fe.min.z:1,Yt=fe.min.x,ei=fe.min.y,Bt=fe.isBox3?fe.min.z:0):(Ye=Sr.width,lt=Sr.height,Ct=Sr.depth||1,Yt=0,ei=0,Bt=0),Be!==null?(ni=Be.x,wi=Be.y,zi=Be.z):(ni=0,wi=0,zi=0);const hr=re.convert(se.format),er=re.convert(se.type);let _i;se.isData3DTexture?(Ge.setTexture3D(se,0),_i=$e.TEXTURE_3D):se.isDataArrayTexture||se.isCompressedArrayTexture?(Ge.setTexture2DArray(se,0),_i=$e.TEXTURE_2D_ARRAY):(Ge.setTexture2D(se,0),_i=$e.TEXTURE_2D),$e.pixelStorei($e.UNPACK_FLIP_Y_WEBGL,se.flipY),$e.pixelStorei($e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,se.premultiplyAlpha),$e.pixelStorei($e.UNPACK_ALIGNMENT,se.unpackAlignment);const Rn=$e.getParameter($e.UNPACK_ROW_LENGTH),Kn=$e.getParameter($e.UNPACK_IMAGE_HEIGHT),Bi=$e.getParameter($e.UNPACK_SKIP_PIXELS),or=$e.getParameter($e.UNPACK_SKIP_ROWS),dn=$e.getParameter($e.UNPACK_SKIP_IMAGES);$e.pixelStorei($e.UNPACK_ROW_LENGTH,Sr.width),$e.pixelStorei($e.UNPACK_IMAGE_HEIGHT,Sr.height),$e.pixelStorei($e.UNPACK_SKIP_PIXELS,Yt),$e.pixelStorei($e.UNPACK_SKIP_ROWS,ei),$e.pixelStorei($e.UNPACK_SKIP_IMAGES,Bt);const qr=Ie.isDataArrayTexture||Ie.isData3DTexture,W=se.isDataArrayTexture||se.isData3DTexture;if(Ie.isRenderTargetTexture||Ie.isDepthTexture){const ue=Vi.get(Ie),ge=Vi.get(se),Se=Vi.get(ue.__renderTarget),We=Vi.get(ge.__renderTarget);Si.bindFramebuffer($e.READ_FRAMEBUFFER,Se.__webglFramebuffer),Si.bindFramebuffer($e.DRAW_FRAMEBUFFER,We.__webglFramebuffer);for(let Ke=0;Ke<Ct;Ke++)qr&&$e.framebufferTextureLayer($e.READ_FRAMEBUFFER,$e.COLOR_ATTACHMENT0,Vi.get(Ie).__webglTexture,Fe,Bt+Ke),Ie.isDepthTexture?(W&&$e.framebufferTextureLayer($e.DRAW_FRAMEBUFFER,$e.COLOR_ATTACHMENT0,Vi.get(se).__webglTexture,Fe,zi+Ke),$e.blitFramebuffer(Yt,ei,Ye,lt,ni,wi,Ye,lt,$e.DEPTH_BUFFER_BIT,$e.NEAREST)):W?$e.copyTexSubImage3D(_i,Fe,ni,wi,zi+Ke,Yt,ei,Ye,lt):$e.copyTexSubImage2D(_i,Fe,ni,wi,zi+Ke,Yt,ei,Ye,lt);Si.bindFramebuffer($e.READ_FRAMEBUFFER,null),Si.bindFramebuffer($e.DRAW_FRAMEBUFFER,null)}else W?Ie.isDataTexture||Ie.isData3DTexture?$e.texSubImage3D(_i,Fe,ni,wi,zi,Ye,lt,Ct,hr,er,Sr.data):se.isCompressedArrayTexture?$e.compressedTexSubImage3D(_i,Fe,ni,wi,zi,Ye,lt,Ct,hr,Sr.data):$e.texSubImage3D(_i,Fe,ni,wi,zi,Ye,lt,Ct,hr,er,Sr):Ie.isDataTexture?$e.texSubImage2D($e.TEXTURE_2D,Fe,ni,wi,Ye,lt,hr,er,Sr.data):Ie.isCompressedTexture?$e.compressedTexSubImage2D($e.TEXTURE_2D,Fe,ni,wi,Sr.width,Sr.height,hr,Sr.data):$e.texSubImage2D($e.TEXTURE_2D,Fe,ni,wi,Ye,lt,hr,er,Sr);$e.pixelStorei($e.UNPACK_ROW_LENGTH,Rn),$e.pixelStorei($e.UNPACK_IMAGE_HEIGHT,Kn),$e.pixelStorei($e.UNPACK_SKIP_PIXELS,Bi),$e.pixelStorei($e.UNPACK_SKIP_ROWS,or),$e.pixelStorei($e.UNPACK_SKIP_IMAGES,dn),Fe===0&&se.generateMipmaps&&$e.generateMipmap(_i),Si.unbindTexture()},this.copyTextureToTexture3D=function(Ie,se,fe=null,Be=null,Fe=0){return Ie.isTexture!==!0&&(_A("WebGLRenderer: copyTextureToTexture3D function signature has changed."),fe=arguments[0]||null,Be=arguments[1]||null,Ie=arguments[2],se=arguments[3],Fe=arguments[4]||0),_A('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(Ie,se,fe,Be,Fe)},this.initRenderTarget=function(Ie){Vi.get(Ie).__webglFramebuffer===void 0&&Ge.setupRenderTarget(Ie)},this.initTexture=function(Ie){Ie.isCubeTexture?Ge.setTextureCube(Ie,0):Ie.isData3DTexture?Ge.setTexture3D(Ie,0):Ie.isDataArrayTexture||Ie.isCompressedArrayTexture?Ge.setTexture2DArray(Ie,0):Ge.setTexture2D(Ie,0),Si.unbindTexture()},this.resetState=function(){B=0,I=0,D=null,Si.reset(),Re.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Iu}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const i=this.getContext();i.drawingBufferColorspace=Fn._getDrawingBufferColorSpace(e),i.unpackColorSpace=Fn._getUnpackColorSpace()}}let lre=class extends to{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new td,this.environmentIntensity=1,this.environmentRotation=new td,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(r,e){return super.copy(r,e),r.background!==null&&(this.background=r.background.clone()),r.environment!==null&&(this.environment=r.environment.clone()),r.fog!==null&&(this.fog=r.fog.clone()),this.backgroundBlurriness=r.backgroundBlurriness,this.backgroundIntensity=r.backgroundIntensity,this.backgroundRotation.copy(r.backgroundRotation),this.environmentIntensity=r.environmentIntensity,this.environmentRotation.copy(r.environmentRotation),r.overrideMaterial!==null&&(this.overrideMaterial=r.overrideMaterial.clone()),this.matrixAutoUpdate=r.matrixAutoUpdate,this}toJSON(r){const e=super.toJSON(r);return this.fog!==null&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(e.object.backgroundIntensity=this.backgroundIntensity),e.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(e.object.environmentIntensity=this.environmentIntensity),e.object.environmentRotation=this.environmentRotation.toArray(),e}},cre=class{constructor(r,e){this.isInterleavedBuffer=!0,this.array=r,this.stride=e,this.count=r!==void 0?r.length/e:0,this.usage=LS,this.updateRanges=[],this.version=0,this.uuid=Bu()}onUploadCallback(){}set needsUpdate(r){r===!0&&this.version++}setUsage(r){return this.usage=r,this}addUpdateRange(r,e){this.updateRanges.push({start:r,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(r){return this.array=new r.array.constructor(r.array),this.count=r.count,this.stride=r.stride,this.usage=r.usage,this}copyAt(r,e,i){r*=this.stride,i*=e.stride;for(let n=0,s=this.stride;n<s;n++)this.array[r+n]=e.array[i+n];return this}set(r,e=0){return this.array.set(r,e),this}clone(r){r.arrayBuffers===void 0&&(r.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Bu()),r.arrayBuffers[this.array.buffer._uuid]===void 0&&(r.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(r.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(e,this.stride);return i.setUsage(this.usage),i}onUpload(r){return this.onUploadCallback=r,this}toJSON(r){return r.arrayBuffers===void 0&&(r.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Bu()),r.arrayBuffers[this.array.buffer._uuid]===void 0&&(r.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}};const _o=new ot;let ek=class nW{constructor(e,i,n,s=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=i,this.offset=n,this.normalized=s}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let i=0,n=this.data.count;i<n;i++)_o.fromBufferAttribute(this,i),_o.applyMatrix4(e),this.setXYZ(i,_o.x,_o.y,_o.z);return this}applyNormalMatrix(e){for(let i=0,n=this.count;i<n;i++)_o.fromBufferAttribute(this,i),_o.applyNormalMatrix(e),this.setXYZ(i,_o.x,_o.y,_o.z);return this}transformDirection(e){for(let i=0,n=this.count;i<n;i++)_o.fromBufferAttribute(this,i),_o.transformDirection(e),this.setXYZ(i,_o.x,_o.y,_o.z);return this}getComponent(e,i){let n=this.array[e*this.data.stride+this.offset+i];return this.normalized&&(n=ac(n,this.array)),n}setComponent(e,i,n){return this.normalized&&(n=rs(n,this.array)),this.data.array[e*this.data.stride+this.offset+i]=n,this}setX(e,i){return this.normalized&&(i=rs(i,this.array)),this.data.array[e*this.data.stride+this.offset]=i,this}setY(e,i){return this.normalized&&(i=rs(i,this.array)),this.data.array[e*this.data.stride+this.offset+1]=i,this}setZ(e,i){return this.normalized&&(i=rs(i,this.array)),this.data.array[e*this.data.stride+this.offset+2]=i,this}setW(e,i){return this.normalized&&(i=rs(i,this.array)),this.data.array[e*this.data.stride+this.offset+3]=i,this}getX(e){let i=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(i=ac(i,this.array)),i}getY(e){let i=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(i=ac(i,this.array)),i}getZ(e){let i=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(i=ac(i,this.array)),i}getW(e){let i=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(i=ac(i,this.array)),i}setXY(e,i,n){return e=e*this.data.stride+this.offset,this.normalized&&(i=rs(i,this.array),n=rs(n,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=n,this}setXYZ(e,i,n,s){return e=e*this.data.stride+this.offset,this.normalized&&(i=rs(i,this.array),n=rs(n,this.array),s=rs(s,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=n,this.data.array[e+2]=s,this}setXYZW(e,i,n,s,o){return e=e*this.data.stride+this.offset,this.normalized&&(i=rs(i,this.array),n=rs(n,this.array),s=rs(s,this.array),o=rs(o,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=n,this.data.array[e+2]=s,this.data.array[e+3]=o,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let n=0;n<this.count;n++){const s=n*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)i.push(this.data.array[s+o])}return new Go(new this.array.constructor(i),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new nW(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let n=0;n<this.count;n++){const s=n*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)i.push(this.data.array[s+o])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:i,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}},tk=class extends xp{static get type(){return"SpriteMaterial"}constructor(r){super(),this.isSpriteMaterial=!0,this.color=new Sn(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.alphaMap=r.alphaMap,this.rotation=r.rotation,this.sizeAttenuation=r.sizeAttenuation,this.fog=r.fog,this}},Qm;const MA=new ot,qm=new ot,Xm=new ot,Km=new Gi,RA=new Gi,ik=new gs,Ox=new ot,IA=new ot,Px=new ot,rk=new Gi,fT=new Gi,nk=new Gi;class ure extends to{constructor(e=new tk){if(super(),this.isSprite=!0,this.type="Sprite",Qm===void 0){Qm=new Vo;const i=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new cre(i,5);Qm.setIndex([0,1,2,0,2,3]),Qm.setAttribute("position",new ek(n,3,0,!1)),Qm.setAttribute("uv",new ek(n,2,3,!1))}this.geometry=Qm,this.material=e,this.center=new Gi(.5,.5)}raycast(e,i){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),qm.setFromMatrixScale(this.matrixWorld),ik.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Xm.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&qm.multiplyScalar(-Xm.z);const n=this.material.rotation;let s,o;n!==0&&(o=Math.cos(n),s=Math.sin(n));const l=this.center;kx(Ox.set(-.5,-.5,0),Xm,l,qm,s,o),kx(IA.set(.5,-.5,0),Xm,l,qm,s,o),kx(Px.set(.5,.5,0),Xm,l,qm,s,o),rk.set(0,0),fT.set(1,0),nk.set(1,1);let u=e.ray.intersectTriangle(Ox,IA,Px,!1,MA);if(u===null&&(kx(IA.set(-.5,.5,0),Xm,l,qm,s,o),fT.set(0,1),u=e.ray.intersectTriangle(Ox,Px,IA,!1,MA),u===null))return;const c=e.ray.origin.distanceTo(MA);c<e.near||c>e.far||i.push({distance:c,point:MA.clone(),uv:bp.getInterpolation(MA,Ox,IA,Px,rk,fT,nk,new Gi),face:null,object:this})}copy(e,i){return super.copy(e,i),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function kx(r,e,i,n,s,o){Km.subVectors(r,i).addScalar(.5).multiply(n),s!==void 0?(RA.x=o*Km.x-s*Km.y,RA.y=s*Km.x+o*Km.y):RA.copy(Km),r.copy(e),r.x+=RA.x,r.y+=RA.y,r.applyMatrix4(ik)}let mT=class extends xp{static get type(){return"LineBasicMaterial"}constructor(r){super(),this.isLineBasicMaterial=!0,this.color=new Sn(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.linewidth=r.linewidth,this.linecap=r.linecap,this.linejoin=r.linejoin,this.fog=r.fog,this}};const Fx=new ot,Ux=new ot,sk=new gs,BA=new gx,zx=new px,gT=new ot,ak=new ot;class ok extends to{constructor(e=new Vo,i=new mT){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=i,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const i=e.attributes.position,n=[0];for(let s=1,o=i.count;s<o;s++)Fx.fromBufferAttribute(i,s-1),Ux.fromBufferAttribute(i,s),n[s]=n[s-1],n[s]+=Fx.distanceTo(Ux);e.setAttribute("lineDistance",new pa(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,i){const n=this.geometry,s=this.matrixWorld,o=e.params.Line.threshold,l=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),zx.copy(n.boundingSphere),zx.applyMatrix4(s),zx.radius+=o,e.ray.intersectsSphere(zx)===!1)return;sk.copy(s).invert(),BA.copy(e.ray).applyMatrix4(sk);const u=o/((this.scale.x+this.scale.y+this.scale.z)/3),c=u*u,h=this.isLineSegments?2:1,p=n.index,f=n.attributes.position;if(p!==null){const g=Math.max(0,l.start),m=Math.min(p.count,l.start+l.count);for(let y=g,b=m-1;y<b;y+=h){const v=p.getX(y),_=p.getX(y+1),C=jx(this,e,BA,c,v,_);C&&i.push(C)}if(this.isLineLoop){const y=p.getX(m-1),b=p.getX(g),v=jx(this,e,BA,c,y,b);v&&i.push(v)}}else{const g=Math.max(0,l.start),m=Math.min(f.count,l.start+l.count);for(let y=g,b=m-1;y<b;y+=h){const v=jx(this,e,BA,c,y,y+1);v&&i.push(v)}if(this.isLineLoop){const y=jx(this,e,BA,c,m-1,g);y&&i.push(y)}}}updateMorphTargets(){const e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){const n=e[i[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=n.length;s<o;s++){const l=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=s}}}}}function jx(r,e,i,n,s,o){const l=r.geometry.attributes.position;if(Fx.fromBufferAttribute(l,s),Ux.fromBufferAttribute(l,o),i.distanceSqToSegment(Fx,Ux,gT,ak)>n)return;gT.applyMatrix4(r.matrixWorld);const u=e.ray.origin.distanceTo(gT);if(!(u<e.near||u>e.far))return{distance:u,point:ak.clone().applyMatrix4(r.matrixWorld),index:s,face:null,faceIndex:null,barycoord:null,object:r}}class hre extends Ol{constructor(e,i,n,s,o,l,u,c,h){super(e,i,n,s,o,l,u,c,h),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Fu{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,i){const n=this.getUtoTmapping(e);return this.getPoint(n,i)}getPoints(e=5){const i=[];for(let n=0;n<=e;n++)i.push(this.getPoint(n/e));return i}getSpacedPoints(e=5){const i=[];for(let n=0;n<=e;n++)i.push(this.getPointAt(n/e));return i}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const i=[];let n,s=this.getPoint(0),o=0;i.push(0);for(let l=1;l<=e;l++)n=this.getPoint(l/e),o+=n.distanceTo(s),i.push(o),s=n;return this.cacheArcLengths=i,i}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,i){const n=this.getLengths();let s=0;const o=n.length;let l;i?l=i:l=e*n[o-1];let u=0,c=o-1,h;for(;u<=c;)if(s=Math.floor(u+(c-u)/2),h=n[s]-l,h<0)u=s+1;else if(h>0)c=s-1;else{c=s;break}if(s=c,n[s]===l)return s/(o-1);const p=n[s],f=n[s+1]-p,g=(l-p)/f;return(s+g)/(o-1)}getTangent(e,i){let n=e-1e-4,s=e+1e-4;n<0&&(n=0),s>1&&(s=1);const o=this.getPoint(n),l=this.getPoint(s),u=i||(o.isVector2?new Gi:new ot);return u.copy(l).sub(o).normalize(),u}getTangentAt(e,i){const n=this.getUtoTmapping(e);return this.getTangent(n,i)}computeFrenetFrames(e,i){const n=new ot,s=[],o=[],l=[],u=new ot,c=new gs;for(let m=0;m<=e;m++){const y=m/e;s[m]=this.getTangentAt(y,new ot)}o[0]=new ot,l[0]=new ot;let h=Number.MAX_VALUE;const p=Math.abs(s[0].x),f=Math.abs(s[0].y),g=Math.abs(s[0].z);p<=h&&(h=p,n.set(1,0,0)),f<=h&&(h=f,n.set(0,1,0)),g<=h&&n.set(0,0,1),u.crossVectors(s[0],n).normalize(),o[0].crossVectors(s[0],u),l[0].crossVectors(s[0],o[0]);for(let m=1;m<=e;m++){if(o[m]=o[m-1].clone(),l[m]=l[m-1].clone(),u.crossVectors(s[m-1],s[m]),u.length()>Number.EPSILON){u.normalize();const y=Math.acos(Ta(s[m-1].dot(s[m]),-1,1));o[m].applyMatrix4(c.makeRotationAxis(u,y))}l[m].crossVectors(s[m],o[m])}if(i===!0){let m=Math.acos(Ta(o[0].dot(o[e]),-1,1));m/=e,s[0].dot(u.crossVectors(o[0],o[e]))>0&&(m=-m);for(let y=1;y<=e;y++)o[y].applyMatrix4(c.makeRotationAxis(s[y],m*y)),l[y].crossVectors(s[y],o[y])}return{tangents:s,normals:o,binormals:l}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class lk extends Fu{constructor(e=0,i=0,n=1,s=1,o=0,l=Math.PI*2,u=!1,c=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=i,this.xRadius=n,this.yRadius=s,this.aStartAngle=o,this.aEndAngle=l,this.aClockwise=u,this.aRotation=c}getPoint(e,i=new Gi){const n=i,s=Math.PI*2;let o=this.aEndAngle-this.aStartAngle;const l=Math.abs(o)<Number.EPSILON;for(;o<0;)o+=s;for(;o>s;)o-=s;o<Number.EPSILON&&(l?o=0:o=s),this.aClockwise===!0&&!l&&(o===s?o=-s:o=o-s);const u=this.aStartAngle+e*o;let c=this.aX+this.xRadius*Math.cos(u),h=this.aY+this.yRadius*Math.sin(u);if(this.aRotation!==0){const p=Math.cos(this.aRotation),f=Math.sin(this.aRotation),g=c-this.aX,m=h-this.aY;c=g*p-m*f+this.aX,h=g*f+m*p+this.aY}return n.set(c,h)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class dre extends lk{constructor(e,i,n,s,o,l){super(e,i,n,n,s,o,l),this.isArcCurve=!0,this.type="ArcCurve"}}function AT(){let r=0,e=0,i=0,n=0;function s(o,l,u,c){r=o,e=u,i=-3*o+3*l-2*u-c,n=2*o-2*l+u+c}return{initCatmullRom:function(o,l,u,c,h){s(l,u,h*(u-o),h*(c-l))},initNonuniformCatmullRom:function(o,l,u,c,h,p,f){let g=(l-o)/h-(u-o)/(h+p)+(u-l)/p,m=(u-l)/p-(c-l)/(p+f)+(c-u)/f;g*=p,m*=p,s(l,u,g,m)},calc:function(o){const l=o*o,u=l*o;return r+e*o+i*l+n*u}}}const Gx=new ot,yT=new AT,vT=new AT,bT=new AT;class pre extends Fu{constructor(e=[],i=!1,n="centripetal",s=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=i,this.curveType=n,this.tension=s}getPoint(e,i=new ot){const n=i,s=this.points,o=s.length,l=(o-(this.closed?0:1))*e;let u=Math.floor(l),c=l-u;this.closed?u+=u>0?0:(Math.floor(Math.abs(u)/o)+1)*o:c===0&&u===o-1&&(u=o-2,c=1);let h,p;this.closed||u>0?h=s[(u-1)%o]:(Gx.subVectors(s[0],s[1]).add(s[0]),h=Gx);const f=s[u%o],g=s[(u+1)%o];if(this.closed||u+2<o?p=s[(u+2)%o]:(Gx.subVectors(s[o-1],s[o-2]).add(s[o-1]),p=Gx),this.curveType==="centripetal"||this.curveType==="chordal"){const m=this.curveType==="chordal"?.5:.25;let y=Math.pow(h.distanceToSquared(f),m),b=Math.pow(f.distanceToSquared(g),m),v=Math.pow(g.distanceToSquared(p),m);b<1e-4&&(b=1),y<1e-4&&(y=b),v<1e-4&&(v=b),yT.initNonuniformCatmullRom(h.x,f.x,g.x,p.x,y,b,v),vT.initNonuniformCatmullRom(h.y,f.y,g.y,p.y,y,b,v),bT.initNonuniformCatmullRom(h.z,f.z,g.z,p.z,y,b,v)}else this.curveType==="catmullrom"&&(yT.initCatmullRom(h.x,f.x,g.x,p.x,this.tension),vT.initCatmullRom(h.y,f.y,g.y,p.y,this.tension),bT.initCatmullRom(h.z,f.z,g.z,p.z,this.tension));return n.set(yT.calc(c),vT.calc(c),bT.calc(c)),n}copy(e){super.copy(e),this.points=[];for(let i=0,n=e.points.length;i<n;i++){const s=e.points[i];this.points.push(s.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let i=0,n=this.points.length;i<n;i++){const s=this.points[i];e.points.push(s.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let i=0,n=e.points.length;i<n;i++){const s=e.points[i];this.points.push(new ot().fromArray(s))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function ck(r,e,i,n,s){const o=(n-e)*.5,l=(s-i)*.5,u=r*r,c=r*u;return(2*i-2*n+o+l)*c+(-3*i+3*n-2*o-l)*u+o*r+i}function fre(r,e){const i=1-r;return i*i*e}function mre(r,e){return 2*(1-r)*r*e}function gre(r,e){return r*r*e}function NA(r,e,i,n){return fre(r,e)+mre(r,i)+gre(r,n)}function Are(r,e){const i=1-r;return i*i*i*e}function yre(r,e){const i=1-r;return 3*i*i*r*e}function vre(r,e){return 3*(1-r)*r*r*e}function bre(r,e){return r*r*r*e}function LA(r,e,i,n,s){return Are(r,e)+yre(r,i)+vre(r,n)+bre(r,s)}class xre extends Fu{constructor(e=new Gi,i=new Gi,n=new Gi,s=new Gi){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=i,this.v2=n,this.v3=s}getPoint(e,i=new Gi){const n=i,s=this.v0,o=this.v1,l=this.v2,u=this.v3;return n.set(LA(e,s.x,o.x,l.x,u.x),LA(e,s.y,o.y,l.y,u.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class uk extends Fu{constructor(e=new ot,i=new ot,n=new ot,s=new ot){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=i,this.v2=n,this.v3=s}getPoint(e,i=new ot){const n=i,s=this.v0,o=this.v1,l=this.v2,u=this.v3;return n.set(LA(e,s.x,o.x,l.x,u.x),LA(e,s.y,o.y,l.y,u.y),LA(e,s.z,o.z,l.z,u.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class _re extends Fu{constructor(e=new Gi,i=new Gi){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=i}getPoint(e,i=new Gi){const n=i;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,i){return this.getPoint(e,i)}getTangent(e,i=new Gi){return i.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,i){return this.getTangent(e,i)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Ere extends Fu{constructor(e=new ot,i=new ot){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=i}getPoint(e,i=new ot){const n=i;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,i){return this.getPoint(e,i)}getTangent(e,i=new ot){return i.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,i){return this.getTangent(e,i)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class wre extends Fu{constructor(e=new Gi,i=new Gi,n=new Gi){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=i,this.v2=n}getPoint(e,i=new Gi){const n=i,s=this.v0,o=this.v1,l=this.v2;return n.set(NA(e,s.x,o.x,l.x),NA(e,s.y,o.y,l.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class xT extends Fu{constructor(e=new ot,i=new ot,n=new ot){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=i,this.v2=n}getPoint(e,i=new ot){const n=i,s=this.v0,o=this.v1,l=this.v2;return n.set(NA(e,s.x,o.x,l.x),NA(e,s.y,o.y,l.y),NA(e,s.z,o.z,l.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Cre extends Fu{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,i=new Gi){const n=i,s=this.points,o=(s.length-1)*e,l=Math.floor(o),u=o-l,c=s[l===0?l:l-1],h=s[l],p=s[l>s.length-2?s.length-1:l+1],f=s[l>s.length-3?s.length-1:l+2];return n.set(ck(u,c.x,h.x,p.x,f.x),ck(u,c.y,h.y,p.y,f.y)),n}copy(e){super.copy(e),this.points=[];for(let i=0,n=e.points.length;i<n;i++){const s=e.points[i];this.points.push(s.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let i=0,n=this.points.length;i<n;i++){const s=this.points[i];e.points.push(s.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let i=0,n=e.points.length;i<n;i++){const s=e.points[i];this.points.push(new Gi().fromArray(s))}return this}}var Sre=Object.freeze({__proto__:null,ArcCurve:dre,CatmullRomCurve3:pre,CubicBezierCurve:xre,CubicBezierCurve3:uk,EllipseCurve:lk,LineCurve:_re,LineCurve3:Ere,QuadraticBezierCurve:wre,QuadraticBezierCurve3:xT,SplineCurve:Cre});class Vx extends Vo{constructor(e=1,i=1,n=1,s=32,o=1,l=!1,u=0,c=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:i,height:n,radialSegments:s,heightSegments:o,openEnded:l,thetaStart:u,thetaLength:c};const h=this;s=Math.floor(s),o=Math.floor(o);const p=[],f=[],g=[],m=[];let y=0;const b=[],v=n/2;let _=0;C(),l===!1&&(e>0&&E(!0),i>0&&E(!1)),this.setIndex(p),this.setAttribute("position",new pa(f,3)),this.setAttribute("normal",new pa(g,3)),this.setAttribute("uv",new pa(m,2));function C(){const T=new ot,R=new ot;let B=0;const I=(i-e)/n;for(let D=0;D<=o;D++){const L=[],O=D/o,F=O*(i-e)+e;for(let q=0;q<=s;q++){const H=q/s,G=H*c+u,J=Math.sin(G),Q=Math.cos(G);R.x=F*J,R.y=-O*n+v,R.z=F*Q,f.push(R.x,R.y,R.z),T.set(J,I,Q).normalize(),g.push(T.x,T.y,T.z),m.push(H,1-O),L.push(y++)}b.push(L)}for(let D=0;D<s;D++)for(let L=0;L<o;L++){const O=b[L][D],F=b[L+1][D],q=b[L+1][D+1],H=b[L][D+1];(e>0||L!==0)&&(p.push(O,F,H),B+=3),(i>0||L!==o-1)&&(p.push(F,q,H),B+=3)}h.addGroup(_,B,0),_+=B}function E(T){const R=y,B=new Gi,I=new ot;let D=0;const L=T===!0?e:i,O=T===!0?1:-1;for(let q=1;q<=s;q++)f.push(0,v*O,0),g.push(0,O,0),m.push(.5,.5),y++;const F=y;for(let q=0;q<=s;q++){const H=q/s*c+u,G=Math.cos(H),J=Math.sin(H);I.x=L*J,I.y=v*O,I.z=L*G,f.push(I.x,I.y,I.z),g.push(0,O,0),B.x=G*.5+.5,B.y=J*.5*O+.5,m.push(B.x,B.y),y++}for(let q=0;q<s;q++){const H=R+q,G=F+q;T===!0?p.push(G,G+1,H):p.push(G+1,G,H),D+=3}h.addGroup(_,D,T===!0?1:2),_+=D}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Vx(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class _T extends Vx{constructor(e=1,i=1,n=32,s=1,o=!1,l=0,u=Math.PI*2){super(0,e,i,n,s,o,l,u),this.type="ConeGeometry",this.parameters={radius:e,height:i,radialSegments:n,heightSegments:s,openEnded:o,thetaStart:l,thetaLength:u}}static fromJSON(e){return new _T(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}let Hx=class sW extends Vo{constructor(e=1,i=32,n=16,s=0,o=Math.PI*2,l=0,u=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:i,heightSegments:n,phiStart:s,phiLength:o,thetaStart:l,thetaLength:u},i=Math.max(3,Math.floor(i)),n=Math.max(2,Math.floor(n));const c=Math.min(l+u,Math.PI);let h=0;const p=[],f=new ot,g=new ot,m=[],y=[],b=[],v=[];for(let _=0;_<=n;_++){const C=[],E=_/n;let T=0;_===0&&l===0?T=.5/i:_===n&&c===Math.PI&&(T=-.5/i);for(let R=0;R<=i;R++){const B=R/i;f.x=-e*Math.cos(s+B*o)*Math.sin(l+E*u),f.y=e*Math.cos(l+E*u),f.z=e*Math.sin(s+B*o)*Math.sin(l+E*u),y.push(f.x,f.y,f.z),g.copy(f).normalize(),b.push(g.x,g.y,g.z),v.push(B+T,1-E),C.push(h++)}p.push(C)}for(let _=0;_<n;_++)for(let C=0;C<i;C++){const E=p[_][C+1],T=p[_][C],R=p[_+1][C],B=p[_+1][C+1];(_!==0||l>0)&&m.push(E,T,B),(_!==n-1||c<Math.PI)&&m.push(T,R,B)}this.setIndex(m),this.setAttribute("position",new pa(y,3)),this.setAttribute("normal",new pa(b,3)),this.setAttribute("uv",new pa(v,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new sW(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}};class ET extends Vo{constructor(e=new xT(new ot(-1,-1,0),new ot(-1,1,0),new ot(1,1,0)),i=64,n=1,s=8,o=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:i,radius:n,radialSegments:s,closed:o};const l=e.computeFrenetFrames(i,o);this.tangents=l.tangents,this.normals=l.normals,this.binormals=l.binormals;const u=new ot,c=new ot,h=new Gi;let p=new ot;const f=[],g=[],m=[],y=[];b(),this.setIndex(y),this.setAttribute("position",new pa(f,3)),this.setAttribute("normal",new pa(g,3)),this.setAttribute("uv",new pa(m,2));function b(){for(let E=0;E<i;E++)v(E);v(o===!1?i:0),C(),_()}function v(E){p=e.getPointAt(E/i,p);const T=l.normals[E],R=l.binormals[E];for(let B=0;B<=s;B++){const I=B/s*Math.PI*2,D=Math.sin(I),L=-Math.cos(I);c.x=L*T.x+D*R.x,c.y=L*T.y+D*R.y,c.z=L*T.z+D*R.z,c.normalize(),g.push(c.x,c.y,c.z),u.x=p.x+n*c.x,u.y=p.y+n*c.y,u.z=p.z+n*c.z,f.push(u.x,u.y,u.z)}}function _(){for(let E=1;E<=i;E++)for(let T=1;T<=s;T++){const R=(s+1)*(E-1)+(T-1),B=(s+1)*E+(T-1),I=(s+1)*E+T,D=(s+1)*(E-1)+T;y.push(R,B,D),y.push(B,I,D)}}function C(){for(let E=0;E<=i;E++)for(let T=0;T<=s;T++)h.x=E/i,h.y=T/s,m.push(h.x,h.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new ET(new Sre[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}let Tre=class extends xp{static get type(){return"MeshLambertMaterial"}constructor(r){super(),this.isMeshLambertMaterial=!0,this.color=new Sn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Sn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=GP,this.normalScale=new Gi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new td,this.combine=KC,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.lightMap=r.lightMap,this.lightMapIntensity=r.lightMapIntensity,this.aoMap=r.aoMap,this.aoMapIntensity=r.aoMapIntensity,this.emissive.copy(r.emissive),this.emissiveMap=r.emissiveMap,this.emissiveIntensity=r.emissiveIntensity,this.bumpMap=r.bumpMap,this.bumpScale=r.bumpScale,this.normalMap=r.normalMap,this.normalMapType=r.normalMapType,this.normalScale.copy(r.normalScale),this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.specularMap=r.specularMap,this.alphaMap=r.alphaMap,this.envMap=r.envMap,this.envMapRotation.copy(r.envMapRotation),this.combine=r.combine,this.reflectivity=r.reflectivity,this.refractionRatio=r.refractionRatio,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.wireframeLinecap=r.wireframeLinecap,this.wireframeLinejoin=r.wireframeLinejoin,this.flatShading=r.flatShading,this.fog=r.fog,this}};const hk={enabled:!1,files:{},add:function(r,e){this.enabled!==!1&&(this.files[r]=e)},get:function(r){if(this.enabled!==!1)return this.files[r]},remove:function(r){delete this.files[r]},clear:function(){this.files={}}};class Mre{constructor(e,i,n){const s=this;let o=!1,l=0,u=0,c;const h=[];this.onStart=void 0,this.onLoad=e,this.onProgress=i,this.onError=n,this.itemStart=function(p){u++,o===!1&&s.onStart!==void 0&&s.onStart(p,l,u),o=!0},this.itemEnd=function(p){l++,s.onProgress!==void 0&&s.onProgress(p,l,u),l===u&&(o=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(p){s.onError!==void 0&&s.onError(p)},this.resolveURL=function(p){return c?c(p):p},this.setURLModifier=function(p){return c=p,this},this.addHandler=function(p,f){return h.push(p,f),this},this.removeHandler=function(p){const f=h.indexOf(p);return f!==-1&&h.splice(f,2),this},this.getHandler=function(p){for(let f=0,g=h.length;f<g;f+=2){const m=h[f],y=h[f+1];if(m.global&&(m.lastIndex=0),m.test(p))return y}return null}}}const Rre=new Mre;class wT{constructor(e){this.manager=e!==void 0?e:Rre,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,i){const n=this;return new Promise(function(s,o){n.load(e,s,i,o)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}wT.DEFAULT_MATERIAL_NAME="__DEFAULT";class Ire extends wT{constructor(e){super(e)}load(e,i,n,s){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,l=hk.get(e);if(l!==void 0)return o.manager.itemStart(e),setTimeout(function(){i&&i(l),o.manager.itemEnd(e)},0),l;const u=xA("img");function c(){p(),hk.add(e,this),i&&i(this),o.manager.itemEnd(e)}function h(f){p(),s&&s(f),o.manager.itemError(e),o.manager.itemEnd(e)}function p(){u.removeEventListener("load",c,!1),u.removeEventListener("error",h,!1)}return u.addEventListener("load",c,!1),u.addEventListener("error",h,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(u.crossOrigin=this.crossOrigin),o.manager.itemStart(e),u.src=e,u}}class Bre extends wT{constructor(e){super(e)}load(e,i,n,s){const o=new Ol,l=new Ire(this.manager);return l.setCrossOrigin(this.crossOrigin),l.setPath(this.path),l.load(e,function(u){o.image=u,o.needsUpdate=!0,i!==void 0&&i(o)},n,s),o}}let dk=class extends to{constructor(r,e=1){super(),this.isLight=!0,this.type="Light",this.color=new Sn(r),this.intensity=e}dispose(){}copy(r,e){return super.copy(r,e),this.color.copy(r.color),this.intensity=r.intensity,this}toJSON(r){const e=super.toJSON(r);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,this.groundColor!==void 0&&(e.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(e.object.distance=this.distance),this.angle!==void 0&&(e.object.angle=this.angle),this.decay!==void 0&&(e.object.decay=this.decay),this.penumbra!==void 0&&(e.object.penumbra=this.penumbra),this.shadow!==void 0&&(e.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(e.object.target=this.target.uuid),e}};const CT=new gs,pk=new ot,fk=new ot;let Nre=class{constructor(r){this.camera=r,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Gi(512,512),this.map=null,this.mapPass=null,this.matrix=new gs,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new rT,this._frameExtents=new Gi(1,1),this._viewportCount=1,this._viewports=[new Zs(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(r){const e=this.camera,i=this.matrix;pk.setFromMatrixPosition(r.matrixWorld),e.position.copy(pk),fk.setFromMatrixPosition(r.target.matrixWorld),e.lookAt(fk),e.updateMatrixWorld(),CT.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(CT),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(CT)}getViewport(r){return this._viewports[r]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(r){return this.camera=r.camera.clone(),this.intensity=r.intensity,this.bias=r.bias,this.radius=r.radius,this.mapSize.copy(r.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const r={};return this.intensity!==1&&(r.intensity=this.intensity),this.bias!==0&&(r.bias=this.bias),this.normalBias!==0&&(r.normalBias=this.normalBias),this.radius!==1&&(r.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(r.mapSize=this.mapSize.toArray()),r.camera=this.camera.toJSON(!1).object,delete r.camera.matrix,r}},Lre=class extends Nre{constructor(){super(new nT(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},Dre=class extends dk{constructor(r,e){super(r,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(to.DEFAULT_UP),this.updateMatrix(),this.target=new to,this.shadow=new Lre}dispose(){this.shadow.dispose()}copy(r){return super.copy(r),this.target=r.target.clone(),this.shadow=r.shadow.clone(),this}},Ore=class extends dk{constructor(r,e){super(r,e),this.isAmbientLight=!0,this.type="AmbientLight"}};class mk{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=gk(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const i=gk();e=(i-this.oldTime)/1e3,this.oldTime=i,this.elapsedTime+=e}return e}}function gk(){return performance.now()}const Ak=new gs;class yk{constructor(e,i,n=0,s=1/0){this.ray=new gx(e,i),this.near=n,this.far=s,this.camera=null,this.layers=new HS,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,i){this.ray.set(e,i)}setFromCamera(e,i){i.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(i.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(i).sub(this.ray.origin).normalize(),this.camera=i):i.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(i.near+i.far)/(i.near-i.far)).unproject(i),this.ray.direction.set(0,0,-1).transformDirection(i.matrixWorld),this.camera=i):console.error("THREE.Raycaster: Unsupported camera type: "+i.type)}setFromXRController(e){return Ak.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(Ak),this}intersectObject(e,i=!0,n=[]){return ST(e,this,n,i),n.sort(vk),n}intersectObjects(e,i=!0,n=[]){for(let s=0,o=e.length;s<o;s++)ST(e[s],this,n,i);return n.sort(vk),n}}function vk(r,e){return r.distance-e.distance}function ST(r,e,i,n){let s=!0;if(r.layers.test(e.layers)&&r.raycast(e,i)===!1&&(s=!1),s===!0&&n===!0){const o=r.children;for(let l=0,u=o.length;l<u;l++)ST(o[l],e,i,!0)}}class bk{constructor(e=1,i=0,n=0){return this.radius=e,this.phi=i,this.theta=n,this}set(e,i,n){return this.radius=e,this.phi=i,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,i,n){return this.radius=Math.sqrt(e*e+i*i+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Ta(i/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class Wx extends gp{constructor(e,i=null){super(),this.object=e,this.domElement=i,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(){}disconnect(){}dispose(){}update(){}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:ex}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=ex);class Ws{static roundNumber(e,i){const n=Math.pow(10,i);return Math.round(e*n)/n}static sample(e){return e[Math.floor(Math.random()*e.length)]}static distanceToSquared(e,i){var n=e.x-i.x,s=e.y-i.y,o=e.z-i.z;return n*n+s*s+o*o}static isPointInPoly(e,i){for(var n=!1,s=-1,o=e.length,l=o-1;++s<o;l=s)(e[s].z<=i.z&&i.z<e[l].z||e[l].z<=i.z&&i.z<e[s].z)&&i.x<(e[l].x-e[s].x)*(i.z-e[s].z)/(e[l].z-e[s].z)+e[s].x&&(n=!n);return n}static isVectorInPolygon(e,i,n){var s=1e5,o=-1e5,l=[];return i.vertexIds.forEach(u=>{s=Math.min(n[u].y,s),o=Math.max(n[u].y,o),l.push(n[u])}),!!(e.y<o+.5&&e.y>s-.5&&this.isPointInPoly(l,e))}static triarea2(e,i,n){return(n.x-e.x)*(i.z-e.z)-(i.x-e.x)*(n.z-e.z)}static vequal(e,i){return this.distanceToSquared(e,i)<1e-5}static mergeVertices(e,i=1e-4){i=Math.max(i,Number.EPSILON);for(var n={},s=e.getIndex(),o=e.getAttribute("position"),l=s?s.count:o.count,u=0,c=[],h=[],p=Math.log10(1/i),f=Math.pow(10,p),g=0;g<l;g++){var m=s?s.getX(g):g,y="";y+=~~(o.getX(m)*f)+",",y+=~~(o.getY(m)*f)+",",(y+=~~(o.getZ(m)*f)+",")in n?c.push(n[y]):(h.push(o.getX(m)),h.push(o.getY(m)),h.push(o.getZ(m)),n[y]=u,c.push(u),u++)}const b=new Go(new Float32Array(h),o.itemSize,o.normalized),v=new Vo;return v.setAttribute("position",b),v.setIndex(c),v}}class Pre{constructor(e){this.content=[],this.scoreFunction=e}push(e){this.content.push(e),this.sinkDown(this.content.length-1)}pop(){const e=this.content[0],i=this.content.pop();return this.content.length>0&&(this.content[0]=i,this.bubbleUp(0)),e}remove(e){const i=this.content.indexOf(e),n=this.content.pop();i!==this.content.length-1&&(this.content[i]=n,this.scoreFunction(n)<this.scoreFunction(e)?this.sinkDown(i):this.bubbleUp(i))}size(){return this.content.length}rescoreElement(e){this.sinkDown(this.content.indexOf(e))}sinkDown(e){const i=this.content[e];for(;e>0;){const n=(e+1>>1)-1,s=this.content[n];if(!(this.scoreFunction(i)<this.scoreFunction(s)))break;this.content[n]=i,this.content[e]=s,e=n}}bubbleUp(e){const i=this.content.length,n=this.content[e],s=this.scoreFunction(n);for(;;){const o=e+1<<1,l=o-1;let u,c=null;if(l<i&&(u=this.scoreFunction(this.content[l]),u<s&&(c=l)),o<i&&this.scoreFunction(this.content[o])<(c===null?s:u)&&(c=o),c===null)break;this.content[e]=this.content[c],this.content[c]=n,e=c}}}class kre{constructor(){this.portals=[]}push(e,i){i===void 0&&(i=e),this.portals.push({left:e,right:i})}stringPull(){const e=this.portals,i=[];let n,s,o,l=0,u=0,c=0;n=e[0].left,s=e[0].left,o=e[0].right,i.push(n);for(let h=1;h<e.length;h++){const p=e[h].left,f=e[h].right;if(Ws.triarea2(n,o,f)<=0){if(!(Ws.vequal(n,o)||Ws.triarea2(n,s,f)>0)){i.push(s),n=s,l=u,s=n,o=n,u=l,c=l,h=l;continue}o=f,c=h}if(Ws.triarea2(n,s,p)>=0){if(!(Ws.vequal(n,s)||Ws.triarea2(n,o,p)<0)){i.push(o),n=o,l=c,s=n,o=n,u=l,c=l,h=l;continue}s=p,u=h}}return i.length!==0&&Ws.vequal(i[i.length-1],e[e.length-1].left)||i.push(e[e.length-1].left),this.path=i,i}}class TT{constructor(){this.zones={}}static createZone(e,i=1e-4){return(class{static buildZone(n,s){const o=this._buildNavigationMesh(n,s),l={};o.vertices.forEach(c=>{c.x=Ws.roundNumber(c.x,2),c.y=Ws.roundNumber(c.y,2),c.z=Ws.roundNumber(c.z,2)}),l.vertices=o.vertices;const u=this._buildPolygonGroups(o);return l.groups=new Array(u.length),u.forEach((c,h)=>{const p=new Map;c.forEach((g,m)=>{p.set(g,m)});const f=new Array(c.length);c.forEach((g,m)=>{const y=[];g.neighbours.forEach(_=>y.push(p.get(_)));const b=[];g.neighbours.forEach(_=>b.push(this._getSharedVerticesInOrder(g,_)));const v=new ot(0,0,0);v.add(l.vertices[g.vertexIds[0]]),v.add(l.vertices[g.vertexIds[1]]),v.add(l.vertices[g.vertexIds[2]]),v.divideScalar(3),v.x=Ws.roundNumber(v.x,2),v.y=Ws.roundNumber(v.y,2),v.z=Ws.roundNumber(v.z,2),f[m]={id:m,neighbours:y,vertexIds:g.vertexIds,centroid:v,portals:b}}),l.groups[h]=f}),l}static _buildNavigationMesh(n,s){return n=Ws.mergeVertices(n,s),this._buildPolygonsFromGeometry(n)}static _spreadGroupId(n){let s=new Set([n]);for(;s.size>0;){const o=s;s=new Set,o.forEach(l=>{l.group=n.group,l.neighbours.forEach(u=>{u.group===void 0&&s.add(u)})})}}static _buildPolygonGroups(n){const s=[];return n.polygons.forEach(o=>{o.group!==void 0?s[o.group].push(o):(o.group=s.length,this._spreadGroupId(o),s.push([o]))}),s}static _buildPolygonNeighbours(n,s){const o=new Set,l=s[n.vertexIds[1]],u=s[n.vertexIds[2]];return s[n.vertexIds[0]].forEach(c=>{c!==n&&(l.includes(c)||u.includes(c))&&o.add(c)}),l.forEach(c=>{c!==n&&u.includes(c)&&o.add(c)}),o}static _buildPolygonsFromGeometry(n){const s=[],o=[],l=n.attributes.position,u=n.index,c=[];for(let h=0;h<l.count;h++)o.push(new ot().fromBufferAttribute(l,h)),c[h]=[];for(let h=0;h<n.index.count;h+=3){const p=u.getX(h),f=u.getX(h+1),g=u.getX(h+2),m={vertexIds:[p,f,g],neighbours:null};s.push(m),c[p].push(m),c[f].push(m),c[g].push(m)}return s.forEach(h=>{h.neighbours=this._buildPolygonNeighbours(h,c)}),{polygons:s,vertices:o}}static _getSharedVerticesInOrder(n,s){const o=n.vertexIds,l=o[0],u=o[1],c=o[2],h=s.vertexIds,p=h.includes(l),f=h.includes(u),g=h.includes(c);return p&&f&&g?Array.from(o):p&&f?[l,u]:f&&g?[u,c]:p&&g?[c,l]:(console.warn("Error processing navigation mesh neighbors; neighbors with <2 shared vertices found."),[])}}).buildZone(e,i)}setZoneData(e,i){this.zones[e]=i}getRandomNode(e,i,n,s){if(!this.zones[e])return new ot;n=n||null,s=s||0;const o=[];return this.zones[e].groups[i].forEach(l=>{n&&s?Ws.distanceToSquared(n,l.centroid)<s*s&&o.push(l.centroid):o.push(l.centroid)}),Ws.sample(o)||new ot}getClosestNode(e,i,n,s=!1){const o=this.zones[i].vertices;let l=null,u=1/0;return this.zones[i].groups[n].forEach(c=>{const h=Ws.distanceToSquared(c.centroid,e);h<u&&(!s||Ws.isVectorInPolygon(e,c,o))&&(l=c,u=h)}),l}findPath(e,i,n,s){const o=this.zones[n].groups[s],l=this.zones[n].vertices,u=this.getClosestNode(e,n,s,!0),c=this.getClosestNode(i,n,s,!0);if(!u||!c)return null;const h=(class{static init(m){for(let y=0;y<m.length;y++){const b=m[y];b.f=0,b.g=0,b.h=0,b.cost=1,b.visited=!1,b.closed=!1,b.parent=null}}static cleanUp(m){for(let y=0;y<m.length;y++){const b=m[y];delete b.f,delete b.g,delete b.h,delete b.cost,delete b.visited,delete b.closed,delete b.parent}}static heap(){return new Pre(function(m){return m.f})}static search(m,y,b){this.init(m);const v=this.heap();for(v.push(y);v.size()>0;){const _=v.pop();if(_===b){let E=_;const T=[];for(;E.parent;)T.push(E),E=E.parent;return this.cleanUp(T),T.reverse()}_.closed=!0;const C=this.neighbours(m,_);for(let E=0,T=C.length;E<T;E++){const R=C[E];if(R.closed)continue;const B=_.g+R.cost,I=R.visited;if(!I||B<R.g){if(R.visited=!0,R.parent=_,!R.centroid||!b.centroid)throw new Error("Unexpected state");R.h=R.h||this.heuristic(R.centroid,b.centroid),R.g=B,R.f=R.g+R.h,I?v.rescoreElement(R):v.push(R)}}}return[]}static heuristic(m,y){return Ws.distanceToSquared(m,y)}static neighbours(m,y){const b=[];for(let v=0;v<y.neighbours.length;v++)b.push(m[y.neighbours[v]]);return b}}).search(o,u,c),p=function(m,y){for(var b=0;b<m.neighbours.length;b++)if(m.neighbours[b]===y.id)return m.portals[b]},f=new kre;f.push(e);for(let m=0;m<h.length;m++){const y=h[m],b=h[m+1];if(b){const v=p(y,b);f.push(l[v[0]],l[v[1]])}}f.push(i),f.stringPull();const g=f.path.map(m=>new ot(m.x,m.y,m.z));return g.shift(),g}}TT.prototype.getGroup=function(){const r=new uc;return function(e,i,n=!1){if(!this.zones[e])return null;let s=null,o=Math.pow(50,2);const l=this.zones[e];for(let u=0;u<l.groups.length;u++){const c=l.groups[u];for(const h of c){if(n&&(r.setFromCoplanarPoints(l.vertices[h.vertexIds[0]],l.vertices[h.vertexIds[1]],l.vertices[h.vertexIds[2]]),Math.abs(r.distanceToPoint(i))<.01)&&Ws.isPointInPoly([l.vertices[h.vertexIds[0]],l.vertices[h.vertexIds[1]],l.vertices[h.vertexIds[2]]],i))return u;const p=Ws.distanceToSquared(h.centroid,i);p<o&&(s=u,o=p)}}return s}}(),TT.prototype.clampStep=function(){const r=new ot,e=new uc,i=new bp,n=new ot;let s,o,l=new ot;return function(u,c,h,p,f,g){const m=this.zones[p].vertices,y=this.zones[p].groups[f],b=[h],v={};v[h.id]=0,s=void 0,l.set(0,0,0),o=1/0,e.setFromCoplanarPoints(m[h.vertexIds[0]],m[h.vertexIds[1]],m[h.vertexIds[2]]),e.projectPoint(c,r),n.copy(r);for(let _=b.pop();_;_=b.pop()){i.set(m[_.vertexIds[0]],m[_.vertexIds[1]],m[_.vertexIds[2]]),i.closestPointToPoint(n,r),r.distanceToSquared(n)<o&&(s=_,l.copy(r),o=r.distanceToSquared(n));const C=v[_.id];if(!(C>2))for(let E=0;E<_.neighbours.length;E++){const T=y[_.neighbours[E]];T.id in v||(b.push(T),v[T.id]=C+1)}}return g.copy(l),s}}();class Fre extends to{constructor(){super(),this._playerMarker=new za(new Hx(.25,32,32),new rd({color:15631215})),this._targetMarker=new za(new Fm(.3,.3,.3),new rd({color:14469912})),this._nodeMarker=new za(new Fm(.1,.8,.1),new rd({color:4417387})),this._stepMarker=new za(new Fm(.1,1,.1),new rd({color:14472114})),this._pathMarker=new to,this._pathLineMaterial=new mT({color:41903,linewidth:2}),this._pathPointMaterial=new rd({color:41903}),this._pathPointGeometry=new Hx(.08),this._markers=[this._playerMarker,this._targetMarker,this._nodeMarker,this._stepMarker,this._pathMarker],this._markers.forEach(e=>{e.visible=!1,this.add(e)})}setPath(e){for(;this._pathMarker.children.length;)this._pathMarker.children[0].visible=!1,this._pathMarker.remove(this._pathMarker.children[0]);e=[this._playerMarker.position].concat(e);const i=new Vo;i.setAttribute("position",new Go(new Float32Array(3*e.length),3));for(let n=0;n<e.length;n++)i.attributes.position.setXYZ(n,e[n].x,e[n].y+.2,e[n].z);this._pathMarker.add(new ok(i,this._pathLineMaterial));for(let n=0;n<e.length-1;n++){const s=new za(this._pathPointGeometry,this._pathPointMaterial);s.position.copy(e[n]),s.position.y+=.2,this._pathMarker.add(s)}return this._pathMarker.visible=!0,this}setPlayerPosition(e){return this._playerMarker.position.copy(e),this._playerMarker.visible=!0,this}setTargetPosition(e){return this._targetMarker.position.copy(e),this._targetMarker.visible=!0,this}setNodePosition(e){return this._nodeMarker.position.copy(e),this._nodeMarker.visible=!0,this}setStepPosition(e){return this._stepMarker.position.copy(e),this._stepMarker.visible=!0,this}reset(){for(;this._pathMarker.children.length;)this._pathMarker.children[0].visible=!1,this._pathMarker.remove(this._pathMarker.children[0]);return this._markers.forEach(e=>{e.visible=!1}),this}}const Ure=Object.freeze(Object.defineProperty({__proto__:null,Pathfinding:TT,PathfindingHelper:Fre},Symbol.toStringTag,{value:"Module"})),zre=O2(Ure),{Pathfinding:xk}=zre,DA=new xk,OA="level";AFRAME.registerSystem("nav",{init:function(){this.navMesh=null,this.agents=new Set},setNavMeshGeometry:function(r){this.navMesh=new THREE.Mesh(r),DA.setZoneData(OA,xk.createZone(r)),Array.from(this.agents).forEach(e=>e.updateNavLocation())},getNavMesh:function(){return this.navMesh},addAgent:function(r){this.agents.add(r)},removeAgent:function(r){this.agents.delete(r)},getPath:function(r,e,i){return this.navMesh?DA.findPath(r,e,OA,i):null},getGroup:function(r){return this.navMesh?DA.getGroup(OA,r):null},getNode:function(r,e){return this.navMesh?DA.getClosestNode(r,OA,e,!0):null},clampStep:function(r,e,i,n,s){if(this.navMesh){if(!n)return s.copy(e),this.getNode(e,i)}else return s.copy(e),null;return DA.clampStep(r,e,n,OA,i,s)}}),AFRAME.registerPrimitive("a-grid",{defaultComponents:{geometry:{primitive:"plane",width:75,height:75},rotation:{x:-90,y:0,z:0},material:{src:"url(https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v1.16.3/assets/grid.png)",repeat:"75 75"}},mappings:{width:"geometry.width",height:"geometry.height",src:"material.src"}}),AFRAME.registerPrimitive("a-ocean",{defaultComponents:{ocean:{},rotation:{x:-90,y:0,z:0}},mappings:{width:"ocean.width",depth:"ocean.depth",density:"ocean.density",amplitude:"ocean.amplitude",amplitudeVariance:"ocean.amplitudeVariance",speed:"ocean.speed",speedVariance:"ocean.speedVariance",color:"ocean.color",opacity:"ocean.opacity"}}),AFRAME.registerComponent("ocean",{schema:{width:{default:10,min:0},depth:{default:10,min:0},density:{default:10},amplitude:{default:.1},amplitudeVariance:{default:.3},speed:{default:1},speedVariance:{default:2},color:{default:"#7AD2F7",type:"color"},opacity:{default:.8}},play:function(){const r=this.el,e=this.data;let i=r.components.material;const n=new THREE.PlaneGeometry(e.width,e.depth,e.density,e.density);this.waves=[];const s=n.getAttribute("position");for(let o=0;o<s.count;o++)this.waves.push({z:s.getZ(o),ang:Math.random()*Math.PI*2,amp:e.amplitude+Math.random()*e.amplitudeVariance,speed:(e.speed+Math.random()*e.speedVariance)/1e3});i||(i={},i.material=new THREE.MeshPhongMaterial({color:e.color,transparent:e.opacity<1,opacity:e.opacity,flatShading:!0})),this.mesh=new THREE.Mesh(n,i.material),r.setObject3D("mesh",this.mesh)},remove:function(){this.el.removeObject3D("mesh")},tick:function(r,e){if(!e)return;const i=this.mesh.geometry.getAttribute("position");for(let n=0;n<i.count;n++){const s=this.waves[n],o=s.z+Math.sin(s.ang)*s.amp;i.setZ(n,o),s.ang+=s.speed*e}i.needsUpdate=!0}}),AFRAME.registerPrimitive("a-tube",{defaultComponents:{tube:{}},mappings:{path:"tube.path",segments:"tube.segments",radius:"tube.radius","radial-segments":"tube.radialSegments",closed:"tube.closed"}}),AFRAME.registerComponent("tube",{schema:{path:{default:[]},segments:{default:64},radius:{default:1},radialSegments:{default:8},closed:{default:!1}},init:function(){const r=this.el,e=this.data;let i=r.components.material;if(!e.path.length){console.error("[a-tube] `path` property expected but not found.");return}const n=new THREE.CatmullRomCurve3(e.path.map(function(o){return o=o.split(" "),new THREE.Vector3(Number(o[0]),Number(o[1]),Number(o[2]))})),s=new THREE.TubeGeometry(n,e.segments,e.radius,e.radialSegments,e.closed);i||(i={},i.material=new THREE.MeshPhongMaterial),this.mesh=new THREE.Mesh(s,i.material),this.el.setObject3D("mesh",this.mesh)},update:function(r){Object.keys(r).length&&(this.remove(),this.init())},remove:function(){this.mesh&&this.el.removeObject3D("mesh")}});var gr=function(r){return typeof r=="function"?r:typeof r=="string"?function(e){return e[r]}:function(e){return r}};const jre=Object.freeze(Object.defineProperty({__proto__:null,default:gr},Symbol.toStringTag,{value:"Module"})),Gre=O2(jre);function _k(r,e,i){var n,s=1;r==null&&(r=0),e==null&&(e=0),i==null&&(i=0);function o(){var l,u=n.length,c,h=0,p=0,f=0;for(l=0;l<u;++l)c=n[l],h+=c.x||0,p+=c.y||0,f+=c.z||0;for(h=(h/u-r)*s,p=(p/u-e)*s,f=(f/u-i)*s,l=0;l<u;++l)c=n[l],h&&(c.x-=h),p&&(c.y-=p),f&&(c.z-=f)}return o.initialize=function(l){n=l},o.x=function(l){return arguments.length?(r=+l,o):r},o.y=function(l){return arguments.length?(e=+l,o):e},o.z=function(l){return arguments.length?(i=+l,o):i},o.strength=function(l){return arguments.length?(s=+l,o):s},o}function Vre(r){const e=+this._x.call(null,r);return Ek(this.cover(e),e,r)}function Ek(r,e,i){if(isNaN(e))return r;var n,s=r._root,o={data:i},l=r._x0,u=r._x1,c,h,p,f,g;if(!s)return r._root=o,r;for(;s.length;)if((p=e>=(c=(l+u)/2))?l=c:u=c,n=s,!(s=s[f=+p]))return n[f]=o,r;if(h=+r._x.call(null,s.data),e===h)return o.next=s,n?n[f]=o:r._root=o,r;do n=n?n[f]=new Array(2):r._root=new Array(2),(p=e>=(c=(l+u)/2))?l=c:u=c;while((f=+p)==(g=+(h>=c)));return n[g]=s,n[f]=o,r}function Hre(r){Array.isArray(r)||(r=Array.from(r));const e=r.length,i=new Float64Array(e);let n=1/0,s=-1/0;for(let o=0,l;o<e;++o)isNaN(l=+this._x.call(null,r[o]))||(i[o]=l,l<n&&(n=l),l>s&&(s=l));if(n>s)return this;this.cover(n).cover(s);for(let o=0;o<e;++o)Ek(this,i[o],r[o]);return this}function Wre(r){if(isNaN(r=+r))return this;var e=this._x0,i=this._x1;if(isNaN(e))i=(e=Math.floor(r))+1;else{for(var n=i-e||1,s=this._root,o,l;e>r||r>=i;)switch(l=+(r<e),o=new Array(2),o[l]=s,s=o,n*=2,l){case 0:i=e+n;break;case 1:e=i-n;break}this._root&&this._root.length&&(this._root=s)}return this._x0=e,this._x1=i,this}function Qre(){var r=[];return this.visit(function(e){if(!e.length)do r.push(e.data);while(e=e.next)}),r}function qre(r){return arguments.length?this.cover(+r[0][0]).cover(+r[1][0]):isNaN(this._x0)?void 0:[[this._x0],[this._x1]]}function Uu(r,e,i){this.node=r,this.x0=e,this.x1=i}function Xre(r,e){var i,n=this._x0,s,o,l=this._x1,u=[],c=this._root,h,p;for(c&&u.push(new Uu(c,n,l)),e==null?e=1/0:(n=r-e,l=r+e);h=u.pop();)if(!(!(c=h.node)||(s=h.x0)>l||(o=h.x1)<n))if(c.length){var f=(s+o)/2;u.push(new Uu(c[1],f,o),new Uu(c[0],s,f)),(p=+(r>=f))&&(h=u[u.length-1],u[u.length-1]=u[u.length-1-p],u[u.length-1-p]=h)}else{var g=Math.abs(r-+this._x.call(null,c.data));g<e&&(e=g,n=r-g,l=r+g,i=c.data)}return i}function Kre(r){if(isNaN(c=+this._x.call(null,r)))return this;var e,i=this._root,n,s,o,l=this._x0,u=this._x1,c,h,p,f,g;if(!i)return this;if(i.length)for(;;){if((p=c>=(h=(l+u)/2))?l=h:u=h,e=i,!(i=i[f=+p]))return this;if(!i.length)break;e[f+1&1]&&(n=e,g=f)}for(;i.data!==r;)if(s=i,!(i=i.next))return this;return(o=i.next)&&delete i.next,s?(o?s.next=o:delete s.next,this):e?(o?e[f]=o:delete e[f],(i=e[0]||e[1])&&i===(e[1]||e[0])&&!i.length&&(n?n[g]=i:this._root=i),this):(this._root=o,this)}function Yre(r){for(var e=0,i=r.length;e<i;++e)this.remove(r[e]);return this}function Jre(){return this._root}function Zre(){var r=0;return this.visit(function(e){if(!e.length)do++r;while(e=e.next)}),r}function $re(r){var e=[],i,n=this._root,s,o,l;for(n&&e.push(new Uu(n,this._x0,this._x1));i=e.pop();)if(!r(n=i.node,o=i.x0,l=i.x1)&&n.length){var u=(o+l)/2;(s=n[1])&&e.push(new Uu(s,u,l)),(s=n[0])&&e.push(new Uu(s,o,u))}return this}function ene(r){var e=[],i=[],n;for(this._root&&e.push(new Uu(this._root,this._x0,this._x1));n=e.pop();){var s=n.node;if(s.length){var o,l=n.x0,u=n.x1,c=(l+u)/2;(o=s[0])&&e.push(new Uu(o,l,c)),(o=s[1])&&e.push(new Uu(o,c,u))}i.push(n)}for(;n=i.pop();)r(n.node,n.x0,n.x1);return this}function tne(r){return r[0]}function ine(r){return arguments.length?(this._x=r,this):this._x}function wk(r,e){var i=new MT(e??tne,NaN,NaN);return r==null?i:i.addAll(r)}function MT(r,e,i){this._x=r,this._x0=e,this._x1=i,this._root=void 0}function Ck(r){for(var e={data:r.data},i=e;r=r.next;)i=i.next={data:r.data};return e}var Ho=wk.prototype=MT.prototype;Ho.copy=function(){var r=new MT(this._x,this._x0,this._x1),e=this._root,i,n;if(!e)return r;if(!e.length)return r._root=Ck(e),r;for(i=[{source:e,target:r._root=new Array(2)}];e=i.pop();)for(var s=0;s<2;++s)(n=e.source[s])&&(n.length?i.push({source:n,target:e.target[s]=new Array(2)}):e.target[s]=Ck(n));return r},Ho.add=Vre,Ho.addAll=Hre,Ho.cover=Wre,Ho.data=Qre,Ho.extent=qre,Ho.find=Xre,Ho.remove=Kre,Ho.removeAll=Yre,Ho.root=Jre,Ho.size=Zre,Ho.visit=$re,Ho.visitAfter=ene,Ho.x=ine;function rne(r){const e=+this._x.call(null,r),i=+this._y.call(null,r);return Sk(this.cover(e,i),e,i,r)}function Sk(r,e,i,n){if(isNaN(e)||isNaN(i))return r;var s,o=r._root,l={data:n},u=r._x0,c=r._y0,h=r._x1,p=r._y1,f,g,m,y,b,v,_,C;if(!o)return r._root=l,r;for(;o.length;)if((b=e>=(f=(u+h)/2))?u=f:h=f,(v=i>=(g=(c+p)/2))?c=g:p=g,s=o,!(o=o[_=v<<1|b]))return s[_]=l,r;if(m=+r._x.call(null,o.data),y=+r._y.call(null,o.data),e===m&&i===y)return l.next=o,s?s[_]=l:r._root=l,r;do s=s?s[_]=new Array(4):r._root=new Array(4),(b=e>=(f=(u+h)/2))?u=f:h=f,(v=i>=(g=(c+p)/2))?c=g:p=g;while((_=v<<1|b)===(C=(y>=g)<<1|m>=f));return s[C]=o,s[_]=l,r}function nne(r){var e,i,n=r.length,s,o,l=new Array(n),u=new Array(n),c=1/0,h=1/0,p=-1/0,f=-1/0;for(i=0;i<n;++i)isNaN(s=+this._x.call(null,e=r[i]))||isNaN(o=+this._y.call(null,e))||(l[i]=s,u[i]=o,s<c&&(c=s),s>p&&(p=s),o<h&&(h=o),o>f&&(f=o));if(c>p||h>f)return this;for(this.cover(c,h).cover(p,f),i=0;i<n;++i)Sk(this,l[i],u[i],r[i]);return this}function sne(r,e){if(isNaN(r=+r)||isNaN(e=+e))return this;var i=this._x0,n=this._y0,s=this._x1,o=this._y1;if(isNaN(i))s=(i=Math.floor(r))+1,o=(n=Math.floor(e))+1;else{for(var l=s-i||1,u=this._root,c,h;i>r||r>=s||n>e||e>=o;)switch(h=(e<n)<<1|r<i,c=new Array(4),c[h]=u,u=c,l*=2,h){case 0:s=i+l,o=n+l;break;case 1:i=s-l,o=n+l;break;case 2:s=i+l,n=o-l;break;case 3:i=s-l,n=o-l;break}this._root&&this._root.length&&(this._root=u)}return this._x0=i,this._y0=n,this._x1=s,this._y1=o,this}function ane(){var r=[];return this.visit(function(e){if(!e.length)do r.push(e.data);while(e=e.next)}),r}function one(r){return arguments.length?this.cover(+r[0][0],+r[0][1]).cover(+r[1][0],+r[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function Eo(r,e,i,n,s){this.node=r,this.x0=e,this.y0=i,this.x1=n,this.y1=s}function lne(r,e,i){var n,s=this._x0,o=this._y0,l,u,c,h,p=this._x1,f=this._y1,g=[],m=this._root,y,b;for(m&&g.push(new Eo(m,s,o,p,f)),i==null?i=1/0:(s=r-i,o=e-i,p=r+i,f=e+i,i*=i);y=g.pop();)if(!(!(m=y.node)||(l=y.x0)>p||(u=y.y0)>f||(c=y.x1)<s||(h=y.y1)<o))if(m.length){var v=(l+c)/2,_=(u+h)/2;g.push(new Eo(m[3],v,_,c,h),new Eo(m[2],l,_,v,h),new Eo(m[1],v,u,c,_),new Eo(m[0],l,u,v,_)),(b=(e>=_)<<1|r>=v)&&(y=g[g.length-1],g[g.length-1]=g[g.length-1-b],g[g.length-1-b]=y)}else{var C=r-+this._x.call(null,m.data),E=e-+this._y.call(null,m.data),T=C*C+E*E;if(T<i){var R=Math.sqrt(i=T);s=r-R,o=e-R,p=r+R,f=e+R,n=m.data}}return n}function cne(r){if(isNaN(p=+this._x.call(null,r))||isNaN(f=+this._y.call(null,r)))return this;var e,i=this._root,n,s,o,l=this._x0,u=this._y0,c=this._x1,h=this._y1,p,f,g,m,y,b,v,_;if(!i)return this;if(i.length)for(;;){if((y=p>=(g=(l+c)/2))?l=g:c=g,(b=f>=(m=(u+h)/2))?u=m:h=m,e=i,!(i=i[v=b<<1|y]))return this;if(!i.length)break;(e[v+1&3]||e[v+2&3]||e[v+3&3])&&(n=e,_=v)}for(;i.data!==r;)if(s=i,!(i=i.next))return this;return(o=i.next)&&delete i.next,s?(o?s.next=o:delete s.next,this):e?(o?e[v]=o:delete e[v],(i=e[0]||e[1]||e[2]||e[3])&&i===(e[3]||e[2]||e[1]||e[0])&&!i.length&&(n?n[_]=i:this._root=i),this):(this._root=o,this)}function une(r){for(var e=0,i=r.length;e<i;++e)this.remove(r[e]);return this}function hne(){return this._root}function dne(){var r=0;return this.visit(function(e){if(!e.length)do++r;while(e=e.next)}),r}function pne(r){var e=[],i,n=this._root,s,o,l,u,c;for(n&&e.push(new Eo(n,this._x0,this._y0,this._x1,this._y1));i=e.pop();)if(!r(n=i.node,o=i.x0,l=i.y0,u=i.x1,c=i.y1)&&n.length){var h=(o+u)/2,p=(l+c)/2;(s=n[3])&&e.push(new Eo(s,h,p,u,c)),(s=n[2])&&e.push(new Eo(s,o,p,h,c)),(s=n[1])&&e.push(new Eo(s,h,l,u,p)),(s=n[0])&&e.push(new Eo(s,o,l,h,p))}return this}function fne(r){var e=[],i=[],n;for(this._root&&e.push(new Eo(this._root,this._x0,this._y0,this._x1,this._y1));n=e.pop();){var s=n.node;if(s.length){var o,l=n.x0,u=n.y0,c=n.x1,h=n.y1,p=(l+c)/2,f=(u+h)/2;(o=s[0])&&e.push(new Eo(o,l,u,p,f)),(o=s[1])&&e.push(new Eo(o,p,u,c,f)),(o=s[2])&&e.push(new Eo(o,l,f,p,h)),(o=s[3])&&e.push(new Eo(o,p,f,c,h))}i.push(n)}for(;n=i.pop();)r(n.node,n.x0,n.y0,n.x1,n.y1);return this}function mne(r){return r[0]}function gne(r){return arguments.length?(this._x=r,this):this._x}function Ane(r){return r[1]}function yne(r){return arguments.length?(this._y=r,this):this._y}function Tk(r,e,i){var n=new RT(e??mne,i??Ane,NaN,NaN,NaN,NaN);return r==null?n:n.addAll(r)}function RT(r,e,i,n,s,o){this._x=r,this._y=e,this._x0=i,this._y0=n,this._x1=s,this._y1=o,this._root=void 0}function Mk(r){for(var e={data:r.data},i=e;r=r.next;)i=i.next={data:r.data};return e}var wo=Tk.prototype=RT.prototype;wo.copy=function(){var r=new RT(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,i,n;if(!e)return r;if(!e.length)return r._root=Mk(e),r;for(i=[{source:e,target:r._root=new Array(4)}];e=i.pop();)for(var s=0;s<4;++s)(n=e.source[s])&&(n.length?i.push({source:n,target:e.target[s]=new Array(4)}):e.target[s]=Mk(n));return r},wo.add=rne,wo.addAll=nne,wo.cover=sne,wo.data=ane,wo.extent=one,wo.find=lne,wo.remove=cne,wo.removeAll=une,wo.root=hne,wo.size=dne,wo.visit=pne,wo.visitAfter=fne,wo.x=gne,wo.y=yne;function vne(r){const e=+this._x.call(null,r),i=+this._y.call(null,r),n=+this._z.call(null,r);return Rk(this.cover(e,i,n),e,i,n,r)}function Rk(r,e,i,n,s){if(isNaN(e)||isNaN(i)||isNaN(n))return r;var o,l=r._root,u={data:s},c=r._x0,h=r._y0,p=r._z0,f=r._x1,g=r._y1,m=r._z1,y,b,v,_,C,E,T,R,B,I,D;if(!l)return r._root=u,r;for(;l.length;)if((T=e>=(y=(c+f)/2))?c=y:f=y,(R=i>=(b=(h+g)/2))?h=b:g=b,(B=n>=(v=(p+m)/2))?p=v:m=v,o=l,!(l=l[I=B<<2|R<<1|T]))return o[I]=u,r;if(_=+r._x.call(null,l.data),C=+r._y.call(null,l.data),E=+r._z.call(null,l.data),e===_&&i===C&&n===E)return u.next=l,o?o[I]=u:r._root=u,r;do o=o?o[I]=new Array(8):r._root=new Array(8),(T=e>=(y=(c+f)/2))?c=y:f=y,(R=i>=(b=(h+g)/2))?h=b:g=b,(B=n>=(v=(p+m)/2))?p=v:m=v;while((I=B<<2|R<<1|T)===(D=(E>=v)<<2|(C>=b)<<1|_>=y));return o[D]=l,o[I]=u,r}function bne(r){Array.isArray(r)||(r=Array.from(r));const e=r.length,i=new Float64Array(e),n=new Float64Array(e),s=new Float64Array(e);let o=1/0,l=1/0,u=1/0,c=-1/0,h=-1/0,p=-1/0;for(let f=0,g,m,y,b;f<e;++f)isNaN(m=+this._x.call(null,g=r[f]))||isNaN(y=+this._y.call(null,g))||isNaN(b=+this._z.call(null,g))||(i[f]=m,n[f]=y,s[f]=b,m<o&&(o=m),m>c&&(c=m),y<l&&(l=y),y>h&&(h=y),b<u&&(u=b),b>p&&(p=b));if(o>c||l>h||u>p)return this;this.cover(o,l,u).cover(c,h,p);for(let f=0;f<e;++f)Rk(this,i[f],n[f],s[f],r[f]);return this}function xne(r,e,i){if(isNaN(r=+r)||isNaN(e=+e)||isNaN(i=+i))return this;var n=this._x0,s=this._y0,o=this._z0,l=this._x1,u=this._y1,c=this._z1;if(isNaN(n))l=(n=Math.floor(r))+1,u=(s=Math.floor(e))+1,c=(o=Math.floor(i))+1;else{for(var h=l-n||1,p=this._root,f,g;n>r||r>=l||s>e||e>=u||o>i||i>=c;)switch(g=(i<o)<<2|(e<s)<<1|r<n,f=new Array(8),f[g]=p,p=f,h*=2,g){case 0:l=n+h,u=s+h,c=o+h;break;case 1:n=l-h,u=s+h,c=o+h;break;case 2:l=n+h,s=u-h,c=o+h;break;case 3:n=l-h,s=u-h,c=o+h;break;case 4:l=n+h,u=s+h,o=c-h;break;case 5:n=l-h,u=s+h,o=c-h;break;case 6:l=n+h,s=u-h,o=c-h;break;case 7:n=l-h,s=u-h,o=c-h;break}this._root&&this._root.length&&(this._root=p)}return this._x0=n,this._y0=s,this._z0=o,this._x1=l,this._y1=u,this._z1=c,this}function _ne(){var r=[];return this.visit(function(e){if(!e.length)do r.push(e.data);while(e=e.next)}),r}function Ene(r){return arguments.length?this.cover(+r[0][0],+r[0][1],+r[0][2]).cover(+r[1][0],+r[1][1],+r[1][2]):isNaN(this._x0)?void 0:[[this._x0,this._y0,this._z0],[this._x1,this._y1,this._z1]]}function us(r,e,i,n,s,o,l){this.node=r,this.x0=e,this.y0=i,this.z0=n,this.x1=s,this.y1=o,this.z1=l}function wne(r,e,i,n){var s,o=this._x0,l=this._y0,u=this._z0,c,h,p,f,g,m,y=this._x1,b=this._y1,v=this._z1,_=[],C=this._root,E,T;for(C&&_.push(new us(C,o,l,u,y,b,v)),n==null?n=1/0:(o=r-n,l=e-n,u=i-n,y=r+n,b=e+n,v=i+n,n*=n);E=_.pop();)if(!(!(C=E.node)||(c=E.x0)>y||(h=E.y0)>b||(p=E.z0)>v||(f=E.x1)<o||(g=E.y1)<l||(m=E.z1)<u))if(C.length){var R=(c+f)/2,B=(h+g)/2,I=(p+m)/2;_.push(new us(C[7],R,B,I,f,g,m),new us(C[6],c,B,I,R,g,m),new us(C[5],R,h,I,f,B,m),new us(C[4],c,h,I,R,B,m),new us(C[3],R,B,p,f,g,I),new us(C[2],c,B,p,R,g,I),new us(C[1],R,h,p,f,B,I),new us(C[0],c,h,p,R,B,I)),(T=(i>=I)<<2|(e>=B)<<1|r>=R)&&(E=_[_.length-1],_[_.length-1]=_[_.length-1-T],_[_.length-1-T]=E)}else{var D=r-+this._x.call(null,C.data),L=e-+this._y.call(null,C.data),O=i-+this._z.call(null,C.data),F=D*D+L*L+O*O;if(F<n){var q=Math.sqrt(n=F);o=r-q,l=e-q,u=i-q,y=r+q,b=e+q,v=i+q,s=C.data}}return s}function Cne(r){if(isNaN(g=+this._x.call(null,r))||isNaN(m=+this._y.call(null,r))||isNaN(y=+this._z.call(null,r)))return this;var e,i=this._root,n,s,o,l=this._x0,u=this._y0,c=this._z0,h=this._x1,p=this._y1,f=this._z1,g,m,y,b,v,_,C,E,T,R,B;if(!i)return this;if(i.length)for(;;){if((C=g>=(b=(l+h)/2))?l=b:h=b,(E=m>=(v=(u+p)/2))?u=v:p=v,(T=y>=(_=(c+f)/2))?c=_:f=_,e=i,!(i=i[R=T<<2|E<<1|C]))return this;if(!i.length)break;(e[R+1&7]||e[R+2&7]||e[R+3&7]||e[R+4&7]||e[R+5&7]||e[R+6&7]||e[R+7&7])&&(n=e,B=R)}for(;i.data!==r;)if(s=i,!(i=i.next))return this;return(o=i.next)&&delete i.next,s?(o?s.next=o:delete s.next,this):e?(o?e[R]=o:delete e[R],(i=e[0]||e[1]||e[2]||e[3]||e[4]||e[5]||e[6]||e[7])&&i===(e[7]||e[6]||e[5]||e[4]||e[3]||e[2]||e[1]||e[0])&&!i.length&&(n?n[B]=i:this._root=i),this):(this._root=o,this)}function Sne(r){for(var e=0,i=r.length;e<i;++e)this.remove(r[e]);return this}function Tne(){return this._root}function Mne(){var r=0;return this.visit(function(e){if(!e.length)do++r;while(e=e.next)}),r}function Rne(r){var e=[],i,n=this._root,s,o,l,u,c,h,p;for(n&&e.push(new us(n,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));i=e.pop();)if(!r(n=i.node,o=i.x0,l=i.y0,u=i.z0,c=i.x1,h=i.y1,p=i.z1)&&n.length){var f=(o+c)/2,g=(l+h)/2,m=(u+p)/2;(s=n[7])&&e.push(new us(s,f,g,m,c,h,p)),(s=n[6])&&e.push(new us(s,o,g,m,f,h,p)),(s=n[5])&&e.push(new us(s,f,l,m,c,g,p)),(s=n[4])&&e.push(new us(s,o,l,m,f,g,p)),(s=n[3])&&e.push(new us(s,f,g,u,c,h,m)),(s=n[2])&&e.push(new us(s,o,g,u,f,h,m)),(s=n[1])&&e.push(new us(s,f,l,u,c,g,m)),(s=n[0])&&e.push(new us(s,o,l,u,f,g,m))}return this}function Ine(r){var e=[],i=[],n;for(this._root&&e.push(new us(this._root,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));n=e.pop();){var s=n.node;if(s.length){var o,l=n.x0,u=n.y0,c=n.z0,h=n.x1,p=n.y1,f=n.z1,g=(l+h)/2,m=(u+p)/2,y=(c+f)/2;(o=s[0])&&e.push(new us(o,l,u,c,g,m,y)),(o=s[1])&&e.push(new us(o,g,u,c,h,m,y)),(o=s[2])&&e.push(new us(o,l,m,c,g,p,y)),(o=s[3])&&e.push(new us(o,g,m,c,h,p,y)),(o=s[4])&&e.push(new us(o,l,u,y,g,m,f)),(o=s[5])&&e.push(new us(o,g,u,y,h,m,f)),(o=s[6])&&e.push(new us(o,l,m,y,g,p,f)),(o=s[7])&&e.push(new us(o,g,m,y,h,p,f))}i.push(n)}for(;n=i.pop();)r(n.node,n.x0,n.y0,n.z0,n.x1,n.y1,n.z1);return this}function Bne(r){return r[0]}function Nne(r){return arguments.length?(this._x=r,this):this._x}function Lne(r){return r[1]}function Dne(r){return arguments.length?(this._y=r,this):this._y}function One(r){return r[2]}function Pne(r){return arguments.length?(this._z=r,this):this._z}function Ik(r,e,i,n){var s=new IT(e??Bne,i??Lne,n??One,NaN,NaN,NaN,NaN,NaN,NaN);return r==null?s:s.addAll(r)}function IT(r,e,i,n,s,o,l,u,c){this._x=r,this._y=e,this._z=i,this._x0=n,this._y0=s,this._z0=o,this._x1=l,this._y1=u,this._z1=c,this._root=void 0}function Bk(r){for(var e={data:r.data},i=e;r=r.next;)i=i.next={data:r.data};return e}var ro=Ik.prototype=IT.prototype;ro.copy=function(){var r=new IT(this._x,this._y,this._z,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1),e=this._root,i,n;if(!e)return r;if(!e.length)return r._root=Bk(e),r;for(i=[{source:e,target:r._root=new Array(8)}];e=i.pop();)for(var s=0;s<8;++s)(n=e.source[s])&&(n.length?i.push({source:n,target:e.target[s]=new Array(8)}):e.target[s]=Bk(n));return r},ro.add=vne,ro.addAll=bne,ro.cover=xne,ro.data=_ne,ro.extent=Ene,ro.find=wne,ro.remove=Cne,ro.removeAll=Sne,ro.root=Tne,ro.size=Mne,ro.visit=Rne,ro.visitAfter=Ine,ro.x=Nne,ro.y=Dne,ro.z=Pne;function zu(r){return function(){return r}}function ju(r){return(r()-.5)*1e-6}function kne(r){return r.index}function Nk(r,e){var i=r.get(e);if(!i)throw new Error("node not found: "+e);return i}function Lk(r){var e=kne,i=g,n,s=zu(30),o,l,u,c,h,p,f=1;r==null&&(r=[]);function g(_){return 1/Math.min(c[_.source.index],c[_.target.index])}function m(_){for(var C=0,E=r.length;C<f;++C)for(var T=0,R,B,I,D=0,L=0,O=0,F,q;T<E;++T)R=r[T],B=R.source,I=R.target,D=I.x+I.vx-B.x-B.vx||ju(p),u>1&&(L=I.y+I.vy-B.y-B.vy||ju(p)),u>2&&(O=I.z+I.vz-B.z-B.vz||ju(p)),F=Math.sqrt(D*D+L*L+O*O),F=(F-o[T])/F*_*n[T],D*=F,L*=F,O*=F,I.vx-=D*(q=h[T]),u>1&&(I.vy-=L*q),u>2&&(I.vz-=O*q),B.vx+=D*(q=1-q),u>1&&(B.vy+=L*q),u>2&&(B.vz+=O*q)}function y(){if(l){var _,C=l.length,E=r.length,T=new Map(l.map((B,I)=>[e(B,I,l),B])),R;for(_=0,c=new Array(C);_<E;++_)R=r[_],R.index=_,typeof R.source!="object"&&(R.source=Nk(T,R.source)),typeof R.target!="object"&&(R.target=Nk(T,R.target)),c[R.source.index]=(c[R.source.index]||0)+1,c[R.target.index]=(c[R.target.index]||0)+1;for(_=0,h=new Array(E);_<E;++_)R=r[_],h[_]=c[R.source.index]/(c[R.source.index]+c[R.target.index]);n=new Array(E),b(),o=new Array(E),v()}}function b(){if(l)for(var _=0,C=r.length;_<C;++_)n[_]=+i(r[_],_,r)}function v(){if(l)for(var _=0,C=r.length;_<C;++_)o[_]=+s(r[_],_,r)}return m.initialize=function(_,...C){l=_,p=C.find(E=>typeof E=="function")||Math.random,u=C.find(E=>[1,2,3].includes(E))||2,y()},m.links=function(_){return arguments.length?(r=_,y(),m):r},m.id=function(_){return arguments.length?(e=_,m):e},m.iterations=function(_){return arguments.length?(f=+_,m):f},m.strength=function(_){return arguments.length?(i=typeof _=="function"?_:zu(+_),b(),m):i},m.distance=function(_){return arguments.length?(s=typeof _=="function"?_:zu(+_),v(),m):s},m}var Fne={value:()=>{}};function PA(){for(var r=0,e=arguments.length,i={},n;r<e;++r){if(!(n=arguments[r]+"")||n in i||/[\s.]/.test(n))throw new Error("illegal type: "+n);i[n]=[]}return new Qx(i)}function Qx(r){this._=r}function Une(r,e){return r.trim().split(/^|\s+/).map(function(i){var n="",s=i.indexOf(".");if(s>=0&&(n=i.slice(s+1),i=i.slice(0,s)),i&&!e.hasOwnProperty(i))throw new Error("unknown type: "+i);return{type:i,name:n}})}Qx.prototype=PA.prototype={constructor:Qx,on:function(r,e){var i=this._,n=Une(r+"",i),s,o=-1,l=n.length;if(arguments.length<2){for(;++o<l;)if((s=(r=n[o]).type)&&(s=zne(i[s],r.name)))return s;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++o<l;)if(s=(r=n[o]).type)i[s]=Dk(i[s],r.name,e);else if(e==null)for(s in i)i[s]=Dk(i[s],r.name,null);return this},copy:function(){var r={},e=this._;for(var i in e)r[i]=e[i].slice();return new Qx(r)},call:function(r,e){if((s=arguments.length-2)>0)for(var i=new Array(s),n=0,s,o;n<s;++n)i[n]=arguments[n+2];if(!this._.hasOwnProperty(r))throw new Error("unknown type: "+r);for(o=this._[r],n=0,s=o.length;n<s;++n)o[n].value.apply(e,i)},apply:function(r,e,i){if(!this._.hasOwnProperty(r))throw new Error("unknown type: "+r);for(var n=this._[r],s=0,o=n.length;s<o;++s)n[s].value.apply(e,i)}};function zne(r,e){for(var i=0,n=r.length,s;i<n;++i)if((s=r[i]).name===e)return s.value}function Dk(r,e,i){for(var n=0,s=r.length;n<s;++n)if(r[n].name===e){r[n]=Fne,r=r.slice(0,n).concat(r.slice(n+1));break}return i!=null&&r.push({name:e,value:i}),r}var Ym=0,kA=0,FA=0,Ok=1e3,qx,UA,Xx=0,Mp=0,Kx=0,zA=typeof performance=="object"&&performance.now?performance:Date,Pk=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(r){setTimeout(r,17)};function BT(){return Mp||(Pk(jne),Mp=zA.now()+Kx)}function jne(){Mp=0}function Yx(){this._call=this._time=this._next=null}Yx.prototype=NT.prototype={constructor:Yx,restart:function(r,e,i){if(typeof r!="function")throw new TypeError("callback is not a function");i=(i==null?BT():+i)+(e==null?0:+e),!this._next&&UA!==this&&(UA?UA._next=this:qx=this,UA=this),this._call=r,this._time=i,LT()},stop:function(){this._call&&(this._call=null,this._time=1/0,LT())}};function NT(r,e,i){var n=new Yx;return n.restart(r,e,i),n}function Gne(){BT(),++Ym;for(var r=qx,e;r;)(e=Mp-r._time)>=0&&r._call.call(void 0,e),r=r._next;--Ym}function kk(){Mp=(Xx=zA.now())+Kx,Ym=kA=0;try{Gne()}finally{Ym=0,Hne(),Mp=0}}function Vne(){var r=zA.now(),e=r-Xx;e>Ok&&(Kx-=e,Xx=r)}function Hne(){for(var r,e=qx,i,n=1/0;e;)e._call?(n>e._time&&(n=e._time),r=e,e=e._next):(i=e._next,e._next=null,e=r?r._next=i:qx=i);UA=r,LT(n)}function LT(r){if(!Ym){kA&&(kA=clearTimeout(kA));var e=r-Mp;e>24?(r<1/0&&(kA=setTimeout(kk,r-zA.now()-Kx)),FA&&(FA=clearInterval(FA))):(FA||(Xx=zA.now(),FA=setInterval(Vne,Ok)),Ym=1,Pk(kk))}}function Fk(r,e,i){var n=new Yx;return e=e==null?0:+e,n.restart(s=>{n.stop(),r(s+e)},e,i),n}const Wne=1664525,Qne=1013904223,Uk=4294967296;function qne(){let r=1;return()=>(r=(Wne*r+Qne)%Uk)/Uk}var zk=3;function DT(r){return r.x}function jk(r){return r.y}function Xne(r){return r.z}var Kne=10,Yne=Math.PI*(3-Math.sqrt(5)),Jne=Math.PI*20/(9+Math.sqrt(221));function Gk(r,e){e=e||2;var i=Math.min(zk,Math.max(1,Math.round(e))),n,s=1,o=.001,l=1-Math.pow(o,1/300),u=0,c=.6,h=new Map,p=NT(m),f=PA("tick","end"),g=qne();r==null&&(r=[]);function m(){y(),f.call("tick",n),s<o&&(p.stop(),f.call("end",n))}function y(_){var C,E=r.length,T;_===void 0&&(_=1);for(var R=0;R<_;++R)for(s+=(u-s)*l,h.forEach(function(B){B(s)}),C=0;C<E;++C)T=r[C],T.fx==null?T.x+=T.vx*=c:(T.x=T.fx,T.vx=0),i>1&&(T.fy==null?T.y+=T.vy*=c:(T.y=T.fy,T.vy=0)),i>2&&(T.fz==null?T.z+=T.vz*=c:(T.z=T.fz,T.vz=0));return n}function b(){for(var _=0,C=r.length,E;_<C;++_){if(E=r[_],E.index=_,E.fx!=null&&(E.x=E.fx),E.fy!=null&&(E.y=E.fy),E.fz!=null&&(E.z=E.fz),isNaN(E.x)||i>1&&isNaN(E.y)||i>2&&isNaN(E.z)){var T=Kne*(i>2?Math.cbrt(.5+_):i>1?Math.sqrt(.5+_):_),R=_*Yne,B=_*Jne;i===1?E.x=T:i===2?(E.x=T*Math.cos(R),E.y=T*Math.sin(R)):(E.x=T*Math.sin(R)*Math.cos(B),E.y=T*Math.cos(R),E.z=T*Math.sin(R)*Math.sin(B))}(isNaN(E.vx)||i>1&&isNaN(E.vy)||i>2&&isNaN(E.vz))&&(E.vx=0,i>1&&(E.vy=0),i>2&&(E.vz=0))}}function v(_){return _.initialize&&_.initialize(r,g,i),_}return b(),n={tick:y,restart:function(){return p.restart(m),n},stop:function(){return p.stop(),n},numDimensions:function(_){return arguments.length?(i=Math.min(zk,Math.max(1,Math.round(_))),h.forEach(v),n):i},nodes:function(_){return arguments.length?(r=_,b(),h.forEach(v),n):r},alpha:function(_){return arguments.length?(s=+_,n):s},alphaMin:function(_){return arguments.length?(o=+_,n):o},alphaDecay:function(_){return arguments.length?(l=+_,n):+l},alphaTarget:function(_){return arguments.length?(u=+_,n):u},velocityDecay:function(_){return arguments.length?(c=1-_,n):1-c},randomSource:function(_){return arguments.length?(g=_,h.forEach(v),n):g},force:function(_,C){return arguments.length>1?(C==null?h.delete(_):h.set(_,v(C)),n):h.get(_)},find:function(){var _=Array.prototype.slice.call(arguments),C=_.shift()||0,E=(i>1?_.shift():null)||0,T=(i>2?_.shift():null)||0,R=_.shift()||1/0,B=0,I=r.length,D,L,O,F,q,H;for(R*=R,B=0;B<I;++B)q=r[B],D=C-q.x,L=E-(q.y||0),O=T-(q.z||0),F=D*D+L*L+O*O,F<R&&(H=q,R=F);return H},on:function(_,C){return arguments.length>1?(f.on(_,C),n):f.on(_)}}}function Vk(){var r,e,i,n,s,o=zu(-30),l,u=1,c=1/0,h=.81;function p(y){var b,v=r.length,_=(e===1?wk(r,DT):e===2?Tk(r,DT,jk):e===3?Ik(r,DT,jk,Xne):null).visitAfter(g);for(s=y,b=0;b<v;++b)i=r[b],_.visit(m)}function f(){if(r){var y,b=r.length,v;for(l=new Array(b),y=0;y<b;++y)v=r[y],l[v.index]=+o(v,y,r)}}function g(y){var b=0,v,_,C=0,E,T,R,B,I=y.length;if(I){for(E=T=R=B=0;B<I;++B)(v=y[B])&&(_=Math.abs(v.value))&&(b+=v.value,C+=_,E+=_*(v.x||0),T+=_*(v.y||0),R+=_*(v.z||0));b*=Math.sqrt(4/I),y.x=E/C,e>1&&(y.y=T/C),e>2&&(y.z=R/C)}else{v=y,v.x=v.data.x,e>1&&(v.y=v.data.y),e>2&&(v.z=v.data.z);do b+=l[v.data.index];while(v=v.next)}y.value=b}function m(y,b,v,_,C){if(!y.value)return!0;var E=[v,_,C][e-1],T=y.x-i.x,R=e>1?y.y-i.y:0,B=e>2?y.z-i.z:0,I=E-b,D=T*T+R*R+B*B;if(I*I/h<D)return D<c&&(T===0&&(T=ju(n),D+=T*T),e>1&&R===0&&(R=ju(n),D+=R*R),e>2&&B===0&&(B=ju(n),D+=B*B),D<u&&(D=Math.sqrt(u*D)),i.vx+=T*y.value*s/D,e>1&&(i.vy+=R*y.value*s/D),e>2&&(i.vz+=B*y.value*s/D)),!0;if(!(y.length||D>=c)){(y.data!==i||y.next)&&(T===0&&(T=ju(n),D+=T*T),e>1&&R===0&&(R=ju(n),D+=R*R),e>2&&B===0&&(B=ju(n),D+=B*B),D<u&&(D=Math.sqrt(u*D)));do y.data!==i&&(I=l[y.data.index]*s/D,i.vx+=T*I,e>1&&(i.vy+=R*I),e>2&&(i.vz+=B*I));while(y=y.next)}}return p.initialize=function(y,...b){r=y,n=b.find(v=>typeof v=="function")||Math.random,e=b.find(v=>[1,2,3].includes(v))||2,f()},p.strength=function(y){return arguments.length?(o=typeof y=="function"?y:zu(+y),f(),p):o},p.distanceMin=function(y){return arguments.length?(u=y*y,p):Math.sqrt(u)},p.distanceMax=function(y){return arguments.length?(c=y*y,p):Math.sqrt(c)},p.theta=function(y){return arguments.length?(h=y*y,p):Math.sqrt(h)},p}function Hk(r,e,i,n){var s,o,l=zu(.1),u,c;typeof r!="function"&&(r=zu(+r)),e==null&&(e=0),i==null&&(i=0),n==null&&(n=0);function h(f){for(var g=0,m=s.length;g<m;++g){var y=s[g],b=y.x-e||1e-6,v=(y.y||0)-i||1e-6,_=(y.z||0)-n||1e-6,C=Math.sqrt(b*b+v*v+_*_),E=(c[g]-C)*u[g]*f/C;y.vx+=b*E,o>1&&(y.vy+=v*E),o>2&&(y.vz+=_*E)}}function p(){if(s){var f,g=s.length;for(u=new Array(g),c=new Array(g),f=0;f<g;++f)c[f]=+r(s[f],f,s),u[f]=isNaN(c[f])?0:+l(s[f],f,s)}}return h.initialize=function(f,...g){s=f,o=g.find(m=>[1,2,3].includes(m))||2,p()},h.strength=function(f){return arguments.length?(l=typeof f=="function"?f:zu(+f),p(),h):l},h.radius=function(f){return arguments.length?(r=typeof f=="function"?f:zu(+f),p(),h):r},h.x=function(f){return arguments.length?(e=+f,h):e},h.y=function(f){return arguments.length?(i=+f,h):i},h.z=function(f){return arguments.length?(n=+f,h):n},h}var OT=function(r){$ne(r);var e=Zne(r);return r.on=e.on,r.off=e.off,r.fire=e.fire,r};function Zne(r){var e=Object.create(null);return{on:function(i,n,s){if(typeof n!="function")throw new Error("callback is expected to be a function");var o=e[i];return o||(o=e[i]=[]),o.push({callback:n,ctx:s}),r},off:function(i,n){var s=typeof i>"u";if(s)return e=Object.create(null),r;if(e[i]){var o=typeof n!="function";if(o)delete e[i];else for(var l=e[i],u=0;u<l.length;++u)l[u].callback===n&&l.splice(u,1)}return r},fire:function(i){var n=e[i];if(!n)return r;var s;arguments.length>1&&(s=Array.prototype.splice.call(arguments,1));for(var o=0;o<n.length;++o){var l=n[o];l.callback.apply(l.ctx,s)}return r}}}function $ne(r){if(!r)throw new Error("Eventify cannot use falsy object as events subject");for(var e=["on","fire","off"],i=0;i<e.length;++i)if(r.hasOwnProperty(e[i]))throw new Error("Subject cannot be eventified, since it already has property '"+e[i]+"'")}var ese=ise,tse=OT;function ise(r){if(r=r||{},"uniqueLinkId"in r&&(console.warn("ngraph.graph: Starting from version 0.14 `uniqueLinkId` is deprecated.\nUse `multigraph` option instead\n",`
`,`Note: there is also change in default behavior: From now on each graph
is considered to be not a multigraph by default (each edge is unique).`),r.multigraph=r.uniqueLinkId),r.multigraph===void 0&&(r.multigraph=!1),typeof Map!="function")throw new Error("ngraph.graph requires `Map` to be defined. Please polyfill it before using ngraph");var e=new Map,i=new Map,n={},s=0,o=r.multigraph?T:E,l=[],u=Q,c=Q,h=Q,p=Q,f={version:20,addNode:b,addLink:C,removeLink:D,removeNode:_,getNode:v,getNodeCount:R,getLinkCount:B,getEdgeCount:B,getLinksCount:B,getNodesCount:R,getLinks:I,forEachNode:te,forEachLinkedNode:H,forEachLink:q,beginUpdate:h,endUpdate:p,clear:F,hasLink:O,hasNode:v,getLink:O};return tse(f),g(),f;function g(){var K=f.on;f.on=ae;function ae(){return f.beginUpdate=h=V,f.endUpdate=p=z,u=m,c=y,f.on=K,K.apply(f,arguments)}}function m(K,ae){l.push({link:K,changeType:ae})}function y(K,ae){l.push({node:K,changeType:ae})}function b(K,ae){if(K===void 0)throw new Error("Invalid node identifier");h();var Ae=v(K);return Ae?(Ae.data=ae,c(Ae,"update")):(Ae=new rse(K,ae),c(Ae,"add")),e.set(K,Ae),p(),Ae}function v(K){return e.get(K)}function _(K){var ae=v(K);if(!ae)return!1;h();var Ae=ae.links;return Ae&&(Ae.forEach(L),ae.links=null),e.delete(K),c(ae,"remove"),p(),!0}function C(K,ae,Ae){h();var _e=v(K)||b(K),me=v(ae)||b(ae),Pe=o(K,ae,Ae),Xe=i.has(Pe.id);return i.set(Pe.id,Pe),Wk(_e,Pe),K!==ae&&Wk(me,Pe),u(Pe,Xe?"update":"add"),p(),Pe}function E(K,ae,Ae){var _e=Jx(K,ae),me=i.get(_e);return me?(me.data=Ae,me):new Qk(K,ae,Ae,_e)}function T(K,ae,Ae){var _e=Jx(K,ae),me=n.hasOwnProperty(_e);if(me||O(K,ae)){me||(n[_e]=0);var Pe="@"+ ++n[_e];_e=Jx(K+Pe,ae+Pe)}return new Qk(K,ae,Ae,_e)}function R(){return e.size}function B(){return i.size}function I(K){var ae=v(K);return ae?ae.links:null}function D(K,ae){return ae!==void 0&&(K=O(K,ae)),L(K)}function L(K){if(!K||!i.get(K.id))return!1;h(),i.delete(K.id);var ae=v(K.fromId),Ae=v(K.toId);return ae&&ae.links.delete(K),Ae&&Ae.links.delete(K),u(K,"remove"),p(),!0}function O(K,ae){if(!(K===void 0||ae===void 0))return i.get(Jx(K,ae))}function F(){h(),te(function(K){_(K.id)}),p()}function q(K){if(typeof K=="function")for(var ae=i.values(),Ae=ae.next();!Ae.done;){if(K(Ae.value))return!0;Ae=ae.next()}}function H(K,ae,Ae){var _e=v(K);if(_e&&_e.links&&typeof ae=="function")return Ae?J(_e.links,K,ae):G(_e.links,K,ae)}function G(K,ae,Ae){for(var _e,me=K.values(),Pe=me.next();!Pe.done;){var Xe=Pe.value,Je=Xe.fromId===ae?Xe.toId:Xe.fromId;if(_e=Ae(e.get(Je),Xe),_e)return!0;Pe=me.next()}}function J(K,ae,Ae){for(var _e,me=K.values(),Pe=me.next();!Pe.done;){var Xe=Pe.value;if(Xe.fromId===ae&&(_e=Ae(e.get(Xe.toId),Xe),_e))return!0;Pe=me.next()}}function Q(){}function V(){s+=1}function z(){s-=1,s===0&&l.length>0&&(f.fire("changed",l),l.length=0)}function te(K){if(typeof K!="function")throw new Error("Function is expected to iterate over graph nodes. You passed "+K);for(var ae=e.values(),Ae=ae.next();!Ae.done;){if(K(Ae.value))return!0;Ae=ae.next()}}}function rse(r,e){this.id=r,this.links=null,this.data=e}function Wk(r,e){r.links?r.links.add(e):r.links=new Set([e])}function Qk(r,e,i,n){this.fromId=r,this.toId=e,this.data=i,this.id=n}function Jx(r,e){return r.toString()+"👉 "+e.toString()}const nse=D2(ese);var PT={exports:{}},jA={exports:{}},qk=function(r){return r===0?"x":r===1?"y":r===2?"z":"c"+(r+1)};const sse=qk;var Jm=function(r){return e;function e(i,n){let s=n&&n.indent||0,o=n&&n.join!==void 0?n.join:`
`,l=Array(s+1).join(" "),u=[];for(let c=0;c<r;++c){let h=sse(c),p=c===0?"":l;u.push(p+i.replace(/{var}/g,h))}return u.join(o)}};const Xk=Jm;jA.exports=ase,jA.exports.generateCreateBodyFunctionBody=Kk,jA.exports.getVectorCode=Jk,jA.exports.getBodyCode=Yk;function ase(r,e){let i=Kk(r,e),{Body:n}=new Function(i)();return n}function Kk(r,e){return`
${Jk(r,e)}
${Yk(r)}
return {Body: Body, Vector: Vector};
`}function Yk(r){let e=Xk(r),i=e("{var}",{join:", "});return`
function Body(${i}) {
  this.isPinned = false;
  this.pos = new Vector(${i});
  this.force = new Vector();
  this.velocity = new Vector();
  this.mass = 1;

  this.springCount = 0;
  this.springLength = 0;
}

Body.prototype.reset = function() {
  this.force.reset();
  this.springCount = 0;
  this.springLength = 0;
}

Body.prototype.setPosition = function (${i}) {
  ${e("this.pos.{var} = {var} || 0;",{indent:2})}
};`}function Jk(r,e){let i=Xk(r),n="";return e&&(n=`${i(`
   var v{var};
Object.defineProperty(this, '{var}', {
  set: function(v) { 
    if (!Number.isFinite(v)) throw new Error('Cannot set non-numbers to {var}');
    v{var} = v; 
  },
  get: function() { return v{var}; }
});`)}`),`function Vector(${i("{var}",{join:", "})}) {
  ${n}
    if (typeof arguments[0] === 'object') {
      // could be another vector
      let v = arguments[0];
      ${i('if (!Number.isFinite(v.{var})) throw new Error("Expected value is not a finite number at Vector constructor ({var})");',{indent:4})}
      ${i("this.{var} = v.{var};",{indent:4})}
    } else {
      ${i('this.{var} = typeof {var} === "number" ? {var} : 0;',{indent:4})}
    }
  }
  
  Vector.prototype.reset = function () {
    ${i("this.{var} = ",{join:""})}0;
  };`}var ose=jA.exports,sd={exports:{}};const kT=Jm,ad=qk;sd.exports=lse,sd.exports.generateQuadTreeFunctionBody=Zk,sd.exports.getInsertStackCode=r5,sd.exports.getQuadNodeCode=i5,sd.exports.isSamePosition=$k,sd.exports.getChildBodyCode=t5,sd.exports.setChildBodyCode=e5;function lse(r){let e=Zk(r);return new Function(e)()}function Zk(r){let e=kT(r),i=Math.pow(2,r);return`
${r5()}
${i5(r)}
${$k(r)}
${t5(r)}
${e5(r)}

function createQuadTree(options, random) {
  options = options || {};
  options.gravity = typeof options.gravity === 'number' ? options.gravity : -1;
  options.theta = typeof options.theta === 'number' ? options.theta : 0.8;

  var gravity = options.gravity;
  var updateQueue = [];
  var insertStack = new InsertStack();
  var theta = options.theta;

  var nodesCache = [];
  var currentInCache = 0;
  var root = newNode();

  return {
    insertBodies: insertBodies,

    /**
     * Gets root node if it is present
     */
    getRoot: function() {
      return root;
    },

    updateBodyForce: update,

    options: function(newOptions) {
      if (newOptions) {
        if (typeof newOptions.gravity === 'number') {
          gravity = newOptions.gravity;
        }
        if (typeof newOptions.theta === 'number') {
          theta = newOptions.theta;
        }

        return this;
      }

      return {
        gravity: gravity,
        theta: theta
      };
    }
  };

  function newNode() {
    // To avoid pressure on GC we reuse nodes.
    var node = nodesCache[currentInCache];
    if (node) {
${o("      node.")}
      node.body = null;
      node.mass = ${e("node.mass_{var} = ",{join:""})}0;
      ${e("node.min_{var} = node.max_{var} = ",{join:""})}0;
    } else {
      node = new QuadNode();
      nodesCache[currentInCache] = node;
    }

    ++currentInCache;
    return node;
  }

  function update(sourceBody) {
    var queue = updateQueue;
    var v;
    ${e("var d{var};",{indent:4})}
    var r; 
    ${e("var f{var} = 0;",{indent:4})}
    var queueLength = 1;
    var shiftIdx = 0;
    var pushIdx = 1;

    queue[0] = root;

    while (queueLength) {
      var node = queue[shiftIdx];
      var body = node.body;

      queueLength -= 1;
      shiftIdx += 1;
      var differentBody = (body !== sourceBody);
      if (body && differentBody) {
        // If the current node is a leaf node (and it is not source body),
        // calculate the force exerted by the current node on body, and add this
        // amount to body's net force.
        ${e("d{var} = body.pos.{var} - sourceBody.pos.{var};",{indent:8})}
        r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});

        if (r === 0) {
          // Poor man's protection against zero distance.
          ${e("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10})}
          r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});
        }

        // This is standard gravitation force calculation but we divide
        // by r^3 to save two operations when normalizing force vector.
        v = gravity * body.mass * sourceBody.mass / (r * r * r);
        ${e("f{var} += v * d{var};",{indent:8})}
      } else if (differentBody) {
        // Otherwise, calculate the ratio s / r,  where s is the width of the region
        // represented by the internal node, and r is the distance between the body
        // and the node's center-of-mass
        ${e("d{var} = node.mass_{var} / node.mass - sourceBody.pos.{var};",{indent:8})}
        r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});

        if (r === 0) {
          // Sorry about code duplication. I don't want to create many functions
          // right away. Just want to see performance first.
          ${e("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10})}
          r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});
        }
        // If s / r < θ, treat this internal node as a single body, and calculate the
        // force it exerts on sourceBody, and add this amount to sourceBody's net force.
        if ((node.max_${ad(0)} - node.min_${ad(0)}) / r < theta) {
          // in the if statement above we consider node's width only
          // because the region was made into square during tree creation.
          // Thus there is no difference between using width or height.
          v = gravity * node.mass * sourceBody.mass / (r * r * r);
          ${e("f{var} += v * d{var};",{indent:10})}
        } else {
          // Otherwise, run the procedure recursively on each of the current node's children.

          // I intentionally unfolded this loop, to save several CPU cycles.
${s()}
        }
      }
    }

    ${e("sourceBody.force.{var} += f{var};",{indent:4})}
  }

  function insertBodies(bodies) {
    ${e("var {var}min = Number.MAX_VALUE;",{indent:4})}
    ${e("var {var}max = Number.MIN_VALUE;",{indent:4})}
    var i = bodies.length;

    // To reduce quad tree depth we are looking for exact bounding box of all particles.
    while (i--) {
      var pos = bodies[i].pos;
      ${e("if (pos.{var} < {var}min) {var}min = pos.{var};",{indent:6})}
      ${e("if (pos.{var} > {var}max) {var}max = pos.{var};",{indent:6})}
    }

    // Makes the bounds square.
    var maxSideLength = -Infinity;
    ${e("if ({var}max - {var}min > maxSideLength) maxSideLength = {var}max - {var}min ;",{indent:4})}

    currentInCache = 0;
    root = newNode();
    ${e("root.min_{var} = {var}min;",{indent:4})}
    ${e("root.max_{var} = {var}min + maxSideLength;",{indent:4})}

    i = bodies.length - 1;
    if (i >= 0) {
      root.body = bodies[i];
    }
    while (i--) {
      insert(bodies[i], root);
    }
  }

  function insert(newBody) {
    insertStack.reset();
    insertStack.push(root, newBody);

    while (!insertStack.isEmpty()) {
      var stackItem = insertStack.pop();
      var node = stackItem.node;
      var body = stackItem.body;

      if (!node.body) {
        // This is internal node. Update the total mass of the node and center-of-mass.
        ${e("var {var} = body.pos.{var};",{indent:8})}
        node.mass += body.mass;
        ${e("node.mass_{var} += body.mass * {var};",{indent:8})}

        // Recursively insert the body in the appropriate quadrant.
        // But first find the appropriate quadrant.
        var quadIdx = 0; // Assume we are in the 0's quad.
        ${e("var min_{var} = node.min_{var};",{indent:8})}
        ${e("var max_{var} = (min_{var} + node.max_{var}) / 2;",{indent:8})}

${n(8)}

        var child = getChild(node, quadIdx);

        if (!child) {
          // The node is internal but this quadrant is not taken. Add
          // subnode to it.
          child = newNode();
          ${e("child.min_{var} = min_{var};",{indent:10})}
          ${e("child.max_{var} = max_{var};",{indent:10})}
          child.body = body;

          setChild(node, quadIdx, child);
        } else {
          // continue searching in this quadrant.
          insertStack.push(child, body);
        }
      } else {
        // We are trying to add to the leaf node.
        // We have to convert current leaf into internal node
        // and continue adding two nodes.
        var oldBody = node.body;
        node.body = null; // internal nodes do not cary bodies

        if (isSamePosition(oldBody.pos, body.pos)) {
          // Prevent infinite subdivision by bumping one node
          // anywhere in this quadrant
          var retriesCount = 3;
          do {
            var offset = random.nextDouble();
            ${e("var d{var} = (node.max_{var} - node.min_{var}) * offset;",{indent:12})}

            ${e("oldBody.pos.{var} = node.min_{var} + d{var};",{indent:12})}
            retriesCount -= 1;
            // Make sure we don't bump it out of the box. If we do, next iteration should fix it
          } while (retriesCount > 0 && isSamePosition(oldBody.pos, body.pos));

          if (retriesCount === 0 && isSamePosition(oldBody.pos, body.pos)) {
            // This is very bad, we ran out of precision.
            // if we do not return from the method we'll get into
            // infinite loop here. So we sacrifice correctness of layout, and keep the app running
            // Next layout iteration should get larger bounding box in the first step and fix this
            return;
          }
        }
        // Next iteration should subdivide node further.
        insertStack.push(node, oldBody);
        insertStack.push(node, body);
      }
    }
  }
}
return createQuadTree;

`;function n(l){let u=[],c=Array(l+1).join(" ");for(let h=0;h<r;++h)u.push(c+`if (${ad(h)} > max_${ad(h)}) {`),u.push(c+`  quadIdx = quadIdx + ${Math.pow(2,h)};`),u.push(c+`  min_${ad(h)} = max_${ad(h)};`),u.push(c+`  max_${ad(h)} = node.max_${ad(h)};`),u.push(c+"}");return u.join(`
`)}function s(){let l=Array(11).join(" "),u=[];for(let c=0;c<i;++c)u.push(l+`if (node.quad${c}) {`),u.push(l+`  queue[pushIdx] = node.quad${c};`),u.push(l+"  queueLength += 1;"),u.push(l+"  pushIdx += 1;"),u.push(l+"}");return u.join(`
`)}function o(l){let u=[];for(let c=0;c<i;++c)u.push(`${l}quad${c} = null;`);return u.join(`
`)}}function $k(r){let e=kT(r);return`
  function isSamePosition(point1, point2) {
    ${e("var d{var} = Math.abs(point1.{var} - point2.{var});",{indent:2})}
  
    return ${e("d{var} < 1e-8",{join:" && "})};
  }  
`}function e5(r){var e=Math.pow(2,r);return`
function setChild(node, idx, child) {
  ${i()}
}`;function i(){let n=[];for(let s=0;s<e;++s){let o=s===0?"  ":"  else ";n.push(`${o}if (idx === ${s}) node.quad${s} = child;`)}return n.join(`
`)}}function t5(r){return`function getChild(node, idx) {
${e()}
  return null;
}`;function e(){let i=[],n=Math.pow(2,r);for(let s=0;s<n;++s)i.push(`  if (idx === ${s}) return node.quad${s};`);return i.join(`
`)}}function i5(r){let e=kT(r),i=Math.pow(2,r);var n=`
function QuadNode() {
  // body stored inside this node. In quad tree only leaf nodes (by construction)
  // contain bodies:
  this.body = null;

  // Child nodes are stored in quads. Each quad is presented by number:
  // 0 | 1
  // -----
  // 2 | 3
${s("  this.")}

  // Total mass of current node
  this.mass = 0;

  // Center of mass coordinates
  ${e("this.mass_{var} = 0;",{indent:2})}

  // bounding box coordinates
  ${e("this.min_{var} = 0;",{indent:2})}
  ${e("this.max_{var} = 0;",{indent:2})}
}
`;return n;function s(o){let l=[];for(let u=0;u<i;++u)l.push(`${o}quad${u} = null;`);return l.join(`
`)}}function r5(){return`
/**
 * Our implementation of QuadTree is non-recursive to avoid GC hit
 * This data structure represent stack of elements
 * which we are trying to insert into quad tree.
 */
function InsertStack () {
    this.stack = [];
    this.popIdx = 0;
}

InsertStack.prototype = {
    isEmpty: function() {
        return this.popIdx === 0;
    },
    push: function (node, body) {
        var item = this.stack[this.popIdx];
        if (!item) {
            // we are trying to avoid memory pressure: create new element
            // only when absolutely necessary
            this.stack[this.popIdx] = new InsertStackElement(node, body);
        } else {
            item.node = node;
            item.body = body;
        }
        ++this.popIdx;
    },
    pop: function () {
        if (this.popIdx > 0) {
            return this.stack[--this.popIdx];
        }
    },
    reset: function () {
        this.popIdx = 0;
    }
};

function InsertStackElement(node, body) {
    this.node = node; // QuadTree node
    this.body = body; // physical body which needs to be inserted to node
}
`}var cse=sd.exports,FT={exports:{}};FT.exports=hse,FT.exports.generateFunctionBody=n5;const use=Jm;function hse(r){let e=n5(r);return new Function("bodies","settings","random",e)}function n5(r){let e=use(r);return`
  var boundingBox = {
    ${e("min_{var}: 0, max_{var}: 0,",{indent:4})}
  };

  return {
    box: boundingBox,

    update: updateBoundingBox,

    reset: resetBoundingBox,

    getBestNewPosition: function (neighbors) {
      var ${e("base_{var} = 0",{join:", "})};

      if (neighbors.length) {
        for (var i = 0; i < neighbors.length; ++i) {
          let neighborPos = neighbors[i].pos;
          ${e("base_{var} += neighborPos.{var};",{indent:10})}
        }

        ${e("base_{var} /= neighbors.length;",{indent:8})}
      } else {
        ${e("base_{var} = (boundingBox.min_{var} + boundingBox.max_{var}) / 2;",{indent:8})}
      }

      var springLength = settings.springLength;
      return {
        ${e("{var}: base_{var} + (random.nextDouble() - 0.5) * springLength,",{indent:8})}
      };
    }
  };

  function updateBoundingBox() {
    var i = bodies.length;
    if (i === 0) return; // No bodies - no borders.

    ${e("var max_{var} = -Infinity;",{indent:4})}
    ${e("var min_{var} = Infinity;",{indent:4})}

    while(i--) {
      // this is O(n), it could be done faster with quadtree, if we check the root node bounds
      var bodyPos = bodies[i].pos;
      ${e("if (bodyPos.{var} < min_{var}) min_{var} = bodyPos.{var};",{indent:6})}
      ${e("if (bodyPos.{var} > max_{var}) max_{var} = bodyPos.{var};",{indent:6})}
    }

    ${e("boundingBox.min_{var} = min_{var};",{indent:4})}
    ${e("boundingBox.max_{var} = max_{var};",{indent:4})}
  }

  function resetBoundingBox() {
    ${e("boundingBox.min_{var} = boundingBox.max_{var} = 0;",{indent:4})}
  }
`}var dse=FT.exports,UT={exports:{}};const pse=Jm;UT.exports=fse,UT.exports.generateCreateDragForceFunctionBody=s5;function fse(r){let e=s5(r);return new Function("options",e)}function s5(r){return`
  if (!Number.isFinite(options.dragCoefficient)) throw new Error('dragCoefficient is not a finite number');

  return {
    update: function(body) {
      ${pse(r)("body.force.{var} -= options.dragCoefficient * body.velocity.{var};",{indent:6})}
    }
  };
`}var mse=UT.exports,zT={exports:{}};const gse=Jm;zT.exports=Ase,zT.exports.generateCreateSpringForceFunctionBody=a5;function Ase(r){let e=a5(r);return new Function("options","random",e)}function a5(r){let e=gse(r);return`
  if (!Number.isFinite(options.springCoefficient)) throw new Error('Spring coefficient is not a number');
  if (!Number.isFinite(options.springLength)) throw new Error('Spring length is not a number');

  return {
    /**
     * Updates forces acting on a spring
     */
    update: function (spring) {
      var body1 = spring.from;
      var body2 = spring.to;
      var length = spring.length < 0 ? options.springLength : spring.length;
      ${e("var d{var} = body2.pos.{var} - body1.pos.{var};",{indent:6})}
      var r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});

      if (r === 0) {
        ${e("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:8})}
        r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});
      }

      var d = r - length;
      var coefficient = ((spring.coefficient > 0) ? spring.coefficient : options.springCoefficient) * d / r;

      ${e("body1.force.{var} += coefficient * d{var}",{indent:6})};
      body1.springCount += 1;
      body1.springLength += r;

      ${e("body2.force.{var} -= coefficient * d{var}",{indent:6})};
      body2.springCount += 1;
      body2.springLength += r;
    }
  };
`}var yse=zT.exports,jT={exports:{}};const vse=Jm;jT.exports=bse,jT.exports.generateIntegratorFunctionBody=o5;function bse(r){let e=o5(r);return new Function("bodies","timeStep","adaptiveTimeStepWeight",e)}function o5(r){let e=vse(r);return`
  var length = bodies.length;
  if (length === 0) return 0;

  ${e("var d{var} = 0, t{var} = 0;",{indent:2})}

  for (var i = 0; i < length; ++i) {
    var body = bodies[i];
    if (body.isPinned) continue;

    if (adaptiveTimeStepWeight && body.springCount) {
      timeStep = (adaptiveTimeStepWeight * body.springLength/body.springCount);
    }

    var coeff = timeStep / body.mass;

    ${e("body.velocity.{var} += coeff * body.force.{var};",{indent:4})}
    ${e("var v{var} = body.velocity.{var};",{indent:4})}
    var v = Math.sqrt(${e("v{var} * v{var}",{join:" + "})});

    if (v > 1) {
      // We normalize it so that we move within timeStep range. 
      // for the case when v <= 1 - we let velocity to fade out.
      ${e("body.velocity.{var} = v{var} / v;",{indent:6})}
    }

    ${e("d{var} = timeStep * body.velocity.{var};",{indent:4})}

    ${e("body.pos.{var} += d{var};",{indent:4})}

    ${e("t{var} += Math.abs(d{var});",{indent:4})}
  }

  return (${e("t{var} * t{var}",{join:" + "})})/length;
`}var xse=jT.exports,GT,l5;function _se(){if(l5)return GT;l5=1,GT=r;function r(e,i,n,s){this.from=e,this.to=i,this.length=n,this.coefficient=s}return GT}var VT,c5;function Ese(){if(c5)return VT;c5=1,VT=r;function r(e,i){var n;if(e||(e={}),i){for(n in i)if(i.hasOwnProperty(n)){var s=e.hasOwnProperty(n),o=typeof i[n],l=!s||typeof e[n]!==o;l?e[n]=i[n]:o==="object"&&(e[n]=r(e[n],i[n]))}}return e}return VT}var GA={exports:{}},u5;function wse(){if(u5)return GA.exports;u5=1,GA.exports=r,GA.exports.random=r,GA.exports.randomIterator=u;function r(c){var h=typeof c=="number"?c:+new Date;return new e(h)}function e(c){this.seed=c}e.prototype.next=l,e.prototype.nextDouble=o,e.prototype.uniform=o,e.prototype.gaussian=i;function i(){var c,h,p;do h=this.nextDouble()*2-1,p=this.nextDouble()*2-1,c=h*h+p*p;while(c>=1||c===0);return h*Math.sqrt(-2*Math.log(c)/c)}e.prototype.levy=n;function n(){var c=1.5,h=Math.pow(s(1+c)*Math.sin(Math.PI*c/2)/(s((1+c)/2)*c*Math.pow(2,(c-1)/2)),1/c);return this.gaussian()*h/Math.pow(Math.abs(this.gaussian()),1/c)}function s(c){return Math.sqrt(2*Math.PI/c)*Math.pow(1/Math.E*(c+1/(12*c-1/(10*c))),c)}function o(){var c=this.seed;return c=c+2127912214+(c<<12)&4294967295,c=(c^3345072700^c>>>19)&4294967295,c=c+374761393+(c<<5)&4294967295,c=(c+3550635116^c<<9)&4294967295,c=c+4251993797+(c<<3)&4294967295,c=(c^3042594569^c>>>16)&4294967295,this.seed=c,(c&268435455)/268435456}function l(c){return Math.floor(this.nextDouble()*c)}function u(c,h){var p=h||r();if(typeof p.next!="function")throw new Error("customRandom does not match expected API: next() function is missing");return{forEach:g,shuffle:f};function f(){var m,y,b;for(m=c.length-1;m>0;--m)y=p.next(m+1),b=c[y],c[y]=c[m],c[m]=b;return c}function g(m){var y,b,v;for(y=c.length-1;y>0;--y)b=p.next(y+1),v=c[b],c[b]=c[y],c[y]=v,m(v);c.length&&m(c[0])}}return GA.exports}var h5=Bse,Cse=ose,Sse=cse,Tse=dse,Mse=mse,Rse=yse,Ise=xse,d5={};function Bse(r){var e=_se(),i=Ese(),n=OT;if(r){if(r.springCoeff!==void 0)throw new Error("springCoeff was renamed to springCoefficient");if(r.dragCoeff!==void 0)throw new Error("dragCoeff was renamed to dragCoefficient")}r=i(r,{springLength:10,springCoefficient:.8,gravity:-12,theta:.8,dragCoefficient:.9,timeStep:.5,adaptiveTimeStepWeight:0,dimensions:2,debug:!1});var s=d5[r.dimensions];if(!s){var o=r.dimensions;s={Body:Cse(o,r.debug),createQuadTree:Sse(o),createBounds:Tse(o),createDragForce:Mse(o),createSpringForce:Rse(o),integrate:Ise(o)},d5[o]=s}var l=s.Body,u=s.createQuadTree,c=s.createBounds,h=s.createDragForce,p=s.createSpringForce,f=s.integrate,g=J=>new l(J),m=wse().random(42),y=[],b=[],v=u(r,m),_=c(y,r,m),C=p(r,m),E=h(r),T=0,R=[],B=new Map,I=0;O("nbody",H),O("spring",G);var D={bodies:y,quadTree:v,springs:b,settings:r,addForce:O,removeForce:F,getForces:q,step:function(){for(var J=0;J<R.length;++J)R[J](I);var Q=f(y,r.timeStep,r.adaptiveTimeStepWeight);return I+=1,Q},addBody:function(J){if(!J)throw new Error("Body is required");return y.push(J),J},addBodyAt:function(J){if(!J)throw new Error("Body position is required");var Q=g(J);return y.push(Q),Q},removeBody:function(J){if(J){var Q=y.indexOf(J);if(!(Q<0))return y.splice(Q,1),y.length===0&&_.reset(),!0}},addSpring:function(J,Q,V,z){if(!J||!Q)throw new Error("Cannot add null spring to force simulator");typeof V!="number"&&(V=-1);var te=new e(J,Q,V,z>=0?z:-1);return b.push(te),te},getTotalMovement:function(){return T},removeSpring:function(J){if(J){var Q=b.indexOf(J);if(Q>-1)return b.splice(Q,1),!0}},getBestNewBodyPosition:function(J){return _.getBestNewPosition(J)},getBBox:L,getBoundingBox:L,invalidateBBox:function(){console.warn("invalidateBBox() is deprecated, bounds always recomputed on `getBBox()` call")},gravity:function(J){return J!==void 0?(r.gravity=J,v.options({gravity:J}),this):r.gravity},theta:function(J){return J!==void 0?(r.theta=J,v.options({theta:J}),this):r.theta},random:m};return Nse(r,D),n(D),D;function L(){return _.update(),_.box}function O(J,Q){if(B.has(J))throw new Error("Force "+J+" is already added");B.set(J,Q),R.push(Q)}function F(J){var Q=R.indexOf(B.get(J));Q<0||(R.splice(Q,1),B.delete(J))}function q(){return B}function H(){if(y.length!==0){v.insertBodies(y);for(var J=y.length;J--;){var Q=y[J];Q.isPinned||(Q.reset(),v.updateBodyForce(Q),E.update(Q))}}}function G(){for(var J=b.length;J--;)C.update(b[J])}}function Nse(r,e){for(var i in r)Lse(r,e,i)}function Lse(r,e,i){if(r.hasOwnProperty(i)&&typeof e[i]!="function"){var n=Number.isFinite(r[i]);n?e[i]=function(s){if(s!==void 0){if(!Number.isFinite(s))throw new Error("Value of "+i+" should be a valid number.");return r[i]=s,e}return r[i]}:e[i]=function(s){return s!==void 0?(r[i]=s,e):r[i]}}}PT.exports=Ose,PT.exports.simulator=h5;var Dse=OT;function Ose(r,e){if(!r)throw new Error("Graph structure cannot be undefined");var i=e&&e.createSimulator||h5,n=i(e);if(Array.isArray(e))throw new Error("Physics settings is expected to be an object");var s=r.version>19?H:q;e&&typeof e.nodeMass=="function"&&(s=e.nodeMass);var o=new Map,l={},u=0,c=n.settings.springTransform||Pse;E(),v();var h=!1,p={step:function(){if(u===0)return f(!0),!0;var G=n.step();p.lastMove=G,p.fire("step");var J=G/u,Q=J<=.01;return f(Q),Q},getNodePosition:function(G){return F(G).pos},setNodePosition:function(G){var J=F(G);J.setPosition.apply(J,Array.prototype.slice.call(arguments,1))},getLinkPosition:function(G){var J=l[G];if(J)return{from:J.from.pos,to:J.to.pos}},getGraphRect:function(){return n.getBBox()},forEachBody:g,pinNode:function(G,J){var Q=F(G.id);Q.isPinned=!!J},isNodePinned:function(G){return F(G.id).isPinned},dispose:function(){r.off("changed",C),p.fire("disposed")},getBody:b,getSpring:y,getForceVectorLength:m,simulator:n,graph:r,lastMove:0};return Dse(p),p;function f(G){h!==G&&(h=G,_(G))}function g(G){o.forEach(G)}function m(){var G=0,J=0;return g(function(Q){G+=Math.abs(Q.force.x),J+=Math.abs(Q.force.y)}),Math.sqrt(G*G+J*J)}function y(G,J){var Q;if(J===void 0)typeof G!="object"?Q=G:Q=G.id;else{var V=r.hasLink(G,J);if(!V)return;Q=V.id}return l[Q]}function b(G){return o.get(G)}function v(){r.on("changed",C)}function _(G){p.fire("stable",G)}function C(G){for(var J=0;J<G.length;++J){var Q=G[J];Q.changeType==="add"?(Q.node&&T(Q.node.id),Q.link&&B(Q.link)):Q.changeType==="remove"&&(Q.node&&R(Q.node),Q.link&&I(Q.link))}u=r.getNodesCount()}function E(){u=0,r.forEachNode(function(G){T(G.id),u+=1}),r.forEachLink(B)}function T(G){var J=o.get(G);if(!J){var Q=r.getNode(G);if(!Q)throw new Error("initBody() was called with unknown node id");var V=Q.position;if(!V){var z=D(Q);V=n.getBestNewBodyPosition(z)}J=n.addBodyAt(V),J.id=G,o.set(G,J),L(G),O(Q)&&(J.isPinned=!0)}}function R(G){var J=G.id,Q=o.get(J);Q&&(o.delete(J),n.removeBody(Q))}function B(G){L(G.fromId),L(G.toId);var J=o.get(G.fromId),Q=o.get(G.toId),V=n.addSpring(J,Q,G.length);c(G,V),l[G.id]=V}function I(G){var J=l[G.id];if(J){var Q=r.getNode(G.fromId),V=r.getNode(G.toId);Q&&L(Q.id),V&&L(V.id),delete l[G.id],n.removeSpring(J)}}function D(G){var J=[];if(!G.links)return J;for(var Q=Math.min(G.links.length,2),V=0;V<Q;++V){var z=G.links[V],te=z.fromId!==G.id?o.get(z.fromId):o.get(z.toId);te&&te.pos&&J.push(te)}return J}function L(G){var J=o.get(G);if(J.mass=s(G),Number.isNaN(J.mass))throw new Error("Node mass should be a number")}function O(G){return G&&(G.isPinned||G.data&&G.data.isPinned)}function F(G){var J=o.get(G);return J||(T(G),J=o.get(G)),J}function q(G){var J=r.getLinks(G);return J?1+J.length/3:1}function H(G){var J=r.getLinks(G);return J?1+J.size/3:1}}function Pse(){}var kse=PT.exports;const Fse=D2(kse);function Zx(r){var e=typeof r;return r!=null&&(e=="object"||e=="function")}var Use=typeof global=="object"&&global&&global.Object===Object&&global,zse=typeof self=="object"&&self&&self.Object===Object&&self,p5=Use||zse||Function("return this")(),HT=function(){return p5.Date.now()},jse=/\s/;function Gse(r){for(var e=r.length;e--&&jse.test(r.charAt(e)););return e}var Vse=/^\s+/;function Hse(r){return r&&r.slice(0,Gse(r)+1).replace(Vse,"")}var $x=p5.Symbol,f5=Object.prototype,Wse=f5.hasOwnProperty,Qse=f5.toString,VA=$x?$x.toStringTag:void 0;function qse(r){var e=Wse.call(r,VA),i=r[VA];try{r[VA]=void 0;var n=!0}catch{}var s=Qse.call(r);return n&&(e?r[VA]=i:delete r[VA]),s}var Xse=Object.prototype,Kse=Xse.toString;function Yse(r){return Kse.call(r)}var Jse="[object Null]",Zse="[object Undefined]",m5=$x?$x.toStringTag:void 0;function $se(r){return r==null?r===void 0?Zse:Jse:m5&&m5 in Object(r)?qse(r):Yse(r)}function eae(r){return r!=null&&typeof r=="object"}var tae="[object Symbol]";function iae(r){return typeof r=="symbol"||eae(r)&&$se(r)==tae}var g5=NaN,rae=/^[-+]0x[0-9a-f]+$/i,nae=/^0b[01]+$/i,sae=/^0o[0-7]+$/i,aae=parseInt;function A5(r){if(typeof r=="number")return r;if(iae(r))return g5;if(Zx(r)){var e=typeof r.valueOf=="function"?r.valueOf():r;r=Zx(e)?e+"":e}if(typeof r!="string")return r===0?r:+r;r=Hse(r);var i=nae.test(r);return i||sae.test(r)?aae(r.slice(2),i?2:8):rae.test(r)?g5:+r}var oae="Expected a function",lae=Math.max,cae=Math.min;function y5(r,e,i){var n,s,o,l,u,c,h=0,p=!1,f=!1,g=!0;if(typeof r!="function")throw new TypeError(oae);e=A5(e)||0,Zx(i)&&(p=!!i.leading,f="maxWait"in i,o=f?lae(A5(i.maxWait)||0,e):o,g="trailing"in i?!!i.trailing:g);function m(B){var I=n,D=s;return n=s=void 0,h=B,l=r.apply(D,I),l}function y(B){return h=B,u=setTimeout(_,e),p?m(B):l}function b(B){var I=B-c,D=B-h,L=e-I;return f?cae(L,o-D):L}function v(B){var I=B-c,D=B-h;return c===void 0||I>=e||I<0||f&&D>=o}function _(){var B=HT();if(v(B))return C(B);u=setTimeout(_,b(B))}function C(B){return u=void 0,g&&n?m(B):(n=s=void 0,l)}function E(){u!==void 0&&clearTimeout(u),h=0,n=c=s=u=void 0}function T(){return u===void 0?l:C(HT())}function R(){var B=HT(),I=v(B);if(n=arguments,s=this,c=B,I){if(u===void 0)return y(c);if(f)return clearTimeout(u),u=setTimeout(_,e),m(c)}return u===void 0&&(u=setTimeout(_,e)),l}return R.cancel=E,R.flush=T,R}function v5(r,e){(e==null||e>r.length)&&(e=r.length);for(var i=0,n=Array(e);i<e;i++)n[i]=r[i];return n}function uae(r){if(Array.isArray(r))return r}function hae(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function dae(r,e,i){return Object.defineProperty(r,"prototype",{writable:!1}),r}function pae(r,e){var i=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(i!=null){var n,s,o,l,u=[],c=!0,h=!1;try{if(o=(i=i.call(r)).next,e!==0)for(;!(c=(n=o.call(i)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(p){h=!0,s=p}finally{try{if(!c&&i.return!=null&&(l=i.return(),Object(l)!==l))return}finally{if(h)throw s}}return u}}function fae(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function mae(r,e){return uae(r)||pae(r,e)||gae(r,e)||fae()}function gae(r,e){if(r){if(typeof r=="string")return v5(r,e);var i={}.toString.call(r).slice(8,-1);return i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set"?Array.from(r):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?v5(r,e):void 0}}var Aae=dae(function r(e,i){var n=i.default,s=n===void 0?null:n,o=i.triggerUpdate,l=o===void 0?!0:o,u=i.onChange,c=u===void 0?function(h,p){}:u;hae(this,r),this.name=e,this.defaultVal=s,this.triggerUpdate=l,this.onChange=c});function Rp(r){var e=r.stateInit,i=e===void 0?function(){return{}}:e,n=r.props,s=n===void 0?{}:n,o=r.methods,l=o===void 0?{}:o,u=r.aliases,c=u===void 0?{}:u,h=r.init,p=h===void 0?function(){}:h,f=r.update,g=f===void 0?function(){}:f,m=Object.keys(s).map(function(y){return new Aae(y,s[y])});return function y(){for(var b=arguments.length,v=new Array(b),_=0;_<b;_++)v[_]=arguments[_];var C=!!(this instanceof y&&this.constructor),E=C?v.shift():void 0,T=v[0],R=T===void 0?{}:T,B=Object.assign({},i instanceof Function?i(R):i,{initialised:!1}),I={};function D(F){return L(F,R),O(),D}var L=function(F,q){p.call(D,F,B,q),B.initialised=!0},O=y5(function(){B.initialised&&(g.call(D,B,I),I={})},1);return m.forEach(function(F){D[F.name]=q(F);function q(H){var G=H.name,J=H.triggerUpdate,Q=J===void 0?!1:J,V=H.onChange,z=V===void 0?function(ae,Ae){}:V,te=H.defaultVal,K=te===void 0?null:te;return function(ae){var Ae=B[G];if(!arguments.length)return Ae;var _e=ae===void 0?K:ae;return B[G]=_e,z.call(D,_e,B,Ae),!I.hasOwnProperty(G)&&(I[G]=Ae),Q&&O(),D}}}),Object.keys(l).forEach(function(F){D[F]=function(){for(var q,H=arguments.length,G=new Array(H),J=0;J<H;J++)G[J]=arguments[J];return(q=l[F]).call.apply(q,[D,B].concat(G))}}),Object.entries(c).forEach(function(F){var q=mae(F,2),H=q[0],G=q[1];return D[H]=D[G]}),D.resetProps=function(){return m.forEach(function(F){D[F.name](F.defaultVal)}),D},D.resetProps(),B._rerender=O,C&&E&&D(E),D}}class b5 extends Map{constructor(e,i=bae){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:i}}),e!=null)for(const[n,s]of e)this.set(n,s)}get(e){return super.get(x5(this,e))}has(e){return super.has(x5(this,e))}set(e,i){return super.set(yae(this,e),i)}delete(e){return super.delete(vae(this,e))}}function x5({_intern:r,_key:e},i){const n=e(i);return r.has(n)?r.get(n):i}function yae({_intern:r,_key:e},i){const n=e(i);return r.has(n)?r.get(n):(r.set(n,i),i)}function vae({_intern:r,_key:e},i){const n=e(i);return r.has(n)&&(i=r.get(n),r.delete(n)),i}function bae(r){return r!==null&&typeof r=="object"?r.valueOf():r}function WT(r,e){let i;if(e===void 0)for(const n of r)n!=null&&(i<n||i===void 0&&n>=n)&&(i=n);else{let n=-1;for(let s of r)(s=e(s,++n,r))!=null&&(i<s||i===void 0&&s>=s)&&(i=s)}return i}function QT(r,e){let i;if(e===void 0)for(const n of r)n!=null&&(i>n||i===void 0&&n>=n)&&(i=n);else{let n=-1;for(let s of r)(s=e(s,++n,r))!=null&&(i>s||i===void 0&&s>=s)&&(i=s)}return i}function qT(r,e){(e==null||e>r.length)&&(e=r.length);for(var i=0,n=Array(e);i<e;i++)n[i]=r[i];return n}function xae(r){if(Array.isArray(r))return r}function _ae(r){if(Array.isArray(r))return qT(r)}function Eae(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function wae(r,e){var i=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(i!=null){var n,s,o,l,u=[],c=!0,h=!1;try{if(o=(i=i.call(r)).next,e!==0)for(;!(c=(n=o.call(i)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(p){h=!0,s=p}finally{try{if(!c&&i.return!=null&&(l=i.return(),Object(l)!==l))return}finally{if(h)throw s}}return u}}function Cae(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Sae(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Tae(r,e){if(r==null)return{};var i,n,s=Mae(r,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(r);for(n=0;n<o.length;n++)i=o[n],e.includes(i)||{}.propertyIsEnumerable.call(r,i)&&(s[i]=r[i])}return s}function Mae(r,e){if(r==null)return{};var i={};for(var n in r)if({}.hasOwnProperty.call(r,n)){if(e.includes(n))continue;i[n]=r[n]}return i}function Rae(r,e){return xae(r)||wae(r,e)||_5(r,e)||Cae()}function Iae(r){return _ae(r)||Eae(r)||_5(r)||Sae()}function Bae(r,e){if(typeof r!="object"||!r)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var n=i.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}function Nae(r){var e=Bae(r,"string");return typeof e=="symbol"?e:e+""}function _5(r,e){if(r){if(typeof r=="string")return qT(r,e);var i={}.toString.call(r).slice(8,-1);return i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set"?Array.from(r):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?qT(r,e):void 0}}var XT=function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=(e instanceof Array?e.length?e:[void 0]:[e]).map(function(u){return{keyAccessor:u,isProp:!(u instanceof Function)}}),o=r.reduce(function(u,c){var h=u,p=c;return s.forEach(function(f,g){var m=f.keyAccessor,y=f.isProp,b;if(y){var v=p,_=v[m],C=Tae(v,[m].map(Nae));b=_,p=C}else b=m(p,g);g+1<s.length?(h.hasOwnProperty(b)||(h[b]={}),h=h[b]):i?(h.hasOwnProperty(b)||(h[b]=[]),h[b].push(p)):h[b]=p}),u},{});i instanceof Function&&function u(c){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;h===s.length?Object.keys(c).forEach(function(p){return c[p]=i(c[p])}):Object.values(c).forEach(function(p){return u(p,h+1)})}(o);var l=o;return n&&(l=[],function u(c){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];h.length===s.length?l.push({keys:h,vals:c}):Object.entries(c).forEach(function(p){var f=Rae(p,2),g=f[0],m=f[1];return u(m,[].concat(Iae(h),[g]))})}(o),e instanceof Array&&e.length===0&&l.length===1&&(l[0].keys=[])),l};function Lae(r,e){var i=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(i!=null){var n,s,o,l,u=[],c=!0,h=!1;try{if(o=(i=i.call(r)).next,e!==0)for(;!(c=(n=o.call(i)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(p){h=!0,s=p}finally{try{if(!c&&i.return!=null&&(l=i.return(),Object(l)!==l))return}finally{if(h)throw s}}return u}}function E5(r,e){var i=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),i.push.apply(i,n)}return i}function Dae(r){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?E5(Object(i),!0).forEach(function(n){w5(r,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):E5(Object(i)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(i,n))})}return r}function w5(r,e,i){return e=Vae(e),e in r?Object.defineProperty(r,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[e]=i,r}function Oae(r,e){if(r==null)return{};var i={},n=Object.keys(r),s,o;for(o=0;o<n.length;o++)s=n[o],!(e.indexOf(s)>=0)&&(i[s]=r[s]);return i}function Pae(r,e){if(r==null)return{};var i=Oae(r,e),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(r);for(s=0;s<o.length;s++)n=o[s],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(r,n)&&(i[n]=r[n])}return i}function C5(r,e){return Fae(r)||Lae(r,e)||S5(r,e)||jae()}function e1(r){return kae(r)||Uae(r)||S5(r)||zae()}function kae(r){if(Array.isArray(r))return KT(r)}function Fae(r){if(Array.isArray(r))return r}function Uae(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function S5(r,e){if(r){if(typeof r=="string")return KT(r,e);var i=Object.prototype.toString.call(r).slice(8,-1);if(i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set")return Array.from(r);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return KT(r,e)}}function KT(r,e){(e==null||e>r.length)&&(e=r.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=r[i];return n}function zae(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function jae(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Gae(r,e){if(typeof r!="object"||r===null)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var n=i.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function Vae(r){var e=Gae(r,"string");return typeof e=="symbol"?e:String(e)}var Hae=["createObj","updateObj","exitObj","objBindAttr","dataBindAttr"];function Wae(r,e,i){var n={enter:[],update:[],exit:[]};if(i){var s=XT(r,i,!1),o=XT(e,i,!1),l=Object.assign({},s,o);Object.entries(l).forEach(function(h){var p=C5(h,2),f=p[0],g=p[1],m=s.hasOwnProperty(f)?o.hasOwnProperty(f)?"update":"exit":"enter";n[m].push(m==="update"?[s[f],o[f]]:g)})}else{var u=new Set(r),c=new Set(e);new Set([].concat(e1(u),e1(c))).forEach(function(h){var p=u.has(h)?c.has(h)?"update":"exit":"enter";n[p].push(p==="update"?[h,h]:h)})}return n}function Qae(r,e,i){var n=i.objBindAttr,s=n===void 0?"__obj":n,o=i.dataBindAttr,l=o===void 0?"__data":o,u=i.idAccessor,c=i.purge,h=c===void 0?!1:c,p=function(b){return b.hasOwnProperty(l)},f=e.filter(function(b){return!p(b)}),g=e.filter(p).map(function(b){return b[l]}),m=r,y=h?{enter:m,exit:g,update:[]}:Wae(g,m,u);return y.update=y.update.map(function(b){var v=C5(b,2),_=v[0],C=v[1];return _!==C&&(C[s]=_[s],C[s][l]=C),C}),y.exit=y.exit.concat(f.map(function(b){return w5({},s,b)})),y}function qae(r,e,i,n,s){var o=s.createObj,l=o===void 0?function(D){return{}}:o,u=s.updateObj,c=u===void 0?function(D,L){}:u,h=s.exitObj,p=h===void 0?function(D){}:h,f=s.objBindAttr,g=f===void 0?"__obj":f,m=s.dataBindAttr,y=m===void 0?"__data":m,b=Pae(s,Hae),v=Qae(r,e,Dae({objBindAttr:g,dataBindAttr:y},b)),_=v.enter,C=v.update,E=v.exit;E.forEach(function(D){var L=D[g];delete D[g],p(L),n(L)});var T=B(_),R=[].concat(e1(_),e1(C));I(R),T.forEach(i);function B(D){var L=[];return D.forEach(function(O){var F=l(O);F&&(F[y]=O,O[g]=F,L.push(F))}),L}function I(D){D.forEach(function(L){var O=L[g];O&&(O[y]=L,c(O,L))})}}function Xae(r,e){switch(arguments.length){case 0:break;case 1:this.range(r);break;default:this.range(e).domain(r);break}return this}const T5=Symbol("implicit");function YT(){var r=new b5,e=[],i=[],n=T5;function s(o){let l=r.get(o);if(l===void 0){if(n!==T5)return n;r.set(o,l=e.push(o)-1)}return i[l%i.length]}return s.domain=function(o){if(!arguments.length)return e.slice();e=[],r=new b5;for(const l of o)r.has(l)||r.set(l,e.push(l)-1);return s},s.range=function(o){return arguments.length?(i=Array.from(o),s):i.slice()},s.unknown=function(o){return arguments.length?(n=o,s):n},s.copy=function(){return YT(e,i).unknown(n)},Xae.apply(s,arguments),s}function JT(r,e,i){r.prototype=e.prototype=i,i.constructor=r}function M5(r,e){var i=Object.create(r.prototype);for(var n in e)i[n]=e[n];return i}function HA(){}var WA=.7,t1=1/WA,Zm="\\s*([+-]?\\d+)\\s*",QA="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",qc="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Kae=/^#([0-9a-f]{3,8})$/,Yae=new RegExp(`^rgb\\(${Zm},${Zm},${Zm}\\)$`),Jae=new RegExp(`^rgb\\(${qc},${qc},${qc}\\)$`),Zae=new RegExp(`^rgba\\(${Zm},${Zm},${Zm},${QA}\\)$`),$ae=new RegExp(`^rgba\\(${qc},${qc},${qc},${QA}\\)$`),eoe=new RegExp(`^hsl\\(${QA},${qc},${qc}\\)$`),toe=new RegExp(`^hsla\\(${QA},${qc},${qc},${QA}\\)$`),R5={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};JT(HA,qA,{copy(r){return Object.assign(new this.constructor,this,r)},displayable(){return this.rgb().displayable()},hex:I5,formatHex:I5,formatHex8:ioe,formatHsl:roe,formatRgb:B5,toString:B5});function I5(){return this.rgb().formatHex()}function ioe(){return this.rgb().formatHex8()}function roe(){return P5(this).formatHsl()}function B5(){return this.rgb().formatRgb()}function qA(r){var e,i;return r=(r+"").trim().toLowerCase(),(e=Kae.exec(r))?(i=e[1].length,e=parseInt(e[1],16),i===6?N5(e):i===3?new Wo(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):i===8?i1(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):i===4?i1(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=Yae.exec(r))?new Wo(e[1],e[2],e[3],1):(e=Jae.exec(r))?new Wo(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=Zae.exec(r))?i1(e[1],e[2],e[3],e[4]):(e=$ae.exec(r))?i1(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=eoe.exec(r))?O5(e[1],e[2]/100,e[3]/100,1):(e=toe.exec(r))?O5(e[1],e[2]/100,e[3]/100,e[4]):R5.hasOwnProperty(r)?N5(R5[r]):r==="transparent"?new Wo(NaN,NaN,NaN,0):null}function N5(r){return new Wo(r>>16&255,r>>8&255,r&255,1)}function i1(r,e,i,n){return n<=0&&(r=e=i=NaN),new Wo(r,e,i,n)}function noe(r){return r instanceof HA||(r=qA(r)),r?(r=r.rgb(),new Wo(r.r,r.g,r.b,r.opacity)):new Wo}function ZT(r,e,i,n){return arguments.length===1?noe(r):new Wo(r,e,i,n??1)}function Wo(r,e,i,n){this.r=+r,this.g=+e,this.b=+i,this.opacity=+n}JT(Wo,ZT,M5(HA,{brighter(r){return r=r==null?t1:Math.pow(t1,r),new Wo(this.r*r,this.g*r,this.b*r,this.opacity)},darker(r){return r=r==null?WA:Math.pow(WA,r),new Wo(this.r*r,this.g*r,this.b*r,this.opacity)},rgb(){return this},clamp(){return new Wo(Ip(this.r),Ip(this.g),Ip(this.b),r1(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:L5,formatHex:L5,formatHex8:soe,formatRgb:D5,toString:D5}));function L5(){return`#${Bp(this.r)}${Bp(this.g)}${Bp(this.b)}`}function soe(){return`#${Bp(this.r)}${Bp(this.g)}${Bp(this.b)}${Bp((isNaN(this.opacity)?1:this.opacity)*255)}`}function D5(){const r=r1(this.opacity);return`${r===1?"rgb(":"rgba("}${Ip(this.r)}, ${Ip(this.g)}, ${Ip(this.b)}${r===1?")":`, ${r})`}`}function r1(r){return isNaN(r)?1:Math.max(0,Math.min(1,r))}function Ip(r){return Math.max(0,Math.min(255,Math.round(r)||0))}function Bp(r){return r=Ip(r),(r<16?"0":"")+r.toString(16)}function O5(r,e,i,n){return n<=0?r=e=i=NaN:i<=0||i>=1?r=e=NaN:e<=0&&(r=NaN),new hc(r,e,i,n)}function P5(r){if(r instanceof hc)return new hc(r.h,r.s,r.l,r.opacity);if(r instanceof HA||(r=qA(r)),!r)return new hc;if(r instanceof hc)return r;r=r.rgb();var e=r.r/255,i=r.g/255,n=r.b/255,s=Math.min(e,i,n),o=Math.max(e,i,n),l=NaN,u=o-s,c=(o+s)/2;return u?(e===o?l=(i-n)/u+(i<n)*6:i===o?l=(n-e)/u+2:l=(e-i)/u+4,u/=c<.5?o+s:2-o-s,l*=60):u=c>0&&c<1?0:l,new hc(l,u,c,r.opacity)}function aoe(r,e,i,n){return arguments.length===1?P5(r):new hc(r,e,i,n??1)}function hc(r,e,i,n){this.h=+r,this.s=+e,this.l=+i,this.opacity=+n}JT(hc,aoe,M5(HA,{brighter(r){return r=r==null?t1:Math.pow(t1,r),new hc(this.h,this.s,this.l*r,this.opacity)},darker(r){return r=r==null?WA:Math.pow(WA,r),new hc(this.h,this.s,this.l*r,this.opacity)},rgb(){var r=this.h%360+(this.h<0)*360,e=isNaN(r)||isNaN(this.s)?0:this.s,i=this.l,n=i+(i<.5?i:1-i)*e,s=2*i-n;return new Wo($T(r>=240?r-240:r+120,s,n),$T(r,s,n),$T(r<120?r+240:r-120,s,n),this.opacity)},clamp(){return new hc(k5(this.h),n1(this.s),n1(this.l),r1(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const r=r1(this.opacity);return`${r===1?"hsl(":"hsla("}${k5(this.h)}, ${n1(this.s)*100}%, ${n1(this.l)*100}%${r===1?")":`, ${r})`}`}}));function k5(r){return r=(r||0)%360,r<0?r+360:r}function n1(r){return Math.max(0,Math.min(1,r||0))}function $T(r,e,i){return(r<60?e+(i-e)*r/60:r<180?i:r<240?e+(i-e)*(240-r)/60:e)*255}const F5=r=>()=>r;function ooe(r,e){return function(i){return r+i*e}}function loe(r,e,i){return r=Math.pow(r,i),e=Math.pow(e,i)-r,i=1/i,function(n){return Math.pow(r+n*e,i)}}function coe(r){return(r=+r)==1?U5:function(e,i){return i-e?loe(e,i,r):F5(isNaN(e)?i:e)}}function U5(r,e){var i=e-r;return i?ooe(r,i):F5(isNaN(r)?e:r)}const z5=function r(e){var i=coe(e);function n(s,o){var l=i((s=ZT(s)).r,(o=ZT(o)).r),u=i(s.g,o.g),c=i(s.b,o.b),h=U5(s.opacity,o.opacity);return function(p){return s.r=l(p),s.g=u(p),s.b=c(p),s.opacity=h(p),s+""}}return n.gamma=r,n}(1);function od(r,e){return r=+r,e=+e,function(i){return r*(1-i)+e*i}}var eM=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,tM=new RegExp(eM.source,"g");function uoe(r){return function(){return r}}function hoe(r){return function(e){return r(e)+""}}function doe(r,e){var i=eM.lastIndex=tM.lastIndex=0,n,s,o,l=-1,u=[],c=[];for(r=r+"",e=e+"";(n=eM.exec(r))&&(s=tM.exec(e));)(o=s.index)>i&&(o=e.slice(i,o),u[l]?u[l]+=o:u[++l]=o),(n=n[0])===(s=s[0])?u[l]?u[l]+=s:u[++l]=s:(u[++l]=null,c.push({i:l,x:od(n,s)})),i=tM.lastIndex;return i<e.length&&(o=e.slice(i),u[l]?u[l]+=o:u[++l]=o),u.length<2?c[0]?hoe(c[0].x):uoe(e):(e=c.length,function(h){for(var p=0,f;p<e;++p)u[(f=c[p]).i]=f.x(h);return u.join("")})}var j5=180/Math.PI,G5={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function V5(r,e,i,n,s,o){var l,u,c;return(l=Math.sqrt(r*r+e*e))&&(r/=l,e/=l),(c=r*i+e*n)&&(i-=r*c,n-=e*c),(u=Math.sqrt(i*i+n*n))&&(i/=u,n/=u,c/=u),r*n<e*i&&(r=-r,e=-e,c=-c,l=-l),{translateX:s,translateY:o,rotate:Math.atan2(e,r)*j5,skewX:Math.atan(c)*j5,scaleX:l,scaleY:u}}var s1;function poe(r){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(r+"");return e.isIdentity?G5:V5(e.a,e.b,e.c,e.d,e.e,e.f)}function foe(r){return r==null||(s1||(s1=document.createElementNS("http://www.w3.org/2000/svg","g")),s1.setAttribute("transform",r),!(r=s1.transform.baseVal.consolidate()))?G5:(r=r.matrix,V5(r.a,r.b,r.c,r.d,r.e,r.f))}function H5(r,e,i,n){function s(h){return h.length?h.pop()+" ":""}function o(h,p,f,g,m,y){if(h!==f||p!==g){var b=m.push("translate(",null,e,null,i);y.push({i:b-4,x:od(h,f)},{i:b-2,x:od(p,g)})}else(f||g)&&m.push("translate("+f+e+g+i)}function l(h,p,f,g){h!==p?(h-p>180?p+=360:p-h>180&&(h+=360),g.push({i:f.push(s(f)+"rotate(",null,n)-2,x:od(h,p)})):p&&f.push(s(f)+"rotate("+p+n)}function u(h,p,f,g){h!==p?g.push({i:f.push(s(f)+"skewX(",null,n)-2,x:od(h,p)}):p&&f.push(s(f)+"skewX("+p+n)}function c(h,p,f,g,m,y){if(h!==f||p!==g){var b=m.push(s(m)+"scale(",null,",",null,")");y.push({i:b-4,x:od(h,f)},{i:b-2,x:od(p,g)})}else(f!==1||g!==1)&&m.push(s(m)+"scale("+f+","+g+")")}return function(h,p){var f=[],g=[];return h=r(h),p=r(p),o(h.translateX,h.translateY,p.translateX,p.translateY,f,g),l(h.rotate,p.rotate,f,g),u(h.skewX,p.skewX,f,g),c(h.scaleX,h.scaleY,p.scaleX,p.scaleY,f,g),h=p=null,function(m){for(var y=-1,b=g.length,v;++y<b;)f[(v=g[y]).i]=v.x(m);return f.join("")}}}var moe=H5(poe,"px, ","px)","deg)"),goe=H5(foe,", ",")",")"),Aoe=1e-12;function W5(r){return((r=Math.exp(r))+1/r)/2}function yoe(r){return((r=Math.exp(r))-1/r)/2}function voe(r){return((r=Math.exp(2*r))-1)/(r+1)}const boe=function r(e,i,n){function s(o,l){var u=o[0],c=o[1],h=o[2],p=l[0],f=l[1],g=l[2],m=p-u,y=f-c,b=m*m+y*y,v,_;if(b<Aoe)_=Math.log(g/h)/e,v=function(I){return[u+I*m,c+I*y,h*Math.exp(e*I*_)]};else{var C=Math.sqrt(b),E=(g*g-h*h+n*b)/(2*h*i*C),T=(g*g-h*h-n*b)/(2*g*i*C),R=Math.log(Math.sqrt(E*E+1)-E),B=Math.log(Math.sqrt(T*T+1)-T);_=(B-R)/e,v=function(I){var D=I*_,L=W5(R),O=h/(i*C)*(L*voe(e*D+R)-yoe(R));return[u+O*m,c+O*y,h*L/W5(e*D+R)]}}return v.duration=_*1e3*e/Math.SQRT2,v}return s.rho=function(o){var l=Math.max(.001,+o),u=l*l,c=u*u;return r(l,u,c)},s}(Math.SQRT2,2,4);function xoe(r){for(var e=r.length/6|0,i=new Array(e),n=0;n<e;)i[n]="#"+r.slice(n*6,++n*6);return i}const Q5=xoe("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928");function a1(r){"@babel/helpers - typeof";return a1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a1(r)}var _oe=/^\s+/,Eoe=/\s+$/;function xr(r,e){if(r=r||"",e=e||{},r instanceof xr)return r;if(!(this instanceof xr))return new xr(r,e);var i=woe(r);this._originalInput=r,this._r=i.r,this._g=i.g,this._b=i.b,this._a=i.a,this._roundA=Math.round(100*this._a)/100,this._format=e.format||i.format,this._gradientType=e.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=i.ok}xr.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var r=this.toRgb();return(r.r*299+r.g*587+r.b*114)/1e3},getLuminance:function(){var r=this.toRgb(),e,i,n,s,o,l;return e=r.r/255,i=r.g/255,n=r.b/255,e<=.03928?s=e/12.92:s=Math.pow((e+.055)/1.055,2.4),i<=.03928?o=i/12.92:o=Math.pow((i+.055)/1.055,2.4),n<=.03928?l=n/12.92:l=Math.pow((n+.055)/1.055,2.4),.2126*s+.7152*o+.0722*l},setAlpha:function(r){return this._a=Z5(r),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var r=X5(this._r,this._g,this._b);return{h:r.h*360,s:r.s,v:r.v,a:this._a}},toHsvString:function(){var r=X5(this._r,this._g,this._b),e=Math.round(r.h*360),i=Math.round(r.s*100),n=Math.round(r.v*100);return this._a==1?"hsv("+e+", "+i+"%, "+n+"%)":"hsva("+e+", "+i+"%, "+n+"%, "+this._roundA+")"},toHsl:function(){var r=q5(this._r,this._g,this._b);return{h:r.h*360,s:r.s,l:r.l,a:this._a}},toHslString:function(){var r=q5(this._r,this._g,this._b),e=Math.round(r.h*360),i=Math.round(r.s*100),n=Math.round(r.l*100);return this._a==1?"hsl("+e+", "+i+"%, "+n+"%)":"hsla("+e+", "+i+"%, "+n+"%, "+this._roundA+")"},toHex:function(r){return K5(this._r,this._g,this._b,r)},toHexString:function(r){return"#"+this.toHex(r)},toHex8:function(r){return Moe(this._r,this._g,this._b,this._a,r)},toHex8String:function(r){return"#"+this.toHex8(r)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(Es(this._r,255)*100)+"%",g:Math.round(Es(this._g,255)*100)+"%",b:Math.round(Es(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+Math.round(Es(this._r,255)*100)+"%, "+Math.round(Es(this._g,255)*100)+"%, "+Math.round(Es(this._b,255)*100)+"%)":"rgba("+Math.round(Es(this._r,255)*100)+"%, "+Math.round(Es(this._g,255)*100)+"%, "+Math.round(Es(this._b,255)*100)+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":this._a<1?!1:zoe[K5(this._r,this._g,this._b,!0)]||!1},toFilter:function(r){var e="#"+Y5(this._r,this._g,this._b,this._a),i=e,n=this._gradientType?"GradientType = 1, ":"";if(r){var s=xr(r);i="#"+Y5(s._r,s._g,s._b,s._a)}return"progid:DXImageTransform.Microsoft.gradient("+n+"startColorstr="+e+",endColorstr="+i+")"},toString:function(r){var e=!!r;r=r||this._format;var i=!1,n=this._a<1&&this._a>=0,s=!e&&n&&(r==="hex"||r==="hex6"||r==="hex3"||r==="hex4"||r==="hex8"||r==="name");return s?r==="name"&&this._a===0?this.toName():this.toRgbString():(r==="rgb"&&(i=this.toRgbString()),r==="prgb"&&(i=this.toPercentageRgbString()),(r==="hex"||r==="hex6")&&(i=this.toHexString()),r==="hex3"&&(i=this.toHexString(!0)),r==="hex4"&&(i=this.toHex8String(!0)),r==="hex8"&&(i=this.toHex8String()),r==="name"&&(i=this.toName()),r==="hsl"&&(i=this.toHslString()),r==="hsv"&&(i=this.toHsvString()),i||this.toHexString())},clone:function(){return xr(this.toString())},_applyModification:function(r,e){var i=r.apply(null,[this].concat([].slice.call(e)));return this._r=i._r,this._g=i._g,this._b=i._b,this.setAlpha(i._a),this},lighten:function(){return this._applyModification(Noe,arguments)},brighten:function(){return this._applyModification(Loe,arguments)},darken:function(){return this._applyModification(Doe,arguments)},desaturate:function(){return this._applyModification(Roe,arguments)},saturate:function(){return this._applyModification(Ioe,arguments)},greyscale:function(){return this._applyModification(Boe,arguments)},spin:function(){return this._applyModification(Ooe,arguments)},_applyCombination:function(r,e){return r.apply(null,[this].concat([].slice.call(e)))},analogous:function(){return this._applyCombination(Foe,arguments)},complement:function(){return this._applyCombination(Poe,arguments)},monochromatic:function(){return this._applyCombination(Uoe,arguments)},splitcomplement:function(){return this._applyCombination(koe,arguments)},triad:function(){return this._applyCombination(J5,[3])},tetrad:function(){return this._applyCombination(J5,[4])}},xr.fromRatio=function(r,e){if(a1(r)=="object"){var i={};for(var n in r)r.hasOwnProperty(n)&&(n==="a"?i[n]=r[n]:i[n]=XA(r[n]));r=i}return xr(r,e)};function woe(r){var e={r:0,g:0,b:0},i=1,n=null,s=null,o=null,l=!1,u=!1;return typeof r=="string"&&(r=Hoe(r)),a1(r)=="object"&&(Gu(r.r)&&Gu(r.g)&&Gu(r.b)?(e=Coe(r.r,r.g,r.b),l=!0,u=String(r.r).substr(-1)==="%"?"prgb":"rgb"):Gu(r.h)&&Gu(r.s)&&Gu(r.v)?(n=XA(r.s),s=XA(r.v),e=Toe(r.h,n,s),l=!0,u="hsv"):Gu(r.h)&&Gu(r.s)&&Gu(r.l)&&(n=XA(r.s),o=XA(r.l),e=Soe(r.h,n,o),l=!0,u="hsl"),r.hasOwnProperty("a")&&(i=r.a)),i=Z5(i),{ok:l,format:r.format||u,r:Math.min(255,Math.max(e.r,0)),g:Math.min(255,Math.max(e.g,0)),b:Math.min(255,Math.max(e.b,0)),a:i}}function Coe(r,e,i){return{r:Es(r,255)*255,g:Es(e,255)*255,b:Es(i,255)*255}}function q5(r,e,i){r=Es(r,255),e=Es(e,255),i=Es(i,255);var n=Math.max(r,e,i),s=Math.min(r,e,i),o,l,u=(n+s)/2;if(n==s)o=l=0;else{var c=n-s;switch(l=u>.5?c/(2-n-s):c/(n+s),n){case r:o=(e-i)/c+(e<i?6:0);break;case e:o=(i-r)/c+2;break;case i:o=(r-e)/c+4;break}o/=6}return{h:o,s:l,l:u}}function Soe(r,e,i){var n,s,o;r=Es(r,360),e=Es(e,100),i=Es(i,100);function l(h,p,f){return f<0&&(f+=1),f>1&&(f-=1),f<1/6?h+(p-h)*6*f:f<1/2?p:f<2/3?h+(p-h)*(2/3-f)*6:h}if(e===0)n=s=o=i;else{var u=i<.5?i*(1+e):i+e-i*e,c=2*i-u;n=l(c,u,r+1/3),s=l(c,u,r),o=l(c,u,r-1/3)}return{r:n*255,g:s*255,b:o*255}}function X5(r,e,i){r=Es(r,255),e=Es(e,255),i=Es(i,255);var n=Math.max(r,e,i),s=Math.min(r,e,i),o,l,u=n,c=n-s;if(l=n===0?0:c/n,n==s)o=0;else{switch(n){case r:o=(e-i)/c+(e<i?6:0);break;case e:o=(i-r)/c+2;break;case i:o=(r-e)/c+4;break}o/=6}return{h:o,s:l,v:u}}function Toe(r,e,i){r=Es(r,360)*6,e=Es(e,100),i=Es(i,100);var n=Math.floor(r),s=r-n,o=i*(1-e),l=i*(1-s*e),u=i*(1-(1-s)*e),c=n%6,h=[i,l,o,o,u,i][c],p=[u,i,i,l,o,o][c],f=[o,o,u,i,i,l][c];return{r:h*255,g:p*255,b:f*255}}function K5(r,e,i,n){var s=[dc(Math.round(r).toString(16)),dc(Math.round(e).toString(16)),dc(Math.round(i).toString(16))];return n&&s[0].charAt(0)==s[0].charAt(1)&&s[1].charAt(0)==s[1].charAt(1)&&s[2].charAt(0)==s[2].charAt(1)?s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0):s.join("")}function Moe(r,e,i,n,s){var o=[dc(Math.round(r).toString(16)),dc(Math.round(e).toString(16)),dc(Math.round(i).toString(16)),dc($5(n))];return s&&o[0].charAt(0)==o[0].charAt(1)&&o[1].charAt(0)==o[1].charAt(1)&&o[2].charAt(0)==o[2].charAt(1)&&o[3].charAt(0)==o[3].charAt(1)?o[0].charAt(0)+o[1].charAt(0)+o[2].charAt(0)+o[3].charAt(0):o.join("")}function Y5(r,e,i,n){var s=[dc($5(n)),dc(Math.round(r).toString(16)),dc(Math.round(e).toString(16)),dc(Math.round(i).toString(16))];return s.join("")}xr.equals=function(r,e){return!r||!e?!1:xr(r).toRgbString()==xr(e).toRgbString()},xr.random=function(){return xr.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})};function Roe(r,e){e=e===0?0:e||10;var i=xr(r).toHsl();return i.s-=e/100,i.s=o1(i.s),xr(i)}function Ioe(r,e){e=e===0?0:e||10;var i=xr(r).toHsl();return i.s+=e/100,i.s=o1(i.s),xr(i)}function Boe(r){return xr(r).desaturate(100)}function Noe(r,e){e=e===0?0:e||10;var i=xr(r).toHsl();return i.l+=e/100,i.l=o1(i.l),xr(i)}function Loe(r,e){e=e===0?0:e||10;var i=xr(r).toRgb();return i.r=Math.max(0,Math.min(255,i.r-Math.round(255*-(e/100)))),i.g=Math.max(0,Math.min(255,i.g-Math.round(255*-(e/100)))),i.b=Math.max(0,Math.min(255,i.b-Math.round(255*-(e/100)))),xr(i)}function Doe(r,e){e=e===0?0:e||10;var i=xr(r).toHsl();return i.l-=e/100,i.l=o1(i.l),xr(i)}function Ooe(r,e){var i=xr(r).toHsl(),n=(i.h+e)%360;return i.h=n<0?360+n:n,xr(i)}function Poe(r){var e=xr(r).toHsl();return e.h=(e.h+180)%360,xr(e)}function J5(r,e){if(isNaN(e)||e<=0)throw new Error("Argument to polyad must be a positive number");for(var i=xr(r).toHsl(),n=[xr(r)],s=360/e,o=1;o<e;o++)n.push(xr({h:(i.h+o*s)%360,s:i.s,l:i.l}));return n}function koe(r){var e=xr(r).toHsl(),i=e.h;return[xr(r),xr({h:(i+72)%360,s:e.s,l:e.l}),xr({h:(i+216)%360,s:e.s,l:e.l})]}function Foe(r,e,i){e=e||6,i=i||30;var n=xr(r).toHsl(),s=360/i,o=[xr(r)];for(n.h=(n.h-(s*e>>1)+720)%360;--e;)n.h=(n.h+s)%360,o.push(xr(n));return o}function Uoe(r,e){e=e||6;for(var i=xr(r).toHsv(),n=i.h,s=i.s,o=i.v,l=[],u=1/e;e--;)l.push(xr({h:n,s,v:o})),o=(o+u)%1;return l}xr.mix=function(r,e,i){i=i===0?0:i||50;var n=xr(r).toRgb(),s=xr(e).toRgb(),o=i/100,l={r:(s.r-n.r)*o+n.r,g:(s.g-n.g)*o+n.g,b:(s.b-n.b)*o+n.b,a:(s.a-n.a)*o+n.a};return xr(l)},xr.readability=function(r,e){var i=xr(r),n=xr(e);return(Math.max(i.getLuminance(),n.getLuminance())+.05)/(Math.min(i.getLuminance(),n.getLuminance())+.05)},xr.isReadable=function(r,e,i){var n=xr.readability(r,e),s,o;switch(o=!1,s=Woe(i),s.level+s.size){case"AAsmall":case"AAAlarge":o=n>=4.5;break;case"AAlarge":o=n>=3;break;case"AAAsmall":o=n>=7;break}return o},xr.mostReadable=function(r,e,i){var n=null,s=0,o,l,u,c;i=i||{},l=i.includeFallbackColors,u=i.level,c=i.size;for(var h=0;h<e.length;h++)o=xr.readability(r,e[h]),o>s&&(s=o,n=xr(e[h]));return xr.isReadable(r,n,{level:u,size:c})||!l?n:(i.includeFallbackColors=!1,xr.mostReadable(r,["#fff","#000"],i))};var iM=xr.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},zoe=xr.hexNames=joe(iM);function joe(r){var e={};for(var i in r)r.hasOwnProperty(i)&&(e[r[i]]=i);return e}function Z5(r){return r=parseFloat(r),(isNaN(r)||r<0||r>1)&&(r=1),r}function Es(r,e){Goe(r)&&(r="100%");var i=Voe(r);return r=Math.min(e,Math.max(0,parseFloat(r))),i&&(r=parseInt(r*e,10)/100),Math.abs(r-e)<1e-6?1:r%e/parseFloat(e)}function o1(r){return Math.min(1,Math.max(0,r))}function fl(r){return parseInt(r,16)}function Goe(r){return typeof r=="string"&&r.indexOf(".")!=-1&&parseFloat(r)===1}function Voe(r){return typeof r=="string"&&r.indexOf("%")!=-1}function dc(r){return r.length==1?"0"+r:""+r}function XA(r){return r<=1&&(r=r*100+"%"),r}function $5(r){return Math.round(parseFloat(r)*255).toString(16)}function eF(r){return fl(r)/255}var pc=function(){var r="[-\\+]?\\d+%?",e="[-\\+]?\\d*\\.\\d+%?",i="(?:"+e+")|(?:"+r+")",n="[\\s|\\(]+("+i+")[,|\\s]+("+i+")[,|\\s]+("+i+")\\s*\\)?",s="[\\s|\\(]+("+i+")[,|\\s]+("+i+")[,|\\s]+("+i+")[,|\\s]+("+i+")\\s*\\)?";return{CSS_UNIT:new RegExp(i),rgb:new RegExp("rgb"+n),rgba:new RegExp("rgba"+s),hsl:new RegExp("hsl"+n),hsla:new RegExp("hsla"+s),hsv:new RegExp("hsv"+n),hsva:new RegExp("hsva"+s),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function Gu(r){return!!pc.CSS_UNIT.exec(r)}function Hoe(r){r=r.replace(_oe,"").replace(Eoe,"").toLowerCase();var e=!1;if(iM[r])r=iM[r],e=!0;else if(r=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var i;return(i=pc.rgb.exec(r))?{r:i[1],g:i[2],b:i[3]}:(i=pc.rgba.exec(r))?{r:i[1],g:i[2],b:i[3],a:i[4]}:(i=pc.hsl.exec(r))?{h:i[1],s:i[2],l:i[3]}:(i=pc.hsla.exec(r))?{h:i[1],s:i[2],l:i[3],a:i[4]}:(i=pc.hsv.exec(r))?{h:i[1],s:i[2],v:i[3]}:(i=pc.hsva.exec(r))?{h:i[1],s:i[2],v:i[3],a:i[4]}:(i=pc.hex8.exec(r))?{r:fl(i[1]),g:fl(i[2]),b:fl(i[3]),a:eF(i[4]),format:e?"name":"hex8"}:(i=pc.hex6.exec(r))?{r:fl(i[1]),g:fl(i[2]),b:fl(i[3]),format:e?"name":"hex"}:(i=pc.hex4.exec(r))?{r:fl(i[1]+""+i[1]),g:fl(i[2]+""+i[2]),b:fl(i[3]+""+i[3]),a:eF(i[4]+""+i[4]),format:e?"name":"hex8"}:(i=pc.hex3.exec(r))?{r:fl(i[1]+""+i[1]),g:fl(i[2]+""+i[2]),b:fl(i[3]+""+i[3]),format:e?"name":"hex"}:!1}function Woe(r){var e,i;return r=r||{level:"AA",size:"small"},e=(r.level||"AA").toUpperCase(),i=(r.size||"small").toLowerCase(),e!=="AA"&&e!=="AAA"&&(e="AA"),i!=="small"&&i!=="large"&&(i="small"),{level:e,size:i}}function rM(r,e){(e==null||e>r.length)&&(e=r.length);for(var i=0,n=Array(e);i<e;i++)n[i]=r[i];return n}function Qoe(r){if(Array.isArray(r))return r}function qoe(r){if(Array.isArray(r))return rM(r)}function Xoe(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function Koe(r,e,i){return e=l1(e),sle(r,sM()?Reflect.construct(e,i||[],l1(r).constructor):e.apply(r,i))}function Yoe(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function tF(r,e,i){if(sM())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,e);var s=new(r.bind.apply(r,n));return s}function Joe(r,e,i){return Object.defineProperty(r,"prototype",{writable:!1}),r}function nM(r,e,i){return(e=ole(e))in r?Object.defineProperty(r,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[e]=i,r}function l1(r){return l1=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},l1(r)}function Zoe(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),e&&aM(r,e)}function sM(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(sM=function(){return!!r})()}function $oe(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function ele(r,e){var i=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(i!=null){var n,s,o,l,u=[],c=!0,h=!1;try{if(o=(i=i.call(r)).next,e!==0)for(;!(c=(n=o.call(i)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(p){h=!0,s=p}finally{try{if(!c&&i.return!=null&&(l=i.return(),Object(l)!==l))return}finally{if(h)throw s}}return u}}function tle(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ile(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function iF(r,e){var i=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),i.push.apply(i,n)}return i}function rF(r){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?iF(Object(i),!0).forEach(function(n){nM(r,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):iF(Object(i)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(i,n))})}return r}function rle(r,e){if(r==null)return{};var i,n,s=nle(r,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(r);for(n=0;n<o.length;n++)i=o[n],e.includes(i)||{}.propertyIsEnumerable.call(r,i)&&(s[i]=r[i])}return s}function nle(r,e){if(r==null)return{};var i={};for(var n in r)if({}.hasOwnProperty.call(r,n)){if(e.includes(n))continue;i[n]=r[n]}return i}function sle(r,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Xoe(r)}function aM(r,e){return aM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,n){return i.__proto__=n,i},aM(r,e)}function nF(r,e){return Qoe(r)||ele(r,e)||sF(r,e)||tle()}function fc(r){return qoe(r)||$oe(r)||sF(r)||ile()}function ale(r,e){if(typeof r!="object"||!r)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var n=i.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function ole(r){var e=ale(r,"string");return typeof e=="symbol"?e:e+""}function oM(r){"@babel/helpers - typeof";return oM=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},oM(r)}function sF(r,e){if(r){if(typeof r=="string")return rM(r,e);var i={}.toString.call(r).slice(8,-1);return i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set"?Array.from(r):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?rM(r,e):void 0}}var aF=function(r){r instanceof Array?r.forEach(aF):(r.map&&r.map.dispose(),r.dispose())},oF=function(r){r.geometry&&r.geometry.dispose(),r.material&&aF(r.material),r.texture&&r.texture.dispose(),r.children&&r.children.forEach(oF)},lM=function(r){for(;r.children.length;){var e=r.children[0];r.remove(e),oF(e)}},lle=["objFilter"];function KA(r,e){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=i.objFilter,s=n===void 0?function(){return!0}:n,o=rle(i,lle);return qae(r,e.children.filter(s),function(l){return e.add(l)},function(l){e.remove(l),lM(l)},rF({objBindAttr:"__threeObj"},o))}var YA=function(r){return isNaN(r)?parseInt(xr(r).toHex(),16):r},cM=function(r){return isNaN(r)?xr(r).getAlpha():1},cle=YT(Q5);function lF(r,e,i){!e||typeof i!="string"||r.filter(function(n){return!n[i]}).forEach(function(n){n[i]=cle(e(n))})}function ule(r,e){var i=r.nodes,n=r.links,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=s.nodeFilter,l=o===void 0?function(){return!0}:o,u=s.onLoopError,c=u===void 0?function(m){throw"Invalid DAG structure! Found cycle in node path: ".concat(m.join(" -> "),".")}:u,h={};i.forEach(function(m){return h[e(m)]={data:m,out:[],depth:-1,skip:!l(m)}}),n.forEach(function(m){var y=m.source,b=m.target,v=T(y),_=T(b);if(!h.hasOwnProperty(v))throw"Missing source node with id: ".concat(v);if(!h.hasOwnProperty(_))throw"Missing target node with id: ".concat(_);var C=h[v],E=h[_];C.out.push(E);function T(R){return oM(R)==="object"?e(R):R}});var p=[];g(Object.values(h));var f=Object.assign.apply(Object,[{}].concat(fc(Object.entries(h).filter(function(m){var y=nF(m,2),b=y[1];return!b.skip}).map(function(m){var y=nF(m,2),b=y[0],v=y[1];return nM({},b,v.depth)}))));return f;function g(m){for(var y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,v=function(){var E=m[_];if(y.indexOf(E)!==-1){var T=[].concat(fc(y.slice(y.indexOf(E))),[E]).map(function(R){return e(R.data)});return p.some(function(R){return R.length===T.length&&R.every(function(B,I){return B===T[I]})})||(p.push(T),c(T)),1}b>E.depth&&(E.depth=b,g(E.out,[].concat(fc(y),[E]),b+(E.skip?0:1)))},_=0,C=m.length;_<C;_++)v()}}var Or=window.THREE?window.THREE:{Group:Wm,Mesh:za,MeshLambertMaterial:Tre,Color:Sn,BufferGeometry:Vo,BufferAttribute:Go,Matrix4:gs,Vector3:ot,SphereGeometry:Hx,CylinderGeometry:Vx,TubeGeometry:ET,ConeGeometry:_T,Line:ok,LineBasicMaterial:mT,QuadraticBezierCurve3:xT,CubicBezierCurve3:uk,Box3:Ap},cF={graph:nse,forcelayout:Fse},hle=2,uM=new Or.BufferGeometry().setAttribute?"setAttribute":"addAttribute",c1=new Or.BufferGeometry().applyMatrix4?"applyMatrix4":"applyMatrix",dle=Rp({props:{jsonUrl:{onChange:function(r,e){var i=this;r&&!e.fetchingJson&&(e.fetchingJson=!0,e.onLoading(),fetch(r).then(function(n){return n.json()}).then(function(n){e.fetchingJson=!1,e.onFinishLoading(n),i.graphData(n)}))},triggerUpdate:!1},graphData:{default:{nodes:[],links:[]},onChange:function(r,e){e.engineRunning=!1}},numDimensions:{default:3,onChange:function(r,e){var i=e.d3ForceLayout.force("charge");i&&i.strength(r>2?-60:-30),r<3&&n(e.graphData.nodes,"z"),r<2&&n(e.graphData.nodes,"y");function n(s,o){s.forEach(function(l){delete l[o],delete l["v".concat(o)]})}}},dagMode:{onChange:function(r,e){!r&&e.forceEngine==="d3"&&(e.graphData.nodes||[]).forEach(function(i){return i.fx=i.fy=i.fz=void 0})}},dagLevelDistance:{},dagNodeFilter:{default:function(r){return!0}},onDagError:{triggerUpdate:!1},nodeRelSize:{default:4},nodeId:{default:"id"},nodeVal:{default:"val"},nodeResolution:{default:8},nodeColor:{default:"color"},nodeAutoColorBy:{},nodeOpacity:{default:.75},nodeVisibility:{default:!0},nodeThreeObject:{},nodeThreeObjectExtend:{default:!1},nodePositionUpdate:{triggerUpdate:!1},linkSource:{default:"source"},linkTarget:{default:"target"},linkVisibility:{default:!0},linkColor:{default:"color"},linkAutoColorBy:{},linkOpacity:{default:.2},linkWidth:{},linkResolution:{default:6},linkCurvature:{default:0,triggerUpdate:!1},linkCurveRotation:{default:0,triggerUpdate:!1},linkMaterial:{},linkThreeObject:{},linkThreeObjectExtend:{default:!1},linkPositionUpdate:{triggerUpdate:!1},linkDirectionalArrowLength:{default:0},linkDirectionalArrowColor:{},linkDirectionalArrowRelPos:{default:.5,triggerUpdate:!1},linkDirectionalArrowResolution:{default:8},linkDirectionalParticles:{default:0},linkDirectionalParticleSpeed:{default:.01,triggerUpdate:!1},linkDirectionalParticleWidth:{default:.5},linkDirectionalParticleColor:{},linkDirectionalParticleResolution:{default:4},forceEngine:{default:"d3"},d3AlphaMin:{default:0},d3AlphaDecay:{default:.0228,triggerUpdate:!1,onChange:function(r,e){e.d3ForceLayout.alphaDecay(r)}},d3AlphaTarget:{default:0,triggerUpdate:!1,onChange:function(r,e){e.d3ForceLayout.alphaTarget(r)}},d3VelocityDecay:{default:.4,triggerUpdate:!1,onChange:function(r,e){e.d3ForceLayout.velocityDecay(r)}},ngraphPhysics:{default:{timeStep:20,gravity:-1.2,theta:.8,springLength:30,springCoefficient:8e-4,dragCoefficient:.02}},warmupTicks:{default:0,triggerUpdate:!1},cooldownTicks:{default:1/0,triggerUpdate:!1},cooldownTime:{default:15e3,triggerUpdate:!1},onLoading:{default:function(){},triggerUpdate:!1},onFinishLoading:{default:function(){},triggerUpdate:!1},onUpdate:{default:function(){},triggerUpdate:!1},onFinishUpdate:{default:function(){},triggerUpdate:!1},onEngineTick:{default:function(){},triggerUpdate:!1},onEngineStop:{default:function(){},triggerUpdate:!1}},methods:{refresh:function(r){return r._flushObjects=!0,r._rerender(),this},d3Force:function(r,e,i){return i===void 0?r.d3ForceLayout.force(e):(r.d3ForceLayout.force(e,i),this)},d3ReheatSimulation:function(r){return r.d3ForceLayout.alpha(1),this.resetCountdown(),this},resetCountdown:function(r){return r.cntTicks=0,r.startTickTime=new Date,r.engineRunning=!0,this},tickFrame:function(r){var e=r.forceEngine!=="ngraph";return r.engineRunning&&i(),n(),s(),this;function i(){++r.cntTicks>r.cooldownTicks||new Date-r.startTickTime>r.cooldownTime||e&&r.d3AlphaMin>0&&r.d3ForceLayout.alpha()<r.d3AlphaMin?(r.engineRunning=!1,r.onEngineStop()):(r.layout[e?"tick":"step"](),r.onEngineTick());var o=gr(r.nodeThreeObjectExtend);r.graphData.nodes.forEach(function(f){var g=f.__threeObj;if(g){var m=e?f:r.layout.getNodePosition(f[r.nodeId]),y=o(f);(!r.nodePositionUpdate||!r.nodePositionUpdate(y?g.children[0]:g,{x:m.x,y:m.y,z:m.z},f)||y)&&(g.position.x=m.x,g.position.y=m.y||0,g.position.z=m.z||0)}});var l=gr(r.linkWidth),u=gr(r.linkCurvature),c=gr(r.linkCurveRotation),h=gr(r.linkThreeObjectExtend);r.graphData.links.forEach(function(f){var g=f.__lineObj;if(g){var m=e?f:r.layout.getLinkPosition(r.layout.graph.getLink(f.source,f.target).id),y=m[e?"source":"from"],b=m[e?"target":"to"];if(!(!y||!b||!y.hasOwnProperty("x")||!b.hasOwnProperty("x"))){p(f);var v=h(f);if(!(r.linkPositionUpdate&&r.linkPositionUpdate(v?g.children[1]:g,{start:{x:y.x,y:y.y,z:y.z},end:{x:b.x,y:b.y,z:b.z}},f)&&!v)){var _=30,C=f.__curve,E=g.children.length?g.children[0]:g;if(E.type==="Line"){if(C){var T=C.getPoints(_);E.geometry.getAttribute("position").array.length!==T.length*3&&E.geometry[uM]("position",new Or.BufferAttribute(new Float32Array(T.length*3),3)),E.geometry.setFromPoints(T)}else{var R=E.geometry.getAttribute("position");(!R||!R.array||R.array.length!==6)&&E.geometry[uM]("position",R=new Or.BufferAttribute(new Float32Array(2*3),3)),R.array[0]=y.x,R.array[1]=y.y||0,R.array[2]=y.z||0,R.array[3]=b.x,R.array[4]=b.y||0,R.array[5]=b.z||0,R.needsUpdate=!0}E.geometry.computeBoundingSphere()}else if(E.type==="Mesh")if(C){E.geometry.type.match(/^Tube(Buffer)?Geometry$/)||(E.position.set(0,0,0),E.rotation.set(0,0,0),E.scale.set(1,1,1));var B=Math.ceil(l(f)*10)/10,I=B/2,D=new Or.TubeGeometry(C,_,I,r.linkResolution,!1);E.geometry.dispose(),E.geometry=D}else{if(!E.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)){var L=Math.ceil(l(f)*10)/10,O=L/2,F=new Or.CylinderGeometry(O,O,1,r.linkResolution,1,!1);F[c1](new Or.Matrix4().makeTranslation(0,1/2,0)),F[c1](new Or.Matrix4().makeRotationX(Math.PI/2)),E.geometry.dispose(),E.geometry=F}var q=new Or.Vector3(y.x,y.y||0,y.z||0),H=new Or.Vector3(b.x,b.y||0,b.z||0),G=q.distanceTo(H);E.position.x=q.x,E.position.y=q.y,E.position.z=q.z,E.scale.z=G,E.parent.localToWorld(H),E.lookAt(H)}}}}});function p(f){var g=e?f:r.layout.getLinkPosition(r.layout.graph.getLink(f.source,f.target).id),m=g[e?"source":"from"],y=g[e?"target":"to"];if(!(!m||!y||!m.hasOwnProperty("x")||!y.hasOwnProperty("x"))){var b=u(f);if(!b)f.__curve=null;else{var v=new Or.Vector3(m.x,m.y||0,m.z||0),_=new Or.Vector3(y.x,y.y||0,y.z||0),C=v.distanceTo(_),E,T=c(f);if(C>0){var R=y.x-m.x,B=y.y-m.y||0,I=new Or.Vector3().subVectors(_,v),D=I.clone().multiplyScalar(b).cross(R!==0||B!==0?new Or.Vector3(0,0,1):new Or.Vector3(0,1,0)).applyAxisAngle(I.normalize(),T).add(new Or.Vector3().addVectors(v,_).divideScalar(2));E=new Or.QuadraticBezierCurve3(v,D,_)}else{var L=b*70,O=-T,F=O+Math.PI/2;E=new Or.CubicBezierCurve3(v,new Or.Vector3(L*Math.cos(F),L*Math.sin(F),0).add(v),new Or.Vector3(L*Math.cos(O),L*Math.sin(O),0).add(v),_)}f.__curve=E}}}}function n(){var o=gr(r.linkDirectionalArrowRelPos),l=gr(r.linkDirectionalArrowLength),u=gr(r.nodeVal);r.graphData.links.forEach(function(c){var h=c.__arrowObj;if(h){var p=e?c:r.layout.getLinkPosition(r.layout.graph.getLink(c.source,c.target).id),f=p[e?"source":"from"],g=p[e?"target":"to"];if(!(!f||!g||!f.hasOwnProperty("x")||!g.hasOwnProperty("x"))){var m=Math.cbrt(Math.max(0,u(f)||1))*r.nodeRelSize,y=Math.cbrt(Math.max(0,u(g)||1))*r.nodeRelSize,b=l(c),v=o(c),_=c.__curve?function(I){return c.__curve.getPoint(I)}:function(I){var D=function(L,O,F,q){return O[L]+(F[L]-O[L])*q||0};return{x:D("x",f,g,I),y:D("y",f,g,I),z:D("z",f,g,I)}},C=c.__curve?c.__curve.getLength():Math.sqrt(["x","y","z"].map(function(I){return Math.pow((g[I]||0)-(f[I]||0),2)}).reduce(function(I,D){return I+D},0)),E=m+b+(C-m-y-b)*v,T=_(E/C),R=_((E-b)/C);["x","y","z"].forEach(function(I){return h.position[I]=R[I]});var B=tF(Or.Vector3,fc(["x","y","z"].map(function(I){return T[I]})));h.parent.localToWorld(B),h.lookAt(B)}}})}function s(){var o=gr(r.linkDirectionalParticleSpeed);r.graphData.links.forEach(function(l){var u=l.__photonsObj&&l.__photonsObj.children,c=l.__singleHopPhotonsObj&&l.__singleHopPhotonsObj.children;if(!((!c||!c.length)&&(!u||!u.length))){var h=e?l:r.layout.getLinkPosition(r.layout.graph.getLink(l.source,l.target).id),p=h[e?"source":"from"],f=h[e?"target":"to"];if(!(!p||!f||!p.hasOwnProperty("x")||!f.hasOwnProperty("x"))){var g=o(l),m=l.__curve?function(b){return l.__curve.getPoint(b)}:function(b){var v=function(_,C,E,T){return C[_]+(E[_]-C[_])*T||0};return{x:v("x",p,f,b),y:v("y",p,f,b),z:v("z",p,f,b)}},y=[].concat(fc(u||[]),fc(c||[]));y.forEach(function(b,v){var _=b.parent.__linkThreeObjType==="singleHopPhotons";if(b.hasOwnProperty("__progressRatio")||(b.__progressRatio=_?0:v/u.length),b.__progressRatio+=g,b.__progressRatio>=1)if(!_)b.__progressRatio=b.__progressRatio%1;else{b.parent.remove(b),lM(b);return}var C=b.__progressRatio,E=m(C);["x","y","z"].forEach(function(T){return b.position[T]=E[T]})})}}})}},emitParticle:function(r,e){if(e&&r.graphData.links.includes(e)){if(!e.__singleHopPhotonsObj){var i=new Or.Group;i.__linkThreeObjType="singleHopPhotons",e.__singleHopPhotonsObj=i,r.graphScene.add(i)}var n=gr(r.linkDirectionalParticleWidth),s=Math.ceil(n(e)*10)/10/2,o=r.linkDirectionalParticleResolution,l=new Or.SphereGeometry(s,o,o),u=gr(r.linkColor),c=gr(r.linkDirectionalParticleColor),h=c(e)||u(e)||"#f0f0f0",p=new Or.Color(YA(h)),f=r.linkOpacity*3,g=new Or.MeshLambertMaterial({color:p,transparent:!0,opacity:f});e.__singleHopPhotonsObj.add(new Or.Mesh(l,g))}return this},getGraphBbox:function(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return!0};if(!r.initialised)return null;var i=function n(s){var o=[];if(s.geometry){s.geometry.computeBoundingBox();var l=new Or.Box3;l.copy(s.geometry.boundingBox).applyMatrix4(s.matrixWorld),o.push(l)}return o.concat.apply(o,fc((s.children||[]).filter(function(u){return!u.hasOwnProperty("__graphObjType")||u.__graphObjType==="node"&&e(u.__data)}).map(n)))}(r.graphScene);return i.length?Object.assign.apply(Object,fc(["x","y","z"].map(function(n){return nM({},n,[QT(i,function(s){return s.min[n]}),WT(i,function(s){return s.max[n]})])}))):null}},stateInit:function(){return{d3ForceLayout:Gk().force("link",Lk()).force("charge",Vk()).force("center",_k()).force("dagRadial",null).stop(),engineRunning:!1}},init:function(r,e){e.graphScene=r},update:function(r,e){var i=function(_e){return _e.some(function(me){return e.hasOwnProperty(me)})};if(r.engineRunning=!1,r.onUpdate(),r.nodeAutoColorBy!==null&&i(["nodeAutoColorBy","graphData","nodeColor"])&&lF(r.graphData.nodes,gr(r.nodeAutoColorBy),r.nodeColor),r.linkAutoColorBy!==null&&i(["linkAutoColorBy","graphData","linkColor"])&&lF(r.graphData.links,gr(r.linkAutoColorBy),r.linkColor),r._flushObjects||i(["graphData","nodeThreeObject","nodeThreeObjectExtend","nodeVal","nodeColor","nodeVisibility","nodeRelSize","nodeResolution","nodeOpacity"])){var n=gr(r.nodeThreeObject),s=gr(r.nodeThreeObjectExtend),o=gr(r.nodeVal),l=gr(r.nodeColor),u=gr(r.nodeVisibility),c={},h={};KA(r.graphData.nodes.filter(u),r.graphScene,{purge:r._flushObjects||i(["nodeThreeObject","nodeThreeObjectExtend"]),objFilter:function(_e){return _e.__graphObjType==="node"},createObj:function(_e){var me=n(_e),Pe=s(_e);me&&r.nodeThreeObject===me&&(me=me.clone());var Xe;return me&&!Pe?Xe=me:(Xe=new Or.Mesh,Xe.__graphDefaultObj=!0,me&&Pe&&Xe.add(me)),Xe.__graphObjType="node",Xe},updateObj:function(_e,me){if(_e.__graphDefaultObj){var Pe=o(me)||1,Xe=Math.cbrt(Pe)*r.nodeRelSize,Je=r.nodeResolution;(!_e.geometry.type.match(/^Sphere(Buffer)?Geometry$/)||_e.geometry.parameters.radius!==Xe||_e.geometry.parameters.widthSegments!==Je)&&(c.hasOwnProperty(Pe)||(c[Pe]=new Or.SphereGeometry(Xe,Je,Je)),_e.geometry.dispose(),_e.geometry=c[Pe]);var tt=l(me),dt=new Or.Color(YA(tt||"#ffffaa")),wt=r.nodeOpacity*cM(tt);(_e.material.type!=="MeshLambertMaterial"||!_e.material.color.equals(dt)||_e.material.opacity!==wt)&&(h.hasOwnProperty(tt)||(h[tt]=new Or.MeshLambertMaterial({color:dt,transparent:!0,opacity:wt})),_e.material.dispose(),_e.material=h[tt])}}})}if(r._flushObjects||i(["graphData","linkThreeObject","linkThreeObjectExtend","linkMaterial","linkColor","linkWidth","linkVisibility","linkResolution","linkOpacity","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution"])){var p=gr(r.linkThreeObject),f=gr(r.linkThreeObjectExtend),g=gr(r.linkMaterial),m=gr(r.linkVisibility),y=gr(r.linkColor),b=gr(r.linkWidth),v={},_={},C={},E=r.graphData.links.filter(m);if(KA(E,r.graphScene,{objBindAttr:"__lineObj",purge:r._flushObjects||i(["linkThreeObject","linkThreeObjectExtend","linkWidth"]),objFilter:function(_e){return _e.__graphObjType==="link"},exitObj:function(_e){var me=_e.__data&&_e.__data.__singleHopPhotonsObj;me&&(me.parent.remove(me),lM(me),delete _e.__data.__singleHopPhotonsObj)},createObj:function(_e){var me=p(_e),Pe=f(_e);me&&r.linkThreeObject===me&&(me=me.clone());var Xe;if(!me||Pe){var Je=!!b(_e);if(Je)Xe=new Or.Mesh;else{var tt=new Or.BufferGeometry;tt[uM]("position",new Or.BufferAttribute(new Float32Array(2*3),3)),Xe=new Or.Line(tt)}}var dt;return me?Pe?(dt=new Or.Group,dt.__graphDefaultObj=!0,dt.add(Xe),dt.add(me)):dt=me:(dt=Xe,dt.__graphDefaultObj=!0),dt.renderOrder=10,dt.__graphObjType="link",dt},updateObj:function(_e,me){if(_e.__graphDefaultObj){var Pe=_e.children.length?_e.children[0]:_e,Xe=Math.ceil(b(me)*10)/10,Je=!!Xe;if(Je){var tt=Xe/2,dt=r.linkResolution;if(!Pe.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)||Pe.geometry.parameters.radiusTop!==tt||Pe.geometry.parameters.radialSegments!==dt){if(!v.hasOwnProperty(Xe)){var wt=new Or.CylinderGeometry(tt,tt,1,dt,1,!1);wt[c1](new Or.Matrix4().makeTranslation(0,1/2,0)),wt[c1](new Or.Matrix4().makeRotationX(Math.PI/2)),v[Xe]=wt}Pe.geometry.dispose(),Pe.geometry=v[Xe]}}var qt=g(me);if(qt)Pe.material=qt;else{var yt=y(me),Ei=new Or.Color(YA(yt||"#f0f0f0")),$e=r.linkOpacity*cM(yt),Ui=Je?"MeshLambertMaterial":"LineBasicMaterial";if(Pe.material.type!==Ui||!Pe.material.color.equals(Ei)||Pe.material.opacity!==$e){var hi=Je?_:C;hi.hasOwnProperty(yt)||(hi[yt]=new Or[Ui]({color:Ei,transparent:$e<1,opacity:$e,depthWrite:$e>=1})),Pe.material.dispose(),Pe.material=hi[yt]}}}}}),r.linkDirectionalArrowLength||e.hasOwnProperty("linkDirectionalArrowLength")){var T=gr(r.linkDirectionalArrowLength),R=gr(r.linkDirectionalArrowColor);KA(E.filter(T),r.graphScene,{objBindAttr:"__arrowObj",objFilter:function(_e){return _e.__linkThreeObjType==="arrow"},createObj:function(){var _e=new Or.Mesh(void 0,new Or.MeshLambertMaterial({transparent:!0}));return _e.__linkThreeObjType="arrow",_e},updateObj:function(_e,me){var Pe=T(me),Xe=r.linkDirectionalArrowResolution;if(!_e.geometry.type.match(/^Cone(Buffer)?Geometry$/)||_e.geometry.parameters.height!==Pe||_e.geometry.parameters.radialSegments!==Xe){var Je=new Or.ConeGeometry(Pe*.25,Pe,Xe);Je.translate(0,Pe/2,0),Je.rotateX(Math.PI/2),_e.geometry.dispose(),_e.geometry=Je}var tt=R(me)||y(me)||"#f0f0f0";_e.material.color=new Or.Color(YA(tt)),_e.material.opacity=r.linkOpacity*3*cM(tt)}})}if(r.linkDirectionalParticles||e.hasOwnProperty("linkDirectionalParticles")){var B=gr(r.linkDirectionalParticles),I=gr(r.linkDirectionalParticleWidth),D=gr(r.linkDirectionalParticleColor),L={},O={};KA(E.filter(B),r.graphScene,{objBindAttr:"__photonsObj",objFilter:function(_e){return _e.__linkThreeObjType==="photons"},createObj:function(){var _e=new Or.Group;return _e.__linkThreeObjType="photons",_e},updateObj:function(_e,me){var Pe=Math.round(Math.abs(B(me))),Xe=!!_e.children.length&&_e.children[0],Je=Math.ceil(I(me)*10)/10/2,tt=r.linkDirectionalParticleResolution,dt;Xe&&Xe.geometry.parameters.radius===Je&&Xe.geometry.parameters.widthSegments===tt?dt=Xe.geometry:(O.hasOwnProperty(Je)||(O[Je]=new Or.SphereGeometry(Je,tt,tt)),dt=O[Je],Xe&&Xe.geometry.dispose());var wt=D(me)||y(me)||"#f0f0f0",qt=new Or.Color(YA(wt)),yt=r.linkOpacity*3,Ei;Xe&&Xe.material.color.equals(qt)&&Xe.material.opacity===yt?Ei=Xe.material:(L.hasOwnProperty(wt)||(L[wt]=new Or.MeshLambertMaterial({color:qt,transparent:!0,opacity:yt})),Ei=L[wt],Xe&&Xe.material.dispose()),KA(fc(new Array(Pe)).map(function($e,Ui){return{idx:Ui}}),_e,{idAccessor:function($e){return $e.idx},createObj:function(){return new Or.Mesh(dt,Ei)},updateObj:function($e){$e.geometry=dt,$e.material=Ei}})}})}}if(r._flushObjects=!1,i(["graphData","nodeId","linkSource","linkTarget","numDimensions","forceEngine","dagMode","dagNodeFilter","dagLevelDistance"])){r.engineRunning=!1,r.graphData.links.forEach(function(_e){_e.source=_e[r.linkSource],_e.target=_e[r.linkTarget]});var F=r.forceEngine!=="ngraph",q;if(F){(q=r.d3ForceLayout).stop().alpha(1).numDimensions(r.numDimensions).nodes(r.graphData.nodes);var H=r.d3ForceLayout.force("link");H&&H.id(function(_e){return _e[r.nodeId]}).links(r.graphData.links);var G=r.dagMode&&ule(r.graphData,function(_e){return _e[r.nodeId]},{nodeFilter:r.dagNodeFilter,onLoopError:r.onDagError||void 0}),J=Math.max.apply(Math,fc(Object.values(G||[]))),Q=r.dagLevelDistance||r.graphData.nodes.length/(J||1)*hle*(["radialin","radialout"].indexOf(r.dagMode)!==-1?.7:1);if(["lr","rl","td","bu","zin","zout"].includes(e.dagMode)){var V=["lr","rl"].includes(e.dagMode)?"fx":["td","bu"].includes(e.dagMode)?"fy":"fz";r.graphData.nodes.filter(r.dagNodeFilter).forEach(function(_e){return delete _e[V]})}if(["lr","rl","td","bu","zin","zout"].includes(r.dagMode)){var z=["rl","td","zout"].includes(r.dagMode),te=function(_e){return(G[_e[r.nodeId]]-J/2)*Q*(z?-1:1)},K=["lr","rl"].includes(r.dagMode)?"fx":["td","bu"].includes(r.dagMode)?"fy":"fz";r.graphData.nodes.filter(r.dagNodeFilter).forEach(function(_e){return _e[K]=te(_e)})}r.d3ForceLayout.force("dagRadial",["radialin","radialout"].indexOf(r.dagMode)!==-1?Hk(function(_e){var me=G[_e[r.nodeId]]||-1;return(r.dagMode==="radialin"?J-me:me)*Q}).strength(function(_e){return r.dagNodeFilter(_e)?1:0}):null)}else{var ae=cF.graph();r.graphData.nodes.forEach(function(_e){ae.addNode(_e[r.nodeId])}),r.graphData.links.forEach(function(_e){ae.addLink(_e.source,_e.target)}),q=cF.forcelayout(ae,rF({dimensions:r.numDimensions},r.ngraphPhysics)),q.graph=ae}for(var Ae=0;Ae<r.warmupTicks&&!(F&&r.d3AlphaMin>0&&r.d3ForceLayout.alpha()<r.d3AlphaMin);Ae++)q[F?"tick":"step"]();r.layout=q,this.resetCountdown()}r.engineRunning=!0,r.onFinishUpdate()}});function ple(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Object,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=function(s){function o(){var l;Yoe(this,o);for(var u=arguments.length,c=new Array(u),h=0;h<u;h++)c[h]=arguments[h];return l=Koe(this,o,[].concat(c)),l.__kapsuleInstance=tF(r,[].concat(fc(i?[l]:[]),c)),l}return Zoe(o,s),Joe(o)}(e);return Object.keys(r()).forEach(function(s){return n.prototype[s]=function(){var o,l=(o=this.__kapsuleInstance)[s].apply(o,arguments);return l===this.__kapsuleInstance?this:l}}),n}var fle=window.THREE?window.THREE:{Group:Wm},hM=ple(dle,fle.Group,!0);const mle=Object.freeze(Object.defineProperty({__proto__:null,default:hM},Symbol.toStringTag,{value:"Module"})),gle=O2(mle);if(typeof AFRAME>"u")throw new Error("Component attempted to register before AFRAME was available.");let dM=Gre;"default"in dM&&(dM=dM.default);let Np=gle;"default"in Np&&(Np=Np.default);const pM=function(r){return typeof r=="string"?JSON.parse(r):r},mc=function(r){if(typeof r=="function")return r;const e=eval;try{return e("("+r+")")}catch{}return null},Os=function(r){return isNaN(parseFloat(r))?mc(r)?mc(r):r:parseFloat(r)};AFRAME.registerComponent("forcegraph",{schema:{jsonUrl:{type:"string",default:""},nodes:{parse:pM,default:[]},links:{parse:pM,default:[]},numDimensions:{type:"number",default:3},dagMode:{type:"string",default:""},dagLevelDistance:{type:"number",default:0},dagNodeFilter:{parse:mc,default:function(){return!0}},onDagError:{parse:mc,default:void 0},nodeRelSize:{type:"number",default:4},nodeId:{type:"string",default:"id"},nodeVal:{parse:Os,default:"val"},nodeResolution:{type:"number",default:8},nodeVisibility:{parse:Os,default:!0},nodeColor:{parse:Os,default:"color"},nodeAutoColorBy:{parse:Os,default:""},nodeOpacity:{type:"number",default:.75},nodeThreeObject:{parse:Os,default:null},nodeThreeObjectExtend:{parse:Os,default:!1},linkSource:{type:"string",default:"source"},linkTarget:{type:"string",default:"target"},linkVisibility:{parse:Os,default:!0},linkColor:{parse:Os,default:"color"},linkAutoColorBy:{parse:Os,default:""},linkOpacity:{type:"number",default:.2},linkWidth:{parse:Os,default:0},linkResolution:{type:"number",default:6},linkCurvature:{parse:Os,default:0},linkCurveRotation:{parse:Os,default:0},linkMaterial:{parse:Os,default:null},linkThreeObject:{parse:Os,default:null},linkThreeObjectExtend:{parse:Os,default:!1},linkPositionUpdate:{parse:mc,default:null},linkDirectionalArrowLength:{parse:Os,default:0},linkDirectionalArrowColor:{parse:Os,default:null},linkDirectionalArrowRelPos:{parse:Os,default:.5},linkDirectionalArrowResolution:{type:"number",default:8},linkDirectionalParticles:{parse:Os,default:0},linkDirectionalParticleSpeed:{parse:Os,default:.01},linkDirectionalParticleWidth:{parse:Os,default:.5},linkDirectionalParticleColor:{parse:Os,default:null},linkDirectionalParticleResolution:{type:"number",default:4},onNodeHover:{parse:mc,default:()=>{}},onLinkHover:{parse:mc,default:()=>{}},onNodeClick:{parse:mc,default:()=>{}},onLinkClick:{parse:mc,default:()=>{}},forceEngine:{type:"string",default:"d3"},d3AlphaMin:{type:"number",default:0},d3AlphaDecay:{type:"number",default:.0228},d3VelocityDecay:{type:"number",default:.4},ngraphPhysics:{parse:pM,default:null},warmupTicks:{type:"int",default:0},cooldownTicks:{type:"int",default:1e18},cooldownTime:{type:"int",default:15e3},onEngineTick:{parse:mc,default:function(){}},onEngineStop:{parse:mc,default:function(){}}},getGraphBbox:function(r){return this.forceGraph||(this.forceGraph=new Np),this.forceGraph.getGraphBbox(r)},emitParticle:function(){this.forceGraph||(this.forceGraph=new Np);const r=this.forceGraph,e=r.emitParticle.apply(r,arguments);return e===r?this:e},d3Force:function(){this.forceGraph||(this.forceGraph=new Np);const r=this.forceGraph,e=r.d3Force.apply(r,arguments);return e===r?this:e},d3ReheatSimulation:function(){return this.forceGraph&&this.forceGraph.d3ReheatSimulation(),this},refresh:function(){return this.forceGraph&&this.forceGraph.refresh(),this},init:function(){const r=this.state={};r.infoEl=document.createElement("a-text"),r.infoEl.setAttribute("position","0 -0.1 -1"),r.infoEl.setAttribute("width",1),r.infoEl.setAttribute("align","center"),r.infoEl.setAttribute("color","lavender");const e=document.querySelector("a-entity[camera], a-camera");e.appendChild(r.infoEl),r.cameraObj=e.object3D.children.filter(function(i){return i.type==="PerspectiveCamera"})[0],this.el.sceneEl.addEventListener("camera-set-active",function(i){r.cameraObj=i.detail.cameraEl.components.camera.camera}),this.forceGraph||(this.forceGraph=new Np),this.forceGraph.onFinishUpdate(()=>this.el.setObject3D("forcegraphGroup",this.forceGraph)).onLoading(()=>r.infoEl.setAttribute("value","Loading...")).onFinishLoading(()=>r.infoEl.setAttribute("value","")),this.el.addEventListener("raycaster-intersected",i=>r.hoverDetail=i.detail),this.el.addEventListener("raycaster-intersected-cleared",i=>r.hoverDetail=i.detail),this.el.addEventListener("click",()=>r.hoverObj&&this.data["on"+(r.hoverObj.__graphObjType==="node"?"Node":"Link")+"Click"](r.hoverObj.__data))},remove:function(){this.state.infoEl.remove(),this.el.removeObject3D("forcegraphGroup")},update:function(r){const e=this,i=this.data,n=AFRAME.utils.diff(i,r);["jsonUrl","numDimensions","dagMode","dagLevelDistance","dagNodeFilter","onDagError","nodeRelSize","nodeId","nodeVal","nodeResolution","nodeVisibility","nodeColor","nodeAutoColorBy","nodeOpacity","nodeThreeObject","nodeThreeObjectExtend","linkSource","linkTarget","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","forceEngine","d3AlphaMin","d3AphaDecay","d3VelocityDecay","ngraphPhysics","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"].filter(function(s){return s in n}).forEach(function(s){e.forceGraph[s](i[s]!==""?i[s]:null)}),("nodes"in n||"links"in n)&&e.forceGraph.graphData({nodes:i.nodes,links:i.links})},tick:function(r,e){const i=this.state,n=this.data,s=i.hoverDetail?i.hoverDetail.getIntersection?i.hoverDetail.getIntersection(this.el):i.hoverDetail.intersection||void 0:void 0;let o=s?s.object:void 0;for(;o&&!o.hasOwnProperty("__graphObjType");)o=o.parent;if(o!==i.hoverObj){const l=i.hoverObj?i.hoverObj.__graphObjType:null,u=i.hoverObj?i.hoverObj.__data:null,c=o?o.__graphObjType:null,h=o?o.__data:null;l&&l!==c&&n["on"+(l==="node"?"Node":"Link")+"Hover"](null,u),c&&n["on"+(c==="node"?"Node":"Link")+"Hover"](h,l===c?u:null),i.hoverObj=o}this.forceGraph.tickFrame()}});function Qo(){return Qo=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(r[n]=i[n])}return r},Qo.apply(null,arguments)}function Ale(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function JA(r,e){return JA=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,n){return i.__proto__=n,i},JA(r,e)}function yle(r,e){r.prototype=Object.create(e.prototype),r.prototype.constructor=r,JA(r,e)}function fM(r){return fM=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},fM(r)}function vle(r){try{return Function.toString.call(r).indexOf("[native code]")!==-1}catch{return typeof r=="function"}}function uF(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(uF=function(){return!!r})()}function ble(r,e,i){if(uF())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,e);var s=new(r.bind.apply(r,n));return i&&JA(s,i.prototype),s}function mM(r){var e=typeof Map=="function"?new Map:void 0;return mM=function(i){if(i===null||!vle(i))return i;if(typeof i!="function")throw new TypeError("Super expression must either be null or a function");if(e!==void 0){if(e.has(i))return e.get(i);e.set(i,n)}function n(){return ble(i,arguments,fM(this).constructor)}return n.prototype=Object.create(i.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),JA(n,i)},mM(r)}var xle={1:`Passed invalid arguments to hsl, please pass multiple numbers e.g. hsl(360, 0.75, 0.4) or an object e.g. rgb({ hue: 255, saturation: 0.4, lightness: 0.75 }).

`,2:`Passed invalid arguments to hsla, please pass multiple numbers e.g. hsla(360, 0.75, 0.4, 0.7) or an object e.g. rgb({ hue: 255, saturation: 0.4, lightness: 0.75, alpha: 0.7 }).

`,3:`Passed an incorrect argument to a color function, please pass a string representation of a color.

`,4:`Couldn't generate valid rgb string from %s, it returned %s.

`,5:`Couldn't parse the color string. Please provide the color as a string in hex, rgb, rgba, hsl or hsla notation.

`,6:`Passed invalid arguments to rgb, please pass multiple numbers e.g. rgb(255, 205, 100) or an object e.g. rgb({ red: 255, green: 205, blue: 100 }).

`,7:`Passed invalid arguments to rgba, please pass multiple numbers e.g. rgb(255, 205, 100, 0.75) or an object e.g. rgb({ red: 255, green: 205, blue: 100, alpha: 0.75 }).

`,8:`Passed invalid argument to toColorString, please pass a RgbColor, RgbaColor, HslColor or HslaColor object.

`,9:`Please provide a number of steps to the modularScale helper.

`,10:`Please pass a number or one of the predefined scales to the modularScale helper as the ratio.

`,11:`Invalid value passed as base to modularScale, expected number or em string but got "%s"

`,12:`Expected a string ending in "px" or a number passed as the first argument to %s(), got "%s" instead.

`,13:`Expected a string ending in "px" or a number passed as the second argument to %s(), got "%s" instead.

`,14:`Passed invalid pixel value ("%s") to %s(), please pass a value like "12px" or 12.

`,15:`Passed invalid base value ("%s") to %s(), please pass a value like "12px" or 12.

`,16:`You must provide a template to this method.

`,17:`You passed an unsupported selector state to this method.

`,18:`minScreen and maxScreen must be provided as stringified numbers with the same units.

`,19:`fromSize and toSize must be provided as stringified numbers with the same units.

`,20:`expects either an array of objects or a single object with the properties prop, fromSize, and toSize.

`,21:"expects the objects in the first argument array to have the properties `prop`, `fromSize`, and `toSize`.\n\n",22:"expects the first argument object to have the properties `prop`, `fromSize`, and `toSize`.\n\n",23:`fontFace expects a name of a font-family.

`,24:`fontFace expects either the path to the font file(s) or a name of a local copy.

`,25:`fontFace expects localFonts to be an array.

`,26:`fontFace expects fileFormats to be an array.

`,27:`radialGradient requries at least 2 color-stops to properly render.

`,28:`Please supply a filename to retinaImage() as the first argument.

`,29:`Passed invalid argument to triangle, please pass correct pointingDirection e.g. 'right'.

`,30:"Passed an invalid value to `height` or `width`. Please provide a pixel based unit.\n\n",31:`The animation shorthand only takes 8 arguments. See the specification for more information: http://mdn.io/animation

`,32:`To pass multiple animations please supply them in arrays, e.g. animation(['rotate', '2s'], ['move', '1s'])
To pass a single animation please supply them in simple values, e.g. animation('rotate', '2s')

`,33:`The animation shorthand arrays can only have 8 elements. See the specification for more information: http://mdn.io/animation

`,34:`borderRadius expects a radius value as a string or number as the second argument.

`,35:`borderRadius expects one of "top", "bottom", "left" or "right" as the first argument.

`,36:`Property must be a string value.

`,37:`Syntax Error at %s.

`,38:`Formula contains a function that needs parentheses at %s.

`,39:`Formula is missing closing parenthesis at %s.

`,40:`Formula has too many closing parentheses at %s.

`,41:`All values in a formula must have the same unit or be unitless.

`,42:`Please provide a number of steps to the modularScale helper.

`,43:`Please pass a number or one of the predefined scales to the modularScale helper as the ratio.

`,44:`Invalid value passed as base to modularScale, expected number or em/rem string but got %s.

`,45:`Passed invalid argument to hslToColorString, please pass a HslColor or HslaColor object.

`,46:`Passed invalid argument to rgbToColorString, please pass a RgbColor or RgbaColor object.

`,47:`minScreen and maxScreen must be provided as stringified numbers with the same units.

`,48:`fromSize and toSize must be provided as stringified numbers with the same units.

`,49:`Expects either an array of objects or a single object with the properties prop, fromSize, and toSize.

`,50:`Expects the objects in the first argument array to have the properties prop, fromSize, and toSize.

`,51:`Expects the first argument object to have the properties prop, fromSize, and toSize.

`,52:`fontFace expects either the path to the font file(s) or a name of a local copy.

`,53:`fontFace expects localFonts to be an array.

`,54:`fontFace expects fileFormats to be an array.

`,55:`fontFace expects a name of a font-family.

`,56:`linearGradient requries at least 2 color-stops to properly render.

`,57:`radialGradient requries at least 2 color-stops to properly render.

`,58:`Please supply a filename to retinaImage() as the first argument.

`,59:`Passed invalid argument to triangle, please pass correct pointingDirection e.g. 'right'.

`,60:"Passed an invalid value to `height` or `width`. Please provide a pixel based unit.\n\n",61:`Property must be a string value.

`,62:`borderRadius expects a radius value as a string or number as the second argument.

`,63:`borderRadius expects one of "top", "bottom", "left" or "right" as the first argument.

`,64:`The animation shorthand only takes 8 arguments. See the specification for more information: http://mdn.io/animation.

`,65:`To pass multiple animations please supply them in arrays, e.g. animation(['rotate', '2s'], ['move', '1s'])\\nTo pass a single animation please supply them in simple values, e.g. animation('rotate', '2s').

`,66:`The animation shorthand arrays can only have 8 elements. See the specification for more information: http://mdn.io/animation.

`,67:`You must provide a template to this method.

`,68:`You passed an unsupported selector state to this method.

`,69:`Expected a string ending in "px" or a number passed as the first argument to %s(), got %s instead.

`,70:`Expected a string ending in "px" or a number passed as the second argument to %s(), got %s instead.

`,71:`Passed invalid pixel value %s to %s(), please pass a value like "12px" or 12.

`,72:`Passed invalid base value %s to %s(), please pass a value like "12px" or 12.

`,73:`Please provide a valid CSS variable.

`,74:`CSS variable not found and no default was provided.

`,75:`important requires a valid style object, got a %s instead.

`,76:`fromSize and toSize must be provided as stringified numbers with the same units as minScreen and maxScreen.

`,77:`remToPx expects a value in "rem" but you provided it in "%s".

`,78:`base must be set in "px" or "%" but you set it in "%s".
`};function _le(){for(var r=arguments.length,e=new Array(r),i=0;i<r;i++)e[i]=arguments[i];var n=e[0],s=[],o;for(o=1;o<e.length;o+=1)s.push(e[o]);return s.forEach(function(l){n=n.replace(/%[a-z]/,l)}),n}var Xc=function(r){yle(e,r);function e(i){var n;if(process.env.NODE_ENV==="production")n=r.call(this,"An error occurred. See https://github.com/styled-components/polished/blob/main/src/internalHelpers/errors.md#"+i+" for more information.")||this;else{for(var s=arguments.length,o=new Array(s>1?s-1:0),l=1;l<s;l++)o[l-1]=arguments[l];n=r.call(this,_le.apply(void 0,[xle[i]].concat(o)))||this}return Ale(n)}return e}(mM(Error));function gM(r){return Math.round(r*255)}function Ele(r,e,i){return gM(r)+","+gM(e)+","+gM(i)}function u1(r,e,i,n){if(n===void 0&&(n=Ele),e===0)return n(i,i,i);var s=(r%360+360)%360/60,o=(1-Math.abs(2*i-1))*e,l=o*(1-Math.abs(s%2-1)),u=0,c=0,h=0;s>=0&&s<1?(u=o,c=l):s>=1&&s<2?(u=l,c=o):s>=2&&s<3?(c=o,h=l):s>=3&&s<4?(c=l,h=o):s>=4&&s<5?(u=l,h=o):s>=5&&s<6&&(u=o,h=l);var p=i-o/2,f=u+p,g=c+p,m=h+p;return n(f,g,m)}var hF={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"639",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};function wle(r){if(typeof r!="string")return r;var e=r.toLowerCase();return hF[e]?"#"+hF[e]:r}var Cle=/^#[a-fA-F0-9]{6}$/,Sle=/^#[a-fA-F0-9]{8}$/,Tle=/^#[a-fA-F0-9]{3}$/,Mle=/^#[a-fA-F0-9]{4}$/,AM=/^rgb\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*\)$/i,Rle=/^rgb(?:a)?\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i,Ile=/^hsl\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*\)$/i,Ble=/^hsl(?:a)?\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i;function Lp(r){if(typeof r!="string")throw new Xc(3);var e=wle(r);if(e.match(Cle))return{red:parseInt(""+e[1]+e[2],16),green:parseInt(""+e[3]+e[4],16),blue:parseInt(""+e[5]+e[6],16)};if(e.match(Sle)){var i=parseFloat((parseInt(""+e[7]+e[8],16)/255).toFixed(2));return{red:parseInt(""+e[1]+e[2],16),green:parseInt(""+e[3]+e[4],16),blue:parseInt(""+e[5]+e[6],16),alpha:i}}if(e.match(Tle))return{red:parseInt(""+e[1]+e[1],16),green:parseInt(""+e[2]+e[2],16),blue:parseInt(""+e[3]+e[3],16)};if(e.match(Mle)){var n=parseFloat((parseInt(""+e[4]+e[4],16)/255).toFixed(2));return{red:parseInt(""+e[1]+e[1],16),green:parseInt(""+e[2]+e[2],16),blue:parseInt(""+e[3]+e[3],16),alpha:n}}var s=AM.exec(e);if(s)return{red:parseInt(""+s[1],10),green:parseInt(""+s[2],10),blue:parseInt(""+s[3],10)};var o=Rle.exec(e.substring(0,50));if(o)return{red:parseInt(""+o[1],10),green:parseInt(""+o[2],10),blue:parseInt(""+o[3],10),alpha:parseFloat(""+o[4])>1?parseFloat(""+o[4])/100:parseFloat(""+o[4])};var l=Ile.exec(e);if(l){var u=parseInt(""+l[1],10),c=parseInt(""+l[2],10)/100,h=parseInt(""+l[3],10)/100,p="rgb("+u1(u,c,h)+")",f=AM.exec(p);if(!f)throw new Xc(4,e,p);return{red:parseInt(""+f[1],10),green:parseInt(""+f[2],10),blue:parseInt(""+f[3],10)}}var g=Ble.exec(e.substring(0,50));if(g){var m=parseInt(""+g[1],10),y=parseInt(""+g[2],10)/100,b=parseInt(""+g[3],10)/100,v="rgb("+u1(m,y,b)+")",_=AM.exec(v);if(!_)throw new Xc(4,e,v);return{red:parseInt(""+_[1],10),green:parseInt(""+_[2],10),blue:parseInt(""+_[3],10),alpha:parseFloat(""+g[4])>1?parseFloat(""+g[4])/100:parseFloat(""+g[4])}}throw new Xc(5)}function Nle(r){var e=r.red/255,i=r.green/255,n=r.blue/255,s=Math.max(e,i,n),o=Math.min(e,i,n),l=(s+o)/2;if(s===o)return r.alpha!==void 0?{hue:0,saturation:0,lightness:l,alpha:r.alpha}:{hue:0,saturation:0,lightness:l};var u,c=s-o,h=l>.5?c/(2-s-o):c/(s+o);switch(s){case e:u=(i-n)/c+(i<n?6:0);break;case i:u=(n-e)/c+2;break;default:u=(e-i)/c+4;break}return u*=60,r.alpha!==void 0?{hue:u,saturation:h,lightness:l,alpha:r.alpha}:{hue:u,saturation:h,lightness:l}}function ld(r){return Nle(Lp(r))}var Lle=function(r){return r.length===7&&r[1]===r[2]&&r[3]===r[4]&&r[5]===r[6]?"#"+r[1]+r[3]+r[5]:r},yM=Lle;function Dp(r){var e=r.toString(16);return e.length===1?"0"+e:e}function vM(r){return Dp(Math.round(r*255))}function Dle(r,e,i){return yM("#"+vM(r)+vM(e)+vM(i))}function dF(r,e,i){return u1(r,e,i,Dle)}function Ole(r,e,i){if(typeof r=="object"&&e===void 0&&i===void 0)return dF(r.hue,r.saturation,r.lightness);throw new Xc(1)}function Ple(r,e,i,n){if(typeof r=="object"&&e===void 0&&i===void 0&&n===void 0)return r.alpha>=1?dF(r.hue,r.saturation,r.lightness):"rgba("+u1(r.hue,r.saturation,r.lightness)+","+r.alpha+")";throw new Xc(2)}function pF(r,e,i){if(typeof r=="number"&&typeof e=="number"&&typeof i=="number")return yM("#"+Dp(r)+Dp(e)+Dp(i));if(typeof r=="object"&&e===void 0&&i===void 0)return yM("#"+Dp(r.red)+Dp(r.green)+Dp(r.blue));throw new Xc(6)}function h1(r,e,i,n){if(typeof r=="object"&&e===void 0&&i===void 0&&n===void 0)return r.alpha>=1?pF(r.red,r.green,r.blue):"rgba("+r.red+","+r.green+","+r.blue+","+r.alpha+")";throw new Xc(7)}var kle=function(r){return typeof r.red=="number"&&typeof r.green=="number"&&typeof r.blue=="number"&&(typeof r.alpha!="number"||typeof r.alpha>"u")},Fle=function(r){return typeof r.red=="number"&&typeof r.green=="number"&&typeof r.blue=="number"&&typeof r.alpha=="number"},Ule=function(r){return typeof r.hue=="number"&&typeof r.saturation=="number"&&typeof r.lightness=="number"&&(typeof r.alpha!="number"||typeof r.alpha>"u")},zle=function(r){return typeof r.hue=="number"&&typeof r.saturation=="number"&&typeof r.lightness=="number"&&typeof r.alpha=="number"};function cd(r){if(typeof r!="object")throw new Xc(8);if(Fle(r))return h1(r);if(kle(r))return pF(r);if(zle(r))return Ple(r);if(Ule(r))return Ole(r);throw new Xc(8)}function fF(r,e,i){return function(){var n=i.concat(Array.prototype.slice.call(arguments));return n.length>=e?r.apply(this,n):fF(r,e,n)}}function ml(r){return fF(r,r.length,[])}function jle(r,e){if(e==="transparent")return e;var i=ld(e);return cd(Qo({},i,{hue:i.hue+parseFloat(r)}))}ml(jle);function $m(r,e,i){return Math.max(r,Math.min(e,i))}function Gle(r,e){if(e==="transparent")return e;var i=ld(e);return cd(Qo({},i,{lightness:$m(0,1,i.lightness-parseFloat(r))}))}ml(Gle);function Vle(r,e){if(e==="transparent")return e;var i=ld(e);return cd(Qo({},i,{saturation:$m(0,1,i.saturation-parseFloat(r))}))}ml(Vle);function Hle(r,e){if(e==="transparent")return e;var i=ld(e);return cd(Qo({},i,{lightness:$m(0,1,i.lightness+parseFloat(r))}))}ml(Hle);function Wle(r,e,i){if(e==="transparent")return i;if(i==="transparent")return e;if(r===0)return i;var n=Lp(e),s=Qo({},n,{alpha:typeof n.alpha=="number"?n.alpha:1}),o=Lp(i),l=Qo({},o,{alpha:typeof o.alpha=="number"?o.alpha:1}),u=s.alpha-l.alpha,c=parseFloat(r)*2-1,h=c*u===-1?c:c+u,p=1+c*u,f=(h/p+1)/2,g=1-f,m={red:Math.floor(s.red*f+l.red*g),green:Math.floor(s.green*f+l.green*g),blue:Math.floor(s.blue*f+l.blue*g),alpha:s.alpha*parseFloat(r)+l.alpha*(1-parseFloat(r))};return h1(m)}var Qle=ml(Wle),mF=Qle;function qle(r,e){if(e==="transparent")return e;var i=Lp(e),n=typeof i.alpha=="number"?i.alpha:1,s=Qo({},i,{alpha:$m(0,1,(n*100+parseFloat(r)*100)/100)});return h1(s)}var Xle=ml(qle),gF=Xle;function Kle(r,e){if(e==="transparent")return e;var i=ld(e);return cd(Qo({},i,{saturation:$m(0,1,i.saturation+parseFloat(r))}))}ml(Kle);function Yle(r,e){return e==="transparent"?e:cd(Qo({},ld(e),{hue:parseFloat(r)}))}ml(Yle);function Jle(r,e){return e==="transparent"?e:cd(Qo({},ld(e),{lightness:parseFloat(r)}))}ml(Jle);function Zle(r,e){return e==="transparent"?e:cd(Qo({},ld(e),{saturation:parseFloat(r)}))}ml(Zle);function $le(r,e){return e==="transparent"?e:mF(parseFloat(r),"rgb(0, 0, 0)",e)}ml($le);function ece(r,e){return e==="transparent"?e:mF(parseFloat(r),"rgb(255, 255, 255)",e)}ml(ece);function tce(r,e){if(e==="transparent")return e;var i=Lp(e),n=typeof i.alpha=="number"?i.alpha:1,s=Qo({},i,{alpha:$m(0,1,+(n*100-parseFloat(r)*100).toFixed(2)/100)});return h1(s)}ml(tce);function ice(r,e){e===void 0&&(e={});var i=e.insertAt;if(!(typeof document>"u")){var n=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css",i==="top"&&n.firstChild?n.insertBefore(s,n.firstChild):n.appendChild(s),s.styleSheet?s.styleSheet.cssText=r:s.appendChild(document.createTextNode(r))}}var rce=`.graph-nav-info {
  position: absolute;
  bottom: 5px;
  width: 100%;
  text-align: center;
  color: slategrey;
  opacity: 0.7;
  font-size: 10px;
  font-family: Sans-serif;
  z-index: 1000;
}`;ice(rce);function bM(r,e){(e==null||e>r.length)&&(e=r.length);for(var i=0,n=Array(e);i<e;i++)n[i]=r[i];return n}function nce(r){if(Array.isArray(r))return r}function sce(r){if(Array.isArray(r))return bM(r)}function ZA(r,e,i){return(e=hce(e))in r?Object.defineProperty(r,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[e]=i,r}function ace(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function oce(r,e){var i=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(i!=null){var n,s,o,l,u=[],c=!0,h=!1;try{if(o=(i=i.call(r)).next,e!==0)for(;!(c=(n=o.call(i)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(p){h=!0,s=p}finally{try{if(!c&&i.return!=null&&(l=i.return(),Object(l)!==l))return}finally{if(h)throw s}}return u}}function lce(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function cce(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function AF(r,e){var i=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),i.push.apply(i,n)}return i}function yF(r){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?AF(Object(i),!0).forEach(function(n){ZA(r,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):AF(Object(i)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(i,n))})}return r}function xM(r,e){return nce(r)||oce(r,e)||vF(r,e)||lce()}function d1(r){return sce(r)||ace(r)||vF(r)||cce()}function uce(r,e){if(typeof r!="object"||!r)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var n=i.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function hce(r){var e=uce(r,"string");return typeof e=="symbol"?e:e+""}function vF(r,e){if(r){if(typeof r=="string")return bM(r,e);var i={}.toString.call(r).slice(8,-1);return i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set"?Array.from(r):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?bM(r,e):void 0}}var bF=Rp({props:{width:{default:window.innerWidth,triggerUpdate:!1,onChange:function(r,e){e.container&&(e.container.style.width="".concat(r,"px"))}},height:{default:window.innerHeight,triggerUpdate:!1,onChange:function(r,e){e.container&&(e.container.style.height="".concat(r,"px"))}},jsonUrl:{},graphData:{default:{nodes:[],links:[]}},numDimensions:{default:3},dagMode:{},dagLevelDistance:{},dagNodeFilter:{default:function(){return!0}},onDagError:{default:void 0},backgroundColor:{default:"#002"},showNavInfo:{default:!0},nodeRelSize:{default:4},nodeId:{default:"id"},nodeLabel:{default:"name"},nodeDesc:{default:"desc"},onNodeHover:{},onNodeClick:{},nodeVal:{default:"val"},nodeResolution:{default:8},nodeVisibility:{default:!0},nodeColor:{default:"color"},nodeAutoColorBy:{},nodeOpacity:{default:.75},nodeThreeObject:{},nodeThreeObjectExtend:{default:!1},linkSource:{default:"source"},linkTarget:{default:"target"},linkLabel:{default:"name"},linkDesc:{default:"desc"},onLinkHover:{},onLinkClick:{},linkVisibility:{default:!0},linkColor:{default:"color"},linkAutoColorBy:{},linkOpacity:{default:.2},linkWidth:{default:0},linkResolution:{default:6},linkCurvature:{default:0},linkCurveRotation:{default:0},linkMaterial:{},linkThreeObject:{},linkThreeObjectExtend:{default:!1},linkPositionUpdate:{},linkDirectionalArrowLength:{default:0},linkDirectionalArrowColor:{},linkDirectionalArrowRelPos:{default:.5},linkDirectionalArrowResolution:{default:8},linkDirectionalParticles:{default:0},linkDirectionalParticleSpeed:{default:.01},linkDirectionalParticleWidth:{default:.5},linkDirectionalParticleColor:{},linkDirectionalParticleResolution:{default:4},forceEngine:{default:"d3"},d3AlphaMin:{default:0},d3AlphaDecay:{default:.0228},d3VelocityDecay:{default:.4},ngraphPhysics:{},warmupTicks:{default:0},cooldownTicks:{},cooldownTime:{default:15e3},onEngineTick:{},onEngineStop:{}},methods:yF(yF({},Object.assign.apply(Object,[{}].concat(d1(["getGraphBbox","emitParticle","d3Force","d3ReheatSimulation","refresh"].map(function(r){return ZA({},r,function(e){for(var i=e.forcegraph.components.forcegraph,n=arguments.length,s=new Array(n>1?n-1:0),o=1;o<n;o++)s[o-1]=arguments[o];var l=i[r].apply(i,s);return l===i?this:l})}))))),{},{_destructor:function(){this.graphData({nodes:[],links:[]})}}),init:function(r,e){r.innerHTML="",e.container=document.createElement("div"),r.appendChild(e.container),e.container.style.position="relative",e.container.style.width="".concat(e.width,"px"),e.container.style.height="".concat(e.height,"px"),e.container.appendChild(e.navInfo=document.createElement("div")),e.navInfo.className="graph-nav-info",e.navInfo.textContent="Mouse drag: look, gamepad/arrow/wasd keys: move";var i=document.createElement("a-scene");i.setAttribute("embedded",""),i.appendChild(e.sky=document.createElement("a-sky")),e.sky.setAttribute("radius",3e3);var n;i.appendChild(n=document.createElement("a-entity")),n.setAttribute("position","0 0 300"),n.setAttribute("movement-controls","controls: gamepad, touch; fly: true; speed: 7");var s;n.appendChild(s=document.createElement("a-entity")),s.setAttribute("camera",""),s.setAttribute("position","0 0 0"),s.setAttribute("look-controls","pointerLockEnabled: false"),s.setAttribute("wasd-controls","fly: true; acceleration: 700");var o;s.appendChild(o=document.createElement("a-text")),o.setAttribute("position","0 -0.3 -1"),o.setAttribute("width",2),o.setAttribute("align","center"),o.setAttribute("color","lavender"),o.setAttribute("value","");var l;s.appendChild(l=document.createElement("a-text")),l.setAttribute("position","0 -0.4 -1"),l.setAttribute("width",1.3),l.setAttribute("align","center"),l.setAttribute("color","lavender"),l.setAttribute("value",""),e.raycasterEls=[];var u;i.appendChild(u=document.createElement("a-entity")),u.setAttribute("cursor","rayOrigin: mouse; mouseCursorStylesEnabled: true"),u.setAttribute("raycaster","objects: [forcegraph]; interval: 100"),e.raycasterEls.push(u),["left","right"].forEach(function(c){var h;n.appendChild(h=document.createElement("a-entity")),h.setAttribute("laser-controls","hand: ".concat(c,"; model: false;")),h.setAttribute("raycaster","objects: [forcegraph]; interval: 100; lineColor: steelblue; lineOpacity: 0.85"),e.raycasterEls.push(h)}),i.appendChild(e.forcegraph=document.createElement("a-entity")),e.forcegraph.setAttribute("forcegraph",null),e.container.appendChild(i),e.forcegraph.setAttribute("forcegraph",Object.assign.apply(Object,d1(["node","link"].map(function(c){var h={node:"Node",link:"Link"}[c];return ZA({},"on".concat(h,"Hover"),function(p,f){var g=p&&gr(e["".concat(c,"Label")])(p)||"",m=p&&gr(e["".concat(c,"Desc")])(p)||"";o.setAttribute("value",g),l.setAttribute("value",m),e["on".concat(h,"Hover")]&&e["on".concat(h,"Hover")](p,f)})}))))},update:function(r,e){if(e.hasOwnProperty("backgroundColor")){var i=Lp(r.backgroundColor).alpha;i===void 0&&(i=1),r.sky.setAttribute("color",gF(1,r.backgroundColor)),r.sky.setAttribute("opacity",i)}e.hasOwnProperty("showNavInfo")&&(r.navInfo.style.display=r.showNavInfo?null:"none");var n=["onNodeHover","onLinkHover","onNodeClick","onLinkClick"].some(function(l){return r[l]})||["nodeLabel","linkLabel"].some(function(l){return r[l]!=="name"})||["nodeDesc","linkDesc"].some(function(l){return r[l]!=="desc"});r.raycasterEls.forEach(function(l){return l.setAttribute("raycaster",n?"objects: [forcegraph]; interval: 100":"objects: __none__")});var s=["jsonUrl","numDimensions","dagMode","dagLevelDistance","dagNodeFilter","onDagError","nodeRelSize","nodeId","onNodeClick","nodeVal","nodeResolution","nodeVisibility","nodeColor","nodeAutoColorBy","nodeOpacity","nodeThreeObject","nodeThreeObjectExtend","linkSource","linkTarget","onLinkClick","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","forceEngine","d3AlphaMin","d3AlphaDecay","d3VelocityDecay","ngraphPhysics","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"],o=Object.assign.apply(Object,[{}].concat(d1(Object.entries(r).filter(function(l){var u=xM(l,2),c=u[0],h=u[1];return e.hasOwnProperty(c)&&s.indexOf(c)!==-1&&h!==void 0&&h!==null}).map(function(l){var u=xM(l,2),c=u[0],h=u[1];return ZA({},c,h)})),d1(Object.entries(r.graphData).map(function(l){var u=xM(l,2),c=u[0],h=u[1];return ZA({},c,h)}))));r.forcegraph.setAttribute("forcegraph",o)}});class eg extends Error{constructor(e,i){const n=`${eg.extractMessage(e)}: ${JSON.stringify({response:e,request:i})}`;super(n),X0(this,"response"),X0(this,"request"),Object.setPrototypeOf(this,eg.prototype),this.response=e,this.request=i,typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,eg)}static extractMessage(e){var i,n;return((n=(i=e.errors)==null?void 0:i[0])==null?void 0:n.message)??`GraphQL Error (Code: ${String(e.status)})`}}const xF=r=>r.toUpperCase(),_M=r=>typeof r=="function"?r():r,_F=(r,e)=>r.map((i,n)=>[i,e[n]]),tg=r=>{let e={};return r instanceof Headers?e=dce(r):Array.isArray(r)?r.forEach(([i,n])=>{i&&n!==void 0&&(e[i]=n)}):r&&(e=r),e},dce=r=>{const e={};return r.forEach((i,n)=>{e[n]=i}),e},pce=r=>{try{const e=r();return fce(e)?e.catch(i=>EF(i)):e}catch(e){return EF(e)}},EF=r=>r instanceof Error?r:new Error(String(r)),fce=r=>typeof r=="object"&&r!==null&&"then"in r&&typeof r.then=="function"&&"catch"in r&&typeof r.catch=="function"&&"finally"in r&&typeof r.finally=="function",EM=r=>{throw new Error(`Unhandled case: ${String(r)}`)},p1=r=>typeof r=="object"&&r!==null&&!Array.isArray(r),mce=(r,e)=>r.documents?r:{documents:r,requestHeaders:e,signal:void 0},gce=(r,e,i)=>r.query?r:{query:r,variables:e,requestHeaders:i,signal:void 0};function f1(r,e){throw new Error(e)}function Ace(r){return typeof r=="object"&&r!==null}function yce(r,e){throw new Error("Unexpected invariant triggered.")}const vce=/\r\n|[\n\r]/g;function wM(r,e){let i=0,n=1;for(const s of r.body.matchAll(vce)){if(typeof s.index=="number"||yce(),s.index>=e)break;i=s.index+s[0].length,n+=1}return{line:n,column:e+1-i}}function bce(r){return wF(r.source,wM(r.source,r.start))}function wF(r,e){const i=r.locationOffset.column-1,n="".padStart(i)+r.body,s=e.line-1,o=r.locationOffset.line-1,l=e.line+o,u=e.line===1?i:0,c=e.column+u,h=`${r.name}:${l}:${c}
`,p=n.split(/\r\n|[\n\r]/g),f=p[s];if(f.length>120){const g=Math.floor(c/80),m=c%80,y=[];for(let b=0;b<f.length;b+=80)y.push(f.slice(b,b+80));return h+CF([[`${l} |`,y[0]],...y.slice(1,g+1).map(b=>["|",b]),["|","^".padStart(m)],["|",y[g+1]]])}return h+CF([[`${l-1} |`,p[s-1]],[`${l} |`,f],["|","^".padStart(c)],[`${l+1} |`,p[s+1]]])}function CF(r){const e=r.filter(([n,s])=>s!==void 0),i=Math.max(...e.map(([n])=>n.length));return e.map(([n,s])=>n.padStart(i)+(s?" "+s:"")).join(`
`)}function xce(r){const e=r[0];return e==null||"kind"in e||"length"in e?{nodes:e,source:r[1],positions:r[2],path:r[3],originalError:r[4],extensions:r[5]}:e}class CM extends Error{constructor(e,...i){var n,s,o;const{nodes:l,source:u,positions:c,path:h,originalError:p,extensions:f}=xce(i);super(e),this.name="GraphQLError",this.path=h??void 0,this.originalError=p??void 0,this.nodes=SF(Array.isArray(l)?l:l?[l]:void 0);const g=SF((n=this.nodes)===null||n===void 0?void 0:n.map(y=>y.loc).filter(y=>y!=null));this.source=u??(g==null||(s=g[0])===null||s===void 0?void 0:s.source),this.positions=c??(g==null?void 0:g.map(y=>y.start)),this.locations=c&&u?c.map(y=>wM(u,y)):g==null?void 0:g.map(y=>wM(y.source,y.start));const m=Ace(p==null?void 0:p.extensions)?p==null?void 0:p.extensions:void 0;this.extensions=(o=f??m)!==null&&o!==void 0?o:Object.create(null),Object.defineProperties(this,{message:{writable:!0,enumerable:!0},name:{enumerable:!1},nodes:{enumerable:!1},source:{enumerable:!1},positions:{enumerable:!1},originalError:{enumerable:!1}}),p!=null&&p.stack?Object.defineProperty(this,"stack",{value:p.stack,writable:!0,configurable:!0}):Error.captureStackTrace?Error.captureStackTrace(this,CM):Object.defineProperty(this,"stack",{value:Error().stack,writable:!0,configurable:!0})}get[Symbol.toStringTag](){return"GraphQLError"}toString(){let e=this.message;if(this.nodes)for(const i of this.nodes)i.loc&&(e+=`

`+bce(i.loc));else if(this.source&&this.locations)for(const i of this.locations)e+=`

`+wF(this.source,i);return e}toJSON(){const e={message:this.message};return this.locations!=null&&(e.locations=this.locations),this.path!=null&&(e.path=this.path),this.extensions!=null&&Object.keys(this.extensions).length>0&&(e.extensions=this.extensions),e}}function SF(r){return r===void 0||r.length===0?void 0:r}function Ra(r,e,i){return new CM(`Syntax Error: ${i}`,{source:r,positions:[e]})}class _ce{constructor(e,i,n){this.start=e.start,this.end=i.end,this.startToken=e,this.endToken=i,this.source=n}get[Symbol.toStringTag](){return"Location"}toJSON(){return{start:this.start,end:this.end}}}class TF{constructor(e,i,n,s,o,l){this.kind=e,this.start=i,this.end=n,this.line=s,this.column=o,this.value=l,this.prev=null,this.next=null}get[Symbol.toStringTag](){return"Token"}toJSON(){return{kind:this.kind,value:this.value,line:this.line,column:this.column}}}const MF={Name:[],Document:["definitions"],OperationDefinition:["name","variableDefinitions","directives","selectionSet"],VariableDefinition:["variable","type","defaultValue","directives"],Variable:["name"],SelectionSet:["selections"],Field:["alias","name","arguments","directives","selectionSet"],Argument:["name","value"],FragmentSpread:["name","directives"],InlineFragment:["typeCondition","directives","selectionSet"],FragmentDefinition:["name","variableDefinitions","typeCondition","directives","selectionSet"],IntValue:[],FloatValue:[],StringValue:[],BooleanValue:[],NullValue:[],EnumValue:[],ListValue:["values"],ObjectValue:["fields"],ObjectField:["name","value"],Directive:["name","arguments"],NamedType:["name"],ListType:["type"],NonNullType:["type"],SchemaDefinition:["description","directives","operationTypes"],OperationTypeDefinition:["type"],ScalarTypeDefinition:["description","name","directives"],ObjectTypeDefinition:["description","name","interfaces","directives","fields"],FieldDefinition:["description","name","arguments","type","directives"],InputValueDefinition:["description","name","type","defaultValue","directives"],InterfaceTypeDefinition:["description","name","interfaces","directives","fields"],UnionTypeDefinition:["description","name","directives","types"],EnumTypeDefinition:["description","name","directives","values"],EnumValueDefinition:["description","name","directives"],InputObjectTypeDefinition:["description","name","directives","fields"],DirectiveDefinition:["description","name","arguments","locations"],SchemaExtension:["directives","operationTypes"],ScalarTypeExtension:["name","directives"],ObjectTypeExtension:["name","interfaces","directives","fields"],InterfaceTypeExtension:["name","interfaces","directives","fields"],UnionTypeExtension:["name","directives","types"],EnumTypeExtension:["name","directives","values"],InputObjectTypeExtension:["name","directives","fields"]},Ece=new Set(Object.keys(MF));function RF(r){const e=r==null?void 0:r.kind;return typeof e=="string"&&Ece.has(e)}var Op;(function(r){r.QUERY="query",r.MUTATION="mutation",r.SUBSCRIPTION="subscription"})(Op||(Op={}));var SM;(function(r){r.QUERY="QUERY",r.MUTATION="MUTATION",r.SUBSCRIPTION="SUBSCRIPTION",r.FIELD="FIELD",r.FRAGMENT_DEFINITION="FRAGMENT_DEFINITION",r.FRAGMENT_SPREAD="FRAGMENT_SPREAD",r.INLINE_FRAGMENT="INLINE_FRAGMENT",r.VARIABLE_DEFINITION="VARIABLE_DEFINITION",r.SCHEMA="SCHEMA",r.SCALAR="SCALAR",r.OBJECT="OBJECT",r.FIELD_DEFINITION="FIELD_DEFINITION",r.ARGUMENT_DEFINITION="ARGUMENT_DEFINITION",r.INTERFACE="INTERFACE",r.UNION="UNION",r.ENUM="ENUM",r.ENUM_VALUE="ENUM_VALUE",r.INPUT_OBJECT="INPUT_OBJECT",r.INPUT_FIELD_DEFINITION="INPUT_FIELD_DEFINITION"})(SM||(SM={}));var Pr;(function(r){r.NAME="Name",r.DOCUMENT="Document",r.OPERATION_DEFINITION="OperationDefinition",r.VARIABLE_DEFINITION="VariableDefinition",r.SELECTION_SET="SelectionSet",r.FIELD="Field",r.ARGUMENT="Argument",r.FRAGMENT_SPREAD="FragmentSpread",r.INLINE_FRAGMENT="InlineFragment",r.FRAGMENT_DEFINITION="FragmentDefinition",r.VARIABLE="Variable",r.INT="IntValue",r.FLOAT="FloatValue",r.STRING="StringValue",r.BOOLEAN="BooleanValue",r.NULL="NullValue",r.ENUM="EnumValue",r.LIST="ListValue",r.OBJECT="ObjectValue",r.OBJECT_FIELD="ObjectField",r.DIRECTIVE="Directive",r.NAMED_TYPE="NamedType",r.LIST_TYPE="ListType",r.NON_NULL_TYPE="NonNullType",r.SCHEMA_DEFINITION="SchemaDefinition",r.OPERATION_TYPE_DEFINITION="OperationTypeDefinition",r.SCALAR_TYPE_DEFINITION="ScalarTypeDefinition",r.OBJECT_TYPE_DEFINITION="ObjectTypeDefinition",r.FIELD_DEFINITION="FieldDefinition",r.INPUT_VALUE_DEFINITION="InputValueDefinition",r.INTERFACE_TYPE_DEFINITION="InterfaceTypeDefinition",r.UNION_TYPE_DEFINITION="UnionTypeDefinition",r.ENUM_TYPE_DEFINITION="EnumTypeDefinition",r.ENUM_VALUE_DEFINITION="EnumValueDefinition",r.INPUT_OBJECT_TYPE_DEFINITION="InputObjectTypeDefinition",r.DIRECTIVE_DEFINITION="DirectiveDefinition",r.SCHEMA_EXTENSION="SchemaExtension",r.SCALAR_TYPE_EXTENSION="ScalarTypeExtension",r.OBJECT_TYPE_EXTENSION="ObjectTypeExtension",r.INTERFACE_TYPE_EXTENSION="InterfaceTypeExtension",r.UNION_TYPE_EXTENSION="UnionTypeExtension",r.ENUM_TYPE_EXTENSION="EnumTypeExtension",r.INPUT_OBJECT_TYPE_EXTENSION="InputObjectTypeExtension"})(Pr||(Pr={}));function TM(r){return r===9||r===32}function $A(r){return r>=48&&r<=57}function IF(r){return r>=97&&r<=122||r>=65&&r<=90}function BF(r){return IF(r)||r===95}function wce(r){return IF(r)||$A(r)||r===95}function Cce(r){var e;let i=Number.MAX_SAFE_INTEGER,n=null,s=-1;for(let l=0;l<r.length;++l){var o;const u=r[l],c=Sce(u);c!==u.length&&(n=(o=n)!==null&&o!==void 0?o:l,s=l,l!==0&&c<i&&(i=c))}return r.map((l,u)=>u===0?l:l.slice(i)).slice((e=n)!==null&&e!==void 0?e:0,s+1)}function Sce(r){let e=0;for(;e<r.length&&TM(r.charCodeAt(e));)++e;return e}function Tce(r,e){const i=r.replace(/"""/g,'\\"""'),n=i.split(/\r\n|[\n\r]/g),s=n.length===1,o=n.length>1&&n.slice(1).every(m=>m.length===0||TM(m.charCodeAt(0))),l=i.endsWith('\\"""'),u=r.endsWith('"')&&!l,c=r.endsWith("\\"),h=u||c,p=!s||r.length>70||h||o||l;let f="";const g=s&&TM(r.charCodeAt(0));return(p&&!g||o)&&(f+=`
`),f+=i,(p||h)&&(f+=`
`),'"""'+f+'"""'}var ai;(function(r){r.SOF="<SOF>",r.EOF="<EOF>",r.BANG="!",r.DOLLAR="$",r.AMP="&",r.PAREN_L="(",r.PAREN_R=")",r.SPREAD="...",r.COLON=":",r.EQUALS="=",r.AT="@",r.BRACKET_L="[",r.BRACKET_R="]",r.BRACE_L="{",r.PIPE="|",r.BRACE_R="}",r.NAME="Name",r.INT="Int",r.FLOAT="Float",r.STRING="String",r.BLOCK_STRING="BlockString",r.COMMENT="Comment"})(ai||(ai={}));class Mce{constructor(e){const i=new TF(ai.SOF,0,0,0,0);this.source=e,this.lastToken=i,this.token=i,this.line=1,this.lineStart=0}get[Symbol.toStringTag](){return"Lexer"}advance(){return this.lastToken=this.token,this.token=this.lookahead()}lookahead(){let e=this.token;if(e.kind!==ai.EOF)do if(e.next)e=e.next;else{const i=Ice(this,e.end);e.next=i,i.prev=e,e=i}while(e.kind===ai.COMMENT);return e}}function Rce(r){return r===ai.BANG||r===ai.DOLLAR||r===ai.AMP||r===ai.PAREN_L||r===ai.PAREN_R||r===ai.SPREAD||r===ai.COLON||r===ai.EQUALS||r===ai.AT||r===ai.BRACKET_L||r===ai.BRACKET_R||r===ai.BRACE_L||r===ai.PIPE||r===ai.BRACE_R}function ig(r){return r>=0&&r<=55295||r>=57344&&r<=1114111}function m1(r,e){return NF(r.charCodeAt(e))&&LF(r.charCodeAt(e+1))}function NF(r){return r>=55296&&r<=56319}function LF(r){return r>=56320&&r<=57343}function Pp(r,e){const i=r.source.body.codePointAt(e);if(i===void 0)return ai.EOF;if(i>=32&&i<=126){const n=String.fromCodePoint(i);return n==='"'?`'"'`:`"${n}"`}return"U+"+i.toString(16).toUpperCase().padStart(4,"0")}function ea(r,e,i,n,s){const o=r.line,l=1+i-r.lineStart;return new TF(e,i,n,o,l,s)}function Ice(r,e){const i=r.source.body,n=i.length;let s=e;for(;s<n;){const o=i.charCodeAt(s);switch(o){case 65279:case 9:case 32:case 44:++s;continue;case 10:++s,++r.line,r.lineStart=s;continue;case 13:i.charCodeAt(s+1)===10?s+=2:++s,++r.line,r.lineStart=s;continue;case 35:return Bce(r,s);case 33:return ea(r,ai.BANG,s,s+1);case 36:return ea(r,ai.DOLLAR,s,s+1);case 38:return ea(r,ai.AMP,s,s+1);case 40:return ea(r,ai.PAREN_L,s,s+1);case 41:return ea(r,ai.PAREN_R,s,s+1);case 46:if(i.charCodeAt(s+1)===46&&i.charCodeAt(s+2)===46)return ea(r,ai.SPREAD,s,s+3);break;case 58:return ea(r,ai.COLON,s,s+1);case 61:return ea(r,ai.EQUALS,s,s+1);case 64:return ea(r,ai.AT,s,s+1);case 91:return ea(r,ai.BRACKET_L,s,s+1);case 93:return ea(r,ai.BRACKET_R,s,s+1);case 123:return ea(r,ai.BRACE_L,s,s+1);case 124:return ea(r,ai.PIPE,s,s+1);case 125:return ea(r,ai.BRACE_R,s,s+1);case 34:return i.charCodeAt(s+1)===34&&i.charCodeAt(s+2)===34?kce(r,s):Lce(r,s)}if($A(o)||o===45)return Nce(r,s,o);if(BF(o))return Fce(r,s);throw Ra(r.source,s,o===39?`Unexpected single quote character ('), did you mean to use a double quote (")?`:ig(o)||m1(i,s)?`Unexpected character: ${Pp(r,s)}.`:`Invalid character: ${Pp(r,s)}.`)}return ea(r,ai.EOF,n,n)}function Bce(r,e){const i=r.source.body,n=i.length;let s=e+1;for(;s<n;){const o=i.charCodeAt(s);if(o===10||o===13)break;if(ig(o))++s;else if(m1(i,s))s+=2;else break}return ea(r,ai.COMMENT,e,s,i.slice(e+1,s))}function Nce(r,e,i){const n=r.source.body;let s=e,o=i,l=!1;if(o===45&&(o=n.charCodeAt(++s)),o===48){if(o=n.charCodeAt(++s),$A(o))throw Ra(r.source,s,`Invalid number, unexpected digit after 0: ${Pp(r,s)}.`)}else s=MM(r,s,o),o=n.charCodeAt(s);if(o===46&&(l=!0,o=n.charCodeAt(++s),s=MM(r,s,o),o=n.charCodeAt(s)),(o===69||o===101)&&(l=!0,o=n.charCodeAt(++s),(o===43||o===45)&&(o=n.charCodeAt(++s)),s=MM(r,s,o),o=n.charCodeAt(s)),o===46||BF(o))throw Ra(r.source,s,`Invalid number, expected digit but got: ${Pp(r,s)}.`);return ea(r,l?ai.FLOAT:ai.INT,e,s,n.slice(e,s))}function MM(r,e,i){if(!$A(i))throw Ra(r.source,e,`Invalid number, expected digit but got: ${Pp(r,e)}.`);const n=r.source.body;let s=e+1;for(;$A(n.charCodeAt(s));)++s;return s}function Lce(r,e){const i=r.source.body,n=i.length;let s=e+1,o=s,l="";for(;s<n;){const u=i.charCodeAt(s);if(u===34)return l+=i.slice(o,s),ea(r,ai.STRING,e,s+1,l);if(u===92){l+=i.slice(o,s);const c=i.charCodeAt(s+1)===117?i.charCodeAt(s+2)===123?Dce(r,s):Oce(r,s):Pce(r,s);l+=c.value,s+=c.size,o=s;continue}if(u===10||u===13)break;if(ig(u))++s;else if(m1(i,s))s+=2;else throw Ra(r.source,s,`Invalid character within String: ${Pp(r,s)}.`)}throw Ra(r.source,s,"Unterminated string.")}function Dce(r,e){const i=r.source.body;let n=0,s=3;for(;s<12;){const o=i.charCodeAt(e+s++);if(o===125){if(s<5||!ig(n))break;return{value:String.fromCodePoint(n),size:s}}if(n=n<<4|ey(o),n<0)break}throw Ra(r.source,e,`Invalid Unicode escape sequence: "${i.slice(e,e+s)}".`)}function Oce(r,e){const i=r.source.body,n=DF(i,e+2);if(ig(n))return{value:String.fromCodePoint(n),size:6};if(NF(n)&&i.charCodeAt(e+6)===92&&i.charCodeAt(e+7)===117){const s=DF(i,e+8);if(LF(s))return{value:String.fromCodePoint(n,s),size:12}}throw Ra(r.source,e,`Invalid Unicode escape sequence: "${i.slice(e,e+6)}".`)}function DF(r,e){return ey(r.charCodeAt(e))<<12|ey(r.charCodeAt(e+1))<<8|ey(r.charCodeAt(e+2))<<4|ey(r.charCodeAt(e+3))}function ey(r){return r>=48&&r<=57?r-48:r>=65&&r<=70?r-55:r>=97&&r<=102?r-87:-1}function Pce(r,e){const i=r.source.body;switch(i.charCodeAt(e+1)){case 34:return{value:'"',size:2};case 92:return{value:"\\",size:2};case 47:return{value:"/",size:2};case 98:return{value:"\b",size:2};case 102:return{value:"\f",size:2};case 110:return{value:`
`,size:2};case 114:return{value:"\r",size:2};case 116:return{value:"	",size:2}}throw Ra(r.source,e,`Invalid character escape sequence: "${i.slice(e,e+2)}".`)}function kce(r,e){const i=r.source.body,n=i.length;let s=r.lineStart,o=e+3,l=o,u="";const c=[];for(;o<n;){const h=i.charCodeAt(o);if(h===34&&i.charCodeAt(o+1)===34&&i.charCodeAt(o+2)===34){u+=i.slice(l,o),c.push(u);const p=ea(r,ai.BLOCK_STRING,e,o+3,Cce(c).join(`
`));return r.line+=c.length-1,r.lineStart=s,p}if(h===92&&i.charCodeAt(o+1)===34&&i.charCodeAt(o+2)===34&&i.charCodeAt(o+3)===34){u+=i.slice(l,o),l=o+1,o+=4;continue}if(h===10||h===13){u+=i.slice(l,o),c.push(u),h===13&&i.charCodeAt(o+1)===10?o+=2:++o,u="",l=o,s=o;continue}if(ig(h))++o;else if(m1(i,o))o+=2;else throw Ra(r.source,o,`Invalid character within String: ${Pp(r,o)}.`)}throw Ra(r.source,o,"Unterminated string.")}function Fce(r,e){const i=r.source.body,n=i.length;let s=e+1;for(;s<n;){const o=i.charCodeAt(s);if(wce(o))++s;else break}return ea(r,ai.NAME,e,s,i.slice(e,s))}const Uce=10,OF=2;function RM(r){return g1(r,[])}function g1(r,e){switch(typeof r){case"string":return JSON.stringify(r);case"function":return r.name?`[function ${r.name}]`:"[function]";case"object":return zce(r,e);default:return String(r)}}function zce(r,e){if(r===null)return"null";if(e.includes(r))return"[Circular]";const i=[...e,r];if(jce(r)){const n=r.toJSON();if(n!==r)return typeof n=="string"?n:g1(n,i)}else if(Array.isArray(r))return Vce(r,i);return Gce(r,i)}function jce(r){return typeof r.toJSON=="function"}function Gce(r,e){const i=Object.entries(r);return i.length===0?"{}":e.length>OF?"["+Hce(r)+"]":"{ "+i.map(([n,s])=>n+": "+g1(s,e)).join(", ")+" }"}function Vce(r,e){if(r.length===0)return"[]";if(e.length>OF)return"[Array]";const i=Math.min(Uce,r.length),n=r.length-i,s=[];for(let o=0;o<i;++o)s.push(g1(r[o],e));return n===1?s.push("... 1 more item"):n>1&&s.push(`... ${n} more items`),"["+s.join(", ")+"]"}function Hce(r){const e=Object.prototype.toString.call(r).replace(/^\[object /,"").replace(/]$/,"");if(e==="Object"&&typeof r.constructor=="function"){const i=r.constructor.name;if(typeof i=="string"&&i!=="")return i}return e}const Wce=globalThis.process&&process.env.NODE_ENV==="production",Qce=Wce?function(r,e){return r instanceof e}:function(r,e){if(r instanceof e)return!0;if(typeof r=="object"&&r!==null){var i;const n=e.prototype[Symbol.toStringTag],s=Symbol.toStringTag in r?r[Symbol.toStringTag]:(i=r.constructor)===null||i===void 0?void 0:i.name;if(n===s){const o=RM(r);throw new Error(`Cannot use ${n} "${o}" from another module or realm.

Ensure that there is only one instance of "graphql" in the node_modules
directory. If different versions of "graphql" are the dependencies of other
relied on modules, use "resolutions" to ensure only one version is installed.

https://yarnpkg.com/en/docs/selective-version-resolutions

Duplicate "graphql" modules cannot be used at the same time since different
versions may have different capabilities and behavior. The data from one
version used in the function from another could produce confusing and
spurious results.`)}}return!1};let PF=class{constructor(r,e="GraphQL request",i={line:1,column:1}){typeof r=="string"||f1(!1,`Body must be a string. Received: ${RM(r)}.`),this.body=r,this.name=e,this.locationOffset=i,this.locationOffset.line>0||f1(!1,"line in locationOffset is 1-indexed and must be positive."),this.locationOffset.column>0||f1(!1,"column in locationOffset is 1-indexed and must be positive.")}get[Symbol.toStringTag](){return"Source"}};function qce(r){return Qce(r,PF)}function Xce(r,e){return new Kce(r,e).parseDocument()}class Kce{constructor(e,i={}){const n=qce(e)?e:new PF(e);this._lexer=new Mce(n),this._options=i,this._tokenCounter=0}parseName(){const e=this.expectToken(ai.NAME);return this.node(e,{kind:Pr.NAME,value:e.value})}parseDocument(){return this.node(this._lexer.token,{kind:Pr.DOCUMENT,definitions:this.many(ai.SOF,this.parseDefinition,ai.EOF)})}parseDefinition(){if(this.peek(ai.BRACE_L))return this.parseOperationDefinition();const e=this.peekDescription(),i=e?this._lexer.lookahead():this._lexer.token;if(i.kind===ai.NAME){switch(i.value){case"schema":return this.parseSchemaDefinition();case"scalar":return this.parseScalarTypeDefinition();case"type":return this.parseObjectTypeDefinition();case"interface":return this.parseInterfaceTypeDefinition();case"union":return this.parseUnionTypeDefinition();case"enum":return this.parseEnumTypeDefinition();case"input":return this.parseInputObjectTypeDefinition();case"directive":return this.parseDirectiveDefinition()}if(e)throw Ra(this._lexer.source,this._lexer.token.start,"Unexpected description, descriptions are supported only on type definitions.");switch(i.value){case"query":case"mutation":case"subscription":return this.parseOperationDefinition();case"fragment":return this.parseFragmentDefinition();case"extend":return this.parseTypeSystemExtension()}}throw this.unexpected(i)}parseOperationDefinition(){const e=this._lexer.token;if(this.peek(ai.BRACE_L))return this.node(e,{kind:Pr.OPERATION_DEFINITION,operation:Op.QUERY,name:void 0,variableDefinitions:[],directives:[],selectionSet:this.parseSelectionSet()});const i=this.parseOperationType();let n;return this.peek(ai.NAME)&&(n=this.parseName()),this.node(e,{kind:Pr.OPERATION_DEFINITION,operation:i,name:n,variableDefinitions:this.parseVariableDefinitions(),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()})}parseOperationType(){const e=this.expectToken(ai.NAME);switch(e.value){case"query":return Op.QUERY;case"mutation":return Op.MUTATION;case"subscription":return Op.SUBSCRIPTION}throw this.unexpected(e)}parseVariableDefinitions(){return this.optionalMany(ai.PAREN_L,this.parseVariableDefinition,ai.PAREN_R)}parseVariableDefinition(){return this.node(this._lexer.token,{kind:Pr.VARIABLE_DEFINITION,variable:this.parseVariable(),type:(this.expectToken(ai.COLON),this.parseTypeReference()),defaultValue:this.expectOptionalToken(ai.EQUALS)?this.parseConstValueLiteral():void 0,directives:this.parseConstDirectives()})}parseVariable(){const e=this._lexer.token;return this.expectToken(ai.DOLLAR),this.node(e,{kind:Pr.VARIABLE,name:this.parseName()})}parseSelectionSet(){return this.node(this._lexer.token,{kind:Pr.SELECTION_SET,selections:this.many(ai.BRACE_L,this.parseSelection,ai.BRACE_R)})}parseSelection(){return this.peek(ai.SPREAD)?this.parseFragment():this.parseField()}parseField(){const e=this._lexer.token,i=this.parseName();let n,s;return this.expectOptionalToken(ai.COLON)?(n=i,s=this.parseName()):s=i,this.node(e,{kind:Pr.FIELD,alias:n,name:s,arguments:this.parseArguments(!1),directives:this.parseDirectives(!1),selectionSet:this.peek(ai.BRACE_L)?this.parseSelectionSet():void 0})}parseArguments(e){const i=e?this.parseConstArgument:this.parseArgument;return this.optionalMany(ai.PAREN_L,i,ai.PAREN_R)}parseArgument(e=!1){const i=this._lexer.token,n=this.parseName();return this.expectToken(ai.COLON),this.node(i,{kind:Pr.ARGUMENT,name:n,value:this.parseValueLiteral(e)})}parseConstArgument(){return this.parseArgument(!0)}parseFragment(){const e=this._lexer.token;this.expectToken(ai.SPREAD);const i=this.expectOptionalKeyword("on");return!i&&this.peek(ai.NAME)?this.node(e,{kind:Pr.FRAGMENT_SPREAD,name:this.parseFragmentName(),directives:this.parseDirectives(!1)}):this.node(e,{kind:Pr.INLINE_FRAGMENT,typeCondition:i?this.parseNamedType():void 0,directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()})}parseFragmentDefinition(){const e=this._lexer.token;return this.expectKeyword("fragment"),this._options.allowLegacyFragmentVariables===!0?this.node(e,{kind:Pr.FRAGMENT_DEFINITION,name:this.parseFragmentName(),variableDefinitions:this.parseVariableDefinitions(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()}):this.node(e,{kind:Pr.FRAGMENT_DEFINITION,name:this.parseFragmentName(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()})}parseFragmentName(){if(this._lexer.token.value==="on")throw this.unexpected();return this.parseName()}parseValueLiteral(e){const i=this._lexer.token;switch(i.kind){case ai.BRACKET_L:return this.parseList(e);case ai.BRACE_L:return this.parseObject(e);case ai.INT:return this.advanceLexer(),this.node(i,{kind:Pr.INT,value:i.value});case ai.FLOAT:return this.advanceLexer(),this.node(i,{kind:Pr.FLOAT,value:i.value});case ai.STRING:case ai.BLOCK_STRING:return this.parseStringLiteral();case ai.NAME:switch(this.advanceLexer(),i.value){case"true":return this.node(i,{kind:Pr.BOOLEAN,value:!0});case"false":return this.node(i,{kind:Pr.BOOLEAN,value:!1});case"null":return this.node(i,{kind:Pr.NULL});default:return this.node(i,{kind:Pr.ENUM,value:i.value})}case ai.DOLLAR:if(e)if(this.expectToken(ai.DOLLAR),this._lexer.token.kind===ai.NAME){const n=this._lexer.token.value;throw Ra(this._lexer.source,i.start,`Unexpected variable "$${n}" in constant value.`)}else throw this.unexpected(i);return this.parseVariable();default:throw this.unexpected()}}parseConstValueLiteral(){return this.parseValueLiteral(!0)}parseStringLiteral(){const e=this._lexer.token;return this.advanceLexer(),this.node(e,{kind:Pr.STRING,value:e.value,block:e.kind===ai.BLOCK_STRING})}parseList(e){const i=()=>this.parseValueLiteral(e);return this.node(this._lexer.token,{kind:Pr.LIST,values:this.any(ai.BRACKET_L,i,ai.BRACKET_R)})}parseObject(e){const i=()=>this.parseObjectField(e);return this.node(this._lexer.token,{kind:Pr.OBJECT,fields:this.any(ai.BRACE_L,i,ai.BRACE_R)})}parseObjectField(e){const i=this._lexer.token,n=this.parseName();return this.expectToken(ai.COLON),this.node(i,{kind:Pr.OBJECT_FIELD,name:n,value:this.parseValueLiteral(e)})}parseDirectives(e){const i=[];for(;this.peek(ai.AT);)i.push(this.parseDirective(e));return i}parseConstDirectives(){return this.parseDirectives(!0)}parseDirective(e){const i=this._lexer.token;return this.expectToken(ai.AT),this.node(i,{kind:Pr.DIRECTIVE,name:this.parseName(),arguments:this.parseArguments(e)})}parseTypeReference(){const e=this._lexer.token;let i;if(this.expectOptionalToken(ai.BRACKET_L)){const n=this.parseTypeReference();this.expectToken(ai.BRACKET_R),i=this.node(e,{kind:Pr.LIST_TYPE,type:n})}else i=this.parseNamedType();return this.expectOptionalToken(ai.BANG)?this.node(e,{kind:Pr.NON_NULL_TYPE,type:i}):i}parseNamedType(){return this.node(this._lexer.token,{kind:Pr.NAMED_TYPE,name:this.parseName()})}peekDescription(){return this.peek(ai.STRING)||this.peek(ai.BLOCK_STRING)}parseDescription(){if(this.peekDescription())return this.parseStringLiteral()}parseSchemaDefinition(){const e=this._lexer.token,i=this.parseDescription();this.expectKeyword("schema");const n=this.parseConstDirectives(),s=this.many(ai.BRACE_L,this.parseOperationTypeDefinition,ai.BRACE_R);return this.node(e,{kind:Pr.SCHEMA_DEFINITION,description:i,directives:n,operationTypes:s})}parseOperationTypeDefinition(){const e=this._lexer.token,i=this.parseOperationType();this.expectToken(ai.COLON);const n=this.parseNamedType();return this.node(e,{kind:Pr.OPERATION_TYPE_DEFINITION,operation:i,type:n})}parseScalarTypeDefinition(){const e=this._lexer.token,i=this.parseDescription();this.expectKeyword("scalar");const n=this.parseName(),s=this.parseConstDirectives();return this.node(e,{kind:Pr.SCALAR_TYPE_DEFINITION,description:i,name:n,directives:s})}parseObjectTypeDefinition(){const e=this._lexer.token,i=this.parseDescription();this.expectKeyword("type");const n=this.parseName(),s=this.parseImplementsInterfaces(),o=this.parseConstDirectives(),l=this.parseFieldsDefinition();return this.node(e,{kind:Pr.OBJECT_TYPE_DEFINITION,description:i,name:n,interfaces:s,directives:o,fields:l})}parseImplementsInterfaces(){return this.expectOptionalKeyword("implements")?this.delimitedMany(ai.AMP,this.parseNamedType):[]}parseFieldsDefinition(){return this.optionalMany(ai.BRACE_L,this.parseFieldDefinition,ai.BRACE_R)}parseFieldDefinition(){const e=this._lexer.token,i=this.parseDescription(),n=this.parseName(),s=this.parseArgumentDefs();this.expectToken(ai.COLON);const o=this.parseTypeReference(),l=this.parseConstDirectives();return this.node(e,{kind:Pr.FIELD_DEFINITION,description:i,name:n,arguments:s,type:o,directives:l})}parseArgumentDefs(){return this.optionalMany(ai.PAREN_L,this.parseInputValueDef,ai.PAREN_R)}parseInputValueDef(){const e=this._lexer.token,i=this.parseDescription(),n=this.parseName();this.expectToken(ai.COLON);const s=this.parseTypeReference();let o;this.expectOptionalToken(ai.EQUALS)&&(o=this.parseConstValueLiteral());const l=this.parseConstDirectives();return this.node(e,{kind:Pr.INPUT_VALUE_DEFINITION,description:i,name:n,type:s,defaultValue:o,directives:l})}parseInterfaceTypeDefinition(){const e=this._lexer.token,i=this.parseDescription();this.expectKeyword("interface");const n=this.parseName(),s=this.parseImplementsInterfaces(),o=this.parseConstDirectives(),l=this.parseFieldsDefinition();return this.node(e,{kind:Pr.INTERFACE_TYPE_DEFINITION,description:i,name:n,interfaces:s,directives:o,fields:l})}parseUnionTypeDefinition(){const e=this._lexer.token,i=this.parseDescription();this.expectKeyword("union");const n=this.parseName(),s=this.parseConstDirectives(),o=this.parseUnionMemberTypes();return this.node(e,{kind:Pr.UNION_TYPE_DEFINITION,description:i,name:n,directives:s,types:o})}parseUnionMemberTypes(){return this.expectOptionalToken(ai.EQUALS)?this.delimitedMany(ai.PIPE,this.parseNamedType):[]}parseEnumTypeDefinition(){const e=this._lexer.token,i=this.parseDescription();this.expectKeyword("enum");const n=this.parseName(),s=this.parseConstDirectives(),o=this.parseEnumValuesDefinition();return this.node(e,{kind:Pr.ENUM_TYPE_DEFINITION,description:i,name:n,directives:s,values:o})}parseEnumValuesDefinition(){return this.optionalMany(ai.BRACE_L,this.parseEnumValueDefinition,ai.BRACE_R)}parseEnumValueDefinition(){const e=this._lexer.token,i=this.parseDescription(),n=this.parseEnumValueName(),s=this.parseConstDirectives();return this.node(e,{kind:Pr.ENUM_VALUE_DEFINITION,description:i,name:n,directives:s})}parseEnumValueName(){if(this._lexer.token.value==="true"||this._lexer.token.value==="false"||this._lexer.token.value==="null")throw Ra(this._lexer.source,this._lexer.token.start,`${A1(this._lexer.token)} is reserved and cannot be used for an enum value.`);return this.parseName()}parseInputObjectTypeDefinition(){const e=this._lexer.token,i=this.parseDescription();this.expectKeyword("input");const n=this.parseName(),s=this.parseConstDirectives(),o=this.parseInputFieldsDefinition();return this.node(e,{kind:Pr.INPUT_OBJECT_TYPE_DEFINITION,description:i,name:n,directives:s,fields:o})}parseInputFieldsDefinition(){return this.optionalMany(ai.BRACE_L,this.parseInputValueDef,ai.BRACE_R)}parseTypeSystemExtension(){const e=this._lexer.lookahead();if(e.kind===ai.NAME)switch(e.value){case"schema":return this.parseSchemaExtension();case"scalar":return this.parseScalarTypeExtension();case"type":return this.parseObjectTypeExtension();case"interface":return this.parseInterfaceTypeExtension();case"union":return this.parseUnionTypeExtension();case"enum":return this.parseEnumTypeExtension();case"input":return this.parseInputObjectTypeExtension()}throw this.unexpected(e)}parseSchemaExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("schema");const i=this.parseConstDirectives(),n=this.optionalMany(ai.BRACE_L,this.parseOperationTypeDefinition,ai.BRACE_R);if(i.length===0&&n.length===0)throw this.unexpected();return this.node(e,{kind:Pr.SCHEMA_EXTENSION,directives:i,operationTypes:n})}parseScalarTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("scalar");const i=this.parseName(),n=this.parseConstDirectives();if(n.length===0)throw this.unexpected();return this.node(e,{kind:Pr.SCALAR_TYPE_EXTENSION,name:i,directives:n})}parseObjectTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("type");const i=this.parseName(),n=this.parseImplementsInterfaces(),s=this.parseConstDirectives(),o=this.parseFieldsDefinition();if(n.length===0&&s.length===0&&o.length===0)throw this.unexpected();return this.node(e,{kind:Pr.OBJECT_TYPE_EXTENSION,name:i,interfaces:n,directives:s,fields:o})}parseInterfaceTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("interface");const i=this.parseName(),n=this.parseImplementsInterfaces(),s=this.parseConstDirectives(),o=this.parseFieldsDefinition();if(n.length===0&&s.length===0&&o.length===0)throw this.unexpected();return this.node(e,{kind:Pr.INTERFACE_TYPE_EXTENSION,name:i,interfaces:n,directives:s,fields:o})}parseUnionTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("union");const i=this.parseName(),n=this.parseConstDirectives(),s=this.parseUnionMemberTypes();if(n.length===0&&s.length===0)throw this.unexpected();return this.node(e,{kind:Pr.UNION_TYPE_EXTENSION,name:i,directives:n,types:s})}parseEnumTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("enum");const i=this.parseName(),n=this.parseConstDirectives(),s=this.parseEnumValuesDefinition();if(n.length===0&&s.length===0)throw this.unexpected();return this.node(e,{kind:Pr.ENUM_TYPE_EXTENSION,name:i,directives:n,values:s})}parseInputObjectTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("input");const i=this.parseName(),n=this.parseConstDirectives(),s=this.parseInputFieldsDefinition();if(n.length===0&&s.length===0)throw this.unexpected();return this.node(e,{kind:Pr.INPUT_OBJECT_TYPE_EXTENSION,name:i,directives:n,fields:s})}parseDirectiveDefinition(){const e=this._lexer.token,i=this.parseDescription();this.expectKeyword("directive"),this.expectToken(ai.AT);const n=this.parseName(),s=this.parseArgumentDefs(),o=this.expectOptionalKeyword("repeatable");this.expectKeyword("on");const l=this.parseDirectiveLocations();return this.node(e,{kind:Pr.DIRECTIVE_DEFINITION,description:i,name:n,arguments:s,repeatable:o,locations:l})}parseDirectiveLocations(){return this.delimitedMany(ai.PIPE,this.parseDirectiveLocation)}parseDirectiveLocation(){const e=this._lexer.token,i=this.parseName();if(Object.prototype.hasOwnProperty.call(SM,i.value))return i;throw this.unexpected(e)}node(e,i){return this._options.noLocation!==!0&&(i.loc=new _ce(e,this._lexer.lastToken,this._lexer.source)),i}peek(e){return this._lexer.token.kind===e}expectToken(e){const i=this._lexer.token;if(i.kind===e)return this.advanceLexer(),i;throw Ra(this._lexer.source,i.start,`Expected ${kF(e)}, found ${A1(i)}.`)}expectOptionalToken(e){return this._lexer.token.kind===e?(this.advanceLexer(),!0):!1}expectKeyword(e){const i=this._lexer.token;if(i.kind===ai.NAME&&i.value===e)this.advanceLexer();else throw Ra(this._lexer.source,i.start,`Expected "${e}", found ${A1(i)}.`)}expectOptionalKeyword(e){const i=this._lexer.token;return i.kind===ai.NAME&&i.value===e?(this.advanceLexer(),!0):!1}unexpected(e){const i=e??this._lexer.token;return Ra(this._lexer.source,i.start,`Unexpected ${A1(i)}.`)}any(e,i,n){this.expectToken(e);const s=[];for(;!this.expectOptionalToken(n);)s.push(i.call(this));return s}optionalMany(e,i,n){if(this.expectOptionalToken(e)){const s=[];do s.push(i.call(this));while(!this.expectOptionalToken(n));return s}return[]}many(e,i,n){this.expectToken(e);const s=[];do s.push(i.call(this));while(!this.expectOptionalToken(n));return s}delimitedMany(e,i){this.expectOptionalToken(e);const n=[];do n.push(i.call(this));while(this.expectOptionalToken(e));return n}advanceLexer(){const{maxTokens:e}=this._options,i=this._lexer.advance();if(e!==void 0&&i.kind!==ai.EOF&&(++this._tokenCounter,this._tokenCounter>e))throw Ra(this._lexer.source,i.start,`Document contains more that ${e} tokens. Parsing aborted.`)}}function A1(r){const e=r.value;return kF(r.kind)+(e!=null?` "${e}"`:"")}function kF(r){return Rce(r)?`"${r}"`:r}function Yce(r){return`"${r.replace(Jce,Zce)}"`}const Jce=/[\x00-\x1f\x22\x5c\x7f-\x9f]/g;function Zce(r){return $ce[r.charCodeAt(0)]}const $ce=["\\u0000","\\u0001","\\u0002","\\u0003","\\u0004","\\u0005","\\u0006","\\u0007","\\b","\\t","\\n","\\u000B","\\f","\\r","\\u000E","\\u000F","\\u0010","\\u0011","\\u0012","\\u0013","\\u0014","\\u0015","\\u0016","\\u0017","\\u0018","\\u0019","\\u001A","\\u001B","\\u001C","\\u001D","\\u001E","\\u001F","","",'\\"',"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","\\\\","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","\\u007F","\\u0080","\\u0081","\\u0082","\\u0083","\\u0084","\\u0085","\\u0086","\\u0087","\\u0088","\\u0089","\\u008A","\\u008B","\\u008C","\\u008D","\\u008E","\\u008F","\\u0090","\\u0091","\\u0092","\\u0093","\\u0094","\\u0095","\\u0096","\\u0097","\\u0098","\\u0099","\\u009A","\\u009B","\\u009C","\\u009D","\\u009E","\\u009F"],eue=Object.freeze({});function tue(r,e,i=MF){const n=new Map;for(const _ of Object.values(Pr))n.set(_,iue(e,_));let s,o=Array.isArray(r),l=[r],u=-1,c=[],h=r,p,f;const g=[],m=[];do{u++;const _=u===l.length,C=_&&c.length!==0;if(_){if(p=m.length===0?void 0:g[g.length-1],h=f,f=m.pop(),C)if(o){h=h.slice();let T=0;for(const[R,B]of c){const I=R-T;B===null?(h.splice(I,1),T++):h[I]=B}}else{h=Object.defineProperties({},Object.getOwnPropertyDescriptors(h));for(const[T,R]of c)h[T]=R}u=s.index,l=s.keys,c=s.edits,o=s.inArray,s=s.prev}else if(f){if(p=o?u:l[u],h=f[p],h==null)continue;g.push(p)}let E;if(!Array.isArray(h)){var y,b;RF(h)||f1(!1,`Invalid AST Node: ${RM(h)}.`);const T=_?(y=n.get(h.kind))===null||y===void 0?void 0:y.leave:(b=n.get(h.kind))===null||b===void 0?void 0:b.enter;if(E=T==null?void 0:T.call(e,h,p,f,g,m),E===eue)break;if(E===!1){if(!_){g.pop();continue}}else if(E!==void 0&&(c.push([p,E]),!_))if(RF(E))h=E;else{g.pop();continue}}if(E===void 0&&C&&c.push([p,h]),_)g.pop();else{var v;s={inArray:o,index:u,keys:l,edits:c,prev:s},o=Array.isArray(h),l=o?h:(v=i[h.kind])!==null&&v!==void 0?v:[],u=-1,c=[],f&&m.push(f),f=h}}while(s!==void 0);return c.length!==0?c[c.length-1][1]:r}function iue(r,e){const i=r[e];return typeof i=="object"?i:typeof i=="function"?{enter:i,leave:void 0}:{enter:r.enter,leave:r.leave}}function rue(r){return tue(r,sue)}const nue=80,sue={Name:{leave:r=>r.value},Variable:{leave:r=>"$"+r.name},Document:{leave:r=>Ar(r.definitions,`

`)},OperationDefinition:{leave(r){const e=Tn("(",Ar(r.variableDefinitions,", "),")"),i=Ar([r.operation,Ar([r.name,e]),Ar(r.directives," ")]," ");return(i==="query"?"":i+" ")+r.selectionSet}},VariableDefinition:{leave:({variable:r,type:e,defaultValue:i,directives:n})=>r+": "+e+Tn(" = ",i)+Tn(" ",Ar(n," "))},SelectionSet:{leave:({selections:r})=>gc(r)},Field:{leave({alias:r,name:e,arguments:i,directives:n,selectionSet:s}){const o=Tn("",r,": ")+e;let l=o+Tn("(",Ar(i,", "),")");return l.length>nue&&(l=o+Tn(`(
`,y1(Ar(i,`
`)),`
)`)),Ar([l,Ar(n," "),s]," ")}},Argument:{leave:({name:r,value:e})=>r+": "+e},FragmentSpread:{leave:({name:r,directives:e})=>"..."+r+Tn(" ",Ar(e," "))},InlineFragment:{leave:({typeCondition:r,directives:e,selectionSet:i})=>Ar(["...",Tn("on ",r),Ar(e," "),i]," ")},FragmentDefinition:{leave:({name:r,typeCondition:e,variableDefinitions:i,directives:n,selectionSet:s})=>`fragment ${r}${Tn("(",Ar(i,", "),")")} on ${e} ${Tn("",Ar(n," ")," ")}`+s},IntValue:{leave:({value:r})=>r},FloatValue:{leave:({value:r})=>r},StringValue:{leave:({value:r,block:e})=>e?Tce(r):Yce(r)},BooleanValue:{leave:({value:r})=>r?"true":"false"},NullValue:{leave:()=>"null"},EnumValue:{leave:({value:r})=>r},ListValue:{leave:({values:r})=>"["+Ar(r,", ")+"]"},ObjectValue:{leave:({fields:r})=>"{"+Ar(r,", ")+"}"},ObjectField:{leave:({name:r,value:e})=>r+": "+e},Directive:{leave:({name:r,arguments:e})=>"@"+r+Tn("(",Ar(e,", "),")")},NamedType:{leave:({name:r})=>r},ListType:{leave:({type:r})=>"["+r+"]"},NonNullType:{leave:({type:r})=>r+"!"},SchemaDefinition:{leave:({description:r,directives:e,operationTypes:i})=>Tn("",r,`
`)+Ar(["schema",Ar(e," "),gc(i)]," ")},OperationTypeDefinition:{leave:({operation:r,type:e})=>r+": "+e},ScalarTypeDefinition:{leave:({description:r,name:e,directives:i})=>Tn("",r,`
`)+Ar(["scalar",e,Ar(i," ")]," ")},ObjectTypeDefinition:{leave:({description:r,name:e,interfaces:i,directives:n,fields:s})=>Tn("",r,`
`)+Ar(["type",e,Tn("implements ",Ar(i," & ")),Ar(n," "),gc(s)]," ")},FieldDefinition:{leave:({description:r,name:e,arguments:i,type:n,directives:s})=>Tn("",r,`
`)+e+(FF(i)?Tn(`(
`,y1(Ar(i,`
`)),`
)`):Tn("(",Ar(i,", "),")"))+": "+n+Tn(" ",Ar(s," "))},InputValueDefinition:{leave:({description:r,name:e,type:i,defaultValue:n,directives:s})=>Tn("",r,`
`)+Ar([e+": "+i,Tn("= ",n),Ar(s," ")]," ")},InterfaceTypeDefinition:{leave:({description:r,name:e,interfaces:i,directives:n,fields:s})=>Tn("",r,`
`)+Ar(["interface",e,Tn("implements ",Ar(i," & ")),Ar(n," "),gc(s)]," ")},UnionTypeDefinition:{leave:({description:r,name:e,directives:i,types:n})=>Tn("",r,`
`)+Ar(["union",e,Ar(i," "),Tn("= ",Ar(n," | "))]," ")},EnumTypeDefinition:{leave:({description:r,name:e,directives:i,values:n})=>Tn("",r,`
`)+Ar(["enum",e,Ar(i," "),gc(n)]," ")},EnumValueDefinition:{leave:({description:r,name:e,directives:i})=>Tn("",r,`
`)+Ar([e,Ar(i," ")]," ")},InputObjectTypeDefinition:{leave:({description:r,name:e,directives:i,fields:n})=>Tn("",r,`
`)+Ar(["input",e,Ar(i," "),gc(n)]," ")},DirectiveDefinition:{leave:({description:r,name:e,arguments:i,repeatable:n,locations:s})=>Tn("",r,`
`)+"directive @"+e+(FF(i)?Tn(`(
`,y1(Ar(i,`
`)),`
)`):Tn("(",Ar(i,", "),")"))+(n?" repeatable":"")+" on "+Ar(s," | ")},SchemaExtension:{leave:({directives:r,operationTypes:e})=>Ar(["extend schema",Ar(r," "),gc(e)]," ")},ScalarTypeExtension:{leave:({name:r,directives:e})=>Ar(["extend scalar",r,Ar(e," ")]," ")},ObjectTypeExtension:{leave:({name:r,interfaces:e,directives:i,fields:n})=>Ar(["extend type",r,Tn("implements ",Ar(e," & ")),Ar(i," "),gc(n)]," ")},InterfaceTypeExtension:{leave:({name:r,interfaces:e,directives:i,fields:n})=>Ar(["extend interface",r,Tn("implements ",Ar(e," & ")),Ar(i," "),gc(n)]," ")},UnionTypeExtension:{leave:({name:r,directives:e,types:i})=>Ar(["extend union",r,Ar(e," "),Tn("= ",Ar(i," | "))]," ")},EnumTypeExtension:{leave:({name:r,directives:e,values:i})=>Ar(["extend enum",r,Ar(e," "),gc(i)]," ")},InputObjectTypeExtension:{leave:({name:r,directives:e,fields:i})=>Ar(["extend input",r,Ar(e," "),gc(i)]," ")}};function Ar(r,e=""){var i;return(i=r==null?void 0:r.filter(n=>n).join(e))!==null&&i!==void 0?i:""}function gc(r){return Tn(`{
`,y1(Ar(r,`
`)),`
}`)}function Tn(r,e,i=""){return e!=null&&e!==""?r+e+i:""}function y1(r){return Tn("  ",r.replace(/\n/g,`
  `))}function FF(r){var e;return(e=r==null?void 0:r.some(i=>i.includes(`
`)))!==null&&e!==void 0?e:!1}const UF="Accept",IM="Content-Type",BM="application/json",zF="application/graphql-response+json",jF=r=>r.replace(/([\s,]|#[^\n\r]+)+/g," ").trim(),aue=r=>{const e=r.toLowerCase();return e.includes(zF)||e.includes(BM)},GF=r=>{try{if(Array.isArray(r))return{_tag:"Batch",executionResults:r.map(VF)};if(p1(r))return{_tag:"Single",executionResult:VF(r)};throw new Error(`Invalid execution result: result is not object or array. 
Got:
${String(r)}`)}catch(e){return e}},VF=r=>{if(typeof r!="object"||r===null)throw new Error("Invalid execution result: result is not object");let e,i,n;if("errors"in r){if(!p1(r.errors)&&!Array.isArray(r.errors))throw new Error("Invalid execution result: errors is not plain object OR array");e=r.errors}if("data"in r){if(!p1(r.data)&&r.data!==null)throw new Error("Invalid execution result: data is not plain object");i=r.data}if("extensions"in r){if(!p1(r.extensions))throw new Error("Invalid execution result: extensions is not plain object");n=r.extensions}return{data:i,errors:e,extensions:n}},oue=r=>r._tag==="Batch"?r.executionResults.some(HF):HF(r.executionResult),HF=r=>Array.isArray(r.errors)?r.errors.length>0:!!r.errors,WF=r=>typeof r=="object"&&r!==null&&"kind"in r&&r.kind===Pr.OPERATION_DEFINITION,lue=r=>{var e;let i;const n=r.definitions.filter(WF);return n.length===1&&(i=(e=n[0].name)==null?void 0:e.value),i},cue=r=>{let e=!1;const i=r.definitions.filter(WF);return i.length===1&&(e=i[0].operation===Op.MUTATION),e},NM=(r,e)=>{const i=typeof r=="string"?r:rue(r);let n=!1,s;if(e)return{expression:i,isMutation:n,operationName:s};const o=pce(()=>typeof r=="string"?Xce(r):r);return o instanceof Error?{expression:i,isMutation:n,operationName:s}:(s=lue(o),n=cue(o),{expression:i,operationName:s,isMutation:n})},LM=JSON,DM=async r=>{const e={...r,method:r.request._tag==="Single"?r.request.document.isMutation?"POST":xF(r.method??"post"):r.request.hasMutations?"POST":xF(r.method??"post"),fetchOptions:{...r.fetchOptions,errorPolicy:r.fetchOptions.errorPolicy??"none"}},i=await hue(e.method)(e);if(!i.ok)return new eg({status:i.status,headers:i.headers},{query:r.request._tag==="Single"?r.request.document.expression:r.request.query,variables:r.request.variables});const n=await uue(i,r.fetchOptions.jsonSerializer??LM);if(n instanceof Error)throw n;const s={status:i.status,headers:i.headers};if(oue(n)&&e.fetchOptions.errorPolicy==="none"){const o=n._tag==="Batch"?{...n.executionResults,...s}:{...n.executionResult,...s};return new eg(o,{query:r.request._tag==="Single"?r.request.document.expression:r.request.query,variables:r.request.variables})}switch(n._tag){case"Single":return{...s,...QF(e)(n.executionResult)};case"Batch":return{...s,data:n.executionResults.map(QF(e))};default:EM(n)}},QF=r=>e=>({extensions:e.extensions,data:e.data,errors:r.fetchOptions.errorPolicy==="all"?e.errors:void 0}),uue=async(r,e)=>{const i=r.headers.get(IM),n=await r.text();return i&&aue(i)?GF(e.parse(n)):GF(n)},hue=r=>async e=>{const i=new Headers(e.headers);let n=null,s;i.has(UF)||i.set(UF,[zF,BM].join(", ")),r==="POST"?(s=(e.fetchOptions.jsonSerializer??LM).stringify(due(e)),typeof s=="string"&&!i.has(IM)&&i.set(IM,BM)):n=pue(e);const o={method:r,headers:i,body:s,...e.fetchOptions};let l=new URL(e.url),u=o;if(e.middleware){const c=await Promise.resolve(e.middleware({...o,url:e.url,operationName:e.request._tag==="Single"?e.request.document.operationName:void 0,variables:e.request.variables})),{url:h,...p}=c;l=new URL(h),u=p}return n&&n.forEach((c,h)=>{l.searchParams.append(h,c)}),await(e.fetch??fetch)(l,u)},due=r=>{switch(r.request._tag){case"Single":return{query:r.request.document.expression,variables:r.request.variables,operationName:r.request.document.operationName};case"Batch":return _F(r.request.query,r.request.variables??[]).map(([e,i])=>({query:e,variables:i}));default:throw EM(r.request)}},pue=r=>{var e;const i=r.fetchOptions.jsonSerializer??LM,n=new URLSearchParams;switch(r.request._tag){case"Single":return n.append("query",jF(r.request.document.expression)),r.request.variables&&n.append("variables",i.stringify(r.request.variables)),r.request.document.operationName&&n.append("operationName",r.request.document.operationName),n;case"Batch":{const s=((e=r.request.variables)==null?void 0:e.map(u=>i.stringify(u)))??[],o=r.request.query.map(jF),l=_F(o,s).map(([u,c])=>({query:u,variables:c}));return n.append("query",i.stringify(l)),n}default:throw EM(r.request)}};class qF{constructor(e,i={}){X0(this,"url"),X0(this,"requestConfig"),X0(this,"rawRequest",async(...n)=>{const[s,o,l]=n,u=gce(s,o,l),{headers:c,fetch:h=globalThis.fetch,method:p="POST",requestMiddleware:f,responseMiddleware:g,excludeOperationName:m,...y}=this.requestConfig,{url:b}=this;u.signal!==void 0&&(y.signal=u.signal);const v=NM(u.query,m),_=await DM({url:b,request:{_tag:"Single",document:v,variables:u.variables},headers:{...tg(_M(c)),...tg(u.requestHeaders)},fetch:h,method:p,fetchOptions:y,middleware:f});if(g&&await g(_,{operationName:v.operationName,variables:o,url:this.url}),_ instanceof Error)throw _;return _}),this.url=e,this.requestConfig=i}async request(e,...i){const[n,s]=i,o=fue(e,n,s),{headers:l,fetch:u=globalThis.fetch,method:c="POST",requestMiddleware:h,responseMiddleware:p,excludeOperationName:f,...g}=this.requestConfig,{url:m}=this;o.signal!==void 0&&(g.signal=o.signal);const y=NM(o.document,f),b=await DM({url:m,request:{_tag:"Single",document:y,variables:o.variables},headers:{...tg(_M(l)),...tg(o.requestHeaders)},fetch:u,method:c,fetchOptions:g,middleware:h});if(p&&await p(b,{operationName:y.operationName,variables:o.variables,url:this.url}),b instanceof Error)throw b;return b.data}async batchRequests(e,i){const n=mce(e,i),{headers:s,excludeOperationName:o,...l}=this.requestConfig;n.signal!==void 0&&(l.signal=n.signal);const u=n.documents.map(({document:g})=>NM(g,o)),c=u.map(({expression:g})=>g),h=u.some(({isMutation:g})=>g),p=n.documents.map(({variables:g})=>g),f=await DM({url:this.url,request:{_tag:"Batch",operationName:void 0,query:c,hasMutations:h,variables:p},headers:{...tg(_M(s)),...tg(n.requestHeaders)},fetch:this.requestConfig.fetch??globalThis.fetch,method:this.requestConfig.method||"POST",fetchOptions:l,middleware:this.requestConfig.requestMiddleware});if(this.requestConfig.responseMiddleware&&await this.requestConfig.responseMiddleware(f,{operationName:void 0,variables:p,url:this.url}),f instanceof Error)throw f;return f.data}setHeaders(e){return this.requestConfig.headers=e,this}setHeader(e,i){const{headers:n}=this.requestConfig;return n?n[e]=i:this.requestConfig.headers={[e]:i},this}setEndpoint(e){return this.url=e,this}}const fue=(r,e,i)=>r.document?r:{document:r,variables:e,requestHeaders:i,signal:void 0},Ac=(r,...e)=>r.reduce((i,n,s)=>`${i}${n}${s in e?String(e[s]):""}`,""),XF={base:{url:" https://prod.base.intuition-api.com/v1/graphql",displayName:"Base Mainnet"}},ty=r=>new qF(XF[r].url),mue=async(r,e="baseSepolia")=>{const i=ty(e);let n;n=Ac`
    query GetAtom($atomId: numeric!) {
      atom(id: $atomId) {
        id
        image
        label
        emoji
        type
        creator_id
        vault {
          total_shares
        }
      }
    }
  `;const s={atomId:r};try{return(await i.request(n,s)).atom}catch(o){throw console.error("Error fetching atom details:",o),o}},gue=async(r="baseSepolia")=>{const e=ty(r);let i,n;return i=Ac`
    query {
      triples(limit: 1000) {
        id
        subject {
          label
          id
          creator_id
          type
        }
        predicate {
          label
          id
          creator_id
          type
        }
        object {
          label
          id
          creator_id
          type
        }
      }
    }
  `,n=await e.request(i),{items:n.triples}.items},Aue=async(r,e="baseSepolia")=>{const i=ty(e);let n,s,o;return n=Ac`
    query Triples($where: triples_bool_exp) {
      triples(where: $where) {
        id
        subject {
          label
          id
          creator_id
          type
        }
        predicate {
          label
          id
          creator_id
          type
        }
        object {
          label
          id
          creator_id
          type
        }
      }
    }
  `,o={where:{_or:[{predicate_id:{_eq:r}},{subject_id:{_eq:r}},{object_id:{_eq:r}}]}},s=await i.request(n,o),s.triples},yue=async(r,e="baseSepolia")=>{const i=ty(e),n=Ac`
    query SearchTriples($where: triples_bool_exp) {
      triples(where: $where) {
        id
        subject {
          label
          id
          creator_id
          type
        }
        predicate {
          label
          id
          creator_id
          type
        }
        object {
          label
          id
          creator_id
          type
        }
      }
    }
  `,s={_and:[]};r.subject&&s._and.push({subject:{label:{_ilike:`%${r.subject}%`}}}),r.predicate&&s._and.push({predicate:{label:{_ilike:`%${r.predicate}%`}}}),r.object&&s._and.push({object:{label:{_ilike:`%${r.object}%`}}});const o={where:s._and.length>0?s:{}};console.log("Executing search query with variables:",o);try{const l=await i.request(n,o);return console.log("Search query response:",l),l.triples}catch(l){throw console.error("Error executing search query:",l),l}},KF=Object.freeze(Object.defineProperty({__proto__:null,ENDPOINTS:XF,createClient:ty,fetchAtomDetails:mue,fetchTriples:gue,fetchTriplesForNode:Aue,searchTriples:yue},Symbol.toStringTag,{value:"Module"})),YF={baseSepolia:{url:"https://dev.base-sepolia.intuition-api.com/v1/graphql",displayName:"Base Testnet"}},ud=r=>new qF(YF[r].url),vue=async(r,e="baseSepolia")=>{const i=ud(e);let n;n=Ac`
    query GetAtom($atomId: numeric!) {
      atom(id: $atomId) {
        id
        image
        label
        emoji
        type
        creator_id
        vault {
          total_shares
        }
      }
    }
  `;const s={atomId:r};try{return(await i.request(n,s)).atom}catch(o){throw console.error("Error fetching atom details:",o),o}},JF=async(r="baseSepolia")=>{const e=ud(r);let i,n;return i=Ac`
    query {
      triples(limit: 1000) {
        id
        subject {
          label
          id
          creator_id
          type
        }
        predicate {
          label
          id
          creator_id
          type
        }
        object {
          label
          id
          creator_id
          type
        }
      }
    }
  `,n=await e.request(i),{items:n.triples}.items},bue=async(r,e="baseSepolia")=>{const i=ud(e);let n,s,o;return n=Ac`
    query Triples($where: triples_bool_exp) {
      triples(where: $where) {
        id
        subject {
          label
          id
          creator_id
          type
        }
        predicate {
          label
          id
          creator_id
          type
        }
        object {
          label
          id
          creator_id
          type
        }
      }
    }
  `,o={where:{_or:[{predicate_id:{_eq:r}},{subject_id:{_eq:r}},{object_id:{_eq:r}}]}},s=await i.request(n,o),s.triples},xue=async(r,e="baseSepolia")=>{const i=ud(e),n=Ac`
    query SearchTriples($where: triples_bool_exp) {
      triples(where: $where) {
        id
        subject {
          label
          id
          creator_id
          type
        }
        predicate {
          label
          id
          creator_id
          type
        }
        object {
          label
          id
          creator_id
          type
        }
      }
    }
  `,s={_and:[]};r.subject&&s._and.push({subject:{label:{_ilike:`%${r.subject}%`}}}),r.predicate&&s._and.push({predicate:{label:{_ilike:`%${r.predicate}%`}}}),r.object&&s._and.push({object:{label:{_ilike:`%${r.object}%`}}});const o={where:s._and.length>0?s:{}};console.log("Executing search query with variables:",o);try{const l=await i.request(n,o);return console.log("Search query response:",l),l.triples}catch(l){throw console.error("Error executing search query:",l),l}},ZF=async(r,e="baseSepolia")=>{const i=ud(e),n=Ac`
    query ClaimsByAccount($accountId: String!) {
      claims(where: { account_id: { _eq: $accountId } }) {
        id
        account_id
        counter_shares
        counter_vault_id
        object_id
        predicate_id
        shares
        subject_id
        triple_id
        vault_id
      }
    }
  `,s={accountId:r};return(await i.request(n,s)).claims},$F=async(r,e="baseSepolia")=>{const i=ud(e),n=Ac`
    query TriplesByCreator($creatorId: String!) {
      triples(where: { creator_id: { _eq: $creatorId } }) {
        id
        subject {
          label
          id
        }
        predicate {
          label
          id
        }
        object {
          label
          id
        }
      }
    }
  `,s={creatorId:r};return(await i.request(n,s)).triples},eU=async(r,e="baseSepolia",i=1e3)=>{const n=ud(e),s=Ac`
    query Claims_for_Agent(
      $objectId: numeric!,
      $batchSize: Int!
    ) {
      claims(
        limit: $batchSize,
        where: { object_id: { _eq: $objectId } }
      ) {
        subject {
          id
          label
          as_subject_claims {
            predicate {
              label
              id
            }
            object {
              label
              id
            }
          }
        }
      }
    }
  `,o={batchSize:i,objectId:r};try{return(await n.request(s,o)).claims.flatMap(l=>!l.subject.as_subject_claims||l.subject.as_subject_claims.length===0?[{id:`${l.subject.id}-connected-to-${r}`,subject:{id:l.subject.id,label:l.subject.label,type:"agent"},predicate:{id:null,label:"connected to",type:"relation"},object:{id:r,label:"Agent",type:"agent"}}]:l.subject.as_subject_claims.map(u=>({id:`${l.subject.id}-${u.predicate.label}-${u.object.label}`,subject:{id:l.subject.id,label:l.subject.label,type:"agent"},predicate:{id:u.predicate.id||null,label:u.predicate.label,type:"relation"},object:{id:u.object.id||null,label:u.object.label,type:"concept"}})))}catch(l){return console.error("Error fetching agent-specific triples:",l),JF(e).then(u=>u.filter(c=>c.subject.id===r||c.object.id===r||c.predicate.id===r)).catch(u=>{throw console.error("Fallback fetch also failed:",u),l})}},_ue=Object.freeze(Object.defineProperty({__proto__:null,ENDPOINTS:YF,createClient:ud,fetchAtomDetails:vue,fetchClaimsByAccount:ZF,fetchTriples:JF,fetchTriplesByCreator:$F,fetchTriplesForAgent:eU,fetchTriplesForNode:bue,searchTriples:xue},Symbol.toStringTag,{value:"Module"})),OM={railsMockApi:{url:"https://api-i7n.thp-lab.org/api/v1/graph",displayName:"[OffChain] Playground API",module:KF},baseSepolia:{url:"https://api.i7n.dev/v1/graphql",displayName:"Base Testnet",module:_ue},base:{url:"https://prod.base.intuition-api.com/v1/graphql",displayName:"Base Mainnet",module:KF}},v1=r=>{if(!OM[r]||!OM[r].module)throw new Error(`No module defined for endpoint '${r}'.`);return OM[r].module},PM=async(r="base")=>{const e=v1(r);try{return e.fetchTriples(r)}catch(i){throw console.error(`Error fetching triples for endpoint ${r}:`,i),i}},Eue=async(r,e="base")=>{const i=v1(e);try{return i.fetchTriplesForNode(r,e)}catch(n){throw console.error(`Error fetching triples for node ${r} with endpoint ${e}:`,n),n}},wue=async(r,e="base")=>{const i=v1(e);try{return i.fetchAtomDetails(r,e)}catch(n){throw console.error(`Error fetching atom details for ${r} with endpoint ${e}:`,n),n}},Cue=async(r,e="base")=>{const i=v1(e);try{return i.searchTriples(r,e)}catch(n){throw console.error(`Error searching triples with endpoint ${e}:`,n),n}},Sue=async(r,e="baseSepolia")=>ZF(r,e),Tue=async(r,e="baseSepolia")=>$F(r,e),Mue=async(r,e="baseSepolia",i=1e3)=>eU(r,e,i),kM=({triple:r,endpoint:e,onClose:i})=>{var n,s;const[o,l]=Dt.useState(null),[u,c]=Dt.useState(null),[h,p]=Dt.useState(!1),[f,g]=Dt.useState(null);console.log("NodeDetailsSidebar rendering with triple:",r),Dt.useEffect(()=>{r&&(console.log("NodeDetailsSidebar fetching data for triple:",r),p(!0),g(null),c(null),(async()=>{try{console.log("Received triple:",r);const v=(await PM(e)).filter(_=>{var C,E,T;return _.id===r.id||((C=_.subject)==null?void 0:C.id)===r.id||((E=_.predicate)==null?void 0:E.id)===r.id||((T=_.object)==null?void 0:T.id)===r.id});if(l(v),r.id){console.log("Fetching atom details for ID:",r.id);const _=await wue(parseInt(r.id),e);console.log("Received atom details:",_),c(_)}}catch(v){console.error("Error fetching sidebar data:",v),g("Failed to fetch data: "+(v.message||"Unknown error"))}finally{p(!1)}})())},[r,e]);const m=v=>`${(v/1e18).toFixed(4)} ETH`;if(!r)return console.log("No triple provided to sidebar"),null;const y={padding:"20px",color:"#ffd32a",width:"100%",height:"100%",overflowY:"auto",maxHeight:"80vh"},b={position:"absolute",top:"10px",right:"15px",background:"none",border:"none",color:"#ffd32a",fontSize:"32px",fontWeight:"bold",cursor:"pointer",zIndex:1e4};return qe.jsxs("div",{style:y,className:"node-details-sidebar",children:[qe.jsx("h2",{children:r.label||r.id||"Unknown Node"}),qe.jsx("button",{onClick:i,style:b,"aria-label":"Close details",children:"×"}),h&&qe.jsx("p",{className:"loading-indicator",children:"Loading details..."}),f&&qe.jsxs("p",{className:"error-message",children:["Error: ",f]}),qe.jsxs("div",{className:"basic-details",style:{background:"#232328",padding:"12px",borderRadius:"8px",margin:"15px 0",borderLeft:"3px solid #ffe066"},children:[qe.jsxs("p",{children:[qe.jsx("strong",{children:"ID:"})," ",r.id]}),qe.jsxs("p",{children:[qe.jsx("strong",{children:"Type:"})," ",r.type||"N/A"]}),r.color&&qe.jsxs("p",{children:[qe.jsx("strong",{children:"Color:"}),qe.jsx("span",{style:{backgroundColor:r.color,width:20,height:20,display:"inline-block",marginLeft:10,borderRadius:"50%",border:"1px solid rgba(255,255,255,0.3)"}})]})]}),u&&qe.jsxs("div",{className:"atom-details",style:{background:"#232328",padding:"12px",borderRadius:"8px",margin:"15px 0",borderLeft:"3px solid #ffd32a"},children:[qe.jsx("h4",{style:{color:"#ffd32a",fontSize:"18px",marginTop:"0"},children:"Atom Info"}),qe.jsxs("p",{children:[qe.jsx("strong",{children:"ID:"})," ",u.id]}),qe.jsxs("p",{children:[qe.jsx("strong",{children:"Label:"})," ",u.label]}),qe.jsxs("p",{children:[qe.jsx("strong",{children:"Type:"})," ",u.type]}),qe.jsxs("p",{children:[qe.jsx("strong",{children:"Emoji:"})," ",u.emoji||"N/A"]}),qe.jsxs("p",{children:[qe.jsx("strong",{children:"Creator:"})," ",((n=u.creator)==null?void 0:n.label)||"Unknown"]}),qe.jsxs("p",{children:[qe.jsx("strong",{children:"Vault Shares:"})," ",m(((s=u.vault)==null?void 0:s.total_shares)||0)]})]}),o&&o.length>0?qe.jsxs("div",{className:"related-triples",style:{background:"#18181b",border:"1.5px solid #ffd32a",borderRadius:"8px",padding:"14px 12px 10px 12px",marginTop:"20px",maxHeight:"200px",overflowY:"auto"},children:[qe.jsx("h4",{style:{color:"#ffd32a",marginBottom:"10px",fontSize:"15px",fontWeight:"bold"},children:"Related Data:"}),qe.jsx("ul",{style:{listStyle:"none",padding:"0",margin:"0"},children:o.map(v=>{var _,C,E,T,R,B;return qe.jsxs("li",{style:{marginBottom:"10px",background:"#232326",borderRadius:"6px",padding:"6px 10px"},children:[qe.jsx("strong",{children:"Subject:"})," ",((_=v.subject)==null?void 0:_.label)||((C=v.subject)==null?void 0:C.id)||"N/A"," |"," ",qe.jsx("strong",{children:"Predicate:"})," ",((E=v.predicate)==null?void 0:E.label)||((T=v.predicate)==null?void 0:T.id)||"N/A"," |"," ",qe.jsx("strong",{children:"Object:"})," ",((R=v.object)==null?void 0:R.label)||((B=v.object)==null?void 0:B.id)||"N/A"]},v.id)})})]}):!h&&qe.jsx("p",{children:"No additional related data found."}),qe.jsx("button",{style:{background:"rgba(255, 211, 42, 0.9)",color:"#18181b",border:"none",borderRadius:8,width:"100%",height:40,fontSize:16,fontWeight:"bold",boxShadow:"0 2px 8px rgba(0,0,0,0.18)",cursor:"pointer",textTransform:"uppercase",transition:"background 0.2s, color 0.2s, transform 0.1s",marginTop:20},onMouseEnter:v=>v.currentTarget.style.background="rgba(255, 224, 102, 0.9)",onMouseLeave:v=>v.currentTarget.style.background="rgba(255, 211, 42, 0.9)",onClick:i,children:"Close"})]})},Rue=({graphData:r,onNodeClick:e,onBack:i,onForward:n,selectedTriple:s,endpoint:o})=>{const l=Dt.useRef(),u=Dt.useRef(),[c,h]=Dt.useState({width:100,height:100});return Dt.useEffect(()=>{const p=()=>{l.current&&h({width:l.current.clientWidth,height:l.current.clientHeight})};return p(),window.addEventListener("resize",p),()=>window.removeEventListener("resize",p)},[]),Dt.useEffect(()=>{if(u.current&&c.width>0&&c.height>0){const p=bF()(u.current);p.width(c.width).height(c.height).graphData(r).nodeLabel(f=>f.label||f.id).nodeAutoColorBy("group"),e&&p.onNodeClick(f=>{console.log("VR Node clicked inside Graph:",f),e(f)})}},[r,e,c]),qe.jsxs("div",{ref:l,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden"},children:[qe.jsx("div",{ref:u,style:{width:"100%",height:"100%"}}),qe.jsxs("div",{style:{position:"absolute",bottom:20,left:20,zIndex:100},children:[qe.jsx("button",{onClick:i,style:{background:"#ffd32a",color:"#18181b",border:"none",borderRadius:8,padding:"10px 20px",marginRight:10,cursor:"pointer",fontWeight:"bold"},children:"Back"}),qe.jsx("button",{onClick:n,style:{background:"#ffd32a",color:"#18181b",border:"none",borderRadius:8,padding:"10px 20px",cursor:"pointer",fontWeight:"bold"},children:"Forward"})]}),s&&qe.jsx("div",{style:{position:"absolute",top:80,right:30,width:350,zIndex:9999,maxHeight:"80vh",background:"#18181b",borderRadius:"10px",border:"3px solid #ffd32a",boxShadow:"0 8px 30px rgba(0, 0, 0, 0.5)",overflowY:"auto"},children:qe.jsx(kM,{triple:s,endpoint:o,onClose:()=>e(null)})})]})},tU=()=>{const[r,e]=Dt.useState([]),i=200;Dt.useEffect(()=>{let s;const o=()=>{const l=Date.now()/1e3,u=[];for(let c=0;c<3;c++){const h=l*.8+c*2*Math.PI/3;u.push({x:Math.cos(h)*150+200,y:Math.sin(h)*150+200,color:"#00fff2"})}for(let c=0;c<3;c++){const h=-l*1.2+c*2*Math.PI/3;u.push({x:Math.cos(h)*100+200,y:Math.sin(h)*100+200,color:"#ff00ff"})}for(let c=0;c<3;c++){const h=l*1.5+c*2*Math.PI/3;u.push({x:Math.cos(h)*50+200,y:Math.sin(h)*50+200,color:"#ffff00"})}e(u),s=requestAnimationFrame(o)};return o(),()=>cancelAnimationFrame(s)},[]);const n=r.flatMap((s,o)=>r.slice(o+1).map((l,u)=>{const c=l.x-s.x,h=l.y-s.y,p=Math.sqrt(c*c+h*h);if(p<i){const f=1-p/i;return{x1:s.x,y1:s.y,x2:l.x,y2:l.y,opacity:f*.8,gradient:`link-gradient-${o}-${u}`,color1:s.color,color2:l.color}}return null}).filter(Boolean));return qe.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",background:"rgba(0, 0, 0, 0.9)",zIndex:1e3,overflow:"hidden"},children:[qe.jsxs("div",{style:{position:"relative",width:"400px",height:"400px",display:"flex",flexDirection:"column",alignItems:"center"},children:[qe.jsxs("svg",{width:"400",height:"400",children:[qe.jsx("defs",{children:n.map(s=>qe.jsxs("linearGradient",{id:s.gradient,x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[qe.jsx("stop",{offset:"0%",stopColor:s.color1,stopOpacity:s.opacity}),qe.jsx("stop",{offset:"100%",stopColor:s.color2,stopOpacity:s.opacity})]},s.gradient))}),n.map((s,o)=>qe.jsx("line",{x1:s.x1,y1:s.y1,x2:s.x2,y2:s.y2,stroke:`url(#${s.gradient})`,strokeWidth:"3",style:{filter:"brightness(1.5) blur(1px)"}},o))]}),qe.jsx("div",{style:{color:"#00fff2",fontSize:"40px",fontFamily:"sans-serif",letterSpacing:"-2px",textShadow:`
            0 0 5px #00fff2,
            0 0 10px #00fff2,
            0 0 20px #00fff2,
            0 0 40px #00fff2
          `,animation:"textPulse 1.5s ease-in-out infinite",whiteSpace:"nowrap",marginTop:"20px"},children:"Connecting I7n Dots..."})]}),qe.jsx("style",{children:`
          @keyframes textPulse {
            0% { 
              opacity: 0.5;
              transform: scale(0.98) translateY(0);
            }
            50% { 
              opacity: 1;
              transform: scale(1.02) translateY(-5px);
            }
            100% { 
              opacity: 0.5;
              transform: scale(0.98) translateY(0);
            }
          }
        `})]})},Iue=({subjectFilter:r,objectFilter:e,onFilterChange:i,onReset:n})=>qe.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[qe.jsx("input",{className:"agent-navbar",type:"text",value:r,onChange:s=>i("subject",s.target.value),placeholder:"Subject",style:{padding:"5px",borderRadius:"4px",border:"1px solid #ffd32a",fontSize:"14px",width:"150px",background:"#232326",color:"#fff"}}),qe.jsx("input",{className:"agent-navbar",type:"text",value:e,onChange:s=>i("object",s.target.value),placeholder:"Object",style:{padding:"5px",borderRadius:"4px",border:"1px solid #ffd32a",fontSize:"14px",width:"150px",background:"#232326",color:"#fff"}}),qe.jsx("button",{style:{background:"#ffd32a",color:"#18181b",border:"none",borderRadius:12,width:120,height:40,fontSize:15,fontWeight:"bold",boxShadow:"0 2px 8px rgba(0,0,0,0.18)",cursor:"pointer",textTransform:"uppercase",transition:"background 0.2s, color 0.2s, transform 0.1s"},onMouseEnter:s=>s.currentTarget.style.background="#ffe066",onMouseLeave:s=>s.currentTarget.style.background="#ffd32a",onClick:n,children:"Reset"})]});function Bue(r,e){var i=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(i!=null){var n,s,o,l,u=[],c=!0,h=!1;try{if(o=(i=i.call(r)).next,e===0){if(Object(i)!==i)return;c=!1}else for(;!(c=(n=o.call(i)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(p){h=!0,s=p}finally{try{if(!c&&i.return!=null&&(l=i.return(),Object(l)!==l))return}finally{if(h)throw s}}return u}}function Nue(r,e,i){return e=zue(e),e in r?Object.defineProperty(r,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[e]=i,r}function iU(r,e){return Oue(r)||Bue(r,e)||rU(r,e)||Fue()}function Lue(r){return Due(r)||Pue(r)||rU(r)||kue()}function Due(r){if(Array.isArray(r))return FM(r)}function Oue(r){if(Array.isArray(r))return r}function Pue(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function rU(r,e){if(r){if(typeof r=="string")return FM(r,e);var i=Object.prototype.toString.call(r).slice(8,-1);if(i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set")return Array.from(r);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return FM(r,e)}}function FM(r,e){(e==null||e>r.length)&&(e=r.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=r[i];return n}function kue(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Fue(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Uue(r,e){if(typeof r!="object"||r===null)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var n=i.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function zue(r){var e=Uue(r,"string");return typeof e=="symbol"?e:String(e)}var jue=function(r,e){var i=new Set(e);return Object.assign.apply(Object,[{}].concat(Lue(Object.entries(r).filter(function(n){var s=iU(n,1),o=s[0];return!i.has(o)}).map(function(n){var s=iU(n,2),o=s[0],l=s[1];return Nue({},o,l)}))))};function UM(r,e){(e==null||e>r.length)&&(e=r.length);for(var i=0,n=Array(e);i<e;i++)n[i]=r[i];return n}function Gue(r){if(Array.isArray(r))return r}function Vue(r){if(Array.isArray(r))return UM(r)}function Hue(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function Wue(r,e){var i=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(i!=null){var n,s,o,l,u=[],c=!0,h=!1;try{if(o=(i=i.call(r)).next,e!==0)for(;!(c=(n=o.call(i)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(p){h=!0,s=p}finally{try{if(!c&&i.return!=null&&(l=i.return(),Object(l)!==l))return}finally{if(h)throw s}}return u}}function Que(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function que(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Xue(r,e){return Gue(r)||Wue(r,e)||sU(r,e)||Que()}function nU(r){return Vue(r)||Hue(r)||sU(r)||que()}function sU(r,e){if(r){if(typeof r=="string")return UM(r,e);var i={}.toString.call(r).slice(8,-1);return i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set"?Array.from(r):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?UM(r,e):void 0}}function b1(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=e.wrapperElementType,n=i===void 0?"div":i,s=e.nodeMapper,o=s===void 0?function(p){return p}:s,l=e.methodNames,u=l===void 0?[]:l,c=e.initPropNames,h=c===void 0?[]:c;return Dt.forwardRef(function(p,f){var g=Dt.useRef(),m=Dt.useMemo(function(){var v=Object.fromEntries(h.filter(function(_){return p.hasOwnProperty(_)}).map(function(_){return[_,p[_]]}));return r(v)},[]);aU(function(){m(o(g.current))},Dt.useLayoutEffect),aU(function(){return m._destructor instanceof Function?m._destructor:void 0});var y=Dt.useCallback(function(v){for(var _=arguments.length,C=new Array(_>1?_-1:0),E=1;E<_;E++)C[E-1]=arguments[E];return m[v]instanceof Function?m[v].apply(m,C):void 0},[m]),b=Dt.useRef({});return Object.keys(jue(p,[].concat(nU(u),nU(h)))).filter(function(v){return b.current[v]!==p[v]}).forEach(function(v){return y(v,p[v])}),b.current=p,Dt.useImperativeHandle(f,function(){return Object.fromEntries(u.map(function(v){return[v,function(){for(var _=arguments.length,C=new Array(_),E=0;E<_;E++)C[E]=arguments[E];return y.apply(void 0,[v].concat(C))}]}))},[y]),Dt.createElement(n,{ref:g})})}function aU(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Dt.useEffect,i=Dt.useRef(),n=Dt.useRef(!1),s=Dt.useRef(!1),o=Dt.useState(0),l=Xue(o,2);l[0];var u=l[1];n.current&&(s.current=!0),e(function(){return n.current||(i.current=r(),n.current=!0),u(function(c){return c+1}),function(){s.current&&i.current&&i.current()}},[])}var zM={exports:{}},jM={exports:{}},Jn={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var oU;function Kue(){if(oU)return Jn;oU=1;var r=typeof Symbol=="function"&&Symbol.for,e=r?Symbol.for("react.element"):60103,i=r?Symbol.for("react.portal"):60106,n=r?Symbol.for("react.fragment"):60107,s=r?Symbol.for("react.strict_mode"):60108,o=r?Symbol.for("react.profiler"):60114,l=r?Symbol.for("react.provider"):60109,u=r?Symbol.for("react.context"):60110,c=r?Symbol.for("react.async_mode"):60111,h=r?Symbol.for("react.concurrent_mode"):60111,p=r?Symbol.for("react.forward_ref"):60112,f=r?Symbol.for("react.suspense"):60113,g=r?Symbol.for("react.suspense_list"):60120,m=r?Symbol.for("react.memo"):60115,y=r?Symbol.for("react.lazy"):60116,b=r?Symbol.for("react.block"):60121,v=r?Symbol.for("react.fundamental"):60117,_=r?Symbol.for("react.responder"):60118,C=r?Symbol.for("react.scope"):60119;function E(R){if(typeof R=="object"&&R!==null){var B=R.$$typeof;switch(B){case e:switch(R=R.type,R){case c:case h:case n:case o:case s:case f:return R;default:switch(R=R&&R.$$typeof,R){case u:case p:case y:case m:case l:return R;default:return B}}case i:return B}}}function T(R){return E(R)===h}return Jn.AsyncMode=c,Jn.ConcurrentMode=h,Jn.ContextConsumer=u,Jn.ContextProvider=l,Jn.Element=e,Jn.ForwardRef=p,Jn.Fragment=n,Jn.Lazy=y,Jn.Memo=m,Jn.Portal=i,Jn.Profiler=o,Jn.StrictMode=s,Jn.Suspense=f,Jn.isAsyncMode=function(R){return T(R)||E(R)===c},Jn.isConcurrentMode=T,Jn.isContextConsumer=function(R){return E(R)===u},Jn.isContextProvider=function(R){return E(R)===l},Jn.isElement=function(R){return typeof R=="object"&&R!==null&&R.$$typeof===e},Jn.isForwardRef=function(R){return E(R)===p},Jn.isFragment=function(R){return E(R)===n},Jn.isLazy=function(R){return E(R)===y},Jn.isMemo=function(R){return E(R)===m},Jn.isPortal=function(R){return E(R)===i},Jn.isProfiler=function(R){return E(R)===o},Jn.isStrictMode=function(R){return E(R)===s},Jn.isSuspense=function(R){return E(R)===f},Jn.isValidElementType=function(R){return typeof R=="string"||typeof R=="function"||R===n||R===h||R===o||R===s||R===f||R===g||typeof R=="object"&&R!==null&&(R.$$typeof===y||R.$$typeof===m||R.$$typeof===l||R.$$typeof===u||R.$$typeof===p||R.$$typeof===v||R.$$typeof===_||R.$$typeof===C||R.$$typeof===b)},Jn.typeOf=E,Jn}var ns={};/** @license React v16.13.1
 * react-is.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lU;function Yue(){return lU||(lU=1,process.env.NODE_ENV!=="production"&&function(){var r=typeof Symbol=="function"&&Symbol.for,e=r?Symbol.for("react.element"):60103,i=r?Symbol.for("react.portal"):60106,n=r?Symbol.for("react.fragment"):60107,s=r?Symbol.for("react.strict_mode"):60108,o=r?Symbol.for("react.profiler"):60114,l=r?Symbol.for("react.provider"):60109,u=r?Symbol.for("react.context"):60110,c=r?Symbol.for("react.async_mode"):60111,h=r?Symbol.for("react.concurrent_mode"):60111,p=r?Symbol.for("react.forward_ref"):60112,f=r?Symbol.for("react.suspense"):60113,g=r?Symbol.for("react.suspense_list"):60120,m=r?Symbol.for("react.memo"):60115,y=r?Symbol.for("react.lazy"):60116,b=r?Symbol.for("react.block"):60121,v=r?Symbol.for("react.fundamental"):60117,_=r?Symbol.for("react.responder"):60118,C=r?Symbol.for("react.scope"):60119;function E(yt){return typeof yt=="string"||typeof yt=="function"||yt===n||yt===h||yt===o||yt===s||yt===f||yt===g||typeof yt=="object"&&yt!==null&&(yt.$$typeof===y||yt.$$typeof===m||yt.$$typeof===l||yt.$$typeof===u||yt.$$typeof===p||yt.$$typeof===v||yt.$$typeof===_||yt.$$typeof===C||yt.$$typeof===b)}function T(yt){if(typeof yt=="object"&&yt!==null){var Ei=yt.$$typeof;switch(Ei){case e:var $e=yt.type;switch($e){case c:case h:case n:case o:case s:case f:return $e;default:var Ui=$e&&$e.$$typeof;switch(Ui){case u:case p:case y:case m:case l:return Ui;default:return Ei}}case i:return Ei}}}var R=c,B=h,I=u,D=l,L=e,O=p,F=n,q=y,H=m,G=i,J=o,Q=s,V=f,z=!1;function te(yt){return z||(z=!0,console.warn("The ReactIs.isAsyncMode() alias has been deprecated, and will be removed in React 17+. Update your code to use ReactIs.isConcurrentMode() instead. It has the exact same API.")),K(yt)||T(yt)===c}function K(yt){return T(yt)===h}function ae(yt){return T(yt)===u}function Ae(yt){return T(yt)===l}function _e(yt){return typeof yt=="object"&&yt!==null&&yt.$$typeof===e}function me(yt){return T(yt)===p}function Pe(yt){return T(yt)===n}function Xe(yt){return T(yt)===y}function Je(yt){return T(yt)===m}function tt(yt){return T(yt)===i}function dt(yt){return T(yt)===o}function wt(yt){return T(yt)===s}function qt(yt){return T(yt)===f}ns.AsyncMode=R,ns.ConcurrentMode=B,ns.ContextConsumer=I,ns.ContextProvider=D,ns.Element=L,ns.ForwardRef=O,ns.Fragment=F,ns.Lazy=q,ns.Memo=H,ns.Portal=G,ns.Profiler=J,ns.StrictMode=Q,ns.Suspense=V,ns.isAsyncMode=te,ns.isConcurrentMode=K,ns.isContextConsumer=ae,ns.isContextProvider=Ae,ns.isElement=_e,ns.isForwardRef=me,ns.isFragment=Pe,ns.isLazy=Xe,ns.isMemo=Je,ns.isPortal=tt,ns.isProfiler=dt,ns.isStrictMode=wt,ns.isSuspense=qt,ns.isValidElementType=E,ns.typeOf=T}()),ns}var cU;function uU(){return cU||(cU=1,process.env.NODE_ENV==="production"?jM.exports=Kue():jM.exports=Yue()),jM.exports}/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var GM,hU;function Jue(){if(hU)return GM;hU=1;var r=Object.getOwnPropertySymbols,e=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable;function n(o){if(o==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(o)}function s(){try{if(!Object.assign)return!1;var o=new String("abc");if(o[5]="de",Object.getOwnPropertyNames(o)[0]==="5")return!1;for(var l={},u=0;u<10;u++)l["_"+String.fromCharCode(u)]=u;var c=Object.getOwnPropertyNames(l).map(function(p){return l[p]});if(c.join("")!=="0123456789")return!1;var h={};return"abcdefghijklmnopqrst".split("").forEach(function(p){h[p]=p}),Object.keys(Object.assign({},h)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}return GM=s()?Object.assign:function(o,l){for(var u,c=n(o),h,p=1;p<arguments.length;p++){u=Object(arguments[p]);for(var f in u)e.call(u,f)&&(c[f]=u[f]);if(r){h=r(u);for(var g=0;g<h.length;g++)i.call(u,h[g])&&(c[h[g]]=u[h[g]])}}return c},GM}var VM,dU;function HM(){if(dU)return VM;dU=1;var r="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return VM=r,VM}var pU,fU;function mU(){return fU||(fU=1,pU=Function.call.bind(Object.prototype.hasOwnProperty)),pU}var WM,gU;function Zue(){if(gU)return WM;gU=1;var r=function(){};if(process.env.NODE_ENV!=="production"){var e=HM(),i={},n=mU();r=function(o){var l="Warning: "+o;typeof console<"u"&&console.error(l);try{throw new Error(l)}catch{}}}function s(o,l,u,c,h){if(process.env.NODE_ENV!=="production"){for(var p in o)if(n(o,p)){var f;try{if(typeof o[p]!="function"){var g=Error((c||"React class")+": "+u+" type `"+p+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof o[p]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw g.name="Invariant Violation",g}f=o[p](l,p,c,u,null,e)}catch(y){f=y}if(f&&!(f instanceof Error)&&r((c||"React class")+": type specification of "+u+" `"+p+"` is invalid; the type checker function must return `null` or an `Error` but returned a "+typeof f+". You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument)."),f instanceof Error&&!(f.message in i)){i[f.message]=!0;var m=h?h():"";r("Failed "+u+" type: "+f.message+(m??""))}}}}return s.resetWarningCache=function(){process.env.NODE_ENV!=="production"&&(i={})},WM=s,WM}var QM,AU;function $ue(){if(AU)return QM;AU=1;var r=uU(),e=Jue(),i=HM(),n=mU(),s=Zue(),o=function(){};process.env.NODE_ENV!=="production"&&(o=function(u){var c="Warning: "+u;typeof console<"u"&&console.error(c);try{throw new Error(c)}catch{}});function l(){return null}return QM=function(u,c){var h=typeof Symbol=="function"&&Symbol.iterator,p="@@iterator";function f(K){var ae=K&&(h&&K[h]||K[p]);if(typeof ae=="function")return ae}var g="<<anonymous>>",m={array:_("array"),bigint:_("bigint"),bool:_("boolean"),func:_("function"),number:_("number"),object:_("object"),string:_("string"),symbol:_("symbol"),any:C(),arrayOf:E,element:T(),elementType:R(),instanceOf:B,node:O(),objectOf:D,oneOf:I,oneOfType:L,shape:q,exact:H};function y(K,ae){return K===ae?K!==0||1/K===1/ae:K!==K&&ae!==ae}function b(K,ae){this.message=K,this.data=ae&&typeof ae=="object"?ae:{},this.stack=""}b.prototype=Error.prototype;function v(K){if(process.env.NODE_ENV!=="production")var ae={},Ae=0;function _e(Pe,Xe,Je,tt,dt,wt,qt){if(tt=tt||g,wt=wt||Je,qt!==i){if(c){var yt=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use `PropTypes.checkPropTypes()` to call them. Read more at http://fb.me/use-check-prop-types");throw yt.name="Invariant Violation",yt}else if(process.env.NODE_ENV!=="production"&&typeof console<"u"){var Ei=tt+":"+Je;!ae[Ei]&&Ae<3&&(o("You are manually calling a React.PropTypes validation function for the `"+wt+"` prop on `"+tt+"`. This is deprecated and will throw in the standalone `prop-types` package. You may be seeing this warning due to a third-party PropTypes library. See https://fb.me/react-warning-dont-call-proptypes for details."),ae[Ei]=!0,Ae++)}}return Xe[Je]==null?Pe?Xe[Je]===null?new b("The "+dt+" `"+wt+"` is marked as required "+("in `"+tt+"`, but its value is `null`.")):new b("The "+dt+" `"+wt+"` is marked as required in "+("`"+tt+"`, but its value is `undefined`.")):null:K(Xe,Je,tt,dt,wt)}var me=_e.bind(null,!1);return me.isRequired=_e.bind(null,!0),me}function _(K){function ae(Ae,_e,me,Pe,Xe,Je){var tt=Ae[_e],dt=Q(tt);if(dt!==K){var wt=V(tt);return new b("Invalid "+Pe+" `"+Xe+"` of type "+("`"+wt+"` supplied to `"+me+"`, expected ")+("`"+K+"`."),{expectedType:K})}return null}return v(ae)}function C(){return v(l)}function E(K){function ae(Ae,_e,me,Pe,Xe){if(typeof K!="function")return new b("Property `"+Xe+"` of component `"+me+"` has invalid PropType notation inside arrayOf.");var Je=Ae[_e];if(!Array.isArray(Je)){var tt=Q(Je);return new b("Invalid "+Pe+" `"+Xe+"` of type "+("`"+tt+"` supplied to `"+me+"`, expected an array."))}for(var dt=0;dt<Je.length;dt++){var wt=K(Je,dt,me,Pe,Xe+"["+dt+"]",i);if(wt instanceof Error)return wt}return null}return v(ae)}function T(){function K(ae,Ae,_e,me,Pe){var Xe=ae[Ae];if(!u(Xe)){var Je=Q(Xe);return new b("Invalid "+me+" `"+Pe+"` of type "+("`"+Je+"` supplied to `"+_e+"`, expected a single ReactElement."))}return null}return v(K)}function R(){function K(ae,Ae,_e,me,Pe){var Xe=ae[Ae];if(!r.isValidElementType(Xe)){var Je=Q(Xe);return new b("Invalid "+me+" `"+Pe+"` of type "+("`"+Je+"` supplied to `"+_e+"`, expected a single ReactElement type."))}return null}return v(K)}function B(K){function ae(Ae,_e,me,Pe,Xe){if(!(Ae[_e]instanceof K)){var Je=K.name||g,tt=te(Ae[_e]);return new b("Invalid "+Pe+" `"+Xe+"` of type "+("`"+tt+"` supplied to `"+me+"`, expected ")+("instance of `"+Je+"`."))}return null}return v(ae)}function I(K){if(!Array.isArray(K))return process.env.NODE_ENV!=="production"&&(arguments.length>1?o("Invalid arguments supplied to oneOf, expected an array, got "+arguments.length+" arguments. A common mistake is to write oneOf(x, y, z) instead of oneOf([x, y, z])."):o("Invalid argument supplied to oneOf, expected an array.")),l;function ae(Ae,_e,me,Pe,Xe){for(var Je=Ae[_e],tt=0;tt<K.length;tt++)if(y(Je,K[tt]))return null;var dt=JSON.stringify(K,function(wt,qt){var yt=V(qt);return yt==="symbol"?String(qt):qt});return new b("Invalid "+Pe+" `"+Xe+"` of value `"+String(Je)+"` "+("supplied to `"+me+"`, expected one of "+dt+"."))}return v(ae)}function D(K){function ae(Ae,_e,me,Pe,Xe){if(typeof K!="function")return new b("Property `"+Xe+"` of component `"+me+"` has invalid PropType notation inside objectOf.");var Je=Ae[_e],tt=Q(Je);if(tt!=="object")return new b("Invalid "+Pe+" `"+Xe+"` of type "+("`"+tt+"` supplied to `"+me+"`, expected an object."));for(var dt in Je)if(n(Je,dt)){var wt=K(Je,dt,me,Pe,Xe+"."+dt,i);if(wt instanceof Error)return wt}return null}return v(ae)}function L(K){if(!Array.isArray(K))return process.env.NODE_ENV!=="production"&&o("Invalid argument supplied to oneOfType, expected an instance of array."),l;for(var ae=0;ae<K.length;ae++){var Ae=K[ae];if(typeof Ae!="function")return o("Invalid argument supplied to oneOfType. Expected an array of check functions, but received "+z(Ae)+" at index "+ae+"."),l}function _e(me,Pe,Xe,Je,tt){for(var dt=[],wt=0;wt<K.length;wt++){var qt=K[wt],yt=qt(me,Pe,Xe,Je,tt,i);if(yt==null)return null;yt.data&&n(yt.data,"expectedType")&&dt.push(yt.data.expectedType)}var Ei=dt.length>0?", expected one of type ["+dt.join(", ")+"]":"";return new b("Invalid "+Je+" `"+tt+"` supplied to "+("`"+Xe+"`"+Ei+"."))}return v(_e)}function O(){function K(ae,Ae,_e,me,Pe){return G(ae[Ae])?null:new b("Invalid "+me+" `"+Pe+"` supplied to "+("`"+_e+"`, expected a ReactNode."))}return v(K)}function F(K,ae,Ae,_e,me){return new b((K||"React class")+": "+ae+" type `"+Ae+"."+_e+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+me+"`.")}function q(K){function ae(Ae,_e,me,Pe,Xe){var Je=Ae[_e],tt=Q(Je);if(tt!=="object")return new b("Invalid "+Pe+" `"+Xe+"` of type `"+tt+"` "+("supplied to `"+me+"`, expected `object`."));for(var dt in K){var wt=K[dt];if(typeof wt!="function")return F(me,Pe,Xe,dt,V(wt));var qt=wt(Je,dt,me,Pe,Xe+"."+dt,i);if(qt)return qt}return null}return v(ae)}function H(K){function ae(Ae,_e,me,Pe,Xe){var Je=Ae[_e],tt=Q(Je);if(tt!=="object")return new b("Invalid "+Pe+" `"+Xe+"` of type `"+tt+"` "+("supplied to `"+me+"`, expected `object`."));var dt=e({},Ae[_e],K);for(var wt in dt){var qt=K[wt];if(n(K,wt)&&typeof qt!="function")return F(me,Pe,Xe,wt,V(qt));if(!qt)return new b("Invalid "+Pe+" `"+Xe+"` key `"+wt+"` supplied to `"+me+"`.\nBad object: "+JSON.stringify(Ae[_e],null,"  ")+`
Valid keys: `+JSON.stringify(Object.keys(K),null,"  "));var yt=qt(Je,wt,me,Pe,Xe+"."+wt,i);if(yt)return yt}return null}return v(ae)}function G(K){switch(typeof K){case"number":case"string":case"undefined":return!0;case"boolean":return!K;case"object":if(Array.isArray(K))return K.every(G);if(K===null||u(K))return!0;var ae=f(K);if(ae){var Ae=ae.call(K),_e;if(ae!==K.entries){for(;!(_e=Ae.next()).done;)if(!G(_e.value))return!1}else for(;!(_e=Ae.next()).done;){var me=_e.value;if(me&&!G(me[1]))return!1}}else return!1;return!0;default:return!1}}function J(K,ae){return K==="symbol"?!0:ae?ae["@@toStringTag"]==="Symbol"||typeof Symbol=="function"&&ae instanceof Symbol:!1}function Q(K){var ae=typeof K;return Array.isArray(K)?"array":K instanceof RegExp?"object":J(ae,K)?"symbol":ae}function V(K){if(typeof K>"u"||K===null)return""+K;var ae=Q(K);if(ae==="object"){if(K instanceof Date)return"date";if(K instanceof RegExp)return"regexp"}return ae}function z(K){var ae=V(K);switch(ae){case"array":case"object":return"an "+ae;case"boolean":case"date":case"regexp":return"a "+ae;default:return ae}}function te(K){return!K.constructor||!K.constructor.name?g:K.constructor.name}return m.checkPropTypes=s,m.resetWarningCache=s.resetWarningCache,m.PropTypes=m,m},QM}var qM,yU;function ehe(){if(yU)return qM;yU=1;var r=HM();function e(){}function i(){}return i.resetWarningCache=e,qM=function(){function n(l,u,c,h,p,f){if(f!==r){var g=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw g.name="Invariant Violation",g}}n.isRequired=n;function s(){return n}var o={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:s,element:n,elementType:n,instanceOf:s,node:n,objectOf:s,oneOf:s,oneOfType:s,shape:s,exact:s,checkPropTypes:i,resetWarningCache:e};return o.PropTypes=o,o},qM}if(process.env.NODE_ENV!=="production"){var the=uU(),ihe=!0;zM.exports=$ue()(the.isElement,ihe)}else zM.exports=ehe()();var rhe=zM.exports;const bt=D2(rhe);function XM(r,e){(e==null||e>r.length)&&(e=r.length);for(var i=0,n=Array(e);i<e;i++)n[i]=r[i];return n}function nhe(r){if(Array.isArray(r))return r}function she(r){if(Array.isArray(r))return XM(r)}function x1(r,e,i){return(e=hhe(e))in r?Object.defineProperty(r,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[e]=i,r}function ahe(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function ohe(r,e){var i=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(i!=null){var n,s,o,l,u=[],c=!0,h=!1;try{if(o=(i=i.call(r)).next,e!==0)for(;!(c=(n=o.call(i)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(p){h=!0,s=p}finally{try{if(!c&&i.return!=null&&(l=i.return(),Object(l)!==l))return}finally{if(h)throw s}}return u}}function lhe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function che(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function vU(r,e){var i=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),i.push.apply(i,n)}return i}function bU(r){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?vU(Object(i),!0).forEach(function(n){x1(r,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):vU(Object(i)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(i,n))})}return r}function _1(r,e){return nhe(r)||ohe(r,e)||xU(r,e)||lhe()}function E1(r){return she(r)||ahe(r)||xU(r)||che()}function uhe(r,e){if(typeof r!="object"||!r)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var n=i.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function hhe(r){var e=uhe(r,"string");return typeof e=="symbol"?e:e+""}function xU(r,e){if(r){if(typeof r=="string")return XM(r,e);var i={}.toString.call(r).slice(8,-1);return i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set"?Array.from(r):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?XM(r,e):void 0}}var dhe=Rp({props:{width:{},height:{},yOffset:{default:1.5},glScale:{default:200},jsonUrl:{},graphData:{default:{nodes:[],links:[]}},numDimensions:{default:3},dagMode:{},dagLevelDistance:{},dagNodeFilter:{default:function(){return!0}},onDagError:{default:void 0},nodeRelSize:{default:4},nodeId:{default:"id"},nodeVal:{default:"val"},nodeResolution:{default:8},nodeVisibility:{default:!0},nodeColor:{default:"color"},nodeAutoColorBy:{},nodeOpacity:{default:.75},nodeThreeObject:{},nodeThreeObjectExtend:{default:!1},linkSource:{default:"source"},linkTarget:{default:"target"},linkVisibility:{default:!0},linkColor:{default:"color"},linkAutoColorBy:{},linkOpacity:{default:.2},linkWidth:{default:0},linkResolution:{default:6},linkCurvature:{default:0},linkCurveRotation:{default:0},linkMaterial:{},linkThreeObject:{},linkThreeObjectExtend:{default:!1},linkPositionUpdate:{},linkDirectionalArrowLength:{default:0},linkDirectionalArrowColor:{},linkDirectionalArrowRelPos:{default:.5},linkDirectionalArrowResolution:{default:8},linkDirectionalParticles:{default:0},linkDirectionalParticleSpeed:{default:.01},linkDirectionalParticleWidth:{default:.5},linkDirectionalParticleColor:{},linkDirectionalParticleResolution:{default:4},onNodeHover:{},onNodeClick:{},onLinkHover:{},onLinkClick:{},forceEngine:{default:"d3"},d3AlphaMin:{default:0},d3AlphaDecay:{default:.0228},d3VelocityDecay:{default:.4},ngraphPhysics:{},warmupTicks:{default:0},cooldownTicks:{},cooldownTime:{default:15e3},onEngineTick:{},onEngineStop:{}},methods:bU(bU({},Object.assign.apply(Object,[{}].concat(E1(["getGraphBbox","emitParticle","d3Force","d3ReheatSimulation","refresh"].map(function(r){return x1({},r,function(e){for(var i=e.forcegraph.components.forcegraph,n=arguments.length,s=new Array(n>1?n-1:0),o=1;o<n;o++)s[o-1]=arguments[o];var l=i[r].apply(i,s);return l===i?this:l})}))))),{},{_destructor:function(){this.graphData({nodes:[],links:[]})}}),init:function(r,e){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=i.markerAttrs,s=n===void 0?{preset:"hiro"}:n;r.innerHTML="",e.container=document.createElement("div"),r.appendChild(e.container);var o=document.createElement("a-scene");o.setAttribute("embedded",""),o.setAttribute("vr-mode-ui","enabled: false"),o.setAttribute("arjs","debugUIEnabled: false;");var l=document.createElement("a-marker");Object.entries(s).forEach(function(h){var p=_1(h,2),f=p[0],g=p[1];return l.setAttribute(f,g)}),o.appendChild(l);var u;o.appendChild(u=document.createElement("a-entity")),u.setAttribute("cursor"),u.setAttribute("raycaster","objects: [forcegraph]"),e.forcegraph=document.createElement("a-entity"),e.forcegraph.setAttribute("forcegraph",null),l.appendChild(e.forcegraph);var c=document.createElement("a-entity");c.setAttribute("camera",""),o.appendChild(c),e.container.appendChild(o)},update:function(r,e){e.hasOwnProperty("width")&&r.width&&(r.container.style.width="".concat(r.width,"px")),e.hasOwnProperty("height")&&r.height&&(r.container.style.height="".concat(r.height,"px")),e.hasOwnProperty("glScale")&&r.forcegraph.setAttribute("scale",E1(new Array(3)).map(function(){return 1/r.glScale}).join(" ")),e.hasOwnProperty("yOffset")&&r.forcegraph.setAttribute("position","0 ".concat(r.yOffset," 0"));var i=["jsonUrl","numDimensions","dagMode","dagLevelDistance","dagNodeFilter","onDagError","nodeRelSize","nodeId","nodeVal","nodeResolution","nodeVisibility","nodeColor","nodeAutoColorBy","nodeOpacity","nodeThreeObject","nodeThreeObjectExtend","linkSource","linkTarget","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","onNodeHover","onNodeClick","onLinkHover","onLinkClick","forceEngine","d3AlphaMin","d3AlphaDecay","d3VelocityDecay","ngraphPhysics","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"],n=Object.assign.apply(Object,[{}].concat(E1(Object.entries(r).filter(function(s){var o=_1(s,2),l=o[0],u=o[1];return e.hasOwnProperty(l)&&i.indexOf(l)!==-1&&u!==void 0&&u!==null}).map(function(s){var o=_1(s,2),l=o[0],u=o[1];return x1({},l,u)})),E1(Object.entries(r.graphData).map(function(s){var o=_1(s,2),l=o[0],u=o[1];return x1({},l,u)}))));r.forcegraph.setAttribute("forcegraph",n)}});const rg=new uc,Vu=new Gi,_U=new ot,KM=new Gi,w1=new Gi,C1=new ot,YM=new ot,EU=new gs,wU=new ot,CU=new ot;let qo=null,Kc=null;const Hu=[],hd={NONE:-1,PAN:0,ROTATE:1};class phe extends Wx{constructor(e,i,n=null){super(i,n),this.objects=e,this.recursive=!0,this.transformGroup=!1,this.rotateSpeed=1,this.raycaster=new yk,this.mouseButtons={LEFT:Ua.PAN,MIDDLE:Ua.PAN,RIGHT:Ua.ROTATE},this.touches={ONE:wu.PAN},this._onPointerMove=fhe.bind(this),this._onPointerDown=mhe.bind(this),this._onPointerCancel=ghe.bind(this),this._onContextMenu=Ahe.bind(this),n!==null&&this.connect()}connect(){this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerCancel),this.domElement.addEventListener("pointerleave",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerCancel),this.domElement.removeEventListener("pointerleave",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto",this.domElement.style.cursor=""}dispose(){this.disconnect()}_updatePointer(e){const i=this.domElement.getBoundingClientRect();Vu.x=(e.clientX-i.left)/i.width*2-1,Vu.y=-(e.clientY-i.top)/i.height*2+1}_updateState(e){let i;if(e.pointerType==="touch")i=this.touches.ONE;else switch(e.button){case 0:i=this.mouseButtons.LEFT;break;case 1:i=this.mouseButtons.MIDDLE;break;case 2:i=this.mouseButtons.RIGHT;break;default:i=null}switch(i){case Ua.PAN:case wu.PAN:this.state=hd.PAN;break;case Ua.ROTATE:case wu.ROTATE:this.state=hd.ROTATE;break;default:this.state=hd.NONE}}getRaycaster(){return console.warn("THREE.DragControls: getRaycaster() has been deprecated. Use controls.raycaster instead."),this.raycaster}setObjects(e){console.warn("THREE.DragControls: setObjects() has been deprecated. Use controls.objects instead."),this.objects=e}getObjects(){return console.warn("THREE.DragControls: getObjects() has been deprecated. Use controls.objects instead."),this.objects}activate(){console.warn("THREE.DragControls: activate() has been renamed to connect()."),this.connect()}deactivate(){console.warn("THREE.DragControls: deactivate() has been renamed to disconnect()."),this.disconnect()}set mode(e){console.warn("THREE.DragControls: The .mode property has been removed. Define the type of transformation via the .mouseButtons or .touches properties.")}get mode(){console.warn("THREE.DragControls: The .mode property has been removed. Define the type of transformation via the .mouseButtons or .touches properties.")}}function fhe(r){const e=this.object,i=this.domElement,n=this.raycaster;if(this.enabled!==!1){if(this._updatePointer(r),n.setFromCamera(Vu,e),qo)this.state===hd.PAN?n.ray.intersectPlane(rg,C1)&&qo.position.copy(C1.sub(_U).applyMatrix4(EU)):this.state===hd.ROTATE&&(KM.subVectors(Vu,w1).multiplyScalar(this.rotateSpeed),qo.rotateOnWorldAxis(wU,KM.x),qo.rotateOnWorldAxis(CU.normalize(),-KM.y)),this.dispatchEvent({type:"drag",object:qo}),w1.copy(Vu);else if(r.pointerType==="mouse"||r.pointerType==="pen")if(Hu.length=0,n.setFromCamera(Vu,e),n.intersectObjects(this.objects,this.recursive,Hu),Hu.length>0){const s=Hu[0].object;rg.setFromNormalAndCoplanarPoint(e.getWorldDirection(rg.normal),YM.setFromMatrixPosition(s.matrixWorld)),Kc!==s&&Kc!==null&&(this.dispatchEvent({type:"hoveroff",object:Kc}),i.style.cursor="auto",Kc=null),Kc!==s&&(this.dispatchEvent({type:"hoveron",object:s}),i.style.cursor="pointer",Kc=s)}else Kc!==null&&(this.dispatchEvent({type:"hoveroff",object:Kc}),i.style.cursor="auto",Kc=null);w1.copy(Vu)}}function mhe(r){const e=this.object,i=this.domElement,n=this.raycaster;this.enabled!==!1&&(this._updatePointer(r),this._updateState(r),Hu.length=0,n.setFromCamera(Vu,e),n.intersectObjects(this.objects,this.recursive,Hu),Hu.length>0&&(this.transformGroup===!0?qo=SU(Hu[0].object):qo=Hu[0].object,rg.setFromNormalAndCoplanarPoint(e.getWorldDirection(rg.normal),YM.setFromMatrixPosition(qo.matrixWorld)),n.ray.intersectPlane(rg,C1)&&(this.state===hd.PAN?(EU.copy(qo.parent.matrixWorld).invert(),_U.copy(C1).sub(YM.setFromMatrixPosition(qo.matrixWorld))):this.state===hd.ROTATE&&(wU.set(0,1,0).applyQuaternion(e.quaternion).normalize(),CU.set(1,0,0).applyQuaternion(e.quaternion).normalize())),i.style.cursor="move",this.dispatchEvent({type:"dragstart",object:qo})),w1.copy(Vu))}function ghe(){this.enabled!==!1&&(qo&&(this.dispatchEvent({type:"dragend",object:qo}),qo=null),this.domElement.style.cursor=Kc?"pointer":"auto",this.state=hd.NONE)}function Ahe(r){this.enabled!==!1&&r.preventDefault()}function SU(r,e=null){return r.isGroup&&(e=r),r.parent===null?e:SU(r.parent,e)}/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const S1="170",yhe=0,vhe=1,bhe=2,xhe=1,T1=3,ng=0,yc=1,sg=2,ag=0,dd=1,M1=2,R1=3,I1=4,TU=5,pd=100,MU=101,RU=102,_he=103,Ehe=104,IU=200,BU=201,NU=202,LU=203,B1=204,N1=205,DU=206,OU=207,PU=208,kU=209,FU=210,UU=0,zU=1,jU=2,L1=3,GU=4,VU=5,HU=6,WU=7,D1=0,whe=1,Che=2,og=0,She=1,The=2,Mhe=3,Rhe=4,Ihe=6,Bhe=7,JM=300,kp=301,lg=302,iy=303,ry=304,ZM=306,O1=1e3,cg=1001,P1=1002,no=1003,$M=1004,ug=1005,gl=1006,e3=1007,Wu=1008,fd=1009,ny=1010,sy=1011,hg=1012,Co=1013,ja=1014,Al=1015,Qu=1016,Nhe=1017,Lhe=1018,ay=1020,QU=35902,Dhe=1021,t3=1022,dg=1023,Ohe=1024,Phe=1025,Fp=1026,pg=1027,i3=1028,r3=1029,oy=1030,n3=1031,khe=1032,s3=1033,a3=33776,k1=33777,F1=33778,U1=33779,qU=35840,XU=35841,KU=35842,YU=35843,JU=36196,o3=37492,l3=37496,c3=37808,u3=37809,h3=37810,d3=37811,p3=37812,f3=37813,m3=37814,g3=37815,A3=37816,y3=37817,v3=37818,b3=37819,x3=37820,_3=37821,E3=36492,Fhe=36283,ZU=36284,$U=36285,e6=36286,md=0,Uhe=1,Up="",Lr="srgb",gd="srgb-linear",t6="linear",ly="srgb",zhe=0,zp=7680,jhe=7681,Ghe=7682,Vhe=7683,Hhe=34055,Whe=34056,Qhe=5386,qhe=512,Xhe=513,Khe=514,Yhe=515,Jhe=516,Zhe=517,$he=518,w3=519,i6=512,C3=513,r6=514,n6=515,s6=516,a6=517,o6=518,l6=519,z1=35044,fg=35048,vc=2e3,jp=2001;class mg{addEventListener(e,i){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(i)===-1&&n[e].push(i)}hasEventListener(e,i){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(i)!==-1}removeEventListener(e,i){if(this._listeners===void 0)return;const n=this._listeners[e];if(n!==void 0){const s=n.indexOf(i);s!==-1&&n.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const n=i.slice(0);for(let s=0,o=n.length;s<o;s++)n[s].call(this,e);e.target=null}}}const so=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let c6=1234567;const cy=Math.PI/180,uy=180/Math.PI;function qu(){const r=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(so[r&255]+so[r>>8&255]+so[r>>16&255]+so[r>>24&255]+"-"+so[e&255]+so[e>>8&255]+"-"+so[e>>16&15|64]+so[e>>24&255]+"-"+so[i&63|128]+so[i>>8&255]+"-"+so[i>>16&255]+so[i>>24&255]+so[n&255]+so[n>>8&255]+so[n>>16&255]+so[n>>24&255]).toLowerCase()}function Ga(r,e,i){return Math.max(e,Math.min(i,r))}function S3(r,e){return(r%e+e)%e}function ede(r,e,i,n,s){return n+(r-e)*(s-n)/(i-e)}function tde(r,e,i){return r!==e?(i-r)/(e-r):0}function hy(r,e,i){return(1-i)*r+i*e}function ide(r,e,i,n){return hy(r,e,1-Math.exp(-i*n))}function rde(r,e=1){return e-Math.abs(S3(r,e*2)-e)}function nde(r,e,i){return r<=e?0:r>=i?1:(r=(r-e)/(i-e),r*r*(3-2*r))}function sde(r,e,i){return r<=e?0:r>=i?1:(r=(r-e)/(i-e),r*r*r*(r*(r*6-15)+10))}function ade(r,e){return r+Math.floor(Math.random()*(e-r+1))}function ode(r,e){return r+Math.random()*(e-r)}function lde(r){return r*(.5-Math.random())}function cde(r){r!==void 0&&(c6=r);let e=c6+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function ude(r){return r*cy}function hde(r){return r*uy}function dde(r){return(r&r-1)===0&&r!==0}function pde(r){return Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function fde(r){return Math.pow(2,Math.floor(Math.log(r)/Math.LN2))}function mde(r,e,i,n,s){const o=Math.cos,l=Math.sin,u=o(i/2),c=l(i/2),h=o((e+n)/2),p=l((e+n)/2),f=o((e-n)/2),g=l((e-n)/2),m=o((n-e)/2),y=l((n-e)/2);switch(s){case"XYX":r.set(u*p,c*f,c*g,u*h);break;case"YZY":r.set(c*g,u*p,c*f,u*h);break;case"ZXZ":r.set(c*f,c*g,u*p,u*h);break;case"XZX":r.set(u*p,c*y,c*m,u*h);break;case"YXY":r.set(c*m,u*p,c*y,u*h);break;case"ZYZ":r.set(c*y,c*m,u*p,u*h);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function So(r,e){switch(e.constructor){case Float32Array:return r;case Uint32Array:return r/4294967295;case Uint16Array:return r/65535;case Uint8Array:return r/255;case Int32Array:return Math.max(r/2147483647,-1);case Int16Array:return Math.max(r/32767,-1);case Int8Array:return Math.max(r/127,-1);default:throw new Error("Invalid component type.")}}function en(r,e){switch(e.constructor){case Float32Array:return r;case Uint32Array:return Math.round(r*4294967295);case Uint16Array:return Math.round(r*65535);case Uint8Array:return Math.round(r*255);case Int32Array:return Math.round(r*2147483647);case Int16Array:return Math.round(r*32767);case Int8Array:return Math.round(r*127);default:throw new Error("Invalid component type.")}}const gde={DEG2RAD:cy,RAD2DEG:uy,generateUUID:qu,clamp:Ga,euclideanModulo:S3,mapLinear:ede,inverseLerp:tde,lerp:hy,damp:ide,pingpong:rde,smoothstep:nde,smootherstep:sde,randInt:ade,randFloat:ode,randFloatSpread:lde,seededRandom:cde,degToRad:ude,radToDeg:hde,isPowerOfTwo:dde,ceilPowerOfTwo:pde,floorPowerOfTwo:fde,setQuaternionFromProperEuler:mde,normalize:en,denormalize:So};class Dn{constructor(e=0,i=0){Dn.prototype.isVector2=!0,this.x=e,this.y=i}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,i){return this.x=e,this.y=i,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const i=this.x,n=this.y,s=e.elements;return this.x=s[0]*i+s[3]*n+s[6],this.y=s[1]*i+s[4]*n+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this}clampLength(e,i){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(i,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const n=this.dot(e)/i;return Math.acos(Ga(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,n=this.y-e.y;return i*i+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this}lerpVectors(e,i,n){return this.x=e.x+(i.x-e.x)*n,this.y=e.y+(i.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this}rotateAround(e,i){const n=Math.cos(i),s=Math.sin(i),o=this.x-e.x,l=this.y-e.y;return this.x=o*n-l*s+e.x,this.y=o*s+l*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Xo{constructor(e,i,n,s,o,l,u,c,h){Xo.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,i,n,s,o,l,u,c,h)}set(e,i,n,s,o,l,u,c,h){const p=this.elements;return p[0]=e,p[1]=s,p[2]=u,p[3]=i,p[4]=o,p[5]=c,p[6]=n,p[7]=l,p[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const i=this.elements,n=e.elements;return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],this}extractBasis(e,i,n){return e.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const i=e.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const n=e.elements,s=i.elements,o=this.elements,l=n[0],u=n[3],c=n[6],h=n[1],p=n[4],f=n[7],g=n[2],m=n[5],y=n[8],b=s[0],v=s[3],_=s[6],C=s[1],E=s[4],T=s[7],R=s[2],B=s[5],I=s[8];return o[0]=l*b+u*C+c*R,o[3]=l*v+u*E+c*B,o[6]=l*_+u*T+c*I,o[1]=h*b+p*C+f*R,o[4]=h*v+p*E+f*B,o[7]=h*_+p*T+f*I,o[2]=g*b+m*C+y*R,o[5]=g*v+m*E+y*B,o[8]=g*_+m*T+y*I,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=e,i[4]*=e,i[7]*=e,i[2]*=e,i[5]*=e,i[8]*=e,this}determinant(){const e=this.elements,i=e[0],n=e[1],s=e[2],o=e[3],l=e[4],u=e[5],c=e[6],h=e[7],p=e[8];return i*l*p-i*u*h-n*o*p+n*u*c+s*o*h-s*l*c}invert(){const e=this.elements,i=e[0],n=e[1],s=e[2],o=e[3],l=e[4],u=e[5],c=e[6],h=e[7],p=e[8],f=p*l-u*h,g=u*c-p*o,m=h*o-l*c,y=i*f+n*g+s*m;if(y===0)return this.set(0,0,0,0,0,0,0,0,0);const b=1/y;return e[0]=f*b,e[1]=(s*h-p*n)*b,e[2]=(u*n-s*l)*b,e[3]=g*b,e[4]=(p*i-s*c)*b,e[5]=(s*o-u*i)*b,e[6]=m*b,e[7]=(n*c-h*i)*b,e[8]=(l*i-n*o)*b,this}transpose(){let e;const i=this.elements;return e=i[1],i[1]=i[3],i[3]=e,e=i[2],i[2]=i[6],i[6]=e,e=i[5],i[5]=i[7],i[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const i=this.elements;return e[0]=i[0],e[1]=i[3],e[2]=i[6],e[3]=i[1],e[4]=i[4],e[5]=i[7],e[6]=i[2],e[7]=i[5],e[8]=i[8],this}setUvTransform(e,i,n,s,o,l,u){const c=Math.cos(o),h=Math.sin(o);return this.set(n*c,n*h,-n*(c*l+h*u)+l+e,-s*h,s*c,-s*(-h*l+c*u)+u+i,0,0,1),this}scale(e,i){return this.premultiply(T3.makeScale(e,i)),this}rotate(e){return this.premultiply(T3.makeRotation(-e)),this}translate(e,i){return this.premultiply(T3.makeTranslation(e,i)),this}makeTranslation(e,i){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,i,0,0,1),this}makeRotation(e){const i=Math.cos(e),n=Math.sin(e);return this.set(i,-n,0,n,i,0,0,0,1),this}makeScale(e,i){return this.set(e,0,0,0,i,0,0,0,1),this}equals(e){const i=this.elements,n=e.elements;for(let s=0;s<9;s++)if(i[s]!==n[s])return!1;return!0}fromArray(e,i=0){for(let n=0;n<9;n++)this.elements[n]=e[n+i];return this}toArray(e=[],i=0){const n=this.elements;return e[i]=n[0],e[i+1]=n[1],e[i+2]=n[2],e[i+3]=n[3],e[i+4]=n[4],e[i+5]=n[5],e[i+6]=n[6],e[i+7]=n[7],e[i+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const T3=new Xo;function Ade(r){for(let e=r.length-1;e>=0;--e)if(r[e]>=65535)return!0;return!1}function M3(r){return document.createElementNS("http://www.w3.org/1999/xhtml",r)}function yde(){const r=M3("canvas");return r.style.display="block",r}const u6={};function vde(r){r in u6||(u6[r]=!0,console.warn(r))}const ta={enabled:!0,workingColorSpace:gd,spaces:{},convert:function(r,e,i){return this.enabled===!1||e===i||!e||!i||(this.spaces[e].transfer===ly&&(r.r=Xu(r.r),r.g=Xu(r.g),r.b=Xu(r.b)),this.spaces[e].primaries!==this.spaces[i].primaries&&(r.applyMatrix3(this.spaces[e].toXYZ),r.applyMatrix3(this.spaces[i].fromXYZ)),this.spaces[i].transfer===ly&&(r.r=gg(r.r),r.g=gg(r.g),r.b=gg(r.b))),r},fromWorkingColorSpace:function(r,e){return this.convert(r,this.workingColorSpace,e)},toWorkingColorSpace:function(r,e){return this.convert(r,e,this.workingColorSpace)},getPrimaries:function(r){return this.spaces[r].primaries},getTransfer:function(r){return r===Up?t6:this.spaces[r].transfer},getLuminanceCoefficients:function(r,e=this.workingColorSpace){return r.fromArray(this.spaces[e].luminanceCoefficients)},define:function(r){Object.assign(this.spaces,r)},_getMatrix:function(r,e,i){return r.copy(this.spaces[e].toXYZ).multiply(this.spaces[i].fromXYZ)},_getDrawingBufferColorSpace:function(r){return this.spaces[r].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(r=this.workingColorSpace){return this.spaces[r].workingColorSpaceConfig.unpackColorSpace}};function Xu(r){return r<.04045?r*.0773993808:Math.pow(r*.9478672986+.0521327014,2.4)}function gg(r){return r<.0031308?r*12.92:1.055*Math.pow(r,.41666)-.055}const h6=[.64,.33,.3,.6,.15,.06],d6=[.2126,.7152,.0722],p6=[.3127,.329],f6=new Xo().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),m6=new Xo().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);ta.define({[gd]:{primaries:h6,whitePoint:p6,transfer:t6,toXYZ:f6,fromXYZ:m6,luminanceCoefficients:d6,workingColorSpaceConfig:{unpackColorSpace:Lr},outputColorSpaceConfig:{drawingBufferColorSpace:Lr}},[Lr]:{primaries:h6,whitePoint:p6,transfer:ly,toXYZ:f6,fromXYZ:m6,luminanceCoefficients:d6,outputColorSpaceConfig:{drawingBufferColorSpace:Lr}}});let Ag;class bde{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let i;if(e instanceof HTMLCanvasElement)i=e;else{Ag===void 0&&(Ag=M3("canvas")),Ag.width=e.width,Ag.height=e.height;const n=Ag.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),i=Ag}return i.width>2048||i.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),i.toDataURL("image/jpeg",.6)):i.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const i=M3("canvas");i.width=e.width,i.height=e.height;const n=i.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const s=n.getImageData(0,0,e.width,e.height),o=s.data;for(let l=0;l<o.length;l++)o[l]=Xu(o[l]/255)*255;return n.putImageData(s,0,0),i}else if(e.data){const i=e.data.slice(0);for(let n=0;n<i.length;n++)i instanceof Uint8Array||i instanceof Uint8ClampedArray?i[n]=Math.floor(Xu(i[n]/255)*255):i[n]=Xu(i[n]);return{data:i,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let xde=0;class g6{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:xde++}),this.uuid=qu(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},s=this.data;if(s!==null){let o;if(Array.isArray(s)){o=[];for(let l=0,u=s.length;l<u;l++)s[l].isDataTexture?o.push(R3(s[l].image)):o.push(R3(s[l]))}else o=R3(s);n.url=o}return i||(e.images[this.uuid]=n),n}}function R3(r){return typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap?bde.getDataURL(r):r.data?{data:Array.from(r.data),width:r.width,height:r.height,type:r.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let _de=0;class To extends mg{constructor(e=To.DEFAULT_IMAGE,i=To.DEFAULT_MAPPING,n=cg,s=cg,o=gl,l=Wu,u=dg,c=fd,h=To.DEFAULT_ANISOTROPY,p=Up){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:_de++}),this.uuid=qu(),this.name="",this.source=new g6(e),this.mipmaps=[],this.mapping=i,this.channel=0,this.wrapS=n,this.wrapT=s,this.magFilter=o,this.minFilter=l,this.anisotropy=h,this.format=u,this.internalFormat=null,this.type=c,this.offset=new Dn(0,0),this.repeat=new Dn(1,1),this.center=new Dn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Xo,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=p,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),i||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==JM)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case O1:e.x=e.x-Math.floor(e.x);break;case cg:e.x=e.x<0?0:1;break;case P1:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case O1:e.y=e.y-Math.floor(e.y);break;case cg:e.y=e.y<0?0:1;break;case P1:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}To.DEFAULT_IMAGE=null,To.DEFAULT_MAPPING=JM,To.DEFAULT_ANISOTROPY=1;class Zn{constructor(e=0,i=0,n=0,s=1){Zn.prototype.isVector4=!0,this.x=e,this.y=i,this.z=n,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,i,n,s){return this.x=e,this.y=i,this.z=n,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this.w=e.w+i.w,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this.w+=e.w*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this.w=e.w-i.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const i=this.x,n=this.y,s=this.z,o=this.w,l=e.elements;return this.x=l[0]*i+l[4]*n+l[8]*s+l[12]*o,this.y=l[1]*i+l[5]*n+l[9]*s+l[13]*o,this.z=l[2]*i+l[6]*n+l[10]*s+l[14]*o,this.w=l[3]*i+l[7]*n+l[11]*s+l[15]*o,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const i=Math.sqrt(1-e.w*e.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/i,this.y=e.y/i,this.z=e.z/i),this}setAxisAngleFromRotationMatrix(e){let i,n,s,o;const l=e.elements,u=l[0],c=l[4],h=l[8],p=l[1],f=l[5],g=l[9],m=l[2],y=l[6],b=l[10];if(Math.abs(c-p)<.01&&Math.abs(h-m)<.01&&Math.abs(g-y)<.01){if(Math.abs(c+p)<.1&&Math.abs(h+m)<.1&&Math.abs(g+y)<.1&&Math.abs(u+f+b-3)<.1)return this.set(1,0,0,0),this;i=Math.PI;const _=(u+1)/2,C=(f+1)/2,E=(b+1)/2,T=(c+p)/4,R=(h+m)/4,B=(g+y)/4;return _>C&&_>E?_<.01?(n=0,s=.707106781,o=.707106781):(n=Math.sqrt(_),s=T/n,o=R/n):C>E?C<.01?(n=.707106781,s=0,o=.707106781):(s=Math.sqrt(C),n=T/s,o=B/s):E<.01?(n=.707106781,s=.707106781,o=0):(o=Math.sqrt(E),n=R/o,s=B/o),this.set(n,s,o,i),this}let v=Math.sqrt((y-g)*(y-g)+(h-m)*(h-m)+(p-c)*(p-c));return Math.abs(v)<.001&&(v=1),this.x=(y-g)/v,this.y=(h-m)/v,this.z=(p-c)/v,this.w=Math.acos((u+f+b-1)/2),this}setFromMatrixPosition(e){const i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this.w=i[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this.w=Math.max(e.w,Math.min(i.w,this.w)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this.w=Math.max(e,Math.min(i,this.w)),this}clampLength(e,i){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(i,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this.w+=(e.w-this.w)*i,this}lerpVectors(e,i,n){return this.x=e.x+(i.x-e.x)*n,this.y=e.y+(i.y-e.y)*n,this.z=e.z+(i.z-e.z)*n,this.w=e.w+(i.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this.w=e[i+3],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e[i+3]=this.w,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this.w=e.getW(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class yg extends mg{constructor(e=1,i=1,n={}){super(),this.isRenderTarget=!0,this.width=e,this.height=i,this.depth=1,this.scissor=new Zn(0,0,e,i),this.scissorTest=!1,this.viewport=new Zn(0,0,e,i);const s={width:e,height:i,depth:1};n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:gl,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},n);const o=new To(s,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace);o.flipY=!1,o.generateMipmaps=n.generateMipmaps,o.internalFormat=n.internalFormat,this.textures=[];const l=n.count;for(let u=0;u<l;u++)this.textures[u]=o.clone(),this.textures[u].isRenderTargetTexture=!0;this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this.depthTexture=n.depthTexture,this.samples=n.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,i,n=1){if(this.width!==e||this.height!==i||this.depth!==n){this.width=e,this.height=i,this.depth=n;for(let s=0,o=this.textures.length;s<o;s++)this.textures[s].image.width=e,this.textures[s].image.height=i,this.textures[s].image.depth=n;this.dispose()}this.viewport.set(0,0,e,i),this.scissor.set(0,0,e,i)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let n=0,s=e.textures.length;n<s;n++)this.textures[n]=e.textures[n].clone(),this.textures[n].isRenderTargetTexture=!0;const i=Object.assign({},e.texture.image);return this.texture.source=new g6(i),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Ede extends yg{constructor(e=1,i=1,n={}){super(e,i,n),this.isWebGLRenderTarget=!0}}class wde extends To{constructor(e=null,i=1,n=1,s=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:i,height:n,depth:s},this.magFilter=no,this.minFilter=no,this.wrapR=cg,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class dy{constructor(e=0,i=0,n=0,s=1){this.isQuaternion=!0,this._x=e,this._y=i,this._z=n,this._w=s}static slerpFlat(e,i,n,s,o,l,u){let c=n[s+0],h=n[s+1],p=n[s+2],f=n[s+3];const g=o[l+0],m=o[l+1],y=o[l+2],b=o[l+3];if(u===0){e[i+0]=c,e[i+1]=h,e[i+2]=p,e[i+3]=f;return}if(u===1){e[i+0]=g,e[i+1]=m,e[i+2]=y,e[i+3]=b;return}if(f!==b||c!==g||h!==m||p!==y){let v=1-u;const _=c*g+h*m+p*y+f*b,C=_>=0?1:-1,E=1-_*_;if(E>Number.EPSILON){const R=Math.sqrt(E),B=Math.atan2(R,_*C);v=Math.sin(v*B)/R,u=Math.sin(u*B)/R}const T=u*C;if(c=c*v+g*T,h=h*v+m*T,p=p*v+y*T,f=f*v+b*T,v===1-u){const R=1/Math.sqrt(c*c+h*h+p*p+f*f);c*=R,h*=R,p*=R,f*=R}}e[i]=c,e[i+1]=h,e[i+2]=p,e[i+3]=f}static multiplyQuaternionsFlat(e,i,n,s,o,l){const u=n[s],c=n[s+1],h=n[s+2],p=n[s+3],f=o[l],g=o[l+1],m=o[l+2],y=o[l+3];return e[i]=u*y+p*f+c*m-h*g,e[i+1]=c*y+p*g+h*f-u*m,e[i+2]=h*y+p*m+u*g-c*f,e[i+3]=p*y-u*f-c*g-h*m,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,i,n,s){return this._x=e,this._y=i,this._z=n,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,i=!0){const n=e._x,s=e._y,o=e._z,l=e._order,u=Math.cos,c=Math.sin,h=u(n/2),p=u(s/2),f=u(o/2),g=c(n/2),m=c(s/2),y=c(o/2);switch(l){case"XYZ":this._x=g*p*f+h*m*y,this._y=h*m*f-g*p*y,this._z=h*p*y+g*m*f,this._w=h*p*f-g*m*y;break;case"YXZ":this._x=g*p*f+h*m*y,this._y=h*m*f-g*p*y,this._z=h*p*y-g*m*f,this._w=h*p*f+g*m*y;break;case"ZXY":this._x=g*p*f-h*m*y,this._y=h*m*f+g*p*y,this._z=h*p*y+g*m*f,this._w=h*p*f-g*m*y;break;case"ZYX":this._x=g*p*f-h*m*y,this._y=h*m*f+g*p*y,this._z=h*p*y-g*m*f,this._w=h*p*f+g*m*y;break;case"YZX":this._x=g*p*f+h*m*y,this._y=h*m*f+g*p*y,this._z=h*p*y-g*m*f,this._w=h*p*f-g*m*y;break;case"XZY":this._x=g*p*f-h*m*y,this._y=h*m*f-g*p*y,this._z=h*p*y+g*m*f,this._w=h*p*f+g*m*y;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+l)}return i===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,i){const n=i/2,s=Math.sin(n);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const i=e.elements,n=i[0],s=i[4],o=i[8],l=i[1],u=i[5],c=i[9],h=i[2],p=i[6],f=i[10],g=n+u+f;if(g>0){const m=.5/Math.sqrt(g+1);this._w=.25/m,this._x=(p-c)*m,this._y=(o-h)*m,this._z=(l-s)*m}else if(n>u&&n>f){const m=2*Math.sqrt(1+n-u-f);this._w=(p-c)/m,this._x=.25*m,this._y=(s+l)/m,this._z=(o+h)/m}else if(u>f){const m=2*Math.sqrt(1+u-n-f);this._w=(o-h)/m,this._x=(s+l)/m,this._y=.25*m,this._z=(c+p)/m}else{const m=2*Math.sqrt(1+f-n-u);this._w=(l-s)/m,this._x=(o+h)/m,this._y=(c+p)/m,this._z=.25*m}return this._onChangeCallback(),this}setFromUnitVectors(e,i){let n=e.dot(i)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*i.z-e.z*i.y,this._y=e.z*i.x-e.x*i.z,this._z=e.x*i.y-e.y*i.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Ga(this.dot(e),-1,1)))}rotateTowards(e,i){const n=this.angleTo(e);if(n===0)return this;const s=Math.min(1,i/n);return this.slerp(e,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,i){const n=e._x,s=e._y,o=e._z,l=e._w,u=i._x,c=i._y,h=i._z,p=i._w;return this._x=n*p+l*u+s*h-o*c,this._y=s*p+l*c+o*u-n*h,this._z=o*p+l*h+n*c-s*u,this._w=l*p-n*u-s*c-o*h,this._onChangeCallback(),this}slerp(e,i){if(i===0)return this;if(i===1)return this.copy(e);const n=this._x,s=this._y,o=this._z,l=this._w;let u=l*e._w+n*e._x+s*e._y+o*e._z;if(u<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,u=-u):this.copy(e),u>=1)return this._w=l,this._x=n,this._y=s,this._z=o,this;const c=1-u*u;if(c<=Number.EPSILON){const m=1-i;return this._w=m*l+i*this._w,this._x=m*n+i*this._x,this._y=m*s+i*this._y,this._z=m*o+i*this._z,this.normalize(),this}const h=Math.sqrt(c),p=Math.atan2(h,u),f=Math.sin((1-i)*p)/h,g=Math.sin(i*p)/h;return this._w=l*f+this._w*g,this._x=n*f+this._x*g,this._y=s*f+this._y*g,this._z=o*f+this._z*g,this._onChangeCallback(),this}slerpQuaternions(e,i,n){return this.copy(e).slerp(i,n)}random(){const e=2*Math.PI*Math.random(),i=2*Math.PI*Math.random(),n=Math.random(),s=Math.sqrt(1-n),o=Math.sqrt(n);return this.set(s*Math.sin(e),s*Math.cos(e),o*Math.sin(i),o*Math.cos(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,i=0){return this._x=e[i],this._y=e[i+1],this._z=e[i+2],this._w=e[i+3],this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._w,e}fromBufferAttribute(e,i){return this._x=e.getX(i),this._y=e.getY(i),this._z=e.getZ(i),this._w=e.getW(i),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Nt{constructor(e=0,i=0,n=0){Nt.prototype.isVector3=!0,this.x=e,this.y=i,this.z=n}set(e,i,n){return n===void 0&&(n=this.z),this.x=e,this.y=i,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,i){return this.x=e.x*i.x,this.y=e.y*i.y,this.z=e.z*i.z,this}applyEuler(e){return this.applyQuaternion(A6.setFromEuler(e))}applyAxisAngle(e,i){return this.applyQuaternion(A6.setFromAxisAngle(e,i))}applyMatrix3(e){const i=this.x,n=this.y,s=this.z,o=e.elements;return this.x=o[0]*i+o[3]*n+o[6]*s,this.y=o[1]*i+o[4]*n+o[7]*s,this.z=o[2]*i+o[5]*n+o[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const i=this.x,n=this.y,s=this.z,o=e.elements,l=1/(o[3]*i+o[7]*n+o[11]*s+o[15]);return this.x=(o[0]*i+o[4]*n+o[8]*s+o[12])*l,this.y=(o[1]*i+o[5]*n+o[9]*s+o[13])*l,this.z=(o[2]*i+o[6]*n+o[10]*s+o[14])*l,this}applyQuaternion(e){const i=this.x,n=this.y,s=this.z,o=e.x,l=e.y,u=e.z,c=e.w,h=2*(l*s-u*n),p=2*(u*i-o*s),f=2*(o*n-l*i);return this.x=i+c*h+l*f-u*p,this.y=n+c*p+u*h-o*f,this.z=s+c*f+o*p-l*h,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const i=this.x,n=this.y,s=this.z,o=e.elements;return this.x=o[0]*i+o[4]*n+o[8]*s,this.y=o[1]*i+o[5]*n+o[9]*s,this.z=o[2]*i+o[6]*n+o[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this}clampLength(e,i){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(i,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this}lerpVectors(e,i,n){return this.x=e.x+(i.x-e.x)*n,this.y=e.y+(i.y-e.y)*n,this.z=e.z+(i.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,i){const n=e.x,s=e.y,o=e.z,l=i.x,u=i.y,c=i.z;return this.x=s*c-o*u,this.y=o*l-n*c,this.z=n*u-s*l,this}projectOnVector(e){const i=e.lengthSq();if(i===0)return this.set(0,0,0);const n=e.dot(this)/i;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return I3.copy(this).projectOnVector(e),this.sub(I3)}reflect(e){return this.sub(I3.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const n=this.dot(e)/i;return Math.acos(Ga(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,n=this.y-e.y,s=this.z-e.z;return i*i+n*n+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,i,n){const s=Math.sin(i)*e;return this.x=s*Math.sin(n),this.y=Math.cos(i)*e,this.z=s*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,i,n){return this.x=e*Math.sin(i),this.y=n,this.z=e*Math.cos(i),this}setFromMatrixPosition(e){const i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(e){const i=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=i,this.y=n,this.z=s,this}setFromMatrixColumn(e,i){return this.fromArray(e.elements,i*4)}setFromMatrix3Column(e,i){return this.fromArray(e.elements,i*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,i=Math.random()*2-1,n=Math.sqrt(1-i*i);return this.x=n*Math.cos(e),this.y=i,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const I3=new Nt,A6=new dy;class py{constructor(e=new Nt(1/0,1/0,1/0),i=new Nt(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=i}set(e,i){return this.min.copy(e),this.max.copy(i),this}setFromArray(e){this.makeEmpty();for(let i=0,n=e.length;i<n;i+=3)this.expandByPoint(bc.fromArray(e,i));return this}setFromBufferAttribute(e){this.makeEmpty();for(let i=0,n=e.count;i<n;i++)this.expandByPoint(bc.fromBufferAttribute(e,i));return this}setFromPoints(e){this.makeEmpty();for(let i=0,n=e.length;i<n;i++)this.expandByPoint(e[i]);return this}setFromCenterAndSize(e,i){const n=bc.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,i=!1){return this.makeEmpty(),this.expandByObject(e,i)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,i=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0){const o=n.getAttribute("position");if(i===!0&&o!==void 0&&e.isInstancedMesh!==!0)for(let l=0,u=o.count;l<u;l++)e.isMesh===!0?e.getVertexPosition(l,bc):bc.fromBufferAttribute(o,l),bc.applyMatrix4(e.matrixWorld),this.expandByPoint(bc);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),j1.copy(e.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),j1.copy(n.boundingBox)),j1.applyMatrix4(e.matrixWorld),this.union(j1)}const s=e.children;for(let o=0,l=s.length;o<l;o++)this.expandByObject(s[o],i);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,i){return i.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,bc),bc.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let i,n;return e.normal.x>0?(i=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(i=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(i+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(i+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(i+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(i+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),i<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(fy),G1.subVectors(this.max,fy),vg.subVectors(e.a,fy),bg.subVectors(e.b,fy),xg.subVectors(e.c,fy),Ad.subVectors(bg,vg),yd.subVectors(xg,bg),Gp.subVectors(vg,xg);let i=[0,-Ad.z,Ad.y,0,-yd.z,yd.y,0,-Gp.z,Gp.y,Ad.z,0,-Ad.x,yd.z,0,-yd.x,Gp.z,0,-Gp.x,-Ad.y,Ad.x,0,-yd.y,yd.x,0,-Gp.y,Gp.x,0];return!B3(i,vg,bg,xg,G1)||(i=[1,0,0,0,1,0,0,0,1],!B3(i,vg,bg,xg,G1))?!1:(V1.crossVectors(Ad,yd),i=[V1.x,V1.y,V1.z],B3(i,vg,bg,xg,G1))}clampPoint(e,i){return i.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,bc).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(bc).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Ku[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Ku[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Ku[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Ku[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Ku[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Ku[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Ku[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Ku[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Ku),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Ku=[new Nt,new Nt,new Nt,new Nt,new Nt,new Nt,new Nt,new Nt],bc=new Nt,j1=new py,vg=new Nt,bg=new Nt,xg=new Nt,Ad=new Nt,yd=new Nt,Gp=new Nt,fy=new Nt,G1=new Nt,V1=new Nt,Vp=new Nt;function B3(r,e,i,n,s){for(let o=0,l=r.length-3;o<=l;o+=3){Vp.fromArray(r,o);const u=s.x*Math.abs(Vp.x)+s.y*Math.abs(Vp.y)+s.z*Math.abs(Vp.z),c=e.dot(Vp),h=i.dot(Vp),p=n.dot(Vp);if(Math.max(-Math.max(c,h,p),Math.min(c,h,p))>u)return!1}return!0}const Cde=new py,my=new Nt,N3=new Nt;class L3{constructor(e=new Nt,i=-1){this.isSphere=!0,this.center=e,this.radius=i}set(e,i){return this.center.copy(e),this.radius=i,this}setFromPoints(e,i){const n=this.center;i!==void 0?n.copy(i):Cde.setFromPoints(e).getCenter(n);let s=0;for(let o=0,l=e.length;o<l;o++)s=Math.max(s,n.distanceToSquared(e[o]));return this.radius=Math.sqrt(s),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const i=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=i*i}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,i){const n=this.center.distanceToSquared(e);return i.copy(e),n>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;my.subVectors(e,this.center);const i=my.lengthSq();if(i>this.radius*this.radius){const n=Math.sqrt(i),s=(n-this.radius)*.5;this.center.addScaledVector(my,s/n),this.radius+=s}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(N3.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(my.copy(e.center).add(N3)),this.expandByPoint(my.copy(e.center).sub(N3))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Yu=new Nt,D3=new Nt,H1=new Nt,vd=new Nt,O3=new Nt,W1=new Nt,P3=new Nt;class Sde{constructor(e=new Nt,i=new Nt(0,0,-1)){this.origin=e,this.direction=i}set(e,i){return this.origin.copy(e),this.direction.copy(i),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,i){return i.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Yu)),this}closestPointToPoint(e,i){i.subVectors(e,this.origin);const n=i.dot(this.direction);return n<0?i.copy(this.origin):i.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const i=Yu.subVectors(e,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(e):(Yu.copy(this.origin).addScaledVector(this.direction,i),Yu.distanceToSquared(e))}distanceSqToSegment(e,i,n,s){D3.copy(e).add(i).multiplyScalar(.5),H1.copy(i).sub(e).normalize(),vd.copy(this.origin).sub(D3);const o=e.distanceTo(i)*.5,l=-this.direction.dot(H1),u=vd.dot(this.direction),c=-vd.dot(H1),h=vd.lengthSq(),p=Math.abs(1-l*l);let f,g,m,y;if(p>0)if(f=l*c-u,g=l*u-c,y=o*p,f>=0)if(g>=-y)if(g<=y){const b=1/p;f*=b,g*=b,m=f*(f+l*g+2*u)+g*(l*f+g+2*c)+h}else g=o,f=Math.max(0,-(l*g+u)),m=-f*f+g*(g+2*c)+h;else g=-o,f=Math.max(0,-(l*g+u)),m=-f*f+g*(g+2*c)+h;else g<=-y?(f=Math.max(0,-(-l*o+u)),g=f>0?-o:Math.min(Math.max(-o,-c),o),m=-f*f+g*(g+2*c)+h):g<=y?(f=0,g=Math.min(Math.max(-o,-c),o),m=g*(g+2*c)+h):(f=Math.max(0,-(l*o+u)),g=f>0?o:Math.min(Math.max(-o,-c),o),m=-f*f+g*(g+2*c)+h);else g=l>0?-o:o,f=Math.max(0,-(l*g+u)),m=-f*f+g*(g+2*c)+h;return n&&n.copy(this.origin).addScaledVector(this.direction,f),s&&s.copy(D3).addScaledVector(H1,g),m}intersectSphere(e,i){Yu.subVectors(e.center,this.origin);const n=Yu.dot(this.direction),s=Yu.dot(Yu)-n*n,o=e.radius*e.radius;if(s>o)return null;const l=Math.sqrt(o-s),u=n-l,c=n+l;return c<0?null:u<0?this.at(c,i):this.at(u,i)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const i=e.normal.dot(this.direction);if(i===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/i;return n>=0?n:null}intersectPlane(e,i){const n=this.distanceToPlane(e);return n===null?null:this.at(n,i)}intersectsPlane(e){const i=e.distanceToPoint(this.origin);return i===0||e.normal.dot(this.direction)*i<0}intersectBox(e,i){let n,s,o,l,u,c;const h=1/this.direction.x,p=1/this.direction.y,f=1/this.direction.z,g=this.origin;return h>=0?(n=(e.min.x-g.x)*h,s=(e.max.x-g.x)*h):(n=(e.max.x-g.x)*h,s=(e.min.x-g.x)*h),p>=0?(o=(e.min.y-g.y)*p,l=(e.max.y-g.y)*p):(o=(e.max.y-g.y)*p,l=(e.min.y-g.y)*p),n>l||o>s||((o>n||isNaN(n))&&(n=o),(l<s||isNaN(s))&&(s=l),f>=0?(u=(e.min.z-g.z)*f,c=(e.max.z-g.z)*f):(u=(e.max.z-g.z)*f,c=(e.min.z-g.z)*f),n>c||u>s)||((u>n||n!==n)&&(n=u),(c<s||s!==s)&&(s=c),s<0)?null:this.at(n>=0?n:s,i)}intersectsBox(e){return this.intersectBox(e,Yu)!==null}intersectTriangle(e,i,n,s,o){O3.subVectors(i,e),W1.subVectors(n,e),P3.crossVectors(O3,W1);let l=this.direction.dot(P3),u;if(l>0){if(s)return null;u=1}else if(l<0)u=-1,l=-l;else return null;vd.subVectors(this.origin,e);const c=u*this.direction.dot(W1.crossVectors(vd,W1));if(c<0)return null;const h=u*this.direction.dot(O3.cross(vd));if(h<0||c+h>l)return null;const p=-u*vd.dot(P3);return p<0?null:this.at(p/l,o)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class ws{constructor(e,i,n,s,o,l,u,c,h,p,f,g,m,y,b,v){ws.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,i,n,s,o,l,u,c,h,p,f,g,m,y,b,v)}set(e,i,n,s,o,l,u,c,h,p,f,g,m,y,b,v){const _=this.elements;return _[0]=e,_[4]=i,_[8]=n,_[12]=s,_[1]=o,_[5]=l,_[9]=u,_[13]=c,_[2]=h,_[6]=p,_[10]=f,_[14]=g,_[3]=m,_[7]=y,_[11]=b,_[15]=v,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new ws().fromArray(this.elements)}copy(e){const i=this.elements,n=e.elements;return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],this}copyPosition(e){const i=this.elements,n=e.elements;return i[12]=n[12],i[13]=n[13],i[14]=n[14],this}setFromMatrix3(e){const i=e.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(e,i,n){return e.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,i,n){return this.set(e.x,i.x,n.x,0,e.y,i.y,n.y,0,e.z,i.z,n.z,0,0,0,0,1),this}extractRotation(e){const i=this.elements,n=e.elements,s=1/_g.setFromMatrixColumn(e,0).length(),o=1/_g.setFromMatrixColumn(e,1).length(),l=1/_g.setFromMatrixColumn(e,2).length();return i[0]=n[0]*s,i[1]=n[1]*s,i[2]=n[2]*s,i[3]=0,i[4]=n[4]*o,i[5]=n[5]*o,i[6]=n[6]*o,i[7]=0,i[8]=n[8]*l,i[9]=n[9]*l,i[10]=n[10]*l,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(e){const i=this.elements,n=e.x,s=e.y,o=e.z,l=Math.cos(n),u=Math.sin(n),c=Math.cos(s),h=Math.sin(s),p=Math.cos(o),f=Math.sin(o);if(e.order==="XYZ"){const g=l*p,m=l*f,y=u*p,b=u*f;i[0]=c*p,i[4]=-c*f,i[8]=h,i[1]=m+y*h,i[5]=g-b*h,i[9]=-u*c,i[2]=b-g*h,i[6]=y+m*h,i[10]=l*c}else if(e.order==="YXZ"){const g=c*p,m=c*f,y=h*p,b=h*f;i[0]=g+b*u,i[4]=y*u-m,i[8]=l*h,i[1]=l*f,i[5]=l*p,i[9]=-u,i[2]=m*u-y,i[6]=b+g*u,i[10]=l*c}else if(e.order==="ZXY"){const g=c*p,m=c*f,y=h*p,b=h*f;i[0]=g-b*u,i[4]=-l*f,i[8]=y+m*u,i[1]=m+y*u,i[5]=l*p,i[9]=b-g*u,i[2]=-l*h,i[6]=u,i[10]=l*c}else if(e.order==="ZYX"){const g=l*p,m=l*f,y=u*p,b=u*f;i[0]=c*p,i[4]=y*h-m,i[8]=g*h+b,i[1]=c*f,i[5]=b*h+g,i[9]=m*h-y,i[2]=-h,i[6]=u*c,i[10]=l*c}else if(e.order==="YZX"){const g=l*c,m=l*h,y=u*c,b=u*h;i[0]=c*p,i[4]=b-g*f,i[8]=y*f+m,i[1]=f,i[5]=l*p,i[9]=-u*p,i[2]=-h*p,i[6]=m*f+y,i[10]=g-b*f}else if(e.order==="XZY"){const g=l*c,m=l*h,y=u*c,b=u*h;i[0]=c*p,i[4]=-f,i[8]=h*p,i[1]=g*f+b,i[5]=l*p,i[9]=m*f-y,i[2]=y*f-m,i[6]=u*p,i[10]=b*f+g}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Tde,e,Mde)}lookAt(e,i,n){const s=this.elements;return yl.subVectors(e,i),yl.lengthSq()===0&&(yl.z=1),yl.normalize(),bd.crossVectors(n,yl),bd.lengthSq()===0&&(Math.abs(n.z)===1?yl.x+=1e-4:yl.z+=1e-4,yl.normalize(),bd.crossVectors(n,yl)),bd.normalize(),Q1.crossVectors(yl,bd),s[0]=bd.x,s[4]=Q1.x,s[8]=yl.x,s[1]=bd.y,s[5]=Q1.y,s[9]=yl.y,s[2]=bd.z,s[6]=Q1.z,s[10]=yl.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const n=e.elements,s=i.elements,o=this.elements,l=n[0],u=n[4],c=n[8],h=n[12],p=n[1],f=n[5],g=n[9],m=n[13],y=n[2],b=n[6],v=n[10],_=n[14],C=n[3],E=n[7],T=n[11],R=n[15],B=s[0],I=s[4],D=s[8],L=s[12],O=s[1],F=s[5],q=s[9],H=s[13],G=s[2],J=s[6],Q=s[10],V=s[14],z=s[3],te=s[7],K=s[11],ae=s[15];return o[0]=l*B+u*O+c*G+h*z,o[4]=l*I+u*F+c*J+h*te,o[8]=l*D+u*q+c*Q+h*K,o[12]=l*L+u*H+c*V+h*ae,o[1]=p*B+f*O+g*G+m*z,o[5]=p*I+f*F+g*J+m*te,o[9]=p*D+f*q+g*Q+m*K,o[13]=p*L+f*H+g*V+m*ae,o[2]=y*B+b*O+v*G+_*z,o[6]=y*I+b*F+v*J+_*te,o[10]=y*D+b*q+v*Q+_*K,o[14]=y*L+b*H+v*V+_*ae,o[3]=C*B+E*O+T*G+R*z,o[7]=C*I+E*F+T*J+R*te,o[11]=C*D+E*q+T*Q+R*K,o[15]=C*L+E*H+T*V+R*ae,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[4]*=e,i[8]*=e,i[12]*=e,i[1]*=e,i[5]*=e,i[9]*=e,i[13]*=e,i[2]*=e,i[6]*=e,i[10]*=e,i[14]*=e,i[3]*=e,i[7]*=e,i[11]*=e,i[15]*=e,this}determinant(){const e=this.elements,i=e[0],n=e[4],s=e[8],o=e[12],l=e[1],u=e[5],c=e[9],h=e[13],p=e[2],f=e[6],g=e[10],m=e[14],y=e[3],b=e[7],v=e[11],_=e[15];return y*(+o*c*f-s*h*f-o*u*g+n*h*g+s*u*m-n*c*m)+b*(+i*c*m-i*h*g+o*l*g-s*l*m+s*h*p-o*c*p)+v*(+i*h*f-i*u*m-o*l*f+n*l*m+o*u*p-n*h*p)+_*(-s*u*p-i*c*f+i*u*g+s*l*f-n*l*g+n*c*p)}transpose(){const e=this.elements;let i;return i=e[1],e[1]=e[4],e[4]=i,i=e[2],e[2]=e[8],e[8]=i,i=e[6],e[6]=e[9],e[9]=i,i=e[3],e[3]=e[12],e[12]=i,i=e[7],e[7]=e[13],e[13]=i,i=e[11],e[11]=e[14],e[14]=i,this}setPosition(e,i,n){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=i,s[14]=n),this}invert(){const e=this.elements,i=e[0],n=e[1],s=e[2],o=e[3],l=e[4],u=e[5],c=e[6],h=e[7],p=e[8],f=e[9],g=e[10],m=e[11],y=e[12],b=e[13],v=e[14],_=e[15],C=f*v*h-b*g*h+b*c*m-u*v*m-f*c*_+u*g*_,E=y*g*h-p*v*h-y*c*m+l*v*m+p*c*_-l*g*_,T=p*b*h-y*f*h+y*u*m-l*b*m-p*u*_+l*f*_,R=y*f*c-p*b*c-y*u*g+l*b*g+p*u*v-l*f*v,B=i*C+n*E+s*T+o*R;if(B===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const I=1/B;return e[0]=C*I,e[1]=(b*g*o-f*v*o-b*s*m+n*v*m+f*s*_-n*g*_)*I,e[2]=(u*v*o-b*c*o+b*s*h-n*v*h-u*s*_+n*c*_)*I,e[3]=(f*c*o-u*g*o-f*s*h+n*g*h+u*s*m-n*c*m)*I,e[4]=E*I,e[5]=(p*v*o-y*g*o+y*s*m-i*v*m-p*s*_+i*g*_)*I,e[6]=(y*c*o-l*v*o-y*s*h+i*v*h+l*s*_-i*c*_)*I,e[7]=(l*g*o-p*c*o+p*s*h-i*g*h-l*s*m+i*c*m)*I,e[8]=T*I,e[9]=(y*f*o-p*b*o-y*n*m+i*b*m+p*n*_-i*f*_)*I,e[10]=(l*b*o-y*u*o+y*n*h-i*b*h-l*n*_+i*u*_)*I,e[11]=(p*u*o-l*f*o-p*n*h+i*f*h+l*n*m-i*u*m)*I,e[12]=R*I,e[13]=(p*b*s-y*f*s+y*n*g-i*b*g-p*n*v+i*f*v)*I,e[14]=(y*u*s-l*b*s-y*n*c+i*b*c+l*n*v-i*u*v)*I,e[15]=(l*f*s-p*u*s+p*n*c-i*f*c-l*n*g+i*u*g)*I,this}scale(e){const i=this.elements,n=e.x,s=e.y,o=e.z;return i[0]*=n,i[4]*=s,i[8]*=o,i[1]*=n,i[5]*=s,i[9]*=o,i[2]*=n,i[6]*=s,i[10]*=o,i[3]*=n,i[7]*=s,i[11]*=o,this}getMaxScaleOnAxis(){const e=this.elements,i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(i,n,s))}makeTranslation(e,i,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,i,0,0,1,n,0,0,0,1),this}makeRotationX(e){const i=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,i,-n,0,0,n,i,0,0,0,0,1),this}makeRotationY(e){const i=Math.cos(e),n=Math.sin(e);return this.set(i,0,n,0,0,1,0,0,-n,0,i,0,0,0,0,1),this}makeRotationZ(e){const i=Math.cos(e),n=Math.sin(e);return this.set(i,-n,0,0,n,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,i){const n=Math.cos(i),s=Math.sin(i),o=1-n,l=e.x,u=e.y,c=e.z,h=o*l,p=o*u;return this.set(h*l+n,h*u-s*c,h*c+s*u,0,h*u+s*c,p*u+n,p*c-s*l,0,h*c-s*u,p*c+s*l,o*c*c+n,0,0,0,0,1),this}makeScale(e,i,n){return this.set(e,0,0,0,0,i,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,i,n,s,o,l){return this.set(1,n,o,0,e,1,l,0,i,s,1,0,0,0,0,1),this}compose(e,i,n){const s=this.elements,o=i._x,l=i._y,u=i._z,c=i._w,h=o+o,p=l+l,f=u+u,g=o*h,m=o*p,y=o*f,b=l*p,v=l*f,_=u*f,C=c*h,E=c*p,T=c*f,R=n.x,B=n.y,I=n.z;return s[0]=(1-(b+_))*R,s[1]=(m+T)*R,s[2]=(y-E)*R,s[3]=0,s[4]=(m-T)*B,s[5]=(1-(g+_))*B,s[6]=(v+C)*B,s[7]=0,s[8]=(y+E)*I,s[9]=(v-C)*I,s[10]=(1-(g+b))*I,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,i,n){const s=this.elements;let o=_g.set(s[0],s[1],s[2]).length();const l=_g.set(s[4],s[5],s[6]).length(),u=_g.set(s[8],s[9],s[10]).length();this.determinant()<0&&(o=-o),e.x=s[12],e.y=s[13],e.z=s[14],xc.copy(this);const c=1/o,h=1/l,p=1/u;return xc.elements[0]*=c,xc.elements[1]*=c,xc.elements[2]*=c,xc.elements[4]*=h,xc.elements[5]*=h,xc.elements[6]*=h,xc.elements[8]*=p,xc.elements[9]*=p,xc.elements[10]*=p,i.setFromRotationMatrix(xc),n.x=o,n.y=l,n.z=u,this}makePerspective(e,i,n,s,o,l,u=vc){const c=this.elements,h=2*o/(i-e),p=2*o/(n-s),f=(i+e)/(i-e),g=(n+s)/(n-s);let m,y;if(u===vc)m=-(l+o)/(l-o),y=-2*l*o/(l-o);else if(u===jp)m=-l/(l-o),y=-l*o/(l-o);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+u);return c[0]=h,c[4]=0,c[8]=f,c[12]=0,c[1]=0,c[5]=p,c[9]=g,c[13]=0,c[2]=0,c[6]=0,c[10]=m,c[14]=y,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,i,n,s,o,l,u=vc){const c=this.elements,h=1/(i-e),p=1/(n-s),f=1/(l-o),g=(i+e)*h,m=(n+s)*p;let y,b;if(u===vc)y=(l+o)*f,b=-2*f;else if(u===jp)y=o*f,b=-1*f;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+u);return c[0]=2*h,c[4]=0,c[8]=0,c[12]=-g,c[1]=0,c[5]=2*p,c[9]=0,c[13]=-m,c[2]=0,c[6]=0,c[10]=b,c[14]=-y,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const i=this.elements,n=e.elements;for(let s=0;s<16;s++)if(i[s]!==n[s])return!1;return!0}fromArray(e,i=0){for(let n=0;n<16;n++)this.elements[n]=e[n+i];return this}toArray(e=[],i=0){const n=this.elements;return e[i]=n[0],e[i+1]=n[1],e[i+2]=n[2],e[i+3]=n[3],e[i+4]=n[4],e[i+5]=n[5],e[i+6]=n[6],e[i+7]=n[7],e[i+8]=n[8],e[i+9]=n[9],e[i+10]=n[10],e[i+11]=n[11],e[i+12]=n[12],e[i+13]=n[13],e[i+14]=n[14],e[i+15]=n[15],e}}const _g=new Nt,xc=new ws,Tde=new Nt(0,0,0),Mde=new Nt(1,1,1),bd=new Nt,Q1=new Nt,yl=new Nt,y6=new ws,v6=new dy;class _c{constructor(e=0,i=0,n=0,s=_c.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=i,this._z=n,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,i,n,s=this._order){return this._x=e,this._y=i,this._z=n,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,i=this._order,n=!0){const s=e.elements,o=s[0],l=s[4],u=s[8],c=s[1],h=s[5],p=s[9],f=s[2],g=s[6],m=s[10];switch(i){case"XYZ":this._y=Math.asin(Ga(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-p,m),this._z=Math.atan2(-l,o)):(this._x=Math.atan2(g,h),this._z=0);break;case"YXZ":this._x=Math.asin(-Ga(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(u,m),this._z=Math.atan2(c,h)):(this._y=Math.atan2(-f,o),this._z=0);break;case"ZXY":this._x=Math.asin(Ga(g,-1,1)),Math.abs(g)<.9999999?(this._y=Math.atan2(-f,m),this._z=Math.atan2(-l,h)):(this._y=0,this._z=Math.atan2(c,o));break;case"ZYX":this._y=Math.asin(-Ga(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(g,m),this._z=Math.atan2(c,o)):(this._x=0,this._z=Math.atan2(-l,h));break;case"YZX":this._z=Math.asin(Ga(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-p,h),this._y=Math.atan2(-f,o)):(this._x=0,this._y=Math.atan2(u,m));break;case"XZY":this._z=Math.asin(-Ga(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(g,h),this._y=Math.atan2(u,o)):(this._x=Math.atan2(-p,m),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,i,n){return y6.makeRotationFromQuaternion(e),this.setFromRotationMatrix(y6,i,n)}setFromVector3(e,i=this._order){return this.set(e.x,e.y,e.z,i)}reorder(e){return v6.setFromEuler(this),this.setFromQuaternion(v6,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}_c.DEFAULT_ORDER="XYZ";class Rde{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let Ide=0;const b6=new Nt,Eg=new dy,Ju=new ws,q1=new Nt,gy=new Nt,Bde=new Nt,Nde=new dy,x6=new Nt(1,0,0),_6=new Nt(0,1,0),E6=new Nt(0,0,1),w6={type:"added"},Lde={type:"removed"},wg={type:"childadded",child:null},k3={type:"childremoved",child:null};class Ia extends mg{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Ide++}),this.uuid=qu(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ia.DEFAULT_UP.clone();const e=new Nt,i=new _c,n=new dy,s=new Nt(1,1,1);function o(){n.setFromEuler(i,!1)}function l(){i.setFromQuaternion(n,void 0,!1)}i._onChange(o),n._onChange(l),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new ws},normalMatrix:{value:new Xo}}),this.matrix=new ws,this.matrixWorld=new ws,this.matrixAutoUpdate=Ia.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Ia.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Rde,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,i){this.quaternion.setFromAxisAngle(e,i)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,i){return Eg.setFromAxisAngle(e,i),this.quaternion.multiply(Eg),this}rotateOnWorldAxis(e,i){return Eg.setFromAxisAngle(e,i),this.quaternion.premultiply(Eg),this}rotateX(e){return this.rotateOnAxis(x6,e)}rotateY(e){return this.rotateOnAxis(_6,e)}rotateZ(e){return this.rotateOnAxis(E6,e)}translateOnAxis(e,i){return b6.copy(e).applyQuaternion(this.quaternion),this.position.add(b6.multiplyScalar(i)),this}translateX(e){return this.translateOnAxis(x6,e)}translateY(e){return this.translateOnAxis(_6,e)}translateZ(e){return this.translateOnAxis(E6,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Ju.copy(this.matrixWorld).invert())}lookAt(e,i,n){e.isVector3?q1.copy(e):q1.set(e,i,n);const s=this.parent;this.updateWorldMatrix(!0,!1),gy.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ju.lookAt(gy,q1,this.up):Ju.lookAt(q1,gy,this.up),this.quaternion.setFromRotationMatrix(Ju),s&&(Ju.extractRotation(s.matrixWorld),Eg.setFromRotationMatrix(Ju),this.quaternion.premultiply(Eg.invert()))}add(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(w6),wg.child=e,this.dispatchEvent(wg),wg.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const i=this.children.indexOf(e);return i!==-1&&(e.parent=null,this.children.splice(i,1),e.dispatchEvent(Lde),k3.child=e,this.dispatchEvent(k3),k3.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Ju.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Ju.multiply(e.parent.matrixWorld)),e.applyMatrix4(Ju),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(w6),wg.child=e,this.dispatchEvent(wg),wg.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,i){if(this[e]===i)return this;for(let n=0,s=this.children.length;n<s;n++){const o=this.children[n].getObjectByProperty(e,i);if(o!==void 0)return o}}getObjectsByProperty(e,i,n=[]){this[e]===i&&n.push(this);const s=this.children;for(let o=0,l=s.length;o<l;o++)s[o].getObjectsByProperty(e,i,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(gy,e,Bde),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(gy,Nde,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return e.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(e){e(this);const i=this.children;for(let n=0,s=i.length;n<s;n++)i[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const i=this.children;for(let n=0,s=i.length;n<s;n++)i[n].traverseVisible(e)}traverseAncestors(e){const i=this.parent;i!==null&&(e(i),i.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const i=this.children;for(let n=0,s=i.length;n<s;n++)i[n].updateMatrixWorld(e)}updateWorldMatrix(e,i){const n=this.parent;if(e===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),i===!0){const s=this.children;for(let o=0,l=s.length;o<l;o++)s[o].updateWorldMatrix(!1,!0)}}toJSON(e){const i=e===void 0||typeof e=="string",n={};i&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.visibility=this._visibility,s.active=this._active,s.bounds=this._bounds.map(u=>({boxInitialized:u.boxInitialized,boxMin:u.box.min.toArray(),boxMax:u.box.max.toArray(),sphereInitialized:u.sphereInitialized,sphereRadius:u.sphere.radius,sphereCenter:u.sphere.center.toArray()})),s.maxInstanceCount=this._maxInstanceCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.geometryCount=this._geometryCount,s.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(s.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(s.boundingSphere={center:s.boundingSphere.center.toArray(),radius:s.boundingSphere.radius}),this.boundingBox!==null&&(s.boundingBox={min:s.boundingBox.min.toArray(),max:s.boundingBox.max.toArray()}));function o(u,c){return u[c.uuid]===void 0&&(u[c.uuid]=c.toJSON(e)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=o(e.geometries,this.geometry);const u=this.geometry.parameters;if(u!==void 0&&u.shapes!==void 0){const c=u.shapes;if(Array.isArray(c))for(let h=0,p=c.length;h<p;h++){const f=c[h];o(e.shapes,f)}else o(e.shapes,c)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(o(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const u=[];for(let c=0,h=this.material.length;c<h;c++)u.push(o(e.materials,this.material[c]));s.material=u}else s.material=o(e.materials,this.material);if(this.children.length>0){s.children=[];for(let u=0;u<this.children.length;u++)s.children.push(this.children[u].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let u=0;u<this.animations.length;u++){const c=this.animations[u];s.animations.push(o(e.animations,c))}}if(i){const u=l(e.geometries),c=l(e.materials),h=l(e.textures),p=l(e.images),f=l(e.shapes),g=l(e.skeletons),m=l(e.animations),y=l(e.nodes);u.length>0&&(n.geometries=u),c.length>0&&(n.materials=c),h.length>0&&(n.textures=h),p.length>0&&(n.images=p),f.length>0&&(n.shapes=f),g.length>0&&(n.skeletons=g),m.length>0&&(n.animations=m),y.length>0&&(n.nodes=y)}return n.object=s,n;function l(u){const c=[];for(const h in u){const p=u[h];delete p.metadata,c.push(p)}return c}}clone(e){return new this.constructor().copy(this,e)}copy(e,i=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),i===!0)for(let n=0;n<e.children.length;n++){const s=e.children[n];this.add(s.clone())}return this}}Ia.DEFAULT_UP=new Nt(0,1,0),Ia.DEFAULT_MATRIX_AUTO_UPDATE=!0,Ia.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Ec=new Nt,Zu=new Nt,F3=new Nt,$u=new Nt,Cg=new Nt,Sg=new Nt,C6=new Nt,U3=new Nt,z3=new Nt,j3=new Nt,G3=new Zn,V3=new Zn,H3=new Zn;class wc{constructor(e=new Nt,i=new Nt,n=new Nt){this.a=e,this.b=i,this.c=n}static getNormal(e,i,n,s){s.subVectors(n,i),Ec.subVectors(e,i),s.cross(Ec);const o=s.lengthSq();return o>0?s.multiplyScalar(1/Math.sqrt(o)):s.set(0,0,0)}static getBarycoord(e,i,n,s,o){Ec.subVectors(s,i),Zu.subVectors(n,i),F3.subVectors(e,i);const l=Ec.dot(Ec),u=Ec.dot(Zu),c=Ec.dot(F3),h=Zu.dot(Zu),p=Zu.dot(F3),f=l*h-u*u;if(f===0)return o.set(0,0,0),null;const g=1/f,m=(h*c-u*p)*g,y=(l*p-u*c)*g;return o.set(1-m-y,y,m)}static containsPoint(e,i,n,s){return this.getBarycoord(e,i,n,s,$u)===null?!1:$u.x>=0&&$u.y>=0&&$u.x+$u.y<=1}static getInterpolation(e,i,n,s,o,l,u,c){return this.getBarycoord(e,i,n,s,$u)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(o,$u.x),c.addScaledVector(l,$u.y),c.addScaledVector(u,$u.z),c)}static getInterpolatedAttribute(e,i,n,s,o,l){return G3.setScalar(0),V3.setScalar(0),H3.setScalar(0),G3.fromBufferAttribute(e,i),V3.fromBufferAttribute(e,n),H3.fromBufferAttribute(e,s),l.setScalar(0),l.addScaledVector(G3,o.x),l.addScaledVector(V3,o.y),l.addScaledVector(H3,o.z),l}static isFrontFacing(e,i,n,s){return Ec.subVectors(n,i),Zu.subVectors(e,i),Ec.cross(Zu).dot(s)<0}set(e,i,n){return this.a.copy(e),this.b.copy(i),this.c.copy(n),this}setFromPointsAndIndices(e,i,n,s){return this.a.copy(e[i]),this.b.copy(e[n]),this.c.copy(e[s]),this}setFromAttributeAndIndices(e,i,n,s){return this.a.fromBufferAttribute(e,i),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Ec.subVectors(this.c,this.b),Zu.subVectors(this.a,this.b),Ec.cross(Zu).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return wc.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,i){return wc.getBarycoord(e,this.a,this.b,this.c,i)}getInterpolation(e,i,n,s,o){return wc.getInterpolation(e,this.a,this.b,this.c,i,n,s,o)}containsPoint(e){return wc.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return wc.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,i){const n=this.a,s=this.b,o=this.c;let l,u;Cg.subVectors(s,n),Sg.subVectors(o,n),U3.subVectors(e,n);const c=Cg.dot(U3),h=Sg.dot(U3);if(c<=0&&h<=0)return i.copy(n);z3.subVectors(e,s);const p=Cg.dot(z3),f=Sg.dot(z3);if(p>=0&&f<=p)return i.copy(s);const g=c*f-p*h;if(g<=0&&c>=0&&p<=0)return l=c/(c-p),i.copy(n).addScaledVector(Cg,l);j3.subVectors(e,o);const m=Cg.dot(j3),y=Sg.dot(j3);if(y>=0&&m<=y)return i.copy(o);const b=m*h-c*y;if(b<=0&&h>=0&&y<=0)return u=h/(h-y),i.copy(n).addScaledVector(Sg,u);const v=p*y-m*f;if(v<=0&&f-p>=0&&m-y>=0)return C6.subVectors(o,s),u=(f-p)/(f-p+(m-y)),i.copy(s).addScaledVector(C6,u);const _=1/(v+b+g);return l=b*_,u=g*_,i.copy(n).addScaledVector(Cg,l).addScaledVector(Sg,u)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const S6={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},xd={h:0,s:0,l:0},X1={h:0,s:0,l:0};function W3(r,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?r+(e-r)*6*i:i<1/2?e:i<2/3?r+(e-r)*6*(2/3-i):r}class $n{constructor(e,i,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,i,n)}set(e,i,n){if(i===void 0&&n===void 0){const s=e;s&&s.isColor?this.copy(s):typeof s=="number"?this.setHex(s):typeof s=="string"&&this.setStyle(s)}else this.setRGB(e,i,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,i=Lr){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,ta.toWorkingColorSpace(this,i),this}setRGB(e,i,n,s=ta.workingColorSpace){return this.r=e,this.g=i,this.b=n,ta.toWorkingColorSpace(this,s),this}setHSL(e,i,n,s=ta.workingColorSpace){if(e=S3(e,1),i=Ga(i,0,1),n=Ga(n,0,1),i===0)this.r=this.g=this.b=n;else{const o=n<=.5?n*(1+i):n+i-n*i,l=2*n-o;this.r=W3(l,o,e+1/3),this.g=W3(l,o,e),this.b=W3(l,o,e-1/3)}return ta.toWorkingColorSpace(this,s),this}setStyle(e,i=Lr){function n(o){o!==void 0&&parseFloat(o)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let s;if(s=/^(\w+)\(([^\)]*)\)/.exec(e)){let o;const l=s[1],u=s[2];switch(l){case"rgb":case"rgba":if(o=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(u))return n(o[4]),this.setRGB(Math.min(255,parseInt(o[1],10))/255,Math.min(255,parseInt(o[2],10))/255,Math.min(255,parseInt(o[3],10))/255,i);if(o=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(u))return n(o[4]),this.setRGB(Math.min(100,parseInt(o[1],10))/100,Math.min(100,parseInt(o[2],10))/100,Math.min(100,parseInt(o[3],10))/100,i);break;case"hsl":case"hsla":if(o=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(u))return n(o[4]),this.setHSL(parseFloat(o[1])/360,parseFloat(o[2])/100,parseFloat(o[3])/100,i);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(e)){const o=s[1],l=o.length;if(l===3)return this.setRGB(parseInt(o.charAt(0),16)/15,parseInt(o.charAt(1),16)/15,parseInt(o.charAt(2),16)/15,i);if(l===6)return this.setHex(parseInt(o,16),i);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,i);return this}setColorName(e,i=Lr){const n=S6[e.toLowerCase()];return n!==void 0?this.setHex(n,i):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Xu(e.r),this.g=Xu(e.g),this.b=Xu(e.b),this}copyLinearToSRGB(e){return this.r=gg(e.r),this.g=gg(e.g),this.b=gg(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Lr){return ta.fromWorkingColorSpace(ao.copy(this),e),Math.round(Ga(ao.r*255,0,255))*65536+Math.round(Ga(ao.g*255,0,255))*256+Math.round(Ga(ao.b*255,0,255))}getHexString(e=Lr){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,i=ta.workingColorSpace){ta.fromWorkingColorSpace(ao.copy(this),i);const n=ao.r,s=ao.g,o=ao.b,l=Math.max(n,s,o),u=Math.min(n,s,o);let c,h;const p=(u+l)/2;if(u===l)c=0,h=0;else{const f=l-u;switch(h=p<=.5?f/(l+u):f/(2-l-u),l){case n:c=(s-o)/f+(s<o?6:0);break;case s:c=(o-n)/f+2;break;case o:c=(n-s)/f+4;break}c/=6}return e.h=c,e.s=h,e.l=p,e}getRGB(e,i=ta.workingColorSpace){return ta.fromWorkingColorSpace(ao.copy(this),i),e.r=ao.r,e.g=ao.g,e.b=ao.b,e}getStyle(e=Lr){ta.fromWorkingColorSpace(ao.copy(this),e);const i=ao.r,n=ao.g,s=ao.b;return e!==Lr?`color(${e} ${i.toFixed(3)} ${n.toFixed(3)} ${s.toFixed(3)})`:`rgb(${Math.round(i*255)},${Math.round(n*255)},${Math.round(s*255)})`}offsetHSL(e,i,n){return this.getHSL(xd),this.setHSL(xd.h+e,xd.s+i,xd.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,i){return this.r=e.r+i.r,this.g=e.g+i.g,this.b=e.b+i.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,i){return this.r+=(e.r-this.r)*i,this.g+=(e.g-this.g)*i,this.b+=(e.b-this.b)*i,this}lerpColors(e,i,n){return this.r=e.r+(i.r-e.r)*n,this.g=e.g+(i.g-e.g)*n,this.b=e.b+(i.b-e.b)*n,this}lerpHSL(e,i){this.getHSL(xd),e.getHSL(X1);const n=hy(xd.h,X1.h,i),s=hy(xd.s,X1.s,i),o=hy(xd.l,X1.l,i);return this.setHSL(n,s,o),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const i=this.r,n=this.g,s=this.b,o=e.elements;return this.r=o[0]*i+o[3]*n+o[6]*s,this.g=o[1]*i+o[4]*n+o[7]*s,this.b=o[2]*i+o[5]*n+o[8]*s,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,i=0){return this.r=e[i],this.g=e[i+1],this.b=e[i+2],this}toArray(e=[],i=0){return e[i]=this.r,e[i+1]=this.g,e[i+2]=this.b,e}fromBufferAttribute(e,i){return this.r=e.getX(i),this.g=e.getY(i),this.b=e.getZ(i),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const ao=new $n;$n.NAMES=S6;let Dde=0;class Ko extends mg{static get type(){return"Material"}get type(){return this.constructor.type}set type(e){}constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Dde++}),this.uuid=qu(),this.name="",this.blending=dd,this.side=ng,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=B1,this.blendDst=N1,this.blendEquation=pd,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new $n(0,0,0),this.blendAlpha=0,this.depthFunc=L1,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=w3,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=zp,this.stencilZFail=zp,this.stencilZPass=zp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const i in e){const n=e[i];if(n===void 0){console.warn(`THREE.Material: parameter '${i}' has value of undefined.`);continue}const s=this[i];if(s===void 0){console.warn(`THREE.Material: '${i}' is not a property of THREE.${this.type}.`);continue}s&&s.isColor?s.set(n):s&&s.isVector3&&n&&n.isVector3?s.copy(n):this[i]=n}}toJSON(e){const i=e===void 0||typeof e=="string";i&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(n.dispersion=this.dispersion),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapRotation!==void 0&&(n.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==dd&&(n.blending=this.blending),this.side!==ng&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),this.blendSrc!==B1&&(n.blendSrc=this.blendSrc),this.blendDst!==N1&&(n.blendDst=this.blendDst),this.blendEquation!==pd&&(n.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(n.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(n.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==L1&&(n.depthFunc=this.depthFunc),this.depthTest===!1&&(n.depthTest=this.depthTest),this.depthWrite===!1&&(n.depthWrite=this.depthWrite),this.colorWrite===!1&&(n.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==w3&&(n.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(n.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==zp&&(n.stencilFail=this.stencilFail),this.stencilZFail!==zp&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==zp&&(n.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(n.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function s(o){const l=[];for(const u in o){const c=o[u];delete c.metadata,l.push(c)}return l}if(i){const o=s(e.textures),l=s(e.images);o.length>0&&(n.textures=o),l.length>0&&(n.images=l)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const i=e.clippingPlanes;let n=null;if(i!==null){const s=i.length;n=new Array(s);for(let o=0;o!==s;++o)n[o]=i[o].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class K1 extends Ko{static get type(){return"MeshBasicMaterial"}constructor(e){super(),this.isMeshBasicMaterial=!0,this.color=new $n(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new _c,this.combine=D1,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const eh=Ode();function Ode(){const r=new ArrayBuffer(4),e=new Float32Array(r),i=new Uint32Array(r),n=new Uint32Array(512),s=new Uint32Array(512);for(let c=0;c<256;++c){const h=c-127;h<-27?(n[c]=0,n[c|256]=32768,s[c]=24,s[c|256]=24):h<-14?(n[c]=1024>>-h-14,n[c|256]=1024>>-h-14|32768,s[c]=-h-1,s[c|256]=-h-1):h<=15?(n[c]=h+15<<10,n[c|256]=h+15<<10|32768,s[c]=13,s[c|256]=13):h<128?(n[c]=31744,n[c|256]=64512,s[c]=24,s[c|256]=24):(n[c]=31744,n[c|256]=64512,s[c]=13,s[c|256]=13)}const o=new Uint32Array(2048),l=new Uint32Array(64),u=new Uint32Array(64);for(let c=1;c<1024;++c){let h=c<<13,p=0;for(;!(h&8388608);)h<<=1,p-=8388608;h&=-8388609,p+=947912704,o[c]=h|p}for(let c=1024;c<2048;++c)o[c]=939524096+(c-1024<<13);for(let c=1;c<31;++c)l[c]=c<<23;l[31]=1199570944,l[32]=2147483648;for(let c=33;c<63;++c)l[c]=2147483648+(c-32<<23);l[63]=3347054592;for(let c=1;c<64;++c)c!==32&&(u[c]=1024);return{floatView:e,uint32View:i,baseTable:n,shiftTable:s,mantissaTable:o,exponentTable:l,offsetTable:u}}function vl(r){Math.abs(r)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),r=Ga(r,-65504,65504),eh.floatView[0]=r;const e=eh.uint32View[0],i=e>>23&511;return eh.baseTable[i]+((e&8388607)>>eh.shiftTable[i])}function Y1(r){const e=r>>10;return eh.uint32View[0]=eh.mantissaTable[eh.offsetTable[e]+(r&1023)]+eh.exponentTable[e],eh.floatView[0]}const ia=new Nt,J1=new Dn;class Fl{constructor(e,i,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=i,this.count=e!==void 0?e.length/i:0,this.normalized=n,this.usage=z1,this.updateRanges=[],this.gpuType=Al,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,i){this.updateRanges.push({start:e,count:i})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,i,n){e*=this.itemSize,n*=i.itemSize;for(let s=0,o=this.itemSize;s<o;s++)this.array[e+s]=i.array[n+s];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let i=0,n=this.count;i<n;i++)J1.fromBufferAttribute(this,i),J1.applyMatrix3(e),this.setXY(i,J1.x,J1.y);else if(this.itemSize===3)for(let i=0,n=this.count;i<n;i++)ia.fromBufferAttribute(this,i),ia.applyMatrix3(e),this.setXYZ(i,ia.x,ia.y,ia.z);return this}applyMatrix4(e){for(let i=0,n=this.count;i<n;i++)ia.fromBufferAttribute(this,i),ia.applyMatrix4(e),this.setXYZ(i,ia.x,ia.y,ia.z);return this}applyNormalMatrix(e){for(let i=0,n=this.count;i<n;i++)ia.fromBufferAttribute(this,i),ia.applyNormalMatrix(e),this.setXYZ(i,ia.x,ia.y,ia.z);return this}transformDirection(e){for(let i=0,n=this.count;i<n;i++)ia.fromBufferAttribute(this,i),ia.transformDirection(e),this.setXYZ(i,ia.x,ia.y,ia.z);return this}set(e,i=0){return this.array.set(e,i),this}getComponent(e,i){let n=this.array[e*this.itemSize+i];return this.normalized&&(n=So(n,this.array)),n}setComponent(e,i,n){return this.normalized&&(n=en(n,this.array)),this.array[e*this.itemSize+i]=n,this}getX(e){let i=this.array[e*this.itemSize];return this.normalized&&(i=So(i,this.array)),i}setX(e,i){return this.normalized&&(i=en(i,this.array)),this.array[e*this.itemSize]=i,this}getY(e){let i=this.array[e*this.itemSize+1];return this.normalized&&(i=So(i,this.array)),i}setY(e,i){return this.normalized&&(i=en(i,this.array)),this.array[e*this.itemSize+1]=i,this}getZ(e){let i=this.array[e*this.itemSize+2];return this.normalized&&(i=So(i,this.array)),i}setZ(e,i){return this.normalized&&(i=en(i,this.array)),this.array[e*this.itemSize+2]=i,this}getW(e){let i=this.array[e*this.itemSize+3];return this.normalized&&(i=So(i,this.array)),i}setW(e,i){return this.normalized&&(i=en(i,this.array)),this.array[e*this.itemSize+3]=i,this}setXY(e,i,n){return e*=this.itemSize,this.normalized&&(i=en(i,this.array),n=en(n,this.array)),this.array[e+0]=i,this.array[e+1]=n,this}setXYZ(e,i,n,s){return e*=this.itemSize,this.normalized&&(i=en(i,this.array),n=en(n,this.array),s=en(s,this.array)),this.array[e+0]=i,this.array[e+1]=n,this.array[e+2]=s,this}setXYZW(e,i,n,s,o){return e*=this.itemSize,this.normalized&&(i=en(i,this.array),n=en(n,this.array),s=en(s,this.array),o=en(o,this.array)),this.array[e+0]=i,this.array[e+1]=n,this.array[e+2]=s,this.array[e+3]=o,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==z1&&(e.usage=this.usage),e}}class T6 extends Fl{constructor(e,i,n){super(new Uint16Array(e),i,n)}}class M6 extends Fl{constructor(e,i,n){super(new Uint32Array(e),i,n)}}class R6 extends Fl{constructor(e,i,n){super(new Uint16Array(e),i,n),this.isFloat16BufferAttribute=!0}getX(e){let i=Y1(this.array[e*this.itemSize]);return this.normalized&&(i=So(i,this.array)),i}setX(e,i){return this.normalized&&(i=en(i,this.array)),this.array[e*this.itemSize]=vl(i),this}getY(e){let i=Y1(this.array[e*this.itemSize+1]);return this.normalized&&(i=So(i,this.array)),i}setY(e,i){return this.normalized&&(i=en(i,this.array)),this.array[e*this.itemSize+1]=vl(i),this}getZ(e){let i=Y1(this.array[e*this.itemSize+2]);return this.normalized&&(i=So(i,this.array)),i}setZ(e,i){return this.normalized&&(i=en(i,this.array)),this.array[e*this.itemSize+2]=vl(i),this}getW(e){let i=Y1(this.array[e*this.itemSize+3]);return this.normalized&&(i=So(i,this.array)),i}setW(e,i){return this.normalized&&(i=en(i,this.array)),this.array[e*this.itemSize+3]=vl(i),this}setXY(e,i,n){return e*=this.itemSize,this.normalized&&(i=en(i,this.array),n=en(n,this.array)),this.array[e+0]=vl(i),this.array[e+1]=vl(n),this}setXYZ(e,i,n,s){return e*=this.itemSize,this.normalized&&(i=en(i,this.array),n=en(n,this.array),s=en(s,this.array)),this.array[e+0]=vl(i),this.array[e+1]=vl(n),this.array[e+2]=vl(s),this}setXYZW(e,i,n,s,o){return e*=this.itemSize,this.normalized&&(i=en(i,this.array),n=en(n,this.array),s=en(s,this.array),o=en(o,this.array)),this.array[e+0]=vl(i),this.array[e+1]=vl(n),this.array[e+2]=vl(s),this.array[e+3]=vl(o),this}}class th extends Fl{constructor(e,i,n){super(new Float32Array(e),i,n)}}let Pde=0;const Ul=new ws,Q3=new Ia,Tg=new Nt,bl=new py,Ay=new py,Ba=new Nt;class Hp extends mg{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Pde++}),this.uuid=qu(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Ade(e)?M6:T6)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,i){return this.attributes[e]=i,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,i,n=0){this.groups.push({start:e,count:i,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,i){this.drawRange.start=e,this.drawRange.count=i}applyMatrix4(e){const i=this.attributes.position;i!==void 0&&(i.applyMatrix4(e),i.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const o=new Xo().getNormalMatrix(e);n.applyNormalMatrix(o),n.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(e),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Ul.makeRotationFromQuaternion(e),this.applyMatrix4(Ul),this}rotateX(e){return Ul.makeRotationX(e),this.applyMatrix4(Ul),this}rotateY(e){return Ul.makeRotationY(e),this.applyMatrix4(Ul),this}rotateZ(e){return Ul.makeRotationZ(e),this.applyMatrix4(Ul),this}translate(e,i,n){return Ul.makeTranslation(e,i,n),this.applyMatrix4(Ul),this}scale(e,i,n){return Ul.makeScale(e,i,n),this.applyMatrix4(Ul),this}lookAt(e){return Q3.lookAt(e),Q3.updateMatrix(),this.applyMatrix4(Q3.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Tg).negate(),this.translate(Tg.x,Tg.y,Tg.z),this}setFromPoints(e){const i=this.getAttribute("position");if(i===void 0){const n=[];for(let s=0,o=e.length;s<o;s++){const l=e[s];n.push(l.x,l.y,l.z||0)}this.setAttribute("position",new th(n,3))}else{for(let n=0,s=i.count;n<s;n++){const o=e[n];i.setXYZ(n,o.x,o.y,o.z||0)}e.length>i.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),i.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new py);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new Nt(-1/0,-1/0,-1/0),new Nt(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),i)for(let n=0,s=i.length;n<s;n++){const o=i[n];bl.setFromBufferAttribute(o),this.morphTargetsRelative?(Ba.addVectors(this.boundingBox.min,bl.min),this.boundingBox.expandByPoint(Ba),Ba.addVectors(this.boundingBox.max,bl.max),this.boundingBox.expandByPoint(Ba)):(this.boundingBox.expandByPoint(bl.min),this.boundingBox.expandByPoint(bl.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new L3);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new Nt,1/0);return}if(e){const n=this.boundingSphere.center;if(bl.setFromBufferAttribute(e),i)for(let o=0,l=i.length;o<l;o++){const u=i[o];Ay.setFromBufferAttribute(u),this.morphTargetsRelative?(Ba.addVectors(bl.min,Ay.min),bl.expandByPoint(Ba),Ba.addVectors(bl.max,Ay.max),bl.expandByPoint(Ba)):(bl.expandByPoint(Ay.min),bl.expandByPoint(Ay.max))}bl.getCenter(n);let s=0;for(let o=0,l=e.count;o<l;o++)Ba.fromBufferAttribute(e,o),s=Math.max(s,n.distanceToSquared(Ba));if(i)for(let o=0,l=i.length;o<l;o++){const u=i[o],c=this.morphTargetsRelative;for(let h=0,p=u.count;h<p;h++)Ba.fromBufferAttribute(u,h),c&&(Tg.fromBufferAttribute(e,h),Ba.add(Tg)),s=Math.max(s,n.distanceToSquared(Ba))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,i=this.attributes;if(e===null||i.position===void 0||i.normal===void 0||i.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=i.position,s=i.normal,o=i.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Fl(new Float32Array(4*n.count),4));const l=this.getAttribute("tangent"),u=[],c=[];for(let D=0;D<n.count;D++)u[D]=new Nt,c[D]=new Nt;const h=new Nt,p=new Nt,f=new Nt,g=new Dn,m=new Dn,y=new Dn,b=new Nt,v=new Nt;function _(D,L,O){h.fromBufferAttribute(n,D),p.fromBufferAttribute(n,L),f.fromBufferAttribute(n,O),g.fromBufferAttribute(o,D),m.fromBufferAttribute(o,L),y.fromBufferAttribute(o,O),p.sub(h),f.sub(h),m.sub(g),y.sub(g);const F=1/(m.x*y.y-y.x*m.y);isFinite(F)&&(b.copy(p).multiplyScalar(y.y).addScaledVector(f,-m.y).multiplyScalar(F),v.copy(f).multiplyScalar(m.x).addScaledVector(p,-y.x).multiplyScalar(F),u[D].add(b),u[L].add(b),u[O].add(b),c[D].add(v),c[L].add(v),c[O].add(v))}let C=this.groups;C.length===0&&(C=[{start:0,count:e.count}]);for(let D=0,L=C.length;D<L;++D){const O=C[D],F=O.start,q=O.count;for(let H=F,G=F+q;H<G;H+=3)_(e.getX(H+0),e.getX(H+1),e.getX(H+2))}const E=new Nt,T=new Nt,R=new Nt,B=new Nt;function I(D){R.fromBufferAttribute(s,D),B.copy(R);const L=u[D];E.copy(L),E.sub(R.multiplyScalar(R.dot(L))).normalize(),T.crossVectors(B,L);const O=T.dot(c[D])<0?-1:1;l.setXYZW(D,E.x,E.y,E.z,O)}for(let D=0,L=C.length;D<L;++D){const O=C[D],F=O.start,q=O.count;for(let H=F,G=F+q;H<G;H+=3)I(e.getX(H+0)),I(e.getX(H+1)),I(e.getX(H+2))}}computeVertexNormals(){const e=this.index,i=this.getAttribute("position");if(i!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new Fl(new Float32Array(i.count*3),3),this.setAttribute("normal",n);else for(let g=0,m=n.count;g<m;g++)n.setXYZ(g,0,0,0);const s=new Nt,o=new Nt,l=new Nt,u=new Nt,c=new Nt,h=new Nt,p=new Nt,f=new Nt;if(e)for(let g=0,m=e.count;g<m;g+=3){const y=e.getX(g+0),b=e.getX(g+1),v=e.getX(g+2);s.fromBufferAttribute(i,y),o.fromBufferAttribute(i,b),l.fromBufferAttribute(i,v),p.subVectors(l,o),f.subVectors(s,o),p.cross(f),u.fromBufferAttribute(n,y),c.fromBufferAttribute(n,b),h.fromBufferAttribute(n,v),u.add(p),c.add(p),h.add(p),n.setXYZ(y,u.x,u.y,u.z),n.setXYZ(b,c.x,c.y,c.z),n.setXYZ(v,h.x,h.y,h.z)}else for(let g=0,m=i.count;g<m;g+=3)s.fromBufferAttribute(i,g+0),o.fromBufferAttribute(i,g+1),l.fromBufferAttribute(i,g+2),p.subVectors(l,o),f.subVectors(s,o),p.cross(f),n.setXYZ(g+0,p.x,p.y,p.z),n.setXYZ(g+1,p.x,p.y,p.z),n.setXYZ(g+2,p.x,p.y,p.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let i=0,n=e.count;i<n;i++)Ba.fromBufferAttribute(e,i),Ba.normalize(),e.setXYZ(i,Ba.x,Ba.y,Ba.z)}toNonIndexed(){function e(u,c){const h=u.array,p=u.itemSize,f=u.normalized,g=new h.constructor(c.length*p);let m=0,y=0;for(let b=0,v=c.length;b<v;b++){u.isInterleavedBufferAttribute?m=c[b]*u.data.stride+u.offset:m=c[b]*p;for(let _=0;_<p;_++)g[y++]=h[m++]}return new Fl(g,p,f)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const i=new Hp,n=this.index.array,s=this.attributes;for(const u in s){const c=s[u],h=e(c,n);i.setAttribute(u,h)}const o=this.morphAttributes;for(const u in o){const c=[],h=o[u];for(let p=0,f=h.length;p<f;p++){const g=h[p],m=e(g,n);c.push(m)}i.morphAttributes[u]=c}i.morphTargetsRelative=this.morphTargetsRelative;const l=this.groups;for(let u=0,c=l.length;u<c;u++){const h=l[u];i.addGroup(h.start,h.count,h.materialIndex)}return i}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const h in c)c[h]!==void 0&&(e[h]=c[h]);return e}e.data={attributes:{}};const i=this.index;i!==null&&(e.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});const n=this.attributes;for(const c in n){const h=n[c];e.data.attributes[c]=h.toJSON(e.data)}const s={};let o=!1;for(const c in this.morphAttributes){const h=this.morphAttributes[c],p=[];for(let f=0,g=h.length;f<g;f++){const m=h[f];p.push(m.toJSON(e.data))}p.length>0&&(s[c]=p,o=!0)}o&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);const l=this.groups;l.length>0&&(e.data.groups=JSON.parse(JSON.stringify(l)));const u=this.boundingSphere;return u!==null&&(e.data.boundingSphere={center:u.center.toArray(),radius:u.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const i={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone(i));const s=e.attributes;for(const h in s){const p=s[h];this.setAttribute(h,p.clone(i))}const o=e.morphAttributes;for(const h in o){const p=[],f=o[h];for(let g=0,m=f.length;g<m;g++)p.push(f[g].clone(i));this.morphAttributes[h]=p}this.morphTargetsRelative=e.morphTargetsRelative;const l=e.groups;for(let h=0,p=l.length;h<p;h++){const f=l[h];this.addGroup(f.start,f.count,f.materialIndex)}const u=e.boundingBox;u!==null&&(this.boundingBox=u.clone());const c=e.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const I6=new ws,Wp=new Sde,Z1=new L3,B6=new Nt,$1=new Nt,e_=new Nt,t_=new Nt,q3=new Nt,i_=new Nt,N6=new Nt,r_=new Nt;class Qp extends Ia{constructor(e=new Hp,i=new K1){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=i,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){const n=e[i[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=n.length;s<o;s++){const l=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=s}}}}getVertexPosition(e,i){const n=this.geometry,s=n.attributes.position,o=n.morphAttributes.position,l=n.morphTargetsRelative;i.fromBufferAttribute(s,e);const u=this.morphTargetInfluences;if(o&&u){i_.set(0,0,0);for(let c=0,h=o.length;c<h;c++){const p=u[c],f=o[c];p!==0&&(q3.fromBufferAttribute(f,e),l?i_.addScaledVector(q3,p):i_.addScaledVector(q3.sub(i),p))}i.add(i_)}return i}raycast(e,i){const n=this.geometry,s=this.material,o=this.matrixWorld;s!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),Z1.copy(n.boundingSphere),Z1.applyMatrix4(o),Wp.copy(e.ray).recast(e.near),!(Z1.containsPoint(Wp.origin)===!1&&(Wp.intersectSphere(Z1,B6)===null||Wp.origin.distanceToSquared(B6)>(e.far-e.near)**2))&&(I6.copy(o).invert(),Wp.copy(e.ray).applyMatrix4(I6),!(n.boundingBox!==null&&Wp.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(e,i,Wp)))}_computeIntersections(e,i,n){let s;const o=this.geometry,l=this.material,u=o.index,c=o.attributes.position,h=o.attributes.uv,p=o.attributes.uv1,f=o.attributes.normal,g=o.groups,m=o.drawRange;if(u!==null)if(Array.isArray(l))for(let y=0,b=g.length;y<b;y++){const v=g[y],_=l[v.materialIndex],C=Math.max(v.start,m.start),E=Math.min(u.count,Math.min(v.start+v.count,m.start+m.count));for(let T=C,R=E;T<R;T+=3){const B=u.getX(T),I=u.getX(T+1),D=u.getX(T+2);s=n_(this,_,e,n,h,p,f,B,I,D),s&&(s.faceIndex=Math.floor(T/3),s.face.materialIndex=v.materialIndex,i.push(s))}}else{const y=Math.max(0,m.start),b=Math.min(u.count,m.start+m.count);for(let v=y,_=b;v<_;v+=3){const C=u.getX(v),E=u.getX(v+1),T=u.getX(v+2);s=n_(this,l,e,n,h,p,f,C,E,T),s&&(s.faceIndex=Math.floor(v/3),i.push(s))}}else if(c!==void 0)if(Array.isArray(l))for(let y=0,b=g.length;y<b;y++){const v=g[y],_=l[v.materialIndex],C=Math.max(v.start,m.start),E=Math.min(c.count,Math.min(v.start+v.count,m.start+m.count));for(let T=C,R=E;T<R;T+=3){const B=T,I=T+1,D=T+2;s=n_(this,_,e,n,h,p,f,B,I,D),s&&(s.faceIndex=Math.floor(T/3),s.face.materialIndex=v.materialIndex,i.push(s))}}else{const y=Math.max(0,m.start),b=Math.min(c.count,m.start+m.count);for(let v=y,_=b;v<_;v+=3){const C=v,E=v+1,T=v+2;s=n_(this,l,e,n,h,p,f,C,E,T),s&&(s.faceIndex=Math.floor(v/3),i.push(s))}}}}function kde(r,e,i,n,s,o,l,u){let c;if(e.side===yc?c=n.intersectTriangle(l,o,s,!0,u):c=n.intersectTriangle(s,o,l,e.side===ng,u),c===null)return null;r_.copy(u),r_.applyMatrix4(r.matrixWorld);const h=i.ray.origin.distanceTo(r_);return h<i.near||h>i.far?null:{distance:h,point:r_.clone(),object:r}}function n_(r,e,i,n,s,o,l,u,c,h){r.getVertexPosition(u,$1),r.getVertexPosition(c,e_),r.getVertexPosition(h,t_);const p=kde(r,e,i,n,$1,e_,t_,N6);if(p){const f=new Nt;wc.getBarycoord(N6,$1,e_,t_,f),s&&(p.uv=wc.getInterpolatedAttribute(s,u,c,h,f,new Dn)),o&&(p.uv1=wc.getInterpolatedAttribute(o,u,c,h,f,new Dn)),l&&(p.normal=wc.getInterpolatedAttribute(l,u,c,h,f,new Nt),p.normal.dot(n.direction)>0&&p.normal.multiplyScalar(-1));const g={a:u,b:c,c:h,normal:new Nt,materialIndex:0};wc.getNormal($1,e_,t_,g.normal),p.face=g,p.barycoord=f}return p}class yy extends Hp{constructor(e=1,i=1,n=1,s=1,o=1,l=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:i,depth:n,widthSegments:s,heightSegments:o,depthSegments:l};const u=this;s=Math.floor(s),o=Math.floor(o),l=Math.floor(l);const c=[],h=[],p=[],f=[];let g=0,m=0;y("z","y","x",-1,-1,n,i,e,l,o,0),y("z","y","x",1,-1,n,i,-e,l,o,1),y("x","z","y",1,1,e,n,i,s,l,2),y("x","z","y",1,-1,e,n,-i,s,l,3),y("x","y","z",1,-1,e,i,n,s,o,4),y("x","y","z",-1,-1,e,i,-n,s,o,5),this.setIndex(c),this.setAttribute("position",new th(h,3)),this.setAttribute("normal",new th(p,3)),this.setAttribute("uv",new th(f,2));function y(b,v,_,C,E,T,R,B,I,D,L){const O=T/I,F=R/D,q=T/2,H=R/2,G=B/2,J=I+1,Q=D+1;let V=0,z=0;const te=new Nt;for(let K=0;K<Q;K++){const ae=K*F-H;for(let Ae=0;Ae<J;Ae++){const _e=Ae*O-q;te[b]=_e*C,te[v]=ae*E,te[_]=G,h.push(te.x,te.y,te.z),te[b]=0,te[v]=0,te[_]=B>0?1:-1,p.push(te.x,te.y,te.z),f.push(Ae/I),f.push(1-K/D),V+=1}}for(let K=0;K<D;K++)for(let ae=0;ae<I;ae++){const Ae=g+ae+J*K,_e=g+ae+J*(K+1),me=g+(ae+1)+J*(K+1),Pe=g+(ae+1)+J*K;c.push(Ae,_e,Pe),c.push(_e,me,Pe),z+=6}u.addGroup(m,z,L),m+=z,g+=V}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new yy(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function L6(r){const e={};for(const i in r){e[i]={};for(const n in r[i]){const s=r[i][n];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[i][n]=null):e[i][n]=s.clone():Array.isArray(s)?e[i][n]=s.slice():e[i][n]=s}}return e}function Fde(r){const e=[];for(let i=0;i<r.length;i++)e.push(r[i].clone());return e}var Ude=`
void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}
`,zde=`
void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}
`;class jde extends Ko{static get type(){return"ShaderMaterial"}constructor(e){super(),this.isShaderMaterial=!0,this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=Ude,this.fragmentShader=zde,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=L6(e.uniforms),this.uniformsGroups=Fde(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const i=super.toJSON(e);i.glslVersion=this.glslVersion,i.uniforms={};for(const s in this.uniforms){const o=this.uniforms[s].value;o&&o.isTexture?i.uniforms[s]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?i.uniforms[s]={type:"c",value:o.getHex()}:o&&o.isVector2?i.uniforms[s]={type:"v2",value:o.toArray()}:o&&o.isVector3?i.uniforms[s]={type:"v3",value:o.toArray()}:o&&o.isVector4?i.uniforms[s]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?i.uniforms[s]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?i.uniforms[s]={type:"m4",value:o.toArray()}:i.uniforms[s]={value:o}}Object.keys(this.defines).length>0&&(i.defines=this.defines),i.vertexShader=this.vertexShader,i.fragmentShader=this.fragmentShader,i.lights=this.lights,i.clipping=this.clipping;const n={};for(const s in this.extensions)this.extensions[s]===!0&&(n[s]=!0);return Object.keys(n).length>0&&(i.extensions=n),i}}class D6 extends Ia{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new ws,this.projectionMatrix=new ws,this.projectionMatrixInverse=new ws,this.coordinateSystem=vc}copy(e,i){return super.copy(e,i),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,i){super.updateWorldMatrix(e,i),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const _d=new Nt,O6=new Dn,P6=new Dn;class ih extends D6{constructor(e=50,i=1,n=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=s,this.focus=10,this.aspect=i,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,i){return super.copy(e,i),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const i=.5*this.getFilmHeight()/e;this.fov=uy*2*Math.atan(i),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(cy*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return uy*2*Math.atan(Math.tan(cy*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,i,n){_d.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(_d.x,_d.y).multiplyScalar(-e/_d.z),_d.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(_d.x,_d.y).multiplyScalar(-e/_d.z)}getViewSize(e,i){return this.getViewBounds(e,O6,P6),i.subVectors(P6,O6)}setViewOffset(e,i,n,s,o,l){this.aspect=e/i,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=i,this.view.offsetX=n,this.view.offsetY=s,this.view.width=o,this.view.height=l,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let i=e*Math.tan(cy*.5*this.fov)/this.zoom,n=2*i,s=this.aspect*n,o=-.5*s;const l=this.view;if(this.view!==null&&this.view.enabled){const c=l.fullWidth,h=l.fullHeight;o+=l.offsetX*s/c,i-=l.offsetY*n/h,s*=l.width/c,n*=l.height/h}const u=this.filmOffset;u!==0&&(o+=e*u/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+s,i,i-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const i=super.toJSON(e);return i.object.fov=this.fov,i.object.zoom=this.zoom,i.object.near=this.near,i.object.far=this.far,i.object.focus=this.focus,i.object.aspect=this.aspect,this.view!==null&&(i.object.view=Object.assign({},this.view)),i.object.filmGauge=this.filmGauge,i.object.filmOffset=this.filmOffset,i}}const Mg=-90,Rg=1;class k6 extends Ia{constructor(e,i,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const s=new ih(Mg,Rg,e,i);s.layers=this.layers,this.add(s);const o=new ih(Mg,Rg,e,i);o.layers=this.layers,this.add(o);const l=new ih(Mg,Rg,e,i);l.layers=this.layers,this.add(l);const u=new ih(Mg,Rg,e,i);u.layers=this.layers,this.add(u);const c=new ih(Mg,Rg,e,i);c.layers=this.layers,this.add(c);const h=new ih(Mg,Rg,e,i);h.layers=this.layers,this.add(h)}updateCoordinateSystem(){const e=this.coordinateSystem,i=this.children.concat(),[n,s,o,l,u,c]=i;for(const h of i)this.remove(h);if(e===vc)n.up.set(0,1,0),n.lookAt(1,0,0),s.up.set(0,1,0),s.lookAt(-1,0,0),o.up.set(0,0,-1),o.lookAt(0,1,0),l.up.set(0,0,1),l.lookAt(0,-1,0),u.up.set(0,1,0),u.lookAt(0,0,1),c.up.set(0,1,0),c.lookAt(0,0,-1);else if(e===jp)n.up.set(0,-1,0),n.lookAt(-1,0,0),s.up.set(0,-1,0),s.lookAt(1,0,0),o.up.set(0,0,1),o.lookAt(0,1,0),l.up.set(0,0,-1),l.lookAt(0,-1,0),u.up.set(0,-1,0),u.lookAt(0,0,1),c.up.set(0,-1,0),c.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const h of i)this.add(h),h.updateMatrixWorld()}update(e,i){this.parent===null&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:s}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[o,l,u,c,h,p]=this.children,f=e.getRenderTarget(),g=e.getActiveCubeFace(),m=e.getActiveMipmapLevel(),y=e.xr.enabled;e.xr.enabled=!1;const b=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,s),e.render(i,o),e.setRenderTarget(n,1,s),e.render(i,l),e.setRenderTarget(n,2,s),e.render(i,u),e.setRenderTarget(n,3,s),e.render(i,c),e.setRenderTarget(n,4,s),e.render(i,h),n.texture.generateMipmaps=b,e.setRenderTarget(n,5,s),e.render(i,p),e.setRenderTarget(f,g,m),e.xr.enabled=y,n.texture.needsPMREMUpdate=!0}}class X3 extends To{constructor(e,i,n,s,o,l,u,c,h,p){e=e!==void 0?e:[],i=i!==void 0?i:kp,super(e,i,n,s,o,l,u,c,h,p),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class Gde extends Ede{constructor(e=1,i={}){super(e,e,i),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},s=[n,n,n,n,n,n];this.texture=new X3(s,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:gl}fromEquirectangularTexture(e,i){this.texture.type=i.type,this.texture.colorSpace=i.colorSpace,this.texture.generateMipmaps=i.generateMipmaps,this.texture.minFilter=i.minFilter,this.texture.magFilter=i.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},s=new yy(5,5,5),o=new jde({name:"CubemapFromEquirect",uniforms:L6(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:yc,blending:ag});o.uniforms.tEquirect.value=i;const l=new Qp(s,o),u=i.minFilter;return i.minFilter===Wu&&(i.minFilter=gl),new k6(1,10,this).update(e,l),i.minFilter=u,l.geometry.dispose(),l.material.dispose(),this}clear(e,i,n,s){const o=e.getRenderTarget();for(let l=0;l<6;l++)e.setRenderTarget(this,l),e.clear(i,n,s);e.setRenderTarget(o)}}class F6 extends Ia{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new _c,this.environmentIntensity=1,this.environmentRotation=new _c,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,i){return super.copy(e,i),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const i=super.toJSON(e);return this.fog!==null&&(i.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(i.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(i.object.backgroundIntensity=this.backgroundIntensity),i.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(i.object.environmentIntensity=this.environmentIntensity),i.object.environmentRotation=this.environmentRotation.toArray(),i}}class U6{constructor(e,i){this.isInterleavedBuffer=!0,this.array=e,this.stride=i,this.count=e!==void 0?e.length/i:0,this.usage=z1,this.updateRanges=[],this.version=0,this.uuid=qu()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,i){this.updateRanges.push({start:e,count:i})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,i,n){e*=this.stride,n*=i.stride;for(let s=0,o=this.stride;s<o;s++)this.array[e+s]=i.array[n+s];return this}set(e,i=0){return this.array.set(e,i),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=qu()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const i=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(i,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=qu()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Mo=new Nt;class K3{constructor(e,i,n,s=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=i,this.offset=n,this.normalized=s}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let i=0,n=this.data.count;i<n;i++)Mo.fromBufferAttribute(this,i),Mo.applyMatrix4(e),this.setXYZ(i,Mo.x,Mo.y,Mo.z);return this}applyNormalMatrix(e){for(let i=0,n=this.count;i<n;i++)Mo.fromBufferAttribute(this,i),Mo.applyNormalMatrix(e),this.setXYZ(i,Mo.x,Mo.y,Mo.z);return this}transformDirection(e){for(let i=0,n=this.count;i<n;i++)Mo.fromBufferAttribute(this,i),Mo.transformDirection(e),this.setXYZ(i,Mo.x,Mo.y,Mo.z);return this}getComponent(e,i){let n=this.array[e*this.data.stride+this.offset+i];return this.normalized&&(n=So(n,this.array)),n}setComponent(e,i,n){return this.normalized&&(n=en(n,this.array)),this.data.array[e*this.data.stride+this.offset+i]=n,this}setX(e,i){return this.normalized&&(i=en(i,this.array)),this.data.array[e*this.data.stride+this.offset]=i,this}setY(e,i){return this.normalized&&(i=en(i,this.array)),this.data.array[e*this.data.stride+this.offset+1]=i,this}setZ(e,i){return this.normalized&&(i=en(i,this.array)),this.data.array[e*this.data.stride+this.offset+2]=i,this}setW(e,i){return this.normalized&&(i=en(i,this.array)),this.data.array[e*this.data.stride+this.offset+3]=i,this}getX(e){let i=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(i=So(i,this.array)),i}getY(e){let i=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(i=So(i,this.array)),i}getZ(e){let i=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(i=So(i,this.array)),i}getW(e){let i=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(i=So(i,this.array)),i}setXY(e,i,n){return e=e*this.data.stride+this.offset,this.normalized&&(i=en(i,this.array),n=en(n,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=n,this}setXYZ(e,i,n,s){return e=e*this.data.stride+this.offset,this.normalized&&(i=en(i,this.array),n=en(n,this.array),s=en(s,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=n,this.data.array[e+2]=s,this}setXYZW(e,i,n,s,o){return e=e*this.data.stride+this.offset,this.normalized&&(i=en(i,this.array),n=en(n,this.array),s=en(s,this.array),o=en(o,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=n,this.data.array[e+2]=s,this.data.array[e+3]=o,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let n=0;n<this.count;n++){const s=n*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)i.push(this.data.array[s+o])}return new Fl(new this.array.constructor(i),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new K3(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let n=0;n<this.count;n++){const s=n*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)i.push(this.data.array[s+o])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:i,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class z6 extends Ko{static get type(){return"SpriteMaterial"}constructor(e){super(),this.isSpriteMaterial=!0,this.color=new $n(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}class Vde extends To{constructor(e=null,i=1,n=1,s,o,l,u,c,h=no,p=no,f,g){super(null,l,u,c,h,p,s,o,f,g),this.isDataTexture=!0,this.image={data:e,width:i,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Hde extends Fl{constructor(e,i,n,s=1){super(e,i,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=s}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Y3=new Nt,Wde=new Nt,Qde=new Xo;class Ed{constructor(e=new Nt(1,0,0),i=0){this.isPlane=!0,this.normal=e,this.constant=i}set(e,i){return this.normal.copy(e),this.constant=i,this}setComponents(e,i,n,s){return this.normal.set(e,i,n),this.constant=s,this}setFromNormalAndCoplanarPoint(e,i){return this.normal.copy(e),this.constant=-i.dot(this.normal),this}setFromCoplanarPoints(e,i,n){const s=Y3.subVectors(n,i).cross(Wde.subVectors(e,i)).normalize();return this.setFromNormalAndCoplanarPoint(s,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,i){return i.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,i){const n=e.delta(Y3),s=this.normal.dot(n);if(s===0)return this.distanceToPoint(e.start)===0?i.copy(e.start):null;const o=-(e.start.dot(this.normal)+this.constant)/s;return o<0||o>1?null:i.copy(e.start).addScaledVector(n,o)}intersectsLine(e){const i=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return i<0&&n>0||n<0&&i>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,i){const n=i||Qde.getNormalMatrix(e),s=this.coplanarPoint(Y3).applyMatrix4(e),o=this.normal.applyMatrix3(n).normalize();return this.constant=-s.dot(o),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const qp=new L3,s_=new Nt;class j6{constructor(e=new Ed,i=new Ed,n=new Ed,s=new Ed,o=new Ed,l=new Ed){this.planes=[e,i,n,s,o,l]}set(e,i,n,s,o,l){const u=this.planes;return u[0].copy(e),u[1].copy(i),u[2].copy(n),u[3].copy(s),u[4].copy(o),u[5].copy(l),this}copy(e){const i=this.planes;for(let n=0;n<6;n++)i[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,i=vc){const n=this.planes,s=e.elements,o=s[0],l=s[1],u=s[2],c=s[3],h=s[4],p=s[5],f=s[6],g=s[7],m=s[8],y=s[9],b=s[10],v=s[11],_=s[12],C=s[13],E=s[14],T=s[15];if(n[0].setComponents(c-o,g-h,v-m,T-_).normalize(),n[1].setComponents(c+o,g+h,v+m,T+_).normalize(),n[2].setComponents(c+l,g+p,v+y,T+C).normalize(),n[3].setComponents(c-l,g-p,v-y,T-C).normalize(),n[4].setComponents(c-u,g-f,v-b,T-E).normalize(),i===vc)n[5].setComponents(c+u,g+f,v+b,T+E).normalize();else if(i===jp)n[5].setComponents(u,f,b,E).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+i);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),qp.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const i=e.geometry;i.boundingSphere===null&&i.computeBoundingSphere(),qp.copy(i.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(qp)}intersectsSprite(e){return qp.center.set(0,0,0),qp.radius=.7071067811865476,qp.applyMatrix4(e.matrixWorld),this.intersectsSphere(qp)}intersectsSphere(e){const i=this.planes,n=e.center,s=-e.radius;for(let o=0;o<6;o++)if(i[o].distanceToPoint(n)<s)return!1;return!0}intersectsBox(e){const i=this.planes;for(let n=0;n<6;n++){const s=i[n];if(s_.x=s.normal.x>0?e.max.x:e.min.x,s_.y=s.normal.y>0?e.max.y:e.min.y,s_.z=s.normal.z>0?e.max.z:e.min.z,s.distanceToPoint(s_)<0)return!1}return!0}containsPoint(e){const i=this.planes;for(let n=0;n<6;n++)if(i[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}class J3 extends Ko{static get type(){return"LineBasicMaterial"}constructor(e){super(),this.isLineBasicMaterial=!0,this.color=new $n(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}class G6 extends Ko{static get type(){return"PointsMaterial"}constructor(e){super(),this.isPointsMaterial=!0,this.color=new $n(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}class qde extends To{constructor(e,i){super({width:e,height:i}),this.isFramebufferTexture=!0,this.magFilter=no,this.minFilter=no,this.generateMipmaps=!1,this.needsUpdate=!0}}class Ig extends To{constructor(e,i,n,s,o,l,u,c,h,p=Fp){if(p!==Fp&&p!==pg)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&p===Fp&&(n=ja),n===void 0&&p===pg&&(n=ay),super(null,s,o,l,u,c,p,n,h),this.isDepthTexture=!0,this.image={width:e,height:i},this.magFilter=u!==void 0?u:no,this.minFilter=c!==void 0?c:no,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const i=super.toJSON(e);return this.compareFunction!==null&&(i.compareFunction=this.compareFunction),i}}class Z3 extends Hp{constructor(e=1,i=32,n=16,s=0,o=Math.PI*2,l=0,u=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:i,heightSegments:n,phiStart:s,phiLength:o,thetaStart:l,thetaLength:u},i=Math.max(3,Math.floor(i)),n=Math.max(2,Math.floor(n));const c=Math.min(l+u,Math.PI);let h=0;const p=[],f=new Nt,g=new Nt,m=[],y=[],b=[],v=[];for(let _=0;_<=n;_++){const C=[],E=_/n;let T=0;_===0&&l===0?T=.5/i:_===n&&c===Math.PI&&(T=-.5/i);for(let R=0;R<=i;R++){const B=R/i;f.x=-e*Math.cos(s+B*o)*Math.sin(l+E*u),f.y=e*Math.cos(l+E*u),f.z=e*Math.sin(s+B*o)*Math.sin(l+E*u),y.push(f.x,f.y,f.z),g.copy(f).normalize(),b.push(g.x,g.y,g.z),v.push(B+T,1-E),C.push(h++)}p.push(C)}for(let _=0;_<n;_++)for(let C=0;C<i;C++){const E=p[_][C+1],T=p[_][C],R=p[_+1][C],B=p[_+1][C+1];(_!==0||l>0)&&m.push(E,T,B),(_!==n-1||c<Math.PI)&&m.push(T,R,B)}this.setIndex(m),this.setAttribute("position",new th(y,3)),this.setAttribute("normal",new th(b,3)),this.setAttribute("uv",new th(v,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Z3(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class V6 extends Ko{static get type(){return"ShadowMaterial"}constructor(e){super(),this.isShadowMaterial=!0,this.color=new $n(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class $3 extends Ko{static get type(){return"MeshStandardMaterial"}constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.color=new $n(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new $n(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=md,this.normalScale=new Dn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new _c,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class H6 extends $3{static get type(){return"MeshPhysicalMaterial"}constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Dn(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Ga(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(i){this.ior=(1+.4*i)/(1-.4*i)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new $n(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new $n(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new $n(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class W6 extends Ko{static get type(){return"MeshPhongMaterial"}constructor(e){super(),this.isMeshPhongMaterial=!0,this.color=new $n(16777215),this.specular=new $n(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new $n(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=md,this.normalScale=new Dn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new _c,this.combine=D1,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Q6 extends Ko{static get type(){return"MeshToonMaterial"}constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.color=new $n(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new $n(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=md,this.normalScale=new Dn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class q6 extends Ko{static get type(){return"MeshNormalMaterial"}constructor(e){super(),this.isMeshNormalMaterial=!0,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=md,this.normalScale=new Dn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class X6 extends Ko{static get type(){return"MeshLambertMaterial"}constructor(e){super(),this.isMeshLambertMaterial=!0,this.color=new $n(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new $n(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=md,this.normalScale=new Dn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new _c,this.combine=D1,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class K6 extends Ko{static get type(){return"MeshMatcapMaterial"}constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.color=new $n(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=md,this.normalScale=new Dn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Y6 extends J3{static get type(){return"LineDashedMaterial"}constructor(e){super(),this.isLineDashedMaterial=!0,this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}class Xp extends Ia{constructor(e,i=1){super(),this.isLight=!0,this.type="Light",this.color=new $n(e),this.intensity=i}dispose(){}copy(e,i){return super.copy(e,i),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const i=super.toJSON(e);return i.object.color=this.color.getHex(),i.object.intensity=this.intensity,this.groundColor!==void 0&&(i.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(i.object.distance=this.distance),this.angle!==void 0&&(i.object.angle=this.angle),this.decay!==void 0&&(i.object.decay=this.decay),this.penumbra!==void 0&&(i.object.penumbra=this.penumbra),this.shadow!==void 0&&(i.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(i.object.target=this.target.uuid),i}}class Xde extends Xp{constructor(e,i,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Ia.DEFAULT_UP),this.updateMatrix(),this.groundColor=new $n(i)}copy(e,i){return super.copy(e,i),this.groundColor.copy(e.groundColor),this}}const eR=new ws,J6=new Nt,Z6=new Nt;class tR{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Dn(512,512),this.map=null,this.mapPass=null,this.matrix=new ws,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new j6,this._frameExtents=new Dn(1,1),this._viewportCount=1,this._viewports=[new Zn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const i=this.camera,n=this.matrix;J6.setFromMatrixPosition(e.matrixWorld),i.position.copy(J6),Z6.setFromMatrixPosition(e.target.matrixWorld),i.lookAt(Z6),i.updateMatrixWorld(),eR.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(eR),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(eR)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class Kde extends tR{constructor(){super(new ih(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const i=this.camera,n=uy*2*e.angle*this.focus,s=this.mapSize.width/this.mapSize.height,o=e.distance||i.far;(n!==i.fov||s!==i.aspect||o!==i.far)&&(i.fov=n,i.aspect=s,i.far=o,i.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class $6 extends Xp{constructor(e,i,n=0,s=Math.PI/3,o=0,l=2){super(e,i),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Ia.DEFAULT_UP),this.updateMatrix(),this.target=new Ia,this.distance=n,this.angle=s,this.penumbra=o,this.decay=l,this.map=null,this.shadow=new Kde}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,i){return super.copy(e,i),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const e8=new ws,vy=new Nt,iR=new Nt;class Yde extends tR{constructor(){super(new ih(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Dn(4,2),this._viewportCount=6,this._viewports=[new Zn(2,1,1,1),new Zn(0,1,1,1),new Zn(3,1,1,1),new Zn(1,1,1,1),new Zn(3,0,1,1),new Zn(1,0,1,1)],this._cubeDirections=[new Nt(1,0,0),new Nt(-1,0,0),new Nt(0,0,1),new Nt(0,0,-1),new Nt(0,1,0),new Nt(0,-1,0)],this._cubeUps=[new Nt(0,1,0),new Nt(0,1,0),new Nt(0,1,0),new Nt(0,1,0),new Nt(0,0,1),new Nt(0,0,-1)]}updateMatrices(e,i=0){const n=this.camera,s=this.matrix,o=e.distance||n.far;o!==n.far&&(n.far=o,n.updateProjectionMatrix()),vy.setFromMatrixPosition(e.matrixWorld),n.position.copy(vy),iR.copy(n.position),iR.add(this._cubeDirections[i]),n.up.copy(this._cubeUps[i]),n.lookAt(iR),n.updateMatrixWorld(),s.makeTranslation(-vy.x,-vy.y,-vy.z),e8.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(e8)}}class Jde extends Xp{constructor(e,i,n=0,s=2){super(e,i),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=s,this.shadow=new Yde}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,i){return super.copy(e,i),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class rR extends D6{constructor(e=-1,i=1,n=1,s=-1,o=.1,l=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=i,this.top=n,this.bottom=s,this.near=o,this.far=l,this.updateProjectionMatrix()}copy(e,i){return super.copy(e,i),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,i,n,s,o,l){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=i,this.view.offsetX=n,this.view.offsetY=s,this.view.width=o,this.view.height=l,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),i=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let o=n-e,l=n+e,u=s+i,c=s-i;if(this.view!==null&&this.view.enabled){const h=(this.right-this.left)/this.view.fullWidth/this.zoom,p=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o+=h*this.view.offsetX,l=o+h*this.view.width,u-=p*this.view.offsetY,c=u-p*this.view.height}this.projectionMatrix.makeOrthographic(o,l,u,c,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const i=super.toJSON(e);return i.object.zoom=this.zoom,i.object.left=this.left,i.object.right=this.right,i.object.top=this.top,i.object.bottom=this.bottom,i.object.near=this.near,i.object.far=this.far,this.view!==null&&(i.object.view=Object.assign({},this.view)),i}}class Zde extends tR{constructor(){super(new rR(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class $de extends Xp{constructor(e,i){super(e,i),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Ia.DEFAULT_UP),this.updateMatrix(),this.target=new Ia,this.shadow=new Zde}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class epe extends Xp{constructor(e,i){super(e,i),this.isAmbientLight=!0,this.type="AmbientLight"}}class tpe extends Xp{constructor(e,i,n=10,s=10){super(e,i),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=s}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const i=super.toJSON(e);return i.object.width=this.width,i.object.height=this.height,i}}class ipe{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new Nt)}set(e){for(let i=0;i<9;i++)this.coefficients[i].copy(e[i]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,i){const n=e.x,s=e.y,o=e.z,l=this.coefficients;return i.copy(l[0]).multiplyScalar(.282095),i.addScaledVector(l[1],.488603*s),i.addScaledVector(l[2],.488603*o),i.addScaledVector(l[3],.488603*n),i.addScaledVector(l[4],1.092548*(n*s)),i.addScaledVector(l[5],1.092548*(s*o)),i.addScaledVector(l[6],.315392*(3*o*o-1)),i.addScaledVector(l[7],1.092548*(n*o)),i.addScaledVector(l[8],.546274*(n*n-s*s)),i}getIrradianceAt(e,i){const n=e.x,s=e.y,o=e.z,l=this.coefficients;return i.copy(l[0]).multiplyScalar(.886227),i.addScaledVector(l[1],2*.511664*s),i.addScaledVector(l[2],2*.511664*o),i.addScaledVector(l[3],2*.511664*n),i.addScaledVector(l[4],2*.429043*n*s),i.addScaledVector(l[5],2*.429043*s*o),i.addScaledVector(l[6],.743125*o*o-.247708),i.addScaledVector(l[7],2*.429043*n*o),i.addScaledVector(l[8],.429043*(n*n-s*s)),i}add(e){for(let i=0;i<9;i++)this.coefficients[i].add(e.coefficients[i]);return this}addScaledSH(e,i){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],i);return this}scale(e){for(let i=0;i<9;i++)this.coefficients[i].multiplyScalar(e);return this}lerp(e,i){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],i);return this}equals(e){for(let i=0;i<9;i++)if(!this.coefficients[i].equals(e.coefficients[i]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,i=0){const n=this.coefficients;for(let s=0;s<9;s++)n[s].fromArray(e,i+s*3);return this}toArray(e=[],i=0){const n=this.coefficients;for(let s=0;s<9;s++)n[s].toArray(e,i+s*3);return e}static getBasisAt(e,i){const n=e.x,s=e.y,o=e.z;i[0]=.282095,i[1]=.488603*s,i[2]=.488603*o,i[3]=.488603*n,i[4]=1.092548*n*s,i[5]=1.092548*s*o,i[6]=.315392*(3*o*o-1),i[7]=1.092548*n*o,i[8]=.546274*(n*n-s*s)}}class rpe extends Xp{constructor(e=new ipe,i=1){super(void 0,i),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const i=super.toJSON(e);return i.object.sh=this.sh.toArray(),i}}class npe extends U6{constructor(e,i,n=1){super(e,i),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const i=super.clone(e);return i.meshPerAttribute=this.meshPerAttribute,i}toJSON(e){const i=super.toJSON(e);return i.isInstancedInterleavedBuffer=!0,i.meshPerAttribute=this.meshPerAttribute,i}}const spe=["alphaMap","alphaTest","anisotropy","anisotropyMap","anisotropyRotation","aoMap","attenuationColor","attenuationDistance","bumpMap","clearcoat","clearcoatMap","clearcoatNormalMap","clearcoatNormalScale","clearcoatRoughness","color","dispersion","displacementMap","emissive","emissiveMap","envMap","gradientMap","ior","iridescence","iridescenceIOR","iridescenceMap","iridescenceThicknessMap","lightMap","map","matcap","metalness","metalnessMap","normalMap","normalScale","opacity","roughness","roughnessMap","sheen","sheenColor","sheenColorMap","sheenRoughnessMap","shininess","specular","specularColor","specularColorMap","specularIntensity","specularIntensityMap","specularMap","thickness","transmission","transmissionMap"];class ape{constructor(e){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(e),this.hasAnimation=e.object.isSkinnedMesh===!0,this.refreshUniforms=spe,this.renderId=0}firstInitialization(e){return this.renderObjects.has(e)===!1?(this.getRenderObjectData(e),!0):!1}getRenderObjectData(e){let i=this.renderObjects.get(e);if(i===void 0){const{geometry:n,material:s}=e;if(i={material:this.getMaterialData(s),geometry:{attributes:this.getAttributesData(n.attributes),indexVersion:n.index?n.index.version:null,drawRange:{start:n.drawRange.start,count:n.drawRange.count}},worldMatrix:e.object.matrixWorld.clone()},e.object.center&&(i.center=e.object.center.clone()),e.object.morphTargetInfluences&&(i.morphTargetInfluences=e.object.morphTargetInfluences.slice()),e.bundle!==null&&(i.version=e.bundle.version),i.material.transmission>0){const{width:o,height:l}=e.context;i.bufferWidth=o,i.bufferHeight=l}this.renderObjects.set(e,i)}return i}getAttributesData(e){const i={};for(const n in e){const s=e[n];i[n]={version:s.version}}return i}containsNode(e){const i=e.material;for(const n in i)if(i[n]&&i[n].isNode)return!0;return e.renderer.nodes.modelViewMatrix!==null||e.renderer.nodes.modelNormalViewMatrix!==null}getMaterialData(e){const i={};for(const n of this.refreshUniforms){const s=e[n];s!=null&&(typeof s=="object"&&s.clone!==void 0?s.isTexture===!0?i[n]={id:s.id,version:s.version}:i[n]=s.clone():i[n]=s)}return i}equals(e){const{object:i,material:n,geometry:s}=e,o=this.getRenderObjectData(e);if(o.worldMatrix.equals(i.matrixWorld)!==!0)return o.worldMatrix.copy(i.matrixWorld),!1;const l=o.material;for(const b in l){const v=l[b],_=n[b];if(v.equals!==void 0){if(v.equals(_)===!1)return v.copy(_),!1}else if(_.isTexture===!0){if(v.id!==_.id||v.version!==_.version)return v.id=_.id,v.version=_.version,!1}else if(v!==_)return l[b]=_,!1}if(l.transmission>0){const{width:b,height:v}=e.context;if(o.bufferWidth!==b||o.bufferHeight!==v)return o.bufferWidth=b,o.bufferHeight=v,!1}const u=o.geometry,c=s.attributes,h=u.attributes,p=Object.keys(h),f=Object.keys(c);if(p.length!==f.length)return o.geometry.attributes=this.getAttributesData(c),!1;for(const b of p){const v=h[b],_=c[b];if(_===void 0)return delete h[b],!1;if(v.version!==_.version)return v.version=_.version,!1}const g=s.index,m=u.indexVersion,y=g?g.version:null;if(m!==y)return u.indexVersion=y,!1;if(u.drawRange.start!==s.drawRange.start||u.drawRange.count!==s.drawRange.count)return u.drawRange.start=s.drawRange.start,u.drawRange.count=s.drawRange.count,!1;if(o.morphTargetInfluences){let b=!1;for(let v=0;v<o.morphTargetInfluences.length;v++)o.morphTargetInfluences[v]!==i.morphTargetInfluences[v]&&(b=!0);if(b)return!0}return o.center&&o.center.equals(i.center)===!1?(o.center.copy(i.center),!0):(e.bundle!==null&&(o.version=e.bundle.version),!0)}needsRefresh(e,i){if(this.hasNode||this.hasAnimation||this.firstInitialization(e))return!0;const{renderId:n}=i;if(this.renderId!==n)return this.renderId=n,!0;const s=e.object.static===!0,o=e.bundle!==null&&e.bundle.static===!0&&this.getRenderObjectData(e).version===e.bundle.version;return s||o?!1:this.equals(e)!==!0}}function by(r,e=0){let i=3735928559^e,n=1103547991^e;if(r instanceof Array)for(let s=0,o;s<r.length;s++)o=r[s],i=Math.imul(i^o,2654435761),n=Math.imul(n^o,1597334677);else for(let s=0,o;s<r.length;s++)o=r.charCodeAt(s),i=Math.imul(i^o,2654435761),n=Math.imul(n^o,1597334677);return i=Math.imul(i^i>>>16,2246822507),i^=Math.imul(n^n>>>13,3266489909),n=Math.imul(n^n>>>16,2246822507),n^=Math.imul(i^i>>>13,3266489909),4294967296*(2097151&n)+(i>>>0)}const ope=r=>by(r),t8=r=>by(r),a_=(...r)=>by(r);function i8(r,e=!1){const i=[];r.isNode===!0&&(i.push(r.id),r=r.getSelf());for(const{property:n,childNode:s}of o_(r))i.push(i,by(n.slice(0,-4)),s.getCacheKey(e));return by(i)}function*o_(r,e=!1){for(const i in r){if(i.startsWith("_")===!0)continue;const n=r[i];if(Array.isArray(n)===!0)for(let s=0;s<n.length;s++){const o=n[s];o&&(o.isNode===!0||e&&typeof o.toJSON=="function")&&(yield{property:i,index:s,childNode:o})}else if(n&&n.isNode===!0)yield{property:i,childNode:n};else if(typeof n=="object")for(const s in n){const o=n[s];o&&(o.isNode===!0||e&&typeof o.toJSON=="function")&&(yield{property:i,index:s,childNode:o})}}}function l_(r){if(r==null)return null;const e=typeof r;return r.isNode===!0?"node":e==="number"?"float":e==="boolean"?"bool":e==="string"?"string":e==="function"?"shader":r.isVector2===!0?"vec2":r.isVector3===!0?"vec3":r.isVector4===!0?"vec4":r.isMatrix3===!0?"mat3":r.isMatrix4===!0?"mat4":r.isColor===!0?"color":r instanceof ArrayBuffer?"ArrayBuffer":null}function r8(r,...e){const i=r?r.slice(-4):void 0;return e.length===1&&(i==="vec2"?e=[e[0],e[0]]:i==="vec3"?e=[e[0],e[0],e[0]]:i==="vec4"&&(e=[e[0],e[0],e[0],e[0]])),r==="color"?new $n(...e):i==="vec2"?new Dn(...e):i==="vec3"?new Nt(...e):i==="vec4"?new Zn(...e):i==="mat3"?new Xo(...e):i==="mat4"?new ws(...e):r==="bool"?e[0]||!1:r==="float"||r==="int"||r==="uint"?e[0]||0:r==="string"?e[0]||"":r==="ArrayBuffer"?cpe(e[0]):null}function lpe(r){let e="";const i=new Uint8Array(r);for(let n=0;n<i.length;n++)e+=String.fromCharCode(i[n]);return btoa(e)}function cpe(r){return Uint8Array.from(atob(r),e=>e.charCodeAt(0)).buffer}const n8={VERTEX:"vertex"},hn={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},upe=["fragment","vertex"],s8=["setup","analyze","generate"],a8=[...upe,"compute"],Bg=["x","y","z","w"];let hpe=0,tn=class extends mg{static get type(){return"Node"}constructor(r=null){super(),this.nodeType=r,this.updateType=hn.NONE,this.updateBeforeType=hn.NONE,this.updateAfterType=hn.NONE,this.uuid=gde.generateUUID(),this.version=0,this._cacheKey=null,this._cacheKeyVersion=0,this.global=!1,this.isNode=!0,Object.defineProperty(this,"id",{value:hpe++})}set needsUpdate(r){r===!0&&this.version++}get type(){return this.constructor.type}onUpdate(r,e){return this.updateType=e,this.update=r.bind(this.getSelf()),this}onFrameUpdate(r){return this.onUpdate(r,hn.FRAME)}onRenderUpdate(r){return this.onUpdate(r,hn.RENDER)}onObjectUpdate(r){return this.onUpdate(r,hn.OBJECT)}onReference(r){return this.updateReference=r.bind(this.getSelf()),this}getSelf(){return this.self||this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:r}of o_(this))yield r}dispose(){this.dispatchEvent({type:"dispose"})}traverse(r){r(this);for(const e of this.getChildren())e.traverse(r)}getCacheKey(r=!1){return r=r||this.version!==this._cacheKeyVersion,(r===!0||this._cacheKey===null)&&(this._cacheKey=i8(this,r),this._cacheKeyVersion=this.version),this._cacheKey}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(r){const e=this.getNodeType(r);return r.getElementType(e)}getNodeType(r){const e=r.getNodeProperties(this);return e.outputNode?e.outputNode.getNodeType(r):this.nodeType}getShared(r){const e=this.getHash(r);return r.getNodeFromHash(e)||this}setup(r){const e=r.getNodeProperties(this);let i=0;for(const n of this.getChildren())e["node"+i++]=n;return null}analyze(r){if(r.increaseUsage(this)===1){const e=r.getNodeProperties(this);for(const i of Object.values(e))i&&i.isNode===!0&&i.build(r)}}generate(r,e){const{outputNode:i}=r.getNodeProperties(this);if(i&&i.isNode===!0)return i.build(r,e)}updateBefore(){console.warn("Abstract function.")}updateAfter(){console.warn("Abstract function.")}update(){console.warn("Abstract function.")}build(r,e=null){const i=this.getShared(r);if(this!==i)return i.build(r,e);r.addNode(this),r.addChain(this);let n=null;const s=r.getBuildStage();if(s==="setup"){this.updateReference(r);const o=r.getNodeProperties(this);if(o.initialized!==!0){r.stack.nodes.length,o.initialized=!0,o.outputNode=this.setup(r),o.outputNode!==null&&r.stack.nodes.length;for(const l of Object.values(o))l&&l.isNode===!0&&l.build(r)}}else if(s==="analyze")this.analyze(r);else if(s==="generate")if(this.generate.length===1){const o=this.getNodeType(r),l=r.getDataFromNode(this);n=l.snippet,n===void 0?(n=this.generate(r)||"",l.snippet=n):l.flowCodes!==void 0&&r.context.nodeBlock!==void 0&&r.addFlowCodeHierarchy(this,r.context.nodeBlock),n=r.format(n,o,e)}else n=this.generate(r,e)||"";return r.removeChain(this),r.addSequentialNode(this),n}getSerializeChildren(){return o_(this)}serialize(r){const e=this.getSerializeChildren(),i={};for(const{property:n,index:s,childNode:o}of e)s!==void 0?(i[n]===void 0&&(i[n]=Number.isInteger(s)?[]:{}),i[n][s]=o.toJSON(r.meta).uuid):i[n]=o.toJSON(r.meta).uuid;Object.keys(i).length>0&&(r.inputNodes=i)}deserialize(r){if(r.inputNodes!==void 0){const e=r.meta.nodes;for(const i in r.inputNodes)if(Array.isArray(r.inputNodes[i])){const n=[];for(const s of r.inputNodes[i])n.push(e[s]);this[i]=n}else if(typeof r.inputNodes[i]=="object"){const n={};for(const s in r.inputNodes[i]){const o=r.inputNodes[i][s];n[s]=e[o]}this[i]=n}else{const n=r.inputNodes[i];this[i]=e[n]}}}toJSON(r){const{uuid:e,type:i}=this,n=r===void 0||typeof r=="string";n&&(r={textures:{},images:{},nodes:{}});let s=r.nodes[e];s===void 0&&(s={uuid:e,type:i,meta:r,metadata:{version:4.6,type:"Node",generator:"Node.toJSON"}},n!==!0&&(r.nodes[s.uuid]=s),this.serialize(s),delete s.meta);function o(l){const u=[];for(const c in l){const h=l[c];delete h.metadata,u.push(h)}return u}if(n){const l=o(r.textures),u=o(r.images),c=o(r.nodes);l.length>0&&(s.textures=l),u.length>0&&(s.images=u),c.length>0&&(s.nodes=c)}return s}};class xy extends tn{static get type(){return"ArrayElementNode"}constructor(e,i){super(),this.node=e,this.indexNode=i,this.isArrayElementNode=!0}getNodeType(e){return this.node.getElementType(e)}generate(e){const i=this.node.build(e),n=this.indexNode.build(e,"uint");return`${i}[ ${n} ]`}}class o8 extends tn{static get type(){return"ConvertNode"}constructor(e,i){super(),this.node=e,this.convertTo=i}getNodeType(e){const i=this.node.getNodeType(e);let n=null;for(const s of this.convertTo.split("|"))(n===null||e.getTypeLength(i)===e.getTypeLength(s))&&(n=s);return n}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,i){const n=this.node,s=this.getNodeType(e),o=n.build(e,s);return e.format(o,s,i)}}class ra extends tn{static get type(){return"TempNode"}constructor(e){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,i){if(e.getBuildStage()==="generate"){const n=e.getVectorType(this.getNodeType(e,i)),s=e.getDataFromNode(this);if(s.propertyName!==void 0)return e.format(s.propertyName,n,i);if(n!=="void"&&i!=="void"&&this.hasDependencies(e)){const o=super.build(e,n),l=e.getVarFromNode(this,null,n),u=e.getPropertyName(l);return e.addLineFlowCode(`${u} = ${o}`,this),s.snippet=o,s.propertyName=u,e.format(s.propertyName,n,i)}}return super.build(e,i)}}class dpe extends ra{static get type(){return"JoinNode"}constructor(e=[],i=null){super(i),this.nodes=e}getNodeType(e){return this.nodeType!==null?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((i,n)=>i+e.getTypeLength(n.getNodeType(e)),0))}generate(e,i){const n=this.getNodeType(e),s=this.nodes,o=e.getComponentType(n),l=[];for(const c of s){let h=c.build(e);const p=e.getComponentType(c.getNodeType(e));p!==o&&(h=e.format(h,p,o)),l.push(h)}const u=`${e.getType(n)}( ${l.join(", ")} )`;return e.format(u,n,i)}}const ppe=Bg.join("");class l8 extends tn{static get type(){return"SplitNode"}constructor(e,i="x"){super(),this.node=e,this.components=i,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(const i of this.components)e=Math.max(Bg.indexOf(i)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}generate(e,i){const n=this.node,s=e.getTypeLength(n.getNodeType(e));let o=null;if(s>1){let l=null;this.getVectorLength()>=s&&(l=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));const u=n.build(e,l);this.components.length===s&&this.components===ppe.slice(0,this.components.length)?o=e.format(u,l,i):o=e.format(`${u}.${this.components}`,this.getNodeType(e),i)}else o=n.build(e,i);return o}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}class fpe extends ra{static get type(){return"SetNode"}constructor(e,i,n){super(),this.sourceNode=e,this.components=i,this.targetNode=n}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{sourceNode:i,components:n,targetNode:s}=this,o=this.getNodeType(e),l=e.getTypeFromLength(n.length,s.getNodeType(e)),u=s.build(e,l),c=i.build(e,o),h=e.getTypeLength(o),p=[];for(let f=0;f<h;f++){const g=Bg[f];g===n[0]?(p.push(u),f+=n.length-1):p.push(c+"."+g)}return`${e.getType(o)}( ${p.join(", ")} )`}}class mpe extends ra{static get type(){return"FlipNode"}constructor(e,i){super(),this.sourceNode=e,this.components=i}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{components:i,sourceNode:n}=this,s=this.getNodeType(e),o=n.build(e),l=e.getVarFromNode(this),u=e.getPropertyName(l);e.addLineFlowCode(u+" = "+o,this);const c=e.getTypeLength(s),h=[];let p=0;for(let f=0;f<c;f++){const g=Bg[f];g===i[p]?(h.push("1.0 - "+(u+"."+g)),p++):h.push(u+"."+g)}return`${e.getType(s)}( ${h.join(", ")} )`}}class nR extends tn{static get type(){return"InputNode"}constructor(e,i=null){super(i),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return this.nodeType===null?l_(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=l_(this.value),e.nodeType=this.nodeType,e.valueType==="ArrayBuffer"&&(e.value=lpe(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?r8(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){console.warn("Abstract function.")}}class rh extends nR{static get type(){return"ConstNode"}constructor(e,i=null){super(e,i),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,i){const n=this.getNodeType(e);return e.format(this.generateConst(e),n,i)}}let Ng=null;const Lg=new Map;function Zt(r,e){if(Lg.has(r)){console.warn(`Redefinition of method chaining ${r}`);return}if(typeof e!="function")throw new Error(`Node element ${r} is not a function`);Lg.set(r,e)}const c8=r=>r.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),u8=r=>c8(r).split("").sort().join(""),h8={setup(r,e){const i=e.shift();return r(d_(i),...e)},get(r,e,i){if(typeof e=="string"&&r[e]===void 0){if(r.isStackNode!==!0&&e==="assign")return(...n)=>(Ng.assign(i,...n),i);if(Lg.has(e)){const n=Lg.get(e);return r.isStackNode?(...s)=>i.add(n(...s)):(...s)=>n(i,...s)}else{if(e==="self")return r;if(e.endsWith("Assign")&&Lg.has(e.slice(0,e.length-6))){const n=Lg.get(e.slice(0,e.length-6));return r.isStackNode?(...s)=>i.assign(s[0],n(...s)):(...s)=>i.assign(n(i,...s))}else{if(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0)return e=c8(e),Ti(new l8(i,e));if(/^set[XYZWRGBASTPQ]{1,4}$/.test(e)===!0)return e=u8(e.slice(3).toLowerCase()),n=>Ti(new fpe(r,e,n));if(/^flip[XYZWRGBASTPQ]{1,4}$/.test(e)===!0)return e=u8(e.slice(4).toLowerCase()),()=>Ti(new mpe(Ti(r),e));if(e==="width"||e==="height"||e==="depth")return e==="width"?e="x":e==="height"?e="y":e==="depth"&&(e="z"),Ti(new l8(r,e));if(/^\d+$/.test(e)===!0)return Ti(new xy(i,new rh(Number(e),"uint")))}}}return Reflect.get(r,e,i)},set(r,e,i,n){return typeof e=="string"&&r[e]===void 0&&(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0||e==="width"||e==="height"||e==="depth"||/^\d+$/.test(e)===!0)?(n[e].assign(i),!0):Reflect.set(r,e,i,n)}},sR=new WeakMap,d8=new WeakMap,gpe=function(r,e=null){const i=l_(r);if(i==="node"){let n=sR.get(r);return n===void 0&&(n=new Proxy(r,h8),sR.set(r,n),sR.set(n,n)),n}else{if(e===null&&(i==="float"||i==="boolean")||i&&i!=="shader"&&i!=="string")return Ti(cR(r,e));if(i==="shader")return Hi(r)}return r},Ape=function(r,e=null){for(const i in r)r[i]=Ti(r[i],e);return r},ype=function(r,e=null){const i=r.length;for(let n=0;n<i;n++)r[n]=Ti(r[n],e);return r},vpe=function(r,e=null,i=null,n=null){const s=o=>Ti(n!==null?Object.assign(o,n):o);return e===null?(...o)=>s(new r(...Dg(o))):i!==null?(i=Ti(i),(...o)=>s(new r(e,...Dg(o),i))):(...o)=>s(new r(e,...Dg(o)))},bpe=function(r,...e){return Ti(new r(...Dg(e)))};class xpe extends tn{constructor(e,i){super(),this.shaderNode=e,this.inputNodes=i}getNodeType(e){return this.shaderNode.nodeType||this.getOutputNode(e).getNodeType(e)}call(e){const{shaderNode:i,inputNodes:n}=this,s=e.getNodeProperties(i);if(s.onceOutput)return s.onceOutput;let o=null;if(i.layout){let l=d8.get(e.constructor);l===void 0&&(l=new WeakMap,d8.set(e.constructor,l));let u=l.get(i);u===void 0&&(u=Ti(e.buildFunctionNode(i)),l.set(i,u)),e.currentFunctionNode!==null&&e.currentFunctionNode.includes.push(u),o=Ti(u.call(n))}else{const l=i.jsFunc,u=n!==null?l(n,e):l(e);o=Ti(u)}return i.once&&(s.onceOutput=o),o}getOutputNode(e){const i=e.getNodeProperties(this);return i.outputNode===null&&(i.outputNode=this.setupOutput(e)),i.outputNode}setup(e){return this.getOutputNode(e)}setupOutput(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}generate(e,i){return this.getOutputNode(e).build(e,i)}}class _pe extends tn{constructor(e,i){super(i),this.jsFunc=e,this.layout=null,this.global=!0,this.once=!1}setLayout(e){return this.layout=e,this}call(e=null){return d_(e),Ti(new xpe(this,e))}setup(){return this.call()}}const Epe=[!1,!0],wpe=[0,1,2,3],Cpe=[-1,-2],p8=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],aR=new Map;for(const r of Epe)aR.set(r,new rh(r));const oR=new Map;for(const r of wpe)oR.set(r,new rh(r,"uint"));const lR=new Map([...oR].map(r=>new rh(r.value,"int")));for(const r of Cpe)lR.set(r,new rh(r,"int"));const c_=new Map([...lR].map(r=>new rh(r.value)));for(const r of p8)c_.set(r,new rh(r));for(const r of p8)c_.set(-r,new rh(-r));const u_={bool:aR,uint:oR,ints:lR,float:c_},f8=new Map([...aR,...c_]),cR=(r,e)=>f8.has(r)?f8.get(r):r.isNode===!0?r:new rh(r,e),Spe=r=>{try{return r.getNodeType()}catch{return}},na=function(r,e=null){return(...i)=>{if((i.length===0||!["bool","float","int","uint"].includes(r)&&i.every(s=>typeof s!="object"))&&(i=[r8(r,...i)]),i.length===1&&e!==null&&e.has(i[0]))return Ti(e.get(i[0]));if(i.length===1){const s=cR(i[0],r);return Spe(s)===r?Ti(s):Ti(new o8(s,r))}const n=i.map(s=>cR(s));return Ti(new dpe(n,r))}},m8=r=>typeof r=="object"&&r!==null?r.value:r,Tpe=r=>r!=null?r.nodeType||r.convertTo||(typeof r=="string"?r:null):null;function h_(r,e){return new Proxy(new _pe(r,e),h8)}const Ti=(r,e=null)=>gpe(r,e),d_=(r,e=null)=>new Ape(r,e),Dg=(r,e=null)=>new ype(r,e),ui=(...r)=>new vpe(...r),Yi=(...r)=>new bpe(...r),Hi=(r,e)=>{const i=new h_(r,e),n=(...s)=>{let o;return d_(s),s[0]&&s[0].isNode?o=[...s]:o=s[0],i.call(o)};return n.shaderNode=i,n.setLayout=s=>(i.setLayout(s),n),n.once=()=>(i.once=!0,n),n};Zt("toGlobal",r=>(r.global=!0,r));const p_=r=>{Ng=r},g8=()=>Ng,Va=(...r)=>Ng.If(...r);function Mpe(r){return Ng&&Ng.add(r),r}Zt("append",Mpe);const Rpe=new na("color"),ri=new na("float",u_.float),Ps=new na("int",u_.ints),Ipe=new na("uint",u_.uint),Bpe=new na("bool",u_.bool),Ji=new na("vec2"),nh=new na("ivec2"),Npe=new na("uvec2"),Lpe=new na("bvec2"),ti=new na("vec3"),Dpe=new na("ivec3"),Ope=new na("uvec3"),Ppe=new na("bvec3"),Jr=new na("vec4"),kpe=new na("ivec4"),Fpe=new na("uvec4"),Upe=new na("bvec4"),uR=new na("mat2"),Ro=new na("mat3"),Og=new na("mat4");Zt("toColor",Rpe),Zt("toFloat",ri),Zt("toInt",Ps),Zt("toUint",Ipe),Zt("toBool",Bpe),Zt("toVec2",Ji),Zt("toIVec2",nh),Zt("toUVec2",Npe),Zt("toBVec2",Lpe),Zt("toVec3",ti),Zt("toIVec3",Dpe),Zt("toUVec3",Ope),Zt("toBVec3",Ppe),Zt("toVec4",Jr),Zt("toIVec4",kpe),Zt("toUVec4",Fpe),Zt("toBVec4",Upe),Zt("toMat2",uR),Zt("toMat3",Ro),Zt("toMat4",Og);const zpe=ui(xy),jpe=(r,e)=>Ti(new o8(Ti(r),e));Zt("element",zpe),Zt("convert",jpe);class A8 extends tn{static get type(){return"UniformGroupNode"}constructor(e,i=!1,n=1){super("string"),this.name=e,this.version=0,this.shared=i,this.order=n,this.isUniformGroup=!0}set needsUpdate(e){e===!0&&this.version++}serialize(e){super.serialize(e),e.name=this.name,e.version=this.version,e.shared=this.shared}deserialize(e){super.deserialize(e),this.name=e.name,this.version=e.version,this.shared=e.shared}}const Gpe=r=>new A8(r),y8=(r,e=0)=>new A8(r,!0,e),Vpe=y8("frame"),Mn=y8("render"),v8=Gpe("object");class _y extends nR{static get type(){return"UniformNode"}constructor(e,i=null){super(e,i),this.isUniformNode=!0,this.name="",this.groupNode=v8}label(e){return this.name=e,this}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}onUpdate(e,i){const n=this.getSelf();return e=e.bind(n),super.onUpdate(s=>{const o=e(s,n);o!==void 0&&(this.value=o)},i)}generate(e,i){const n=this.getNodeType(e),s=this.getUniformHash(e);let o=e.getNodeFromHash(s);o===void 0&&(e.setHashNode(this,s),o=this);const l=o.getInputType(e),u=e.getUniformFromNode(o,l,e.shaderStage,this.name||e.context.label),c=e.getPropertyName(u);return e.context.label!==void 0&&delete e.context.label,e.format(c,n,i)}}const Zr=(r,e)=>{const i=Tpe(e||r),n=r&&r.isNode===!0?r.node&&r.node.value||r.value:r;return Ti(new _y(n,i))};class es extends tn{static get type(){return"PropertyNode"}constructor(e,i=null,n=!1){super(e),this.name=i,this.varying=n,this.isPropertyNode=!0}getHash(e){return this.name||super.getHash(e)}isGlobal(){return!0}generate(e){let i;return this.varying===!0?(i=e.getVaryingFromNode(this,this.name),i.needsInterpolation=!0):i=e.getVarFromNode(this,this.name),e.getPropertyName(i)}}const Pg=(r,e)=>Ti(new es(r,e)),f_=(r,e)=>Ti(new es(r,e,!0)),qn=Yi(es,"vec4","DiffuseColor"),b8=Yi(es,"vec3","EmissiveColor"),sh=Yi(es,"float","Roughness"),m_=Yi(es,"float","Metalness"),hR=Yi(es,"float","Clearcoat"),g_=Yi(es,"float","ClearcoatRoughness"),kg=Yi(es,"vec3","Sheen"),dR=Yi(es,"float","SheenRoughness"),pR=Yi(es,"float","Iridescence"),x8=Yi(es,"float","IridescenceIOR"),_8=Yi(es,"float","IridescenceThickness"),fR=Yi(es,"float","AlphaT"),Kp=Yi(es,"float","Anisotropy"),A_=Yi(es,"vec3","AnisotropyT"),Fg=Yi(es,"vec3","AnisotropyB"),xl=Yi(es,"color","SpecularColor"),y_=Yi(es,"float","SpecularF90"),mR=Yi(es,"float","Shininess"),Hpe=Yi(es,"vec4","Output"),gR=Yi(es,"float","dashSize"),E8=Yi(es,"float","gapSize"),v_=Yi(es,"float","IOR"),AR=Yi(es,"float","Transmission"),w8=Yi(es,"float","Thickness"),C8=Yi(es,"float","AttenuationDistance"),S8=Yi(es,"color","AttenuationColor"),T8=Yi(es,"float","Dispersion");class Wpe extends ra{static get type(){return"AssignNode"}constructor(e,i){super(),this.targetNode=e,this.sourceNode=i}hasDependencies(){return!1}getNodeType(e,i){return i!=="void"?this.targetNode.getNodeType(e):"void"}needsSplitAssign(e){const{targetNode:i}=this;if(e.isAvailable("swizzleAssign")===!1&&i.isSplitNode&&i.components.length>1){const n=e.getTypeLength(i.node.getNodeType(e));return Bg.join("").slice(0,n)!==i.components}return!1}generate(e,i){const{targetNode:n,sourceNode:s}=this,o=this.needsSplitAssign(e),l=n.getNodeType(e),u=n.context({assign:!0}).build(e),c=s.build(e,l),h=s.getNodeType(e),p=e.getDataFromNode(this);let f;if(p.initialized===!0)i!=="void"&&(f=u);else if(o){const g=e.getVarFromNode(this,null,l),m=e.getPropertyName(g);e.addLineFlowCode(`${m} = ${c}`,this);const y=n.node.context({assign:!0}).build(e);for(let b=0;b<n.components.length;b++){const v=n.components[b];e.addLineFlowCode(`${y}.${v} = ${m}[ ${b} ]`,this)}i!=="void"&&(f=u)}else f=`${u} = ${c}`,(i==="void"||h==="void")&&(e.addLineFlowCode(f,this),i!=="void"&&(f=u));return p.initialized=!0,e.format(f,l,i)}}Zt("assign",ui(Wpe));class Qpe extends ra{static get type(){return"FunctionCallNode"}constructor(e=null,i={}){super(),this.functionNode=e,this.parameters=i}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}generate(e){const i=[],n=this.functionNode,s=n.getInputs(e),o=this.parameters,l=(u,c)=>{const h=c.type,p=h==="pointer";let f;return p?f="&"+u.build(e):f=u.build(e,h),f};if(Array.isArray(o))for(let u=0;u<o.length;u++)i.push(l(o[u],s[u]));else for(const u of s){const c=o[u.name];if(c!==void 0)i.push(l(c,u));else throw new Error(`FunctionCallNode: Input '${u.name}' not found in FunctionNode.`)}return`${n.build(e,"property")}( ${i.join(", ")} )`}}Zt("call",(r,...e)=>(e=e.length>1||e[0]&&e[0].isNode===!0?Dg(e):d_(e[0]),Ti(new Qpe(Ti(r),e))));class Cs extends ra{static get type(){return"OperatorNode"}constructor(e,i,n,...s){if(super(),s.length>0){let o=new Cs(e,i,n);for(let l=0;l<s.length-1;l++)o=new Cs(e,o,s[l]);i=o,n=s[s.length-1]}this.op=e,this.aNode=i,this.bNode=n}getNodeType(e,i){const n=this.op,s=this.aNode,o=this.bNode,l=s.getNodeType(e),u=typeof o<"u"?o.getNodeType(e):null;if(l==="void"||u==="void")return"void";if(n==="%")return l;if(n==="~"||n==="&"||n==="|"||n==="^"||n===">>"||n==="<<")return e.getIntegerType(l);if(n==="!"||n==="=="||n==="&&"||n==="||"||n==="^^")return"bool";if(n==="<"||n===">"||n==="<="||n===">="){const c=i?e.getTypeLength(i):Math.max(e.getTypeLength(l),e.getTypeLength(u));return c>1?`bvec${c}`:"bool"}else return l==="float"&&e.isMatrix(u)?u:e.isMatrix(l)&&e.isVector(u)?e.getVectorFromMatrix(l):e.isVector(l)&&e.isMatrix(u)?e.getVectorFromMatrix(u):e.getTypeLength(u)>e.getTypeLength(l)?u:l}generate(e,i){const n=this.op,s=this.aNode,o=this.bNode,l=this.getNodeType(e,i);let u=null,c=null;l!=="void"?(u=s.getNodeType(e),c=typeof o<"u"?o.getNodeType(e):null,n==="<"||n===">"||n==="<="||n===">="||n==="=="?e.isVector(u)?c=u:u!==c&&(u=c="float"):n===">>"||n==="<<"?(u=l,c=e.changeComponentType(c,"uint")):e.isMatrix(u)&&e.isVector(c)?c=e.getVectorFromMatrix(u):e.isVector(u)&&e.isMatrix(c)?u=e.getVectorFromMatrix(c):u=c=l):u=c=l;const h=s.build(e,u),p=typeof o<"u"?o.build(e,c):null,f=e.getTypeLength(i),g=e.getFunctionOperator(n);if(i!=="void")return n==="<"&&f>1?e.useComparisonMethod?e.format(`${e.getMethod("lessThan",i)}( ${h}, ${p} )`,l,i):e.format(`( ${h} < ${p} )`,l,i):n==="<="&&f>1?e.useComparisonMethod?e.format(`${e.getMethod("lessThanEqual",i)}( ${h}, ${p} )`,l,i):e.format(`( ${h} <= ${p} )`,l,i):n===">"&&f>1?e.useComparisonMethod?e.format(`${e.getMethod("greaterThan",i)}( ${h}, ${p} )`,l,i):e.format(`( ${h} > ${p} )`,l,i):n===">="&&f>1?e.useComparisonMethod?e.format(`${e.getMethod("greaterThanEqual",i)}( ${h}, ${p} )`,l,i):e.format(`( ${h} >= ${p} )`,l,i):n==="!"||n==="~"?e.format(`(${n}${h})`,u,i):g?e.format(`${g}( ${h}, ${p} )`,l,i):e.format(`( ${h} ${n} ${p} )`,l,i);if(u!=="void")return g?e.format(`${g}( ${h}, ${p} )`,l,i):e.format(`${h} ${n} ${p}`,l,i)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}const Io=ui(Cs,"+"),_l=ui(Cs,"-"),bn=ui(Cs,"*"),wd=ui(Cs,"/"),M8=ui(Cs,"%"),qpe=ui(Cs,"=="),Xpe=ui(Cs,"!="),Kpe=ui(Cs,"<"),Ype=ui(Cs,">"),Jpe=ui(Cs,"<="),Zpe=ui(Cs,">="),$pe=ui(Cs,"&&"),efe=ui(Cs,"||"),tfe=ui(Cs,"!"),ife=ui(Cs,"^^"),rfe=ui(Cs,"&"),nfe=ui(Cs,"~"),sfe=ui(Cs,"|"),afe=ui(Cs,"^"),ofe=ui(Cs,"<<"),lfe=ui(Cs,">>");Zt("add",Io),Zt("sub",_l),Zt("mul",bn),Zt("div",wd),Zt("modInt",M8),Zt("equal",qpe),Zt("notEqual",Xpe),Zt("lessThan",Kpe),Zt("greaterThan",Ype),Zt("lessThanEqual",Jpe),Zt("greaterThanEqual",Zpe),Zt("and",$pe),Zt("or",efe),Zt("not",tfe),Zt("xor",ife),Zt("bitAnd",rfe),Zt("bitNot",nfe),Zt("bitOr",sfe),Zt("bitXor",afe),Zt("shiftLeft",ofe),Zt("shiftRight",lfe),Zt("remainder",(...r)=>(console.warn("TSL.OperatorNode: .remainder() has been renamed to .modInt()."),M8(...r)));class _t extends ra{static get type(){return"MathNode"}constructor(e,i,n=null,s=null){super(),this.method=e,this.aNode=i,this.bNode=n,this.cNode=s}getInputType(e){const i=this.aNode.getNodeType(e),n=this.bNode?this.bNode.getNodeType(e):null,s=this.cNode?this.cNode.getNodeType(e):null,o=e.isMatrix(i)?0:e.getTypeLength(i),l=e.isMatrix(n)?0:e.getTypeLength(n),u=e.isMatrix(s)?0:e.getTypeLength(s);return o>l&&o>u?i:l>u?n:u>o?s:i}getNodeType(e){const i=this.method;return i===_t.LENGTH||i===_t.DISTANCE||i===_t.DOT?"float":i===_t.CROSS?"vec3":i===_t.ALL?"bool":i===_t.EQUALS?e.changeComponentType(this.aNode.getNodeType(e),"bool"):i===_t.MOD?this.aNode.getNodeType(e):this.getInputType(e)}generate(e,i){const n=this.method,s=this.getNodeType(e),o=this.getInputType(e),l=this.aNode,u=this.bNode,c=this.cNode,h=e.renderer.isWebGLRenderer===!0;if(n===_t.TRANSFORM_DIRECTION){let p=l,f=u;e.isMatrix(p.getNodeType(e))?f=Jr(ti(f),0):p=Jr(ti(p),0);const g=bn(p,f).xyz;return wy(g).build(e,i)}else{if(n===_t.NEGATE)return e.format("( - "+l.build(e,o)+" )",s,i);if(n===_t.ONE_MINUS)return _l(1,l).build(e,i);if(n===_t.RECIPROCAL)return wd(1,l).build(e,i);if(n===_t.DIFFERENCE)return Sc(_l(l,u)).build(e,i);{const p=[];return n===_t.CROSS||n===_t.MOD?p.push(l.build(e,s),u.build(e,s)):h&&n===_t.STEP?p.push(l.build(e,e.getTypeLength(l.getNodeType(e))===1?"float":o),u.build(e,o)):h&&(n===_t.MIN||n===_t.MAX)||n===_t.MOD?p.push(l.build(e,o),u.build(e,e.getTypeLength(u.getNodeType(e))===1?"float":o)):n===_t.REFRACT?p.push(l.build(e,o),u.build(e,o),c.build(e,"float")):n===_t.MIX?p.push(l.build(e,o),u.build(e,o),c.build(e,e.getTypeLength(c.getNodeType(e))===1?"float":o)):(p.push(l.build(e,o)),u!==null&&p.push(u.build(e,o)),c!==null&&p.push(c.build(e,o))),e.format(`${e.getMethod(n,s)}( ${p.join(", ")} )`,s,i)}}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}_t.ALL="all",_t.ANY="any",_t.EQUALS="equals",_t.RADIANS="radians",_t.DEGREES="degrees",_t.EXP="exp",_t.EXP2="exp2",_t.LOG="log",_t.LOG2="log2",_t.SQRT="sqrt",_t.INVERSE_SQRT="inversesqrt",_t.FLOOR="floor",_t.CEIL="ceil",_t.NORMALIZE="normalize",_t.FRACT="fract",_t.SIN="sin",_t.COS="cos",_t.TAN="tan",_t.ASIN="asin",_t.ACOS="acos",_t.ATAN="atan",_t.ABS="abs",_t.SIGN="sign",_t.LENGTH="length",_t.NEGATE="negate",_t.ONE_MINUS="oneMinus",_t.DFDX="dFdx",_t.DFDY="dFdy",_t.ROUND="round",_t.RECIPROCAL="reciprocal",_t.TRUNC="trunc",_t.FWIDTH="fwidth",_t.BITCAST="bitcast",_t.TRANSPOSE="transpose",_t.ATAN2="atan2",_t.MIN="min",_t.MAX="max",_t.MOD="mod",_t.STEP="step",_t.REFLECT="reflect",_t.DISTANCE="distance",_t.DIFFERENCE="difference",_t.DOT="dot",_t.CROSS="cross",_t.POW="pow",_t.TRANSFORM_DIRECTION="transformDirection",_t.MIX="mix",_t.CLAMP="clamp",_t.REFRACT="refract",_t.SMOOTHSTEP="smoothstep",_t.FACEFORWARD="faceforward";const cfe=ri(1e-6),ufe=ri(Math.PI),R8=ui(_t,_t.ALL),hfe=ui(_t,_t.ANY),dfe=ui(_t,_t.EQUALS),pfe=ui(_t,_t.RADIANS),ffe=ui(_t,_t.DEGREES),I8=ui(_t,_t.EXP),Ey=ui(_t,_t.EXP2),B8=ui(_t,_t.LOG),ah=ui(_t,_t.LOG2),yR=ui(_t,_t.SQRT),mfe=ui(_t,_t.INVERSE_SQRT),Yp=ui(_t,_t.FLOOR),vR=ui(_t,_t.CEIL),wy=ui(_t,_t.NORMALIZE),Cd=ui(_t,_t.FRACT),Cc=ui(_t,_t.SIN),Sd=ui(_t,_t.COS),gfe=ui(_t,_t.TAN),Afe=ui(_t,_t.ASIN),yfe=ui(_t,_t.ACOS),vfe=ui(_t,_t.ATAN),Sc=ui(_t,_t.ABS),N8=ui(_t,_t.SIGN),Td=ui(_t,_t.LENGTH),bfe=ui(_t,_t.NEGATE),xfe=ui(_t,_t.ONE_MINUS),L8=ui(_t,_t.DFDX),D8=ui(_t,_t.DFDY),_fe=ui(_t,_t.ROUND),Efe=ui(_t,_t.RECIPROCAL),wfe=ui(_t,_t.TRUNC),Cfe=ui(_t,_t.FWIDTH);_t.BITCAST;const Sfe=ui(_t,_t.TRANSPOSE),Tfe=ui(_t,_t.ATAN2),Cy=ui(_t,_t.MIN),zl=ui(_t,_t.MAX),O8=ui(_t,_t.MOD),P8=ui(_t,_t.STEP),Mfe=ui(_t,_t.REFLECT),Rfe=ui(_t,_t.DISTANCE),Ife=ui(_t,_t.DIFFERENCE),bR=ui(_t,_t.DOT),k8=ui(_t,_t.CROSS),b_=ui(_t,_t.POW),F8=ui(_t,_t.POW,2),Bfe=ui(_t,_t.POW,3),Nfe=ui(_t,_t.POW,4),Lfe=ui(_t,_t.TRANSFORM_DIRECTION),Dfe=r=>bn(N8(r),b_(Sc(r),1/3)),Ofe=r=>bR(r,r),As=ui(_t,_t.MIX),oh=(r,e=0,i=1)=>Ti(new _t(_t.CLAMP,Ti(r),Ti(e),Ti(i))),Pfe=r=>oh(r),U8=ui(_t,_t.REFRACT),Jp=ui(_t,_t.SMOOTHSTEP),kfe=ui(_t,_t.FACEFORWARD),Ffe=Hi(([r])=>{const e=43758.5453,i=bR(r.xy,Ji(12.9898,78.233)),n=O8(i,ufe);return Cd(Cc(n).mul(e))}),Ufe=(r,e,i)=>As(e,i,r),zfe=(r,e,i)=>Jp(e,i,r);Zt("all",R8),Zt("any",hfe),Zt("equals",dfe),Zt("radians",pfe),Zt("degrees",ffe),Zt("exp",I8),Zt("exp2",Ey),Zt("log",B8),Zt("log2",ah),Zt("sqrt",yR),Zt("inverseSqrt",mfe),Zt("floor",Yp),Zt("ceil",vR),Zt("normalize",wy),Zt("fract",Cd),Zt("sin",Cc),Zt("cos",Sd),Zt("tan",gfe),Zt("asin",Afe),Zt("acos",yfe),Zt("atan",vfe),Zt("abs",Sc),Zt("sign",N8),Zt("length",Td),Zt("lengthSq",Ofe),Zt("negate",bfe),Zt("oneMinus",xfe),Zt("dFdx",L8),Zt("dFdy",D8),Zt("round",_fe),Zt("reciprocal",Efe),Zt("trunc",wfe),Zt("fwidth",Cfe),Zt("atan2",Tfe),Zt("min",Cy),Zt("max",zl),Zt("mod",O8),Zt("step",P8),Zt("reflect",Mfe),Zt("distance",Rfe),Zt("dot",bR),Zt("cross",k8),Zt("pow",b_),Zt("pow2",F8),Zt("pow3",Bfe),Zt("pow4",Nfe),Zt("transformDirection",Lfe),Zt("mix",Ufe),Zt("clamp",oh),Zt("refract",U8),Zt("smoothstep",zfe),Zt("faceForward",kfe),Zt("difference",Ife),Zt("saturate",Pfe),Zt("cbrt",Dfe),Zt("transpose",Sfe),Zt("rand",Ffe);class jfe extends tn{static get type(){return"ConditionalNode"}constructor(e,i,n=null){super(),this.condNode=e,this.ifNode=i,this.elseNode=n}getNodeType(e){const i=this.ifNode.getNodeType(e);if(this.elseNode!==null){const n=this.elseNode.getNodeType(e);if(e.getTypeLength(n)>e.getTypeLength(i))return n}return i}setup(e){const i=this.condNode.cache(),n=this.ifNode.cache(),s=this.elseNode?this.elseNode.cache():null,o=e.context.nodeBlock;e.getDataFromNode(n).parentNodeBlock=o,s!==null&&(e.getDataFromNode(s).parentNodeBlock=o);const l=e.getNodeProperties(this);l.condNode=i,l.ifNode=n.context({nodeBlock:n}),l.elseNode=s?s.context({nodeBlock:s}):null}generate(e,i){const n=this.getNodeType(e),s=e.getDataFromNode(this);if(s.nodeProperty!==void 0)return s.nodeProperty;const{condNode:o,ifNode:l,elseNode:u}=e.getNodeProperties(this),c=i!=="void",h=c?Pg(n).build(e):"";s.nodeProperty=h;const p=o.build(e,"bool");e.addFlowCode(`
${e.tab}if ( ${p} ) {

`).addFlowTab();let f=l.build(e,n);if(f&&(c?f=h+" = "+f+";":f="return "+f+";"),e.removeFlowTab().addFlowCode(e.tab+"	"+f+`

`+e.tab+"}"),u!==null){e.addFlowCode(` else {

`).addFlowTab();let g=u.build(e,n);g&&(c?g=h+" = "+g+";":g="return "+g+";"),e.removeFlowTab().addFlowCode(e.tab+"	"+g+`

`+e.tab+`}

`)}else e.addFlowCode(`

`);return e.format(h,n,i)}}const Yo=ui(jfe);Zt("select",Yo),Zt("cond",(...r)=>(console.warn("TSL.ConditionalNode: cond() has been renamed to select()."),Yo(...r)));class z8 extends tn{static get type(){return"ContextNode"}constructor(e,i={}){super(),this.isContextNode=!0,this.node=e,this.value=i}getScope(){return this.node.getScope()}getNodeType(e){return this.node.getNodeType(e)}analyze(e){this.node.build(e)}setup(e){const i=e.getContext();e.setContext({...e.context,...this.value});const n=this.node.build(e);return e.setContext(i),n}generate(e,i){const n=e.getContext();e.setContext({...e.context,...this.value});const s=this.node.build(e,i);return e.setContext(n),s}}const xR=ui(z8),Gfe=(r,e)=>xR(r,{label:e});Zt("context",xR),Zt("label",Gfe);class Vfe extends tn{static get type(){return"VarNode"}constructor(e,i=null){super(),this.node=e,this.name=i,this.global=!0,this.isVarNode=!0}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}generate(e){const{node:i,name:n}=this,s=e.getVarFromNode(this,n,e.getVectorType(this.getNodeType(e))),o=e.getPropertyName(s),l=i.build(e,s.type);return e.addLineFlowCode(`${o} = ${l}`,this),o}}const j8=ui(Vfe);Zt("toVar",(...r)=>j8(...r).append()),Zt("temp",r=>(console.warn('TSL: "temp" is deprecated. Use ".toVar()" instead.'),j8(r)));class Hfe extends tn{static get type(){return"VaryingNode"}constructor(e,i=null){super(),this.node=e,this.name=i,this.isVaryingNode=!0}isGlobal(){return!0}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}setupVarying(e){const i=e.getNodeProperties(this);let n=i.varying;if(n===void 0){const s=this.name,o=this.getNodeType(e);i.varying=n=e.getVaryingFromNode(this,s,o),i.node=this.node}return n.needsInterpolation||(n.needsInterpolation=e.shaderStage==="fragment"),n}setup(e){this.setupVarying(e)}analyze(e){return this.setupVarying(e),this.node.analyze(e)}generate(e){const i=e.getNodeProperties(this),n=this.setupVarying(e);if(i.propertyName===void 0){const s=this.getNodeType(e),o=e.getPropertyName(n,n8.VERTEX);e.flowNodeFromShaderStage(n8.VERTEX,this.node,s,o),i.propertyName=o}return e.getPropertyName(n)}}const lh=ui(Hfe);Zt("varying",lh);const Wfe=Hi(([r])=>{const e=r.mul(.9478672986).add(.0521327014).pow(2.4),i=r.mul(.0773993808),n=r.lessThanEqual(.04045);return As(e,i,n)}).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),Qfe=Hi(([r])=>{const e=r.pow(.41666).mul(1.055).sub(.055),i=r.mul(12.92),n=r.lessThanEqual(.0031308);return As(e,i,n)}).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),Sy="WorkingColorSpace",_R="OutputColorSpace";class x_ extends ra{static get type(){return"ColorSpaceNode"}constructor(e,i,n){super("vec4"),this.colorNode=e,this.source=i,this.target=n}resolveColorSpace(e,i){return i===Sy?ta.workingColorSpace:i===_R?e.context.outputColorSpace||e.renderer.outputColorSpace:i}setup(e){const{colorNode:i}=this,n=this.resolveColorSpace(e,this.source),s=this.resolveColorSpace(e,this.target);let o=i;return ta.enabled===!1||n===s||!n||!s||(ta.getTransfer(n)===ly&&(o=Jr(Wfe(o.rgb),o.a)),ta.getPrimaries(n)!==ta.getPrimaries(s)&&(o=Jr(Ro(ta._getMatrix(new Xo,n,s)).mul(o.rgb),o.a)),ta.getTransfer(s)===ly&&(o=Jr(Qfe(o.rgb),o.a))),o}}const qfe=r=>Ti(new x_(Ti(r),Sy,_R)),Xfe=r=>Ti(new x_(Ti(r),_R,Sy)),Kfe=(r,e)=>Ti(new x_(Ti(r),Sy,e)),G8=(r,e)=>Ti(new x_(Ti(r),e,Sy));Zt("toOutputColorSpace",qfe),Zt("toWorkingColorSpace",Xfe),Zt("workingToColorSpace",Kfe),Zt("colorSpaceToWorking",G8);let Yfe=class extends xy{static get type(){return"ReferenceElementNode"}constructor(r,e){super(r,e),this.referenceNode=r,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(r){const e=super.generate(r),i=this.referenceNode.getNodeType(),n=this.getNodeType();return r.format(e,i,n)}};class V8 extends tn{static get type(){return"ReferenceBaseNode"}constructor(e,i,n=null,s=null){super(),this.property=e,this.uniformType=i,this.object=n,this.count=s,this.properties=e.split("."),this.reference=n,this.node=null,this.group=null,this.updateType=hn.OBJECT}setGroup(e){return this.group=e,this}element(e){return Ti(new Yfe(this,Ti(e)))}setNodeType(e){const i=Zr(null,e).getSelf();this.group!==null&&i.setGroup(this.group),this.node=i}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:i}=this;let n=e[i[0]];for(let s=1;s<i.length;s++)n=n[i[s]];return n}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const Jfe=(r,e,i)=>Ti(new V8(r,e,i));class Zfe extends V8{static get type(){return"RendererReferenceNode"}constructor(e,i,n=null){super(e,i,n),this.renderer=n,this.setGroup(Mn)}updateReference(e){return this.reference=this.renderer!==null?this.renderer:e.renderer,this.reference}}const $fe=(r,e,i)=>Ti(new Zfe(r,e,i));class eme extends ra{static get type(){return"ToneMappingNode"}constructor(e,i=ime,n=null){super("vec3"),this.toneMapping=e,this.exposureNode=i,this.colorNode=n}getCacheKey(){return a_(super.getCacheKey(),this.toneMapping)}setup(e){const i=this.colorNode||e.context.color,n=this.toneMapping;if(n===og)return i;let s=null;const o=e.renderer.library.getToneMappingFunction(n);return o!==null?s=Jr(o(i.rgb,this.exposureNode),i.a):(console.error("ToneMappingNode: Unsupported Tone Mapping configuration.",n),s=i),s}}const tme=(r,e,i)=>Ti(new eme(r,Ti(e),Ti(i))),ime=$fe("toneMappingExposure","float");Zt("toneMapping",(r,e,i)=>tme(e,i,r));class rme extends nR{static get type(){return"BufferAttributeNode"}constructor(e,i=null,n=0,s=0){super(e,i),this.isBufferNode=!0,this.bufferType=i,this.bufferStride=n,this.bufferOffset=s,this.usage=z1,this.instanced=!1,this.attribute=null,this.global=!0,e&&e.isBufferAttribute===!0&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getHash(e){if(this.bufferStride===0&&this.bufferOffset===0){let i=e.globalCache.getData(this.value);return i===void 0&&(i={node:this},e.globalCache.setData(this.value,i)),i.node.uuid}return this.uuid}getNodeType(e){return this.bufferType===null&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(this.attribute!==null)return;const i=this.getNodeType(e),n=this.value,s=e.getTypeLength(i),o=this.bufferStride||s,l=this.bufferOffset,u=n.isInterleavedBuffer===!0?n:new U6(n,o),c=new K3(u,s,l);u.setUsage(this.usage),this.attribute=c,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){const i=this.getNodeType(e),n=e.getBufferAttributeFromNode(this,i),s=e.getPropertyName(n);let o=null;return e.shaderStage==="vertex"||e.shaderStage==="compute"?(this.name=s,o=s):o=lh(this).build(e,i),o}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this.attribute&&this.attribute.isBufferAttribute===!0&&(this.attribute.usage=e),this}setInstanced(e){return this.instanced=e,this}}const ER=(r,e,i,n)=>Ti(new rme(r,e,i,n)),nme=(r,e,i,n)=>ER(r,e,i,n).setUsage(fg),H8=(r,e,i,n)=>ER(r,e,i,n).setInstanced(!0),W8=(r,e,i,n)=>nme(r,e,i,n).setInstanced(!0);Zt("toAttribute",r=>ER(r.value));class sme extends tn{static get type(){return"ComputeNode"}constructor(e,i,n=[64]){super("void"),this.isComputeNode=!0,this.computeNode=e,this.count=i,this.workgroupSize=n,this.dispatchCount=0,this.version=1,this.updateBeforeType=hn.OBJECT,this.onInitFunction=null,this.updateDispatchCount()}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}updateDispatchCount(){const{count:e,workgroupSize:i}=this;let n=i[0];for(let s=1;s<i.length;s++)n*=i[s];this.dispatchCount=Math.ceil(e/n)}onInit(e){return this.onInitFunction=e,this}updateBefore({renderer:e}){e.compute(this)}generate(e){const{shaderStage:i}=e;if(i==="compute"){const n=this.computeNode.build(e,"void");n!==""&&e.addLineFlowCode(n,this)}}}Zt("compute",(r,e,i)=>Ti(new sme(Ti(r),e,i)));class ame extends tn{static get type(){return"CacheNode"}constructor(e,i=!0){super(),this.node=e,this.parent=i,this.isCacheNode=!0}getNodeType(e){return this.node.getNodeType(e)}build(e,...i){const n=e.getCache(),s=e.getCacheFromNode(this,this.parent);e.setCache(s);const o=this.node.build(e,...i);return e.setCache(n),o}}const __=(r,...e)=>Ti(new ame(Ti(r),...e));Zt("cache",__);class ome extends tn{static get type(){return"BypassNode"}constructor(e,i){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=i}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){const i=this.callNode.build(e,"void");return i!==""&&e.addLineFlowCode(i,this),this.outputNode.build(e)}}Zt("bypass",ui(ome));class Q8 extends tn{static get type(){return"RemapNode"}constructor(e,i,n,s=ri(0),o=ri(1)){super(),this.node=e,this.inLowNode=i,this.inHighNode=n,this.outLowNode=s,this.outHighNode=o,this.doClamp=!0}setup(){const{node:e,inLowNode:i,inHighNode:n,outLowNode:s,outHighNode:o,doClamp:l}=this;let u=e.sub(i).div(n.sub(i));return l===!0&&(u=u.clamp()),u.mul(o.sub(s)).add(s)}}const lme=ui(Q8,null,null,{doClamp:!1}),cme=ui(Q8);Zt("remap",lme),Zt("remapClamp",cme);class ume extends tn{static get type(){return"ExpressionNode"}constructor(e="",i="void"){super(i),this.snippet=e}generate(e,i){const n=this.getNodeType(e),s=this.snippet;if(n==="void")e.addLineFlowCode(s,this);else return e.format(`( ${s} )`,n,i)}}const Ty=ui(ume);Zt("discard",r=>(r?Yo(r,Ty("discard")):Ty("discard")).append());class hme extends ra{static get type(){return"RenderOutputNode"}constructor(e,i,n){super("vec4"),this.colorNode=e,this.toneMapping=i,this.outputColorSpace=n,this.isRenderOutput=!0}setup({context:e}){let i=this.colorNode||e.color;const n=(this.toneMapping!==null?this.toneMapping:e.toneMapping)||og,s=(this.outputColorSpace!==null?this.outputColorSpace:e.outputColorSpace)||Up;return n!==og&&(i=i.toneMapping(n)),s!==Up&&s!==ta.workingColorSpace&&(i=i.workingToColorSpace(s)),i}}Zt("renderOutput",(r,e=null,i=null)=>Ti(new hme(Ti(r),e,i)));class dme extends tn{static get type(){return"AttributeNode"}constructor(e,i=null){super(i),this.global=!0,this._attributeName=e}getHash(e){return this.getAttributeName(e)}getNodeType(e){let i=this.nodeType;if(i===null){const n=this.getAttributeName(e);if(e.hasGeometryAttribute(n)){const s=e.geometry.getAttribute(n);i=e.getTypeFromAttribute(s)}else i="float"}return i}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){const i=this.getAttributeName(e),n=this.getNodeType(e);if(e.hasGeometryAttribute(i)===!0){const s=e.geometry.getAttribute(i),o=e.getTypeFromAttribute(s),l=e.getAttribute(i,o);return e.shaderStage==="vertex"?e.format(l.name,o,n):lh(this).build(e,n)}else return console.warn(`AttributeNode: Vertex attribute "${i}" not found on geometry.`),e.generateConst(n)}serialize(e){super.serialize(e),e.global=this.global,e._attributeName=this._attributeName}deserialize(e){super.deserialize(e),this.global=e.global,this._attributeName=e._attributeName}}const ch=(r,e)=>Ti(new dme(r,e)),E_=r=>ch("uv"+(r>0?r:""),"vec2");class pme extends tn{static get type(){return"TextureSizeNode"}constructor(e,i=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=i}generate(e,i){const n=this.textureNode.build(e,"property"),s=this.levelNode===null?"0":this.levelNode.build(e,"int");return e.format(`${e.getMethod("textureDimensions")}( ${n}, ${s} )`,this.getNodeType(e),i)}}const My=ui(pme);class fme extends _y{static get type(){return"MaxMipLevelNode"}constructor(e){super(0),this._textureNode=e,this.updateType=hn.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){const e=this.texture,i=e.images,n=i&&i.length>0?i[0]&&i[0].image||i[0]:e.image;if(n&&n.width!==void 0){const{width:s,height:o}=n;this.value=Math.log2(Math.max(s,o))}}}const mme=ui(fme);class Ry extends _y{static get type(){return"TextureNode"}constructor(e,i=null,n=null,s=null){super(e),this.isTextureNode=!0,this.uvNode=i,this.levelNode=n,this.biasNode=s,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=hn.NONE,this.referenceNode=null,this._value=e,this._matrixUniform=null,this.setUpdateMatrix(i===null)}set value(e){this.referenceNode?this.referenceNode.value=e:this._value=e}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":this.value.type===ja?"uvec4":this.value.type===Co?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return E_(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){return this._matrixUniform===null&&(this._matrixUniform=Zr(this.value.matrix)),this._matrixUniform.mul(ti(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this.updateType=e?hn.FRAME:hn.NONE,this}setupUV(e,i){const n=this.value;return e.isFlipY()&&(n.isRenderTargetTexture===!0||n.isFramebufferTexture===!0||n.isDepthTexture===!0)&&(this.sampler?i=i.flipY():i=i.setY(Ps(My(this,this.levelNode).y).sub(i.y).sub(1))),i}setup(e){const i=e.getNodeProperties(this);i.referenceNode=this.referenceNode;let n=this.uvNode;(n===null||e.context.forceUVContext===!0)&&e.context.getUV&&(n=e.context.getUV(this)),n||(n=this.getDefaultUV()),this.updateMatrix===!0&&(n=this.getTransformedUV(n)),n=this.setupUV(e,n);let s=this.levelNode;s===null&&e.context.getTextureLevel&&(s=e.context.getTextureLevel(this)),i.uvNode=n,i.levelNode=s,i.biasNode=this.biasNode,i.compareNode=this.compareNode,i.gradNode=this.gradNode,i.depthNode=this.depthNode}generateUV(e,i){return i.build(e,this.sampler===!0?"vec2":"ivec2")}generateSnippet(e,i,n,s,o,l,u,c){const h=this.value;let p;return s?p=e.generateTextureLevel(h,i,n,s,l):o?p=e.generateTextureBias(h,i,n,o,l):c?p=e.generateTextureGrad(h,i,n,c,l):u?p=e.generateTextureCompare(h,i,n,u,l):this.sampler===!1?p=e.generateTextureLoad(h,i,n,l):p=e.generateTexture(h,i,n,l),p}generate(e,i){const n=e.getNodeProperties(this),s=this.value;if(!s||s.isTexture!==!0)throw new Error("TextureNode: Need a three.js texture.");const o=super.generate(e,"property");if(i==="sampler")return o+"_sampler";if(e.isReference(i))return o;{const l=e.getDataFromNode(this);let u=l.propertyName;if(u===void 0){const{uvNode:p,levelNode:f,biasNode:g,compareNode:m,depthNode:y,gradNode:b}=n,v=this.generateUV(e,p),_=f?f.build(e,"float"):null,C=g?g.build(e,"float"):null,E=y?y.build(e,"int"):null,T=m?m.build(e,"float"):null,R=b?[b[0].build(e,"vec2"),b[1].build(e,"vec2")]:null,B=e.getVarFromNode(this);u=e.getPropertyName(B);const I=this.generateSnippet(e,o,v,_,C,E,T,R);e.addLineFlowCode(`${u} = ${I}`,this),l.snippet=I,l.propertyName=u}let c=u;const h=this.getNodeType(e);return e.needsToWorkingColorSpace(s)&&(c=G8(Ty(c,h),s.colorSpace).setup(e).build(e,h)),e.format(c,h,i)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}uv(e){const i=this.clone();return i.uvNode=Ti(e),i.referenceNode=this.getSelf(),Ti(i)}blur(e){const i=this.clone();return i.biasNode=Ti(e).mul(mme(i)),i.referenceNode=this.getSelf(),Ti(i)}level(e){const i=this.clone();return i.levelNode=Ti(e),i.referenceNode=this.getSelf(),Ti(i)}size(e){return My(this,e)}bias(e){const i=this.clone();return i.biasNode=Ti(e),i.referenceNode=this.getSelf(),Ti(i)}compare(e){const i=this.clone();return i.compareNode=Ti(e),i.referenceNode=this.getSelf(),Ti(i)}grad(e,i){const n=this.clone();return n.gradNode=[Ti(e),Ti(i)],n.referenceNode=this.getSelf(),Ti(n)}depth(e){const i=this.clone();return i.depthNode=Ti(e),i.referenceNode=this.getSelf(),Ti(i)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid,e.sampler=this.sampler,e.updateMatrix=this.updateMatrix,e.updateType=this.updateType}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value],this.sampler=e.sampler,this.updateMatrix=e.updateMatrix,this.updateType=e.updateType}update(){const e=this.value,i=this._matrixUniform;i!==null&&(i.value=e.matrix),e.matrixAutoUpdate===!0&&e.updateMatrix()}clone(){const e=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return e.sampler=this.sampler,e}}const ks=ui(Ry),Tc=(...r)=>ks(...r).setSampler(!1),Zp=Zr("float").label("cameraNear").setGroup(Mn).onRenderUpdate(({camera:r})=>r.near),$p=Zr("float").label("cameraFar").setGroup(Mn).onRenderUpdate(({camera:r})=>r.far),w_=Zr("mat4").label("cameraProjectionMatrix").setGroup(Mn).onRenderUpdate(({camera:r})=>r.projectionMatrix),uh=Zr("mat4").label("cameraViewMatrix").setGroup(Mn).onRenderUpdate(({camera:r})=>r.matrixWorldInverse),gme=Zr(new Nt).label("cameraPosition").setGroup(Mn).onRenderUpdate(({camera:r},e)=>e.value.setFromMatrixPosition(r.matrixWorld));class Fs extends tn{static get type(){return"Object3DNode"}constructor(e,i=null){super(),this.scope=e,this.object3d=i,this.updateType=hn.OBJECT,this._uniformNode=new _y(null)}getNodeType(){const e=this.scope;if(e===Fs.WORLD_MATRIX)return"mat4";if(e===Fs.POSITION||e===Fs.VIEW_POSITION||e===Fs.DIRECTION||e===Fs.SCALE)return"vec3"}update(e){const i=this.object3d,n=this._uniformNode,s=this.scope;if(s===Fs.WORLD_MATRIX)n.value=i.matrixWorld;else if(s===Fs.POSITION)n.value=n.value||new Nt,n.value.setFromMatrixPosition(i.matrixWorld);else if(s===Fs.SCALE)n.value=n.value||new Nt,n.value.setFromMatrixScale(i.matrixWorld);else if(s===Fs.DIRECTION)n.value=n.value||new Nt,i.getWorldDirection(n.value);else if(s===Fs.VIEW_POSITION){const o=e.camera;n.value=n.value||new Nt,n.value.setFromMatrixPosition(i.matrixWorld),n.value.applyMatrix4(o.matrixWorldInverse)}}generate(e){const i=this.scope;return i===Fs.WORLD_MATRIX?this._uniformNode.nodeType="mat4":(i===Fs.POSITION||i===Fs.VIEW_POSITION||i===Fs.DIRECTION||i===Fs.SCALE)&&(this._uniformNode.nodeType="vec3"),this._uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}Fs.WORLD_MATRIX="worldMatrix",Fs.POSITION="position",Fs.SCALE="scale",Fs.VIEW_POSITION="viewPosition",Fs.DIRECTION="direction";class Ug extends Fs{static get type(){return"ModelNode"}constructor(e){super(e)}update(e){this.object3d=e.object,super.update(e)}}Ug.DIRECTION;const ef=Yi(Ug,Ug.WORLD_MATRIX);Ug.POSITION,Ug.SCALE,Ug.VIEW_POSITION;const Ame=Zr(new Xo).onObjectUpdate(({object:r},e)=>e.value.getNormalMatrix(r.matrixWorld)),C_=uh.mul(ef).toVar("modelViewMatrix"),q8=ch("position","vec3"),Ha=q8.varying("positionLocal"),X8=q8.varying("positionPrevious"),wR=ef.mul(Ha).xyz.varying("v_positionWorld"),K8=Ha.transformDirection(ef).varying("v_positionWorldDirection").normalize().toVar("positionWorldDirection"),Wa=C_.mul(Ha).xyz.varying("v_positionView"),Is=Wa.negate().varying("v_positionViewDirection").normalize().toVar("positionViewDirection");class yme extends tn{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){const{renderer:i,material:n}=e;return i.coordinateSystem===vc&&n.side===yc?"false":e.getFrontFacing()}}const vme=Yi(yme),S_=ri(vme).mul(2).sub(1),Y8=ch("normal","vec3"),Yc=Hi(r=>r.geometry.hasAttribute("normal")===!1?(console.warn('TSL.NormalNode: Vertex attribute "normal" not found on geometry.'),ti(0,1,0)):Y8,"vec3").once()().toVar("normalLocal"),bme=Wa.dFdx().cross(Wa.dFdy()).normalize().toVar("normalFlat"),Mc=Hi(r=>{let e;return r.material.flatShading===!0?e=bme:e=lh(Z8(Yc),"v_normalView").normalize(),e},"vec3").once()().toVar("normalView"),J8=lh(Mc.transformDirection(uh),"v_normalWorld").normalize().toVar("normalWorld"),sa=Hi(r=>r.context.setupNormal(),"vec3").once()().mul(S_).toVar("transformedNormalView"),CR=sa.transformDirection(uh).toVar("transformedNormalWorld"),Iy=Hi(r=>r.context.setupClearcoatNormal(),"vec3").once()().mul(S_).toVar("transformedClearcoatNormalView"),xme=Hi(([r,e=ef])=>{const i=Ro(e),n=r.div(ti(i[0].dot(i[0]),i[1].dot(i[1]),i[2].dot(i[2])));return i.mul(n).xyz}),Z8=Hi(([r],e)=>{const i=e.renderer.nodes.modelNormalViewMatrix;if(i!==null)return i.transformDirection(r);const n=Ame.mul(r);return uh.transformDirection(n)}),_me=Zr(0).onReference(({material:r})=>r).onRenderUpdate(({material:r})=>r.refractionRatio),Eme=Is.negate().reflect(sa),wme=Is.negate().refract(sa,_me),Cme=Eme.transformDirection(uh).toVar("reflectVector"),Sme=wme.transformDirection(uh).toVar("reflectVector");class Tme extends Ry{static get type(){return"CubeTextureNode"}constructor(e,i=null,n=null,s=null){super(e,i,n,s),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){const e=this.value;return e.mapping===kp?Cme:e.mapping===lg?Sme:(console.error('THREE.CubeTextureNode: Mapping "%s" not supported.',e.mapping),ti(0,0,0))}setUpdateMatrix(){}setupUV(e,i){const n=this.value;return e.renderer.coordinateSystem===jp||!n.isRenderTargetTexture?ti(i.x.negate(),i.yz):i}generateUV(e,i){return i.build(e,"vec3")}}const By=ui(Tme);class $8 extends _y{static get type(){return"BufferNode"}constructor(e,i,n=0){super(e,i),this.isBufferNode=!0,this.bufferType=i,this.bufferCount=n}getElementType(e){return this.getNodeType(e)}getInputType(){return"buffer"}}const SR=(r,e,i)=>Ti(new $8(r,e,i));class Mme extends xy{static get type(){return"UniformArrayElementNode"}constructor(e,i){super(e,i),this.isArrayBufferElementNode=!0}generate(e){const i=super.generate(e),n=this.getNodeType();return e.format(i,"vec4",n)}}class Rme extends $8{static get type(){return"UniformArrayNode"}constructor(e,i=null){super(null,"vec4"),this.array=e,this.elementType=i,this._elementType=null,this._elementLength=0,this.updateType=hn.RENDER,this.isArrayBufferNode=!0}getElementType(){return this.elementType||this._elementType}getElementLength(){return this._elementLength}update(){const{array:e,value:i}=this,n=this.getElementLength(),s=this.getElementType();if(n===1)for(let o=0;o<e.length;o++){const l=o*4;i[l]=e[o]}else if(s==="color")for(let o=0;o<e.length;o++){const l=o*4,u=e[o];i[l]=u.r,i[l+1]=u.g,i[l+2]=u.b||0}else for(let o=0;o<e.length;o++){const l=o*4,u=e[o];i[l]=u.x,i[l+1]=u.y,i[l+2]=u.z||0,i[l+3]=u.w||0}}setup(e){const i=this.array.length;this._elementType=this.elementType===null?l_(this.array[0]):this.elementType,this._elementLength=e.getTypeLength(this._elementType);let n=Float32Array;return this._elementType.charAt(0)==="i"?n=Int32Array:this._elementType.charAt(0)==="u"&&(n=Uint32Array),this.value=new n(i*4),this.bufferCount=i,this.bufferType=e.changeComponentType("vec4",e.getComponentType(this._elementType)),super.setup(e)}element(e){return Ti(new Mme(this,Ti(e)))}}const Ny=(r,e)=>Ti(new Rme(r,e));class Ime extends xy{static get type(){return"ReferenceElementNode"}constructor(e,i){super(e,i),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const i=super.generate(e),n=this.referenceNode.getNodeType(),s=this.getNodeType();return e.format(i,n,s)}}class TR extends tn{static get type(){return"ReferenceNode"}constructor(e,i,n=null,s=null){super(),this.property=e,this.uniformType=i,this.object=n,this.count=s,this.properties=e.split("."),this.reference=n,this.node=null,this.group=null,this.name=null,this.updateType=hn.OBJECT}element(e){return Ti(new Ime(this,Ti(e)))}setGroup(e){return this.group=e,this}label(e){return this.name=e,this}setNodeType(e){let i=null;this.count!==null?i=SR(null,e,this.count):Array.isArray(this.getValueFromReference())?i=Ny(null,e):e==="texture"?i=ks(null):e==="cubeTexture"?i=By(null):i=Zr(null,e),this.group!==null&&i.setGroup(this.group),this.name!==null&&i.label(this.name),this.node=i.getSelf()}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:i}=this;let n=e[i[0]];for(let s=1;s<i.length;s++)n=n[i[s]];return n}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const Bs=(r,e,i)=>Ti(new TR(r,e,i)),ez=(r,e,i,n)=>Ti(new TR(r,e,n,i));class Bme extends TR{static get type(){return"MaterialReferenceNode"}constructor(e,i,n=null){super(e,i,n),this.material=n,this.isMaterialReferenceNode=!0}updateReference(e){return this.reference=this.material!==null?this.material:e.material,this.reference}}const Md=(r,e,i)=>Ti(new Bme(r,e,i)),tz=Hi(r=>(r.geometry.hasAttribute("tangent")===!1&&r.geometry.computeTangents(),ch("tangent","vec4")))(),MR=tz.xyz.toVar("tangentLocal"),iz=C_.mul(Jr(MR,0)).xyz.varying("v_tangentView").normalize().toVar("tangentView"),Nme=r=>r.mul(tz.w).xyz,Lme=lh(Nme(Mc.cross(iz)),"v_bitangentView").normalize().toVar("bitangentView"),Ly=Ro(iz,Lme,Mc),Dme=(()=>{let r=Fg.cross(Is);return r=r.cross(Fg).normalize(),r=As(r,sa,Kp.mul(sh.oneMinus()).oneMinus().pow2().pow2()).normalize(),r})(),Ome=Hi(r=>{const{eye_pos:e,surf_norm:i,mapN:n,uv:s}=r,o=e.dFdx(),l=e.dFdy(),u=s.dFdx(),c=s.dFdy(),h=i,p=l.cross(h),f=h.cross(o),g=p.mul(u.x).add(f.mul(c.x)),m=p.mul(u.y).add(f.mul(c.y)),y=g.dot(g).max(m.dot(m)),b=S_.mul(y.inverseSqrt());return Io(g.mul(n.x,b),m.mul(n.y,b),h.mul(n.z)).normalize()});class Pme extends ra{static get type(){return"NormalMapNode"}constructor(e,i=null){super("vec3"),this.node=e,this.scaleNode=i,this.normalMapType=md}setup(e){const{normalMapType:i,scaleNode:n}=this;let s=this.node.mul(2).sub(1);n!==null&&(s=ti(s.xy.mul(n),s.z));let o=null;return i===Uhe?o=Z8(s):i===md&&(e.hasGeometryAttribute("tangent")===!0?o=Ly.mul(s).normalize():o=Ome({eye_pos:Wa,surf_norm:Mc,mapN:s,uv:E_()})),o}}const rz=ui(Pme),kme=Hi(({textureNode:r,bumpScale:e})=>{const i=s=>r.cache().context({getUV:o=>s(o.uvNode||E_()),forceUVContext:!0}),n=ri(i(s=>s));return Ji(ri(i(s=>s.add(s.dFdx()))).sub(n),ri(i(s=>s.add(s.dFdy()))).sub(n)).mul(e)}),Fme=Hi(r=>{const{surf_pos:e,surf_norm:i,dHdxy:n}=r,s=e.dFdx().normalize(),o=e.dFdy().normalize(),l=i,u=o.cross(l),c=l.cross(s),h=s.dot(u).mul(S_),p=h.sign().mul(n.x.mul(u).add(n.y.mul(c)));return h.abs().mul(i).sub(p).normalize()});class Ume extends ra{static get type(){return"BumpMapNode"}constructor(e,i=null){super("vec3"),this.textureNode=e,this.scaleNode=i}setup(){const e=this.scaleNode!==null?this.scaleNode:1,i=kme({textureNode:this.textureNode,bumpScale:e});return Fme({surf_pos:Wa,surf_norm:Mc,dHdxy:i})}}const zme=ui(Ume),nz=new Map;class Kt extends tn{static get type(){return"MaterialNode"}constructor(e){super(),this.scope=e}getCache(e,i){let n=nz.get(e);return n===void 0&&(n=Md(e,i),nz.set(e,n)),n}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache(e==="map"?"map":e+"Map","texture")}setup(e){const i=e.context.material,n=this.scope;let s=null;if(n===Kt.COLOR){const o=i.color!==void 0?this.getColor(n):ti();i.map&&i.map.isTexture===!0?s=o.mul(this.getTexture("map")):s=o}else if(n===Kt.OPACITY){const o=this.getFloat(n);i.alphaMap&&i.alphaMap.isTexture===!0?s=o.mul(this.getTexture("alpha")):s=o}else if(n===Kt.SPECULAR_STRENGTH)i.specularMap&&i.specularMap.isTexture===!0?s=this.getTexture("specular").r:s=ri(1);else if(n===Kt.SPECULAR_INTENSITY){const o=this.getFloat(n);i.specularMap?s=o.mul(this.getTexture(n).a):s=o}else if(n===Kt.SPECULAR_COLOR){const o=this.getColor(n);i.specularColorMap&&i.specularColorMap.isTexture===!0?s=o.mul(this.getTexture(n).rgb):s=o}else if(n===Kt.ROUGHNESS){const o=this.getFloat(n);i.roughnessMap&&i.roughnessMap.isTexture===!0?s=o.mul(this.getTexture(n).g):s=o}else if(n===Kt.METALNESS){const o=this.getFloat(n);i.metalnessMap&&i.metalnessMap.isTexture===!0?s=o.mul(this.getTexture(n).b):s=o}else if(n===Kt.EMISSIVE){const o=this.getFloat("emissiveIntensity"),l=this.getColor(n).mul(o);i.emissiveMap&&i.emissiveMap.isTexture===!0?s=l.mul(this.getTexture(n)):s=l}else if(n===Kt.NORMAL)i.normalMap?(s=rz(this.getTexture("normal"),this.getCache("normalScale","vec2")),s.normalMapType=i.normalMapType):i.bumpMap?s=zme(this.getTexture("bump").r,this.getFloat("bumpScale")):s=Mc;else if(n===Kt.CLEARCOAT){const o=this.getFloat(n);i.clearcoatMap&&i.clearcoatMap.isTexture===!0?s=o.mul(this.getTexture(n).r):s=o}else if(n===Kt.CLEARCOAT_ROUGHNESS){const o=this.getFloat(n);i.clearcoatRoughnessMap&&i.clearcoatRoughnessMap.isTexture===!0?s=o.mul(this.getTexture(n).r):s=o}else if(n===Kt.CLEARCOAT_NORMAL)i.clearcoatNormalMap?s=rz(this.getTexture(n),this.getCache(n+"Scale","vec2")):s=Mc;else if(n===Kt.SHEEN){const o=this.getColor("sheenColor").mul(this.getFloat("sheen"));i.sheenColorMap&&i.sheenColorMap.isTexture===!0?s=o.mul(this.getTexture("sheenColor").rgb):s=o}else if(n===Kt.SHEEN_ROUGHNESS){const o=this.getFloat(n);i.sheenRoughnessMap&&i.sheenRoughnessMap.isTexture===!0?s=o.mul(this.getTexture(n).a):s=o,s=s.clamp(.07,1)}else if(n===Kt.ANISOTROPY)if(i.anisotropyMap&&i.anisotropyMap.isTexture===!0){const o=this.getTexture(n);s=uR(Dy.x,Dy.y,Dy.y.negate(),Dy.x).mul(o.rg.mul(2).sub(Ji(1)).normalize().mul(o.b))}else s=Dy;else if(n===Kt.IRIDESCENCE_THICKNESS){const o=Bs("1","float",i.iridescenceThicknessRange);if(i.iridescenceThicknessMap){const l=Bs("0","float",i.iridescenceThicknessRange);s=o.sub(l).mul(this.getTexture(n).g).add(l)}else s=o}else if(n===Kt.TRANSMISSION){const o=this.getFloat(n);i.transmissionMap?s=o.mul(this.getTexture(n).r):s=o}else if(n===Kt.THICKNESS){const o=this.getFloat(n);i.thicknessMap?s=o.mul(this.getTexture(n).g):s=o}else if(n===Kt.IOR)s=this.getFloat(n);else if(n===Kt.LIGHT_MAP)s=this.getTexture(n).rgb.mul(this.getFloat("lightMapIntensity"));else if(n===Kt.AO_MAP)s=this.getTexture(n).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else{const o=this.getNodeType(e);s=this.getCache(n,o)}return s}}Kt.ALPHA_TEST="alphaTest",Kt.COLOR="color",Kt.OPACITY="opacity",Kt.SHININESS="shininess",Kt.SPECULAR="specular",Kt.SPECULAR_STRENGTH="specularStrength",Kt.SPECULAR_INTENSITY="specularIntensity",Kt.SPECULAR_COLOR="specularColor",Kt.REFLECTIVITY="reflectivity",Kt.ROUGHNESS="roughness",Kt.METALNESS="metalness",Kt.NORMAL="normal",Kt.CLEARCOAT="clearcoat",Kt.CLEARCOAT_ROUGHNESS="clearcoatRoughness",Kt.CLEARCOAT_NORMAL="clearcoatNormal",Kt.EMISSIVE="emissive",Kt.ROTATION="rotation",Kt.SHEEN="sheen",Kt.SHEEN_ROUGHNESS="sheenRoughness",Kt.ANISOTROPY="anisotropy",Kt.IRIDESCENCE="iridescence",Kt.IRIDESCENCE_IOR="iridescenceIOR",Kt.IRIDESCENCE_THICKNESS="iridescenceThickness",Kt.IOR="ior",Kt.TRANSMISSION="transmission",Kt.THICKNESS="thickness",Kt.ATTENUATION_DISTANCE="attenuationDistance",Kt.ATTENUATION_COLOR="attenuationColor",Kt.LINE_SCALE="scale",Kt.LINE_DASH_SIZE="dashSize",Kt.LINE_GAP_SIZE="gapSize",Kt.LINE_WIDTH="linewidth",Kt.LINE_DASH_OFFSET="dashOffset",Kt.POINT_WIDTH="pointWidth",Kt.DISPERSION="dispersion",Kt.LIGHT_MAP="light",Kt.AO_MAP="ao";const jme=Yi(Kt,Kt.ALPHA_TEST),Gme=Yi(Kt,Kt.COLOR),Vme=Yi(Kt,Kt.SHININESS),Hme=Yi(Kt,Kt.EMISSIVE),sz=Yi(Kt,Kt.OPACITY),Wme=Yi(Kt,Kt.SPECULAR),az=Yi(Kt,Kt.SPECULAR_INTENSITY),Qme=Yi(Kt,Kt.SPECULAR_COLOR),T_=Yi(Kt,Kt.SPECULAR_STRENGTH),RR=Yi(Kt,Kt.REFLECTIVITY),qme=Yi(Kt,Kt.ROUGHNESS),Xme=Yi(Kt,Kt.METALNESS),Kme=Yi(Kt,Kt.NORMAL).context({getUV:null}),Yme=Yi(Kt,Kt.CLEARCOAT),Jme=Yi(Kt,Kt.CLEARCOAT_ROUGHNESS),Zme=Yi(Kt,Kt.CLEARCOAT_NORMAL).context({getUV:null}),$me=Yi(Kt,Kt.ROTATION),ege=Yi(Kt,Kt.SHEEN),tge=Yi(Kt,Kt.SHEEN_ROUGHNESS),ige=Yi(Kt,Kt.ANISOTROPY),rge=Yi(Kt,Kt.IRIDESCENCE),nge=Yi(Kt,Kt.IRIDESCENCE_IOR),sge=Yi(Kt,Kt.IRIDESCENCE_THICKNESS),age=Yi(Kt,Kt.TRANSMISSION),oge=Yi(Kt,Kt.THICKNESS),lge=Yi(Kt,Kt.IOR),cge=Yi(Kt,Kt.ATTENUATION_DISTANCE),uge=Yi(Kt,Kt.ATTENUATION_COLOR),hge=Yi(Kt,Kt.LINE_SCALE),dge=Yi(Kt,Kt.LINE_DASH_SIZE),pge=Yi(Kt,Kt.LINE_GAP_SIZE);Kt.LINE_WIDTH,Kt.LINE_DASH_OFFSET,Kt.POINT_WIDTH;const fge=Yi(Kt,Kt.DISPERSION),oz=Yi(Kt,Kt.LIGHT_MAP),mge=Yi(Kt,Kt.AO_MAP),Dy=Zr(new Dn).onReference(function(r){return r.material}).onRenderUpdate(function({material:r}){this.value.set(r.anisotropy*Math.cos(r.anisotropyRotation),r.anisotropy*Math.sin(r.anisotropyRotation))});class gge extends ra{static get type(){return"ModelViewProjectionNode"}constructor(e=null){super("vec4"),this.positionNode=e}setup(e){if(e.shaderStage==="fragment")return lh(e.context.mvp);const i=this.positionNode||Ha,n=e.renderer.nodes.modelViewMatrix||C_;return w_.mul(n).mul(i)}}const IR=ui(gge);class Us extends tn{static get type(){return"IndexNode"}constructor(e){super("uint"),this.scope=e,this.isInstanceIndexNode=!0}generate(e){const i=this.getNodeType(e),n=this.scope;let s;if(n===Us.VERTEX)s=e.getVertexIndex();else if(n===Us.INSTANCE)s=e.getInstanceIndex();else if(n===Us.DRAW)s=e.getDrawIndex();else if(n===Us.INVOCATION_LOCAL)s=e.getInvocationLocalIndex();else if(n===Us.INVOCATION_SUBGROUP)s=e.getInvocationSubgroupIndex();else if(n===Us.SUBGROUP)s=e.getSubgroupIndex();else throw new Error("THREE.IndexNode: Unknown scope: "+n);let o;return e.shaderStage==="vertex"||e.shaderStage==="compute"?o=s:o=lh(this).build(e,i),o}}Us.VERTEX="vertex",Us.INSTANCE="instance",Us.SUBGROUP="subgroup",Us.INVOCATION_LOCAL="invocationLocal",Us.INVOCATION_SUBGROUP="invocationSubgroup",Us.DRAW="draw";const Age=Yi(Us,Us.VERTEX),BR=Yi(Us,Us.INSTANCE);Us.SUBGROUP,Us.INVOCATION_SUBGROUP,Us.INVOCATION_LOCAL;const yge=Yi(Us,Us.DRAW);class vge extends tn{static get type(){return"InstanceNode"}constructor(e){super("void"),this.instanceMesh=e,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=hn.FRAME,this.buffer=null,this.bufferColor=null}setup(e){let i=this.instanceMatrixNode,n=this.instanceColorNode;const s=this.instanceMesh;if(i===null){const u=s.instanceMatrix;if(s.count<=1e3)i=SR(u.array,"mat4",Math.max(s.count,1)).element(BR);else{const c=new npe(u.array,16,1);this.buffer=c;const h=u.usage===fg?W8:H8,p=[h(c,"vec4",16,0),h(c,"vec4",16,4),h(c,"vec4",16,8),h(c,"vec4",16,12)];i=Og(...p)}this.instanceMatrixNode=i}const o=s.instanceColor;if(o&&n===null){const u=new Hde(o.array,3),c=o.usage===fg?W8:H8;this.bufferColor=u,n=ti(c(u,"vec3",3,0)),this.instanceColorNode=n}const l=i.mul(Ha).xyz;if(Ha.assign(l),e.hasGeometryAttribute("normal")){const u=xme(Yc,i);Yc.assign(u)}this.instanceColorNode!==null&&f_("vec3","vInstanceColor").assign(this.instanceColorNode)}update(){this.instanceMesh.instanceMatrix.usage!==fg&&this.buffer!=null&&this.instanceMesh.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMesh.instanceMatrix.version),this.instanceMesh.instanceColor&&this.instanceMesh.instanceColor.usage!==fg&&this.bufferColor!=null&&this.instanceMesh.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceMesh.instanceColor.version)}}const bge=ui(vge);class xge extends tn{static get type(){return"BatchNode"}constructor(e){super("void"),this.batchMesh=e,this.batchingIdNode=null}setup(e){this.batchingIdNode===null&&(e.getDrawIndex()===null?this.batchingIdNode=BR:this.batchingIdNode=yge);const i=Hi(([m])=>{const y=My(Tc(this.batchMesh._indirectTexture),0),b=Ps(m).modInt(Ps(y)),v=Ps(m).div(Ps(y));return Tc(this.batchMesh._indirectTexture,nh(b,v)).x}).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]})(Ps(this.batchingIdNode)),n=this.batchMesh._matricesTexture,s=My(Tc(n),0),o=ri(i).mul(4).toInt().toVar(),l=o.modInt(s),u=o.div(Ps(s)),c=Og(Tc(n,nh(l,u)),Tc(n,nh(l.add(1),u)),Tc(n,nh(l.add(2),u)),Tc(n,nh(l.add(3),u))),h=this.batchMesh._colorsTexture;if(h!==null){const m=Hi(([y])=>{const b=My(Tc(h),0).x,v=y,_=v.modInt(b),C=v.div(b);return Tc(h,nh(_,C)).rgb}).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]})(i);f_("vec3","vBatchColor").assign(m)}const p=Ro(c);Ha.assign(c.mul(Ha));const f=Yc.div(ti(p[0].dot(p[0]),p[1].dot(p[1]),p[2].dot(p[2]))),g=p.mul(f).xyz;Yc.assign(g),e.hasGeometryAttribute("tangent")&&MR.mulAssign(p)}}const _ge=ui(xge),lz=new WeakMap;class Ege extends tn{static get type(){return"SkinningNode"}constructor(e,i=!1){super("void"),this.skinnedMesh=e,this.useReference=i,this.updateType=hn.OBJECT,this.skinIndexNode=ch("skinIndex","uvec4"),this.skinWeightNode=ch("skinWeight","vec4");let n,s,o;i?(n=Bs("bindMatrix","mat4"),s=Bs("bindMatrixInverse","mat4"),o=ez("skeleton.boneMatrices","mat4",e.skeleton.bones.length)):(n=Zr(e.bindMatrix,"mat4"),s=Zr(e.bindMatrixInverse,"mat4"),o=SR(e.skeleton.boneMatrices,"mat4",e.skeleton.bones.length)),this.bindMatrixNode=n,this.bindMatrixInverseNode=s,this.boneMatricesNode=o,this.previousBoneMatricesNode=null}getSkinnedPosition(e=this.boneMatricesNode,i=Ha){const{skinIndexNode:n,skinWeightNode:s,bindMatrixNode:o,bindMatrixInverseNode:l}=this,u=e.element(n.x),c=e.element(n.y),h=e.element(n.z),p=e.element(n.w),f=o.mul(i),g=Io(u.mul(s.x).mul(f),c.mul(s.y).mul(f),h.mul(s.z).mul(f),p.mul(s.w).mul(f));return l.mul(g).xyz}getSkinnedNormal(e=this.boneMatricesNode,i=Yc){const{skinIndexNode:n,skinWeightNode:s,bindMatrixNode:o,bindMatrixInverseNode:l}=this,u=e.element(n.x),c=e.element(n.y),h=e.element(n.z),p=e.element(n.w);let f=Io(s.x.mul(u),s.y.mul(c),s.z.mul(h),s.w.mul(p));return f=l.mul(f).mul(o),f.transformDirection(i).xyz}getPreviousSkinnedPosition(e){const i=e.object;return this.previousBoneMatricesNode===null&&(i.skeleton.previousBoneMatrices=new Float32Array(i.skeleton.boneMatrices),this.previousBoneMatricesNode=ez("skeleton.previousBoneMatrices","mat4",i.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,X8)}needsPreviousBoneMatrices(e){const i=e.renderer.getMRT();return i&&i.has("velocity")}setup(e){this.needsPreviousBoneMatrices(e)&&X8.assign(this.getPreviousSkinnedPosition(e));const i=this.getSkinnedPosition();if(Ha.assign(i),e.hasGeometryAttribute("normal")){const n=this.getSkinnedNormal();Yc.assign(n),e.hasGeometryAttribute("tangent")&&MR.assign(n)}}generate(e,i){if(i!=="void")return Ha.build(e,i)}update(e){const i=(this.useReference?e.object:this.skinnedMesh).skeleton;lz.get(i)!==e.frameId&&(lz.set(i,e.frameId),this.previousBoneMatricesNode!==null&&i.previousBoneMatrices.set(i.boneMatrices),i.update())}}const wge=r=>Ti(new Ege(r,!0));class Cge extends tn{static get type(){return"LoopNode"}constructor(e=[]){super(),this.params=e}getVarName(e){return String.fromCharCode(105+e)}getProperties(e){const i=e.getNodeProperties(this);if(i.stackNode!==void 0)return i;const n={};for(let o=0,l=this.params.length-1;o<l;o++){const u=this.params[o],c=u.isNode!==!0&&u.name||this.getVarName(o),h=u.isNode!==!0&&u.type||"int";n[c]=Ty(c,h)}const s=e.addStack();return i.returnsNode=this.params[this.params.length-1](n,s,e),i.stackNode=s,e.removeStack(),i}getNodeType(e){const{returnsNode:i}=this.getProperties(e);return i?i.getNodeType(e):"void"}setup(e){this.getProperties(e)}generate(e){const i=this.getProperties(e),n=this.params,s=i.stackNode;for(let u=0,c=n.length-1;u<c;u++){const h=n[u];let p=null,f=null,g=null,m=null,y=null,b=null;h.isNode?(m="int",g=this.getVarName(u),p="0",f=h.build(e,m),y="<"):(m=h.type||"int",g=h.name||this.getVarName(u),p=h.start,f=h.end,y=h.condition,b=h.update,typeof p=="number"?p=e.generateConst(m,p):p&&p.isNode&&(p=p.build(e,m)),typeof f=="number"?f=e.generateConst(m,f):f&&f.isNode&&(f=f.build(e,m)),p!==void 0&&f===void 0?(p=p+" - 1",f="0",y=">="):f!==void 0&&p===void 0&&(p="0",y="<"),y===void 0&&(Number(p)>Number(f)?y=">=":y="<"));const v={start:p,end:f},_=v.start,C=v.end;let E="",T="",R="";b||(m==="int"||m==="uint"?y.includes("<")?b="++":b="--":y.includes("<")?b="+= 1.":b="-= 1."),E+=e.getVar(m,g)+" = "+_,T+=g+" "+y+" "+C,R+=g+" "+b;const B=`for ( ${E}; ${T}; ${R} )`;e.addFlowCode((u===0?`
`:"")+e.tab+B+` {

`).addFlowTab()}const o=s.build(e,"void"),l=i.returnsNode?i.returnsNode.build(e):"";e.removeFlowTab().addFlowCode(`
`+e.tab+o);for(let u=0,c=this.params.length-1;u<c;u++)e.addFlowCode((u===0?"":e.tab)+`}

`).removeFlowTab();return e.addFlowTab(),l}}const Jc=(...r)=>Ti(new Cge(Dg(r,"int"))).append(),Sge=()=>Ty("break").append(),NR=new WeakMap,El=new Zn,cz=Hi(({bufferMap:r,influence:e,stride:i,width:n,depth:s,offset:o})=>{const l=Ps(Age).mul(i).add(o),u=l.div(n),c=l.sub(u.mul(n));return Tc(r,nh(c,u)).depth(s).mul(e)});function Tge(r){const e=r.morphAttributes.position!==void 0,i=r.morphAttributes.normal!==void 0,n=r.morphAttributes.color!==void 0,s=r.morphAttributes.position||r.morphAttributes.normal||r.morphAttributes.color,o=s!==void 0?s.length:0;let l=NR.get(r);if(l===void 0||l.count!==o){let u=function(){v.dispose(),NR.delete(r),r.removeEventListener("dispose",u)};l!==void 0&&l.texture.dispose();const c=r.morphAttributes.position||[],h=r.morphAttributes.normal||[],p=r.morphAttributes.color||[];let f=0;e===!0&&(f=1),i===!0&&(f=2),n===!0&&(f=3);let g=r.attributes.position.count*f,m=1;const y=4096;g>y&&(m=Math.ceil(g/y),g=y);const b=new Float32Array(g*m*4*o),v=new wde(b,g,m,o);v.type=Al,v.needsUpdate=!0;const _=f*4;for(let C=0;C<o;C++){const E=c[C],T=h[C],R=p[C],B=g*m*4*C;for(let I=0;I<E.count;I++){const D=I*_;e===!0&&(El.fromBufferAttribute(E,I),b[B+D+0]=El.x,b[B+D+1]=El.y,b[B+D+2]=El.z,b[B+D+3]=0),i===!0&&(El.fromBufferAttribute(T,I),b[B+D+4]=El.x,b[B+D+5]=El.y,b[B+D+6]=El.z,b[B+D+7]=0),n===!0&&(El.fromBufferAttribute(R,I),b[B+D+8]=El.x,b[B+D+9]=El.y,b[B+D+10]=El.z,b[B+D+11]=R.itemSize===4?El.w:1)}}l={count:o,texture:v,stride:f,size:new Dn(g,m)},NR.set(r,l),r.addEventListener("dispose",u)}return l}class Mge extends tn{static get type(){return"MorphNode"}constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=Zr(1),this.updateType=hn.OBJECT}setup(e){const{geometry:i}=e,n=i.morphAttributes.position!==void 0,s=i.hasAttribute("normal")&&i.morphAttributes.normal!==void 0,o=i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color,l=o!==void 0?o.length:0,{texture:u,stride:c,size:h}=Tge(i);n===!0&&Ha.mulAssign(this.morphBaseInfluence),s===!0&&Yc.mulAssign(this.morphBaseInfluence);const p=Ps(h.width);Jc(l,({i:f})=>{const g=ri(0).toVar();this.mesh.count>1&&this.mesh.morphTexture!==null&&this.mesh.morphTexture!==void 0?g.assign(Tc(this.mesh.morphTexture,nh(Ps(f).add(1),Ps(BR))).r):g.assign(Bs("morphTargetInfluences","float").element(f).toVar()),n===!0&&Ha.addAssign(cz({bufferMap:u,influence:g,stride:c,width:p,depth:f,offset:Ps(0)})),s===!0&&Yc.addAssign(cz({bufferMap:u,influence:g,stride:c,width:p,depth:f,offset:Ps(1)}))})}update(){const e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((i,n)=>i+n,0)}}const Rge=ui(Mge);class zg extends tn{static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}generate(){console.warn("Abstract function.")}}class Ige extends zg{static get type(){return"AONode"}constructor(e=null){super(),this.aoNode=e}setup(e){e.context.ambientOcclusion.mulAssign(this.aoNode)}}class Bge extends z8{static get type(){return"LightingContextNode"}constructor(e,i=null,n=null,s=null){super(e),this.lightingModel=i,this.backdropNode=n,this.backdropAlphaNode=s,this._value=null}getContext(){const{backdropNode:e,backdropAlphaNode:i}=this,n=ti().toVar("directDiffuse"),s=ti().toVar("directSpecular"),o=ti().toVar("indirectDiffuse"),l=ti().toVar("indirectSpecular"),u={directDiffuse:n,directSpecular:s,indirectDiffuse:o,indirectSpecular:l};return{radiance:ti().toVar("radiance"),irradiance:ti().toVar("irradiance"),iblIrradiance:ti().toVar("iblIrradiance"),ambientOcclusion:ri(1).toVar("ambientOcclusion"),reflectedLight:u,backdrop:e,backdropAlpha:i}}setup(e){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}}const Nge=ui(Bge);class Lge extends zg{static get type(){return"IrradianceNode"}constructor(e){super(),this.node=e}setup(e){e.context.irradiance.addAssign(this.node)}}let Oy,Py;class aa extends tn{static get type(){return"ScreenNode"}constructor(e){super(),this.scope=e,this.isViewportNode=!0}getNodeType(){return this.scope===aa.VIEWPORT?"vec4":"vec2"}getUpdateType(){let e=hn.NONE;return(this.scope===aa.SIZE||this.scope===aa.VIEWPORT)&&(e=hn.RENDER),this.updateType=e,e}update({renderer:e}){const i=e.getRenderTarget();this.scope===aa.VIEWPORT?i!==null?Py.copy(i.viewport):(e.getViewport(Py),Py.multiplyScalar(e.getPixelRatio())):i!==null?(Oy.width=i.width,Oy.height=i.height):e.getDrawingBufferSize(Oy)}setup(){const e=this.scope;let i=null;return e===aa.SIZE?i=Zr(Oy||(Oy=new Dn)):e===aa.VIEWPORT?i=Zr(Py||(Py=new Zn)):i=Ji(DR.div(LR)),i}generate(e){if(this.scope===aa.COORDINATE){let i=e.getFragCoord();if(e.isFlipY()){const n=e.getNodeProperties(LR).outputNode.build(e);i=`${e.getType("vec2")}( ${i}.x, ${n}.y - ${i}.y )`}return i}return super.generate(e)}}aa.COORDINATE="coordinate",aa.VIEWPORT="viewport",aa.SIZE="size",aa.UV="uv";const ky=Yi(aa,aa.UV),LR=Yi(aa,aa.SIZE),DR=Yi(aa,aa.COORDINATE),uz=Yi(aa,aa.VIEWPORT);uz.zw,uz.xy;const Fy=new Dn;class hz extends Ry{static get type(){return"ViewportTextureNode"}constructor(e=ky,i=null,n=null){n===null&&(n=new qde,n.minFilter=Wu),super(n,e,i),this.generateMipmaps=!1,this.isOutputTextureNode=!0,this.updateBeforeType=hn.FRAME}updateBefore(e){const i=e.renderer;i.getDrawingBufferSize(Fy);const n=this.value;(n.image.width!==Fy.width||n.image.height!==Fy.height)&&(n.image.width=Fy.width,n.image.height=Fy.height,n.needsUpdate=!0);const s=n.generateMipmaps;n.generateMipmaps=this.generateMipmaps,i.copyFramebufferToTexture(n),n.generateMipmaps=s}clone(){const e=new this.constructor(this.uvNode,this.levelNode,this.value);return e.generateMipmaps=this.generateMipmaps,e}}const dz=ui(hz,null,null,{generateMipmaps:!0});let OR=null;class Dge extends hz{static get type(){return"ViewportDepthTextureNode"}constructor(e=ky,i=null){OR===null&&(OR=new Ig),super(e,i,OR)}}const Oge=ui(Dge);class Jo extends tn{static get type(){return"ViewportDepthNode"}constructor(e,i=null){super("float"),this.scope=e,this.valueNode=i,this.isViewportDepthNode=!0}generate(e){const{scope:i}=this;return i===Jo.DEPTH_BASE?e.getFragDepth():super.generate(e)}setup({camera:e}){const{scope:i}=this,n=this.valueNode;let s=null;if(i===Jo.DEPTH_BASE)n!==null&&(s=mz().assign(n));else if(i===Jo.DEPTH)e.isPerspectiveCamera?s=Pge(Wa.z,Zp,$p):s=Uy(Wa.z,Zp,$p);else if(i===Jo.LINEAR_DEPTH)if(n!==null)if(e.isPerspectiveCamera){const o=pz(n,Zp,$p);s=Uy(o,Zp,$p)}else s=n;else s=Uy(Wa.z,Zp,$p);return s}}Jo.DEPTH_BASE="depthBase",Jo.DEPTH="depth",Jo.LINEAR_DEPTH="linearDepth";const Uy=(r,e,i)=>r.add(e).div(e.sub(i)),Pge=(r,e,i)=>e.add(r).mul(i).div(i.sub(e).mul(r)),pz=(r,e,i)=>e.mul(i).div(i.sub(e).mul(r).sub(i)),fz=(r,e,i)=>{e=e.max(1e-6).toVar();const n=ah(r.div(e).add(1)),s=ah(i.div(e).add(1));return n.div(s)},mz=ui(Jo,Jo.DEPTH_BASE),gz=Yi(Jo,Jo.DEPTH);Jo.LINEAR_DEPTH,Oge(),gz.assign=r=>mz(r);class Rd extends tn{static get type(){return"ClippingNode"}constructor(e=Rd.DEFAULT){super(),this.scope=e}setup(e){super.setup(e);const i=e.clippingContext,{localClipIntersection:n,localClippingCount:s,globalClippingCount:o}=i,l=o+s,u=n?l-s:l;return this.scope===Rd.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(i.planes,l,u):this.setupDefault(i.planes,l,u)}setupAlphaToCoverage(e,i,n){return Hi(()=>{const s=Ny(e),o=Pg("float","distanceToPlane"),l=Pg("float","distanceToGradient"),u=Pg("float","clipOpacity");u.assign(1);let c;if(Jc(n,({i:h})=>{c=s.element(h),o.assign(Wa.dot(c.xyz).negate().add(c.w)),l.assign(o.fwidth().div(2)),u.mulAssign(Jp(l.negate(),l,o)),u.equal(0).discard()}),n<i){const h=Pg("float","unionclipOpacity");h.assign(1),Jc({start:n,end:i},({i:p})=>{c=s.element(p),o.assign(Wa.dot(c.xyz).negate().add(c.w)),l.assign(o.fwidth().div(2)),h.mulAssign(Jp(l.negate(),l,o).oneMinus())}),u.mulAssign(h.oneMinus())}qn.a.mulAssign(u),qn.a.equal(0).discard()})()}setupDefault(e,i,n){return Hi(()=>{const s=Ny(e);let o;if(Jc(n,({i:l})=>{o=s.element(l),Wa.dot(o.xyz).greaterThan(o.w).discard()}),n<i){const l=Pg("bool","clipped");l.assign(!0),Jc({start:n,end:i},({i:u})=>{o=s.element(u),l.assign(Wa.dot(o.xyz).greaterThan(o.w).and(l))}),l.discard()}})()}}Rd.ALPHA_TO_COVERAGE="alphaToCoverage",Rd.DEFAULT="default";const kge=()=>Ti(new Rd),Fge=()=>Ti(new Rd(Rd.ALPHA_TO_COVERAGE)),Uge=.05,Az=Hi(([r])=>Cd(bn(1e4,Cc(bn(17,r.x).add(bn(.1,r.y)))).mul(Io(.1,Sc(Cc(bn(13,r.y).add(r.x))))))),yz=Hi(([r])=>Az(Ji(Az(r.xy),r.z))),zge=Hi(([r])=>{const e=zl(Td(L8(r.xyz)),Td(D8(r.xyz))).toVar("maxDeriv"),i=ri(1).div(ri(Uge).mul(e)).toVar("pixScale"),n=Ji(Ey(Yp(ah(i))),Ey(vR(ah(i)))).toVar("pixScales"),s=Ji(yz(Yp(n.x.mul(r.xyz))),yz(Yp(n.y.mul(r.xyz)))).toVar("alpha"),o=Cd(ah(i)).toVar("lerpFactor"),l=Io(bn(o.oneMinus(),s.x),bn(o,s.y)).toVar("x"),u=Cy(o,o.oneMinus()).toVar("a"),c=ti(l.mul(l).div(bn(2,u).mul(_l(1,u))),l.sub(bn(.5,u)).div(_l(1,u)),_l(1,_l(1,l).mul(_l(1,l)).div(bn(2,u).mul(_l(1,u))))).toVar("cases"),h=l.lessThan(u.oneMinus()).select(l.lessThan(u).select(c.x,c.y),c.z);return oh(h,1e-6,1)});class oa extends Ko{static get type(){return"NodeMaterial"}constructor(){super(),this.isNodeMaterial=!0,this.type=this.constructor.type,this.forceSinglePass=!1,this.fog=!0,this.lights=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.positionNode=null,this.geometryNode=null,this.depthNode=null,this.shadowNode=null,this.shadowPositionNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null}customProgramCacheKey(){return this.type+i8(this)}build(e){this.setup(e)}setupObserver(e){return new ape(e)}setup(e){e.context.setupNormal=()=>this.setupNormal(e),e.addStack(),e.stack.outputNode=this.vertexNode||this.setupPosition(e),this.geometryNode!==null&&(e.stack.outputNode=e.stack.outputNode.bypass(this.geometryNode)),e.addFlow("vertex",e.removeStack()),e.addStack();let i;const n=this.setupClipping(e);if(this.depthWrite===!0&&this.setupDepth(e),this.fragmentNode===null){this.setupDiffuseColor(e),this.setupVariants(e);const s=this.setupLighting(e);n!==null&&e.stack.add(n);const o=Jr(s,qn.a).max(0);if(i=this.setupOutput(e,o),Hpe.assign(i),this.outputNode!==null&&(i=this.outputNode),e.renderer.getRenderTarget()!==null){const l=e.renderer.getMRT(),u=this.mrtNode;l!==null?(i=l,u!==null&&(i=l.merge(u))):u!==null&&(i=u)}}else{let s=this.fragmentNode;s.isOutputStructNode!==!0&&(s=Jr(s)),i=this.setupOutput(e,s)}e.stack.outputNode=i,e.addFlow("fragment",e.removeStack()),e.monitor=this.setupObserver(e)}setupClipping(e){if(e.clippingContext===null)return null;const{globalClippingCount:i,localClippingCount:n}=e.clippingContext;let s=null;if(i||n){const o=e.renderer.samples;this.alphaToCoverage&&o>1?s=Fge():e.stack.add(kge())}return s}setupDepth(e){const{renderer:i,camera:n}=e;let s=this.depthNode;if(s===null){const o=i.getMRT();o&&o.has("depth")?s=o.get("depth"):i.logarithmicDepthBuffer===!0&&(n.isPerspectiveCamera?s=fz(IR().w,Zp,$p):s=Uy(Wa.z,Zp,$p))}s!==null&&gz.assign(s).append()}setupPosition(e){const{object:i}=e,n=i.geometry;if(e.addStack(),(n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color)&&Rge(i).append(),i.isSkinnedMesh===!0&&wge(i).append(),this.displacementMap){const o=Md("displacementMap","texture"),l=Md("displacementScale","float"),u=Md("displacementBias","float");Ha.addAssign(Yc.normalize().mul(o.x.mul(l).add(u)))}i.isBatchedMesh&&_ge(i).append(),i.instanceMatrix&&i.instanceMatrix.isInstancedBufferAttribute===!0&&bge(i).append(),this.positionNode!==null&&Ha.assign(this.positionNode);const s=IR();return e.context.vertex=e.removeStack(),e.context.mvp=s,s}setupDiffuseColor({object:e,geometry:i}){let n=this.colorNode?Jr(this.colorNode):Gme;this.vertexColors===!0&&i.hasAttribute("color")&&(n=Jr(n.xyz.mul(ch("color","vec3")),n.a)),e.instanceColor&&(n=f_("vec3","vInstanceColor").mul(n)),e.isBatchedMesh&&e._colorsTexture&&(n=f_("vec3","vBatchColor").mul(n)),qn.assign(n);const s=this.opacityNode?ri(this.opacityNode):sz;if(qn.a.assign(qn.a.mul(s)),this.alphaTestNode!==null||this.alphaTest>0){const o=this.alphaTestNode!==null?ri(this.alphaTestNode):jme;qn.a.lessThanEqual(o).discard()}this.alphaHash===!0&&qn.a.lessThan(zge(Ha)).discard(),this.transparent===!1&&this.blending===dd&&this.alphaToCoverage===!1&&qn.a.assign(1)}setupVariants(){}setupOutgoingLight(){return this.lights===!0?ti(0):qn.rgb}setupNormal(){return this.normalNode?ti(this.normalNode):Kme}setupEnvironment(){let e=null;return this.envNode?e=this.envNode:this.envMap&&(e=this.envMap.isCubeTexture?Md("envMap","cubeTexture"):Md("envMap","texture")),e}setupLightMap(e){let i=null;return e.material.lightMap&&(i=new Lge(oz)),i}setupLights(e){const i=[],n=this.setupEnvironment(e);n&&n.isLightingNode&&i.push(n);const s=this.setupLightMap(e);if(s&&s.isLightingNode&&i.push(s),this.aoNode!==null||e.material.aoMap){const l=this.aoNode!==null?this.aoNode:mge;i.push(new Ige(l))}let o=this.lightsNode||e.lightsNode;return i.length>0&&(o=e.renderer.lighting.createNode([...o.getLights(),...i])),o}setupLightingModel(){}setupLighting(e){const{material:i}=e,{backdropNode:n,backdropAlphaNode:s,emissiveNode:o}=this,l=this.lights===!0||this.lightsNode!==null?this.setupLights(e):null;let u=this.setupOutgoingLight(e);if(l&&l.getScope().hasLights){const c=this.setupLightingModel(e);u=Nge(l,c,n,s)}else n!==null&&(u=ti(s!==null?As(u,n,s):n));return(o&&o.isNode===!0||i.emissive&&i.emissive.isColor===!0)&&(b8.assign(ti(o||Hme)),u=u.add(b8)),u}setupOutput(e,i){if(this.fog===!0){const n=e.fogNode;n&&(i=Jr(n.mix(i.rgb,n.colorNode),i.a))}return i}setDefaultValues(e){for(const n in e){const s=e[n];this[n]===void 0&&(this[n]=s,s&&s.clone&&(this[n]=s.clone()))}const i=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(const n in i)Object.getOwnPropertyDescriptor(this.constructor.prototype,n)===void 0&&i[n].get!==void 0&&Object.defineProperty(this.constructor.prototype,n,i[n])}toJSON(e){const i=e===void 0||typeof e=="string";i&&(e={textures:{},images:{},nodes:{}});const n=Ko.prototype.toJSON.call(this,e),s=o_(this);n.inputNodes={};for(const{property:l,childNode:u}of s)n.inputNodes[l]=u.toJSON(e).uuid;function o(l){const u=[];for(const c in l){const h=l[c];delete h.metadata,u.push(h)}return u}if(i){const l=o(e.textures),u=o(e.images),c=o(e.nodes);l.length>0&&(n.textures=l),u.length>0&&(n.images=u),c.length>0&&(n.nodes=c)}return n}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.positionNode=e.positionNode,this.geometryNode=e.geometryNode,this.depthNode=e.depthNode,this.shadowNode=e.shadowNode,this.shadowPositionNode=e.shadowPositionNode,this.outputNode=e.outputNode,this.mrtNode=e.mrtNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,super.copy(e)}}const jge=new J3;class Gge extends oa{static get type(){return"LineBasicNodeMaterial"}constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.lights=!1,this.setDefaultValues(jge),this.setValues(e)}}const Vge=new Y6;class Hge extends oa{static get type(){return"LineDashedNodeMaterial"}constructor(e){super(),this.isLineDashedNodeMaterial=!0,this.lights=!1,this.setDefaultValues(Vge),this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setupVariants(){const e=this.offsetNode,i=this.dashScaleNode?ri(this.dashScaleNode):hge,n=this.dashSizeNode?ri(this.dashSizeNode):dge,s=this.dashSizeNode?ri(this.dashGapNode):pge;gR.assign(n),E8.assign(s);const o=lh(ch("lineDistance").mul(i));(e?o.add(e):o).mod(gR.add(E8)).greaterThan(gR).discard()}}const Wge=r=>Ti(r).mul(.5).add(.5),Qge=new q6;class qge extends oa{static get type(){return"MeshNormalNodeMaterial"}constructor(e){super(),this.lights=!1,this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(Qge),this.setValues(e)}setupDiffuseColor(){const e=this.opacityNode?ri(this.opacityNode):sz;qn.assign(Jr(Wge(sa),e))}}class Xge extends ra{static get type(){return"EquirectUVNode"}constructor(e=K8){super("vec2"),this.dirNode=e}setup(){const e=this.dirNode,i=e.z.atan2(e.x).mul(1/(Math.PI*2)).add(.5),n=e.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return Ji(i,n)}}const vz=ui(Xge);class bz extends Gde{constructor(e=1,i={}){super(e,i),this.isCubeRenderTarget=!0}fromEquirectangularTexture(e,i){const n=i.minFilter,s=i.generateMipmaps;i.generateMipmaps=!0,this.texture.type=i.type,this.texture.colorSpace=i.colorSpace,this.texture.generateMipmaps=i.generateMipmaps,this.texture.minFilter=i.minFilter,this.texture.magFilter=i.magFilter;const o=new yy(5,5,5),l=vz(K8),u=new oa;u.colorNode=ks(i,l,0),u.side=yc,u.blending=ag;const c=new Qp(o,u),h=new F6;h.add(c),i.minFilter===Wu&&(i.minFilter=gl);const p=new k6(1,10,this),f=e.getMRT();return e.setMRT(null),p.update(e,h),e.setMRT(f),i.minFilter=n,i.currentGenerateMipmaps=s,c.geometry.dispose(),c.material.dispose(),this}}const zy=new WeakMap;class Kge extends ra{static get type(){return"CubeMapNode"}constructor(e){super("vec3"),this.envNode=e,this._cubeTexture=null,this._cubeTextureNode=By();const i=new X3;i.isRenderTargetTexture=!0,this._defaultTexture=i,this.updateBeforeType=hn.RENDER}updateBefore(e){const{renderer:i,material:n}=e,s=this.envNode;if(s.isTextureNode||s.isMaterialReferenceNode){const o=s.isTextureNode?s.value:n[s.property];if(o&&o.isTexture){const l=o.mapping;if(l===iy||l===ry){if(zy.has(o)){const u=zy.get(o);_z(u,o.mapping),this._cubeTexture=u}else{const u=o.image;if(Yge(u)){const c=new bz(u.height);c.fromEquirectangularTexture(i,o),_z(c.texture,o.mapping),this._cubeTexture=c.texture,zy.set(o,c.texture),o.addEventListener("dispose",xz)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(e){return this.updateBefore(e),this._cubeTextureNode}}function Yge(r){return r==null?!1:r.height>0}function xz(r){const e=r.target;e.removeEventListener("dispose",xz);const i=zy.get(e);i!==void 0&&(zy.delete(e),i.dispose())}function _z(r,e){e===iy?r.mapping=kp:e===ry&&(r.mapping=lg)}const Ez=ui(Kge);class PR extends zg{static get type(){return"BasicEnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){e.context.environment=Ez(this.envNode)}}class Jge extends zg{static get type(){return"BasicLightMapNode"}constructor(e=null){super(),this.lightMapNode=e}setup(e){const i=ri(1/Math.PI);e.context.irradianceLightMap=this.lightMapNode.mul(i)}}class M_{start(){}finish(){}direct(){}directRectArea(){}indirect(){}ambientOcclusion(){}}class wz extends M_{constructor(){super()}indirect(e,i,n){const s=e.ambientOcclusion,o=e.reflectedLight,l=n.context.irradianceLightMap;o.indirectDiffuse.assign(Jr(0)),l?o.indirectDiffuse.addAssign(l):o.indirectDiffuse.addAssign(Jr(1,1,1,0)),o.indirectDiffuse.mulAssign(s),o.indirectDiffuse.mulAssign(qn.rgb)}finish(e,i,n){const s=n.material,o=e.outgoingLight,l=n.context.environment;if(l)switch(s.combine){case D1:o.rgb.assign(As(o.rgb,o.rgb.mul(l.rgb),T_.mul(RR)));break;case whe:o.rgb.assign(As(o.rgb,l.rgb,T_.mul(RR)));break;case Che:o.rgb.addAssign(l.rgb.mul(T_.mul(RR)));break;default:console.warn("THREE.BasicLightingModel: Unsupported .combine value:",s.combine);break}}}const Zge=new K1;class $ge extends oa{static get type(){return"MeshBasicNodeMaterial"}constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.setDefaultValues(Zge),this.setValues(e)}setupNormal(){return Mc}setupEnvironment(e){const i=super.setupEnvironment(e);return i?new PR(i):null}setupLightMap(e){let i=null;return e.material.lightMap&&(i=new Jge(oz)),i}setupOutgoingLight(){return qn.rgb}setupLightingModel(){return new wz}}const jy=Hi(({f0:r,f90:e,dotVH:i})=>{const n=i.mul(-5.55473).sub(6.98316).mul(i).exp2();return r.mul(n.oneMinus()).add(e.mul(n))}),jg=Hi(r=>r.diffuseColor.mul(1/Math.PI)),e0e=()=>ri(.25),t0e=Hi(({dotNH:r})=>mR.mul(ri(.5)).add(1).mul(ri(1/Math.PI)).mul(r.pow(mR))),i0e=Hi(({lightDirection:r})=>{const e=r.add(Is).normalize(),i=sa.dot(e).clamp(),n=Is.dot(e).clamp(),s=jy({f0:xl,f90:1,dotVH:n}),o=e0e(),l=t0e({dotNH:i});return s.mul(o).mul(l)});class Cz extends wz{constructor(e=!0){super(),this.specular=e}direct({lightDirection:e,lightColor:i,reflectedLight:n}){const s=sa.dot(e).clamp().mul(i);n.directDiffuse.addAssign(s.mul(jg({diffuseColor:qn.rgb}))),this.specular===!0&&n.directSpecular.addAssign(s.mul(i0e({lightDirection:e})).mul(T_))}indirect({ambientOcclusion:e,irradiance:i,reflectedLight:n}){n.indirectDiffuse.addAssign(i.mul(jg({diffuseColor:qn}))),n.indirectDiffuse.mulAssign(e)}}const r0e=new X6;class n0e extends oa{static get type(){return"MeshLambertNodeMaterial"}constructor(e){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(r0e),this.setValues(e)}setupEnvironment(e){const i=super.setupEnvironment(e);return i?new PR(i):null}setupLightingModel(){return new Cz(!1)}}const s0e=new W6;class a0e extends oa{static get type(){return"MeshPhongNodeMaterial"}constructor(e){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(s0e),this.setValues(e)}setupEnvironment(e){const i=super.setupEnvironment(e);return i?new PR(i):null}setupLightingModel(){return new Cz}setupVariants(){const e=(this.shininessNode?ri(this.shininessNode):Vme).max(1e-4);mR.assign(e);const i=this.specularNode||Wme;xl.assign(i)}copy(e){return this.shininessNode=e.shininessNode,this.specularNode=e.specularNode,super.copy(e)}}const o0e=Hi(r=>{if(r.geometry.hasAttribute("normal")===!1)return ri(0);const e=Mc.dFdx().abs().max(Mc.dFdy().abs());return e.x.max(e.y).max(e.z)}),Sz=Hi(r=>{const{roughness:e}=r,i=o0e();let n=e.max(.0525);return n=n.add(i),n=n.min(1),n}),l0e=Hi(({alpha:r,dotNL:e,dotNV:i})=>{const n=r.pow2(),s=e.mul(n.add(n.oneMinus().mul(i.pow2())).sqrt()),o=i.mul(n.add(n.oneMinus().mul(e.pow2())).sqrt());return wd(.5,s.add(o).max(cfe))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),c0e=Hi(({alphaT:r,alphaB:e,dotTV:i,dotBV:n,dotTL:s,dotBL:o,dotNV:l,dotNL:u})=>{const c=u.mul(ti(r.mul(i),e.mul(n),l).length()),h=l.mul(ti(r.mul(s),e.mul(o),u).length());return wd(.5,c.add(h)).saturate()}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),u0e=Hi(({alpha:r,dotNH:e})=>{const i=r.pow2(),n=e.pow2().mul(i.oneMinus()).oneMinus();return i.div(n.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),h0e=ri(1/Math.PI),d0e=Hi(({alphaT:r,alphaB:e,dotNH:i,dotTH:n,dotBH:s})=>{const o=r.mul(e),l=ti(e.mul(n),r.mul(s),o.mul(i)),u=l.dot(l),c=o.div(u);return h0e.mul(o.mul(c.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),Tz=Hi(r=>{const{lightDirection:e,f0:i,f90:n,roughness:s,f:o,USE_IRIDESCENCE:l,USE_ANISOTROPY:u}=r,c=r.normalView||sa,h=s.pow2(),p=e.add(Is).normalize(),f=c.dot(e).clamp(),g=c.dot(Is).clamp(),m=c.dot(p).clamp(),y=Is.dot(p).clamp();let b=jy({f0:i,f90:n,dotVH:y}),v,_;if(m8(l)&&(b=pR.mix(b,o)),m8(u)){const C=A_.dot(e),E=A_.dot(Is),T=A_.dot(p),R=Fg.dot(e),B=Fg.dot(Is),I=Fg.dot(p);v=c0e({alphaT:fR,alphaB:h,dotTV:E,dotBV:B,dotTL:C,dotBL:R,dotNV:g,dotNL:f}),_=d0e({alphaT:fR,alphaB:h,dotNH:m,dotTH:T,dotBH:I})}else v=l0e({alpha:h,dotNL:f,dotNV:g}),_=u0e({alpha:h,dotNH:m});return b.mul(v).mul(_)}),Mz=Hi(({roughness:r,dotNV:e})=>{const i=Jr(-1,-.0275,-.572,.022),n=Jr(1,.0425,1.04,-.04),s=r.mul(i).add(n),o=s.x.mul(s.x).min(e.mul(-9.28).exp2()).mul(s.x).add(s.y);return Ji(-1.04,1.04).mul(o).add(s.zw)}).setLayout({name:"DFGApprox",type:"vec2",inputs:[{name:"roughness",type:"float"},{name:"dotNV",type:"vec3"}]}),Rz=Hi(r=>{const{dotNV:e,specularColor:i,specularF90:n,roughness:s}=r,o=Mz({dotNV:e,roughness:s});return i.mul(o.x).add(n.mul(o.y))}),p0e=Hi(({f:r,f90:e,dotVH:i})=>{const n=i.oneMinus().saturate(),s=n.mul(n),o=n.mul(s,s).clamp(0,.9999);return r.sub(ti(e).mul(o)).div(o.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),f0e=Hi(({roughness:r,dotNH:e})=>{const i=r.pow2(),n=ri(1).div(i),s=e.pow2().oneMinus().max(.0078125);return ri(2).add(n).mul(s.pow(n.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),m0e=Hi(({dotNV:r,dotNL:e})=>ri(1).div(ri(4).mul(e.add(r).sub(e.mul(r))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),g0e=Hi(({lightDirection:r})=>{const e=r.add(Is).normalize(),i=sa.dot(r).clamp(),n=sa.dot(Is).clamp(),s=sa.dot(e).clamp(),o=f0e({roughness:dR,dotNH:s}),l=m0e({dotNV:n,dotNL:i});return kg.mul(o).mul(l)}),A0e=Hi(({N:r,V:e,roughness:i})=>{const n=.0078125,s=r.dot(e).saturate(),o=Ji(i,s.oneMinus().sqrt());return o.assign(o.mul(.984375).add(n)),o}).setLayout({name:"LTC_Uv",type:"vec2",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"roughness",type:"float"}]}),y0e=Hi(({f:r})=>{const e=r.length();return zl(e.mul(e).add(r.z).div(e.add(1)),0)}).setLayout({name:"LTC_ClippedSphereFormFactor",type:"float",inputs:[{name:"f",type:"vec3"}]}),R_=Hi(({v1:r,v2:e})=>{const i=r.dot(e),n=i.abs().toVar(),s=n.mul(.0145206).add(.4965155).mul(n).add(.8543985).toVar(),o=n.add(4.1616724).mul(n).add(3.417594).toVar(),l=s.div(o),u=i.greaterThan(0).select(l,zl(i.mul(i).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(l));return r.cross(e).mul(u)}).setLayout({name:"LTC_EdgeVectorFormFactor",type:"vec3",inputs:[{name:"v1",type:"vec3"},{name:"v2",type:"vec3"}]}),Iz=Hi(({N:r,V:e,P:i,mInv:n,p0:s,p1:o,p2:l,p3:u})=>{const c=o.sub(s).toVar(),h=u.sub(s).toVar(),p=c.cross(h),f=ti().toVar();return Va(p.dot(i.sub(s)).greaterThanEqual(0),()=>{const g=e.sub(r.mul(e.dot(r))).normalize(),m=r.cross(g).negate(),y=n.mul(Ro(g,m,r).transpose()).toVar(),b=y.mul(s.sub(i)).normalize().toVar(),v=y.mul(o.sub(i)).normalize().toVar(),_=y.mul(l.sub(i)).normalize().toVar(),C=y.mul(u.sub(i)).normalize().toVar(),E=ti(0).toVar();E.addAssign(R_({v1:b,v2:v})),E.addAssign(R_({v1:v,v2:_})),E.addAssign(R_({v1:_,v2:C})),E.addAssign(R_({v1:C,v2:b})),f.assign(ti(y0e({f:E})))}),f}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"P",type:"vec3"},{name:"mInv",type:"mat3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),I_=1/6,Bz=r=>bn(I_,bn(r,bn(r,r.negate().add(3)).sub(3)).add(1)),kR=r=>bn(I_,bn(r,bn(r,bn(3,r).sub(6))).add(4)),Nz=r=>bn(I_,bn(r,bn(r,bn(-3,r).add(3)).add(3)).add(1)),FR=r=>bn(I_,b_(r,3)),Lz=r=>Bz(r).add(kR(r)),Dz=r=>Nz(r).add(FR(r)),Oz=r=>Io(-1,kR(r).div(Bz(r).add(kR(r)))),Pz=r=>Io(1,FR(r).div(Nz(r).add(FR(r)))),kz=(r,e,i)=>{const n=r.uvNode,s=bn(n,e.zw).add(.5),o=Yp(s),l=Cd(s),u=Lz(l.x),c=Dz(l.x),h=Oz(l.x),p=Pz(l.x),f=Oz(l.y),g=Pz(l.y),m=Ji(o.x.add(h),o.y.add(f)).sub(.5).mul(e.xy),y=Ji(o.x.add(p),o.y.add(f)).sub(.5).mul(e.xy),b=Ji(o.x.add(h),o.y.add(g)).sub(.5).mul(e.xy),v=Ji(o.x.add(p),o.y.add(g)).sub(.5).mul(e.xy),_=Lz(l.y).mul(Io(u.mul(r.uv(m).level(i)),c.mul(r.uv(y).level(i)))),C=Dz(l.y).mul(Io(u.mul(r.uv(b).level(i)),c.mul(r.uv(v).level(i))));return _.add(C)},v0e=Hi(([r,e=ri(3)])=>{const i=Ji(r.size(Ps(e))),n=Ji(r.size(Ps(e.add(1)))),s=wd(1,i),o=wd(1,n),l=kz(r,Jr(s,i),Yp(e)),u=kz(r,Jr(o,n),vR(e));return Cd(e).mix(l,u)}),Fz=Hi(([r,e,i,n,s])=>{const o=ti(U8(e.negate(),wy(r),wd(1,n))),l=ti(Td(s[0].xyz),Td(s[1].xyz),Td(s[2].xyz));return wy(o).mul(i.mul(l))}).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),b0e=Hi(([r,e])=>r.mul(oh(e.mul(2).sub(2),0,1))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),x0e=dz(),_0e=dz(),Uz=Hi(([r,e,i],{material:n})=>{const s=(n.side==yc?x0e:_0e).uv(r),o=ah(LR.x).mul(b0e(e,i));return v0e(s,o)}),zz=Hi(([r,e,i])=>(Va(i.notEqual(0),()=>{const n=B8(e).negate().div(i);return I8(n.negate().mul(r))}),ti(1))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),E0e=Hi(([r,e,i,n,s,o,l,u,c,h,p,f,g,m,y])=>{let b,v;if(y){b=Jr().toVar(),v=ti().toVar();const R=p.sub(1).mul(y.mul(.025)),B=ti(p.sub(R),p,p.add(R));Jc({start:0,end:3},({i:I})=>{const D=B.element(I),L=Fz(r,e,f,D,u),O=l.add(L),F=h.mul(c.mul(Jr(O,1))),q=Ji(F.xy.div(F.w)).toVar();q.addAssign(1),q.divAssign(2),q.assign(Ji(q.x,q.y.oneMinus()));const H=Uz(q,i,D);b.element(I).assign(H.element(I)),b.a.addAssign(H.a),v.element(I).assign(n.element(I).mul(zz(Td(L),g,m).element(I)))}),b.a.divAssign(3)}else{const R=Fz(r,e,f,p,u),B=l.add(R),I=h.mul(c.mul(Jr(B,1))),D=Ji(I.xy.div(I.w)).toVar();D.addAssign(1),D.divAssign(2),D.assign(Ji(D.x,D.y.oneMinus())),b=Uz(D,i,p),v=n.mul(zz(Td(R),g,m))}const _=v.rgb.mul(b.rgb),C=r.dot(e).clamp(),E=ti(Rz({dotNV:C,specularColor:s,specularF90:o,roughness:i})),T=v.r.add(v.g,v.b).div(3);return Jr(E.oneMinus().mul(_),b.a.oneMinus().mul(T).oneMinus())}),w0e=Ro(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),C0e=r=>{const e=r.sqrt();return ti(1).add(e).div(ti(1).sub(e))},jz=(r,e)=>r.sub(e).div(r.add(e)).pow2(),S0e=(r,e)=>{const i=r.mul(2*Math.PI*1e-9),n=ti(54856e-17,44201e-17,52481e-17),s=ti(1681e3,1795300,2208400),o=ti(43278e5,93046e5,66121e5),l=ri(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(i.mul(2239900).add(e.x).cos()).mul(i.pow2().mul(-45282e5).exp());let u=n.mul(o.mul(2*Math.PI).sqrt()).mul(s.mul(i).add(e).cos()).mul(i.pow2().negate().mul(o).exp());return u=ti(u.x.add(l),u.y,u.z).div(10685e-11),w0e.mul(u)},T0e=Hi(({outsideIOR:r,eta2:e,cosTheta1:i,thinFilmThickness:n,baseF0:s})=>{const o=As(r,e,Jp(0,.03,n)),l=r.div(o).pow2().mul(i.pow2().oneMinus()).oneMinus();Va(l.lessThan(0),()=>ti(1));const u=l.sqrt(),c=jz(o,r),h=jy({f0:c,f90:1,dotVH:i}),p=h.oneMinus(),f=o.lessThan(r).select(Math.PI,0),g=ri(Math.PI).sub(f),m=C0e(s.clamp(0,.9999)),y=jz(m,o.toVec3()),b=jy({f0:y,f90:1,dotVH:u}),v=ti(m.x.lessThan(o).select(Math.PI,0),m.y.lessThan(o).select(Math.PI,0),m.z.lessThan(o).select(Math.PI,0)),_=o.mul(n,u,2),C=ti(g).add(v),E=h.mul(b).clamp(1e-5,.9999),T=E.sqrt(),R=p.pow2().mul(b).div(ti(1).sub(E)),B=h.add(R).toVar(),I=R.sub(p).toVar();return Jc({start:1,end:2,condition:"<=",name:"m"},({m:D})=>{I.mulAssign(T);const L=S0e(ri(D).mul(_),ri(D).mul(C)).mul(2);B.addAssign(I.mul(L))}),B.max(ti(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),M0e=Hi(({normal:r,viewDir:e,roughness:i})=>{const n=r.dot(e).saturate(),s=i.pow2(),o=Yo(i.lessThan(.25),ri(-339.2).mul(s).add(ri(161.4).mul(i)).sub(25.9),ri(-8.48).mul(s).add(ri(14.3).mul(i)).sub(9.95)),l=Yo(i.lessThan(.25),ri(44).mul(s).sub(ri(23.7).mul(i)).add(3.26),ri(1.97).mul(s).sub(ri(3.27).mul(i)).add(.72));return Yo(i.lessThan(.25),0,ri(.1).mul(i).sub(.025)).add(o.mul(n).add(l).exp()).mul(1/Math.PI).saturate()}),UR=ti(.04),zR=ri(1);class Gz extends M_{constructor(e=!1,i=!1,n=!1,s=!1,o=!1,l=!1){super(),this.clearcoat=e,this.sheen=i,this.iridescence=n,this.anisotropy=s,this.transmission=o,this.dispersion=l,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null}start(e){if(this.clearcoat===!0&&(this.clearcoatRadiance=ti().toVar("clearcoatRadiance"),this.clearcoatSpecularDirect=ti().toVar("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=ti().toVar("clearcoatSpecularIndirect")),this.sheen===!0&&(this.sheenSpecularDirect=ti().toVar("sheenSpecularDirect"),this.sheenSpecularIndirect=ti().toVar("sheenSpecularIndirect")),this.iridescence===!0){const i=sa.dot(Is).clamp();this.iridescenceFresnel=T0e({outsideIOR:ri(1),eta2:x8,cosTheta1:i,thinFilmThickness:_8,baseF0:xl}),this.iridescenceF0=p0e({f:this.iridescenceFresnel,f90:1,dotVH:i})}if(this.transmission===!0){const i=wR,n=gme.sub(wR).normalize(),s=CR;e.backdrop=E0e(s,n,sh,qn,xl,y_,i,ef,uh,w_,v_,w8,S8,C8,this.dispersion?T8:null),e.backdropAlpha=AR,qn.a.mulAssign(As(1,e.backdrop.a,AR))}}computeMultiscattering(e,i,n){const s=sa.dot(Is).clamp(),o=Mz({roughness:sh,dotNV:s}),l=(this.iridescenceF0?pR.mix(xl,this.iridescenceF0):xl).mul(o.x).add(n.mul(o.y)),u=o.x.add(o.y).oneMinus(),c=xl.add(xl.oneMinus().mul(.047619)),h=l.mul(c).div(u.mul(c).oneMinus());e.addAssign(l),i.addAssign(h.mul(u))}direct({lightDirection:e,lightColor:i,reflectedLight:n}){const s=sa.dot(e).clamp().mul(i);if(this.sheen===!0&&this.sheenSpecularDirect.addAssign(s.mul(g0e({lightDirection:e}))),this.clearcoat===!0){const o=Iy.dot(e).clamp().mul(i);this.clearcoatSpecularDirect.addAssign(o.mul(Tz({lightDirection:e,f0:UR,f90:zR,roughness:g_,normalView:Iy})))}n.directDiffuse.addAssign(s.mul(jg({diffuseColor:qn.rgb}))),n.directSpecular.addAssign(s.mul(Tz({lightDirection:e,f0:xl,f90:1,roughness:sh,iridescence:this.iridescence,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}directRectArea({lightColor:e,lightPosition:i,halfWidth:n,halfHeight:s,reflectedLight:o,ltc_1:l,ltc_2:u}){const c=i.add(n).sub(s),h=i.sub(n).sub(s),p=i.sub(n).add(s),f=i.add(n).add(s),g=sa,m=Is,y=Wa.toVar(),b=A0e({N:g,V:m,roughness:sh}),v=l.uv(b).toVar(),_=u.uv(b).toVar(),C=Ro(ti(v.x,0,v.y),ti(0,1,0),ti(v.z,0,v.w)).toVar(),E=xl.mul(_.x).add(xl.oneMinus().mul(_.y)).toVar();o.directSpecular.addAssign(e.mul(E).mul(Iz({N:g,V:m,P:y,mInv:C,p0:c,p1:h,p2:p,p3:f}))),o.directDiffuse.addAssign(e.mul(qn).mul(Iz({N:g,V:m,P:y,mInv:Ro(1,0,0,0,1,0,0,0,1),p0:c,p1:h,p2:p,p3:f})))}indirect(e,i,n){this.indirectDiffuse(e,i,n),this.indirectSpecular(e,i,n),this.ambientOcclusion(e,i,n)}indirectDiffuse({irradiance:e,reflectedLight:i}){i.indirectDiffuse.addAssign(e.mul(jg({diffuseColor:qn})))}indirectSpecular({radiance:e,iblIrradiance:i,reflectedLight:n}){if(this.sheen===!0&&this.sheenSpecularIndirect.addAssign(i.mul(kg,M0e({normal:sa,viewDir:Is,roughness:dR}))),this.clearcoat===!0){const h=Iy.dot(Is).clamp(),p=Rz({dotNV:h,specularColor:UR,specularF90:zR,roughness:g_});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(p))}const s=ti().toVar("singleScattering"),o=ti().toVar("multiScattering"),l=i.mul(1/Math.PI);this.computeMultiscattering(s,o,y_);const u=s.add(o),c=qn.mul(u.r.max(u.g).max(u.b).oneMinus());n.indirectSpecular.addAssign(e.mul(s)),n.indirectSpecular.addAssign(o.mul(l)),n.indirectDiffuse.addAssign(c.mul(l))}ambientOcclusion({ambientOcclusion:e,reflectedLight:i}){const n=sa.dot(Is).clamp().add(e),s=sh.mul(-16).oneMinus().negate().exp2(),o=e.sub(n.pow(s).oneMinus()).clamp();this.clearcoat===!0&&this.clearcoatSpecularIndirect.mulAssign(e),this.sheen===!0&&this.sheenSpecularIndirect.mulAssign(e),i.indirectDiffuse.mulAssign(e),i.indirectSpecular.mulAssign(o)}finish(e){const{outgoingLight:i}=e;if(this.clearcoat===!0){const n=Iy.dot(Is).clamp(),s=jy({dotVH:n,f0:UR,f90:zR}),o=i.mul(hR.mul(s).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(hR));i.assign(o)}if(this.sheen===!0){const n=kg.r.max(kg.g).max(kg.b).mul(.157).oneMinus(),s=i.mul(n).add(this.sheenSpecularDirect,this.sheenSpecularIndirect);i.assign(s)}}}const Vz=ri(1),jR=ri(-2),B_=ri(.8),GR=ri(-1),N_=ri(.4),VR=ri(2),L_=ri(.305),HR=ri(3),Hz=ri(.21),R0e=ri(4),Wz=ri(4),I0e=ri(16),B0e=Hi(([r])=>{const e=ti(Sc(r)).toVar(),i=ri(-1).toVar();return Va(e.x.greaterThan(e.z),()=>{Va(e.x.greaterThan(e.y),()=>{i.assign(Yo(r.x.greaterThan(0),0,3))}).Else(()=>{i.assign(Yo(r.y.greaterThan(0),1,4))})}).Else(()=>{Va(e.z.greaterThan(e.y),()=>{i.assign(Yo(r.z.greaterThan(0),2,5))}).Else(()=>{i.assign(Yo(r.y.greaterThan(0),1,4))})}),i}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),N0e=Hi(([r,e])=>{const i=Ji().toVar();return Va(e.equal(0),()=>{i.assign(Ji(r.z,r.y).div(Sc(r.x)))}).ElseIf(e.equal(1),()=>{i.assign(Ji(r.x.negate(),r.z.negate()).div(Sc(r.y)))}).ElseIf(e.equal(2),()=>{i.assign(Ji(r.x.negate(),r.y).div(Sc(r.z)))}).ElseIf(e.equal(3),()=>{i.assign(Ji(r.z.negate(),r.y).div(Sc(r.x)))}).ElseIf(e.equal(4),()=>{i.assign(Ji(r.x.negate(),r.z).div(Sc(r.y)))}).Else(()=>{i.assign(Ji(r.x,r.y).div(Sc(r.z)))}),bn(.5,i.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),L0e=Hi(([r])=>{const e=ri(0).toVar();return Va(r.greaterThanEqual(B_),()=>{e.assign(Vz.sub(r).mul(GR.sub(jR)).div(Vz.sub(B_)).add(jR))}).ElseIf(r.greaterThanEqual(N_),()=>{e.assign(B_.sub(r).mul(VR.sub(GR)).div(B_.sub(N_)).add(GR))}).ElseIf(r.greaterThanEqual(L_),()=>{e.assign(N_.sub(r).mul(HR.sub(VR)).div(N_.sub(L_)).add(VR))}).ElseIf(r.greaterThanEqual(Hz),()=>{e.assign(L_.sub(r).mul(R0e.sub(HR)).div(L_.sub(Hz)).add(HR))}).Else(()=>{e.assign(ri(-2).mul(ah(bn(1.16,r))))}),e}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),D0e=Hi(([r,e])=>{const i=r.toVar();i.assign(bn(2,i).sub(1));const n=ti(i,1).toVar();return Va(e.equal(0),()=>{n.assign(n.zyx)}).ElseIf(e.equal(1),()=>{n.assign(n.xzy),n.xz.mulAssign(-1)}).ElseIf(e.equal(2),()=>{n.x.mulAssign(-1)}).ElseIf(e.equal(3),()=>{n.assign(n.zyx),n.xz.mulAssign(-1)}).ElseIf(e.equal(4),()=>{n.assign(n.xzy),n.xy.mulAssign(-1)}).ElseIf(e.equal(5),()=>{n.z.mulAssign(-1)}),n}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),O0e=Hi(([r,e,i,n,s,o])=>{const l=ri(i),u=ti(e),c=oh(L0e(l),jR,o),h=Cd(c),p=Yp(c),f=ti(WR(r,u,p,n,s,o)).toVar();return Va(h.notEqual(0),()=>{const g=ti(WR(r,u,p.add(1),n,s,o)).toVar();f.assign(As(f,g,h))}),f}),WR=Hi(([r,e,i,n,s,o])=>{const l=ri(i).toVar(),u=ti(e),c=ri(B0e(u)).toVar(),h=ri(zl(Wz.sub(l),0)).toVar();l.assign(zl(l,Wz));const p=ri(Ey(l)).toVar(),f=Ji(N0e(u,c).mul(p.sub(2)).add(1)).toVar();return Va(c.greaterThan(2),()=>{f.y.addAssign(p),c.subAssign(3)}),f.x.addAssign(c.mul(p)),f.x.addAssign(h.mul(bn(3,I0e))),f.y.addAssign(bn(4,Ey(o).sub(p))),f.x.mulAssign(n),f.y.mulAssign(s),r.uv(f).grad(Ji(),Ji())}),QR=Hi(({envMap:r,mipInt:e,outputDirection:i,theta:n,axis:s,CUBEUV_TEXEL_WIDTH:o,CUBEUV_TEXEL_HEIGHT:l,CUBEUV_MAX_MIP:u})=>{const c=Sd(n),h=i.mul(c).add(s.cross(i).mul(Cc(n))).add(s.mul(s.dot(i).mul(c.oneMinus())));return WR(r,h,e,o,l,u)}),P0e=Hi(({n:r,latitudinal:e,poleAxis:i,outputDirection:n,weights:s,samples:o,dTheta:l,mipInt:u,envMap:c,CUBEUV_TEXEL_WIDTH:h,CUBEUV_TEXEL_HEIGHT:p,CUBEUV_MAX_MIP:f})=>{const g=ti(Yo(e,i,k8(i,n))).toVar();Va(R8(g.equals(ti(0))),()=>{g.assign(ti(n.z,0,n.x.negate()))}),g.assign(wy(g));const m=ti().toVar();return m.addAssign(s.element(Ps(0)).mul(QR({theta:0,axis:g,outputDirection:n,mipInt:u,envMap:c,CUBEUV_TEXEL_WIDTH:h,CUBEUV_TEXEL_HEIGHT:p,CUBEUV_MAX_MIP:f}))),Jc({start:Ps(1),end:r},({i:y})=>{Va(y.greaterThanEqual(o),()=>{Sge()});const b=ri(l.mul(ri(y))).toVar();m.addAssign(s.element(y).mul(QR({theta:b.mul(-1),axis:g,outputDirection:n,mipInt:u,envMap:c,CUBEUV_TEXEL_WIDTH:h,CUBEUV_TEXEL_HEIGHT:p,CUBEUV_MAX_MIP:f}))),m.addAssign(s.element(y).mul(QR({theta:b,axis:g,outputDirection:n,mipInt:u,envMap:c,CUBEUV_TEXEL_WIDTH:h,CUBEUV_TEXEL_HEIGHT:p,CUBEUV_MAX_MIP:f})))}),Jr(m,1)});let D_=null;const Qz=new WeakMap;function k0e(r){const e=Math.log2(r)-2,i=1/r;return{texelWidth:1/(3*Math.max(Math.pow(2,e),7*16)),texelHeight:i,maxMip:e}}function F0e(r){let e=Qz.get(r);if((e!==void 0?e.pmremVersion:-1)!==r.pmremVersion){const i=r.image;if(r.isCubeTexture)if(z0e(i))e=D_.fromCubemap(r,e);else return null;else if(j0e(i))e=D_.fromEquirectangular(r,e);else return null;e.pmremVersion=r.pmremVersion,Qz.set(r,e)}return e.texture}class U0e extends ra{static get type(){return"PMREMNode"}constructor(e,i=null,n=null){super("vec3"),this._value=e,this._pmrem=null,this.uvNode=i,this.levelNode=n,this._generator=null;const s=new To;s.isRenderTargetTexture=!0,this._texture=ks(s),this._width=Zr(0),this._height=Zr(0),this._maxMip=Zr(0),this.updateBeforeType=hn.RENDER}set value(e){this._value=e,this._pmrem=null}get value(){return this._value}updateFromTexture(e){const i=k0e(e.image.height);this._texture.value=e,this._width.value=i.texelWidth,this._height.value=i.texelHeight,this._maxMip.value=i.maxMip}updateBefore(){let e=this._pmrem;const i=e?e.pmremVersion:-1,n=this._value;i!==n.pmremVersion&&(n.isPMREMTexture===!0?e=n:e=F0e(n),e!==null&&(this._pmrem=e,this.updateFromTexture(e)))}setup(e){D_===null&&(D_=e.createPMREMGenerator()),this.updateBefore(e);let i=this.uvNode;i===null&&e.context.getUV&&(i=e.context.getUV(this));const n=this.value;e.renderer.coordinateSystem===vc&&n.isPMREMTexture!==!0&&n.isRenderTargetTexture===!0&&(i=ti(i.x.negate(),i.yz));let s=this.levelNode;return s===null&&e.context.getTextureLevel&&(s=e.context.getTextureLevel(this)),O0e(this._texture,i,s,this._width,this._height,this._maxMip)}}function z0e(r){if(r==null)return!1;let e=0;const i=6;for(let n=0;n<i;n++)r[n]!==void 0&&e++;return e===i}function j0e(r){return r==null?!1:r.height>0}const qz=ui(U0e),Xz=new WeakMap;class G0e extends zg{static get type(){return"EnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){const{material:i}=e;let n=this.envNode;if(n.isTextureNode||n.isMaterialReferenceNode){const f=n.isTextureNode?n.value:i[n.property];let g=Xz.get(f);g===void 0&&(g=qz(f),Xz.set(f,g)),n=g}const s=i.envMap?Bs("envMapIntensity","float",e.material):Bs("environmentIntensity","float",e.scene),o=i.useAnisotropy===!0||i.anisotropy>0?Dme:sa,l=n.context(Kz(sh,o)).mul(s),u=n.context(V0e(CR)).mul(Math.PI).mul(s),c=__(l),h=__(u);e.context.radiance.addAssign(c),e.context.iblIrradiance.addAssign(h);const p=e.context.lightingModel.clearcoatRadiance;if(p){const f=n.context(Kz(g_,Iy)).mul(s),g=__(f);p.addAssign(g)}}}const Kz=(r,e)=>{let i=null;return{getUV:()=>(i===null&&(i=Is.negate().reflect(e),i=r.mul(r).mix(i,e).normalize(),i=i.transformDirection(uh)),i),getTextureLevel:()=>r}},V0e=r=>({getUV:()=>r,getTextureLevel:()=>ri(1)}),H0e=new $3;class Yz extends oa{static get type(){return"MeshStandardNodeMaterial"}constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.lights=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(H0e),this.setValues(e)}setupEnvironment(e){let i=super.setupEnvironment(e);return i===null&&e.environmentNode&&(i=e.environmentNode),i?new G0e(i):null}setupLightingModel(){return new Gz}setupSpecular(){const e=As(ti(.04),qn.rgb,m_);xl.assign(e),y_.assign(1)}setupVariants(){const e=this.metalnessNode?ri(this.metalnessNode):Xme;m_.assign(e);let i=this.roughnessNode?ri(this.roughnessNode):qme;i=Sz({roughness:i}),sh.assign(i),this.setupSpecular(),qn.assign(Jr(qn.rgb.mul(e.oneMinus()),qn.a))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}}const W0e=new H6;class Q0e extends Yz{static get type(){return"MeshPhysicalNodeMaterial"}constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(W0e),this.setValues(e)}get useClearcoat(){return this.clearcoat>0||this.clearcoatNode!==null}get useIridescence(){return this.iridescence>0||this.iridescenceNode!==null}get useSheen(){return this.sheen>0||this.sheenNode!==null}get useAnisotropy(){return this.anisotropy>0||this.anisotropyNode!==null}get useTransmission(){return this.transmission>0||this.transmissionNode!==null}get useDispersion(){return this.dispersion>0||this.dispersionNode!==null}setupSpecular(){const e=this.iorNode?ri(this.iorNode):lge;v_.assign(e),xl.assign(As(Cy(F8(v_.sub(1).div(v_.add(1))).mul(Qme),ti(1)).mul(az),qn.rgb,m_)),y_.assign(As(az,1,m_))}setupLightingModel(){return new Gz(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(e){if(super.setupVariants(e),this.useClearcoat){const i=this.clearcoatNode?ri(this.clearcoatNode):Yme,n=this.clearcoatRoughnessNode?ri(this.clearcoatRoughnessNode):Jme;hR.assign(i),g_.assign(Sz({roughness:n}))}if(this.useSheen){const i=this.sheenNode?ti(this.sheenNode):ege,n=this.sheenRoughnessNode?ri(this.sheenRoughnessNode):tge;kg.assign(i),dR.assign(n)}if(this.useIridescence){const i=this.iridescenceNode?ri(this.iridescenceNode):rge,n=this.iridescenceIORNode?ri(this.iridescenceIORNode):nge,s=this.iridescenceThicknessNode?ri(this.iridescenceThicknessNode):sge;pR.assign(i),x8.assign(n),_8.assign(s)}if(this.useAnisotropy){const i=(this.anisotropyNode?Ji(this.anisotropyNode):ige).toVar();Kp.assign(i.length()),Va(Kp.equal(0),()=>{i.assign(Ji(1,0))}).Else(()=>{i.divAssign(Ji(Kp)),Kp.assign(Kp.saturate())}),fR.assign(Kp.pow2().mix(sh.pow2(),1)),A_.assign(Ly[0].mul(i.x).add(Ly[1].mul(i.y))),Fg.assign(Ly[1].mul(i.x).sub(Ly[0].mul(i.y)))}if(this.useTransmission){const i=this.transmissionNode?ri(this.transmissionNode):age,n=this.thicknessNode?ri(this.thicknessNode):oge,s=this.attenuationDistanceNode?ri(this.attenuationDistanceNode):cge,o=this.attenuationColorNode?ti(this.attenuationColorNode):uge;if(AR.assign(i),w8.assign(n),C8.assign(s),S8.assign(o),this.useDispersion){const l=this.dispersionNode?ri(this.dispersionNode):fge;T8.assign(l)}}}setupClearcoatNormal(){return this.clearcoatNormalNode?ti(this.clearcoatNormalNode):Zme}setup(e){e.context.setupClearcoatNormal=()=>this.setupClearcoatNormal(e),super.setup(e)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,this.dispersionNode=e.dispersionNode,this.anisotropyNode=e.anisotropyNode,super.copy(e)}}const q0e=Hi(({normal:r,lightDirection:e,builder:i})=>{const n=r.dot(e),s=Ji(n.mul(.5).add(.5),0);if(i.material.gradientMap){const o=Md("gradientMap","texture").context({getUV:()=>s});return ti(o.r)}else{const o=s.fwidth().mul(.5);return As(ti(.7),ti(1),Jp(ri(.7).sub(o.x),ri(.7).add(o.x),s.x))}});class X0e extends M_{direct({lightDirection:e,lightColor:i,reflectedLight:n},s,o){const l=q0e({normal:Y8,lightDirection:e,builder:o}).mul(i);n.directDiffuse.addAssign(l.mul(jg({diffuseColor:qn.rgb})))}indirect({ambientOcclusion:e,irradiance:i,reflectedLight:n}){n.indirectDiffuse.addAssign(i.mul(jg({diffuseColor:qn}))),n.indirectDiffuse.mulAssign(e)}}const K0e=new Q6;class Y0e extends oa{static get type(){return"MeshToonNodeMaterial"}constructor(e){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues(K0e),this.setValues(e)}setupLightingModel(){return new X0e}}class J0e extends ra{static get type(){return"MatcapUVNode"}constructor(){super("vec2")}setup(){const e=ti(Is.z,0,Is.x.negate()).normalize(),i=Is.cross(e);return Ji(e.dot(sa),i.dot(sa)).mul(.495).add(.5)}}const Z0e=Yi(J0e),$0e=new K6;class eAe extends oa{static get type(){return"MeshMatcapNodeMaterial"}constructor(e){super(),this.lights=!1,this.isMeshMatcapNodeMaterial=!0,this.setDefaultValues($0e),this.setValues(e)}setupVariants(e){const i=Z0e;let n;e.material.matcap?n=Md("matcap","texture").context({getUV:()=>i}):n=ti(As(.2,.8,i.y)),qn.rgb.mulAssign(n.rgb)}}const tAe=new G6;class iAe extends oa{static get type(){return"PointsNodeMaterial"}constructor(e){super(),this.isPointsNodeMaterial=!0,this.lights=!1,this.transparent=!0,this.sizeNode=null,this.setDefaultValues(tAe),this.setValues(e)}copy(e){return this.sizeNode=e.sizeNode,super.copy(e)}}class rAe extends ra{static get type(){return"RotateNode"}constructor(e,i){super(),this.positionNode=e,this.rotationNode=i}getNodeType(e){return this.positionNode.getNodeType(e)}setup(e){const{rotationNode:i,positionNode:n}=this;if(this.getNodeType(e)==="vec2"){const s=i.cos(),o=i.sin();return uR(s,o,o.negate(),s).mul(n)}else{const s=i,o=Og(Jr(1,0,0,0),Jr(0,Sd(s.x),Cc(s.x).negate(),0),Jr(0,Cc(s.x),Sd(s.x),0),Jr(0,0,0,1)),l=Og(Jr(Sd(s.y),0,Cc(s.y),0),Jr(0,1,0,0),Jr(Cc(s.y).negate(),0,Sd(s.y),0),Jr(0,0,0,1)),u=Og(Jr(Sd(s.z),Cc(s.z).negate(),0,0),Jr(Cc(s.z),Sd(s.z),0,0),Jr(0,0,1,0),Jr(0,0,0,1));return o.mul(l).mul(u).mul(Jr(n,1)).xyz}}}const nAe=ui(rAe),sAe=new z6;class aAe extends oa{static get type(){return"SpriteNodeMaterial"}constructor(e){super(),this.isSpriteNodeMaterial=!0,this.lights=!1,this._useSizeAttenuation=!0,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.setDefaultValues(sAe),this.setValues(e)}setupPosition({object:e,camera:i,context:n}){const s=this.sizeAttenuation,{positionNode:o,rotationNode:l,scaleNode:u}=this,c=Ha;let h=C_.mul(ti(o||0)),p=Ji(ef[0].xyz.length(),ef[1].xyz.length());if(u!==null&&(p=p.mul(u)),!s)if(i.isPerspectiveCamera)p=p.mul(h.z.negate());else{const b=ri(2).div(w_.element(1).element(1));p=p.mul(b.mul(2))}let f=c.xy;if(e.center&&e.center.isVector2===!0){const b=Jfe("center","vec2");f=f.sub(b.sub(.5))}f=f.mul(p);const g=ri(l||$me),m=nAe(f,g);h=Jr(h.xy.add(m),h.zw);const y=w_.mul(h);return n.vertex=c,y}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}get sizeAttenuation(){return this._useSizeAttenuation}set sizeAttenuation(e){this._useSizeAttenuation!==e&&(this._useSizeAttenuation=e,this.needsUpdate=!0)}}class oAe extends M_{constructor(){super(),this.shadowNode=ri(1).toVar("shadowMask")}direct({shadowMask:e}){this.shadowNode.mulAssign(e)}finish(e){qn.a.mulAssign(this.shadowNode.oneMinus()),e.outgoingLight.rgb.assign(qn.rgb)}}const lAe=new V6;class cAe extends oa{static get type(){return"ShadowNodeMaterial"}constructor(e){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.setDefaultValues(lAe),this.setValues(e)}setupLightingModel(){return new oAe}}Hi(({texture:r,uv:e})=>{const i=ti().toVar();return Va(e.x.lessThan(1e-4),()=>{i.assign(ti(1,0,0))}).ElseIf(e.y.lessThan(1e-4),()=>{i.assign(ti(0,1,0))}).ElseIf(e.z.lessThan(1e-4),()=>{i.assign(ti(0,0,1))}).ElseIf(e.x.greaterThan(1-1e-4),()=>{i.assign(ti(-1,0,0))}).ElseIf(e.y.greaterThan(1-1e-4),()=>{i.assign(ti(0,-1,0))}).ElseIf(e.z.greaterThan(1-1e-4),()=>{i.assign(ti(0,0,-1))}).Else(()=>{const n=r.uv(e.add(ti(-.01,0,0))).r.sub(r.uv(e.add(ti(.01,0,0))).r),s=r.uv(e.add(ti(0,-.01,0))).r.sub(r.uv(e.add(ti(0,.01,0))).r),o=r.uv(e.add(ti(0,0,-.01))).r.sub(r.uv(e.add(ti(0,0,.01))).r);i.assign(ti(n,s,o))}),i.normalize()});class uAe{constructor(e,i){this.nodes=e,this.info=i,this.animationLoop=null,this.requestId=null,this._init()}_init(){const e=(i,n)=>{this.requestId=self.requestAnimationFrame(e),this.info.autoReset===!0&&this.info.reset(),this.nodes.nodeFrame.update(),this.info.frame=this.nodes.nodeFrame.frameId,this.animationLoop!==null&&this.animationLoop(i,n)};e()}dispose(){self.cancelAnimationFrame(this.requestId),this.requestId=null}setAnimationLoop(e){this.animationLoop=e}}class Zc{constructor(){this.weakMap=new WeakMap}get(e){let i=this.weakMap;for(let n=0;n<e.length;n++)if(i=i.get(e[n]),i===void 0)return;return i.get(e[e.length-1])}set(e,i){let n=this.weakMap;for(let s=0;s<e.length;s++){const o=e[s];n.has(o)===!1&&n.set(o,new WeakMap),n=n.get(o)}return n.set(e[e.length-1],i)}delete(e){let i=this.weakMap;for(let n=0;n<e.length;n++)if(i=i.get(e[n]),i===void 0)return!1;return i.delete(e[e.length-1])}}const qR=new Ed;class XR{constructor(){this.version=0,this.globalClippingCount=0,this.localClippingCount=0,this.localClippingEnabled=!1,this.localClipIntersection=!1,this.planes=[],this.parentVersion=0,this.viewNormalMatrix=new Xo,this.cacheKey=0}projectPlanes(e,i){const n=e.length,s=this.planes;for(let o=0;o<n;o++){qR.copy(e[o]).applyMatrix4(this.viewMatrix,this.viewNormalMatrix);const l=s[i+o],u=qR.normal;l.x=-u.x,l.y=-u.y,l.z=-u.z,l.w=qR.constant}}updateGlobal(e,i){const n=e.clippingPlanes;this.viewMatrix=i.matrixWorldInverse,this.viewNormalMatrix.getNormalMatrix(this.viewMatrix);let s=!1;if(Array.isArray(n)&&n.length!==0){const o=n.length;if(o!==this.globalClippingCount){const l=[];for(let u=0;u<o;u++)l.push(new Zn);this.globalClippingCount=o,this.planes=l,s=!0}this.projectPlanes(n,0)}else this.globalClippingCount!==0&&(this.globalClippingCount=0,this.planes=[],s=!0);e.localClippingEnabled!==this.localClippingEnabled&&(this.localClippingEnabled=e.localClippingEnabled,s=!0),s&&(this.version++,this.cacheKey=a_(this.globalClippingCount,this.localClippingEnabled===!0?1:0))}update(e,i){let n=!1;if(this!==e&&e.version!==this.parentVersion&&(this.globalClippingCount=i.isShadowNodeMaterial?0:e.globalClippingCount,this.localClippingEnabled=e.localClippingEnabled,this.planes=Array.from(e.planes),this.parentVersion=e.version,this.viewMatrix=e.viewMatrix,this.viewNormalMatrix=e.viewNormalMatrix,n=!0),this.localClippingEnabled){const s=i.clippingPlanes;if(Array.isArray(s)&&s.length!==0){const o=s.length,l=this.planes,u=this.globalClippingCount;if(n||o!==this.localClippingCount){l.length=u+o;for(let c=0;c<o;c++)l[u+c]=new Zn;this.localClippingCount=o,n=!0}this.projectPlanes(s,u)}else this.localClippingCount!==0&&(this.localClippingCount=0,n=!0);this.localClipIntersection!==i.clipIntersection&&(this.localClipIntersection=i.clipIntersection,n=!0)}n&&(this.version+=e.version,this.cacheKey=a_(e.cacheKey,this.localClippingCount,this.localClipIntersection===!0?1:0))}}let hAe=0;function dAe(r){const e=Object.keys(r);let i=Object.getPrototypeOf(r);for(;i;){const n=Object.getOwnPropertyDescriptors(i);for(const s in n)if(n[s]!==void 0){const o=n[s];o&&typeof o.get=="function"&&e.push(s)}i=Object.getPrototypeOf(i)}return e}class pAe{constructor(e,i,n,s,o,l,u,c,h){this._nodes=e,this._geometries=i,this.id=hAe++,this.renderer=n,this.object=s,this.material=o,this.scene=l,this.camera=u,this.lightsNode=c,this.context=h,this.geometry=s.geometry,this.version=o.version,this.drawRange=null,this.attributes=null,this.pipeline=null,this.vertexBuffers=null,this.drawParams=null,this.bundle=null,this.updateClipping(h.clippingContext),this.clippingContextVersion=this.clippingContext.version,this.initialNodesCacheKey=this.getDynamicCacheKey(),this.initialCacheKey=this.getCacheKey(),this._nodeBuilderState=null,this._bindings=null,this._monitor=null,this.onDispose=null,this.isRenderObject=!0,this.onMaterialDispose=()=>{this.dispose()},this.material.addEventListener("dispose",this.onMaterialDispose)}updateClipping(e){const i=this.material;let n=this.clippingContext;Array.isArray(i.clippingPlanes)?((n===e||!n)&&(n=new XR,this.clippingContext=n),n.update(e,i)):this.clippingContext!==e&&(this.clippingContext=e)}get clippingNeedsUpdate(){return this.clippingContext.version===this.clippingContextVersion?!1:(this.clippingContextVersion=this.clippingContext.version,!0)}getNodeBuilderState(){return this._nodeBuilderState||(this._nodeBuilderState=this._nodes.getForRender(this))}getMonitor(){return this._monitor||(this._monitor=this.getNodeBuilderState().monitor)}getBindings(){return this._bindings||(this._bindings=this.getNodeBuilderState().createBindings())}getIndex(){return this._geometries.getIndex(this)}getIndirect(){return this._geometries.getIndirect(this)}getChainArray(){return[this.object,this.material,this.context,this.lightsNode]}getAttributes(){if(this.attributes!==null)return this.attributes;const e=this.getNodeBuilderState().nodeAttributes,i=this.geometry,n=[],s=new Set;for(const o of e){const l=o.node&&o.node.attribute?o.node.attribute:i.getAttribute(o.name);if(l===void 0)continue;n.push(l);const u=l.isInterleavedBufferAttribute?l.data:l;s.add(u)}return this.attributes=n,this.vertexBuffers=Array.from(s.values()),n}getVertexBuffers(){return this.vertexBuffers===null&&this.getAttributes(),this.vertexBuffers}getDrawParameters(){const{object:e,material:i,geometry:n,group:s,drawRange:o}=this,l=this.drawParams||(this.drawParams={vertexCount:0,firstVertex:0,instanceCount:0,firstInstance:0}),u=this.getIndex(),c=u!==null,h=n.isInstancedBufferGeometry?n.instanceCount:e.count>1?e.count:1;if(h===0)return null;if(l.instanceCount=h,e.isBatchedMesh===!0)return l;let p=1;i.wireframe===!0&&!e.isPoints&&!e.isLineSegments&&!e.isLine&&!e.isLineLoop&&(p=2);let f=o.start*p,g=(o.start+o.count)*p;s!==null&&(f=Math.max(f,s.start*p),g=Math.min(g,(s.start+s.count)*p));const m=n.attributes.position;let y=1/0;c?y=u.count:m!=null&&(y=m.count),f=Math.max(f,0),g=Math.min(g,y);const b=g-f;return b<0||b===1/0?null:(l.vertexCount=b,l.firstVertex=f,l)}getGeometryCacheKey(){const{geometry:e}=this;let i="";for(const n of Object.keys(e.attributes).sort()){const s=e.attributes[n];i+=n+",",s.data&&(i+=s.data.stride+","),s.offset&&(i+=s.offset+","),s.itemSize&&(i+=s.itemSize+","),s.normalized&&(i+="n,")}return e.index&&(i+="index,"),i}getMaterialCacheKey(){const{object:e,material:i}=this;let n=i.customProgramCacheKey();for(const s of dAe(i)){if(/^(is[A-Z]|_)|^(visible|version|uuid|name|opacity|userData)$/.test(s))continue;const o=i[s];let l;if(o!==null){const u=typeof o;u==="number"?l=o!==0?"1":"0":u==="object"?(l="{",o.isTexture&&(l+=o.mapping),l+="}"):l=String(o)}else l=String(o);n+=l+","}return n+=this.clippingContext.cacheKey+",",e.geometry&&(n+=this.getGeometryCacheKey()),e.skeleton&&(n+=e.skeleton.bones.length+","),e.morphTargetInfluences&&(n+=e.morphTargetInfluences.length+","),e.isBatchedMesh&&(n+=e._matricesTexture.uuid+",",e._colorsTexture!==null&&(n+=e._colorsTexture.uuid+",")),e.count>1&&(n+=e.uuid+","),ope(n)}get needsUpdate(){return this.initialNodesCacheKey!==this.getDynamicCacheKey()||this.clippingNeedsUpdate}getDynamicCacheKey(){let e=this._nodes.getCacheKey(this.scene,this.lightsNode);return this.object.receiveShadow&&(e+=1),e}getCacheKey(){return this.getMaterialCacheKey()+this.getDynamicCacheKey()}dispose(){this.material.removeEventListener("dispose",this.onMaterialDispose),this.onDispose()}}const Gg=[];class fAe{constructor(e,i,n,s,o,l){this.renderer=e,this.nodes=i,this.geometries=n,this.pipelines=s,this.bindings=o,this.info=l,this.chainMaps={}}get(e,i,n,s,o,l,u){const c=this.getChainMap(u);Gg[0]=e,Gg[1]=i,Gg[2]=l,Gg[3]=o;let h=c.get(Gg);return h===void 0?(h=this.createRenderObject(this.nodes,this.geometries,this.renderer,e,i,n,s,o,l,u),c.set(Gg,h)):(h.updateClipping(l.clippingContext),(h.version!==i.version||h.needsUpdate)&&(h.initialCacheKey!==h.getCacheKey()?(h.dispose(),h=this.get(e,i,n,s,o,l,u)):h.version=i.version)),h}getChainMap(e="default"){return this.chainMaps[e]||(this.chainMaps[e]=new Zc)}dispose(){this.chainMaps={}}createRenderObject(e,i,n,s,o,l,u,c,h,p){const f=this.getChainMap(p),g=new pAe(e,i,n,s,o,l,u,c,h);return g.onDispose=()=>{this.pipelines.delete(g),this.bindings.delete(g),this.nodes.delete(g),f.delete(g.getChainArray())},g}}class Id{constructor(){this.data=new WeakMap}get(e){let i=this.data.get(e);return i===void 0&&(i={},this.data.set(e,i)),i}delete(e){let i;return this.data.has(e)&&(i=this.data.get(e),this.data.delete(e)),i}has(e){return this.data.has(e)}dispose(){this.data=new WeakMap}}const $c={VERTEX:1,INDEX:2,STORAGE:3,INDIRECT:4},Bd=16,mAe=211,gAe=212;class AAe extends Id{constructor(e){super(),this.backend=e}delete(e){const i=super.delete(e);return i!==void 0&&this.backend.destroyAttribute(e),i}update(e,i){const n=this.get(e);if(n.version===void 0)i===$c.VERTEX?this.backend.createAttribute(e):i===$c.INDEX?this.backend.createIndexAttribute(e):i===$c.STORAGE?this.backend.createStorageAttribute(e):i===$c.INDIRECT&&this.backend.createIndirectStorageAttribute(e),n.version=this._getBufferAttribute(e).version;else{const s=this._getBufferAttribute(e);(n.version<s.version||s.usage===fg)&&(this.backend.updateAttribute(e),n.version=s.version)}}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}function yAe(r){for(let e=r.length-1;e>=0;--e)if(r[e]>=65535)return!0;return!1}function Jz(r){return r.index!==null?r.index.version:r.attributes.position.version}function Zz(r){const e=[],i=r.index,n=r.attributes.position;if(i!==null){const o=i.array;for(let l=0,u=o.length;l<u;l+=3){const c=o[l+0],h=o[l+1],p=o[l+2];e.push(c,h,h,p,p,c)}}else{const o=n.array;for(let l=0,u=o.length/3-1;l<u;l+=3){const c=l+0,h=l+1,p=l+2;e.push(c,h,h,p,p,c)}}const s=new(yAe(e)?M6:T6)(e,1);return s.version=Jz(r),s}class vAe extends Id{constructor(e,i){super(),this.attributes=e,this.info=i,this.wireframes=new WeakMap,this.attributeCall=new WeakMap}has(e){const i=e.geometry;return super.has(i)&&this.get(i).initialized===!0}updateForRender(e){this.has(e)===!1&&this.initGeometry(e),this.updateAttributes(e)}initGeometry(e){const i=e.geometry,n=this.get(i);n.initialized=!0,this.info.memory.geometries++;const s=()=>{this.info.memory.geometries--;const o=i.index,l=e.getAttributes();o!==null&&this.attributes.delete(o);for(const c of l)this.attributes.delete(c);const u=this.wireframes.get(i);u!==void 0&&this.attributes.delete(u),i.removeEventListener("dispose",s)};i.addEventListener("dispose",s)}updateAttributes(e){const i=e.getAttributes();for(const o of i)o.isStorageBufferAttribute||o.isStorageInstancedBufferAttribute?this.updateAttribute(o,$c.STORAGE):this.updateAttribute(o,$c.VERTEX);const n=this.getIndex(e);n!==null&&this.updateAttribute(n,$c.INDEX);const s=e.geometry.indirect;s!==null&&this.updateAttribute(s,$c.INDIRECT)}updateAttribute(e,i){const n=this.info.render.calls;e.isInterleavedBufferAttribute?this.attributeCall.get(e)===void 0?(this.attributes.update(e,i),this.attributeCall.set(e,n)):this.attributeCall.get(e.data)!==n&&(this.attributes.update(e,i),this.attributeCall.set(e.data,n),this.attributeCall.set(e,n)):this.attributeCall.get(e)!==n&&(this.attributes.update(e,i),this.attributeCall.set(e,n))}getIndirect(e){return e.geometry.indirect}getIndex(e){const{geometry:i,material:n}=e;let s=i.index;if(n.wireframe===!0){const o=this.wireframes;let l=o.get(i);l===void 0?(l=Zz(i),o.set(i,l)):l.version!==Jz(i)&&(this.attributes.delete(l),l=Zz(i),o.set(i,l)),s=l}return s}}class bAe{constructor(){this.autoReset=!0,this.frame=0,this.calls=0,this.render={calls:0,frameCalls:0,drawCalls:0,triangles:0,points:0,lines:0,timestamp:0,previousFrameCalls:0,timestampCalls:0},this.compute={calls:0,frameCalls:0,timestamp:0,previousFrameCalls:0,timestampCalls:0},this.memory={geometries:0,textures:0}}update(e,i,n){this.render.drawCalls++,e.isMesh||e.isSprite?this.render.triangles+=n*(i/3):e.isPoints?this.render.points+=n*i:e.isLineSegments?this.render.lines+=n*(i/2):e.isLine?this.render.lines+=n*(i-1):console.error("THREE.WebGPUInfo: Unknown object type.")}updateTimestamp(e,i){this[e].timestampCalls===0&&(this[e].timestamp=0),this[e].timestamp+=i,this[e].timestampCalls++,this[e].timestampCalls>=this[e].previousFrameCalls&&(this[e].timestampCalls=0)}reset(){const e=this.render.frameCalls;this.render.previousFrameCalls=e;const i=this.compute.frameCalls;this.compute.previousFrameCalls=i,this.render.drawCalls=0,this.render.frameCalls=0,this.compute.frameCalls=0,this.render.triangles=0,this.render.points=0,this.render.lines=0}dispose(){this.reset(),this.calls=0,this.render.calls=0,this.compute.calls=0,this.render.timestamp=0,this.compute.timestamp=0,this.memory.geometries=0,this.memory.textures=0}}class $z{constructor(e){this.cacheKey=e,this.usedTimes=0}}class xAe extends $z{constructor(e,i,n){super(e),this.vertexProgram=i,this.fragmentProgram=n}}class _Ae extends $z{constructor(e,i){super(e),this.computeProgram=i,this.isComputePipeline=!0}}let EAe=0;class KR{constructor(e,i,n=null,s=null){this.id=EAe++,this.code=e,this.stage=i,this.transforms=n,this.attributes=s,this.usedTimes=0}}class wAe extends Id{constructor(e,i){super(),this.backend=e,this.nodes=i,this.bindings=null,this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}getForCompute(e,i){const{backend:n}=this,s=this.get(e);if(this._needsComputeUpdate(e)){const o=s.pipeline;o&&(o.usedTimes--,o.computeProgram.usedTimes--);const l=this.nodes.getForCompute(e);let u=this.programs.compute.get(l.computeShader);u===void 0&&(o&&o.computeProgram.usedTimes===0&&this._releaseProgram(o.computeProgram),u=new KR(l.computeShader,"compute",l.transforms,l.nodeAttributes),this.programs.compute.set(l.computeShader,u),n.createProgram(u));const c=this._getComputeCacheKey(e,u);let h=this.caches.get(c);h===void 0&&(o&&o.usedTimes===0&&this._releasePipeline(o),h=this._getComputePipeline(e,u,c,i)),h.usedTimes++,u.usedTimes++,s.version=e.version,s.pipeline=h}return s.pipeline}getForRender(e,i=null){const{backend:n}=this,s=this.get(e);if(this._needsRenderUpdate(e)){const o=s.pipeline;o&&(o.usedTimes--,o.vertexProgram.usedTimes--,o.fragmentProgram.usedTimes--);const l=e.getNodeBuilderState();let u=this.programs.vertex.get(l.vertexShader);u===void 0&&(o&&o.vertexProgram.usedTimes===0&&this._releaseProgram(o.vertexProgram),u=new KR(l.vertexShader,"vertex"),this.programs.vertex.set(l.vertexShader,u),n.createProgram(u));let c=this.programs.fragment.get(l.fragmentShader);c===void 0&&(o&&o.fragmentProgram.usedTimes===0&&this._releaseProgram(o.fragmentProgram),c=new KR(l.fragmentShader,"fragment"),this.programs.fragment.set(l.fragmentShader,c),n.createProgram(c));const h=this._getRenderCacheKey(e,u,c);let p=this.caches.get(h);p===void 0?(o&&o.usedTimes===0&&this._releasePipeline(o),p=this._getRenderPipeline(e,u,c,h,i)):e.pipeline=p,p.usedTimes++,u.usedTimes++,c.usedTimes++,s.pipeline=p}return s.pipeline}delete(e){const i=this.get(e).pipeline;return i&&(i.usedTimes--,i.usedTimes===0&&this._releasePipeline(i),i.isComputePipeline?(i.computeProgram.usedTimes--,i.computeProgram.usedTimes===0&&this._releaseProgram(i.computeProgram)):(i.fragmentProgram.usedTimes--,i.vertexProgram.usedTimes--,i.vertexProgram.usedTimes===0&&this._releaseProgram(i.vertexProgram),i.fragmentProgram.usedTimes===0&&this._releaseProgram(i.fragmentProgram))),super.delete(e)}dispose(){super.dispose(),this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}updateForRender(e){this.getForRender(e)}_getComputePipeline(e,i,n,s){n=n||this._getComputeCacheKey(e,i);let o=this.caches.get(n);return o===void 0&&(o=new _Ae(n,i),this.caches.set(n,o),this.backend.createComputePipeline(o,s)),o}_getRenderPipeline(e,i,n,s,o){s=s||this._getRenderCacheKey(e,i,n);let l=this.caches.get(s);return l===void 0&&(l=new xAe(s,i,n),this.caches.set(s,l),e.pipeline=l,this.backend.createRenderPipeline(e,o)),l}_getComputeCacheKey(e,i){return e.id+","+i.id}_getRenderCacheKey(e,i,n){return i.id+","+n.id+","+this.backend.getRenderCacheKey(e)}_releasePipeline(e){this.caches.delete(e.cacheKey)}_releaseProgram(e){const i=e.code,n=e.stage;this.programs[n].delete(i)}_needsComputeUpdate(e){const i=this.get(e);return i.pipeline===void 0||i.version!==e.version}_needsRenderUpdate(e){return this.get(e).pipeline===void 0||this.backend.needsRenderUpdate(e)}}class CAe extends Id{constructor(e,i,n,s,o,l){super(),this.backend=e,this.textures=n,this.pipelines=o,this.attributes=s,this.nodes=i,this.info=l,this.pipelines.bindings=this}getForRender(e){const i=e.getBindings();for(const n of i){const s=this.get(n);s.bindGroup===void 0&&(this._init(n),this.backend.createBindings(n,i),s.bindGroup=n)}return i}getForCompute(e){const i=this.nodes.getForCompute(e).bindings;for(const n of i){const s=this.get(n);s.bindGroup===void 0&&(this._init(n),this.backend.createBindings(n,i),s.bindGroup=n)}return i}updateForCompute(e){this._updateBindings(this.getForCompute(e))}updateForRender(e){this._updateBindings(this.getForRender(e))}_updateBindings(e){for(const i of e)this._update(i,e)}_init(e){for(const i of e.bindings)if(i.isSampledTexture)this.textures.updateTexture(i.texture);else if(i.isStorageBuffer){const n=i.attribute,s=n.isIndirectStorageBufferAttribute?$c.INDIRECT:$c.STORAGE;this.attributes.update(n,s)}}_update(e,i){const{backend:n}=this;let s=!1;for(const o of e.bindings)if(!(o.isNodeUniformsGroup&&!this.nodes.updateGroup(o))){if(o.isUniformBuffer)o.update()&&n.updateBinding(o);else if(o.isSampler)o.update();else if(o.isSampledTexture){o.needsBindingsUpdate(this.textures.get(o.texture).generation)&&(s=!0);const l=o.update(),u=o.texture;l&&this.textures.updateTexture(u);const c=n.get(u);if(n.isWebGPUBackend===!0&&c.texture===void 0&&c.externalTexture===void 0&&(console.error("Bindings._update: binding should be available:",o,l,u,o.textureNode.value,s),this.textures.updateTexture(u),s=!0),u.isStorageTexture===!0){const h=this.get(u);o.store===!0?h.needsMipmap=!0:this.textures.needsMipmaps(u)&&h.needsMipmap===!0&&(this.backend.generateMipmaps(u),h.needsMipmap=!1)}}}s===!0&&this.backend.updateBindings(e,i)}}function SAe(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.material.id!==e.material.id?r.material.id-e.material.id:r.z!==e.z?r.z-e.z:r.id-e.id}function e7(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.z!==e.z?e.z-r.z:r.id-e.id}function t7(r){return(r.transmission>0||r.transmissionNode)&&r.side===sg&&r.forceSinglePass===!1}class TAe{constructor(e,i,n){this.renderItems=[],this.renderItemsIndex=0,this.opaque=[],this.transparentDoublePass=[],this.transparent=[],this.bundles=[],this.lightsNode=e.getNode(i,n),this.lightsArray=[],this.scene=i,this.camera=n,this.occlusionQueryCount=0}begin(){return this.renderItemsIndex=0,this.opaque.length=0,this.transparentDoublePass.length=0,this.transparent.length=0,this.bundles.length=0,this.lightsArray.length=0,this.occlusionQueryCount=0,this}getNextRenderItem(e,i,n,s,o,l){let u=this.renderItems[this.renderItemsIndex];return u===void 0?(u={id:e.id,object:e,geometry:i,material:n,groupOrder:s,renderOrder:e.renderOrder,z:o,group:l},this.renderItems[this.renderItemsIndex]=u):(u.id=e.id,u.object=e,u.geometry=i,u.material=n,u.groupOrder=s,u.renderOrder=e.renderOrder,u.z=o,u.group=l),this.renderItemsIndex++,u}push(e,i,n,s,o,l){const u=this.getNextRenderItem(e,i,n,s,o,l);e.occlusionTest===!0&&this.occlusionQueryCount++,n.transparent===!0||n.transmission>0?(t7(n)&&this.transparentDoublePass.push(u),this.transparent.push(u)):this.opaque.push(u)}unshift(e,i,n,s,o,l){const u=this.getNextRenderItem(e,i,n,s,o,l);n.transparent===!0||n.transmission>0?(t7(n)&&this.transparentDoublePass.unshift(u),this.transparent.unshift(u)):this.opaque.unshift(u)}pushBundle(e){this.bundles.push(e)}pushLight(e){this.lightsArray.push(e)}sort(e,i){this.opaque.length>1&&this.opaque.sort(e||SAe),this.transparentDoublePass.length>1&&this.transparentDoublePass.sort(i||e7),this.transparent.length>1&&this.transparent.sort(i||e7)}finish(){this.lightsNode.setLights(this.lightsArray);for(let e=this.renderItemsIndex,i=this.renderItems.length;e<i;e++){const n=this.renderItems[e];if(n.id===null)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.groupOrder=null,n.renderOrder=null,n.z=null,n.group=null}}}class MAe{constructor(e){this.lighting=e,this.lists=new Zc}get(e,i){const n=this.lists,s=[e,i];let o=n.get(s);return o===void 0&&(o=new TAe(this.lighting,e,i),n.set(s,o)),o}dispose(){this.lists=new Zc}}let RAe=0;class IAe{constructor(){this.id=RAe++,this.color=!0,this.clearColor=!0,this.clearColorValue={r:0,g:0,b:0,a:1},this.depth=!0,this.clearDepth=!0,this.clearDepthValue=1,this.stencil=!1,this.clearStencil=!0,this.clearStencilValue=1,this.viewport=!1,this.viewportValue=new Zn,this.scissor=!1,this.scissorValue=new Zn,this.textures=null,this.depthTexture=null,this.activeCubeFace=0,this.sampleCount=1,this.width=0,this.height=0,this.isRenderContext=!0}getCacheKey(){return i7(this)}}function i7(r){const{textures:e,activeCubeFace:i}=r,n=[i];for(const s of e)n.push(s.id);return t8(n)}class BAe{constructor(){this.chainMaps={}}get(e,i,n=null){const s=[e,i];let o;if(n===null)o="default";else{const c=n.texture.format;o=`${n.textures.length}:${c}:${n.samples}:${n.depthBuffer}:${n.stencilBuffer}`}const l=this.getChainMap(o);let u=l.get(s);return u===void 0&&(u=new IAe,l.set(s,u)),n!==null&&(u.sampleCount=n.samples===0?1:n.samples),u}getChainMap(e){return this.chainMaps[e]||(this.chainMaps[e]=new Zc)}dispose(){this.chainMaps={}}}const NAe=new Nt;class LAe extends Id{constructor(e,i,n){super(),this.renderer=e,this.backend=i,this.info=n}updateRenderTarget(e,i=0){const n=this.get(e),s=e.samples===0?1:e.samples,o=n.depthTextureMips||(n.depthTextureMips={}),l=e.textures,u=this.getSize(l[0]),c=u.width>>i,h=u.height>>i;let p=e.depthTexture||o[i];const f=e.depthBuffer===!0||e.stencilBuffer===!0;let g=!1;p===void 0&&f&&(p=new Ig,p.format=e.stencilBuffer?pg:Fp,p.type=e.stencilBuffer?ay:ja,p.image.width=c,p.image.height=h,o[i]=p),(n.width!==u.width||u.height!==n.height)&&(g=!0,p&&(p.needsUpdate=!0,p.image.width=c,p.image.height=h)),n.width=u.width,n.height=u.height,n.textures=l,n.depthTexture=p||null,n.depth=e.depthBuffer,n.stencil=e.stencilBuffer,n.renderTarget=e,n.sampleCount!==s&&(g=!0,p&&(p.needsUpdate=!0),n.sampleCount=s);const m={sampleCount:s};for(let y=0;y<l.length;y++){const b=l[y];g&&(b.needsUpdate=!0),this.updateTexture(b,m)}if(p&&this.updateTexture(p,m),n.initialized!==!0){n.initialized=!0;const y=()=>{e.removeEventListener("dispose",y);for(let b=0;b<l.length;b++)this._destroyTexture(l[b]);p&&this._destroyTexture(p),this.delete(e)};e.addEventListener("dispose",y)}}updateTexture(e,i={}){const n=this.get(e);if(n.initialized===!0&&n.version===e.version)return;const s=e.isRenderTargetTexture||e.isDepthTexture||e.isFramebufferTexture,o=this.backend;if(s&&n.initialized===!0&&(o.destroySampler(e),o.destroyTexture(e)),e.isFramebufferTexture){const h=this.renderer.getRenderTarget();h?e.type=h.texture.type:e.type=fd}const{width:l,height:u,depth:c}=this.getSize(e);if(i.width=l,i.height=u,i.depth=c,i.needsMipmaps=this.needsMipmaps(e),i.levels=i.needsMipmaps?this.getMipLevels(e,l,u):1,s||e.isStorageTexture===!0)o.createSampler(e),o.createTexture(e,i),n.generation=e.version;else if(n.initialized!==!0&&o.createSampler(e),e.version>0){const h=e.image;if(h===void 0)console.warn("THREE.Renderer: Texture marked for update but image is undefined.");else if(h.complete===!1)console.warn("THREE.Renderer: Texture marked for update but image is incomplete.");else{if(e.images){const p=[];for(const f of e.images)p.push(f);i.images=p}else i.image=h;(n.isDefaultTexture===void 0||n.isDefaultTexture===!0)&&(o.createTexture(e,i),n.isDefaultTexture=!1,n.generation=e.version),e.source.dataReady===!0&&o.updateTexture(e,i),i.needsMipmaps&&e.mipmaps.length===0&&o.generateMipmaps(e)}}else o.createDefaultTexture(e),n.isDefaultTexture=!0,n.generation=e.version;if(n.initialized!==!0){n.initialized=!0,n.generation=e.version,this.info.memory.textures++;const h=()=>{e.removeEventListener("dispose",h),this._destroyTexture(e),this.info.memory.textures--};e.addEventListener("dispose",h)}n.version=e.version}getSize(e,i=NAe){let n=e.images?e.images[0]:e.image;return n?(n.image!==void 0&&(n=n.image),i.width=n.width,i.height=n.height,i.depth=e.isCubeTexture?6:n.depth||1):i.width=i.height=i.depth=1,i}getMipLevels(e,i,n){let s;return e.isCompressedTexture?s=e.mipmaps.length:s=Math.floor(Math.log2(Math.max(i,n)))+1,s}needsMipmaps(e){return this.isEnvironmentTexture(e)||e.isCompressedTexture===!0||e.generateMipmaps}isEnvironmentTexture(e){const i=e.mapping;return i===iy||i===ry||i===kp||i===lg}_destroyTexture(e){this.backend.destroySampler(e),this.backend.destroyTexture(e),this.delete(e)}}class YR extends $n{constructor(e,i,n,s=1){super(e,i,n),this.a=s}set(e,i,n,s=1){return this.a=s,super.set(e,i,n)}copy(e){return e.a!==void 0&&(this.a=e.a),super.copy(e)}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}}class DAe extends es{static get type(){return"ParameterNode"}constructor(e,i=null){super(e,i),this.isParameterNode=!0}getHash(){return this.uuid}generate(){return this.name}}class OAe extends tn{static get type(){return"StackNode"}constructor(e=null){super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this.isStackNode=!0}getNodeType(e){return this.outputNode?this.outputNode.getNodeType(e):"void"}add(e){return this.nodes.push(e),this}If(e,i){const n=new h_(i);return this._currentCond=Yo(e,n),this.add(this._currentCond)}ElseIf(e,i){const n=new h_(i),s=Yo(e,n);return this._currentCond.elseNode=s,this._currentCond=s,this}Else(e){return this._currentCond.elseNode=new h_(e),this}build(e,...i){const n=g8();p_(this);for(const s of this.nodes)s.build(e,"void");return p_(n),this.outputNode?this.outputNode.build(e,...i):super.build(e,...i)}else(...e){return console.warn("TSL.StackNode: .else() has been renamed to .Else()."),this.Else(...e)}elseif(...e){return console.warn("TSL.StackNode: .elseif() has been renamed to .ElseIf()."),this.ElseIf(...e)}}const JR=ui(OAe);new Ed,new Nt,new Nt,new Nt,new ws,new Nt(0,0,-1),new Zn,new Nt,new Nt,new Zn,new Dn;const PAe=new yg;ky.flipX(),PAe.depthTexture=new Ig(1,1);const ZR=new rR(-1,1,1,-1,0,1);class kAe extends Hp{constructor(e=!1){super();const i=e===!1?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new th([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new th(i,2))}}const FAe=new kAe;class r7 extends Qp{constructor(e=null){super(FAe,e),this.camera=ZR,this.isQuadMesh=!0}renderAsync(e){return e.renderAsync(this,ZR)}render(e){e.render(this,ZR)}}const Gy=new _c,$R=new ws;class Zo extends tn{static get type(){return"SceneNode"}constructor(e=Zo.BACKGROUND_BLURRINESS,i=null){super(),this.scope=e,this.scene=i}setup(e){const i=this.scope,n=this.scene!==null?this.scene:e.scene;let s;return i===Zo.BACKGROUND_BLURRINESS?s=Bs("backgroundBlurriness","float",n):i===Zo.BACKGROUND_INTENSITY?s=Bs("backgroundIntensity","float",n):i===Zo.BACKGROUND_ROTATION?s=Zr("mat4").label("backgroundRotation").setGroup(Mn).onRenderUpdate(()=>{const o=n.background;return o!==null&&o.isTexture&&o.mapping!==JM?(Gy.copy(n.backgroundRotation),Gy.x*=-1,Gy.y*=-1,Gy.z*=-1,$R.makeRotationFromEuler(Gy)):$R.identity(),$R}):console.error("THREE.SceneNode: Unknown scope:",i),s}}Zo.BACKGROUND_BLURRINESS="backgroundBlurriness",Zo.BACKGROUND_INTENSITY="backgroundIntensity",Zo.BACKGROUND_ROTATION="backgroundRotation";const UAe=Yi(Zo,Zo.BACKGROUND_BLURRINESS),n7=Yi(Zo,Zo.BACKGROUND_INTENSITY),zAe=Yi(Zo,Zo.BACKGROUND_ROTATION),Vg={PointList:"point-list",LineList:"line-list",LineStrip:"line-strip",TriangleList:"triangle-list",TriangleStrip:"triangle-strip"},Qa={Never:"never",Less:"less",Equal:"equal",LessEqual:"less-equal",Greater:"greater",NotEqual:"not-equal",GreaterEqual:"greater-equal",Always:"always"},qa={Store:"store"},la={Load:"load",Clear:"clear"},eI={CCW:"ccw"},tI={None:"none",Front:"front",Back:"back"},Hg={Uint16:"uint16",Uint32:"uint32"},ht={R8Unorm:"r8unorm",R8Snorm:"r8snorm",R8Uint:"r8uint",R8Sint:"r8sint",R16Uint:"r16uint",R16Sint:"r16sint",R16Float:"r16float",RG8Unorm:"rg8unorm",RG8Snorm:"rg8snorm",RG8Uint:"rg8uint",RG8Sint:"rg8sint",R32Uint:"r32uint",R32Sint:"r32sint",R32Float:"r32float",RG16Uint:"rg16uint",RG16Sint:"rg16sint",RG16Float:"rg16float",RGBA8Unorm:"rgba8unorm",RGBA8UnormSRGB:"rgba8unorm-srgb",RGBA8Snorm:"rgba8snorm",RGBA8Uint:"rgba8uint",RGBA8Sint:"rgba8sint",BGRA8Unorm:"bgra8unorm",BGRA8UnormSRGB:"bgra8unorm-srgb",RGB9E5UFloat:"rgb9e5ufloat",RGB10A2Unorm:"rgb10a2unorm",RG32Uint:"rg32uint",RG32Sint:"rg32sint",RG32Float:"rg32float",RGBA16Uint:"rgba16uint",RGBA16Sint:"rgba16sint",RGBA16Float:"rgba16float",RGBA32Uint:"rgba32uint",RGBA32Sint:"rgba32sint",RGBA32Float:"rgba32float",Depth16Unorm:"depth16unorm",Depth24Plus:"depth24plus",Depth24PlusStencil8:"depth24plus-stencil8",Depth32Float:"depth32float",Depth32FloatStencil8:"depth32float-stencil8",BC1RGBAUnorm:"bc1-rgba-unorm",BC1RGBAUnormSRGB:"bc1-rgba-unorm-srgb",BC2RGBAUnorm:"bc2-rgba-unorm",BC2RGBAUnormSRGB:"bc2-rgba-unorm-srgb",BC3RGBAUnorm:"bc3-rgba-unorm",BC3RGBAUnormSRGB:"bc3-rgba-unorm-srgb",BC4RUnorm:"bc4-r-unorm",BC5RGUnorm:"bc5-rg-unorm",BC5RGSnorm:"bc5-rg-snorm",BC6HRGBUFloat:"bc6h-rgb-ufloat",BC6HRGBFloat:"bc6h-rgb-float",BC7RGBAUnorm:"bc7-rgba-unorm",BC7RGBAUnormSRGB:"bc7-rgba-srgb",ETC2RGB8Unorm:"etc2-rgb8unorm",ETC2RGB8UnormSRGB:"etc2-rgb8unorm-srgb",ETC2RGB8A1Unorm:"etc2-rgb8a1unorm",ETC2RGB8A1UnormSRGB:"etc2-rgb8a1unorm-srgb",ETC2RGBA8Unorm:"etc2-rgba8unorm",ETC2RGBA8UnormSRGB:"etc2-rgba8unorm-srgb",EACR11Unorm:"eac-r11unorm",EACR11Snorm:"eac-r11snorm",EACRG11Unorm:"eac-rg11unorm",EACRG11Snorm:"eac-rg11snorm",ASTC4x4Unorm:"astc-4x4-unorm",ASTC4x4UnormSRGB:"astc-4x4-unorm-srgb",ASTC5x4Unorm:"astc-5x4-unorm",ASTC5x4UnormSRGB:"astc-5x4-unorm-srgb",ASTC5x5Unorm:"astc-5x5-unorm",ASTC5x5UnormSRGB:"astc-5x5-unorm-srgb",ASTC6x5Unorm:"astc-6x5-unorm",ASTC6x5UnormSRGB:"astc-6x5-unorm-srgb",ASTC6x6Unorm:"astc-6x6-unorm",ASTC6x6UnormSRGB:"astc-6x6-unorm-srgb",ASTC8x5Unorm:"astc-8x5-unorm",ASTC8x5UnormSRGB:"astc-8x5-unorm-srgb",ASTC8x6Unorm:"astc-8x6-unorm",ASTC8x6UnormSRGB:"astc-8x6-unorm-srgb",ASTC8x8Unorm:"astc-8x8-unorm",ASTC8x8UnormSRGB:"astc-8x8-unorm-srgb",ASTC10x5Unorm:"astc-10x5-unorm",ASTC10x5UnormSRGB:"astc-10x5-unorm-srgb",ASTC10x6Unorm:"astc-10x6-unorm",ASTC10x6UnormSRGB:"astc-10x6-unorm-srgb",ASTC10x8Unorm:"astc-10x8-unorm",ASTC10x8UnormSRGB:"astc-10x8-unorm-srgb",ASTC10x10Unorm:"astc-10x10-unorm",ASTC10x10UnormSRGB:"astc-10x10-unorm-srgb",ASTC12x10Unorm:"astc-12x10-unorm",ASTC12x10UnormSRGB:"astc-12x10-unorm-srgb",ASTC12x12Unorm:"astc-12x12-unorm",ASTC12x12UnormSRGB:"astc-12x12-unorm-srgb"},iI={ClampToEdge:"clamp-to-edge",Repeat:"repeat",MirrorRepeat:"mirror-repeat"},tf={Linear:"linear",Nearest:"nearest"},Qr={Zero:"zero",One:"one",Src:"src",OneMinusSrc:"one-minus-src",SrcAlpha:"src-alpha",OneMinusSrcAlpha:"one-minus-src-alpha",Dst:"dst",OneMinusDstColor:"one-minus-dst",DstAlpha:"dst-alpha",OneMinusDstAlpha:"one-minus-dst-alpha",SrcAlphaSaturated:"src-alpha-saturated",Constant:"constant",OneMinusConstant:"one-minus-constant"},rf={Add:"add",Subtract:"subtract",ReverseSubtract:"reverse-subtract",Min:"min",Max:"max"},s7={None:0,All:15},Nd={Keep:"keep",Zero:"zero",Replace:"replace",Invert:"invert",IncrementClamp:"increment-clamp",DecrementClamp:"decrement-clamp",IncrementWrap:"increment-wrap",DecrementWrap:"decrement-wrap"},rI={Storage:"storage",ReadOnlyStorage:"read-only-storage"},a7={WriteOnly:"write-only",ReadOnly:"read-only"},Vy={Float:"float",UnfilterableFloat:"unfilterable-float",Depth:"depth",SInt:"sint",UInt:"uint"},o7={TwoD:"2d",ThreeD:"3d"},jl={TwoD:"2d",TwoDArray:"2d-array",Cube:"cube",ThreeD:"3d"},jAe={All:"all"},O_={Vertex:"vertex",Instance:"instance"},nI={DepthClipControl:"depth-clip-control",Depth32FloatStencil8:"depth32float-stencil8",TextureCompressionBC:"texture-compression-bc",TextureCompressionETC2:"texture-compression-etc2",TextureCompressionASTC:"texture-compression-astc",TimestampQuery:"timestamp-query",IndirectFirstInstance:"indirect-first-instance",ShaderF16:"shader-f16",RG11B10UFloat:"rg11b10ufloat-renderable",BGRA8UNormStorage:"bgra8unorm-storage",Float32Filterable:"float32-filterable",ClipDistances:"clip-distances",DualSourceBlending:"dual-source-blending",Subgroups:"subgroups"},GAe=new Dn;class VAe extends Ry{static get type(){return"PassTextureNode"}constructor(e,i){super(i),this.passNode=e,this.setUpdateMatrix(!1)}setup(e){return e.object.isQuadMesh&&this.passNode.build(e),super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}}class l7 extends VAe{static get type(){return"PassMultipleTextureNode"}constructor(e,i,n=!1){super(e,null),this.textureName=i,this.previousTexture=n}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(e){return this.updateTexture(),super.setup(e)}clone(){return new this.constructor(this.passNode,this.textureName,this.previousTexture)}}class P_ extends ra{static get type(){return"PassNode"}constructor(e,i,n,s={}){super("vec4"),this.scope=e,this.scene=i,this.camera=n,this.options=s,this._pixelRatio=1,this._width=1,this._height=1;const o=new Ig;o.isRenderTargetTexture=!0,o.name="depth";const l=new yg(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Qu,...s});l.texture.name="output",l.depthTexture=o,this.renderTarget=l,this.updateBeforeType=hn.FRAME,this._textures={output:l.texture,depth:o},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=Zr(0),this._cameraFar=Zr(0),this._mrt=null,this.isPassNode=!0}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}isGlobal(){return!0}getTexture(e){let i=this._textures[e];return i===void 0&&(i=this.renderTarget.texture.clone(),i.isRenderTargetTexture=!0,i.name=e,this._textures[e]=i,this.renderTarget.textures.push(i)),i}getPreviousTexture(e){let i=this._previousTextures[e];return i===void 0&&(i=this.getTexture(e).clone(),i.isRenderTargetTexture=!0,this._previousTextures[e]=i),i}toggleTexture(e){const i=this._previousTextures[e];if(i!==void 0){const n=this._textures[e],s=this.renderTarget.textures.indexOf(n);this.renderTarget.textures[s]=i,this._textures[e]=i,this._previousTextures[e]=n,this._textureNodes[e].updateTexture(),this._previousTextureNodes[e].updateTexture()}}getTextureNode(e="output"){let i=this._textureNodes[e];return i===void 0&&(i=Ti(new l7(this,e)),i.updateTexture(),this._textureNodes[e]=i),i}getPreviousTextureNode(e="output"){let i=this._previousTextureNodes[e];return i===void 0&&(this._textureNodes[e]===void 0&&this.getTextureNode(e),i=Ti(new l7(this,e,!0)),i.updateTexture(),this._previousTextureNodes[e]=i),i}getViewZNode(e="depth"){let i=this._viewZNodes[e];if(i===void 0){const n=this._cameraNear,s=this._cameraFar;this._viewZNodes[e]=i=pz(this.getTextureNode(e),n,s)}return i}getLinearDepthNode(e="depth"){let i=this._linearDepthNodes[e];if(i===void 0){const n=this._cameraNear,s=this._cameraFar,o=this.getViewZNode(e);this._linearDepthNodes[e]=i=Uy(o,n,s)}return i}setup({renderer:e}){return this.renderTarget.samples=this.options.samples===void 0?e.samples:this.options.samples,e.backend.isWebGLBackend===!0&&(this.renderTarget.samples=0),this.renderTarget.depthTexture.isMultisampleRenderTargetTexture=this.renderTarget.samples>1,this.scope===P_.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(e){const{renderer:i}=e,{scene:n,camera:s}=this;this._pixelRatio=i.getPixelRatio();const o=i.getSize(GAe);this.setSize(o.width,o.height);const l=i.getRenderTarget(),u=i.getMRT();this._cameraNear.value=s.near,this._cameraFar.value=s.far;for(const c in this._previousTextures)this.toggleTexture(c);i.setRenderTarget(this.renderTarget),i.setMRT(this._mrt),i.render(n,s),i.setRenderTarget(l),i.setMRT(u)}setSize(e,i){this._width=e,this._height=i;const n=this._width*this._pixelRatio,s=this._height*this._pixelRatio;this.renderTarget.setSize(n,s)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}P_.COLOR="color",P_.DEPTH="depth";const HAe=Hi(([r,e])=>r.mul(e).clamp()).setLayout({name:"linearToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),WAe=Hi(([r,e])=>(r=r.mul(e),r.div(r.add(1)).clamp())).setLayout({name:"reinhardToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),QAe=Hi(([r,e])=>{r=r.mul(e),r=r.sub(.004).max(0);const i=r.mul(r.mul(6.2).add(.5)),n=r.mul(r.mul(6.2).add(1.7)).add(.06);return i.div(n).pow(2.2)}).setLayout({name:"cineonToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),qAe=Hi(([r])=>{const e=r.mul(r.add(.0245786)).sub(90537e-9),i=r.mul(r.add(.432951).mul(.983729)).add(.238081);return e.div(i)}),XAe=Hi(([r,e])=>{const i=Ro(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),n=Ro(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return r=r.mul(e).div(.6),r=i.mul(r),r=qAe(r),r=n.mul(r),r.clamp()}).setLayout({name:"acesFilmicToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),KAe=Ro(ti(1.6605,-.1246,-.0182),ti(-.5876,1.1329,-.1006),ti(-.0728,-.0083,1.1187)),YAe=Ro(ti(.6274,.0691,.0164),ti(.3293,.9195,.088),ti(.0433,.0113,.8956)),JAe=Hi(([r])=>{const e=ti(r).toVar(),i=ti(e.mul(e)).toVar(),n=ti(i.mul(i)).toVar();return ri(15.5).mul(n.mul(i)).sub(bn(40.14,n.mul(e))).add(bn(31.96,n).sub(bn(6.868,i.mul(e))).add(bn(.4298,i).add(bn(.1191,e).sub(.00232))))}),ZAe=Hi(([r,e])=>{const i=ti(r).toVar(),n=Ro(ti(.856627153315983,.137318972929847,.11189821299995),ti(.0951212405381588,.761241990602591,.0767994186031903),ti(.0482516061458583,.101439036467562,.811302368396859)),s=Ro(ti(1.1271005818144368,-.1413297634984383,-.14132976349843826),ti(-.11060664309660323,1.157823702216272,-.11060664309660294),ti(-.016493938717834573,-.016493938717834257,1.2519364065950405)),o=ri(-12.47393),l=ri(4.026069);return i.mulAssign(e),i.assign(YAe.mul(i)),i.assign(n.mul(i)),i.assign(zl(i,1e-10)),i.assign(ah(i)),i.assign(i.sub(o).div(l.sub(o))),i.assign(oh(i,0,1)),i.assign(JAe(i)),i.assign(s.mul(i)),i.assign(b_(zl(ti(0),i),ti(2.2))),i.assign(KAe.mul(i)),i.assign(oh(i,0,1)),i}).setLayout({name:"agxToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),$Ae=Hi(([r,e])=>{const i=ri(.76),n=ri(.15);r=r.mul(e);const s=Cy(r.r,Cy(r.g,r.b)),o=Yo(s.lessThan(.08),s.sub(bn(6.25,s.mul(s))),.04);r.subAssign(o);const l=zl(r.r,zl(r.g,r.b));Va(l.lessThan(i),()=>r);const u=_l(1,i),c=_l(1,u.mul(u).div(l.add(u.sub(i))));r.mulAssign(c.div(l));const h=_l(1,wd(1,n.mul(l.sub(c)).add(1)));return As(r,ti(c),h)}).setLayout({name:"neutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});class oo extends tn{static get type(){return"CodeNode"}constructor(e="",i=[],n=""){super("code"),this.isCodeNode=!0,this.code=e,this.language=n,this.includes=i}isGlobal(){return!0}setIncludes(e){return this.includes=e,this}getIncludes(){return this.includes}generate(e){const i=this.getIncludes(e);for(const s of i)s.build(e);const n=e.getCodeFromNode(this,this.getNodeType(e));return n.code=this.code,n.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}}class eye extends oo{static get type(){return"FunctionNode"}constructor(e="",i=[],n=""){super(e,i,n)}getNodeType(e){return this.getNodeFunction(e).type}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){const i=e.getDataFromNode(this);let n=i.nodeFunction;return n===void 0&&(n=e.parser.parseFunction(this.code),i.nodeFunction=n),n}generate(e,i){super.generate(e);const n=this.getNodeFunction(e),s=n.name,o=n.type,l=e.getCodeFromNode(this,o);s!==""&&(l.name=s);const u=e.getPropertyName(l),c=this.getNodeFunction(e).getCode(u);return l.code=c+`
`,i==="property"?u:e.format(`${u}()`,o,i)}}class c7 extends tn{static get type(){return"FogNode"}constructor(e,i){super("float"),this.isFogNode=!0,this.colorNode=e,this.factorNode=i}getViewZNode(e){let i;const n=e.context.getViewZ;return n!==void 0&&(i=n(this)),(i||Wa.z).negate()}setup(){return this.factorNode}}class tye extends c7{static get type(){return"FogRangeNode"}constructor(e,i,n){super(e),this.isFogRangeNode=!0,this.nearNode=i,this.farNode=n}setup(e){const i=this.getViewZNode(e);return Jp(this.nearNode,this.farNode,i)}}const iye=ui(tye);class rye extends c7{static get type(){return"FogExp2Node"}constructor(e,i){super(e),this.isFogExp2Node=!0,this.densityNode=i}setup(e){const i=this.getViewZNode(e),n=this.densityNode;return n.mul(n,i,i).negate().exp().oneMinus()}}const nye=ui(rye);class sye extends tn{constructor(e){super(),this.scope=e}generate(e){const{scope:i}=this,{renderer:n}=e;n.backend.isWebGLBackend===!0?e.addFlowCode(`	// ${i}Barrier 
`):e.addLineFlowCode(`${i}Barrier()`,this)}}ui(sye);class eu extends ra{static get type(){return"AtomicFunctionNode"}constructor(e,i,n,s=null){super("uint"),this.method=e,this.pointerNode=i,this.valueNode=n,this.storeNode=s}getInputType(e){return this.pointerNode.getNodeType(e)}getNodeType(e){return this.getInputType(e)}generate(e){const i=this.method,n=this.getNodeType(e),s=this.getInputType(e),o=this.pointerNode,l=this.valueNode,u=[];u.push(`&${o.build(e,s)}`),u.push(l.build(e,s));const c=`${e.getMethod(i,n)}( ${u.join(", ")} )`;if(this.storeNode!==null){const h=this.storeNode.build(e,s);e.addLineFlowCode(`${h} = ${c}`,this)}else e.addLineFlowCode(c,this)}}eu.ATOMIC_LOAD="atomicLoad",eu.ATOMIC_STORE="atomicStore",eu.ATOMIC_ADD="atomicAdd",eu.ATOMIC_SUB="atomicSub",eu.ATOMIC_MAX="atomicMax",eu.ATOMIC_MIN="atomicMin",eu.ATOMIC_AND="atomicAnd",eu.ATOMIC_OR="atomicOr",eu.ATOMIC_XOR="atomicXor",ui(eu);let k_;function sI(r){k_=k_||new WeakMap;let e=k_.get(r);return e===void 0&&k_.set(r,e={}),e}function u7(r){const e=sI(r);return e.position||(e.position=Zr(new Nt).setGroup(Mn).onRenderUpdate((i,n)=>n.value.setFromMatrixPosition(r.matrixWorld)))}function aye(r){const e=sI(r);return e.targetPosition||(e.targetPosition=Zr(new Nt).setGroup(Mn).onRenderUpdate((i,n)=>n.value.setFromMatrixPosition(r.target.matrixWorld)))}function aI(r){const e=sI(r);return e.viewPosition||(e.viewPosition=Zr(new Nt).setGroup(Mn).onRenderUpdate(({camera:i},n)=>{n.value=n.value||new Nt,n.value.setFromMatrixPosition(r.matrixWorld),n.value.applyMatrix4(i.matrixWorldInverse)}))}const h7=r=>uh.transformDirection(u7(r).sub(aye(r))),oye=r=>r.sort((e,i)=>e.id-i.id),lye=(r,e)=>{for(const i of e)if(i.isAnalyticLightNode&&i.light.id===r)return i;return null},oI=new WeakMap;class d7 extends tn{static get type(){return"LightsNode"}constructor(){super("vec3"),this.totalDiffuseNode=ti().toVar("totalDiffuse"),this.totalSpecularNode=ti().toVar("totalSpecular"),this.outgoingLightNode=ti().toVar("outgoingLight"),this._lights=[],this._lightNodes=null,this._lightNodesHash=null,this.global=!0}getHash(e){if(this._lightNodesHash===null){this._lightNodes===null&&this.setupLightsNode(e);const i=[];for(const n of this._lightNodes)i.push(n.getSelf().getHash());this._lightNodesHash="lights-"+i.join(",")}return this._lightNodesHash}analyze(e){const i=e.getDataFromNode(this);for(const n of i.nodes)n.build(e)}setupLightsNode(e){const i=[],n=this._lightNodes,s=oye(this._lights),o=e.renderer.library;for(const l of s)if(l.isNode)i.push(Ti(l));else{let u=null;if(n!==null&&(u=lye(l.id,n)),u===null){const c=o.getLightNodeClass(l.constructor);if(c===null){console.warn(`LightsNode.setupNodeLights: Light node not found for ${l.constructor.name}`);continue}let h=null;oI.has(l)?h=oI.get(l):(h=Ti(new c(l)),oI.set(l,h)),i.push(h)}}this._lightNodes=i}setupLights(e,i){for(const n of i)n.build(e)}setup(e){this._lightNodes===null&&this.setupLightsNode(e);const i=e.context,n=i.lightingModel;let s=this.outgoingLightNode;if(n){const{_lightNodes:o,totalDiffuseNode:l,totalSpecularNode:u}=this;i.outgoingLight=s;const c=e.addStack(),h=e.getDataFromNode(this);h.nodes=c.nodes,n.start(i,c,e),this.setupLights(e,o),n.indirect(i,c,e);const{backdrop:p,backdropAlpha:f}=i,{directDiffuse:g,directSpecular:m,indirectDiffuse:y,indirectSpecular:b}=i.reflectedLight;let v=g.add(y);p!==null&&(f!==null?v=ti(f.mix(v,p)):v=ti(p),i.material.transparent=!0),l.assign(v),u.assign(m.add(b)),s.assign(l.add(u)),n.finish(i,c,e),s=s.bypass(e.removeStack())}return s}setLights(e){return this._lights=e,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}get hasLights(){return this._lights.length>0}}const cye=Hi(({depthTexture:r,shadowCoord:e})=>ks(r,e.xy).compare(e.z)),uye=Hi(({depthTexture:r,shadowCoord:e,shadow:i})=>{const n=(b,v)=>ks(r,b).compare(v),s=Bs("mapSize","vec2",i).setGroup(Mn),o=Bs("radius","float",i).setGroup(Mn),l=Ji(1).div(s),u=l.x.negate().mul(o),c=l.y.negate().mul(o),h=l.x.mul(o),p=l.y.mul(o),f=u.div(2),g=c.div(2),m=h.div(2),y=p.div(2);return Io(n(e.xy.add(Ji(u,c)),e.z),n(e.xy.add(Ji(0,c)),e.z),n(e.xy.add(Ji(h,c)),e.z),n(e.xy.add(Ji(f,g)),e.z),n(e.xy.add(Ji(0,g)),e.z),n(e.xy.add(Ji(m,g)),e.z),n(e.xy.add(Ji(u,0)),e.z),n(e.xy.add(Ji(f,0)),e.z),n(e.xy,e.z),n(e.xy.add(Ji(m,0)),e.z),n(e.xy.add(Ji(h,0)),e.z),n(e.xy.add(Ji(f,y)),e.z),n(e.xy.add(Ji(0,y)),e.z),n(e.xy.add(Ji(m,y)),e.z),n(e.xy.add(Ji(u,p)),e.z),n(e.xy.add(Ji(0,p)),e.z),n(e.xy.add(Ji(h,p)),e.z)).mul(1/17)}),hye=Hi(({depthTexture:r,shadowCoord:e,shadow:i})=>{const n=(p,f)=>ks(r,p).compare(f),s=Bs("mapSize","vec2",i).setGroup(Mn),o=Ji(1).div(s),l=o.x,u=o.y,c=e.xy,h=Cd(c.mul(s).add(.5));return c.subAssign(h.mul(o)),Io(n(c,e.z),n(c.add(Ji(l,0)),e.z),n(c.add(Ji(0,u)),e.z),n(c.add(o),e.z),As(n(c.add(Ji(l.negate(),0)),e.z),n(c.add(Ji(l.mul(2),0)),e.z),h.x),As(n(c.add(Ji(l.negate(),u)),e.z),n(c.add(Ji(l.mul(2),u)),e.z),h.x),As(n(c.add(Ji(0,u.negate())),e.z),n(c.add(Ji(0,u.mul(2))),e.z),h.y),As(n(c.add(Ji(l,u.negate())),e.z),n(c.add(Ji(l,u.mul(2))),e.z),h.y),As(As(n(c.add(Ji(l.negate(),u.negate())),e.z),n(c.add(Ji(l.mul(2),u.negate())),e.z),h.x),As(n(c.add(Ji(l.negate(),u.mul(2))),e.z),n(c.add(Ji(l.mul(2),u.mul(2))),e.z),h.x),h.y)).mul(1/9)}),dye=Hi(({depthTexture:r,shadowCoord:e})=>{const i=ri(1).toVar(),n=ks(r).uv(e.xy).rg,s=P8(e.z,n.x);return Va(s.notEqual(ri(1)),()=>{const o=e.z.sub(n.x),l=zl(0,n.y.mul(n.y));let u=l.div(l.add(o.mul(o)));u=oh(_l(u,.3).div(.95-.3)),i.assign(oh(zl(s,u)))}),i}),pye=Hi(({samples:r,radius:e,size:i,shadowPass:n})=>{const s=ri(0).toVar(),o=ri(0).toVar(),l=r.lessThanEqual(ri(1)).select(ri(0),ri(2).div(r.sub(1))),u=r.lessThanEqual(ri(1)).select(ri(0),ri(-1));Jc({start:Ps(0),end:Ps(r),type:"int",condition:"<"},({i:h})=>{const p=u.add(ri(h).mul(l)),f=n.uv(Io(DR.xy,Ji(0,p).mul(e)).div(i)).x;s.addAssign(f),o.addAssign(f.mul(f))}),s.divAssign(r),o.divAssign(r);const c=yR(o.sub(s.mul(s)));return Ji(s,c)}),fye=Hi(({samples:r,radius:e,size:i,shadowPass:n})=>{const s=ri(0).toVar(),o=ri(0).toVar(),l=r.lessThanEqual(ri(1)).select(ri(0),ri(2).div(r.sub(1))),u=r.lessThanEqual(ri(1)).select(ri(0),ri(-1));Jc({start:Ps(0),end:Ps(r),type:"int",condition:"<"},({i:h})=>{const p=u.add(ri(h).mul(l)),f=n.uv(Io(DR.xy,Ji(p,0).mul(e)).div(i));s.addAssign(f.x),o.addAssign(Io(f.y.mul(f.y),f.x.mul(f.x)))}),s.divAssign(r),o.divAssign(r);const c=yR(o.sub(s.mul(s)));return Ji(s,c)}),mye=[cye,uye,hye,dye];let Wg=null;const F_=new r7;class gye extends tn{static get type(){return"ShadowNode"}constructor(e,i=null){super(),this.light=e,this.shadow=i||e.shadow,this.shadowMap=null,this.vsmShadowMapVertical=null,this.vsmShadowMapHorizontal=null,this.vsmMaterialVertical=null,this.vsmMaterialHorizontal=null,this.updateBeforeType=hn.RENDER,this._node=null,this.isShadowNode=!0}setupShadow(e){const{object:i,renderer:n}=e;Wg===null&&(Wg=new oa,Wg.fragmentNode=Jr(0,0,0,1),Wg.isShadowNodeMaterial=!0,Wg.name="ShadowMaterial");const s=this.shadow,o=n.shadowMap.type,l=new Ig(s.mapSize.width,s.mapSize.height);l.compareFunction=C3;const u=e.createRenderTarget(s.mapSize.width,s.mapSize.height);if(u.depthTexture=l,s.camera.updateProjectionMatrix(),o===T1){l.compareFunction=null,this.vsmShadowMapVertical=e.createRenderTarget(s.mapSize.width,s.mapSize.height,{format:oy,type:Qu}),this.vsmShadowMapHorizontal=e.createRenderTarget(s.mapSize.width,s.mapSize.height,{format:oy,type:Qu});const C=ks(l),E=ks(this.vsmShadowMapVertical.texture),T=Bs("blurSamples","float",s).setGroup(Mn),R=Bs("radius","float",s).setGroup(Mn),B=Bs("mapSize","vec2",s).setGroup(Mn);let I=this.vsmMaterialVertical||(this.vsmMaterialVertical=new oa);I.fragmentNode=pye({samples:T,radius:R,size:B,shadowPass:C}).context(e.getSharedContext()),I.name="VSMVertical",I=this.vsmMaterialHorizontal||(this.vsmMaterialHorizontal=new oa),I.fragmentNode=fye({samples:T,radius:R,size:B,shadowPass:E}).context(e.getSharedContext()),I.name="VSMHorizontal"}const c=Bs("intensity","float",s).setGroup(Mn),h=Bs("bias","float",s).setGroup(Mn),p=Bs("normalBias","float",s).setGroup(Mn),f=i.material.shadowPositionNode||wR;let g=Zr(s.matrix).setGroup(Mn).mul(f.add(CR.mul(p))),m;if(s.camera.isOrthographicCamera||n.logarithmicDepthBuffer!==!0)g=g.xyz.div(g.w),m=g.z,n.coordinateSystem===jp&&(m=m.mul(2).sub(1));else{const C=g.w;g=g.xy.div(C);const E=Zr("float").onRenderUpdate(()=>s.camera.near),T=Zr("float").onRenderUpdate(()=>s.camera.far);m=fz(C,E,T)}g=ti(g.x,g.y.oneMinus(),m.add(h));const y=g.x.greaterThanEqual(0).and(g.x.lessThanEqual(1)).and(g.y.greaterThanEqual(0)).and(g.y.lessThanEqual(1)).and(g.z.lessThanEqual(1)),b=s.filterNode||mye[n.shadowMap.type]||null;if(b===null)throw new Error("THREE.WebGPURenderer: Shadow map type not supported yet.");const v=ks(u.texture,g),_=y.select(b({depthTexture:o===T1?this.vsmShadowMapHorizontal.texture:l,shadowCoord:g,shadow:s}),ri(1));return this.shadowMap=u,this.shadow.map=u,As(1,_.rgb.mix(v,1),c.mul(v.a))}setup(e){if(e.renderer.shadowMap.enabled!==!1)return this._node!==null?this._node:this._node=this.setupShadow(e)}updateShadow(e){const{shadowMap:i,light:n,shadow:s}=this,{renderer:o,scene:l,camera:u}=e,c=o.shadowMap.type,h=i.depthTexture.version;this._depthVersionCached=h;const p=l.overrideMaterial;l.overrideMaterial=Wg,i.setSize(s.mapSize.width,s.mapSize.height),s.updateMatrices(n),s.camera.layers.mask=u.layers.mask;const f=o.getRenderTarget(),g=o.getRenderObjectFunction();o.setRenderObjectFunction((m,...y)=>{(m.castShadow===!0||m.receiveShadow&&c===T1)&&o.renderObject(m,...y)}),o.setRenderTarget(i),o.render(l,s.camera),o.setRenderObjectFunction(g),n.isPointLight!==!0&&c===T1&&this.vsmPass(o),o.setRenderTarget(f),l.overrideMaterial=p}vsmPass(e){const{shadow:i}=this;this.vsmShadowMapVertical.setSize(i.mapSize.width,i.mapSize.height),this.vsmShadowMapHorizontal.setSize(i.mapSize.width,i.mapSize.height),e.setRenderTarget(this.vsmShadowMapVertical),F_.material=this.vsmMaterialVertical,F_.render(e),e.setRenderTarget(this.vsmShadowMapHorizontal),F_.material=this.vsmMaterialHorizontal,F_.render(e)}dispose(){this.shadowMap.dispose(),this.shadowMap=null,this.vsmShadowMapVertical!==null&&(this.vsmShadowMapVertical.dispose(),this.vsmShadowMapVertical=null,this.vsmMaterialVertical.dispose(),this.vsmMaterialVertical=null),this.vsmShadowMapHorizontal!==null&&(this.vsmShadowMapHorizontal.dispose(),this.vsmShadowMapHorizontal=null,this.vsmMaterialHorizontal.dispose(),this.vsmMaterialHorizontal=null),this.updateBeforeType=hn.NONE}updateBefore(e){const{shadow:i}=this;(i.needsUpdate||i.autoUpdate)&&(this.updateShadow(e),this.shadowMap.depthTexture.version===this._depthVersionCached&&(i.needsUpdate=!1))}}const Aye=(r,e)=>Ti(new gye(r,e));class nf extends zg{static get type(){return"AnalyticLightNode"}constructor(e=null){super(),this.updateType=hn.FRAME,this.light=e,this.color=new $n,this.colorNode=Zr(this.color).setGroup(Mn),this.baseColorNode=null,this.shadowNode=null,this.shadowColorNode=null,this.isAnalyticLightNode=!0}getCacheKey(){return a_(super.getCacheKey(),this.light.id,this.light.castShadow?1:0)}getHash(){return this.light.uuid}setupShadow(e){const{renderer:i}=e;if(i.shadowMap.enabled===!1)return;let n=this.shadowColorNode;if(n===null){const s=this.light.shadow.shadowNode;let o;s!==void 0?o=Ti(s):o=Aye(this.light),this.shadowNode=o,this.shadowColorNode=n=this.colorNode.mul(o),this.baseColorNode=this.colorNode}this.colorNode=n}setup(e){this.colorNode=this.baseColorNode||this.colorNode,this.light.castShadow?e.object.receiveShadow&&this.setupShadow(e):this.shadowNode!==null&&this.shadowNode.dispose()}update(){const{light:e}=this;this.color.copy(e.color).multiplyScalar(e.intensity)}}const p7=Hi(r=>{const{lightDistance:e,cutoffDistance:i,decayExponent:n}=r,s=e.pow(n).max(.01).reciprocal();return i.greaterThan(0).select(s.mul(e.div(i).pow4().oneMinus().clamp().pow2()),s)}),yye=Hi(({color:r,lightViewPosition:e,cutoffDistance:i,decayExponent:n},s)=>{const o=s.context.lightingModel,l=e.sub(Wa),u=l.normalize(),c=l.length(),h=p7({lightDistance:c,cutoffDistance:i,decayExponent:n}),p=r.mul(h),f=s.context.reflectedLight;o.direct({lightDirection:u,lightColor:p,reflectedLight:f},s.stack,s)});class vye extends nf{static get type(){return"PointLightNode"}constructor(e=null){super(e),this.cutoffDistanceNode=Zr(0).setGroup(Mn),this.decayExponentNode=Zr(0).setGroup(Mn)}update(e){const{light:i}=this;super.update(e),this.cutoffDistanceNode.value=i.distance,this.decayExponentNode.value=i.decay}setup(){yye({color:this.colorNode,lightViewPosition:aI(this.light),cutoffDistance:this.cutoffDistanceNode,decayExponent:this.decayExponentNode}).append()}}const bye=Hi(([r,e])=>{const i=r.x,n=r.y,s=r.z;let o=e.element(0).mul(.886227);return o=o.add(e.element(1).mul(2*.511664).mul(n)),o=o.add(e.element(2).mul(2*.511664).mul(s)),o=o.add(e.element(3).mul(2*.511664).mul(i)),o=o.add(e.element(4).mul(2*.429043).mul(i).mul(n)),o=o.add(e.element(5).mul(2*.429043).mul(n).mul(s)),o=o.add(e.element(6).mul(s.mul(s).mul(.743125).sub(.247708))),o=o.add(e.element(7).mul(2*.429043).mul(i).mul(s)),o=o.add(e.element(8).mul(.429043).mul(bn(i,i).sub(bn(n,n)))),o}),hh=new YR;class xye extends Id{constructor(e,i){super(),this.renderer=e,this.nodes=i}update(e,i,n){const s=this.renderer,o=this.nodes.getBackgroundNode(e)||e.background;let l=!1;if(o===null)s._clearColor.getRGB(hh,gd),hh.a=s._clearColor.a;else if(o.isColor===!0)o.getRGB(hh,gd),hh.a=1,l=!0;else if(o.isNode===!0){const u=this.get(e),c=o;hh.copy(s._clearColor);let h=u.backgroundMesh;if(h===void 0){const f=xR(Jr(c).mul(n7),{getUV:()=>zAe.mul(J8),getTextureLevel:()=>UAe});let g=IR();g=g.setZ(g.w);const m=new oa;m.name="Background.material",m.side=yc,m.depthTest=!1,m.depthWrite=!1,m.fog=!1,m.lights=!1,m.vertexNode=g,m.colorNode=f,u.backgroundMeshNode=f,u.backgroundMesh=h=new Qp(new Z3(1,32,32),m),h.frustumCulled=!1,h.name="Background.mesh",h.onBeforeRender=function(y,b,v){this.matrixWorld.copyPosition(v.matrixWorld)}}const p=c.getCacheKey();u.backgroundCacheKey!==p&&(u.backgroundMeshNode.node=Jr(c).mul(n7),u.backgroundMeshNode.needsUpdate=!0,h.material.needsUpdate=!0,u.backgroundCacheKey=p),i.unshift(h,h.geometry,h.material,0,0,null)}else console.error("THREE.Renderer: Unsupported background configuration.",o);if(s.autoClear===!0||l===!0){const u=n.clearColorValue;u.r=hh.r,u.g=hh.g,u.b=hh.b,u.a=hh.a,(s.backend.isWebGLBackend===!0||s.alpha===!0)&&(u.r*=u.a,u.g*=u.a,u.b*=u.a),n.depthClearValue=s._clearDepth,n.stencilClearValue=s._clearStencil,n.clearColor=s.autoClearColor===!0,n.clearDepth=s.autoClearDepth===!0,n.clearStencil=s.autoClearStencil===!0}else n.clearColor=!1,n.clearDepth=!1,n.clearStencil=!1}}let _ye=0;class lI{constructor(e="",i=[],n=0,s=[]){this.name=e,this.bindings=i,this.index=n,this.bindingsReference=s,this.id=_ye++}}class Eye{constructor(e,i,n,s,o,l,u,c,h,p=[]){this.vertexShader=e,this.fragmentShader=i,this.computeShader=n,this.transforms=p,this.nodeAttributes=s,this.bindings=o,this.updateNodes=l,this.updateBeforeNodes=u,this.updateAfterNodes=c,this.monitor=h,this.usedTimes=0}createBindings(){const e=[];for(const i of this.bindings)if(i.bindings[0].groupNode.shared!==!0){const n=new lI(i.name,[],i.index,i);e.push(n);for(const s of i.bindings)n.bindings.push(s.clone())}else e.push(i);return e}}class f7{constructor(e,i,n=null){this.isNodeAttribute=!0,this.name=e,this.type=i,this.node=n}}class wye{constructor(e,i,n){this.isNodeUniform=!0,this.name=e,this.type=i,this.node=n.getSelf()}get value(){return this.node.value}set value(e){this.node.value=e}get id(){return this.node.id}get groupNode(){return this.node.groupNode}}class m7{constructor(e,i){this.isNodeVar=!0,this.name=e,this.type=i}}class Cye extends m7{constructor(e,i){super(e,i),this.needsInterpolation=!1,this.isNodeVarying=!0}}class Sye{constructor(e,i,n=""){this.name=e,this.type=i,this.code=n,Object.defineProperty(this,"isNodeCode",{value:!0})}}let Tye=0;class cI{constructor(e=null){this.id=Tye++,this.nodesData=new WeakMap,this.parent=e}getData(e){let i=this.nodesData.get(e);return i===void 0&&this.parent!==null&&(i=this.parent.getData(e)),i}setData(e,i){this.nodesData.set(e,i)}}class sf{constructor(e,i){this.name=e,this.value=i,this.boundary=0,this.itemSize=0,this.offset=0}setValue(e){this.value=e}getValue(){return this.value}}class Mye extends sf{constructor(e,i=0){super(e,i),this.isNumberUniform=!0,this.boundary=4,this.itemSize=1}}class Rye extends sf{constructor(e,i=new Dn){super(e,i),this.isVector2Uniform=!0,this.boundary=8,this.itemSize=2}}class Iye extends sf{constructor(e,i=new Nt){super(e,i),this.isVector3Uniform=!0,this.boundary=16,this.itemSize=3}}class Bye extends sf{constructor(e,i=new Zn){super(e,i),this.isVector4Uniform=!0,this.boundary=16,this.itemSize=4}}class Nye extends sf{constructor(e,i=new $n){super(e,i),this.isColorUniform=!0,this.boundary=16,this.itemSize=3}}class Lye extends sf{constructor(e,i=new Xo){super(e,i),this.isMatrix3Uniform=!0,this.boundary=48,this.itemSize=12}}class Dye extends sf{constructor(e,i=new ws){super(e,i),this.isMatrix4Uniform=!0,this.boundary=64,this.itemSize=16}}class Oye extends Mye{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class Pye extends Rye{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class kye extends Iye{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class Fye extends Bye{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class Uye extends Nye{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class zye extends Lye{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class jye extends Dye{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}const Qg=4,g7=[.125,.215,.35,.446,.526,.582],af=20,uI=new rR(-1,1,1,-1,0,1),Gye=new ih(90,1),A7=new $n;let hI=null,dI=0,pI=0;const of=(1+Math.sqrt(5))/2,qg=1/of,y7=[new Nt(-of,qg,0),new Nt(of,qg,0),new Nt(-qg,0,of),new Nt(qg,0,of),new Nt(0,of,-qg),new Nt(0,of,qg),new Nt(-1,1,-1),new Nt(1,1,-1),new Nt(-1,1,1),new Nt(1,1,1)],Vye=[3,1,5,0,4,2],fI=D0e(E_(),ch("faceIndex")).normalize(),mI=ti(fI.x,fI.y.negate(),fI.z);class Hye{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}fromScene(e,i=0,n=.1,s=100){hI=this._renderer.getRenderTarget(),dI=this._renderer.getActiveCubeFace(),pI=this._renderer.getActiveMipmapLevel(),this._setSize(256);const o=this._allocateTargets();return o.depthBuffer=!0,this._sceneToCubeUV(e,n,s,o),i>0&&this._blur(o,0,0,i),this._applyPMREM(o),this._cleanup(o),o}fromEquirectangular(e,i=null){return this._fromTexture(e,i)}fromCubemap(e,i=null){return this._fromTexture(e,i)}async compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=b7(),await this._compileMaterial(this._cubemapMaterial))}async compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=x7(),await this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(hI,dI,pI),e.scissorTest=!1,U_(e,0,0,e.width,e.height)}_fromTexture(e,i){e.mapping===kp||e.mapping===lg?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),hI=this._renderer.getRenderTarget(),dI=this._renderer.getActiveCubeFace(),pI=this._renderer.getActiveMipmapLevel();const n=i||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),i=4*this._cubeSize,n={magFilter:gl,minFilter:gl,generateMipmaps:!1,type:Qu,format:dg,colorSpace:gd},s=v7(e,i,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==i){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=v7(e,i,n);const{_lodMax:o}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas,lodMeshes:this._lodMeshes}=Wye(o)),this._blurMaterial=Qye(o,e,i)}return s}async _compileMaterial(e){const i=new Qp(this._lodPlanes[0],e);await this._renderer.compile(i,uI)}_sceneToCubeUV(e,i,n,s){const o=Gye;o.near=i,o.far=n;const l=[-1,1,-1,-1,-1,-1],u=[1,1,1,-1,-1,-1],c=this._renderer,h=c.autoClear;c.getClearColor(A7),c.autoClear=!1;let p=this._backgroundBox;if(p===null){const m=new K1({name:"PMREM.Background",side:yc,depthWrite:!1,depthTest:!1});p=new Qp(new yy,m)}let f=!1;const g=e.background;g?g.isColor&&(p.material.color.copy(g),e.background=null,f=!0):(p.material.color.copy(A7),f=!0),c.setRenderTarget(s),c.clear(),f&&c.render(p,o);for(let m=0;m<6;m++){const y=m%3;y===0?(o.up.set(0,l[m],0),o.lookAt(u[m],0,0)):y===1?(o.up.set(0,0,l[m]),o.lookAt(0,u[m],0)):(o.up.set(0,l[m],0),o.lookAt(0,0,u[m]));const b=this._cubeSize;U_(s,y*b,m>2?b:0,b,b),c.render(e,o)}c.autoClear=h,e.background=g}_textureToCubeUV(e,i){const n=this._renderer,s=e.mapping===kp||e.mapping===lg;s?this._cubemapMaterial===null&&(this._cubemapMaterial=b7(e)):this._equirectMaterial===null&&(this._equirectMaterial=x7(e));const o=s?this._cubemapMaterial:this._equirectMaterial;o.fragmentNode.value=e;const l=this._lodMeshes[0];l.material=o;const u=this._cubeSize;U_(i,0,0,3*u,2*u),n.setRenderTarget(i),n.render(l,uI)}_applyPMREM(e){const i=this._renderer,n=i.autoClear;i.autoClear=!1;const s=this._lodPlanes.length;for(let o=1;o<s;o++){const l=Math.sqrt(this._sigmas[o]*this._sigmas[o]-this._sigmas[o-1]*this._sigmas[o-1]),u=y7[(s-o-1)%y7.length];this._blur(e,o-1,o,l,u)}i.autoClear=n}_blur(e,i,n,s,o){const l=this._pingPongRenderTarget;this._halfBlur(e,l,i,n,s,"latitudinal",o),this._halfBlur(l,e,n,n,s,"longitudinal",o)}_halfBlur(e,i,n,s,o,l,u){const c=this._renderer,h=this._blurMaterial;l!=="latitudinal"&&l!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const p=3,f=this._lodMeshes[s];f.material=h;const g=h.uniforms,m=this._sizeLods[n]-1,y=isFinite(o)?Math.PI/(2*m):2*Math.PI/(2*af-1),b=o/y,v=isFinite(o)?1+Math.floor(p*b):af;v>af&&console.warn(`sigmaRadians, ${o}, is too large and will clip, as it requested ${v} samples when the maximum is set to ${af}`);const _=[];let C=0;for(let I=0;I<af;++I){const D=I/b,L=Math.exp(-D*D/2);_.push(L),I===0?C+=L:I<v&&(C+=2*L)}for(let I=0;I<_.length;I++)_[I]=_[I]/C;e.texture.frame=(e.texture.frame||0)+1,g.envMap.value=e.texture,g.samples.value=v,g.weights.array=_,g.latitudinal.value=l==="latitudinal"?1:0,u&&(g.poleAxis.value=u);const{_lodMax:E}=this;g.dTheta.value=y,g.mipInt.value=E-n;const T=this._sizeLods[s],R=3*T*(s>E-Qg?s-E+Qg:0),B=4*(this._cubeSize-T);U_(i,R,B,3*T,2*T),c.setRenderTarget(i),c.render(f,uI)}}function Wye(r){const e=[],i=[],n=[],s=[];let o=r;const l=r-Qg+1+g7.length;for(let u=0;u<l;u++){const c=Math.pow(2,o);i.push(c);let h=1/c;u>r-Qg?h=g7[u-r+Qg-1]:u===0&&(h=0),n.push(h);const p=1/(c-2),f=-p,g=1+p,m=[f,f,g,f,g,g,f,f,g,g,f,g],y=6,b=6,v=3,_=2,C=1,E=new Float32Array(v*b*y),T=new Float32Array(_*b*y),R=new Float32Array(C*b*y);for(let I=0;I<y;I++){const D=I%3*2/3-1,L=I>2?0:-1,O=[D,L,0,D+2/3,L,0,D+2/3,L+1,0,D,L,0,D+2/3,L+1,0,D,L+1,0],F=Vye[I];E.set(O,v*b*F),T.set(m,_*b*F);const q=[F,F,F,F,F,F];R.set(q,C*b*F)}const B=new Hp;B.setAttribute("position",new Fl(E,v)),B.setAttribute("uv",new Fl(T,_)),B.setAttribute("faceIndex",new Fl(R,C)),e.push(B),s.push(new Qp(B,null)),o>Qg&&o--}return{lodPlanes:e,sizeLods:i,sigmas:n,lodMeshes:s}}function v7(r,e,i){const n=new yg(r,e,i);return n.texture.mapping=ZM,n.texture.name="PMREM.cubeUv",n.texture.isPMREMTexture=!0,n.scissorTest=!0,n}function U_(r,e,i,n,s){r.viewport.set(e,i,n,s),r.scissor.set(e,i,n,s)}function gI(r){const e=new oa;return e.depthTest=!1,e.depthWrite=!1,e.blending=ag,e.name=`PMREM_${r}`,e}function Qye(r,e,i){const n=Ny(new Array(af).fill(0)),s=Zr(new Nt(0,1,0)),o=Zr(0),l=ri(af),u=Zr(0),c=Zr(1),h=ks(null),p=Zr(0),f=ri(1/e),g=ri(1/i),m=ri(r),y={n:l,latitudinal:u,weights:n,poleAxis:s,outputDirection:mI,dTheta:o,samples:c,envMap:h,mipInt:p,CUBEUV_TEXEL_WIDTH:f,CUBEUV_TEXEL_HEIGHT:g,CUBEUV_MAX_MIP:m},b=gI("blur");return b.uniforms=y,b.fragmentNode=P0e({...y,latitudinal:u.equal(1)}),b}function b7(r){const e=gI("cubemap");return e.fragmentNode=By(r,mI),e}function x7(r){const e=gI("equirect");return e.fragmentNode=ks(r,vz(mI),0),e}const _7=new WeakMap,qye=new Map([[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]),Xye=new Map([[Int8Array,"int"],[Int16Array,"int"],[Int32Array,"int"],[Uint8Array,"uint"],[Uint16Array,"uint"],[Uint32Array,"uint"],[Float32Array,"float"]]),z_=r=>/e/g.test(r)?String(r).replace(/\+/g,""):(r=Number(r),r+(r%1?"":".0"));class E7{constructor(e,i,n){this.object=e,this.material=e&&e.material||null,this.geometry=e&&e.geometry||null,this.renderer=i,this.parser=n,this.scene=null,this.camera=null,this.nodes=[],this.sequentialNodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.updateAfterNodes=[],this.hashNodes={},this.monitor=null,this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.clippingContext=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:""},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.structs={vertex:[],fragment:[],compute:[],index:0},this.bindings={vertex:{},fragment:{},compute:{}},this.bindingsIndexes={},this.bindGroups=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.codes={},this.vars={},this.flow={code:""},this.chaining=[],this.stack=JR(),this.stacks=[],this.tab="	",this.currentFunctionNode=null,this.context={material:this.material},this.cache=new cI,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null,this.useComparisonMethod=!1}getBindGroupsCache(){let e=_7.get(this.renderer);return e===void 0&&(e=new Zc,_7.set(this.renderer,e)),e}createRenderTarget(e,i,n){return new yg(e,i,n)}createCubeRenderTarget(e,i){return new bz(e,i)}createPMREMGenerator(){return new Hye(this.renderer)}includes(e){return this.nodes.includes(e)}_getBindGroup(e,i){const n=this.getBindGroupsCache(),s=[];let o=!0;for(const u of i)s.push(u),o=o&&u.groupNode.shared!==!0;let l;return o?(l=n.get(s),l===void 0&&(l=new lI(e,s,this.bindingsIndexes[e].group,s),n.set(s,l))):l=new lI(e,s,this.bindingsIndexes[e].group,s),l}getBindGroupArray(e,i){const n=this.bindings[i];let s=n[e];return s===void 0&&(this.bindingsIndexes[e]===void 0&&(this.bindingsIndexes[e]={binding:0,group:Object.keys(this.bindingsIndexes).length}),n[e]=s=[]),s}getBindings(){let e=this.bindGroups;if(e===null){const i={},n=this.bindings;for(const s of a8)for(const o in n[s]){const l=n[s][o];(i[o]||(i[o]=[])).push(...l)}e=[];for(const s in i){const o=i[s],l=this._getBindGroup(s,o);e.push(l)}this.bindGroups=e}return e}sortBindingGroups(){const e=this.getBindings();e.sort((i,n)=>i.bindings[0].groupNode.order-n.bindings[0].groupNode.order);for(let i=0;i<e.length;i++){const n=e[i];this.bindingsIndexes[n.name].group=i,n.index=i}}setHashNode(e,i){this.hashNodes[i]=e}addNode(e){this.nodes.includes(e)===!1&&(this.nodes.push(e),this.setHashNode(e,e.getHash(this)))}addSequentialNode(e){this.sequentialNodes.includes(e)===!1&&this.sequentialNodes.push(e)}buildUpdateNodes(){for(const e of this.nodes)e.getUpdateType()!==hn.NONE&&this.updateNodes.push(e.getSelf());for(const e of this.sequentialNodes){const i=e.getUpdateBeforeType(),n=e.getUpdateAfterType();i!==hn.NONE&&this.updateBeforeNodes.push(e.getSelf()),n!==hn.NONE&&this.updateAfterNodes.push(e.getSelf())}}get currentNode(){return this.chaining[this.chaining.length-1]}isFilteredTexture(e){return e.magFilter===gl||e.magFilter===e3||e.magFilter===ug||e.magFilter===Wu||e.minFilter===gl||e.minFilter===e3||e.minFilter===ug||e.minFilter===Wu}addChain(e){this.chaining.push(e)}removeChain(e){if(this.chaining.pop()!==e)throw new Error("NodeBuilder: Invalid node chaining!")}getMethod(e){return e}getNodeFromHash(e){return this.hashNodes[e]}addFlow(e,i){return this.flowNodes[e].push(i),i}setContext(e){this.context=e}getContext(){return this.context}getSharedContext(){return{...this.context},this.context}setCache(e){this.cache=e}getCache(){return this.cache}getCacheFromNode(e,i=!0){const n=this.getDataFromNode(e);return n.cache===void 0&&(n.cache=new cI(i?this.getCache():null)),n.cache}isAvailable(){return!1}getVertexIndex(){console.warn("Abstract function.")}getInstanceIndex(){console.warn("Abstract function.")}getDrawIndex(){console.warn("Abstract function.")}getFrontFacing(){console.warn("Abstract function.")}getFragCoord(){console.warn("Abstract function.")}isFlipY(){return!1}increaseUsage(e){const i=this.getDataFromNode(e);return i.usageCount=i.usageCount===void 0?1:i.usageCount+1,i.usageCount}generateTexture(){console.warn("Abstract function.")}generateTextureLod(){console.warn("Abstract function.")}generateConst(e,i=null){if(i===null&&(e==="float"||e==="int"||e==="uint"?i=0:e==="bool"?i=!1:e==="color"?i=new $n:e==="vec2"?i=new Dn:e==="vec3"?i=new Nt:e==="vec4"&&(i=new Zn)),e==="float")return z_(i);if(e==="int")return`${Math.round(i)}`;if(e==="uint")return i>=0?`${Math.round(i)}u`:"0u";if(e==="bool")return i?"true":"false";if(e==="color")return`${this.getType("vec3")}( ${z_(i.r)}, ${z_(i.g)}, ${z_(i.b)} )`;const n=this.getTypeLength(e),s=this.getComponentType(e),o=l=>this.generateConst(s,l);if(n===2)return`${this.getType(e)}( ${o(i.x)}, ${o(i.y)} )`;if(n===3)return`${this.getType(e)}( ${o(i.x)}, ${o(i.y)}, ${o(i.z)} )`;if(n===4)return`${this.getType(e)}( ${o(i.x)}, ${o(i.y)}, ${o(i.z)}, ${o(i.w)} )`;if(n>4&&i&&(i.isMatrix3||i.isMatrix4))return`${this.getType(e)}( ${i.elements.map(o).join(", ")} )`;if(n>4)return`${this.getType(e)}()`;throw new Error(`NodeBuilder: Type '${e}' not found in generate constant attempt.`)}getType(e){return e==="color"?"vec3":e}hasGeometryAttribute(e){return this.geometry&&this.geometry.getAttribute(e)!==void 0}getAttribute(e,i){const n=this.attributes;for(const o of n)if(o.name===e)return o;const s=new f7(e,i);return n.push(s),s}getPropertyName(e){return e.name}isVector(e){return/vec\d/.test(e)}isMatrix(e){return/mat\d/.test(e)}isReference(e){return e==="void"||e==="property"||e==="sampler"||e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="depthTexture"||e==="texture3D"}needsToWorkingColorSpace(){return!1}getComponentTypeFromTexture(e){const i=e.type;if(e.isDataTexture){if(i===Co)return"int";if(i===ja)return"uint"}return"float"}getElementType(e){return e==="mat2"?"vec2":e==="mat3"?"vec3":e==="mat4"?"vec4":this.getComponentType(e)}getComponentType(e){if(e=this.getVectorType(e),e==="float"||e==="bool"||e==="int"||e==="uint")return e;const i=/(b|i|u|)(vec|mat)([2-4])/.exec(e);return i===null?null:i[1]==="b"?"bool":i[1]==="i"?"int":i[1]==="u"?"uint":"float"}getVectorType(e){return e==="color"?"vec3":e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="texture3D"?"vec4":e}getTypeFromLength(e,i="float"){if(e===1)return i;const n=qye.get(e);return(i==="float"?"":i[0])+n}getTypeFromArray(e){return Xye.get(e.constructor)}getTypeFromAttribute(e){let i=e;e.isInterleavedBufferAttribute&&(i=e.data);const n=i.array,s=e.itemSize,o=e.normalized;let l;return!(e instanceof R6)&&o!==!0&&(l=this.getTypeFromArray(n)),this.getTypeFromLength(s,l)}getTypeLength(e){const i=this.getVectorType(e),n=/vec([2-4])/.exec(i);return n!==null?Number(n[1]):i==="float"||i==="bool"||i==="int"||i==="uint"?1:/mat2/.test(e)===!0?4:/mat3/.test(e)===!0?9:/mat4/.test(e)===!0?16:0}getVectorFromMatrix(e){return e.replace("mat","vec")}changeComponentType(e,i){return this.getTypeFromLength(this.getTypeLength(e),i)}getIntegerType(e){const i=this.getComponentType(e);return i==="int"||i==="uint"?e:this.changeComponentType(e,"int")}addStack(){return this.stack=JR(this.stack),this.stacks.push(g8()||this.stack),p_(this.stack),this.stack}removeStack(){const e=this.stack;return this.stack=e.parent,p_(this.stacks.pop()),e}getDataFromNode(e,i=this.shaderStage,n=null){n=n===null?e.isGlobal(this)?this.globalCache:this.cache:n;let s=n.getData(e);return s===void 0&&(s={},n.setData(e,s)),s[i]===void 0&&(s[i]={}),s[i]}getNodeProperties(e,i="any"){const n=this.getDataFromNode(e,i);return n.properties||(n.properties={outputNode:null})}getBufferAttributeFromNode(e,i){const n=this.getDataFromNode(e);let s=n.bufferAttribute;if(s===void 0){const o=this.uniforms.index++;s=new f7("nodeAttribute"+o,i,e),this.bufferAttributes.push(s),n.bufferAttribute=s}return s}getStructTypeFromNode(e,i=this.shaderStage){const n=this.getDataFromNode(e,i);if(n.structType===void 0){const s=this.structs.index++;e.name=`StructType${s}`,this.structs[i].push(e),n.structType=e}return e}getUniformFromNode(e,i,n=this.shaderStage,s=null){const o=this.getDataFromNode(e,n,this.globalCache);let l=o.uniform;if(l===void 0){const u=this.uniforms.index++;l=new wye(s||"nodeUniform"+u,i,e),this.uniforms[n].push(l),o.uniform=l}return l}getVarFromNode(e,i=null,n=e.getNodeType(this),s=this.shaderStage){const o=this.getDataFromNode(e,s);let l=o.variable;if(l===void 0){const u=this.vars[s]||(this.vars[s]=[]);i===null&&(i="nodeVar"+u.length),l=new m7(i,n),u.push(l),o.variable=l}return l}getVaryingFromNode(e,i=null,n=e.getNodeType(this)){const s=this.getDataFromNode(e,"any");let o=s.varying;if(o===void 0){const l=this.varyings,u=l.length;i===null&&(i="nodeVarying"+u),o=new Cye(i,n),l.push(o),s.varying=o}return o}getCodeFromNode(e,i,n=this.shaderStage){const s=this.getDataFromNode(e);let o=s.code;if(o===void 0){const l=this.codes[n]||(this.codes[n]=[]),u=l.length;o=new Sye("nodeCode"+u,i),l.push(o),s.code=o}return o}addFlowCodeHierarchy(e,i){const{flowCodes:n,flowCodeBlock:s}=this.getDataFromNode(e);let o=!0,l=i;for(;l;){if(s.get(l)===!0){o=!1;break}l=this.getDataFromNode(l).parentNodeBlock}if(o)for(const u of n)this.addLineFlowCode(u)}addLineFlowCodeBlock(e,i,n){const s=this.getDataFromNode(e),o=s.flowCodes||(s.flowCodes=[]),l=s.flowCodeBlock||(s.flowCodeBlock=new WeakMap);o.push(i),l.set(n,!0)}addLineFlowCode(e,i=null){return e===""?this:(i!==null&&this.context.nodeBlock&&this.addLineFlowCodeBlock(i,e,this.context.nodeBlock),e=this.tab+e,/;\s*$/.test(e)||(e=e+`;
`),this.flow.code+=e,this)}addFlowCode(e){return this.flow.code+=e,this}addFlowTab(){return this.tab+="	",this}removeFlowTab(){return this.tab=this.tab.slice(0,-1),this}getFlowData(e){return this.flowsData.get(e)}flowNode(e){const i=e.getNodeType(this),n=this.flowChildNode(e,i);return this.flowsData.set(e,n),n}buildFunctionNode(e){const i=new eye,n=this.currentFunctionNode;return this.currentFunctionNode=i,i.code=this.buildFunctionCode(e),this.currentFunctionNode=n,i}flowShaderNode(e){const i=e.layout,n={[Symbol.iterator](){let l=0;const u=Object.values(this);return{next:()=>({value:u[l],done:l++>=u.length})}}};for(const l of i.inputs)n[l.name]=new DAe(l.type,l.name);e.layout=null;const s=e.call(n),o=this.flowStagesNode(s,i.type);return e.layout=i,o}flowStagesNode(e,i=null){const n=this.flow,s=this.vars,o=this.cache,l=this.buildStage,u=this.stack,c={code:""};this.flow=c,this.vars={},this.cache=new cI,this.stack=JR();for(const h of s8)this.setBuildStage(h),c.result=e.build(this,i);return c.vars=this.getVars(this.shaderStage),this.flow=n,this.vars=s,this.cache=o,this.stack=u,this.setBuildStage(l),c}getFunctionOperator(){return null}flowChildNode(e,i=null){const n=this.flow,s={code:""};return this.flow=s,s.result=e.build(this,i),this.flow=n,s}flowNodeFromShaderStage(e,i,n=null,s=null){const o=this.shaderStage;this.setShaderStage(e);const l=this.flowChildNode(i,n);return s!==null&&(l.code+=`${this.tab+s} = ${l.result};
`),this.flowCode[e]=this.flowCode[e]+l.code,this.setShaderStage(o),l}getAttributesArray(){return this.attributes.concat(this.bufferAttributes)}getAttributes(){console.warn("Abstract function.")}getVaryings(){console.warn("Abstract function.")}getVar(e,i){return`${this.getType(e)} ${i}`}getVars(e){let i="";const n=this.vars[e];if(n!==void 0)for(const s of n)i+=`${this.getVar(s.type,s.name)}; `;return i}getUniforms(){console.warn("Abstract function.")}getCodes(e){const i=this.codes[e];let n="";if(i!==void 0)for(const s of i)n+=s.code+`
`;return n}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(e){this.shaderStage=e}getShaderStage(){return this.shaderStage}setBuildStage(e){this.buildStage=e}getBuildStage(){return this.buildStage}buildCode(){console.warn("Abstract function.")}build(){const{object:e,material:i,renderer:n}=this;if(i!==null){let s=n.library.fromMaterial(i);s===null&&(console.error(`NodeMaterial: Material "${i.type}" is not compatible.`),s=new oa),s.build(this)}else this.addFlow("compute",e);for(const s of s8){this.setBuildStage(s),this.context.vertex&&this.context.vertex.isNode&&this.flowNodeFromShaderStage("vertex",this.context.vertex);for(const o of a8){this.setShaderStage(o);const l=this.flowNodes[o];for(const u of l)s==="generate"?this.flowNode(u):u.build(this)}}return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this.buildUpdateNodes(),this}getNodeUniform(e,i){if(i==="float"||i==="int"||i==="uint")return new Oye(e);if(i==="vec2"||i==="ivec2"||i==="uvec2")return new Pye(e);if(i==="vec3"||i==="ivec3"||i==="uvec3")return new kye(e);if(i==="vec4"||i==="ivec4"||i==="uvec4")return new Fye(e);if(i==="color")return new Uye(e);if(i==="mat3")return new zye(e);if(i==="mat4")return new jye(e);throw new Error(`Uniform "${i}" not declared.`)}createNodeMaterial(e="NodeMaterial"){throw new Error(`THREE.NodeBuilder: createNodeMaterial() was deprecated. Use new ${e}() instead.`)}format(e,i,n){if(i=this.getVectorType(i),n=this.getVectorType(n),i===n||n===null||this.isReference(n))return e;const s=this.getTypeLength(i),o=this.getTypeLength(n);return s===16&&o===9?`${this.getType(n)}(${e}[0].xyz, ${e}[1].xyz, ${e}[2].xyz)`:s===9&&o===4?`${this.getType(n)}(${e}[0].xy, ${e}[1].xy)`:s>4||o>4||o===0?e:s===o?`${this.getType(n)}( ${e} )`:s>o?this.format(`${e}.${"xyz".slice(0,o)}`,this.getTypeFromLength(o,this.getComponentType(i)),n):o===4&&s>1?`${this.getType(n)}( ${this.format(e,i,"vec3")}, 1.0 )`:s===2?`${this.getType(n)}( ${this.format(e,i,"vec2")}, 0.0 )`:(s===1&&o>1&&i!==this.getComponentType(n)&&(e=`${this.getType(this.getComponentType(n))}( ${e} )`),`${this.getType(n)}( ${e} )`)}getSignature(){return`// Three.js r${S1} - Node System
`}}class w7{constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.startTime=null,this.updateMap=new WeakMap,this.updateBeforeMap=new WeakMap,this.updateAfterMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null}_getMaps(e,i){let n=e.get(i);return n===void 0&&(n={renderMap:new WeakMap,frameMap:new WeakMap},e.set(i,n)),n}updateBeforeNode(e){const i=e.getUpdateBeforeType(),n=e.updateReference(this);if(i===hn.FRAME){const{frameMap:s}=this._getMaps(this.updateBeforeMap,n);s.get(n)!==this.frameId&&e.updateBefore(this)!==!1&&s.set(n,this.frameId)}else if(i===hn.RENDER){const{renderMap:s}=this._getMaps(this.updateBeforeMap,n);s.get(n)!==this.renderId&&e.updateBefore(this)!==!1&&s.set(n,this.renderId)}else i===hn.OBJECT&&e.updateBefore(this)}updateAfterNode(e){const i=e.getUpdateAfterType(),n=e.updateReference(this);if(i===hn.FRAME){const{frameMap:s}=this._getMaps(this.updateAfterMap,n);s.get(n)!==this.frameId&&e.updateAfter(this)!==!1&&s.set(n,this.frameId)}else if(i===hn.RENDER){const{renderMap:s}=this._getMaps(this.updateAfterMap,n);s.get(n)!==this.renderId&&e.updateAfter(this)!==!1&&s.set(n,this.renderId)}else i===hn.OBJECT&&e.updateAfter(this)}updateNode(e){const i=e.getUpdateType(),n=e.updateReference(this);if(i===hn.FRAME){const{frameMap:s}=this._getMaps(this.updateMap,n);s.get(n)!==this.frameId&&e.update(this)!==!1&&s.set(n,this.frameId)}else if(i===hn.RENDER){const{renderMap:s}=this._getMaps(this.updateMap,n);s.get(n)!==this.renderId&&e.update(this)!==!1&&s.set(n,this.renderId)}else i===hn.OBJECT&&e.update(this)}update(){this.frameId++,this.lastTime===void 0&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}}class AI{constructor(e,i,n=null,s="",o=!1){this.type=e,this.name=i,this.count=n,this.qualifier=s,this.isConst=o}}AI.isNodeFunctionInput=!0;class Kye extends nf{static get type(){return"DirectionalLightNode"}constructor(e=null){super(e)}setup(e){super.setup(e);const i=e.context.lightingModel,n=this.colorNode,s=h7(this.light),o=e.context.reflectedLight;i.direct({lightDirection:s,lightColor:n,reflectedLight:o},e.stack,e)}}const yI=new ws,j_=new ws;let Hy=null;class Yye extends nf{static get type(){return"RectAreaLightNode"}constructor(e=null){super(e),this.halfHeight=Zr(new Nt).setGroup(Mn),this.halfWidth=Zr(new Nt).setGroup(Mn),this.updateType=hn.RENDER}update(e){super.update(e);const{light:i}=this,n=e.camera.matrixWorldInverse;j_.identity(),yI.copy(i.matrixWorld),yI.premultiply(n),j_.extractRotation(yI),this.halfWidth.value.set(i.width*.5,0,0),this.halfHeight.value.set(0,i.height*.5,0),this.halfWidth.value.applyMatrix4(j_),this.halfHeight.value.applyMatrix4(j_)}setup(e){super.setup(e);let i,n;e.isAvailable("float32Filterable")?(i=ks(Hy.LTC_FLOAT_1),n=ks(Hy.LTC_FLOAT_2)):(i=ks(Hy.LTC_HALF_1),n=ks(Hy.LTC_HALF_2));const{colorNode:s,light:o}=this,l=e.context.lightingModel,u=aI(o),c=e.context.reflectedLight;l.directRectArea({lightColor:s,lightPosition:u,halfWidth:this.halfWidth,halfHeight:this.halfHeight,reflectedLight:c,ltc_1:i,ltc_2:n},e.stack,e)}static setLTC(e){Hy=e}}class C7 extends nf{static get type(){return"SpotLightNode"}constructor(e=null){super(e),this.coneCosNode=Zr(0).setGroup(Mn),this.penumbraCosNode=Zr(0).setGroup(Mn),this.cutoffDistanceNode=Zr(0).setGroup(Mn),this.decayExponentNode=Zr(0).setGroup(Mn)}update(e){super.update(e);const{light:i}=this;this.coneCosNode.value=Math.cos(i.angle),this.penumbraCosNode.value=Math.cos(i.angle*(1-i.penumbra)),this.cutoffDistanceNode.value=i.distance,this.decayExponentNode.value=i.decay}getSpotAttenuation(e){const{coneCosNode:i,penumbraCosNode:n}=this;return Jp(i,n,e)}setup(e){super.setup(e);const i=e.context.lightingModel,{colorNode:n,cutoffDistanceNode:s,decayExponentNode:o,light:l}=this,u=aI(l).sub(Wa),c=u.normalize(),h=c.dot(h7(l)),p=this.getSpotAttenuation(h),f=u.length(),g=p7({lightDistance:f,cutoffDistance:s,decayExponent:o}),m=n.mul(p).mul(g),y=e.context.reflectedLight;i.direct({lightDirection:c,lightColor:m,reflectedLight:y},e.stack,e)}}class Jye extends C7{static get type(){return"IESSpotLightNode"}getSpotAttenuation(e){const i=this.light.iesMap;let n=null;if(i&&i.isTexture===!0){const s=e.acos().mul(1/Math.PI);n=ks(i,Ji(s,0),0).r}else n=super.getSpotAttenuation(e);return n}}class Zye extends nf{static get type(){return"AmbientLightNode"}constructor(e=null){super(e)}setup({context:e}){e.irradiance.addAssign(this.colorNode)}}class $ye extends nf{static get type(){return"HemisphereLightNode"}constructor(e=null){super(e),this.lightPositionNode=u7(e),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=Zr(new $n).setGroup(Mn)}update(e){const{light:i}=this;super.update(e),this.lightPositionNode.object3d=i,this.groundColorNode.value.copy(i.groundColor).multiplyScalar(i.intensity)}setup(e){const{colorNode:i,groundColorNode:n,lightDirectionNode:s}=this,o=Mc.dot(s).mul(.5).add(.5),l=As(n,i,o);e.context.irradiance.addAssign(l)}}class eve extends nf{static get type(){return"LightProbeNode"}constructor(e=null){super(e);const i=[];for(let n=0;n<9;n++)i.push(new Nt);this.lightProbe=Ny(i)}update(e){const{light:i}=this;super.update(e);for(let n=0;n<9;n++)this.lightProbe.array[n].copy(i.sh.coefficients[n]).multiplyScalar(i.intensity)}setup(e){const i=bye(J8,this.lightProbe);e.context.irradiance.addAssign(i)}}class S7{parseFunction(){console.warn("Abstract function.")}}class vI{constructor(e,i,n="",s=""){this.type=e,this.inputs=i,this.name=n,this.precision=s}getCode(){console.warn("Abstract function.")}}vI.isNodeFunction=!0;const tve=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,ive=/[a-z_0-9]+/ig,T7="#pragma main",rve=r=>{r=r.trim();const e=r.indexOf(T7),i=e!==-1?r.slice(e+T7.length):r,n=i.match(tve);if(n!==null&&n.length===5){const s=n[4],o=[];let l=null;for(;(l=ive.exec(s))!==null;)o.push(l);const u=[];let c=0;for(;c<o.length;){const y=o[c][0]==="const";y===!0&&c++;let b=o[c][0];b==="in"||b==="out"||b==="inout"?c++:b="";const v=o[c++][0];let _=Number.parseInt(o[c][0]);Number.isNaN(_)===!1?c++:_=null;const C=o[c++][0];u.push(new AI(v,C,_,b,y))}const h=i.substring(n[0].length),p=n[3]!==void 0?n[3]:"",f=n[2],g=n[1]!==void 0?n[1]:"",m=e!==-1?r.slice(0,e):"";return{type:f,inputs:u,name:p,precision:g,inputsCode:s,blockCode:h,headerCode:m}}else throw new Error("FunctionNode: Function is not a GLSL code.")};class nve extends vI{constructor(e){const{type:i,inputs:n,name:s,precision:o,inputsCode:l,blockCode:u,headerCode:c}=rve(e);super(i,n,s,o),this.inputsCode=l,this.blockCode=u,this.headerCode=c}getCode(e=this.name){let i;const n=this.blockCode;if(n!==""){const{type:s,inputsCode:o,headerCode:l,precision:u}=this;let c=`${s} ${e} ( ${o.trim()} )`;u!==""&&(c=`${u} ${c}`),i=l+c+n}else i="";return i}}class sve extends S7{parseFunction(e){return new nve(e)}}const M7=new WeakMap;class ave extends Id{constructor(e,i){super(),this.renderer=e,this.backend=i,this.nodeFrame=new w7,this.nodeBuilderCache=new Map,this.callHashCache=new Zc,this.groupsData=new Zc}updateGroup(e){const i=e.groupNode,n=i.name;if(n===v8.name)return!0;if(n===Mn.name){const l=this.get(e),u=this.nodeFrame.renderId;return l.renderId!==u?(l.renderId=u,!0):!1}if(n===Vpe.name){const l=this.get(e),u=this.nodeFrame.frameId;return l.frameId!==u?(l.frameId=u,!0):!1}const s=[i,e];let o=this.groupsData.get(s);return o===void 0&&this.groupsData.set(s,o={}),o.version!==i.version?(o.version=i.version,!0):!1}getForRenderCacheKey(e){return e.initialCacheKey}getForRender(e){const i=this.get(e);let n=i.nodeBuilderState;if(n===void 0){const{nodeBuilderCache:s}=this,o=this.getForRenderCacheKey(e);if(n=s.get(o),n===void 0){const l=this.backend.createNodeBuilder(e.object,this.renderer);l.scene=e.scene,l.material=e.material,l.camera=e.camera,l.context.material=e.material,l.lightsNode=e.lightsNode,l.environmentNode=this.getEnvironmentNode(e.scene),l.fogNode=this.getFogNode(e.scene),l.clippingContext=e.clippingContext,l.build(),n=this._createNodeBuilderState(l),s.set(o,n)}n.usedTimes++,i.nodeBuilderState=n}return n}delete(e){if(e.isRenderObject){const i=this.get(e).nodeBuilderState;i.usedTimes--,i.usedTimes===0&&this.nodeBuilderCache.delete(this.getForRenderCacheKey(e))}return super.delete(e)}getForCompute(e){const i=this.get(e);let n=i.nodeBuilderState;if(n===void 0){const s=this.backend.createNodeBuilder(e,this.renderer);s.build(),n=this._createNodeBuilderState(s),i.nodeBuilderState=n}return n}_createNodeBuilderState(e){return new Eye(e.vertexShader,e.fragmentShader,e.computeShader,e.getAttributesArray(),e.getBindings(),e.updateNodes,e.updateBeforeNodes,e.updateAfterNodes,e.monitor,e.transforms)}getEnvironmentNode(e){return e.environmentNode||this.get(e).environmentNode||null}getBackgroundNode(e){return e.backgroundNode||this.get(e).backgroundNode||null}getFogNode(e){return e.fogNode||this.get(e).fogNode||null}getCacheKey(e,i){const n=[e,i],s=this.renderer.info.calls;let o=this.callHashCache.get(n);if(o===void 0||o.callId!==s){const l=this.getEnvironmentNode(e),u=this.getFogNode(e),c=[];i&&c.push(i.getCacheKey(!0)),l&&c.push(l.getCacheKey()),u&&c.push(u.getCacheKey()),c.push(this.renderer.shadowMap.enabled?1:0),o={callId:s,cacheKey:t8(c)},this.callHashCache.set(n,o)}return o.cacheKey}updateScene(e){this.updateEnvironment(e),this.updateFog(e),this.updateBackground(e)}get isToneMappingState(){return!this.renderer.getRenderTarget()}updateBackground(e){const i=this.get(e),n=e.background;if(n){const s=e.backgroundBlurriness===0&&i.backgroundBlurriness>0||e.backgroundBlurriness>0&&i.backgroundBlurriness===0;if(i.background!==n||s){let o=null;if(n.isCubeTexture===!0||n.mapping===iy||n.mapping===ry||n.mapping===ZM)if(e.backgroundBlurriness>0||n.mapping===ZM)o=qz(n);else{let l;n.isCubeTexture===!0?l=By(n):l=ks(n),o=Ez(l)}else n.isTexture===!0?o=ks(n,ky.flipY()).setUpdateMatrix(!0):n.isColor!==!0&&console.error("WebGPUNodes: Unsupported background configuration.",n);i.backgroundNode=o,i.background=n,i.backgroundBlurriness=e.backgroundBlurriness}}else i.backgroundNode&&(delete i.backgroundNode,delete i.background)}updateFog(e){const i=this.get(e),n=e.fog;if(n){if(i.fog!==n){let s=null;if(n.isFogExp2){const o=Bs("color","color",n).setGroup(Mn),l=Bs("density","float",n).setGroup(Mn);s=nye(o,l)}else if(n.isFog){const o=Bs("color","color",n).setGroup(Mn),l=Bs("near","float",n).setGroup(Mn),u=Bs("far","float",n).setGroup(Mn);s=iye(o,l,u)}else console.error("WebGPUNodes: Unsupported fog configuration.",n);i.fogNode=s,i.fog=n}}else delete i.fogNode,delete i.fog}updateEnvironment(e){const i=this.get(e),n=e.environment;if(n){if(i.environment!==n){let s=null;n.isCubeTexture===!0?s=By(n):n.isTexture===!0?s=ks(n):console.error("Nodes: Unsupported environment configuration.",n),i.environmentNode=s,i.environment=n}}else i.environmentNode&&(delete i.environmentNode,delete i.environment)}getNodeFrame(e=this.renderer,i=null,n=null,s=null,o=null){const l=this.nodeFrame;return l.renderer=e,l.scene=i,l.object=n,l.camera=s,l.material=o,l}getNodeFrameForRender(e){return this.getNodeFrame(e.renderer,e.scene,e.object,e.camera,e.material)}getOutputCacheKey(){const e=this.renderer;return e.toneMapping+","+e.currentColorSpace}hasOutputChange(e){return M7.get(e)!==this.getOutputCacheKey()}getOutputNode(e){const i=this.renderer,n=this.getOutputCacheKey(),s=ks(e,ky).renderOutput(i.toneMapping,i.currentColorSpace);return M7.set(e,n),s}updateBefore(e){const i=e.getNodeBuilderState();for(const n of i.updateBeforeNodes)this.getNodeFrameForRender(e).updateBeforeNode(n)}updateAfter(e){const i=e.getNodeBuilderState();for(const n of i.updateAfterNodes)this.getNodeFrameForRender(e).updateAfterNode(n)}updateForCompute(e){const i=this.getNodeFrame(),n=this.getForCompute(e);for(const s of n.updateNodes)i.updateNode(s)}updateForRender(e){const i=this.getNodeFrameForRender(e),n=e.getNodeBuilderState();for(const s of n.updateNodes)i.updateNode(s)}needsRefresh(e){const i=this.getNodeFrameForRender(e);return e.getMonitor().needsRefresh(e,i)}dispose(){super.dispose(),this.nodeFrame=new w7,this.nodeBuilderCache=new Map}}class ove{constructor(e,i){this.scene=e,this.camera=i}clone(){return Object.assign(new this.constructor,this)}}class lve{constructor(){this.lists=new Zc}get(e,i){const n=this.lists,s=[e,i];let o=n.get(s);return o===void 0&&(o=new ove(e,i),n.set(s,o)),o}dispose(){this.lists=new Zc}}class R7{constructor(){this.lightNodes=new WeakMap,this.materialNodes=new Map,this.toneMappingNodes=new Map}fromMaterial(e){if(e.isNodeMaterial)return e;let i=null;const n=this.getMaterialNodeClass(e.type);if(n!==null){i=new n;for(const s in e)i[s]=e[s]}return i}addToneMapping(e,i){this.addType(e,i,this.toneMappingNodes)}getToneMappingFunction(e){return this.toneMappingNodes.get(e)||null}getMaterialNodeClass(e){return this.materialNodes.get(e)||null}addMaterial(e,i){this.addType(e,i.type,this.materialNodes)}getLightNodeClass(e){return this.lightNodes.get(e)||null}addLight(e,i){this.addClass(e,i,this.lightNodes)}addType(e,i,n){if(n.has(i)){console.warn(`Redefinition of node ${i}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof i=="function"||typeof i=="object")throw new Error(`Base class ${i} is not a class.`);n.set(i,e)}addClass(e,i,n){if(n.has(i)){console.warn(`Redefinition of node ${i.name}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof i!="function")throw new Error(`Base class ${i.name} is not a class.`);n.set(i,e)}}const cve=new d7;class uve extends Zc{constructor(){super()}createNode(e=[]){return new d7().setLights(e)}getNode(e,i){if(e.isQuadMesh)return cve;const n=[e,i];let s=this.get(n);return s===void 0&&(s=this.createNode(),this.set(n,s)),s}}const I7=new F6,G_=new Dn,bI=new Zn,xI=new j6,V_=new ws,Ld=new Zn;class hve{constructor(e,i={}){this.isRenderer=!0;const{logarithmicDepthBuffer:n=!1,alpha:s=!0,depth:o=!0,stencil:l=!1,antialias:u=!1,samples:c=0,getFallback:h=null}=i;this.domElement=e.getDomElement(),this.backend=e,this.samples=c||u===!0?4:0,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.alpha=s,this.logarithmicDepthBuffer=n,this.outputColorSpace=Lr,this.toneMapping=og,this.toneMappingExposure=1,this.sortObjects=!0,this.depth=o,this.stencil=l,this.clippingPlanes=[],this.info=new bAe,this.nodes={modelViewMatrix:null,modelNormalViewMatrix:null},this.library=new R7,this.lighting=new uve,this._getFallback=h,this._pixelRatio=1,this._width=this.domElement.width,this._height=this.domElement.height,this._viewport=new Zn(0,0,this._width,this._height),this._scissor=new Zn(0,0,this._width,this._height),this._scissorTest=!1,this._attributes=null,this._geometries=null,this._nodes=null,this._animation=null,this._bindings=null,this._objects=null,this._pipelines=null,this._bundles=null,this._renderLists=null,this._renderContexts=null,this._textures=null,this._background=null,this._quad=new r7(new oa),this._quad.material.type="Renderer_output",this._currentRenderContext=null,this._opaqueSort=null,this._transparentSort=null,this._frameBufferTarget=null;const p=this.alpha===!0?0:1;this._clearColor=new YR(0,0,0,p),this._clearDepth=1,this._clearStencil=0,this._renderTarget=null,this._activeCubeFace=0,this._activeMipmapLevel=0,this._mrt=null,this._renderObjectFunction=null,this._currentRenderObjectFunction=null,this._currentRenderBundle=null,this._handleObjectFunction=this._renderObjectDirect,this._isDeviceLost=!1,this.onDeviceLost=this._onDeviceLost,this._initialized=!1,this._initPromise=null,this._compilationPromises=null,this.transparent=!0,this.opaque=!0,this.shadowMap={enabled:!1,type:xhe},this.xr={enabled:!1},this.debug={checkShaderErrors:!0,onShaderError:null,getShaderAsync:async(f,g,m)=>{await this.compileAsync(f,g);const y=this._renderLists.get(f,g),b=this._renderContexts.get(f,g,this._renderTarget),v=f.overrideMaterial||m.material,_=this._objects.get(m,v,f,g,y.lightsNode,b),{fragmentShader:C,vertexShader:E}=_.getNodeBuilderState();return{fragmentShader:C,vertexShader:E}}}}async init(){if(this._initialized)throw new Error("Renderer: Backend has already been initialized.");return this._initPromise!==null?this._initPromise:(this._initPromise=new Promise(async(e,i)=>{let n=this.backend;try{await n.init(this)}catch(s){if(this._getFallback!==null)try{this.backend=n=this._getFallback(s),await n.init(this)}catch(o){i(o);return}else{i(s);return}}this._nodes=new ave(this,n),this._animation=new uAe(this._nodes,this.info),this._attributes=new AAe(n),this._background=new xye(this,this._nodes),this._geometries=new vAe(this._attributes,this.info),this._textures=new LAe(this,n,this.info),this._pipelines=new wAe(n,this._nodes),this._bindings=new CAe(n,this._nodes,this._textures,this._attributes,this._pipelines,this.info),this._objects=new fAe(this,this._nodes,this._geometries,this._pipelines,this._bindings,this.info),this._renderLists=new MAe(this.lighting),this._bundles=new lve,this._renderContexts=new BAe,this._initialized=!0,e()}),this._initPromise)}get coordinateSystem(){return this.backend.coordinateSystem}async compileAsync(e,i,n=null){if(this._isDeviceLost===!0)return;this._initialized===!1&&await this.init();const s=this._nodes.nodeFrame,o=s.renderId,l=this._currentRenderContext,u=this._currentRenderObjectFunction,c=this._compilationPromises,h=e.isScene===!0?e:I7;n===null&&(n=e);const p=this._renderTarget,f=this._renderContexts.get(n,i,p),g=this._activeMipmapLevel,m=[];this._currentRenderContext=f,this._currentRenderObjectFunction=this.renderObject,this._handleObjectFunction=this._createObjectPipeline,this._compilationPromises=m,s.renderId++,s.update(),f.depth=this.depth,f.stencil=this.stencil,f.clippingContext||(f.clippingContext=new XR),f.clippingContext.updateGlobal(this,i),h.onBeforeRender(this,e,i,p);const y=this._renderLists.get(e,i);if(y.begin(),this._projectObject(e,i,0,y),n!==e&&n.traverseVisible(function(C){C.isLight&&C.layers.test(i.layers)&&y.pushLight(C)}),y.finish(),p!==null){this._textures.updateRenderTarget(p,g);const C=this._textures.get(p);f.textures=C.textures,f.depthTexture=C.depthTexture}else f.textures=null,f.depthTexture=null;this._nodes.updateScene(h),this._background.update(h,y,f);const b=y.opaque,v=y.transparent,_=y.lightsNode;this.opaque===!0&&b.length>0&&this._renderObjects(b,i,h,_),this.transparent===!0&&v.length>0&&this._renderTransparents(v,i,h,_),s.renderId=o,this._currentRenderContext=l,this._currentRenderObjectFunction=u,this._compilationPromises=c,this._handleObjectFunction=this._renderObjectDirect,await Promise.all(m)}async renderAsync(e,i){this._initialized===!1&&await this.init();const n=this._renderScene(e,i);await this.backend.resolveTimestampAsync(n,"render")}async waitForGPU(){await this.backend.waitForGPU()}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}_onDeviceLost(e){let i=`THREE.WebGPURenderer: ${e.api} Device Lost:

Message: ${e.message}`;e.reason&&(i+=`
Reason: ${e.reason}`),console.error(i),this._isDeviceLost=!0}_renderBundle(e,i,n){const{bundleGroup:s,camera:o,renderList:l}=e,u=this._currentRenderContext,c=this._bundles.get(s,o),h=this.backend.get(c);h.renderContexts===void 0&&(h.renderContexts=new Set);const p=s.version!==h.version,f=h.renderContexts.has(u)===!1||p;if(h.renderContexts.add(u),f){this.backend.beginBundle(u),(h.renderObjects===void 0||p)&&(h.renderObjects=[]),this._currentRenderBundle=c;const g=l.opaque;this.opaque===!0&&g.length>0&&this._renderObjects(g,o,i,n),this._currentRenderBundle=null,this.backend.finishBundle(u,c),h.version=s.version}else{const{renderObjects:g}=h;for(let m=0,y=g.length;m<y;m++){const b=g[m];this._nodes.needsRefresh(b)&&(this._nodes.updateBefore(b),this._nodes.updateForRender(b),this._bindings.updateForRender(b),this._nodes.updateAfter(b))}}this.backend.addBundle(u,c)}render(e,i){if(this._initialized===!1)return console.warn("THREE.Renderer: .render() called before the backend is initialized. Try using .renderAsync() instead."),this.renderAsync(e,i);this._renderScene(e,i)}_getFrameBufferTarget(){const{currentToneMapping:e,currentColorSpace:i}=this;if(e===og&&i===gd)return null;const{width:n,height:s}=this.getDrawingBufferSize(G_),{depth:o,stencil:l}=this;let u=this._frameBufferTarget;return u===null&&(u=new yg(n,s,{depthBuffer:o,stencilBuffer:l,type:Qu,format:dg,colorSpace:gd,generateMipmaps:!1,minFilter:gl,magFilter:gl,samples:this.samples}),u.isPostProcessingRenderTarget=!0,this._frameBufferTarget=u),u.depthBuffer=o,u.stencilBuffer=l,u.setSize(n,s),u.viewport.copy(this._viewport),u.scissor.copy(this._scissor),u.viewport.multiplyScalar(this._pixelRatio),u.scissor.multiplyScalar(this._pixelRatio),u.scissorTest=this._scissorTest,u}_renderScene(e,i,n=!0){if(this._isDeviceLost===!0)return;const s=n?this._getFrameBufferTarget():null,o=this._nodes.nodeFrame,l=o.renderId,u=this._currentRenderContext,c=this._currentRenderObjectFunction,h=e.isScene===!0?e:I7,p=this._renderTarget,f=this._activeCubeFace,g=this._activeMipmapLevel;let m;s!==null?(m=s,this.setRenderTarget(m)):m=p;const y=this._renderContexts.get(e,i,m);this._currentRenderContext=y,this._currentRenderObjectFunction=this._renderObjectFunction||this.renderObject,this.info.calls++,this.info.render.calls++,this.info.render.frameCalls++,o.renderId=this.info.calls;const b=this.coordinateSystem;i.coordinateSystem!==b&&(i.coordinateSystem=b,i.updateProjectionMatrix()),e.matrixWorldAutoUpdate===!0&&e.updateMatrixWorld(),i.parent===null&&i.matrixWorldAutoUpdate===!0&&i.updateMatrixWorld();let v=this._viewport,_=this._scissor,C=this._pixelRatio;m!==null&&(v=m.viewport,_=m.scissor,C=1),this.getDrawingBufferSize(G_),bI.set(0,0,G_.width,G_.height);const E=v.minDepth===void 0?0:v.minDepth,T=v.maxDepth===void 0?1:v.maxDepth;y.viewportValue.copy(v).multiplyScalar(C).floor(),y.viewportValue.width>>=g,y.viewportValue.height>>=g,y.viewportValue.minDepth=E,y.viewportValue.maxDepth=T,y.viewport=y.viewportValue.equals(bI)===!1,y.scissorValue.copy(_).multiplyScalar(C).floor(),y.scissor=this._scissorTest&&y.scissorValue.equals(bI)===!1,y.scissorValue.width>>=g,y.scissorValue.height>>=g,y.clippingContext||(y.clippingContext=new XR),y.clippingContext.updateGlobal(this,i),h.onBeforeRender(this,e,i,m),V_.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),xI.setFromProjectionMatrix(V_,b);const R=this._renderLists.get(e,i);if(R.begin(),this._projectObject(e,i,0,R),R.finish(),this.sortObjects===!0&&R.sort(this._opaqueSort,this._transparentSort),m!==null){this._textures.updateRenderTarget(m,g);const F=this._textures.get(m);y.textures=F.textures,y.depthTexture=F.depthTexture,y.width=F.width,y.height=F.height,y.renderTarget=m,y.depth=m.depthBuffer,y.stencil=m.stencilBuffer}else y.textures=null,y.depthTexture=null,y.width=this.domElement.width,y.height=this.domElement.height,y.depth=this.depth,y.stencil=this.stencil;y.width>>=g,y.height>>=g,y.activeCubeFace=f,y.activeMipmapLevel=g,y.occlusionQueryCount=R.occlusionQueryCount,this._nodes.updateScene(h),this._background.update(h,R,y),this.backend.beginRender(y);const{bundles:B,lightsNode:I,transparentDoublePass:D,transparent:L,opaque:O}=R;if(B.length>0&&this._renderBundles(B,h,I),this.opaque===!0&&O.length>0&&this._renderObjects(O,i,h,I),this.transparent===!0&&L.length>0&&this._renderTransparents(L,D,i,h,I),this.backend.finishRender(y),o.renderId=l,this._currentRenderContext=u,this._currentRenderObjectFunction=c,s!==null){this.setRenderTarget(p,f,g);const F=this._quad;this._nodes.hasOutputChange(m.texture)&&(F.material.fragmentNode=this._nodes.getOutputNode(m.texture),F.material.needsUpdate=!0),this._renderScene(F,F.camera,!1)}return h.onAfterRender(this,e,i,m),y}getMaxAnisotropy(){return this.backend.getMaxAnisotropy()}getActiveCubeFace(){return this._activeCubeFace}getActiveMipmapLevel(){return this._activeMipmapLevel}async setAnimationLoop(e){this._initialized===!1&&await this.init(),this._animation.setAnimationLoop(e)}async getArrayBufferAsync(e){return await this.backend.getArrayBufferAsync(e)}getContext(){return this.backend.getContext()}getPixelRatio(){return this._pixelRatio}getDrawingBufferSize(e){return e.set(this._width*this._pixelRatio,this._height*this._pixelRatio).floor()}getSize(e){return e.set(this._width,this._height)}setPixelRatio(e=1){this._pixelRatio!==e&&(this._pixelRatio=e,this.setSize(this._width,this._height,!1))}setDrawingBufferSize(e,i,n){this._width=e,this._height=i,this._pixelRatio=n,this.domElement.width=Math.floor(e*n),this.domElement.height=Math.floor(i*n),this.setViewport(0,0,e,i),this._initialized&&this.backend.updateSize()}setSize(e,i,n=!0){this._width=e,this._height=i,this.domElement.width=Math.floor(e*this._pixelRatio),this.domElement.height=Math.floor(i*this._pixelRatio),n===!0&&(this.domElement.style.width=e+"px",this.domElement.style.height=i+"px"),this.setViewport(0,0,e,i),this._initialized&&this.backend.updateSize()}setOpaqueSort(e){this._opaqueSort=e}setTransparentSort(e){this._transparentSort=e}getScissor(e){const i=this._scissor;return e.x=i.x,e.y=i.y,e.width=i.width,e.height=i.height,e}setScissor(e,i,n,s){const o=this._scissor;e.isVector4?o.copy(e):o.set(e,i,n,s)}getScissorTest(){return this._scissorTest}setScissorTest(e){this._scissorTest=e,this.backend.setScissorTest(e)}getViewport(e){return e.copy(this._viewport)}setViewport(e,i,n,s,o=0,l=1){const u=this._viewport;e.isVector4?u.copy(e):u.set(e,i,n,s),u.minDepth=o,u.maxDepth=l}getClearColor(e){return e.copy(this._clearColor)}setClearColor(e,i=1){this._clearColor.set(e),this._clearColor.a=i}getClearAlpha(){return this._clearColor.a}setClearAlpha(e){this._clearColor.a=e}getClearDepth(){return this._clearDepth}setClearDepth(e){this._clearDepth=e}getClearStencil(){return this._clearStencil}setClearStencil(e){this._clearStencil=e}isOccluded(e){const i=this._currentRenderContext;return i&&this.backend.isOccluded(i,e)}clear(e=!0,i=!0,n=!0){if(this._initialized===!1)return console.warn("THREE.Renderer: .clear() called before the backend is initialized. Try using .clearAsync() instead."),this.clearAsync(e,i,n);const s=this._renderTarget||this._getFrameBufferTarget();let o=null;if(s!==null&&(this._textures.updateRenderTarget(s),o=this._textures.get(s)),this.backend.clear(e,i,n,o),s!==null&&this._renderTarget===null){const l=this._quad;this._nodes.hasOutputChange(s.texture)&&(l.material.fragmentNode=this._nodes.getOutputNode(s.texture),l.material.needsUpdate=!0),this._renderScene(l,l.camera,!1)}}clearColor(){return this.clear(!0,!1,!1)}clearDepth(){return this.clear(!1,!0,!1)}clearStencil(){return this.clear(!1,!1,!0)}async clearAsync(e=!0,i=!0,n=!0){this._initialized===!1&&await this.init(),this.clear(e,i,n)}clearColorAsync(){return this.clearAsync(!0,!1,!1)}clearDepthAsync(){return this.clearAsync(!1,!0,!1)}clearStencilAsync(){return this.clearAsync(!1,!1,!0)}get currentToneMapping(){return this._renderTarget!==null?og:this.toneMapping}get currentColorSpace(){return this._renderTarget!==null?gd:this.outputColorSpace}dispose(){this.info.dispose(),this.backend.dispose(),this._animation.dispose(),this._objects.dispose(),this._pipelines.dispose(),this._nodes.dispose(),this._bindings.dispose(),this._renderLists.dispose(),this._renderContexts.dispose(),this._textures.dispose(),this.setRenderTarget(null),this.setAnimationLoop(null)}setRenderTarget(e,i=0,n=0){this._renderTarget=e,this._activeCubeFace=i,this._activeMipmapLevel=n}getRenderTarget(){return this._renderTarget}setRenderObjectFunction(e){this._renderObjectFunction=e}getRenderObjectFunction(){return this._renderObjectFunction}compute(e){if(this.isDeviceLost===!0)return;if(this._initialized===!1)return console.warn("THREE.Renderer: .compute() called before the backend is initialized. Try using .computeAsync() instead."),this.computeAsync(e);const i=this._nodes.nodeFrame,n=i.renderId;this.info.calls++,this.info.compute.calls++,this.info.compute.frameCalls++,i.renderId=this.info.calls;const s=this.backend,o=this._pipelines,l=this._bindings,u=this._nodes,c=Array.isArray(e)?e:[e];if(c[0]===void 0||c[0].isComputeNode!==!0)throw new Error("THREE.Renderer: .compute() expects a ComputeNode.");s.beginCompute(e);for(const h of c){if(o.has(h)===!1){const g=()=>{h.removeEventListener("dispose",g),o.delete(h),l.delete(h),u.delete(h)};h.addEventListener("dispose",g);const m=h.onInitFunction;m!==null&&m.call(h,{renderer:this})}u.updateForCompute(h),l.updateForCompute(h);const p=l.getForCompute(h),f=o.getForCompute(h,p);s.compute(e,h,p,f)}s.finishCompute(e),i.renderId=n}async computeAsync(e){this._initialized===!1&&await this.init(),this.compute(e),await this.backend.resolveTimestampAsync(e,"compute")}async hasFeatureAsync(e){return this._initialized===!1&&await this.init(),this.backend.hasFeature(e)}hasFeature(e){return this._initialized===!1?(console.warn("THREE.Renderer: .hasFeature() called before the backend is initialized. Try using .hasFeatureAsync() instead."),!1):this.backend.hasFeature(e)}copyFramebufferToTexture(e,i=null){if(i!==null)if(i.isVector2)i=Ld.set(i.x,i.y,e.image.width,e.image.height).floor();else if(i.isVector4)i=Ld.copy(i).floor();else{console.error("THREE.Renderer.copyFramebufferToTexture: Invalid rectangle.");return}else i=Ld.set(0,0,e.image.width,e.image.height);let n=this._currentRenderContext,s;n!==null?s=n.renderTarget:(s=this._renderTarget||this._getFrameBufferTarget(),s!==null&&(this._textures.updateRenderTarget(s),n=this._textures.get(s))),this._textures.updateTexture(e,{renderTarget:s}),this.backend.copyFramebufferToTexture(e,n,i)}copyTextureToTexture(e,i,n=null,s=null,o=0){this._textures.updateTexture(e),this._textures.updateTexture(i),this.backend.copyTextureToTexture(e,i,n,s,o)}readRenderTargetPixelsAsync(e,i,n,s,o,l=0,u=0){return this.backend.copyTextureToBuffer(e.textures[l],i,n,s,o,u)}_projectObject(e,i,n,s){if(e.visible===!1)return;if(e.layers.test(i.layers)){if(e.isGroup)n=e.renderOrder;else if(e.isLOD)e.autoUpdate===!0&&e.update(i);else if(e.isLight)s.pushLight(e);else if(e.isSprite){if(!e.frustumCulled||xI.intersectsSprite(e)){this.sortObjects===!0&&Ld.setFromMatrixPosition(e.matrixWorld).applyMatrix4(V_);const{geometry:l,material:u}=e;u.visible&&s.push(e,l,u,n,Ld.z,null)}}else if(e.isLineLoop)console.error("THREE.Renderer: Objects of type THREE.LineLoop are not supported. Please use THREE.Line or THREE.LineSegments.");else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||xI.intersectsObject(e))){const{geometry:l,material:u}=e;if(this.sortObjects===!0&&(l.boundingSphere===null&&l.computeBoundingSphere(),Ld.copy(l.boundingSphere.center).applyMatrix4(e.matrixWorld).applyMatrix4(V_)),Array.isArray(u)){const c=l.groups;for(let h=0,p=c.length;h<p;h++){const f=c[h],g=u[f.materialIndex];g&&g.visible&&s.push(e,l,g,n,Ld.z,f)}}else u.visible&&s.push(e,l,u,n,Ld.z,null)}}if(e.isBundleGroup===!0&&this.backend.beginBundle!==void 0){const l=s;s=this._renderLists.get(e,i),s.begin(),l.pushBundle({bundleGroup:e,camera:i,renderList:s}),s.finish()}const o=e.children;for(let l=0,u=o.length;l<u;l++)this._projectObject(o[l],i,n,s)}_renderBundles(e,i,n){for(const s of e)this._renderBundle(s,i,n)}_renderTransparents(e,i,n,s,o){if(i.length>0){for(const{material:l}of i)l.side=yc;this._renderObjects(i,n,s,o,"backSide");for(const{material:l}of i)l.side=ng;this._renderObjects(e,n,s,o);for(const{material:l}of i)l.side=sg}else this._renderObjects(e,n,s,o)}_renderObjects(e,i,n,s,o=null){for(let l=0,u=e.length;l<u;l++){const c=e[l],{object:h,geometry:p,material:f,group:g}=c;if(i.isArrayCamera){const m=i.cameras;for(let y=0,b=m.length;y<b;y++){const v=m[y];if(h.layers.test(v.layers)){const _=v.viewport,C=_.minDepth===void 0?0:_.minDepth,E=_.maxDepth===void 0?1:_.maxDepth,T=this._currentRenderContext.viewportValue;T.copy(_).multiplyScalar(this._pixelRatio).floor(),T.minDepth=C,T.maxDepth=E,this.backend.updateViewport(this._currentRenderContext),this._currentRenderObjectFunction(h,n,v,p,f,g,s,o)}}}else this._currentRenderObjectFunction(h,n,i,p,f,g,s,o)}}renderObject(e,i,n,s,o,l,u,c=null){let h,p,f;if(e.onBeforeRender(this,i,n,s,o,l),i.overrideMaterial!==null){const g=i.overrideMaterial;o.positionNode&&o.positionNode.isNode&&(h=g.positionNode,g.positionNode=o.positionNode),g.isShadowNodeMaterial&&(g.side=o.shadowSide===null?o.side:o.shadowSide,o.depthNode&&o.depthNode.isNode&&(f=g.depthNode,g.depthNode=o.depthNode),o.shadowNode&&o.shadowNode.isNode&&(p=g.fragmentNode,g.fragmentNode=o.shadowNode),this.localClippingEnabled&&(o.clipShadows?(g.clippingPlanes!==o.clippingPlanes&&(g.clippingPlanes=o.clippingPlanes,g.needsUpdate=!0),g.clipIntersection!==o.clipIntersection&&(g.clipIntersection=o.clipIntersection)):Array.isArray(g.clippingPlanes)&&(g.clippingPlanes=null,g.needsUpdate=!0))),o=g}o.transparent===!0&&o.side===sg&&o.forceSinglePass===!1?(o.side=yc,this._handleObjectFunction(e,o,i,n,u,l,"backSide"),o.side=ng,this._handleObjectFunction(e,o,i,n,u,l,c),o.side=sg):this._handleObjectFunction(e,o,i,n,u,l,c),h!==void 0&&(i.overrideMaterial.positionNode=h),f!==void 0&&(i.overrideMaterial.depthNode=f),p!==void 0&&(i.overrideMaterial.fragmentNode=p),e.onAfterRender(this,i,n,s,o,l)}_renderObjectDirect(e,i,n,s,o,l,u){const c=this._objects.get(e,i,n,s,o,this._currentRenderContext,u);c.drawRange=e.geometry.drawRange,c.group=l;const h=this._nodes.needsRefresh(c);h&&(this._nodes.updateBefore(c),this._geometries.updateForRender(c),this._nodes.updateForRender(c),this._bindings.updateForRender(c)),this._pipelines.updateForRender(c),this._currentRenderBundle!==null&&(this.backend.get(this._currentRenderBundle).renderObjects.push(c),c.bundle=this._currentRenderBundle.scene),this.backend.draw(c,this.info),h&&this._nodes.updateAfter(c)}_createObjectPipeline(e,i,n,s,o,l){const u=this._objects.get(e,i,n,s,o,this._currentRenderContext,l);this._nodes.updateBefore(u),this._geometries.updateForRender(u),this._nodes.updateForRender(u),this._bindings.updateForRender(u),this._pipelines.getForRender(u,this._compilationPromises),this._nodes.updateAfter(u)}get compile(){return this.compileAsync}}class _I{constructor(e=""){this.name=e,this.visibility=0}setVisibility(e){this.visibility|=e}clone(){return Object.assign(new this.constructor,this)}}function dve(r){return r+(Bd-r%Bd)%Bd}let B7=class extends _I{constructor(r,e=null){super(r),this.isBuffer=!0,this.bytesPerElement=Float32Array.BYTES_PER_ELEMENT,this._buffer=e}get byteLength(){return dve(this._buffer.byteLength)}get buffer(){return this._buffer}update(){return!0}};class N7 extends B7{constructor(e,i=null){super(e,i),this.isUniformBuffer=!0}}let pve=0;class L7 extends N7{constructor(e,i){super("UniformBuffer_"+pve++,e?e.value:null),this.nodeUniform=e,this.groupNode=i}get buffer(){return this.nodeUniform.value}}class fve extends N7{constructor(e){super(e),this.isUniformsGroup=!0,this._values=null,this.uniforms=[]}addUniform(e){return this.uniforms.push(e),this}removeUniform(e){const i=this.uniforms.indexOf(e);return i!==-1&&this.uniforms.splice(i,1),this}get values(){return this._values===null&&(this._values=Array.from(this.buffer)),this._values}get buffer(){let e=this._buffer;if(e===null){const i=this.byteLength;e=new Float32Array(new ArrayBuffer(i)),this._buffer=e}return e}get byteLength(){let e=0;for(let i=0,n=this.uniforms.length;i<n;i++){const s=this.uniforms[i],{boundary:o,itemSize:l}=s,u=e%Bd,c=Bd-u;u!==0&&c-o<0?e+=Bd-u:u%o!==0&&(e+=u%o),s.offset=e/this.bytesPerElement,e+=l*this.bytesPerElement}return Math.ceil(e/Bd)*Bd}update(){let e=!1;for(const i of this.uniforms)this.updateByType(i)===!0&&(e=!0);return e}updateByType(e){if(e.isNumberUniform)return this.updateNumber(e);if(e.isVector2Uniform)return this.updateVector2(e);if(e.isVector3Uniform)return this.updateVector3(e);if(e.isVector4Uniform)return this.updateVector4(e);if(e.isColorUniform)return this.updateColor(e);if(e.isMatrix3Uniform)return this.updateMatrix3(e);if(e.isMatrix4Uniform)return this.updateMatrix4(e);console.error("THREE.WebGPUUniformsGroup: Unsupported uniform type.",e)}updateNumber(e){let i=!1;const n=this.values,s=e.getValue(),o=e.offset;if(n[o]!==s){const l=this.buffer;l[o]=n[o]=s,i=!0}return i}updateVector2(e){let i=!1;const n=this.values,s=e.getValue(),o=e.offset;if(n[o+0]!==s.x||n[o+1]!==s.y){const l=this.buffer;l[o+0]=n[o+0]=s.x,l[o+1]=n[o+1]=s.y,i=!0}return i}updateVector3(e){let i=!1;const n=this.values,s=e.getValue(),o=e.offset;if(n[o+0]!==s.x||n[o+1]!==s.y||n[o+2]!==s.z){const l=this.buffer;l[o+0]=n[o+0]=s.x,l[o+1]=n[o+1]=s.y,l[o+2]=n[o+2]=s.z,i=!0}return i}updateVector4(e){let i=!1;const n=this.values,s=e.getValue(),o=e.offset;if(n[o+0]!==s.x||n[o+1]!==s.y||n[o+2]!==s.z||n[o+4]!==s.w){const l=this.buffer;l[o+0]=n[o+0]=s.x,l[o+1]=n[o+1]=s.y,l[o+2]=n[o+2]=s.z,l[o+3]=n[o+3]=s.w,i=!0}return i}updateColor(e){let i=!1;const n=this.values,s=e.getValue(),o=e.offset;if(n[o+0]!==s.r||n[o+1]!==s.g||n[o+2]!==s.b){const l=this.buffer;l[o+0]=n[o+0]=s.r,l[o+1]=n[o+1]=s.g,l[o+2]=n[o+2]=s.b,i=!0}return i}updateMatrix3(e){let i=!1;const n=this.values,s=e.getValue().elements,o=e.offset;if(n[o+0]!==s[0]||n[o+1]!==s[1]||n[o+2]!==s[2]||n[o+4]!==s[3]||n[o+5]!==s[4]||n[o+6]!==s[5]||n[o+8]!==s[6]||n[o+9]!==s[7]||n[o+10]!==s[8]){const l=this.buffer;l[o+0]=n[o+0]=s[0],l[o+1]=n[o+1]=s[1],l[o+2]=n[o+2]=s[2],l[o+4]=n[o+4]=s[3],l[o+5]=n[o+5]=s[4],l[o+6]=n[o+6]=s[5],l[o+8]=n[o+8]=s[6],l[o+9]=n[o+9]=s[7],l[o+10]=n[o+10]=s[8],i=!0}return i}updateMatrix4(e){let i=!1;const n=this.values,s=e.getValue().elements,o=e.offset;return gve(n,s,o)===!1&&(this.buffer.set(s,o),mve(n,s,o),i=!0),i}}function mve(r,e,i){for(let n=0,s=e.length;n<s;n++)r[i+n]=e[n]}function gve(r,e,i){for(let n=0,s=e.length;n<s;n++)if(r[i+n]!==e[n])return!1;return!0}let Ave=0;class D7 extends fve{constructor(e,i){super(e),this.id=Ave++,this.groupNode=i,this.isNodeUniformsGroup=!0}getNodes(){const e=[];for(const i of this.uniforms){const n=i.nodeUniform.node;if(!n)throw new Error("NodeUniformsGroup: Uniform has no node.");e.push(n)}return e}}let yve=0;class vve extends _I{constructor(e,i){super(e),this.id=yve++,this.texture=i,this.version=i?i.version:0,this.store=!1,this.generation=null,this.isSampledTexture=!0}needsBindingsUpdate(e){const{texture:i}=this;return e!==this.generation?(this.generation=e,!0):i.isVideoTexture}update(){const{texture:e,version:i}=this;return i!==e.version?(this.version=e.version,!0):!1}}class H_ extends vve{constructor(e,i,n,s=null){super(e,i?i.value:null),this.textureNode=i,this.groupNode=n,this.access=s}needsBindingsUpdate(e){return this.textureNode.value!==this.texture||super.needsBindingsUpdate(e)}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class O7 extends H_{constructor(e,i,n,s){super(e,i,n,s),this.isSampledCubeTexture=!0}}class P7 extends H_{constructor(e,i,n,s){super(e,i,n,s),this.isSampledTexture3D=!0}}const bve={atan2:"atan",textureDimensions:"textureSize",equals:"equal"},xve={low:"lowp",medium:"mediump",high:"highp"},k7={swizzleAssign:!0,storageBuffer:!1},F7=`
precision highp float;
precision highp int;
precision highp sampler2D;
precision highp sampler3D;
precision highp samplerCube;
precision highp sampler2DArray;

precision highp usampler2D;
precision highp usampler3D;
precision highp usamplerCube;
precision highp usampler2DArray;

precision highp isampler2D;
precision highp isampler3D;
precision highp isamplerCube;
precision highp isampler2DArray;

precision lowp sampler2DShadow;
`;class _ve extends E7{constructor(e,i){super(e,i,new sve),this.uniformGroups={},this.transforms=[],this.extensions={},this.useComparisonMethod=!0}needsColorSpaceToLinearSRGB(e){return e.isVideoTexture===!0&&e.colorSpace!==Up}getMethod(e){return bve[e]||e}getOutputStructName(){return""}buildFunctionCode(e){const i=e.layout,n=this.flowShaderNode(e),s=[];for(const o of i.inputs)s.push(this.getType(o.type)+" "+o.name);return`${this.getType(i.type)} ${i.name}( ${s.join(", ")} ) {

	${n.vars}

${n.code}
	return ${n.result};

}`}setupPBO(e){const i=e.value;if(i.pbo===void 0){const n=i.array,s=i.count*i.itemSize,{itemSize:o}=i,l=i.array.constructor.name.toLowerCase().includes("int");let u=l?r3:i3;o===2?u=l?n3:oy:o===3?u=l?khe:t3:o===4&&(u=l?s3:dg);const c={Float32Array:Al,Uint8Array:fd,Uint16Array:hg,Uint32Array:ja,Int8Array:ny,Int16Array:sy,Int32Array:Co,Uint8ClampedArray:fd},h=Math.pow(2,Math.ceil(Math.log2(Math.sqrt(s/o))));let p=Math.ceil(s/o/h);h*p*o<s&&p++;const f=h*p*o,g=new n.constructor(f);g.set(n,0),i.array=g;const m=new Vde(i.array,h,p,u,c[i.array.constructor.name]||Al);m.needsUpdate=!0,m.isPBOTexture=!0;const y=new Ry(m,null,null);y.setPrecision("high"),i.pboNode=y,i.pbo=y.value,this.getUniformFromNode(i.pboNode,"texture",this.shaderStage,this.context.label)}}getPropertyName(e,i=this.shaderStage){return e.isNodeUniform&&e.node.isTextureNode!==!0&&e.node.isBufferNode!==!0?i.charAt(0)+"_"+e.name:super.getPropertyName(e,i)}generatePBO(e){const{node:i,indexNode:n}=e,s=i.value;if(this.renderer.backend.has(s)){const p=this.renderer.backend.get(s);p.pbo=s.pbo}const o=this.getUniformFromNode(s.pboNode,"texture",this.shaderStage,this.context.label),l=this.getPropertyName(o);this.increaseUsage(n);const u=n.build(this,"uint"),c=this.getDataFromNode(e);let h=c.propertyName;if(h===void 0){const p=this.getVarFromNode(e);h=this.getPropertyName(p);const f=this.getDataFromNode(i);let g=f.propertySizeName;g===void 0&&(g=h+"Size",this.getVarFromNode(i,g,"uint"),this.addLineFlowCode(`${g} = uint( textureSize( ${l}, 0 ).x )`,e),f.propertySizeName=g);const{itemSize:m}=s,y="."+Bg.join("").slice(0,m),b=`ivec2(${u} % ${g}, ${u} / ${g})`,v=this.generateTextureLoad(null,l,b,null,"0");let _="vec4";s.pbo.type===ja?_="uvec4":s.pbo.type===Co&&(_="ivec4"),this.addLineFlowCode(`${h} = ${_}(${v})${y}`,e),c.propertyName=h}return h}generateTextureLoad(e,i,n,s,o="0"){return s?`texelFetch( ${i}, ivec3( ${n}, ${s} ), ${o} )`:`texelFetch( ${i}, ${n}, ${o} )`}generateTexture(e,i,n,s){return e.isDepthTexture?`texture( ${i}, ${n} ).x`:(s&&(n=`vec3( ${n}, ${s} )`),`texture( ${i}, ${n} )`)}generateTextureLevel(e,i,n,s){return`textureLod( ${i}, ${n}, ${s} )`}generateTextureBias(e,i,n,s){return`texture( ${i}, ${n}, ${s} )`}generateTextureGrad(e,i,n,s){return`textureGrad( ${i}, ${n}, ${s[0]}, ${s[1]} )`}generateTextureCompare(e,i,n,s,o,l=this.shaderStage){if(l==="fragment")return`texture( ${i}, vec3( ${n}, ${s} ) )`;console.error(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${l} shader.`)}getVars(e){const i=[],n=this.vars[e];if(n!==void 0)for(const s of n)i.push(`${this.getVar(s.type,s.name)};`);return i.join(`
	`)}getUniforms(e){const i=this.uniforms[e],n=[],s={};for(const l of i){let u=null,c=!1;if(l.type==="texture"){const p=l.node.value;let f="";p.isDataTexture===!0&&(p.type===ja?f="u":p.type===Co&&(f="i")),p.compareFunction?u=`sampler2DShadow ${l.name};`:p.isDataArrayTexture===!0||p.isCompressedArrayTexture===!0?u=`${f}sampler2DArray ${l.name};`:u=`${f}sampler2D ${l.name};`}else if(l.type==="cubeTexture")u=`samplerCube ${l.name};`;else if(l.type==="texture3D")u=`sampler3D ${l.name};`;else if(l.type==="buffer"){const p=l.node,f=this.getType(p.bufferType),g=p.bufferCount,m=g>0?g:"";u=`${p.name} {
	${f} ${l.name}[${m}];
};
`}else u=`${this.getVectorType(l.type)} ${this.getPropertyName(l,e)};`,c=!0;const h=l.node.precision;if(h!==null&&(u=xve[h]+" "+u),c){u="	"+u;const p=l.groupNode.name;(s[p]||(s[p]=[])).push(u)}else u="uniform "+u,n.push(u)}let o="";for(const l in s){const u=s[l];o+=this._getGLSLUniformStruct(e+"_"+l,u.join(`
`))+`
`}return o+=n.join(`
`),o}getTypeFromAttribute(e){let i=super.getTypeFromAttribute(e);if(/^[iu]/.test(i)&&e.gpuType!==Co){let n=e;e.isInterleavedBufferAttribute&&(n=e.data);const s=n.array;s instanceof Uint32Array||s instanceof Int32Array||(i=i.slice(1))}return i}getAttributes(e){let i="";if(e==="vertex"||e==="compute"){const n=this.getAttributesArray();let s=0;for(const o of n)i+=`layout( location = ${s++} ) in ${o.type} ${o.name};
`}return i}getStructMembers(e){const i=[],n=e.getMemberTypes();for(let s=0;s<n.length;s++){const o=n[s];i.push(`layout( location = ${s} ) out ${o} m${s};`)}return i.join(`
`)}getStructs(e){const i=[],n=this.structs[e];if(n.length===0)return`layout( location = 0 ) out vec4 fragColor;
`;for(let s=0,o=n.length;s<o;s++){const l=n[s];let u=`
`;u+=this.getStructMembers(l),u+=`
`,i.push(u)}return i.join(`

`)}getVaryings(e){let i="";const n=this.varyings;if(e==="vertex"||e==="compute")for(const s of n){e==="compute"&&(s.needsInterpolation=!0);const o=s.type,l=o.includes("int")||o.includes("uv")||o.includes("iv")?"flat ":"";i+=`${l}${s.needsInterpolation?"out":"/*out*/"} ${o} ${s.name};
`}else if(e==="fragment"){for(const s of n)if(s.needsInterpolation){const o=s.type,l=o.includes("int")||o.includes("uv")||o.includes("iv")?"flat ":"";i+=`${l}in ${o} ${s.name};
`}}return i}getVertexIndex(){return"uint( gl_VertexID )"}getInstanceIndex(){return"uint( gl_InstanceID )"}getInvocationLocalIndex(){return`uint( gl_InstanceID ) % ${this.object.workgroupSize.reduce((e,i)=>e*i,1)}u`}getDrawIndex(){return this.renderer.backend.extensions.has("WEBGL_multi_draw")?"uint( gl_DrawID )":null}getFrontFacing(){return"gl_FrontFacing"}getFragCoord(){return"gl_FragCoord.xy"}getFragDepth(){return"gl_FragDepth"}enableExtension(e,i,n=this.shaderStage){const s=this.extensions[n]||(this.extensions[n]=new Map);s.has(e)===!1&&s.set(e,{name:e,behavior:i})}getExtensions(e){const i=[];if(e==="vertex"){const s=this.renderer.backend.extensions;this.object.isBatchedMesh&&s.has("WEBGL_multi_draw")&&this.enableExtension("GL_ANGLE_multi_draw","require",e)}const n=this.extensions[e];if(n!==void 0)for(const{name:s,behavior:o}of n.values())i.push(`#extension ${s} : ${o}`);return i.join(`
`)}isAvailable(e){let i=k7[e];if(i===void 0){if(e==="float32Filterable"){const n=this.renderer.backend.extensions;n.has("OES_texture_float_linear")?(n.get("OES_texture_float_linear"),i=!0):i=!1}k7[e]=i}return i}isFlipY(){return!0}registerTransform(e,i){this.transforms.push({varyingName:e,attributeNode:i})}getTransforms(){const e=this.transforms;let i="";for(let n=0;n<e.length;n++){const s=e[n],o=this.getPropertyName(s.attributeNode);i+=`${s.varyingName} = ${o};
	`}return i}_getGLSLUniformStruct(e,i){return`
layout( std140 ) uniform ${e} {
${i}
};`}_getGLSLVertexCode(e){return`#version 300 es

${this.getSignature()}

// extensions 
${e.extensions}

// precision
${F7}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// attributes
${e.attributes}

// codes
${e.codes}

void main() {

	// vars
	${e.vars}

	// transforms
	${e.transforms}

	// flow
	${e.flow}

	gl_PointSize = 1.0;

}
`}_getGLSLFragmentCode(e){return`#version 300 es

${this.getSignature()}

// precision
${F7}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// codes
${e.codes}

${e.structs}

void main() {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const i in e){let n=`// code

`;n+=this.flowCode[i];const s=this.flowNodes[i],o=s[s.length-1];for(const u of s){const c=this.getFlowData(u),h=u.name;h&&(n.length>0&&(n+=`
`),n+=`	// flow -> ${h}
	`),n+=`${c.code}
	`,u===o&&i!=="compute"&&(n+=`// result
	`,i==="vertex"?(n+="gl_Position = ",n+=`${c.result};`):i==="fragment"&&(u.outputNode.isOutputStructNode||(n+="fragColor = ",n+=`${c.result};`)))}const l=e[i];l.extensions=this.getExtensions(i),l.uniforms=this.getUniforms(i),l.attributes=this.getAttributes(i),l.varyings=this.getVaryings(i),l.vars=this.getVars(i),l.structs=this.getStructs(i),l.codes=this.getCodes(i),l.transforms=this.getTransforms(i),l.flow=n}this.material!==null?(this.vertexShader=this._getGLSLVertexCode(e.vertex),this.fragmentShader=this._getGLSLFragmentCode(e.fragment)):this.computeShader=this._getGLSLVertexCode(e.compute)}getUniformFromNode(e,i,n,s=null){const o=super.getUniformFromNode(e,i,n,s),l=this.getDataFromNode(e,n,this.globalCache);let u=l.uniformGPU;if(u===void 0){const c=e.groupNode,h=c.name,p=this.getBindGroupArray(h,n);if(i==="texture")u=new H_(o.name,o.node,c),p.push(u);else if(i==="cubeTexture")u=new O7(o.name,o.node,c),p.push(u);else if(i==="texture3D")u=new P7(o.name,o.node,c),p.push(u);else if(i==="buffer"){e.name=`NodeBuffer_${e.id}`,o.name=`buffer${e.id}`;const f=new L7(e,c);f.name=e.name,p.push(f),u=f}else{const f=this.uniformGroups[n]||(this.uniformGroups[n]={});let g=f[h];g===void 0&&(g=new D7(n+"_"+h,c),f[h]=g,p.push(g)),u=this.getNodeUniform(o,i),g.addUniform(u)}l.uniformGPU=u}return o}}let EI=null,wI=null,Xg=null;class U7{constructor(e={}){this.parameters=Object.assign({},e),this.data=new WeakMap,this.renderer=null,this.domElement=null}async init(e){this.renderer=e}begin(){}finish(){}draw(){}createProgram(){}destroyProgram(){}createBindings(){}updateBindings(){}createRenderPipeline(){}createComputePipeline(){}destroyPipeline(){}needsRenderUpdate(){}getRenderCacheKey(){}createNodeBuilder(){}createSampler(){}createDefaultTexture(){}createTexture(){}copyTextureToBuffer(){}createAttribute(){}createIndexAttribute(){}updateAttribute(){}destroyAttribute(){}getContext(){}updateSize(){}resolveTimestampAsync(){}hasFeatureAsync(){}hasFeature(){}getInstanceCount(e){const{object:i,geometry:n}=e;return n.isInstancedBufferGeometry?n.instanceCount:i.count>1?i.count:1}getDrawingBufferSize(){return EI=EI||new Dn,this.renderer.getDrawingBufferSize(EI)}getScissor(){return wI=wI||new Zn,this.renderer.getScissor(wI)}setScissorTest(){}getClearColor(){const e=this.renderer;return Xg=Xg||new YR,e.getClearColor(Xg),Xg.getRGB(Xg,this.renderer.currentColorSpace),Xg}getDomElement(){let e=this.domElement;return e===null&&(e=this.parameters.canvas!==void 0?this.parameters.canvas:yde(),"setAttribute"in e&&e.setAttribute("data-engine",`three.js r${S1} webgpu`),this.domElement=e),e}set(e,i){this.data.set(e,i)}get(e){let i=this.data.get(e);return i===void 0&&(i={},this.data.set(e,i)),i}has(e){return this.data.has(e)}delete(e){this.data.delete(e)}dispose(){}}let Eve=0;class wve{constructor(e,i){this.buffers=[e.bufferGPU,i],this.type=e.type,this.bufferType=e.bufferType,this.pbo=e.pbo,this.byteLength=e.byteLength,this.bytesPerElement=e.BYTES_PER_ELEMENT,this.version=e.version,this.isInteger=e.isInteger,this.activeBufferIndex=0,this.baseId=e.id}get id(){return`${this.baseId}|${this.activeBufferIndex}`}get bufferGPU(){return this.buffers[this.activeBufferIndex]}get transformBuffer(){return this.buffers[this.activeBufferIndex^1]}switchBuffers(){this.activeBufferIndex^=1}}class Cve{constructor(e){this.backend=e}createAttribute(e,i){const n=this.backend,{gl:s}=n,o=e.array,l=e.usage||s.STATIC_DRAW,u=e.isInterleavedBufferAttribute?e.data:e,c=n.get(u);let h=c.bufferGPU;h===void 0&&(h=this._createBuffer(s,i,o,l),c.bufferGPU=h,c.bufferType=i,c.version=u.version);let p;if(o instanceof Float32Array)p=s.FLOAT;else if(o instanceof Uint16Array)e.isFloat16BufferAttribute?p=s.HALF_FLOAT:p=s.UNSIGNED_SHORT;else if(o instanceof Int16Array)p=s.SHORT;else if(o instanceof Uint32Array)p=s.UNSIGNED_INT;else if(o instanceof Int32Array)p=s.INT;else if(o instanceof Int8Array)p=s.BYTE;else if(o instanceof Uint8Array)p=s.UNSIGNED_BYTE;else if(o instanceof Uint8ClampedArray)p=s.UNSIGNED_BYTE;else throw new Error("THREE.WebGLBackend: Unsupported buffer data format: "+o);let f={bufferGPU:h,bufferType:i,type:p,byteLength:o.byteLength,bytesPerElement:o.BYTES_PER_ELEMENT,version:e.version,pbo:e.pbo,isInteger:p===s.INT||p===s.UNSIGNED_INT||e.gpuType===Co,id:Eve++};if(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute){const g=this._createBuffer(s,i,o,l);f=new wve(f,g)}n.set(e,f)}updateAttribute(e){const i=this.backend,{gl:n}=i,s=e.array,o=e.isInterleavedBufferAttribute?e.data:e,l=i.get(o),u=l.bufferType,c=e.isInterleavedBufferAttribute?e.data.updateRanges:e.updateRanges;if(n.bindBuffer(u,l.bufferGPU),c.length===0)n.bufferSubData(u,0,s);else{for(let h=0,p=c.length;h<p;h++){const f=c[h];n.bufferSubData(u,f.start*s.BYTES_PER_ELEMENT,s,f.start,f.count)}o.clearUpdateRanges()}n.bindBuffer(u,null),l.version=o.version}destroyAttribute(e){const i=this.backend,{gl:n}=i;e.isInterleavedBufferAttribute&&i.delete(e.data);const s=i.get(e);n.deleteBuffer(s.bufferGPU),i.delete(e)}async getArrayBufferAsync(e){const i=this.backend,{gl:n}=i,s=e.isInterleavedBufferAttribute?e.data:e,{bufferGPU:o}=i.get(s),l=e.array,u=l.byteLength;n.bindBuffer(n.COPY_READ_BUFFER,o);const c=n.createBuffer();n.bindBuffer(n.COPY_WRITE_BUFFER,c),n.bufferData(n.COPY_WRITE_BUFFER,u,n.STREAM_READ),n.copyBufferSubData(n.COPY_READ_BUFFER,n.COPY_WRITE_BUFFER,0,0,u),await i.utils._clientWaitAsync();const h=new e.array.constructor(l.length);return n.bindBuffer(n.COPY_WRITE_BUFFER,c),n.getBufferSubData(n.COPY_WRITE_BUFFER,0,h),n.deleteBuffer(c),n.bindBuffer(n.COPY_READ_BUFFER,null),n.bindBuffer(n.COPY_WRITE_BUFFER,null),h.buffer}_createBuffer(e,i,n,s){const o=e.createBuffer();return e.bindBuffer(i,o),e.bufferData(i,n,s),e.bindBuffer(i,null),o}}let z7=!1,CI,Wy;class Sve{constructor(e){this.backend=e,this.gl=this.backend.gl,this.enabled={},this.currentFlipSided=null,this.currentCullFace=null,this.currentProgram=null,this.currentBlendingEnabled=!1,this.currentBlending=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipledAlpha=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentColorMask=null,this.currentDepthFunc=null,this.currentDepthMask=null,this.currentStencilFunc=null,this.currentStencilRef=null,this.currentStencilFuncMask=null,this.currentStencilFail=null,this.currentStencilZFail=null,this.currentStencilZPass=null,this.currentStencilMask=null,this.currentLineWidth=null,this.currentBoundFramebuffers={},this.currentDrawbuffers=new WeakMap,this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.currentTextureSlot=null,this.currentBoundTextures={},this.currentBoundBufferBases={},z7===!1&&(this._init(this.gl),z7=!0)}_init(e){CI={[pd]:e.FUNC_ADD,[MU]:e.FUNC_SUBTRACT,[RU]:e.FUNC_REVERSE_SUBTRACT},Wy={[IU]:e.ZERO,[BU]:e.ONE,[NU]:e.SRC_COLOR,[B1]:e.SRC_ALPHA,[FU]:e.SRC_ALPHA_SATURATE,[PU]:e.DST_COLOR,[DU]:e.DST_ALPHA,[LU]:e.ONE_MINUS_SRC_COLOR,[N1]:e.ONE_MINUS_SRC_ALPHA,[kU]:e.ONE_MINUS_DST_COLOR,[OU]:e.ONE_MINUS_DST_ALPHA}}enable(e){const{enabled:i}=this;i[e]!==!0&&(this.gl.enable(e),i[e]=!0)}disable(e){const{enabled:i}=this;i[e]!==!1&&(this.gl.disable(e),i[e]=!1)}setFlipSided(e){if(this.currentFlipSided!==e){const{gl:i}=this;e?i.frontFace(i.CW):i.frontFace(i.CCW),this.currentFlipSided=e}}setCullFace(e){const{gl:i}=this;e!==yhe?(this.enable(i.CULL_FACE),e!==this.currentCullFace&&(e===vhe?i.cullFace(i.BACK):e===bhe?i.cullFace(i.FRONT):i.cullFace(i.FRONT_AND_BACK))):this.disable(i.CULL_FACE),this.currentCullFace=e}setLineWidth(e){const{currentLineWidth:i,gl:n}=this;e!==i&&(n.lineWidth(e),this.currentLineWidth=e)}setBlending(e,i,n,s,o,l,u,c){const{gl:h}=this;if(e===ag){this.currentBlendingEnabled===!0&&(this.disable(h.BLEND),this.currentBlendingEnabled=!1);return}if(this.currentBlendingEnabled===!1&&(this.enable(h.BLEND),this.currentBlendingEnabled=!0),e!==TU){if(e!==this.currentBlending||c!==this.currentPremultipledAlpha){if((this.currentBlendEquation!==pd||this.currentBlendEquationAlpha!==pd)&&(h.blendEquation(h.FUNC_ADD),this.currentBlendEquation=pd,this.currentBlendEquationAlpha=pd),c)switch(e){case dd:h.blendFuncSeparate(h.ONE,h.ONE_MINUS_SRC_ALPHA,h.ONE,h.ONE_MINUS_SRC_ALPHA);break;case M1:h.blendFunc(h.ONE,h.ONE);break;case R1:h.blendFuncSeparate(h.ZERO,h.ONE_MINUS_SRC_COLOR,h.ZERO,h.ONE);break;case I1:h.blendFuncSeparate(h.ZERO,h.SRC_COLOR,h.ZERO,h.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",e);break}else switch(e){case dd:h.blendFuncSeparate(h.SRC_ALPHA,h.ONE_MINUS_SRC_ALPHA,h.ONE,h.ONE_MINUS_SRC_ALPHA);break;case M1:h.blendFunc(h.SRC_ALPHA,h.ONE);break;case R1:h.blendFuncSeparate(h.ZERO,h.ONE_MINUS_SRC_COLOR,h.ZERO,h.ONE);break;case I1:h.blendFunc(h.ZERO,h.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",e);break}this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentBlending=e,this.currentPremultipledAlpha=c}return}o=o||i,l=l||n,u=u||s,(i!==this.currentBlendEquation||o!==this.currentBlendEquationAlpha)&&(h.blendEquationSeparate(CI[i],CI[o]),this.currentBlendEquation=i,this.currentBlendEquationAlpha=o),(n!==this.currentBlendSrc||s!==this.currentBlendDst||l!==this.currentBlendSrcAlpha||u!==this.currentBlendDstAlpha)&&(h.blendFuncSeparate(Wy[n],Wy[s],Wy[l],Wy[u]),this.currentBlendSrc=n,this.currentBlendDst=s,this.currentBlendSrcAlpha=l,this.currentBlendDstAlpha=u),this.currentBlending=e,this.currentPremultipledAlpha=!1}setColorMask(e){this.currentColorMask!==e&&(this.gl.colorMask(e,e,e,e),this.currentColorMask=e)}setDepthTest(e){const{gl:i}=this;e?this.enable(i.DEPTH_TEST):this.disable(i.DEPTH_TEST)}setDepthMask(e){this.currentDepthMask!==e&&(this.gl.depthMask(e),this.currentDepthMask=e)}setDepthFunc(e){if(this.currentDepthFunc!==e){const{gl:i}=this;switch(e){case UU:i.depthFunc(i.NEVER);break;case zU:i.depthFunc(i.ALWAYS);break;case jU:i.depthFunc(i.LESS);break;case L1:i.depthFunc(i.LEQUAL);break;case GU:i.depthFunc(i.EQUAL);break;case VU:i.depthFunc(i.GEQUAL);break;case HU:i.depthFunc(i.GREATER);break;case WU:i.depthFunc(i.NOTEQUAL);break;default:i.depthFunc(i.LEQUAL)}this.currentDepthFunc=e}}setStencilTest(e){const{gl:i}=this;e?this.enable(i.STENCIL_TEST):this.disable(i.STENCIL_TEST)}setStencilMask(e){this.currentStencilMask!==e&&(this.gl.stencilMask(e),this.currentStencilMask=e)}setStencilFunc(e,i,n){(this.currentStencilFunc!==e||this.currentStencilRef!==i||this.currentStencilFuncMask!==n)&&(this.gl.stencilFunc(e,i,n),this.currentStencilFunc=e,this.currentStencilRef=i,this.currentStencilFuncMask=n)}setStencilOp(e,i,n){(this.currentStencilFail!==e||this.currentStencilZFail!==i||this.currentStencilZPass!==n)&&(this.gl.stencilOp(e,i,n),this.currentStencilFail=e,this.currentStencilZFail=i,this.currentStencilZPass=n)}setMaterial(e,i){const{gl:n}=this;e.side===sg?this.disable(n.CULL_FACE):this.enable(n.CULL_FACE);let s=e.side===yc;i&&(s=!s),this.setFlipSided(s),e.blending===dd&&e.transparent===!1?this.setBlending(ag):this.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),this.setDepthFunc(e.depthFunc),this.setDepthTest(e.depthTest),this.setDepthMask(e.depthWrite),this.setColorMask(e.colorWrite);const o=e.stencilWrite;this.setStencilTest(o),o&&(this.setStencilMask(e.stencilWriteMask),this.setStencilFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),this.setStencilOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),this.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),e.alphaToCoverage===!0&&this.backend.renderer.samples>1?this.enable(n.SAMPLE_ALPHA_TO_COVERAGE):this.disable(n.SAMPLE_ALPHA_TO_COVERAGE)}setPolygonOffset(e,i,n){const{gl:s}=this;e?(this.enable(s.POLYGON_OFFSET_FILL),(this.currentPolygonOffsetFactor!==i||this.currentPolygonOffsetUnits!==n)&&(s.polygonOffset(i,n),this.currentPolygonOffsetFactor=i,this.currentPolygonOffsetUnits=n)):this.disable(s.POLYGON_OFFSET_FILL)}useProgram(e){return this.currentProgram!==e?(this.gl.useProgram(e),this.currentProgram=e,!0):!1}bindFramebuffer(e,i){const{gl:n,currentBoundFramebuffers:s}=this;return s[e]!==i?(n.bindFramebuffer(e,i),s[e]=i,e===n.DRAW_FRAMEBUFFER&&(s[n.FRAMEBUFFER]=i),e===n.FRAMEBUFFER&&(s[n.DRAW_FRAMEBUFFER]=i),!0):!1}drawBuffers(e,i){const{gl:n}=this;let s=[],o=!1;if(e.textures!==null){s=this.currentDrawbuffers.get(i),s===void 0&&(s=[],this.currentDrawbuffers.set(i,s));const l=e.textures;if(s.length!==l.length||s[0]!==n.COLOR_ATTACHMENT0){for(let u=0,c=l.length;u<c;u++)s[u]=n.COLOR_ATTACHMENT0+u;s.length=l.length,o=!0}}else s[0]!==n.BACK&&(s[0]=n.BACK,o=!0);o&&n.drawBuffers(s)}activeTexture(e){const{gl:i,currentTextureSlot:n,maxTextures:s}=this;e===void 0&&(e=i.TEXTURE0+s-1),n!==e&&(i.activeTexture(e),this.currentTextureSlot=e)}bindTexture(e,i,n){const{gl:s,currentTextureSlot:o,currentBoundTextures:l,maxTextures:u}=this;n===void 0&&(o===null?n=s.TEXTURE0+u-1:n=o);let c=l[n];c===void 0&&(c={type:void 0,texture:void 0},l[n]=c),(c.type!==e||c.texture!==i)&&(o!==n&&(s.activeTexture(n),this.currentTextureSlot=n),s.bindTexture(e,i),c.type=e,c.texture=i)}bindBufferBase(e,i,n){const{gl:s}=this,o=`${e}-${i}`;return this.currentBoundBufferBases[o]!==n?(s.bindBufferBase(e,i,n),this.currentBoundBufferBases[o]=n,!0):!1}unbindTexture(){const{gl:e,currentTextureSlot:i,currentBoundTextures:n}=this,s=n[i];s!==void 0&&s.type!==void 0&&(e.bindTexture(s.type,null),s.type=void 0,s.texture=void 0)}}class Tve{constructor(e){this.backend=e,this.gl=this.backend.gl,this.extensions=e.extensions}convert(e,i=Up){const{gl:n,extensions:s}=this;let o;if(e===fd)return n.UNSIGNED_BYTE;if(e===Nhe)return n.UNSIGNED_SHORT_4_4_4_4;if(e===Lhe)return n.UNSIGNED_SHORT_5_5_5_1;if(e===QU)return n.UNSIGNED_INT_5_9_9_9_REV;if(e===ny)return n.BYTE;if(e===sy)return n.SHORT;if(e===hg)return n.UNSIGNED_SHORT;if(e===Co)return n.INT;if(e===ja)return n.UNSIGNED_INT;if(e===Al)return n.FLOAT;if(e===Qu)return n.HALF_FLOAT;if(e===Dhe)return n.ALPHA;if(e===t3)return n.RGB;if(e===dg)return n.RGBA;if(e===Ohe)return n.LUMINANCE;if(e===Phe)return n.LUMINANCE_ALPHA;if(e===Fp)return n.DEPTH_COMPONENT;if(e===pg)return n.DEPTH_STENCIL;if(e===i3)return n.RED;if(e===r3)return n.RED_INTEGER;if(e===oy)return n.RG;if(e===n3)return n.RG_INTEGER;if(e===s3)return n.RGBA_INTEGER;if(e===a3||e===k1||e===F1||e===U1)if(i===Lr)if(o=s.get("WEBGL_compressed_texture_s3tc_srgb"),o!==null){if(e===a3)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(e===k1)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(e===F1)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(e===U1)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(o=s.get("WEBGL_compressed_texture_s3tc"),o!==null){if(e===a3)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===k1)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===F1)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===U1)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(e===qU||e===XU||e===KU||e===YU)if(o=s.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(e===qU)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===XU)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===KU)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===YU)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(e===JU||e===o3||e===l3)if(o=s.get("WEBGL_compressed_texture_etc"),o!==null){if(e===JU||e===o3)return i===Lr?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(e===l3)return i===Lr?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(e===c3||e===u3||e===h3||e===d3||e===p3||e===f3||e===m3||e===g3||e===A3||e===y3||e===v3||e===b3||e===x3||e===_3)if(o=s.get("WEBGL_compressed_texture_astc"),o!==null){if(e===c3)return i===Lr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(e===u3)return i===Lr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(e===h3)return i===Lr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(e===d3)return i===Lr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(e===p3)return i===Lr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(e===f3)return i===Lr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(e===m3)return i===Lr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(e===g3)return i===Lr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(e===A3)return i===Lr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(e===y3)return i===Lr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(e===v3)return i===Lr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(e===b3)return i===Lr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(e===x3)return i===Lr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(e===_3)return i===Lr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(e===E3)if(o=s.get("EXT_texture_compression_bptc"),o!==null){if(e===E3)return i===Lr?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(e===Fhe||e===ZU||e===$U||e===e6)if(o=s.get("EXT_texture_compression_rgtc"),o!==null){if(e===E3)return o.COMPRESSED_RED_RGTC1_EXT;if(e===ZU)return o.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(e===$U)return o.COMPRESSED_RED_GREEN_RGTC2_EXT;if(e===e6)return o.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return e===ay?n.UNSIGNED_INT_24_8:n[e]!==void 0?n[e]:null}_clientWaitAsync(){const{gl:e}=this,i=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);return e.flush(),new Promise((n,s)=>{function o(){const l=e.clientWaitSync(i,e.SYNC_FLUSH_COMMANDS_BIT,0);if(l===e.WAIT_FAILED){e.deleteSync(i),s();return}if(l===e.TIMEOUT_EXPIRED){requestAnimationFrame(o);return}e.deleteSync(i),n()}o()})}}let j7=!1,W_,SI,G7;class Mve{constructor(e){this.backend=e,this.gl=e.gl,this.extensions=e.extensions,this.defaultTextures={},j7===!1&&(this._init(this.gl),j7=!0)}_init(e){W_={[O1]:e.REPEAT,[cg]:e.CLAMP_TO_EDGE,[P1]:e.MIRRORED_REPEAT},SI={[no]:e.NEAREST,[$M]:e.NEAREST_MIPMAP_NEAREST,[ug]:e.NEAREST_MIPMAP_LINEAR,[gl]:e.LINEAR,[e3]:e.LINEAR_MIPMAP_NEAREST,[Wu]:e.LINEAR_MIPMAP_LINEAR},G7={[i6]:e.NEVER,[l6]:e.ALWAYS,[C3]:e.LESS,[n6]:e.LEQUAL,[r6]:e.EQUAL,[o6]:e.GEQUAL,[s6]:e.GREATER,[a6]:e.NOTEQUAL}}filterFallback(e){const{gl:i}=this;return e===no||e===$M||e===ug?i.NEAREST:i.LINEAR}getGLTextureType(e){const{gl:i}=this;let n;return e.isCubeTexture===!0?n=i.TEXTURE_CUBE_MAP:e.isDataArrayTexture===!0||e.isCompressedArrayTexture===!0?n=i.TEXTURE_2D_ARRAY:e.isData3DTexture===!0?n=i.TEXTURE_3D:n=i.TEXTURE_2D,n}getInternalFormat(e,i,n,s,o=!1){const{gl:l,extensions:u}=this;if(e!==null){if(l[e]!==void 0)return l[e];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+e+"'")}let c=i;return i===l.RED&&(n===l.FLOAT&&(c=l.R32F),n===l.HALF_FLOAT&&(c=l.R16F),n===l.UNSIGNED_BYTE&&(c=l.R8),n===l.UNSIGNED_SHORT&&(c=l.R16),n===l.UNSIGNED_INT&&(c=l.R32UI),n===l.BYTE&&(c=l.R8I),n===l.SHORT&&(c=l.R16I),n===l.INT&&(c=l.R32I)),i===l.RED_INTEGER&&(n===l.UNSIGNED_BYTE&&(c=l.R8UI),n===l.UNSIGNED_SHORT&&(c=l.R16UI),n===l.UNSIGNED_INT&&(c=l.R32UI),n===l.BYTE&&(c=l.R8I),n===l.SHORT&&(c=l.R16I),n===l.INT&&(c=l.R32I)),i===l.RG&&(n===l.FLOAT&&(c=l.RG32F),n===l.HALF_FLOAT&&(c=l.RG16F),n===l.UNSIGNED_BYTE&&(c=l.RG8),n===l.UNSIGNED_SHORT&&(c=l.RG16),n===l.UNSIGNED_INT&&(c=l.RG32UI),n===l.BYTE&&(c=l.RG8I),n===l.SHORT&&(c=l.RG16I),n===l.INT&&(c=l.RG32I)),i===l.RG_INTEGER&&(n===l.UNSIGNED_BYTE&&(c=l.RG8UI),n===l.UNSIGNED_SHORT&&(c=l.RG16UI),n===l.UNSIGNED_INT&&(c=l.RG32UI),n===l.BYTE&&(c=l.RG8I),n===l.SHORT&&(c=l.RG16I),n===l.INT&&(c=l.RG32I)),i===l.RGB&&(n===l.FLOAT&&(c=l.RGB32F),n===l.HALF_FLOAT&&(c=l.RGB16F),n===l.UNSIGNED_BYTE&&(c=l.RGB8),n===l.UNSIGNED_SHORT&&(c=l.RGB16),n===l.UNSIGNED_INT&&(c=l.RGB32UI),n===l.BYTE&&(c=l.RGB8I),n===l.SHORT&&(c=l.RGB16I),n===l.INT&&(c=l.RGB32I),n===l.UNSIGNED_BYTE&&(c=s===Lr&&o===!1?l.SRGB8:l.RGB8),n===l.UNSIGNED_SHORT_5_6_5&&(c=l.RGB565),n===l.UNSIGNED_SHORT_5_5_5_1&&(c=l.RGB5_A1),n===l.UNSIGNED_SHORT_4_4_4_4&&(c=l.RGB4),n===l.UNSIGNED_INT_5_9_9_9_REV&&(c=l.RGB9_E5)),i===l.RGB_INTEGER&&(n===l.UNSIGNED_BYTE&&(c=l.RGB8UI),n===l.UNSIGNED_SHORT&&(c=l.RGB16UI),n===l.UNSIGNED_INT&&(c=l.RGB32UI),n===l.BYTE&&(c=l.RGB8I),n===l.SHORT&&(c=l.RGB16I),n===l.INT&&(c=l.RGB32I)),i===l.RGBA&&(n===l.FLOAT&&(c=l.RGBA32F),n===l.HALF_FLOAT&&(c=l.RGBA16F),n===l.UNSIGNED_BYTE&&(c=l.RGBA8),n===l.UNSIGNED_SHORT&&(c=l.RGBA16),n===l.UNSIGNED_INT&&(c=l.RGBA32UI),n===l.BYTE&&(c=l.RGBA8I),n===l.SHORT&&(c=l.RGBA16I),n===l.INT&&(c=l.RGBA32I),n===l.UNSIGNED_BYTE&&(c=s===Lr&&o===!1?l.SRGB8_ALPHA8:l.RGBA8),n===l.UNSIGNED_SHORT_4_4_4_4&&(c=l.RGBA4),n===l.UNSIGNED_SHORT_5_5_5_1&&(c=l.RGB5_A1)),i===l.RGBA_INTEGER&&(n===l.UNSIGNED_BYTE&&(c=l.RGBA8UI),n===l.UNSIGNED_SHORT&&(c=l.RGBA16UI),n===l.UNSIGNED_INT&&(c=l.RGBA32UI),n===l.BYTE&&(c=l.RGBA8I),n===l.SHORT&&(c=l.RGBA16I),n===l.INT&&(c=l.RGBA32I)),i===l.DEPTH_COMPONENT&&(n===l.UNSIGNED_INT&&(c=l.DEPTH24_STENCIL8),n===l.FLOAT&&(c=l.DEPTH_COMPONENT32F)),i===l.DEPTH_STENCIL&&n===l.UNSIGNED_INT_24_8&&(c=l.DEPTH24_STENCIL8),(c===l.R16F||c===l.R32F||c===l.RG16F||c===l.RG32F||c===l.RGBA16F||c===l.RGBA32F)&&u.get("EXT_color_buffer_float"),c}setTextureParameters(e,i){const{gl:n,extensions:s,backend:o}=this;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,i.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,i.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,n.NONE),n.texParameteri(e,n.TEXTURE_WRAP_S,W_[i.wrapS]),n.texParameteri(e,n.TEXTURE_WRAP_T,W_[i.wrapT]),(e===n.TEXTURE_3D||e===n.TEXTURE_2D_ARRAY)&&n.texParameteri(e,n.TEXTURE_WRAP_R,W_[i.wrapR]),n.texParameteri(e,n.TEXTURE_MAG_FILTER,SI[i.magFilter]);const l=i.mipmaps!==void 0&&i.mipmaps.length>0,u=i.minFilter===gl&&l?Wu:i.minFilter;if(n.texParameteri(e,n.TEXTURE_MIN_FILTER,SI[u]),i.compareFunction&&(n.texParameteri(e,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(e,n.TEXTURE_COMPARE_FUNC,G7[i.compareFunction])),s.has("EXT_texture_filter_anisotropic")===!0){if(i.magFilter===no||i.minFilter!==ug&&i.minFilter!==Wu||i.type===Al&&s.has("OES_texture_float_linear")===!1)return;if(i.anisotropy>1){const c=s.get("EXT_texture_filter_anisotropic");n.texParameterf(e,c.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(i.anisotropy,o.getMaxAnisotropy()))}}}createDefaultTexture(e){const{gl:i,backend:n,defaultTextures:s}=this,o=this.getGLTextureType(e);let l=s[o];l===void 0&&(l=i.createTexture(),n.state.bindTexture(o,l),i.texParameteri(o,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(o,i.TEXTURE_MAG_FILTER,i.NEAREST),s[o]=l),n.set(e,{textureGPU:l,glTextureType:o,isDefault:!0})}createTexture(e,i){const{gl:n,backend:s}=this,{levels:o,width:l,height:u,depth:c}=i,h=s.utils.convert(e.format,e.colorSpace),p=s.utils.convert(e.type),f=this.getInternalFormat(e.internalFormat,h,p,e.colorSpace,e.isVideoTexture),g=n.createTexture(),m=this.getGLTextureType(e);s.state.bindTexture(m,g),this.setTextureParameters(m,e),e.isDataArrayTexture||e.isCompressedArrayTexture?n.texStorage3D(n.TEXTURE_2D_ARRAY,o,f,l,u,c):e.isData3DTexture?n.texStorage3D(n.TEXTURE_3D,o,f,l,u,c):e.isVideoTexture||n.texStorage2D(m,o,f,l,u),s.set(e,{textureGPU:g,glTextureType:m,glFormat:h,glType:p,glInternalFormat:f})}copyBufferToTexture(e,i){const{gl:n,backend:s}=this,{textureGPU:o,glTextureType:l,glFormat:u,glType:c}=s.get(i),{width:h,height:p}=i.source.data;n.bindBuffer(n.PIXEL_UNPACK_BUFFER,e),s.state.bindTexture(l,o),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n.texSubImage2D(l,0,0,0,h,p,u,c,0),n.bindBuffer(n.PIXEL_UNPACK_BUFFER,null),s.state.unbindTexture()}updateTexture(e,i){const{gl:n}=this,{width:s,height:o}=i,{textureGPU:l,glTextureType:u,glFormat:c,glType:h,glInternalFormat:p}=this.backend.get(e);if(e.isRenderTargetTexture||l===void 0)return;const f=g=>g.isDataTexture?g.image.data:g instanceof ImageBitmap||g instanceof OffscreenCanvas||g instanceof HTMLImageElement||g instanceof HTMLCanvasElement?g:g.data;if(this.backend.state.bindTexture(u,l),this.setTextureParameters(u,e),e.isCompressedTexture){const g=e.mipmaps,m=i.image;for(let y=0;y<g.length;y++){const b=g[y];e.isCompressedArrayTexture?e.format!==n.RGBA?c!==null?n.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,y,0,0,0,b.width,b.height,m.depth,c,b.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texSubImage3D(n.TEXTURE_2D_ARRAY,y,0,0,0,b.width,b.height,m.depth,c,h,b.data):c!==null?n.compressedTexSubImage2D(n.TEXTURE_2D,y,0,0,b.width,b.height,c,b.data):console.warn("Unsupported compressed texture format")}}else if(e.isCubeTexture){const g=i.images;for(let m=0;m<6;m++){const y=f(g[m]);n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+m,0,0,0,s,o,c,h,y)}}else if(e.isDataArrayTexture){const g=i.image;n.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,g.width,g.height,g.depth,c,h,g.data)}else if(e.isData3DTexture){const g=i.image;n.texSubImage3D(n.TEXTURE_3D,0,0,0,0,g.width,g.height,g.depth,c,h,g.data)}else if(e.isVideoTexture)e.update(),n.texImage2D(u,0,p,c,h,i.image);else{const g=f(i.image);n.texSubImage2D(u,0,0,0,s,o,c,h,g)}}generateMipmaps(e){const{gl:i,backend:n}=this,{textureGPU:s,glTextureType:o}=n.get(e);n.state.bindTexture(o,s),i.generateMipmap(o)}deallocateRenderBuffers(e){const{gl:i,backend:n}=this;if(e){const s=n.get(e);if(s.renderBufferStorageSetup=void 0,s.framebuffers){for(const o in s.framebuffers)i.deleteFramebuffer(s.framebuffers[o]);delete s.framebuffers}if(s.depthRenderbuffer&&(i.deleteRenderbuffer(s.depthRenderbuffer),delete s.depthRenderbuffer),s.stencilRenderbuffer&&(i.deleteRenderbuffer(s.stencilRenderbuffer),delete s.stencilRenderbuffer),s.msaaFrameBuffer&&(i.deleteFramebuffer(s.msaaFrameBuffer),delete s.msaaFrameBuffer),s.msaaRenderbuffers){for(let o=0;o<s.msaaRenderbuffers.length;o++)i.deleteRenderbuffer(s.msaaRenderbuffers[o]);delete s.msaaRenderbuffers}}}destroyTexture(e){const{gl:i,backend:n}=this,{textureGPU:s,renderTarget:o}=n.get(e);this.deallocateRenderBuffers(o),i.deleteTexture(s),n.delete(e)}copyTextureToTexture(e,i,n=null,s=null,o=0){const{gl:l,backend:u}=this,{state:c}=this.backend,{textureGPU:h,glTextureType:p,glType:f,glFormat:g}=u.get(i);let m,y,b,v,_,C;n!==null?(m=n.max.x-n.min.x,y=n.max.y-n.min.y,b=n.min.x,v=n.min.y):(m=e.image.width,y=e.image.height,b=0,v=0),s!==null?(_=s.x,C=s.y):(_=0,C=0),c.bindTexture(p,h),l.pixelStorei(l.UNPACK_ALIGNMENT,i.unpackAlignment),l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,i.flipY),l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),l.pixelStorei(l.UNPACK_ALIGNMENT,i.unpackAlignment);const E=l.getParameter(l.UNPACK_ROW_LENGTH),T=l.getParameter(l.UNPACK_IMAGE_HEIGHT),R=l.getParameter(l.UNPACK_SKIP_PIXELS),B=l.getParameter(l.UNPACK_SKIP_ROWS),I=l.getParameter(l.UNPACK_SKIP_IMAGES),D=e.isCompressedTexture?e.mipmaps[o]:e.image;if(l.pixelStorei(l.UNPACK_ROW_LENGTH,D.width),l.pixelStorei(l.UNPACK_IMAGE_HEIGHT,D.height),l.pixelStorei(l.UNPACK_SKIP_PIXELS,b),l.pixelStorei(l.UNPACK_SKIP_ROWS,v),e.isRenderTargetTexture||e.isDepthTexture){const L=u.get(e),O=u.get(i),F=u.get(L.renderTarget),q=u.get(O.renderTarget),H=F.framebuffers[L.cacheKey],G=q.framebuffers[O.cacheKey];c.bindFramebuffer(l.READ_FRAMEBUFFER,H),c.bindFramebuffer(l.DRAW_FRAMEBUFFER,G);let J=l.COLOR_BUFFER_BIT;e.isDepthTexture&&(J=l.DEPTH_BUFFER_BIT),l.blitFramebuffer(b,v,m,y,_,C,m,y,J,l.NEAREST),c.bindFramebuffer(l.READ_FRAMEBUFFER,null),c.bindFramebuffer(l.DRAW_FRAMEBUFFER,null)}else e.isDataTexture?l.texSubImage2D(l.TEXTURE_2D,o,_,C,m,y,g,f,D.data):e.isCompressedTexture?l.compressedTexSubImage2D(l.TEXTURE_2D,o,_,C,D.width,D.height,g,D.data):l.texSubImage2D(l.TEXTURE_2D,o,_,C,m,y,g,f,D);l.pixelStorei(l.UNPACK_ROW_LENGTH,E),l.pixelStorei(l.UNPACK_IMAGE_HEIGHT,T),l.pixelStorei(l.UNPACK_SKIP_PIXELS,R),l.pixelStorei(l.UNPACK_SKIP_ROWS,B),l.pixelStorei(l.UNPACK_SKIP_IMAGES,I),o===0&&i.generateMipmaps&&l.generateMipmap(l.TEXTURE_2D),c.unbindTexture()}copyFramebufferToTexture(e,i,n){const{gl:s}=this,{state:o}=this.backend,{textureGPU:l}=this.backend.get(e),{x:u,y:c,z:h,w:p}=n,f=e.isDepthTexture===!0||i.renderTarget&&i.renderTarget.samples>0,g=i.renderTarget?i.renderTarget.height:this.backend.gerDrawingBufferSize().y;if(f){const m=u!==0||c!==0;let y,b;if(e.isDepthTexture===!0?(y=s.DEPTH_BUFFER_BIT,b=s.DEPTH_ATTACHMENT,i.stencil&&(y|=s.STENCIL_BUFFER_BIT)):(y=s.COLOR_BUFFER_BIT,b=s.COLOR_ATTACHMENT0),m){const v=this.backend.get(i.renderTarget),_=v.framebuffers[i.getCacheKey()],C=v.msaaFrameBuffer;o.bindFramebuffer(s.DRAW_FRAMEBUFFER,_),o.bindFramebuffer(s.READ_FRAMEBUFFER,C);const E=g-c-p;s.blitFramebuffer(u,E,u+h,E+p,u,E,u+h,E+p,y,s.NEAREST),o.bindFramebuffer(s.READ_FRAMEBUFFER,_),o.bindTexture(s.TEXTURE_2D,l),s.copyTexSubImage2D(s.TEXTURE_2D,0,0,0,u,E,h,p),o.unbindTexture()}else{const v=s.createFramebuffer();o.bindFramebuffer(s.DRAW_FRAMEBUFFER,v),s.framebufferTexture2D(s.DRAW_FRAMEBUFFER,b,s.TEXTURE_2D,l,0),s.blitFramebuffer(0,0,h,p,0,0,h,p,y,s.NEAREST),s.deleteFramebuffer(v)}}else o.bindTexture(s.TEXTURE_2D,l),s.copyTexSubImage2D(s.TEXTURE_2D,0,0,0,u,g-p-c,h,p),o.unbindTexture();e.generateMipmaps&&this.generateMipmaps(e),this.backend._setFramebuffer(i)}setupRenderBufferStorage(e,i){const{gl:n}=this,s=i.renderTarget,{samples:o,depthTexture:l,depthBuffer:u,stencilBuffer:c,width:h,height:p}=s;if(n.bindRenderbuffer(n.RENDERBUFFER,e),u&&!c){let f=n.DEPTH_COMPONENT24;o>0?(l&&l.isDepthTexture&&l.type===n.FLOAT&&(f=n.DEPTH_COMPONENT32F),n.renderbufferStorageMultisample(n.RENDERBUFFER,o,f,h,p)):n.renderbufferStorage(n.RENDERBUFFER,f,h,p),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,e)}else u&&c&&(o>0?n.renderbufferStorageMultisample(n.RENDERBUFFER,o,n.DEPTH24_STENCIL8,h,p):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,h,p),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,e))}async copyTextureToBuffer(e,i,n,s,o,l){const{backend:u,gl:c}=this,{textureGPU:h,glFormat:p,glType:f}=this.backend.get(e),g=c.createFramebuffer();c.bindFramebuffer(c.READ_FRAMEBUFFER,g);const m=e.isCubeTexture?c.TEXTURE_CUBE_MAP_POSITIVE_X+l:c.TEXTURE_2D;c.framebufferTexture2D(c.READ_FRAMEBUFFER,c.COLOR_ATTACHMENT0,m,h,0);const y=this._getTypedArrayType(f),b=this._getBytesPerTexel(f,p),v=s*o*b,_=c.createBuffer();c.bindBuffer(c.PIXEL_PACK_BUFFER,_),c.bufferData(c.PIXEL_PACK_BUFFER,v,c.STREAM_READ),c.readPixels(i,n,s,o,p,f,0),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),await u.utils._clientWaitAsync();const C=new y(v/y.BYTES_PER_ELEMENT);return c.bindBuffer(c.PIXEL_PACK_BUFFER,_),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,C),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),c.deleteFramebuffer(g),C}_getTypedArrayType(e){const{gl:i}=this;if(e===i.UNSIGNED_BYTE)return Uint8Array;if(e===i.UNSIGNED_SHORT_4_4_4_4||e===i.UNSIGNED_SHORT_5_5_5_1||e===i.UNSIGNED_SHORT_5_6_5||e===i.UNSIGNED_SHORT)return Uint16Array;if(e===i.UNSIGNED_INT)return Uint32Array;if(e===i.HALF_FLOAT)return Uint16Array;if(e===i.FLOAT)return Float32Array;throw new Error(`Unsupported WebGL type: ${e}`)}_getBytesPerTexel(e,i){const{gl:n}=this;let s=0;if(e===n.UNSIGNED_BYTE&&(s=1),(e===n.UNSIGNED_SHORT_4_4_4_4||e===n.UNSIGNED_SHORT_5_5_5_1||e===n.UNSIGNED_SHORT_5_6_5||e===n.UNSIGNED_SHORT||e===n.HALF_FLOAT)&&(s=2),(e===n.UNSIGNED_INT||e===n.FLOAT)&&(s=4),i===n.RGBA)return s*4;if(i===n.RGB)return s*3;if(i===n.ALPHA)return s}}class Rve{constructor(e){this.backend=e,this.gl=this.backend.gl,this.availableExtensions=this.gl.getSupportedExtensions(),this.extensions={}}get(e){let i=this.extensions[e];return i===void 0&&(i=this.gl.getExtension(e),this.extensions[e]=i),i}has(e){return this.availableExtensions.includes(e)}}class Ive{constructor(e){this.backend=e,this.maxAnisotropy=null}getMaxAnisotropy(){if(this.maxAnisotropy!==null)return this.maxAnisotropy;const e=this.backend.gl,i=this.backend.extensions;if(i.has("EXT_texture_filter_anisotropic")===!0){const n=i.get("EXT_texture_filter_anisotropic");this.maxAnisotropy=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else this.maxAnisotropy=0;return this.maxAnisotropy}}const V7={WEBGL_multi_draw:"WEBGL_multi_draw",WEBGL_compressed_texture_astc:"texture-compression-astc",WEBGL_compressed_texture_etc:"texture-compression-etc2",WEBGL_compressed_texture_etc1:"texture-compression-etc1",WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBKIT_WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBGL_compressed_texture_s3tc:"texture-compression-bc",EXT_texture_compression_bptc:"texture-compression-bptc",EXT_disjoint_timer_query_webgl2:"timestamp-query"};class Bve{constructor(e){this.gl=e.gl,this.extensions=e.extensions,this.info=e.renderer.info,this.mode=null,this.index=0,this.type=null,this.object=null}render(e,i){const{gl:n,mode:s,object:o,type:l,info:u,index:c}=this;c!==0?n.drawElements(s,i,l,e):n.drawArrays(s,e,i),u.update(o,i,s,1)}renderInstances(e,i,n){const{gl:s,mode:o,type:l,index:u,object:c,info:h}=this;n!==0&&(u!==0?s.drawElementsInstanced(o,i,l,e,n):s.drawArraysInstanced(o,e,i,n),h.update(c,i,o,n))}renderMultiDraw(e,i,n){const{extensions:s,mode:o,object:l,info:u}=this;if(n===0)return;const c=s.get("WEBGL_multi_draw");if(c===null)for(let h=0;h<n;h++)this.render(e[h],i[h]);else{this.index!==0?c.multiDrawElementsWEBGL(o,i,0,this.type,e,0,n):c.multiDrawArraysWEBGL(o,e,0,i,0,n);let h=0;for(let p=0;p<n;p++)h+=i[p];u.update(l,h,o,1)}}renderMultiDrawInstances(e,i,n,s){const{extensions:o,mode:l,object:u,info:c}=this;if(n===0)return;const h=o.get("WEBGL_multi_draw");if(h===null)for(let p=0;p<n;p++)this.renderInstances(e[p],i[p],s[p]);else{this.index!==0?h.multiDrawElementsInstancedWEBGL(l,i,0,this.type,e,0,s,0,n):h.multiDrawArraysInstancedWEBGL(l,e,0,i,0,s,0,n);let p=0;for(let f=0;f<n;f++)p+=i[f]*s[f];c.update(u,p,l,1)}}}class H7 extends U7{constructor(e={}){super(e),this.isWebGLBackend=!0}init(e){super.init(e);const i=this.parameters,n=i.context!==void 0?i.context:e.domElement.getContext("webgl2");function s(o){o.preventDefault();const l={api:"WebGL",message:o.statusMessage||"Unknown reason",reason:null,originalEvent:o};e.onDeviceLost(l)}this._onContextLost=s,e.domElement.addEventListener("webglcontextlost",s,!1),this.gl=n,this.extensions=new Rve(this),this.capabilities=new Ive(this),this.attributeUtils=new Cve(this),this.textureUtils=new Mve(this),this.bufferRenderer=new Bve(this),this.state=new Sve(this),this.utils=new Tve(this),this.vaoCache={},this.transformFeedbackCache={},this.discard=!1,this.trackTimestamp=i.trackTimestamp===!0,this.extensions.get("EXT_color_buffer_float"),this.extensions.get("WEBGL_clip_cull_distance"),this.extensions.get("OES_texture_float_linear"),this.extensions.get("EXT_color_buffer_half_float"),this.extensions.get("WEBGL_multisampled_render_to_texture"),this.extensions.get("WEBGL_render_shared_exponent"),this.extensions.get("WEBGL_multi_draw"),this.disjoint=this.extensions.get("EXT_disjoint_timer_query_webgl2"),this.parallel=this.extensions.get("KHR_parallel_shader_compile"),this._knownBindings=new WeakSet,this._currentContext=null}get coordinateSystem(){return vc}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}async waitForGPU(){await this.utils._clientWaitAsync()}initTimestampQuery(e){if(!this.disjoint||!this.trackTimestamp)return;const i=this.get(e);if(this.queryRunning){i.queryQueue||(i.queryQueue=[]),i.queryQueue.push(e);return}i.activeQuery&&(this.gl.endQuery(this.disjoint.TIME_ELAPSED_EXT),i.activeQuery=null),i.activeQuery=this.gl.createQuery(),i.activeQuery!==null&&(this.gl.beginQuery(this.disjoint.TIME_ELAPSED_EXT,i.activeQuery),this.queryRunning=!0)}prepareTimestampBuffer(e){if(!this.disjoint||!this.trackTimestamp)return;const i=this.get(e);if(i.activeQuery&&(this.gl.endQuery(this.disjoint.TIME_ELAPSED_EXT),i.gpuQueries||(i.gpuQueries=[]),i.gpuQueries.push({query:i.activeQuery}),i.activeQuery=null,this.queryRunning=!1,i.queryQueue&&i.queryQueue.length>0)){const n=i.queryQueue.shift();this.initTimestampQuery(n)}}async resolveTimestampAsync(e,i="render"){if(!this.disjoint||!this.trackTimestamp)return;const n=this.get(e);n.gpuQueries||(n.gpuQueries=[]);for(let s=0;s<n.gpuQueries.length;s++){const o=n.gpuQueries[s],l=this.gl.getQueryParameter(o.query,this.gl.QUERY_RESULT_AVAILABLE),u=this.gl.getParameter(this.disjoint.GPU_DISJOINT_EXT);if(l&&!u){const c=this.gl.getQueryParameter(o.query,this.gl.QUERY_RESULT),h=Number(c)/1e6;this.gl.deleteQuery(o.query),n.gpuQueries.splice(s,1),s--,this.renderer.info.updateTimestamp(i,h)}}}getContext(){return this.gl}beginRender(e){const{gl:i}=this,n=this.get(e);if(this.initTimestampQuery(e),n.previousContext=this._currentContext,this._currentContext=e,this._setFramebuffer(e),this.clear(e.clearColor,e.clearDepth,e.clearStencil,e,!1),e.viewport?this.updateViewport(e):i.viewport(0,0,i.drawingBufferWidth,i.drawingBufferHeight),e.scissor){const{x:o,y:l,width:u,height:c}=e.scissorValue;i.scissor(o,e.height-c-l,u,c)}const s=e.occlusionQueryCount;s>0&&(n.currentOcclusionQueries=n.occlusionQueries,n.currentOcclusionQueryObjects=n.occlusionQueryObjects,n.lastOcclusionObject=null,n.occlusionQueries=new Array(s),n.occlusionQueryObjects=new Array(s),n.occlusionQueryIndex=0)}finishRender(e){const{gl:i,state:n}=this,s=this.get(e),o=s.previousContext,l=e.occlusionQueryCount;l>0&&(l>s.occlusionQueryIndex&&i.endQuery(i.ANY_SAMPLES_PASSED),this.resolveOccludedAsync(e));const u=e.textures;if(u!==null)for(let c=0;c<u.length;c++){const h=u[c];h.generateMipmaps&&this.generateMipmaps(h)}if(this._currentContext=o,e.textures!==null&&e.renderTarget){const c=this.get(e.renderTarget),{samples:h}=e.renderTarget;if(h>0){const p=c.framebuffers[e.getCacheKey()],f=i.COLOR_BUFFER_BIT,g=c.msaaFrameBuffer,m=e.textures;n.bindFramebuffer(i.READ_FRAMEBUFFER,g),n.bindFramebuffer(i.DRAW_FRAMEBUFFER,p);for(let y=0;y<m.length;y++)if(e.scissor){const{x:b,y:v,width:_,height:C}=e.scissorValue,E=e.height-C-v;i.blitFramebuffer(b,E,b+_,E+C,b,E,b+_,E+C,f,i.NEAREST),i.invalidateSubFramebuffer(i.READ_FRAMEBUFFER,c.invalidationArray,b,E,_,C)}else i.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,f,i.NEAREST),i.invalidateFramebuffer(i.READ_FRAMEBUFFER,c.invalidationArray)}}o!==null&&(this._setFramebuffer(o),o.viewport?this.updateViewport(o):i.viewport(0,0,i.drawingBufferWidth,i.drawingBufferHeight)),this.prepareTimestampBuffer(e)}resolveOccludedAsync(e){const i=this.get(e),{currentOcclusionQueries:n,currentOcclusionQueryObjects:s}=i;if(n&&s){const o=new WeakSet,{gl:l}=this;i.currentOcclusionQueryObjects=null,i.currentOcclusionQueries=null;const u=()=>{let c=0;for(let h=0;h<n.length;h++){const p=n[h];p!==null&&l.getQueryParameter(p,l.QUERY_RESULT_AVAILABLE)&&(l.getQueryParameter(p,l.QUERY_RESULT)>0&&o.add(s[h]),n[h]=null,l.deleteQuery(p),c++)}c<n.length?requestAnimationFrame(u):i.occluded=o};u()}}isOccluded(e,i){const n=this.get(e);return n.occluded&&n.occluded.has(i)}updateViewport(e){const i=this.gl,{x:n,y:s,width:o,height:l}=e.viewportValue;i.viewport(n,e.height-l-s,o,l)}setScissorTest(e){const i=this.gl;e?i.enable(i.SCISSOR_TEST):i.disable(i.SCISSOR_TEST)}clear(e,i,n,s=null,o=!0){const{gl:l}=this;if(s===null){const c=this.getClearColor();c.r*=c.a,c.g*=c.a,c.b*=c.a,s={textures:null,clearColorValue:c}}let u=0;if(e&&(u|=l.COLOR_BUFFER_BIT),i&&(u|=l.DEPTH_BUFFER_BIT),n&&(u|=l.STENCIL_BUFFER_BIT),u!==0){let c;if(s.clearColorValue?c=s.clearColorValue:(c=this.getClearColor(),c.r*=c.a,c.g*=c.a,c.b*=c.a),i&&this.state.setDepthMask(!0),s.textures===null)l.clearColor(c.r,c.g,c.b,c.a),l.clear(u);else{if(o&&this._setFramebuffer(s),e)for(let h=0;h<s.textures.length;h++)l.clearBufferfv(l.COLOR,h,[c.r,c.g,c.b,c.a]);i&&n?l.clearBufferfi(l.DEPTH_STENCIL,0,1,0):i?l.clearBufferfv(l.DEPTH,0,[1]):n&&l.clearBufferiv(l.STENCIL,0,[0])}}}beginCompute(e){const{state:i,gl:n}=this;i.bindFramebuffer(n.FRAMEBUFFER,null),this.initTimestampQuery(e)}compute(e,i,n,s){const{state:o,gl:l}=this;this.discard||(l.enable(l.RASTERIZER_DISCARD),this.discard=!0);const{programGPU:u,transformBuffers:c,attributes:h}=this.get(s),p=this._getVaoKey(null,h),f=this.vaoCache[p];f===void 0?this._createVao(null,h):l.bindVertexArray(f),o.useProgram(u),this._bindUniforms(n);const g=this._getTransformFeedback(c);l.bindTransformFeedback(l.TRANSFORM_FEEDBACK,g),l.beginTransformFeedback(l.POINTS),h[0].isStorageInstancedBufferAttribute?l.drawArraysInstanced(l.POINTS,0,1,i.count):l.drawArrays(l.POINTS,0,i.count),l.endTransformFeedback(),l.bindTransformFeedback(l.TRANSFORM_FEEDBACK,null);for(let m=0;m<c.length;m++){const y=c[m];y.pbo&&this.textureUtils.copyBufferToTexture(y.transformBuffer,y.pbo),y.switchBuffers()}}finishCompute(e){const i=this.gl;this.discard=!1,i.disable(i.RASTERIZER_DISCARD),this.prepareTimestampBuffer(e),this._currentContext&&this._setFramebuffer(this._currentContext)}draw(e){const{object:i,pipeline:n,material:s,context:o}=e,{programGPU:l}=this.get(n),{gl:u,state:c}=this,h=this.get(o),p=e.getDrawParameters();if(p===null)return;this._bindUniforms(e.getBindings());const f=i.isMesh&&i.matrixWorld.determinant()<0;c.setMaterial(s,f),c.useProgram(l);let g=e.staticVao;if(g===void 0){const E=this._getVaoKey(e.getIndex(),e.getAttributes());if(g=this.vaoCache[E],g===void 0){let T;({vaoGPU:g,staticVao:T}=this._createVao(e.getIndex(),e.getAttributes())),T&&(e.staticVao=g)}}u.bindVertexArray(g);const m=e.getIndex(),y=h.lastOcclusionObject;if(y!==i&&y!==void 0){if(y!==null&&y.occlusionTest===!0&&(u.endQuery(u.ANY_SAMPLES_PASSED),h.occlusionQueryIndex++),i.occlusionTest===!0){const E=u.createQuery();u.beginQuery(u.ANY_SAMPLES_PASSED,E),h.occlusionQueries[h.occlusionQueryIndex]=E,h.occlusionQueryObjects[h.occlusionQueryIndex]=i}h.lastOcclusionObject=i}const b=this.bufferRenderer;i.isPoints?b.mode=u.POINTS:i.isLineSegments?b.mode=u.LINES:i.isLine?b.mode=u.LINE_STRIP:i.isLineLoop?b.mode=u.LINE_LOOP:s.wireframe===!0?(c.setLineWidth(s.wireframeLinewidth*this.renderer.getPixelRatio()),b.mode=u.LINES):b.mode=u.TRIANGLES;const{vertexCount:v,instanceCount:_}=p;let{firstVertex:C}=p;if(b.object=i,m!==null){C*=m.array.BYTES_PER_ELEMENT;const E=this.get(m);b.index=m.count,b.type=E.type}else b.index=0;i.isBatchedMesh?i._multiDrawInstances!==null?b.renderMultiDrawInstances(i._multiDrawStarts,i._multiDrawCounts,i._multiDrawCount,i._multiDrawInstances):this.hasFeature("WEBGL_multi_draw")?b.renderMultiDraw(i._multiDrawStarts,i._multiDrawCounts,i._multiDrawCount):vde("THREE.WebGLRenderer: WEBGL_multi_draw not supported."):_>1?b.renderInstances(C,v,_):b.render(C,v),u.bindVertexArray(null)}needsRenderUpdate(){return!1}getRenderCacheKey(){return""}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,i){this.textureUtils.createTexture(e,i)}updateTexture(e,i){this.textureUtils.updateTexture(e,i)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e){this.textureUtils.destroyTexture(e)}copyTextureToBuffer(e,i,n,s,o,l){return this.textureUtils.copyTextureToBuffer(e,i,n,s,o,l)}createSampler(){}destroySampler(){}createNodeBuilder(e,i){return new _ve(e,i)}createProgram(e){const i=this.gl,{stage:n,code:s}=e,o=n==="fragment"?i.createShader(i.FRAGMENT_SHADER):i.createShader(i.VERTEX_SHADER);i.shaderSource(o,s),i.compileShader(o),this.set(e,{shaderGPU:o})}destroyProgram(){console.warn("Abstract class.")}createRenderPipeline(e,i){const n=this.gl,s=e.pipeline,{fragmentProgram:o,vertexProgram:l}=s,u=n.createProgram(),c=this.get(o).shaderGPU,h=this.get(l).shaderGPU;if(n.attachShader(u,c),n.attachShader(u,h),n.linkProgram(u),this.set(s,{programGPU:u,fragmentShader:c,vertexShader:h}),i!==null&&this.parallel){const p=new Promise(f=>{const g=this.parallel,m=()=>{n.getProgramParameter(u,g.COMPLETION_STATUS_KHR)?(this._completeCompile(e,s),f()):requestAnimationFrame(m)};m()});i.push(p);return}this._completeCompile(e,s)}_handleSource(e,i){const n=e.split(`
`),s=[],o=Math.max(i-6,0),l=Math.min(i+6,n.length);for(let u=o;u<l;u++){const c=u+1;s.push(`${c===i?">":" "} ${c}: ${n[u]}`)}return s.join(`
`)}_getShaderErrors(e,i,n){const s=e.getShaderParameter(i,e.COMPILE_STATUS),o=e.getShaderInfoLog(i).trim();if(s&&o==="")return"";const l=/ERROR: 0:(\d+)/.exec(o);if(l){const u=parseInt(l[1]);return n.toUpperCase()+`

`+o+`

`+this._handleSource(e.getShaderSource(i),u)}else return o}_logProgramError(e,i,n){if(this.renderer.debug.checkShaderErrors){const s=this.gl,o=s.getProgramInfoLog(e).trim();if(s.getProgramParameter(e,s.LINK_STATUS)===!1)if(typeof this.renderer.debug.onShaderError=="function")this.renderer.debug.onShaderError(s,e,n,i);else{const l=this._getShaderErrors(s,n,"vertex"),u=this._getShaderErrors(s,i,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(e,s.VALIDATE_STATUS)+`

Program Info Log: `+o+`
`+l+`
`+u)}else o!==""&&console.warn("THREE.WebGLProgram: Program Info Log:",o)}}_completeCompile(e,i){const{state:n,gl:s}=this,o=this.get(i),{programGPU:l,fragmentShader:u,vertexShader:c}=o;s.getProgramParameter(l,s.LINK_STATUS)===!1&&this._logProgramError(l,u,c),n.useProgram(l);const h=e.getBindings();this._setupBindings(h,l),this.set(i,{programGPU:l})}createComputePipeline(e,i){const{state:n,gl:s}=this,o={stage:"fragment",code:`#version 300 es
precision highp float;
void main() {}`};this.createProgram(o);const{computeProgram:l}=e,u=s.createProgram(),c=this.get(o).shaderGPU,h=this.get(l).shaderGPU,p=l.transforms,f=[],g=[];for(let v=0;v<p.length;v++){const _=p[v];f.push(_.varyingName),g.push(_.attributeNode)}s.attachShader(u,c),s.attachShader(u,h),s.transformFeedbackVaryings(u,f,s.SEPARATE_ATTRIBS),s.linkProgram(u),s.getProgramParameter(u,s.LINK_STATUS)===!1&&this._logProgramError(u,c,h),n.useProgram(u),this._setupBindings(i,u);const m=l.attributes,y=[],b=[];for(let v=0;v<m.length;v++){const _=m[v].node.attribute;y.push(_),this.has(_)||this.attributeUtils.createAttribute(_,s.ARRAY_BUFFER)}for(let v=0;v<g.length;v++){const _=g[v].attribute;this.has(_)||this.attributeUtils.createAttribute(_,s.ARRAY_BUFFER);const C=this.get(_);b.push(C)}this.set(e,{programGPU:u,transformBuffers:b,attributes:y})}createBindings(e,i){if(this._knownBindings.has(i)===!1){this._knownBindings.add(i);let n=0,s=0;for(const o of i){this.set(o,{textures:s,uniformBuffers:n});for(const l of o.bindings)l.isUniformBuffer&&n++,l.isSampledTexture&&s++}}this.updateBindings(e,i)}updateBindings(e){const{gl:i}=this,n=this.get(e);let s=n.uniformBuffers,o=n.textures;for(const l of e.bindings)if(l.isUniformsGroup||l.isUniformBuffer){const u=l.buffer,c=i.createBuffer();i.bindBuffer(i.UNIFORM_BUFFER,c),i.bufferData(i.UNIFORM_BUFFER,u,i.DYNAMIC_DRAW),this.set(l,{index:s++,bufferGPU:c})}else if(l.isSampledTexture){const{textureGPU:u,glTextureType:c}=this.get(l.texture);this.set(l,{index:o++,textureGPU:u,glTextureType:c})}}updateBinding(e){const i=this.gl;if(e.isUniformsGroup||e.isUniformBuffer){const n=this.get(e).bufferGPU,s=e.buffer;i.bindBuffer(i.UNIFORM_BUFFER,n),i.bufferData(i.UNIFORM_BUFFER,s,i.DYNAMIC_DRAW)}}createIndexAttribute(e){const i=this.gl;this.attributeUtils.createAttribute(e,i.ELEMENT_ARRAY_BUFFER)}createAttribute(e){if(this.has(e))return;const i=this.gl;this.attributeUtils.createAttribute(e,i.ARRAY_BUFFER)}createStorageAttribute(e){if(this.has(e))return;const i=this.gl;this.attributeUtils.createAttribute(e,i.ARRAY_BUFFER)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}updateSize(){}hasFeature(e){const i=Object.keys(V7).filter(s=>V7[s]===e),n=this.extensions;for(let s=0;s<i.length;s++)if(n.has(i[s]))return!0;return!1}getMaxAnisotropy(){return this.capabilities.getMaxAnisotropy()}copyTextureToTexture(e,i,n,s,o){this.textureUtils.copyTextureToTexture(e,i,n,s,o)}copyFramebufferToTexture(e,i,n){this.textureUtils.copyFramebufferToTexture(e,i,n)}_setFramebuffer(e){const{gl:i,state:n}=this;let s=null;if(e.textures!==null){const o=e.renderTarget,l=this.get(o),{samples:u,depthBuffer:c,stencilBuffer:h}=o,p=o.isWebGLCubeRenderTarget===!0;let f=l.msaaFrameBuffer,g=l.depthRenderbuffer;const m=i7(e);let y;if(p?(l.cubeFramebuffers||(l.cubeFramebuffers={}),y=l.cubeFramebuffers[m]):(l.framebuffers||(l.framebuffers={}),y=l.framebuffers[m]),y===void 0){y=i.createFramebuffer(),n.bindFramebuffer(i.FRAMEBUFFER,y);const b=e.textures;if(p){l.cubeFramebuffers[m]=y;const{textureGPU:v}=this.get(b[0]),_=this.renderer._activeCubeFace;i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+_,v,0)}else{l.framebuffers[m]=y;for(let v=0;v<b.length;v++){const _=b[v],C=this.get(_);C.renderTarget=e.renderTarget,C.cacheKey=m;const E=i.COLOR_ATTACHMENT0+v;i.framebufferTexture2D(i.FRAMEBUFFER,E,i.TEXTURE_2D,C.textureGPU,0)}n.drawBuffers(e,y)}if(e.depthTexture!==null){const v=this.get(e.depthTexture),_=h?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;v.renderTarget=e.renderTarget,v.cacheKey=m,i.framebufferTexture2D(i.FRAMEBUFFER,_,i.TEXTURE_2D,v.textureGPU,0)}}if(u>0){if(f===void 0){const b=[];f=i.createFramebuffer(),n.bindFramebuffer(i.FRAMEBUFFER,f);const v=[],_=e.textures;for(let C=0;C<_.length;C++){if(v[C]=i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,v[C]),b.push(i.COLOR_ATTACHMENT0+C),c){const R=h?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;b.push(R)}const E=e.textures[C],T=this.get(E);i.renderbufferStorageMultisample(i.RENDERBUFFER,u,T.glInternalFormat,e.width,e.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+C,i.RENDERBUFFER,v[C])}if(l.msaaFrameBuffer=f,l.msaaRenderbuffers=v,g===void 0){g=i.createRenderbuffer(),this.textureUtils.setupRenderBufferStorage(g,e),l.depthRenderbuffer=g;const C=h?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;b.push(C)}l.invalidationArray=b}s=l.msaaFrameBuffer}else s=y}n.bindFramebuffer(i.FRAMEBUFFER,s)}_getVaoKey(e,i){let n=[];if(e!==null){const s=this.get(e);n+=":"+s.id}for(let s=0;s<i.length;s++){const o=this.get(i[s]);n+=":"+o.id}return n}_createVao(e,i){const{gl:n}=this,s=n.createVertexArray();let o="",l=!0;if(n.bindVertexArray(s),e!==null){const u=this.get(e);n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,u.bufferGPU),o+=":"+u.id}for(let u=0;u<i.length;u++){const c=i[u],h=this.get(c);o+=":"+h.id,n.bindBuffer(n.ARRAY_BUFFER,h.bufferGPU),n.enableVertexAttribArray(u),(c.isStorageBufferAttribute||c.isStorageInstancedBufferAttribute)&&(l=!1);let p,f;c.isInterleavedBufferAttribute===!0?(p=c.data.stride*h.bytesPerElement,f=c.offset*h.bytesPerElement):(p=0,f=0),h.isInteger?n.vertexAttribIPointer(u,c.itemSize,h.type,p,f):n.vertexAttribPointer(u,c.itemSize,h.type,c.normalized,p,f),c.isInstancedBufferAttribute&&!c.isInterleavedBufferAttribute?n.vertexAttribDivisor(u,c.meshPerAttribute):c.isInterleavedBufferAttribute&&c.data.isInstancedInterleavedBuffer&&n.vertexAttribDivisor(u,c.data.meshPerAttribute)}return n.bindBuffer(n.ARRAY_BUFFER,null),this.vaoCache[o]=s,{vaoGPU:s,staticVao:l}}_getTransformFeedback(e){let i="";for(let o=0;o<e.length;o++)i+=":"+e[o].id;let n=this.transformFeedbackCache[i];if(n!==void 0)return n;const{gl:s}=this;n=s.createTransformFeedback(),s.bindTransformFeedback(s.TRANSFORM_FEEDBACK,n);for(let o=0;o<e.length;o++){const l=e[o];s.bindBufferBase(s.TRANSFORM_FEEDBACK_BUFFER,o,l.transformBuffer)}return s.bindTransformFeedback(s.TRANSFORM_FEEDBACK,null),this.transformFeedbackCache[i]=n,n}_setupBindings(e,i){const n=this.gl;for(const s of e)for(const o of s.bindings){const l=this.get(o).index;if(o.isUniformsGroup||o.isUniformBuffer){const u=n.getUniformBlockIndex(i,o.name);n.uniformBlockBinding(i,u,l)}else if(o.isSampledTexture){const u=n.getUniformLocation(i,o.name);n.uniform1i(u,l)}}}_bindUniforms(e){const{gl:i,state:n}=this;for(const s of e)for(const o of s.bindings){const l=this.get(o),u=l.index;o.isUniformsGroup||o.isUniformBuffer?n.bindBufferBase(i.UNIFORM_BUFFER,u,l.bufferGPU):o.isSampledTexture&&n.bindTexture(l.glTextureType,l.textureGPU,i.TEXTURE0+u)}}dispose(){this.renderer.domElement.removeEventListener("webglcontextlost",this._onContextLost)}}class Nve extends _I{constructor(e,i){super(e),this.texture=i,this.version=i?i.version:0,this.isSampler=!0}}class Lve extends Nve{constructor(e,i,n){super(e,i?i.value:null),this.textureNode=i,this.groupNode=n}update(){this.texture=this.textureNode.value}}class Dve extends B7{constructor(e,i){super(e,i?i.array:null),this.attribute=i,this.isStorageBuffer=!0}}let Ove=0;class Pve extends Dve{constructor(e,i){super("StorageBuffer_"+Ove++,e?e.value:null),this.nodeUniform=e,this.access=e?e.access:rI.Storage,this.groupNode=i}get buffer(){return this.nodeUniform.value}}class kve extends Id{constructor(e){super(),this.device=e;const i=`
struct VarysStruct {
	@builtin( position ) Position: vec4<f32>,
	@location( 0 ) vTex : vec2<f32>
};

@vertex
fn main( @builtin( vertex_index ) vertexIndex : u32 ) -> VarysStruct {

	var Varys : VarysStruct;

	var pos = array< vec2<f32>, 4 >(
		vec2<f32>( -1.0,  1.0 ),
		vec2<f32>(  1.0,  1.0 ),
		vec2<f32>( -1.0, -1.0 ),
		vec2<f32>(  1.0, -1.0 )
	);

	var tex = array< vec2<f32>, 4 >(
		vec2<f32>( 0.0, 0.0 ),
		vec2<f32>( 1.0, 0.0 ),
		vec2<f32>( 0.0, 1.0 ),
		vec2<f32>( 1.0, 1.0 )
	);

	Varys.vTex = tex[ vertexIndex ];
	Varys.Position = vec4<f32>( pos[ vertexIndex ], 0.0, 1.0 );

	return Varys;

}
`,n=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vTex );

}
`,s=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vec2( vTex.x, 1.0 - vTex.y ) );

}
`;this.mipmapSampler=e.createSampler({minFilter:tf.Linear}),this.flipYSampler=e.createSampler({minFilter:tf.Nearest}),this.transferPipelines={},this.flipYPipelines={},this.mipmapVertexShaderModule=e.createShaderModule({label:"mipmapVertex",code:i}),this.mipmapFragmentShaderModule=e.createShaderModule({label:"mipmapFragment",code:n}),this.flipYFragmentShaderModule=e.createShaderModule({label:"flipYFragment",code:s})}getTransferPipeline(e){let i=this.transferPipelines[e];return i===void 0&&(i=this.device.createRenderPipeline({label:`mipmap-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.mipmapFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:Vg.TriangleStrip,stripIndexFormat:Hg.Uint32},layout:"auto"}),this.transferPipelines[e]=i),i}getFlipYPipeline(e){let i=this.flipYPipelines[e];return i===void 0&&(i=this.device.createRenderPipeline({label:`flipY-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.flipYFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:Vg.TriangleStrip,stripIndexFormat:Hg.Uint32},layout:"auto"}),this.flipYPipelines[e]=i),i}flipY(e,i,n=0){const s=i.format,{width:o,height:l}=i.size,u=this.getTransferPipeline(s),c=this.getFlipYPipeline(s),h=this.device.createTexture({size:{width:o,height:l,depthOrArrayLayers:1},format:s,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),p=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:jl.TwoD,baseArrayLayer:n}),f=h.createView({baseMipLevel:0,mipLevelCount:1,dimension:jl.TwoD,baseArrayLayer:0}),g=this.device.createCommandEncoder({}),m=(y,b,v)=>{const _=y.getBindGroupLayout(0),C=this.device.createBindGroup({layout:_,entries:[{binding:0,resource:this.flipYSampler},{binding:1,resource:b}]}),E=g.beginRenderPass({colorAttachments:[{view:v,loadOp:la.Clear,storeOp:qa.Store,clearValue:[0,0,0,0]}]});E.setPipeline(y),E.setBindGroup(0,C),E.draw(4,1,0,0),E.end()};m(u,p,f),m(c,f,p),this.device.queue.submit([g.finish()]),h.destroy()}generateMipmaps(e,i,n=0){const s=this.get(e);s.useCount===void 0&&(s.useCount=0,s.layers=[]);const o=s.layers[n]||this._mipmapCreateBundles(e,i,n),l=this.device.createCommandEncoder({});this._mipmapRunBundles(l,o),this.device.queue.submit([l.finish()]),s.useCount!==0&&(s.layers[n]=o),s.useCount++}_mipmapCreateBundles(e,i,n){const s=this.getTransferPipeline(i.format),o=s.getBindGroupLayout(0);let l=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:jl.TwoD,baseArrayLayer:n});const u=[];for(let c=1;c<i.mipLevelCount;c++){const h=this.device.createBindGroup({layout:o,entries:[{binding:0,resource:this.mipmapSampler},{binding:1,resource:l}]}),p=e.createView({baseMipLevel:c,mipLevelCount:1,dimension:jl.TwoD,baseArrayLayer:n}),f={colorAttachments:[{view:p,loadOp:la.Clear,storeOp:qa.Store,clearValue:[0,0,0,0]}]},g=this.device.createRenderBundleEncoder({colorFormats:[i.format]});g.setPipeline(s),g.setBindGroup(0,h),g.draw(4,1,0,0),u.push({renderBundles:[g.finish()],passDescriptor:f}),l=p}return u}_mipmapRunBundles(e,i){const n=i.length;for(let s=0;s<n;s++){const o=i[s],l=e.beginRenderPass(o.passDescriptor);l.executeBundles(o.renderBundles),l.end()}}}const Fve={[i6]:"never",[C3]:"less",[r6]:"equal",[n6]:"less-equal",[s6]:"greater",[o6]:"greater-equal",[l6]:"always",[a6]:"not-equal"},Uve=[0,1,3,2,4,5];class zve{constructor(e){this.backend=e,this._passUtils=null,this.defaultTexture={},this.defaultCubeTexture={},this.defaultVideoFrame=null,this.colorBuffer=null,this.depthTexture=new Ig,this.depthTexture.name="depthBuffer"}createSampler(e){const i=this.backend,n=i.device,s=i.get(e),o={addressModeU:this._convertAddressMode(e.wrapS),addressModeV:this._convertAddressMode(e.wrapT),addressModeW:this._convertAddressMode(e.wrapR),magFilter:this._convertFilterMode(e.magFilter),minFilter:this._convertFilterMode(e.minFilter),mipmapFilter:this._convertFilterMode(e.minFilter),maxAnisotropy:1};o.magFilter===tf.Linear&&o.minFilter===tf.Linear&&o.mipmapFilter===tf.Linear&&(o.maxAnisotropy=e.anisotropy),e.isDepthTexture&&e.compareFunction!==null&&(o.compare=Fve[e.compareFunction]),s.sampler=n.createSampler(o)}createDefaultTexture(e){let i;const n=TI(e);e.isCubeTexture?i=this._getDefaultCubeTextureGPU(n):e.isVideoTexture?this.backend.get(e).externalTexture=this._getDefaultVideoFrame():i=this._getDefaultTextureGPU(n),this.backend.get(e).texture=i}createTexture(e,i={}){const n=this.backend,s=n.get(e);if(s.initialized)throw new Error("WebGPUTextureUtils: Texture already initialized.");i.needsMipmaps===void 0&&(i.needsMipmaps=!1),i.levels===void 0&&(i.levels=1),i.depth===void 0&&(i.depth=1);const{width:o,height:l,depth:u,levels:c}=i;e.isFramebufferTexture&&(i.renderTarget?i.format=this.backend.utils.getCurrentColorFormat(i.renderTarget):i.format=this.backend.utils.getPreferredCanvasFormat());const h=this._getDimension(e),p=e.internalFormat||i.format||TI(e,n.device);s.format=p;let f=i.sampleCount!==void 0?i.sampleCount:1;f=n.utils.getSampleCount(f);const g=e.isRenderTargetTexture&&!e.isMultisampleRenderTargetTexture?1:f;let m=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;e.isStorageTexture===!0&&(m|=GPUTextureUsage.STORAGE_BINDING),e.isCompressedTexture!==!0&&e.isCompressedArrayTexture!==!0&&(m|=GPUTextureUsage.RENDER_ATTACHMENT);const y={label:e.name,size:{width:o,height:l,depthOrArrayLayers:u},mipLevelCount:c,sampleCount:g,dimension:h,format:p,usage:m};if(e.isVideoTexture){const b=e.source.data,v=new VideoFrame(b);y.size.width=v.displayWidth,y.size.height=v.displayHeight,v.close(),s.externalTexture=b}else{if(p===void 0)return console.warn("WebGPURenderer: Texture format not supported."),this.createDefaultTexture(e);s.texture=n.device.createTexture(y)}if(e.isRenderTargetTexture&&f>1&&!e.isMultisampleRenderTargetTexture){const b=Object.assign({},y);b.label=b.label+"-msaa",b.sampleCount=f,s.msaaTexture=n.device.createTexture(b)}s.initialized=!0,s.textureDescriptorGPU=y}destroyTexture(e){const i=this.backend,n=i.get(e);n.texture.destroy(),n.msaaTexture!==void 0&&n.msaaTexture.destroy(),i.delete(e)}destroySampler(e){const i=this.backend.get(e);delete i.sampler}generateMipmaps(e){const i=this.backend.get(e);if(e.isCubeTexture)for(let n=0;n<6;n++)this._generateMipmaps(i.texture,i.textureDescriptorGPU,n);else{const n=e.image.depth||1;for(let s=0;s<n;s++)this._generateMipmaps(i.texture,i.textureDescriptorGPU,s)}}getColorBuffer(){this.colorBuffer&&this.colorBuffer.destroy();const e=this.backend,{width:i,height:n}=e.getDrawingBufferSize();return this.colorBuffer=e.device.createTexture({label:"colorBuffer",size:{width:i,height:n,depthOrArrayLayers:1},sampleCount:e.utils.getSampleCount(e.renderer.samples),format:e.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),this.colorBuffer}getDepthBuffer(e=!0,i=!1){const n=this.backend,{width:s,height:o}=n.getDrawingBufferSize(),l=this.depthTexture,u=n.get(l).texture;let c,h;if(i?(c=pg,h=ay):e&&(c=Fp,h=ja),u!==void 0){if(l.image.width===s&&l.image.height===o&&l.format===c&&l.type===h)return u;this.destroyTexture(l)}return l.name="depthBuffer",l.format=c,l.type=h,l.image.width=s,l.image.height=o,this.createTexture(l,{sampleCount:n.utils.getSampleCount(n.renderer.samples),width:s,height:o}),n.get(l).texture}updateTexture(e,i){const n=this.backend.get(e),{textureDescriptorGPU:s}=n;if(!(e.isRenderTargetTexture||s===void 0)){if(e.isDataTexture)this._copyBufferToTexture(i.image,n.texture,s,0,e.flipY);else if(e.isDataArrayTexture||e.isData3DTexture)for(let o=0;o<i.image.depth;o++)this._copyBufferToTexture(i.image,n.texture,s,o,e.flipY,o);else if(e.isCompressedTexture||e.isCompressedArrayTexture)this._copyCompressedBufferToTexture(e.mipmaps,n.texture,s);else if(e.isCubeTexture)this._copyCubeMapToTexture(i.images,n.texture,s,e.flipY);else if(e.isVideoTexture){const o=e.source.data;n.externalTexture=o}else this._copyImageToTexture(i.image,n.texture,s,0,e.flipY);n.version=e.version,e.onUpdate&&e.onUpdate(e)}}async copyTextureToBuffer(e,i,n,s,o,l){const u=this.backend.device,c=this.backend.get(e),h=c.texture,p=c.textureDescriptorGPU.format,f=this._getBytesPerTexel(p);let g=s*f;g=Math.ceil(g/256)*256;const m=u.createBuffer({size:s*o*f,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),y=u.createCommandEncoder();y.copyTextureToBuffer({texture:h,origin:{x:i,y:n,z:l}},{buffer:m,bytesPerRow:g},{width:s,height:o});const b=this._getTypedArrayType(p);u.queue.submit([y.finish()]),await m.mapAsync(GPUMapMode.READ);const v=m.getMappedRange();return new b(v)}_isEnvironmentTexture(e){const i=e.mapping;return i===iy||i===ry||i===kp||i===lg}_getDefaultTextureGPU(e){let i=this.defaultTexture[e];if(i===void 0){const n=new To;n.minFilter=no,n.magFilter=no,this.createTexture(n,{width:1,height:1,format:e}),this.defaultTexture[e]=i=n}return this.backend.get(i).texture}_getDefaultCubeTextureGPU(e){let i=this.defaultTexture[e];if(i===void 0){const n=new X3;n.minFilter=no,n.magFilter=no,this.createTexture(n,{width:1,height:1,depth:6}),this.defaultCubeTexture[e]=i=n}return this.backend.get(i).texture}_getDefaultVideoFrame(){let e=this.defaultVideoFrame;if(e===null){const i={timestamp:0,codedWidth:1,codedHeight:1,format:"RGBA"};this.defaultVideoFrame=e=new VideoFrame(new Uint8Array([0,0,0,255]),i)}return e}_copyCubeMapToTexture(e,i,n,s){for(let o=0;o<6;o++){const l=e[o],u=s===!0?Uve[o]:o;l.isDataTexture?this._copyBufferToTexture(l.image,i,n,u,s):this._copyImageToTexture(l,i,n,u,s)}}_copyImageToTexture(e,i,n,s,o){this.backend.device.queue.copyExternalImageToTexture({source:e},{texture:i,mipLevel:0,origin:{x:0,y:0,z:s}},{width:e.width,height:e.height,depthOrArrayLayers:1}),o===!0&&this._flipY(i,n,s)}_getPassUtils(){let e=this._passUtils;return e===null&&(this._passUtils=e=new kve(this.backend.device)),e}_generateMipmaps(e,i,n=0){this._getPassUtils().generateMipmaps(e,i,n)}_flipY(e,i,n=0){this._getPassUtils().flipY(e,i,n)}_copyBufferToTexture(e,i,n,s,o,l=0){const u=this.backend.device,c=e.data,h=this._getBytesPerTexel(n.format),p=e.width*h;u.queue.writeTexture({texture:i,mipLevel:0,origin:{x:0,y:0,z:s}},c,{offset:e.width*e.height*h*l,bytesPerRow:p},{width:e.width,height:e.height,depthOrArrayLayers:1}),o===!0&&this._flipY(i,n,s)}_copyCompressedBufferToTexture(e,i,n){const s=this.backend.device,o=this._getBlockData(n.format),l=n.size.depthOrArrayLayers>1;for(let u=0;u<e.length;u++){const c=e[u],h=c.width,p=c.height,f=l?n.size.depthOrArrayLayers:1,g=Math.ceil(h/o.width)*o.byteLength,m=g*Math.ceil(p/o.height);for(let y=0;y<f;y++)s.queue.writeTexture({texture:i,mipLevel:u,origin:{x:0,y:0,z:y}},c.data,{offset:y*m,bytesPerRow:g,rowsPerImage:Math.ceil(p/o.height)},{width:Math.ceil(h/o.width)*o.width,height:Math.ceil(p/o.height)*o.height,depthOrArrayLayers:1})}}_getBlockData(e){if(e===ht.BC1RGBAUnorm||e===ht.BC1RGBAUnormSRGB)return{byteLength:8,width:4,height:4};if(e===ht.BC2RGBAUnorm||e===ht.BC2RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===ht.BC3RGBAUnorm||e===ht.BC3RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===ht.BC4RUnorm||e===ht.BC4RSNorm)return{byteLength:8,width:4,height:4};if(e===ht.BC5RGUnorm||e===ht.BC5RGSnorm)return{byteLength:16,width:4,height:4};if(e===ht.BC6HRGBUFloat||e===ht.BC6HRGBFloat)return{byteLength:16,width:4,height:4};if(e===ht.BC7RGBAUnorm||e===ht.BC7RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===ht.ETC2RGB8Unorm||e===ht.ETC2RGB8UnormSRGB)return{byteLength:8,width:4,height:4};if(e===ht.ETC2RGB8A1Unorm||e===ht.ETC2RGB8A1UnormSRGB)return{byteLength:8,width:4,height:4};if(e===ht.ETC2RGBA8Unorm||e===ht.ETC2RGBA8UnormSRGB)return{byteLength:16,width:4,height:4};if(e===ht.EACR11Unorm)return{byteLength:8,width:4,height:4};if(e===ht.EACR11Snorm)return{byteLength:8,width:4,height:4};if(e===ht.EACRG11Unorm)return{byteLength:16,width:4,height:4};if(e===ht.EACRG11Snorm)return{byteLength:16,width:4,height:4};if(e===ht.ASTC4x4Unorm||e===ht.ASTC4x4UnormSRGB)return{byteLength:16,width:4,height:4};if(e===ht.ASTC5x4Unorm||e===ht.ASTC5x4UnormSRGB)return{byteLength:16,width:5,height:4};if(e===ht.ASTC5x5Unorm||e===ht.ASTC5x5UnormSRGB)return{byteLength:16,width:5,height:5};if(e===ht.ASTC6x5Unorm||e===ht.ASTC6x5UnormSRGB)return{byteLength:16,width:6,height:5};if(e===ht.ASTC6x6Unorm||e===ht.ASTC6x6UnormSRGB)return{byteLength:16,width:6,height:6};if(e===ht.ASTC8x5Unorm||e===ht.ASTC8x5UnormSRGB)return{byteLength:16,width:8,height:5};if(e===ht.ASTC8x6Unorm||e===ht.ASTC8x6UnormSRGB)return{byteLength:16,width:8,height:6};if(e===ht.ASTC8x8Unorm||e===ht.ASTC8x8UnormSRGB)return{byteLength:16,width:8,height:8};if(e===ht.ASTC10x5Unorm||e===ht.ASTC10x5UnormSRGB)return{byteLength:16,width:10,height:5};if(e===ht.ASTC10x6Unorm||e===ht.ASTC10x6UnormSRGB)return{byteLength:16,width:10,height:6};if(e===ht.ASTC10x8Unorm||e===ht.ASTC10x8UnormSRGB)return{byteLength:16,width:10,height:8};if(e===ht.ASTC10x10Unorm||e===ht.ASTC10x10UnormSRGB)return{byteLength:16,width:10,height:10};if(e===ht.ASTC12x10Unorm||e===ht.ASTC12x10UnormSRGB)return{byteLength:16,width:12,height:10};if(e===ht.ASTC12x12Unorm||e===ht.ASTC12x12UnormSRGB)return{byteLength:16,width:12,height:12}}_convertAddressMode(e){let i=iI.ClampToEdge;return e===O1?i=iI.Repeat:e===P1&&(i=iI.MirrorRepeat),i}_convertFilterMode(e){let i=tf.Linear;return(e===no||e===$M||e===ug)&&(i=tf.Nearest),i}_getBytesPerTexel(e){if(e===ht.R8Unorm||e===ht.R8Snorm||e===ht.R8Uint||e===ht.R8Sint)return 1;if(e===ht.R16Uint||e===ht.R16Sint||e===ht.R16Float||e===ht.RG8Unorm||e===ht.RG8Snorm||e===ht.RG8Uint||e===ht.RG8Sint)return 2;if(e===ht.R32Uint||e===ht.R32Sint||e===ht.R32Float||e===ht.RG16Uint||e===ht.RG16Sint||e===ht.RG16Float||e===ht.RGBA8Unorm||e===ht.RGBA8UnormSRGB||e===ht.RGBA8Snorm||e===ht.RGBA8Uint||e===ht.RGBA8Sint||e===ht.BGRA8Unorm||e===ht.BGRA8UnormSRGB||e===ht.RGB9E5UFloat||e===ht.RGB10A2Unorm||e===ht.RG11B10UFloat||e===ht.Depth32Float||e===ht.Depth24Plus||e===ht.Depth24PlusStencil8||e===ht.Depth32FloatStencil8)return 4;if(e===ht.RG32Uint||e===ht.RG32Sint||e===ht.RG32Float||e===ht.RGBA16Uint||e===ht.RGBA16Sint||e===ht.RGBA16Float)return 8;if(e===ht.RGBA32Uint||e===ht.RGBA32Sint||e===ht.RGBA32Float)return 16}_getTypedArrayType(e){if(e===ht.R8Uint)return Uint8Array;if(e===ht.R8Sint)return Int8Array;if(e===ht.R8Unorm)return Uint8Array;if(e===ht.R8Snorm)return Int8Array;if(e===ht.RG8Uint)return Uint8Array;if(e===ht.RG8Sint)return Int8Array;if(e===ht.RG8Unorm)return Uint8Array;if(e===ht.RG8Snorm)return Int8Array;if(e===ht.RGBA8Uint)return Uint8Array;if(e===ht.RGBA8Sint)return Int8Array;if(e===ht.RGBA8Unorm)return Uint8Array;if(e===ht.RGBA8Snorm)return Int8Array;if(e===ht.R16Uint)return Uint16Array;if(e===ht.R16Sint)return Int16Array;if(e===ht.RG16Uint)return Uint16Array;if(e===ht.RG16Sint)return Int16Array;if(e===ht.RGBA16Uint)return Uint16Array;if(e===ht.RGBA16Sint)return Int16Array;if(e===ht.R16Float||e===ht.RG16Float||e===ht.RGBA16Float)return Uint16Array;if(e===ht.R32Uint)return Uint32Array;if(e===ht.R32Sint)return Int32Array;if(e===ht.R32Float)return Float32Array;if(e===ht.RG32Uint)return Uint32Array;if(e===ht.RG32Sint)return Int32Array;if(e===ht.RG32Float)return Float32Array;if(e===ht.RGBA32Uint)return Uint32Array;if(e===ht.RGBA32Sint)return Int32Array;if(e===ht.RGBA32Float)return Float32Array;if(e===ht.BGRA8Unorm||e===ht.BGRA8UnormSRGB)return Uint8Array;if(e===ht.RGB10A2Unorm||e===ht.RGB9E5UFloat||e===ht.RG11B10UFloat)return Uint32Array;if(e===ht.Depth32Float)return Float32Array;if(e===ht.Depth24Plus||e===ht.Depth24PlusStencil8)return Uint32Array;if(e===ht.Depth32FloatStencil8)return Float32Array}_getDimension(e){let i;return e.isData3DTexture?i=o7.ThreeD:i=o7.TwoD,i}}function TI(r,e=null){const i=r.format,n=r.type,s=r.colorSpace;let o;if(r.isCompressedTexture===!0||r.isCompressedArrayTexture===!0)switch(i){case k1:o=s===Lr?ht.BC1RGBAUnormSRGB:ht.BC1RGBAUnorm;break;case F1:o=s===Lr?ht.BC2RGBAUnormSRGB:ht.BC2RGBAUnorm;break;case U1:o=s===Lr?ht.BC3RGBAUnormSRGB:ht.BC3RGBAUnorm;break;case o3:o=s===Lr?ht.ETC2RGB8UnormSRGB:ht.ETC2RGB8Unorm;break;case l3:o=s===Lr?ht.ETC2RGBA8UnormSRGB:ht.ETC2RGBA8Unorm;break;case c3:o=s===Lr?ht.ASTC4x4UnormSRGB:ht.ASTC4x4Unorm;break;case u3:o=s===Lr?ht.ASTC5x4UnormSRGB:ht.ASTC5x4Unorm;break;case h3:o=s===Lr?ht.ASTC5x5UnormSRGB:ht.ASTC5x5Unorm;break;case d3:o=s===Lr?ht.ASTC6x5UnormSRGB:ht.ASTC6x5Unorm;break;case p3:o=s===Lr?ht.ASTC6x6UnormSRGB:ht.ASTC6x6Unorm;break;case f3:o=s===Lr?ht.ASTC8x5UnormSRGB:ht.ASTC8x5Unorm;break;case m3:o=s===Lr?ht.ASTC8x6UnormSRGB:ht.ASTC8x6Unorm;break;case g3:o=s===Lr?ht.ASTC8x8UnormSRGB:ht.ASTC8x8Unorm;break;case A3:o=s===Lr?ht.ASTC10x5UnormSRGB:ht.ASTC10x5Unorm;break;case y3:o=s===Lr?ht.ASTC10x6UnormSRGB:ht.ASTC10x6Unorm;break;case v3:o=s===Lr?ht.ASTC10x8UnormSRGB:ht.ASTC10x8Unorm;break;case b3:o=s===Lr?ht.ASTC10x10UnormSRGB:ht.ASTC10x10Unorm;break;case x3:o=s===Lr?ht.ASTC12x10UnormSRGB:ht.ASTC12x10Unorm;break;case _3:o=s===Lr?ht.ASTC12x12UnormSRGB:ht.ASTC12x12Unorm;break;default:console.error("WebGPURenderer: Unsupported texture format.",i)}else switch(i){case dg:switch(n){case ny:o=ht.RGBA8Snorm;break;case sy:o=ht.RGBA16Sint;break;case hg:o=ht.RGBA16Uint;break;case ja:o=ht.RGBA32Uint;break;case Co:o=ht.RGBA32Sint;break;case fd:o=s===Lr?ht.RGBA8UnormSRGB:ht.RGBA8Unorm;break;case Qu:o=ht.RGBA16Float;break;case Al:o=ht.RGBA32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAFormat.",n)}break;case t3:switch(n){case QU:o=ht.RGB9E5UFloat;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBFormat.",n)}break;case i3:switch(n){case ny:o=ht.R8Snorm;break;case sy:o=ht.R16Sint;break;case hg:o=ht.R16Uint;break;case ja:o=ht.R32Uint;break;case Co:o=ht.R32Sint;break;case fd:o=ht.R8Unorm;break;case Qu:o=ht.R16Float;break;case Al:o=ht.R32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RedFormat.",n)}break;case oy:switch(n){case ny:o=ht.RG8Snorm;break;case sy:o=ht.RG16Sint;break;case hg:o=ht.RG16Uint;break;case ja:o=ht.RG32Uint;break;case Co:o=ht.RG32Sint;break;case fd:o=ht.RG8Unorm;break;case Qu:o=ht.RG16Float;break;case Al:o=ht.RG32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RGFormat.",n)}break;case Fp:switch(n){case hg:o=ht.Depth16Unorm;break;case ja:o=ht.Depth24Plus;break;case Al:o=ht.Depth32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthFormat.",n)}break;case pg:switch(n){case ay:o=ht.Depth24PlusStencil8;break;case Al:e&&e.features.has(nI.Depth32FloatStencil8)===!1&&console.error('WebGPURenderer: Depth textures with DepthStencilFormat + FloatType can only be used with the "depth32float-stencil8" GPU feature.'),o=ht.Depth32FloatStencil8;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthStencilFormat.",n)}break;case r3:switch(n){case Co:o=ht.R32Sint;break;case ja:o=ht.R32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RedIntegerFormat.",n)}break;case n3:switch(n){case Co:o=ht.RG32Sint;break;case ja:o=ht.RG32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RGIntegerFormat.",n)}break;case s3:switch(n){case Co:o=ht.RGBA32Sint;break;case ja:o=ht.RGBA32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAIntegerFormat.",n)}break;default:console.error("WebGPURenderer: Unsupported texture format.",i)}return o}const jve=/^[fn]*\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)\s*[\-\>]*\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/i,Gve=/([a-z_0-9]+)\s*:\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/ig,W7={f32:"float",i32:"int",u32:"uint",bool:"bool","vec2<f32>":"vec2","vec2<i32>":"ivec2","vec2<u32>":"uvec2","vec2<bool>":"bvec2",vec2f:"vec2",vec2i:"ivec2",vec2u:"uvec2",vec2b:"bvec2","vec3<f32>":"vec3","vec3<i32>":"ivec3","vec3<u32>":"uvec3","vec3<bool>":"bvec3",vec3f:"vec3",vec3i:"ivec3",vec3u:"uvec3",vec3b:"bvec3","vec4<f32>":"vec4","vec4<i32>":"ivec4","vec4<u32>":"uvec4","vec4<bool>":"bvec4",vec4f:"vec4",vec4i:"ivec4",vec4u:"uvec4",vec4b:"bvec4","mat2x2<f32>":"mat2",mat2x2f:"mat2","mat3x3<f32>":"mat3",mat3x3f:"mat3","mat4x4<f32>":"mat4",mat4x4f:"mat4",sampler:"sampler",texture_1d:"texture",texture_2d:"texture",texture_2d_array:"texture",texture_multisampled_2d:"cubeTexture",texture_depth_2d:"depthTexture",texture_3d:"texture3D",texture_cube:"cubeTexture",texture_cube_array:"cubeTexture",texture_storage_1d:"storageTexture",texture_storage_2d:"storageTexture",texture_storage_2d_array:"storageTexture",texture_storage_3d:"storageTexture"},Vve=r=>{r=r.trim();const e=r.match(jve);if(e!==null&&e.length===4){const i=e[2],n=[];let s=null;for(;(s=Gve.exec(i))!==null;)n.push({name:s[1],type:s[2]});const o=[];for(let h=0;h<n.length;h++){const{name:p,type:f}=n[h];let g=f;g.startsWith("ptr")?g="pointer":(g.startsWith("texture")&&(g=f.split("<")[0]),g=W7[g]),o.push(new AI(g,p))}const l=r.substring(e[0].length),u=e[3]||"void",c=e[1]!==void 0?e[1]:"";return{type:W7[u]||u,inputs:o,name:c,inputsCode:i,blockCode:l,outputType:u}}else throw new Error("FunctionNode: Function is not a WGSL code.")};class Hve extends vI{constructor(e){const{type:i,inputs:n,name:s,inputsCode:o,blockCode:l,outputType:u}=Vve(e);super(i,n,s),this.inputsCode=o,this.blockCode=l,this.outputType=u}getCode(e=this.name){const i=this.outputType!=="void"?"-> "+this.outputType:"";return`fn ${e} ( ${this.inputsCode.trim()} ) ${i}`+this.blockCode}}class Wve extends S7{parseFunction(e){return new Hve(e)}}const Kg=self.GPUShaderStage,Q_={vertex:Kg?Kg.VERTEX:1,fragment:Kg?Kg.FRAGMENT:2,compute:Kg?Kg.COMPUTE:4},Q7={instance:!0,swizzleAssign:!1,storageBuffer:!0},Qve={"^^":"tsl_xor"},qve={float:"f32",int:"i32",uint:"u32",bool:"bool",color:"vec3<f32>",vec2:"vec2<f32>",ivec2:"vec2<i32>",uvec2:"vec2<u32>",bvec2:"vec2<bool>",vec3:"vec3<f32>",ivec3:"vec3<i32>",uvec3:"vec3<u32>",bvec3:"vec3<bool>",vec4:"vec4<f32>",ivec4:"vec4<i32>",uvec4:"vec4<u32>",bvec4:"vec4<bool>",mat2:"mat2x2<f32>",mat3:"mat3x3<f32>",mat4:"mat4x4<f32>"},dh={tsl_xor:new oo("fn tsl_xor( a : bool, b : bool ) -> bool { return ( a || b ) && !( a && b ); }"),mod_float:new oo("fn tsl_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }"),mod_vec2:new oo("fn tsl_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }"),mod_vec3:new oo("fn tsl_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }"),mod_vec4:new oo("fn tsl_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }"),equals_bool:new oo("fn tsl_equals_bool( a : bool, b : bool ) -> bool { return a == b; }"),equals_bvec2:new oo("fn tsl_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }"),equals_bvec3:new oo("fn tsl_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }"),equals_bvec4:new oo("fn tsl_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }"),repeatWrapping:new oo(`
fn tsl_repeatWrapping( uv : vec2<f32>, dimension : vec2<u32> ) -> vec2<u32> {

	let uvScaled = vec2<u32>( uv * vec2<f32>( dimension ) );

	return ( ( uvScaled % dimension ) + dimension ) % dimension;

}
`),biquadraticTexture:new oo(`
fn tsl_biquadraticTexture( map : texture_2d<f32>, coord : vec2f, level : i32 ) -> vec4f {

	let iRes = vec2i( textureDimensions( map, level ) );
	let res = vec2f( iRes );

	let uvScaled = coord * res;
	let uvWrapping = ( ( uvScaled % res ) + res ) % res;

	// https://www.shadertoy.com/view/WtyXRy

	let uv = uvWrapping - 0.5;
	let iuv = floor( uv );
	let f = fract( uv );

	let rg1 = textureLoad( map, vec2i( iuv + vec2( 0.5, 0.5 ) ) % iRes, level );
	let rg2 = textureLoad( map, vec2i( iuv + vec2( 1.5, 0.5 ) ) % iRes, level );
	let rg3 = textureLoad( map, vec2i( iuv + vec2( 0.5, 1.5 ) ) % iRes, level );
	let rg4 = textureLoad( map, vec2i( iuv + vec2( 1.5, 1.5 ) ) % iRes, level );

	return mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );

}
`)},Qy={dFdx:"dpdx",dFdy:"- dpdy",mod_float:"tsl_mod_float",mod_vec2:"tsl_mod_vec2",mod_vec3:"tsl_mod_vec3",mod_vec4:"tsl_mod_vec4",equals_bool:"tsl_equals_bool",equals_bvec2:"tsl_equals_bvec2",equals_bvec3:"tsl_equals_bvec3",equals_bvec4:"tsl_equals_bvec4",inversesqrt:"inverseSqrt",bitcast:"bitcast<f32>"};/Windows/g.test(navigator.userAgent)&&(dh.pow_float=new oo("fn tsl_pow_float( a : f32, b : f32 ) -> f32 { return select( -pow( -a, b ), pow( a, b ), a > 0.0 ); }"),dh.pow_vec2=new oo("fn tsl_pow_vec2( a : vec2f, b : vec2f ) -> vec2f { return vec2f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ) ); }",[dh.pow_float]),dh.pow_vec3=new oo("fn tsl_pow_vec3( a : vec3f, b : vec3f ) -> vec3f { return vec3f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ), tsl_pow_float( a.z, b.z ) ); }",[dh.pow_float]),dh.pow_vec4=new oo("fn tsl_pow_vec4( a : vec4f, b : vec4f ) -> vec4f { return vec4f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ), tsl_pow_float( a.z, b.z ), tsl_pow_float( a.w, b.w ) ); }",[dh.pow_float]),Qy.pow_float="tsl_pow_float",Qy.pow_vec2="tsl_pow_vec2",Qy.pow_vec3="tsl_pow_vec3",Qy.pow_vec4="tsl_pow_vec4");let q7="";/Firefox|Deno/g.test(navigator.userAgent)!==!0&&(q7+=`diagnostic( off, derivative_uniformity );
`);class Xve extends E7{constructor(e,i){super(e,i,new Wve),this.uniformGroups={},this.builtins={},this.directives={},this.scopedArrays=new Map}needsToWorkingColorSpace(e){return e.isVideoTexture===!0&&e.colorSpace!==Up}_generateTextureSample(e,i,n,s,o=this.shaderStage){return o==="fragment"?s?`textureSample( ${i}, ${i}_sampler, ${n}, ${s} )`:`textureSample( ${i}, ${i}_sampler, ${n} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,i,n):this.generateTextureLod(e,i,n,"0")}_generateVideoSample(e,i,n=this.shaderStage){if(n==="fragment")return`textureSampleBaseClampToEdge( ${e}, ${e}_sampler, vec2<f32>( ${i}.x, 1.0 - ${i}.y ) )`;console.error(`WebGPURenderer: THREE.VideoTexture does not support ${n} shader.`)}_generateTextureSampleLevel(e,i,n,s,o,l=this.shaderStage){return l==="fragment"&&this.isUnfilterable(e)===!1?`textureSampleLevel( ${i}, ${i}_sampler, ${n}, ${s} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,i,n,s):this.generateTextureLod(e,i,n,s)}generateFilteredTexture(e,i,n,s="0"){return this._include("biquadraticTexture"),`tsl_biquadraticTexture( ${i}, ${n}, i32( ${s} ) )`}generateTextureLod(e,i,n,s="0"){this._include("repeatWrapping");const o=e.isMultisampleRenderTargetTexture===!0?`textureDimensions( ${i} )`:`textureDimensions( ${i}, 0 )`;return`textureLoad( ${i}, tsl_repeatWrapping( ${n}, ${o} ), i32( ${s} ) )`}generateTextureLoad(e,i,n,s,o="0u"){return s?`textureLoad( ${i}, ${n}, ${s}, ${o} )`:`textureLoad( ${i}, ${n}, ${o} )`}generateTextureStore(e,i,n,s){return`textureStore( ${i}, ${n}, ${s} )`}isUnfilterable(e){return this.getComponentTypeFromTexture(e)!=="float"||!this.isAvailable("float32Filterable")&&e.isDataTexture===!0&&e.type===Al||e.isMultisampleRenderTargetTexture===!0}generateTexture(e,i,n,s,o=this.shaderStage){let l=null;return e.isVideoTexture===!0?l=this._generateVideoSample(i,n,o):this.isUnfilterable(e)?l=this.generateTextureLod(e,i,n,"0",s,o):l=this._generateTextureSample(e,i,n,s,o),l}generateTextureGrad(e,i,n,s,o,l=this.shaderStage){if(l==="fragment")return`textureSampleGrad( ${i}, ${i}_sampler, ${n},  ${s[0]}, ${s[1]} )`;console.error(`WebGPURenderer: THREE.TextureNode.gradient() does not support ${l} shader.`)}generateTextureCompare(e,i,n,s,o,l=this.shaderStage){if(l==="fragment")return`textureSampleCompare( ${i}, ${i}_sampler, ${n}, ${s} )`;console.error(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${l} shader.`)}generateTextureLevel(e,i,n,s,o,l=this.shaderStage){let u=null;return e.isVideoTexture===!0?u=this._generateVideoSample(i,n,l):u=this._generateTextureSampleLevel(e,i,n,s,o,l),u}generateTextureBias(e,i,n,s,o,l=this.shaderStage){if(l==="fragment")return`textureSampleBias( ${i}, ${i}_sampler, ${n}, ${s} )`;console.error(`WebGPURenderer: THREE.TextureNode.biasNode does not support ${l} shader.`)}getPropertyName(e,i=this.shaderStage){if(e.isNodeVarying===!0&&e.needsInterpolation===!0){if(i==="vertex")return`varyings.${e.name}`}else if(e.isNodeUniform===!0){const n=e.name,s=e.type;return s==="texture"||s==="cubeTexture"||s==="storageTexture"||s==="texture3D"?n:s==="buffer"||s==="storageBuffer"||s==="indirectStorageBuffer"?`NodeBuffer_${e.id}.${n}`:e.groupNode.name+"."+n}return super.getPropertyName(e)}getOutputStructName(){return"output"}_getUniformGroupCount(e){return Object.keys(this.uniforms[e]).length}getFunctionOperator(e){const i=Qve[e];return i!==void 0?(this._include(i),i):null}getStorageAccess(e){if(e.isStorageTextureNode)switch(e.access){case a7.ReadOnly:return"read";case a7.WriteOnly:return"write";default:return"read_write"}else switch(e.access){case rI.Storage:return"read_write";case rI.ReadOnlyStorage:return"read";default:return"write"}}getUniformFromNode(e,i,n,s=null){const o=super.getUniformFromNode(e,i,n,s),l=this.getDataFromNode(e,n,this.globalCache);if(l.uniformGPU===void 0){let u;const c=e.groupNode,h=c.name,p=this.getBindGroupArray(h,n);if(i==="texture"||i==="cubeTexture"||i==="storageTexture"||i==="texture3D"){let f=null;if(i==="texture"||i==="storageTexture"?f=new H_(o.name,o.node,c,e.access?e.access:null):i==="cubeTexture"?f=new O7(o.name,o.node,c,e.access?e.access:null):i==="texture3D"&&(f=new P7(o.name,o.node,c,e.access?e.access:null)),f.store=e.isStorageTextureNode===!0,f.setVisibility(Q_[n]),n==="fragment"&&this.isUnfilterable(e.value)===!1&&f.store===!1){const g=new Lve(`${o.name}_sampler`,o.node,c);g.setVisibility(Q_[n]),p.push(g,f),u=[g,f]}else p.push(f),u=[f]}else if(i==="buffer"||i==="storageBuffer"||i==="indirectStorageBuffer"){const f=i==="buffer"?L7:Pve,g=new f(e,c);g.setVisibility(Q_[n]),p.push(g),u=g}else{const f=this.uniformGroups[n]||(this.uniformGroups[n]={});let g=f[h];g===void 0&&(g=new D7(h,c),g.setVisibility(Q_[n]),f[h]=g,p.push(g)),u=this.getNodeUniform(o,i),g.addUniform(u)}l.uniformGPU=u}return o}getBuiltin(e,i,n,s=this.shaderStage){const o=this.builtins[s]||(this.builtins[s]=new Map);return o.has(e)===!1&&o.set(e,{name:e,property:i,type:n}),i}hasBuiltin(e,i=this.shaderStage){return this.builtins[i]!==void 0&&this.builtins[i].has(e)}getVertexIndex(){return this.shaderStage==="vertex"?this.getBuiltin("vertex_index","vertexIndex","u32","attribute"):"vertexIndex"}buildFunctionCode(e){const i=e.layout,n=this.flowShaderNode(e),s=[];for(const l of i.inputs)s.push(l.name+" : "+this.getType(l.type));let o=`fn ${i.name}( ${s.join(", ")} ) -> ${this.getType(i.type)} {
${n.vars}
${n.code}
`;return n.result&&(o+=`	return ${n.result};
`),o+=`
}
`,o}getInstanceIndex(){return this.shaderStage==="vertex"?this.getBuiltin("instance_index","instanceIndex","u32","attribute"):"instanceIndex"}getInvocationLocalIndex(){return this.getBuiltin("local_invocation_index","invocationLocalIndex","u32","attribute")}getSubgroupSize(){return this.enableSubGroups(),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute")}getInvocationSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_invocation_id","invocationSubgroupIndex","u32","attribute")}getSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_id","subgroupIndex","u32","attribute")}getDrawIndex(){return null}getFrontFacing(){return this.getBuiltin("front_facing","isFront","bool")}getFragCoord(){return this.getBuiltin("position","fragCoord","vec4<f32>")+".xy"}getFragDepth(){return"output."+this.getBuiltin("frag_depth","depth","f32","output")}isFlipY(){return!1}enableDirective(e,i=this.shaderStage){(this.directives[i]||(this.directives[i]=new Set)).add(e)}getDirectives(e){const i=[],n=this.directives[e];if(n!==void 0)for(const s of n)i.push(`enable ${s};`);return i.join(`
`)}enableSubGroups(){this.enableDirective("subgroups")}enableSubgroupsF16(){this.enableDirective("subgroups-f16")}enableClipDistances(){this.enableDirective("clip_distances")}enableShaderF16(){this.enableDirective("f16")}enableDualSourceBlending(){this.enableDirective("dual_source_blending")}getBuiltins(e){const i=[],n=this.builtins[e];if(n!==void 0)for(const{name:s,property:o,type:l}of n.values())i.push(`@builtin( ${s} ) ${o} : ${l}`);return i.join(`,
	`)}getScopedArray(e,i,n,s){return this.scopedArrays.has(e)===!1&&this.scopedArrays.set(e,{name:e,scope:i,bufferType:n,bufferCount:s}),e}getScopedArrays(e){if(e!=="compute")return;const i=[];for(const{name:n,scope:s,bufferType:o,bufferCount:l}of this.scopedArrays.values()){const u=this.getType(o);i.push(`var<${s}> ${n}: array< ${u}, ${l} >;`)}return i.join(`
`)}getAttributes(e){const i=[];if(e==="compute"&&(this.getBuiltin("global_invocation_id","id","vec3<u32>","attribute"),this.getBuiltin("workgroup_id","workgroupId","vec3<u32>","attribute"),this.getBuiltin("local_invocation_id","localId","vec3<u32>","attribute"),this.getBuiltin("num_workgroups","numWorkgroups","vec3<u32>","attribute"),this.renderer.hasFeature("subgroups")&&(this.enableDirective("subgroups",e),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute"))),e==="vertex"||e==="compute"){const n=this.getBuiltins("attribute");n&&i.push(n);const s=this.getAttributesArray();for(let o=0,l=s.length;o<l;o++){const u=s[o],c=u.name,h=this.getType(u.type);i.push(`@location( ${o} ) ${c} : ${h}`)}}return i.join(`,
	`)}getStructMembers(e){const i=[],n=e.getMemberTypes();for(let o=0;o<n.length;o++){const l=n[o];i.push(`	@location( ${o} ) m${o} : ${l}<f32>`)}const s=this.getBuiltins("output");return s&&i.push("	"+s),i.join(`,
`)}getStructs(e){const i=[],n=this.structs[e];for(let s=0,o=n.length;s<o;s++){const l=n[s],u=l.name;let c=`struct ${u} {
`;c+=this.getStructMembers(l),c+=`
}`,i.push(c),i.push(`
var<private> output : ${u};

`)}return i.join(`

`)}getVar(e,i){return`var ${i} : ${this.getType(e)}`}getVars(e){const i=[],n=this.vars[e];if(n!==void 0)for(const s of n)i.push(`	${this.getVar(s.type,s.name)};`);return`
${i.join(`
`)}
`}getVaryings(e){const i=[];if(e==="vertex"&&this.getBuiltin("position","Vertex","vec4<f32>","vertex"),e==="vertex"||e==="fragment"){const o=this.varyings,l=this.vars[e];for(let u=0;u<o.length;u++){const c=o[u];if(c.needsInterpolation){let h=`@location( ${u} )`;/^(int|uint|ivec|uvec)/.test(c.type)&&(h+=" @interpolate( flat )"),i.push(`${h} ${c.name} : ${this.getType(c.type)}`)}else e==="vertex"&&l.includes(c)===!1&&l.push(c)}}const n=this.getBuiltins(e);n&&i.push(n);const s=i.join(`,
	`);return e==="vertex"?this._getWGSLStruct("VaryingsStruct","	"+s):s}getUniforms(e){const i=this.uniforms[e],n=[],s=[],o=[],l={};for(const c of i){const h=c.groupNode.name,p=this.bindingsIndexes[h];if(c.type==="texture"||c.type==="cubeTexture"||c.type==="storageTexture"||c.type==="texture3D"){const f=c.node.value;e==="fragment"&&this.isUnfilterable(f)===!1&&c.node.isStorageTextureNode!==!0&&(f.isDepthTexture===!0&&f.compareFunction!==null?n.push(`@binding( ${p.binding++} ) @group( ${p.group} ) var ${c.name}_sampler : sampler_comparison;`):n.push(`@binding( ${p.binding++} ) @group( ${p.group} ) var ${c.name}_sampler : sampler;`));let g,m="";if(f.isMultisampleRenderTargetTexture===!0&&(m="_multisampled"),f.isCubeTexture===!0)g="texture_cube<f32>";else if(f.isDataArrayTexture===!0||f.isCompressedArrayTexture===!0)g="texture_2d_array<f32>";else if(f.isDepthTexture===!0)g=`texture_depth${m}_2d`;else if(f.isVideoTexture===!0)g="texture_external";else if(f.isData3DTexture===!0)g="texture_3d<f32>";else if(c.node.isStorageTextureNode===!0){const y=TI(f),b=this.getStorageAccess(c.node);g=`texture_storage_2d<${y}, ${b}>`}else{const y=this.getComponentTypeFromTexture(f).charAt(0);g=`texture${m}_2d<${y}32>`}n.push(`@binding( ${p.binding++} ) @group( ${p.group} ) var ${c.name} : ${g};`)}else if(c.type==="buffer"||c.type==="storageBuffer"||c.type==="indirectStorageBuffer"){const f=c.node,g=this.getType(f.bufferType),m=f.bufferCount,y=m>0&&c.type==="buffer"?", "+m:"",b=f.isAtomic?`atomic<${g}>`:`${g}`,v=`	${c.name} : array< ${b}${y} >
`,_=f.isStorageBufferNode?`storage, ${this.getStorageAccess(f)}`:"uniform";s.push(this._getWGSLStructBinding("NodeBuffer_"+f.id,v,_,p.binding++,p.group))}else{const f=this.getType(this.getVectorType(c.type)),g=c.groupNode.name;(l[g]||(l[g]={index:p.binding++,id:p.group,snippets:[]})).snippets.push(`	${c.name} : ${f}`)}}for(const c in l){const h=l[c];o.push(this._getWGSLStructBinding(c,h.snippets.join(`,
`),"uniform",h.index,h.id))}let u=n.join(`
`);return u+=s.join(`
`),u+=o.join(`
`),u}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const i in e){const n=e[i];n.uniforms=this.getUniforms(i),n.attributes=this.getAttributes(i),n.varyings=this.getVaryings(i),n.structs=this.getStructs(i),n.vars=this.getVars(i),n.codes=this.getCodes(i),n.directives=this.getDirectives(i),n.scopedArrays=this.getScopedArrays(i);let s=`// code

`;s+=this.flowCode[i];const o=this.flowNodes[i],l=o[o.length-1],u=l.outputNode,c=u!==void 0&&u.isOutputStructNode===!0;for(const h of o){const p=this.getFlowData(h),f=h.name;if(f&&(s.length>0&&(s+=`
`),s+=`	// flow -> ${f}
	`),s+=`${p.code}
	`,h===l&&i!=="compute"){if(s+=`// result

	`,i==="vertex")s+=`varyings.Vertex = ${p.result};`;else if(i==="fragment")if(c)n.returnType=u.nodeType,s+=`return ${p.result};`;else{let g="	@location(0) color: vec4<f32>";const m=this.getBuiltins("output");m&&(g+=`,
	`+m),n.returnType="OutputStruct",n.structs+=this._getWGSLStruct("OutputStruct",g),n.structs+=`
var<private> output : OutputStruct;

`,s+=`output.color = ${p.result};

	return output;`}}}n.flow=s}this.material!==null?(this.vertexShader=this._getWGSLVertexCode(e.vertex),this.fragmentShader=this._getWGSLFragmentCode(e.fragment)):this.computeShader=this._getWGSLComputeCode(e.compute,(this.object.workgroupSize||[64]).join(", "))}getMethod(e,i=null){let n;return i!==null&&(n=this._getWGSLMethod(e+"_"+i)),n===void 0&&(n=this._getWGSLMethod(e)),n||e}getType(e){return qve[e]||e}isAvailable(e){let i=Q7[e];return i===void 0&&(e==="float32Filterable"&&(i=this.renderer.hasFeature("float32-filterable")),Q7[e]=i),i}_getWGSLMethod(e){return dh[e]!==void 0&&this._include(e),Qy[e]}_include(e){const i=dh[e];return i.build(this),this.currentFunctionNode!==null&&this.currentFunctionNode.includes.push(i),i}_getWGSLVertexCode(e){return`${this.getSignature()}
// directives
${e.directives}

// uniforms
${e.uniforms}

// varyings
${e.varyings}
var<private> varyings : VaryingsStruct;

// codes
${e.codes}

@vertex
fn main( ${e.attributes} ) -> VaryingsStruct {

	// vars
	${e.vars}

	// flow
	${e.flow}

	return varyings;

}
`}_getWGSLFragmentCode(e){return`${this.getSignature()}
// global
${q7}

// uniforms
${e.uniforms}

// structs
${e.structs}

// codes
${e.codes}

@fragment
fn main( ${e.varyings} ) -> ${e.returnType} {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLComputeCode(e,i){return`${this.getSignature()}
// directives
${e.directives}

// system
var<private> instanceIndex : u32;

// locals
${e.scopedArrays}

// uniforms
${e.uniforms}

// codes
${e.codes}

@compute @workgroup_size( ${i} )
fn main( ${e.attributes} ) {

	// system
	instanceIndex = id.x + id.y * numWorkgroups.x * u32(${i}) + id.z * numWorkgroups.x * numWorkgroups.y * u32(${i});

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLStruct(e,i){return`
struct ${e} {
${i}
};`}_getWGSLStructBinding(e,i,n,s=0,o=0){const l=e+"Struct";return`${this._getWGSLStruct(l,i)}
@binding( ${s} ) @group( ${o} )
var<${n}> ${e} : ${l};`}}class Kve{constructor(e){this.backend=e}getCurrentDepthStencilFormat(e){let i;return e.depthTexture!==null?i=this.getTextureFormatGPU(e.depthTexture):e.depth&&e.stencil?i=ht.Depth24PlusStencil8:e.depth&&(i=ht.Depth24Plus),i}getTextureFormatGPU(e){return this.backend.get(e).format}getCurrentColorFormat(e){let i;return e.textures!==null?i=this.getTextureFormatGPU(e.textures[0]):i=this.getPreferredCanvasFormat(),i}getCurrentColorSpace(e){return e.textures!==null?e.textures[0].colorSpace:this.backend.renderer.outputColorSpace}getPrimitiveTopology(e,i){if(e.isPoints)return Vg.PointList;if(e.isLineSegments||e.isMesh&&i.wireframe===!0)return Vg.LineList;if(e.isLine)return Vg.LineStrip;if(e.isMesh)return Vg.TriangleList}getSampleCount(e){let i=1;return e>1&&(i=Math.pow(2,Math.floor(Math.log2(e))),i===2&&(i=4)),i}getSampleCountRenderContext(e){return e.textures!==null?this.getSampleCount(e.sampleCount):this.getSampleCount(this.backend.renderer.samples)}getPreferredCanvasFormat(){return navigator.userAgent.includes("Quest")?ht.BGRA8Unorm:navigator.gpu.getPreferredCanvasFormat()}}const Yve=new Map([[Int8Array,["sint8","snorm8"]],[Uint8Array,["uint8","unorm8"]],[Int16Array,["sint16","snorm16"]],[Uint16Array,["uint16","unorm16"]],[Int32Array,["sint32","snorm32"]],[Uint32Array,["uint32","unorm32"]],[Float32Array,["float32"]]]),Jve=new Map([[R6,["float16"]]]),Zve=new Map([[Int32Array,"sint32"],[Int16Array,"sint32"],[Uint32Array,"uint32"],[Uint16Array,"uint32"],[Float32Array,"float32"]]);class $ve{constructor(e){this.backend=e}createAttribute(e,i){const n=this._getBufferAttribute(e),s=this.backend,o=s.get(n);let l=o.buffer;if(l===void 0){const u=s.device;let c=n.array;if(e.normalized===!1&&(c.constructor===Int16Array||c.constructor===Uint16Array)){const p=new Uint32Array(c.length);for(let f=0;f<c.length;f++)p[f]=c[f];c=p}if(n.array=c,(n.isStorageBufferAttribute||n.isStorageInstancedBufferAttribute)&&n.itemSize===3){c=new c.constructor(n.count*4);for(let p=0;p<n.count;p++)c.set(n.array.subarray(p*3,p*3+3),p*4);n.itemSize=4,n.array=c}const h=c.byteLength+(4-c.byteLength%4)%4;l=u.createBuffer({label:n.name,size:h,usage:i,mappedAtCreation:!0}),new c.constructor(l.getMappedRange()).set(c),l.unmap(),o.buffer=l}}updateAttribute(e){const i=this._getBufferAttribute(e),n=this.backend,s=n.device,o=n.get(i).buffer,l=i.array,u=i.updateRanges;if(u.length===0)s.queue.writeBuffer(o,0,l,0);else{for(let c=0,h=u.length;c<h;c++){const p=u[c];s.queue.writeBuffer(o,0,l,p.start*l.BYTES_PER_ELEMENT,p.count*l.BYTES_PER_ELEMENT)}i.clearUpdateRanges()}}createShaderVertexBuffers(e){const i=e.getAttributes(),n=new Map;for(let s=0;s<i.length;s++){const o=i[s],l=o.array.BYTES_PER_ELEMENT,u=this._getBufferAttribute(o);let c=n.get(u);if(c===void 0){let f,g;o.isInterleavedBufferAttribute===!0?(f=o.data.stride*l,g=o.data.isInstancedInterleavedBuffer?O_.Instance:O_.Vertex):(f=o.itemSize*l,g=o.isInstancedBufferAttribute?O_.Instance:O_.Vertex),o.normalized===!1&&(o.array.constructor===Int16Array||o.array.constructor===Uint16Array)&&(f=4),c={arrayStride:f,attributes:[],stepMode:g},n.set(u,c)}const h=this._getVertexFormat(o),p=o.isInterleavedBufferAttribute===!0?o.offset*l:0;c.attributes.push({shaderLocation:s,offset:p,format:h})}return Array.from(n.values())}destroyAttribute(e){const i=this.backend;i.get(this._getBufferAttribute(e)).buffer.destroy(),i.delete(e)}async getArrayBufferAsync(e){const i=this.backend,n=i.device,s=i.get(this._getBufferAttribute(e)).buffer,o=s.size,l=n.createBuffer({label:e.name,size:o,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),u=n.createCommandEncoder({});u.copyBufferToBuffer(s,0,l,0,o),l.unmap();const c=u.finish();return n.queue.submit([c]),await l.mapAsync(GPUMapMode.READ),l.getMappedRange()}_getVertexFormat(e){const{itemSize:i,normalized:n}=e,s=e.array.constructor,o=e.constructor;let l;if(i==1)l=Zve.get(s);else{const u=(Jve.get(o)||Yve.get(s))[n?1:0];if(u){const c=s.BYTES_PER_ELEMENT*i,h=Math.floor((c+3)/4)*4/s.BYTES_PER_ELEMENT;if(h%1)throw new Error("THREE.WebGPUAttributeUtils: Bad vertex format item size.");l=`${u}x${h}`}}return l||console.error("THREE.WebGPUAttributeUtils: Vertex format not supported yet."),l}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}class ebe{constructor(e){this.backend=e,this.bindGroupLayoutCache=new WeakMap}createBindingsLayout(e){const i=this.backend.device,n=[];let s=0;for(const o of e.bindings){const l={binding:s++,visibility:o.visibility};if(o.isUniformBuffer||o.isStorageBuffer){const u={};o.isStorageBuffer&&(u.type=o.access),l.buffer=u}else if(o.isSampler){const u={};o.texture.isDepthTexture&&o.texture.compareFunction!==null&&(u.type="comparison"),l.sampler=u}else if(o.isSampledTexture&&o.texture.isVideoTexture)l.externalTexture={};else if(o.isSampledTexture&&o.store){const u=this.backend.get(o.texture).texture.format,c=o.access;l.storageTexture={format:u,access:c}}else if(o.isSampledTexture){const u={};if(o.texture.isMultisampleRenderTargetTexture===!0&&(u.multisampled=!0),o.texture.isDepthTexture)u.sampleType=Vy.Depth;else if(o.texture.isDataTexture||o.texture.isDataArrayTexture||o.texture.isData3DTexture){const c=o.texture.type;c===Co?u.sampleType=Vy.SInt:c===ja?u.sampleType=Vy.UInt:c===Al&&(this.backend.hasFeature("float32-filterable")?u.sampleType=Vy.Float:u.sampleType=Vy.UnfilterableFloat)}o.isSampledCubeTexture?u.viewDimension=jl.Cube:o.texture.isDataArrayTexture||o.texture.isCompressedArrayTexture?u.viewDimension=jl.TwoDArray:o.isSampledTexture3D&&(u.viewDimension=jl.ThreeD),l.texture=u}else console.error(`WebGPUBindingUtils: Unsupported binding "${o}".`);n.push(l)}return i.createBindGroupLayout({entries:n})}createBindings(e){const{backend:i,bindGroupLayoutCache:n}=this,s=i.get(e);let o=n.get(e.bindingsReference);o===void 0&&(o=this.createBindingsLayout(e),n.set(e.bindingsReference,o));const l=this.createBindGroup(e,o);s.layout=o,s.group=l}updateBinding(e){const i=this.backend,n=i.device,s=e.buffer,o=i.get(e).buffer;n.queue.writeBuffer(o,0,s,0)}createBindGroup(e,i){const n=this.backend,s=n.device;let o=0;const l=[];for(const u of e.bindings){if(u.isUniformBuffer){const c=n.get(u);if(c.buffer===void 0){const h=u.byteLength,p=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,f=s.createBuffer({label:"bindingBuffer_"+u.name,size:h,usage:p});c.buffer=f}l.push({binding:o,resource:{buffer:c.buffer}})}else if(u.isStorageBuffer){const c=n.get(u);if(c.buffer===void 0){const h=u.attribute;c.buffer=n.get(h).buffer}l.push({binding:o,resource:{buffer:c.buffer}})}else if(u.isSampler){const c=n.get(u.texture);l.push({binding:o,resource:c.sampler})}else if(u.isSampledTexture){const c=n.get(u.texture);let h;if(c.externalTexture!==void 0)h=s.importExternalTexture({source:c.externalTexture});else{const p=u.store?1:c.texture.mipLevelCount,f=`view-${c.texture.width}-${c.texture.height}-${p}`;if(h=c[f],h===void 0){const g=jAe.All;let m;u.isSampledCubeTexture?m=jl.Cube:u.isSampledTexture3D?m=jl.ThreeD:u.texture.isDataArrayTexture||u.texture.isCompressedArrayTexture?m=jl.TwoDArray:m=jl.TwoD,h=c[f]=c.texture.createView({aspect:g,dimension:m,mipLevelCount:p})}}l.push({binding:o,resource:h})}o++}return s.createBindGroup({label:"bindGroup_"+e.name,layout:i,entries:l})}}class tbe{constructor(e){this.backend=e}_getSampleCount(e){return this.backend.utils.getSampleCountRenderContext(e)}createRenderPipeline(e,i){const{object:n,material:s,geometry:o,pipeline:l}=e,{vertexProgram:u,fragmentProgram:c}=l,h=this.backend,p=h.device,f=h.utils,g=h.get(l),m=[];for(const H of e.getBindings()){const G=h.get(H);m.push(G.layout)}const y=h.attributeUtils.createShaderVertexBuffers(e);let b;s.transparent===!0&&s.blending!==ag&&(b=this._getBlending(s));let v={};s.stencilWrite===!0&&(v={compare:this._getStencilCompare(s),failOp:this._getStencilOperation(s.stencilFail),depthFailOp:this._getStencilOperation(s.stencilZFail),passOp:this._getStencilOperation(s.stencilZPass)});const _=this._getColorWriteMask(s),C=[];if(e.context.textures!==null){const H=e.context.textures;for(let G=0;G<H.length;G++){const J=f.getTextureFormatGPU(H[G]);C.push({format:J,blend:b,writeMask:_})}}else{const H=f.getCurrentColorFormat(e.context);C.push({format:H,blend:b,writeMask:_})}const E=h.get(u).module,T=h.get(c).module,R=this._getPrimitiveState(n,o,s),B=this._getDepthCompare(s),I=f.getCurrentDepthStencilFormat(e.context),D=this._getSampleCount(e.context),L={label:`renderPipeline_${s.name||s.type}_${s.id}`,vertex:Object.assign({},E,{buffers:y}),fragment:Object.assign({},T,{targets:C}),primitive:R,multisample:{count:D,alphaToCoverageEnabled:s.alphaToCoverage&&D>1},layout:p.createPipelineLayout({bindGroupLayouts:m})},O={},F=e.context.depth,q=e.context.stencil;if((F===!0||q===!0)&&(F===!0&&(O.format=I,O.depthWriteEnabled=s.depthWrite,O.depthCompare=B),q===!0&&(O.stencilFront=v,O.stencilBack={},O.stencilReadMask=s.stencilFuncMask,O.stencilWriteMask=s.stencilWriteMask),L.depthStencil=O),i===null)g.pipeline=p.createRenderPipeline(L);else{const H=new Promise(G=>{p.createRenderPipelineAsync(L).then(J=>{g.pipeline=J,G()})});i.push(H)}}createBundleEncoder(e){const i=this.backend,{utils:n,device:s}=i,o=n.getCurrentDepthStencilFormat(e),l=n.getCurrentColorFormat(e),u=this._getSampleCount(e),c={label:"renderBundleEncoder",colorFormats:[l],depthStencilFormat:o,sampleCount:u};return s.createRenderBundleEncoder(c)}createComputePipeline(e,i){const n=this.backend,s=n.device,o=n.get(e.computeProgram).module,l=n.get(e),u=[];for(const c of i){const h=n.get(c);u.push(h.layout)}l.pipeline=s.createComputePipeline({compute:o,layout:s.createPipelineLayout({bindGroupLayouts:u})})}_getBlending(e){let i,n;const s=e.blending,o=e.blendSrc,l=e.blendDst,u=e.blendEquation;if(s===TU){const c=e.blendSrcAlpha!==null?e.blendSrcAlpha:o,h=e.blendDstAlpha!==null?e.blendDstAlpha:l,p=e.blendEquationAlpha!==null?e.blendEquationAlpha:u;i={srcFactor:this._getBlendFactor(o),dstFactor:this._getBlendFactor(l),operation:this._getBlendOperation(u)},n={srcFactor:this._getBlendFactor(c),dstFactor:this._getBlendFactor(h),operation:this._getBlendOperation(p)}}else{const c=e.premultipliedAlpha,h=(p,f,g,m)=>{i={srcFactor:p,dstFactor:f,operation:rf.Add},n={srcFactor:g,dstFactor:m,operation:rf.Add}};if(c)switch(s){case dd:h(Qr.One,Qr.OneMinusSrcAlpha,Qr.One,Qr.OneMinusSrcAlpha);break;case M1:h(Qr.One,Qr.One,Qr.One,Qr.One);break;case R1:h(Qr.Zero,Qr.OneMinusSrc,Qr.Zero,Qr.One);break;case I1:h(Qr.Zero,Qr.Src,Qr.Zero,Qr.SrcAlpha);break}else switch(s){case dd:h(Qr.SrcAlpha,Qr.OneMinusSrcAlpha,Qr.One,Qr.OneMinusSrcAlpha);break;case M1:h(Qr.SrcAlpha,Qr.One,Qr.SrcAlpha,Qr.One);break;case R1:h(Qr.Zero,Qr.OneMinusSrc,Qr.Zero,Qr.One);break;case I1:h(Qr.Zero,Qr.Src,Qr.Zero,Qr.Src);break}}if(i!==void 0&&n!==void 0)return{color:i,alpha:n};console.error("THREE.WebGPURenderer: Invalid blending: ",s)}_getBlendFactor(e){let i;switch(e){case IU:i=Qr.Zero;break;case BU:i=Qr.One;break;case NU:i=Qr.Src;break;case LU:i=Qr.OneMinusSrc;break;case B1:i=Qr.SrcAlpha;break;case N1:i=Qr.OneMinusSrcAlpha;break;case PU:i=Qr.Dst;break;case kU:i=Qr.OneMinusDstColor;break;case DU:i=Qr.DstAlpha;break;case OU:i=Qr.OneMinusDstAlpha;break;case FU:i=Qr.SrcAlphaSaturated;break;case mAe:i=Qr.Constant;break;case gAe:i=Qr.OneMinusConstant;break;default:console.error("THREE.WebGPURenderer: Blend factor not supported.",e)}return i}_getStencilCompare(e){let i;const n=e.stencilFunc;switch(n){case qhe:i=Qa.Never;break;case w3:i=Qa.Always;break;case Xhe:i=Qa.Less;break;case Yhe:i=Qa.LessEqual;break;case Khe:i=Qa.Equal;break;case $he:i=Qa.GreaterEqual;break;case Jhe:i=Qa.Greater;break;case Zhe:i=Qa.NotEqual;break;default:console.error("THREE.WebGPURenderer: Invalid stencil function.",n)}return i}_getStencilOperation(e){let i;switch(e){case zp:i=Nd.Keep;break;case zhe:i=Nd.Zero;break;case jhe:i=Nd.Replace;break;case Qhe:i=Nd.Invert;break;case Ghe:i=Nd.IncrementClamp;break;case Vhe:i=Nd.DecrementClamp;break;case Hhe:i=Nd.IncrementWrap;break;case Whe:i=Nd.DecrementWrap;break;default:console.error("THREE.WebGPURenderer: Invalid stencil operation.",i)}return i}_getBlendOperation(e){let i;switch(e){case pd:i=rf.Add;break;case MU:i=rf.Subtract;break;case RU:i=rf.ReverseSubtract;break;case _he:i=rf.Min;break;case Ehe:i=rf.Max;break;default:console.error("THREE.WebGPUPipelineUtils: Blend equation not supported.",e)}return i}_getPrimitiveState(e,i,n){const s={},o=this.backend.utils;switch(s.topology=o.getPrimitiveTopology(e,n),i.index!==null&&e.isLine===!0&&e.isLineSegments!==!0&&(s.stripIndexFormat=i.index.array instanceof Uint16Array?Hg.Uint16:Hg.Uint32),n.side){case ng:s.frontFace=eI.CCW,s.cullMode=tI.Back;break;case yc:s.frontFace=eI.CCW,s.cullMode=tI.Front;break;case sg:s.frontFace=eI.CCW,s.cullMode=tI.None;break;default:console.error("THREE.WebGPUPipelineUtils: Unknown material.side value.",n.side);break}return s}_getColorWriteMask(e){return e.colorWrite===!0?s7.All:s7.None}_getDepthCompare(e){let i;if(e.depthTest===!1)i=Qa.Always;else{const n=e.depthFunc;switch(n){case UU:i=Qa.Never;break;case zU:i=Qa.Always;break;case jU:i=Qa.Less;break;case L1:i=Qa.LessEqual;break;case GU:i=Qa.Equal;break;case VU:i=Qa.GreaterEqual;break;case HU:i=Qa.Greater;break;case WU:i=Qa.NotEqual;break;default:console.error("THREE.WebGPUPipelineUtils: Invalid depth function.",n)}}return i}}class ibe extends U7{constructor(e={}){super(e),this.isWebGPUBackend=!0,this.parameters.alpha=e.alpha===void 0?!0:e.alpha,this.parameters.requiredLimits=e.requiredLimits===void 0?{}:e.requiredLimits,this.trackTimestamp=e.trackTimestamp===!0,this.device=null,this.context=null,this.colorBuffer=null,this.defaultRenderPassdescriptor=null,this.utils=new Kve(this),this.attributeUtils=new $ve(this),this.bindingUtils=new ebe(this),this.pipelineUtils=new tbe(this),this.textureUtils=new zve(this),this.occludedResolveCache=new Map}async init(e){await super.init(e);const i=this.parameters;let n;if(i.device===void 0){const l={powerPreference:i.powerPreference},u=await navigator.gpu.requestAdapter(l);if(u===null)throw new Error("WebGPUBackend: Unable to create WebGPU adapter.");const c=Object.values(nI),h=[];for(const f of c)u.features.has(f)&&h.push(f);const p={requiredFeatures:h,requiredLimits:i.requiredLimits};n=await u.requestDevice(p)}else n=i.device;n.lost.then(l=>{const u={api:"WebGPU",message:l.message||"Unknown reason",reason:l.reason||null,originalEvent:l};e.onDeviceLost(u)});const s=i.context!==void 0?i.context:e.domElement.getContext("webgpu");this.device=n,this.context=s;const o=i.alpha?"premultiplied":"opaque";this.trackTimestamp=this.trackTimestamp&&this.hasFeature(nI.TimestampQuery),this.context.configure({device:this.device,format:this.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:o}),this.updateSize()}get coordinateSystem(){return jp}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}getContext(){return this.context}_getDefaultRenderPassDescriptor(){let e=this.defaultRenderPassdescriptor;if(e===null){const n=this.renderer;e={colorAttachments:[{view:null}]},(this.renderer.depth===!0||this.renderer.stencil===!0)&&(e.depthStencilAttachment={view:this.textureUtils.getDepthBuffer(n.depth,n.stencil).createView()});const s=e.colorAttachments[0];this.renderer.samples>0?s.view=this.colorBuffer.createView():s.resolveTarget=void 0,this.defaultRenderPassdescriptor=e}const i=e.colorAttachments[0];return this.renderer.samples>0?i.resolveTarget=this.context.getCurrentTexture().createView():i.view=this.context.getCurrentTexture().createView(),e}_getRenderPassDescriptor(e){const i=e.renderTarget,n=this.get(i);let s=n.descriptors;if(s===void 0||n.width!==i.width||n.height!==i.height||n.activeMipmapLevel!==i.activeMipmapLevel||n.samples!==i.samples){s={},n.descriptors=s;const u=()=>{i.removeEventListener("dispose",u),this.delete(i)};i.addEventListener("dispose",u)}const o=e.getCacheKey();let l=s[o];if(l===void 0){const u=e.textures,c=[];for(let h=0;h<u.length;h++){const p=this.get(u[h]),f=p.texture.createView({baseMipLevel:e.activeMipmapLevel,mipLevelCount:1,baseArrayLayer:e.activeCubeFace,dimension:jl.TwoD});let g,m;p.msaaTexture!==void 0?(g=p.msaaTexture.createView(),m=f):(g=f,m=void 0),c.push({view:g,resolveTarget:m,loadOp:la.Load,storeOp:qa.Store})}if(l={colorAttachments:c},e.depth){const h={view:this.get(e.depthTexture).texture.createView()};l.depthStencilAttachment=h}s[o]=l,n.width=i.width,n.height=i.height,n.samples=i.samples,n.activeMipmapLevel=i.activeMipmapLevel}return l}beginRender(e){const i=this.get(e),n=this.device,s=e.occlusionQueryCount;let o;s>0&&(i.currentOcclusionQuerySet&&i.currentOcclusionQuerySet.destroy(),i.currentOcclusionQueryBuffer&&i.currentOcclusionQueryBuffer.destroy(),i.currentOcclusionQuerySet=i.occlusionQuerySet,i.currentOcclusionQueryBuffer=i.occlusionQueryBuffer,i.currentOcclusionQueryObjects=i.occlusionQueryObjects,o=n.createQuerySet({type:"occlusion",count:s}),i.occlusionQuerySet=o,i.occlusionQueryIndex=0,i.occlusionQueryObjects=new Array(s),i.lastOcclusionObject=null);let l;e.textures===null?l=this._getDefaultRenderPassDescriptor():l=this._getRenderPassDescriptor(e),this.initTimestampQuery(e,l),l.occlusionQuerySet=o;const u=l.depthStencilAttachment;if(e.textures!==null){const p=l.colorAttachments;for(let f=0;f<p.length;f++){const g=p[f];e.clearColor?(g.clearValue=f===0?e.clearColorValue:{r:0,g:0,b:0,a:1},g.loadOp=la.Clear,g.storeOp=qa.Store):(g.loadOp=la.Load,g.storeOp=qa.Store)}}else{const p=l.colorAttachments[0];e.clearColor?(p.clearValue=e.clearColorValue,p.loadOp=la.Clear,p.storeOp=qa.Store):(p.loadOp=la.Load,p.storeOp=qa.Store)}e.depth&&(e.clearDepth?(u.depthClearValue=e.clearDepthValue,u.depthLoadOp=la.Clear,u.depthStoreOp=qa.Store):(u.depthLoadOp=la.Load,u.depthStoreOp=qa.Store)),e.stencil&&(e.clearStencil?(u.stencilClearValue=e.clearStencilValue,u.stencilLoadOp=la.Clear,u.stencilStoreOp=qa.Store):(u.stencilLoadOp=la.Load,u.stencilStoreOp=qa.Store));const c=n.createCommandEncoder({label:"renderContext_"+e.id}),h=c.beginRenderPass(l);if(i.descriptor=l,i.encoder=c,i.currentPass=h,i.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},i.renderBundles=[],e.viewport&&this.updateViewport(e),e.scissor){const{x:p,y:f,width:g,height:m}=e.scissorValue;h.setScissorRect(p,f,g,m)}}finishRender(e){const i=this.get(e),n=e.occlusionQueryCount;if(i.renderBundles.length>0&&i.currentPass.executeBundles(i.renderBundles),n>i.occlusionQueryIndex&&i.currentPass.endOcclusionQuery(),i.currentPass.end(),n>0){const s=n*8;let o=this.occludedResolveCache.get(s);o===void 0&&(o=this.device.createBuffer({size:s,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.occludedResolveCache.set(s,o));const l=this.device.createBuffer({size:s,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});i.encoder.resolveQuerySet(i.occlusionQuerySet,0,n,o,0),i.encoder.copyBufferToBuffer(o,0,l,0,s),i.occlusionQueryBuffer=l,this.resolveOccludedAsync(e)}if(this.prepareTimestampBuffer(e,i.encoder),this.device.queue.submit([i.encoder.finish()]),e.textures!==null){const s=e.textures;for(let o=0;o<s.length;o++){const l=s[o];l.generateMipmaps===!0&&this.textureUtils.generateMipmaps(l)}}}isOccluded(e,i){const n=this.get(e);return n.occluded&&n.occluded.has(i)}async resolveOccludedAsync(e){const i=this.get(e),{currentOcclusionQueryBuffer:n,currentOcclusionQueryObjects:s}=i;if(n&&s){const o=new WeakSet;i.currentOcclusionQueryObjects=null,i.currentOcclusionQueryBuffer=null,await n.mapAsync(GPUMapMode.READ);const l=n.getMappedRange(),u=new BigUint64Array(l);for(let c=0;c<s.length;c++)u[c]!==BigInt(0)&&o.add(s[c]);n.destroy(),i.occluded=o}}updateViewport(e){const{currentPass:i}=this.get(e),{x:n,y:s,width:o,height:l,minDepth:u,maxDepth:c}=e.viewportValue;i.setViewport(n,s,o,l,u,c)}clear(e,i,n,s=null){const o=this.device,l=this.renderer;let u=[],c,h,p,f;if(e){const m=this.getClearColor();if(this.renderer.alpha===!0){const y=m.a;h={r:m.r*y,g:m.g*y,b:m.b*y,a:y}}else h={r:m.r,g:m.g,b:m.b,a:m.a}}if(s===null){p=l.depth,f=l.stencil;const m=this._getDefaultRenderPassDescriptor();if(e){u=m.colorAttachments;const y=u[0];y.clearValue=h,y.loadOp=la.Clear,y.storeOp=qa.Store}(p||f)&&(c=m.depthStencilAttachment)}else{if(p=s.depth,f=s.stencil,e)for(const m of s.textures){const y=this.get(m),b=y.texture.createView();let v,_;y.msaaTexture!==void 0?(v=y.msaaTexture.createView(),_=b):(v=b,_=void 0),u.push({view:v,resolveTarget:_,clearValue:h,loadOp:la.Clear,storeOp:qa.Store})}(p||f)&&(c={view:this.get(s.depthTexture).texture.createView()})}p&&(i?(c.depthLoadOp=la.Clear,c.depthClearValue=l.getClearDepth(),c.depthStoreOp=qa.Store):(c.depthLoadOp=la.Load,c.depthStoreOp=qa.Store)),f&&(n?(c.stencilLoadOp=la.Clear,c.stencilClearValue=l.getClearStencil(),c.stencilStoreOp=qa.Store):(c.stencilLoadOp=la.Load,c.stencilStoreOp=qa.Store));const g=o.createCommandEncoder({});g.beginRenderPass({colorAttachments:u,depthStencilAttachment:c}).end(),o.queue.submit([g.finish()])}beginCompute(e){const i=this.get(e),n={};this.initTimestampQuery(e,n),i.cmdEncoderGPU=this.device.createCommandEncoder(),i.passEncoderGPU=i.cmdEncoderGPU.beginComputePass(n)}compute(e,i,n,s){const{passEncoderGPU:o}=this.get(e),l=this.get(s).pipeline;o.setPipeline(l);for(let p=0,f=n.length;p<f;p++){const g=n[p],m=this.get(g);o.setBindGroup(p,m.group)}const u=this.device.limits.maxComputeWorkgroupsPerDimension,c=this.get(i);c.dispatchSize===void 0&&(c.dispatchSize={x:0,y:1,z:1});const{dispatchSize:h}=c;i.dispatchCount>u?(h.x=Math.min(i.dispatchCount,u),h.y=Math.ceil(i.dispatchCount/u)):h.x=i.dispatchCount,o.dispatchWorkgroups(h.x,h.y,h.z)}finishCompute(e){const i=this.get(e);i.passEncoderGPU.end(),this.prepareTimestampBuffer(e,i.cmdEncoderGPU),this.device.queue.submit([i.cmdEncoderGPU.finish()])}async waitForGPU(){await this.device.queue.onSubmittedWorkDone()}draw(e,i){const{object:n,context:s,pipeline:o}=e,l=e.getBindings(),u=this.get(s),c=this.get(o).pipeline,h=u.currentSets,p=u.currentPass,f=e.getDrawParameters();if(f===null)return;h.pipeline!==c&&(p.setPipeline(c),h.pipeline=c);const g=h.bindingGroups;for(let v=0,_=l.length;v<_;v++){const C=l[v],E=this.get(C);g[C.index]!==C.id&&(p.setBindGroup(C.index,E.group),g[C.index]=C.id)}const m=e.getIndex(),y=m!==null;if(y===!0&&h.index!==m){const v=this.get(m).buffer,_=m.array instanceof Uint16Array?Hg.Uint16:Hg.Uint32;p.setIndexBuffer(v,_),h.index=m}const b=e.getVertexBuffers();for(let v=0,_=b.length;v<_;v++){const C=b[v];if(h.attributes[v]!==C){const E=this.get(C).buffer;p.setVertexBuffer(v,E),h.attributes[v]=C}}if(u.occlusionQuerySet!==void 0){const v=u.lastOcclusionObject;v!==n&&(v!==null&&v.occlusionTest===!0&&(p.endOcclusionQuery(),u.occlusionQueryIndex++),n.occlusionTest===!0&&(p.beginOcclusionQuery(u.occlusionQueryIndex),u.occlusionQueryObjects[u.occlusionQueryIndex]=n),u.lastOcclusionObject=n)}if(n.isBatchedMesh===!0){const v=n._multiDrawStarts,_=n._multiDrawCounts,C=n._multiDrawCount,E=n._multiDrawInstances,T=y?m.array.BYTES_PER_ELEMENT:1;for(let R=0;R<C;R++){const B=E?E[R]:1,I=B>1?0:R;p.drawIndexed(_[R],B,v[R]/T,0,I)}}else if(y===!0){const{vertexCount:v,instanceCount:_,firstVertex:C}=f,E=e.getIndirect();if(E!==null){const T=this.get(E).buffer;p.drawIndexedIndirect(T,0)}else p.drawIndexed(v,_,C,0,0);i.update(n,v,_)}else{const{vertexCount:v,instanceCount:_,firstVertex:C}=f,E=e.getIndirect();if(E!==null){const T=this.get(E).buffer;p.drawIndirect(T,0)}else p.draw(v,_,C,0);i.update(n,v,_)}}needsRenderUpdate(e){const i=this.get(e),{object:n,material:s}=e,o=this.utils,l=o.getSampleCountRenderContext(e.context),u=o.getCurrentColorSpace(e.context),c=o.getCurrentColorFormat(e.context),h=o.getCurrentDepthStencilFormat(e.context),p=o.getPrimitiveTopology(n,s);let f=!1;return(i.material!==s||i.materialVersion!==s.version||i.transparent!==s.transparent||i.blending!==s.blending||i.premultipliedAlpha!==s.premultipliedAlpha||i.blendSrc!==s.blendSrc||i.blendDst!==s.blendDst||i.blendEquation!==s.blendEquation||i.blendSrcAlpha!==s.blendSrcAlpha||i.blendDstAlpha!==s.blendDstAlpha||i.blendEquationAlpha!==s.blendEquationAlpha||i.colorWrite!==s.colorWrite||i.depthWrite!==s.depthWrite||i.depthTest!==s.depthTest||i.depthFunc!==s.depthFunc||i.stencilWrite!==s.stencilWrite||i.stencilFunc!==s.stencilFunc||i.stencilFail!==s.stencilFail||i.stencilZFail!==s.stencilZFail||i.stencilZPass!==s.stencilZPass||i.stencilFuncMask!==s.stencilFuncMask||i.stencilWriteMask!==s.stencilWriteMask||i.side!==s.side||i.alphaToCoverage!==s.alphaToCoverage||i.sampleCount!==l||i.colorSpace!==u||i.colorFormat!==c||i.depthStencilFormat!==h||i.primitiveTopology!==p||i.clippingContextCacheKey!==e.clippingContext.cacheKey)&&(i.material=s,i.materialVersion=s.version,i.transparent=s.transparent,i.blending=s.blending,i.premultipliedAlpha=s.premultipliedAlpha,i.blendSrc=s.blendSrc,i.blendDst=s.blendDst,i.blendEquation=s.blendEquation,i.blendSrcAlpha=s.blendSrcAlpha,i.blendDstAlpha=s.blendDstAlpha,i.blendEquationAlpha=s.blendEquationAlpha,i.colorWrite=s.colorWrite,i.depthWrite=s.depthWrite,i.depthTest=s.depthTest,i.depthFunc=s.depthFunc,i.stencilWrite=s.stencilWrite,i.stencilFunc=s.stencilFunc,i.stencilFail=s.stencilFail,i.stencilZFail=s.stencilZFail,i.stencilZPass=s.stencilZPass,i.stencilFuncMask=s.stencilFuncMask,i.stencilWriteMask=s.stencilWriteMask,i.side=s.side,i.alphaToCoverage=s.alphaToCoverage,i.sampleCount=l,i.colorSpace=u,i.colorFormat=c,i.depthStencilFormat=h,i.primitiveTopology=p,i.clippingContextCacheKey=e.clippingContext.cacheKey,f=!0),f}getRenderCacheKey(e){const{object:i,material:n}=e,s=this.utils,o=e.context;return[n.transparent,n.blending,n.premultipliedAlpha,n.blendSrc,n.blendDst,n.blendEquation,n.blendSrcAlpha,n.blendDstAlpha,n.blendEquationAlpha,n.colorWrite,n.depthWrite,n.depthTest,n.depthFunc,n.stencilWrite,n.stencilFunc,n.stencilFail,n.stencilZFail,n.stencilZPass,n.stencilFuncMask,n.stencilWriteMask,n.side,s.getSampleCountRenderContext(o),s.getCurrentColorSpace(o),s.getCurrentColorFormat(o),s.getCurrentDepthStencilFormat(o),s.getPrimitiveTopology(i,n),e.getGeometryCacheKey(),e.clippingContext.cacheKey].join()}createSampler(e){this.textureUtils.createSampler(e)}destroySampler(e){this.textureUtils.destroySampler(e)}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,i){this.textureUtils.createTexture(e,i)}updateTexture(e,i){this.textureUtils.updateTexture(e,i)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e){this.textureUtils.destroyTexture(e)}copyTextureToBuffer(e,i,n,s,o,l){return this.textureUtils.copyTextureToBuffer(e,i,n,s,o,l)}initTimestampQuery(e,i){if(!this.trackTimestamp)return;const n=this.get(e);if(!n.timeStampQuerySet){const s=this.device.createQuerySet({type:"timestamp",count:2});Object.assign(i,{timestampWrites:{querySet:s,beginningOfPassWriteIndex:0,endOfPassWriteIndex:1}}),n.timeStampQuerySet=s}}prepareTimestampBuffer(e,i){if(!this.trackTimestamp)return;const n=this.get(e),s=2*BigInt64Array.BYTES_PER_ELEMENT;n.currentTimestampQueryBuffers===void 0&&(n.currentTimestampQueryBuffers={resolveBuffer:this.device.createBuffer({label:"timestamp resolve buffer",size:s,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),resultBuffer:this.device.createBuffer({label:"timestamp result buffer",size:s,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),isMappingPending:!1});const{resolveBuffer:o,resultBuffer:l,isMappingPending:u}=n.currentTimestampQueryBuffers;u!==!0&&(i.resolveQuerySet(n.timeStampQuerySet,0,2,o,0),i.copyBufferToBuffer(o,0,l,0,s))}async resolveTimestampAsync(e,i="render"){if(!this.trackTimestamp)return;const n=this.get(e);if(n.currentTimestampQueryBuffers===void 0)return;const{resultBuffer:s,isMappingPending:o}=n.currentTimestampQueryBuffers;o!==!0&&(n.currentTimestampQueryBuffers.isMappingPending=!0,s.mapAsync(GPUMapMode.READ).then(()=>{const l=new BigUint64Array(s.getMappedRange()),u=Number(l[1]-l[0])/1e6;this.renderer.info.updateTimestamp(i,u),s.unmap(),n.currentTimestampQueryBuffers.isMappingPending=!1}))}createNodeBuilder(e,i){return new Xve(e,i)}createProgram(e){const i=this.get(e);i.module={module:this.device.createShaderModule({code:e.code,label:e.stage}),entryPoint:"main"}}destroyProgram(e){this.delete(e)}createRenderPipeline(e,i){this.pipelineUtils.createRenderPipeline(e,i)}createComputePipeline(e,i){this.pipelineUtils.createComputePipeline(e,i)}beginBundle(e){const i=this.get(e);i._currentPass=i.currentPass,i._currentSets=i.currentSets,i.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},i.currentPass=this.pipelineUtils.createBundleEncoder(e)}finishBundle(e,i){const n=this.get(e),s=n.currentPass.finish();this.get(i).bundleGPU=s,n.currentSets=n._currentSets,n.currentPass=n._currentPass}addBundle(e,i){this.get(e).renderBundles.push(this.get(i).bundleGPU)}createBindings(e){this.bindingUtils.createBindings(e)}updateBindings(e){this.bindingUtils.createBindings(e)}updateBinding(e){this.bindingUtils.updateBinding(e)}createIndexAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.INDEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createIndirectStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.INDIRECT|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}updateSize(){this.colorBuffer=this.textureUtils.getColorBuffer(),this.defaultRenderPassdescriptor=null}getMaxAnisotropy(){return 16}hasFeature(e){return this.device.features.has(e)}copyTextureToTexture(e,i,n=null,s=null,o=0){let l=0,u=0,c=0,h=0,p=0,f=0,g=e.image.width,m=e.image.height;n!==null&&(h=n.x,p=n.y,f=n.z||0,g=n.width,m=n.height),s!==null&&(l=s.x,u=s.y,c=s.z||0);const y=this.device.createCommandEncoder({label:"copyTextureToTexture_"+e.id+"_"+i.id}),b=this.get(e).texture,v=this.get(i).texture;y.copyTextureToTexture({texture:b,mipLevel:o,origin:{x:h,y:p,z:f}},{texture:v,mipLevel:o,origin:{x:l,y:u,z:c}},[g,m,1]),this.device.queue.submit([y.finish()])}copyFramebufferToTexture(e,i,n){const s=this.get(i);let o=null;i.renderTarget?e.isDepthTexture?o=this.get(i.depthTexture).texture:o=this.get(i.textures[0]).texture:e.isDepthTexture?o=this.textureUtils.getDepthBuffer(i.depth,i.stencil):o=this.context.getCurrentTexture();const l=this.get(e).texture;if(o.format!==l.format){console.error("WebGPUBackend: copyFramebufferToTexture: Source and destination formats do not match.",o.format,l.format);return}let u;if(s.currentPass?(s.currentPass.end(),u=s.encoder):u=this.device.createCommandEncoder({label:"copyFramebufferToTexture_"+e.id}),u.copyTextureToTexture({texture:o,origin:{x:n.x,y:n.y,z:0}},{texture:l},[n.z,n.w]),e.generateMipmaps&&this.textureUtils.generateMipmaps(e),s.currentPass){const{descriptor:c}=s;for(let h=0;h<c.colorAttachments.length;h++)c.colorAttachments[h].loadOp=la.Load;i.depth&&(c.depthStencilAttachment.depthLoadOp=la.Load),i.stencil&&(c.depthStencilAttachment.stencilLoadOp=la.Load),s.currentPass=u.beginRenderPass(c),s.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null}}else this.device.queue.submit([u.finish()])}}class rbe extends $6{constructor(e,i,n,s,o,l){super(e,i,n,s,o,l),this.iesMap=null}copy(e,i){return super.copy(e,i),this.iesMap=e.iesMap,this}}class nbe extends R7{constructor(){super(),this.addMaterial(a0e,W6),this.addMaterial(Yz,$3),this.addMaterial(Q0e,H6),this.addMaterial(Y0e,Q6),this.addMaterial($ge,K1),this.addMaterial(n0e,X6),this.addMaterial(qge,q6),this.addMaterial(eAe,K6),this.addMaterial(Gge,J3),this.addMaterial(Hge,Y6),this.addMaterial(iAe,G6),this.addMaterial(aAe,z6),this.addMaterial(cAe,V6),this.addLight(vye,Jde),this.addLight(Kye,$de),this.addLight(Yye,tpe),this.addLight(C7,$6),this.addLight(Zye,epe),this.addLight($ye,Xde),this.addLight(eve,rpe),this.addLight(Jye,rbe),this.addToneMapping(HAe,She),this.addToneMapping(WAe,The),this.addToneMapping(QAe,Mhe),this.addToneMapping(XAe,Rhe),this.addToneMapping(ZAe,Ihe),this.addToneMapping($Ae,Bhe)}}class sbe extends hve{constructor(e={}){let i;e.forceWebGL?i=H7:(i=ibe,e.getFallback=()=>(console.warn("THREE.WebGPURenderer: WebGPU is not available, running under WebGL2 backend."),new H7(e)));const n=new i(e);super(n,e),this.library=new nbe,this.isWebGPURenderer=!0}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:S1}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=S1);const MI={type:"change"},RI={type:"start"},II={type:"end"},X7=1e-6,Xn={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4},q_=new Gi,Dd=new Gi,abe=new ot,X_=new ot,BI=new ot,Yg=new Hc,K7=new ot,K_=new ot,NI=new ot,Y_=new ot;class obe extends Wx{constructor(e,i=null){super(e,i),this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.keys=["KeyA","KeyS","KeyD"],this.mouseButtons={LEFT:Ua.ROTATE,MIDDLE:Ua.DOLLY,RIGHT:Ua.PAN},this.state=Xn.NONE,this.keyState=Xn.NONE,this.target=new ot,this._lastPosition=new ot,this._lastZoom=1,this._touchZoomDistanceStart=0,this._touchZoomDistanceEnd=0,this._lastAngle=0,this._eye=new ot,this._movePrev=new Gi,this._moveCurr=new Gi,this._lastAxis=new ot,this._zoomStart=new Gi,this._zoomEnd=new Gi,this._panStart=new Gi,this._panEnd=new Gi,this._pointers=[],this._pointerPositions={},this._onPointerMove=cbe.bind(this),this._onPointerDown=lbe.bind(this),this._onPointerUp=ube.bind(this),this._onPointerCancel=hbe.bind(this),this._onContextMenu=ybe.bind(this),this._onMouseWheel=Abe.bind(this),this._onKeyDown=pbe.bind(this),this._onKeyUp=dbe.bind(this),this._onTouchStart=vbe.bind(this),this._onTouchMove=bbe.bind(this),this._onTouchEnd=xbe.bind(this),this._onMouseDown=fbe.bind(this),this._onMouseMove=mbe.bind(this),this._onMouseUp=gbe.bind(this),this._target0=this.target.clone(),this._position0=this.object.position.clone(),this._up0=this.object.up.clone(),this._zoom0=this.object.zoom,i!==null&&(this.connect(),this.handleResize()),this.update()}connect(){window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}handleResize(){const e=this.domElement.getBoundingClientRect(),i=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-i.clientLeft,this.screen.top=e.top+window.pageYOffset-i.clientTop,this.screen.width=e.width,this.screen.height=e.height}update(){this._eye.subVectors(this.object.position,this.target),this.noRotate||this._rotateCamera(),this.noZoom||this._zoomCamera(),this.noPan||this._panCamera(),this.object.position.addVectors(this.target,this._eye),this.object.isPerspectiveCamera?(this._checkDistances(),this.object.lookAt(this.target),this._lastPosition.distanceToSquared(this.object.position)>X7&&(this.dispatchEvent(MI),this._lastPosition.copy(this.object.position))):this.object.isOrthographicCamera?(this.object.lookAt(this.target),(this._lastPosition.distanceToSquared(this.object.position)>X7||this._lastZoom!==this.object.zoom)&&(this.dispatchEvent(MI),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type.")}reset(){this.state=Xn.NONE,this.keyState=Xn.NONE,this.target.copy(this._target0),this.object.position.copy(this._position0),this.object.up.copy(this._up0),this.object.zoom=this._zoom0,this.object.updateProjectionMatrix(),this._eye.subVectors(this.object.position,this.target),this.object.lookAt(this.target),this.dispatchEvent(MI),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom}_panCamera(){if(Dd.copy(this._panEnd).sub(this._panStart),Dd.lengthSq()){if(this.object.isOrthographicCamera){const e=(this.object.right-this.object.left)/this.object.zoom/this.domElement.clientWidth,i=(this.object.top-this.object.bottom)/this.object.zoom/this.domElement.clientWidth;Dd.x*=e,Dd.y*=i}Dd.multiplyScalar(this._eye.length()*this.panSpeed),X_.copy(this._eye).cross(this.object.up).setLength(Dd.x),X_.add(abe.copy(this.object.up).setLength(Dd.y)),this.object.position.add(X_),this.target.add(X_),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(Dd.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}_rotateCamera(){Y_.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0);let e=Y_.length();e?(this._eye.copy(this.object.position).sub(this.target),K7.copy(this._eye).normalize(),K_.copy(this.object.up).normalize(),NI.crossVectors(K_,K7).normalize(),K_.setLength(this._moveCurr.y-this._movePrev.y),NI.setLength(this._moveCurr.x-this._movePrev.x),Y_.copy(K_.add(NI)),BI.crossVectors(Y_,this._eye).normalize(),e*=this.rotateSpeed,Yg.setFromAxisAngle(BI,e),this._eye.applyQuaternion(Yg),this.object.up.applyQuaternion(Yg),this._lastAxis.copy(BI),this._lastAngle=e):!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.target),Yg.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(Yg),this.object.up.applyQuaternion(Yg)),this._movePrev.copy(this._moveCurr)}_zoomCamera(){let e;this.state===Xn.TOUCH_ZOOM_PAN?(e=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=OS.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(e=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed,e!==1&&e>0&&(this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=OS.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor)}_getMouseOnScreen(e,i){return q_.set((e-this.screen.left)/this.screen.width,(i-this.screen.top)/this.screen.height),q_}_getMouseOnCircle(e,i){return q_.set((e-this.screen.width*.5-this.screen.left)/(this.screen.width*.5),(this.screen.height+2*(this.screen.top-i))/this.screen.width),q_}_addPointer(e){this._pointers.push(e)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let i=0;i<this._pointers.length;i++)if(this._pointers[i].pointerId==e.pointerId){this._pointers.splice(i,1);return}}_trackPointer(e){let i=this._pointerPositions[e.pointerId];i===void 0&&(i=new Gi,this._pointerPositions[e.pointerId]=i),i.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const i=e.pointerId===this._pointers[0].pointerId?this._pointers[1]:this._pointers[0];return this._pointerPositions[i.pointerId]}_checkDistances(){(!this.noZoom||!this.noPan)&&(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))}}function lbe(r){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(r.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),this._addPointer(r),r.pointerType==="touch"?this._onTouchStart(r):this._onMouseDown(r))}function cbe(r){this.enabled!==!1&&(r.pointerType==="touch"?this._onTouchMove(r):this._onMouseMove(r))}function ube(r){this.enabled!==!1&&(r.pointerType==="touch"?this._onTouchEnd(r):this._onMouseUp(),this._removePointer(r),this._pointers.length===0&&(this.domElement.releasePointerCapture(r.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp)))}function hbe(r){this._removePointer(r)}function dbe(){this.enabled!==!1&&(this.keyState=Xn.NONE,window.addEventListener("keydown",this._onKeyDown))}function pbe(r){this.enabled!==!1&&(window.removeEventListener("keydown",this._onKeyDown),this.keyState===Xn.NONE&&(r.code===this.keys[Xn.ROTATE]&&!this.noRotate?this.keyState=Xn.ROTATE:r.code===this.keys[Xn.ZOOM]&&!this.noZoom?this.keyState=Xn.ZOOM:r.code===this.keys[Xn.PAN]&&!this.noPan&&(this.keyState=Xn.PAN)))}function fbe(r){let e;switch(r.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case Ua.DOLLY:this.state=Xn.ZOOM;break;case Ua.ROTATE:this.state=Xn.ROTATE;break;case Ua.PAN:this.state=Xn.PAN;break;default:this.state=Xn.NONE}const i=this.keyState!==Xn.NONE?this.keyState:this.state;i===Xn.ROTATE&&!this.noRotate?(this._moveCurr.copy(this._getMouseOnCircle(r.pageX,r.pageY)),this._movePrev.copy(this._moveCurr)):i===Xn.ZOOM&&!this.noZoom?(this._zoomStart.copy(this._getMouseOnScreen(r.pageX,r.pageY)),this._zoomEnd.copy(this._zoomStart)):i===Xn.PAN&&!this.noPan&&(this._panStart.copy(this._getMouseOnScreen(r.pageX,r.pageY)),this._panEnd.copy(this._panStart)),this.dispatchEvent(RI)}function mbe(r){const e=this.keyState!==Xn.NONE?this.keyState:this.state;e===Xn.ROTATE&&!this.noRotate?(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(r.pageX,r.pageY))):e===Xn.ZOOM&&!this.noZoom?this._zoomEnd.copy(this._getMouseOnScreen(r.pageX,r.pageY)):e===Xn.PAN&&!this.noPan&&this._panEnd.copy(this._getMouseOnScreen(r.pageX,r.pageY))}function gbe(){this.state=Xn.NONE,this.dispatchEvent(II)}function Abe(r){if(this.enabled!==!1&&this.noZoom!==!0){switch(r.preventDefault(),r.deltaMode){case 2:this._zoomStart.y-=r.deltaY*.025;break;case 1:this._zoomStart.y-=r.deltaY*.01;break;default:this._zoomStart.y-=r.deltaY*25e-5;break}this.dispatchEvent(RI),this.dispatchEvent(II)}}function ybe(r){this.enabled!==!1&&r.preventDefault()}function vbe(r){switch(this._trackPointer(r),this._pointers.length){case 1:this.state=Xn.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(this._pointers[0].pageX,this._pointers[0].pageY)),this._movePrev.copy(this._moveCurr);break;default:this.state=Xn.TOUCH_ZOOM_PAN;const e=this._pointers[0].pageX-this._pointers[1].pageX,i=this._pointers[0].pageY-this._pointers[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(e*e+i*i);const n=(this._pointers[0].pageX+this._pointers[1].pageX)/2,s=(this._pointers[0].pageY+this._pointers[1].pageY)/2;this._panStart.copy(this._getMouseOnScreen(n,s)),this._panEnd.copy(this._panStart);break}this.dispatchEvent(RI)}function bbe(r){switch(this._trackPointer(r),this._pointers.length){case 1:this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(r.pageX,r.pageY));break;default:const e=this._getSecondPointerPosition(r),i=r.pageX-e.x,n=r.pageY-e.y;this._touchZoomDistanceEnd=Math.sqrt(i*i+n*n);const s=(r.pageX+e.x)/2,o=(r.pageY+e.y)/2;this._panEnd.copy(this._getMouseOnScreen(s,o));break}}function xbe(r){switch(this._pointers.length){case 0:this.state=Xn.NONE;break;case 1:this.state=Xn.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(r.pageX,r.pageY)),this._movePrev.copy(this._moveCurr);break;case 2:this.state=Xn.TOUCH_ZOOM_PAN;for(let e=0;e<this._pointers.length;e++)if(this._pointers[e].pointerId!==r.pointerId){const i=this._pointerPositions[this._pointers[e].pointerId];this._moveCurr.copy(this._getMouseOnCircle(i.x,i.y)),this._movePrev.copy(this._moveCurr);break}break}this.dispatchEvent(II)}const Y7={type:"change"},LI={type:"start"},J7={type:"end"},J_=new gx,Z7=new uc,_be=Math.cos(70*OS.DEG2RAD),ga=new ot,$o=2*Math.PI,ls={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},DI=1e-6;class Ebe extends Wx{constructor(e,i=null){super(e,i),this.state=ls.NONE,this.enabled=!0,this.target=new ot,this.cursor=new ot,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Ua.ROTATE,MIDDLE:Ua.DOLLY,RIGHT:Ua.PAN},this.touches={ONE:wu.ROTATE,TWO:wu.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new ot,this._lastQuaternion=new Hc,this._lastTargetPosition=new ot,this._quat=new Hc().setFromUnitVectors(e.up,new ot(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new bk,this._sphericalDelta=new bk,this._scale=1,this._panOffset=new ot,this._rotateStart=new Gi,this._rotateEnd=new Gi,this._rotateDelta=new Gi,this._panStart=new Gi,this._panEnd=new Gi,this._panDelta=new Gi,this._dollyStart=new Gi,this._dollyEnd=new Gi,this._dollyDelta=new Gi,this._dollyDirection=new ot,this._mouse=new Gi,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=Cbe.bind(this),this._onPointerDown=wbe.bind(this),this._onPointerUp=Sbe.bind(this),this._onContextMenu=Lbe.bind(this),this._onMouseWheel=Rbe.bind(this),this._onKeyDown=Ibe.bind(this),this._onTouchStart=Bbe.bind(this),this._onTouchMove=Nbe.bind(this),this._onMouseDown=Tbe.bind(this),this._onMouseMove=Mbe.bind(this),this._interceptControlDown=Dbe.bind(this),this._interceptControlUp=Obe.bind(this),this.domElement!==null&&this.connect(),this.update()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(Y7),this.update(),this.state=ls.NONE}update(e=null){const i=this.object.position;ga.copy(i).sub(this.target),ga.applyQuaternion(this._quat),this._spherical.setFromVector3(ga),this.autoRotate&&this.state===ls.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let n=this.minAzimuthAngle,s=this.maxAzimuthAngle;isFinite(n)&&isFinite(s)&&(n<-Math.PI?n+=$o:n>Math.PI&&(n-=$o),s<-Math.PI?s+=$o:s>Math.PI&&(s-=$o),n<=s?this._spherical.theta=Math.max(n,Math.min(s,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(n+s)/2?Math.max(n,this._spherical.theta):Math.min(s,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let o=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const l=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),o=l!=this._spherical.radius}if(ga.setFromSpherical(this._spherical),ga.applyQuaternion(this._quatInverse),i.copy(this.target).add(ga),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let l=null;if(this.object.isPerspectiveCamera){const u=ga.length();l=this._clampDistance(u*this._scale);const c=u-l;this.object.position.addScaledVector(this._dollyDirection,c),this.object.updateMatrixWorld(),o=!!c}else if(this.object.isOrthographicCamera){const u=new ot(this._mouse.x,this._mouse.y,0);u.unproject(this.object);const c=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),o=c!==this.object.zoom;const h=new ot(this._mouse.x,this._mouse.y,0);h.unproject(this.object),this.object.position.sub(h).add(u),this.object.updateMatrixWorld(),l=ga.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;l!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(l).add(this.object.position):(J_.origin.copy(this.object.position),J_.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(J_.direction))<_be?this.object.lookAt(this.target):(Z7.setFromNormalAndCoplanarPoint(this.object.up,this.target),J_.intersectPlane(Z7,this.target))))}else if(this.object.isOrthographicCamera){const l=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),l!==this.object.zoom&&(this.object.updateProjectionMatrix(),o=!0)}return this._scale=1,this._performCursorZoom=!1,o||this._lastPosition.distanceToSquared(this.object.position)>DI||8*(1-this._lastQuaternion.dot(this.object.quaternion))>DI||this._lastTargetPosition.distanceToSquared(this.target)>DI?(this.dispatchEvent(Y7),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?$o/60*this.autoRotateSpeed*e:$o/60/60*this.autoRotateSpeed}_getZoomScale(e){const i=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*i)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,i){ga.setFromMatrixColumn(i,0),ga.multiplyScalar(-e),this._panOffset.add(ga)}_panUp(e,i){this.screenSpacePanning===!0?ga.setFromMatrixColumn(i,1):(ga.setFromMatrixColumn(i,0),ga.crossVectors(this.object.up,ga)),ga.multiplyScalar(e),this._panOffset.add(ga)}_pan(e,i){const n=this.domElement;if(this.object.isPerspectiveCamera){const s=this.object.position;ga.copy(s).sub(this.target);let o=ga.length();o*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*o/n.clientHeight,this.object.matrix),this._panUp(2*i*o/n.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/n.clientWidth,this.object.matrix),this._panUp(i*(this.object.top-this.object.bottom)/this.object.zoom/n.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,i){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const n=this.domElement.getBoundingClientRect(),s=e-n.left,o=i-n.top,l=n.width,u=n.height;this._mouse.x=s/l*2-1,this._mouse.y=-(o/u)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const i=this.domElement;this._rotateLeft($o*this._rotateDelta.x/i.clientHeight),this._rotateUp($o*this._rotateDelta.y/i.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let i=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this._rotateUp($o*this.rotateSpeed/this.domElement.clientHeight):this._pan(0,this.keyPanSpeed),i=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this._rotateUp(-$o*this.rotateSpeed/this.domElement.clientHeight):this._pan(0,-this.keyPanSpeed),i=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this._rotateLeft($o*this.rotateSpeed/this.domElement.clientHeight):this._pan(this.keyPanSpeed,0),i=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this._rotateLeft(-$o*this.rotateSpeed/this.domElement.clientHeight):this._pan(-this.keyPanSpeed,0),i=!0;break}i&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const i=this._getSecondPointerPosition(e),n=.5*(e.pageX+i.x),s=.5*(e.pageY+i.y);this._rotateStart.set(n,s)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const i=this._getSecondPointerPosition(e),n=.5*(e.pageX+i.x),s=.5*(e.pageY+i.y);this._panStart.set(n,s)}}_handleTouchStartDolly(e){const i=this._getSecondPointerPosition(e),n=e.pageX-i.x,s=e.pageY-i.y,o=Math.sqrt(n*n+s*s);this._dollyStart.set(0,o)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const n=this._getSecondPointerPosition(e),s=.5*(e.pageX+n.x),o=.5*(e.pageY+n.y);this._rotateEnd.set(s,o)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const i=this.domElement;this._rotateLeft($o*this._rotateDelta.x/i.clientHeight),this._rotateUp($o*this._rotateDelta.y/i.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const i=this._getSecondPointerPosition(e),n=.5*(e.pageX+i.x),s=.5*(e.pageY+i.y);this._panEnd.set(n,s)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const i=this._getSecondPointerPosition(e),n=e.pageX-i.x,s=e.pageY-i.y,o=Math.sqrt(n*n+s*s);this._dollyEnd.set(0,o),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const l=(e.pageX+i.x)*.5,u=(e.pageY+i.y)*.5;this._updateZoomParameters(l,u)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let i=0;i<this._pointers.length;i++)if(this._pointers[i]==e.pointerId){this._pointers.splice(i,1);return}}_isTrackingPointer(e){for(let i=0;i<this._pointers.length;i++)if(this._pointers[i]==e.pointerId)return!0;return!1}_trackPointer(e){let i=this._pointerPositions[e.pointerId];i===void 0&&(i=new Gi,this._pointerPositions[e.pointerId]=i),i.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const i=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[i]}_customWheelEvent(e){const i=e.deltaMode,n={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(i){case 1:n.deltaY*=16;break;case 2:n.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(n.deltaY*=10),n}}function wbe(r){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(r.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(r)&&(this._addPointer(r),r.pointerType==="touch"?this._onTouchStart(r):this._onMouseDown(r)))}function Cbe(r){this.enabled!==!1&&(r.pointerType==="touch"?this._onTouchMove(r):this._onMouseMove(r))}function Sbe(r){switch(this._removePointer(r),this._pointers.length){case 0:this.domElement.releasePointerCapture(r.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(J7),this.state=ls.NONE;break;case 1:const e=this._pointers[0],i=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:i.x,pageY:i.y});break}}function Tbe(r){let e;switch(r.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case Ua.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(r),this.state=ls.DOLLY;break;case Ua.ROTATE:if(r.ctrlKey||r.metaKey||r.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(r),this.state=ls.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(r),this.state=ls.ROTATE}break;case Ua.PAN:if(r.ctrlKey||r.metaKey||r.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(r),this.state=ls.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(r),this.state=ls.PAN}break;default:this.state=ls.NONE}this.state!==ls.NONE&&this.dispatchEvent(LI)}function Mbe(r){switch(this.state){case ls.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(r);break;case ls.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(r);break;case ls.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(r);break}}function Rbe(r){this.enabled===!1||this.enableZoom===!1||this.state!==ls.NONE||(r.preventDefault(),this.dispatchEvent(LI),this._handleMouseWheel(this._customWheelEvent(r)),this.dispatchEvent(J7))}function Ibe(r){this.enabled===!1||this.enablePan===!1||this._handleKeyDown(r)}function Bbe(r){switch(this._trackPointer(r),this._pointers.length){case 1:switch(this.touches.ONE){case wu.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(r),this.state=ls.TOUCH_ROTATE;break;case wu.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(r),this.state=ls.TOUCH_PAN;break;default:this.state=ls.NONE}break;case 2:switch(this.touches.TWO){case wu.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(r),this.state=ls.TOUCH_DOLLY_PAN;break;case wu.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(r),this.state=ls.TOUCH_DOLLY_ROTATE;break;default:this.state=ls.NONE}break;default:this.state=ls.NONE}this.state!==ls.NONE&&this.dispatchEvent(LI)}function Nbe(r){switch(this._trackPointer(r),this.state){case ls.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(r),this.update();break;case ls.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(r),this.update();break;case ls.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(r),this.update();break;case ls.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(r),this.update();break;default:this.state=ls.NONE}}function Lbe(r){this.enabled!==!1&&r.preventDefault()}function Dbe(r){r.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function Obe(r){r.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}const Pbe={type:"change"},$7=1e-6,e9=new Hc;class kbe extends Wx{constructor(e,i=null){super(e,i),this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1,this._moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this._moveVector=new ot(0,0,0),this._rotationVector=new ot(0,0,0),this._lastQuaternion=new Hc,this._lastPosition=new ot,this._status=0,this._onKeyDown=Fbe.bind(this),this._onKeyUp=Ube.bind(this),this._onPointerMove=jbe.bind(this),this._onPointerDown=zbe.bind(this),this._onPointerUp=Gbe.bind(this),this._onPointerCancel=Vbe.bind(this),this._onContextMenu=Hbe.bind(this),i!==null&&this.connect()}connect(){window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu)}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu)}dispose(){this.disconnect()}update(e){if(this.enabled===!1)return;const i=this.object,n=e*this.movementSpeed,s=e*this.rollSpeed;i.translateX(this._moveVector.x*n),i.translateY(this._moveVector.y*n),i.translateZ(this._moveVector.z*n),e9.set(this._rotationVector.x*s,this._rotationVector.y*s,this._rotationVector.z*s,1).normalize(),i.quaternion.multiply(e9),(this._lastPosition.distanceToSquared(i.position)>$7||8*(1-this._lastQuaternion.dot(i.quaternion))>$7)&&(this.dispatchEvent(Pbe),this._lastQuaternion.copy(i.quaternion),this._lastPosition.copy(i.position))}_updateMovementVector(){const e=this._moveState.forward||this.autoForward&&!this._moveState.back?1:0;this._moveVector.x=-this._moveState.left+this._moveState.right,this._moveVector.y=-this._moveState.down+this._moveState.up,this._moveVector.z=-e+this._moveState.back}_updateRotationVector(){this._rotationVector.x=-this._moveState.pitchDown+this._moveState.pitchUp,this._rotationVector.y=-this._moveState.yawRight+this._moveState.yawLeft,this._rotationVector.z=-this._moveState.rollRight+this._moveState.rollLeft}_getContainerDimensions(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}}}function Fbe(r){if(!(r.altKey||this.enabled===!1)){switch(r.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this._moveState.forward=1;break;case"KeyS":this._moveState.back=1;break;case"KeyA":this._moveState.left=1;break;case"KeyD":this._moveState.right=1;break;case"KeyR":this._moveState.up=1;break;case"KeyF":this._moveState.down=1;break;case"ArrowUp":this._moveState.pitchUp=1;break;case"ArrowDown":this._moveState.pitchDown=1;break;case"ArrowLeft":this._moveState.yawLeft=1;break;case"ArrowRight":this._moveState.yawRight=1;break;case"KeyQ":this._moveState.rollLeft=1;break;case"KeyE":this._moveState.rollRight=1;break}this._updateMovementVector(),this._updateRotationVector()}}function Ube(r){if(this.enabled!==!1){switch(r.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this._moveState.forward=0;break;case"KeyS":this._moveState.back=0;break;case"KeyA":this._moveState.left=0;break;case"KeyD":this._moveState.right=0;break;case"KeyR":this._moveState.up=0;break;case"KeyF":this._moveState.down=0;break;case"ArrowUp":this._moveState.pitchUp=0;break;case"ArrowDown":this._moveState.pitchDown=0;break;case"ArrowLeft":this._moveState.yawLeft=0;break;case"ArrowRight":this._moveState.yawRight=0;break;case"KeyQ":this._moveState.rollLeft=0;break;case"KeyE":this._moveState.rollRight=0;break}this._updateMovementVector(),this._updateRotationVector()}}function zbe(r){if(this.enabled!==!1)if(this.dragToLook)this._status++;else{switch(r.button){case 0:this._moveState.forward=1;break;case 2:this._moveState.back=1;break}this._updateMovementVector()}}function jbe(r){if(this.enabled!==!1&&(!this.dragToLook||this._status>0)){const e=this._getContainerDimensions(),i=e.size[0]/2,n=e.size[1]/2;this._moveState.yawLeft=-(r.pageX-e.offset[0]-i)/i,this._moveState.pitchDown=(r.pageY-e.offset[1]-n)/n,this._updateRotationVector()}}function Gbe(r){if(this.enabled!==!1){if(this.dragToLook)this._status--,this._moveState.yawLeft=this._moveState.pitchDown=0;else{switch(r.button){case 0:this._moveState.forward=0;break;case 2:this._moveState.back=0;break}this._updateMovementVector()}this._updateRotationVector()}}function Vbe(){this.enabled!==!1&&(this.dragToLook?(this._status=0,this._moveState.yawLeft=this._moveState.pitchDown=0):(this._moveState.forward=0,this._moveState.back=0,this._updateMovementVector()),this._updateRotationVector())}function Hbe(r){this.enabled!==!1&&r.preventDefault()}const Wbe={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};class Z_{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const Qbe=new nT(-1,1,1,-1,0,1);class qbe extends Vo{constructor(){super(),this.setAttribute("position",new pa([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new pa([0,2,0,0,2,0],2))}}const Xbe=new qbe;class Kbe{constructor(e){this._mesh=new za(Xbe,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,Qbe)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class Ybe extends Z_{constructor(e,i){super(),this.textureID=i!==void 0?i:"tDiffuse",e instanceof Wc?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=y4.clone(e.uniforms),this.material=new Wc({name:e.name!==void 0?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new Kbe(this.material)}render(e,i,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(i),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class t9 extends Z_{constructor(e,i){super(),this.scene=e,this.camera=i,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,i,n){const s=e.getContext(),o=e.state;o.buffers.color.setMask(!1),o.buffers.depth.setMask(!1),o.buffers.color.setLocked(!0),o.buffers.depth.setLocked(!0);let l,u;this.inverse?(l=0,u=1):(l=1,u=0),o.buffers.stencil.setTest(!0),o.buffers.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),o.buffers.stencil.setFunc(s.ALWAYS,l,4294967295),o.buffers.stencil.setClear(u),o.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),o.buffers.color.setLocked(!1),o.buffers.depth.setLocked(!1),o.buffers.color.setMask(!0),o.buffers.depth.setMask(!0),o.buffers.stencil.setLocked(!1),o.buffers.stencil.setFunc(s.EQUAL,1,4294967295),o.buffers.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),o.buffers.stencil.setLocked(!0)}}class Jbe extends Z_{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class Zbe{constructor(e,i){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),i===void 0){const n=e.getSize(new Gi);this._width=n.width,this._height=n.height,i=new Yh(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:xm}),i.texture.name="EffectComposer.rt1"}else this._width=i.width,this._height=i.height;this.renderTarget1=i,this.renderTarget2=i.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new Ybe(Wbe),this.copyPass.material.blending=Tu,this.clock=new mk}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,i){this.passes.splice(i,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const i=this.passes.indexOf(e);i!==-1&&this.passes.splice(i,1)}isLastEnabledPass(e){for(let i=e+1;i<this.passes.length;i++)if(this.passes[i].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const i=this.renderer.getRenderTarget();let n=!1;for(let s=0,o=this.passes.length;s<o;s++){const l=this.passes[s];if(l.enabled!==!1){if(l.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(s),l.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),l.needsSwap){if(n){const u=this.renderer.getContext(),c=this.renderer.state.buffers.stencil;c.setFunc(u.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),c.setFunc(u.EQUAL,1,4294967295)}this.swapBuffers()}t9!==void 0&&(l instanceof t9?n=!0:l instanceof Jbe&&(n=!1))}}this.renderer.setRenderTarget(i)}reset(e){if(e===void 0){const i=this.renderer.getSize(new Gi);this._pixelRatio=this.renderer.getPixelRatio(),this._width=i.width,this._height=i.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,i){this._width=e,this._height=i;const n=this._width*this._pixelRatio,s=this._height*this._pixelRatio;this.renderTarget1.setSize(n,s),this.renderTarget2.setSize(n,s);for(let o=0;o<this.passes.length;o++)this.passes[o].setSize(n,s)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class $be extends Z_{constructor(e,i,n=null,s=null,o=null){super(),this.scene=e,this.camera=i,this.overrideMaterial=n,this.clearColor=s,this.clearAlpha=o,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new Sn}render(e,i,n){const s=e.autoClear;e.autoClear=!1;let o,l;this.overrideMaterial!==null&&(l=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor,e.getClearAlpha())),this.clearAlpha!==null&&(o=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),this.clearDepth==!0&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),this.clear===!0&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor!==null&&e.setClearColor(this._oldClearColor),this.clearAlpha!==null&&e.setClearAlpha(o),this.overrideMaterial!==null&&(this.scene.overrideMaterial=l),e.autoClear=s}}var ph=Object.freeze({Linear:Object.freeze({None:function(r){return r},In:function(r){return r},Out:function(r){return r},InOut:function(r){return r}}),Quadratic:Object.freeze({In:function(r){return r*r},Out:function(r){return r*(2-r)},InOut:function(r){return(r*=2)<1?.5*r*r:-.5*(--r*(r-2)-1)}}),Cubic:Object.freeze({In:function(r){return r*r*r},Out:function(r){return--r*r*r+1},InOut:function(r){return(r*=2)<1?.5*r*r*r:.5*((r-=2)*r*r+2)}}),Quartic:Object.freeze({In:function(r){return r*r*r*r},Out:function(r){return 1- --r*r*r*r},InOut:function(r){return(r*=2)<1?.5*r*r*r*r:-.5*((r-=2)*r*r*r-2)}}),Quintic:Object.freeze({In:function(r){return r*r*r*r*r},Out:function(r){return--r*r*r*r*r+1},InOut:function(r){return(r*=2)<1?.5*r*r*r*r*r:.5*((r-=2)*r*r*r*r+2)}}),Sinusoidal:Object.freeze({In:function(r){return 1-Math.sin((1-r)*Math.PI/2)},Out:function(r){return Math.sin(r*Math.PI/2)},InOut:function(r){return .5*(1-Math.sin(Math.PI*(.5-r)))}}),Exponential:Object.freeze({In:function(r){return r===0?0:Math.pow(1024,r-1)},Out:function(r){return r===1?1:1-Math.pow(2,-10*r)},InOut:function(r){return r===0?0:r===1?1:(r*=2)<1?.5*Math.pow(1024,r-1):.5*(-Math.pow(2,-10*(r-1))+2)}}),Circular:Object.freeze({In:function(r){return 1-Math.sqrt(1-r*r)},Out:function(r){return Math.sqrt(1- --r*r)},InOut:function(r){return(r*=2)<1?-.5*(Math.sqrt(1-r*r)-1):.5*(Math.sqrt(1-(r-=2)*r)+1)}}),Elastic:Object.freeze({In:function(r){return r===0?0:r===1?1:-Math.pow(2,10*(r-1))*Math.sin((r-1.1)*5*Math.PI)},Out:function(r){return r===0?0:r===1?1:Math.pow(2,-10*r)*Math.sin((r-.1)*5*Math.PI)+1},InOut:function(r){return r===0?0:r===1?1:(r*=2,r<1?-.5*Math.pow(2,10*(r-1))*Math.sin((r-1.1)*5*Math.PI):.5*Math.pow(2,-10*(r-1))*Math.sin((r-1.1)*5*Math.PI)+1)}}),Back:Object.freeze({In:function(r){var e=1.70158;return r===1?1:r*r*((e+1)*r-e)},Out:function(r){var e=1.70158;return r===0?0:--r*r*((e+1)*r+e)+1},InOut:function(r){var e=2.5949095;return(r*=2)<1?.5*(r*r*((e+1)*r-e)):.5*((r-=2)*r*((e+1)*r+e)+2)}}),Bounce:Object.freeze({In:function(r){return 1-ph.Bounce.Out(1-r)},Out:function(r){return r<1/2.75?7.5625*r*r:r<2/2.75?7.5625*(r-=1.5/2.75)*r+.75:r<2.5/2.75?7.5625*(r-=2.25/2.75)*r+.9375:7.5625*(r-=2.625/2.75)*r+.984375},InOut:function(r){return r<.5?ph.Bounce.In(r*2)*.5:ph.Bounce.Out(r*2-1)*.5+.5}}),generatePow:function(r){return r===void 0&&(r=4),r=r<Number.EPSILON?Number.EPSILON:r,r=r>1e4?1e4:r,{In:function(e){return Math.pow(e,r)},Out:function(e){return 1-Math.pow(1-e,r)},InOut:function(e){return e<.5?Math.pow(e*2,r)/2:(1-Math.pow(2-e*2,r))/2+.5}}}}),qy=function(){return performance.now()},OI=function(){function r(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this._tweens={},this._tweensAddedDuringUpdate={},this.add.apply(this,e)}return r.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map(function(i){return e._tweens[i]})},r.prototype.removeAll=function(){this._tweens={}},r.prototype.add=function(){for(var e,i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];for(var s=0,o=i;s<o.length;s++){var l=o[s];(e=l._group)===null||e===void 0||e.remove(l),l._group=this,this._tweens[l.getId()]=l,this._tweensAddedDuringUpdate[l.getId()]=l}},r.prototype.remove=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];for(var n=0,s=e;n<s.length;n++){var o=s[n];o._group=void 0,delete this._tweens[o.getId()],delete this._tweensAddedDuringUpdate[o.getId()]}},r.prototype.allStopped=function(){return this.getAll().every(function(e){return!e.isPlaying()})},r.prototype.update=function(e,i){e===void 0&&(e=qy()),i===void 0&&(i=!0);var n=Object.keys(this._tweens);if(n.length!==0)for(;n.length>0;){this._tweensAddedDuringUpdate={};for(var s=0;s<n.length;s++){var o=this._tweens[n[s]],l=!i;o&&o.update(e,l)===!1&&!i&&this.remove(o)}n=Object.keys(this._tweensAddedDuringUpdate)}},r}(),PI={Linear:function(r,e){var i=r.length-1,n=i*e,s=Math.floor(n),o=PI.Utils.Linear;return e<0?o(r[0],r[1],n):e>1?o(r[i],r[i-1],i-n):o(r[s],r[s+1>i?i:s+1],n-s)},Utils:{Linear:function(r,e,i){return(e-r)*i+r}}},i9=function(){function r(){}return r.nextId=function(){return r._nextId++},r._nextId=0,r}(),kI=new OI,$_=function(){function r(e,i){this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=ph.Linear.None,this._interpolationFunction=PI.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=i9.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1,this._object=e,typeof i=="object"?(this._group=i,i.add(this)):i===!0&&(this._group=kI,kI.add(this))}return r.prototype.getId=function(){return this._id},r.prototype.isPlaying=function(){return this._isPlaying},r.prototype.isPaused=function(){return this._isPaused},r.prototype.getDuration=function(){return this._duration},r.prototype.to=function(e,i){if(i===void 0&&(i=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=e,this._propertiesAreSetUp=!1,this._duration=i<0?0:i,this},r.prototype.duration=function(e){return e===void 0&&(e=1e3),this._duration=e<0?0:e,this},r.prototype.dynamic=function(e){return e===void 0&&(e=!1),this._isDynamic=e,this},r.prototype.start=function(e,i){if(e===void 0&&(e=qy()),i===void 0&&(i=!1),this._isPlaying)return this;if(this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var n in this._valuesStartRepeat)this._swapEndStartRepeatValues(n),this._valuesStart[n]=this._valuesStartRepeat[n]}if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=e,this._startTime+=this._delayTime,!this._propertiesAreSetUp||i){if(this._propertiesAreSetUp=!0,!this._isDynamic){var s={};for(var o in this._valuesEnd)s[o]=this._valuesEnd[o];this._valuesEnd=s}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,i)}return this},r.prototype.startFromCurrentValues=function(e){return this.start(e,!0)},r.prototype._setupProperties=function(e,i,n,s,o){for(var l in n){var u=e[l],c=Array.isArray(u),h=c?"array":typeof u,p=!c&&Array.isArray(n[l]);if(!(h==="undefined"||h==="function")){if(p){var f=n[l];if(f.length===0)continue;for(var g=[u],m=0,y=f.length;m<y;m+=1){var b=this._handleRelativeValue(u,f[m]);if(isNaN(b)){p=!1,console.warn("Found invalid interpolation list. Skipping.");break}g.push(b)}p&&(n[l]=g)}if((h==="object"||c)&&u&&!p){i[l]=c?[]:{};var v=u;for(var _ in v)i[l][_]=v[_];s[l]=c?[]:{};var f=n[l];if(!this._isDynamic){var C={};for(var _ in f)C[_]=f[_];n[l]=f=C}this._setupProperties(v,i[l],f,s[l],o)}else(typeof i[l]>"u"||o)&&(i[l]=u),c||(i[l]*=1),p?s[l]=n[l].slice().reverse():s[l]=i[l]||0}}},r.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},r.prototype.end=function(){return this._goToEnd=!0,this.update(this._startTime+this._duration),this},r.prototype.pause=function(e){return e===void 0&&(e=qy()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=e,this)},r.prototype.resume=function(e){return e===void 0&&(e=qy()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this)},r.prototype.stopChainedTweens=function(){for(var e=0,i=this._chainedTweens.length;e<i;e++)this._chainedTweens[e].stop();return this},r.prototype.group=function(e){return e?(e.add(this),this):(console.warn("tween.group() without args has been removed, use group.add(tween) instead."),this)},r.prototype.remove=function(){var e;return(e=this._group)===null||e===void 0||e.remove(this),this},r.prototype.delay=function(e){return e===void 0&&(e=0),this._delayTime=e,this},r.prototype.repeat=function(e){return e===void 0&&(e=0),this._initialRepeat=e,this._repeat=e,this},r.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},r.prototype.yoyo=function(e){return e===void 0&&(e=!1),this._yoyo=e,this},r.prototype.easing=function(e){return e===void 0&&(e=ph.Linear.None),this._easingFunction=e,this},r.prototype.interpolation=function(e){return e===void 0&&(e=PI.Linear),this._interpolationFunction=e,this},r.prototype.chain=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return this._chainedTweens=e,this},r.prototype.onStart=function(e){return this._onStartCallback=e,this},r.prototype.onEveryStart=function(e){return this._onEveryStartCallback=e,this},r.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},r.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},r.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},r.prototype.onStop=function(e){return this._onStopCallback=e,this},r.prototype.update=function(e,i){var n=this,s;if(e===void 0&&(e=qy()),i===void 0&&(i=r.autoStartOnUpdate),this._isPaused)return!0;var o;if(!this._goToEnd&&!this._isPlaying)if(i)this.start(e,!0);else return!1;if(this._goToEnd=!1,e<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),this._onEveryStartCallbackFired===!1&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0);var l=e-this._startTime,u=this._duration+((s=this._repeatDelayTime)!==null&&s!==void 0?s:this._delayTime),c=this._duration+this._repeat*u,h=function(){if(n._duration===0||l>c)return 1;var b=Math.trunc(l/u),v=l-b*u,_=Math.min(v/n._duration,1);return _===0&&l===n._duration?1:_},p=h(),f=this._easingFunction(p);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,f),this._onUpdateCallback&&this._onUpdateCallback(this._object,p),this._duration===0||l>=this._duration)if(this._repeat>0){var g=Math.min(Math.trunc((l-this._duration)/u)+1,this._repeat);isFinite(this._repeat)&&(this._repeat-=g);for(o in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[o]=="string"&&(this._valuesStartRepeat[o]=this._valuesStartRepeat[o]+parseFloat(this._valuesEnd[o])),this._yoyo&&this._swapEndStartRepeatValues(o),this._valuesStart[o]=this._valuesStartRepeat[o];return this._yoyo&&(this._reversed=!this._reversed),this._startTime+=u*g,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var m=0,y=this._chainedTweens.length;m<y;m++)this._chainedTweens[m].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},r.prototype._updateProperties=function(e,i,n,s){for(var o in n)if(i[o]!==void 0){var l=i[o]||0,u=n[o],c=Array.isArray(e[o]),h=Array.isArray(u),p=!c&&h;p?e[o]=this._interpolationFunction(u,s):typeof u=="object"&&u?this._updateProperties(e[o],l,u,s):(u=this._handleRelativeValue(l,u),typeof u=="number"&&(e[o]=l+(u-l)*s))}},r.prototype._handleRelativeValue=function(e,i){return typeof i!="string"?i:i.charAt(0)==="+"||i.charAt(0)==="-"?e+parseFloat(i):parseFloat(i)},r.prototype._swapEndStartRepeatValues=function(e){var i=this._valuesStartRepeat[e],n=this._valuesEnd[e];typeof n=="string"?this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(n):this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=i},r.autoStartOnUpdate=!1,r}();i9.nextId;var tu=kI;tu.getAll.bind(tu),tu.removeAll.bind(tu),tu.add.bind(tu),tu.remove.bind(tu),tu.update.bind(tu);function exe(r,e){e===void 0&&(e={});var i=e.insertAt;if(!(typeof document>"u")){var n=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css",i==="top"&&n.firstChild?n.insertBefore(s,n.firstChild):n.appendChild(s),s.styleSheet?s.styleSheet.cssText=r:s.appendChild(document.createTextNode(r))}}var txe=`.scene-nav-info {
  bottom: 5px;
  width: 100%;
  text-align: center;
  color: slategrey;
  opacity: 0.7;
  font-size: 10px;
}

.scene-tooltip {
  top: 0;
  color: lavender;
  font-size: 15px;
}

.scene-nav-info, .scene-tooltip {
  position: absolute;
  font-family: sans-serif;
  pointer-events: none;
  user-select: none;
}

.scene-container canvas:focus {
  outline: none;
}`;exe(txe);function FI(r,e){(e==null||e>r.length)&&(e=r.length);for(var i=0,n=Array(e);i<e;i++)n[i]=r[i];return n}function ixe(r){if(Array.isArray(r))return r}function rxe(r){if(Array.isArray(r))return FI(r)}function nxe(r,e,i){return(e=hxe(e))in r?Object.defineProperty(r,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[e]=i,r}function sxe(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function axe(r,e){var i=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(i!=null){var n,s,o,l,u=[],c=!0,h=!1;try{if(o=(i=i.call(r)).next,e!==0)for(;!(c=(n=o.call(i)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(p){h=!0,s=p}finally{try{if(!c&&i.return!=null&&(l=i.return(),Object(l)!==l))return}finally{if(h)throw s}}return u}}function oxe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function lxe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function cxe(r,e){return ixe(r)||axe(r,e)||r9(r,e)||oxe()}function Xy(r){return rxe(r)||sxe(r)||r9(r)||lxe()}function uxe(r,e){if(typeof r!="object"||!r)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var n=i.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function hxe(r){var e=uxe(r,"string");return typeof e=="symbol"?e:e+""}function r9(r,e){if(r){if(typeof r=="string")return FI(r,e);var i={}.toString.call(r).slice(8,-1);return i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set"?Array.from(r):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?FI(r,e):void 0}}var Ss=window.THREE?window.THREE:{WebGLRenderer:ore,Scene:lre,PerspectiveCamera:kl,Raycaster:yk,SRGBColorSpace:jo,TextureLoader:Bre,Vector2:Gi,Vector3:ot,Box3:Ap,Color:Sn,Mesh:za,SphereGeometry:Hx,MeshBasicMaterial:rd,BackSide:bo,Clock:mk},n9=Rp({props:{width:{default:window.innerWidth,onChange:function(r,e,i){isNaN(r)&&(e.width=i)}},height:{default:window.innerHeight,onChange:function(r,e,i){isNaN(r)&&(e.height=i)}},backgroundColor:{default:"#000011"},backgroundImageUrl:{},onBackgroundImageLoaded:{},showNavInfo:{default:!0},skyRadius:{default:5e4},objects:{default:[]},lights:{default:[]},enablePointerInteraction:{default:!0,onChange:function(r,e){e.hoverObj=null,e.toolTipElem&&(e.toolTipElem.innerHTML="")},triggerUpdate:!1},lineHoverPrecision:{default:1,triggerUpdate:!1},hoverOrderComparator:{default:function(){return-1},triggerUpdate:!1},hoverFilter:{default:function(){return!0},triggerUpdate:!1},tooltipContent:{triggerUpdate:!1},hoverDuringDrag:{default:!1,triggerUpdate:!1},clickAfterDrag:{default:!1,triggerUpdate:!1},onHover:{default:function(){},triggerUpdate:!1},onClick:{default:function(){},triggerUpdate:!1},onRightClick:{triggerUpdate:!1}},methods:{tick:function(r){if(r.initialised){if(r.controls.update&&r.controls.update(Math.min(1,r.clock.getDelta())),r.postProcessingComposer?r.postProcessingComposer.render():r.renderer.render(r.scene,r.camera),r.extraRenderers.forEach(function(s){return s.render(r.scene,r.camera)}),r.enablePointerInteraction){var e=null;if(r.hoverDuringDrag||!r.isPointerDragging){var i=this.intersectingObjects(r.pointerPos.x,r.pointerPos.y).filter(function(s){return r.hoverFilter(s.object)}).sort(function(s,o){return r.hoverOrderComparator(s.object,o.object)}),n=i.length?i[0]:null;e=n?n.object:null,r.intersectionPoint=n?n.point:null}e!==r.hoverObj&&(r.onHover(e,r.hoverObj),r.toolTipElem.innerHTML=e&&gr(r.tooltipContent)(e)||"",r.hoverObj=e)}r.tweenGroup.update()}return this},getPointerPos:function(r){var e=r.pointerPos,i=e.x,n=e.y;return{x:i,y:n}},cameraPosition:function(r,e,i,n){var s=r.camera;if(e&&r.initialised){var o=e,l=i||{x:0,y:0,z:0};if(!n)h(o),p(l);else{var u=Object.assign({},s.position),c=f();r.tweenGroup.add(new $_(u).to(o,n).easing(ph.Quadratic.Out).onUpdate(h).start()),r.tweenGroup.add(new $_(c).to(l,n/3).easing(ph.Quadratic.Out).onUpdate(p).start())}return this}return Object.assign({},s.position,{lookAt:f()});function h(g){var m=g.x,y=g.y,b=g.z;m!==void 0&&(s.position.x=m),y!==void 0&&(s.position.y=y),b!==void 0&&(s.position.z=b)}function p(g){var m=new Ss.Vector3(g.x,g.y,g.z);r.controls.target?r.controls.target=m:s.lookAt(m)}function f(){return Object.assign(new Ss.Vector3(0,0,-1e3).applyQuaternion(s.quaternion).add(s.position))}},zoomToFit:function(r){for(var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:10,n=arguments.length,s=new Array(n>3?n-3:0),o=3;o<n;o++)s[o-3]=arguments[o];return this.fitToBbox(this.getBbox.apply(this,s),e,i)},fitToBbox:function(r,e){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:10,s=r.camera;if(e){var o=new Ss.Vector3(0,0,0),l=Math.max.apply(Math,Xy(Object.entries(e).map(function(g){var m=cxe(g,2),y=m[0],b=m[1];return Math.max.apply(Math,Xy(b.map(function(v){return Math.abs(o[y]-v)})))})))*2,u=(1-n*2/r.height)*s.fov,c=l/Math.atan(u*Math.PI/180),h=c/s.aspect,p=Math.max(c,h);if(p>0){var f=o.clone().sub(s.position).normalize().multiplyScalar(-p);this.cameraPosition(f,o,i)}}return this},getBbox:function(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return!0},i=new Ss.Box3(new Ss.Vector3(0,0,0),new Ss.Vector3(0,0,0)),n=r.objects.filter(e);return n.length?(n.forEach(function(s){return i.expandByObject(s)}),Object.assign.apply(Object,Xy(["x","y","z"].map(function(s){return nxe({},s,[i.min[s],i.max[s]])})))):null},getScreenCoords:function(r,e,i,n){var s=new Ss.Vector3(e,i,n);return s.project(this.camera()),{x:(s.x+1)*r.width/2,y:-(s.y-1)*r.height/2}},getSceneCoords:function(r,e,i){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,s=new Ss.Vector2(e/r.width*2-1,-(i/r.height)*2+1),o=new Ss.Raycaster;return o.setFromCamera(s,r.camera),Object.assign({},o.ray.at(n,new Ss.Vector3))},intersectingObjects:function(r,e,i){var n=new Ss.Vector2(e/r.width*2-1,-(i/r.height)*2+1),s=new Ss.Raycaster;return s.params.Line.threshold=r.lineHoverPrecision,s.setFromCamera(n,r.camera),s.intersectObjects(r.objects,!0)},renderer:function(r){return r.renderer},scene:function(r){return r.scene},camera:function(r){return r.camera},postProcessingComposer:function(r){return r.postProcessingComposer},controls:function(r){return r.controls},tbControls:function(r){return r.controls}},stateInit:function(){return{scene:new Ss.Scene,camera:new Ss.PerspectiveCamera,clock:new Ss.Clock,tweenGroup:new OI}},init:function(r,e){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=i.controlType,s=n===void 0?"trackball":n,o=i.useWebGPU,l=o===void 0?!1:o,u=i.rendererConfig,c=u===void 0?{}:u,h=i.extraRenderers,p=h===void 0?[]:h,f=i.waitForLoadComplete,g=f===void 0?!0:f;r.innerHTML="",r.appendChild(e.container=document.createElement("div")),e.container.className="scene-container",e.container.style.position="relative",e.container.appendChild(e.navInfo=document.createElement("div")),e.navInfo.className="scene-nav-info",e.navInfo.textContent={orbit:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",trackball:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",fly:"WASD: move, R|F: up | down, Q|E: roll, up|down: pitch, left|right: yaw"}[s]||"",e.navInfo.style.display=e.showNavInfo?null:"none",e.toolTipElem=document.createElement("div"),e.toolTipElem.classList.add("scene-tooltip"),e.container.appendChild(e.toolTipElem),e.pointerPos=new Ss.Vector2,e.pointerPos.x=-2,e.pointerPos.y=-2,["pointermove","pointerdown"].forEach(function(m){return e.container.addEventListener(m,function(y){if(m==="pointerdown"&&(e.isPointerPressed=!0),!e.isPointerDragging&&y.type==="pointermove"&&(y.pressure>0||e.isPointerPressed)&&(y.pointerType!=="touch"||y.movementX===void 0||[y.movementX,y.movementY].some(function(_){return Math.abs(_)>1}))&&(e.isPointerDragging=!0),e.enablePointerInteraction){var b=v(e.container);e.pointerPos.x=y.pageX-b.left,e.pointerPos.y=y.pageY-b.top,e.toolTipElem.style.top="".concat(e.pointerPos.y,"px"),e.toolTipElem.style.left="".concat(e.pointerPos.x,"px"),e.toolTipElem.style.transform="translate(-".concat(e.pointerPos.x/e.width*100,"%, ").concat(e.height-e.pointerPos.y<100?"calc(-100% - 8px)":"21px",")")}function v(_){var C=_.getBoundingClientRect(),E=window.pageXOffset||document.documentElement.scrollLeft,T=window.pageYOffset||document.documentElement.scrollTop;return{top:C.top+T,left:C.left+E}}},{passive:!0})}),e.container.addEventListener("pointerup",function(m){e.isPointerPressed=!1,!(e.isPointerDragging&&(e.isPointerDragging=!1,!e.clickAfterDrag))&&requestAnimationFrame(function(){m.button===0&&e.onClick(e.hoverObj||null,m,e.intersectionPoint),m.button===2&&e.onRightClick&&e.onRightClick(e.hoverObj||null,m,e.intersectionPoint)})},{passive:!0,capture:!0}),e.container.addEventListener("contextmenu",function(m){e.onRightClick&&m.preventDefault()}),e.renderer=new(l?sbe:Ss.WebGLRenderer)(Object.assign({antialias:!0,alpha:!0},c)),e.renderer.setPixelRatio(Math.min(2,window.devicePixelRatio)),e.container.appendChild(e.renderer.domElement),e.extraRenderers=p,e.extraRenderers.forEach(function(m){m.domElement.style.position="absolute",m.domElement.style.top="0px",m.domElement.style.pointerEvents="none",e.container.appendChild(m.domElement)}),e.postProcessingComposer=new Zbe(e.renderer),e.postProcessingComposer.addPass(new $be(e.scene,e.camera)),e.controls=new{trackball:obe,orbit:Ebe,fly:kbe}[s](e.camera,e.renderer.domElement),s==="fly"&&(e.controls.movementSpeed=300,e.controls.rollSpeed=Math.PI/6,e.controls.dragToLook=!0),(s==="trackball"||s==="orbit")&&(e.controls.minDistance=.1,e.controls.maxDistance=e.skyRadius,e.controls.addEventListener("start",function(){e.controlsEngaged=!0}),e.controls.addEventListener("change",function(){e.controlsEngaged&&(e.controlsDragging=!0)}),e.controls.addEventListener("end",function(){e.controlsEngaged=!1,e.controlsDragging=!1})),[e.renderer,e.postProcessingComposer].concat(Xy(e.extraRenderers)).forEach(function(m){return m.setSize(e.width,e.height)}),e.camera.aspect=e.width/e.height,e.camera.updateProjectionMatrix(),e.camera.position.z=1e3,e.scene.add(e.skysphere=new Ss.Mesh),e.skysphere.visible=!1,e.loadComplete=e.scene.visible=!g,window.scene=e.scene},update:function(r,e){if(r.width&&r.height&&(e.hasOwnProperty("width")||e.hasOwnProperty("height"))&&(r.container.style.width="".concat(r.width,"px"),r.container.style.height="".concat(r.height,"px"),[r.renderer,r.postProcessingComposer].concat(Xy(r.extraRenderers)).forEach(function(s){return s.setSize(r.width,r.height)}),r.camera.aspect=r.width/r.height,r.camera.updateProjectionMatrix()),e.hasOwnProperty("skyRadius")&&r.skyRadius&&(r.controls.hasOwnProperty("maxDistance")&&e.skyRadius&&(r.controls.maxDistance=Math.min(r.controls.maxDistance,r.skyRadius)),r.camera.far=r.skyRadius*2.5,r.camera.updateProjectionMatrix(),r.skysphere.geometry=new Ss.SphereGeometry(r.skyRadius)),e.hasOwnProperty("backgroundColor")){var i=Lp(r.backgroundColor).alpha;i===void 0&&(i=1),r.renderer.setClearColor(new Ss.Color(gF(1,r.backgroundColor)),i)}e.hasOwnProperty("backgroundImageUrl")&&(r.backgroundImageUrl?new Ss.TextureLoader().load(r.backgroundImageUrl,function(s){s.colorSpace=Ss.SRGBColorSpace,r.skysphere.material=new Ss.MeshBasicMaterial({map:s,side:Ss.BackSide}),r.skysphere.visible=!0,r.onBackgroundImageLoaded&&setTimeout(r.onBackgroundImageLoaded),!r.loadComplete&&n()}):(r.skysphere.visible=!1,r.skysphere.material.map=null,!r.loadComplete&&n())),e.hasOwnProperty("showNavInfo")&&(r.navInfo.style.display=r.showNavInfo?null:"none"),e.hasOwnProperty("lights")&&((e.lights||[]).forEach(function(s){return r.scene.remove(s)}),r.lights.forEach(function(s){return r.scene.add(s)})),e.hasOwnProperty("objects")&&((e.objects||[]).forEach(function(s){return r.scene.remove(s)}),r.objects.forEach(function(s){return r.scene.add(s)}));function n(){r.loadComplete=r.scene.visible=!0}}});function dxe(r,e){e===void 0&&(e={});var i=e.insertAt;if(!(typeof document>"u")){var n=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css",i==="top"&&n.firstChild?n.insertBefore(s,n.firstChild):n.appendChild(s),s.styleSheet?s.styleSheet.cssText=r:s.appendChild(document.createTextNode(r))}}var pxe=`.graph-info-msg {
  top: 50%;
  width: 100%;
  text-align: center;
  color: lavender;
  opacity: 0.7;
  font-size: 22px;
  position: absolute;
  font-family: Sans-serif;
}

.scene-container .clickable {
  cursor: pointer;
}

.scene-container .grabbable {
  cursor: move;
  cursor: grab;
  cursor: -moz-grab;
  cursor: -webkit-grab;
}

.scene-container .grabbable:active {
  cursor: grabbing;
  cursor: -moz-grabbing;
  cursor: -webkit-grabbing;
}`;dxe(pxe);function UI(r,e){(e==null||e>r.length)&&(e=r.length);for(var i=0,n=Array(e);i<e;i++)n[i]=r[i];return n}function fxe(r){if(Array.isArray(r))return UI(r)}function Ky(r,e,i){return(e=yxe(e))in r?Object.defineProperty(r,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[e]=i,r}function mxe(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function gxe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function s9(r,e){var i=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),i.push.apply(i,n)}return i}function eE(r){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?s9(Object(i),!0).forEach(function(n){Ky(r,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):s9(Object(i)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(i,n))})}return r}function tE(r){return fxe(r)||mxe(r)||vxe(r)||gxe()}function Axe(r,e){if(typeof r!="object"||!r)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var n=i.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function yxe(r){var e=Axe(r,"string");return typeof e=="symbol"?e:e+""}function vxe(r,e){if(r){if(typeof r=="string")return UI(r,e);var i={}.toString.call(r).slice(8,-1);return i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set"?Array.from(r):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?UI(r,e):void 0}}function a9(r,e){var i=new e;return i._destructor&&i._destructor(),{linkProp:function(n){return{default:i[n](),onChange:function(s,o){o[r][n](s)},triggerUpdate:!1}},linkMethod:function(n){return function(s){for(var o=s[r],l=arguments.length,u=new Array(l>1?l-1:0),c=1;c<l;c++)u[c-1]=arguments[c];var h=o[n].apply(o,u);return h===o?this:h}}}}var zI=window.THREE?window.THREE:{AmbientLight:Ore,DirectionalLight:Dre,REVISION:ex},bxe=170,o9=a9("forceGraph",hM),xxe=Object.assign.apply(Object,tE(["jsonUrl","graphData","numDimensions","dagMode","dagLevelDistance","dagNodeFilter","onDagError","nodeRelSize","nodeId","nodeVal","nodeResolution","nodeColor","nodeAutoColorBy","nodeOpacity","nodeVisibility","nodeThreeObject","nodeThreeObjectExtend","linkSource","linkTarget","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","forceEngine","d3AlphaDecay","d3VelocityDecay","d3AlphaMin","ngraphPhysics","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"].map(function(r){return Ky({},r,o9.linkProp(r))}))),_xe=Object.assign.apply(Object,tE(["refresh","getGraphBbox","d3Force","d3ReheatSimulation","emitParticle"].map(function(r){return Ky({},r,o9.linkMethod(r))}))),iE=a9("renderObjs",n9),Exe=Object.assign.apply(Object,tE(["width","height","backgroundColor","showNavInfo","enablePointerInteraction"].map(function(r){return Ky({},r,iE.linkProp(r))}))),wxe=Object.assign.apply(Object,tE(["lights","cameraPosition","postProcessingComposer"].map(function(r){return Ky({},r,iE.linkMethod(r))})).concat([{graph2ScreenCoords:iE.linkMethod("getScreenCoords"),screen2GraphCoords:iE.linkMethod("getSceneCoords")}])),Cxe=Rp({props:eE(eE({nodeLabel:{default:"name",triggerUpdate:!1},linkLabel:{default:"name",triggerUpdate:!1},linkHoverPrecision:{default:1,onChange:function(r,e){return e.renderObjs.lineHoverPrecision(r)},triggerUpdate:!1},enableNavigationControls:{default:!0,onChange:function(r,e){var i=e.renderObjs.controls();i&&(i.enabled=r,r&&i.domElement&&i.domElement.dispatchEvent(new PointerEvent("pointerup")))},triggerUpdate:!1},enableNodeDrag:{default:!0,triggerUpdate:!1},onNodeDrag:{default:function(){},triggerUpdate:!1},onNodeDragEnd:{default:function(){},triggerUpdate:!1},onNodeClick:{triggerUpdate:!1},onNodeRightClick:{triggerUpdate:!1},onNodeHover:{triggerUpdate:!1},onLinkClick:{triggerUpdate:!1},onLinkRightClick:{triggerUpdate:!1},onLinkHover:{triggerUpdate:!1},onBackgroundClick:{triggerUpdate:!1},onBackgroundRightClick:{triggerUpdate:!1}},xxe),Exe),methods:eE(eE({zoomToFit:function(r,e,i){for(var n,s=arguments.length,o=new Array(s>3?s-3:0),l=3;l<s;l++)o[l-3]=arguments[l];return r.renderObjs.fitToBbox((n=r.forceGraph).getGraphBbox.apply(n,o),e,i),this},pauseAnimation:function(r){return r.animationFrameRequestId!==null&&(cancelAnimationFrame(r.animationFrameRequestId),r.animationFrameRequestId=null),this},resumeAnimation:function(r){return r.animationFrameRequestId===null&&this._animationCycle(),this},_animationCycle:function(r){r.enablePointerInteraction&&(this.renderer().domElement.style.cursor=null),r.forceGraph.tickFrame(),r.renderObjs.tick(),r.animationFrameRequestId=requestAnimationFrame(this._animationCycle)},scene:function(r){return r.renderObjs.scene()},camera:function(r){return r.renderObjs.camera()},renderer:function(r){return r.renderObjs.renderer()},controls:function(r){return r.renderObjs.controls()},tbControls:function(r){return r.renderObjs.tbControls()},_destructor:function(){this.pauseAnimation(),this.graphData({nodes:[],links:[]})}},_xe),wxe),stateInit:function(r){var e=r.controlType,i=r.rendererConfig,n=r.extraRenderers,s=new hM;return{forceGraph:s,renderObjs:n9({controlType:e,rendererConfig:i,extraRenderers:n}).objects([s]).lights([new zI.AmbientLight(13421772,Math.PI),new zI.DirectionalLight(16777215,.6*Math.PI)])}},init:function(r,e){r.innerHTML="",r.appendChild(e.container=document.createElement("div")),e.container.style.position="relative";var i=document.createElement("div");e.container.appendChild(i),e.renderObjs(i);var n=e.renderObjs.camera(),s=e.renderObjs.renderer(),o=e.renderObjs.controls();o.enabled=!!e.enableNavigationControls,e.lastSetCameraZ=n.position.z;var l;e.container.appendChild(l=document.createElement("div")),l.className="graph-info-msg",l.textContent="",e.forceGraph.onLoading(function(){l.textContent="Loading..."}).onFinishLoading(function(){l.textContent=""}).onUpdate(function(){e.graphData=e.forceGraph.graphData(),n.position.x===0&&n.position.y===0&&n.position.z===e.lastSetCameraZ&&e.graphData.nodes.length&&(n.lookAt(e.forceGraph.position),e.lastSetCameraZ=n.position.z=Math.cbrt(e.graphData.nodes.length)*bxe)}).onFinishUpdate(function(){if(e._dragControls){var u=e.graphData.nodes.find(function(h){return h.__initialFixedPos&&!h.__disposeControlsAfterDrag});u?u.__disposeControlsAfterDrag=!0:e._dragControls.dispose(),e._dragControls=void 0}if(e.enableNodeDrag&&e.enablePointerInteraction&&e.forceEngine==="d3"){var c=e._dragControls=new phe(e.graphData.nodes.map(function(h){return h.__threeObj}).filter(function(h){return h}),n,s.domElement);c.addEventListener("dragstart",function(h){o.enabled=!1,h.object.__initialPos=h.object.position.clone(),h.object.__prevPos=h.object.position.clone();var p=fh(h.object).__data;!p.__initialFixedPos&&(p.__initialFixedPos={fx:p.fx,fy:p.fy,fz:p.fz}),!p.__initialPos&&(p.__initialPos={x:p.x,y:p.y,z:p.z}),["x","y","z"].forEach(function(f){return p["f".concat(f)]=p[f]}),s.domElement.classList.add("grabbable")}),c.addEventListener("drag",function(h){var p=fh(h.object);if(!h.object.hasOwnProperty("__graphObjType")){var f=h.object.__initialPos,g=h.object.__prevPos,m=h.object.position;p.position.add(m.clone().sub(g)),g.copy(m),m.copy(f)}var y=p.__data,b=p.position,v={x:b.x-y.x,y:b.y-y.y,z:b.z-y.z};["x","y","z"].forEach(function(_){return y["f".concat(_)]=y[_]=b[_]}),e.forceGraph.d3AlphaTarget(.3).resetCountdown(),y.__dragged=!0,e.onNodeDrag(y,v)}),c.addEventListener("dragend",function(h){delete h.object.__initialPos,delete h.object.__prevPos;var p=fh(h.object).__data;p.__disposeControlsAfterDrag&&(c.dispose(),delete p.__disposeControlsAfterDrag);var f=p.__initialFixedPos,g=p.__initialPos,m={x:g.x-p.x,y:g.y-p.y,z:g.z-p.z};f&&(["x","y","z"].forEach(function(y){var b="f".concat(y);f[b]===void 0&&delete p[b]}),delete p.__initialFixedPos,delete p.__initialPos,p.__dragged&&(delete p.__dragged,e.onNodeDragEnd(p,m))),e.forceGraph.d3AlphaTarget(0).resetCountdown(),e.enableNavigationControls&&(o.enabled=!0,o.domElement&&o.domElement.ownerDocument&&o.domElement.ownerDocument.dispatchEvent(new PointerEvent("pointerup",{pointerType:"touch"}))),s.domElement.classList.remove("grabbable")})}}),zI.REVISION<155&&(e.renderObjs.renderer().useLegacyLights=!1),e.renderObjs.hoverOrderComparator(function(u,c){var h=fh(u);if(!h)return 1;var p=fh(c);if(!p)return-1;var f=function(g){return g.__graphObjType==="node"};return f(p)-f(h)}).tooltipContent(function(u){var c=fh(u);return c&&gr(e["".concat(c.__graphObjType,"Label")])(c.__data)||""}).hoverDuringDrag(!1).onHover(function(u){var c=fh(u);if(c!==e.hoverObj){var h=e.hoverObj?e.hoverObj.__graphObjType:null,p=e.hoverObj?e.hoverObj.__data:null,f=c?c.__graphObjType:null,g=c?c.__data:null;if(h&&h!==f){var m=e["on".concat(h==="node"?"Node":"Link","Hover")];m&&m(null,p)}if(f){var y=e["on".concat(f==="node"?"Node":"Link","Hover")];y&&y(g,h===f?p:null)}s.domElement.classList[c&&e["on".concat(f==="node"?"Node":"Link","Click")]||!c&&e.onBackgroundClick?"add":"remove"]("clickable"),e.hoverObj=c}}).clickAfterDrag(!1).onClick(function(u,c){var h=fh(u);if(h){var p=e["on".concat(h.__graphObjType==="node"?"Node":"Link","Click")];p&&p(h.__data,c)}else e.onBackgroundClick&&e.onBackgroundClick(c)}).onRightClick(function(u,c){var h=fh(u);if(h){var p=e["on".concat(h.__graphObjType==="node"?"Node":"Link","RightClick")];p&&p(h.__data,c)}else e.onBackgroundRightClick&&e.onBackgroundRightClick(c)}),this._animationCycle()}});function fh(r){for(var e=r;e&&!e.hasOwnProperty("__graphObjType");)e=e.parent;return e}var jI="http://www.w3.org/1999/xhtml";const l9={svg:"http://www.w3.org/2000/svg",xhtml:jI,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function rE(r){var e=r+="",i=e.indexOf(":");return i>=0&&(e=r.slice(0,i))!=="xmlns"&&(r=r.slice(i+1)),l9.hasOwnProperty(e)?{space:l9[e],local:r}:r}function Sxe(r){return function(){var e=this.ownerDocument,i=this.namespaceURI;return i===jI&&e.documentElement.namespaceURI===jI?e.createElement(r):e.createElementNS(i,r)}}function Txe(r){return function(){return this.ownerDocument.createElementNS(r.space,r.local)}}function c9(r){var e=rE(r);return(e.local?Txe:Sxe)(e)}function Mxe(){}function GI(r){return r==null?Mxe:function(){return this.querySelector(r)}}function Rxe(r){typeof r!="function"&&(r=GI(r));for(var e=this._groups,i=e.length,n=new Array(i),s=0;s<i;++s)for(var o=e[s],l=o.length,u=n[s]=new Array(l),c,h,p=0;p<l;++p)(c=o[p])&&(h=r.call(c,c.__data__,p,o))&&("__data__"in c&&(h.__data__=c.__data__),u[p]=h);return new wl(n,this._parents)}function Ixe(r){return r==null?[]:Array.isArray(r)?r:Array.from(r)}function Bxe(){return[]}function u9(r){return r==null?Bxe:function(){return this.querySelectorAll(r)}}function Nxe(r){return function(){return Ixe(r.apply(this,arguments))}}function Lxe(r){typeof r=="function"?r=Nxe(r):r=u9(r);for(var e=this._groups,i=e.length,n=[],s=[],o=0;o<i;++o)for(var l=e[o],u=l.length,c,h=0;h<u;++h)(c=l[h])&&(n.push(r.call(c,c.__data__,h,l)),s.push(c));return new wl(n,s)}function h9(r){return function(){return this.matches(r)}}function d9(r){return function(e){return e.matches(r)}}var Dxe=Array.prototype.find;function Oxe(r){return function(){return Dxe.call(this.children,r)}}function Pxe(){return this.firstElementChild}function kxe(r){return this.select(r==null?Pxe:Oxe(typeof r=="function"?r:d9(r)))}var Fxe=Array.prototype.filter;function Uxe(){return Array.from(this.children)}function zxe(r){return function(){return Fxe.call(this.children,r)}}function jxe(r){return this.selectAll(r==null?Uxe:zxe(typeof r=="function"?r:d9(r)))}function Gxe(r){typeof r!="function"&&(r=h9(r));for(var e=this._groups,i=e.length,n=new Array(i),s=0;s<i;++s)for(var o=e[s],l=o.length,u=n[s]=[],c,h=0;h<l;++h)(c=o[h])&&r.call(c,c.__data__,h,o)&&u.push(c);return new wl(n,this._parents)}function p9(r){return new Array(r.length)}function Vxe(){return new wl(this._enter||this._groups.map(p9),this._parents)}function nE(r,e){this.ownerDocument=r.ownerDocument,this.namespaceURI=r.namespaceURI,this._next=null,this._parent=r,this.__data__=e}nE.prototype={constructor:nE,appendChild:function(r){return this._parent.insertBefore(r,this._next)},insertBefore:function(r,e){return this._parent.insertBefore(r,e)},querySelector:function(r){return this._parent.querySelector(r)},querySelectorAll:function(r){return this._parent.querySelectorAll(r)}};function Hxe(r){return function(){return r}}function Wxe(r,e,i,n,s,o){for(var l=0,u,c=e.length,h=o.length;l<h;++l)(u=e[l])?(u.__data__=o[l],n[l]=u):i[l]=new nE(r,o[l]);for(;l<c;++l)(u=e[l])&&(s[l]=u)}function Qxe(r,e,i,n,s,o,l){var u,c,h=new Map,p=e.length,f=o.length,g=new Array(p),m;for(u=0;u<p;++u)(c=e[u])&&(g[u]=m=l.call(c,c.__data__,u,e)+"",h.has(m)?s[u]=c:h.set(m,c));for(u=0;u<f;++u)m=l.call(r,o[u],u,o)+"",(c=h.get(m))?(n[u]=c,c.__data__=o[u],h.delete(m)):i[u]=new nE(r,o[u]);for(u=0;u<p;++u)(c=e[u])&&h.get(g[u])===c&&(s[u]=c)}function qxe(r){return r.__data__}function Xxe(r,e){if(!arguments.length)return Array.from(this,qxe);var i=e?Qxe:Wxe,n=this._parents,s=this._groups;typeof r!="function"&&(r=Hxe(r));for(var o=s.length,l=new Array(o),u=new Array(o),c=new Array(o),h=0;h<o;++h){var p=n[h],f=s[h],g=f.length,m=Kxe(r.call(p,p&&p.__data__,h,n)),y=m.length,b=u[h]=new Array(y),v=l[h]=new Array(y),_=c[h]=new Array(g);i(p,f,b,v,_,m,e);for(var C=0,E=0,T,R;C<y;++C)if(T=b[C]){for(C>=E&&(E=C+1);!(R=v[E])&&++E<y;);T._next=R||null}}return l=new wl(l,n),l._enter=u,l._exit=c,l}function Kxe(r){return typeof r=="object"&&"length"in r?r:Array.from(r)}function Yxe(){return new wl(this._exit||this._groups.map(p9),this._parents)}function Jxe(r,e,i){var n=this.enter(),s=this,o=this.exit();return typeof r=="function"?(n=r(n),n&&(n=n.selection())):n=n.append(r+""),e!=null&&(s=e(s),s&&(s=s.selection())),i==null?o.remove():i(o),n&&s?n.merge(s).order():s}function Zxe(r){for(var e=r.selection?r.selection():r,i=this._groups,n=e._groups,s=i.length,o=n.length,l=Math.min(s,o),u=new Array(s),c=0;c<l;++c)for(var h=i[c],p=n[c],f=h.length,g=u[c]=new Array(f),m,y=0;y<f;++y)(m=h[y]||p[y])&&(g[y]=m);for(;c<s;++c)u[c]=i[c];return new wl(u,this._parents)}function $xe(){for(var r=this._groups,e=-1,i=r.length;++e<i;)for(var n=r[e],s=n.length-1,o=n[s],l;--s>=0;)(l=n[s])&&(o&&l.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(l,o),o=l);return this}function e1e(r){r||(r=t1e);function e(f,g){return f&&g?r(f.__data__,g.__data__):!f-!g}for(var i=this._groups,n=i.length,s=new Array(n),o=0;o<n;++o){for(var l=i[o],u=l.length,c=s[o]=new Array(u),h,p=0;p<u;++p)(h=l[p])&&(c[p]=h);c.sort(e)}return new wl(s,this._parents).order()}function t1e(r,e){return r<e?-1:r>e?1:r>=e?0:NaN}function i1e(){var r=arguments[0];return arguments[0]=this,r.apply(null,arguments),this}function r1e(){return Array.from(this)}function n1e(){for(var r=this._groups,e=0,i=r.length;e<i;++e)for(var n=r[e],s=0,o=n.length;s<o;++s){var l=n[s];if(l)return l}return null}function s1e(){let r=0;for(const e of this)++r;return r}function a1e(){return!this.node()}function o1e(r){for(var e=this._groups,i=0,n=e.length;i<n;++i)for(var s=e[i],o=0,l=s.length,u;o<l;++o)(u=s[o])&&r.call(u,u.__data__,o,s);return this}function l1e(r){return function(){this.removeAttribute(r)}}function c1e(r){return function(){this.removeAttributeNS(r.space,r.local)}}function u1e(r,e){return function(){this.setAttribute(r,e)}}function h1e(r,e){return function(){this.setAttributeNS(r.space,r.local,e)}}function d1e(r,e){return function(){var i=e.apply(this,arguments);i==null?this.removeAttribute(r):this.setAttribute(r,i)}}function p1e(r,e){return function(){var i=e.apply(this,arguments);i==null?this.removeAttributeNS(r.space,r.local):this.setAttributeNS(r.space,r.local,i)}}function f1e(r,e){var i=rE(r);if(arguments.length<2){var n=this.node();return i.local?n.getAttributeNS(i.space,i.local):n.getAttribute(i)}return this.each((e==null?i.local?c1e:l1e:typeof e=="function"?i.local?p1e:d1e:i.local?h1e:u1e)(i,e))}function f9(r){return r.ownerDocument&&r.ownerDocument.defaultView||r.document&&r||r.defaultView}function m1e(r){return function(){this.style.removeProperty(r)}}function g1e(r,e,i){return function(){this.style.setProperty(r,e,i)}}function A1e(r,e,i){return function(){var n=e.apply(this,arguments);n==null?this.style.removeProperty(r):this.style.setProperty(r,n,i)}}function y1e(r,e,i){return arguments.length>1?this.each((e==null?m1e:typeof e=="function"?A1e:g1e)(r,e,i??"")):Jg(this.node(),r)}function Jg(r,e){return r.style.getPropertyValue(e)||f9(r).getComputedStyle(r,null).getPropertyValue(e)}function v1e(r){return function(){delete this[r]}}function b1e(r,e){return function(){this[r]=e}}function x1e(r,e){return function(){var i=e.apply(this,arguments);i==null?delete this[r]:this[r]=i}}function _1e(r,e){return arguments.length>1?this.each((e==null?v1e:typeof e=="function"?x1e:b1e)(r,e)):this.node()[r]}function m9(r){return r.trim().split(/^|\s+/)}function VI(r){return r.classList||new g9(r)}function g9(r){this._node=r,this._names=m9(r.getAttribute("class")||"")}g9.prototype={add:function(r){var e=this._names.indexOf(r);e<0&&(this._names.push(r),this._node.setAttribute("class",this._names.join(" ")))},remove:function(r){var e=this._names.indexOf(r);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(r){return this._names.indexOf(r)>=0}};function A9(r,e){for(var i=VI(r),n=-1,s=e.length;++n<s;)i.add(e[n])}function y9(r,e){for(var i=VI(r),n=-1,s=e.length;++n<s;)i.remove(e[n])}function E1e(r){return function(){A9(this,r)}}function w1e(r){return function(){y9(this,r)}}function C1e(r,e){return function(){(e.apply(this,arguments)?A9:y9)(this,r)}}function S1e(r,e){var i=m9(r+"");if(arguments.length<2){for(var n=VI(this.node()),s=-1,o=i.length;++s<o;)if(!n.contains(i[s]))return!1;return!0}return this.each((typeof e=="function"?C1e:e?E1e:w1e)(i,e))}function T1e(){this.textContent=""}function M1e(r){return function(){this.textContent=r}}function R1e(r){return function(){var e=r.apply(this,arguments);this.textContent=e??""}}function I1e(r){return arguments.length?this.each(r==null?T1e:(typeof r=="function"?R1e:M1e)(r)):this.node().textContent}function B1e(){this.innerHTML=""}function N1e(r){return function(){this.innerHTML=r}}function L1e(r){return function(){var e=r.apply(this,arguments);this.innerHTML=e??""}}function D1e(r){return arguments.length?this.each(r==null?B1e:(typeof r=="function"?L1e:N1e)(r)):this.node().innerHTML}function O1e(){this.nextSibling&&this.parentNode.appendChild(this)}function P1e(){return this.each(O1e)}function k1e(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function F1e(){return this.each(k1e)}function U1e(r){var e=typeof r=="function"?r:c9(r);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function z1e(){return null}function j1e(r,e){var i=typeof r=="function"?r:c9(r),n=e==null?z1e:typeof e=="function"?e:GI(e);return this.select(function(){return this.insertBefore(i.apply(this,arguments),n.apply(this,arguments)||null)})}function G1e(){var r=this.parentNode;r&&r.removeChild(this)}function V1e(){return this.each(G1e)}function H1e(){var r=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(r,this.nextSibling):r}function W1e(){var r=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(r,this.nextSibling):r}function Q1e(r){return this.select(r?W1e:H1e)}function q1e(r){return arguments.length?this.property("__data__",r):this.node().__data__}function X1e(r){return function(e){r.call(this,e,this.__data__)}}function K1e(r){return r.trim().split(/^|\s+/).map(function(e){var i="",n=e.indexOf(".");return n>=0&&(i=e.slice(n+1),e=e.slice(0,n)),{type:e,name:i}})}function Y1e(r){return function(){var e=this.__on;if(e){for(var i=0,n=-1,s=e.length,o;i<s;++i)o=e[i],(!r.type||o.type===r.type)&&o.name===r.name?this.removeEventListener(o.type,o.listener,o.options):e[++n]=o;++n?e.length=n:delete this.__on}}}function J1e(r,e,i){return function(){var n=this.__on,s,o=X1e(e);if(n){for(var l=0,u=n.length;l<u;++l)if((s=n[l]).type===r.type&&s.name===r.name){this.removeEventListener(s.type,s.listener,s.options),this.addEventListener(s.type,s.listener=o,s.options=i),s.value=e;return}}this.addEventListener(r.type,o,i),s={type:r.type,name:r.name,value:e,listener:o,options:i},n?n.push(s):this.__on=[s]}}function Z1e(r,e,i){var n=K1e(r+""),s,o=n.length,l;if(arguments.length<2){var u=this.node().__on;if(u){for(var c=0,h=u.length,p;c<h;++c)for(s=0,p=u[c];s<o;++s)if((l=n[s]).type===p.type&&l.name===p.name)return p.value}return}for(u=e?J1e:Y1e,s=0;s<o;++s)this.each(u(n[s],e,i));return this}function v9(r,e,i){var n=f9(r),s=n.CustomEvent;typeof s=="function"?s=new s(e,i):(s=n.document.createEvent("Event"),i?(s.initEvent(e,i.bubbles,i.cancelable),s.detail=i.detail):s.initEvent(e,!1,!1)),r.dispatchEvent(s)}function $1e(r,e){return function(){return v9(this,r,e)}}function e_e(r,e){return function(){return v9(this,r,e.apply(this,arguments))}}function t_e(r,e){return this.each((typeof e=="function"?e_e:$1e)(r,e))}function*i_e(){for(var r=this._groups,e=0,i=r.length;e<i;++e)for(var n=r[e],s=0,o=n.length,l;s<o;++s)(l=n[s])&&(yield l)}var b9=[null];function wl(r,e){this._groups=r,this._parents=e}function Yy(){return new wl([[document.documentElement]],b9)}function r_e(){return this}wl.prototype=Yy.prototype={constructor:wl,select:Rxe,selectAll:Lxe,selectChild:kxe,selectChildren:jxe,filter:Gxe,data:Xxe,enter:Vxe,exit:Yxe,join:Jxe,merge:Zxe,selection:r_e,order:$xe,sort:e1e,call:i1e,nodes:r1e,node:n1e,size:s1e,empty:a1e,each:o1e,attr:f1e,style:y1e,property:_1e,classed:S1e,text:I1e,html:D1e,raise:P1e,lower:F1e,append:U1e,insert:j1e,remove:V1e,clone:Q1e,datum:q1e,on:Z1e,dispatch:t_e,[Symbol.iterator]:i_e};function Rc(r){return typeof r=="string"?new wl([[document.querySelector(r)]],[document.documentElement]):new wl([[r]],b9)}function n_e(r){let e;for(;e=r.sourceEvent;)r=e;return r}function mh(r,e){if(r=n_e(r),e===void 0&&(e=r.currentTarget),e){var i=e.ownerSVGElement||e;if(i.createSVGPoint){var n=i.createSVGPoint();return n.x=r.clientX,n.y=r.clientY,n=n.matrixTransform(e.getScreenCTM().inverse()),[n.x,n.y]}if(e.getBoundingClientRect){var s=e.getBoundingClientRect();return[r.clientX-s.left-e.clientLeft,r.clientY-s.top-e.clientTop]}}return[r.pageX,r.pageY]}const s_e={passive:!1},Jy={capture:!0,passive:!1};function HI(r){r.stopImmediatePropagation()}function Zg(r){r.preventDefault(),r.stopImmediatePropagation()}function x9(r){var e=r.document.documentElement,i=Rc(r).on("dragstart.drag",Zg,Jy);"onselectstart"in e?i.on("selectstart.drag",Zg,Jy):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function _9(r,e){var i=r.document.documentElement,n=Rc(r).on("dragstart.drag",null);e&&(n.on("click.drag",Zg,Jy),setTimeout(function(){n.on("click.drag",null)},0)),"onselectstart"in i?n.on("selectstart.drag",null):(i.style.MozUserSelect=i.__noselect,delete i.__noselect)}const sE=r=>()=>r;function WI(r,{sourceEvent:e,subject:i,target:n,identifier:s,active:o,x:l,y:u,dx:c,dy:h,dispatch:p}){Object.defineProperties(this,{type:{value:r,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:i,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},identifier:{value:s,enumerable:!0,configurable:!0},active:{value:o,enumerable:!0,configurable:!0},x:{value:l,enumerable:!0,configurable:!0},y:{value:u,enumerable:!0,configurable:!0},dx:{value:c,enumerable:!0,configurable:!0},dy:{value:h,enumerable:!0,configurable:!0},_:{value:p}})}WI.prototype.on=function(){var r=this._.on.apply(this._,arguments);return r===this._?this:r};function a_e(r){return!r.ctrlKey&&!r.button}function o_e(){return this.parentNode}function l_e(r,e){return e??{x:r.x,y:r.y}}function c_e(){return navigator.maxTouchPoints||"ontouchstart"in this}function u_e(){var r=a_e,e=o_e,i=l_e,n=c_e,s={},o=PA("start","drag","end"),l=0,u,c,h,p,f=0;function g(T){T.on("mousedown.drag",m).filter(n).on("touchstart.drag",v).on("touchmove.drag",_,s_e).on("touchend.drag touchcancel.drag",C).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function m(T,R){if(!(p||!r.call(this,T,R))){var B=E(this,e.call(this,T,R),T,R,"mouse");B&&(Rc(T.view).on("mousemove.drag",y,Jy).on("mouseup.drag",b,Jy),x9(T.view),HI(T),h=!1,u=T.clientX,c=T.clientY,B("start",T))}}function y(T){if(Zg(T),!h){var R=T.clientX-u,B=T.clientY-c;h=R*R+B*B>f}s.mouse("drag",T)}function b(T){Rc(T.view).on("mousemove.drag mouseup.drag",null),_9(T.view,h),Zg(T),s.mouse("end",T)}function v(T,R){if(r.call(this,T,R)){var B=T.changedTouches,I=e.call(this,T,R),D=B.length,L,O;for(L=0;L<D;++L)(O=E(this,I,T,R,B[L].identifier,B[L]))&&(HI(T),O("start",T,B[L]))}}function _(T){var R=T.changedTouches,B=R.length,I,D;for(I=0;I<B;++I)(D=s[R[I].identifier])&&(Zg(T),D("drag",T,R[I]))}function C(T){var R=T.changedTouches,B=R.length,I,D;for(p&&clearTimeout(p),p=setTimeout(function(){p=null},500),I=0;I<B;++I)(D=s[R[I].identifier])&&(HI(T),D("end",T,R[I]))}function E(T,R,B,I,D,L){var O=o.copy(),F=mh(L||B,R),q,H,G;if((G=i.call(T,new WI("beforestart",{sourceEvent:B,target:g,identifier:D,active:l,x:F[0],y:F[1],dx:0,dy:0,dispatch:O}),I))!=null)return q=G.x-F[0]||0,H=G.y-F[1]||0,function J(Q,V,z){var te=F,K;switch(Q){case"start":s[D]=J,K=l++;break;case"end":delete s[D],--l;case"drag":F=mh(z||V,R),K=l;break}O.call(Q,T,new WI(Q,{sourceEvent:V,subject:G,target:g,identifier:D,active:K,x:F[0]+q,y:F[1]+H,dx:F[0]-te[0],dy:F[1]-te[1],dispatch:O}),I)}}return g.filter=function(T){return arguments.length?(r=typeof T=="function"?T:sE(!!T),g):r},g.container=function(T){return arguments.length?(e=typeof T=="function"?T:sE(T),g):e},g.subject=function(T){return arguments.length?(i=typeof T=="function"?T:sE(T),g):i},g.touchable=function(T){return arguments.length?(n=typeof T=="function"?T:sE(!!T),g):n},g.on=function(){var T=o.on.apply(o,arguments);return T===o?g:T},g.clickDistance=function(T){return arguments.length?(f=(T=+T)*T,g):Math.sqrt(f)},g}var h_e=PA("start","end","cancel","interrupt"),d_e=[],E9=0,w9=1,QI=2,aE=3,C9=4,qI=5,oE=6;function lE(r,e,i,n,s,o){var l=r.__transition;if(!l)r.__transition={};else if(i in l)return;p_e(r,i,{name:e,index:n,group:s,on:h_e,tween:d_e,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:E9})}function XI(r,e){var i=Ic(r,e);if(i.state>E9)throw new Error("too late; already scheduled");return i}function iu(r,e){var i=Ic(r,e);if(i.state>aE)throw new Error("too late; already running");return i}function Ic(r,e){var i=r.__transition;if(!i||!(i=i[e]))throw new Error("transition not found");return i}function p_e(r,e,i){var n=r.__transition,s;n[e]=i,i.timer=NT(o,0,i.time);function o(h){i.state=w9,i.timer.restart(l,i.delay,i.time),i.delay<=h&&l(h-i.delay)}function l(h){var p,f,g,m;if(i.state!==w9)return c();for(p in n)if(m=n[p],m.name===i.name){if(m.state===aE)return Fk(l);m.state===C9?(m.state=oE,m.timer.stop(),m.on.call("interrupt",r,r.__data__,m.index,m.group),delete n[p]):+p<e&&(m.state=oE,m.timer.stop(),m.on.call("cancel",r,r.__data__,m.index,m.group),delete n[p])}if(Fk(function(){i.state===aE&&(i.state=C9,i.timer.restart(u,i.delay,i.time),u(h))}),i.state=QI,i.on.call("start",r,r.__data__,i.index,i.group),i.state===QI){for(i.state=aE,s=new Array(g=i.tween.length),p=0,f=-1;p<g;++p)(m=i.tween[p].value.call(r,r.__data__,i.index,i.group))&&(s[++f]=m);s.length=f+1}}function u(h){for(var p=h<i.duration?i.ease.call(null,h/i.duration):(i.timer.restart(c),i.state=qI,1),f=-1,g=s.length;++f<g;)s[f].call(r,p);i.state===qI&&(i.on.call("end",r,r.__data__,i.index,i.group),c())}function c(){i.state=oE,i.timer.stop(),delete n[e];for(var h in n)return;delete r.__transition}}function cE(r,e){var i=r.__transition,n,s,o=!0,l;if(i){e=e==null?null:e+"";for(l in i){if((n=i[l]).name!==e){o=!1;continue}s=n.state>QI&&n.state<qI,n.state=oE,n.timer.stop(),n.on.call(s?"interrupt":"cancel",r,r.__data__,n.index,n.group),delete i[l]}o&&delete r.__transition}}function f_e(r){return this.each(function(){cE(this,r)})}function m_e(r,e){var i,n;return function(){var s=iu(this,r),o=s.tween;if(o!==i){n=i=o;for(var l=0,u=n.length;l<u;++l)if(n[l].name===e){n=n.slice(),n.splice(l,1);break}}s.tween=n}}function g_e(r,e,i){var n,s;if(typeof i!="function")throw new Error;return function(){var o=iu(this,r),l=o.tween;if(l!==n){s=(n=l).slice();for(var u={name:e,value:i},c=0,h=s.length;c<h;++c)if(s[c].name===e){s[c]=u;break}c===h&&s.push(u)}o.tween=s}}function A_e(r,e){var i=this._id;if(r+="",arguments.length<2){for(var n=Ic(this.node(),i).tween,s=0,o=n.length,l;s<o;++s)if((l=n[s]).name===r)return l.value;return null}return this.each((e==null?m_e:g_e)(i,r,e))}function KI(r,e,i){var n=r._id;return r.each(function(){var s=iu(this,n);(s.value||(s.value={}))[e]=i.apply(this,arguments)}),function(s){return Ic(s,n).value[e]}}function S9(r,e){var i;return(typeof e=="number"?od:e instanceof qA?z5:(i=qA(e))?(e=i,z5):doe)(r,e)}function y_e(r){return function(){this.removeAttribute(r)}}function v_e(r){return function(){this.removeAttributeNS(r.space,r.local)}}function b_e(r,e,i){var n,s=i+"",o;return function(){var l=this.getAttribute(r);return l===s?null:l===n?o:o=e(n=l,i)}}function x_e(r,e,i){var n,s=i+"",o;return function(){var l=this.getAttributeNS(r.space,r.local);return l===s?null:l===n?o:o=e(n=l,i)}}function __e(r,e,i){var n,s,o;return function(){var l,u=i(this),c;return u==null?void this.removeAttribute(r):(l=this.getAttribute(r),c=u+"",l===c?null:l===n&&c===s?o:(s=c,o=e(n=l,u)))}}function E_e(r,e,i){var n,s,o;return function(){var l,u=i(this),c;return u==null?void this.removeAttributeNS(r.space,r.local):(l=this.getAttributeNS(r.space,r.local),c=u+"",l===c?null:l===n&&c===s?o:(s=c,o=e(n=l,u)))}}function w_e(r,e){var i=rE(r),n=i==="transform"?goe:S9;return this.attrTween(r,typeof e=="function"?(i.local?E_e:__e)(i,n,KI(this,"attr."+r,e)):e==null?(i.local?v_e:y_e)(i):(i.local?x_e:b_e)(i,n,e))}function C_e(r,e){return function(i){this.setAttribute(r,e.call(this,i))}}function S_e(r,e){return function(i){this.setAttributeNS(r.space,r.local,e.call(this,i))}}function T_e(r,e){var i,n;function s(){var o=e.apply(this,arguments);return o!==n&&(i=(n=o)&&S_e(r,o)),i}return s._value=e,s}function M_e(r,e){var i,n;function s(){var o=e.apply(this,arguments);return o!==n&&(i=(n=o)&&C_e(r,o)),i}return s._value=e,s}function R_e(r,e){var i="attr."+r;if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;var n=rE(r);return this.tween(i,(n.local?T_e:M_e)(n,e))}function I_e(r,e){return function(){XI(this,r).delay=+e.apply(this,arguments)}}function B_e(r,e){return e=+e,function(){XI(this,r).delay=e}}function N_e(r){var e=this._id;return arguments.length?this.each((typeof r=="function"?I_e:B_e)(e,r)):Ic(this.node(),e).delay}function L_e(r,e){return function(){iu(this,r).duration=+e.apply(this,arguments)}}function D_e(r,e){return e=+e,function(){iu(this,r).duration=e}}function O_e(r){var e=this._id;return arguments.length?this.each((typeof r=="function"?L_e:D_e)(e,r)):Ic(this.node(),e).duration}function P_e(r,e){if(typeof e!="function")throw new Error;return function(){iu(this,r).ease=e}}function k_e(r){var e=this._id;return arguments.length?this.each(P_e(e,r)):Ic(this.node(),e).ease}function F_e(r,e){return function(){var i=e.apply(this,arguments);if(typeof i!="function")throw new Error;iu(this,r).ease=i}}function U_e(r){if(typeof r!="function")throw new Error;return this.each(F_e(this._id,r))}function z_e(r){typeof r!="function"&&(r=h9(r));for(var e=this._groups,i=e.length,n=new Array(i),s=0;s<i;++s)for(var o=e[s],l=o.length,u=n[s]=[],c,h=0;h<l;++h)(c=o[h])&&r.call(c,c.__data__,h,o)&&u.push(c);return new gh(n,this._parents,this._name,this._id)}function j_e(r){if(r._id!==this._id)throw new Error;for(var e=this._groups,i=r._groups,n=e.length,s=i.length,o=Math.min(n,s),l=new Array(n),u=0;u<o;++u)for(var c=e[u],h=i[u],p=c.length,f=l[u]=new Array(p),g,m=0;m<p;++m)(g=c[m]||h[m])&&(f[m]=g);for(;u<n;++u)l[u]=e[u];return new gh(l,this._parents,this._name,this._id)}function G_e(r){return(r+"").trim().split(/^|\s+/).every(function(e){var i=e.indexOf(".");return i>=0&&(e=e.slice(0,i)),!e||e==="start"})}function V_e(r,e,i){var n,s,o=G_e(e)?XI:iu;return function(){var l=o(this,r),u=l.on;u!==n&&(s=(n=u).copy()).on(e,i),l.on=s}}function H_e(r,e){var i=this._id;return arguments.length<2?Ic(this.node(),i).on.on(r):this.each(V_e(i,r,e))}function W_e(r){return function(){var e=this.parentNode;for(var i in this.__transition)if(+i!==r)return;e&&e.removeChild(this)}}function Q_e(){return this.on("end.remove",W_e(this._id))}function q_e(r){var e=this._name,i=this._id;typeof r!="function"&&(r=GI(r));for(var n=this._groups,s=n.length,o=new Array(s),l=0;l<s;++l)for(var u=n[l],c=u.length,h=o[l]=new Array(c),p,f,g=0;g<c;++g)(p=u[g])&&(f=r.call(p,p.__data__,g,u))&&("__data__"in p&&(f.__data__=p.__data__),h[g]=f,lE(h[g],e,i,g,h,Ic(p,i)));return new gh(o,this._parents,e,i)}function X_e(r){var e=this._name,i=this._id;typeof r!="function"&&(r=u9(r));for(var n=this._groups,s=n.length,o=[],l=[],u=0;u<s;++u)for(var c=n[u],h=c.length,p,f=0;f<h;++f)if(p=c[f]){for(var g=r.call(p,p.__data__,f,c),m,y=Ic(p,i),b=0,v=g.length;b<v;++b)(m=g[b])&&lE(m,e,i,b,g,y);o.push(g),l.push(p)}return new gh(o,l,e,i)}var K_e=Yy.prototype.constructor;function Y_e(){return new K_e(this._groups,this._parents)}function J_e(r,e){var i,n,s;return function(){var o=Jg(this,r),l=(this.style.removeProperty(r),Jg(this,r));return o===l?null:o===i&&l===n?s:s=e(i=o,n=l)}}function T9(r){return function(){this.style.removeProperty(r)}}function Z_e(r,e,i){var n,s=i+"",o;return function(){var l=Jg(this,r);return l===s?null:l===n?o:o=e(n=l,i)}}function $_e(r,e,i){var n,s,o;return function(){var l=Jg(this,r),u=i(this),c=u+"";return u==null&&(c=u=(this.style.removeProperty(r),Jg(this,r))),l===c?null:l===n&&c===s?o:(s=c,o=e(n=l,u))}}function eEe(r,e){var i,n,s,o="style."+e,l="end."+o,u;return function(){var c=iu(this,r),h=c.on,p=c.value[o]==null?u||(u=T9(e)):void 0;(h!==i||s!==p)&&(n=(i=h).copy()).on(l,s=p),c.on=n}}function tEe(r,e,i){var n=(r+="")=="transform"?moe:S9;return e==null?this.styleTween(r,J_e(r,n)).on("end.style."+r,T9(r)):typeof e=="function"?this.styleTween(r,$_e(r,n,KI(this,"style."+r,e))).each(eEe(this._id,r)):this.styleTween(r,Z_e(r,n,e),i).on("end.style."+r,null)}function iEe(r,e,i){return function(n){this.style.setProperty(r,e.call(this,n),i)}}function rEe(r,e,i){var n,s;function o(){var l=e.apply(this,arguments);return l!==s&&(n=(s=l)&&iEe(r,l,i)),n}return o._value=e,o}function nEe(r,e,i){var n="style."+(r+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;return this.tween(n,rEe(r,e,i??""))}function sEe(r){return function(){this.textContent=r}}function aEe(r){return function(){var e=r(this);this.textContent=e??""}}function oEe(r){return this.tween("text",typeof r=="function"?aEe(KI(this,"text",r)):sEe(r==null?"":r+""))}function lEe(r){return function(e){this.textContent=r.call(this,e)}}function cEe(r){var e,i;function n(){var s=r.apply(this,arguments);return s!==i&&(e=(i=s)&&lEe(s)),e}return n._value=r,n}function uEe(r){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(r==null)return this.tween(e,null);if(typeof r!="function")throw new Error;return this.tween(e,cEe(r))}function hEe(){for(var r=this._name,e=this._id,i=M9(),n=this._groups,s=n.length,o=0;o<s;++o)for(var l=n[o],u=l.length,c,h=0;h<u;++h)if(c=l[h]){var p=Ic(c,e);lE(c,r,i,h,l,{time:p.time+p.delay+p.duration,delay:0,duration:p.duration,ease:p.ease})}return new gh(n,this._parents,r,i)}function dEe(){var r,e,i=this,n=i._id,s=i.size();return new Promise(function(o,l){var u={value:l},c={value:function(){--s===0&&o()}};i.each(function(){var h=iu(this,n),p=h.on;p!==r&&(e=(r=p).copy(),e._.cancel.push(u),e._.interrupt.push(u),e._.end.push(c)),h.on=e}),s===0&&o()})}var pEe=0;function gh(r,e,i,n){this._groups=r,this._parents=e,this._name=i,this._id=n}function M9(){return++pEe}var Ah=Yy.prototype;gh.prototype={constructor:gh,select:q_e,selectAll:X_e,selectChild:Ah.selectChild,selectChildren:Ah.selectChildren,filter:z_e,merge:j_e,selection:Y_e,transition:hEe,call:Ah.call,nodes:Ah.nodes,node:Ah.node,size:Ah.size,empty:Ah.empty,each:Ah.each,on:H_e,attr:w_e,attrTween:R_e,style:tEe,styleTween:nEe,text:oEe,textTween:uEe,remove:Q_e,tween:A_e,delay:N_e,duration:O_e,ease:k_e,easeVarying:U_e,end:dEe,[Symbol.iterator]:Ah[Symbol.iterator]};function fEe(r){return((r*=2)<=1?r*r*r:(r-=2)*r*r+2)/2}var mEe={time:null,delay:0,duration:250,ease:fEe};function gEe(r,e){for(var i;!(i=r.__transition)||!(i=i[e]);)if(!(r=r.parentNode))throw new Error(`transition ${e} not found`);return i}function AEe(r){var e,i;r instanceof gh?(e=r._id,r=r._name):(e=M9(),(i=mEe).time=BT(),r=r==null?null:r+"");for(var n=this._groups,s=n.length,o=0;o<s;++o)for(var l=n[o],u=l.length,c,h=0;h<u;++h)(c=l[h])&&lE(c,r,e,h,l,i||gEe(c,e));return new gh(n,this._parents,r,e)}Yy.prototype.interrupt=f_e,Yy.prototype.transition=AEe;const uE=r=>()=>r;function yEe(r,{sourceEvent:e,target:i,transform:n,dispatch:s}){Object.defineProperties(this,{type:{value:r,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},transform:{value:n,enumerable:!0,configurable:!0},_:{value:s}})}function yh(r,e,i){this.k=r,this.x=e,this.y=i}yh.prototype={constructor:yh,scale:function(r){return r===1?this:new yh(this.k*r,this.x,this.y)},translate:function(r,e){return r===0&e===0?this:new yh(this.k,this.x+this.k*r,this.y+this.k*e)},apply:function(r){return[r[0]*this.k+this.x,r[1]*this.k+this.y]},applyX:function(r){return r*this.k+this.x},applyY:function(r){return r*this.k+this.y},invert:function(r){return[(r[0]-this.x)/this.k,(r[1]-this.y)/this.k]},invertX:function(r){return(r-this.x)/this.k},invertY:function(r){return(r-this.y)/this.k},rescaleX:function(r){return r.copy().domain(r.range().map(this.invertX,this).map(r.invert,r))},rescaleY:function(r){return r.copy().domain(r.range().map(this.invertY,this).map(r.invert,r))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var YI=new yh(1,0,0);ru.prototype=yh.prototype;function ru(r){for(;!r.__zoom;)if(!(r=r.parentNode))return YI;return r.__zoom}function JI(r){r.stopImmediatePropagation()}function Zy(r){r.preventDefault(),r.stopImmediatePropagation()}function vEe(r){return(!r.ctrlKey||r.type==="wheel")&&!r.button}function bEe(){var r=this;return r instanceof SVGElement?(r=r.ownerSVGElement||r,r.hasAttribute("viewBox")?(r=r.viewBox.baseVal,[[r.x,r.y],[r.x+r.width,r.y+r.height]]):[[0,0],[r.width.baseVal.value,r.height.baseVal.value]]):[[0,0],[r.clientWidth,r.clientHeight]]}function R9(){return this.__zoom||YI}function xEe(r){return-r.deltaY*(r.deltaMode===1?.05:r.deltaMode?1:.002)*(r.ctrlKey?10:1)}function _Ee(){return navigator.maxTouchPoints||"ontouchstart"in this}function EEe(r,e,i){var n=r.invertX(e[0][0])-i[0][0],s=r.invertX(e[1][0])-i[1][0],o=r.invertY(e[0][1])-i[0][1],l=r.invertY(e[1][1])-i[1][1];return r.translate(s>n?(n+s)/2:Math.min(0,n)||Math.max(0,s),l>o?(o+l)/2:Math.min(0,o)||Math.max(0,l))}function wEe(){var r=vEe,e=bEe,i=EEe,n=xEe,s=_Ee,o=[0,1/0],l=[[-1/0,-1/0],[1/0,1/0]],u=250,c=boe,h=PA("start","zoom","end"),p,f,g,m=500,y=150,b=0,v=10;function _(G){G.property("__zoom",R9).on("wheel.zoom",D,{passive:!1}).on("mousedown.zoom",L).on("dblclick.zoom",O).filter(s).on("touchstart.zoom",F).on("touchmove.zoom",q).on("touchend.zoom touchcancel.zoom",H).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}_.transform=function(G,J,Q,V){var z=G.selection?G.selection():G;z.property("__zoom",R9),G!==z?R(G,J,Q,V):z.interrupt().each(function(){B(this,arguments).event(V).start().zoom(null,typeof J=="function"?J.apply(this,arguments):J).end()})},_.scaleBy=function(G,J,Q,V){_.scaleTo(G,function(){var z=this.__zoom.k,te=typeof J=="function"?J.apply(this,arguments):J;return z*te},Q,V)},_.scaleTo=function(G,J,Q,V){_.transform(G,function(){var z=e.apply(this,arguments),te=this.__zoom,K=Q==null?T(z):typeof Q=="function"?Q.apply(this,arguments):Q,ae=te.invert(K),Ae=typeof J=="function"?J.apply(this,arguments):J;return i(E(C(te,Ae),K,ae),z,l)},Q,V)},_.translateBy=function(G,J,Q,V){_.transform(G,function(){return i(this.__zoom.translate(typeof J=="function"?J.apply(this,arguments):J,typeof Q=="function"?Q.apply(this,arguments):Q),e.apply(this,arguments),l)},null,V)},_.translateTo=function(G,J,Q,V,z){_.transform(G,function(){var te=e.apply(this,arguments),K=this.__zoom,ae=V==null?T(te):typeof V=="function"?V.apply(this,arguments):V;return i(YI.translate(ae[0],ae[1]).scale(K.k).translate(typeof J=="function"?-J.apply(this,arguments):-J,typeof Q=="function"?-Q.apply(this,arguments):-Q),te,l)},V,z)};function C(G,J){return J=Math.max(o[0],Math.min(o[1],J)),J===G.k?G:new yh(J,G.x,G.y)}function E(G,J,Q){var V=J[0]-Q[0]*G.k,z=J[1]-Q[1]*G.k;return V===G.x&&z===G.y?G:new yh(G.k,V,z)}function T(G){return[(+G[0][0]+ +G[1][0])/2,(+G[0][1]+ +G[1][1])/2]}function R(G,J,Q,V){G.on("start.zoom",function(){B(this,arguments).event(V).start()}).on("interrupt.zoom end.zoom",function(){B(this,arguments).event(V).end()}).tween("zoom",function(){var z=this,te=arguments,K=B(z,te).event(V),ae=e.apply(z,te),Ae=Q==null?T(ae):typeof Q=="function"?Q.apply(z,te):Q,_e=Math.max(ae[1][0]-ae[0][0],ae[1][1]-ae[0][1]),me=z.__zoom,Pe=typeof J=="function"?J.apply(z,te):J,Xe=c(me.invert(Ae).concat(_e/me.k),Pe.invert(Ae).concat(_e/Pe.k));return function(Je){if(Je===1)Je=Pe;else{var tt=Xe(Je),dt=_e/tt[2];Je=new yh(dt,Ae[0]-tt[0]*dt,Ae[1]-tt[1]*dt)}K.zoom(null,Je)}})}function B(G,J,Q){return!Q&&G.__zooming||new I(G,J)}function I(G,J){this.that=G,this.args=J,this.active=0,this.sourceEvent=null,this.extent=e.apply(G,J),this.taps=0}I.prototype={event:function(G){return G&&(this.sourceEvent=G),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(G,J){return this.mouse&&G!=="mouse"&&(this.mouse[1]=J.invert(this.mouse[0])),this.touch0&&G!=="touch"&&(this.touch0[1]=J.invert(this.touch0[0])),this.touch1&&G!=="touch"&&(this.touch1[1]=J.invert(this.touch1[0])),this.that.__zoom=J,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(G){var J=Rc(this.that).datum();h.call(G,this.that,new yEe(G,{sourceEvent:this.sourceEvent,target:_,transform:this.that.__zoom,dispatch:h}),J)}};function D(G,...J){if(!r.apply(this,arguments))return;var Q=B(this,J).event(G),V=this.__zoom,z=Math.max(o[0],Math.min(o[1],V.k*Math.pow(2,n.apply(this,arguments)))),te=mh(G);if(Q.wheel)(Q.mouse[0][0]!==te[0]||Q.mouse[0][1]!==te[1])&&(Q.mouse[1]=V.invert(Q.mouse[0]=te)),clearTimeout(Q.wheel);else{if(V.k===z)return;Q.mouse=[te,V.invert(te)],cE(this),Q.start()}Zy(G),Q.wheel=setTimeout(K,y),Q.zoom("mouse",i(E(C(V,z),Q.mouse[0],Q.mouse[1]),Q.extent,l));function K(){Q.wheel=null,Q.end()}}function L(G,...J){if(g||!r.apply(this,arguments))return;var Q=G.currentTarget,V=B(this,J,!0).event(G),z=Rc(G.view).on("mousemove.zoom",Ae,!0).on("mouseup.zoom",_e,!0),te=mh(G,Q),K=G.clientX,ae=G.clientY;x9(G.view),JI(G),V.mouse=[te,this.__zoom.invert(te)],cE(this),V.start();function Ae(me){if(Zy(me),!V.moved){var Pe=me.clientX-K,Xe=me.clientY-ae;V.moved=Pe*Pe+Xe*Xe>b}V.event(me).zoom("mouse",i(E(V.that.__zoom,V.mouse[0]=mh(me,Q),V.mouse[1]),V.extent,l))}function _e(me){z.on("mousemove.zoom mouseup.zoom",null),_9(me.view,V.moved),Zy(me),V.event(me).end()}}function O(G,...J){if(r.apply(this,arguments)){var Q=this.__zoom,V=mh(G.changedTouches?G.changedTouches[0]:G,this),z=Q.invert(V),te=Q.k*(G.shiftKey?.5:2),K=i(E(C(Q,te),V,z),e.apply(this,J),l);Zy(G),u>0?Rc(this).transition().duration(u).call(R,K,V,G):Rc(this).call(_.transform,K,V,G)}}function F(G,...J){if(r.apply(this,arguments)){var Q=G.touches,V=Q.length,z=B(this,J,G.changedTouches.length===V).event(G),te,K,ae,Ae;for(JI(G),K=0;K<V;++K)ae=Q[K],Ae=mh(ae,this),Ae=[Ae,this.__zoom.invert(Ae),ae.identifier],z.touch0?!z.touch1&&z.touch0[2]!==Ae[2]&&(z.touch1=Ae,z.taps=0):(z.touch0=Ae,te=!0,z.taps=1+!!p);p&&(p=clearTimeout(p)),te&&(z.taps<2&&(f=Ae[0],p=setTimeout(function(){p=null},m)),cE(this),z.start())}}function q(G,...J){if(this.__zooming){var Q=B(this,J).event(G),V=G.changedTouches,z=V.length,te,K,ae,Ae;for(Zy(G),te=0;te<z;++te)K=V[te],ae=mh(K,this),Q.touch0&&Q.touch0[2]===K.identifier?Q.touch0[0]=ae:Q.touch1&&Q.touch1[2]===K.identifier&&(Q.touch1[0]=ae);if(K=Q.that.__zoom,Q.touch1){var _e=Q.touch0[0],me=Q.touch0[1],Pe=Q.touch1[0],Xe=Q.touch1[1],Je=(Je=Pe[0]-_e[0])*Je+(Je=Pe[1]-_e[1])*Je,tt=(tt=Xe[0]-me[0])*tt+(tt=Xe[1]-me[1])*tt;K=C(K,Math.sqrt(Je/tt)),ae=[(_e[0]+Pe[0])/2,(_e[1]+Pe[1])/2],Ae=[(me[0]+Xe[0])/2,(me[1]+Xe[1])/2]}else if(Q.touch0)ae=Q.touch0[0],Ae=Q.touch0[1];else return;Q.zoom("touch",i(E(K,ae,Ae),Q.extent,l))}}function H(G,...J){if(this.__zooming){var Q=B(this,J).event(G),V=G.changedTouches,z=V.length,te,K;for(JI(G),g&&clearTimeout(g),g=setTimeout(function(){g=null},m),te=0;te<z;++te)K=V[te],Q.touch0&&Q.touch0[2]===K.identifier?delete Q.touch0:Q.touch1&&Q.touch1[2]===K.identifier&&delete Q.touch1;if(Q.touch1&&!Q.touch0&&(Q.touch0=Q.touch1,delete Q.touch1),Q.touch0)Q.touch0[1]=this.__zoom.invert(Q.touch0[0]);else if(Q.end(),Q.taps===2&&(K=mh(K,this),Math.hypot(f[0]-K[0],f[1]-K[1])<v)){var ae=Rc(this).on("dblclick.zoom");ae&&ae.apply(this,arguments)}}}return _.wheelDelta=function(G){return arguments.length?(n=typeof G=="function"?G:uE(+G),_):n},_.filter=function(G){return arguments.length?(r=typeof G=="function"?G:uE(!!G),_):r},_.touchable=function(G){return arguments.length?(s=typeof G=="function"?G:uE(!!G),_):s},_.extent=function(G){return arguments.length?(e=typeof G=="function"?G:uE([[+G[0][0],+G[0][1]],[+G[1][0],+G[1][1]]]),_):e},_.scaleExtent=function(G){return arguments.length?(o[0]=+G[0],o[1]=+G[1],_):[o[0],o[1]]},_.translateExtent=function(G){return arguments.length?(l[0][0]=+G[0][0],l[1][0]=+G[1][0],l[0][1]=+G[0][1],l[1][1]=+G[1][1],_):[[l[0][0],l[0][1]],[l[1][0],l[1][1]]]},_.constrain=function(G){return arguments.length?(i=G,_):i},_.duration=function(G){return arguments.length?(u=+G,_):u},_.interpolate=function(G){return arguments.length?(c=G,_):c},_.on=function(){var G=h.on.apply(h,arguments);return G===h?_:G},_.clickDistance=function(G){return arguments.length?(b=(G=+G)*G,_):Math.sqrt(b)},_.tapDistance=function(G){return arguments.length?(v=+G,_):v},_}var CEe="Expected a function";function SEe(r,e,i){var n=!0,s=!0;if(typeof r!="function")throw new TypeError(CEe);return Zx(i)&&(n="leading"in i?!!i.leading:n,s="trailing"in i?!!i.trailing:s),y5(r,e,{leading:n,maxWait:e,trailing:s})}function ZI(r,e){(e==null||e>r.length)&&(e=r.length);for(var i=0,n=Array(e);i<e;i++)n[i]=r[i];return n}function TEe(r){if(Array.isArray(r))return ZI(r)}function I9(r,e,i){if(typeof r=="function"?r===e:r.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}function MEe(r,e){if(e.has(r))throw new TypeError("Cannot initialize the same private elements twice on an object")}function REe(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function Gl(r,e){return r.get(I9(r,e))}function B9(r,e,i){MEe(r,e),e.set(r,i)}function N9(r,e,i){return r.set(I9(r,e),i),i}function IEe(r,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,PEe(n.key),n)}}function BEe(r,e,i){return e&&IEe(r.prototype,e),Object.defineProperty(r,"prototype",{writable:!1}),r}function NEe(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function LEe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function DEe(r){return TEe(r)||NEe(r)||kEe(r)||LEe()}function OEe(r,e){if(typeof r!="object"||!r)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var n=i.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}function PEe(r){var e=OEe(r,"string");return typeof e=="symbol"?e:e+""}function kEe(r,e){if(r){if(typeof r=="string")return ZI(r,e);var i={}.toString.call(r).slice(8,-1);return i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set"?Array.from(r):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?ZI(r,e):void 0}}var FEe=123,UEe=function(r){return"#".concat(Math.min(r,Math.pow(2,24)).toString(16).padStart(6,"0"))},L9=function(r,e,i){return(r<<16)+(e<<8)+i},zEe=function(r){var e=xr(r).toRgb(),i=e.r,n=e.g,s=e.b;return L9(i,n,s)},D9=function(r,e){return r*FEe%Math.pow(2,e)},lf=new WeakMap,vh=new WeakMap,jEe=function(){function r(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:6;REe(this,r),B9(this,lf,void 0),B9(this,vh,void 0),N9(vh,this,e),this.reset()}return BEe(r,[{key:"reset",value:function(){N9(lf,this,["__reserved for background__"])}},{key:"register",value:function(e){if(Gl(lf,this).length>=Math.pow(2,24-Gl(vh,this)))return null;var i=Gl(lf,this).length,n=D9(i,Gl(vh,this)),s=UEe(i+(n<<24-Gl(vh,this)));return Gl(lf,this).push(e),s}},{key:"lookup",value:function(e){if(!e)return null;var i=typeof e=="string"?zEe(e):L9.apply(void 0,DEe(e));if(!i)return null;var n=i&Math.pow(2,24-Gl(vh,this))-1,s=i>>24-Gl(vh,this)&Math.pow(2,Gl(vh,this))-1;return D9(n,Gl(vh,this))!==s||n>=Gl(lf,this).length?null:Gl(lf,this)[n]}}])}();const{abs:$y,cos:bh,sin:$g,acos:GEe,atan2:ev,sqrt:Od,pow:Vl}=Math;function tv(r){return r<0?-Vl(-r,1/3):Vl(r,1/3)}const O9=Math.PI,hE=2*O9,Pd=O9/2,VEe=1e-6,$I=Number.MAX_SAFE_INTEGER||9007199254740991,eB=Number.MIN_SAFE_INTEGER||-9007199254740991,HEe={x:0,y:0,z:0},Mi={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(r,e){const i=e(r);let n=i.x*i.x+i.y*i.y;return typeof i.z<"u"&&(n+=i.z*i.z),Od(n)},compute:function(r,e,i){if(r===0)return e[0].t=0,e[0];const n=e.length-1;if(r===1)return e[n].t=1,e[n];const s=1-r;let o=e;if(n===0)return e[0].t=r,e[0];if(n===1){const u={x:s*o[0].x+r*o[1].x,y:s*o[0].y+r*o[1].y,t:r};return i&&(u.z=s*o[0].z+r*o[1].z),u}if(n<4){let u=s*s,c=r*r,h,p,f,g=0;n===2?(o=[o[0],o[1],o[2],HEe],h=u,p=s*r*2,f=c):n===3&&(h=u*s,p=u*r*3,f=s*c*3,g=r*c);const m={x:h*o[0].x+p*o[1].x+f*o[2].x+g*o[3].x,y:h*o[0].y+p*o[1].y+f*o[2].y+g*o[3].y,t:r};return i&&(m.z=h*o[0].z+p*o[1].z+f*o[2].z+g*o[3].z),m}const l=JSON.parse(JSON.stringify(e));for(;l.length>1;){for(let u=0;u<l.length-1;u++)l[u]={x:l[u].x+(l[u+1].x-l[u].x)*r,y:l[u].y+(l[u+1].y-l[u].y)*r},typeof l[u].z<"u"&&(l[u].z=l[u].z+(l[u+1].z-l[u].z)*r);l.splice(l.length-1,1)}return l[0].t=r,l[0]},computeWithRatios:function(r,e,i,n){const s=1-r,o=i,l=e;let u=o[0],c=o[1],h=o[2],p=o[3],f;if(u*=s,c*=r,l.length===2)return f=u+c,{x:(u*l[0].x+c*l[1].x)/f,y:(u*l[0].y+c*l[1].y)/f,z:n?(u*l[0].z+c*l[1].z)/f:!1,t:r};if(u*=s,c*=2*s,h*=r*r,l.length===3)return f=u+c+h,{x:(u*l[0].x+c*l[1].x+h*l[2].x)/f,y:(u*l[0].y+c*l[1].y+h*l[2].y)/f,z:n?(u*l[0].z+c*l[1].z+h*l[2].z)/f:!1,t:r};if(u*=s,c*=1.5*s,h*=3*s,p*=r*r*r,l.length===4)return f=u+c+h+p,{x:(u*l[0].x+c*l[1].x+h*l[2].x+p*l[3].x)/f,y:(u*l[0].y+c*l[1].y+h*l[2].y+p*l[3].y)/f,z:n?(u*l[0].z+c*l[1].z+h*l[2].z+p*l[3].z)/f:!1,t:r}},derive:function(r,e){const i=[];for(let n=r,s=n.length,o=s-1;s>1;s--,o--){const l=[];for(let u=0,c;u<o;u++)c={x:o*(n[u+1].x-n[u].x),y:o*(n[u+1].y-n[u].y)},e&&(c.z=o*(n[u+1].z-n[u].z)),l.push(c);i.push(l),n=l}return i},between:function(r,e,i){return e<=r&&r<=i||Mi.approximately(r,e)||Mi.approximately(r,i)},approximately:function(r,e,i){return $y(r-e)<=(i||VEe)},length:function(r){const e=Mi.Tvalues.length;let i=0;for(let n=0,s;n<e;n++)s=.5*Mi.Tvalues[n]+.5,i+=Mi.Cvalues[n]*Mi.arcfn(s,r);return .5*i},map:function(r,e,i,n,s){const o=i-e,l=s-n,u=r-e,c=u/o;return n+l*c},lerp:function(r,e,i){const n={x:e.x+r*(i.x-e.x),y:e.y+r*(i.y-e.y)};return e.z!==void 0&&i.z!==void 0&&(n.z=e.z+r*(i.z-e.z)),n},pointToString:function(r){let e=r.x+"/"+r.y;return typeof r.z<"u"&&(e+="/"+r.z),e},pointsToString:function(r){return"["+r.map(Mi.pointToString).join(", ")+"]"},copy:function(r){return JSON.parse(JSON.stringify(r))},angle:function(r,e,i){const n=e.x-r.x,s=e.y-r.y,o=i.x-r.x,l=i.y-r.y,u=n*l-s*o,c=n*o+s*l;return ev(u,c)},round:function(r,e){const i=""+r,n=i.indexOf(".");return parseFloat(i.substring(0,n+1+e))},dist:function(r,e){const i=r.x-e.x,n=r.y-e.y;return Od(i*i+n*n)},closest:function(r,e){let i=Vl(2,63),n,s;return r.forEach(function(o,l){s=Mi.dist(e,o),s<i&&(i=s,n=l)}),{mdist:i,mpos:n}},abcratio:function(r,e){if(e!==2&&e!==3)return!1;if(typeof r>"u")r=.5;else if(r===0||r===1)return r;const i=Vl(r,e)+Vl(1-r,e),n=i-1;return $y(n/i)},projectionratio:function(r,e){if(e!==2&&e!==3)return!1;if(typeof r>"u")r=.5;else if(r===0||r===1)return r;const i=Vl(1-r,e),n=Vl(r,e)+i;return i/n},lli8:function(r,e,i,n,s,o,l,u){const c=(r*n-e*i)*(s-l)-(r-i)*(s*u-o*l),h=(r*n-e*i)*(o-u)-(e-n)*(s*u-o*l),p=(r-i)*(o-u)-(e-n)*(s-l);return p==0?!1:{x:c/p,y:h/p}},lli4:function(r,e,i,n){const s=r.x,o=r.y,l=e.x,u=e.y,c=i.x,h=i.y,p=n.x,f=n.y;return Mi.lli8(s,o,l,u,c,h,p,f)},lli:function(r,e){return Mi.lli4(r,r.c,e,e.c)},makeline:function(r,e){return new ys(r.x,r.y,(r.x+e.x)/2,(r.y+e.y)/2,e.x,e.y)},findbbox:function(r){let e=$I,i=$I,n=eB,s=eB;return r.forEach(function(o){const l=o.bbox();e>l.x.min&&(e=l.x.min),i>l.y.min&&(i=l.y.min),n<l.x.max&&(n=l.x.max),s<l.y.max&&(s=l.y.max)}),{x:{min:e,mid:(e+n)/2,max:n,size:n-e},y:{min:i,mid:(i+s)/2,max:s,size:s-i}}},shapeintersections:function(r,e,i,n,s){if(!Mi.bboxoverlap(e,n))return[];const o=[],l=[r.startcap,r.forward,r.back,r.endcap],u=[i.startcap,i.forward,i.back,i.endcap];return l.forEach(function(c){c.virtual||u.forEach(function(h){if(h.virtual)return;const p=c.intersects(h,s);p.length>0&&(p.c1=c,p.c2=h,p.s1=r,p.s2=i,o.push(p))})}),o},makeshape:function(r,e,i){const n=e.points.length,s=r.points.length,o=Mi.makeline(e.points[n-1],r.points[0]),l=Mi.makeline(r.points[s-1],e.points[0]),u={startcap:o,forward:r,back:e,endcap:l,bbox:Mi.findbbox([o,r,e,l])};return u.intersections=function(c){return Mi.shapeintersections(u,u.bbox,c,c.bbox,i)},u},getminmax:function(r,e,i){if(!i)return{min:0,max:0};let n=$I,s=eB,o,l;i.indexOf(0)===-1&&(i=[0].concat(i)),i.indexOf(1)===-1&&i.push(1);for(let u=0,c=i.length;u<c;u++)o=i[u],l=r.get(o),l[e]<n&&(n=l[e]),l[e]>s&&(s=l[e]);return{min:n,mid:(n+s)/2,max:s,size:s-n}},align:function(r,e){const i=e.p1.x,n=e.p1.y,s=-ev(e.p2.y-n,e.p2.x-i),o=function(l){return{x:(l.x-i)*bh(s)-(l.y-n)*$g(s),y:(l.x-i)*$g(s)+(l.y-n)*bh(s)}};return r.map(o)},roots:function(r,e){e=e||{p1:{x:0,y:0},p2:{x:1,y:0}};const i=r.length-1,n=Mi.align(r,e),s=function(I){return 0<=I&&I<=1};if(i===2){const I=n[0].y,D=n[1].y,L=n[2].y,O=I-2*D+L;if(O!==0){const F=-Od(D*D-I*L),q=-I+D,H=-(F+q)/O,G=-(-F+q)/O;return[H,G].filter(s)}else if(D!==L&&O===0)return[(2*D-L)/(2*D-2*L)].filter(s);return[]}const o=n[0].y,l=n[1].y,u=n[2].y,c=n[3].y;let h=-o+3*l-3*u+c,p=3*o-6*l+3*u,f=-3*o+3*l,g=o;if(Mi.approximately(h,0)){if(Mi.approximately(p,0))return Mi.approximately(f,0)?[]:[-g/f].filter(s);const I=Od(f*f-4*p*g),D=2*p;return[(I-f)/D,(-f-I)/D].filter(s)}p/=h,f/=h,g/=h;const m=(3*f-p*p)/3,y=m/3,b=(2*p*p*p-9*p*f+27*g)/27,v=b/2,_=v*v+y*y*y;let C,E,T,R,B;if(_<0){const I=-m/3,D=I*I*I,L=Od(D),O=-b/(2*L),F=O<-1?-1:O>1?1:O,q=GEe(F),H=tv(L),G=2*H;return T=G*bh(q/3)-p/3,R=G*bh((q+hE)/3)-p/3,B=G*bh((q+2*hE)/3)-p/3,[T,R,B].filter(s)}else{if(_===0)return C=v<0?tv(-v):-tv(v),T=2*C-p/3,R=-C-p/3,[T,R].filter(s);{const I=Od(_);return C=tv(-v+I),E=tv(v+I),[C-E-p/3].filter(s)}}},droots:function(r){if(r.length===3){const e=r[0],i=r[1],n=r[2],s=e-2*i+n;if(s!==0){const o=-Od(i*i-e*n),l=-e+i,u=-(o+l)/s,c=-(-o+l)/s;return[u,c]}else if(i!==n&&s===0)return[(2*i-n)/(2*(i-n))];return[]}if(r.length===2){const e=r[0],i=r[1];return e!==i?[e/(e-i)]:[]}return[]},curvature:function(r,e,i,n,s){let o,l,u,c,h=0,p=0;const f=Mi.compute(r,e),g=Mi.compute(r,i),m=f.x*f.x+f.y*f.y;if(n?(o=Od(Vl(f.y*g.z-g.y*f.z,2)+Vl(f.z*g.x-g.z*f.x,2)+Vl(f.x*g.y-g.x*f.y,2)),l=Vl(m+f.z*f.z,3/2)):(o=f.x*g.y-f.y*g.x,l=Vl(m,3/2)),o===0||l===0)return{k:0,r:0};if(h=o/l,p=l/o,!s){const y=Mi.curvature(r-.001,e,i,n,!0).k,b=Mi.curvature(r+.001,e,i,n,!0).k;c=(b-h+(h-y))/2,u=($y(b-h)+$y(h-y))/2}return{k:h,r:p,dk:c,adk:u}},inflections:function(r){if(r.length<4)return[];const e=Mi.align(r,{p1:r[0],p2:r.slice(-1)[0]}),i=e[2].x*e[1].y,n=e[3].x*e[1].y,s=e[1].x*e[2].y,o=e[3].x*e[2].y,l=18*(-3*i+2*n+3*s-o),u=18*(3*i-n-3*s),c=18*(s-i);if(Mi.approximately(l,0)){if(!Mi.approximately(u,0)){let g=-c/u;if(0<=g&&g<=1)return[g]}return[]}const h=2*l;if(Mi.approximately(h,0))return[];const p=u*u-4*l*c;if(p<0)return[];const f=Math.sqrt(p);return[(f-u)/h,-(u+f)/h].filter(function(g){return 0<=g&&g<=1})},bboxoverlap:function(r,e){const i=["x","y"],n=i.length;for(let s=0,o,l,u,c;s<n;s++)if(o=i[s],l=r[o].mid,u=e[o].mid,c=(r[o].size+e[o].size)/2,$y(l-u)>=c)return!1;return!0},expandbox:function(r,e){e.x.min<r.x.min&&(r.x.min=e.x.min),e.y.min<r.y.min&&(r.y.min=e.y.min),e.z&&e.z.min<r.z.min&&(r.z.min=e.z.min),e.x.max>r.x.max&&(r.x.max=e.x.max),e.y.max>r.y.max&&(r.y.max=e.y.max),e.z&&e.z.max>r.z.max&&(r.z.max=e.z.max),r.x.mid=(r.x.min+r.x.max)/2,r.y.mid=(r.y.min+r.y.max)/2,r.z&&(r.z.mid=(r.z.min+r.z.max)/2),r.x.size=r.x.max-r.x.min,r.y.size=r.y.max-r.y.min,r.z&&(r.z.size=r.z.max-r.z.min)},pairiteration:function(r,e,i){const n=r.bbox(),s=e.bbox(),o=1e5,l=i||.5;if(n.x.size+n.y.size<l&&s.x.size+s.y.size<l)return[(o*(r._t1+r._t2)/2|0)/o+"/"+(o*(e._t1+e._t2)/2|0)/o];let u=r.split(.5),c=e.split(.5),h=[{left:u.left,right:c.left},{left:u.left,right:c.right},{left:u.right,right:c.right},{left:u.right,right:c.left}];h=h.filter(function(f){return Mi.bboxoverlap(f.left.bbox(),f.right.bbox())});let p=[];return h.length===0||(h.forEach(function(f){p=p.concat(Mi.pairiteration(f.left,f.right,l))}),p=p.filter(function(f,g){return p.indexOf(f)===g})),p},getccenter:function(r,e,i){const n=e.x-r.x,s=e.y-r.y,o=i.x-e.x,l=i.y-e.y,u=n*bh(Pd)-s*$g(Pd),c=n*$g(Pd)+s*bh(Pd),h=o*bh(Pd)-l*$g(Pd),p=o*$g(Pd)+l*bh(Pd),f=(r.x+e.x)/2,g=(r.y+e.y)/2,m=(e.x+i.x)/2,y=(e.y+i.y)/2,b=f+u,v=g+c,_=m+h,C=y+p,E=Mi.lli8(f,g,b,v,m,y,_,C),T=Mi.dist(E,r);let R=ev(r.y-E.y,r.x-E.x),B=ev(e.y-E.y,e.x-E.x),I=ev(i.y-E.y,i.x-E.x),D;return R<I?((R>B||B>I)&&(R+=hE),R>I&&(D=I,I=R,R=D)):I<B&&B<R?(D=I,I=R,R=D):I+=hE,E.s=R,E.e=I,E.r=T,E},numberSort:function(r,e){return r-e}};class iv{constructor(e){this.curves=[],this._3d=!1,e&&(this.curves=e,this._3d=this.curves[0]._3d)}valueOf(){return this.toString()}toString(){return"["+this.curves.map(function(e){return Mi.pointsToString(e.points)}).join(", ")+"]"}addCurve(e){this.curves.push(e),this._3d=this._3d||e._3d}length(){return this.curves.map(function(e){return e.length()}).reduce(function(e,i){return e+i})}curve(e){return this.curves[e]}bbox(){const e=this.curves;for(var i=e[0].bbox(),n=1;n<e.length;n++)Mi.expandbox(i,e[n].bbox());return i}offset(e){const i=[];return this.curves.forEach(function(n){i.push(...n.offset(e))}),new iv(i)}}const{abs:rv,min:P9,max:k9,cos:WEe,sin:QEe,acos:qEe,sqrt:nv}=Math,XEe=Math.PI;class ys{constructor(e){let i=e&&e.forEach?e:Array.from(arguments).slice(),n=!1;if(typeof i[0]=="object"){n=i.length;const m=[];i.forEach(function(y){["x","y","z"].forEach(function(b){typeof y[b]<"u"&&m.push(y[b])})}),i=m}let s=!1;const o=i.length;if(n){if(n>4){if(arguments.length!==1)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");s=!0}}else if(o!==6&&o!==8&&o!==9&&o!==12&&arguments.length!==1)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");const l=this._3d=!s&&(o===9||o===12)||e&&e[0]&&typeof e[0].z<"u",u=this.points=[];for(let m=0,y=l?3:2;m<o;m+=y){var c={x:i[m],y:i[m+1]};l&&(c.z=i[m+2]),u.push(c)}const h=this.order=u.length-1,p=this.dims=["x","y"];l&&p.push("z"),this.dimlen=p.length;const f=Mi.align(u,{p1:u[0],p2:u[h]}),g=Mi.dist(u[0],u[h]);this._linear=f.reduce((m,y)=>m+rv(y.y),0)<g/50,this._lut=[],this._t1=0,this._t2=1,this.update()}static quadraticFromPoints(e,i,n,s){if(typeof s>"u"&&(s=.5),s===0)return new ys(i,i,n);if(s===1)return new ys(e,i,i);const o=ys.getABC(2,e,i,n,s);return new ys(e,o.A,n)}static cubicFromPoints(e,i,n,s,o){typeof s>"u"&&(s=.5);const l=ys.getABC(3,e,i,n,s);typeof o>"u"&&(o=Mi.dist(i,l.C));const u=o*(1-s)/s,c=Mi.dist(e,n),h=(n.x-e.x)/c,p=(n.y-e.y)/c,f=o*h,g=o*p,m=u*h,y=u*p,b={x:i.x-f,y:i.y-g},v={x:i.x+m,y:i.y+y},_=l.A,C={x:_.x+(b.x-_.x)/(1-s),y:_.y+(b.y-_.y)/(1-s)},E={x:_.x+(v.x-_.x)/s,y:_.y+(v.y-_.y)/s},T={x:e.x+(C.x-e.x)/s,y:e.y+(C.y-e.y)/s},R={x:n.x+(E.x-n.x)/(1-s),y:n.y+(E.y-n.y)/(1-s)};return new ys(e,T,R,n)}static getUtils(){return Mi}getUtils(){return ys.getUtils()}static get PolyBezier(){return iv}valueOf(){return this.toString()}toString(){return Mi.pointsToString(this.points)}toSVG(){if(this._3d)return!1;const e=this.points,i=e[0].x,n=e[0].y,s=["M",i,n,this.order===2?"Q":"C"];for(let o=1,l=e.length;o<l;o++)s.push(e[o].x),s.push(e[o].y);return s.join(" ")}setRatios(e){if(e.length!==this.points.length)throw new Error("incorrect number of ratio values");this.ratios=e,this._lut=[]}verify(){const e=this.coordDigest();e!==this._print&&(this._print=e,this.update())}coordDigest(){return this.points.map(function(e,i){return""+i+e.x+e.y+(e.z?e.z:0)}).join("")}update(){this._lut=[],this.dpoints=Mi.derive(this.points,this._3d),this.computedirection()}computedirection(){const e=this.points,i=Mi.angle(e[0],e[this.order],e[1]);this.clockwise=i>0}length(){return Mi.length(this.derivative.bind(this))}static getABC(e=2,i,n,s,o=.5){const l=Mi.projectionratio(o,e),u=1-l,c={x:l*i.x+u*s.x,y:l*i.y+u*s.y},h=Mi.abcratio(o,e);return{A:{x:n.x+(n.x-c.x)/h,y:n.y+(n.y-c.y)/h},B:n,C:c,S:i,E:s}}getABC(e,i){i=i||this.get(e);let n=this.points[0],s=this.points[this.order];return ys.getABC(this.order,n,i,s,e)}getLUT(e){if(this.verify(),e=e||100,this._lut.length===e+1)return this._lut;this._lut=[],e++,this._lut=[];for(let i=0,n,s;i<e;i++)s=i/(e-1),n=this.compute(s),n.t=s,this._lut.push(n);return this._lut}on(e,i){i=i||5;const n=this.getLUT(),s=[];for(let o=0,l,u=0;o<n.length;o++)l=n[o],Mi.dist(l,e)<i&&(s.push(l),u+=o/n.length);return s.length?t/=s.length:!1}project(e){const i=this.getLUT(),n=i.length-1,s=Mi.closest(i,e),o=s.mpos,l=(o-1)/n,u=(o+1)/n,c=.1/n;let h=s.mdist,p=l,f=p,g;h+=1;for(let m;p<u+c;p+=c)g=this.compute(p),m=Mi.dist(e,g),m<h&&(h=m,f=p);return f=f<0?0:f>1?1:f,g=this.compute(f),g.t=f,g.d=h,g}get(e){return this.compute(e)}point(e){return this.points[e]}compute(e){return this.ratios?Mi.computeWithRatios(e,this.points,this.ratios,this._3d):Mi.compute(e,this.points,this._3d,this.ratios)}raise(){const e=this.points,i=[e[0]],n=e.length;for(let s=1,o,l;s<n;s++)o=e[s],l=e[s-1],i[s]={x:(n-s)/n*o.x+s/n*l.x,y:(n-s)/n*o.y+s/n*l.y};return i[n]=e[n-1],new ys(i)}derivative(e){return Mi.compute(e,this.dpoints[0],this._3d)}dderivative(e){return Mi.compute(e,this.dpoints[1],this._3d)}align(){let e=this.points;return new ys(Mi.align(e,{p1:e[0],p2:e[e.length-1]}))}curvature(e){return Mi.curvature(e,this.dpoints[0],this.dpoints[1],this._3d)}inflections(){return Mi.inflections(this.points)}normal(e){return this._3d?this.__normal3(e):this.__normal2(e)}__normal2(e){const i=this.derivative(e),n=nv(i.x*i.x+i.y*i.y);return{t:e,x:-i.y/n,y:i.x/n}}__normal3(e){const i=this.derivative(e),n=this.derivative(e+.01),s=nv(i.x*i.x+i.y*i.y+i.z*i.z),o=nv(n.x*n.x+n.y*n.y+n.z*n.z);i.x/=s,i.y/=s,i.z/=s,n.x/=o,n.y/=o,n.z/=o;const l={x:n.y*i.z-n.z*i.y,y:n.z*i.x-n.x*i.z,z:n.x*i.y-n.y*i.x},u=nv(l.x*l.x+l.y*l.y+l.z*l.z);l.x/=u,l.y/=u,l.z/=u;const c=[l.x*l.x,l.x*l.y-l.z,l.x*l.z+l.y,l.x*l.y+l.z,l.y*l.y,l.y*l.z-l.x,l.x*l.z-l.y,l.y*l.z+l.x,l.z*l.z];return{t:e,x:c[0]*i.x+c[1]*i.y+c[2]*i.z,y:c[3]*i.x+c[4]*i.y+c[5]*i.z,z:c[6]*i.x+c[7]*i.y+c[8]*i.z}}hull(e){let i=this.points,n=[],s=[],o=0;for(s[o++]=i[0],s[o++]=i[1],s[o++]=i[2],this.order===3&&(s[o++]=i[3]);i.length>1;){n=[];for(let l=0,u,c=i.length-1;l<c;l++)u=Mi.lerp(e,i[l],i[l+1]),s[o++]=u,n.push(u);i=n}return s}split(e,i){if(e===0&&i)return this.split(i).left;if(i===1)return this.split(e).right;const n=this.hull(e),s={left:this.order===2?new ys([n[0],n[3],n[5]]):new ys([n[0],n[4],n[7],n[9]]),right:this.order===2?new ys([n[5],n[4],n[2]]):new ys([n[9],n[8],n[6],n[3]]),span:n};return s.left._t1=Mi.map(0,0,1,this._t1,this._t2),s.left._t2=Mi.map(e,0,1,this._t1,this._t2),s.right._t1=Mi.map(e,0,1,this._t1,this._t2),s.right._t2=Mi.map(1,0,1,this._t1,this._t2),i?(i=Mi.map(i,e,1,0,1),s.right.split(i).left):s}extrema(){const e={};let i=[];return this.dims.forEach((function(n){let s=function(l){return l[n]},o=this.dpoints[0].map(s);e[n]=Mi.droots(o),this.order===3&&(o=this.dpoints[1].map(s),e[n]=e[n].concat(Mi.droots(o))),e[n]=e[n].filter(function(l){return l>=0&&l<=1}),i=i.concat(e[n].sort(Mi.numberSort))}).bind(this)),e.values=i.sort(Mi.numberSort).filter(function(n,s){return i.indexOf(n)===s}),e}bbox(){const e=this.extrema(),i={};return this.dims.forEach((function(n){i[n]=Mi.getminmax(this,n,e[n])}).bind(this)),i}overlaps(e){const i=this.bbox(),n=e.bbox();return Mi.bboxoverlap(i,n)}offset(e,i){if(typeof i<"u"){const n=this.get(e),s=this.normal(e),o={c:n,n:s,x:n.x+s.x*i,y:n.y+s.y*i};return this._3d&&(o.z=n.z+s.z*i),o}if(this._linear){const n=this.normal(0),s=this.points.map(function(o){const l={x:o.x+e*n.x,y:o.y+e*n.y};return o.z&&n.z&&(l.z=o.z+e*n.z),l});return[new ys(s)]}return this.reduce().map(function(n){return n._linear?n.offset(e)[0]:n.scale(e)})}simple(){if(this.order===3){const s=Mi.angle(this.points[0],this.points[3],this.points[1]),o=Mi.angle(this.points[0],this.points[3],this.points[2]);if(s>0&&o<0||s<0&&o>0)return!1}const e=this.normal(0),i=this.normal(1);let n=e.x*i.x+e.y*i.y;return this._3d&&(n+=e.z*i.z),rv(qEe(n))<XEe/3}reduce(){let e,i=0,n=0,s=.01,o,l=[],u=[],c=this.extrema().values;for(c.indexOf(0)===-1&&(c=[0].concat(c)),c.indexOf(1)===-1&&c.push(1),i=c[0],e=1;e<c.length;e++)n=c[e],o=this.split(i,n),o._t1=i,o._t2=n,l.push(o),i=n;return l.forEach(function(h){for(i=0,n=0;n<=1;)for(n=i+s;n<=1+s;n+=s)if(o=h.split(i,n),!o.simple()){if(n-=s,rv(i-n)<s)return[];o=h.split(i,n),o._t1=Mi.map(i,0,1,h._t1,h._t2),o._t2=Mi.map(n,0,1,h._t1,h._t2),u.push(o),i=n;break}i<1&&(o=h.split(i,1),o._t1=Mi.map(i,0,1,h._t1,h._t2),o._t2=h._t2,u.push(o))}),u}translate(e,i,n){n=typeof n=="number"?n:i;const s=this.order;let o=this.points.map((l,u)=>(1-u/s)*i+u/s*n);return new ys(this.points.map((l,u)=>({x:l.x+e.x*o[u],y:l.y+e.y*o[u]})))}scale(e){const i=this.order;let n=!1;if(typeof e=="function"&&(n=e),n&&i===2)return this.raise().scale(n);const s=this.clockwise,o=this.points;if(this._linear)return this.translate(this.normal(0),n?n(0):e,n?n(1):e);const l=n?n(0):e,u=n?n(1):e,c=[this.offset(0,10),this.offset(1,10)],h=[],p=Mi.lli4(c[0],c[0].c,c[1],c[1].c);if(!p)throw new Error("cannot scale this curve. Try reducing it first.");return[0,1].forEach(function(f){const g=h[f*i]=Mi.copy(o[f*i]);g.x+=(f?u:l)*c[f].n.x,g.y+=(f?u:l)*c[f].n.y}),n?([0,1].forEach(function(f){if(!(i===2&&f)){var g=o[f+1],m={x:g.x-p.x,y:g.y-p.y},y=n?n((f+1)/i):e;n&&!s&&(y=-y);var b=nv(m.x*m.x+m.y*m.y);m.x/=b,m.y/=b,h[f+1]={x:g.x+y*m.x,y:g.y+y*m.y}}}),new ys(h)):([0,1].forEach(f=>{if(i===2&&f)return;const g=h[f*i],m=this.derivative(f),y={x:g.x+m.x,y:g.y+m.y};h[f+1]=Mi.lli4(g,y,p,o[f+1])}),new ys(h))}outline(e,i,n,s){if(i=i===void 0?e:i,this._linear){const R=this.normal(0),B=this.points[0],I=this.points[this.points.length-1];let D,L,O;n===void 0&&(n=e,s=i),D={x:B.x+R.x*e,y:B.y+R.y*e},O={x:I.x+R.x*n,y:I.y+R.y*n},L={x:(D.x+O.x)/2,y:(D.y+O.y)/2};const F=[D,L,O];D={x:B.x-R.x*i,y:B.y-R.y*i},O={x:I.x-R.x*s,y:I.y-R.y*s},L={x:(D.x+O.x)/2,y:(D.y+O.y)/2};const q=[O,L,D],H=Mi.makeline(q[2],F[0]),G=Mi.makeline(F[2],q[0]),J=[H,new ys(F),G,new ys(q)];return new iv(J)}const o=this.reduce(),l=o.length,u=[];let c=[],h,p=0,f=this.length();const g=typeof n<"u"&&typeof s<"u";function m(R,B,I,D,L){return function(O){const F=D/I,q=(D+L)/I,H=B-R;return Mi.map(O,0,1,R+F*H,R+q*H)}}o.forEach(function(R){const B=R.length();g?(u.push(R.scale(m(e,n,f,p,B))),c.push(R.scale(m(-i,-s,f,p,B)))):(u.push(R.scale(e)),c.push(R.scale(-i))),p+=B}),c=c.map(function(R){return h=R.points,h[3]?R.points=[h[3],h[2],h[1],h[0]]:R.points=[h[2],h[1],h[0]],R}).reverse();const y=u[0].points[0],b=u[l-1].points[u[l-1].points.length-1],v=c[l-1].points[c[l-1].points.length-1],_=c[0].points[0],C=Mi.makeline(v,y),E=Mi.makeline(b,_),T=[C].concat(u).concat([E]).concat(c);return new iv(T)}outlineshapes(e,i,n){i=i||e;const s=this.outline(e,i).curves,o=[];for(let l=1,u=s.length;l<u/2;l++){const c=Mi.makeshape(s[l],s[u-l],n);c.startcap.virtual=l>1,c.endcap.virtual=l<u/2-1,o.push(c)}return o}intersects(e,i){return e?e.p1&&e.p2?this.lineIntersects(e):(e instanceof ys&&(e=e.reduce()),this.curveintersects(this.reduce(),e,i)):this.selfintersects(i)}lineIntersects(e){const i=P9(e.p1.x,e.p2.x),n=P9(e.p1.y,e.p2.y),s=k9(e.p1.x,e.p2.x),o=k9(e.p1.y,e.p2.y);return Mi.roots(this.points,e).filter(l=>{var u=this.get(l);return Mi.between(u.x,i,s)&&Mi.between(u.y,n,o)})}selfintersects(e){const i=this.reduce(),n=i.length-2,s=[];for(let o=0,l,u,c;o<n;o++)u=i.slice(o,o+1),c=i.slice(o+2),l=this.curveintersects(u,c,e),s.push(...l);return s}curveintersects(e,i,n){const s=[];e.forEach(function(l){i.forEach(function(u){l.overlaps(u)&&s.push({left:l,right:u})})});let o=[];return s.forEach(function(l){const u=Mi.pairiteration(l.left,l.right,n);u.length>0&&(o=o.concat(u))}),o}arcs(e){return e=e||.5,this._iterate(e,[])}_error(e,i,n,s){const o=(s-n)/4,l=this.get(n+o),u=this.get(s-o),c=Mi.dist(e,i),h=Mi.dist(e,l),p=Mi.dist(e,u);return rv(h-c)+rv(p-c)}_iterate(e,i){let n=0,s=1,o;do{o=0,s=1;let l=this.get(n),u,c,h,p,f=!1,g=!1,m,y=s,b=1;do if(g=f,p=h,y=(n+s)/2,u=this.get(y),c=this.get(s),h=Mi.getccenter(l,u,c),h.interval={start:n,end:s},f=this._error(h,l,n,s)<=e,m=g&&!f,m||(b=s),f){if(s>=1){if(h.interval.end=b=1,p=h,s>1){let v={x:h.x+h.r*WEe(h.e),y:h.y+h.r*QEe(h.e)};h.e+=Mi.angle({x:h.x,y:h.y},v,this.get(1))}break}s=s+(s-n)/2}else s=y;while(!m&&o++<100);if(o>=100)break;p=p||h,i.push(p),n=b}while(s<1);return i}}function KEe(r,e){e===void 0&&(e={});var i=e.insertAt;if(!(typeof document>"u")){var n=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css",i==="top"&&n.firstChild?n.insertBefore(s,n.firstChild):n.appendChild(s),s.styleSheet?s.styleSheet.cssText=r:s.appendChild(document.createTextNode(r))}}var YEe=`.force-graph-container canvas {
  display: block;
  user-select: none;
  outline: none;
  -webkit-tap-highlight-color: transparent;
}

.force-graph-container .graph-tooltip {
  position: absolute;
  top: 0;
  font-family: sans-serif;
  font-size: 16px;
  padding: 4px;
  border-radius: 3px;
  color: #eee;
  background: rgba(0,0,0,0.65);
  visibility: hidden; /* by default */
}

.force-graph-container .clickable {
  cursor: pointer;
}

.force-graph-container .grabbable {
  cursor: move;
  cursor: grab;
  cursor: -moz-grab;
  cursor: -webkit-grab;
}

.force-graph-container .grabbable:active {
  cursor: grabbing;
  cursor: -moz-grabbing;
  cursor: -webkit-grabbing;
}
`;KEe(YEe);function tB(r,e){(e==null||e>r.length)&&(e=r.length);for(var i=0,n=Array(e);i<e;i++)n[i]=r[i];return n}function JEe(r){if(Array.isArray(r))return r}function ZEe(r){if(Array.isArray(r))return tB(r)}function F9(r,e,i){if(U9())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,e);var s=new(r.bind.apply(r,n));return s}function sv(r,e,i){return(e=nwe(e))in r?Object.defineProperty(r,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[e]=i,r}function U9(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(U9=function(){return!!r})()}function $Ee(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function ewe(r,e){var i=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(i!=null){var n,s,o,l,u=[],c=!0,h=!1;try{if(o=(i=i.call(r)).next,e!==0)for(;!(c=(n=o.call(i)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(p){h=!0,s=p}finally{try{if(!c&&i.return!=null&&(l=i.return(),Object(l)!==l))return}finally{if(h)throw s}}return u}}function twe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function iwe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function z9(r,e){var i=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),i.push.apply(i,n)}return i}function e0(r){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?z9(Object(i),!0).forEach(function(n){sv(r,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):z9(Object(i)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(i,n))})}return r}function av(r,e){return JEe(r)||ewe(r,e)||j9(r,e)||twe()}function Hl(r){return ZEe(r)||$Ee(r)||j9(r)||iwe()}function rwe(r,e){if(typeof r!="object"||!r)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var n=i.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function nwe(r){var e=rwe(r,"string");return typeof e=="symbol"?e:e+""}function iB(r){"@babel/helpers - typeof";return iB=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},iB(r)}function j9(r,e){if(r){if(typeof r=="string")return tB(r,e);var i={}.toString.call(r).slice(8,-1);return i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set"?Array.from(r):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?tB(r,e):void 0}}var swe=YT(Q5);function G9(r,e,i){!e||typeof i!="string"||r.filter(function(n){return!n[i]}).forEach(function(n){n[i]=swe(e(n))})}function awe(r,e){var i=r.nodes,n=r.links,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=s.nodeFilter,l=o===void 0?function(){return!0}:o,u=s.onLoopError,c=u===void 0?function(m){throw"Invalid DAG structure! Found cycle in node path: ".concat(m.join(" -> "),".")}:u,h={};i.forEach(function(m){return h[e(m)]={data:m,out:[],depth:-1,skip:!l(m)}}),n.forEach(function(m){var y=m.source,b=m.target,v=T(y),_=T(b);if(!h.hasOwnProperty(v))throw"Missing source node with id: ".concat(v);if(!h.hasOwnProperty(_))throw"Missing target node with id: ".concat(_);var C=h[v],E=h[_];C.out.push(E);function T(R){return iB(R)==="object"?e(R):R}});var p=[];g(Object.values(h));var f=Object.assign.apply(Object,[{}].concat(Hl(Object.entries(h).filter(function(m){var y=av(m,2),b=y[1];return!b.skip}).map(function(m){var y=av(m,2),b=y[0],v=y[1];return sv({},b,v.depth)}))));return f;function g(m){for(var y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,v=function(){var E=m[_];if(y.indexOf(E)!==-1){var T=[].concat(Hl(y.slice(y.indexOf(E))),[E]).map(function(R){return e(R.data)});return p.some(function(R){return R.length===T.length&&R.every(function(B,I){return B===T[I]})})||(p.push(T),c(T)),1}b>E.depth&&(E.depth=b,g(E.out,[].concat(Hl(y),[E]),b+(E.skip?0:1)))},_=0,C=m.length;_<C;_++)v()}}var owe=2,lo=function(r,e){return e.onNeedsRedraw&&e.onNeedsRedraw()},V9=function(r,e){if(!e.isShadow){var i=gr(e.linkDirectionalParticles);e.graphData.links.forEach(function(n){var s=Math.round(Math.abs(i(n)));s?n.__photons=Hl(Array(s)).map(function(){return{}}):delete n.__photons})}},dE=Rp({props:{graphData:{default:{nodes:[],links:[]},onChange:function(r,e){e.engineRunning=!1,V9(r,e)}},dagMode:{onChange:function(r,e){!r&&(e.graphData.nodes||[]).forEach(function(i){return i.fx=i.fy=void 0})}},dagLevelDistance:{},dagNodeFilter:{default:function(r){return!0}},onDagError:{triggerUpdate:!1},nodeRelSize:{default:4,triggerUpdate:!1,onChange:lo},nodeId:{default:"id"},nodeVal:{default:"val",triggerUpdate:!1,onChange:lo},nodeColor:{default:"color",triggerUpdate:!1,onChange:lo},nodeAutoColorBy:{},nodeCanvasObject:{triggerUpdate:!1,onChange:lo},nodeCanvasObjectMode:{default:function(){return"replace"},triggerUpdate:!1,onChange:lo},nodeVisibility:{default:!0,triggerUpdate:!1,onChange:lo},linkSource:{default:"source"},linkTarget:{default:"target"},linkVisibility:{default:!0,triggerUpdate:!1,onChange:lo},linkColor:{default:"color",triggerUpdate:!1,onChange:lo},linkAutoColorBy:{},linkLineDash:{triggerUpdate:!1,onChange:lo},linkWidth:{default:1,triggerUpdate:!1,onChange:lo},linkCurvature:{default:0,triggerUpdate:!1,onChange:lo},linkCanvasObject:{triggerUpdate:!1,onChange:lo},linkCanvasObjectMode:{default:function(){return"replace"},triggerUpdate:!1,onChange:lo},linkDirectionalArrowLength:{default:0,triggerUpdate:!1,onChange:lo},linkDirectionalArrowColor:{triggerUpdate:!1,onChange:lo},linkDirectionalArrowRelPos:{default:.5,triggerUpdate:!1,onChange:lo},linkDirectionalParticles:{default:0,triggerUpdate:!1,onChange:V9},linkDirectionalParticleSpeed:{default:.01,triggerUpdate:!1},linkDirectionalParticleWidth:{default:4,triggerUpdate:!1},linkDirectionalParticleColor:{triggerUpdate:!1},globalScale:{default:1,triggerUpdate:!1},d3AlphaMin:{default:0,triggerUpdate:!1},d3AlphaDecay:{default:.0228,triggerUpdate:!1,onChange:function(r,e){e.forceLayout.alphaDecay(r)}},d3AlphaTarget:{default:0,triggerUpdate:!1,onChange:function(r,e){e.forceLayout.alphaTarget(r)}},d3VelocityDecay:{default:.4,triggerUpdate:!1,onChange:function(r,e){e.forceLayout.velocityDecay(r)}},warmupTicks:{default:0,triggerUpdate:!1},cooldownTicks:{default:1/0,triggerUpdate:!1},cooldownTime:{default:15e3,triggerUpdate:!1},onUpdate:{default:function(){},triggerUpdate:!1},onFinishUpdate:{default:function(){},triggerUpdate:!1},onEngineTick:{default:function(){},triggerUpdate:!1},onEngineStop:{default:function(){},triggerUpdate:!1},onNeedsRedraw:{triggerUpdate:!1},isShadow:{default:!1,triggerUpdate:!1}},methods:{d3Force:function(r,e,i){return i===void 0?r.forceLayout.force(e):(r.forceLayout.force(e,i),this)},d3ReheatSimulation:function(r){return r.forceLayout.alpha(1),this.resetCountdown(),this},resetCountdown:function(r){return r.cntTicks=0,r.startTickTime=new Date,r.engineRunning=!0,this},isEngineRunning:function(r){return!!r.engineRunning},tickFrame:function(r){return!r.isShadow&&e(),n(),!r.isShadow&&s(),!r.isShadow&&o(),i(),this;function e(){r.engineRunning&&(++r.cntTicks>r.cooldownTicks||new Date-r.startTickTime>r.cooldownTime||r.d3AlphaMin>0&&r.forceLayout.alpha()<r.d3AlphaMin?(r.engineRunning=!1,r.onEngineStop()):(r.forceLayout.tick(),r.onEngineTick()))}function i(){var l=gr(r.nodeVisibility),u=gr(r.nodeVal),c=gr(r.nodeColor),h=gr(r.nodeCanvasObjectMode),p=r.ctx,f=r.isShadow/r.globalScale,g=r.graphData.nodes.filter(l);p.save(),g.forEach(function(m){var y=h(m);if(r.nodeCanvasObject&&(y==="before"||y==="replace")&&(r.nodeCanvasObject(m,p,r.globalScale),y==="replace")){p.restore();return}var b=Math.sqrt(Math.max(0,u(m)||1))*r.nodeRelSize+f;p.beginPath(),p.arc(m.x,m.y,b,0,2*Math.PI,!1),p.fillStyle=c(m)||"rgba(31, 120, 180, 0.92)",p.fill(),r.nodeCanvasObject&&y==="after"&&r.nodeCanvasObject(m,r.ctx,r.globalScale)}),p.restore()}function n(){var l=gr(r.linkVisibility),u=gr(r.linkColor),c=gr(r.linkWidth),h=gr(r.linkLineDash),p=gr(r.linkCurvature),f=gr(r.linkCanvasObjectMode),g=r.ctx,m=r.isShadow*2,y=r.graphData.links.filter(l);y.forEach(R);var b=[],v=[],_=y;if(r.linkCanvasObject){var C=[],E=[];y.forEach(function(B){return({before:b,after:v,replace:C}[f(B)]||E).push(B)}),_=[].concat(Hl(b),v,E),b=b.concat(C)}g.save(),b.forEach(function(B){return r.linkCanvasObject(B,g,r.globalScale)}),g.restore();var T=XT(_,[u,c,h]);g.save(),Object.entries(T).forEach(function(B){var I=av(B,2),D=I[0],L=I[1],O=!D||D==="undefined"?"rgba(0,0,0,0.15)":D;Object.entries(L).forEach(function(F){var q=av(F,2),H=q[0],G=q[1],J=(H||1)/r.globalScale+m;Object.entries(G).forEach(function(Q){var V=av(Q,2);V[0];var z=V[1],te=h(z[0]);g.beginPath(),z.forEach(function(K){var ae=K.source,Ae=K.target;if(!(!ae||!Ae||!ae.hasOwnProperty("x")||!Ae.hasOwnProperty("x"))){g.moveTo(ae.x,ae.y);var _e=K.__controlPoints;_e?g[_e.length===2?"quadraticCurveTo":"bezierCurveTo"].apply(g,Hl(_e).concat([Ae.x,Ae.y])):g.lineTo(Ae.x,Ae.y)}}),g.strokeStyle=O,g.lineWidth=J,g.setLineDash(te||[]),g.stroke()})})}),g.restore(),g.save(),v.forEach(function(B){return r.linkCanvasObject(B,g,r.globalScale)}),g.restore();function R(B){var I=p(B);if(!I){B.__controlPoints=null;return}var D=B.source,L=B.target;if(!(!D||!L||!D.hasOwnProperty("x")||!L.hasOwnProperty("x"))){var O=Math.sqrt(Math.pow(L.x-D.x,2)+Math.pow(L.y-D.y,2));if(O>0){var F=Math.atan2(L.y-D.y,L.x-D.x),q=O*I,H={x:(D.x+L.x)/2+q*Math.cos(F-Math.PI/2),y:(D.y+L.y)/2+q*Math.sin(F-Math.PI/2)};B.__controlPoints=[H.x,H.y]}else{var G=I*70;B.__controlPoints=[L.x,L.y-G,L.x+G,L.y]}}}}function s(){var l=1.6,u=.2,c=gr(r.linkDirectionalArrowLength),h=gr(r.linkDirectionalArrowRelPos),p=gr(r.linkVisibility),f=gr(r.linkDirectionalArrowColor||r.linkColor),g=gr(r.nodeVal),m=r.ctx;m.save(),r.graphData.links.filter(p).forEach(function(y){var b=c(y);if(!(!b||b<0)){var v=y.source,_=y.target;if(!(!v||!_||!v.hasOwnProperty("x")||!_.hasOwnProperty("x"))){var C=Math.sqrt(Math.max(0,g(v)||1))*r.nodeRelSize,E=Math.sqrt(Math.max(0,g(_)||1))*r.nodeRelSize,T=Math.min(1,Math.max(0,h(y))),R=f(y)||"rgba(0,0,0,0.28)",B=b/l/2,I=y.__controlPoints&&F9(ys,[v.x,v.y].concat(Hl(y.__controlPoints),[_.x,_.y])),D=I?function(J){return I.get(J)}:function(J){return{x:v.x+(_.x-v.x)*J||0,y:v.y+(_.y-v.y)*J||0}},L=I?I.length():Math.sqrt(Math.pow(_.x-v.x,2)+Math.pow(_.y-v.y,2)),O=C+b+(L-C-E-b)*T,F=D(O/L),q=D((O-b)/L),H=D((O-b*(1-u))/L),G=Math.atan2(F.y-q.y,F.x-q.x)-Math.PI/2;m.beginPath(),m.moveTo(F.x,F.y),m.lineTo(q.x+B*Math.cos(G),q.y+B*Math.sin(G)),m.lineTo(H.x,H.y),m.lineTo(q.x-B*Math.cos(G),q.y-B*Math.sin(G)),m.fillStyle=R,m.fill()}}}),m.restore()}function o(){var l=gr(r.linkDirectionalParticles),u=gr(r.linkDirectionalParticleSpeed),c=gr(r.linkDirectionalParticleWidth),h=gr(r.linkVisibility),p=gr(r.linkDirectionalParticleColor||r.linkColor),f=r.ctx;f.save(),r.graphData.links.filter(h).forEach(function(g){var m=l(g);if(!(!g.hasOwnProperty("__photons")||!g.__photons.length)){var y=g.source,b=g.target;if(!(!y||!b||!y.hasOwnProperty("x")||!b.hasOwnProperty("x"))){var v=u(g),_=g.__photons||[],C=Math.max(0,c(g)/2)/Math.sqrt(r.globalScale),E=p(g)||"rgba(0,0,0,0.28)";f.fillStyle=E;var T=g.__controlPoints?F9(ys,[y.x,y.y].concat(Hl(g.__controlPoints),[b.x,b.y])):null,R=0,B=!1;_.forEach(function(I){var D=!!I.__singleHop;if(I.hasOwnProperty("__progressRatio")||(I.__progressRatio=D?0:R/m),!D&&R++,I.__progressRatio+=v,I.__progressRatio>=1)if(!D)I.__progressRatio=I.__progressRatio%1;else{B=!0;return}var L=I.__progressRatio,O=T?T.get(L):{x:y.x+(b.x-y.x)*L||0,y:y.y+(b.y-y.y)*L||0};f.beginPath(),f.arc(O.x,O.y,C,0,2*Math.PI,!1),f.fill()}),B&&(g.__photons=g.__photons.filter(function(I){return!I.__singleHop||I.__progressRatio<=1}))}}}),f.restore()}},emitParticle:function(r,e){return e&&(!e.__photons&&(e.__photons=[]),e.__photons.push({__singleHop:!0})),this}},stateInit:function(){return{forceLayout:Gk().force("link",Lk()).force("charge",Vk()).force("center",_k()).force("dagRadial",null).stop(),engineRunning:!1}},init:function(r,e){e.ctx=r},update:function(r,e){r.engineRunning=!1,r.onUpdate(),r.nodeAutoColorBy!==null&&G9(r.graphData.nodes,gr(r.nodeAutoColorBy),r.nodeColor),r.linkAutoColorBy!==null&&G9(r.graphData.links,gr(r.linkAutoColorBy),r.linkColor),r.graphData.links.forEach(function(f){f.source=f[r.linkSource],f.target=f[r.linkTarget]}),r.forceLayout.stop().alpha(1).nodes(r.graphData.nodes);var i=r.forceLayout.force("link");i&&i.id(function(f){return f[r.nodeId]}).links(r.graphData.links);var n=r.dagMode&&awe(r.graphData,function(f){return f[r.nodeId]},{nodeFilter:r.dagNodeFilter,onLoopError:r.onDagError||void 0}),s=Math.max.apply(Math,Hl(Object.values(n||[]))),o=r.dagLevelDistance||r.graphData.nodes.length/(s||1)*owe*(["radialin","radialout"].indexOf(r.dagMode)!==-1?.7:1);if(["lr","rl","td","bu"].includes(e.dagMode)){var l=["lr","rl"].includes(e.dagMode)?"fx":"fy";r.graphData.nodes.filter(r.dagNodeFilter).forEach(function(f){return delete f[l]})}if(["lr","rl","td","bu"].includes(r.dagMode)){var u=["rl","bu"].includes(r.dagMode),c=function(f){return(n[f[r.nodeId]]-s/2)*o*(u?-1:1)},h=["lr","rl"].includes(r.dagMode)?"fx":"fy";r.graphData.nodes.filter(r.dagNodeFilter).forEach(function(f){return f[h]=c(f)})}r.forceLayout.force("dagRadial",["radialin","radialout"].indexOf(r.dagMode)!==-1?Hk(function(f){var g=n[f[r.nodeId]]||-1;return(r.dagMode==="radialin"?s-g:g)*o}).strength(function(f){return r.dagNodeFilter(f)?1:0}):null);for(var p=0;p<r.warmupTicks&&!(r.d3AlphaMin>0&&r.forceLayout.alpha()<r.d3AlphaMin);p++)r.forceLayout.tick();this.resetCountdown(),r.onFinishUpdate()}});function H9(r,e){var i=r instanceof Array?r:[r],n=new e;return n._destructor&&n._destructor(),{linkProp:function(s){return{default:n[s](),onChange:function(o,l){i.forEach(function(u){return l[u][s](o)})},triggerUpdate:!1}},linkMethod:function(s){return function(o){for(var l=arguments.length,u=new Array(l>1?l-1:0),c=1;c<l;c++)u[c-1]=arguments[c];var h=[];return i.forEach(function(p){var f=o[p],g=f[s].apply(f,u);g!==f&&h.push(g)}),h.length?h[0]:this}}}}var lwe=800,cwe=4,W9=H9("forceGraph",dE),uwe=H9(["forceGraph","shadowGraph"],dE),hwe=Object.assign.apply(Object,Hl(["nodeColor","nodeAutoColorBy","nodeCanvasObject","nodeCanvasObjectMode","linkColor","linkAutoColorBy","linkLineDash","linkWidth","linkCanvasObject","linkCanvasObjectMode","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","dagMode","dagLevelDistance","dagNodeFilter","onDagError","d3AlphaMin","d3AlphaDecay","d3VelocityDecay","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"].map(function(r){return sv({},r,W9.linkProp(r))})).concat(Hl(["nodeRelSize","nodeId","nodeVal","nodeVisibility","linkSource","linkTarget","linkVisibility","linkCurvature"].map(function(r){return sv({},r,uwe.linkProp(r))})))),dwe=Object.assign.apply(Object,Hl(["d3Force","d3ReheatSimulation","emitParticle"].map(function(r){return sv({},r,W9.linkMethod(r))})));function rB(r){if(r.canvas){var e=r.canvas.width,i=r.canvas.height;e===300&&i===150&&(e=i=0);var n=window.devicePixelRatio;e/=n,i/=n,[r.canvas,r.shadowCanvas].forEach(function(o){o.style.width="".concat(r.width,"px"),o.style.height="".concat(r.height,"px"),o.width=r.width*n,o.height=r.height*n,!e&&!i&&o.getContext("2d").scale(n,n)});var s=ru(r.canvas).k;r.zoom.translateBy(r.zoom.__baseElem,(r.width-e)/2/s,(r.height-i)/2/s),r.needsRedraw=!0}}function Q9(r){var e=window.devicePixelRatio;r.setTransform(e,0,0,e,0,0)}function q9(r,e,i){r.save(),Q9(r),r.clearRect(0,0,e,i),r.restore()}var pwe=Rp({props:e0({width:{default:window.innerWidth,onChange:function(r,e){return rB(e)},triggerUpdate:!1},height:{default:window.innerHeight,onChange:function(r,e){return rB(e)},triggerUpdate:!1},graphData:{default:{nodes:[],links:[]},onChange:function(r,e){[r.nodes,r.links].every(function(n){return(n||[]).every(function(s){return!s.hasOwnProperty("__indexColor")})})&&e.colorTracker.reset(),[{type:"Node",objs:r.nodes},{type:"Link",objs:r.links}].forEach(i),e.forceGraph.graphData(r),e.shadowGraph.graphData(r);function i(n){var s=n.type,o=n.objs;o.filter(function(l){if(!l.hasOwnProperty("__indexColor"))return!0;var u=e.colorTracker.lookup(l.__indexColor);return!u||!u.hasOwnProperty("d")||u.d!==l}).forEach(function(l){l.__indexColor=e.colorTracker.register({type:s,d:l})})}},triggerUpdate:!1},backgroundColor:{onChange:function(r,e){e.canvas&&r&&(e.canvas.style.background=r)},triggerUpdate:!1},nodeLabel:{default:"name",triggerUpdate:!1},nodePointerAreaPaint:{onChange:function(r,e){e.shadowGraph.nodeCanvasObject(r?function(i,n,s){return r(i,i.__indexColor,n,s)}:null),e.flushShadowCanvas&&e.flushShadowCanvas()},triggerUpdate:!1},linkPointerAreaPaint:{onChange:function(r,e){e.shadowGraph.linkCanvasObject(r?function(i,n,s){return r(i,i.__indexColor,n,s)}:null),e.flushShadowCanvas&&e.flushShadowCanvas()},triggerUpdate:!1},linkLabel:{default:"name",triggerUpdate:!1},linkHoverPrecision:{default:4,triggerUpdate:!1},minZoom:{default:.01,onChange:function(r,e){e.zoom.scaleExtent([r,e.zoom.scaleExtent()[1]])},triggerUpdate:!1},maxZoom:{default:1e3,onChange:function(r,e){e.zoom.scaleExtent([e.zoom.scaleExtent()[0],r])},triggerUpdate:!1},enableNodeDrag:{default:!0,triggerUpdate:!1},enableZoomInteraction:{default:!0,triggerUpdate:!1},enablePanInteraction:{default:!0,triggerUpdate:!1},enableZoomPanInteraction:{default:!0,triggerUpdate:!1},enablePointerInteraction:{default:!0,onChange:function(r,e){e.hoverObj=null},triggerUpdate:!1},autoPauseRedraw:{default:!0,triggerUpdate:!1},onNodeDrag:{default:function(){},triggerUpdate:!1},onNodeDragEnd:{default:function(){},triggerUpdate:!1},onNodeClick:{triggerUpdate:!1},onNodeRightClick:{triggerUpdate:!1},onNodeHover:{triggerUpdate:!1},onLinkClick:{triggerUpdate:!1},onLinkRightClick:{triggerUpdate:!1},onLinkHover:{triggerUpdate:!1},onBackgroundClick:{triggerUpdate:!1},onBackgroundRightClick:{triggerUpdate:!1},onZoom:{triggerUpdate:!1},onZoomEnd:{triggerUpdate:!1},onRenderFramePre:{triggerUpdate:!1},onRenderFramePost:{triggerUpdate:!1}},hwe),aliases:{stopAnimation:"pauseAnimation"},methods:e0({graph2ScreenCoords:function(r,e,i){var n=ru(r.canvas);return{x:e*n.k+n.x,y:i*n.k+n.y}},screen2GraphCoords:function(r,e,i){var n=ru(r.canvas);return{x:(e-n.x)/n.k,y:(i-n.y)/n.k}},centerAt:function(r,e,i,n){if(!r.canvas)return null;if(e!==void 0||i!==void 0){var s=Object.assign({},e!==void 0?{x:e}:{},i!==void 0?{y:i}:{});return n?r.tweenGroup.add(new $_(o()).to(s,n).easing(ph.Quadratic.Out).onUpdate(l).start()):l(s),this}return o();function o(){var u=ru(r.canvas);return{x:(r.width/2-u.x)/u.k,y:(r.height/2-u.y)/u.k}}function l(u){var c=u.x,h=u.y;r.zoom.translateTo(r.zoom.__baseElem,c===void 0?o().x:c,h===void 0?o().y:h),r.needsRedraw=!0}},zoom:function(r,e,i){if(!r.canvas)return null;if(e!==void 0)return i?r.tweenGroup.add(new $_({k:n()}).to({k:e},i).easing(ph.Quadratic.Out).onUpdate(function(o){var l=o.k;return s(l)}).start()):s(e),this;return n();function n(){return ru(r.canvas).k}function s(o){r.zoom.scaleTo(r.zoom.__baseElem,o),r.needsRedraw=!0}},zoomToFit:function(r){for(var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:10,n=arguments.length,s=new Array(n>3?n-3:0),o=3;o<n;o++)s[o-3]=arguments[o];var l=this.getGraphBbox.apply(this,s);if(l){var u={x:(l.x[0]+l.x[1])/2,y:(l.y[0]+l.y[1])/2},c=Math.max(1e-12,Math.min(1e12,(r.width-i*2)/(l.x[1]-l.x[0]),(r.height-i*2)/(l.y[1]-l.y[0])));this.centerAt(u.x,u.y,e),this.zoom(c,e)}return this},getGraphBbox:function(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return!0},i=gr(r.nodeVal),n=function(o){return Math.sqrt(Math.max(0,i(o)||1))*r.nodeRelSize},s=r.graphData.nodes.filter(e).map(function(o){return{x:o.x,y:o.y,r:n(o)}});return s.length?{x:[QT(s,function(o){return o.x-o.r}),WT(s,function(o){return o.x+o.r})],y:[QT(s,function(o){return o.y-o.r}),WT(s,function(o){return o.y+o.r})]}:null},pauseAnimation:function(r){return r.animationFrameRequestId&&(cancelAnimationFrame(r.animationFrameRequestId),r.animationFrameRequestId=null),this},resumeAnimation:function(r){return r.animationFrameRequestId||this._animationCycle(),this},_destructor:function(){this.pauseAnimation(),this.graphData({nodes:[],links:[]})}},dwe),stateInit:function(){return{lastSetZoom:1,zoom:wEe(),forceGraph:new dE,shadowGraph:new dE().cooldownTicks(0).nodeColor("__indexColor").linkColor("__indexColor").isShadow(!0),colorTracker:new jEe,tweenGroup:new OI}},init:function(r,e){var i=this;r.innerHTML="";var n=document.createElement("div");n.classList.add("force-graph-container"),n.style.position="relative",r.appendChild(n),e.canvas=document.createElement("canvas"),e.backgroundColor&&(e.canvas.style.background=e.backgroundColor),n.appendChild(e.canvas),e.shadowCanvas=document.createElement("canvas");var s=e.canvas.getContext("2d"),o=e.shadowCanvas.getContext("2d",{willReadFrequently:!0}),l={x:-1e12,y:-1e12},u=function(){var p=null,f=window.devicePixelRatio,g=l.x>0&&l.y>0?o.getImageData(l.x*f,l.y*f,1,1):null;return g&&(p=e.colorTracker.lookup(g.data)),p};Rc(e.canvas).call(u_e().subject(function(){if(!e.enableNodeDrag)return null;var p=u();return p&&p.type==="Node"?p.d:null}).on("start",function(p){var f=p.subject;f.__initialDragPos={x:f.x,y:f.y,fx:f.fx,fy:f.fy},p.active||(f.fx=f.x,f.fy=f.y),e.canvas.classList.add("grabbable")}).on("drag",function(p){var f=p.subject,g=f.__initialDragPos,m=p,y=ru(e.canvas).k,b={x:g.x+(m.x-g.x)/y-f.x,y:g.y+(m.y-g.y)/y-f.y};["x","y"].forEach(function(v){return f["f".concat(v)]=f[v]=g[v]+(m[v]-g[v])/y}),e.forceGraph.d3AlphaTarget(.3).resetCountdown(),e.isPointerDragging=!0,f.__dragged=!0,e.onNodeDrag(f,b)}).on("end",function(p){var f=p.subject,g=f.__initialDragPos,m={x:f.x-g.x,y:f.y-g.y};g.fx===void 0&&(f.fx=void 0),g.fy===void 0&&(f.fy=void 0),delete f.__initialDragPos,e.forceGraph.d3AlphaTarget()&&e.forceGraph.d3AlphaTarget(0).resetCountdown(),e.canvas.classList.remove("grabbable"),e.isPointerDragging=!1,f.__dragged&&(delete f.__dragged,e.onNodeDragEnd(f,m))})),e.zoom(e.zoom.__baseElem=Rc(e.canvas)),e.zoom.__baseElem.on("dblclick.zoom",null),e.zoom.filter(function(p){return!p.button&&e.enableZoomPanInteraction&&(p.type!=="wheel"||gr(e.enableZoomInteraction)(p))&&(p.type==="wheel"||gr(e.enablePanInteraction)(p))}).on("zoom",function(p){var f=p.transform;[s,o].forEach(function(g){Q9(g),g.translate(f.x,f.y),g.scale(f.k,f.k)}),e.onZoom&&e.onZoom(e0(e0({},f),i.centerAt())),e.needsRedraw=!0}).on("end",function(p){return e.onZoomEnd&&e.onZoomEnd(e0(e0({},p.transform),i.centerAt()))}),rB(e),e.forceGraph.onNeedsRedraw(function(){return e.needsRedraw=!0}).onFinishUpdate(function(){ru(e.canvas).k===e.lastSetZoom&&e.graphData.nodes.length&&(e.zoom.scaleTo(e.zoom.__baseElem,e.lastSetZoom=cwe/Math.cbrt(e.graphData.nodes.length)),e.needsRedraw=!0)});var c=document.createElement("div");c.classList.add("graph-tooltip"),n.appendChild(c),["pointermove","pointerdown"].forEach(function(p){return n.addEventListener(p,function(f){p==="pointerdown"&&(e.isPointerPressed=!0,e.pointerDownEvent=f),!e.isPointerDragging&&f.type==="pointermove"&&e.onBackgroundClick&&(f.pressure>0||e.isPointerPressed)&&(f.pointerType!=="touch"||f.movementX===void 0||[f.movementX,f.movementY].some(function(y){return Math.abs(y)>1}))&&(e.isPointerDragging=!0);var g=m(n);l.x=f.pageX-g.left,l.y=f.pageY-g.top,c.style.top="".concat(l.y,"px"),c.style.left="".concat(l.x,"px"),c.style.transform="translate(-".concat(l.x/e.width*100,"%, ").concat(e.height-l.y<100?"calc(-100% - 8px)":"21px",")");function m(y){var b=y.getBoundingClientRect(),v=window.pageXOffset||document.documentElement.scrollLeft,_=window.pageYOffset||document.documentElement.scrollTop;return{top:b.top+_,left:b.left+v}}},{passive:!0})}),n.addEventListener("pointerup",function(p){if(e.isPointerPressed=!1,e.isPointerDragging){e.isPointerDragging=!1;return}var f=[p,e.pointerDownEvent];requestAnimationFrame(function(){if(p.button===0)if(e.hoverObj){var g=e["on".concat(e.hoverObj.type,"Click")];g&&g.apply(void 0,[e.hoverObj.d].concat(f))}else e.onBackgroundClick&&e.onBackgroundClick.apply(e,f);if(p.button===2)if(e.hoverObj){var m=e["on".concat(e.hoverObj.type,"RightClick")];m&&m.apply(void 0,[e.hoverObj.d].concat(f))}else e.onBackgroundRightClick&&e.onBackgroundRightClick.apply(e,f)})},{passive:!0}),n.addEventListener("contextmenu",function(p){return!e.onBackgroundRightClick&&!e.onNodeRightClick&&!e.onLinkRightClick?!0:(p.preventDefault(),!1)}),e.forceGraph(s),e.shadowGraph(o);var h=SEe(function(){q9(o,e.width,e.height),e.shadowGraph.linkWidth(function(f){return gr(e.linkWidth)(f)+e.linkHoverPrecision});var p=ru(e.canvas);e.shadowGraph.globalScale(p.k).tickFrame()},lwe);e.flushShadowCanvas=h.flush,(this._animationCycle=function p(){var f=!e.autoPauseRedraw||!!e.needsRedraw||e.forceGraph.isEngineRunning()||e.graphData.links.some(function(T){return T.__photons&&T.__photons.length});if(e.needsRedraw=!1,e.enablePointerInteraction){var g=e.isPointerDragging?null:u();if(g!==e.hoverObj){var m=e.hoverObj,y=m?m.type:null,b=g?g.type:null;if(y&&y!==b){var v=e["on".concat(y,"Hover")];v&&v(null,m.d)}if(b){var _=e["on".concat(b,"Hover")];_&&_(g.d,y===b?m.d:null)}var C=g&&gr(e["".concat(g.type.toLowerCase(),"Label")])(g.d)||"";c.style.visibility=C?"visible":"hidden",c.innerHTML=C,e.canvas.classList[g&&e["on".concat(b,"Click")]||!g&&e.onBackgroundClick?"add":"remove"]("clickable"),e.hoverObj=g}f&&h()}if(f){q9(s,e.width,e.height);var E=ru(e.canvas).k;e.onRenderFramePre&&e.onRenderFramePre(s,E),e.forceGraph.globalScale(E).tickFrame(),e.onRenderFramePost&&e.onRenderFramePost(s,E)}e.tweenGroup.update(),e.animationFrameRequestId=requestAnimationFrame(p)})()},update:function(r){}}),pE={width:bt.number,height:bt.number,graphData:bt.shape({nodes:bt.arrayOf(bt.object).isRequired,links:bt.arrayOf(bt.object).isRequired}),backgroundColor:bt.string,nodeRelSize:bt.number,nodeId:bt.string,nodeLabel:bt.oneOfType([bt.string,bt.func]),nodeVal:bt.oneOfType([bt.number,bt.string,bt.func]),nodeVisibility:bt.oneOfType([bt.bool,bt.string,bt.func]),nodeColor:bt.oneOfType([bt.string,bt.func]),nodeAutoColorBy:bt.oneOfType([bt.string,bt.func]),onNodeHover:bt.func,onNodeClick:bt.func,linkSource:bt.string,linkTarget:bt.string,linkLabel:bt.oneOfType([bt.string,bt.func]),linkVisibility:bt.oneOfType([bt.bool,bt.string,bt.func]),linkColor:bt.oneOfType([bt.string,bt.func]),linkAutoColorBy:bt.oneOfType([bt.string,bt.func]),linkWidth:bt.oneOfType([bt.number,bt.string,bt.func]),linkCurvature:bt.oneOfType([bt.number,bt.string,bt.func]),linkDirectionalArrowLength:bt.oneOfType([bt.number,bt.string,bt.func]),linkDirectionalArrowColor:bt.oneOfType([bt.string,bt.func]),linkDirectionalArrowRelPos:bt.oneOfType([bt.number,bt.string,bt.func]),linkDirectionalParticles:bt.oneOfType([bt.number,bt.string,bt.func]),linkDirectionalParticleSpeed:bt.oneOfType([bt.number,bt.string,bt.func]),linkDirectionalParticleWidth:bt.oneOfType([bt.number,bt.string,bt.func]),linkDirectionalParticleColor:bt.oneOfType([bt.string,bt.func]),onLinkHover:bt.func,onLinkClick:bt.func,dagMode:bt.oneOf(["td","bu","lr","rl","zin","zout","radialin","radialout"]),dagLevelDistance:bt.number,dagNodeFilter:bt.func,onDagError:bt.func,d3AlphaMin:bt.number,d3AlphaDecay:bt.number,d3VelocityDecay:bt.number,warmupTicks:bt.number,cooldownTicks:bt.number,cooldownTime:bt.number,onEngineTick:bt.func,onEngineStop:bt.func,getGraphBbox:bt.func},X9={zoomToFit:bt.func,onNodeRightClick:bt.func,onNodeDrag:bt.func,onNodeDragEnd:bt.func,onLinkRightClick:bt.func,linkHoverPrecision:bt.number,onBackgroundClick:bt.func,onBackgroundRightClick:bt.func,enablePointerInteraction:bt.bool,enableNodeDrag:bt.bool},nB={showNavInfo:bt.bool,nodeOpacity:bt.number,nodeResolution:bt.number,nodeThreeObject:bt.oneOfType([bt.object,bt.string,bt.func]),nodeThreeObjectExtend:bt.oneOfType([bt.bool,bt.string,bt.func]),linkOpacity:bt.number,linkResolution:bt.number,linkCurveRotation:bt.oneOfType([bt.number,bt.string,bt.func]),linkMaterial:bt.oneOfType([bt.object,bt.string,bt.func]),linkThreeObject:bt.oneOfType([bt.object,bt.string,bt.func]),linkThreeObjectExtend:bt.oneOfType([bt.bool,bt.string,bt.func]),linkPositionUpdate:bt.func,linkDirectionalArrowResolution:bt.number,linkDirectionalParticleResolution:bt.number,forceEngine:bt.oneOf(["d3","ngraph"]),ngraphPhysics:bt.object,numDimensions:bt.oneOf([1,2,3])},fwe=Object.assign({},pE,X9,{linkLineDash:bt.oneOfType([bt.arrayOf(bt.number),bt.string,bt.func]),nodeCanvasObjectMode:bt.oneOfType([bt.string,bt.func]),nodeCanvasObject:bt.func,nodePointerAreaPaint:bt.func,linkCanvasObjectMode:bt.oneOfType([bt.string,bt.func]),linkCanvasObject:bt.func,linkPointerAreaPaint:bt.func,autoPauseRedraw:bt.bool,minZoom:bt.number,maxZoom:bt.number,enableZoomInteraction:bt.oneOfType([bt.bool,bt.func]),enablePanInteraction:bt.oneOfType([bt.bool,bt.func]),onZoom:bt.func,onZoomEnd:bt.func,onRenderFramePre:bt.func,onRenderFramePost:bt.func}),mwe=Object.assign({},pE,X9,nB,{enableNavigationControls:bt.bool,controlType:bt.oneOf(["trackball","orbit","fly"]),rendererConfig:bt.object,extraRenderers:bt.arrayOf(bt.shape({render:bt.func.isRequired}))}),gwe=Object.assign({},pE,nB,{nodeDesc:bt.oneOfType([bt.string,bt.func]),linkDesc:bt.oneOfType([bt.string,bt.func])}),Awe=Object.assign({},pE,nB,{markerAttrs:bt.object,yOffset:bt.number,glScale:bt.number});const K9=b1(bF,{methodNames:["getGraphBbox","emitParticle","d3Force","d3ReheatSimulation","refresh"]});K9.displayName="ForceGraphVR",K9.propTypes=gwe;const Y9=b1(dhe,{methodNames:["getGraphBbox","emitParticle","d3Force","d3ReheatSimulation","refresh"],initPropNames:["markerAttrs"]});Y9.displayName="ForceGraphAR",Y9.propTypes=Awe;const sB=b1(Cxe,{methodNames:["emitParticle","d3Force","d3ReheatSimulation","stopAnimation","pauseAnimation","resumeAnimation","cameraPosition","zoomToFit","getGraphBbox","screen2GraphCoords","graph2ScreenCoords","postProcessingComposer","lights","scene","camera","renderer","controls","refresh"],initPropNames:["controlType","rendererConfig","extraRenderers"]});sB.displayName="ForceGraph3D",sB.propTypes=mwe;const aB=b1(pwe,{methodNames:["emitParticle","d3Force","d3ReheatSimulation","stopAnimation","pauseAnimation","resumeAnimation","centerAt","zoom","zoomToFit","getGraphBbox","screen2GraphCoords","graph2ScreenCoords"]});aB.displayName="ForceGraph2D",aB.propTypes=fwe;const ywe={position:"absolute",pointerEvents:"none",background:Ks.PREDICATE,color:"#fff",border:`2px solid ${Ks.PREDICATE}`,borderRadius:8,padding:"6px 14px",fontSize:15,fontWeight:"bold",zIndex:1e4,boxShadow:"0 2px 8px rgba(0,0,0,0.18)",whiteSpace:"nowrap",maxWidth:260,overflow:"hidden",textOverflow:"ellipsis"},vwe=16,J9=32,bwe=({graphData:r,onNodeClick:e,onEngineStop:i,fgRef:n,tabs:s,activeTab:o,onTabChange:l,children:u,drawerOpen:c,drawerContent:h,onDrawerClose:p,sidebarOpen:f,sidebarContent:g,onSidebarClose:m,selectedTriple:y,endpoint:b})=>{const v=Dt.useRef(),[_,C]=Dt.useState(null),[E,T]=Dt.useState({x:0,y:0}),[R,B]=Dt.useState({width:100,height:100});Dt.useEffect(()=>{const D=()=>{v.current&&B({width:v.current.clientWidth,height:v.current.clientHeight})};return D(),window.addEventListener("resize",D),()=>window.removeEventListener("resize",D)},[]);const I=()=>{if(!v.current)return{left:E.x,top:E.y};const D=v.current.getBoundingClientRect(),L=180,O=36;let F=E.x+vwe,q=E.y-J9;return F+L>D.width&&(F=D.width-L-8),F<0&&(F=8),q<0&&(q=E.y+J9),q+O>D.height&&(q=D.height-O-8),{left:F,top:q}};return qe.jsxs("div",{ref:v,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden"},onMouseMove:D=>{if(v.current){const L=v.current.getBoundingClientRect();T({x:D.clientX-L.left,y:D.clientY-L.top})}},children:[qe.jsx(aB,{ref:n,graphData:r,width:R.width,height:R.height,nodeCanvasObject:(D,L,O)=>{const F=D.label||"",q=12/O;L.font=`${q}px Sans-Serif`;const H=L.measureText(F).width,G=10/O,J=5/O;L.fillStyle=D.color+"CC";const Q=D.x-H/2-G,V=D.y-q/2-G,z=H+G*2,te=q+G*2,K=[z,te];L.beginPath(),L.arc(Q+J,V+J,J,Math.PI,1.5*Math.PI),L.arc(Q+z-J,V+J,J,1.5*Math.PI,2*Math.PI),L.arc(Q+z-J,V+te-J,J,0,.5*Math.PI),L.arc(Q+J,V+te-J,J,.5*Math.PI,Math.PI),L.closePath(),L.fill(),L.fillStyle="#fff",L.textAlign="center",L.textBaseline="middle",L.fillText(F,D.x,D.y),D.__bckgDimensions=K},nodePointerAreaPaint:(D,L,O)=>{O.fillStyle=L;const F=D.__bckgDimensions;F&&O.fillRect(D.x-F[0]/2,D.y-F[1]/2,...F)},linkColor:()=>"rgba(255, 211, 42, 0.15)",linkDirectionalParticles:1,linkDirectionalParticleSpeed:.01,linkDirectionalParticleColor:()=>"rgba(255,255,255,0.5)",nodeAutoColorBy:"type",onNodeClick:D=>{console.log("Node clicked inside Graph2D:",D),e&&e(D)},onEngineStop:i,onLinkHover:C,onBackgroundClick:()=>{C(null)},onZoom:()=>C(null)}),_&&_.label&&qe.jsx("div",{style:{...ywe,...I(),pointerEvents:"none"},children:_.label}),y&&qe.jsx("div",{style:{position:"absolute",top:80,right:30,width:350,zIndex:9999,maxHeight:"80vh",background:"#18181b",borderRadius:"10px",border:"3px solid #ffd32a",boxShadow:"0 8px 30px rgba(0, 0, 0, 0.5)",overflowY:"auto"},children:qe.jsx(kM,{triple:y,endpoint:b,onClose:()=>e(null)})}),s&&qe.jsx("div",{style:{position:"absolute",left:0,right:0,bottom:0,zIndex:2e3,display:"flex",justifyContent:"center",alignItems:"center",gap:36,padding:"0 0 4px 0",height:54},children:s.map(D=>qe.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",cursor:"pointer",minWidth:120},onClick:()=>l(D.key),children:[qe.jsx("span",{style:{color:o===D.key?"#ffd32a":"#fff",fontWeight:o===D.key?"bold":"normal",fontSize:17,letterSpacing:.5,padding:"8px 0 2px 0",transition:"color 0.2s, font-weight 0.2s"},children:D.label}),qe.jsx("div",{style:{height:3,width:"80%",background:o===D.key?"#ffd32a":"transparent",borderRadius:2,transition:"background 0.2s"}})]},D.key||"map"))}),qe.jsx("div",{style:{position:"absolute",left:0,right:0,bottom:0,height:c?"33.33vh":0,backgroundColor:"#18181b",borderTopLeftRadius:18,borderTopRightRadius:18,transition:"height 0.35s cubic-bezier(0.4, 1.3, 0.5, 1)",zIndex:1300,boxShadow:"0 -2px 16px rgba(0, 0, 0, 0.18)",border:"2px solid #ffd32a",overflow:"hidden"},children:c&&qe.jsxs(qe.Fragment,{children:[qe.jsx("button",{style:{background:"none",border:"none",color:"#ffd32a",fontSize:32,position:"absolute",top:10,right:18,cursor:"pointer",zIndex:1302,transition:"color 0.2s"},onClick:p,children:"×"}),qe.jsx("div",{style:{padding:"48px 24px 24px 24px",overflowY:"auto",height:"100%",color:"#ffd32a"},children:h})]})}),qe.jsx("div",{style:{position:"absolute",top:0,left:0,bottom:0,width:f?"16.67vw":0,minWidth:f?"250px":0,backgroundColor:"#18181b",borderTopRightRadius:18,borderBottomRightRadius:18,transition:"width 0.35s cubic-bezier(0.4, 1.3, 0.5, 1)",zIndex:1300,boxShadow:"2px 0 16px rgba(0, 0, 0, 0.18)",border:"2px solid #ffd32a",overflow:"hidden"},children:f&&qe.jsxs(qe.Fragment,{children:[qe.jsx("button",{style:{background:"none",border:"none",color:"#ffd32a",fontSize:32,position:"absolute",top:10,right:18,cursor:"pointer",zIndex:1302,transition:"color 0.2s"},onClick:m,children:"×"}),qe.jsx("div",{style:{padding:"48px 24px 24px 24px",overflowY:"auto",height:"100%",color:"#ffd32a"},children:g})]})}),(c||f)&&qe.jsx("div",{style:{position:"absolute",inset:0,backgroundColor:"rgba(0, 0, 0, 0.35)",zIndex:1200,pointerEvents:"auto"},onClick:c?p:m}),qe.jsx("div",{style:{position:"relative",zIndex:2e3},children:u})]})};function oB(r,e){(e==null||e>r.length)&&(e=r.length);for(var i=0,n=Array(e);i<e;i++)n[i]=r[i];return n}function xwe(r){if(Array.isArray(r))return r}function _we(r){if(Array.isArray(r))return oB(r)}function Ewe(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function wwe(r,e,i){return e=fE(e),Lwe(r,Z9()?Reflect.construct(e,i||[],fE(r).constructor):e.apply(r,i))}function Cwe(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function Swe(r,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,Owe(n.key),n)}}function Twe(r,e,i){return e&&Swe(r.prototype,e),Object.defineProperty(r,"prototype",{writable:!1}),r}function fE(r){return fE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},fE(r)}function Mwe(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),e&&lB(r,e)}function Z9(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Z9=function(){return!!r})()}function Rwe(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function Iwe(r,e){var i=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(i!=null){var n,s,o,l,u=[],c=!0,h=!1;try{if(o=(i=i.call(r)).next,e===0){if(Object(i)!==i)return;c=!1}else for(;!(c=(n=o.call(i)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(p){h=!0,s=p}finally{try{if(!c&&i.return!=null&&(l=i.return(),Object(l)!==l))return}finally{if(h)throw s}}return u}}function Bwe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Nwe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Lwe(r,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ewe(r)}function lB(r,e){return lB=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,n){return i.__proto__=n,i},lB(r,e)}function $9(r,e){return xwe(r)||Iwe(r,e)||ej(r,e)||Bwe()}function mE(r){return _we(r)||Rwe(r)||ej(r)||Nwe()}function Dwe(r,e){if(typeof r!="object"||!r)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var n=i.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}function Owe(r){var e=Dwe(r,"string");return typeof e=="symbol"?e:e+""}function ej(r,e){if(r){if(typeof r=="string")return oB(r,e);var i={}.toString.call(r).slice(8,-1);return i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set"?Array.from(r):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?oB(r,e):void 0}}var ov=typeof window<"u"&&window.THREE?window.THREE:{CanvasTexture:hre,Sprite:ure,SpriteMaterial:tk,SRGBColorSpace:jo},Pwe=function(r){function e(){var i,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:10,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"rgba(255, 255, 255, 1)";return Cwe(this,e),i=wwe(this,e,[new ov.SpriteMaterial]),i._text="".concat(n),i._textHeight=s,i._color=o,i._backgroundColor=!1,i._padding=0,i._borderWidth=0,i._borderRadius=0,i._borderColor="white",i._strokeWidth=0,i._strokeColor="white",i._fontFace="system-ui",i._fontSize=90,i._fontWeight="normal",i._canvas=document.createElement("canvas"),i._genCanvas(),i}return Mwe(e,r),Twe(e,[{key:"text",get:function(){return this._text},set:function(i){this._text=i,this._genCanvas()}},{key:"textHeight",get:function(){return this._textHeight},set:function(i){this._textHeight=i,this._genCanvas()}},{key:"color",get:function(){return this._color},set:function(i){this._color=i,this._genCanvas()}},{key:"backgroundColor",get:function(){return this._backgroundColor},set:function(i){this._backgroundColor=i,this._genCanvas()}},{key:"padding",get:function(){return this._padding},set:function(i){this._padding=i,this._genCanvas()}},{key:"borderWidth",get:function(){return this._borderWidth},set:function(i){this._borderWidth=i,this._genCanvas()}},{key:"borderRadius",get:function(){return this._borderRadius},set:function(i){this._borderRadius=i,this._genCanvas()}},{key:"borderColor",get:function(){return this._borderColor},set:function(i){this._borderColor=i,this._genCanvas()}},{key:"fontFace",get:function(){return this._fontFace},set:function(i){this._fontFace=i,this._genCanvas()}},{key:"fontSize",get:function(){return this._fontSize},set:function(i){this._fontSize=i,this._genCanvas()}},{key:"fontWeight",get:function(){return this._fontWeight},set:function(i){this._fontWeight=i,this._genCanvas()}},{key:"strokeWidth",get:function(){return this._strokeWidth},set:function(i){this._strokeWidth=i,this._genCanvas()}},{key:"strokeColor",get:function(){return this._strokeColor},set:function(i){this._strokeColor=i,this._genCanvas()}},{key:"_genCanvas",value:function(){var i=this,n=this._canvas,s=n.getContext("2d"),o=1/this.textHeight,l=Array.isArray(this.borderWidth)?this.borderWidth:[this.borderWidth,this.borderWidth],u=l.map(function(I){return I*i.fontSize*o}),c=Array.isArray(this.borderRadius)?this.borderRadius:[this.borderRadius,this.borderRadius,this.borderRadius,this.borderRadius],h=c.map(function(I){return I*i.fontSize*o}),p=Array.isArray(this.padding)?this.padding:[this.padding,this.padding],f=p.map(function(I){return I*i.fontSize*o}),g=this.text.split(`
`),m="".concat(this.fontWeight," ").concat(this.fontSize,"px ").concat(this.fontFace);s.font=m;var y=Math.max.apply(Math,mE(g.map(function(I){return s.measureText(I).width}))),b=this.fontSize*g.length;if(n.width=y+u[0]*2+f[0]*2,n.height=b+u[1]*2+f[1]*2,this.borderWidth){if(s.strokeStyle=this.borderColor,u[0]){var v=u[0]/2;s.lineWidth=u[0],s.beginPath(),s.moveTo(v,h[0]),s.lineTo(v,n.height-h[3]),s.moveTo(n.width-v,h[1]),s.lineTo(n.width-v,n.height-h[2]),s.stroke()}if(u[1]){var _=u[1]/2;s.lineWidth=u[1],s.beginPath(),s.moveTo(Math.max(u[0],h[0]),_),s.lineTo(n.width-Math.max(u[0],h[1]),_),s.moveTo(Math.max(u[0],h[3]),n.height-_),s.lineTo(n.width-Math.max(u[0],h[2]),n.height-_),s.stroke()}if(this.borderRadius){var C=Math.max.apply(Math,mE(u)),E=C/2;s.lineWidth=C,s.beginPath(),[!!h[0]&&[h[0],E,E,h[0]],!!h[1]&&[n.width-h[1],n.width-E,E,h[1]],!!h[2]&&[n.width-h[2],n.width-E,n.height-E,n.height-h[2]],!!h[3]&&[h[3],E,n.height-E,n.height-h[3]]].filter(function(I){return I}).forEach(function(I){var D=$9(I,4),L=D[0],O=D[1],F=D[2],q=D[3];s.moveTo(L,F),s.quadraticCurveTo(O,F,O,q)}),s.stroke()}}this.backgroundColor&&(s.fillStyle=this.backgroundColor,this.borderRadius?(s.beginPath(),s.moveTo(u[0],h[0]),[[u[0],h[0],n.width-h[1],u[1],u[1],u[1]],[n.width-u[0],n.width-u[0],n.width-u[0],u[1],h[1],n.height-h[2]],[n.width-u[0],n.width-h[2],h[3],n.height-u[1],n.height-u[1],n.height-u[1]],[u[0],u[0],u[0],n.height-u[1],n.height-h[3],h[0]]].forEach(function(I){var D=$9(I,6),L=D[0],O=D[1],F=D[2],q=D[3],H=D[4],G=D[5];s.quadraticCurveTo(L,q,O,H),s.lineTo(F,G)}),s.closePath(),s.fill()):s.fillRect(u[0],u[1],n.width-u[0]*2,n.height-u[1]*2)),s.translate.apply(s,mE(u)),s.translate.apply(s,mE(f)),s.font=m,s.fillStyle=this.color,s.textBaseline="bottom";var T=this.strokeWidth>0;T&&(s.lineWidth=this.strokeWidth*this.fontSize/10,s.strokeStyle=this.strokeColor),g.forEach(function(I,D){var L=(y-s.measureText(I).width)/2,O=(D+1)*i.fontSize;T&&s.strokeText(I,L,O),s.fillText(I,L,O)}),this.material.map&&this.material.map.dispose();var R=this.material.map=new ov.CanvasTexture(n);R.colorSpace=ov.SRGBColorSpace;var B=this.textHeight*g.length+l[1]*2+p[1]*2;this.scale.set(B*n.width/n.height,B,0)}},{key:"clone",value:function(){return new this.constructor(this.text,this.textHeight,this.color).copy(this)}},{key:"copy",value:function(i){return ov.Sprite.prototype.copy.call(this,i),this.color=i.color,this.backgroundColor=i.backgroundColor,this.padding=i.padding,this.borderWidth=i.borderWidth,this.borderColor=i.borderColor,this.fontFace=i.fontFace,this.fontSize=i.fontSize,this.fontWeight=i.fontWeight,this.strokeWidth=i.strokeWidth,this.strokeColor=i.strokeColor,this}}])}(ov.Sprite);const kwe=({graphData:r,onNodeClick:e,onEngineStop:i,fgRef:n,tabs:s,activeTab:o,onTabChange:l,children:u,drawerOpen:c,drawerContent:h,onDrawerClose:p,sidebarOpen:f,sidebarContent:g,onSidebarClose:m,selectedTriple:y,endpoint:b})=>{const v=Dt.useRef(),[_,C]=Dt.useState({width:100,height:100});return Dt.useEffect(()=>{const E=()=>{v.current&&C({width:v.current.clientWidth,height:v.current.clientHeight})};return E(),window.addEventListener("resize",E),()=>window.removeEventListener("resize",E)},[]),qe.jsxs("div",{ref:v,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden"},children:[qe.jsx(sB,{ref:n,graphData:r,width:_.width,height:_.height,controlType:"fly",nodeLabel:"label",onNodeClick:E=>{console.log("Node clicked inside Graph3D:",E),e&&e(E)},linkColor:()=>"rgba(255, 211, 42, 0.15)",linkDirectionalParticles:2,linkDirectionalParticleSpeed:.0025,linkDirectionalParticleColor:()=>"rgba(255,255,255,0.5)",nodeAutoColorBy:"type",nodeThreeObject:E=>{const T=new Pwe(E.label||"");return T.backgroundColor=k2(E.type)+"CC",T.borderRadius=1,T.padding=1,T.color="#fff",T.textHeight=2,T},onEngineStop:i}),y&&qe.jsx("div",{style:{position:"absolute",top:80,right:30,width:350,zIndex:9999,maxHeight:"80vh",background:"#18181b",borderRadius:"10px",border:"3px solid #ffd32a",boxShadow:"0 8px 30px rgba(0, 0, 0, 0.5)",overflowY:"auto"},children:qe.jsx(kM,{triple:y,endpoint:b,onClose:()=>e(null)})}),s&&qe.jsx("div",{style:{position:"absolute",left:0,right:0,bottom:0,zIndex:2e3,display:"flex",justifyContent:"center",alignItems:"center",gap:36,padding:"0 0 4px 0",height:54},children:s.map(E=>qe.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",cursor:"pointer",minWidth:120},onClick:()=>l(E.key),children:[qe.jsx("span",{style:{color:o===E.key?"#ffd32a":"#fff",fontWeight:o===E.key?"bold":"normal",fontSize:17,letterSpacing:.5,padding:"8px 0 2px 0",transition:"color 0.2s, font-weight 0.2s"},children:E.label}),qe.jsx("div",{style:{height:3,width:"80%",background:o===E.key?"#ffd32a":"transparent",borderRadius:2,transition:"background 0.2s"}})]},E.key||"map"))}),qe.jsx("div",{style:{position:"absolute",left:0,right:0,bottom:0,height:c?"33.33vh":0,backgroundColor:"#18181b",borderTopLeftRadius:18,borderTopRightRadius:18,transition:"height 0.35s cubic-bezier(0.4, 1.3, 0.5, 1)",zIndex:1300,boxShadow:"0 -2px 16px rgba(0, 0, 0, 0.18)",border:"2px solid #ffd32a",overflow:"hidden"},children:c&&qe.jsxs(qe.Fragment,{children:[qe.jsx("button",{style:{background:"none",border:"none",color:"#ffd32a",fontSize:32,position:"absolute",top:10,right:18,cursor:"pointer",zIndex:1302,transition:"color 0.2s"},onClick:p,children:"×"}),qe.jsx("div",{style:{padding:"48px 24px 24px 24px",overflowY:"auto",height:"100%",color:"#ffd32a"},children:h})]})}),qe.jsx("div",{style:{position:"absolute",top:0,left:0,bottom:0,width:f?"16.67vw":0,minWidth:f?"250px":0,backgroundColor:"#18181b",borderTopRightRadius:18,borderBottomRightRadius:18,transition:"width 0.35s cubic-bezier(0.4, 1.3, 0.5, 1)",zIndex:1300,boxShadow:"2px 0 16px rgba(0, 0, 0, 0.18)",border:"2px solid #ffd32a",overflow:"hidden"},children:f&&qe.jsxs(qe.Fragment,{children:[qe.jsx("button",{style:{background:"none",border:"none",color:"#ffd32a",fontSize:32,position:"absolute",top:10,right:18,cursor:"pointer",zIndex:1302,transition:"color 0.2s"},onClick:m,children:"×"}),qe.jsx("div",{style:{padding:"48px 24px 24px 24px",overflowY:"auto",height:"100%",color:"#ffd32a"},children:g})]})}),(c||f)&&qe.jsx("div",{style:{position:"absolute",inset:0,backgroundColor:"rgba(0, 0, 0, 0.35)",zIndex:1200,pointerEvents:"auto"},onClick:c?p:m}),qe.jsx("div",{style:{position:"relative",zIndex:2e3},children:u})]})};var tj={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},ij=Dt.createContext&&Dt.createContext(tj),Fwe=["attr","size","title"];function Uwe(r,e){if(r==null)return{};var i=zwe(r,e),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(r);for(s=0;s<o.length;s++)n=o[s],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(r,n)&&(i[n]=r[n])}return i}function zwe(r,e){if(r==null)return{};var i={};for(var n in r)if(Object.prototype.hasOwnProperty.call(r,n)){if(e.indexOf(n)>=0)continue;i[n]=r[n]}return i}function gE(){return gE=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r[n]=i[n])}return r},gE.apply(this,arguments)}function rj(r,e){var i=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),i.push.apply(i,n)}return i}function AE(r){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?rj(Object(i),!0).forEach(function(n){jwe(r,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):rj(Object(i)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(i,n))})}return r}function jwe(r,e,i){return e=Gwe(e),e in r?Object.defineProperty(r,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[e]=i,r}function Gwe(r){var e=Vwe(r,"string");return typeof e=="symbol"?e:e+""}function Vwe(r,e){if(typeof r!="object"||!r)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var n=i.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function nj(r){return r&&r.map((e,i)=>Dt.createElement(e.tag,AE({key:i},e.attr),nj(e.child)))}function lv(r){return e=>Dt.createElement(Hwe,gE({attr:AE({},r.attr)},e),nj(r.child))}function Hwe(r){var e=i=>{var{attr:n,size:s,title:o}=r,l=Uwe(r,Fwe),u=s||i.size||"1em",c;return i.className&&(c=i.className),r.className&&(c=(c?c+" ":"")+r.className),Dt.createElement("svg",gE({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},i.attr,n,l,{className:c,style:AE(AE({color:r.color||i.color},i.style),r.style),height:u,width:u,xmlns:"http://www.w3.org/2000/svg"}),o&&Dt.createElement("title",null,o),r.children)};return ij!==void 0?Dt.createElement(ij.Consumer,null,i=>e(i)):e(tj)}function Wwe(r){return lv({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M200,154a29.87,29.87,0,0,0-19.5,7.23L154.88,141.3A29.83,29.83,0,0,0,158,128a30.52,30.52,0,0,0-.22-3.6L174,119a30,30,0,1,0-4-15,30.52,30.52,0,0,0,.22,3.6L154,113a29.91,29.91,0,0,0-32.42-14.31l-8.14-18.3a30,30,0,1,0-11,4.88l8.14,18.3A29.92,29.92,0,0,0,102.06,143L74,168a30.08,30.08,0,1,0,8,9L110,152a29.91,29.91,0,0,0,37.47-1.23l25.62,19.93A30,30,0,1,0,200,154Zm0-68a18,18,0,1,1-18,18A18,18,0,0,1,200,86ZM78,56A18,18,0,1,1,96,74,18,18,0,0,1,78,56ZM56,210a18,18,0,1,1,18-18A18,18,0,0,1,56,210Zm72-64a18,18,0,1,1,18-18A18,18,0,0,1,128,146Zm72,56a18,18,0,1,1,18-18A18,18,0,0,1,200,202Z"},child:[]}]})(r)}function sj(r){return lv({attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M311.9 260.8L160 353.6 8 260.8 160 0l151.9 260.8zM160 383.4L8 290.6 160 512l152-221.4-152 92.8z"},child:[]}]})(r)}function Qwe(r){return lv({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M257.5 445.1l-22.2 22.2c-9.4 9.4-24.6 9.4-33.9 0L7 273c-9.4-9.4-9.4-24.6 0-33.9L201.4 44.7c9.4-9.4 24.6-9.4 33.9 0l22.2 22.2c9.5 9.5 9.3 25-.4 34.3L136.6 216H424c13.3 0 24 10.7 24 24v32c0 13.3-10.7 24-24 24H136.6l120.5 114.8c9.8 9.3 10 24.8.4 34.3z"},child:[]}]})(r)}function qwe(r){return lv({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z"},child:[]}]})(r)}function Xwe(r){return lv({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"},child:[]}]})(r)}const aj={background:"#ffd32a",color:"#18181b",border:"none",borderRadius:12,width:44,height:44,fontSize:22,fontWeight:"bold",boxShadow:"0 2px 8px rgba(0,0,0,0.18)",cursor:"pointer",marginBottom:0,marginTop:0,textTransform:"uppercase",display:"flex",alignItems:"center",justifyContent:"center",padding:0,transition:"background 0.2s, color 0.2s, transform 0.1s"},Kwe={background:"#ffe066",color:"#18181b",transform:"translateY(-2px) scale(1.03)"},Ywe=({onReset:r,onBack:e,onForward:i,canGoBack:n,canGoForward:s,onMyView:o})=>{const[l,u]=Dt.useState(""),c=h=>l===h?{...aj,...Kwe}:aj;return qe.jsxs("div",{style:{position:"absolute",top:"18px",left:"18px",zIndex:50,display:"flex",flexDirection:"row",gap:"12px",alignItems:"center"},children:[qe.jsx("button",{style:c("profile"),onClick:o,"aria-label":"Profile",onMouseEnter:()=>u("profile"),onMouseLeave:()=>u(""),children:qe.jsx(Xwe,{})}),qe.jsx("button",{style:{...c("graph"),width:54},onClick:r,"aria-label":"Return to graph",onMouseEnter:()=>u("graph"),onMouseLeave:()=>u(""),children:qe.jsx(Wwe,{size:28})}),qe.jsx("button",{style:{...c("prev"),opacity:n?1:.5},onClick:e,disabled:!n,"aria-label":"Previous",onMouseEnter:()=>u("prev"),onMouseLeave:()=>u(""),children:qe.jsx(Qwe,{})}),qe.jsx("button",{style:{...c("next"),opacity:s?1:.5},onClick:i,disabled:!s,"aria-label":"Next",onMouseEnter:()=>u("next"),onMouseLeave:()=>u(""),children:qe.jsx(qwe,{})})]})},Jwe=({viewMode:r,onViewModeChange:e})=>qe.jsxs("div",{className:"agent-navbar",style:{display:"flex",alignItems:"center",gap:"10px"},children:[qe.jsx("label",{htmlFor:"viewMode",children:"View Mode:"}),qe.jsxs("select",{id:"viewMode",value:r,onChange:i=>e(i.target.value),children:[qe.jsx("option",{value:"2D",children:"2D"}),qe.jsx("option",{value:"3D",children:"3D"}),qe.jsx("option",{value:"VR",children:"VR"})]})]}),yE=r=>{const e=[],i=[],n=new Map;return r.forEach(({subject:s,predicate:o,object:l})=>{if(!n.has(s.id)){const u={id:s.id,label:s.label,isTriple:!1,color:k2("subject"),type:"subject"};n.set(s.id,u),e.push(u)}if(!n.has(l.id)){const u={id:l.id,label:l.label,isTriple:!1,color:k2("object"),type:"object"};n.set(l.id,u),e.push(u)}i.push({source:s.id,target:l.id,type:"subject-to-object",label:o.label,predicateId:o.id})}),{nodes:e,links:i}},Zwe=24537,oj=(r,e="base")=>{const[i,n]=Dt.useState({nodes:[],links:[]}),[s,o]=Dt.useState(null),[l,u]=Dt.useState(!0),[c,h]=Dt.useState(null),[p,f]=Dt.useState(!1),[g,m]=Dt.useState([]),[y,b]=Dt.useState(0),v=Dt.useRef(null),[_,C]=Dt.useState(""),[E,T]=Dt.useState(""),[R,B]=Dt.useState(!1),[I,D]=Dt.useState(!1),L=Dt.useCallback(async()=>{f(!0);try{let Q;e==="agent"?Q=await Mue(Zwe,r):Q=await PM(r);const V=yE(Q);n(V),o(V)}catch(Q){console.error("Error loading graph data:",Q)}finally{f(!1)}},[r,e]),O=Dt.useCallback(()=>{n(s),h(null),C(""),T(""),D(!1)},[s]),F=Dt.useCallback(async(Q,V,z)=>{if(Q===null){h(null);return}if(h(Q),V&&V.current)try{const te={x:Q.x,y:Q.y,z:Q.z||0},K=await Eue(Q.id,r),ae=yE(K),Ae=ae.nodes.find(_e=>_e.id===Q.id);Ae&&(Ae.x=te.x,Ae.y=te.y,z==="3D"&&(Ae.z=te.z),Ae.fx=te.x,Ae.fy=te.y,z==="3D"&&(Ae.fz=te.z)),m(_e=>{const me=_e.slice(0,y+1);return me.push({graphData:i,selectedTriple:Q}),me}),b(_e=>_e+1),n(ae)}catch(te){console.error("Error fetching triples:",te)}},[r,i,y]),q=Dt.useCallback((Q,V)=>{switch(v.current&&clearTimeout(v.current),Q){case"subject":C(V);break;case"object":T(V);break}v.current=setTimeout(()=>{D(!0)},500)},[]),H=Dt.useCallback(async()=>{if(I){if(!_&&!E){O();return}B(!0);try{const Q=await Cue({subject:_,object:E},r);if(!Q||Q.length===0){n({nodes:[],links:[]});return}const V=yE(Q);n(V),m(z=>{const te=z.slice(0,y+1);return te.push({graphData:V,selectedTriple:null}),te}),b(z=>z+1)}catch(Q){console.error("Error searching triples:",Q)}finally{B(!1),D(!1)}}},[_,E,r,O,y,I]),G=Dt.useCallback(()=>{if(y>0){const{graphData:Q,selectedTriple:V}=g[y-1];n(Q),h(V),b(z=>z-1)}},[y,g]),J=Dt.useCallback(()=>{if(y<g.length-1){const{graphData:Q,selectedTriple:V}=g[y+1];n(Q),h(V),b(z=>z+1)}},[y,g]);return{graphData:i,initialGraphData:s,isInitialLoad:l,selectedTriple:c,isLoading:p,isSearching:R,subjectFilter:_,objectFilter:E,shouldSearch:I,canGoBack:y>0,canGoForward:y<g.length-1,setSelectedTriple:h,setIsInitialLoad:u,loadInitialData:L,resetGraph:O,handleNodeClick:F,handleFilterChange:q,applyFilters:H,goBack:G,goForward:J,graphType:e}};function $we({open:r,onClose:e,children:i,height:n=400}){return Dt.useEffect(()=>(r?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[r]),qe.jsxs(qe.Fragment,{children:[qe.jsx("div",{className:`drawer-backdrop${r?" open":""}`,onClick:e,"aria-hidden":!r}),qe.jsxs("div",{className:`drawer-panel${r?" open":""}`,style:{height:n},role:"dialog","aria-modal":"true",children:[qe.jsx("button",{className:"drawer-close-btn",onClick:e,"aria-label":"Close",children:"×"}),qe.jsx("div",{className:"drawer-content",children:i})]})]})}function e2e({open:r,onClose:e,children:i,width:n=350}){return Dt.useEffect(()=>(r?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[r]),qe.jsxs(qe.Fragment,{children:[qe.jsx("div",{className:`drawer-backdrop${r?" open":""}`,onClick:e,"aria-hidden":!r}),qe.jsxs("div",{className:`sidebar-drawer-panel${r?" open":""}`,style:{width:n},role:"dialog","aria-modal":"true",children:[qe.jsx("button",{className:"drawer-close-btn",onClick:e,"aria-label":"Close",children:"×"}),qe.jsx("div",{className:"drawer-content",children:i})]})]})}const t2e=({claim:r})=>qe.jsxs("div",{style:{background:"#232326",borderRadius:14,padding:"18px 24px",marginBottom:18,boxShadow:"0 2px 12px rgba(0,0,0,0.13)",display:"flex",alignItems:"center",gap:18,borderLeft:"6px solid #ffd32a",transition:"box-shadow 0.2s, border-color 0.2s",position:"relative"},className:"claim-card",children:[qe.jsxs("div",{style:{flex:1},children:[qe.jsxs("div",{style:{display:"flex",gap:10,marginBottom:8},children:[qe.jsx("span",{style:{color:"#ffd32a",fontWeight:700},children:"Subject:"}),qe.jsx("span",{style:{color:"#fff"},children:r.subject_id}),qe.jsx("span",{style:{color:"#ffd32a",fontWeight:700,marginLeft:12},children:"Predicate:"}),qe.jsx("span",{style:{color:"#fff"},children:r.predicate_id}),qe.jsx("span",{style:{color:"#ffd32a",fontWeight:700,marginLeft:12},children:"Object:"}),qe.jsx("span",{style:{color:"#fff"},children:r.object_id})]}),qe.jsxs("div",{style:{color:"#fff",fontSize:"1.1em",display:"flex",alignItems:"center",gap:8},children:[qe.jsx(sj,{color:"#ffd32a"}),qe.jsx("span",{style:{color:"#ffd32a",fontWeight:700},children:r.shares}),qe.jsx("span",{style:{color:"#fff",fontSize:13,marginLeft:4},children:"shares"})]})]}),qe.jsx("button",{style:{background:"#ffd32a",color:"#18181b",border:"none",borderRadius:8,padding:"8px 18px",fontWeight:"bold",cursor:"pointer",transition:"background 0.2s, color 0.2s, transform 0.1s",boxShadow:"0 2px 8px rgba(0,0,0,0.10)"},onMouseEnter:e=>e.currentTarget.style.background="#ffe066",onMouseLeave:e=>e.currentTarget.style.background="#ffd32a",onClick:()=>alert("Action à définir"),children:"Action"})]}),i2e=({position:r})=>{var e,i;const n=Number(((e=r.vault)==null?void 0:e.total_shares)||0),s=Number(((i=r.counter_vault)==null?void 0:i.total_shares)||0),o=s>0?"#D32F2F":"#43A047";return qe.jsxs("div",{style:{background:"#232326",borderRadius:14,padding:"18px 24px",marginBottom:18,boxShadow:"0 2px 12px rgba(0,0,0,0.13)",display:"flex",alignItems:"center",gap:18,borderLeft:`6px solid ${o}`,transition:"box-shadow 0.2s, border-color 0.2s",position:"relative"},className:"position-card",children:[qe.jsxs("div",{style:{flex:1},children:[qe.jsxs("div",{style:{display:"flex",gap:10,marginBottom:8},children:[qe.jsx("span",{style:{color:"#ffd32a",fontWeight:700},children:"ID:"}),qe.jsx("span",{style:{color:"#fff"},children:r.id})]}),qe.jsxs("div",{style:{color:"#fff",fontSize:"1.1em",display:"flex",alignItems:"center",gap:8},children:[qe.jsx(sj,{color:"#ffd32a"}),qe.jsx("span",{style:{color:"#ffd32a",fontWeight:700},children:n}),qe.jsx("span",{style:{color:"#fff",fontSize:13,marginLeft:4},children:"shares (vault)"}),qe.jsx("span",{style:{color:"#ffd32a",fontWeight:700,marginLeft:16},children:s}),qe.jsx("span",{style:{color:"#fff",fontSize:13,marginLeft:4},children:"shares (counter)"})]})]}),qe.jsx("button",{style:{background:"#ffd32a",color:"#18181b",border:"none",borderRadius:8,padding:"8px 18px",fontWeight:"bold",cursor:"pointer",transition:"background 0.2s, color 0.2s, transform 0.1s",boxShadow:"0 2px 8px rgba(0,0,0,0.10)"},onMouseEnter:l=>l.currentTarget.style.background="#ffe066",onMouseLeave:l=>l.currentTarget.style.background="#ffd32a",onClick:()=>alert("Action à définir"),children:"Action"})]})};function lj(r,e){return function(){return r.apply(e,arguments)}}const{toString:r2e}=Object.prototype,{getPrototypeOf:cB}=Object,{iterator:vE,toStringTag:cj}=Symbol,bE=(r=>e=>{const i=r2e.call(e);return r[i]||(r[i]=i.slice(8,-1).toLowerCase())})(Object.create(null)),Bc=r=>(r=r.toLowerCase(),e=>bE(e)===r),xE=r=>e=>typeof e===r,{isArray:t0}=Array,cv=xE("undefined");function n2e(r){return r!==null&&!cv(r)&&r.constructor!==null&&!cv(r.constructor)&&el(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}const uj=Bc("ArrayBuffer");function s2e(r){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(r):e=r&&r.buffer&&uj(r.buffer),e}const a2e=xE("string"),el=xE("function"),hj=xE("number"),_E=r=>r!==null&&typeof r=="object",o2e=r=>r===!0||r===!1,EE=r=>{if(bE(r)!=="object")return!1;const e=cB(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(cj in r)&&!(vE in r)},l2e=Bc("Date"),c2e=Bc("File"),u2e=Bc("Blob"),h2e=Bc("FileList"),d2e=r=>_E(r)&&el(r.pipe),p2e=r=>{let e;return r&&(typeof FormData=="function"&&r instanceof FormData||el(r.append)&&((e=bE(r))==="formdata"||e==="object"&&el(r.toString)&&r.toString()==="[object FormData]"))},f2e=Bc("URLSearchParams"),[m2e,g2e,A2e,y2e]=["ReadableStream","Request","Response","Headers"].map(Bc),v2e=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function uv(r,e,{allOwnKeys:i=!1}={}){if(r===null||typeof r>"u")return;let n,s;if(typeof r!="object"&&(r=[r]),t0(r))for(n=0,s=r.length;n<s;n++)e.call(null,r[n],n,r);else{const o=i?Object.getOwnPropertyNames(r):Object.keys(r),l=o.length;let u;for(n=0;n<l;n++)u=o[n],e.call(null,r[u],u,r)}}function dj(r,e){e=e.toLowerCase();const i=Object.keys(r);let n=i.length,s;for(;n-- >0;)if(s=i[n],e===s.toLowerCase())return s;return null}const cf=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,pj=r=>!cv(r)&&r!==cf;function uB(){const{caseless:r}=pj(this)&&this||{},e={},i=(n,s)=>{const o=r&&dj(e,s)||s;EE(e[o])&&EE(n)?e[o]=uB(e[o],n):EE(n)?e[o]=uB({},n):t0(n)?e[o]=n.slice():e[o]=n};for(let n=0,s=arguments.length;n<s;n++)arguments[n]&&uv(arguments[n],i);return e}const b2e=(r,e,i,{allOwnKeys:n}={})=>(uv(e,(s,o)=>{i&&el(s)?r[o]=lj(s,i):r[o]=s},{allOwnKeys:n}),r),x2e=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),_2e=(r,e,i,n)=>{r.prototype=Object.create(e.prototype,n),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:e.prototype}),i&&Object.assign(r.prototype,i)},E2e=(r,e,i,n)=>{let s,o,l;const u={};if(e=e||{},r==null)return e;do{for(s=Object.getOwnPropertyNames(r),o=s.length;o-- >0;)l=s[o],(!n||n(l,r,e))&&!u[l]&&(e[l]=r[l],u[l]=!0);r=i!==!1&&cB(r)}while(r&&(!i||i(r,e))&&r!==Object.prototype);return e},w2e=(r,e,i)=>{r=String(r),(i===void 0||i>r.length)&&(i=r.length),i-=e.length;const n=r.indexOf(e,i);return n!==-1&&n===i},C2e=r=>{if(!r)return null;if(t0(r))return r;let e=r.length;if(!hj(e))return null;const i=new Array(e);for(;e-- >0;)i[e]=r[e];return i},S2e=(r=>e=>r&&e instanceof r)(typeof Uint8Array<"u"&&cB(Uint8Array)),T2e=(r,e)=>{const i=(r&&r[vE]).call(r);let n;for(;(n=i.next())&&!n.done;){const s=n.value;e.call(r,s[0],s[1])}},M2e=(r,e)=>{let i;const n=[];for(;(i=r.exec(e))!==null;)n.push(i);return n},R2e=Bc("HTMLFormElement"),I2e=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,i,n){return i.toUpperCase()+n}),fj=(({hasOwnProperty:r})=>(e,i)=>r.call(e,i))(Object.prototype),B2e=Bc("RegExp"),mj=(r,e)=>{const i=Object.getOwnPropertyDescriptors(r),n={};uv(i,(s,o)=>{let l;(l=e(s,o,r))!==!1&&(n[o]=l||s)}),Object.defineProperties(r,n)},N2e=r=>{mj(r,(e,i)=>{if(el(r)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const n=r[i];if(el(n)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")})}})},L2e=(r,e)=>{const i={},n=s=>{s.forEach(o=>{i[o]=!0})};return t0(r)?n(r):n(String(r).split(e)),i},D2e=()=>{},O2e=(r,e)=>r!=null&&Number.isFinite(r=+r)?r:e;function P2e(r){return!!(r&&el(r.append)&&r[cj]==="FormData"&&r[vE])}const k2e=r=>{const e=new Array(10),i=(n,s)=>{if(_E(n)){if(e.indexOf(n)>=0)return;if(!("toJSON"in n)){e[s]=n;const o=t0(n)?[]:{};return uv(n,(l,u)=>{const c=i(l,s+1);!cv(c)&&(o[u]=c)}),e[s]=void 0,o}}return n};return i(r,0)},F2e=Bc("AsyncFunction"),U2e=r=>r&&(_E(r)||el(r))&&el(r.then)&&el(r.catch),gj=((r,e)=>r?setImmediate:e?((i,n)=>(cf.addEventListener("message",({source:s,data:o})=>{s===cf&&o===i&&n.length&&n.shift()()},!1),s=>{n.push(s),cf.postMessage(i,"*")}))(`axios@${Math.random()}`,[]):i=>setTimeout(i))(typeof setImmediate=="function",el(cf.postMessage)),z2e=typeof queueMicrotask<"u"?queueMicrotask.bind(cf):typeof process<"u"&&process.nextTick||gj,j2e=r=>r!=null&&el(r[vE]),Wt={isArray:t0,isArrayBuffer:uj,isBuffer:n2e,isFormData:p2e,isArrayBufferView:s2e,isString:a2e,isNumber:hj,isBoolean:o2e,isObject:_E,isPlainObject:EE,isReadableStream:m2e,isRequest:g2e,isResponse:A2e,isHeaders:y2e,isUndefined:cv,isDate:l2e,isFile:c2e,isBlob:u2e,isRegExp:B2e,isFunction:el,isStream:d2e,isURLSearchParams:f2e,isTypedArray:S2e,isFileList:h2e,forEach:uv,merge:uB,extend:b2e,trim:v2e,stripBOM:x2e,inherits:_2e,toFlatObject:E2e,kindOf:bE,kindOfTest:Bc,endsWith:w2e,toArray:C2e,forEachEntry:T2e,matchAll:M2e,isHTMLForm:R2e,hasOwnProperty:fj,hasOwnProp:fj,reduceDescriptors:mj,freezeMethods:N2e,toObjectSet:L2e,toCamelCase:I2e,noop:D2e,toFiniteNumber:O2e,findKey:dj,global:cf,isContextDefined:pj,isSpecCompliantForm:P2e,toJSONObject:k2e,isAsyncFn:F2e,isThenable:U2e,setImmediate:gj,asap:z2e,isIterable:j2e};function rn(r,e,i,n,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",e&&(this.code=e),i&&(this.config=i),n&&(this.request=n),s&&(this.response=s,this.status=s.status?s.status:null)}Wt.inherits(rn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Wt.toJSONObject(this.config),code:this.code,status:this.status}}});const Aj=rn.prototype,yj={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{yj[r]={value:r}}),Object.defineProperties(rn,yj),Object.defineProperty(Aj,"isAxiosError",{value:!0}),rn.from=(r,e,i,n,s,o)=>{const l=Object.create(Aj);return Wt.toFlatObject(r,l,function(u){return u!==Error.prototype},u=>u!=="isAxiosError"),rn.call(l,r.message,e,i,n,s),l.cause=r,l.name=r.name,o&&Object.assign(l,o),l};const G2e=null;function hB(r){return Wt.isPlainObject(r)||Wt.isArray(r)}function vj(r){return Wt.endsWith(r,"[]")?r.slice(0,-2):r}function bj(r,e,i){return r?r.concat(e).map(function(n,s){return n=vj(n),!i&&s?"["+n+"]":n}).join(i?".":""):e}function V2e(r){return Wt.isArray(r)&&!r.some(hB)}const H2e=Wt.toFlatObject(Wt,{},null,function(r){return/^is[A-Z]/.test(r)});function wE(r,e,i){if(!Wt.isObject(r))throw new TypeError("target must be an object");e=e||new FormData,i=Wt.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(m,y){return!Wt.isUndefined(y[m])});const n=i.metaTokens,s=i.visitor||h,o=i.dots,l=i.indexes,u=(i.Blob||typeof Blob<"u"&&Blob)&&Wt.isSpecCompliantForm(e);if(!Wt.isFunction(s))throw new TypeError("visitor must be a function");function c(m){if(m===null)return"";if(Wt.isDate(m))return m.toISOString();if(!u&&Wt.isBlob(m))throw new rn("Blob is not supported. Use a Buffer instead.");return Wt.isArrayBuffer(m)||Wt.isTypedArray(m)?u&&typeof Blob=="function"?new Blob([m]):Buffer.from(m):m}function h(m,y,b){let v=m;if(m&&!b&&typeof m=="object"){if(Wt.endsWith(y,"{}"))y=n?y:y.slice(0,-2),m=JSON.stringify(m);else if(Wt.isArray(m)&&V2e(m)||(Wt.isFileList(m)||Wt.endsWith(y,"[]"))&&(v=Wt.toArray(m)))return y=vj(y),v.forEach(function(_,C){!(Wt.isUndefined(_)||_===null)&&e.append(l===!0?bj([y],C,o):l===null?y:y+"[]",c(_))}),!1}return hB(m)?!0:(e.append(bj(b,y,o),c(m)),!1)}const p=[],f=Object.assign(H2e,{defaultVisitor:h,convertValue:c,isVisitable:hB});function g(m,y){if(!Wt.isUndefined(m)){if(p.indexOf(m)!==-1)throw Error("Circular reference detected in "+y.join("."));p.push(m),Wt.forEach(m,function(b,v){(!(Wt.isUndefined(b)||b===null)&&s.call(e,b,Wt.isString(v)?v.trim():v,y,f))===!0&&g(b,y?y.concat(v):[v])}),p.pop()}}if(!Wt.isObject(r))throw new TypeError("data must be an object");return g(r),e}function xj(r){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(i){return e[i]})}function dB(r,e){this._pairs=[],r&&wE(r,this,e)}const _j=dB.prototype;_j.append=function(r,e){this._pairs.push([r,e])},_j.toString=function(r){const e=r?function(i){return r.call(this,i,xj)}:xj;return this._pairs.map(function(i){return e(i[0])+"="+e(i[1])},"").join("&")};function W2e(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Ej(r,e,i){if(!e)return r;const n=i&&i.encode||W2e;Wt.isFunction(i)&&(i={serialize:i});const s=i&&i.serialize;let o;if(s?o=s(e,i):o=Wt.isURLSearchParams(e)?e.toString():new dB(e,i).toString(n),o){const l=r.indexOf("#");l!==-1&&(r=r.slice(0,l)),r+=(r.indexOf("?")===-1?"?":"&")+o}return r}class wj{constructor(){this.handlers=[]}use(e,i,n){return this.handlers.push({fulfilled:e,rejected:i,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Wt.forEach(this.handlers,function(i){i!==null&&e(i)})}}const Cj={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Q2e=typeof URLSearchParams<"u"?URLSearchParams:dB,q2e=typeof FormData<"u"?FormData:null,X2e=typeof Blob<"u"?Blob:null,K2e={isBrowser:!0,classes:{URLSearchParams:Q2e,FormData:q2e,Blob:X2e},protocols:["http","https","file","blob","url","data"]},pB=typeof window<"u"&&typeof document<"u",fB=typeof navigator=="object"&&navigator||void 0,Y2e=pB&&(!fB||["ReactNative","NativeScript","NS"].indexOf(fB.product)<0),J2e=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Z2e=pB&&window.location.href||"http://localhost",$2e=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:pB,hasStandardBrowserEnv:Y2e,hasStandardBrowserWebWorkerEnv:J2e,navigator:fB,origin:Z2e},Symbol.toStringTag,{value:"Module"})),co={...$2e,...K2e};function eCe(r,e){return wE(r,new co.classes.URLSearchParams,Object.assign({visitor:function(i,n,s,o){return co.isNode&&Wt.isBuffer(i)?(this.append(n,i.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},e))}function tCe(r){return Wt.matchAll(/\w+|\[(\w*)]/g,r).map(e=>e[0]==="[]"?"":e[1]||e[0])}function iCe(r){const e={},i=Object.keys(r);let n;const s=i.length;let o;for(n=0;n<s;n++)o=i[n],e[o]=r[o];return e}function Sj(r){function e(i,n,s,o){let l=i[o++];if(l==="__proto__")return!0;const u=Number.isFinite(+l),c=o>=i.length;return l=!l&&Wt.isArray(s)?s.length:l,c?(Wt.hasOwnProp(s,l)?s[l]=[s[l],n]:s[l]=n,!u):((!s[l]||!Wt.isObject(s[l]))&&(s[l]=[]),e(i,n,s[l],o)&&Wt.isArray(s[l])&&(s[l]=iCe(s[l])),!u)}if(Wt.isFormData(r)&&Wt.isFunction(r.entries)){const i={};return Wt.forEachEntry(r,(n,s)=>{e(tCe(n),s,i,0)}),i}return null}function rCe(r,e,i){if(Wt.isString(r))try{return(e||JSON.parse)(r),Wt.trim(r)}catch(n){if(n.name!=="SyntaxError")throw n}return(i||JSON.stringify)(r)}const hv={transitional:Cj,adapter:["xhr","http","fetch"],transformRequest:[function(r,e){const i=e.getContentType()||"",n=i.indexOf("application/json")>-1,s=Wt.isObject(r);if(s&&Wt.isHTMLForm(r)&&(r=new FormData(r)),Wt.isFormData(r))return n?JSON.stringify(Sj(r)):r;if(Wt.isArrayBuffer(r)||Wt.isBuffer(r)||Wt.isStream(r)||Wt.isFile(r)||Wt.isBlob(r)||Wt.isReadableStream(r))return r;if(Wt.isArrayBufferView(r))return r.buffer;if(Wt.isURLSearchParams(r))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),r.toString();let o;if(s){if(i.indexOf("application/x-www-form-urlencoded")>-1)return eCe(r,this.formSerializer).toString();if((o=Wt.isFileList(r))||i.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return wE(o?{"files[]":r}:r,l&&new l,this.formSerializer)}}return s||n?(e.setContentType("application/json",!1),rCe(r)):r}],transformResponse:[function(r){const e=this.transitional||hv.transitional,i=e&&e.forcedJSONParsing,n=this.responseType==="json";if(Wt.isResponse(r)||Wt.isReadableStream(r))return r;if(r&&Wt.isString(r)&&(i&&!this.responseType||n)){const s=!(e&&e.silentJSONParsing)&&n;try{return JSON.parse(r)}catch(o){if(s)throw o.name==="SyntaxError"?rn.from(o,rn.ERR_BAD_RESPONSE,this,null,this.response):o}}return r}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:co.classes.FormData,Blob:co.classes.Blob},validateStatus:function(r){return r>=200&&r<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Wt.forEach(["delete","get","head","post","put","patch"],r=>{hv.headers[r]={}});const nCe=Wt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),sCe=r=>{const e={};let i,n,s;return r&&r.split(`
`).forEach(function(o){s=o.indexOf(":"),i=o.substring(0,s).trim().toLowerCase(),n=o.substring(s+1).trim(),!(!i||e[i]&&nCe[i])&&(i==="set-cookie"?e[i]?e[i].push(n):e[i]=[n]:e[i]=e[i]?e[i]+", "+n:n)}),e},Tj=Symbol("internals");function dv(r){return r&&String(r).trim().toLowerCase()}function CE(r){return r===!1||r==null?r:Wt.isArray(r)?r.map(CE):String(r)}function aCe(r){const e=Object.create(null),i=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=i.exec(r);)e[n[1]]=n[2];return e}const oCe=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function mB(r,e,i,n,s){if(Wt.isFunction(n))return n.call(this,e,i);if(s&&(e=i),!!Wt.isString(e)){if(Wt.isString(n))return e.indexOf(n)!==-1;if(Wt.isRegExp(n))return n.test(e)}}function lCe(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,i,n)=>i.toUpperCase()+n)}function cCe(r,e){const i=Wt.toCamelCase(" "+e);["get","set","has"].forEach(n=>{Object.defineProperty(r,n+i,{value:function(s,o,l){return this[n].call(this,e,s,o,l)},configurable:!0})})}let tl=class{constructor(r){r&&this.set(r)}set(r,e,i){const n=this;function s(l,u,c){const h=dv(u);if(!h)throw new Error("header name must be a non-empty string");const p=Wt.findKey(n,h);(!p||n[p]===void 0||c===!0||c===void 0&&n[p]!==!1)&&(n[p||u]=CE(l))}const o=(l,u)=>Wt.forEach(l,(c,h)=>s(c,h,u));if(Wt.isPlainObject(r)||r instanceof this.constructor)o(r,e);else if(Wt.isString(r)&&(r=r.trim())&&!oCe(r))o(sCe(r),e);else if(Wt.isObject(r)&&Wt.isIterable(r)){let l={},u,c;for(const h of r){if(!Wt.isArray(h))throw TypeError("Object iterator must return a key-value pair");l[c=h[0]]=(u=l[c])?Wt.isArray(u)?[...u,h[1]]:[u,h[1]]:h[1]}o(l,e)}else r!=null&&s(e,r,i);return this}get(r,e){if(r=dv(r),r){const i=Wt.findKey(this,r);if(i){const n=this[i];if(!e)return n;if(e===!0)return aCe(n);if(Wt.isFunction(e))return e.call(this,n,i);if(Wt.isRegExp(e))return e.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(r,e){if(r=dv(r),r){const i=Wt.findKey(this,r);return!!(i&&this[i]!==void 0&&(!e||mB(this,this[i],i,e)))}return!1}delete(r,e){const i=this;let n=!1;function s(o){if(o=dv(o),o){const l=Wt.findKey(i,o);l&&(!e||mB(i,i[l],l,e))&&(delete i[l],n=!0)}}return Wt.isArray(r)?r.forEach(s):s(r),n}clear(r){const e=Object.keys(this);let i=e.length,n=!1;for(;i--;){const s=e[i];(!r||mB(this,this[s],s,r,!0))&&(delete this[s],n=!0)}return n}normalize(r){const e=this,i={};return Wt.forEach(this,(n,s)=>{const o=Wt.findKey(i,s);if(o){e[o]=CE(n),delete e[s];return}const l=r?lCe(s):String(s).trim();l!==s&&delete e[s],e[l]=CE(n),i[l]=!0}),this}concat(...r){return this.constructor.concat(this,...r)}toJSON(r){const e=Object.create(null);return Wt.forEach(this,(i,n)=>{i!=null&&i!==!1&&(e[n]=r&&Wt.isArray(i)?i.join(", "):i)}),e}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([r,e])=>r+": "+e).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(r){return r instanceof this?r:new this(r)}static concat(r,...e){const i=new this(r);return e.forEach(n=>i.set(n)),i}static accessor(r){const e=(this[Tj]=this[Tj]={accessors:{}}).accessors,i=this.prototype;function n(s){const o=dv(s);e[o]||(cCe(i,s),e[o]=!0)}return Wt.isArray(r)?r.forEach(n):n(r),this}};tl.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Wt.reduceDescriptors(tl.prototype,({value:r},e)=>{let i=e[0].toUpperCase()+e.slice(1);return{get:()=>r,set(n){this[i]=n}}}),Wt.freezeMethods(tl);function gB(r,e){const i=this||hv,n=e||i,s=tl.from(n.headers);let o=n.data;return Wt.forEach(r,function(l){o=l.call(i,o,s.normalize(),e?e.status:void 0)}),s.normalize(),o}function Mj(r){return!!(r&&r.__CANCEL__)}function i0(r,e,i){rn.call(this,r??"canceled",rn.ERR_CANCELED,e,i),this.name="CanceledError"}Wt.inherits(i0,rn,{__CANCEL__:!0});function Rj(r,e,i){const n=i.config.validateStatus;!i.status||!n||n(i.status)?r(i):e(new rn("Request failed with status code "+i.status,[rn.ERR_BAD_REQUEST,rn.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i))}function uCe(r){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return e&&e[1]||""}function hCe(r,e){r=r||10;const i=new Array(r),n=new Array(r);let s=0,o=0,l;return e=e!==void 0?e:1e3,function(u){const c=Date.now(),h=n[o];l||(l=c),i[s]=u,n[s]=c;let p=o,f=0;for(;p!==s;)f+=i[p++],p=p%r;if(s=(s+1)%r,s===o&&(o=(o+1)%r),c-l<e)return;const g=h&&c-h;return g?Math.round(f*1e3/g):void 0}}function dCe(r,e){let i=0,n=1e3/e,s,o;const l=(u,c=Date.now())=>{i=c,s=null,o&&(clearTimeout(o),o=null),r.apply(null,u)};return[(...u)=>{const c=Date.now(),h=c-i;h>=n?l(u,c):(s=u,o||(o=setTimeout(()=>{o=null,l(s)},n-h)))},()=>s&&l(s)]}const SE=(r,e,i=3)=>{let n=0;const s=hCe(50,250);return dCe(o=>{const l=o.loaded,u=o.lengthComputable?o.total:void 0,c=l-n,h=s(c),p=l<=u;n=l;const f={loaded:l,total:u,progress:u?l/u:void 0,bytes:c,rate:h||void 0,estimated:h&&u&&p?(u-l)/h:void 0,event:o,lengthComputable:u!=null,[e?"download":"upload"]:!0};r(f)},i)},Ij=(r,e)=>{const i=r!=null;return[n=>e[0]({lengthComputable:i,total:r,loaded:n}),e[1]]},Bj=r=>(...e)=>Wt.asap(()=>r(...e)),pCe=co.hasStandardBrowserEnv?((r,e)=>i=>(i=new URL(i,co.origin),r.protocol===i.protocol&&r.host===i.host&&(e||r.port===i.port)))(new URL(co.origin),co.navigator&&/(msie|trident)/i.test(co.navigator.userAgent)):()=>!0,fCe=co.hasStandardBrowserEnv?{write(r,e,i,n,s,o){const l=[r+"="+encodeURIComponent(e)];Wt.isNumber(i)&&l.push("expires="+new Date(i).toGMTString()),Wt.isString(n)&&l.push("path="+n),Wt.isString(s)&&l.push("domain="+s),o===!0&&l.push("secure"),document.cookie=l.join("; ")},read(r){const e=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(r){this.write(r,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function mCe(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function gCe(r,e){return e?r.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):r}function Nj(r,e,i){let n=!mCe(e);return r&&(n||i==!1)?gCe(r,e):e}const Lj=r=>r instanceof tl?{...r}:r;function uf(r,e){e=e||{};const i={};function n(h,p,f,g){return Wt.isPlainObject(h)&&Wt.isPlainObject(p)?Wt.merge.call({caseless:g},h,p):Wt.isPlainObject(p)?Wt.merge({},p):Wt.isArray(p)?p.slice():p}function s(h,p,f,g){if(Wt.isUndefined(p)){if(!Wt.isUndefined(h))return n(void 0,h,f,g)}else return n(h,p,f,g)}function o(h,p){if(!Wt.isUndefined(p))return n(void 0,p)}function l(h,p){if(Wt.isUndefined(p)){if(!Wt.isUndefined(h))return n(void 0,h)}else return n(void 0,p)}function u(h,p,f){if(f in e)return n(h,p);if(f in r)return n(void 0,h)}const c={url:o,method:o,data:o,baseURL:l,transformRequest:l,transformResponse:l,paramsSerializer:l,timeout:l,timeoutMessage:l,withCredentials:l,withXSRFToken:l,adapter:l,responseType:l,xsrfCookieName:l,xsrfHeaderName:l,onUploadProgress:l,onDownloadProgress:l,decompress:l,maxContentLength:l,maxBodyLength:l,beforeRedirect:l,transport:l,httpAgent:l,httpsAgent:l,cancelToken:l,socketPath:l,responseEncoding:l,validateStatus:u,headers:(h,p,f)=>s(Lj(h),Lj(p),f,!0)};return Wt.forEach(Object.keys(Object.assign({},r,e)),function(h){const p=c[h]||s,f=p(r[h],e[h],h);Wt.isUndefined(f)&&p!==u||(i[h]=f)}),i}const Dj=r=>{const e=uf({},r);let{data:i,withXSRFToken:n,xsrfHeaderName:s,xsrfCookieName:o,headers:l,auth:u}=e;e.headers=l=tl.from(l),e.url=Ej(Nj(e.baseURL,e.url,e.allowAbsoluteUrls),r.params,r.paramsSerializer),u&&l.set("Authorization","Basic "+btoa((u.username||"")+":"+(u.password?unescape(encodeURIComponent(u.password)):"")));let c;if(Wt.isFormData(i)){if(co.hasStandardBrowserEnv||co.hasStandardBrowserWebWorkerEnv)l.setContentType(void 0);else if((c=l.getContentType())!==!1){const[h,...p]=c?c.split(";").map(f=>f.trim()).filter(Boolean):[];l.setContentType([h||"multipart/form-data",...p].join("; "))}}if(co.hasStandardBrowserEnv&&(n&&Wt.isFunction(n)&&(n=n(e)),n||n!==!1&&pCe(e.url))){const h=s&&o&&fCe.read(o);h&&l.set(s,h)}return e},ACe=typeof XMLHttpRequest<"u",yCe=ACe&&function(r){return new Promise(function(e,i){const n=Dj(r);let s=n.data;const o=tl.from(n.headers).normalize();let{responseType:l,onUploadProgress:u,onDownloadProgress:c}=n,h,p,f,g,m;function y(){g&&g(),m&&m(),n.cancelToken&&n.cancelToken.unsubscribe(h),n.signal&&n.signal.removeEventListener("abort",h)}let b=new XMLHttpRequest;b.open(n.method.toUpperCase(),n.url,!0),b.timeout=n.timeout;function v(){if(!b)return;const C=tl.from("getAllResponseHeaders"in b&&b.getAllResponseHeaders()),E={data:!l||l==="text"||l==="json"?b.responseText:b.response,status:b.status,statusText:b.statusText,headers:C,config:r,request:b};Rj(function(T){e(T),y()},function(T){i(T),y()},E),b=null}"onloadend"in b?b.onloadend=v:b.onreadystatechange=function(){!b||b.readyState!==4||b.status===0&&!(b.responseURL&&b.responseURL.indexOf("file:")===0)||setTimeout(v)},b.onabort=function(){b&&(i(new rn("Request aborted",rn.ECONNABORTED,r,b)),b=null)},b.onerror=function(){i(new rn("Network Error",rn.ERR_NETWORK,r,b)),b=null},b.ontimeout=function(){let C=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const E=n.transitional||Cj;n.timeoutErrorMessage&&(C=n.timeoutErrorMessage),i(new rn(C,E.clarifyTimeoutError?rn.ETIMEDOUT:rn.ECONNABORTED,r,b)),b=null},s===void 0&&o.setContentType(null),"setRequestHeader"in b&&Wt.forEach(o.toJSON(),function(C,E){b.setRequestHeader(E,C)}),Wt.isUndefined(n.withCredentials)||(b.withCredentials=!!n.withCredentials),l&&l!=="json"&&(b.responseType=n.responseType),c&&([f,m]=SE(c,!0),b.addEventListener("progress",f)),u&&b.upload&&([p,g]=SE(u),b.upload.addEventListener("progress",p),b.upload.addEventListener("loadend",g)),(n.cancelToken||n.signal)&&(h=C=>{b&&(i(!C||C.type?new i0(null,r,b):C),b.abort(),b=null)},n.cancelToken&&n.cancelToken.subscribe(h),n.signal&&(n.signal.aborted?h():n.signal.addEventListener("abort",h)));const _=uCe(n.url);if(_&&co.protocols.indexOf(_)===-1){i(new rn("Unsupported protocol "+_+":",rn.ERR_BAD_REQUEST,r));return}b.send(s||null)})},vCe=(r,e)=>{const{length:i}=r=r?r.filter(Boolean):[];if(e||i){let n=new AbortController,s;const o=function(h){if(!s){s=!0,u();const p=h instanceof Error?h:this.reason;n.abort(p instanceof rn?p:new i0(p instanceof Error?p.message:p))}};let l=e&&setTimeout(()=>{l=null,o(new rn(`timeout ${e} of ms exceeded`,rn.ETIMEDOUT))},e);const u=()=>{r&&(l&&clearTimeout(l),l=null,r.forEach(h=>{h.unsubscribe?h.unsubscribe(o):h.removeEventListener("abort",o)}),r=null)};r.forEach(h=>h.addEventListener("abort",o));const{signal:c}=n;return c.unsubscribe=()=>Wt.asap(u),c}},bCe=function*(r,e){let i=r.byteLength;if(i<e){yield r;return}let n=0,s;for(;n<i;)s=n+e,yield r.slice(n,s),n=s},xCe=async function*(r,e){for await(const i of _Ce(r))yield*bCe(i,e)},_Ce=async function*(r){if(r[Symbol.asyncIterator]){yield*r;return}const e=r.getReader();try{for(;;){const{done:i,value:n}=await e.read();if(i)break;yield n}}finally{await e.cancel()}},Oj=(r,e,i,n)=>{const s=xCe(r,e);let o=0,l,u=c=>{l||(l=!0,n&&n(c))};return new ReadableStream({async pull(c){try{const{done:h,value:p}=await s.next();if(h){u(),c.close();return}let f=p.byteLength;if(i){let g=o+=f;i(g)}c.enqueue(new Uint8Array(p))}catch(h){throw u(h),h}},cancel(c){return u(c),s.return()}},{highWaterMark:2})},TE=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Pj=TE&&typeof ReadableStream=="function",ECe=TE&&(typeof TextEncoder=="function"?(r=>e=>r.encode(e))(new TextEncoder):async r=>new Uint8Array(await new Response(r).arrayBuffer())),kj=(r,...e)=>{try{return!!r(...e)}catch{return!1}},wCe=Pj&&kj(()=>{let r=!1;const e=new Request(co.origin,{body:new ReadableStream,method:"POST",get duplex(){return r=!0,"half"}}).headers.has("Content-Type");return r&&!e}),Fj=64*1024,AB=Pj&&kj(()=>Wt.isReadableStream(new Response("").body)),ME={stream:AB&&(r=>r.body)};TE&&(r=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!ME[e]&&(ME[e]=Wt.isFunction(r[e])?i=>i[e]():(i,n)=>{throw new rn(`Response type '${e}' is not supported`,rn.ERR_NOT_SUPPORT,n)})})})(new Response);const CCe=async r=>{if(r==null)return 0;if(Wt.isBlob(r))return r.size;if(Wt.isSpecCompliantForm(r))return(await new Request(co.origin,{method:"POST",body:r}).arrayBuffer()).byteLength;if(Wt.isArrayBufferView(r)||Wt.isArrayBuffer(r))return r.byteLength;if(Wt.isURLSearchParams(r)&&(r=r+""),Wt.isString(r))return(await ECe(r)).byteLength},SCe=async(r,e)=>Wt.toFiniteNumber(r.getContentLength())??CCe(e),TCe=TE&&(async r=>{let{url:e,method:i,data:n,signal:s,cancelToken:o,timeout:l,onDownloadProgress:u,onUploadProgress:c,responseType:h,headers:p,withCredentials:f="same-origin",fetchOptions:g}=Dj(r);h=h?(h+"").toLowerCase():"text";let m=vCe([s,o&&o.toAbortSignal()],l),y;const b=m&&m.unsubscribe&&(()=>{m.unsubscribe()});let v;try{if(c&&wCe&&i!=="get"&&i!=="head"&&(v=await SCe(p,n))!==0){let R=new Request(e,{method:"POST",body:n,duplex:"half"}),B;if(Wt.isFormData(n)&&(B=R.headers.get("content-type"))&&p.setContentType(B),R.body){const[I,D]=Ij(v,SE(Bj(c)));n=Oj(R.body,Fj,I,D)}}Wt.isString(f)||(f=f?"include":"omit");const _="credentials"in Request.prototype;y=new Request(e,{...g,signal:m,method:i.toUpperCase(),headers:p.normalize().toJSON(),body:n,duplex:"half",credentials:_?f:void 0});let C=await fetch(y);const E=AB&&(h==="stream"||h==="response");if(AB&&(u||E&&b)){const R={};["status","statusText","headers"].forEach(L=>{R[L]=C[L]});const B=Wt.toFiniteNumber(C.headers.get("content-length")),[I,D]=u&&Ij(B,SE(Bj(u),!0))||[];C=new Response(Oj(C.body,Fj,I,()=>{D&&D(),b&&b()}),R)}h=h||"text";let T=await ME[Wt.findKey(ME,h)||"text"](C,r);return!E&&b&&b(),await new Promise((R,B)=>{Rj(R,B,{data:T,headers:tl.from(C.headers),status:C.status,statusText:C.statusText,config:r,request:y})})}catch(_){throw b&&b(),_&&_.name==="TypeError"&&/Load failed|fetch/i.test(_.message)?Object.assign(new rn("Network Error",rn.ERR_NETWORK,r,y),{cause:_.cause||_}):rn.from(_,_&&_.code,r,y)}}),yB={http:G2e,xhr:yCe,fetch:TCe};Wt.forEach(yB,(r,e)=>{if(r){try{Object.defineProperty(r,"name",{value:e})}catch{}Object.defineProperty(r,"adapterName",{value:e})}});const Uj=r=>`- ${r}`,MCe=r=>Wt.isFunction(r)||r===null||r===!1,zj={getAdapter:r=>{r=Wt.isArray(r)?r:[r];const{length:e}=r;let i,n;const s={};for(let o=0;o<e;o++){i=r[o];let l;if(n=i,!MCe(i)&&(n=yB[(l=String(i)).toLowerCase()],n===void 0))throw new rn(`Unknown adapter '${l}'`);if(n)break;s[l||"#"+o]=n}if(!n){const o=Object.entries(s).map(([u,c])=>`adapter ${u} `+(c===!1?"is not supported by the environment":"is not available in the build"));let l=e?o.length>1?`since :
`+o.map(Uj).join(`
`):" "+Uj(o[0]):"as no adapter specified";throw new rn("There is no suitable adapter to dispatch the request "+l,"ERR_NOT_SUPPORT")}return n},adapters:yB};function vB(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new i0(null,r)}function jj(r){return vB(r),r.headers=tl.from(r.headers),r.data=gB.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),zj.getAdapter(r.adapter||hv.adapter)(r).then(function(e){return vB(r),e.data=gB.call(r,r.transformResponse,e),e.headers=tl.from(e.headers),e},function(e){return Mj(e)||(vB(r),e&&e.response&&(e.response.data=gB.call(r,r.transformResponse,e.response),e.response.headers=tl.from(e.response.headers))),Promise.reject(e)})}const Gj="1.9.0",RE={};["object","boolean","number","function","string","symbol"].forEach((r,e)=>{RE[r]=function(i){return typeof i===r||"a"+(e<1?"n ":" ")+r}});const Vj={};RE.transitional=function(r,e,i){function n(s,o){return"[Axios v"+Gj+"] Transitional option '"+s+"'"+o+(i?". "+i:"")}return(s,o,l)=>{if(r===!1)throw new rn(n(o," has been removed"+(e?" in "+e:"")),rn.ERR_DEPRECATED);return e&&!Vj[o]&&(Vj[o]=!0,console.warn(n(o," has been deprecated since v"+e+" and will be removed in the near future"))),r?r(s,o,l):!0}},RE.spelling=function(r){return(e,i)=>(console.warn(`${i} is likely a misspelling of ${r}`),!0)};function RCe(r,e,i){if(typeof r!="object")throw new rn("options must be an object",rn.ERR_BAD_OPTION_VALUE);const n=Object.keys(r);let s=n.length;for(;s-- >0;){const o=n[s],l=e[o];if(l){const u=r[o],c=u===void 0||l(u,o,r);if(c!==!0)throw new rn("option "+o+" must be "+c,rn.ERR_BAD_OPTION_VALUE);continue}if(i!==!0)throw new rn("Unknown option "+o,rn.ERR_BAD_OPTION)}}const IE={assertOptions:RCe,validators:RE},nu=IE.validators;let hf=class{constructor(r){this.defaults=r||{},this.interceptors={request:new wj,response:new wj}}async request(r,e){try{return await this._request(r,e)}catch(i){if(i instanceof Error){let n={};Error.captureStackTrace?Error.captureStackTrace(n):n=new Error;const s=n.stack?n.stack.replace(/^.+\n/,""):"";try{i.stack?s&&!String(i.stack).endsWith(s.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+s):i.stack=s}catch{}}throw i}}_request(r,e){typeof r=="string"?(e=e||{},e.url=r):e=r||{},e=uf(this.defaults,e);const{transitional:i,paramsSerializer:n,headers:s}=e;i!==void 0&&IE.assertOptions(i,{silentJSONParsing:nu.transitional(nu.boolean),forcedJSONParsing:nu.transitional(nu.boolean),clarifyTimeoutError:nu.transitional(nu.boolean)},!1),n!=null&&(Wt.isFunction(n)?e.paramsSerializer={serialize:n}:IE.assertOptions(n,{encode:nu.function,serialize:nu.function},!0)),e.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?e.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:e.allowAbsoluteUrls=!0),IE.assertOptions(e,{baseUrl:nu.spelling("baseURL"),withXsrfToken:nu.spelling("withXSRFToken")},!0),e.method=(e.method||this.defaults.method||"get").toLowerCase();let o=s&&Wt.merge(s.common,s[e.method]);s&&Wt.forEach(["delete","get","head","post","put","patch","common"],m=>{delete s[m]}),e.headers=tl.concat(o,s);const l=[];let u=!0;this.interceptors.request.forEach(function(m){typeof m.runWhen=="function"&&m.runWhen(e)===!1||(u=u&&m.synchronous,l.unshift(m.fulfilled,m.rejected))});const c=[];this.interceptors.response.forEach(function(m){c.push(m.fulfilled,m.rejected)});let h,p=0,f;if(!u){const m=[jj.bind(this),void 0];for(m.unshift.apply(m,l),m.push.apply(m,c),f=m.length,h=Promise.resolve(e);p<f;)h=h.then(m[p++],m[p++]);return h}f=l.length;let g=e;for(p=0;p<f;){const m=l[p++],y=l[p++];try{g=m(g)}catch(b){y.call(this,b);break}}try{h=jj.call(this,g)}catch(m){return Promise.reject(m)}for(p=0,f=c.length;p<f;)h=h.then(c[p++],c[p++]);return h}getUri(r){r=uf(this.defaults,r);const e=Nj(r.baseURL,r.url,r.allowAbsoluteUrls);return Ej(e,r.params,r.paramsSerializer)}};Wt.forEach(["delete","get","head","options"],function(r){hf.prototype[r]=function(e,i){return this.request(uf(i||{},{method:r,url:e,data:(i||{}).data}))}}),Wt.forEach(["post","put","patch"],function(r){function e(i){return function(n,s,o){return this.request(uf(o||{},{method:r,headers:i?{"Content-Type":"multipart/form-data"}:{},url:n,data:s}))}}hf.prototype[r]=e(),hf.prototype[r+"Form"]=e(!0)});let ICe=class aW{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let i;this.promise=new Promise(function(s){i=s});const n=this;this.promise.then(s=>{if(!n._listeners)return;let o=n._listeners.length;for(;o-- >0;)n._listeners[o](s);n._listeners=null}),this.promise.then=s=>{let o;const l=new Promise(u=>{n.subscribe(u),o=u}).then(s);return l.cancel=function(){n.unsubscribe(o)},l},e(function(s,o,l){n.reason||(n.reason=new i0(s,o,l),i(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const i=this._listeners.indexOf(e);i!==-1&&this._listeners.splice(i,1)}toAbortSignal(){const e=new AbortController,i=n=>{e.abort(n)};return this.subscribe(i),e.signal.unsubscribe=()=>this.unsubscribe(i),e.signal}static source(){let e;return{token:new aW(function(i){e=i}),cancel:e}}};function BCe(r){return function(e){return r.apply(null,e)}}function NCe(r){return Wt.isObject(r)&&r.isAxiosError===!0}const bB={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(bB).forEach(([r,e])=>{bB[e]=r});function Hj(r){const e=new hf(r),i=lj(hf.prototype.request,e);return Wt.extend(i,hf.prototype,e,{allOwnKeys:!0}),Wt.extend(i,e,null,{allOwnKeys:!0}),i.create=function(n){return Hj(uf(r,n))},i}const Qs=Hj(hv);Qs.Axios=hf,Qs.CanceledError=i0,Qs.CancelToken=ICe,Qs.isCancel=Mj,Qs.VERSION=Gj,Qs.toFormData=wE,Qs.AxiosError=rn,Qs.Cancel=Qs.CanceledError,Qs.all=function(r){return Promise.all(r)},Qs.spread=BCe,Qs.isAxiosError=NCe,Qs.mergeConfig=uf,Qs.AxiosHeaders=tl,Qs.formToJSON=r=>Sj(Wt.isHTMLForm(r)?new FormData(r):r),Qs.getAdapter=zj.getAdapter,Qs.HttpStatusCode=bB,Qs.default=Qs;const{Axios:sNe,AxiosError:aNe,CanceledError:oNe,isCancel:lNe,CancelToken:cNe,VERSION:uNe,all:hNe,Cancel:dNe,isAxiosError:pNe,spread:fNe,toFormData:mNe,AxiosHeaders:gNe,HttpStatusCode:ANe,formToJSON:yNe,getAdapter:vNe,mergeConfig:bNe}=Qs;let pv={endpoint:null,data:null,timestamp:null};const LCe=15*60*1e3,Wj=async r=>{const e=Date.now();if(pv.data&&pv.endpoint===r&&e-pv.timestamp<LCe)return pv.data;const i=await PM(r);return pv={endpoint:r,data:i,timestamp:e},i},DCe=async(r,e="base",i=5)=>{if(!r||r.length<2)return{subjects:[],predicates:[],objects:[],triples:[]};try{const n=await Wj(e);return OCe(r,n,i)}catch(n){return console.error("Erreur lors de la génération des suggestions:",n),{subjects:[],predicates:[],objects:[],triples:[]}}},OCe=(r,e,i)=>{const n=r.toLowerCase(),s=[...new Set(e.filter(c=>c.subject.label.toLowerCase().includes(n)).map(c=>c.subject.label).slice(0,i))],o=[...new Set(e.filter(c=>c.predicate.label.toLowerCase().includes(n)).map(c=>c.predicate.label).slice(0,i))],l=[...new Set(e.filter(c=>c.object.label.toLowerCase().includes(n)).map(c=>c.object.label).slice(0,i))],u=e.filter(c=>c.subject.label.toLowerCase().includes(n)||c.predicate.label.toLowerCase().includes(n)||c.object.label.toLowerCase().includes(n)).map(c=>({subject:c.subject.label,predicate:c.predicate.label,object:c.object.label})).slice(0,i);return{subjects:s,predicates:o,objects:l,triples:u}},PCe=async(r,e,i="base")=>{try{let n=await Wj(i);if(r){const s=r.toLowerCase();n=n.filter(o=>o.subject.label.toLowerCase().includes(s)||o.predicate.label.toLowerCase().includes(s)||o.object.label.toLowerCase().includes(s))}return e.subject&&(n=n.filter(s=>s.subject.label.toLowerCase().includes(e.subject.toLowerCase()))),e.predicate&&(n=n.filter(s=>s.predicate.label.toLowerCase().includes(e.predicate.toLowerCase()))),e.object&&(n=n.filter(s=>s.object.label.toLowerCase().includes(e.object.toLowerCase()))),n}catch(n){return console.error("Erreur lors de la recherche avec filtres:",n),[]}},kCe=({endpoint:r,onSearch:e,isSearching:i,onSearchStart:n})=>{const[s,o]=Dt.useState(""),[l,u]=Dt.useState({subjects:[],predicates:[],objects:[],triples:[]}),[c,h]=Dt.useState({subject:"",predicate:"",object:""}),[p,f]=Dt.useState(!1),g=Dt.useRef(null),m=Dt.useRef(null),{isSearching:y}=oj(r);Dt.useEffect(()=>{const F=q=>{m.current&&!m.current.contains(q.target)&&f(!1)};return document.addEventListener("mousedown",F),()=>{document.removeEventListener("mousedown",F)}},[]),Dt.useEffect(()=>(s.length>=2?(clearTimeout(g.current),g.current=setTimeout(async()=>{try{const F=await DCe(s,r);u(F),f(F.subjects.length>0||F.predicates.length>0||F.objects.length>0)}catch(F){console.error("Error retrieving suggestions:",F)}},300)):(u({subjects:[],predicates:[],objects:[],triples:[]}),f(!1)),()=>{clearTimeout(g.current)}),[s,r]);const b=(F,q)=>{h(H=>H[F]===q?{...H,[F]:""}:{...H,[F]:q})},v=async()=>{typeof n=="function"?n():console.warn("onSearchStart is not a function");try{console.log("Searching with filters:",{query:s,selectedFilters:c,endpoint:r});const F=await PCe(s,c,r);console.log("Search results:",F),typeof e=="function"?e(F):console.error("onSearch is not a function")}catch(F){console.error("Error during search:",F)}},_=c.subject||c.predicate||c.object,C={container:{width:"100%",maxWidth:"550px",margin:"0 auto",position:"relative",zIndex:1e3},inputWrapper:{display:"flex",width:"100%",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",borderRadius:"12px",overflow:"hidden",backgroundColor:"rgba(30, 30, 40, 0.6)",backdropFilter:"blur(5px)",border:"1px solid rgba(255, 255, 255, 0.2)"},input:{flex:1,padding:"10px 15px",fontSize:"15px",border:"none",backgroundColor:"transparent",color:"white",outline:"none",fontWeight:"400",height:"40px"},button:{padding:"0 22px",border:"none",cursor:"pointer",fontWeight:"bold",fontSize:"15px",textTransform:"uppercase"},activeFilters:{display:"flex",flexWrap:"wrap",alignItems:"center",marginTop:"12px",padding:"8px 12px",backgroundColor:"rgba(30, 30, 40, 0.7)",borderRadius:"6px",border:"1px solid rgba(255, 255, 255, 0.1)",backdropFilter:"blur(5px)"},filtersLabel:{fontWeight:"600",marginRight:"12px",color:"rgba(255, 255, 255, 0.9)",fontSize:"13px"},filtersChips:{display:"flex",flexWrap:"wrap",gap:"6px",flex:1},filterChip:{display:"flex",alignItems:"center",padding:"3px 8px",borderRadius:"16px",fontSize:"12px",color:"white",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)"},subjectChip:{backgroundColor:`${Ks.SUBJECT}cc`},predicateChip:{backgroundColor:`${Ks.PREDICATE}cc`},objectChip:{backgroundColor:`${Ks.OBJECT}cc`},chipButton:{background:"none",border:"none",color:"white",marginLeft:"4px",cursor:"pointer",fontSize:"14px",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",width:"16px",height:"16px",borderRadius:"50%",transition:"background-color 0.2s ease"},chipButtonHover:{backgroundColor:"rgba(255, 255, 255, 0.2)"},clearButton:{padding:"4px 10px",backgroundColor:"rgba(255, 70, 70, 0.8)",color:"white",border:"none",borderRadius:"16px",cursor:"pointer",fontSize:"12px",fontWeight:"500",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)",transition:"background-color 0.2s ease",marginLeft:"auto"},clearButtonHover:{backgroundColor:"rgba(255, 70, 70, 1)"},suggestionsContainer:{position:"absolute",top:"calc(100% + 8px)",left:0,right:0,backgroundColor:"rgba(25, 25, 35, 0.9)",backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:"8px",maxHeight:"400px",overflowY:"auto",zIndex:1001,boxShadow:"0 8px 16px rgba(0, 0, 0, 0.3)",color:"white"},suggestionCategory:{padding:"14px",borderBottom:"1px solid rgba(255, 255, 255, 0.1)"},categoryHeader:{fontWeight:"600",marginBottom:"10px",color:"rgba(255, 255, 255, 0.8)",fontSize:"14px",textTransform:"uppercase",letterSpacing:"0.5px"},suggestionList:{display:"flex",flexWrap:"wrap",gap:"8px"},suggestionItem:{padding:"3px 8px",borderRadius:"16px",backgroundColor:"rgba(255, 255, 255, 0.15)",fontSize:"12px",cursor:"pointer",transition:"all 0.2s ease",color:"rgba(255, 255, 255, 0.9)"},suggestionItemHover:{backgroundColor:"rgba(255, 255, 255, 0.25)"},selectedSuggestion:{backgroundColor:"#4A66E8",color:"white"},subjectSuggestion:{backgroundColor:`${Ks.SUBJECT}cc`,border:"none"},predicateSuggestion:{backgroundColor:`${Ks.PREDICATE}cc`,border:"none"},objectSuggestion:{backgroundColor:`${Ks.OBJECT}cc`,border:"none"},tripleSuggestion:{padding:"8px 12px",borderRadius:"12px",fontSize:"13px",cursor:"pointer",transition:"all 0.2s ease",backgroundColor:"rgba(30, 30, 40, 0.55)",backdropFilter:"blur(5px)",border:"1px solid rgba(255, 255, 255, 0.15)",display:"flex",flexDirection:"row",flexWrap:"wrap",gap:"6px",alignItems:"center",justifyContent:"center"},tripleSuggestionHover:{backgroundColor:"rgba(50, 50, 60, 0.65)"},tripleSubjectPart:{color:Ks.SUBJECT,fontWeight:"500",padding:"2px 6px",borderRadius:"4px",backgroundColor:`${Ks.SUBJECT}33`},triplePredicatePart:{color:Ks.PREDICATE,fontWeight:"500",padding:"2px 6px",borderRadius:"4px",backgroundColor:`${Ks.PREDICATE}33`},tripleObjectPart:{color:Ks.OBJECT,fontWeight:"500",padding:"2px 6px",borderRadius:"4px",backgroundColor:`${Ks.OBJECT}33`}},[E,T]=Dt.useState(!1),[R,B]=Dt.useState(!1),[I,D]=Dt.useState(null),[L,O]=Dt.useState(null);return qe.jsxs("div",{style:C.container,children:[qe.jsxs("div",{style:C.inputWrapper,children:[qe.jsx("input",{type:"text",value:s,onChange:F=>o(F.target.value),placeholder:"Search for triples...",style:C.input,onFocus:()=>f(!0)}),qe.jsx("button",{onClick:v,disabled:y,style:{...C.button,backgroundColor:"#ffd32a",color:"#18181b",height:"40px",borderRadius:"0 12px 12px 0",boxShadow:"0 2px 8px rgba(0,0,0,0.18)",transition:"background 0.2s, color 0.2s, transform 0.1s"},onMouseEnter:F=>F.currentTarget.style.backgroundColor="#ffe066",onMouseLeave:F=>F.currentTarget.style.backgroundColor="#ffd32a",children:y?"Searching...":"Search"})]}),_&&qe.jsxs("div",{style:C.activeFilters,children:[qe.jsx("div",{style:C.filtersLabel,children:"Active filters:"}),qe.jsxs("div",{style:C.filtersChips,children:[c.subject&&qe.jsxs("div",{style:{...C.filterChip,...C.subjectChip},children:[qe.jsxs("span",{children:["Subject: ",c.subject]}),qe.jsx("button",{onClick:()=>b("subject",c.subject),style:{...C.chipButton,...I==="subject"?C.chipButtonHover:{}},onMouseEnter:()=>D("subject"),onMouseLeave:()=>D(null),children:"×"})]}),c.predicate&&qe.jsxs("div",{style:{...C.filterChip,...C.predicateChip},children:[qe.jsxs("span",{children:["Predicate: ",c.predicate]}),qe.jsx("button",{onClick:()=>b("predicate",c.predicate),style:{...C.chipButton,...I==="predicate"?C.chipButtonHover:{}},onMouseEnter:()=>D("predicate"),onMouseLeave:()=>D(null),children:"×"})]}),c.object&&qe.jsxs("div",{style:{...C.filterChip,...C.objectChip},children:[qe.jsxs("span",{children:["Object: ",c.object]}),qe.jsx("button",{onClick:()=>b("object",c.object),style:{...C.chipButton,...I==="object"?C.chipButtonHover:{}},onMouseEnter:()=>D("object"),onMouseLeave:()=>D(null),children:"×"})]})]}),qe.jsx("button",{onClick:()=>h({subject:"",predicate:"",object:""}),style:{...C.clearButton,...R?C.clearButtonHover:{}},onMouseEnter:()=>B(!0),onMouseLeave:()=>B(!1),children:"Clear all filters"})]}),p&&qe.jsxs("div",{style:C.suggestionsContainer,ref:m,children:[l.subjects.length>0&&qe.jsxs("div",{style:C.suggestionCategory,children:[qe.jsx("div",{style:C.categoryHeader,children:"Suggested Subjects"}),qe.jsx("div",{style:C.suggestionList,children:l.subjects.map((F,q)=>qe.jsx("div",{style:{...C.suggestionItem,...C.subjectSuggestion,...L===`subject-${q}`?C.suggestionItemHover:{},...c.subject===F?C.selectedSuggestion:{}},onClick:()=>b("subject",F),onMouseEnter:()=>O(`subject-${q}`),onMouseLeave:()=>O(null),children:F},`subject-${q}`))})]}),l.predicates.length>0&&qe.jsxs("div",{style:C.suggestionCategory,children:[qe.jsx("div",{style:C.categoryHeader,children:"Suggested Predicates"}),qe.jsx("div",{style:C.suggestionList,children:l.predicates.map((F,q)=>qe.jsx("div",{style:{...C.suggestionItem,...C.predicateSuggestion,...L===`predicate-${q}`?C.suggestionItemHover:{},...c.predicate===F?C.selectedSuggestion:{}},onClick:()=>b("predicate",F),onMouseEnter:()=>O(`predicate-${q}`),onMouseLeave:()=>O(null),children:F},`predicate-${q}`))})]}),l.objects.length>0&&qe.jsxs("div",{style:C.suggestionCategory,children:[qe.jsx("div",{style:C.categoryHeader,children:"Suggested Objects"}),qe.jsx("div",{style:C.suggestionList,children:l.objects.map((F,q)=>qe.jsx("div",{style:{...C.suggestionItem,...C.objectSuggestion,...L===`object-${q}`?C.suggestionItemHover:{},...c.object===F?C.selectedSuggestion:{}},onClick:()=>b("object",F),onMouseEnter:()=>O(`object-${q}`),onMouseLeave:()=>O(null),children:F},`object-${q}`))})]}),l.triples&&l.triples.length>0&&qe.jsxs("div",{style:C.suggestionCategory,children:[qe.jsx("div",{style:C.categoryHeader,children:"Suggested Triples"}),qe.jsx("div",{style:C.suggestionList,children:l.triples.map((F,q)=>qe.jsxs("div",{style:{...C.tripleSuggestion,...L===`triple-${q}`?C.tripleSuggestionHover:{}},onClick:()=>{h({subject:F.subject,predicate:F.predicate,object:F.object})},onMouseEnter:()=>O(`triple-${q}`),onMouseLeave:()=>O(null),children:[qe.jsx("span",{style:C.tripleSubjectPart,children:F.subject}),qe.jsx("span",{style:C.triplePredicatePart,children:F.predicate}),qe.jsx("span",{style:C.tripleObjectPart,children:F.object})]},`triple-${q}`))})]})]})]})},FCe={position:"fixed",bottom:"20px",left:"20px",width:"180px",height:"40px",padding:"0 12px",backgroundColor:"#ffd32a",display:"flex",justifyContent:"space-between",alignItems:"center",cursor:"pointer",borderRadius:"10px",color:"#18181b",border:"none",boxShadow:"0 2px 8px rgba(0,0,0,0.18)",fontWeight:"bold",fontSize:"15px",textTransform:"uppercase",zIndex:1200},UCe={position:"fixed",bottom:"20px",left:"20px",width:"380px",height:"500px",display:"flex",flexDirection:"column",borderRadius:"10px",overflow:"hidden",backgroundColor:"rgba(30, 30, 40, 0.85)",border:"1px solid rgba(255, 255, 255, 0.2)",backdropFilter:"blur(5px)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.25)",zIndex:1200},zCe=({walletAddress:r})=>{const[e,i]=Dt.useState([]),[n,s]=Dt.useState(""),[o,l]=Dt.useState(!1),[u,c]=Dt.useState(!0),h=Dt.useRef(null),p=Dt.useRef(null),f=Dt.useRef(null),g=()=>{var v;(v=h.current)==null||v.scrollIntoView({behavior:"smooth"})};Dt.useEffect(()=>{g()},[e]);const m=async()=>{if(!n.trim())return;const v={id:Date.now(),text:n,sender:"user"};i(_=>[..._,v]),s(""),l(!0);try{const _=await Qs.post("/api/completion",{text:n,walletAddress:r||"0x25d5C9DbC1E12163B973261A08739927E4F72BA7"},{headers:{"Content-Type":"application/json"}}),C={id:Date.now()+1,text:_.data.text||_.data,sender:"ai"};i(E=>[...E,C]),l(!1)}catch(_){console.error("Detailed error when calling the API:",_);const C={id:Date.now()+1,text:"Unable to communicate with API. This feature requires a server proxy configured to handle CORS requests.",sender:"system"};i(E=>[...E,C]),l(!1)}},y=v=>{v.preventDefault(),m()},b=()=>{c(!u),u&&p.current&&setTimeout(()=>{p.current.focus()},100)};return u?qe.jsxs("div",{ref:f,style:FCe,onClick:b,onMouseEnter:v=>{v.currentTarget.style.backgroundColor="#ffe066"},onMouseLeave:v=>{v.currentTarget.style.backgroundColor="#ffd32a"},children:[qe.jsx("span",{style:{textAlign:"center",flex:1},children:"INTUITION CHAT"}),qe.jsx("span",{style:{fontSize:"20px",display:"flex",alignItems:"center",justifyContent:"center",width:"20px",height:"20px"},children:"+"})]}):qe.jsxs("div",{style:UCe,children:[qe.jsxs("button",{style:{padding:"0px 12px",width:"100%",height:"40px",backgroundColor:"#ffd32a",display:"flex",justifyContent:"space-between",alignItems:"center",cursor:"pointer",borderRadius:"10px 10px 0 0",color:"#18181b",border:"none",boxShadow:"0 2px 8px rgba(0,0,0,0.18)",fontWeight:"bold",fontSize:"15px",textTransform:"uppercase"},onClick:b,onMouseEnter:v=>{v.currentTarget.style.backgroundColor="#ffe066"},onMouseLeave:v=>{v.currentTarget.style.backgroundColor="#ffd32a"},children:[qe.jsx("span",{style:{textAlign:"center",flex:1},children:"INTUITION CHAT"}),qe.jsx("span",{style:{fontSize:"20px",display:"flex",alignItems:"center",justifyContent:"center",width:"20px",height:"20px"},children:"−"})]}),qe.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"15px",display:"flex",flexDirection:"column",gap:"10px"},children:[e.length===0?qe.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"rgba(255, 255, 255, 0.6)",fontSize:"14px",textAlign:"center"},children:qe.jsx("p",{children:"Start a conversation with Intuition"})}):e.map(v=>qe.jsx("div",{style:{maxWidth:"80%",padding:"10px 15px",borderRadius:"18px",marginBottom:"5px",wordBreak:"break-word",alignSelf:v.sender==="user"?"flex-end":"flex-start",backgroundColor:v.sender==="user"?"#ffd32a":v.sender==="ai"?"rgba(50, 50, 60, 0.9)":"rgba(255, 70, 70, 0.8)",color:v.sender==="user"?"#18181b":"white",borderBottomRightRadius:v.sender==="user"?"4px":"18px",borderBottomLeftRadius:v.sender==="ai"?"4px":"18px"},children:v.text},v.id)),o&&qe.jsx("div",{style:{maxWidth:"80%",padding:"10px 15px",borderRadius:"18px",marginBottom:"5px",borderBottomLeftRadius:"4px",alignSelf:"flex-start",backgroundColor:"rgba(50, 50, 60, 0.9)",color:"white"},children:qe.jsxs("div",{style:{display:"flex",gap:"4px"},children:[qe.jsx("span",{style:{display:"inline-block",width:"8px",height:"8px",borderRadius:"50%",backgroundColor:"white",opacity:.6,animation:"intuition-dot-pulse 1.5s infinite ease-in-out"}}),qe.jsx("span",{style:{display:"inline-block",width:"8px",height:"8px",borderRadius:"50%",backgroundColor:"white",opacity:.6,animation:"intuition-dot-pulse 1.5s infinite ease-in-out 0.2s"}}),qe.jsx("span",{style:{display:"inline-block",width:"8px",height:"8px",borderRadius:"50%",backgroundColor:"white",opacity:.6,animation:"intuition-dot-pulse 1.5s infinite ease-in-out 0.4s"}})]})}),qe.jsx("div",{ref:h})]}),qe.jsxs("form",{style:{display:"flex",padding:"10px",backgroundColor:"rgba(40, 40, 50, 0.7)",borderTop:"1px solid rgba(255, 255, 255, 0.1)"},onSubmit:y,children:[qe.jsx("input",{ref:p,type:"text",value:n,onChange:v=>s(v.target.value),placeholder:"Ask your question...",disabled:o,style:{flex:1,padding:"12px 15px",borderRadius:"20px",border:"none",backgroundColor:"rgba(60, 60, 70, 0.7)",color:"white",fontSize:"14px",outline:"none"}}),qe.jsx("button",{type:"submit",disabled:o||!n.trim(),style:{width:"36px",height:"36px",marginLeft:"8px",borderRadius:"50%",backgroundColor:o||!n.trim()?"rgba(255, 211, 42, 0.5)":"#ffd32a",border:"none",display:"flex",alignItems:"center",justifyContent:"center",cursor:o||!n.trim()?"not-allowed":"pointer",color:"#18181b"},children:qe.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[qe.jsx("path",{d:"M22 2L11 13",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),qe.jsx("path",{d:"M22 2L15 22L11 13L2 9L22 2Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})})]}),qe.jsx("style",{children:`
          @keyframes intuition-dot-pulse {
            0%, 100% { transform: scale(1); opacity: 0.6; }
            50% { transform: scale(1.3); opacity: 1; }
          }
        `})]})},Qj="0xddfff342ce2547338b0f689aa3ec86893340fbdf",jCe=({endpoint:r,walletAddress:e})=>{const i=Dt.useRef(),n=Dt.useRef(),[s,o]=Dt.useState("2D"),[l,u]=Dt.useState(!1),[c,h]=Dt.useState(!1),[p,f]=Dt.useState(null),[g,m]=Dt.useState(!1),[y,b]=Dt.useState([]),[v,_]=Dt.useState([]),[C,E]=Dt.useState(!1),[T,R]=Dt.useState(!1),[B,I]=Dt.useState(!1),[D,L]=Dt.useState(null),[O,F]=Dt.useState("agent"),{graphData:q,isInitialLoad:H,selectedTriple:G,isLoading:J,isSearching:Q,subjectFilter:V,objectFilter:z,shouldSearch:te,canGoBack:K,canGoForward:ae,setIsInitialLoad:Ae,loadInitialData:_e,resetGraph:me,handleNodeClick:Pe,handleFilterChange:Xe,applyFilters:Je,goBack:tt,goForward:dt,graphHistory:wt,setGraphHistory:qt,currentHistoryIndex:yt,setCurrentHistoryIndex:Ei}=oj(r,O),$e=B&&D?D:q,Ui=T||Q;Dt.useEffect(()=>{console.log("GraphData updated:",$e)},[$e]),Dt.useEffect(()=>{_e()},[_e,O]),Dt.useEffect(()=>{te&&(I(!1),Je())},[te,Je]);const hi=()=>{H&&i.current&&Ae(!1)};Dt.useEffect(()=>{l&&p==="claims"&&Sue(Qj,r).then(b)},[l,p,r]),Dt.useEffect(()=>{l&&p==="positions"&&Tue(Qj,r).then(_)},[l,p,r]);const Ri=async Mt=>{console.log("Search results received:",Mt);try{if(Mt&&Mt.length>0){wt&&qt&&typeof qt=="function"&&(qt(vt=>{const ye=vt.slice(0,yt+1);return ye.push({graphData:$e,selectedTriple:null}),ye}),typeof Ei=="function"&&Ei(vt=>vt+1));const yi=yE(Mt);console.log("New graph data created:",yi),L(yi),I(!0),console.log("Graph data updated")}else console.log("No results found"),L({nodes:[],links:[]}),I(!0)}catch(yi){console.error("Error in handleSearch:",yi)}finally{R(!1)}},Si=()=>{console.log("Search starting..."),R(!0)},Zi=()=>{I(!1),me()},Vi=(Mt,yi)=>{I(!1),Xe(Mt,yi)},Ge=()=>{B&&I(!1)},Ce=[{key:null,label:"Map"},{key:"connections",label:"Connections"},{key:"positions",label:"Positions"},{key:"claims",label:"Claims"},{key:"activity",label:"Activity"}],At=Mt=>{f(Mt),u(!!Mt)},Pt=()=>{switch(p){case"claims":return qe.jsxs(qe.Fragment,{children:[qe.jsx("h2",{children:"Claims"}),y.length===0?qe.jsx("p",{style:{color:"#fff"},children:"No claims found."}):qe.jsx("div",{children:y.map(Mt=>qe.jsx(t2e,{claim:Mt},Mt.id))})]});case"positions":return qe.jsxs(qe.Fragment,{children:[qe.jsx("h2",{children:"Positions"}),v.length===0?qe.jsx("p",{style:{color:"#fff"},children:"No positions found."}):qe.jsx("div",{children:v.map(Mt=>qe.jsx(i2e,{position:Mt},Mt.id))})]});case"activity":return qe.jsxs(qe.Fragment,{children:[qe.jsx("h2",{children:"Activity"}),qe.jsx("p",{children:"Activity content here..."})]});case"connections":return qe.jsxs(qe.Fragment,{children:[qe.jsx("h2",{children:"Connections"}),qe.jsx("p",{children:"Connections content here..."})]});default:return null}},$t=()=>qe.jsxs("div",{style:{display:"none",alignItems:"center",backgroundColor:"#27272a",padding:"8px 12px",borderRadius:8,marginLeft:12,boxShadow:"0 2px 8px rgba(0,0,0,0.2)"},children:[qe.jsx("span",{style:{color:"white",marginRight:10,fontSize:14},children:"Graph Type:"}),qe.jsxs("select",{value:O,onChange:Mt=>F(Mt.target.value),style:{backgroundColor:"#3f3f46",color:"white",border:"none",padding:"4px 8px",borderRadius:4,cursor:"pointer"},children:[qe.jsx("option",{value:"base",children:"Base"}),qe.jsx("option",{value:"agent",children:"Agent"})]})]});return qe.jsxs("div",{ref:n,className:"graph-visualization-container",style:{position:"relative",top:0,left:0,right:0,bottom:0,width:"100%",height:"100vh",overflow:"hidden"},children:[(J||Ui||C)&&qe.jsx(tU,{}),qe.jsx(Ywe,{onReset:Zi,onBack:()=>{Ge(),tt()},onForward:()=>{Ge(),dt()},canGoBack:K,canGoForward:ae,onMyView:()=>{h(!0)}}),qe.jsx("div",{style:{position:"absolute",top:"10px",left:"50%",transform:"translateX(-50%)",zIndex:1e3,width:"550px",maxWidth:"calc(100% - 350px)"},children:qe.jsx(kCe,{endpoint:r,onSearch:Ri,isSearching:Ui,onSearchStart:Si})}),qe.jsx("div",{style:{position:"fixed",bottom:"10px",left:"10px",zIndex:1e3},children:qe.jsx(zCe,{walletAddress:e||"0x25d5C9DbC1E12163B973261A08739927E4F72BA7"})}),qe.jsxs("div",{className:"agent-navbar",style:{position:"absolute",top:"10px",right:"10px",zIndex:10,display:"flex",flexDirection:"row",alignItems:"center",gap:"16px"},children:[qe.jsx($t,{}),!g&&qe.jsx("button",{style:{background:"#ffd32a",color:"#18181b",border:"none",borderRadius:12,width:120,height:40,fontSize:15,fontWeight:"bold",boxShadow:"0 2px 8px rgba(0,0,0,0.18)",cursor:"pointer",textTransform:"uppercase",marginLeft:12,transition:"background 0.2s, color 0.2s, transform 0.1s"},onMouseEnter:Mt=>Mt.currentTarget.style.background="#ffe066",onMouseLeave:Mt=>Mt.currentTarget.style.background="#ffd32a",onClick:()=>m(Mt=>!Mt),children:"Filters"}),g&&qe.jsxs("div",{style:{marginLeft:12,display:"flex",alignItems:"center",gap:16,position:"relative"},children:[qe.jsx(Jwe,{viewMode:s,onViewModeChange:o}),qe.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end",position:"relative"},children:[qe.jsx("button",{onClick:()=>m(!1),style:{position:"absolute",top:-20,right:-16,background:"none",border:"none",color:"#ffd32a",fontSize:20,cursor:"pointer",zIndex:2,padding:0,lineHeight:1,width:24,height:24,display:"flex",alignItems:"center",justifyContent:"center"},"aria-label":"Close filters",children:"×"}),qe.jsx(Iue,{subjectFilter:V,objectFilter:z,onFilterChange:Vi,onReset:Zi})]})]})]}),s==="2D"&&qe.jsx(bwe,{graphData:$e,onNodeClick:Mt=>{Ge(),Pe(Mt,i,s)},onEngineStop:hi,fgRef:i,tabs:Ce,activeTab:p,onTabChange:At,drawerOpen:l,drawerContent:Pt(),onDrawerClose:()=>{u(!1),f(null)},sidebarOpen:c,sidebarContent:qe.jsxs(qe.Fragment,{children:[qe.jsx("h2",{children:"My Profile"}),qe.jsx("p",{children:"Name: Base User"}),qe.jsx("p",{children:"Email: user@email.com"}),qe.jsx("p",{children:"Role: Player"}),qe.jsx("button",{style:{background:"#ffd32a",color:"#18181b",border:"none",borderRadius:8,padding:"10px 18px",fontWeight:"bold",marginTop:20,cursor:"pointer"},onClick:()=>h(!1),children:"Close"})]}),onSidebarClose:()=>h(!1),selectedTriple:G,endpoint:r,children:qe.jsx(UD,{})}),s==="3D"&&qe.jsx(kwe,{graphData:$e,onNodeClick:Mt=>{Ge(),Pe(Mt,i,s)},onEngineStop:hi,fgRef:i,tabs:Ce,activeTab:p,onTabChange:At,drawerOpen:l,drawerContent:Pt(),onDrawerClose:()=>{u(!1),f(null)},sidebarOpen:c,sidebarContent:qe.jsxs(qe.Fragment,{children:[qe.jsx("h2",{children:"My Profile"}),qe.jsx("p",{children:"Name: Base User"}),qe.jsx("p",{children:"Email: user@email.com"}),qe.jsx("p",{children:"Role: Player"}),qe.jsx("button",{style:{background:"#ffd32a",color:"#18181b",border:"none",borderRadius:8,padding:"10px 18px",fontWeight:"bold",marginTop:20,cursor:"pointer"},onClick:()=>h(!1),children:"Close"})]}),onSidebarClose:()=>h(!1),selectedTriple:G,endpoint:r,children:qe.jsx(UD,{})}),s==="VR"&&qe.jsx(Rue,{graphData:$e,onNodeClick:Mt=>{Ge(),Pe(Mt,i,s)},onBack:()=>{Ge(),tt()},onForward:()=>{Ge(),dt()},selectedTriple:G,endpoint:r}),qe.jsxs(e2e,{open:c,onClose:()=>h(!1),children:[qe.jsx("h2",{children:"My Profile"}),qe.jsx("p",{children:"Name: Base User"}),qe.jsx("p",{children:"Email: user@email.com"}),qe.jsx("p",{children:"Role: Player"}),qe.jsx("button",{style:{background:"#ffd32a",color:"#18181b",border:"none",borderRadius:8,padding:"10px 18px",fontWeight:"bold",marginTop:20,cursor:"pointer"},onClick:()=>h(!1),children:"Close"})]}),qe.jsx($we,{open:!!l,onClose:()=>{u(!1),f(null)},children:Pt()})]})},qj=()=>{const[r,e]=Dt.useState(null),[i,n]=Dt.useState("baseSepolia"),[s,o]=Dt.useState(!1);return It.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",width:"100%",position:"relative",overflow:"hidden"},children:[It.jsx("div",{style:{position:"relative",flex:1,width:"100%",height:"100%",overflow:"hidden"},children:It.jsx(jCe,{endpoint:i,onNodeSelect:e,onLoadingChange:o})}),s&&It.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:2},children:It.jsx(tU,{})})]})};var xh=(r=>(r.MAINNET="mainnet",r.TESTNET="testnet",r))(xh||{});const xB={mainnet:"https://prod.base.intuition-api.com/v1/graphql",testnet:"https://dev.base-sepolia.intuition-api.com/v1/graphql"},GCe=`
  query GetTriplesByCreator($creatorId: String!, $predicateId: numeric!, $objectId: numeric!) {
    triples(where: {
      subject: { creator_id: { _eq: $creatorId } },
      predicate_id: { _eq: $predicateId },
      object_id: { _eq: $objectId }
    }) {
      id
      subject_id
      predicate_id
      object_id
      subject {
        id
        label
        type
        creator_id
      }
      predicate {
        id
        label
        type
      }
      object {
        id
        label
        type
      }
      block_number
      block_timestamp
      transaction_hash
    }
  }
`,VCe=async(r,e=Number(fs.IS_PLAYER_GAMES.predicateId),i=Number(fs.IS_PLAYER_GAMES.objectId),n=xh.MAINNET)=>{var l;const s=xB[n],o={creatorId:r,predicateId:e,objectId:i};try{const c=await(await fetch(s,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({query:GCe,variables:o})})).json();if(c.errors)throw new Error(((l=c.errors[0])==null?void 0:l.message)||"Erreur GraphQL inconnue");return c.data}catch(u){throw console.error(`[fetchTriplesByCreator] Erreur lors de la requête directe vers ${s}:`,u),u}},Xj=(r,e=Number(fs.IS_PLAYER_GAMES.predicateId),i=Number(fs.IS_PLAYER_GAMES.objectId),n=xh.MAINNET)=>{const[s,o]=Dt.useState(null),[l,u]=Dt.useState(!0),[c,h]=Dt.useState(null);Dt.useEffect(()=>{(async()=>{if(!r){u(!1);return}try{const g=await VCe(r,e,i,n);o(g)}catch(g){console.error(`[${n}] Erreur lors de la récupération des triples:`,g),h(g instanceof Error?g:new Error(String(g)))}finally{u(!1)}})()},[r,e,i,n]);const p=(s==null?void 0:s.triples)||[];return{loading:l,error:c,triples:p,network:n,rawData:s}},Kj=({isOpen:r,onConnectWallet:e})=>r?It.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"rgba(0, 0, 0, 0.7)",backdropFilter:"blur(5px)",zIndex:1e3,width:"100%",height:"100%"},children:It.jsxs("div",{style:{backgroundColor:"#1a1a2e",padding:"30px",borderRadius:"10px",textAlign:"center",maxWidth:"500px",boxShadow:"0 0 15px rgba(108, 92, 231, 0.5)"},children:[It.jsx("h2",{style:{color:"#6c5ce7",marginBottom:"20px"},children:"Wallet Required"}),It.jsx("p",{style:{fontSize:"18px",marginBottom:"25px",color:"#fff"},children:"Please connect your wallet to access this feature"}),It.jsx("button",{onClick:e,style:{padding:"12px 24px",backgroundColor:"#6c5ce7",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"16px"},children:"Connect Wallet"})]})}):null,HCe=({isOpen:r,onCreatePlayer:e,onClose:i})=>r?It.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"rgba(0, 0, 0, 1)",backdropFilter:"blur(1px)",zIndex:1e3,width:"100%",height:"100%"},children:It.jsxs("div",{style:{backgroundColor:"#1a1a2e",padding:"30px",borderRadius:"10px",textAlign:"center",maxWidth:"500px",boxShadow:"0 0 15px rgba(0, 128, 255, 0.7)",position:"relative"},children:[i&&It.jsx("button",{onClick:i,style:{position:"absolute",top:"10px",right:"10px",backgroundColor:"transparent",border:"none",fontSize:"20px",color:"#666",cursor:"pointer"},children:"×"}),It.jsx("h2",{style:{color:"#FFD32A",marginBottom:"20px"},children:"Player Required"}),It.jsx("p",{style:{fontSize:"18px",marginBottom:"25px",color:"#fff"},children:"You need to create a player before you can vote on claims"}),It.jsx("button",{onClick:e,style:{padding:"12px 24px",backgroundColor:"#1976d2",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"16px"},children:"Create Player"})]})}):null,WCe=({walletConnected:r=!1,walletAddress:e="",wagmiConfig:i,walletHooks:n,onClose:s,onCreatePlayer:o,onConnectWallet:l})=>{const[u,c]=Dt.useState(xh.TESTNET),[h,p]=Dt.useState(!1),[f,g]=Dt.useState(!1),m=e?e.toLowerCase():"";Dt.useEffect(()=>{g(!!(e&&e!==""))},[e]);const{loading:y,error:b,triples:v}=Xj(m,Number(fs.IS_PLAYER_GAMES.predicateId),Number(fs.IS_PLAYER_GAMES.objectId),u),_=v.length>0,C=y,E=b,T=Dt.useCallback(()=>{o&&o(),p(!0)},[o]),R=Dt.useCallback(()=>{p(!1),s&&s()},[s]),B=Dt.useCallback(()=>{l&&l()},[l]);return C&&f?It.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",backgroundColor:"#101020",color:"#fff"},children:It.jsxs("div",{style:{textAlign:"center"},children:[It.jsx("h2",{style:{color:"#6c5ce7",marginBottom:"20px"},children:"Uploading datas playeur..."}),It.jsx("div",{style:{width:"50px",height:"50px",border:"5px solid #151525",borderTop:"5px solid #6c5ce7",borderRadius:"50%",margin:"0 auto",animation:"spin 1s linear infinite"}}),It.jsx("style",{children:`
              @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
              }
            `})]})}):E&&f?It.jsxs("div",{style:{margin:"20px",padding:"30px",borderRadius:"8px",backgroundColor:"#1a1a2e",color:"#fff"},children:[It.jsx("h2",{style:{color:"#6c5ce7",marginBottom:"20px"},children:"Player Map"}),It.jsxs("div",{style:{padding:"20px",backgroundColor:"#151525",borderRadius:"6px",color:"#ff6b6b"},children:[It.jsx("h3",{children:"Error to uploading datas"}),It.jsx("p",{children:(b==null?void 0:b.message)||"Unknow error"})]})]}):It.jsxs("div",{style:{position:"relative",width:"100%",height:"100%"},children:[It.jsx(Kj,{isOpen:!f,onConnectWallet:B}),(!f||f&&!_)&&It.jsx("div",{style:{filter:f?"none":"blur(3px)",opacity:f?1:.7,position:"relative"},children:It.jsx(f2,{walletConnected:f,walletAddress:e,wagmiConfig:i,walletHooks:n,onCreatePlayer:T})}),f&&_&&It.jsx(qj,{}),It.jsx(L2,{isOpen:h,onClose:R,walletConnected:r,walletAddress:e,wagmiConfig:i,walletHooks:n})]})};var Na=(r=>(r.For="FOR",r.Against="AGAINST",r.None="NONE",r))(Na||{});const _B=1000000000000000n,Yj=[24596n,24593n,24592n,24580n,24581n,24582n,24575n,24574n,24573n,24572n,24571n,24570n,24569n],Jj=({walletConnected:r,walletAddress:e,publicClient:i,network:n=xh.MAINNET})=>{const[s,o]=Dt.useState(!1),l=async c=>{var h;try{const p=xB[n],f=await fetch(p,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
            query Triple($tripleId: numeric!) {
              triple(id: $tripleId) {
                id
                vault_id
                counter_vault_id
              }
            }
          `,variables:{tripleId:Number(c)}})});if(!f.ok)return console.error(`GraphQL request failed with status ${f.status}`),null;const g=await f.json();return g.errors?(console.error("GraphQL errors:",g.errors),null):(h=g.data)!=null&&h.triple?{id:String(c),...g.data.triple}:(console.warn(`Triple with ID ${c} not found`),null)}catch(p){return console.error(`Error fetching details for triple ${c}:`,p),null}};return{depositTriple:async(c,h,p)=>{if(!r||!e)return{success:!1,error:"Wallet not connected"};if(h<=0)return{success:!1,error:"Units must be greater than 0"};o(!0);try{const f=await l(c);if(!f)return o(!1),{success:!1,error:"Failed to fetch triple details"};let g;p===Na.For?(g=f.vault_id||f.id,console.log(`Voting FOR triple ${c}, using vault_id: ${g}`)):(g=f.counter_vault_id||f.id,console.log(`Voting AGAINST triple ${c}, using counter_vault_id: ${g}`));const m=_B*BigInt(h),y=await r.writeContract({address:Uc,abi:zc,functionName:"depositTriple",args:[e,BigInt(g)],value:m,gas:300000n});console.log("Transaction sent, hash:",y);let b;return r.waitForTransactionReceipt?b=await r.waitForTransactionReceipt({hash:y}):y.wait?b=await y.wait():await new Promise(v=>setTimeout(v,5e3)),o(!1),{success:!0,hash:typeof y=="string"?y:y.hash}}catch(f){return console.error("Error depositing stake:",f),o(!1),{success:!1,error:f instanceof Error?f.message:String(f)}}},isLoading:s}},QCe=({walletConnected:r,walletAddress:e,publicClient:i,network:n=xh.TESTNET,onSuccess:s})=>{const[o,l]=Dt.useState(!1),[u,c]=Dt.useState({status:"idle",message:""}),{depositTriple:h,isLoading:p}=Jj({walletConnected:r,walletAddress:e,publicClient:i,network:n});return{submitVotes:async g=>{var y;if(!g.some(b=>b.units>0))return c({status:"error",message:"Please place at least one vote."}),null;if(!r||!e)return c({status:"error",message:"Wallet not connected."}),null;try{l(!0),c({status:"pending",message:"Transaction in progress..."});const b=g.filter(_=>_.units>0);let v={success:!0,hash:"",error:void 0};for(const _ of b){const C=await h(_.id,_.units,_.direction);if(!C.success){v=C;break}v.hash=C.hash||""}if(v.success)return c({status:"success",message:`Transaction successful! Hash: ${(y=v.hash)==null?void 0:y.substring(0,10)}...`}),s&&s(),v;{let _=v.error||"An error occurred.";return _.includes("user rejected")?c({status:"error",message:"Transaction cancelled: User rejected the request."}):c({status:"error",message:`Error: ${_}`}),null}}catch(b){return console.error("Error submitting votes:",b),c({status:"error",message:b instanceof Error?b.message:"An error occurred."}),null}finally{l(!1)}},isSubmitting:o,isDepositLoading:p,transactionStatus:u,setTransactionStatus:c}},qCe=({network:r=xh.MAINNET,onError:e}={})=>{const[i,n]=Dt.useState(!1);return{fetchTripleDetails:async o=>{var l,u,c;n(!0);try{const h=xB[r];console.log(`Fetching triple ${o} from ${h}`);const p=await fetch(h,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
            query Triple($tripleId: numeric!) {
              triple(id: $tripleId) {
                subject {
                  label
                }
                predicate {
                  label
                }
                object {
                  label
                }
                vault_id
                vault {
                  position_count
                }
                counter_vault_id
                counter_vault {
                  position_count
                }
              }
            }
          `,variables:{tripleId:Number(o)}})});if(!p.ok)return console.error(`GraphQL request failed with status ${p.status}: ${p.statusText}`),e&&e(`GraphQL request failed with status ${p.status}: ${p.statusText}`),n(!1),null;const f=await p.json();if(console.log("API Response:",JSON.stringify(f,null,2)),f.errors)return console.error("GraphQL errors:",f.errors),e&&e(`GraphQL errors: ${JSON.stringify(f.errors)}`),n(!1),null;if(!((l=f.data)!=null&&l.triple))return console.warn(`Triple with ID ${o} not found`),e&&e(`Triple with ID ${o} not found`),n(!1),null;const g=((u=f.data.triple.vault)==null?void 0:u.position_count)||0,m=((c=f.data.triple.counter_vault)==null?void 0:c.position_count)||0;return n(!1),{id:String(o),...f.data.triple,vault_position_count:g,counter_vault_position_count:m}}catch(h){return console.error(`Error fetching details for triple ${o}:`,h),e&&e(`Error fetching details for triple ${o}: ${h instanceof Error?h.message:String(h)}`),n(!1),null}},isLoading:i}},XCe=({network:r=xh.TESTNET,onError:e})=>{const[i,n]=Dt.useState([]),[s,o]=Dt.useState(!0),[l,u]=Dt.useState(0),{fetchTripleDetails:c}=qCe({network:r,onError:e});Dt.useEffect(()=>{h()},[]),Dt.useEffect(()=>{const m=i.reduce((y,b)=>y+b.units,0);u(m)},[i]);const h=async()=>{o(!0);try{const m=Yj.map(async v=>{var C,E,T;const _=await c(v);return console.log(`Received details for triple ${v}:`,_),_?{id:BigInt(_.id),subject:((C=_.subject)==null?void 0:C.label)||`Subject ${v}`,predicate:((E=_.predicate)==null?void 0:E.label)||"is",object:((T=_.object)==null?void 0:T.label)||`Object ${v}`,units:0,direction:Na.None,vault_id:_.vault_id,vault_position_count:_.vault_position_count||0,counter_vault_id:_.counter_vault_id,counter_vault_position_count:_.counter_vault_position_count||0}:{id:v,subject:`Claim ${v}`,predicate:"is",object:"Unknown",units:0,direction:Na.None}}),y=await Promise.all(m);console.log("Loaded vote items:",y),y.every(v=>v.object==="Unknown")&&e&&e("Error: Failed to fetch triple details. Please check your network connection or try again later."),n(y)}catch(m){console.error("Error loading triple details:",m),e&&e("Error: Failed to fetch triple details")}finally{o(!1)}},p=(m,y,b)=>{n(v=>v.map(_=>_.id===m?_.direction!==y&&_.direction!==Na.None?{..._,units:b,direction:y}:b===0?{..._,units:0,direction:Na.None}:{..._,units:b,direction:y}:_))},f=()=>{n(m=>m.map(y=>({...y,units:0,direction:Na.None})))},g=i.filter(m=>m.units>0).length;return{voteItems:i,setVoteItems:n,isLoading:s,totalUnits:l,numberOfTransactions:g,handleChangeUnits:p,resetAllVotes:f,loadTripleDetails:h}},Zj=r=>(r*.001).toFixed(3),KCe=r=>(r*3e-4).toFixed(4),YCe=({numberOfTransactions:r,totalUnits:e,onResetAll:i})=>It.jsxs("div",{style:{backgroundColor:"#10172d",padding:"10px",borderRadius:"8px",marginBottom:"25px",display:"flex",flexDirection:"column",border:"1px solid #1e3b70"},children:[It.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"15px"},children:[It.jsxs("div",{children:[It.jsx("div",{style:{fontSize:"0.9em",color:"#6b7280"},children:"Unit value:"}),It.jsxs("div",{style:{fontSize:"1.1em",fontWeight:"bold",color:"#FFD32A"},children:[Zj(e)," ETH"]})]}),It.jsxs("div",{children:[It.jsx("div",{style:{fontSize:"0.9em",color:"#6b7280"},children:"Number of transactions:"}),It.jsx("div",{style:{fontSize:"1.1em",fontWeight:"bold",color:"#FFD32A"},children:r})]}),It.jsxs("div",{children:[It.jsx("div",{style:{fontSize:"0.9em",color:"#6b7280"},children:"Estimated gas cost:"}),It.jsxs("div",{style:{fontSize:"1.1em",fontWeight:"bold",color:"#FFD32A"},children:["~",KCe(r)," ETH"]})]})]}),It.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[It.jsxs("div",{style:{fontSize:"1em",fontWeight:"bold"},children:["Total units selected:",It.jsxs("span",{style:{fontSize:"1.6em",marginLeft:"10px",color:"#FFD32A"},children:[e," ",e===1?"unit":"units"]})]}),e>0&&It.jsx("button",{onClick:i,style:{backgroundColor:"transparent",border:"1px solid #6b7280",color:"#FFF",padding:"6px 12px",borderRadius:"4px",cursor:"pointer",fontSize:"0.9em"},children:"Reset all"})]})]}),JCe=({onClose:r})=>It.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"25px",borderBottom:"1px solid #1e3b70"},children:[It.jsx("h2",{style:{fontSize:"1.3em",color:"#FFD32A",margin:0,fontWeight:"bold"},children:"VOTE ON CLAIMS"}),r&&It.jsx("button",{onClick:r,style:{backgroundColor:"transparent",border:"none",color:"#FFF",cursor:"pointer",fontSize:"1.5em"},children:"×"})]}),ZCe=({voteItem:r,onChangeUnits:e})=>{const{id:i,subject:n,predicate:s,object:o,units:l,direction:u,vault_position_count:c=0,counter_vault_position_count:h=0}=r,[p,f]=Dt.useState(0),g=20;Dt.useEffect(()=>{u===Na.For?f(l):u===Na.Against?f(-l):f(0)},[l,u]);const m=()=>{const T=Math.min(p+1,g);f(T),e(i,Na.For,T)},y=()=>{if(p<=0)return;const T=p-1;f(T),T===0?e(i,Na.None,0):e(i,Na.For,T)},b=()=>{const T=Math.max(p-1,-20);f(T),e(i,Na.Against,Math.abs(T))},v=()=>{if(p>=0)return;const T=p+1;f(T),T===0?e(i,Na.None,0):e(i,Na.Against,Math.abs(T))},_=u===Na.For&&l>0,C=u===Na.Against&&l>0,E=Number(_B)/10**18*l;return It.jsxs("div",{style:{padding:"20px",marginBottom:"20px",borderRadius:"8px",backgroundColor:"#0c1228",position:"relative",border:"1px solid #1e3b70",boxShadow:"0 4px 10px rgba(0, 0, 0, 0.3)"},children:[l>0&&It.jsxs("div",{style:{position:"absolute",top:"5px",left:"5px",backgroundColor:"#FFD32A",color:"#000000",padding:"3px 6px",fontSize:"10px",fontWeight:"bold",borderRadius:"4px"},children:[E.toFixed(3)," ETH"]}),It.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[It.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[It.jsx("div",{style:{fontSize:"0.9em",color:"#E1E1E1",marginRight:"10px"},children:"For ▲:"}),It.jsx("button",{onClick:y,style:{width:"30px",height:"30px",backgroundColor:"#1e2030",border:"none",borderRadius:"4px",color:"#ffffff",fontSize:"16px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:"-"}),It.jsx("span",{style:{margin:"0 10px",color:"#ffffff",fontWeight:"bold"},children:_?l:0}),It.jsx("button",{onClick:m,style:{width:"30px",height:"30px",backgroundColor:"#1976d2",border:"none",borderRadius:"4px",color:"#ffffff",fontSize:"16px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:"+"})]}),It.jsxs("div",{style:{display:"flex",marginBottom:"20px",gap:"5px",marginTop:"20px"},children:[It.jsx("span",{style:{backgroundColor:"#FFB300",padding:"4px 8px",borderRadius:"4px",fontSize:"0.9em",color:"#000000",fontWeight:"bold"},children:n}),"-",It.jsx("span",{style:{backgroundColor:"#ccd3d3",padding:"4px 8px",borderRadius:"4px",fontSize:"0.9em",color:"#000000",fontWeight:"bold"},children:s}),"-",It.jsx("span",{style:{backgroundColor:"#43A047",padding:"4px 8px",borderRadius:"4px",fontSize:"0.9em",color:"#000000",fontWeight:"bold"},children:o})]}),It.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[It.jsx("div",{style:{fontSize:"0.9em",color:"#E1E1E1",marginRight:"10px"},children:"Against ▼:"}),It.jsx("button",{onClick:v,style:{width:"30px",height:"30px",backgroundColor:"#1e2030",border:"none",borderRadius:"4px",color:"#ffffff",fontSize:"16px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:"-"}),It.jsx("span",{style:{margin:"0 10px",color:"#ffffff",fontWeight:"bold"},children:C?l:0}),It.jsx("button",{onClick:b,style:{width:"30px",height:"30px",backgroundColor:"#dc3545",border:"none",borderRadius:"4px",color:"#ffffff",fontSize:"16px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:"+"})]})]}),It.jsxs("div",{className:"flex flex-row justify-between",children:[It.jsxs("div",{style:{fontSize:"0.7em",color:"#4CAF50",marginBottom:"8px",backgroundColor:"rgba(76, 175, 80, 0.1)",padding:"2px 6px",borderRadius:"4px",fontWeight:"bold"},children:[c," positions"]}),It.jsxs("div",{style:{fontSize:"0.7em",color:"#F44336",marginBottom:"8px",backgroundColor:"rgba(244, 67, 54, 0.1)",padding:"2px 6px",borderRadius:"4px",fontWeight:"bold"},children:[h," positions"]})]})]})},$Ce=({isLoading:r,voteItems:e,onChangeUnits:i})=>r?It.jsx("div",{style:{textAlign:"center",padding:"30px",color:"#6b7280",fontSize:"1.1em"},children:"Loading claims..."}):It.jsx("div",{style:{marginBottom:"25px"},children:e.map(n=>It.jsx(ZCe,{voteItem:n,onChangeUnits:i},n.id.toString()))}),eSe=({onSubmit:r,isSubmitting:e,isDepositLoading:i,totalUnits:n,numberOfTransactions:s})=>It.jsxs("div",{style:{textAlign:"center"},children:[It.jsx("div",{style:{marginBottom:"15px",fontSize:"0.9em",color:"#6b7280"},children:s>0&&`You will initiate ${s} transaction${s>1?"s":""}`}),It.jsx("button",{onClick:r,disabled:e||i||n===0,style:{backgroundColor:n>0&&!e&&!i?"#1976d2":"#10172d",color:"#FFF",padding:"12px 30px",border:"none",borderRadius:"8px",fontSize:"1.1em",fontWeight:"bold",cursor:n>0&&!e&&!i?"pointer":"not-allowed",width:"100%",maxWidth:"350px",boxShadow:"0 4px 10px rgba(0, 0, 0, 0.3)",transition:"background-color 0.2s ease"},children:e||i?"Processing...":n>0?`Submit votes (${Zj(n)} ETH)`:"Submit votes"})]}),tSe=({transactionStatus:r})=>r.status==="idle"||r.status==="whitelist_error"?null:It.jsx("div",{style:{marginTop:"25px",padding:"20px",borderRadius:"8px",backgroundColor:r.status==="pending"?"#10172d":r.status==="approval_pending"?"rgba(255, 211, 42, 0.1)":r.status==="success"?"rgba(0, 128, 0, 0.1)":"rgba(255, 0, 0, 0.1)",color:r.status==="success"?"#4CAF50":r.status==="error"?"#F44336":r.status==="approval_pending"?"#FFD32A":"#FFF",display:"flex",flexDirection:"column",gap:"10px",border:"1px solid #1e3b70"},children:It.jsx("div",{children:r.message})}),iSe=({walletConnected:r,walletAddress:e,publicClient:i,onClose:n,network:s=xh.TESTNET,onConnectWallet:o,onCreatePlayer:l,wagmiConfig:u,walletHooks:c})=>{const[h,p]=Dt.useState(!1),[f,g]=Dt.useState(!1),[m,y]=Dt.useState(!1),b=e?e.toLowerCase():"",{loading:v,triples:_}=Xj(b,Number(fs.IS_PLAYER_GAMES.predicateId),Number(fs.IS_PLAYER_GAMES.objectId),s),C=_.length>0;Dt.useEffect(()=>{y(!!(e&&e!==""))},[e]),Dt.useEffect(()=>{g(!!(m&&!C&&!v))},[m,C,v]);const{voteItems:E,isLoading:T,totalUnits:R,numberOfTransactions:B,handleChangeUnits:I,resetAllVotes:D}=XCe({network:s,onError:z=>{H({status:"error",message:z})}}),{submitVotes:L,isSubmitting:O,isDepositLoading:F,transactionStatus:q,setTransactionStatus:H}=QCe({walletConnected:r,walletAddress:e,publicClient:i,network:s,onSuccess:D}),G=async()=>{await L(E)},J=()=>{g(!1),p(!0),l&&l()},Q=()=>{p(!1)},V=()=>{console.log("Closing CreatePlayerModal and Vote Component"),g(!1),n&&n()};return m?m&&!C&&!v?It.jsxs("div",{style:{backgroundColor:"#070b1a",minHeight:"50vh",color:"#fff",padding:"15px",border:"1px solid #1e3b70",borderRadius:"8px",maxWidth:"960px",margin:"0 auto",position:"relative",boxShadow:"0 4px 15px rgba(0, 0, 0, 0.3)"},children:[It.jsx(HCe,{isOpen:!0,onCreatePlayer:J,onClose:V}),It.jsx(L2,{isOpen:h,onClose:Q,walletConnected:r,walletAddress:e,wagmiConfig:u,walletHooks:c})]}):It.jsxs("div",{style:{backgroundColor:"#070b1a",minHeight:"50vh",opacity:"0.9",color:"#fff",padding:"15px",border:"1px solid #1e3b70",borderRadius:"8px",maxWidth:"960px",margin:"0 auto",position:"relative",boxShadow:"0 4px 15px rgba(0, 0, 0, 0.3)"},children:[It.jsx(JCe,{onClose:n}),It.jsx(YCe,{numberOfTransactions:B,totalUnits:R,onResetAll:D}),It.jsx($Ce,{isLoading:T||v,voteItems:E,onChangeUnits:I}),It.jsx(eSe,{onSubmit:G,isSubmitting:O,isDepositLoading:F,totalUnits:R,numberOfTransactions:B}),It.jsx(tSe,{transactionStatus:q})]}):It.jsx("div",{style:{backgroundColor:"#070b1a",minHeight:"50vh",opacity:"0.9",color:"#fff",padding:"15px",border:"1px solid #1e3b70",borderRadius:"8px",maxWidth:"960px",margin:"0 auto",position:"relative",boxShadow:"0 4px 15px rgba(0, 0, 0, 0.3)"},children:It.jsx(Kj,{isOpen:!0,onConnectWallet:o||(()=>{})})})},rSe={init:r=>{if(!r.apiUrl)throw new Error("L'URL de l'API est obligatoire pour initialiser Player-map");return OQ(r),!0},get:ub},nSe={setAuthToken:mD,getAuthToken:T2,isAuthenticated:cb,clearAuthToken:DQ,initialize:r=>r?(mD(r),!0):!1};wa.ClaimVoting=iSe,wa.GraphComponent=WCe,wa.PREDEFINED_CLAIM_IDS=Yj,wa.PlayerMapConfig=rSe,wa.PlayerMapGraph=qj,wa.PlayerMapHome=f2,wa.RegistrationForm=L2,wa.UNIT_VALUE=_B,wa.VoteDirection=Na,wa.auth=nSe,wa.default=f2,wa.useDepositTriple=Jj,Object.defineProperties(wa,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
