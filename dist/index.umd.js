(function(ps,Ct){typeof exports=="object"&&typeof module<"u"?Ct(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],Ct):(ps=typeof globalThis<"u"?globalThis:ps||self,Ct(ps.PlayerMap={},ps.React))})(this,function(ps,Ct){"use strict";var jw={exports:{}},I0={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var HL;function PG(){if(HL)return I0;HL=1;var r=Ct,e=Symbol.for("react.element"),i=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function l(u,c,h){var p,f={},g=null,m=null;h!==void 0&&(g=""+h),c.key!==void 0&&(g=""+c.key),c.ref!==void 0&&(m=c.ref);for(p in c)n.call(c,p)&&!o.hasOwnProperty(p)&&(f[p]=c[p]);if(u&&u.defaultProps)for(p in c=u.defaultProps,c)f[p]===void 0&&(f[p]=c[p]);return{$$typeof:e,type:u,key:g,ref:m,props:f,_owner:s.current}}return I0.Fragment=i,I0.jsx=l,I0.jsxs=l,I0}var B0={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var WL;function OG(){return WL||(WL=1,process.env.NODE_ENV!=="production"&&function(){var r=Ct,e=Symbol.for("react.element"),i=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),l=Symbol.for("react.provider"),u=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),p=Symbol.for("react.suspense_list"),f=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),m=Symbol.for("react.offscreen"),y=Symbol.iterator,b="@@iterator";function v(pe){if(pe===null||typeof pe!="object")return null;var ct=y&&pe[y]||pe[b];return typeof ct=="function"?ct:null}var _=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function T(pe){{for(var ct=arguments.length,Rt=new Array(ct>1?ct-1:0),Kt=1;Kt<ct;Kt++)Rt[Kt-1]=arguments[Kt];E("error",pe,Rt)}}function E(pe,ct,Rt){{var Kt=_.ReactDebugCurrentFrame,Bi=Kt.getStackAddendum();Bi!==""&&(ct+="%s",Rt=Rt.concat([Bi]));var sr=Rt.map(function(Di){return String(Di)});sr.unshift("Warning: "+ct),Function.prototype.apply.call(console[pe],console,sr)}}var C=!1,R=!1,B=!1,I=!1,N=!1,D;D=Symbol.for("react.module.reference");function P(pe){return!!(typeof pe=="string"||typeof pe=="function"||pe===n||pe===o||N||pe===s||pe===h||pe===p||I||pe===m||C||R||B||typeof pe=="object"&&pe!==null&&(pe.$$typeof===g||pe.$$typeof===f||pe.$$typeof===l||pe.$$typeof===u||pe.$$typeof===c||pe.$$typeof===D||pe.getModuleId!==void 0))}function k(pe,ct,Rt){var Kt=pe.displayName;if(Kt)return Kt;var Bi=ct.displayName||ct.name||"";return Bi!==""?Rt+"("+Bi+")":Rt}function q(pe){return pe.displayName||"Context"}function V(pe){if(pe==null)return null;if(typeof pe.tag=="number"&&T("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof pe=="function")return pe.displayName||pe.name||null;if(typeof pe=="string")return pe;switch(pe){case n:return"Fragment";case i:return"Portal";case o:return"Profiler";case s:return"StrictMode";case h:return"Suspense";case p:return"SuspenseList"}if(typeof pe=="object")switch(pe.$$typeof){case u:var ct=pe;return q(ct)+".Consumer";case l:var Rt=pe;return q(Rt._context)+".Provider";case c:return k(pe,pe.render,"ForwardRef");case f:var Kt=pe.displayName||null;return Kt!==null?Kt:V(pe.type)||"Memo";case g:{var Bi=pe,sr=Bi._payload,Di=Bi._init;try{return V(Di(sr))}catch{return null}}}return null}var j=Object.assign,Q=0,W,G,z,te,Y,se,ve;function Ae(){}Ae.__reactDisabledLog=!0;function me(){{if(Q===0){W=console.log,G=console.info,z=console.warn,te=console.error,Y=console.group,se=console.groupCollapsed,ve=console.groupEnd;var pe={configurable:!0,enumerable:!0,value:Ae,writable:!0};Object.defineProperties(console,{info:pe,log:pe,warn:pe,error:pe,group:pe,groupCollapsed:pe,groupEnd:pe})}Q++}}function Oe(){{if(Q--,Q===0){var pe={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:j({},pe,{value:W}),info:j({},pe,{value:G}),warn:j({},pe,{value:z}),error:j({},pe,{value:te}),group:j({},pe,{value:Y}),groupCollapsed:j({},pe,{value:se}),groupEnd:j({},pe,{value:ve})})}Q<0&&T("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var Xe=_.ReactCurrentDispatcher,Je;function it(pe,ct,Rt){{if(Je===void 0)try{throw Error()}catch(Bi){var Kt=Bi.stack.trim().match(/\n( *(at )?)/);Je=Kt&&Kt[1]||""}return`
`+Je+pe}}var dt=!1,St;{var Qt=typeof WeakMap=="function"?WeakMap:Map;St=new Qt}function yt(pe,ct){if(!pe||dt)return"";{var Rt=St.get(pe);if(Rt!==void 0)return Rt}var Kt;dt=!0;var Bi=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var sr;sr=Xe.current,Xe.current=null,me();try{if(ct){var Di=function(){throw Error()};if(Object.defineProperty(Di.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Di,[])}catch(lt){Kt=lt}Reflect.construct(pe,[],Di)}else{try{Di.call()}catch(lt){Kt=lt}pe.call(Di.prototype)}}else{try{throw Error()}catch(lt){Kt=lt}pe()}}catch(lt){if(lt&&Kt&&typeof lt.stack=="string"){for(var Oi=lt.stack.split(`
`),Be=Kt.stack.split(`
`),ae=Oi.length-1,fe=Be.length-1;ae>=1&&fe>=0&&Oi[ae]!==Be[fe];)fe--;for(;ae>=1&&fe>=0;ae--,fe--)if(Oi[ae]!==Be[fe]){if(ae!==1||fe!==1)do if(ae--,fe--,fe<0||Oi[ae]!==Be[fe]){var Le=`
`+Oi[ae].replace(" at new "," at ");return pe.displayName&&Le.includes("<anonymous>")&&(Le=Le.replace("<anonymous>",pe.displayName)),typeof pe=="function"&&St.set(pe,Le),Le}while(ae>=1&&fe>=0);break}}}finally{dt=!1,Xe.current=sr,Oe(),Error.prepareStackTrace=Bi}var Ue=pe?pe.displayName||pe.name:"",Ke=Ue?it(Ue):"";return typeof pe=="function"&&St.set(pe,Ke),Ke}function bi(pe,ct,Rt){return yt(pe,!1)}function $e(pe){var ct=pe.prototype;return!!(ct&&ct.isReactComponent)}function Fi(pe,ct,Rt){if(pe==null)return"";if(typeof pe=="function")return yt(pe,$e(pe));if(typeof pe=="string")return it(pe);switch(pe){case h:return it("Suspense");case p:return it("SuspenseList")}if(typeof pe=="object")switch(pe.$$typeof){case c:return bi(pe.render);case f:return Fi(pe.type,ct,Rt);case g:{var Kt=pe,Bi=Kt._payload,sr=Kt._init;try{return Fi(sr(Bi),ct,Rt)}catch{}}}return""}var ui=Object.prototype.hasOwnProperty,Si={},Ei=_.ReactDebugCurrentFrame;function Zi(pe){if(pe){var ct=pe._owner,Rt=Fi(pe.type,pe._source,ct?ct.type:null);Ei.setExtraStackFrame(Rt)}else Ei.setExtraStackFrame(null)}function Vi(pe,ct,Rt,Kt,Bi){{var sr=Function.call.bind(ui);for(var Di in pe)if(sr(pe,Di)){var Oi=void 0;try{if(typeof pe[Di]!="function"){var Be=Error((Kt||"React class")+": "+Rt+" type `"+Di+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof pe[Di]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw Be.name="Invariant Violation",Be}Oi=pe[Di](ct,Di,Kt,Rt,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(ae){Oi=ae}Oi&&!(Oi instanceof Error)&&(Zi(Bi),T("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",Kt||"React class",Rt,Di,typeof Oi),Zi(null)),Oi instanceof Error&&!(Oi.message in Si)&&(Si[Oi.message]=!0,Zi(Bi),T("Failed %s type: %s",Rt,Oi.message),Zi(null))}}}var We=Array.isArray;function Ce(pe){return We(pe)}function At(pe){{var ct=typeof Symbol=="function"&&Symbol.toStringTag,Rt=ct&&pe[Symbol.toStringTag]||pe.constructor.name||"Object";return Rt}}function Ot(pe){try{return Zt(pe),!1}catch{return!0}}function Zt(pe){return""+pe}function jt(pe){if(Ot(pe))return T("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",At(pe)),Zt(pe)}var xi=_.ReactCurrentOwner,vt={key:!0,ref:!0,__self:!0,__source:!0},ge,be;function Ne(pe){if(ui.call(pe,"ref")){var ct=Object.getOwnPropertyDescriptor(pe,"ref").get;if(ct&&ct.isReactWarning)return!1}return pe.ref!==void 0}function Se(pe){if(ui.call(pe,"key")){var ct=Object.getOwnPropertyDescriptor(pe,"key").get;if(ct&&ct.isReactWarning)return!1}return pe.key!==void 0}function Fe(pe,ct){typeof pe.ref=="string"&&xi.current}function Ie(pe,ct){{var Rt=function(){ge||(ge=!0,T("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",ct))};Rt.isReactWarning=!0,Object.defineProperty(pe,"key",{get:Rt,configurable:!0})}}function U(pe,ct){{var Rt=function(){be||(be=!0,T("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",ct))};Rt.isReactWarning=!0,Object.defineProperty(pe,"ref",{get:Rt,configurable:!0})}}var $=function(pe,ct,Rt,Kt,Bi,sr,Di){var Oi={$$typeof:e,type:pe,key:ct,ref:Rt,props:Di,_owner:sr};return Oi._store={},Object.defineProperty(Oi._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(Oi,"_self",{configurable:!1,enumerable:!1,writable:!1,value:Kt}),Object.defineProperty(Oi,"_source",{configurable:!1,enumerable:!1,writable:!1,value:Bi}),Object.freeze&&(Object.freeze(Oi.props),Object.freeze(Oi)),Oi};function re(pe,ct,Rt,Kt,Bi){{var sr,Di={},Oi=null,Be=null;Rt!==void 0&&(jt(Rt),Oi=""+Rt),Se(ct)&&(jt(ct.key),Oi=""+ct.key),Ne(ct)&&(Be=ct.ref,Fe(ct,Bi));for(sr in ct)ui.call(ct,sr)&&!vt.hasOwnProperty(sr)&&(Di[sr]=ct[sr]);if(pe&&pe.defaultProps){var ae=pe.defaultProps;for(sr in ae)Di[sr]===void 0&&(Di[sr]=ae[sr])}if(Oi||Be){var fe=typeof pe=="function"?pe.displayName||pe.name||"Unknown":pe;Oi&&Ie(Di,fe),Be&&U(Di,fe)}return $(pe,Oi,Be,Bi,Kt,xi.current,Di)}}var Me=_.ReactCurrentOwner,ce=_.ReactDebugCurrentFrame;function ze(pe){if(pe){var ct=pe._owner,Rt=Fi(pe.type,pe._source,ct?ct.type:null);ce.setExtraStackFrame(Rt)}else ce.setExtraStackFrame(null)}var Ve;Ve=!1;function pt(pe){return typeof pe=="object"&&pe!==null&&pe.$$typeof===e}function Dt(){{if(Me.current){var pe=V(Me.current.type);if(pe)return`

Check the render method of \``+pe+"`."}return""}}function xt(pe){return""}var Vt={};function fi(pe){{var ct=Dt();if(!ct){var Rt=typeof pe=="string"?pe:pe.displayName||pe.name;Rt&&(ct=`

Check the top-level render call using <`+Rt+">.")}return ct}}function xr(pe,ct){{if(!pe._store||pe._store.validated||pe.key!=null)return;pe._store.validated=!0;var Rt=fi(ct);if(Vt[Rt])return;Vt[Rt]=!0;var Kt="";pe&&pe._owner&&pe._owner!==Me.current&&(Kt=" It was passed a child from "+V(pe._owner.type)+"."),ze(pe),T('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',Rt,Kt),ze(null)}}function ki(pe,ct){{if(typeof pe!="object")return;if(Ce(pe))for(var Rt=0;Rt<pe.length;Rt++){var Kt=pe[Rt];pt(Kt)&&xr(Kt,ct)}else if(pt(pe))pe._store&&(pe._store.validated=!0);else if(pe){var Bi=v(pe);if(typeof Bi=="function"&&Bi!==pe.entries)for(var sr=Bi.call(pe),Di;!(Di=sr.next()).done;)pt(Di.value)&&xr(Di.value,ct)}}}function mn(pe){{var ct=pe.type;if(ct==null||typeof ct=="string")return;var Rt;if(typeof ct=="function")Rt=ct.propTypes;else if(typeof ct=="object"&&(ct.$$typeof===c||ct.$$typeof===f))Rt=ct.propTypes;else return;if(Rt){var Kt=V(ct);Vi(Rt,pe.props,"prop",Kt,pe)}else if(ct.PropTypes!==void 0&&!Ve){Ve=!0;var Bi=V(ct);T("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",Bi||"Unknown")}typeof ct.getDefaultProps=="function"&&!ct.getDefaultProps.isReactClassApproved&&T("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function kr(pe){{for(var ct=Object.keys(pe.props),Rt=0;Rt<ct.length;Rt++){var Kt=ct[Rt];if(Kt!=="children"&&Kt!=="key"){ze(pe),T("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",Kt),ze(null);break}}pe.ref!==null&&(ze(pe),T("Invalid attribute `ref` supplied to `React.Fragment`."),ze(null))}}var rn={};function vs(pe,ct,Rt,Kt,Bi,sr){{var Di=P(pe);if(!Di){var Oi="";(pe===void 0||typeof pe=="object"&&pe!==null&&Object.keys(pe).length===0)&&(Oi+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var Be=xt();Be?Oi+=Be:Oi+=Dt();var ae;pe===null?ae="null":Ce(pe)?ae="array":pe!==void 0&&pe.$$typeof===e?(ae="<"+(V(pe.type)||"Unknown")+" />",Oi=" Did you accidentally export a JSX literal instead of a component?"):ae=typeof pe,T("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",ae,Oi)}var fe=re(pe,ct,Rt,Bi,sr);if(fe==null)return fe;if(Di){var Le=ct.children;if(Le!==void 0)if(Kt)if(Ce(Le)){for(var Ue=0;Ue<Le.length;Ue++)ki(Le[Ue],pe);Object.freeze&&Object.freeze(Le)}else T("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else ki(Le,pe)}if(ui.call(ct,"key")){var Ke=V(pe),lt=Object.keys(ct).filter(function($t){return $t!=="key"}),Tt=lt.length>0?"{key: someKey, "+lt.join(": ..., ")+": ...}":"{key: someKey}";if(!rn[Ke+Tt]){var Yt=lt.length>0?"{"+lt.join(": ..., ")+": ...}":"{}";T(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,Tt,Ke,Yt,Ke),rn[Ke+Tt]=!0}}return pe===n?kr(fe):mn(fe),fe}}function gn(pe,ct,Rt){return vs(pe,ct,Rt,!0)}function Ls(pe,ct,Rt){return vs(pe,ct,Rt,!1)}var es=Ls,bs=gn;B0.Fragment=n,B0.jsx=es,B0.jsxs=bs}()),B0}process.env.NODE_ENV==="production"?jw.exports=PG():jw.exports=OG();var Et=jw.exports;const QL="data:image/svg+xml,%3csvg%20width='300'%20height='50'%20viewBox='0%200%20500%2084'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3crect%20width='500'%20height='84'%20fill='url(%23pattern0_10_2)'/%3e%3cdefs%3e%3cpattern%20id='pattern0_10_2'%20patternContentUnits='objectBoundingBox'%20width='1'%20height='1'%3e%3cuse%20xlink:href='%23image0_10_2'%20transform='scale(0.002%200.0119048)'/%3e%3c/pattern%3e%3cimage%20id='image0_10_2'%20width='500'%20height='84'%20preserveAspectRatio='none'%20xlink:href='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAfQAAABUCAYAAAB0vcXQAAAAAXNSR0IArs4c6QAAIABJREFUeF7tXQeYJFW5vfdWro4zw2wgioCoJEUMwDOsGEAFFR/6RFEREAH1IUpQQaIEFcWEiiAGVIKib0URFFBEfQbQJ+CCgODCssvuhE5VXfm+PjVVQ01vz0x3T/eE3arvQ2S6wr3/Def+6fyULPC1YcOGjKZpewiC8JwgCPZkjD07CIIVlNICISRPCMG/JUJImVJa4ZzXov//YBAED3iet0bTtPtVVX2MUore8AXuUvr5VAKpBFIJpBJYaAkADjpGg64eWuieTn4/RMD5vsrl8m6CILyRc/56wsl/EEoEQkhXbclms8S2beL7/oZ6vf6rTCbzy2q1euuyZcs2RO/seEh7Io+lPS96IoIt9SWLeWgXc9u21PmwNPqVzoylMU5za2VXINrNJyuVyrMppScSQt5KCFk+zTtcQsjDhJDHCSElQgg08rLImOdzDk09RwjJEkKWEUKeTQgZEASBQDN3HIcwxggAvlarBZIk/da27Svuv//+H++///4WpXRhgL0bYaXPpBJIJZBKIJVAKoEOJdBXQOecy4Zh/GcQBO8jhLxcEAROOKEBD2LT+AOc819QSv9IKV2TyWTWUEoB6m1d1Wp1med5z1UUZR/XdV8tCMIrGGMZ3/eJ53kEYC8IwngQBN+2bfvr22yzDb5HU3BvS7zpTakEUgmkEghNp6k2tDQmQl8AnXPODMN4G2PsfELILgBYzAhBFIDkd/i+f4PnebcMDAw81ksxcc4Vy7IO9DzvMELIkZIkDQdBwD3PA4jjoHC14zjnDw0NPbFVA3u6Qns57dJ3TfFttTe52rsrFW1/JJBKvz9yXfi39hzQa7XaqznnFxPC9+WchOZwTdVGOeFXm6Z5RaFQeKhVtzdt2pTLZDLPIYQ8k3P+TELIDoQQJTKzi5xzh1I6TiktE0I2BEHwD8YYAuIeb6VxP/TQQ8qKFSveFATBcYyxgxhjOGTSIAjqlmV9yXXdc1euXFlPtfWFn4RpCxa/BBYvBCzels06qku46bP2Lb1hQSTQM0Avl8uDjLEvEkLeEVloKOd8I6X0vGw2eyUhBIA8abnZuHFjVtO0QxhjLyOEHEgI2ZsQwjoNjvN9v+L7/p2MsdsEQbgtm83e26x912q1vSilnyKEHCpJEszx9+i6/oI77rhDXLVqlTdXyafrcq4STJ9PJZBKIJVAKoG5SqAngF6r1V7LOb8qCILt0CDGWKWhWV+azWY/Rwg3KA21YwKfer1eP6yRavY2SunrCCE6Atmmv0KletqfgyD0xYe+crwn8p0/LEkSDhDf13X98SS4V6vVV8iyfKrrul/MZrO3wDVAKZ14SXqlEkglsMQkkB6ll9iApc3tswTmBOgAaNu2P+e67kmKohDDMACs/2NZ1vHLli2Ddh4C+djYWIEx9n7G2AcppTHo96RrUe755Ls47PwTl885/7nv+58qFAp/BLAzSjlv2gOq1eqwIAhfC4IAloT/26p96z0ZkS3kJYsSKxa4UQvw+QX45BYygdNubI0S6BrQOecF0zSv9X3/YKSMqapq+L5/WqFQuDwGRZDGKIpyKmX0I5TQDCLTAMAza+WdDcNmgB7AcT/lHdDAb23cd46u6yGwxwcNBNHZtn1BEAQfJYSMEkJO0nX9ulRz72wM0rtTCcwsgRSW0xmSSmA+JNAVoI+Pjz+DMXaTJEl7oJGyJP/JcZ0jdF1fi/8GaG7cuPFwxtjndF3fMdmRGTTqrvrb7vtgWuecX+O67smFQqEEUOecC7Ztn8A5/1Kk2duO45xXLBYvxG+UUr+rRs36ULrBzSqi9IYF5UXa8sW/BNbgEmjilj9PllYP2wP0xMSqVqugab0d5C6+73NBEG7UNO2dlFIbWL5hw4Zl+Xz+SsbYoa7rclEUN/tGwiwO8J9RYhGoIvCtEGnOUzT8DgA9/A6ldF2DrObDuq7fEGvrlmW9LgiC6wkhGdd1EST3tUKh8MFegXq6LpfWokhbm0oglUAqgaUogfYAPepZvV7fyfO83wmCAD84kPhyTdM+FAeWIWXN87zvSpIEJrfQvN58wdwOf3u1WiW5XA6sbrgFh4E/U0p/Rwj5P9/3/8UYezSXy21MPj86OpoXBGFIFMXdGWNIcXs+53wVIWT7yIwOtXvGcdA0jZTLZV/TtKtWr1594hFHHAEbfLBx48bnZbPZnzRy1XdCRH6Dhe4Luq6f1itQX4qTI21zswTSo1k6J1IJpBJYvBJoG9BHRka203X9TkrpMwOwtXB+Rjab/UxsYq9Wqx9paLifCdngpglNjwEeLG6O4xiiKK5uAPN1uVzuFkqp1Y2YoGU7jrN7EARv5py/mxCye5w2F78vBnlExeP/4x+krzmO8wdZlo/QNO1JHAg2bNiwcz6f/xVy4aM0u0s1Tft4CurdjEz6TCqBVAKpBFIJzKcE2gJ05Jjruv5by7KeyzkPBEH4VCaT+WQE5uKGDRs+VywWEcHOgyCY7Z3ws3++Xq9/c2hoqNpLVkGAe71eP4Axdirn/I0T7vwwrn3StA8gB7BblkWgrQtUeNxyrNcjfx33VSqV3ZHPTgjZjlJaJ4Scoev6F1NQn2ZapkrrfK7X9FupBFIJpBKYVgKzgS+AkNm2/UPHcd4MwBYE4Yu6rp8cgaRcq9WuURTlCPjLZyGFGSGEfELX9asIIUG/Gdocx3keUtE454fiEIJ+oM2u64bsdbIsh8Cuqiqqta13HOcNxWLxHtyDOAEQ1QRBsFwQhDHP896Yz+fv6k30e6cIGN3f6WPppE8lMC8SSCfmvIg5ZVSfHzEv8a/MCOjQbqvV6oc555dCyaWM3pjP5f8TfQbL2gEHHHBlEAQwc4eacNJ/DV85gNO2bT+fz39t7dq1Z+24445hdPl8yQxtMk3zjZTSLxNCto0APfTtx4CONkeuAJRbfaOu63/CfeVy+SXw6cuyjAPNg47jvHCbbbYxQjnMYx/mS1bpd7ZGCfQKjHv1nq1xDNI+b7kSmP91MSOgR6D2W865SAh5NAiCfQcGBkrQVGu12qWe552squqkZh4DOv4d5Zo/6TjOewuFAljZFqzKWalUGpAk6TJK6btgHYgoZjebR5zzfzuO8woUjYGJ3TTNoxtEON/ww+oy5Ke5XA5+epFSOme62C13Eqc9SyWQSiCVwGYSCNENezFjDKWv4drcidKQnwRlsaEQViilcMM+Rjh/SNW0+yilYdR0erUngWkBnXOeaZQ+vS8IgmegoIkkSQdmMpm/ApgrlcpJmqZ9SZIkblnWlHfAhA2zdr1e/61hGIevXLlydDFotADoer2OeuyXRaLZjHMWB5Eg8P9qGOZLV6xYYYBvXlXVy2VZPooQUmtYG84qFAqXzbc/vdNzHudcN03zlYj+B2Ne5AoJXxMVtMEhbU60t/fdd5+84447vkiW5X0453bDvcFAwYsrNNdQqvi+/0Qmk/lJ94e5mXsev9c0zR0YY6+PDl7hQ4IgiEEQoJDPbyMK4Fn7G7+vUqlgwwE1MZ4X4n61t6R6ehcOy4wxhnKBd6mq+uBs43bOOeewc845JxgdHd1eUZSXc87zeD6ymIXvqtfrvykUCg/P9q5OehLLrlarreCcv5wxNgQPVyKZXhIE4Zeqqj7U5XfDcUX/zjjjjNfatr1rIzDXUlUVQAAXXoYx9ntZlv88e7spmXgk5KLI1uv1VzPGtvN9H9k2s7ohZ39/d3f4vo9GyaIoPqiq6u/aDRSO5Wnb9uGc822xHqPOId5JHR0d/eOKFSvu6R+vRuv+xnOxVqs9jzH2XyhxTSndBwuqVQZU01swNmD7vJtzfhvn/Lv5fP6B7iTb/VOJef0aSukzpnsTCodpmnZjv2UMZlPG2JswT5P7EmLCKKU/bDl50YlarXYeIeTMaHP+YC6X+wo6MzIy8iJFUe4KgkDM5XIUL8KFAUL0OnLTGWM/yuVy72wuyNK9WHv3pGVZr25YGlaDD6dZU58A9AB9+Vk2m30DvooNShTFO0VB3K1m1NbWarV9t9tuu/HFaHpPbqqMse8TQpDSB0CfQNqJcbpC07TjQdtLKUV6XkdX/A0ARaVSuViWZRDzuJxzKcEAGFptMMkrlcopy5Yt+9Zf/vIXab/99tus1n2nh5VkY+ODlWVZB3POb/Y8zxcEgWEOSpLEgiBYyxh7n6qqsBDNalmJi/VUKpVjRFG8EhtjVPEvdst0JKse3Bxbv1AV8ERN074FOUelgFu+Pu5nuVx+ra7rV3qeh0NdXK+Acc7rmqYdSyn9/nRj0k27E7I7kFJ6FWMM2SaYezg4A6iEIAiOymaz17QzFhO4+rR3Lp53aPNuu+22WlXVgz3P83Bwi9JM5Qbz40Wapn3i6TPl9O69GATr9fozOOc3CIKwH+ZPEARCksmyDeDpRlyTzzS5KXFwE13Xva7BXIk9d1M7h+F4LVuWdTeldN84Zgjr0nVdKZvNXvjkk09esMMOO9Tbed+cOjQhfHbDDTeIr3zlK4+UZRnxVnvLskxh6OxEnvF+HGctNep//Mn3/cvy+fwPZ1oDc21/qz2mWq3eyBhDHFkr7pTY6ntoJpO5aWKj7WW499MtMgzjhZyQ/6UTB/1QnpATlGjP8/ZpCejlcnk3Qsh9jYkgG4bxx3w+/xK8EuYSURTv4ZyDKW4SyOPPAfwJId/KZDLvnY+JM+1paRZZ1uv1l4LnHcVhpgF1qwF2H89ms5/H0NRqtYMymcwvy+WyA6DM5/NHt7cp9XJqzf6uhQD0fD5/Qr1edz3Pk0RRTC7YcJIHQfBX0zTfMDw8/GSXmtm0HY8BfXR09OBMJnOz67q+KIoMAZqqquLfay3Let/Q0FBHgF6v148RBAFgOAnos0u/L3fMCdBxKGn0Y3ts8FHrmOd59SAIji0UCn0F9Gw2u3u9XofRBBtPoOu6UKlUjioUCm0C+lR5JgF9r732Wi3L8sGWZXlQLHAw1TRNrlarF+Xz+Y4B3XXdGxob8X6I9/F9fzNA79PeHHYwCeiiKIaAXq/XrzNN84MrV67sCNBN07y7kQocAjrk7vu+m81mpWq1emG5XO47oCcOSdj/z0EJ7BiUY/DpdJUkQD0Ul67riIt6pGFN+ditt95641vf+tY+sXlOtDTeYwDogiC8eYb2Y61uaGjpe1NKEQDelwuATgDolIYAHAM6Dkuu624O6BgU0zRvcl33kIaGDl/x/sVi8S9YUIZhXNXwMx8dmW6nHAaik9f/aJoWdnoxmNlnkqhpmijZ+uvoLDWpwSYmEEhtXpHL5dagVjui83VdPyIIgk2lUumNQ0NDf+gYoPq5M0SUu5A7rArTaegNk9wVmUymJxp6uVy+uFAonGCaZgjoSAlsxdzXcNt8K5vN4hA0o3bZ6QpIAno2m70ZG3IUxMgzeobZjt01oEuidKXjOimgtzkosYY+NjZ2oCRJV80HoNfrdS86WHcN6KCxFgThhmw2u59lWf6E0j+5HXSkUbYpqim3NQO6wATRsq3rqtVqx4BuGMbdqqzs6wV+4HleCOi5XK7vgB7vgxs2bNgTAdBROezJAwusnq0UwHbk1QToRNd1YppmkM1m2fj4+K0o+lUsFh9t513d3BPvMZVK5UZRFGcDdPhwrlqzZs0JrayRU77fJRZ0DOgjIyMHybL8K1mWkVP+ZV3XP4SG1Ov1lwVB8Jtm0pbEBv47TdPgt3UXO5jHgjVNExH7NyTN0skFFgTBXblc7qW4v1qtPldTtb+7novVfqemaS/vpcmym8nW/Eyzhk4pXQU/VNLk3ktAh8kdGjoAHaY9ZA40AXqoYQqCMMI5P1lRlO/10rKRBPRcLnczNmRFUZhlWRwL3rKsmQG9aVHFoNSJhh6fkKcxxU07rLGcZmE2XHIa+qICdEZ5wmrfDKRhTEUM6Llcbj9YFJoBvbmQVKvxwj2Rq64llXUrM3Pze/DfgiAg1kF0HGcaQG+NArHJvVqt3q3r+r6e54WA7nmem8/n+wro8RrctGnTkaqqfqmR1jyYFHRzPzsxuTdbMPDfiqyQag1xc4TDtaYoSo1zflQ+n4cbtedXM6DPss4RswC31iGqqv6i540hBBVNO9PQy+XyzfBP+b5fdhxn52KxOI4JY5omcrTDYizJK+rgJvhudF1/oh+d6Nc7oTFalgUSmk9NgDoVnrZOhl81HMc5aWBg4Nucc81xnNNQtc3zvBHHcd5WLBZv71hL71dnWmjojLFVQRAsJKAD4AP4s13XvbtUKr1uxYoVG3slszkDetNYJAGdMXZlFCSlzDRkmP/YzKHVxUyE7WxaKaB3linSyuTeCw0dPvTY5I4DIUzuSQ29HUDH/YgfSgI7TKDxe2YD9Bj0ouDH0Ideq9U61tA7A/QuVcTEYogP57Va7dOiKJ6M/bTVQaUZL6JgyTWEkH8QQtYhsj0IAsT0aBGh13M8z3suBgJyTI4BfMUIvMZag8yjIDSBc35cLpf7ZkxD3qtttkNADy3TjuMAB59XKBTGetWO+D0dAXqtVtuLMfZ3xhg0g0sbJVEBdmBfOwkVyaZpHMxeh2az2b6cSHotkBZabb5er/+UEPKyViltvu8/cPPNN+8JXw247CmliDTGxF2t6zrS2HpqRp5Lf5sijb8vy/JmgB4EQc9M7m1o6OFJmjEWchRwzq/UNO24bmXWvAX1GtDj9zXiRg4RBOEizvmTQRBI041JvNFgY1EUBUE/iPZHENreyX0vChAE6+CaRnAbXDl4ZxjxhY1phgvZAogIRkzHF9sJ7ksGxS2ED31Raegz8EXEh0q4pxqgcJYois/zPK+GbA2MRzy2Sd9vkkI6jiKnlO4niuKAbdsIxAQNNZixmSiKjzLGUJMCAzzpnmw2IcdjH5mlfUTr+77/C9d1vzw4OFhuJxYp1tDL5fLd2Wx2XjT0eJ4ZhoFg6eNjK+A0h9l4kv8MMVaapv0ySk/bbOonMk1Qs+OVnPNjRVE8yLbt8KDVrCFH6ydWWj6QzWa/1stI81aAPuOCnZgkmB5fVVUVdU56muLcDOhxW1r60E3TvIYQ8o4G3SlC13eDxo2a4fV6HSku2Kg2w0Pf96/O5/PHTJ14cz/9zQXY2n92op22bT/H9/2/hZOSEiE200FIQRDYkiR9Utf1T8OXLsvyhaqqfoBzDiKaV0SpRH3PsW9HoklAD4Lg+6qqropSuSadggsA6CGoR3mmALMPRTXnZ406n20cew3os31vloUc9qdaraJs8I8ScZlh6hmlFBv88aqq/rKXbocWB9SwHYhyTwG9PyRWEZ00DlqeaZq3y5K8yqybcPcInuc5uq7LlmVd8Mgjj5y/5557Ou2A8hznXpixUiqV7s7lcn0H9Hj+joyMnK9p2qlxJgj60AToMZD/oHGw+aSqqv/qpJ+x3EZHR587MDBwvmEYb2SMPR3gMPVAHIP6W3O5HNyoPbm6APTwnB6t+YM0TUNl0p5dk4DOKEu6k1oCumEYb2qkGv13o8jJo3Gkummax4BcZZoWbWyYh56Tz+fH5+43bweyeiaXKS/CBK3X6x9tTMyLmtO8wPduGMZD2Wz2WXhobGxsb0VR/k8URQsap6qqKLM6Z3DqRc+aAV3X9FWu504xufcS0Gu12sXZbLalDz3BwBfB+cQkD4LgT4899tghe+yxx9hspvfZZsRSAXSEeWNNpYDe2yj3uZjc57LemgEdB+darearqhoCOiLuOwH02eb5bG2NNfTx8fG7G77kvgJ6vObK5TJKZn+ZUlqILLqhFSIC9DiN65+NctXHNWKr7pytD7MclsN4B6Sn+r7/1YaWP10+eBjxTik9UNf1P7b7zZnk3yWgx/mW/7Zt+/kgY2u3LbPd15GGHr8s7kRExoJk/l1bfAj86CdmMpmv9/sEOlsne/F7tVpdJgjCXyIylnBe4H8cx4E51ajVascODw9fi9Q9ALksy4cLgvCIqqoguEgBfSIoboIOkPN/c87/jzF2WOKAFGrpCJyrVqtfKxaLJ4CcBhpMt+O3KAA92g3iOZDU0CfCF2iYE+/7/qOc8+Oz2WyqoXexXnrtQ+92zuG5dgDdNM0LHn300XnV0PsN6EnSIkmSfpPL5Z5pmuaUGh6xT9v3/Rsx3/P5fE9SuCKZY+8YFEXxes45ArCbr7A4mCAID3ie99K5fzskIIIlxo+j3BMWiNjq+GtUIEWKHhZ7HByZCB7/gqZpH+mVG6ArQI+lVK1WXyEIwh0RiUpzzvq/VVXdZT4Krcxl8bX7LCbr6aef/i7O+dVRup6Y9Jl5nvebgYGBVyCyfeedd37z4ODgda7rbqpWq+8cGhq6dTZts912zOW+djR0PwiuyPYoba2Fhh5omsYQk+D7/scFQbg38iHBTIb5EyA/3LKsDZZlIdgQi77rw9CiAPRowFoBekSkgUhcBAWmgN7jPPRuNPS5asPNgN7I/rk91tA1VRNcz3VUVZUrlcoFjz/++BYF6HHsi2EYq4MgOLQ5YBCHd/ANVKvVq2zb/vDw8HC118oe1jzGoFwug4sAbI5TLrgYZVlGMN1n1q1bd9Zuu+2G1NOOr3iezKChx5U8f8YYu5wQ8kPf9xHUl7xAqISYjP/Qdf134Q9znICtAD2Oy2iZhx63BgNhmuY3KKXHhO2gU/AcDf1vVVW/3OsB61jyPXwgotX7Kwq5RBGrYaejwIuNkiT9B6grx8bGdmwUpXlUEAQwn10xMDDwobkA0/Rd6Gz02wH0zk3urRm7wBTXAtB9TdMEwzRvzWYyrzVN8zMNLma4MqCFg5kvFCdA3ff9Pzz66KMH77rrrtVzzz2Xgq6006FsBnTbsny5k7S1Tj84w/3x+I+Pjx8uy3LoQ4+icLmu6cyyLeTKphp6D4llugH0Xgx5UkOfAuiKJniB5yiKssUBerzWTNMEvSxcsEhPS2rnoWvP9/0fB0FwTJQd1ZfYIrQFe8Zpp52GNOoDmscUwfFIP6xWq3utWLHivrmM+WyAzjn/RaOg1+vq9fqXfd9/f0TVPAmjEW7+U9O0/XrBSz8zoE/DFIfWRHzg6yml+WZAB6WnoiioXgbO4HmrnjaXgZl4dmaAhAl4l112Oc0PgvMFxkIayERUJWgTP5nNZj+L+vCEkG/m8/k3mqa5JpPJoE78gke79wfQp0o9Sf3aDOiiJPkZXQdn/h26rr8SZWglSfpOwPm+NKKgrdfrXNO0kIfY87yv6Lr+gVlN79MMWysNHcQyjuOEeeiGYax1HKdtprju51domtssKA4aOo7xuVwOZE1LEtDbPVIuNWKZ7sd6qsl9Og29XKlc8MQWpKEntHNUo0Qu9BRNFEDGOX/IcZxXDQ4Oru2noheb30dGRlZkMhn4ymHuDpXOaL8OMw0459fCVYq6HN2O90yAjk+6rvvz0dHRt3iex1esWHE/YwxW68krwkcso4s1TTuzG9N7cg1OZ3KHlm7b9gRTXLVaBWe7Aw7zXC53P/5mGMbr8N8JHt3JUwch5GpN05oi27sV2eJ6zrKsXV3XfUiSJM/3fWzSk2QRKJCh6zpoYxXXdY8SBOEbrus+ZVkWaqmDTW/WAiD97O1CA7okSaHJDZucrusHoa+QDeccaYFIbwxN70jlgaxc133Stu33DQ8P/6wbC8fiAfRwk587oLeLnm1YCtIo9/5Vd5xWQ99CTe4J7fwIzvnXCSEDMS7g0CpJEiyVkm3brykWi7/s5x4Xv/v6668XolRiMFCiPDZovAnop23bRtqhp+u6uH79+uduu+22yHnv6moH0HO53OGUUrtWq72qkcYILvdJ7oqmIMGXtBWsN8M+0Bagl8vl9YSQFZIkfVfXdfiR6fj4+CW6riMPfYogOAh6PP+gXC4Hc8cWd3HOC9VqdbWiKC9DTimYfxKHmg3j4+N7bbvttiOVSmV3RVEesG27ZNv2GcPDwwgODAMoFkoorQDdcZ2+EcvEGnqtVnMFQZDgv8pms+Dsvq1QKLwKIPfYY4+JQ0NDZ+dyuTMqlQoOjTK0c1EUA4EJMEX/Znx8/JDtt98+rPLTicWnHUAPguB9Ufnern317Yxn66C4AO4ans/nQw09DYrrbZQ7uNw9zxMFQeiY+rWdMZ3unukAHSlVMa/8YvGhg/q1VqvNics9jqI3TRNVz6YEo6GgDdL1KKXfrtVqHxoaGqr0UztPjkm85iqVyl2NSn4HxnnqcHXBnw8OB8/zPpfL5T7WTSEqvCTeY0ql0o2SJIXFWaIrdDd4nvdzlNWO31+pVL4my/Jx8J0joLqJRvh+VVVfRCk1u51/MaAna5DEhEahhl4qlXaRZflhfMBxnBOLxeJXoT1VKpU/KoqyXzOge543msvltmlv0HqgcnTb8y6fwySpVCof1DTtc7Ztx9Wcwrdxzsu+778zn8/fZBgGXA5/C4JgIAiCbxQKhRPxLKPUmzgCzX/fJ8aE8VqtugJ56EhbmxHQGXWmo8acaTOLyk5O+tCTgA4N3XXd21RVfdWTTz6pb7vttmalUnmWIAjX6rr+fNM0w4WGVJcoIh7z7rP5fP7UWU3vTY1KAX3zUZqWWGbC29n34iybEct4PmNC/4qzpIAe7kthHnqrKPe5AnpsdYzWMHKqt4sVnCi2yBVFUWpUsNwX5bW73Ha7eixuW7lcfp0kSdcxxrIRgVW4XUf/bNQ07TmU0VKne12ngI72rF+/Xi0UCn8XRTE0vcOCkTwANIrmnJfNZs+dYLTrHCOSgB4HMDQD+ltkWf5hBOgvKBaLqKaWN02zFEUxTomGa5wCflwsFhEY0ZeAh65GtscPjY+PPz+Tydxj23Y4WROvBw3UZzKZzJmVSmXI87zv5XP517qeCx77/+gUkHrc7DCdJi7O0hagz7F8arOGjtN6LpeDyf02XdehoatxnAUWnaqqcOGEpnekl8D0HuVow+fWdpnTyRUSWURQbS3mckeKGPxZ8KHXarW1862hR0FDk8QyqPxWKBRSDb1P1dYWG6BDLwKxzJaiocdZq3WfAAAgAElEQVQHxFKpdFqj+BIqqGmxXxjWSKxlz/MQ9f6efgbCTbdXxvU0fNe/16ibe4rilMI6UNVF3/dflc1mb+tmv51NQ4cPPZ/Phxp6vP9Wq9VXMsZ+LoqikgD08HwA/nnf918MF2037Wmloce005Zl7QNa1zMdxzkf0cf5fD4Hc4BpmjAL/DEqh5oEdG7b9n8PDAx8qW1A7/wQ0k0/e/JMYkCWaar2QN2qF0RRRA8mSBMYJb7n35LJZA4Ga1yj3vAnBgcGT3c9d+0ll1yy89lnnw3zPDTQBQkUXMyA/uijj6rDw8PnqIp6uh/4DrJL4OuC6T2TySCV7XZN0+IKfziZzCrDVhp6CugTvvytwYe+GE3uWyCgxyx0N0uSdHBTthPKSaPOx9sHBwev7ckm3OFL4j2gWq2eBUXLtm05YVUOrYG2bV9aKBQ+3o3ZvRNAjzT6MI6qVCp9nVJ6LPajZJcAvo7j/K1UKh2A+vQddneyOEvS5D4F0CuVyncIIQjwAjvcMwEKhmG8UxTF77TgmQZbz8sHBwfv6rQhS+n+0dHRPOhJKaUHJ/jdQwtHEAQP6rr+bJi5KpXKEblc7hrHcdY7jrMqn88/GJMvLER/FwugW5Z1m6ZpoYYOHvLYNGZZ1rMopZDr81AFDoUwoopJ4EHHYfHTxWLxjHYtHSmgd2Byn7h1/k3ufa6Hnmro/TO5x7EC5557bvChD33oHwMDA7ujkmHCn4hUU8+27T2KxeIjbSt5Pdwc429GDJ6/EUWxmDRz43dFVv53vDT+GuTFd/rp2QCdc/5z1PRIHhZi0/vAwMDfBUHYBQVlEKxnWVaY9YK6Dw1r5lnZbPbCTovJzKqhVyqVOwRBeAWlNEw1igD9U6IofiyuHpUQQuD7/rJcLjfWjgbVqfAWy/2PP/64tnLlys+g0hpjLA4qiwF93U033bQTIiwty3qVLMu/bMQebISpdXBw8HcLGem+WAE9OrmG7oBKpXKoIAiroUVGla3w95Aq0vf9xzzPQw7r7XEa1ExzIgX0RQzomezudauOQxu8KgFiKyo9JpZJNfSJ8e+XDz3ey0ql0n6SJP2PKIqIG8JJHBbL0NzeIE35VRAER+ZyuU0LAehR/8OUYcMwHmOMoYDWZNEj3/c9TdUFs24M5/P50U4xpktAD/e6Uqn0almWf0opVSRRIo47ESQXFfJBsa8XDA4O/r2TNs0K6MijJoQ8mxDyA13Xj8QgVqvVb8qy/O4WgD6WyWSGFmrgOun4lHs7NPvDb7Rx48b/Hh4e/qzjOKEfJllgxLbtA3AiXbdu3fNXrlx5j+M4I6ihPTAwsDpOp+i6rW0+2KpLSwHQYXpfuXLlOYqinO44Tmh6b0rt+KWqqjC9h0EtMx0cU0DvDNA5Dk2eVw+C4NhCofD92P/Y5pSb8bZZ89A1XahUt/wo98Vucg84p6wNd1YElGHWjmmab3Uc56uodS6KYlxNDLEwKPV6SS6XQ5BXx+bjXsy7qJ2hm6lULv1YkZU3xeVs8Zvv+66malLdqu+Ry+VQrrWjqxtAj9oUmt4bwdNX+L5/LA5BoL2O0+oa8QgA9r888cQTB3ZCfz0roBuGsYkQgqj1L2SzWdS0RTDRjyRJelMzoKN0aGRu3gIC4mZG+dHR0bcV8oVrPT/MgQgBHYDJGButVquv32abbRBj8AwU3bAsa9y27Y8ODAx8cyFT1xYzoCcnOUzvhBBEpYamdxD4JOI1YAW6MJfLnTWb6T0F9M4APTW5d7SXT3vzTGlrMaCXKpUL1i0CYpm5RLnHAXGWZaGi2jmSJOkIOPU8D/ugSylFqupxuq5f1RuLbYeaVzRCCdC9RBCEU2RZDmm7gV8TGromVqqVwwYHB8GH0dHVLaDH+93dd9+t7rrrrv+QZXknpNOhTYqiEATLwvQuMvFUJrJL25VfO4BeI4RkGtScF2YymU9EgH6bJEmvaOFD/5Ou6y9echp6R0M4cXO5XH490tOQupYEdLDkua77ZuThm6a5g+/7axljtcYJ7Nx8Pv/ZdkzF0zenuwkdv2+xA3o0ycPD4NjY2KGZTGY1fHAA9JjrPTLz/ct13ffk8/nfznRA6j2gdy//ePNLo9zHDpQk6apsNrt7vZ6a3OezfGqv09ZidjjTNC/mnJ8C8hhkPgGYkPuPgDjP8w7OZrO3dLHFTvtIp6sw3gfK5fJJoih+VhRFFdgVFUoJq+CBMS6Xy13dqc96joAe7nXIwpEkCdzzSO9L9pvDSskY2wfxV+3IcFZAr1arYPmBBnoOTCeRyf1/ZVl+YQtAj9ORtgANfWbxlUqlgwqFwq+QuoaJDA0dqVacc5TCOzKTydxsmub2vu8/EqViXZDP5y/qhvGsnYFs556lBOiIDWlUajq7kdb2McZYyPWOU7VpmsHQ0BCsRLdeeumlh5x9Nm5pbXrvJaB3uok0j0cK6HeIq1at8jbLQ0996PNWD71fgG4YxhcJISdFNb6hXcJ0bGuapjTW6QH5fP4P7exP/bonkY/+TlmWEV2ux9gFl0EE6B/KZrOXd0r8NRdAb7JKXmnb9nslSZqSNYYsKtd1f7dmzZpV++23H7BmxmtWQK9UKsdFdJx/ymazf4s09DslSTqwBaDfqev6y7cGDX18fPzlxWLx10lAR7+DIAC5zLsadYdXxxo6IaTWOPmB5/3zc9PQZxvOmX9fCoDeNMl355zfEATBXgg+hKaOaHdMelhGcrncBYIgnDud6X1isTF/dHSkZR56tVZby+eZKS7V0FMNHXnoi4XLfS4m93jdwQ9MCAFOhFzpAHRJkkJAL5VK+w4MDPx1ITEhBnTTNN8CxjpYnIFdsCYAwMFkZxjGGZlMBqbtkEau3WuugB5bJR988MHstttue68oijslvw0XBkDd9/3/zmazX2plem/F5T5t2loLTSPUjiRJOqgFoP9Z1/UXLeTgtTsQc72vUqm8IZfL/bTZ5B4EwXgQBG/J5XJ3mKa5o+/7/4aF3vf9j0UsewtG/7pUAD1pejcMAzXTEUEbRr1H/smwIlsjffLhRsGHdxQKhT+1Mr33UkOf63xJNfQeaugtzCXx3EYg35577bVakeWD0yj3iVnbxyj3OHocXOknxCACk3sM6JVK5SWFQgEFUhbsigG9Xq+/g3OOw0fI6w6LX6yhV6vVk/P5/JfnW0NP7nVPPfXUa3K5HLjeJ8nKIl8/r9frKLs7q+l9Vg29eRSQR33qqaf+BPVu8VuSi5YQ8kAjP/s5WwGg03K5fGQ+n7+mGdBd1x21bfvg4eHhv4yPj+9ULBYfq9Vq457npUFxEVNccx56q5UezyHOuVatVs/XNf0jjuvAPBmWWVVVNfA8j9m2vRpV7aIUGZTtnSScSfjODs7omZuRJgUiB2j5uq6nTHGieKUgCNs3qgTGjrulmYdO4e+aYEEEoO+1117wRy4AoE+cNNoJitsSmOISPvRPN1yNJwdBEAIRQEiSpNCH7rpu1yxsvToBxPuAYRjHU0o/TynVYgrYIAh81KmvGbXjCoXCN+fTh57sX7zfGYaBAMKjGUMQ/EThr8jXj9vvUFX1NTNZEToGdHy4XC5fpSjK0fHgJRpm6LoOvtwt2ocOs/n+++9/kqIolzUDuiAIm+r1+oGFQuEhy7LCAi2NogRjrut+YHBw8AdbXZR7JnNCzTCmFGdpB9CjuRWmdlSr1eeKongd53zPOL8VmzcmPefcbvC+n60oyiXNpvctD9Dn6sl/uupbkiku4DwI38w5Djt9TVurVCoHUko3C4rTNA31qY8q9LAeeqqh91dDj9Maa7Uaipuc5fs+gDJcl6iwhih3UL5qmgYz94JdCUA/v5E+dzraFbPFxVHu1Vr1LQMDAzd22shemNzjbwI3YXpfsWLFvbqu7xQxZU7+HBGXnaDrOuIAWjJldgXotVrtzAYbxHlg3EHeXOJCStHKbDa7qd0w+04FuBjuh9ZYqVQ+qygKCq6E9IFxHnq9Xn8SBW123nlna3R09DWDg4O31Gq1jZ7nvXVgYOA3cyOWmduGvhAm90wmc4LRJaAnzVEjIyOH5/P5HzHKPNux4bagoIUVRRFVi9ZUKpV3LFu2DL66SZfGlgfoc5/9yeIsjLErZVkONfTIfbYggC4IAlwobQD69PM/aXJfOA19EkDRUMxDL1kPHdXWFnseeifKWBwPVKvV3hEEwZcFQSiiemAjroUKghBn/5wry/JFKB8699nb3RviOV+r1b7PGPuvuOgT3pYA9OcPDAz8rdMvzAbolNKfq6o6hSluum/Esi+Xy4dQSuFmhEtjsjx3hDEmpXRPTdMea/UeAHoQBP8Ltqb49ynUr7VaDb5yfCCXy+WOj5jiQDBzDZLfm/zoMIO+AulEnQpmKd0/NjZWyGazNzDKXu16Lsy8k8LjnD+A6j2gNa3VakcjctI0zXX1ev3FQ0NDT6KfC3XYgSI2UW2t1l61tR4UZ9F1/QTTNEMNHYcfaGK2bU+hfp1p7ONJjspsy5cvP58xdoplWa7neWGKDMBAURSQHd2Yz+ffkjS9p4C+uWRnAnQcNoMg6LuGLoriVZqmTaatRWOI1KEJDT3gImUdByctApP71gXoMUkWrC6SJN2gKMpKwzBiQA8ZNBljq+v1+nvBwtbJYaGXeJBwDSD1C/TSkyCJ+rq6pot1qw6GU3CudHT1EtCTCsy6deu+OTg4+J7IfTOlTZzzW3Vdf10rf/+sgF6pVD4my/KF9Xqdj4yMFHfbbbfK6OjoSzRN+wOS35vD7B3HOb1YLH5moQZvsudzU2ZbDmrcp2q1Oqyp2n1+4G+DVLW4OEs0IDfpun4oKtI1ZHa27/unMMYey2QyO8cTq60ZM5f2T/NsJxp6wLnM5gjotm1fLAriCXWr3jWgRzINTe+2bT8XXO9BEOzpum4Y9Q5mKpj4CCF1zvmZuq5/Lja9twJ0aPQLXW2NEDKl2hrqodfr9UcZY8erqvrLfqY2JgGdUnqlqqrbQz3HPAZblWEYnq7rx+bz+W93NF+bJnXzFEzUg18lSdKViqI807Ks8LsYW1mSBcu2jspms9d00//pNHTXdcN66GFkebl8UbFY/ERMAtWvg/VmPnRFXVUzauC4ndTQt4Qo96if9KmnntIYY38dHh7eDTiBAYVsAZyU0hHDMF40MDDw2EJgQgyI9Xp9B0opyrcORntKyASG+aer+t9LldJLUau9rb05cVO8x1QqlRtFUZxSDz3q7+Ya+ix7e2x632677e4jhOyYULbDpkd4c0zDLI+8+Smm9xjQ4wDFSOkJFe+w2trY2NjrFEX5Gf5gmuaBy5cv/z3nXK9UKuMSVPSo0ljcR9/3f4KC7gsxeJ0ORrf3G4YB7uI/gzYwGZFICHE555fpun5auVwelCTpakVRDjNN8w+5XO6A2ZjNum1Pu891AuhxZGy7747vSwSz5QHojLETkNoHDR0WLqSIOI7Ttobe/F6kfTHGftQAbxyuoQGEZVajCXw/TGqKotwXaephFGu5XJ4MiltUgE4JcR2XLwSg12q1VwVBAEDfKQZ0RCdnMhlqWdaJmUzmq3MB9OZ5E4M0uPobmtzXBSasdFwniOdLNC5H6rqOOJOQqrOtuRdtjosa0FV1Va2WAHRNlyvVygWPd8QU1/0Jv19R7hifhx56SNltt91szvntKEAVB5tFYO4ITJAN0zikUCj8oq3x7OVNE8GSoQvO9/2TbNv+LKVUTVRbC8szW5Z1eaFQOKUbt0BXgD5LHxOm99cSQn4mJmu+RkYgQojR2Af3aja9zwroIyMj2ymK8kRUJP3EXC6HhQ4T512SJO0fCicx13zfH8lmsytQhaxfJ+Bejnmn78JmU6/XTxZF8TPwv0SbT/gaznm5QfX67kwm8z+GYayklP5JUZRtDdO4Jp/Lv7uX3Nidtjtpztnc5I4YgImDHtI6MpkMXCthWcTZvzN1o+k3oOMwaRjGBaIofrhRnjZ5oApPro3KTjcUi8W3YlzQ9qhU6OIEdJwA3XkH9HCDq1QqL+WcX5nRM8/yA9/H4QjzGeZHyujHBEG4uJcH0PhwALO6JEmXB0GA4NmQ0Rc+V/AMeJ73Nl3XcVhrH9CjCbqkAH3e6qFPRt2Ha7nXxDLRfhGmrm3cuPF8SZJO0zQNWSjhWmSMxfXGr6xWqx9etmxZbb4VvXjPrVQqqLT2stjcjnmH9iEUp16vHz4wMPDj2fe6KVAX75fxempfQ2/jQ7GcKpXKtymlR8WKc1Jb55zflMlkDkvibLlcfmGjCuj/xm7gzTR0fBt87r7vb0MI+XY+nw/t+q7rfsbzvI80t822bZiWXl8oFLqj++v+INqGmOZ+C+e8UK/X/0dgwssDHkDDgDk4Lkiw3jTN5wwODpYNw3g+pfQe3/dLnPPT8/n8FQsZ4T4zoBOYArsE9KkybQZ0SukJjuOEGjqARBIlwfXcjjX0qP2TUe/gepckaU/45eGrwyYCDukgCIxGyszHdV3/YlyeddFq6AsI6JifnucB0PeNAT0IAheBOJzzr+i6/gHM7dkK4LS7ouIDYr1eP7MRRHo+rAJRVS4uyzLjnCO188hsNvuLbsiXthRAb739zW1T7KeGHgf5btq0ab9MJvNTxhiUuRjQQ6u27/uB67rPLRQK4I3oLgOqCxHEpao3bdq0r6Iot6uqWoAVKtpL0EZY9mxd13eklHZcaS16T18APd6vCSGFWq12LyFke/wtAeihuwCV7AqFwg/iddgWoJdKJQQ8/CfnfKOu68vx8FNPPfVqTdNuFQQhtumH70SUIyHkqlwud1zXg9fuLrEA99m2/Rzf9/+B012sBcbNoJT+TlXV/0AUfBAE76OUXua67nrUiEca20LLYyFM7r0E9OShZHx8/HBoc0EQYIWGXO+R6ZiJongvY+ytSBnEM7Va7WBRFG+Oa3V25UPvYkNJTs8kscwC+9DDQxFoiV3XBaC/1g+gHHsiNHRFUUTTNG8qFovHUEo3zi0rY/KQmIz6/gal9FhYV5C3jDFBhLtt22sEQXhPI9inJUnQbEt9SwH02frZze/9BHS0JxGz8kfLsl6U8POGFrIgCGAtu1jTNFRds7rpQzfPJNw8P5Jl+fCwbKrvT5RpjCOEOf8WAne7bVc/TO4J5WqypLQkST9GzFDMcBdjre/7Y6g3v3z58qfwtxjQYx86ItynRLnjpvHx8aNVVUWlMOI4zguKxeI9mCRI0eKcDzULm1JaMgxjx2222QaUpy3z5boZoIV+BhN3l112Oa0xiMhnjDXDuFmYqOc16A4vgv9cFMVv6rr+xtHR0Xu32WabvbvxR84RQzYT15YE6DC927Z9QWMOTzG9J6qyXavr+tt7BuhznHyLCNAnNaRSqXRlNpM9xg/8MGsAByJBEJC6tk6SJKz5ngToxZveyMjIszOZzNWEkJcgngIHMdd1QzO/WTdvFkXx/bqur+3mELFVAXqHG0O/AT2e2yMjIydkMplPE0KyCVDHksRYwwoDLf6vSRftHJfVtI/HcwhZWqIoIgi1EGdkRQxxobmdc/5iHCK7bUc/AT2pwNTr9e8EQfBOaOVJLd11XZrP528477zz/uucc84J2gL0arW6TBTF9RBSo/73mcVi8VNYQJZlXYHayc3CQJCS4zgfKRQKly20VtrtQLV6DnJolI0Fnz3MSriSRPo4Ib1Y07R/m6a5neM4DzHGRFSW0jTthG78gt20faa1viUAejTJJ03vjLEbGGPPjQEiAejVRs4vTO9fRiCWLMur56ShdzMYiWcWC6BH8gv9nqVS6YxsJnsRNHTf98WoSpYnorKGbX8in89f2It5Gx9mK5XKsZIkgSZUiTd813WdTCYjG4ZxaT6f/2hyE+tE5FsVoHcimD5SvyY1SRzObrjhBn7ooYf+nRCC9Zi03MbKz69d1z0in8+PdIILHZ5fwmYBaO+//35h1113vYcQskccrBeB+UT+Lue3GYbx5uHhYewVXV39BvR4PTz22GOF7bff/l7HcULTe3xBYQbXO2PsCFEUf1gqlfZjjIFqN0ylbqmh44d6vf5nnLAIIX/XdX0f/K1arb6SMXZb0+CFdn7XdR/J5XK7bynBcRi4SqXyflmWsSHFpAlJ2f5S07TXQIvfYYcd3pbP57/DOR91HOe9qqqujnM2u5o1PXpoSwH05KZvmuZbGWOonR6WWY3SCMOod0rpfVbdeqkkSy8QRfFXSxLQu9nNZpkvidS1gxtpa1dyzreDdg4qXUEQfEVWBLNu/r4RDHusoihr5hL7EfsxEc9g2zZS0t6SWD/cdd2QVKZer7+rUCh8t9sDRAro0w96vzX0aD2GgYzIkGi4HC+Blt5gcMT5GmyOuCXcMymln1EU5ewGY1t98xb3ZrLHc2j9+vXXDgwMvC2Oao//jXZG7tKX6rp+11y21/kA9Lh9hmEcQghBzfYw5im2OAC0HccZFUVxD8/zdmgL0E3TRGT35z3Pw2YJQSB9DXzYf2WM7Z04McT/F/edrOv6lzo5jc1FuP18tlarLaeU/rmRuxufkELtXNM0UiqVEIh1Qjab/W6lUhmilF6fzWZfOT4+/uDg4OCzu92ket2fLRHQN2zYkCkWixdJkvRBFyHjnMeFDeJAxUtN0/xJoVD4rWGavhTloWeyWWbUamsR64AAzn6P0SLT0EMLR6lUGtAA6IQcHsUihJkBYPmCT73BAnmOoigomdx1QaFYOx8bGztBUZQvwmqVUADCNEbbtv/i+/4x2Wz2791+a94AvQ3MQVvaY4p74vw999xj3sqnjo2P313I5/fFHo7Dm+d57lyqrTXvT3FEuWEYd+m6HlbjdJynE2UApDBz+76PaPjLYCXqwx4XztVyufxlRVHej3FIpKmFOBiZ/7+naRrinMy5tGG+AD2e36Zp4tD7jtg63ETs9r0gCLDGfh+Dfssod3T40UcfLW6zzTbrwNfLGEO0+9GR2f3oIAiuagHo+NOm9evX7/bMZz6zspR96diUIrrbTzb7zmGm9DwvBG50eGx8bK+B4sDfDcMwfN//fKFQOCsJFm3sB3OZXzM+uyUB+oRWEDBKGQhn9ooIZ8DQNxn1Hk36hx3HuUfTtNc3MjMy0Bq6Coqb06iAmSoINRjk0S9kUFzcjRhoLcuCO+jyUJWi4RkV/xPn9YPd67iGRe7H3Rx4EsQ+LwTNbCaT2RtZMPFmg1QqSqncCKQ9W9O08yIg7IpJcd4AvY150D6gP37+nnvuOW+A3o+0taQ4Yr+14zgvNE1ztaqqKxIusLC0ahwk1zhQnJfNZkEJ27MguWi+cZRzdRznPcjfnqBKmaysNpEnScg4IWS/6ehT2xjiyVvmC9CjPtBSqVQQRfE+xth2SS090ebzG8kzIE8KTe7TAjp+rFQq3yGEHKUoirFhw4Yddtppp3FEdNdqtX9F6QrhoCUubBJX4iTUfy29f1BZrVb3IIQgchq87VPI60VRBFXmqaqqfgXaoizLZw0MDJxeq9UQcwAa3H920/d+9GZLA/R4kuOwWK1W3yYIwrURIUkY9R4v5KhgRPgvzE9oKNlsdsGqrS0SQJ+MdscaJYSAxCLpSgqB13Gch3VdP0aSpDs7SSeLXUylUmlnWZavliUZaZ7wesQpkuH7KaVrGkyK75Fluavo9sQBpSX166Jgimsmlpm3PPQJ6cyHyT0xDuHBtVKpfLxxuD5LlmU1tshEgA5Tcch7EATBTz3PO3FoaOiJTkC0+d54X1u/fv0zMpnMtzzPezksp7Ish7XZE1fMG3KYqqowXc/5mk9AjxtbqVQOEwQBhWTCqPemKz6Mh3+eDdAPlGX5rojeL6RRhDBN0zyGEPINvKAJ0DGZfNu23zQ4OIg6r0vuAm87AqoopS+L4gEmedvRGUmS/vmpT33qOYgwtCxrV8dx7ofWkc1mb6WUvrab6PZ+CWlLBnQcpvL5PE78H0R6N4Ym4TObKEHIWIjyKaBPzLBEtayjKKXfEARBSWpUmO9RkYcNlUrlw8PDw9e2E4Eeb3Ku677M87zLVVXdA77ySqXCsNFGBZ1Csz6l9COg623nvVPWRdOJN9XQp9815hPQowNECOqGYXybMfau+GAdAzrWJaxkWJOc8zFVVc99/PHHrwDjXKd7H+bNr3/9a3nPPfc8qVGs6ZOKouTjXPNcLkdQsSy6QqroRq2C0zOZzOfaZiKcpUHtAzpzYvKuTvuYvD+e55VK5buCIISm9xagPvnIjICOu0ql0q9lWX657/s1y7KeNTw8DE1Usizr7iAI9trsuBAEGLwnZVneT9f1DUvJ9A5aw+XLl58jCMIZcRR104HFqFarxy9fvvx7GzduzEqSdGGxWPygZVkjoigeIUnSrzveqOYy2rNPvlCLma/iLKB+7XUeeqsuJlJU9hIE4XpCCNwfoQYYRbVO1hRuR0Pvk3VkUZnco012wsY+YeH4vKIoJyMXHcFLsZwTAA9T5Q8aVqqzVFX9VyurUzwOqHXQMKWeQSmFjzKZwoTqVkRRlPDA1eB0QEnck6LCHaHFoNvpv7QAXZMrlWqH1K/dSmZ+NfTEvArHs16v39SwvrwOwBqnW8U1vjEXMPfAFOi67kOCIFzNGPuOruvrZuptPNaWZe3SKIb1X5xz1DnfYZq9Afjjy7Ii+L73JdBy98HMD+bFnjLFzdZ/RL0PDQ3d1ziIh6b36a5ZAX18fPxliqL8BoQylNIvyLL8YbwMpUJ1Xb8lIpaZtLvjhZIoEddz/zIyMvKy7bff3poJ1PuxmXa7FEZHR5EKcL0oikm/3+TrfN+/JZfLHRz1fw/4NmRZhqZ+88DAwBsWmuq1ud/NGrqqqqsw2WOfZrQYO6R+nfqV+BsoTjMF0EVBomRuTHEzTvKAU8ooN03zbZTSayPzMQAdh5jNAD2TyTDDMBY8KA6aSi6Xm7fiLC3mRLjx4pAniuIVhBAUFpoE9URAURxk6HPOUWbyds75w0EQlKHJc7Bb0nwAABCXSURBVM5znPNnSJIESlnkmYem1lD40RUdrnwBYbmE/M3zvPciL7nbQLhWmgvWXLJ8ampynwrouWwOzIBhUBxqUWSzWcQHXVguly/YYYcdUOCoOya3pokVxRGwc889lx9//PHXDwwMvEUUROBAeCfmAgAdU6F5jhFC/kEIgQsG1dE2MMYQuIZEjFwEYLtSSl/aYC7dOXatTU6zKTRnIbWyr2u6UK1VL4VFuRu+9lnANcEUJ7054XGOwlLaL5+62XdmAcNKpfJGzvmNyVKpze8A/ka07bBW7DPFIR4NBMjsb/I8DyH0lmVZzxseHn4QA1gul78uSdJxyTS2BKAjze3Hy5YtO7xXk6ZboG7nuVKp9BpBEG5GEFUS8BL70yZBEHC4eQDaeaFQ+IrjOO+SJGnj2NjYIdtuuy3Id+akdbTTzk7uSQI65/z7jYPZvAA6omkppSh36ouCKDiuc1sjXeRVMTVrJ32Y7t7EQSJbr9dhev9AVCwnrCkcmtwngnLCnaERhLWoAN2yrEcppX2vtjaNFhNuSrC4BUEAJje4l8KDXiy32NKRLD0Zb8RJk19TZagpLjgcHJD/6/v+Y/Cba5r2m16AebQvbeZDt23bcxxn4autLSIf+nwBeuIQF84tWIBEUTwpWcyqOZ2sk33g6X14etTDdxs0w4JhGB8dHBz8Qq/M7E0Hyb5Rv85ykAjne7VaRY33t89kdoeLC7+3BHR8BNy4siz/WZIkZtv2XcViEaT3OJHkGlG8IBZ4RrIxSF1AgIKu6wisu64RKHZkrziiO5kE7d6LwhWCINzCGINPEcmUk49GEwk5lGdEfOEoVPP6XC63GnW/GyQn12ua9s62o4Ln0STRDOiyLK9ClFK/NHTXdS/mnJ8wH4AeHzajMqt7+b4/aXrHom4GdFVVmWma/dHQW4zpdGlrvu9zWAts254fQJ9mvsWHz3q9vhMh5GuEEFieQr9jrElNKNZP57+2A+gA+Oi+cJ4pinJ/rVZ7b6FQmFMQXAtLw6IEdMuybsfBOa62hsh+FDCpVDqtttbu7rX5fUkfeiaT2Re0p9DQwd0PDb1cLl9YrVZ7qqE/vWE+XfHM87y3eJ6HGgvbxvMoeUCM/9Z8KGzV8+ZYraZ7Yj19bePw+J5cLndH99Kb+cn2fejtFLrqrJXYz6vV6iD4NhprNiY72+wlWLdYw67rbq6hx6fher2O0pinVatVrmnaKdls9jL8BjCklN4RBAHL6BnquE54So9P+AhYkCTpJw3CirdBg1psPnWYMQRBuA4aZcQmNEVAUYWo67LZbEgrCk5smIdEUVzped6/gyB4SSaTCXl1p+vbPGJ4c9snfejQ0AHoiDiNS41Gbb5C07QOqq1NnT/NJncAOni7EWcB0pJ+aegJjSA+uU5GvUf9S1qbUH+b1a16fwC9xbpsBeiRL5Hrug4GxvkB9Bn2jMTYabZtgyXuZByEkN4PP6eiKOHGkNQGmjWD5s0Y2oFpmr6macg3v85xnFOGh4dBGd1T61XSh/6sZz1rNVxh0NAjAhEkQ6MK2EWaps1rPXTP9W4nhKyyncl0vbA2e6lUumDdunXzmraGOCfG2PwCejTf4pREQkjRtu1PEUKOBZd/xE4Y3oWIdIDPxBxqsp3PgnUJgEccBv65zDCM8+bCAtcOvC4koMftq1arSIW9IU5VizA6/BlyiU3u0wJ69AC4tP8qy/KzKpVKzXXdFwwPD4cpWtVq9RhZlr8hSRJ3HGdqHtvT2u6fG7z+/wnu5nYE1+97MDD1ev0E3/e/BOBJaq3Jb7uu+7exsbH9d955Zwum9lwu93XG2JEonep53knZbPZ7vTIj9rrPzRq6JEmoXzwF0JHD2Qh07Amg12q1UEMXRXHeAR1jgzxXQRA+0KJufYD627ZtLzigY+dSZIW5nrvggJ44FMUpbQcSQj7ted4BiJkBqEeRyZNTcxZABwsc5PwAKg42tMPV0YM9P9P2B9C7a2YyDx2A7npueHBmjOFQ4xQKBbnhCrjgoYcemhbQu/ty6x0j1tA3btx4d6FQ2BeABw0dGKqqqmQYRs996NPtXYmAtmc1SpEj2PjtnuepOCjOrJnPDPCR8mRTSr/FOb+oJa70UqhPH1QWxOTeLF+Y3iHLxBqeBPQY4D3Pa62hxw+Zpnmg7/u/1VSN2o695sknn3zJbrvtVonqpV8ERiBVVaeMRBNrz8YgCN6Nkon98au3N4KIymWMXS4Iwn/Cv5o86TQJ7hFN0w6ilP4boF2tVt8ty/JVoB31PO+HKAbStqm912idfN/0ZtVQe0Uqnqqqx4ADPaopjsUdHrwcx7mzUChc00nOcfLT8Tg+/vjj2rJly94siuJrXdc1okNOIDIx53jO3bquf74XKX2tuhprf+VyeVfG2IdEUZzkDo/XoSAIsud5T/m+f00ul7u/1xpj8/DG70fZUsYYGKzCtB1ciqLIqMrHGPueoij/6Hdb2p168Vi6rnug67of9DwPZvhCssJiC0CP1zvcUncJgvDFhx9++NZ+E6jEbUX++2GHHXZSvV5/kaqq1Qi4EOQ3wDm/Pp/P/6Rfh4qEXOF/xFpD2dBTXNeFVlxF4ZswSEvX85s2bbp+zZo1P1+1atVEPc8+XvFaLpVKn9A0bXfOuRmVrsUhIxsEwY26rv+sH8xtswF7pVJBWW7sE9g794+CKTuRhkEIATPatbZj/2hwYBBBmvN2JTI73i+K4vOjfTQs6BbRT9+rKMpX++G/T3YSckRZ4hC7OD7OJzb0hIbemH/nbRYU17x5VyqVcxog+Mkw+E2SVqPCGO7BJDrggAOu9n3/nTPZT+BDlGX5GhRzyWazI52a4NuD7NbjC57p00477U0wzzRKvu4giii+M8E93LxRcc6fCILgtblcDhGYKFP3WkrpL2BSbORa/qvBjLTvwMAASP6xkreYCnPztjLm40MdTJYObp2Pli/oN5KHtEKhgOIP+zcyCZAauDwIgoGocVWUVxYE4Z9Icbdt5/eDgwPl/hzUF1Qc6cf7JIE77rhDffGLX7xfI3Ib1SkRyQ53ZoEQko+yVqAYlBhjj3POH6GU/p+qaXcz2nv/dJ+6uOCvnRHQ0bqoAhvK070JKWtBEFyYyWTOjH4TTNNEgM2xEcht9r6EqWUUJwxN05A6M2NqWy+kAk2pkSP7Wc75K+P0mmSIf1ydB9+CJsc5P7RQKMBNgPrazwuC4E5CSE4QhDFK6WG6rv9usWhWvZBP+o5UAqkEUgm0JYH09NuWmBbDTbMCegTcecuyfh8EwR4wWTfyWM8Ea1cM6rVa7XMwfTbnpUa/N/dzQ6PW9aeDIPguyuz1UggAXMuykKp1KmMMVJeT7oA4cC8iO5gMzmgQ4T/kuu5h+Xz+gUgz3xU5uBGRQVUURXBdX7cYqqn1Ulbpu1IJTCeBdP9O50YqgaUpgbYAHV0rlUq7MMZ+SwhZGUUZop7yxRFogx72+IYfC7mAYMufQjbRLJrI3G03yrWCLvZ7vu/fMTAwUOpYhDR0VFLX9fYG4UgQBEcIggC/KmeMTelbHCUZR/GiDb7v/8nzvEOXL1++CRaG9evX75HJZH5GCEFqj9Uo1XlusVhE4FfX1ag67lP6wAwS6DHU9Ph16dDNXQKLYUgWQxvmLsn0DVujBNoGdAinUqkg4OI38K0xxhDxc04ul4OjPrzK5fJLGqVWbxQEATlz4bubguTC+2L/deI3BI78JQiCuxhjawgha1zXBaF/eWhoqBK9R/7nP/+ZX7Zs2XaCIIBBCCQZCLI4UBAEBL1NUCBF/vHpCDDANW2apjc2Nvb1crl8yh577BGm1o2MjLxoYGDgZ4ZhIIgDZQC/ksvlTl4yYJ7uQlvj+k373BcJpIupL2JNX9p3CXQE6GhNtVpFCUsk8i8HXsuy/JMHH3zwqH322QfRiPh9mSAIl9m2/XYEoTVrytNo69N2NCa7iG+Ahp0Mq49z8JooBiff10xQ4Pv+esuy3jc8PHxTHNBTLpdfLEnS7b7v65qqOa7nXqJp2ieXDJj3fZosxQ8stk15sbVnKY5p2uZUAqkEZpJAx4CeAHUA4jOhEbuue3cmk3mTruuTZfJc1z2oXq9/DSbwuQxBi+puHb0u8Ty07m+WSqUzV6xYEfru42j1Rm72tg061z8ODQ0NBUHwcZDopGDekZh7cHMKeD0QYvqKVAKpBLZiCXQF6JBXqVQaUBTle5ZlHZLJZBApPo5SiZqmXZ1gpNINwziRUvrRSKPfTNSzUPzNOjStTPrJhwDalNJbkDOfzWbvbZVmg7+Zpvk83/dfkM/nr0yj2WcV+ww3pMA8F+kttWfT0V5qI7ZE25tOtLYGrmtAx9tBHFKtVi+WZfkU0EY2ctZRC/mnpmm+H/SPcQsaUe0A9hMopScTQpB7OHFxQujU2LW2Gp28KU6Liw8GCYB3KaPX8YB/Lqr4FLnYuWqa5qt93/9DFGWfTpWOpb40HkgHdmmM05bSynS+bSkjuXT7MSdAj7sdcc1eHgTBchRp4ZyPNwpeXfLII498ee+99zZj0zbM2IZhHEQIOZpSCoIaNVl+cVoxTrNSwBMMAIcfHQQwEQ/7Pb7v/wBlUXVdB0HBZLlAwzBe6Ps+ige8WJblr2madmJqWl+6kzdteSqBVAKpBFIJPC2BngA6XgcTvCRJn6WUvtdxnDAYznXdjYqiXJzJZC4H62iSYY1znjFNE1XcXtWgkMQ/e0zHrz7TgPm+/ySi40VRvLPBSX1roVB4qNmsDqKYBuif4/s+6suGbHGSJD1Uq9X2HR4eRi3elP1tK1wVqUa1dAe9p2PX05ctXZmmLV/6EugZoMeisCzr9ZzzS0BCI0kSMQyDaJoGJrarbdu+slgsPtJKbA3CfcUwjN0ZY8+JCtsPUErBz1yMABfpa14QBBsZY/8mhPyLc/6viKR/syUZuQMOkSQJhUhQ2x0XtHWHc/7VtWvXnrX77rvXUhrXpT+J0x6kEtgaJJCeO5b4KM/DAPYc0CHyiC72yIZJ/BxCyC4om4cLVc4YY0h5Q/nSW3tdiQ2ad71eh1n9aM75mwVBWI5CEw2CGGpZliOK4reDILi4WCziMDBpiu94mszDwHTcpj49sBV1tU8STF+bSiCVQFsSSDebtsQ00019AfT4gyjrZ1nW213XfR/n/ACUW03UzUU6+T8opTejjq8kSfdls9kH2q1ag/esXbu26HlesMsuu4QVeFABLJ/Pf1UUxXfj7yihGQRBSVEUpKt9ddmyZQ/PCcjnLO70BakEUgmkEkglsPVIYH5PKX0F9OSgVavVPRhjJzRA/K2EkOHI/h0WaMcF9rhGDrjDGHuYUrqRcz5KCEFBl1KjIIxMKdUJIVIjqG2wkU++oyiKuzqOgzq7nxwcHAQ9a/iier3+X5RS1I69pUGCc10QBNcvX758MjBv65lIaU9TCaQSSCWwdUpgfmG0lYwXpgXzBugJrZ0ahrE3pfQNCIjzff+lbOIKA96RhjbbFfGwE9Ri55xfq2nakXG0esN/r61bt25o++23B8nNwkh1tg6kv6cSSCWQSiCVwFYlgafBqH+wNO+A3jyCyFE3TXMPx3H2lCRpz6gO8yDnHJr4UKPgC4LjUCcXjviaKIp1z/PWIijOdd1/EULuKRaLv5rRlN4/+W1VEzLtbCqBVAKpBFIJLF4J/D/xclRhztyp5QAAAABJRU5ErkJggg=='/%3e%3c/defs%3e%3c/svg%3e",Vw=({walletConnected:r,walletAddress:e,wagmiConfig:i,walletHooks:n,onClose:s,isOpen:o,onCreatePlayer:l})=>{r&&(e||r.account&&r.account.address);const u=()=>{l&&l()};return Et.jsxs("div",{style:{backgroundColor:"#101020",color:"#fff",padding:"20px",textAlign:"center",border:"4px solid #0078D4",borderRadius:"5px",display:"flex",flexDirection:"column",alignItems:"center",maxWidth:"960px",margin:"0 auto",position:"relative",overflow:"hidden"},children:[Et.jsx("div",{style:{position:"absolute",top:"0",left:"0",width:"100%",height:"4px",backgroundColor:"#0078D4"}}),Et.jsx("div",{style:{position:"absolute",bottom:"0",left:"0",width:"100%",height:"4px",backgroundColor:"#0078D4"}}),Et.jsx("img",{src:QL,alt:"Intuition Logo",style:{width:"200px",marginBottom:"10px",marginTop:"20px"}}),Et.jsx("h2",{style:{fontSize:"1.2em",margin:"0 0 20px 0",color:"#FFD32A"},children:"BOSS FIGHTERS COMMUNITY PLAYER MAP"}),Et.jsxs("div",{style:{maxWidth:"80%",margin:"0 auto"},children:[Et.jsx("p",{style:{fontSize:"0.9em",lineHeight:"1.5"},children:"At first, there was nothing. And then, suddenly, the whole community appeared !"}),Et.jsx("p",{style:{fontSize:"0.9em",lineHeight:"1.5"},children:"Everything of which the Boss Fighters community would one day be composed, would be born in an instant."}),Et.jsx("p",{style:{fontSize:"0.9em",lineHeight:"1.5"},children:"A single species of condensed matter, exploding in a vast universe."}),Et.jsx("p",{style:{fontSize:"0.9em",lineHeight:"1.5"},children:"Although energy would neither be created nor destroyed, the interaction between these newly-created atoms would continue to create something beautiful..."}),Et.jsx("p",{style:{fontSize:"0.9em",lineHeight:"1.5"},children:"What had been separate would become whole again. And what would be created in the process would be even more beautiful than what came before..."}),Et.jsx("p",{style:{fontSize:"0.9em",lineHeight:"1.5"},children:"Our story begins with the atom. The cornerstone of our ecosystem."}),Et.jsx("p",{style:{fontSize:"0.9em",lineHeight:"1.5"},children:'And our "atoms" start with you !'}),Et.jsx("p",{style:{fontSize:"0.9em",lineHeight:"1.5"},children:"Every contribution will help build our ecosystem and make it healthy..."})]}),Et.jsxs("div",{style:{border:"1px solid #FFD32A",borderRadius:"10px",padding:"15px",margin:"20px 0",display:"inline-block",backgroundColor:"rgba(0, 0, 0, 0.3)",width:"80%",maxWidth:"700px"},children:[Et.jsx("p",{style:{fontSize:"0.9em",margin:"0 0 10px 0",textAlign:"left"},children:'Claims in Intuition, also referred to as "Triples" structured in Semantic Triple format :'}),Et.jsx("p",{style:{fontSize:"0.9em",margin:"0 0 10px 0",textAlign:"left"},children:"[Subject] ⇒ [Predicate] ⇒ [Object] (For example, a triple could be : [SciFi] [is] [strong Boss])"}),Et.jsx("p",{style:{fontSize:"0.9em",margin:"0",textAlign:"left"},children:"This keeps our attestations tidy !"})]}),Et.jsx("button",{onClick:u,style:{marginTop:"20px",marginBottom:"20px",padding:"10px 20px",backgroundColor:"#FFD32A",color:"#000",border:"none",cursor:"pointer",borderRadius:"5px",fontSize:"1em",fontWeight:"bold"},children:"CREATE YOUR PLAYER"})]})},Pc="0x430BbF52503Bd4801E51182f4cB9f8F534225DE5",kG=BigInt("25000000000000"),FG=BigInt("25000000000000"),Oc=[{type:"function",name:"getAtomByOwner",inputs:[{name:"owner",type:"address",internalType:"address"}],outputs:[{name:"",type:"bool",internalType:"bool"}],stateMutability:"view"},{type:"function",name:"balanceOf",inputs:[{name:"owner",type:"address",internalType:"address"}],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"atomsByHash",inputs:[{name:"atomHash",type:"bytes32",internalType:"bytes32"}],outputs:[{name:"atomId",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"createAtom",inputs:[{name:"atomUri",type:"bytes",internalType:"bytes"}],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"payable"},{type:"function",name:"createTriple",inputs:[{name:"subjectId",type:"uint256",internalType:"uint256"},{name:"predicateId",type:"uint256",internalType:"uint256"},{name:"objectId",type:"uint256",internalType:"uint256"}],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"payable"},{type:"function",name:"batchCreateTriple",inputs:[{name:"subjectIds",type:"uint256[]",internalType:"uint256[]"},{name:"predicateIds",type:"uint256[]",internalType:"uint256[]"},{name:"objectIds",type:"uint256[]",internalType:"uint256[]"}],outputs:[{name:"",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"payable"},{type:"function",name:"isTriple",inputs:[{name:"subjectId",type:"uint256",internalType:"uint256"},{name:"predicateId",type:"uint256",internalType:"uint256"},{name:"objectId",type:"uint256",internalType:"uint256"}],outputs:[{name:"",type:"bool",internalType:"bool"}],stateMutability:"view"},{type:"function",name:"depositTriple",inputs:[{name:"receiver",type:"address",internalType:"address"},{name:"id",type:"uint256",internalType:"uint256"}],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"payable"},{type:"function",name:"redeemTriple",inputs:[{name:"shares",type:"uint256",internalType:"uint256"},{name:"receiver",type:"address",internalType:"address"},{name:"id",type:"uint256",internalType:"uint256"}],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"nonpayable"},{type:"fallback",stateMutability:"payable"},{type:"receive",stateMutability:"payable"}];function qL(r,e){return function(){return r.apply(e,arguments)}}const{toString:UG}=Object.prototype,{getPrototypeOf:Gw}=Object,{iterator:zv,toStringTag:XL}=Symbol,jv=(r=>e=>{const i=UG.call(e);return r[i]||(r[i]=i.slice(8,-1).toLowerCase())})(Object.create(null)),Yl=r=>(r=r.toLowerCase(),e=>jv(e)===r),Vv=r=>e=>typeof e===r,{isArray:Df}=Array,L0=Vv("undefined");function zG(r){return r!==null&&!L0(r)&&r.constructor!==null&&!L0(r.constructor)&&No(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}const YL=Yl("ArrayBuffer");function jG(r){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(r):e=r&&r.buffer&&YL(r.buffer),e}const VG=Vv("string"),No=Vv("function"),KL=Vv("number"),Gv=r=>r!==null&&typeof r=="object",GG=r=>r===!0||r===!1,Hv=r=>{if(jv(r)!=="object")return!1;const e=Gw(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(XL in r)&&!(zv in r)},HG=Yl("Date"),WG=Yl("File"),QG=Yl("Blob"),qG=Yl("FileList"),XG=r=>Gv(r)&&No(r.pipe),YG=r=>{let e;return r&&(typeof FormData=="function"&&r instanceof FormData||No(r.append)&&((e=jv(r))==="formdata"||e==="object"&&No(r.toString)&&r.toString()==="[object FormData]"))},KG=Yl("URLSearchParams"),[JG,ZG,$G,eH]=["ReadableStream","Request","Response","Headers"].map(Yl),tH=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function D0(r,e,{allOwnKeys:i=!1}={}){if(r===null||typeof r>"u")return;let n,s;if(typeof r!="object"&&(r=[r]),Df(r))for(n=0,s=r.length;n<s;n++)e.call(null,r[n],n,r);else{const o=i?Object.getOwnPropertyNames(r):Object.keys(r),l=o.length;let u;for(n=0;n<l;n++)u=o[n],e.call(null,r[u],u,r)}}function JL(r,e){e=e.toLowerCase();const i=Object.keys(r);let n=i.length,s;for(;n-- >0;)if(s=i[n],e===s.toLowerCase())return s;return null}const Xd=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,ZL=r=>!L0(r)&&r!==Xd;function Hw(){const{caseless:r}=ZL(this)&&this||{},e={},i=(n,s)=>{const o=r&&JL(e,s)||s;Hv(e[o])&&Hv(n)?e[o]=Hw(e[o],n):Hv(n)?e[o]=Hw({},n):Df(n)?e[o]=n.slice():e[o]=n};for(let n=0,s=arguments.length;n<s;n++)arguments[n]&&D0(arguments[n],i);return e}const iH=(r,e,i,{allOwnKeys:n}={})=>(D0(e,(s,o)=>{i&&No(s)?r[o]=qL(s,i):r[o]=s},{allOwnKeys:n}),r),rH=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),nH=(r,e,i,n)=>{r.prototype=Object.create(e.prototype,n),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:e.prototype}),i&&Object.assign(r.prototype,i)},sH=(r,e,i,n)=>{let s,o,l;const u={};if(e=e||{},r==null)return e;do{for(s=Object.getOwnPropertyNames(r),o=s.length;o-- >0;)l=s[o],(!n||n(l,r,e))&&!u[l]&&(e[l]=r[l],u[l]=!0);r=i!==!1&&Gw(r)}while(r&&(!i||i(r,e))&&r!==Object.prototype);return e},aH=(r,e,i)=>{r=String(r),(i===void 0||i>r.length)&&(i=r.length),i-=e.length;const n=r.indexOf(e,i);return n!==-1&&n===i},oH=r=>{if(!r)return null;if(Df(r))return r;let e=r.length;if(!KL(e))return null;const i=new Array(e);for(;e-- >0;)i[e]=r[e];return i},lH=(r=>e=>r&&e instanceof r)(typeof Uint8Array<"u"&&Gw(Uint8Array)),cH=(r,e)=>{const n=(r&&r[zv]).call(r);let s;for(;(s=n.next())&&!s.done;){const o=s.value;e.call(r,o[0],o[1])}},uH=(r,e)=>{let i;const n=[];for(;(i=r.exec(e))!==null;)n.push(i);return n},hH=Yl("HTMLFormElement"),dH=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(i,n,s){return n.toUpperCase()+s}),$L=(({hasOwnProperty:r})=>(e,i)=>r.call(e,i))(Object.prototype),pH=Yl("RegExp"),eD=(r,e)=>{const i=Object.getOwnPropertyDescriptors(r),n={};D0(i,(s,o)=>{let l;(l=e(s,o,r))!==!1&&(n[o]=l||s)}),Object.defineProperties(r,n)},fH=r=>{eD(r,(e,i)=>{if(No(r)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const n=r[i];if(No(n)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")})}})},mH=(r,e)=>{const i={},n=s=>{s.forEach(o=>{i[o]=!0})};return Df(r)?n(r):n(String(r).split(e)),i},gH=()=>{},AH=(r,e)=>r!=null&&Number.isFinite(r=+r)?r:e;function yH(r){return!!(r&&No(r.append)&&r[XL]==="FormData"&&r[zv])}const vH=r=>{const e=new Array(10),i=(n,s)=>{if(Gv(n)){if(e.indexOf(n)>=0)return;if(!("toJSON"in n)){e[s]=n;const o=Df(n)?[]:{};return D0(n,(l,u)=>{const c=i(l,s+1);!L0(c)&&(o[u]=c)}),e[s]=void 0,o}}return n};return i(r,0)},bH=Yl("AsyncFunction"),xH=r=>r&&(Gv(r)||No(r))&&No(r.then)&&No(r.catch),tD=((r,e)=>r?setImmediate:e?((i,n)=>(Xd.addEventListener("message",({source:s,data:o})=>{s===Xd&&o===i&&n.length&&n.shift()()},!1),s=>{n.push(s),Xd.postMessage(i,"*")}))(`axios@${Math.random()}`,[]):i=>setTimeout(i))(typeof setImmediate=="function",No(Xd.postMessage)),_H=typeof queueMicrotask<"u"?queueMicrotask.bind(Xd):typeof process<"u"&&process.nextTick||tD,Ht={isArray:Df,isArrayBuffer:YL,isBuffer:zG,isFormData:YG,isArrayBufferView:jG,isString:VG,isNumber:KL,isBoolean:GG,isObject:Gv,isPlainObject:Hv,isReadableStream:JG,isRequest:ZG,isResponse:$G,isHeaders:eH,isUndefined:L0,isDate:HG,isFile:WG,isBlob:QG,isRegExp:pH,isFunction:No,isStream:XG,isURLSearchParams:KG,isTypedArray:lH,isFileList:qG,forEach:D0,merge:Hw,extend:iH,trim:tH,stripBOM:rH,inherits:nH,toFlatObject:sH,kindOf:jv,kindOfTest:Yl,endsWith:aH,toArray:oH,forEachEntry:cH,matchAll:uH,isHTMLForm:hH,hasOwnProperty:$L,hasOwnProp:$L,reduceDescriptors:eD,freezeMethods:fH,toObjectSet:mH,toCamelCase:dH,noop:gH,toFiniteNumber:AH,findKey:JL,global:Xd,isContextDefined:ZL,isSpecCompliantForm:yH,toJSONObject:vH,isAsyncFn:bH,isThenable:xH,setImmediate:tD,asap:_H,isIterable:r=>r!=null&&No(r[zv])};function $r(r,e,i,n,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",e&&(this.code=e),i&&(this.config=i),n&&(this.request=n),s&&(this.response=s,this.status=s.status?s.status:null)}Ht.inherits($r,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ht.toJSONObject(this.config),code:this.code,status:this.status}}});const iD=$r.prototype,rD={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{rD[r]={value:r}}),Object.defineProperties($r,rD),Object.defineProperty(iD,"isAxiosError",{value:!0}),$r.from=(r,e,i,n,s,o)=>{const l=Object.create(iD);return Ht.toFlatObject(r,l,function(c){return c!==Error.prototype},u=>u!=="isAxiosError"),$r.call(l,r.message,e,i,n,s),l.cause=r,l.name=r.name,o&&Object.assign(l,o),l};const EH=null;function Ww(r){return Ht.isPlainObject(r)||Ht.isArray(r)}function nD(r){return Ht.endsWith(r,"[]")?r.slice(0,-2):r}function sD(r,e,i){return r?r.concat(e).map(function(s,o){return s=nD(s),!i&&o?"["+s+"]":s}).join(i?".":""):e}function wH(r){return Ht.isArray(r)&&!r.some(Ww)}const CH=Ht.toFlatObject(Ht,{},null,function(e){return/^is[A-Z]/.test(e)});function Wv(r,e,i){if(!Ht.isObject(r))throw new TypeError("target must be an object");e=e||new FormData,i=Ht.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(b,v){return!Ht.isUndefined(v[b])});const n=i.metaTokens,s=i.visitor||p,o=i.dots,l=i.indexes,c=(i.Blob||typeof Blob<"u"&&Blob)&&Ht.isSpecCompliantForm(e);if(!Ht.isFunction(s))throw new TypeError("visitor must be a function");function h(y){if(y===null)return"";if(Ht.isDate(y))return y.toISOString();if(!c&&Ht.isBlob(y))throw new $r("Blob is not supported. Use a Buffer instead.");return Ht.isArrayBuffer(y)||Ht.isTypedArray(y)?c&&typeof Blob=="function"?new Blob([y]):Buffer.from(y):y}function p(y,b,v){let _=y;if(y&&!v&&typeof y=="object"){if(Ht.endsWith(b,"{}"))b=n?b:b.slice(0,-2),y=JSON.stringify(y);else if(Ht.isArray(y)&&wH(y)||(Ht.isFileList(y)||Ht.endsWith(b,"[]"))&&(_=Ht.toArray(y)))return b=nD(b),_.forEach(function(E,C){!(Ht.isUndefined(E)||E===null)&&e.append(l===!0?sD([b],C,o):l===null?b:b+"[]",h(E))}),!1}return Ww(y)?!0:(e.append(sD(v,b,o),h(y)),!1)}const f=[],g=Object.assign(CH,{defaultVisitor:p,convertValue:h,isVisitable:Ww});function m(y,b){if(!Ht.isUndefined(y)){if(f.indexOf(y)!==-1)throw Error("Circular reference detected in "+b.join("."));f.push(y),Ht.forEach(y,function(_,T){(!(Ht.isUndefined(_)||_===null)&&s.call(e,_,Ht.isString(T)?T.trim():T,b,g))===!0&&m(_,b?b.concat(T):[T])}),f.pop()}}if(!Ht.isObject(r))throw new TypeError("data must be an object");return m(r),e}function aD(r){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function Qw(r,e){this._pairs=[],r&&Wv(r,this,e)}const oD=Qw.prototype;oD.append=function(e,i){this._pairs.push([e,i])},oD.toString=function(e){const i=e?function(n){return e.call(this,n,aD)}:aD;return this._pairs.map(function(s){return i(s[0])+"="+i(s[1])},"").join("&")};function SH(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function lD(r,e,i){if(!e)return r;const n=i&&i.encode||SH;Ht.isFunction(i)&&(i={serialize:i});const s=i&&i.serialize;let o;if(s?o=s(e,i):o=Ht.isURLSearchParams(e)?e.toString():new Qw(e,i).toString(n),o){const l=r.indexOf("#");l!==-1&&(r=r.slice(0,l)),r+=(r.indexOf("?")===-1?"?":"&")+o}return r}class cD{constructor(){this.handlers=[]}use(e,i,n){return this.handlers.push({fulfilled:e,rejected:i,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Ht.forEach(this.handlers,function(n){n!==null&&e(n)})}}const uD={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},TH={isBrowser:!0,classes:{URLSearchParams:typeof URLSearchParams<"u"?URLSearchParams:Qw,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]},qw=typeof window<"u"&&typeof document<"u",Xw=typeof navigator=="object"&&navigator||void 0,MH=qw&&(!Xw||["ReactNative","NativeScript","NS"].indexOf(Xw.product)<0),RH=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",IH=qw&&window.location.href||"http://localhost",Xa={...Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:qw,hasStandardBrowserEnv:MH,hasStandardBrowserWebWorkerEnv:RH,navigator:Xw,origin:IH},Symbol.toStringTag,{value:"Module"})),...TH};function BH(r,e){return Wv(r,new Xa.classes.URLSearchParams,Object.assign({visitor:function(i,n,s,o){return Xa.isNode&&Ht.isBuffer(i)?(this.append(n,i.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},e))}function LH(r){return Ht.matchAll(/\w+|\[(\w*)]/g,r).map(e=>e[0]==="[]"?"":e[1]||e[0])}function DH(r){const e={},i=Object.keys(r);let n;const s=i.length;let o;for(n=0;n<s;n++)o=i[n],e[o]=r[o];return e}function hD(r){function e(i,n,s,o){let l=i[o++];if(l==="__proto__")return!0;const u=Number.isFinite(+l),c=o>=i.length;return l=!l&&Ht.isArray(s)?s.length:l,c?(Ht.hasOwnProp(s,l)?s[l]=[s[l],n]:s[l]=n,!u):((!s[l]||!Ht.isObject(s[l]))&&(s[l]=[]),e(i,n,s[l],o)&&Ht.isArray(s[l])&&(s[l]=DH(s[l])),!u)}if(Ht.isFormData(r)&&Ht.isFunction(r.entries)){const i={};return Ht.forEachEntry(r,(n,s)=>{e(LH(n),s,i,0)}),i}return null}function NH(r,e,i){if(Ht.isString(r))try{return(e||JSON.parse)(r),Ht.trim(r)}catch(n){if(n.name!=="SyntaxError")throw n}return(i||JSON.stringify)(r)}const N0={transitional:uD,adapter:["xhr","http","fetch"],transformRequest:[function(e,i){const n=i.getContentType()||"",s=n.indexOf("application/json")>-1,o=Ht.isObject(e);if(o&&Ht.isHTMLForm(e)&&(e=new FormData(e)),Ht.isFormData(e))return s?JSON.stringify(hD(e)):e;if(Ht.isArrayBuffer(e)||Ht.isBuffer(e)||Ht.isStream(e)||Ht.isFile(e)||Ht.isBlob(e)||Ht.isReadableStream(e))return e;if(Ht.isArrayBufferView(e))return e.buffer;if(Ht.isURLSearchParams(e))return i.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let u;if(o){if(n.indexOf("application/x-www-form-urlencoded")>-1)return BH(e,this.formSerializer).toString();if((u=Ht.isFileList(e))||n.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return Wv(u?{"files[]":e}:e,c&&new c,this.formSerializer)}}return o||s?(i.setContentType("application/json",!1),NH(e)):e}],transformResponse:[function(e){const i=this.transitional||N0.transitional,n=i&&i.forcedJSONParsing,s=this.responseType==="json";if(Ht.isResponse(e)||Ht.isReadableStream(e))return e;if(e&&Ht.isString(e)&&(n&&!this.responseType||s)){const l=!(i&&i.silentJSONParsing)&&s;try{return JSON.parse(e)}catch(u){if(l)throw u.name==="SyntaxError"?$r.from(u,$r.ERR_BAD_RESPONSE,this,null,this.response):u}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Xa.classes.FormData,Blob:Xa.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Ht.forEach(["delete","get","head","post","put","patch"],r=>{N0.headers[r]={}});const PH=Ht.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),OH=r=>{const e={};let i,n,s;return r&&r.split(`
`).forEach(function(l){s=l.indexOf(":"),i=l.substring(0,s).trim().toLowerCase(),n=l.substring(s+1).trim(),!(!i||e[i]&&PH[i])&&(i==="set-cookie"?e[i]?e[i].push(n):e[i]=[n]:e[i]=e[i]?e[i]+", "+n:n)}),e},dD=Symbol("internals");function P0(r){return r&&String(r).trim().toLowerCase()}function Qv(r){return r===!1||r==null?r:Ht.isArray(r)?r.map(Qv):String(r)}function kH(r){const e=Object.create(null),i=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=i.exec(r);)e[n[1]]=n[2];return e}const FH=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function Yw(r,e,i,n,s){if(Ht.isFunction(n))return n.call(this,e,i);if(s&&(e=i),!!Ht.isString(e)){if(Ht.isString(n))return e.indexOf(n)!==-1;if(Ht.isRegExp(n))return n.test(e)}}function UH(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,i,n)=>i.toUpperCase()+n)}function zH(r,e){const i=Ht.toCamelCase(" "+e);["get","set","has"].forEach(n=>{Object.defineProperty(r,n+i,{value:function(s,o,l){return this[n].call(this,e,s,o,l)},configurable:!0})})}let Po=class{constructor(e){e&&this.set(e)}set(e,i,n){const s=this;function o(u,c,h){const p=P0(c);if(!p)throw new Error("header name must be a non-empty string");const f=Ht.findKey(s,p);(!f||s[f]===void 0||h===!0||h===void 0&&s[f]!==!1)&&(s[f||c]=Qv(u))}const l=(u,c)=>Ht.forEach(u,(h,p)=>o(h,p,c));if(Ht.isPlainObject(e)||e instanceof this.constructor)l(e,i);else if(Ht.isString(e)&&(e=e.trim())&&!FH(e))l(OH(e),i);else if(Ht.isObject(e)&&Ht.isIterable(e)){let u={},c,h;for(const p of e){if(!Ht.isArray(p))throw TypeError("Object iterator must return a key-value pair");u[h=p[0]]=(c=u[h])?Ht.isArray(c)?[...c,p[1]]:[c,p[1]]:p[1]}l(u,i)}else e!=null&&o(i,e,n);return this}get(e,i){if(e=P0(e),e){const n=Ht.findKey(this,e);if(n){const s=this[n];if(!i)return s;if(i===!0)return kH(s);if(Ht.isFunction(i))return i.call(this,s,n);if(Ht.isRegExp(i))return i.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,i){if(e=P0(e),e){const n=Ht.findKey(this,e);return!!(n&&this[n]!==void 0&&(!i||Yw(this,this[n],n,i)))}return!1}delete(e,i){const n=this;let s=!1;function o(l){if(l=P0(l),l){const u=Ht.findKey(n,l);u&&(!i||Yw(n,n[u],u,i))&&(delete n[u],s=!0)}}return Ht.isArray(e)?e.forEach(o):o(e),s}clear(e){const i=Object.keys(this);let n=i.length,s=!1;for(;n--;){const o=i[n];(!e||Yw(this,this[o],o,e,!0))&&(delete this[o],s=!0)}return s}normalize(e){const i=this,n={};return Ht.forEach(this,(s,o)=>{const l=Ht.findKey(n,o);if(l){i[l]=Qv(s),delete i[o];return}const u=e?UH(o):String(o).trim();u!==o&&delete i[o],i[u]=Qv(s),n[u]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const i=Object.create(null);return Ht.forEach(this,(n,s)=>{n!=null&&n!==!1&&(i[s]=e&&Ht.isArray(n)?n.join(", "):n)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,i])=>e+": "+i).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...i){const n=new this(e);return i.forEach(s=>n.set(s)),n}static accessor(e){const n=(this[dD]=this[dD]={accessors:{}}).accessors,s=this.prototype;function o(l){const u=P0(l);n[u]||(zH(s,l),n[u]=!0)}return Ht.isArray(e)?e.forEach(o):o(e),this}};Po.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Ht.reduceDescriptors(Po.prototype,({value:r},e)=>{let i=e[0].toUpperCase()+e.slice(1);return{get:()=>r,set(n){this[i]=n}}}),Ht.freezeMethods(Po);function Kw(r,e){const i=this||N0,n=e||i,s=Po.from(n.headers);let o=n.data;return Ht.forEach(r,function(u){o=u.call(i,o,s.normalize(),e?e.status:void 0)}),s.normalize(),o}function pD(r){return!!(r&&r.__CANCEL__)}function Nf(r,e,i){$r.call(this,r??"canceled",$r.ERR_CANCELED,e,i),this.name="CanceledError"}Ht.inherits(Nf,$r,{__CANCEL__:!0});function fD(r,e,i){const n=i.config.validateStatus;!i.status||!n||n(i.status)?r(i):e(new $r("Request failed with status code "+i.status,[$r.ERR_BAD_REQUEST,$r.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i))}function jH(r){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return e&&e[1]||""}function VH(r,e){r=r||10;const i=new Array(r),n=new Array(r);let s=0,o=0,l;return e=e!==void 0?e:1e3,function(c){const h=Date.now(),p=n[o];l||(l=h),i[s]=c,n[s]=h;let f=o,g=0;for(;f!==s;)g+=i[f++],f=f%r;if(s=(s+1)%r,s===o&&(o=(o+1)%r),h-l<e)return;const m=p&&h-p;return m?Math.round(g*1e3/m):void 0}}function GH(r,e){let i=0,n=1e3/e,s,o;const l=(h,p=Date.now())=>{i=p,s=null,o&&(clearTimeout(o),o=null),r.apply(null,h)};return[(...h)=>{const p=Date.now(),f=p-i;f>=n?l(h,p):(s=h,o||(o=setTimeout(()=>{o=null,l(s)},n-f)))},()=>s&&l(s)]}const qv=(r,e,i=3)=>{let n=0;const s=VH(50,250);return GH(o=>{const l=o.loaded,u=o.lengthComputable?o.total:void 0,c=l-n,h=s(c),p=l<=u;n=l;const f={loaded:l,total:u,progress:u?l/u:void 0,bytes:c,rate:h||void 0,estimated:h&&u&&p?(u-l)/h:void 0,event:o,lengthComputable:u!=null,[e?"download":"upload"]:!0};r(f)},i)},mD=(r,e)=>{const i=r!=null;return[n=>e[0]({lengthComputable:i,total:r,loaded:n}),e[1]]},gD=r=>(...e)=>Ht.asap(()=>r(...e)),HH=Xa.hasStandardBrowserEnv?((r,e)=>i=>(i=new URL(i,Xa.origin),r.protocol===i.protocol&&r.host===i.host&&(e||r.port===i.port)))(new URL(Xa.origin),Xa.navigator&&/(msie|trident)/i.test(Xa.navigator.userAgent)):()=>!0,WH=Xa.hasStandardBrowserEnv?{write(r,e,i,n,s,o){const l=[r+"="+encodeURIComponent(e)];Ht.isNumber(i)&&l.push("expires="+new Date(i).toGMTString()),Ht.isString(n)&&l.push("path="+n),Ht.isString(s)&&l.push("domain="+s),o===!0&&l.push("secure"),document.cookie=l.join("; ")},read(r){const e=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(r){this.write(r,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function QH(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function qH(r,e){return e?r.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):r}function AD(r,e,i){let n=!QH(e);return r&&(n||i==!1)?qH(r,e):e}const yD=r=>r instanceof Po?{...r}:r;function Yd(r,e){e=e||{};const i={};function n(h,p,f,g){return Ht.isPlainObject(h)&&Ht.isPlainObject(p)?Ht.merge.call({caseless:g},h,p):Ht.isPlainObject(p)?Ht.merge({},p):Ht.isArray(p)?p.slice():p}function s(h,p,f,g){if(Ht.isUndefined(p)){if(!Ht.isUndefined(h))return n(void 0,h,f,g)}else return n(h,p,f,g)}function o(h,p){if(!Ht.isUndefined(p))return n(void 0,p)}function l(h,p){if(Ht.isUndefined(p)){if(!Ht.isUndefined(h))return n(void 0,h)}else return n(void 0,p)}function u(h,p,f){if(f in e)return n(h,p);if(f in r)return n(void 0,h)}const c={url:o,method:o,data:o,baseURL:l,transformRequest:l,transformResponse:l,paramsSerializer:l,timeout:l,timeoutMessage:l,withCredentials:l,withXSRFToken:l,adapter:l,responseType:l,xsrfCookieName:l,xsrfHeaderName:l,onUploadProgress:l,onDownloadProgress:l,decompress:l,maxContentLength:l,maxBodyLength:l,beforeRedirect:l,transport:l,httpAgent:l,httpsAgent:l,cancelToken:l,socketPath:l,responseEncoding:l,validateStatus:u,headers:(h,p,f)=>s(yD(h),yD(p),f,!0)};return Ht.forEach(Object.keys(Object.assign({},r,e)),function(p){const f=c[p]||s,g=f(r[p],e[p],p);Ht.isUndefined(g)&&f!==u||(i[p]=g)}),i}const vD=r=>{const e=Yd({},r);let{data:i,withXSRFToken:n,xsrfHeaderName:s,xsrfCookieName:o,headers:l,auth:u}=e;e.headers=l=Po.from(l),e.url=lD(AD(e.baseURL,e.url,e.allowAbsoluteUrls),r.params,r.paramsSerializer),u&&l.set("Authorization","Basic "+btoa((u.username||"")+":"+(u.password?unescape(encodeURIComponent(u.password)):"")));let c;if(Ht.isFormData(i)){if(Xa.hasStandardBrowserEnv||Xa.hasStandardBrowserWebWorkerEnv)l.setContentType(void 0);else if((c=l.getContentType())!==!1){const[h,...p]=c?c.split(";").map(f=>f.trim()).filter(Boolean):[];l.setContentType([h||"multipart/form-data",...p].join("; "))}}if(Xa.hasStandardBrowserEnv&&(n&&Ht.isFunction(n)&&(n=n(e)),n||n!==!1&&HH(e.url))){const h=s&&o&&WH.read(o);h&&l.set(s,h)}return e},XH=typeof XMLHttpRequest<"u"&&function(r){return new Promise(function(i,n){const s=vD(r);let o=s.data;const l=Po.from(s.headers).normalize();let{responseType:u,onUploadProgress:c,onDownloadProgress:h}=s,p,f,g,m,y;function b(){m&&m(),y&&y(),s.cancelToken&&s.cancelToken.unsubscribe(p),s.signal&&s.signal.removeEventListener("abort",p)}let v=new XMLHttpRequest;v.open(s.method.toUpperCase(),s.url,!0),v.timeout=s.timeout;function _(){if(!v)return;const E=Po.from("getAllResponseHeaders"in v&&v.getAllResponseHeaders()),R={data:!u||u==="text"||u==="json"?v.responseText:v.response,status:v.status,statusText:v.statusText,headers:E,config:r,request:v};fD(function(I){i(I),b()},function(I){n(I),b()},R),v=null}"onloadend"in v?v.onloadend=_:v.onreadystatechange=function(){!v||v.readyState!==4||v.status===0&&!(v.responseURL&&v.responseURL.indexOf("file:")===0)||setTimeout(_)},v.onabort=function(){v&&(n(new $r("Request aborted",$r.ECONNABORTED,r,v)),v=null)},v.onerror=function(){n(new $r("Network Error",$r.ERR_NETWORK,r,v)),v=null},v.ontimeout=function(){let C=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded";const R=s.transitional||uD;s.timeoutErrorMessage&&(C=s.timeoutErrorMessage),n(new $r(C,R.clarifyTimeoutError?$r.ETIMEDOUT:$r.ECONNABORTED,r,v)),v=null},o===void 0&&l.setContentType(null),"setRequestHeader"in v&&Ht.forEach(l.toJSON(),function(C,R){v.setRequestHeader(R,C)}),Ht.isUndefined(s.withCredentials)||(v.withCredentials=!!s.withCredentials),u&&u!=="json"&&(v.responseType=s.responseType),h&&([g,y]=qv(h,!0),v.addEventListener("progress",g)),c&&v.upload&&([f,m]=qv(c),v.upload.addEventListener("progress",f),v.upload.addEventListener("loadend",m)),(s.cancelToken||s.signal)&&(p=E=>{v&&(n(!E||E.type?new Nf(null,r,v):E),v.abort(),v=null)},s.cancelToken&&s.cancelToken.subscribe(p),s.signal&&(s.signal.aborted?p():s.signal.addEventListener("abort",p)));const T=jH(s.url);if(T&&Xa.protocols.indexOf(T)===-1){n(new $r("Unsupported protocol "+T+":",$r.ERR_BAD_REQUEST,r));return}v.send(o||null)})},YH=(r,e)=>{const{length:i}=r=r?r.filter(Boolean):[];if(e||i){let n=new AbortController,s;const o=function(h){if(!s){s=!0,u();const p=h instanceof Error?h:this.reason;n.abort(p instanceof $r?p:new Nf(p instanceof Error?p.message:p))}};let l=e&&setTimeout(()=>{l=null,o(new $r(`timeout ${e} of ms exceeded`,$r.ETIMEDOUT))},e);const u=()=>{r&&(l&&clearTimeout(l),l=null,r.forEach(h=>{h.unsubscribe?h.unsubscribe(o):h.removeEventListener("abort",o)}),r=null)};r.forEach(h=>h.addEventListener("abort",o));const{signal:c}=n;return c.unsubscribe=()=>Ht.asap(u),c}},KH=function*(r,e){let i=r.byteLength;if(i<e){yield r;return}let n=0,s;for(;n<i;)s=n+e,yield r.slice(n,s),n=s},JH=async function*(r,e){for await(const i of ZH(r))yield*KH(i,e)},ZH=async function*(r){if(r[Symbol.asyncIterator]){yield*r;return}const e=r.getReader();try{for(;;){const{done:i,value:n}=await e.read();if(i)break;yield n}}finally{await e.cancel()}},bD=(r,e,i,n)=>{const s=JH(r,e);let o=0,l,u=c=>{l||(l=!0,n&&n(c))};return new ReadableStream({async pull(c){try{const{done:h,value:p}=await s.next();if(h){u(),c.close();return}let f=p.byteLength;if(i){let g=o+=f;i(g)}c.enqueue(new Uint8Array(p))}catch(h){throw u(h),h}},cancel(c){return u(c),s.return()}},{highWaterMark:2})},Xv=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",xD=Xv&&typeof ReadableStream=="function",$H=Xv&&(typeof TextEncoder=="function"?(r=>e=>r.encode(e))(new TextEncoder):async r=>new Uint8Array(await new Response(r).arrayBuffer())),_D=(r,...e)=>{try{return!!r(...e)}catch{return!1}},eW=xD&&_D(()=>{let r=!1;const e=new Request(Xa.origin,{body:new ReadableStream,method:"POST",get duplex(){return r=!0,"half"}}).headers.has("Content-Type");return r&&!e}),ED=64*1024,Jw=xD&&_D(()=>Ht.isReadableStream(new Response("").body)),Yv={stream:Jw&&(r=>r.body)};Xv&&(r=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!Yv[e]&&(Yv[e]=Ht.isFunction(r[e])?i=>i[e]():(i,n)=>{throw new $r(`Response type '${e}' is not supported`,$r.ERR_NOT_SUPPORT,n)})})})(new Response);const tW=async r=>{if(r==null)return 0;if(Ht.isBlob(r))return r.size;if(Ht.isSpecCompliantForm(r))return(await new Request(Xa.origin,{method:"POST",body:r}).arrayBuffer()).byteLength;if(Ht.isArrayBufferView(r)||Ht.isArrayBuffer(r))return r.byteLength;if(Ht.isURLSearchParams(r)&&(r=r+""),Ht.isString(r))return(await $H(r)).byteLength},iW=async(r,e)=>{const i=Ht.toFiniteNumber(r.getContentLength());return i??tW(e)},Zw={http:EH,xhr:XH,fetch:Xv&&(async r=>{let{url:e,method:i,data:n,signal:s,cancelToken:o,timeout:l,onDownloadProgress:u,onUploadProgress:c,responseType:h,headers:p,withCredentials:f="same-origin",fetchOptions:g}=vD(r);h=h?(h+"").toLowerCase():"text";let m=YH([s,o&&o.toAbortSignal()],l),y;const b=m&&m.unsubscribe&&(()=>{m.unsubscribe()});let v;try{if(c&&eW&&i!=="get"&&i!=="head"&&(v=await iW(p,n))!==0){let R=new Request(e,{method:"POST",body:n,duplex:"half"}),B;if(Ht.isFormData(n)&&(B=R.headers.get("content-type"))&&p.setContentType(B),R.body){const[I,N]=mD(v,qv(gD(c)));n=bD(R.body,ED,I,N)}}Ht.isString(f)||(f=f?"include":"omit");const _="credentials"in Request.prototype;y=new Request(e,{...g,signal:m,method:i.toUpperCase(),headers:p.normalize().toJSON(),body:n,duplex:"half",credentials:_?f:void 0});let T=await fetch(y);const E=Jw&&(h==="stream"||h==="response");if(Jw&&(u||E&&b)){const R={};["status","statusText","headers"].forEach(D=>{R[D]=T[D]});const B=Ht.toFiniteNumber(T.headers.get("content-length")),[I,N]=u&&mD(B,qv(gD(u),!0))||[];T=new Response(bD(T.body,ED,I,()=>{N&&N(),b&&b()}),R)}h=h||"text";let C=await Yv[Ht.findKey(Yv,h)||"text"](T,r);return!E&&b&&b(),await new Promise((R,B)=>{fD(R,B,{data:C,headers:Po.from(T.headers),status:T.status,statusText:T.statusText,config:r,request:y})})}catch(_){throw b&&b(),_&&_.name==="TypeError"&&/Load failed|fetch/i.test(_.message)?Object.assign(new $r("Network Error",$r.ERR_NETWORK,r,y),{cause:_.cause||_}):$r.from(_,_&&_.code,r,y)}})};Ht.forEach(Zw,(r,e)=>{if(r){try{Object.defineProperty(r,"name",{value:e})}catch{}Object.defineProperty(r,"adapterName",{value:e})}});const wD=r=>`- ${r}`,rW=r=>Ht.isFunction(r)||r===null||r===!1,CD={getAdapter:r=>{r=Ht.isArray(r)?r:[r];const{length:e}=r;let i,n;const s={};for(let o=0;o<e;o++){i=r[o];let l;if(n=i,!rW(i)&&(n=Zw[(l=String(i)).toLowerCase()],n===void 0))throw new $r(`Unknown adapter '${l}'`);if(n)break;s[l||"#"+o]=n}if(!n){const o=Object.entries(s).map(([u,c])=>`adapter ${u} `+(c===!1?"is not supported by the environment":"is not available in the build"));let l=e?o.length>1?`since :
`+o.map(wD).join(`
`):" "+wD(o[0]):"as no adapter specified";throw new $r("There is no suitable adapter to dispatch the request "+l,"ERR_NOT_SUPPORT")}return n},adapters:Zw};function $w(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new Nf(null,r)}function SD(r){return $w(r),r.headers=Po.from(r.headers),r.data=Kw.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),CD.getAdapter(r.adapter||N0.adapter)(r).then(function(n){return $w(r),n.data=Kw.call(r,r.transformResponse,n),n.headers=Po.from(n.headers),n},function(n){return pD(n)||($w(r),n&&n.response&&(n.response.data=Kw.call(r,r.transformResponse,n.response),n.response.headers=Po.from(n.response.headers))),Promise.reject(n)})}const TD="1.9.0",Kv={};["object","boolean","number","function","string","symbol"].forEach((r,e)=>{Kv[r]=function(n){return typeof n===r||"a"+(e<1?"n ":" ")+r}});const MD={};Kv.transitional=function(e,i,n){function s(o,l){return"[Axios v"+TD+"] Transitional option '"+o+"'"+l+(n?". "+n:"")}return(o,l,u)=>{if(e===!1)throw new $r(s(l," has been removed"+(i?" in "+i:"")),$r.ERR_DEPRECATED);return i&&!MD[l]&&(MD[l]=!0,console.warn(s(l," has been deprecated since v"+i+" and will be removed in the near future"))),e?e(o,l,u):!0}},Kv.spelling=function(e){return(i,n)=>(console.warn(`${n} is likely a misspelling of ${e}`),!0)};function nW(r,e,i){if(typeof r!="object")throw new $r("options must be an object",$r.ERR_BAD_OPTION_VALUE);const n=Object.keys(r);let s=n.length;for(;s-- >0;){const o=n[s],l=e[o];if(l){const u=r[o],c=u===void 0||l(u,o,r);if(c!==!0)throw new $r("option "+o+" must be "+c,$r.ERR_BAD_OPTION_VALUE);continue}if(i!==!0)throw new $r("Unknown option "+o,$r.ERR_BAD_OPTION)}}const Jv={assertOptions:nW,validators:Kv},kc=Jv.validators;let Kd=class{constructor(e){this.defaults=e||{},this.interceptors={request:new cD,response:new cD}}async request(e,i){try{return await this._request(e,i)}catch(n){if(n instanceof Error){let s={};Error.captureStackTrace?Error.captureStackTrace(s):s=new Error;const o=s.stack?s.stack.replace(/^.+\n/,""):"";try{n.stack?o&&!String(n.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+o):n.stack=o}catch{}}throw n}}_request(e,i){typeof e=="string"?(i=i||{},i.url=e):i=e||{},i=Yd(this.defaults,i);const{transitional:n,paramsSerializer:s,headers:o}=i;n!==void 0&&Jv.assertOptions(n,{silentJSONParsing:kc.transitional(kc.boolean),forcedJSONParsing:kc.transitional(kc.boolean),clarifyTimeoutError:kc.transitional(kc.boolean)},!1),s!=null&&(Ht.isFunction(s)?i.paramsSerializer={serialize:s}:Jv.assertOptions(s,{encode:kc.function,serialize:kc.function},!0)),i.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?i.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:i.allowAbsoluteUrls=!0),Jv.assertOptions(i,{baseUrl:kc.spelling("baseURL"),withXsrfToken:kc.spelling("withXSRFToken")},!0),i.method=(i.method||this.defaults.method||"get").toLowerCase();let l=o&&Ht.merge(o.common,o[i.method]);o&&Ht.forEach(["delete","get","head","post","put","patch","common"],y=>{delete o[y]}),i.headers=Po.concat(l,o);const u=[];let c=!0;this.interceptors.request.forEach(function(b){typeof b.runWhen=="function"&&b.runWhen(i)===!1||(c=c&&b.synchronous,u.unshift(b.fulfilled,b.rejected))});const h=[];this.interceptors.response.forEach(function(b){h.push(b.fulfilled,b.rejected)});let p,f=0,g;if(!c){const y=[SD.bind(this),void 0];for(y.unshift.apply(y,u),y.push.apply(y,h),g=y.length,p=Promise.resolve(i);f<g;)p=p.then(y[f++],y[f++]);return p}g=u.length;let m=i;for(f=0;f<g;){const y=u[f++],b=u[f++];try{m=y(m)}catch(v){b.call(this,v);break}}try{p=SD.call(this,m)}catch(y){return Promise.reject(y)}for(f=0,g=h.length;f<g;)p=p.then(h[f++],h[f++]);return p}getUri(e){e=Yd(this.defaults,e);const i=AD(e.baseURL,e.url,e.allowAbsoluteUrls);return lD(i,e.params,e.paramsSerializer)}};Ht.forEach(["delete","get","head","options"],function(e){Kd.prototype[e]=function(i,n){return this.request(Yd(n||{},{method:e,url:i,data:(n||{}).data}))}}),Ht.forEach(["post","put","patch"],function(e){function i(n){return function(o,l,u){return this.request(Yd(u||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:o,data:l}))}}Kd.prototype[e]=i(),Kd.prototype[e+"Form"]=i(!0)});let sW=class vG{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let i;this.promise=new Promise(function(o){i=o});const n=this;this.promise.then(s=>{if(!n._listeners)return;let o=n._listeners.length;for(;o-- >0;)n._listeners[o](s);n._listeners=null}),this.promise.then=s=>{let o;const l=new Promise(u=>{n.subscribe(u),o=u}).then(s);return l.cancel=function(){n.unsubscribe(o)},l},e(function(o,l,u){n.reason||(n.reason=new Nf(o,l,u),i(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const i=this._listeners.indexOf(e);i!==-1&&this._listeners.splice(i,1)}toAbortSignal(){const e=new AbortController,i=n=>{e.abort(n)};return this.subscribe(i),e.signal.unsubscribe=()=>this.unsubscribe(i),e.signal}static source(){let e;return{token:new vG(function(s){e=s}),cancel:e}}};function aW(r){return function(i){return r.apply(null,i)}}function oW(r){return Ht.isObject(r)&&r.isAxiosError===!0}const e2={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(e2).forEach(([r,e])=>{e2[e]=r});function RD(r){const e=new Kd(r),i=qL(Kd.prototype.request,e);return Ht.extend(i,Kd.prototype,e,{allOwnKeys:!0}),Ht.extend(i,e,null,{allOwnKeys:!0}),i.create=function(s){return RD(Yd(r,s))},i}const Ms=RD(N0);Ms.Axios=Kd,Ms.CanceledError=Nf,Ms.CancelToken=sW,Ms.isCancel=pD,Ms.VERSION=TD,Ms.toFormData=Wv,Ms.AxiosError=$r,Ms.Cancel=Ms.CanceledError,Ms.all=function(e){return Promise.all(e)},Ms.spread=aW,Ms.isAxiosError=oW,Ms.mergeConfig=Yd,Ms.AxiosHeaders=Po,Ms.formToJSON=r=>hD(Ht.isHTMLForm(r)?new FormData(r):r),Ms.getAdapter=CD.getAdapter,Ms.HttpStatusCode=e2,Ms.default=Ms;const{Axios:R3e,AxiosError:I3e,CanceledError:B3e,isCancel:L3e,CancelToken:D3e,VERSION:N3e,all:P3e,Cancel:O3e,isAxiosError:k3e,spread:F3e,toFormData:U3e,AxiosHeaders:z3e,HttpStatusCode:j3e,formToJSON:V3e,getAdapter:G3e,mergeConfig:H3e}=Ms,t2=r=>{localStorage.setItem("auth_token",r)},Zv=()=>localStorage.getItem("auth_token"),O0=()=>!!Zv(),ID=()=>{localStorage.removeItem("auth_token")},i2=()=>{const r=Zv();return r?`Bearer ${r}`:""};let r2=null;const $v=()=>{if(!r2)throw new Error("Configuration Player-map non initialisée. Utilisez PlayerMapConfig.init() pour configurer la bibliothèque.");return{...r2}},lW=r=>{if(!r.apiUrl)throw new Error("L'URL de l'API est requise pour initialiser Player-map");r2={apiUrl:r.apiUrl}},cW=async r=>{try{const e=new FormData;if(e.append("file",r),!O0())throw new Error("Vous devez être connecté pour téléverser des fichiers");const{apiUrl:i}=$v(),n=`${i}/ipfs/upload_file`;return(await Ms.post(n,e,{headers:{"Content-Type":"multipart/form-data",Authorization:i2()}})).data.ipfs_url}catch(e){throw e instanceof Error&&e.message.includes("Configuration Player-map non initialisée")?(console.error("Erreur de configuration Player-map:",e.message),new Error("Erreur de configuration: Initialisez la bibliothèque Player-map avec PlayerMapConfig.init() avant utilisation")):(console.error("Erreur lors du téléversement vers le serveur:",e),new Error("Échec du téléversement de l'image vers IPFS"))}},BD=r=>r?r.startsWith("ipfs://"):!1,uW=async r=>{if(!BD(r))return r;try{let e=sessionStorage.getItem("ipfs_gateway");if(!e){if(!O0())throw new Error("Vous devez être connecté pour accéder à la passerelle IPFS");const{apiUrl:n}=$v();if(e=(await Ms.get(`${n}/ipfs/gateway_url`,{headers:{Authorization:i2()}})).data.gateway_url,e)sessionStorage.setItem("ipfs_gateway",e);else throw new Error("Aucune passerelle IPFS configurée")}const i=r.replace("ipfs://","");return`https://${e}/ipfs/${i}`}catch(e){throw e instanceof Error&&e.message.includes("Configuration Player-map non initialisée")?(console.error("Erreur de configuration Player-map:",e.message),new Error("Erreur de configuration: Initialisez la bibliothèque Player-map avec PlayerMapConfig.init() avant utilisation")):(console.error("Erreur lors de la récupération du gateway URL:",e),e)}},fs={IS_PLAYER_GAMES:{predicateId:164046n,objectId:32890n},IS_FAIRPLAY:{predicateId:877n,objectId:164047n},IS_STRONG_BOSS:{predicateId:877n,objectId:164048n},IS_STRONG_FIGHTER:{predicateId:877n,objectId:164049n},IS_PLAYER_GUILD:{predicateId:164046n,objectId:null}},hW=[{id:164062n,name:"The Alchemists"},{id:164063n,name:"Big Time Warriors"},{id:164065n,name:"The NEST"},{id:164066n,name:"Clock Work Gamers"},{id:164067n,name:"Vast Impact Gaming"},{id:164068n,name:"Kraken Gaming"},{id:164070n,name:"FAM"}],dW=({src:r})=>{const[e,i]=Ct.useState(r),[n,s]=Ct.useState(!0);return Ct.useEffect(()=>{(async()=>{s(!0);try{const l=pW(r)?fW(r):r;i(l)}catch(l){console.error("Error loading image:",l)}finally{s(!1)}})()},[r]),n?Et.jsx("div",{children:"Loading image..."}):Et.jsx("img",{src:e,alt:"Preview",style:{maxWidth:"100%",maxHeight:"150px",borderRadius:"5px"}})},pW=r=>r.startsWith("ipfs://"),fW=r=>r.replace("ipfs://","https://gateway.pinata.cloud/ipfs/"),mW=({step:r,isCreatingAtom:e,isCreatingTriples:i,creationSuccess:n,atomId:s,tripleCreated:o,walletAddress:l,hasExistingAtom:u,formData:c,handleInputChange:h,handleSelectChange:p,handleFileUpload:f,handleSubmit:g,isLoading:m,isUploading:y,fileInputRef:b})=>Et.jsxs(Et.Fragment,{children:[Et.jsxs("div",{style:{marginBottom:"20px"},children:[Et.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"10px"},children:[Et.jsxs("div",{style:{textAlign:"center",flex:1},children:[Et.jsx("div",{style:{width:"30px",height:"30px",borderRadius:"15px",backgroundColor:e||r>1?"#FFD32A":"#2e2e40",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto",color:e||r>1?"#000":"#fff"},children:r>1?"✓":"1"}),Et.jsx("p",{style:{fontSize:"0.8em",marginTop:"5px"},children:"Atom Creation"})]}),Et.jsxs("div",{style:{textAlign:"center",flex:1},children:[Et.jsx("div",{style:{width:"30px",height:"30px",borderRadius:"15px",backgroundColor:i||r>2?"#FFD32A":"#2e2e40",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto",color:i||r>2?"#000":"#fff"},children:r>2?"✓":"2"}),Et.jsx("p",{style:{fontSize:"0.8em",marginTop:"5px"},children:"Triples Creation"})]}),Et.jsxs("div",{style:{textAlign:"center",flex:1},children:[Et.jsx("div",{style:{width:"30px",height:"30px",borderRadius:"15px",backgroundColor:r===3?"#4CAF50":"#2e2e40",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto",color:r===3?"#000":"#fff"},children:r===3?"✓":"3"}),Et.jsx("p",{style:{fontSize:"0.8em",marginTop:"5px"},children:"Success"})]})]}),Et.jsx("div",{style:{height:"4px",backgroundColor:"#2e2e40",position:"relative",marginBottom:"20px"},children:Et.jsx("div",{style:{position:"absolute",left:0,top:0,height:"100%",width:`${(r-1)*50}%`,backgroundColor:"#FFD32A",transition:"width 0.3s ease"}})})]}),n?Et.jsxs("div",{style:{textAlign:"center",color:"#4CAF50"},children:[Et.jsx("h3",{style:{color:"#4CAF50",marginBottom:"10px"},children:"Success!"}),Et.jsx("p",{children:"Your player has been created successfully."}),Et.jsxs("p",{children:["Atom ID: ",s]}),Et.jsxs("p",{children:["Triples created: ",o?"Yes":"No"]}),Et.jsx("p",{children:"This window will close automatically..."})]}):l?u?Et.jsx("p",{style:{textAlign:"center",color:"#ff4444"},children:"You already have an atom associated with this wallet"}):Et.jsxs(Et.Fragment,{children:[Et.jsxs("div",{style:{marginBottom:"15px"},children:[Et.jsx("label",{style:{display:"block",marginBottom:"5px",fontSize:"0.9em",textAlign:"left"},children:"Pseudo"}),Et.jsx("input",{type:"text",name:"pseudo",value:c.pseudo,onChange:h,placeholder:"Enter your pseudo",style:{width:"100%",padding:"8px",backgroundColor:"#1e1e30",border:"1px solid #333",color:"#fff",borderRadius:"4px"}})]}),Et.jsxs("div",{style:{marginBottom:"15px"},children:[Et.jsx("label",{style:{display:"block",marginBottom:"5px",fontSize:"0.9em",textAlign:"left"},children:"User UID"}),Et.jsx("input",{type:"text",name:"userId",value:c.userId,onChange:h,placeholder:"Enter your BossFighters UID",style:{width:"100%",padding:"8px",backgroundColor:"#1e1e30",border:"1px solid #333",color:"#fff",borderRadius:"4px"}})]}),Et.jsxs("div",{style:{marginBottom:"15px"},children:[Et.jsx("label",{style:{display:"block",marginBottom:"5px",fontSize:"0.9em",textAlign:"left"},children:"Guild (Optional)"}),Et.jsxs("select",{name:"guildId",value:c.guildId||"",onChange:p,style:{width:"100%",padding:"8px",backgroundColor:"#1e1e30",border:"1px solid #333",color:"#fff",borderRadius:"4px"},children:[Et.jsx("option",{value:"",children:"Select a guild (optional)"}),hW.map(v=>Et.jsx("option",{value:v.id.toString(),children:v.name},v.id.toString()))]})]}),Et.jsxs("div",{style:{marginBottom:"15px"},children:[Et.jsx("label",{style:{display:"block",marginBottom:"5px",fontSize:"0.9em",textAlign:"left"},children:"Profile Picture (optional)"}),Et.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:[Et.jsxs("div",{children:[Et.jsx("button",{onClick:()=>{var v;return(v=b.current)==null?void 0:v.click()},style:{padding:"8px 15px",backgroundColor:"#2e2e40",color:"#fff",border:"1px solid #333",borderRadius:"4px",cursor:"pointer",marginRight:"10px"},disabled:y,children:y?"Upload in progress...":"Choose an image"}),Et.jsx("input",{ref:b,type:"file",accept:"image/*",onChange:f,style:{display:"none"}})]}),Et.jsx("p",{style:{fontSize:"0.8em",color:"#aaa",marginTop:"0px"},children:"This image will be used as your player's profile picture."}),c.image&&Et.jsxs("div",{style:{marginTop:"10px"},children:[Et.jsx("p",{style:{fontSize:"0.8em",color:"#aaa",marginBottom:"5px"},children:"Image preview:"}),Et.jsx(dW,{src:c.image})]})]})]}),Et.jsx("div",{style:{textAlign:"center"},children:Et.jsx("button",{onClick:g,disabled:m||y,style:{padding:"8px 20px",backgroundColor:"#FFD32A",color:"#000",border:"none",borderRadius:"5px",cursor:"pointer",fontWeight:"bold",opacity:m||y?.7:1},children:m?e?"Creating atom...":i?"Creating triples...":"Creating in progress...":"CREATE YOUR PLAYER"})})]}):Et.jsx("div",{children:Et.jsx("p",{style:{textAlign:"center",color:"#ff4444"},children:"Please connect your wallet first"})})]});function n2(r,{strict:e=!0}={}){return!r||typeof r!="string"?!1:e?/^0x[0-9a-fA-F]*$/.test(r):r.startsWith("0x")}function LD(r){return n2(r,{strict:!1})?Math.ceil((r.length-2)/2):r.length}const DD="2.29.2";let k0={getDocsUrl:({docsBaseUrl:r,docsPath:e="",docsSlug:i})=>e?`${r??"https://viem.sh"}${e}${i?`#${i}`:""}`:void 0,version:`viem@${DD}`};class Jd extends Error{constructor(e,i={}){var u;const n=(()=>{var c;return i.cause instanceof Jd?i.cause.details:(c=i.cause)!=null&&c.message?i.cause.message:i.details})(),s=i.cause instanceof Jd&&i.cause.docsPath||i.docsPath,o=(u=k0.getDocsUrl)==null?void 0:u.call(k0,{...i,docsPath:s}),l=[e||"An error occurred.","",...i.metaMessages?[...i.metaMessages,""]:[],...o?[`Docs: ${o}`]:[],...n?[`Details: ${n}`]:[],...k0.version?[`Version: ${k0.version}`]:[]].join(`
`);super(l,i.cause?{cause:i.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=n,this.docsPath=s,this.metaMessages=i.metaMessages,this.name=i.name??this.name,this.shortMessage=e,this.version=DD}walk(e){return ND(this,e)}}function ND(r,e){return e!=null&&e(r)?r:r&&typeof r=="object"&&"cause"in r&&r.cause!==void 0?ND(r.cause,e):e?null:r}class PD extends Jd{constructor({size:e,targetSize:i,type:n}){super(`${n.charAt(0).toUpperCase()}${n.slice(1).toLowerCase()} size (${e}) exceeds padding size (${i}).`,{name:"SizeExceedsPaddingSizeError"})}}function Pf(r,{dir:e,size:i=32}={}){return typeof r=="string"?gW(r,{dir:e,size:i}):AW(r,{dir:e,size:i})}function gW(r,{dir:e,size:i=32}={}){if(i===null)return r;const n=r.replace("0x","");if(n.length>i*2)throw new PD({size:Math.ceil(n.length/2),targetSize:i,type:"hex"});return`0x${n[e==="right"?"padEnd":"padStart"](i*2,"0")}`}function AW(r,{dir:e,size:i=32}={}){if(i===null)return r;if(r.length>i)throw new PD({size:r.length,targetSize:i,type:"bytes"});const n=new Uint8Array(i);for(let s=0;s<i;s++){const o=e==="right";n[o?s:i-s-1]=r[o?s:r.length-s-1]}return n}class yW extends Jd{constructor({max:e,min:i,signed:n,size:s,value:o}){super(`Number "${o}" is not in safe ${s?`${s*8}-bit ${n?"signed":"unsigned"} `:""}integer range ${e?`(${i} to ${e})`:`(above ${i})`}`,{name:"IntegerOutOfRangeError"})}}class vW extends Jd{constructor({givenSize:e,maxSize:i}){super(`Size cannot exceed ${i} bytes. Given size: ${e} bytes.`,{name:"SizeOverflowError"})}}function F0(r,{size:e}){if(LD(r)>e)throw new vW({givenSize:LD(r),maxSize:e})}const bW=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function OD(r,e={}){return typeof r=="number"||typeof r=="bigint"?FD(r,e):typeof r=="string"?EW(r,e):typeof r=="boolean"?xW(r,e):kD(r,e)}function xW(r,e={}){const i=`0x${Number(r)}`;return typeof e.size=="number"?(F0(i,{size:e.size}),Pf(i,{size:e.size})):i}function kD(r,e={}){let i="";for(let s=0;s<r.length;s++)i+=bW[r[s]];const n=`0x${i}`;return typeof e.size=="number"?(F0(n,{size:e.size}),Pf(n,{dir:"right",size:e.size})):n}function FD(r,e={}){const{signed:i,size:n}=e,s=BigInt(r);let o;n?i?o=(1n<<BigInt(n)*8n-1n)-1n:o=2n**(BigInt(n)*8n)-1n:typeof r=="number"&&(o=BigInt(Number.MAX_SAFE_INTEGER));const l=typeof o=="bigint"&&i?-o-1n:0;if(o&&s>o||s<l){const c=typeof r=="bigint"?"n":"";throw new yW({max:o?`${o}${c}`:void 0,min:`${l}${c}`,signed:i,size:n,value:`${r}${c}`})}const u=`0x${(i&&s<0?(1n<<BigInt(n*8))+BigInt(s):s).toString(16)}`;return n?Pf(u,{size:n}):u}const _W=new TextEncoder;function EW(r,e={}){const i=_W.encode(r);return kD(i,e)}const wW=new TextEncoder;function CW(r,e={}){return typeof r=="number"||typeof r=="bigint"?TW(r,e):typeof r=="boolean"?SW(r,e):n2(r)?zD(r,e):MW(r,e)}function SW(r,e={}){const i=new Uint8Array(1);return i[0]=Number(r),typeof e.size=="number"?(F0(i,{size:e.size}),Pf(i,{size:e.size})):i}const cu={zero:48,nine:57,A:65,F:70,a:97,f:102};function UD(r){if(r>=cu.zero&&r<=cu.nine)return r-cu.zero;if(r>=cu.A&&r<=cu.F)return r-(cu.A-10);if(r>=cu.a&&r<=cu.f)return r-(cu.a-10)}function zD(r,e={}){let i=r;e.size&&(F0(i,{size:e.size}),i=Pf(i,{dir:"right",size:e.size}));let n=i.slice(2);n.length%2&&(n=`0${n}`);const s=n.length/2,o=new Uint8Array(s);for(let l=0,u=0;l<s;l++){const c=UD(n.charCodeAt(u++)),h=UD(n.charCodeAt(u++));if(c===void 0||h===void 0)throw new Jd(`Invalid byte sequence ("${n[u-2]}${n[u-1]}" in "${n}").`);o[l]=c*16+h}return o}function TW(r,e){const i=FD(r,e);return zD(i)}function MW(r,e={}){const i=wW.encode(r);return typeof e.size=="number"?(F0(i,{size:e.size}),Pf(i,{dir:"right",size:e.size})):i}function jD(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function RW(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function s2(r,...e){if(!RW(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function VD(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function IW(r,e){s2(r);const i=e.outputLen;if(r.length<i)throw new Error("digestInto() expects output buffer of length at least "+i)}const eb=BigInt(2**32-1),GD=BigInt(32);function BW(r,e=!1){return e?{h:Number(r&eb),l:Number(r>>GD&eb)}:{h:Number(r>>GD&eb)|0,l:Number(r&eb)|0}}function LW(r,e=!1){let i=new Uint32Array(r.length),n=new Uint32Array(r.length);for(let s=0;s<r.length;s++){const{h:o,l}=BW(r[s],e);[i[s],n[s]]=[o,l]}return[i,n]}const DW=(r,e,i)=>r<<i|e>>>32-i,NW=(r,e,i)=>e<<i|r>>>32-i,PW=(r,e,i)=>e<<i-32|r>>>64-i,OW=(r,e,i)=>r<<i-32|e>>>64-i;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function kW(r){return new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4))}const HD=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function FW(r){return r<<24&4278190080|r<<8&16711680|r>>>8&65280|r>>>24&255}function WD(r){for(let e=0;e<r.length;e++)r[e]=FW(r[e])}typeof Uint8Array.from([]).toHex=="function"&&Uint8Array.fromHex;function UW(r){if(typeof r!="string")throw new Error("utf8ToBytes expected string, got "+typeof r);return new Uint8Array(new TextEncoder().encode(r))}function QD(r){return typeof r=="string"&&(r=UW(r)),s2(r),r}class zW{clone(){return this._cloneInto()}}function jW(r){const e=n=>r().update(QD(n)).digest(),i=r();return e.outputLen=i.outputLen,e.blockLen=i.blockLen,e.create=()=>r(),e}const qD=[],XD=[],YD=[],VW=BigInt(0),U0=BigInt(1),GW=BigInt(2),HW=BigInt(7),WW=BigInt(256),QW=BigInt(113);for(let r=0,e=U0,i=1,n=0;r<24;r++){[i,n]=[n,(2*i+3*n)%5],qD.push(2*(5*n+i)),XD.push((r+1)*(r+2)/2%64);let s=VW;for(let o=0;o<7;o++)e=(e<<U0^(e>>HW)*QW)%WW,e&GW&&(s^=U0<<(U0<<BigInt(o))-U0);YD.push(s)}const[qW,XW]=LW(YD,!0),KD=(r,e,i)=>i>32?PW(r,e,i):DW(r,e,i),JD=(r,e,i)=>i>32?OW(r,e,i):NW(r,e,i);function YW(r,e=24){const i=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let l=0;l<10;l++)i[l]=r[l]^r[l+10]^r[l+20]^r[l+30]^r[l+40];for(let l=0;l<10;l+=2){const u=(l+8)%10,c=(l+2)%10,h=i[c],p=i[c+1],f=KD(h,p,1)^i[u],g=JD(h,p,1)^i[u+1];for(let m=0;m<50;m+=10)r[l+m]^=f,r[l+m+1]^=g}let s=r[2],o=r[3];for(let l=0;l<24;l++){const u=XD[l],c=KD(s,o,u),h=JD(s,o,u),p=qD[l];s=r[p],o=r[p+1],r[p]=c,r[p+1]=h}for(let l=0;l<50;l+=10){for(let u=0;u<10;u++)i[u]=r[l+u];for(let u=0;u<10;u++)r[l+u]^=~i[(u+2)%10]&i[(u+4)%10]}r[0]^=qW[n],r[1]^=XW[n]}i.fill(0)}class a2 extends zW{constructor(e,i,n,s=!1,o=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=i,this.outputLen=n,this.enableXOF=s,this.rounds=o,jD(n),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=kW(this.state)}keccak(){HD||WD(this.state32),YW(this.state32,this.rounds),HD||WD(this.state32),this.posOut=0,this.pos=0}update(e){VD(this);const{blockLen:i,state:n}=this;e=QD(e);const s=e.length;for(let o=0;o<s;){const l=Math.min(i-this.pos,s-o);for(let u=0;u<l;u++)n[this.pos++]^=e[o++];this.pos===i&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:i,pos:n,blockLen:s}=this;e[n]^=i,i&128&&n===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){VD(this,!1),s2(e),this.finish();const i=this.state,{blockLen:n}=this;for(let s=0,o=e.length;s<o;){this.posOut>=n&&this.keccak();const l=Math.min(n-this.posOut,o-s);e.set(i.subarray(this.posOut,this.posOut+l),s),this.posOut+=l,s+=l}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return jD(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(IW(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:i,suffix:n,outputLen:s,rounds:o,enableXOF:l}=this;return e||(e=new a2(i,n,s,l,o)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=o,e.suffix=n,e.outputLen=s,e.enableXOF=l,e.destroyed=this.destroyed,e}}const KW=((r,e,i)=>jW(()=>new a2(e,r,i)))(1,136,256/8);function JW(r,e){const i=KW(n2(r,{strict:!1})?CW(r):r);return OD(i)}const ZW=async r=>{try{if(!O0())throw new Error("Vous devez être connecté pour envoyer des données à IPFS");const{apiUrl:e}=$v(),i=`${e}/ipfs/hash_data`,n=await Ms.post(i,{data:r},{headers:{"Content-Type":"application/json",Authorization:i2()}});return{ipfsHash:n.data.ipfs_hash,httpUrl:n.data.http_url}}catch(e){throw e instanceof Error&&e.message.includes("Configuration Player-map non initialisée")?(console.error("Erreur de configuration Player-map:",e.message),new Error("Erreur de configuration: Initialisez la bibliothèque Player-map avec PlayerMapConfig.init() avant utilisation")):(console.error("Erreur lors du hachage de données vers IPFS:",e),e)}},$W=({walletConnected:r,walletAddress:e,publicClient:i})=>({createAtom:async s=>{if(!r||!e)throw new Error("Wallet not connected");try{const o={"@context":"https://schema.org/","@type":"Thing",...s};o.image&&BD(o.image)&&(o.image=await uW(o.image));const{ipfsHash:l}=await ZW(o),u=OD(l),c=JW(u),h=i||r;if(h&&typeof h.readContract=="function")try{const g=await h.readContract({address:Pc,abi:Oc,functionName:"atomsByHash",args:[c]});if(g&&BigInt(g)!==0n)return{atomId:BigInt(g),ipfsHash:l}}catch(g){console.error("Error checking if atom exists:",g)}else console.warn("No valid read client with readContract method available");const p=await r.writeContract({address:Pc,abi:Oc,functionName:"createAtom",args:[u],value:kG});let f;if(r.waitForTransactionReceipt?f=await r.waitForTransactionReceipt({hash:p}):p.wait?f=await p.wait():await new Promise(g=>setTimeout(g,3e3)),h&&typeof h.readContract=="function")try{const g=await h.readContract({address:Pc,abi:Oc,functionName:"atomsByHash",args:[c]});return{atomId:BigInt(g),ipfsHash:l}}catch(g){if(console.error("Error reading new atom ID with readClient:",g),i&&i!==h&&typeof i.readContract=="function")try{const m=await i.readContract({address:Pc,abi:Oc,functionName:"atomsByHash",args:[c]});return{atomId:BigInt(m),ipfsHash:l}}catch(m){console.error("Failed second attempt to read atom ID:",m)}}else if(console.warn("No valid read client available to read the new atom ID"),i&&typeof i.readContract=="function")try{const g=await i.readContract({address:Pc,abi:Oc,functionName:"atomsByHash",args:[c]});return{atomId:BigInt(g),ipfsHash:l}}catch(g){console.error("Failed fallback attempt to read atom ID with publicClient:",g)}return console.warn("Using default atom ID as a fallback"),{atomId:1n,ipfsHash:l}}catch(o){throw console.error("Error creating atom:",o),o}}}),eQ=({walletConnected:r,walletAddress:e,publicClient:i})=>{const n=async(l,u,c)=>{if(!r||!e)throw new Error("Wallet not connected");try{const h=i||r;return!h||typeof h.readContract!="function"?(console.warn("No valid read client available to check if triple exists"),!1):await h.readContract({address:Pc,abi:Oc,functionName:"isTriple",args:[l,u,c]})}catch(h){if(console.error("Error checking if triple exists:",h),i&&i!==r&&typeof i.readContract=="function")try{return await i.readContract({address:Pc,abi:Oc,functionName:"isTriple",args:[l,u,c]})}catch(p){console.error("Second attempt failed when checking if triple exists:",p)}return!1}},s=async l=>{if(!r||!e)throw new Error("Wallet not connected");try{const u=l.map(g=>g.subjectId),c=l.map(g=>g.predicateId),h=l.map(g=>g.objectId),p=await r.writeContract({address:Pc,abi:Oc,functionName:"batchCreateTriple",args:[u,c,h],value:FG*BigInt(l.length)});let f;return r.waitForTransactionReceipt?f=await r.waitForTransactionReceipt({hash:p}):p.wait?f=await p.wait():await new Promise(g=>setTimeout(g,3e3)),{hash:typeof p=="string"?p:p.hash,receipt:f}}catch(u){throw console.error("Error batch creating triples:",u),u}};return{checkTripleExists:n,batchCreateTriple:s,createPlayerTriples:async l=>{const u=[{subjectId:l,predicateId:fs.IS_PLAYER_GAMES.predicateId,objectId:fs.IS_PLAYER_GAMES.objectId},{subjectId:l,predicateId:fs.IS_FAIRPLAY.predicateId,objectId:fs.IS_FAIRPLAY.objectId},{subjectId:l,predicateId:fs.IS_STRONG_BOSS.predicateId,objectId:fs.IS_STRONG_BOSS.objectId},{subjectId:l,predicateId:fs.IS_STRONG_FIGHTER.predicateId,objectId:fs.IS_STRONG_FIGHTER.objectId}];return s(u)}}},tQ=(r,e,i)=>{const{createAtom:n}=$W({walletConnected:r,walletAddress:e,publicClient:i}),{batchCreateTriple:s}=eQ({walletConnected:r,walletAddress:e,publicClient:i});return{createPlayer:async l=>{try{const u=await n({name:l.pseudo,description:l.userId,image:l.image}),c=u.atomId;await new Promise(h=>setTimeout(h,2e3));try{const h=[{subjectId:c,predicateId:fs.IS_PLAYER_GAMES.predicateId,objectId:fs.IS_PLAYER_GAMES.objectId},{subjectId:c,predicateId:fs.IS_FAIRPLAY.predicateId,objectId:fs.IS_FAIRPLAY.objectId},{subjectId:c,predicateId:fs.IS_STRONG_BOSS.predicateId,objectId:fs.IS_STRONG_BOSS.objectId},{subjectId:c,predicateId:fs.IS_STRONG_FIGHTER.predicateId,objectId:fs.IS_STRONG_FIGHTER.objectId}];l.guildId&&h.push({subjectId:c,predicateId:fs.IS_PLAYER_GUILD.predicateId,objectId:l.guildId});const p=await s(h);return{atomId:c,ipfsHash:u.ipfsHash,tripleCreated:!0,transactionHash:p.hash}}catch(h){return console.error("Erreur lors de la création des triples:",h),{atomId:c,ipfsHash:u.ipfsHash,tripleCreated:!1,transactionHash:void 0}}}catch(u){throw console.error("Erreur lors de la création du joueur:",u),u}}}},o2=({isOpen:r,onClose:e,walletConnected:i,walletAddress:n,wagmiConfig:s,walletHooks:o})=>{const[l,u]=Ct.useState({pseudo:"",userId:"",image:"",guildId:""}),[c,h]=Ct.useState(!1),[p,f]=Ct.useState(!1),[g,m]=Ct.useState(!1),[y,b]=Ct.useState(null),v=s==null?void 0:s.publicClient,[_,T]=Ct.useState(!1),E=Ct.useRef(null),[C,R]=Ct.useState(1),[B,I]=Ct.useState(!1),[N,D]=Ct.useState(!1),[P,k]=Ct.useState(!1),{createPlayer:q}=tQ(i,n||"",v);Ct.useEffect(()=>{(async()=>{if(!(!n||!i))try{const z=await i.readContract({address:Pc,abi:Oc,functionName:"balanceOf",args:[n]});h(z>0)}catch(z){console.error("Error checking atom balance:",z)}})()},[n,i]);const V=G=>{const{name:z,value:te}=G.target;u(Y=>({...Y,[z]:te}))},j=G=>{const{name:z,value:te}=G.target;u(Y=>({...Y,[z]:te}))},Q=async G=>{if(!G.target.files||G.target.files.length===0)return;const z=G.target.files[0];try{T(!0);const te=await cW(z);u(Y=>({...Y,image:te})),T(!1)}catch(te){console.error("Error uploading image:",te),alert("Error uploading image. Please try again."),T(!1)}},W=async()=>{if(!n||!i){alert("Please connect your wallet first");return}if(c){alert("You already have an atom!");return}if(!l.pseudo||!l.userId){alert("Please fill in all fields");return}try{f(!0),I(!0),R(1);const G=await q({pseudo:l.pseudo,userId:l.userId,image:l.image||void 0,guildId:l.guildId?BigInt(l.guildId):void 0});b(G.atomId.toString()),I(!1),R(2),D(!0),await new Promise(z=>setTimeout(z,1500)),D(!1),k(G.tripleCreated),R(3),m(!0),f(!1),setTimeout(()=>{e()},3e3)}catch(G){console.error("Error creating player:",G),alert("Error creating player. Please try again."),f(!1),I(!1),D(!1)}};return r?Et.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3},children:Et.jsxs("div",{style:{backgroundColor:"#101020",color:"#fff",padding:"30px",borderRadius:"10px",maxWidth:"760px",width:"90%",position:"relative",border:"1px solid #FFD32A"},children:[Et.jsx("div",{style:{position:"absolute",top:"40px",right:"10px",fontSize:"10px",color:"#666",textAlign:"left",backgroundColor:"rgba(0,0,0,0.3)",padding:"5px",borderRadius:"3px",maxWidth:"200px",overflow:"hidden"},children:Et.jsxs("div",{children:["Wallet:"," ",n?n.slice(0,6)+"..."+n.slice(-4):"Not connected"]})}),Et.jsx("button",{onClick:e,style:{position:"absolute",top:"10px",right:"10px",backgroundColor:"transparent",border:"none",fontSize:"20px",color:"#666",cursor:"pointer"},children:"×"}),Et.jsx("img",{src:QL,alt:"Intuition Logo",style:{width:"100px",marginBottom:"10px"}}),Et.jsx("h2",{style:{fontSize:"1.5em",margin:"0 0 20px 0",textAlign:"center"},children:"Create Your Player"}),Et.jsx(mW,{step:C,isCreatingAtom:B,isCreatingTriples:N,creationSuccess:g,atomId:y,tripleCreated:P,walletAddress:n,hasExistingAtom:c,formData:l,handleInputChange:V,handleSelectChange:j,handleFileUpload:Q,handleSubmit:W,isLoading:p,isUploading:_,fileInputRef:E})]})}):null};var iQ=Object.defineProperty,rQ=(r,e,i)=>e in r?iQ(r,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[e]=i,z0=(r,e,i)=>rQ(r,typeof e!="symbol"?e+"":e,i);function l2(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function c2(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var i=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};i.prototype=e.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var s=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(i,n,s.get?s:{enumerable:!0,get:function(){return r[n]}})}),i}var u2={exports:{}},j0={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ZD;function nQ(){if(ZD)return j0;ZD=1;var r=Ct,e=Symbol.for("react.element"),i=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function l(u,c,h){var p,f={},g=null,m=null;h!==void 0&&(g=""+h),c.key!==void 0&&(g=""+c.key),c.ref!==void 0&&(m=c.ref);for(p in c)n.call(c,p)&&!o.hasOwnProperty(p)&&(f[p]=c[p]);if(u&&u.defaultProps)for(p in c=u.defaultProps,c)f[p]===void 0&&(f[p]=c[p]);return{$$typeof:e,type:u,key:g,ref:m,props:f,_owner:s.current}}return j0.Fragment=i,j0.jsx=l,j0.jsxs=l,j0}var tb={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $D;function sQ(){return $D||($D=1,process.env.NODE_ENV!=="production"&&function(){var r=Ct,e=Symbol.for("react.element"),i=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),l=Symbol.for("react.provider"),u=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),p=Symbol.for("react.suspense_list"),f=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),m=Symbol.for("react.offscreen"),y=Symbol.iterator,b="@@iterator";function v(pe){if(pe===null||typeof pe!="object")return null;var ct=y&&pe[y]||pe[b];return typeof ct=="function"?ct:null}var _=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function T(pe){{for(var ct=arguments.length,Rt=new Array(ct>1?ct-1:0),Kt=1;Kt<ct;Kt++)Rt[Kt-1]=arguments[Kt];E("error",pe,Rt)}}function E(pe,ct,Rt){{var Kt=_.ReactDebugCurrentFrame,Bi=Kt.getStackAddendum();Bi!==""&&(ct+="%s",Rt=Rt.concat([Bi]));var sr=Rt.map(function(Di){return String(Di)});sr.unshift("Warning: "+ct),Function.prototype.apply.call(console[pe],console,sr)}}var C=!1,R=!1,B=!1,I=!1,N=!1,D;D=Symbol.for("react.module.reference");function P(pe){return!!(typeof pe=="string"||typeof pe=="function"||pe===n||pe===o||N||pe===s||pe===h||pe===p||I||pe===m||C||R||B||typeof pe=="object"&&pe!==null&&(pe.$$typeof===g||pe.$$typeof===f||pe.$$typeof===l||pe.$$typeof===u||pe.$$typeof===c||pe.$$typeof===D||pe.getModuleId!==void 0))}function k(pe,ct,Rt){var Kt=pe.displayName;if(Kt)return Kt;var Bi=ct.displayName||ct.name||"";return Bi!==""?Rt+"("+Bi+")":Rt}function q(pe){return pe.displayName||"Context"}function V(pe){if(pe==null)return null;if(typeof pe.tag=="number"&&T("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof pe=="function")return pe.displayName||pe.name||null;if(typeof pe=="string")return pe;switch(pe){case n:return"Fragment";case i:return"Portal";case o:return"Profiler";case s:return"StrictMode";case h:return"Suspense";case p:return"SuspenseList"}if(typeof pe=="object")switch(pe.$$typeof){case u:var ct=pe;return q(ct)+".Consumer";case l:var Rt=pe;return q(Rt._context)+".Provider";case c:return k(pe,pe.render,"ForwardRef");case f:var Kt=pe.displayName||null;return Kt!==null?Kt:V(pe.type)||"Memo";case g:{var Bi=pe,sr=Bi._payload,Di=Bi._init;try{return V(Di(sr))}catch{return null}}}return null}var j=Object.assign,Q=0,W,G,z,te,Y,se,ve;function Ae(){}Ae.__reactDisabledLog=!0;function me(){{if(Q===0){W=console.log,G=console.info,z=console.warn,te=console.error,Y=console.group,se=console.groupCollapsed,ve=console.groupEnd;var pe={configurable:!0,enumerable:!0,value:Ae,writable:!0};Object.defineProperties(console,{info:pe,log:pe,warn:pe,error:pe,group:pe,groupCollapsed:pe,groupEnd:pe})}Q++}}function Oe(){{if(Q--,Q===0){var pe={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:j({},pe,{value:W}),info:j({},pe,{value:G}),warn:j({},pe,{value:z}),error:j({},pe,{value:te}),group:j({},pe,{value:Y}),groupCollapsed:j({},pe,{value:se}),groupEnd:j({},pe,{value:ve})})}Q<0&&T("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var Xe=_.ReactCurrentDispatcher,Je;function it(pe,ct,Rt){{if(Je===void 0)try{throw Error()}catch(Bi){var Kt=Bi.stack.trim().match(/\n( *(at )?)/);Je=Kt&&Kt[1]||""}return`
`+Je+pe}}var dt=!1,St;{var Qt=typeof WeakMap=="function"?WeakMap:Map;St=new Qt}function yt(pe,ct){if(!pe||dt)return"";{var Rt=St.get(pe);if(Rt!==void 0)return Rt}var Kt;dt=!0;var Bi=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var sr;sr=Xe.current,Xe.current=null,me();try{if(ct){var Di=function(){throw Error()};if(Object.defineProperty(Di.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Di,[])}catch(lt){Kt=lt}Reflect.construct(pe,[],Di)}else{try{Di.call()}catch(lt){Kt=lt}pe.call(Di.prototype)}}else{try{throw Error()}catch(lt){Kt=lt}pe()}}catch(lt){if(lt&&Kt&&typeof lt.stack=="string"){for(var Oi=lt.stack.split(`
`),Be=Kt.stack.split(`
`),ae=Oi.length-1,fe=Be.length-1;ae>=1&&fe>=0&&Oi[ae]!==Be[fe];)fe--;for(;ae>=1&&fe>=0;ae--,fe--)if(Oi[ae]!==Be[fe]){if(ae!==1||fe!==1)do if(ae--,fe--,fe<0||Oi[ae]!==Be[fe]){var Le=`
`+Oi[ae].replace(" at new "," at ");return pe.displayName&&Le.includes("<anonymous>")&&(Le=Le.replace("<anonymous>",pe.displayName)),typeof pe=="function"&&St.set(pe,Le),Le}while(ae>=1&&fe>=0);break}}}finally{dt=!1,Xe.current=sr,Oe(),Error.prepareStackTrace=Bi}var Ue=pe?pe.displayName||pe.name:"",Ke=Ue?it(Ue):"";return typeof pe=="function"&&St.set(pe,Ke),Ke}function bi(pe,ct,Rt){return yt(pe,!1)}function $e(pe){var ct=pe.prototype;return!!(ct&&ct.isReactComponent)}function Fi(pe,ct,Rt){if(pe==null)return"";if(typeof pe=="function")return yt(pe,$e(pe));if(typeof pe=="string")return it(pe);switch(pe){case h:return it("Suspense");case p:return it("SuspenseList")}if(typeof pe=="object")switch(pe.$$typeof){case c:return bi(pe.render);case f:return Fi(pe.type,ct,Rt);case g:{var Kt=pe,Bi=Kt._payload,sr=Kt._init;try{return Fi(sr(Bi),ct,Rt)}catch{}}}return""}var ui=Object.prototype.hasOwnProperty,Si={},Ei=_.ReactDebugCurrentFrame;function Zi(pe){if(pe){var ct=pe._owner,Rt=Fi(pe.type,pe._source,ct?ct.type:null);Ei.setExtraStackFrame(Rt)}else Ei.setExtraStackFrame(null)}function Vi(pe,ct,Rt,Kt,Bi){{var sr=Function.call.bind(ui);for(var Di in pe)if(sr(pe,Di)){var Oi=void 0;try{if(typeof pe[Di]!="function"){var Be=Error((Kt||"React class")+": "+Rt+" type `"+Di+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof pe[Di]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw Be.name="Invariant Violation",Be}Oi=pe[Di](ct,Di,Kt,Rt,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(ae){Oi=ae}Oi&&!(Oi instanceof Error)&&(Zi(Bi),T("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",Kt||"React class",Rt,Di,typeof Oi),Zi(null)),Oi instanceof Error&&!(Oi.message in Si)&&(Si[Oi.message]=!0,Zi(Bi),T("Failed %s type: %s",Rt,Oi.message),Zi(null))}}}var We=Array.isArray;function Ce(pe){return We(pe)}function At(pe){{var ct=typeof Symbol=="function"&&Symbol.toStringTag,Rt=ct&&pe[Symbol.toStringTag]||pe.constructor.name||"Object";return Rt}}function Ot(pe){try{return Zt(pe),!1}catch{return!0}}function Zt(pe){return""+pe}function jt(pe){if(Ot(pe))return T("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",At(pe)),Zt(pe)}var xi=_.ReactCurrentOwner,vt={key:!0,ref:!0,__self:!0,__source:!0},ge,be;function Ne(pe){if(ui.call(pe,"ref")){var ct=Object.getOwnPropertyDescriptor(pe,"ref").get;if(ct&&ct.isReactWarning)return!1}return pe.ref!==void 0}function Se(pe){if(ui.call(pe,"key")){var ct=Object.getOwnPropertyDescriptor(pe,"key").get;if(ct&&ct.isReactWarning)return!1}return pe.key!==void 0}function Fe(pe,ct){typeof pe.ref=="string"&&xi.current}function Ie(pe,ct){{var Rt=function(){ge||(ge=!0,T("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",ct))};Rt.isReactWarning=!0,Object.defineProperty(pe,"key",{get:Rt,configurable:!0})}}function U(pe,ct){{var Rt=function(){be||(be=!0,T("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",ct))};Rt.isReactWarning=!0,Object.defineProperty(pe,"ref",{get:Rt,configurable:!0})}}var $=function(pe,ct,Rt,Kt,Bi,sr,Di){var Oi={$$typeof:e,type:pe,key:ct,ref:Rt,props:Di,_owner:sr};return Oi._store={},Object.defineProperty(Oi._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(Oi,"_self",{configurable:!1,enumerable:!1,writable:!1,value:Kt}),Object.defineProperty(Oi,"_source",{configurable:!1,enumerable:!1,writable:!1,value:Bi}),Object.freeze&&(Object.freeze(Oi.props),Object.freeze(Oi)),Oi};function re(pe,ct,Rt,Kt,Bi){{var sr,Di={},Oi=null,Be=null;Rt!==void 0&&(jt(Rt),Oi=""+Rt),Se(ct)&&(jt(ct.key),Oi=""+ct.key),Ne(ct)&&(Be=ct.ref,Fe(ct));for(sr in ct)ui.call(ct,sr)&&!vt.hasOwnProperty(sr)&&(Di[sr]=ct[sr]);if(pe&&pe.defaultProps){var ae=pe.defaultProps;for(sr in ae)Di[sr]===void 0&&(Di[sr]=ae[sr])}if(Oi||Be){var fe=typeof pe=="function"?pe.displayName||pe.name||"Unknown":pe;Oi&&Ie(Di,fe),Be&&U(Di,fe)}return $(pe,Oi,Be,Bi,Kt,xi.current,Di)}}var Me=_.ReactCurrentOwner,ce=_.ReactDebugCurrentFrame;function ze(pe){if(pe){var ct=pe._owner,Rt=Fi(pe.type,pe._source,ct?ct.type:null);ce.setExtraStackFrame(Rt)}else ce.setExtraStackFrame(null)}var Ve;Ve=!1;function pt(pe){return typeof pe=="object"&&pe!==null&&pe.$$typeof===e}function Dt(){{if(Me.current){var pe=V(Me.current.type);if(pe)return`

Check the render method of \``+pe+"`."}return""}}function xt(pe){return""}var Vt={};function fi(pe){{var ct=Dt();if(!ct){var Rt=typeof pe=="string"?pe:pe.displayName||pe.name;Rt&&(ct=`

Check the top-level render call using <`+Rt+">.")}return ct}}function xr(pe,ct){{if(!pe._store||pe._store.validated||pe.key!=null)return;pe._store.validated=!0;var Rt=fi(ct);if(Vt[Rt])return;Vt[Rt]=!0;var Kt="";pe&&pe._owner&&pe._owner!==Me.current&&(Kt=" It was passed a child from "+V(pe._owner.type)+"."),ze(pe),T('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',Rt,Kt),ze(null)}}function ki(pe,ct){{if(typeof pe!="object")return;if(Ce(pe))for(var Rt=0;Rt<pe.length;Rt++){var Kt=pe[Rt];pt(Kt)&&xr(Kt,ct)}else if(pt(pe))pe._store&&(pe._store.validated=!0);else if(pe){var Bi=v(pe);if(typeof Bi=="function"&&Bi!==pe.entries)for(var sr=Bi.call(pe),Di;!(Di=sr.next()).done;)pt(Di.value)&&xr(Di.value,ct)}}}function mn(pe){{var ct=pe.type;if(ct==null||typeof ct=="string")return;var Rt;if(typeof ct=="function")Rt=ct.propTypes;else if(typeof ct=="object"&&(ct.$$typeof===c||ct.$$typeof===f))Rt=ct.propTypes;else return;if(Rt){var Kt=V(ct);Vi(Rt,pe.props,"prop",Kt,pe)}else if(ct.PropTypes!==void 0&&!Ve){Ve=!0;var Bi=V(ct);T("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",Bi||"Unknown")}typeof ct.getDefaultProps=="function"&&!ct.getDefaultProps.isReactClassApproved&&T("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function kr(pe){{for(var ct=Object.keys(pe.props),Rt=0;Rt<ct.length;Rt++){var Kt=ct[Rt];if(Kt!=="children"&&Kt!=="key"){ze(pe),T("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",Kt),ze(null);break}}pe.ref!==null&&(ze(pe),T("Invalid attribute `ref` supplied to `React.Fragment`."),ze(null))}}var rn={};function vs(pe,ct,Rt,Kt,Bi,sr){{var Di=P(pe);if(!Di){var Oi="";(pe===void 0||typeof pe=="object"&&pe!==null&&Object.keys(pe).length===0)&&(Oi+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var Be=xt();Be?Oi+=Be:Oi+=Dt();var ae;pe===null?ae="null":Ce(pe)?ae="array":pe!==void 0&&pe.$$typeof===e?(ae="<"+(V(pe.type)||"Unknown")+" />",Oi=" Did you accidentally export a JSX literal instead of a component?"):ae=typeof pe,T("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",ae,Oi)}var fe=re(pe,ct,Rt,Bi,sr);if(fe==null)return fe;if(Di){var Le=ct.children;if(Le!==void 0)if(Kt)if(Ce(Le)){for(var Ue=0;Ue<Le.length;Ue++)ki(Le[Ue],pe);Object.freeze&&Object.freeze(Le)}else T("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else ki(Le,pe)}if(ui.call(ct,"key")){var Ke=V(pe),lt=Object.keys(ct).filter(function($t){return $t!=="key"}),Tt=lt.length>0?"{key: someKey, "+lt.join(": ..., ")+": ...}":"{key: someKey}";if(!rn[Ke+Tt]){var Yt=lt.length>0?"{"+lt.join(": ..., ")+": ...}":"{}";T(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,Tt,Ke,Yt,Ke),rn[Ke+Tt]=!0}}return pe===n?kr(fe):mn(fe),fe}}function gn(pe,ct,Rt){return vs(pe,ct,Rt,!0)}function Ls(pe,ct,Rt){return vs(pe,ct,Rt,!1)}var es=Ls,bs=gn;tb.Fragment=n,tb.jsx=es,tb.jsxs=bs}()),tb}process.env.NODE_ENV==="production"?u2.exports=nQ():u2.exports=sQ();var De=u2.exports;const Ps={SUBJECT:"#FFB300",PREDICATE:"#1976D2",OBJECT:"#43A047"},Of=r=>{switch(r){case"subject":return Ps.SUBJECT;case"predicate":return Ps.PREDICATE;case"object":return Ps.OBJECT;default:return"#444"}},eN=()=>De.jsxs("div",{style:{position:"absolute",bottom:80,right:30,zIndex:1e3,background:"#18181b",borderRadius:"10px",border:"2px solid #ffd32a",padding:"16px 24px",boxShadow:"0 8px 30px rgba(0, 0, 0, 0.5)"},children:[De.jsx("h4",{style:{margin:"0 0 16px 0",fontSize:"18px",color:"#ffd32a",fontWeight:"bold",letterSpacing:"0.5px"},children:"Graph Legend"}),De.jsxs("ul",{style:{listStyle:"none",padding:0,margin:0,display:"flex",flexDirection:"column",gap:"12px"},children:[De.jsxs("li",{style:{display:"flex",alignItems:"center",gap:"12px",color:"#fff"},children:[De.jsx("span",{style:{width:"20px",height:"20px",backgroundColor:Ps.SUBJECT,borderRadius:"50%",display:"inline-block",boxShadow:"0 2px 8px rgba(0,0,0,0.18)"}}),De.jsx("span",{style:{fontSize:"15px"},children:"Subject"})]}),De.jsxs("li",{style:{display:"flex",alignItems:"center",gap:"12px",color:"#fff"},children:[De.jsx("span",{style:{width:"20px",height:"20px",backgroundColor:Ps.OBJECT,borderRadius:"4px",display:"inline-block",boxShadow:"0 2px 8px rgba(0,0,0,0.18)"}}),De.jsx("span",{style:{fontSize:"15px"},children:"Object"})]}),De.jsxs("li",{style:{display:"flex",alignItems:"center",gap:"12px",color:"#fff"},children:[De.jsx("span",{style:{width:"24px",height:"12px",backgroundColor:Ps.PREDICATE,borderRadius:"4px",display:"inline-block",boxShadow:"0 2px 8px rgba(0,0,0,0.18)"}}),De.jsx("span",{style:{fontSize:"15px"},children:"Predicate"})]})]})]});var aQ={exports:{}};(function(r,e){(function(i,n){r.exports=n()})(self,()=>(()=>{var i={"./node_modules/an-array/index.js":l=>{var u=Object.prototype.toString;l.exports=c;function c(h){return h.BYTES_PER_ELEMENT&&u.call(h.buffer)==="[object ArrayBuffer]"||Array.isArray(h)}},"./node_modules/as-number/index.js":l=>{l.exports=function(u,c){return typeof u=="number"?u:typeof c=="number"?c:0}},"./node_modules/base64-js/index.js":(l,u)=>{u.byteLength=b,u.toByteArray=_,u.fromByteArray=C;for(var c=[],h=[],p=typeof Uint8Array<"u"?Uint8Array:Array,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",g=0,m=f.length;g<m;++g)c[g]=f[g],h[f.charCodeAt(g)]=g;h[45]=62,h[95]=63;function y(R){var B=R.length;if(B%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var I=R.indexOf("=");I===-1&&(I=B);var N=I===B?0:4-I%4;return[I,N]}function b(R){var B=y(R),I=B[0],N=B[1];return(I+N)*3/4-N}function v(R,B,I){return(B+I)*3/4-I}function _(R){var B,I=y(R),N=I[0],D=I[1],P=new p(v(R,N,D)),k=0,q=D>0?N-4:N,V;for(V=0;V<q;V+=4)B=h[R.charCodeAt(V)]<<18|h[R.charCodeAt(V+1)]<<12|h[R.charCodeAt(V+2)]<<6|h[R.charCodeAt(V+3)],P[k++]=B>>16&255,P[k++]=B>>8&255,P[k++]=B&255;return D===2&&(B=h[R.charCodeAt(V)]<<2|h[R.charCodeAt(V+1)]>>4,P[k++]=B&255),D===1&&(B=h[R.charCodeAt(V)]<<10|h[R.charCodeAt(V+1)]<<4|h[R.charCodeAt(V+2)]>>2,P[k++]=B>>8&255,P[k++]=B&255),P}function T(R){return c[R>>18&63]+c[R>>12&63]+c[R>>6&63]+c[R&63]}function E(R,B,I){for(var N,D=[],P=B;P<I;P+=3)N=(R[P]<<16&16711680)+(R[P+1]<<8&65280)+(R[P+2]&255),D.push(T(N));return D.join("")}function C(R){for(var B,I=R.length,N=I%3,D=[],P=16383,k=0,q=I-N;k<q;k+=P)D.push(E(R,k,k+P>q?q:k+P));return N===1?(B=R[I-1],D.push(c[B>>2]+c[B<<4&63]+"==")):N===2&&(B=(R[I-2]<<8)+R[I-1],D.push(c[B>>10]+c[B>>4&63]+c[B<<2&63]+"=")),D.join("")}},"./node_modules/buffer-equal/index.js":(l,u,c)=>{var h=c("./node_modules/buffer/index.js").Buffer;l.exports=function(p,f){if(h.isBuffer(p)&&h.isBuffer(f)){if(typeof p.equals=="function")return p.equals(f);if(p.length!==f.length)return!1;for(var g=0;g<p.length;g++)if(p[g]!==f[g])return!1;return!0}}},"./node_modules/buffer/index.js":(l,u,c)=>{/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */const h=c("./node_modules/base64-js/index.js"),p=c("./node_modules/ieee754/index.js"),f=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;u.Buffer=b,u.SlowBuffer=P,u.INSPECT_MAX_BYTES=50;const g=2147483647;u.kMaxLength=g,b.TYPED_ARRAY_SUPPORT=m(),!b.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function m(){try{const U=new Uint8Array(1),$={foo:function(){return 42}};return Object.setPrototypeOf($,Uint8Array.prototype),Object.setPrototypeOf(U,$),U.foo()===42}catch{return!1}}Object.defineProperty(b.prototype,"parent",{enumerable:!0,get:function(){if(b.isBuffer(this))return this.buffer}}),Object.defineProperty(b.prototype,"offset",{enumerable:!0,get:function(){if(b.isBuffer(this))return this.byteOffset}});function y(U){if(U>g)throw new RangeError('The value "'+U+'" is invalid for option "size"');const $=new Uint8Array(U);return Object.setPrototypeOf($,b.prototype),$}function b(U,$,re){if(typeof U=="number"){if(typeof $=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return E(U)}return v(U,$,re)}b.poolSize=8192;function v(U,$,re){if(typeof U=="string")return C(U,$);if(ArrayBuffer.isView(U))return B(U);if(U==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof U);if(be(U,ArrayBuffer)||U&&be(U.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(be(U,SharedArrayBuffer)||U&&be(U.buffer,SharedArrayBuffer)))return I(U,$,re);if(typeof U=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const Me=U.valueOf&&U.valueOf();if(Me!=null&&Me!==U)return b.from(Me,$,re);const ce=N(U);if(ce)return ce;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof U[Symbol.toPrimitive]=="function")return b.from(U[Symbol.toPrimitive]("string"),$,re);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof U)}b.from=function(U,$,re){return v(U,$,re)},Object.setPrototypeOf(b.prototype,Uint8Array.prototype),Object.setPrototypeOf(b,Uint8Array);function _(U){if(typeof U!="number")throw new TypeError('"size" argument must be of type number');if(U<0)throw new RangeError('The value "'+U+'" is invalid for option "size"')}function T(U,$,re){return _(U),U<=0?y(U):$!==void 0?typeof re=="string"?y(U).fill($,re):y(U).fill($):y(U)}b.alloc=function(U,$,re){return T(U,$,re)};function E(U){return _(U),y(U<0?0:D(U)|0)}b.allocUnsafe=function(U){return E(U)},b.allocUnsafeSlow=function(U){return E(U)};function C(U,$){if((typeof $!="string"||$==="")&&($="utf8"),!b.isEncoding($))throw new TypeError("Unknown encoding: "+$);const re=k(U,$)|0;let Me=y(re);const ce=Me.write(U,$);return ce!==re&&(Me=Me.slice(0,ce)),Me}function R(U){const $=U.length<0?0:D(U.length)|0,re=y($);for(let Me=0;Me<$;Me+=1)re[Me]=U[Me]&255;return re}function B(U){if(be(U,Uint8Array)){const $=new Uint8Array(U);return I($.buffer,$.byteOffset,$.byteLength)}return R(U)}function I(U,$,re){if($<0||U.byteLength<$)throw new RangeError('"offset" is outside of buffer bounds');if(U.byteLength<$+(re||0))throw new RangeError('"length" is outside of buffer bounds');let Me;return $===void 0&&re===void 0?Me=new Uint8Array(U):re===void 0?Me=new Uint8Array(U,$):Me=new Uint8Array(U,$,re),Object.setPrototypeOf(Me,b.prototype),Me}function N(U){if(b.isBuffer(U)){const $=D(U.length)|0,re=y($);return re.length===0||U.copy(re,0,0,$),re}if(U.length!==void 0)return typeof U.length!="number"||Ne(U.length)?y(0):R(U);if(U.type==="Buffer"&&Array.isArray(U.data))return R(U.data)}function D(U){if(U>=g)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+g.toString(16)+" bytes");return U|0}function P(U){return+U!=U&&(U=0),b.alloc(+U)}b.isBuffer=function(U){return U!=null&&U._isBuffer===!0&&U!==b.prototype},b.compare=function(U,$){if(be(U,Uint8Array)&&(U=b.from(U,U.offset,U.byteLength)),be($,Uint8Array)&&($=b.from($,$.offset,$.byteLength)),!b.isBuffer(U)||!b.isBuffer($))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(U===$)return 0;let re=U.length,Me=$.length;for(let ce=0,ze=Math.min(re,Me);ce<ze;++ce)if(U[ce]!==$[ce]){re=U[ce],Me=$[ce];break}return re<Me?-1:Me<re?1:0},b.isEncoding=function(U){switch(String(U).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},b.concat=function(U,$){if(!Array.isArray(U))throw new TypeError('"list" argument must be an Array of Buffers');if(U.length===0)return b.alloc(0);let re;if($===void 0)for($=0,re=0;re<U.length;++re)$+=U[re].length;const Me=b.allocUnsafe($);let ce=0;for(re=0;re<U.length;++re){let ze=U[re];if(be(ze,Uint8Array))ce+ze.length>Me.length?(b.isBuffer(ze)||(ze=b.from(ze)),ze.copy(Me,ce)):Uint8Array.prototype.set.call(Me,ze,ce);else if(b.isBuffer(ze))ze.copy(Me,ce);else throw new TypeError('"list" argument must be an Array of Buffers');ce+=ze.length}return Me};function k(U,$){if(b.isBuffer(U))return U.length;if(ArrayBuffer.isView(U)||be(U,ArrayBuffer))return U.byteLength;if(typeof U!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof U);const re=U.length,Me=arguments.length>2&&arguments[2]===!0;if(!Me&&re===0)return 0;let ce=!1;for(;;)switch($){case"ascii":case"latin1":case"binary":return re;case"utf8":case"utf-8":return Zt(U).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return re*2;case"hex":return re>>>1;case"base64":return vt(U).length;default:if(ce)return Me?-1:Zt(U).length;$=(""+$).toLowerCase(),ce=!0}}b.byteLength=k;function q(U,$,re){let Me=!1;if(($===void 0||$<0)&&($=0),$>this.length||((re===void 0||re>this.length)&&(re=this.length),re<=0)||(re>>>=0,$>>>=0,re<=$))return"";for(U||(U="utf8");;)switch(U){case"hex":return Je(this,$,re);case"utf8":case"utf-8":return ve(this,$,re);case"ascii":return Oe(this,$,re);case"latin1":case"binary":return Xe(this,$,re);case"base64":return se(this,$,re);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return it(this,$,re);default:if(Me)throw new TypeError("Unknown encoding: "+U);U=(U+"").toLowerCase(),Me=!0}}b.prototype._isBuffer=!0;function V(U,$,re){const Me=U[$];U[$]=U[re],U[re]=Me}b.prototype.swap16=function(){const U=this.length;if(U%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let $=0;$<U;$+=2)V(this,$,$+1);return this},b.prototype.swap32=function(){const U=this.length;if(U%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let $=0;$<U;$+=4)V(this,$,$+3),V(this,$+1,$+2);return this},b.prototype.swap64=function(){const U=this.length;if(U%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let $=0;$<U;$+=8)V(this,$,$+7),V(this,$+1,$+6),V(this,$+2,$+5),V(this,$+3,$+4);return this},b.prototype.toString=function(){const U=this.length;return U===0?"":arguments.length===0?ve(this,0,U):q.apply(this,arguments)},b.prototype.toLocaleString=b.prototype.toString,b.prototype.equals=function(U){if(!b.isBuffer(U))throw new TypeError("Argument must be a Buffer");return this===U?!0:b.compare(this,U)===0},b.prototype.inspect=function(){let U="";const $=u.INSPECT_MAX_BYTES;return U=this.toString("hex",0,$).replace(/(.{2})/g,"$1 ").trim(),this.length>$&&(U+=" ... "),"<Buffer "+U+">"},f&&(b.prototype[f]=b.prototype.inspect),b.prototype.compare=function(U,$,re,Me,ce){if(be(U,Uint8Array)&&(U=b.from(U,U.offset,U.byteLength)),!b.isBuffer(U))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof U);if($===void 0&&($=0),re===void 0&&(re=U?U.length:0),Me===void 0&&(Me=0),ce===void 0&&(ce=this.length),$<0||re>U.length||Me<0||ce>this.length)throw new RangeError("out of range index");if(Me>=ce&&$>=re)return 0;if(Me>=ce)return-1;if($>=re)return 1;if($>>>=0,re>>>=0,Me>>>=0,ce>>>=0,this===U)return 0;let ze=ce-Me,Ve=re-$;const pt=Math.min(ze,Ve),Dt=this.slice(Me,ce),xt=U.slice($,re);for(let Vt=0;Vt<pt;++Vt)if(Dt[Vt]!==xt[Vt]){ze=Dt[Vt],Ve=xt[Vt];break}return ze<Ve?-1:Ve<ze?1:0};function j(U,$,re,Me,ce){if(U.length===0)return-1;if(typeof re=="string"?(Me=re,re=0):re>2147483647?re=2147483647:re<-2147483648&&(re=-2147483648),re=+re,Ne(re)&&(re=ce?0:U.length-1),re<0&&(re=U.length+re),re>=U.length){if(ce)return-1;re=U.length-1}else if(re<0)if(ce)re=0;else return-1;if(typeof $=="string"&&($=b.from($,Me)),b.isBuffer($))return $.length===0?-1:Q(U,$,re,Me,ce);if(typeof $=="number")return $=$&255,typeof Uint8Array.prototype.indexOf=="function"?ce?Uint8Array.prototype.indexOf.call(U,$,re):Uint8Array.prototype.lastIndexOf.call(U,$,re):Q(U,[$],re,Me,ce);throw new TypeError("val must be string, number or Buffer")}function Q(U,$,re,Me,ce){let ze=1,Ve=U.length,pt=$.length;if(Me!==void 0&&(Me=String(Me).toLowerCase(),Me==="ucs2"||Me==="ucs-2"||Me==="utf16le"||Me==="utf-16le")){if(U.length<2||$.length<2)return-1;ze=2,Ve/=2,pt/=2,re/=2}function Dt(Vt,fi){return ze===1?Vt[fi]:Vt.readUInt16BE(fi*ze)}let xt;if(ce){let Vt=-1;for(xt=re;xt<Ve;xt++)if(Dt(U,xt)===Dt($,Vt===-1?0:xt-Vt)){if(Vt===-1&&(Vt=xt),xt-Vt+1===pt)return Vt*ze}else Vt!==-1&&(xt-=xt-Vt),Vt=-1}else for(re+pt>Ve&&(re=Ve-pt),xt=re;xt>=0;xt--){let Vt=!0;for(let fi=0;fi<pt;fi++)if(Dt(U,xt+fi)!==Dt($,fi)){Vt=!1;break}if(Vt)return xt}return-1}b.prototype.includes=function(U,$,re){return this.indexOf(U,$,re)!==-1},b.prototype.indexOf=function(U,$,re){return j(this,U,$,re,!0)},b.prototype.lastIndexOf=function(U,$,re){return j(this,U,$,re,!1)};function W(U,$,re,Me){re=Number(re)||0;const ce=U.length-re;Me?(Me=Number(Me),Me>ce&&(Me=ce)):Me=ce;const ze=$.length;Me>ze/2&&(Me=ze/2);let Ve;for(Ve=0;Ve<Me;++Ve){const pt=parseInt($.substr(Ve*2,2),16);if(Ne(pt))return Ve;U[re+Ve]=pt}return Ve}function G(U,$,re,Me){return ge(Zt($,U.length-re),U,re,Me)}function z(U,$,re,Me){return ge(jt($),U,re,Me)}function te(U,$,re,Me){return ge(vt($),U,re,Me)}function Y(U,$,re,Me){return ge(xi($,U.length-re),U,re,Me)}b.prototype.write=function(U,$,re,Me){if($===void 0)Me="utf8",re=this.length,$=0;else if(re===void 0&&typeof $=="string")Me=$,re=this.length,$=0;else if(isFinite($))$=$>>>0,isFinite(re)?(re=re>>>0,Me===void 0&&(Me="utf8")):(Me=re,re=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const ce=this.length-$;if((re===void 0||re>ce)&&(re=ce),U.length>0&&(re<0||$<0)||$>this.length)throw new RangeError("Attempt to write outside buffer bounds");Me||(Me="utf8");let ze=!1;for(;;)switch(Me){case"hex":return W(this,U,$,re);case"utf8":case"utf-8":return G(this,U,$,re);case"ascii":case"latin1":case"binary":return z(this,U,$,re);case"base64":return te(this,U,$,re);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Y(this,U,$,re);default:if(ze)throw new TypeError("Unknown encoding: "+Me);Me=(""+Me).toLowerCase(),ze=!0}},b.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function se(U,$,re){return $===0&&re===U.length?h.fromByteArray(U):h.fromByteArray(U.slice($,re))}function ve(U,$,re){re=Math.min(U.length,re);const Me=[];let ce=$;for(;ce<re;){const ze=U[ce];let Ve=null,pt=ze>239?4:ze>223?3:ze>191?2:1;if(ce+pt<=re){let Dt,xt,Vt,fi;switch(pt){case 1:ze<128&&(Ve=ze);break;case 2:Dt=U[ce+1],(Dt&192)===128&&(fi=(ze&31)<<6|Dt&63,fi>127&&(Ve=fi));break;case 3:Dt=U[ce+1],xt=U[ce+2],(Dt&192)===128&&(xt&192)===128&&(fi=(ze&15)<<12|(Dt&63)<<6|xt&63,fi>2047&&(fi<55296||fi>57343)&&(Ve=fi));break;case 4:Dt=U[ce+1],xt=U[ce+2],Vt=U[ce+3],(Dt&192)===128&&(xt&192)===128&&(Vt&192)===128&&(fi=(ze&15)<<18|(Dt&63)<<12|(xt&63)<<6|Vt&63,fi>65535&&fi<1114112&&(Ve=fi))}}Ve===null?(Ve=65533,pt=1):Ve>65535&&(Ve-=65536,Me.push(Ve>>>10&1023|55296),Ve=56320|Ve&1023),Me.push(Ve),ce+=pt}return me(Me)}const Ae=4096;function me(U){const $=U.length;if($<=Ae)return String.fromCharCode.apply(String,U);let re="",Me=0;for(;Me<$;)re+=String.fromCharCode.apply(String,U.slice(Me,Me+=Ae));return re}function Oe(U,$,re){let Me="";re=Math.min(U.length,re);for(let ce=$;ce<re;++ce)Me+=String.fromCharCode(U[ce]&127);return Me}function Xe(U,$,re){let Me="";re=Math.min(U.length,re);for(let ce=$;ce<re;++ce)Me+=String.fromCharCode(U[ce]);return Me}function Je(U,$,re){const Me=U.length;(!$||$<0)&&($=0),(!re||re<0||re>Me)&&(re=Me);let ce="";for(let ze=$;ze<re;++ze)ce+=Se[U[ze]];return ce}function it(U,$,re){const Me=U.slice($,re);let ce="";for(let ze=0;ze<Me.length-1;ze+=2)ce+=String.fromCharCode(Me[ze]+Me[ze+1]*256);return ce}b.prototype.slice=function(U,$){const re=this.length;U=~~U,$=$===void 0?re:~~$,U<0?(U+=re,U<0&&(U=0)):U>re&&(U=re),$<0?($+=re,$<0&&($=0)):$>re&&($=re),$<U&&($=U);const Me=this.subarray(U,$);return Object.setPrototypeOf(Me,b.prototype),Me};function dt(U,$,re){if(U%1!==0||U<0)throw new RangeError("offset is not uint");if(U+$>re)throw new RangeError("Trying to access beyond buffer length")}b.prototype.readUintLE=b.prototype.readUIntLE=function(U,$,re){U=U>>>0,$=$>>>0,re||dt(U,$,this.length);let Me=this[U],ce=1,ze=0;for(;++ze<$&&(ce*=256);)Me+=this[U+ze]*ce;return Me},b.prototype.readUintBE=b.prototype.readUIntBE=function(U,$,re){U=U>>>0,$=$>>>0,re||dt(U,$,this.length);let Me=this[U+--$],ce=1;for(;$>0&&(ce*=256);)Me+=this[U+--$]*ce;return Me},b.prototype.readUint8=b.prototype.readUInt8=function(U,$){return U=U>>>0,$||dt(U,1,this.length),this[U]},b.prototype.readUint16LE=b.prototype.readUInt16LE=function(U,$){return U=U>>>0,$||dt(U,2,this.length),this[U]|this[U+1]<<8},b.prototype.readUint16BE=b.prototype.readUInt16BE=function(U,$){return U=U>>>0,$||dt(U,2,this.length),this[U]<<8|this[U+1]},b.prototype.readUint32LE=b.prototype.readUInt32LE=function(U,$){return U=U>>>0,$||dt(U,4,this.length),(this[U]|this[U+1]<<8|this[U+2]<<16)+this[U+3]*16777216},b.prototype.readUint32BE=b.prototype.readUInt32BE=function(U,$){return U=U>>>0,$||dt(U,4,this.length),this[U]*16777216+(this[U+1]<<16|this[U+2]<<8|this[U+3])},b.prototype.readBigUInt64LE=Fe(function(U){U=U>>>0,We(U,"offset");const $=this[U],re=this[U+7];($===void 0||re===void 0)&&Ce(U,this.length-8);const Me=$+this[++U]*2**8+this[++U]*2**16+this[++U]*2**24,ce=this[++U]+this[++U]*2**8+this[++U]*2**16+re*2**24;return BigInt(Me)+(BigInt(ce)<<BigInt(32))}),b.prototype.readBigUInt64BE=Fe(function(U){U=U>>>0,We(U,"offset");const $=this[U],re=this[U+7];($===void 0||re===void 0)&&Ce(U,this.length-8);const Me=$*2**24+this[++U]*2**16+this[++U]*2**8+this[++U],ce=this[++U]*2**24+this[++U]*2**16+this[++U]*2**8+re;return(BigInt(Me)<<BigInt(32))+BigInt(ce)}),b.prototype.readIntLE=function(U,$,re){U=U>>>0,$=$>>>0,re||dt(U,$,this.length);let Me=this[U],ce=1,ze=0;for(;++ze<$&&(ce*=256);)Me+=this[U+ze]*ce;return ce*=128,Me>=ce&&(Me-=Math.pow(2,8*$)),Me},b.prototype.readIntBE=function(U,$,re){U=U>>>0,$=$>>>0,re||dt(U,$,this.length);let Me=$,ce=1,ze=this[U+--Me];for(;Me>0&&(ce*=256);)ze+=this[U+--Me]*ce;return ce*=128,ze>=ce&&(ze-=Math.pow(2,8*$)),ze},b.prototype.readInt8=function(U,$){return U=U>>>0,$||dt(U,1,this.length),this[U]&128?(255-this[U]+1)*-1:this[U]},b.prototype.readInt16LE=function(U,$){U=U>>>0,$||dt(U,2,this.length);const re=this[U]|this[U+1]<<8;return re&32768?re|4294901760:re},b.prototype.readInt16BE=function(U,$){U=U>>>0,$||dt(U,2,this.length);const re=this[U+1]|this[U]<<8;return re&32768?re|4294901760:re},b.prototype.readInt32LE=function(U,$){return U=U>>>0,$||dt(U,4,this.length),this[U]|this[U+1]<<8|this[U+2]<<16|this[U+3]<<24},b.prototype.readInt32BE=function(U,$){return U=U>>>0,$||dt(U,4,this.length),this[U]<<24|this[U+1]<<16|this[U+2]<<8|this[U+3]},b.prototype.readBigInt64LE=Fe(function(U){U=U>>>0,We(U,"offset");const $=this[U],re=this[U+7];($===void 0||re===void 0)&&Ce(U,this.length-8);const Me=this[U+4]+this[U+5]*2**8+this[U+6]*2**16+(re<<24);return(BigInt(Me)<<BigInt(32))+BigInt($+this[++U]*256+this[++U]*65536+this[++U]*16777216)}),b.prototype.readBigInt64BE=Fe(function(U){U=U>>>0,We(U,"offset");const $=this[U],re=this[U+7];($===void 0||re===void 0)&&Ce(U,this.length-8);const Me=($<<24)+this[++U]*2**16+this[++U]*2**8+this[++U];return(BigInt(Me)<<BigInt(32))+BigInt(this[++U]*16777216+this[++U]*65536+this[++U]*256+re)}),b.prototype.readFloatLE=function(U,$){return U=U>>>0,$||dt(U,4,this.length),p.read(this,U,!0,23,4)},b.prototype.readFloatBE=function(U,$){return U=U>>>0,$||dt(U,4,this.length),p.read(this,U,!1,23,4)},b.prototype.readDoubleLE=function(U,$){return U=U>>>0,$||dt(U,8,this.length),p.read(this,U,!0,52,8)},b.prototype.readDoubleBE=function(U,$){return U=U>>>0,$||dt(U,8,this.length),p.read(this,U,!1,52,8)};function St(U,$,re,Me,ce,ze){if(!b.isBuffer(U))throw new TypeError('"buffer" argument must be a Buffer instance');if($>ce||$<ze)throw new RangeError('"value" argument is out of bounds');if(re+Me>U.length)throw new RangeError("Index out of range")}b.prototype.writeUintLE=b.prototype.writeUIntLE=function(U,$,re,Me){if(U=+U,$=$>>>0,re=re>>>0,!Me){const Ve=Math.pow(2,8*re)-1;St(this,U,$,re,Ve,0)}let ce=1,ze=0;for(this[$]=U&255;++ze<re&&(ce*=256);)this[$+ze]=U/ce&255;return $+re},b.prototype.writeUintBE=b.prototype.writeUIntBE=function(U,$,re,Me){if(U=+U,$=$>>>0,re=re>>>0,!Me){const Ve=Math.pow(2,8*re)-1;St(this,U,$,re,Ve,0)}let ce=re-1,ze=1;for(this[$+ce]=U&255;--ce>=0&&(ze*=256);)this[$+ce]=U/ze&255;return $+re},b.prototype.writeUint8=b.prototype.writeUInt8=function(U,$,re){return U=+U,$=$>>>0,re||St(this,U,$,1,255,0),this[$]=U&255,$+1},b.prototype.writeUint16LE=b.prototype.writeUInt16LE=function(U,$,re){return U=+U,$=$>>>0,re||St(this,U,$,2,65535,0),this[$]=U&255,this[$+1]=U>>>8,$+2},b.prototype.writeUint16BE=b.prototype.writeUInt16BE=function(U,$,re){return U=+U,$=$>>>0,re||St(this,U,$,2,65535,0),this[$]=U>>>8,this[$+1]=U&255,$+2},b.prototype.writeUint32LE=b.prototype.writeUInt32LE=function(U,$,re){return U=+U,$=$>>>0,re||St(this,U,$,4,4294967295,0),this[$+3]=U>>>24,this[$+2]=U>>>16,this[$+1]=U>>>8,this[$]=U&255,$+4},b.prototype.writeUint32BE=b.prototype.writeUInt32BE=function(U,$,re){return U=+U,$=$>>>0,re||St(this,U,$,4,4294967295,0),this[$]=U>>>24,this[$+1]=U>>>16,this[$+2]=U>>>8,this[$+3]=U&255,$+4};function Qt(U,$,re,Me,ce){Vi($,Me,ce,U,re,7);let ze=Number($&BigInt(4294967295));U[re++]=ze,ze=ze>>8,U[re++]=ze,ze=ze>>8,U[re++]=ze,ze=ze>>8,U[re++]=ze;let Ve=Number($>>BigInt(32)&BigInt(4294967295));return U[re++]=Ve,Ve=Ve>>8,U[re++]=Ve,Ve=Ve>>8,U[re++]=Ve,Ve=Ve>>8,U[re++]=Ve,re}function yt(U,$,re,Me,ce){Vi($,Me,ce,U,re,7);let ze=Number($&BigInt(4294967295));U[re+7]=ze,ze=ze>>8,U[re+6]=ze,ze=ze>>8,U[re+5]=ze,ze=ze>>8,U[re+4]=ze;let Ve=Number($>>BigInt(32)&BigInt(4294967295));return U[re+3]=Ve,Ve=Ve>>8,U[re+2]=Ve,Ve=Ve>>8,U[re+1]=Ve,Ve=Ve>>8,U[re]=Ve,re+8}b.prototype.writeBigUInt64LE=Fe(function(U,$=0){return Qt(this,U,$,BigInt(0),BigInt("0xffffffffffffffff"))}),b.prototype.writeBigUInt64BE=Fe(function(U,$=0){return yt(this,U,$,BigInt(0),BigInt("0xffffffffffffffff"))}),b.prototype.writeIntLE=function(U,$,re,Me){if(U=+U,$=$>>>0,!Me){const pt=Math.pow(2,8*re-1);St(this,U,$,re,pt-1,-pt)}let ce=0,ze=1,Ve=0;for(this[$]=U&255;++ce<re&&(ze*=256);)U<0&&Ve===0&&this[$+ce-1]!==0&&(Ve=1),this[$+ce]=(U/ze>>0)-Ve&255;return $+re},b.prototype.writeIntBE=function(U,$,re,Me){if(U=+U,$=$>>>0,!Me){const pt=Math.pow(2,8*re-1);St(this,U,$,re,pt-1,-pt)}let ce=re-1,ze=1,Ve=0;for(this[$+ce]=U&255;--ce>=0&&(ze*=256);)U<0&&Ve===0&&this[$+ce+1]!==0&&(Ve=1),this[$+ce]=(U/ze>>0)-Ve&255;return $+re},b.prototype.writeInt8=function(U,$,re){return U=+U,$=$>>>0,re||St(this,U,$,1,127,-128),U<0&&(U=255+U+1),this[$]=U&255,$+1},b.prototype.writeInt16LE=function(U,$,re){return U=+U,$=$>>>0,re||St(this,U,$,2,32767,-32768),this[$]=U&255,this[$+1]=U>>>8,$+2},b.prototype.writeInt16BE=function(U,$,re){return U=+U,$=$>>>0,re||St(this,U,$,2,32767,-32768),this[$]=U>>>8,this[$+1]=U&255,$+2},b.prototype.writeInt32LE=function(U,$,re){return U=+U,$=$>>>0,re||St(this,U,$,4,2147483647,-2147483648),this[$]=U&255,this[$+1]=U>>>8,this[$+2]=U>>>16,this[$+3]=U>>>24,$+4},b.prototype.writeInt32BE=function(U,$,re){return U=+U,$=$>>>0,re||St(this,U,$,4,2147483647,-2147483648),U<0&&(U=4294967295+U+1),this[$]=U>>>24,this[$+1]=U>>>16,this[$+2]=U>>>8,this[$+3]=U&255,$+4},b.prototype.writeBigInt64LE=Fe(function(U,$=0){return Qt(this,U,$,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),b.prototype.writeBigInt64BE=Fe(function(U,$=0){return yt(this,U,$,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function bi(U,$,re,Me,ce,ze){if(re+Me>U.length)throw new RangeError("Index out of range");if(re<0)throw new RangeError("Index out of range")}function $e(U,$,re,Me,ce){return $=+$,re=re>>>0,ce||bi(U,$,re,4),p.write(U,$,re,Me,23,4),re+4}b.prototype.writeFloatLE=function(U,$,re){return $e(this,U,$,!0,re)},b.prototype.writeFloatBE=function(U,$,re){return $e(this,U,$,!1,re)};function Fi(U,$,re,Me,ce){return $=+$,re=re>>>0,ce||bi(U,$,re,8),p.write(U,$,re,Me,52,8),re+8}b.prototype.writeDoubleLE=function(U,$,re){return Fi(this,U,$,!0,re)},b.prototype.writeDoubleBE=function(U,$,re){return Fi(this,U,$,!1,re)},b.prototype.copy=function(U,$,re,Me){if(!b.isBuffer(U))throw new TypeError("argument should be a Buffer");if(re||(re=0),!Me&&Me!==0&&(Me=this.length),$>=U.length&&($=U.length),$||($=0),Me>0&&Me<re&&(Me=re),Me===re||U.length===0||this.length===0)return 0;if($<0)throw new RangeError("targetStart out of bounds");if(re<0||re>=this.length)throw new RangeError("Index out of range");if(Me<0)throw new RangeError("sourceEnd out of bounds");Me>this.length&&(Me=this.length),U.length-$<Me-re&&(Me=U.length-$+re);const ce=Me-re;return this===U&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin($,re,Me):Uint8Array.prototype.set.call(U,this.subarray(re,Me),$),ce},b.prototype.fill=function(U,$,re,Me){if(typeof U=="string"){if(typeof $=="string"?(Me=$,$=0,re=this.length):typeof re=="string"&&(Me=re,re=this.length),Me!==void 0&&typeof Me!="string")throw new TypeError("encoding must be a string");if(typeof Me=="string"&&!b.isEncoding(Me))throw new TypeError("Unknown encoding: "+Me);if(U.length===1){const ze=U.charCodeAt(0);(Me==="utf8"&&ze<128||Me==="latin1")&&(U=ze)}}else typeof U=="number"?U=U&255:typeof U=="boolean"&&(U=Number(U));if($<0||this.length<$||this.length<re)throw new RangeError("Out of range index");if(re<=$)return this;$=$>>>0,re=re===void 0?this.length:re>>>0,U||(U=0);let ce;if(typeof U=="number")for(ce=$;ce<re;++ce)this[ce]=U;else{const ze=b.isBuffer(U)?U:b.from(U,Me),Ve=ze.length;if(Ve===0)throw new TypeError('The value "'+U+'" is invalid for argument "value"');for(ce=0;ce<re-$;++ce)this[ce+$]=ze[ce%Ve]}return this};const ui={};function Si(U,$,re){ui[U]=class extends re{constructor(){super(),Object.defineProperty(this,"message",{value:$.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${U}]`,this.stack,delete this.name}get code(){return U}set code(Me){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:Me,writable:!0})}toString(){return`${this.name} [${U}]: ${this.message}`}}}Si("ERR_BUFFER_OUT_OF_BOUNDS",function(U){return U?`${U} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Si("ERR_INVALID_ARG_TYPE",function(U,$){return`The "${U}" argument must be of type number. Received type ${typeof $}`},TypeError),Si("ERR_OUT_OF_RANGE",function(U,$,re){let Me=`The value of "${U}" is out of range.`,ce=re;return Number.isInteger(re)&&Math.abs(re)>4294967296?ce=Ei(String(re)):typeof re=="bigint"&&(ce=String(re),(re>BigInt(2)**BigInt(32)||re<-(BigInt(2)**BigInt(32)))&&(ce=Ei(ce)),ce+="n"),Me+=` It must be ${$}. Received ${ce}`,Me},RangeError);function Ei(U){let $="",re=U.length;const Me=U[0]==="-"?1:0;for(;re>=Me+4;re-=3)$=`_${U.slice(re-3,re)}${$}`;return`${U.slice(0,re)}${$}`}function Zi(U,$,re){We($,"offset"),(U[$]===void 0||U[$+re]===void 0)&&Ce($,U.length-(re+1))}function Vi(U,$,re,Me,ce,ze){if(U>re||U<$){const Ve=typeof $=="bigint"?"n":"";let pt;throw $===0||$===BigInt(0)?pt=`>= 0${Ve} and < 2${Ve} ** ${(ze+1)*8}${Ve}`:pt=`>= -(2${Ve} ** ${(ze+1)*8-1}${Ve}) and < 2 ** ${(ze+1)*8-1}${Ve}`,new ui.ERR_OUT_OF_RANGE("value",pt,U)}Zi(Me,ce,ze)}function We(U,$){if(typeof U!="number")throw new ui.ERR_INVALID_ARG_TYPE($,"number",U)}function Ce(U,$,re){throw Math.floor(U)!==U?(We(U,re),new ui.ERR_OUT_OF_RANGE("offset","an integer",U)):$<0?new ui.ERR_BUFFER_OUT_OF_BOUNDS:new ui.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${$}`,U)}const At=/[^+/0-9A-Za-z-_]/g;function Ot(U){if(U=U.split("=")[0],U=U.trim().replace(At,""),U.length<2)return"";for(;U.length%4!==0;)U=U+"=";return U}function Zt(U,$){$=$||1/0;let re;const Me=U.length;let ce=null;const ze=[];for(let Ve=0;Ve<Me;++Ve){if(re=U.charCodeAt(Ve),re>55295&&re<57344){if(!ce){if(re>56319){($-=3)>-1&&ze.push(239,191,189);continue}else if(Ve+1===Me){($-=3)>-1&&ze.push(239,191,189);continue}ce=re;continue}if(re<56320){($-=3)>-1&&ze.push(239,191,189),ce=re;continue}re=(ce-55296<<10|re-56320)+65536}else ce&&($-=3)>-1&&ze.push(239,191,189);if(ce=null,re<128){if(($-=1)<0)break;ze.push(re)}else if(re<2048){if(($-=2)<0)break;ze.push(re>>6|192,re&63|128)}else if(re<65536){if(($-=3)<0)break;ze.push(re>>12|224,re>>6&63|128,re&63|128)}else if(re<1114112){if(($-=4)<0)break;ze.push(re>>18|240,re>>12&63|128,re>>6&63|128,re&63|128)}else throw new Error("Invalid code point")}return ze}function jt(U){const $=[];for(let re=0;re<U.length;++re)$.push(U.charCodeAt(re)&255);return $}function xi(U,$){let re,Me,ce;const ze=[];for(let Ve=0;Ve<U.length&&!(($-=2)<0);++Ve)re=U.charCodeAt(Ve),Me=re>>8,ce=re%256,ze.push(ce),ze.push(Me);return ze}function vt(U){return h.toByteArray(Ot(U))}function ge(U,$,re,Me){let ce;for(ce=0;ce<Me&&!(ce+re>=$.length||ce>=U.length);++ce)$[ce+re]=U[ce];return ce}function be(U,$){return U instanceof $||U!=null&&U.constructor!=null&&U.constructor.name!=null&&U.constructor.name===$.name}function Ne(U){return U!==U}const Se=function(){const U="0123456789abcdef",$=new Array(256);for(let re=0;re<16;++re){const Me=re*16;for(let ce=0;ce<16;++ce)$[Me+ce]=U[re]+U[ce]}return $}();function Fe(U){return typeof BigInt>"u"?Ie:U}function Ie(){throw new Error("BigInt not supported")}},"./node_modules/css-loader/dist/runtime/api.js":l=>{l.exports=function(u){var c=[];return c.toString=function(){return this.map(function(h){var p="",f=typeof h[5]<"u";return h[4]&&(p+="@supports (".concat(h[4],") {")),h[2]&&(p+="@media ".concat(h[2]," {")),f&&(p+="@layer".concat(h[5].length>0?" ".concat(h[5]):""," {")),p+=u(h),f&&(p+="}"),h[2]&&(p+="}"),h[4]&&(p+="}"),p}).join("")},c.i=function(h,p,f,g,m){typeof h=="string"&&(h=[[null,h,void 0]]);var y={};if(f)for(var b=0;b<this.length;b++){var v=this[b][0];v!=null&&(y[v]=!0)}for(var _=0;_<h.length;_++){var T=[].concat(h[_]);f&&y[T[0]]||(typeof m<"u"&&(typeof T[5]>"u"||(T[1]="@layer".concat(T[5].length>0?" ".concat(T[5]):""," {").concat(T[1],"}")),T[5]=m),p&&(T[2]&&(T[1]="@media ".concat(T[2]," {").concat(T[1],"}")),T[2]=p),g&&(T[4]?(T[1]="@supports (".concat(T[4],") {").concat(T[1],"}"),T[4]=g):T[4]="".concat(g)),c.push(T))}},c}},"./node_modules/css-loader/dist/runtime/getUrl.js":l=>{l.exports=function(u,c){return c||(c={}),u&&(u=String(u.__esModule?u.default:u),/^['"].*['"]$/.test(u)&&(u=u.slice(1,-1)),c.hash&&(u+=c.hash),/["'() \t\n]|(%20)/.test(u)||c.needQuotes?'"'.concat(u.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):u)}},"./node_modules/css-loader/dist/runtime/sourceMaps.js":l=>{l.exports=function(u){var c=u[1],h=u[3];if(!h)return c;if(typeof btoa=="function"){var p=btoa(unescape(encodeURIComponent(JSON.stringify(h)))),f="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(p),g="/*# ".concat(f," */");return[c].concat([g]).join(`
`)}return[c].join(`
`)}},"./node_modules/debug/src/browser.js":(l,u,c)=>{u.formatArgs=p,u.save=f,u.load=g,u.useColors=h,u.storage=m(),u.destroy=(()=>{let b=!1;return()=>{b||(b=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),u.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function h(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function p(b){if(b[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+b[0]+(this.useColors?"%c ":" ")+"+"+l.exports.humanize(this.diff),!this.useColors)return;const v="color: "+this.color;b.splice(1,0,v,"color: inherit");let _=0,T=0;b[0].replace(/%[a-zA-Z%]/g,E=>{E!=="%%"&&(_++,E==="%c"&&(T=_))}),b.splice(T,0,v)}u.log=console.debug||console.log||(()=>{});function f(b){try{b?u.storage.setItem("debug",b):u.storage.removeItem("debug")}catch{}}function g(){let b;try{b=u.storage.getItem("debug")}catch{}return!b&&typeof process<"u"&&"env"in process&&(b=process.env.DEBUG),b}function m(){try{return localStorage}catch{}}l.exports=c("./node_modules/debug/src/common.js")(u);const{formatters:y}=l.exports;y.j=function(b){try{return JSON.stringify(b)}catch(v){return"[UnexpectedJSONParseError]: "+v.message}}},"./node_modules/debug/src/common.js":(l,u,c)=>{function h(p){g.debug=g,g.default=g,g.coerce=T,g.disable=b,g.enable=y,g.enabled=v,g.humanize=c("./node_modules/ms/index.js"),g.destroy=E,Object.keys(p).forEach(C=>{g[C]=p[C]}),g.names=[],g.skips=[],g.formatters={};function f(C){let R=0;for(let B=0;B<C.length;B++)R=(R<<5)-R+C.charCodeAt(B),R|=0;return g.colors[Math.abs(R)%g.colors.length]}g.selectColor=f;function g(C){let R,B=null,I,N;function D(...P){if(!D.enabled)return;const k=D,q=Number(new Date),V=q-(R||q);k.diff=V,k.prev=R,k.curr=q,R=q,P[0]=g.coerce(P[0]),typeof P[0]!="string"&&P.unshift("%O");let j=0;P[0]=P[0].replace(/%([a-zA-Z%])/g,(Q,W)=>{if(Q==="%%")return"%";j++;const G=g.formatters[W];if(typeof G=="function"){const z=P[j];Q=G.call(k,z),P.splice(j,1),j--}return Q}),g.formatArgs.call(k,P),(k.log||g.log).apply(k,P)}return D.namespace=C,D.useColors=g.useColors(),D.color=g.selectColor(C),D.extend=m,D.destroy=g.destroy,Object.defineProperty(D,"enabled",{enumerable:!0,configurable:!1,get:()=>B!==null?B:(I!==g.namespaces&&(I=g.namespaces,N=g.enabled(C)),N),set:P=>{B=P}}),typeof g.init=="function"&&g.init(D),D}function m(C,R){const B=g(this.namespace+(typeof R>"u"?":":R)+C);return B.log=this.log,B}function y(C){g.save(C),g.namespaces=C,g.names=[],g.skips=[];let R;const B=(typeof C=="string"?C:"").split(/[\s,]+/),I=B.length;for(R=0;R<I;R++)B[R]&&(C=B[R].replace(/\*/g,".*?"),C[0]==="-"?g.skips.push(new RegExp("^"+C.slice(1)+"$")):g.names.push(new RegExp("^"+C+"$")))}function b(){const C=[...g.names.map(_),...g.skips.map(_).map(R=>"-"+R)].join(",");return g.enable(""),C}function v(C){if(C[C.length-1]==="*")return!0;let R,B;for(R=0,B=g.skips.length;R<B;R++)if(g.skips[R].test(C))return!1;for(R=0,B=g.names.length;R<B;R++)if(g.names[R].test(C))return!0;return!1}function _(C){return C.toString().substring(2,C.toString().length-2).replace(/\.\*\?$/,"*")}function T(C){return C instanceof Error?C.stack||C.message:C}function E(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return g.enable(g.load()),g}l.exports=h},"./node_modules/deep-assign/index.js":(l,u,c)=>{var h=c("./node_modules/is-obj/index.js"),p=Object.prototype.hasOwnProperty,f=Object.prototype.propertyIsEnumerable;function g(b){if(b==null)throw new TypeError("Sources cannot be null or undefined");return Object(b)}function m(b,v,_){var T=v[_];if(T!=null){if(p.call(b,_)&&(b[_]===void 0||b[_]===null))throw new TypeError("Cannot convert undefined or null to object ("+_+")");!p.call(b,_)||!h(T)?b[_]=T:b[_]=y(Object(b[_]),v[_])}}function y(b,v){if(b===v)return b;v=Object(v);for(var _ in v)p.call(v,_)&&m(b,v,_);if(Object.getOwnPropertySymbols)for(var T=Object.getOwnPropertySymbols(v),E=0;E<T.length;E++)f.call(v,T[E])&&m(b,v,T[E]);return b}l.exports=function(b){b=g(b);for(var v=1;v<arguments.length;v++)y(b,arguments[v]);return b}},"./node_modules/dtype/index.js":l=>{l.exports=function(u){switch(u){case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array;case"array":return Array;case"uint8_clamped":return Uint8ClampedArray}}},"./node_modules/global/window.js":(l,u,c)=>{var h;typeof window<"u"?h=window:typeof c.g<"u"?h=c.g:typeof self<"u"?h=self:h={},l.exports=h},"./node_modules/ieee754/index.js":(l,u)=>{/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */u.read=function(c,h,p,f,g){var m,y,b=g*8-f-1,v=(1<<b)-1,_=v>>1,T=-7,E=p?g-1:0,C=p?-1:1,R=c[h+E];for(E+=C,m=R&(1<<-T)-1,R>>=-T,T+=b;T>0;m=m*256+c[h+E],E+=C,T-=8);for(y=m&(1<<-T)-1,m>>=-T,T+=f;T>0;y=y*256+c[h+E],E+=C,T-=8);if(m===0)m=1-_;else{if(m===v)return y?NaN:(R?-1:1)*(1/0);y=y+Math.pow(2,f),m=m-_}return(R?-1:1)*y*Math.pow(2,m-f)},u.write=function(c,h,p,f,g,m){var y,b,v,_=m*8-g-1,T=(1<<_)-1,E=T>>1,C=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,R=f?0:m-1,B=f?1:-1,I=h<0||h===0&&1/h<0?1:0;for(h=Math.abs(h),isNaN(h)||h===1/0?(b=isNaN(h)?1:0,y=T):(y=Math.floor(Math.log(h)/Math.LN2),h*(v=Math.pow(2,-y))<1&&(y--,v*=2),y+E>=1?h+=C/v:h+=C*Math.pow(2,1-E),h*v>=2&&(y++,v/=2),y+E>=T?(b=0,y=T):y+E>=1?(b=(h*v-1)*Math.pow(2,g),y=y+E):(b=h*Math.pow(2,E-1)*Math.pow(2,g),y=0));g>=8;c[p+R]=b&255,R+=B,b/=256,g-=8);for(y=y<<g|b,_+=g;_>0;c[p+R]=y&255,R+=B,y/=256,_-=8);c[p+R-B]|=I*128}},"./node_modules/is-buffer/index.js":l=>{/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */l.exports=function(h){return h!=null&&(u(h)||c(h)||!!h._isBuffer)};function u(h){return!!h.constructor&&typeof h.constructor.isBuffer=="function"&&h.constructor.isBuffer(h)}function c(h){return typeof h.readFloatLE=="function"&&typeof h.slice=="function"&&u(h.slice(0,0))}},"./node_modules/is-function/index.js":l=>{l.exports=c;var u=Object.prototype.toString;function c(h){if(!h)return!1;var p=u.call(h);return p==="[object Function]"||typeof h=="function"&&p!=="[object RegExp]"||typeof window<"u"&&(h===window.setTimeout||h===window.alert||h===window.confirm||h===window.prompt)}},"./node_modules/is-obj/index.js":l=>{l.exports=function(u){var c=typeof u;return u!==null&&(c==="object"||c==="function")}},"./node_modules/layout-bmfont-text/index.js":(l,u,c)=>{var h=c("./node_modules/word-wrapper/index.js"),p=c("./node_modules/xtend/immutable.js"),f=c("./node_modules/as-number/index.js"),g=["x","e","a","o","n","s","r","c","u","m","v","w","z"],m=["m","w"],y=["H","I","N","E","F","K","L","T","U","V","W","X","Y","Z"],b=9,v=32,_=0,T=1,E=2;l.exports=function(j){return new C(j)};function C(j){this.glyphs=[],this._measure=this.computeMetrics.bind(this),this.update(j)}C.prototype.update=function(j){if(j=p({measure:this._measure},j),this._opt=j,this._opt.tabSize=f(this._opt.tabSize,4),!j.font)throw new Error("must provide a valid bitmap font");var Q=this.glyphs,W=j.text||"",G=j.font;this._setupSpaceGlyphs(G);var z=h.lines(W,j),te=j.width||0;Q.length=0;var Y=z.reduce(function(St,Qt){return Math.max(St,Qt.width,te)},0),se=0,ve=0,Ae=f(j.lineHeight,G.common.lineHeight),me=G.common.base,Oe=Ae-me,Xe=j.letterSpacing||0,Je=Ae*z.length-Oe,it=q(this._opt.align);ve-=Je,this._width=Y,this._height=Je,this._descender=Ae-me,this._baseline=me,this._xHeight=N(G),this._capHeight=P(G),this._lineHeight=Ae,this._ascender=Ae-Oe-this._xHeight;var dt=this;z.forEach(function(St,Qt){for(var yt=St.start,bi=St.end,$e=St.width,Fi,ui=yt;ui<bi;ui++){var Si=W.charCodeAt(ui),Ei=dt.getGlyph(G,Si);if(Ei){Fi&&(se+=k(G,Fi.id,Ei.id));var Zi=se;it===T?Zi+=(Y-$e)/2:it===E&&(Zi+=Y-$e),Q.push({position:[Zi,ve],data:Ei,index:ui,line:Qt}),se+=Ei.xadvance+Xe,Fi=Ei}}ve+=Ae,se=0}),this._linesTotal=z.length},C.prototype._setupSpaceGlyphs=function(j){if(this._fallbackSpaceGlyph=null,this._fallbackTabGlyph=null,!(!j.chars||j.chars.length===0)){var Q=I(j,v)||D(j)||j.chars[0],W=this._opt.tabSize*Q.xadvance;this._fallbackSpaceGlyph=Q,this._fallbackTabGlyph=p(Q,{x:0,y:0,xadvance:W,id:b,xoffset:0,yoffset:0,width:0,height:0})}},C.prototype.getGlyph=function(j,Q){var W=I(j,Q);return W||(Q===b?this._fallbackTabGlyph:Q===v?this._fallbackSpaceGlyph:null)},C.prototype.computeMetrics=function(j,Q,W,G){var z=this._opt.letterSpacing||0,te=this._opt.font,Y=0,se=0,ve=0,Ae,me;if(!te.chars||te.chars.length===0)return{start:Q,end:Q,width:0};W=Math.min(j.length,W);for(var Oe=Q;Oe<W;Oe++){var Xe=j.charCodeAt(Oe),Ae=this.getGlyph(te,Xe);if(Ae){Ae.xoffset;var Je=me?k(te,me.id,Ae.id):0;Y+=Je;var it=Y+Ae.xadvance+z,dt=Y+Ae.width;if(dt>=G||it>=G)break;Y=it,se=dt,me=Ae}ve++}return me&&(se+=me.xoffset),{start:Q,end:Q+ve,width:se}},["width","height","descender","ascender","xHeight","baseline","capHeight","lineHeight"].forEach(R);function R(j){Object.defineProperty(C.prototype,j,{get:B(j),configurable:!0})}function B(j){return new Function(["return function "+j+"() {","  return this._"+j,"}"].join(`
`))()}function I(j,Q){if(!j.chars||j.chars.length===0)return null;var W=V(j.chars,Q);return W>=0?j.chars[W]:null}function N(j){for(var Q=0;Q<g.length;Q++){var W=g[Q].charCodeAt(0),G=V(j.chars,W);if(G>=0)return j.chars[G].height}return 0}function D(j){for(var Q=0;Q<m.length;Q++){var W=m[Q].charCodeAt(0),G=V(j.chars,W);if(G>=0)return j.chars[G]}return 0}function P(j){for(var Q=0;Q<y.length;Q++){var W=y[Q].charCodeAt(0),G=V(j.chars,W);if(G>=0)return j.chars[G].height}return 0}function k(j,Q,W){if(!j.kernings||j.kernings.length===0)return 0;for(var G=j.kernings,z=0;z<G.length;z++){var te=G[z];if(te.first===Q&&te.second===W)return te.amount}return 0}function q(j){return j==="center"?T:j==="right"?E:_}function V(j,Q,W){W=W||0;for(var G=W;G<j.length;G++)if(j[G].id===Q)return G;return-1}},"./node_modules/load-bmfont/browser.js":(l,u,c)=>{var h=c("./node_modules/buffer/index.js").Buffer,p=c("./node_modules/xhr/index.js"),f=function(){},g=c("./node_modules/parse-bmfont-ascii/index.js"),m=c("./node_modules/parse-bmfont-xml/lib/browser.js"),y=c("./node_modules/parse-bmfont-binary/index.js"),b=c("./node_modules/load-bmfont/lib/is-binary.js"),v=c("./node_modules/xtend/immutable.js"),_=function(){return self.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}();l.exports=function(C,R){R=typeof R=="function"?R:f,typeof C=="string"?C={uri:C}:C||(C={});var B=C.binary;B&&(C=E(C)),p(C,function(I,N,D){if(I)return R(I);if(!/^2/.test(N.statusCode))return R(new Error("http status code: "+N.statusCode));if(!D)return R(new Error("no body result"));var P=!1;if(T(D)){var k=new Uint8Array(D);D=h.from(k,"binary")}b(D)&&(P=!0,typeof D=="string"&&(D=h.from(D,"binary"))),P||(h.isBuffer(D)&&(D=D.toString(C.encoding)),D=D.trim());var q;try{var V=N.headers["content-type"];P?q=y(D):/json/.test(V)||D.charAt(0)==="{"?q=JSON.parse(D):/xml/.test(V)||D.charAt(0)==="<"?q=m(D):q=g(D)}catch(j){R(new Error("error parsing font "+j.message)),R=f}R(null,q)})};function T(C){var R=Object.prototype.toString;return R.call(C)==="[object ArrayBuffer]"}function E(C){if(_)return v(C,{responseType:"arraybuffer"});if(typeof self.XMLHttpRequest>"u")throw new Error("your browser does not support XHR loading");var R=new self.XMLHttpRequest;return R.overrideMimeType("text/plain; charset=x-user-defined"),v({xhr:R},C)}},"./node_modules/load-bmfont/lib/is-binary.js":(l,u,c)=>{var h=c("./node_modules/buffer/index.js").Buffer,p=c("./node_modules/buffer-equal/index.js"),f=h.from([66,77,70,3]);l.exports=function(g){return typeof g=="string"?g.substring(0,3)==="BMF":g.length>4&&p(g.slice(0,4),f)}},"./node_modules/ms/index.js":l=>{var u=1e3,c=u*60,h=c*60,p=h*24,f=p*7,g=p*365.25;l.exports=function(_,T){T=T||{};var E=typeof _;if(E==="string"&&_.length>0)return m(_);if(E==="number"&&isFinite(_))return T.long?b(_):y(_);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(_))};function m(_){if(_=String(_),!(_.length>100)){var T=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(_);if(T){var E=parseFloat(T[1]),C=(T[2]||"ms").toLowerCase();switch(C){case"years":case"year":case"yrs":case"yr":case"y":return E*g;case"weeks":case"week":case"w":return E*f;case"days":case"day":case"d":return E*p;case"hours":case"hour":case"hrs":case"hr":case"h":return E*h;case"minutes":case"minute":case"mins":case"min":case"m":return E*c;case"seconds":case"second":case"secs":case"sec":case"s":return E*u;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return E;default:return}}}}function y(_){var T=Math.abs(_);return T>=p?Math.round(_/p)+"d":T>=h?Math.round(_/h)+"h":T>=c?Math.round(_/c)+"m":T>=u?Math.round(_/u)+"s":_+"ms"}function b(_){var T=Math.abs(_);return T>=p?v(_,T,p,"day"):T>=h?v(_,T,h,"hour"):T>=c?v(_,T,c,"minute"):T>=u?v(_,T,u,"second"):_+" ms"}function v(_,T,E,C){var R=T>=E*1.5;return Math.round(_/E)+" "+C+(R?"s":"")}},"./node_modules/parse-bmfont-ascii/index.js":l=>{l.exports=function(p){if(!p)throw new Error("no data provided");p=p.toString().trim();var f={pages:[],chars:[],kernings:[]},g=p.split(/\r\n?|\n/g);if(g.length===0)throw new Error("no data in BMFont file");for(var m=0;m<g.length;m++){var y=u(g[m],m);if(y)if(y.key==="page"){if(typeof y.data.id!="number")throw new Error("malformed file at line "+m+" -- needs page id=N");if(typeof y.data.file!="string")throw new Error("malformed file at line "+m+' -- needs page file="path"');f.pages[y.data.id]=y.data.file}else y.key==="chars"||y.key==="kernings"||(y.key==="char"?f.chars.push(y.data):y.key==="kerning"?f.kernings.push(y.data):f[y.key]=y.data)}return f};function u(p,f){if(p=p.replace(/\t+/g," ").trim(),!p)return null;var g=p.indexOf(" ");if(g===-1)throw new Error("no named row at line "+f);var m=p.substring(0,g);p=p.substring(g+1),p=p.replace(/letter=[\'\"]\S+[\'\"]/gi,""),p=p.split("="),p=p.map(function(T){return T.trim().match(/(".*?"|[^"\s]+)+(?=\s*|\s*$)/g)});for(var y=[],b=0;b<p.length;b++){var v=p[b];b===0?y.push({key:v[0],data:""}):b===p.length-1?y[y.length-1].data=c(v[0]):(y[y.length-1].data=c(v[0]),y.push({key:v[1],data:""}))}var _={key:m,data:{}};return y.forEach(function(T){_.data[T.key]=T.data}),_}function c(p){return!p||p.length===0?"":p.indexOf('"')===0||p.indexOf("'")===0?p.substring(1,p.length-1):p.indexOf(",")!==-1?h(p):parseInt(p,10)}function h(p){return p.split(",").map(function(f){return parseInt(f,10)})}},"./node_modules/parse-bmfont-binary/index.js":l=>{var u=[66,77,70];l.exports=function(v){if(v.length<6)throw new Error("invalid buffer length for BMFont");var _=u.every(function(B,I){return v.readUInt8(I)===B});if(!_)throw new Error("BMFont missing BMF byte header");var T=3,E=v.readUInt8(T++);if(E>3)throw new Error("Only supports BMFont Binary v3 (BMFont App v1.10)");for(var C={kernings:[],chars:[]},R=0;R<5;R++)T+=c(C,v,T);return C};function c(v,_,T){if(T>_.length-1)return 0;var E=_.readUInt8(T++),C=_.readInt32LE(T);switch(T+=4,E){case 1:v.info=h(_,T);break;case 2:v.common=p(_,T);break;case 3:v.pages=f(_,T,C);break;case 4:v.chars=g(_,T,C);break;case 5:v.kernings=m(_,T,C);break}return 5+C}function h(v,_){var T={};T.size=v.readInt16LE(_);var E=v.readUInt8(_+2);return T.smooth=E>>7&1,T.unicode=E>>6&1,T.italic=E>>5&1,T.bold=E>>4&1,E>>3&1&&(T.fixedHeight=1),T.charset=v.readUInt8(_+3)||"",T.stretchH=v.readUInt16LE(_+4),T.aa=v.readUInt8(_+6),T.padding=[v.readInt8(_+7),v.readInt8(_+8),v.readInt8(_+9),v.readInt8(_+10)],T.spacing=[v.readInt8(_+11),v.readInt8(_+12)],T.outline=v.readUInt8(_+13),T.face=b(v,_+14),T}function p(v,_){var T={};return T.lineHeight=v.readUInt16LE(_),T.base=v.readUInt16LE(_+2),T.scaleW=v.readUInt16LE(_+4),T.scaleH=v.readUInt16LE(_+6),T.pages=v.readUInt16LE(_+8),v.readUInt8(_+10),T.packed=0,T.alphaChnl=v.readUInt8(_+11),T.redChnl=v.readUInt8(_+12),T.greenChnl=v.readUInt8(_+13),T.blueChnl=v.readUInt8(_+14),T}function f(v,_,T){for(var E=[],C=y(v,_),R=C.length+1,B=T/R,I=0;I<B;I++)E[I]=v.slice(_,_+C.length).toString("utf8"),_+=R;return E}function g(v,_,T){for(var E=[],C=T/20,R=0;R<C;R++){var B={},I=R*20;B.id=v.readUInt32LE(_+0+I),B.x=v.readUInt16LE(_+4+I),B.y=v.readUInt16LE(_+6+I),B.width=v.readUInt16LE(_+8+I),B.height=v.readUInt16LE(_+10+I),B.xoffset=v.readInt16LE(_+12+I),B.yoffset=v.readInt16LE(_+14+I),B.xadvance=v.readInt16LE(_+16+I),B.page=v.readUInt8(_+18+I),B.chnl=v.readUInt8(_+19+I),E[R]=B}return E}function m(v,_,T){for(var E=[],C=T/10,R=0;R<C;R++){var B={},I=R*10;B.first=v.readUInt32LE(_+0+I),B.second=v.readUInt32LE(_+4+I),B.amount=v.readInt16LE(_+8+I),E[R]=B}return E}function y(v,_){for(var T=_;T<v.length&&v[T]!==0;T++);return v.slice(_,T)}function b(v,_){return y(v,_).toString("utf8")}},"./node_modules/parse-bmfont-xml/lib/browser.js":(l,u,c)=>{var h=c("./node_modules/parse-bmfont-xml/lib/parse-attribs.js"),p=c("./node_modules/xml-parse-from-string/index.js"),f={scaleh:"scaleH",scalew:"scaleW",stretchh:"stretchH",lineheight:"lineHeight",alphachnl:"alphaChnl",redchnl:"redChnl",greenchnl:"greenChnl",bluechnl:"blueChnl"};l.exports=function(b){b=b.toString();var v=p(b),_={pages:[],chars:[],kernings:[]};["info","common"].forEach(function(N){var D=v.getElementsByTagName(N)[0];D&&(_[N]=h(g(D)))});var T=v.getElementsByTagName("pages")[0];if(!T)throw new Error("malformed file -- no <pages> element");for(var E=T.getElementsByTagName("page"),C=0;C<E.length;C++){var R=E[C],B=parseInt(R.getAttribute("id"),10),I=R.getAttribute("file");if(isNaN(B))throw new Error('malformed file -- page "id" attribute is NaN');if(!I)throw new Error('malformed file -- needs page "file" attribute');_.pages[parseInt(B,10)]=I}return["chars","kernings"].forEach(function(N){var D=v.getElementsByTagName(N)[0];if(D)for(var P=N.substring(0,N.length-1),k=D.getElementsByTagName(P),q=0;q<k.length;q++){var V=k[q];_[N].push(h(g(V)))}}),_};function g(b){var v=m(b);return v.reduce(function(_,T){var E=y(T.nodeName);return _[E]=T.nodeValue,_},{})}function m(b){for(var v=[],_=0;_<b.attributes.length;_++)v.push(b.attributes[_]);return v}function y(b){return f[b.toLowerCase()]||b}},"./node_modules/parse-bmfont-xml/lib/parse-attribs.js":l=>{var u="chasrset";l.exports=function(h){u in h&&(h.charset=h[u],delete h[u]);for(var p in h)p==="face"||p==="charset"||(p==="padding"||p==="spacing"?h[p]=c(h[p]):h[p]=parseInt(h[p],10));return h};function c(h){return h.split(",").map(function(p){return parseInt(p,10)})}},"./node_modules/parse-headers/parse-headers.js":l=>{var u=function(h){return h.replace(/^\s+|\s+$/g,"")},c=function(h){return Object.prototype.toString.call(h)==="[object Array]"};l.exports=function(h){if(!h)return{};for(var p={},f=u(h).split(`
`),g=0;g<f.length;g++){var m=f[g],y=m.indexOf(":"),b=u(m.slice(0,y)).toLowerCase(),v=u(m.slice(y+1));typeof p[b]>"u"?p[b]=v:c(p[b])?p[b].push(v):p[b]=[p[b],v]}return p}},"./node_modules/quad-indices/index.js":(l,u,c)=>{var h=c("./node_modules/dtype/index.js"),p=c("./node_modules/an-array/index.js"),f=c("./node_modules/is-buffer/index.js"),g=[0,2,3],m=[2,1,3];l.exports=function(y,b){(!y||!(p(y)||f(y)))&&(b=y||{},y=null),typeof b=="number"?b={count:b}:b=b||{};for(var v=typeof b.type=="string"?b.type:"uint16",_=typeof b.count=="number"?b.count:1,T=b.start||0,E=b.clockwise!==!1?g:m,C=E[0],R=E[1],B=E[2],I=_*6,N=y||new(h(v))(I),D=0,P=0;D<I;D+=6,P+=4){var k=D+T;N[k+0]=P+0,N[k+1]=P+1,N[k+2]=P+2,N[k+3]=P+C,N[k+4]=P+R,N[k+5]=P+B}return N}},"./node_modules/super-animejs/lib/anime.es.js":(l,u,c)=>{c.r(u),c.d(u,{default:()=>Be});var h={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0},p={duration:1e3,delay:0,endDelay:0,easing:"easeOutElastic(1, .5)",round:0},f=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective"],g={CSS:{},springs:{}};function m(ae,fe,Le){return Math.min(Math.max(ae,fe),Le)}function y(ae,fe){return ae.indexOf(fe)>-1}function b(ae,fe){return ae.apply(null,fe)}var v=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i,_=/^rgb/,T=/^hsl/,E={arr:function(ae){return Array.isArray(ae)},obj:function(ae){return y(Object.prototype.toString.call(ae),"Object")},pth:function(ae){return E.obj(ae)&&ae.hasOwnProperty("totalLength")},svg:function(ae){return ae instanceof SVGElement},inp:function(ae){return ae instanceof HTMLInputElement},dom:function(ae){return ae.nodeType||E.svg(ae)},str:function(ae){return typeof ae=="string"},fnc:function(ae){return typeof ae=="function"},und:function(ae){return typeof ae>"u"},hex:function(ae){return v.test(ae)},rgb:function(ae){return _.test(ae)},hsl:function(ae){return T.test(ae)},col:function(ae){return E.hex(ae)||E.rgb(ae)||E.hsl(ae)},key:function(ae){return!h.hasOwnProperty(ae)&&!p.hasOwnProperty(ae)&&ae!=="targets"&&ae!=="keyframes"}},C=/\(([^)]+)\)/;function R(ae){var fe=C.exec(ae);return fe?fe[1].split(",").map(function(Le){return parseFloat(Le)}):[]}function B(ae,fe){var Le=R(ae),Ue=m(E.und(Le[0])?1:Le[0],.1,100),Ke=m(E.und(Le[1])?100:Le[1],.1,100),lt=m(E.und(Le[2])?10:Le[2],.1,100),Tt=m(E.und(Le[3])?0:Le[3],.1,100),Yt=Math.sqrt(Ke/Ue),$t=lt/(2*Math.sqrt(Ke*Ue)),Bt=$t<1?Yt*Math.sqrt(1-$t*$t):0,ri=1,wi=$t<1?($t*Yt+-Tt)/Bt:-Tt+Yt;function Ui(ur){var $i=fe?fe*ur/1e3:ur;return $t<1?$i=Math.exp(-$i*$t*Yt)*(ri*Math.cos(Bt*$i)+wi*Math.sin(Bt*$i)):$i=(ri+wi*$i)*Math.exp(-$i*Yt),ur===0||ur===1?ur:1-$i}function Sr(){var ur=g.springs[ae];if(ur)return ur;for(var $i=.16666666666666666,_i=0,Mn=0;;)if(_i+=$i,Ui(_i)===1){if(Mn++,Mn>=16)break}else Mn=0;var Xn=_i*$i*1e3;return g.springs[ae]=Xn,Xn}return fe?Ui:Sr}function I(ae,fe){ae===void 0&&(ae=1),fe===void 0&&(fe=.5);var Le=m(ae,1,10),Ue=m(fe,.1,2);return function(Ke){return Ke===0||Ke===1?Ke:-Le*Math.pow(2,10*(Ke-1))*Math.sin((Ke-1-Ue/(Math.PI*2)*Math.asin(1/Le))*(Math.PI*2)/Ue)}}function N(ae){return ae===void 0&&(ae=10),function(fe){return Math.round(fe*ae)*(1/ae)}}var D=function(){var ae=11,fe=1/(ae-1);function Le(ri,wi){return 1-3*wi+3*ri}function Ue(ri,wi){return 3*wi-6*ri}function Ke(ri){return 3*ri}function lt(ri,wi,Ui){return((Le(wi,Ui)*ri+Ue(wi,Ui))*ri+Ke(wi))*ri}function Tt(ri,wi,Ui){return 3*Le(wi,Ui)*ri*ri+2*Ue(wi,Ui)*ri+Ke(wi)}function Yt(ri,wi,Ui,Sr,ur){var $i,_i,Mn=0;do _i=wi+(Ui-wi)/2,$i=lt(_i,Sr,ur)-ri,$i>0?Ui=_i:wi=_i;while(Math.abs($i)>1e-7&&++Mn<10);return _i}function $t(ri,wi,Ui,Sr){for(var ur=0;ur<4;++ur){var $i=Tt(wi,Ui,Sr);if($i===0)return wi;var _i=lt(wi,Ui,Sr)-ri;wi-=_i/$i}return wi}function Bt(ri,wi,Ui,Sr){if(!(0<=ri&&ri<=1&&0<=Ui&&Ui<=1))return;var ur=new Float32Array(ae);if(ri!==wi||Ui!==Sr)for(var $i=0;$i<ae;++$i)ur[$i]=lt($i*fe,ri,Ui);function _i(Mn){for(var Xn=0,Ii=1,ar=ae-1;Ii!==ar&&ur[Ii]<=Mn;++Ii)Xn+=fe;--Ii;var hn=(Mn-ur[Ii])/(ur[Ii+1]-ur[Ii]),qr=Xn+hn*fe,X=Tt(qr,ri,Ui);return X>=.001?$t(Mn,qr,ri,Ui):X===0?qr:Yt(Mn,Xn,Xn+fe,ri,Ui)}return function(Mn){return ri===wi&&Ui===Sr||Mn===0||Mn===1?Mn:lt(_i(Mn),wi,Sr)}}return Bt}(),P=function(){var ae=["Quad","Cubic","Quart","Quint","Sine","Expo","Circ","Back","Elastic"],fe={In:[[.55,.085,.68,.53],[.55,.055,.675,.19],[.895,.03,.685,.22],[.755,.05,.855,.06],[.47,0,.745,.715],[.95,.05,.795,.035],[.6,.04,.98,.335],[.6,-.28,.735,.045],I],Out:[[.25,.46,.45,.94],[.215,.61,.355,1],[.165,.84,.44,1],[.23,1,.32,1],[.39,.575,.565,1],[.19,1,.22,1],[.075,.82,.165,1],[.175,.885,.32,1.275],function(Tt,Yt){return function($t){return 1-I(Tt,Yt)(1-$t)}}],InOut:[[.455,.03,.515,.955],[.645,.045,.355,1],[.77,0,.175,1],[.86,0,.07,1],[.445,.05,.55,.95],[1,0,0,1],[.785,.135,.15,.86],[.68,-.55,.265,1.55],function(Tt,Yt){return function($t){return $t<.5?I(Tt,Yt)($t*2)/2:1-I(Tt,Yt)($t*-2+2)/2}}]},Le={linear:[.25,.25,.75,.75]};for(var Ue in fe)for(var Ke=0,lt=fe[Ue].length;Ke<lt;Ke++)Le["ease"+Ue+ae[Ke]]=fe[Ue][Ke];return Le}();function k(ae,fe){if(E.fnc(ae))return ae;var Le=ae.split("(")[0],Ue=P[Le],Ke=R(ae);switch(Le){case"spring":return B(ae,fe);case"cubicBezier":return b(D,Ke);case"steps":return b(N,Ke);default:return E.fnc(Ue)?b(Ue,Ke):b(D,Ue)}}function q(ae){try{var fe=document.querySelectorAll(ae);return fe}catch{return}}var V=[];function j(ae,fe){for(var Le=V,Ue=ae.length,Ke=arguments.length>=2?arguments[1]:void 0,lt=0;lt<Ue;lt++)if(lt in ae){var Tt=ae[lt];fe.call(Ke,Tt,lt,ae)&&Le.push(Tt)}return V=ae,V.length=0,Le}function Q(ae,fe){fe||(fe=[]);for(var Le=0,Ue=ae.length;Le<Ue;Le++){var Ke=ae[Le];Array.isArray(Ke)?Q(Ke,fe):fe.push(Ke)}return fe}function W(ae){return E.arr(ae)?ae:(E.str(ae)&&(ae=q(ae)||ae),ae instanceof NodeList||ae instanceof HTMLCollection?[].slice.call(ae):[ae])}function G(ae,fe){return ae.some(function(Le){return Le===fe})}function z(ae){var fe={};for(var Le in ae)fe[Le]=ae[Le];return fe}function te(ae,fe){var Le=z(ae);for(var Ue in ae)Le[Ue]=fe.hasOwnProperty(Ue)?fe[Ue]:ae[Ue];return Le}function Y(ae,fe){var Le=z(ae);for(var Ue in fe)Le[Ue]=E.und(ae[Ue])?fe[Ue]:ae[Ue];return Le}var se=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g;function ve(ae){var fe=se.exec(ae);return fe?"rgba("+fe[1]+",1)":ae}var Ae=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,me=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i;function Oe(ae){var fe=ae.replace(Ae,function(Tt,Yt,$t,Bt){return Yt+Yt+$t+$t+Bt+Bt}),Le=me.exec(fe),Ue=parseInt(Le[1],16),Ke=parseInt(Le[2],16),lt=parseInt(Le[3],16);return"rgba("+Ue+","+Ke+","+lt+",1)"}var Xe=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g,Je=/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g;function it(ae){var fe=Xe.exec(ae)||Je.exec(ae),Le=parseInt(fe[1],10)/360,Ue=parseInt(fe[2],10)/100,Ke=parseInt(fe[3],10)/100,lt=fe[4]||1;function Tt(Ui,Sr,ur){return ur<0&&(ur+=1),ur>1&&(ur-=1),ur<.16666666666666666?Ui+(Sr-Ui)*6*ur:ur<.5?Sr:ur<.6666666666666666?Ui+(Sr-Ui)*(.6666666666666666-ur)*6:Ui}var Yt,$t,Bt;if(Ue==0)Yt=$t=Bt=Ke;else{var ri=Ke<.5?Ke*(1+Ue):Ke+Ue-Ke*Ue,wi=2*Ke-ri;Yt=Tt(wi,ri,Le+.3333333333333333),$t=Tt(wi,ri,Le),Bt=Tt(wi,ri,Le-.3333333333333333)}return"rgba("+Yt*255+","+$t*255+","+Bt*255+","+lt+")"}function dt(ae){if(E.rgb(ae))return ve(ae);if(E.hex(ae))return Oe(ae);if(E.hsl(ae))return it(ae)}var St=/([\+\-]?[0-9#\.]+)(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/;function Qt(ae){var fe=St.exec(ae);if(fe)return fe[2]}function yt(ae){if(y(ae,"translate")||ae==="perspective")return"px";if(y(ae,"rotate")||y(ae,"skew"))return"deg"}function bi(ae,fe){return E.fnc(ae)?ae(fe.target,fe.id,fe.total):ae}function $e(ae,fe){return ae.getAttribute(fe)}function Fi(ae,fe,Le){var Ue=Qt(fe);if(G([Le,"deg","rad","turn"],Ue))return fe;var Ke=g.CSS[fe+Le];if(!E.und(Ke))return Ke;var lt=100,Tt=document.createElement(ae.tagName),Yt=ae.parentNode&&ae.parentNode!==document?ae.parentNode:document.body;Yt.appendChild(Tt),Tt.style.position="absolute",Tt.style.width=lt+Le;var $t=lt/Tt.offsetWidth;Yt.removeChild(Tt);var Bt=$t*parseFloat(fe);return g.CSS[fe+Le]=Bt,Bt}function ui(ae,fe,Le){if(fe in ae.style){var Ue=fe.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),Ke=ae.style[fe]||getComputedStyle(ae).getPropertyValue(Ue)||"0";return Le?Fi(ae,Ke,Le):Ke}}function Si(ae,fe){if(E.dom(ae)&&!E.inp(ae)&&($e(ae,fe)||E.svg(ae)&&ae[fe]))return"attribute";if(E.dom(ae)&&G(f,fe))return"transform";if(E.dom(ae)&&fe!=="transform"&&ui(ae,fe))return"css";if(ae[fe]!=null)return"object"}var Ei=/(\w+)\(([^)]*)\)/g;function Zi(ae){if(E.dom(ae)){for(var fe=ae.style.transform||"",Le=new Map,Ue;Ue=Ei.exec(fe);)Le.set(Ue[1],Ue[2]);return Le}}function Vi(ae,fe,Le,Ue){var Ke=y(fe,"scale")?1:0+yt(fe),lt=Zi(ae).get(fe)||Ke;return Le&&(Le.transforms.list.set(fe,lt),Le.transforms.last=fe),Ue?Fi(ae,lt,Ue):lt}function We(ae,fe,Le,Ue){switch(Si(ae,fe)){case"transform":return Vi(ae,fe,Ue,Le);case"css":return ui(ae,fe,Le);case"attribute":return $e(ae,fe);default:return ae[fe]||0}}var Ce=/^(\*=|\+=|-=)/;function At(ae,fe){var Le=Ce.exec(ae);if(!Le)return ae;var Ue=Qt(ae)||0,Ke=parseFloat(fe),lt=parseFloat(ae.replace(Le[0],""));switch(Le[0][0]){case"+":return Ke+lt+Ue;case"-":return Ke-lt+Ue;case"*":return Ke*lt+Ue}}var Ot=/\s/g;function Zt(ae,fe){if(E.col(ae))return dt(ae);var Le=Qt(ae),Ue=Le?ae.substr(0,ae.length-Le.length):ae;return fe&&!Ot.test(ae)?Ue+fe:Ue}function jt(ae,fe){return Math.sqrt(Math.pow(fe.x-ae.x,2)+Math.pow(fe.y-ae.y,2))}function xi(ae){return Math.PI*2*$e(ae,"r")}function vt(ae){return $e(ae,"width")*2+$e(ae,"height")*2}function ge(ae){return jt({x:$e(ae,"x1"),y:$e(ae,"y1")},{x:$e(ae,"x2"),y:$e(ae,"y2")})}function be(ae){for(var fe=ae.points,Le=0,Ue,Ke=0;Ke<fe.numberOfItems;Ke++){var lt=fe.getItem(Ke);Ke>0&&(Le+=jt(Ue,lt)),Ue=lt}return Le}function Ne(ae){var fe=ae.points;return be(ae)+jt(fe.getItem(fe.numberOfItems-1),fe.getItem(0))}function Se(ae){if(ae.getTotalLength)return ae.getTotalLength();switch(ae.tagName.toLowerCase()){case"circle":return xi(ae);case"rect":return vt(ae);case"line":return ge(ae);case"polyline":return be(ae);case"polygon":return Ne(ae)}}function Fe(ae){var fe=Se(ae);return ae.setAttribute("stroke-dasharray",fe),fe}function Ie(ae){for(var fe=ae.parentNode;E.svg(fe)&&(fe=fe.parentNode,!!E.svg(fe.parentNode)););return fe}function U(ae,fe){var Le=fe||{},Ue=Le.el||Ie(ae),Ke=Ue.getBoundingClientRect(),lt=$e(Ue,"viewBox"),Tt=Ke.width,Yt=Ke.height,$t=Le.viewBox||(lt?lt.split(" "):[0,0,Tt,Yt]);return{el:Ue,viewBox:$t,x:$t[0]/1,y:$t[1]/1,w:Tt/$t[2],h:Yt/$t[3]}}function $(ae,fe){var Le=E.str(ae)?q(ae)[0]:ae,Ue=fe||100;return function(Ke){return{property:Ke,el:Le,svg:U(Le),totalLength:Se(Le)*(Ue/100)}}}function re(ae,fe){function Le(Yt){Yt===void 0&&(Yt=0);var $t=fe+Yt>=1?fe+Yt:0;return ae.el.getPointAtLength($t)}var Ue=U(ae.el,ae.svg),Ke=Le(),lt=Le(-1),Tt=Le(1);switch(ae.property){case"x":return(Ke.x-Ue.x)*Ue.w;case"y":return(Ke.y-Ue.y)*Ue.h;case"angle":return Math.atan2(Tt.y-lt.y,Tt.x-lt.x)*180/Math.PI}}var Me=/-?\d*\.?\d+/g;function ce(ae,fe){var Le=Zt(E.pth(ae)?ae.totalLength:ae,fe)+"";return{original:Le,numbers:Le.match(Me)?Le.match(Me).map(Number):[0],strings:E.str(ae)||fe?Le.split(Me):[]}}function ze(ae){var fe=ae?Q(E.arr(ae)?ae.map(W):W(ae)):[];return j(fe,function(Le,Ue,Ke){return Ke.indexOf(Le)===Ue})}function Ve(ae){var fe=ze(ae);return fe.map(function(Le,Ue){return{target:Le,id:Ue,total:fe.length,transforms:{list:Zi(Le)}}})}var pt=/^spring/;function Dt(ae,fe){var Le=z(fe);if(pt.test(Le.easing)&&(Le.duration=B(Le.easing)),E.arr(ae)){var Ue=ae.length,Ke=Ue===2&&!E.obj(ae[0]);Ke?ae={value:ae}:E.fnc(fe.duration)||(Le.duration=fe.duration/Ue)}var lt=E.arr(ae)?ae:[ae];return lt.map(function(Tt,Yt){var $t=E.obj(Tt)&&!E.pth(Tt)?Tt:{value:Tt};return E.und($t.delay)&&($t.delay=Yt?0:fe.delay),E.und($t.endDelay)&&($t.endDelay=Yt===lt.length-1?fe.endDelay:0),$t}).map(function(Tt){return Y(Tt,Le)})}function xt(ae){for(var fe=j(Q(ae.map(function(lt){return Object.keys(lt)})),function(lt){return E.key(lt)}).reduce(function(lt,Tt){return lt.indexOf(Tt)<0&&lt.push(Tt),lt},[]),Le={},Ue=function(lt){var Tt=fe[lt];Le[Tt]=ae.map(function(Yt){var $t={};for(var Bt in Yt)E.key(Bt)?Bt==Tt&&($t.value=Yt[Bt]):$t[Bt]=Yt[Bt];return $t})},Ke=0;Ke<fe.length;Ke++)Ue(Ke);return Le}function Vt(ae,fe){var Le=[],Ue=fe.keyframes;Ue&&(fe=Y(xt(Ue),fe));for(var Ke in fe)E.key(Ke)&&Le.push({name:Ke,tweens:Dt(fe[Ke],ae)});return Le}function fi(ae,fe){var Le={};for(var Ue in ae){var Ke=bi(ae[Ue],fe);E.arr(Ke)&&(Ke=Ke.map(function(lt){return bi(lt,fe)}),Ke.length===1&&(Ke=Ke[0])),Le[Ue]=Ke}return Le.duration=parseFloat(Le.duration),Le.delay=parseFloat(Le.delay),Le}function xr(ae,fe){var Le;return ae.tweens.map(function(Ue){var Ke=fi(Ue,fe),lt=Ke.value,Tt=E.arr(lt)?lt[1]:lt,Yt=Qt(Tt),$t=We(fe.target,ae.name,Yt,fe),Bt=Le?Le.to.original:$t,ri=E.arr(lt)?lt[0]:Bt,wi=Qt(ri)||Qt($t),Ui=Yt||wi;return E.und(Tt)&&(Tt=Bt),Ke.from=ce(ri,Ui),Ke.to=ce(At(Tt,ri),Ui),Ke.start=Le?Le.end:0,Ke.end=Ke.start+Ke.delay+Ke.duration+Ke.endDelay,Ke.easing=k(Ke.easing,Ke.duration),Ke.isPath=E.pth(lt),Ke.isColor=E.col(Ke.from.original),Ke.isColor&&(Ke.round=1),Le=Ke,Ke})}var ki={css:function(ae,fe,Le){return ae.style[fe]=Le},attribute:function(ae,fe,Le){return ae.setAttribute(fe,Le)},object:function(ae,fe,Le){return ae[fe]=Le},transform:function(ae,fe,Le,Ue,Ke){if(Ue.list.set(fe,Le),fe===Ue.last||Ke){var lt="";Ue.list.forEach(function(Tt,Yt){lt+=Yt+"("+Tt+") "}),ae.style.transform=lt}}};function mn(ae,fe){for(var Le=Ve(ae),Ue=0,Ke=Le.length;Ue<Ke;Ue++){var lt=Le[Ue];for(var Tt in fe){var Yt=bi(fe[Tt],lt),$t=lt.target,Bt=Qt(Yt),ri=We($t,Tt,Bt,lt),wi=Bt||Qt(ri),Ui=At(Zt(Yt,wi),ri),Sr=Si($t,Tt);ki[Sr]($t,Tt,Ui,lt.transforms,!0)}}}function kr(ae,fe){var Le=Si(ae.target,fe.name);if(Le){var Ue=xr(fe,ae),Ke=Ue[Ue.length-1];return{type:Le,property:fe.name,animatable:ae,tweens:Ue,duration:Ke.end,delay:Ue[0].delay,endDelay:Ke.endDelay}}}function rn(ae,fe){return j(Q(ae.map(function(Le){return fe.map(function(Ue){return kr(Le,Ue)})})),function(Le){return!E.und(Le)})}function vs(ae,fe){var Le=ae.length,Ue=function(lt){return lt.timelineOffset?lt.timelineOffset:0},Ke={};return Ke.duration=Le?Math.max.apply(Math,ae.map(function(lt){return Ue(lt)+lt.duration})):fe.duration,Ke.delay=Le?Math.min.apply(Math,ae.map(function(lt){return Ue(lt)+lt.delay})):fe.delay,Ke.endDelay=Le?Ke.duration-Math.max.apply(Math,ae.map(function(lt){return Ue(lt)+lt.duration-lt.endDelay})):fe.endDelay,Ke}var gn=0;function Ls(ae){var fe=te(h,ae),Le=te(p,ae),Ue=Vt(Le,ae),Ke=Ve(ae.targets),lt=rn(Ke,Ue),Tt=vs(lt,Le),Yt=gn;return gn++,Y(fe,{id:Yt,children:[],animatables:Ke,animations:lt,duration:Tt.duration,delay:Tt.delay,endDelay:Tt.endDelay})}var es=[],bs=[],pe,ct=function(){function ae(){pe=requestAnimationFrame(fe)}function fe(Le){var Ue=es.length;if(Ue){for(var Ke=0;Ke<Ue;){var lt=es[Ke];if(!lt.paused)lt.tick(Le);else{var Tt=es.indexOf(lt);Tt>-1&&(es.splice(Tt,1),Ue=es.length)}Ke++}ae()}else pe=cancelAnimationFrame(pe)}return ae}();function Rt(){if(document.hidden){for(var ae=0,fe=es.length;ae<fe;ae++)activeInstance[ae].pause();bs=es.slice(0),es=[]}else for(var Le=0,Ue=bs.length;Le<Ue;Le++)bs[Le].play()}document.addEventListener("visibilitychange",Rt);function Kt(ae){ae===void 0&&(ae={});var fe=0,Le=0,Ue=0,Ke,lt=0,Tt=null;function Yt(){return window.Promise&&new Promise(function(Ii){return Tt=Ii})}var $t=Yt(),Bt=Ls(ae);function ri(){Bt.reversed=!Bt.reversed;for(var Ii=0,ar=Ke.length;Ii<ar;Ii++)Ke[Ii].reversed=Bt.reversed}function wi(Ii){return Bt.reversed?Bt.duration-Ii:Ii}function Ui(){fe=0,Le=wi(Bt.currentTime)*(1/Kt.speed)}function Sr(Ii,ar){ar&&ar.seek(Ii-ar.timelineOffset)}function ur(Ii){if(Bt.reversePlayback)for(var ar=lt;ar--;)Sr(Ii,Ke[ar]);else for(var hn=0;hn<lt;hn++)Sr(Ii,Ke[hn])}function $i(Ii){for(var ar=0,hn=Bt.animations,qr=hn.length;ar<qr;){var X=hn[ar],ue=X.animatable,ye=X.tweens,Te=ye.length-1,Qe=ye[Te];Te&&(Qe=j(ye,function(dr){return Ii<dr.end})[0]||Qe);for(var Ye=m(Ii-Qe.start-Qe.delay,0,Qe.duration)/Qe.duration,mt=isNaN(Ye)?1:Qe.easing(Ye),he=Qe.to.strings,le=Qe.round,de=[],xe=Qe.to.numbers.length,Ee=void 0,ot=0;ot<xe;ot++){var Mt=void 0,Wt=Qe.to.numbers[ot],ni=Qe.from.numbers[ot]||0;Qe.isPath?Mt=re(Qe.value,mt*Wt):Mt=ni+mt*(Wt-ni),le&&(Qe.isColor&&ot>2||(Mt=Math.round(Mt*le)/le)),de.push(Mt)}var Ai=he.length;if(!Ai)Ee=de[0];else{Ee=he[0];for(var qt=0;qt<Ai;qt++){he[qt];var Li=he[qt+1],yr=de[qt];isNaN(yr)||(Li?Ee+=yr+Li:Ee+=yr+" ")}}ki[X.type](ue.target,X.property,Ee,ue.transforms),X.currentValue=Ee,ar++}}function _i(Ii){Bt[Ii]&&!Bt.passThrough&&Bt[Ii](Bt)}function Mn(){Bt.remaining&&Bt.remaining!==!0&&Bt.remaining--}function Xn(Ii){var ar=Bt.duration,hn=Bt.delay,qr=ar-Bt.endDelay,X=wi(Ii);Bt.progress=m(X/ar*100,0,100),Bt.reversePlayback=X<Bt.currentTime,Ke&&ur(X),!Bt.began&&Bt.currentTime>0&&(Bt.began=!0,_i("begin"),_i("loopBegin")),X<=hn&&Bt.currentTime!==0&&$i(0),(X>=qr&&Bt.currentTime!==ar||!ar)&&$i(ar),X>hn&&X<qr?(Bt.changeBegan||(Bt.changeBegan=!0,Bt.changeCompleted=!1,_i("changeBegin")),_i("change"),$i(X)):Bt.changeBegan&&(Bt.changeCompleted=!0,Bt.changeBegan=!1,_i("changeComplete")),Bt.currentTime=m(X,0,ar),Bt.began&&_i("update"),Ii>=ar&&(Le=0,Mn(),Bt.remaining?(fe=Ue,_i("loopComplete"),_i("loopBegin"),Bt.direction==="alternate"&&ri()):(Bt.paused=!0,Bt.completed||(Bt.completed=!0,_i("loopComplete"),_i("complete"),"Promise"in window&&(Tt(),$t=Yt()))))}return Bt.reset=function(){var Ii=Bt.direction;Bt.passThrough=!1,Bt.currentTime=0,Bt.progress=0,Bt.paused=!0,Bt.began=!1,Bt.changeBegan=!1,Bt.completed=!1,Bt.changeCompleted=!1,Bt.reversePlayback=!1,Bt.reversed=Ii==="reverse",Bt.remaining=Bt.loop,Ke=Bt.children,lt=Ke.length;for(var ar=lt;ar--;)Bt.children[ar].reset();(Bt.reversed&&Bt.loop!==!0||Ii==="alternate"&&Bt.loop===1)&&Bt.remaining++,$i(0)},Bt.set=function(Ii,ar){return mn(Ii,ar),Bt},Bt.tick=function(Ii){Ue=Ii,fe||(fe=Ue),Xn((Ue+(Le-fe))*Kt.speed)},Bt.seek=function(Ii){Xn(wi(Ii))},Bt.pause=function(){Bt.paused=!0,Ui()},Bt.play=function(){Bt.paused&&(Bt.paused=!1,es.push(Bt),Ui(),pe||ct())},Bt.reverse=function(){ri(),Ui()},Bt.restart=function(){Bt.reset(),Bt.play()},Bt.finished=$t,Bt.reset(),Bt.autoplay&&Bt.play(),Bt}function Bi(ae,fe){for(var Le=fe.length;Le--;)G(ae,fe[Le].animatable.target)&&fe.splice(Le,1)}function sr(ae){for(var fe=ze(ae),Le=es.length;Le--;){var Ue=es[Le],Ke=Ue.animations,lt=Ue.children;Bi(fe,Ke);for(var Tt=lt.length;Tt--;){var Yt=lt[Tt],$t=Yt.animations;Bi(fe,$t),!$t.length&&!Yt.children.length&&lt.splice(Tt,1)}!Ke.length&&!lt.length&&Ue.pause()}}function Di(ae,fe){fe===void 0&&(fe={});var Le=fe.direction||"normal",Ue=fe.easing?k(fe.easing):null,Ke=fe.grid,lt=fe.axis,Tt=fe.from||0,Yt=Tt==="first",$t=Tt==="center",Bt=Tt==="last",ri=E.arr(ae),wi=parseFloat(ri?ae[0]:ae),Ui=ri?parseFloat(ae[1]):0,Sr=Qt(ri?ae[1]:ae)||0,ur=fe.start||0+(ri?wi:0),$i=[],_i=0;return function(Mn,Xn,Ii){if(Yt&&(Tt=0),$t&&(Tt=(Ii-1)/2),Bt&&(Tt=Ii-1),!$i.length){for(var ar=0;ar<Ii;ar++){if(!Ke)$i.push(Math.abs(Tt-ar));else{var hn=$t?(Ke[0]-1)/2:Tt%Ke[0],qr=$t?(Ke[1]-1)/2:Math.floor(Tt/Ke[0]),X=ar%Ke[0],ue=Math.floor(ar/Ke[0]),ye=hn-X,Te=qr-ue,Qe=Math.sqrt(ye*ye+Te*Te);lt==="x"&&(Qe=-ye),lt==="y"&&(Qe=-Te),$i.push(Qe)}_i=Math.max.apply(Math,$i)}Ue&&($i=$i.map(function(mt){return Ue(mt/_i)*_i})),Le==="reverse"&&($i=$i.map(function(mt){return lt?mt<0?mt*-1:-mt:Math.abs(_i-mt)}))}var Ye=ri?(Ui-wi)/_i:wi;return ur+Ye*(Math.round($i[Xn]*100)/100)+Sr}}function Oi(ae){ae===void 0&&(ae={});var fe=Kt(ae);return fe.duration=0,fe.add=function(Le,Ue){var Ke=es.indexOf(fe),lt=fe.children;Ke>-1&&es.splice(Ke,1);function Tt(Ui){Ui.passThrough=!0}for(var Yt=0;Yt<lt.length;Yt++)Tt(lt[Yt]);var $t=Y(Le,te(p,ae));$t.targets=$t.targets||ae.targets;var Bt=fe.duration;$t.autoplay=!1,$t.direction=fe.direction,$t.timelineOffset=E.und(Ue)?Bt:At(Ue,Bt),Tt(fe),fe.seek($t.timelineOffset);var ri=Kt($t);Tt(ri),lt.push(ri);var wi=vs(lt,ae);return fe.delay=wi.delay,fe.endDelay=wi.endDelay,fe.duration=wi.duration,fe.seek(0),fe.reset(),fe.autoplay&&fe.play(),fe},fe}Kt.version="3.0.0",Kt.speed=1,Kt.running=es,Kt.remove=sr,Kt.get=We,Kt.set=mn,Kt.convertPx=Fi,Kt.path=$,Kt.setDashoffset=Fe,Kt.stagger=Di,Kt.timeline=Oi,Kt.easing=k,Kt.penner=P,Kt.random=function(ae,fe){return Math.floor(Math.random()*(fe-ae+1))+ae};const Be=Kt},"./node_modules/three-bmfont-text/index.js":(l,u,c)=>{var h=c("./node_modules/layout-bmfont-text/index.js"),p=c("./node_modules/quad-indices/index.js"),f=c("./node_modules/three-bmfont-text/lib/vertices.js"),g=c("./node_modules/three-bmfont-text/lib/utils.js");l.exports=function(y){return new m(y)};class m extends THREE.BufferGeometry{constructor(b){super(),typeof b=="string"&&(b={text:b}),this._opt=Object.assign({},b),b&&this.update(b)}update(b){if(typeof b=="string"&&(b={text:b}),b=Object.assign({},this._opt,b),!b.font)throw new TypeError("must specify a { font } in options");this.layout=h(b);var v=b.flipY!==!1,_=b.font,T=_.common.scaleW,E=_.common.scaleH,C=this.layout.glyphs.filter(function(D){var P=D.data;return P.width*P.height>0});this.visibleGlyphs=C;var R=f.positions(C),B=f.uvs(C,T,E,v),I=p([],{clockwise:!0,type:"uint16",count:C.length});if(this.setIndex(I),this.setAttribute("position",new THREE.BufferAttribute(R,2)),this.setAttribute("uv",new THREE.BufferAttribute(B,2)),!b.multipage&&"page"in this.attributes)this.removeAttribute("page");else if(b.multipage){var N=f.pages(C);this.setAttribute("page",new THREE.BufferAttribute(N,1))}this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere()}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new THREE.Sphere);var b=this.attributes.position.array,v=this.attributes.position.itemSize;if(!b||!v||b.length<2){this.boundingSphere.radius=0,this.boundingSphere.center.set(0,0,0);return}g.computeSphere(b,this.boundingSphere),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new THREE.Box3);var b=this.boundingBox,v=this.attributes.position.array,_=this.attributes.position.itemSize;if(!v||!_||v.length<2){b.makeEmpty();return}g.computeBox(v,b)}}},"./node_modules/three-bmfont-text/lib/utils.js":l=>{var u=2,c={min:[0,0],max:[0,0]};function h(p){var f=p.length/u;c.min[0]=p[0],c.min[1]=p[1],c.max[0]=p[0],c.max[1]=p[1];for(var g=0;g<f;g++){var m=p[g*u+0],y=p[g*u+1];c.min[0]=Math.min(m,c.min[0]),c.min[1]=Math.min(y,c.min[1]),c.max[0]=Math.max(m,c.max[0]),c.max[1]=Math.max(y,c.max[1])}}l.exports.computeBox=function(p,f){h(p),f.min.set(c.min[0],c.min[1],0),f.max.set(c.max[0],c.max[1],0)},l.exports.computeSphere=function(p,f){h(p);var g=c.min[0],m=c.min[1],y=c.max[0],b=c.max[1],v=y-g,_=b-m,T=Math.sqrt(v*v+_*_);f.center.set(g+v/2,m+_/2,0),f.radius=T/2}},"./node_modules/three-bmfont-text/lib/vertices.js":l=>{l.exports.pages=function(u){var c=new Float32Array(u.length*4*1),h=0;return u.forEach(function(p){var f=p.data.page||0;c[h++]=f,c[h++]=f,c[h++]=f,c[h++]=f}),c},l.exports.uvs=function(u,c,h,p){var f=new Float32Array(u.length*4*2),g=0;return u.forEach(function(m){var y=m.data,b=y.x+y.width,v=y.y+y.height,_=y.x/c,T=y.y/h,E=b/c,C=v/h;p&&(T=(h-y.y)/h,C=(h-v)/h),f[g++]=_,f[g++]=T,f[g++]=_,f[g++]=C,f[g++]=E,f[g++]=C,f[g++]=E,f[g++]=T}),f},l.exports.positions=function(u){var c=new Float32Array(u.length*4*2),h=0;return u.forEach(function(p){var f=p.data,g=p.position[0]+f.xoffset,m=p.position[1]+f.yoffset,y=f.width,b=f.height;c[h++]=g,c[h++]=m,c[h++]=g,c[h++]=m+b,c[h++]=g+y,c[h++]=m+b,c[h++]=g+y,c[h++]=m}),c}},"./node_modules/webvr-polyfill/build/webvr-polyfill.js":function(l,u,c){/**
 * @license
 * webvr-polyfill
 * Copyright (c) 2015-2017 Google
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * cardboard-vr-display
 * Copyright (c) 2015-2017 Google
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * webvr-polyfill-dpdb 
 * Copyright (c) 2017 Google
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * wglu-preserve-state
 * Copyright (c) 2016, Brandon Jones.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *//**
 * @license
 * nosleep.js
 * Copyright (c) 2017, Rich Tibbett
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */(function(h,p){l.exports=p()})(this,function(){var h=typeof window<"u"?window:typeof c.g<"u"?c.g:typeof self<"u"?self:{};function p(I){return I&&I.__esModule&&Object.prototype.hasOwnProperty.call(I,"default")?I.default:I}function f(I,N){return N={exports:{}},I(N,N.exports),N.exports}var g=function(){return/Android/i.test(navigator.userAgent)||/iPhone|iPad|iPod/i.test(navigator.userAgent)},m=function(I,N){for(var D=0,P=I.length;D<P;D++)N[D]=I[D]},y=function(I,N){for(var D in N)N.hasOwnProperty(D)&&(I[D]=N[D]);return I},b=f(function(I,N){/**
 * @license
 * cardboard-vr-display
 * Copyright (c) 2015-2017 Google
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * gl-preserve-state
 * Copyright (c) 2016, Brandon Jones.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *//**
 * @license
 * webvr-polyfill-dpdb
 * Copyright (c) 2015-2017 Google
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * nosleep.js
 * Copyright (c) 2017, Rich Tibbett
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */(function(D,P){I.exports=P()})(h,function(){var D=function(X,ue){if(!(X instanceof ue))throw new TypeError("Cannot call a class as a function")},P=function(){function X(ue,ye){for(var Te=0;Te<ye.length;Te++){var Qe=ye[Te];Qe.enumerable=Qe.enumerable||!1,Qe.configurable=!0,"value"in Qe&&(Qe.writable=!0),Object.defineProperty(ue,Qe.key,Qe)}}return function(ue,ye,Te){return ye&&X(ue.prototype,ye),Te&&X(ue,Te),ue}}(),k=function(){function X(ue,ye){var Te=[],Qe=!0,Ye=!1,mt=void 0;try{for(var he=ue[Symbol.iterator](),le;!(Qe=(le=he.next()).done)&&(Te.push(le.value),!(ye&&Te.length===ye));Qe=!0);}catch(de){Ye=!0,mt=de}finally{try{!Qe&&he.return&&he.return()}finally{if(Ye)throw mt}}return Te}return function(ue,ye){if(Array.isArray(ue))return ue;if(Symbol.iterator in Object(ue))return X(ue,ye);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),q=.001,V=1,j=function(X,ue){return"data:"+X+","+encodeURIComponent(ue)},Q=function(X,ue,ye){return X+(ue-X)*ye},W=function(){var X=/iPad|iPhone|iPod/.test(navigator.platform);return function(){return X}}(),G=function(){var X=navigator.userAgent.indexOf("Version")!==-1&&navigator.userAgent.indexOf("Android")!==-1&&navigator.userAgent.indexOf("Chrome")!==-1;return function(){return X}}(),z=function(){var X=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);return function(){return X}}(),te=function(){var X=navigator.userAgent.indexOf("Firefox")!==-1&&navigator.userAgent.indexOf("Android")!==-1;return function(){return X}}(),Y=function(){var X=navigator.userAgent.match(/.*Chrome\/([0-9]+)/),ue=X?parseInt(X[1],10):null;return function(){return ue}}(),se=function(){var X=!1;return X=W()&&z()&&navigator.userAgent.indexOf("13_4")!==-1,function(){return X}}(),ve=function(){var X=!1;if(Y()===65){var ue=navigator.userAgent.match(/.*Chrome\/([0-9\.]*)/);if(ue){var ye=ue[1].split("."),Te=k(ye,4);Te[0],Te[1];var Qe=Te[2],Ye=Te[3];X=parseInt(Qe,10)===3325&&parseInt(Ye,10)<148}}return function(){return X}}(),Ae=function(){var X=navigator.userAgent.indexOf("R7 Build")!==-1;return function(){return X}}(),me=function(){var X=window.orientation==90||window.orientation==-90;return Ae()?!X:X},Oe=function(X){return!(isNaN(X)||X<=q||X>V)},Xe=function(){return Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio},Je=function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio},it=function(X){if(G())return!1;if(X.requestFullscreen)X.requestFullscreen();else if(X.webkitRequestFullscreen)X.webkitRequestFullscreen();else if(X.mozRequestFullScreen)X.mozRequestFullScreen();else if(X.msRequestFullscreen)X.msRequestFullscreen();else return!1;return!0},dt=function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.msExitFullscreen)document.msExitFullscreen();else return!1;return!0},St=function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement},Qt=function(X,ue,ye,Te){var Qe=X.createShader(X.VERTEX_SHADER);X.shaderSource(Qe,ue),X.compileShader(Qe);var Ye=X.createShader(X.FRAGMENT_SHADER);X.shaderSource(Ye,ye),X.compileShader(Ye);var mt=X.createProgram();X.attachShader(mt,Qe),X.attachShader(mt,Ye);for(var he in Te)X.bindAttribLocation(mt,Te[he],he);return X.linkProgram(mt),X.deleteShader(Qe),X.deleteShader(Ye),mt},yt=function(X,ue){for(var ye={},Te=X.getProgramParameter(ue,X.ACTIVE_UNIFORMS),Qe="",Ye=0;Ye<Te;Ye++){var mt=X.getActiveUniform(ue,Ye);Qe=mt.name.replace("[0]",""),ye[Qe]=X.getUniformLocation(ue,Qe)}return ye},bi=function(X,ue,ye,Te,Qe,Ye,mt){var he=1/(ue-ye),le=1/(Te-Qe),de=1/(Ye-mt);return X[0]=-2*he,X[1]=0,X[2]=0,X[3]=0,X[4]=0,X[5]=-2*le,X[6]=0,X[7]=0,X[8]=0,X[9]=0,X[10]=2*de,X[11]=0,X[12]=(ue+ye)*he,X[13]=(Qe+Te)*le,X[14]=(mt+Ye)*de,X[15]=1,X},$e=function(){var X=!1;return function(ue){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(ue)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(ue.substr(0,4)))&&(X=!0)}(navigator.userAgent||navigator.vendor||window.opera),X},Fi=function(X,ue){for(var ye in ue)ue.hasOwnProperty(ye)&&(X[ye]=ue[ye]);return X},ui=function(X){if(W()){var ue=X.style.width,ye=X.style.height;X.style.width=parseInt(ue)+1+"px",X.style.height=parseInt(ye)+"px",setTimeout(function(){X.style.width=ue,X.style.height=ye},100)}window.canvas=X},Si=function(){var X=Math.PI/180,ue=Math.PI*.25;function ye(de,xe,Ee,ot){var Mt=Math.tan(xe?xe.upDegrees*X:ue),Wt=Math.tan(xe?xe.downDegrees*X:ue),ni=Math.tan(xe?xe.leftDegrees*X:ue),Ai=Math.tan(xe?xe.rightDegrees*X:ue),qt=2/(ni+Ai),Li=2/(Mt+Wt);return de[0]=qt,de[1]=0,de[2]=0,de[3]=0,de[4]=0,de[5]=Li,de[6]=0,de[7]=0,de[8]=-((ni-Ai)*qt*.5),de[9]=(Mt-Wt)*Li*.5,de[10]=ot/(Ee-ot),de[11]=-1,de[12]=0,de[13]=0,de[14]=ot*Ee/(Ee-ot),de[15]=0,de}function Te(de,xe,Ee){var ot=xe[0],Mt=xe[1],Wt=xe[2],ni=xe[3],Ai=ot+ot,qt=Mt+Mt,Li=Wt+Wt,yr=ot*Ai,dr=ot*qt,pr=ot*Li,Wi=Mt*qt,wr=Mt*Li,Tr=Wt*Li,Fr=ni*Ai,Vr=ni*qt,bn=ni*Li;return de[0]=1-(Wi+Tr),de[1]=dr+bn,de[2]=pr-Vr,de[3]=0,de[4]=dr-bn,de[5]=1-(yr+Tr),de[6]=wr+Fr,de[7]=0,de[8]=pr+Vr,de[9]=wr-Fr,de[10]=1-(yr+Wi),de[11]=0,de[12]=Ee[0],de[13]=Ee[1],de[14]=Ee[2],de[15]=1,de}function Qe(de,xe,Ee){var ot=Ee[0],Mt=Ee[1],Wt=Ee[2],ni,Ai,qt,Li,yr,dr,pr,Wi,wr,Tr,Fr,Vr;return xe===de?(de[12]=xe[0]*ot+xe[4]*Mt+xe[8]*Wt+xe[12],de[13]=xe[1]*ot+xe[5]*Mt+xe[9]*Wt+xe[13],de[14]=xe[2]*ot+xe[6]*Mt+xe[10]*Wt+xe[14],de[15]=xe[3]*ot+xe[7]*Mt+xe[11]*Wt+xe[15]):(ni=xe[0],Ai=xe[1],qt=xe[2],Li=xe[3],yr=xe[4],dr=xe[5],pr=xe[6],Wi=xe[7],wr=xe[8],Tr=xe[9],Fr=xe[10],Vr=xe[11],de[0]=ni,de[1]=Ai,de[2]=qt,de[3]=Li,de[4]=yr,de[5]=dr,de[6]=pr,de[7]=Wi,de[8]=wr,de[9]=Tr,de[10]=Fr,de[11]=Vr,de[12]=ni*ot+yr*Mt+wr*Wt+xe[12],de[13]=Ai*ot+dr*Mt+Tr*Wt+xe[13],de[14]=qt*ot+pr*Mt+Fr*Wt+xe[14],de[15]=Li*ot+Wi*Mt+Vr*Wt+xe[15]),de}function Ye(de,xe){var Ee=xe[0],ot=xe[1],Mt=xe[2],Wt=xe[3],ni=xe[4],Ai=xe[5],qt=xe[6],Li=xe[7],yr=xe[8],dr=xe[9],pr=xe[10],Wi=xe[11],wr=xe[12],Tr=xe[13],Fr=xe[14],Vr=xe[15],bn=Ee*Ai-ot*ni,jr=Ee*qt-Mt*ni,us=Ee*Li-Wt*ni,Nr=ot*qt-Mt*Ai,El=ot*Li-Wt*Ai,Ko=Mt*Li-Wt*qt,Mc=yr*Tr-dr*wr,tu=yr*Fr-pr*wr,iu=yr*Vr-Wi*wr,ao=dr*Fr-pr*Tr,ru=dr*Vr-Wi*Tr,Wa=pr*Vr-Wi*Fr,Nn=bn*Wa-jr*ru+us*ao+Nr*iu-El*tu+Ko*Mc;return Nn?(Nn=1/Nn,de[0]=(Ai*Wa-qt*ru+Li*ao)*Nn,de[1]=(Mt*ru-ot*Wa-Wt*ao)*Nn,de[2]=(Tr*Ko-Fr*El+Vr*Nr)*Nn,de[3]=(pr*El-dr*Ko-Wi*Nr)*Nn,de[4]=(qt*iu-ni*Wa-Li*tu)*Nn,de[5]=(Ee*Wa-Mt*iu+Wt*tu)*Nn,de[6]=(Fr*us-wr*Ko-Vr*jr)*Nn,de[7]=(yr*Ko-pr*us+Wi*jr)*Nn,de[8]=(ni*ru-Ai*iu+Li*Mc)*Nn,de[9]=(ot*iu-Ee*ru-Wt*Mc)*Nn,de[10]=(wr*El-Tr*us+Vr*bn)*Nn,de[11]=(dr*us-yr*El-Wi*bn)*Nn,de[12]=(Ai*tu-ni*ao-qt*Mc)*Nn,de[13]=(Ee*ao-ot*tu+Mt*Mc)*Nn,de[14]=(Tr*jr-wr*Nr-Fr*bn)*Nn,de[15]=(yr*Nr-dr*jr+pr*bn)*Nn,de):null}var mt=new Float32Array([0,0,0,1]),he=new Float32Array([0,0,0]);function le(de,xe,Ee,ot,Mt,Wt){ye(de,ot||null,Wt.depthNear,Wt.depthFar);var ni=Ee.orientation||mt,Ai=Ee.position||he;Te(xe,ni,Ai),Mt&&Qe(xe,xe,Mt),Ye(xe,xe)}return function(de,xe,Ee){return!de||!xe?!1:(de.pose=xe,de.timestamp=xe.timestamp,le(de.leftProjectionMatrix,de.leftViewMatrix,xe,Ee._getFieldOfView("left"),Ee._getEyeOffset("left"),Ee),le(de.rightProjectionMatrix,de.rightViewMatrix,xe,Ee._getFieldOfView("right"),Ee._getEyeOffset("right"),Ee),!0)}}(),Ei=function(){var X=window.self!==window.top,ue=Zi(document.referrer),ye=Zi(window.location.href);return X&&ue!==ye},Zi=function(X){var ue,ye=X.indexOf("://");ye!==-1?ue=ye+3:ue=0;var Te=X.indexOf("/",ue);return Te===-1&&(Te=X.length),X.substring(0,Te)},Vi=function(X){if(X.w>1)return console.warn("getQuaternionAngle: w > 1"),0;var ue=2*Math.acos(X.w);return ue},We=function(){var X={};return function(ue,ye){X[ue]===void 0&&(console.warn("webvr-polyfill: "+ye),X[ue]=!0)}}(),Ce=function(X,ue){var ye=ue?"Please use "+ue+" instead.":"";We(X,X+" has been deprecated. This may not work on native WebVR displays. "+ye)};function At(X,ue,ye){if(!ue){ye(X);return}for(var Te=[],Qe=null,Ye=0;Ye<ue.length;++Ye){var mt=ue[Ye];switch(mt){case X.TEXTURE_BINDING_2D:case X.TEXTURE_BINDING_CUBE_MAP:var he=ue[++Ye];if(he<X.TEXTURE0||he>X.TEXTURE31){console.error("TEXTURE_BINDING_2D or TEXTURE_BINDING_CUBE_MAP must be followed by a valid texture unit"),Te.push(null,null);break}Qe||(Qe=X.getParameter(X.ACTIVE_TEXTURE)),X.activeTexture(he),Te.push(X.getParameter(mt),null);break;case X.ACTIVE_TEXTURE:Qe=X.getParameter(X.ACTIVE_TEXTURE),Te.push(null);break;default:Te.push(X.getParameter(mt));break}}ye(X);for(var Ye=0;Ye<ue.length;++Ye){var mt=ue[Ye],le=Te[Ye];switch(mt){case X.ACTIVE_TEXTURE:break;case X.ARRAY_BUFFER_BINDING:X.bindBuffer(X.ARRAY_BUFFER,le);break;case X.COLOR_CLEAR_VALUE:X.clearColor(le[0],le[1],le[2],le[3]);break;case X.COLOR_WRITEMASK:X.colorMask(le[0],le[1],le[2],le[3]);break;case X.CURRENT_PROGRAM:X.useProgram(le);break;case X.ELEMENT_ARRAY_BUFFER_BINDING:X.bindBuffer(X.ELEMENT_ARRAY_BUFFER,le);break;case X.FRAMEBUFFER_BINDING:X.bindFramebuffer(X.FRAMEBUFFER,le);break;case X.RENDERBUFFER_BINDING:X.bindRenderbuffer(X.RENDERBUFFER,le);break;case X.TEXTURE_BINDING_2D:var he=ue[++Ye];if(he<X.TEXTURE0||he>X.TEXTURE31)break;X.activeTexture(he),X.bindTexture(X.TEXTURE_2D,le);break;case X.TEXTURE_BINDING_CUBE_MAP:var he=ue[++Ye];if(he<X.TEXTURE0||he>X.TEXTURE31)break;X.activeTexture(he),X.bindTexture(X.TEXTURE_CUBE_MAP,le);break;case X.VIEWPORT:X.viewport(le[0],le[1],le[2],le[3]);break;case X.BLEND:case X.CULL_FACE:case X.DEPTH_TEST:case X.SCISSOR_TEST:case X.STENCIL_TEST:le?X.enable(mt):X.disable(mt);break;default:console.log("No GL restore behavior for 0x"+mt.toString(16));break}Qe&&X.activeTexture(Qe)}}var Ot=At,Zt=["attribute vec2 position;","attribute vec3 texCoord;","varying vec2 vTexCoord;","uniform vec4 viewportOffsetScale[2];","void main() {","  vec4 viewport = viewportOffsetScale[int(texCoord.z)];","  vTexCoord = (texCoord.xy * viewport.zw) + viewport.xy;","  gl_Position = vec4( position, 1.0, 1.0 );","}"].join(`
`),jt=["precision mediump float;","uniform sampler2D diffuse;","varying vec2 vTexCoord;","void main() {","  gl_FragColor = texture2D(diffuse, vTexCoord);","}"].join(`
`);function xi(X,ue,ye,Te){this.gl=X,this.cardboardUI=ue,this.bufferScale=ye,this.dirtySubmitFrameBindings=Te,this.ctxAttribs=X.getContextAttributes(),this.instanceExt=X.getExtension("ANGLE_instanced_arrays"),this.meshWidth=20,this.meshHeight=20,this.bufferWidth=X.drawingBufferWidth,this.bufferHeight=X.drawingBufferHeight,this.realBindFramebuffer=X.bindFramebuffer,this.realEnable=X.enable,this.realDisable=X.disable,this.realColorMask=X.colorMask,this.realClearColor=X.clearColor,this.realViewport=X.viewport,W()||(this.realCanvasWidth=Object.getOwnPropertyDescriptor(X.canvas.__proto__,"width"),this.realCanvasHeight=Object.getOwnPropertyDescriptor(X.canvas.__proto__,"height")),this.isPatched=!1,this.lastBoundFramebuffer=null,this.cullFace=!1,this.depthTest=!1,this.blend=!1,this.scissorTest=!1,this.stencilTest=!1,this.viewport=[0,0,0,0],this.colorMask=[!0,!0,!0,!0],this.clearColor=[0,0,0,0],this.attribs={position:0,texCoord:1},this.program=Qt(X,Zt,jt,this.attribs),this.uniforms=yt(X,this.program),this.viewportOffsetScale=new Float32Array(8),this.setTextureBounds(),this.vertexBuffer=X.createBuffer(),this.indexBuffer=X.createBuffer(),this.indexCount=0,this.renderTarget=X.createTexture(),this.framebuffer=X.createFramebuffer(),this.depthStencilBuffer=null,this.depthBuffer=null,this.stencilBuffer=null,this.ctxAttribs.depth&&this.ctxAttribs.stencil?this.depthStencilBuffer=X.createRenderbuffer():this.ctxAttribs.depth?this.depthBuffer=X.createRenderbuffer():this.ctxAttribs.stencil&&(this.stencilBuffer=X.createRenderbuffer()),this.patch(),this.onResize()}xi.prototype.destroy=function(){var X=this.gl;this.unpatch(),X.deleteProgram(this.program),X.deleteBuffer(this.vertexBuffer),X.deleteBuffer(this.indexBuffer),X.deleteTexture(this.renderTarget),X.deleteFramebuffer(this.framebuffer),this.depthStencilBuffer&&X.deleteRenderbuffer(this.depthStencilBuffer),this.depthBuffer&&X.deleteRenderbuffer(this.depthBuffer),this.stencilBuffer&&X.deleteRenderbuffer(this.stencilBuffer),this.cardboardUI&&this.cardboardUI.destroy()},xi.prototype.onResize=function(){var X=this.gl,ue=this,ye=[X.RENDERBUFFER_BINDING,X.TEXTURE_BINDING_2D,X.TEXTURE0];Ot(X,ye,function(Te){ue.realBindFramebuffer.call(Te,Te.FRAMEBUFFER,null),ue.scissorTest&&ue.realDisable.call(Te,Te.SCISSOR_TEST),ue.realColorMask.call(Te,!0,!0,!0,!0),ue.realViewport.call(Te,0,0,Te.drawingBufferWidth,Te.drawingBufferHeight),ue.realClearColor.call(Te,0,0,0,1),Te.clear(Te.COLOR_BUFFER_BIT),ue.realBindFramebuffer.call(Te,Te.FRAMEBUFFER,ue.framebuffer),Te.bindTexture(Te.TEXTURE_2D,ue.renderTarget),Te.texImage2D(Te.TEXTURE_2D,0,ue.ctxAttribs.alpha?Te.RGBA:Te.RGB,ue.bufferWidth,ue.bufferHeight,0,ue.ctxAttribs.alpha?Te.RGBA:Te.RGB,Te.UNSIGNED_BYTE,null),Te.texParameteri(Te.TEXTURE_2D,Te.TEXTURE_MAG_FILTER,Te.LINEAR),Te.texParameteri(Te.TEXTURE_2D,Te.TEXTURE_MIN_FILTER,Te.LINEAR),Te.texParameteri(Te.TEXTURE_2D,Te.TEXTURE_WRAP_S,Te.CLAMP_TO_EDGE),Te.texParameteri(Te.TEXTURE_2D,Te.TEXTURE_WRAP_T,Te.CLAMP_TO_EDGE),Te.framebufferTexture2D(Te.FRAMEBUFFER,Te.COLOR_ATTACHMENT0,Te.TEXTURE_2D,ue.renderTarget,0),ue.ctxAttribs.depth&&ue.ctxAttribs.stencil?(Te.bindRenderbuffer(Te.RENDERBUFFER,ue.depthStencilBuffer),Te.renderbufferStorage(Te.RENDERBUFFER,Te.DEPTH_STENCIL,ue.bufferWidth,ue.bufferHeight),Te.framebufferRenderbuffer(Te.FRAMEBUFFER,Te.DEPTH_STENCIL_ATTACHMENT,Te.RENDERBUFFER,ue.depthStencilBuffer)):ue.ctxAttribs.depth?(Te.bindRenderbuffer(Te.RENDERBUFFER,ue.depthBuffer),Te.renderbufferStorage(Te.RENDERBUFFER,Te.DEPTH_COMPONENT16,ue.bufferWidth,ue.bufferHeight),Te.framebufferRenderbuffer(Te.FRAMEBUFFER,Te.DEPTH_ATTACHMENT,Te.RENDERBUFFER,ue.depthBuffer)):ue.ctxAttribs.stencil&&(Te.bindRenderbuffer(Te.RENDERBUFFER,ue.stencilBuffer),Te.renderbufferStorage(Te.RENDERBUFFER,Te.STENCIL_INDEX8,ue.bufferWidth,ue.bufferHeight),Te.framebufferRenderbuffer(Te.FRAMEBUFFER,Te.STENCIL_ATTACHMENT,Te.RENDERBUFFER,ue.stencilBuffer)),!Te.checkFramebufferStatus(Te.FRAMEBUFFER)===Te.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer incomplete!"),ue.realBindFramebuffer.call(Te,Te.FRAMEBUFFER,ue.lastBoundFramebuffer),ue.scissorTest&&ue.realEnable.call(Te,Te.SCISSOR_TEST),ue.realColorMask.apply(Te,ue.colorMask),ue.realViewport.apply(Te,ue.viewport),ue.realClearColor.apply(Te,ue.clearColor)}),this.cardboardUI&&this.cardboardUI.onResize()},xi.prototype.patch=function(){if(!this.isPatched){var X=this,ue=this.gl.canvas,ye=this.gl;W()||(ue.width=Xe()*this.bufferScale,ue.height=Je()*this.bufferScale,Object.defineProperty(ue,"width",{configurable:!0,enumerable:!0,get:function(){return X.bufferWidth},set:function(Te){X.bufferWidth=Te,X.realCanvasWidth.set.call(ue,Te),X.onResize()}}),Object.defineProperty(ue,"height",{configurable:!0,enumerable:!0,get:function(){return X.bufferHeight},set:function(Te){X.bufferHeight=Te,X.realCanvasHeight.set.call(ue,Te),X.onResize()}})),this.lastBoundFramebuffer=ye.getParameter(ye.FRAMEBUFFER_BINDING),this.lastBoundFramebuffer==null&&(this.lastBoundFramebuffer=this.framebuffer,this.gl.bindFramebuffer(ye.FRAMEBUFFER,this.framebuffer)),this.gl.bindFramebuffer=function(Te,Qe){X.lastBoundFramebuffer=Qe||X.framebuffer,X.realBindFramebuffer.call(ye,Te,X.lastBoundFramebuffer)},this.cullFace=ye.getParameter(ye.CULL_FACE),this.depthTest=ye.getParameter(ye.DEPTH_TEST),this.blend=ye.getParameter(ye.BLEND),this.scissorTest=ye.getParameter(ye.SCISSOR_TEST),this.stencilTest=ye.getParameter(ye.STENCIL_TEST),ye.enable=function(Te){switch(Te){case ye.CULL_FACE:X.cullFace=!0;break;case ye.DEPTH_TEST:X.depthTest=!0;break;case ye.BLEND:X.blend=!0;break;case ye.SCISSOR_TEST:X.scissorTest=!0;break;case ye.STENCIL_TEST:X.stencilTest=!0;break}X.realEnable.call(ye,Te)},ye.disable=function(Te){switch(Te){case ye.CULL_FACE:X.cullFace=!1;break;case ye.DEPTH_TEST:X.depthTest=!1;break;case ye.BLEND:X.blend=!1;break;case ye.SCISSOR_TEST:X.scissorTest=!1;break;case ye.STENCIL_TEST:X.stencilTest=!1;break}X.realDisable.call(ye,Te)},this.colorMask=ye.getParameter(ye.COLOR_WRITEMASK),ye.colorMask=function(Te,Qe,Ye,mt){X.colorMask[0]=Te,X.colorMask[1]=Qe,X.colorMask[2]=Ye,X.colorMask[3]=mt,X.realColorMask.call(ye,Te,Qe,Ye,mt)},this.clearColor=ye.getParameter(ye.COLOR_CLEAR_VALUE),ye.clearColor=function(Te,Qe,Ye,mt){X.clearColor[0]=Te,X.clearColor[1]=Qe,X.clearColor[2]=Ye,X.clearColor[3]=mt,X.realClearColor.call(ye,Te,Qe,Ye,mt)},this.viewport=ye.getParameter(ye.VIEWPORT),ye.viewport=function(Te,Qe,Ye,mt){X.viewport[0]=Te,X.viewport[1]=Qe,X.viewport[2]=Ye,X.viewport[3]=mt,X.realViewport.call(ye,Te,Qe,Ye,mt)},this.isPatched=!0,ui(ue)}},xi.prototype.unpatch=function(){if(this.isPatched){var X=this.gl,ue=this.gl.canvas;W()||(Object.defineProperty(ue,"width",this.realCanvasWidth),Object.defineProperty(ue,"height",this.realCanvasHeight)),ue.width=this.bufferWidth,ue.height=this.bufferHeight,X.bindFramebuffer=this.realBindFramebuffer,X.enable=this.realEnable,X.disable=this.realDisable,X.colorMask=this.realColorMask,X.clearColor=this.realClearColor,X.viewport=this.realViewport,this.lastBoundFramebuffer==this.framebuffer&&X.bindFramebuffer(X.FRAMEBUFFER,null),this.isPatched=!1,setTimeout(function(){ui(ue)},1)}},xi.prototype.setTextureBounds=function(X,ue){X||(X=[0,0,.5,1]),ue||(ue=[.5,0,.5,1]),this.viewportOffsetScale[0]=X[0],this.viewportOffsetScale[1]=X[1],this.viewportOffsetScale[2]=X[2],this.viewportOffsetScale[3]=X[3],this.viewportOffsetScale[4]=ue[0],this.viewportOffsetScale[5]=ue[1],this.viewportOffsetScale[6]=ue[2],this.viewportOffsetScale[7]=ue[3]},xi.prototype.submitFrame=function(){var X=this.gl,ue=this,ye=[];if(this.dirtySubmitFrameBindings||ye.push(X.CURRENT_PROGRAM,X.ARRAY_BUFFER_BINDING,X.ELEMENT_ARRAY_BUFFER_BINDING,X.TEXTURE_BINDING_2D,X.TEXTURE0),Ot(X,ye,function(Qe){ue.realBindFramebuffer.call(Qe,Qe.FRAMEBUFFER,null);var Ye=0,mt=0;ue.instanceExt&&(Ye=Qe.getVertexAttrib(ue.attribs.position,ue.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE),mt=Qe.getVertexAttrib(ue.attribs.texCoord,ue.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE)),ue.cullFace&&ue.realDisable.call(Qe,Qe.CULL_FACE),ue.depthTest&&ue.realDisable.call(Qe,Qe.DEPTH_TEST),ue.blend&&ue.realDisable.call(Qe,Qe.BLEND),ue.scissorTest&&ue.realDisable.call(Qe,Qe.SCISSOR_TEST),ue.stencilTest&&ue.realDisable.call(Qe,Qe.STENCIL_TEST),ue.realColorMask.call(Qe,!0,!0,!0,!0),ue.realViewport.call(Qe,0,0,Qe.drawingBufferWidth,Qe.drawingBufferHeight),(ue.ctxAttribs.alpha||W())&&(ue.realClearColor.call(Qe,0,0,0,1),Qe.clear(Qe.COLOR_BUFFER_BIT)),Qe.useProgram(ue.program),Qe.bindBuffer(Qe.ELEMENT_ARRAY_BUFFER,ue.indexBuffer),Qe.bindBuffer(Qe.ARRAY_BUFFER,ue.vertexBuffer),Qe.enableVertexAttribArray(ue.attribs.position),Qe.enableVertexAttribArray(ue.attribs.texCoord),Qe.vertexAttribPointer(ue.attribs.position,2,Qe.FLOAT,!1,20,0),Qe.vertexAttribPointer(ue.attribs.texCoord,3,Qe.FLOAT,!1,20,8),ue.instanceExt&&(Ye!=0&&ue.instanceExt.vertexAttribDivisorANGLE(ue.attribs.position,0),mt!=0&&ue.instanceExt.vertexAttribDivisorANGLE(ue.attribs.texCoord,0)),Qe.activeTexture(Qe.TEXTURE0),Qe.uniform1i(ue.uniforms.diffuse,0),Qe.bindTexture(Qe.TEXTURE_2D,ue.renderTarget),Qe.uniform4fv(ue.uniforms.viewportOffsetScale,ue.viewportOffsetScale),Qe.drawElements(Qe.TRIANGLES,ue.indexCount,Qe.UNSIGNED_SHORT,0),ue.cardboardUI&&ue.cardboardUI.renderNoState(),ue.realBindFramebuffer.call(ue.gl,Qe.FRAMEBUFFER,ue.framebuffer),ue.ctxAttribs.preserveDrawingBuffer||(ue.realClearColor.call(Qe,0,0,0,0),Qe.clear(Qe.COLOR_BUFFER_BIT)),ue.dirtySubmitFrameBindings||ue.realBindFramebuffer.call(Qe,Qe.FRAMEBUFFER,ue.lastBoundFramebuffer),ue.cullFace&&ue.realEnable.call(Qe,Qe.CULL_FACE),ue.depthTest&&ue.realEnable.call(Qe,Qe.DEPTH_TEST),ue.blend&&ue.realEnable.call(Qe,Qe.BLEND),ue.scissorTest&&ue.realEnable.call(Qe,Qe.SCISSOR_TEST),ue.stencilTest&&ue.realEnable.call(Qe,Qe.STENCIL_TEST),ue.realColorMask.apply(Qe,ue.colorMask),ue.realViewport.apply(Qe,ue.viewport),(ue.ctxAttribs.alpha||!ue.ctxAttribs.preserveDrawingBuffer)&&ue.realClearColor.apply(Qe,ue.clearColor),ue.instanceExt&&(Ye!=0&&ue.instanceExt.vertexAttribDivisorANGLE(ue.attribs.position,Ye),mt!=0&&ue.instanceExt.vertexAttribDivisorANGLE(ue.attribs.texCoord,mt))}),W()){var Te=X.canvas;(Te.width!=ue.bufferWidth||Te.height!=ue.bufferHeight)&&(ue.bufferWidth=Te.width,ue.bufferHeight=Te.height,ue.onResize())}},xi.prototype.updateDeviceInfo=function(X){var ue=this.gl,ye=this,Te=[ue.ARRAY_BUFFER_BINDING,ue.ELEMENT_ARRAY_BUFFER_BINDING];Ot(ue,Te,function(Qe){var Ye=ye.computeMeshVertices_(ye.meshWidth,ye.meshHeight,X);if(Qe.bindBuffer(Qe.ARRAY_BUFFER,ye.vertexBuffer),Qe.bufferData(Qe.ARRAY_BUFFER,Ye,Qe.STATIC_DRAW),!ye.indexCount){var mt=ye.computeMeshIndices_(ye.meshWidth,ye.meshHeight);Qe.bindBuffer(Qe.ELEMENT_ARRAY_BUFFER,ye.indexBuffer),Qe.bufferData(Qe.ELEMENT_ARRAY_BUFFER,mt,Qe.STATIC_DRAW),ye.indexCount=mt.length}})},xi.prototype.computeMeshVertices_=function(X,ue,ye){for(var Te=new Float32Array(2*X*ue*5),Qe=ye.getLeftEyeVisibleTanAngles(),Ye=ye.getLeftEyeNoLensTanAngles(),mt=ye.getLeftEyeVisibleScreenRect(Ye),he=0,le=0;le<2;le++){for(var de=0;de<ue;de++)for(var xe=0;xe<X;xe++,he++){var Ee=xe/(X-1),ot=de/(ue-1),Mt=Ee,Wt=ot,ni=Q(Qe[0],Qe[2],Ee),Ai=Q(Qe[3],Qe[1],ot),qt=Math.sqrt(ni*ni+Ai*Ai),Li=ye.distortion.distortInverse(qt),yr=ni*Li/qt,dr=Ai*Li/qt;Ee=(yr-Ye[0])/(Ye[2]-Ye[0]),ot=(dr-Ye[3])/(Ye[1]-Ye[3]),Ee=(mt.x+Ee*mt.width-.5)*2,ot=(mt.y+ot*mt.height-.5)*2,Te[he*5+0]=Ee,Te[he*5+1]=ot,Te[he*5+2]=Mt,Te[he*5+3]=Wt,Te[he*5+4]=le}var pr=Qe[2]-Qe[0];Qe[0]=-(pr+Qe[0]),Qe[2]=pr-Qe[2],pr=Ye[2]-Ye[0],Ye[0]=-(pr+Ye[0]),Ye[2]=pr-Ye[2],mt.x=1-(mt.x+mt.width)}return Te},xi.prototype.computeMeshIndices_=function(X,ue){for(var ye=new Uint16Array(2*(X-1)*(ue-1)*6),Te=X/2,Qe=ue/2,Ye=0,mt=0,he=0;he<2;he++)for(var le=0;le<ue;le++)for(var de=0;de<X;de++,Ye++)de==0||le==0||(de<=Te==le<=Qe?(ye[mt++]=Ye,ye[mt++]=Ye-X-1,ye[mt++]=Ye-X,ye[mt++]=Ye-X-1,ye[mt++]=Ye,ye[mt++]=Ye-1):(ye[mt++]=Ye-1,ye[mt++]=Ye-X,ye[mt++]=Ye,ye[mt++]=Ye-X,ye[mt++]=Ye-1,ye[mt++]=Ye-X-1));return ye},xi.prototype.getOwnPropertyDescriptor_=function(X,ue){var ye=Object.getOwnPropertyDescriptor(X,ue);return(ye.get===void 0||ye.set===void 0)&&(ye.configurable=!0,ye.enumerable=!0,ye.get=function(){return this.getAttribute(ue)},ye.set=function(Te){this.setAttribute(ue,Te)}),ye};var vt=["attribute vec2 position;","uniform mat4 projectionMat;","void main() {","  gl_Position = projectionMat * vec4( position, -1.0, 1.0 );","}"].join(`
`),ge=["precision mediump float;","uniform vec4 color;","void main() {","  gl_FragColor = color;","}"].join(`
`),be=Math.PI/180,Ne=60,Se=12,Fe=20,Ie=1,U=.75,$=.3125,re=4,Me=28,ce=1.5;function ze(X){this.gl=X,this.attribs={position:0},this.program=Qt(X,vt,ge,this.attribs),this.uniforms=yt(X,this.program),this.vertexBuffer=X.createBuffer(),this.gearOffset=0,this.gearVertexCount=0,this.arrowOffset=0,this.arrowVertexCount=0,this.projMat=new Float32Array(16),this.listener=null,this.onResize()}ze.prototype.destroy=function(){var X=this.gl;this.listener&&X.canvas.removeEventListener("click",this.listener,!1),X.deleteProgram(this.program),X.deleteBuffer(this.vertexBuffer)},ze.prototype.listen=function(X,ue){var ye=this.gl.canvas;this.listener=function(Te){var Qe=ye.clientWidth/2,Ye=Me*ce;Te.clientX>Qe-Ye&&Te.clientX<Qe+Ye&&Te.clientY>ye.clientHeight-Ye?X(Te):Te.clientX<Ye&&Te.clientY<Ye&&ue(Te)},ye.addEventListener("click",this.listener,!1)},ze.prototype.onResize=function(){var X=this.gl,ue=this,ye=[X.ARRAY_BUFFER_BINDING];Ot(X,ye,function(Te){var Qe=[],Ye=Te.drawingBufferWidth/2,mt=Math.max(screen.width,screen.height)*window.devicePixelRatio,he=Te.drawingBufferWidth/mt,le=he*window.devicePixelRatio,de=re*le/2,xe=Me*ce*le,Ee=Me*le/2,ot=(Me*ce-Me)*le;Qe.push(Ye-de,xe),Qe.push(Ye-de,Te.drawingBufferHeight),Qe.push(Ye+de,xe),Qe.push(Ye+de,Te.drawingBufferHeight),ue.gearOffset=Qe.length/2;function Mt(Li,yr){var dr=(90-Li)*be,pr=Math.cos(dr),Wi=Math.sin(dr);Qe.push($*pr*Ee+Ye,$*Wi*Ee+Ee),Qe.push(yr*pr*Ee+Ye,yr*Wi*Ee+Ee)}for(var Wt=0;Wt<=6;Wt++){var ni=Wt*Ne;Mt(ni,Ie),Mt(ni+Se,Ie),Mt(ni+Fe,U),Mt(ni+(Ne-Fe),U),Mt(ni+(Ne-Se),Ie)}ue.gearVertexCount=Qe.length/2-ue.gearOffset,ue.arrowOffset=Qe.length/2;function Ai(Li,yr){Qe.push(ot+Li,Te.drawingBufferHeight-ot-yr)}var qt=de/Math.sin(45*be);Ai(0,Ee),Ai(Ee,0),Ai(Ee+qt,qt),Ai(qt,Ee+qt),Ai(qt,Ee-qt),Ai(0,Ee),Ai(Ee,Ee*2),Ai(Ee+qt,Ee*2-qt),Ai(qt,Ee-qt),Ai(0,Ee),Ai(qt,Ee-de),Ai(Me*le,Ee-de),Ai(qt,Ee+de),Ai(Me*le,Ee+de),ue.arrowVertexCount=Qe.length/2-ue.arrowOffset,Te.bindBuffer(Te.ARRAY_BUFFER,ue.vertexBuffer),Te.bufferData(Te.ARRAY_BUFFER,new Float32Array(Qe),Te.STATIC_DRAW)})},ze.prototype.render=function(){var X=this.gl,ue=this,ye=[X.CULL_FACE,X.DEPTH_TEST,X.BLEND,X.SCISSOR_TEST,X.STENCIL_TEST,X.COLOR_WRITEMASK,X.VIEWPORT,X.CURRENT_PROGRAM,X.ARRAY_BUFFER_BINDING];Ot(X,ye,function(Te){Te.disable(Te.CULL_FACE),Te.disable(Te.DEPTH_TEST),Te.disable(Te.BLEND),Te.disable(Te.SCISSOR_TEST),Te.disable(Te.STENCIL_TEST),Te.colorMask(!0,!0,!0,!0),Te.viewport(0,0,Te.drawingBufferWidth,Te.drawingBufferHeight),ue.renderNoState()})},ze.prototype.renderNoState=function(){var X=this.gl;X.useProgram(this.program),X.bindBuffer(X.ARRAY_BUFFER,this.vertexBuffer),X.enableVertexAttribArray(this.attribs.position),X.vertexAttribPointer(this.attribs.position,2,X.FLOAT,!1,8,0),X.uniform4f(this.uniforms.color,1,1,1,1),bi(this.projMat,0,X.drawingBufferWidth,0,X.drawingBufferHeight,.1,1024),X.uniformMatrix4fv(this.uniforms.projectionMat,!1,this.projMat),X.drawArrays(X.TRIANGLE_STRIP,0,4),X.drawArrays(X.TRIANGLE_STRIP,this.gearOffset,this.gearVertexCount),X.drawArrays(X.TRIANGLE_STRIP,this.arrowOffset,this.arrowVertexCount)};function Ve(X){this.coefficients=X}Ve.prototype.distortInverse=function(X){for(var ue=0,ye=1,Te=X-this.distort(ue);Math.abs(ye-ue)>1e-4;){var Qe=X-this.distort(ye),Ye=ye-Qe*((ye-ue)/(Qe-Te));ue=ye,ye=Ye,Te=Qe}return ye},Ve.prototype.distort=function(X){for(var ue=X*X,ye=0,Te=0;Te<this.coefficients.length;Te++)ye=ue*(ye+this.coefficients[Te]);return(ye+1)*X};var pt=Math.PI/180,Dt=180/Math.PI,xt=function(X,ue,ye){this.x=X||0,this.y=ue||0,this.z=ye||0};xt.prototype={constructor:xt,set:function(X,ue,ye){return this.x=X,this.y=ue,this.z=ye,this},copy:function(X){return this.x=X.x,this.y=X.y,this.z=X.z,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var X=this.length();if(X!==0){var ue=1/X;this.multiplyScalar(ue)}else this.x=0,this.y=0,this.z=0;return this},multiplyScalar:function(X){this.x*=X,this.y*=X,this.z*=X},applyQuaternion:function(X){var ue=this.x,ye=this.y,Te=this.z,Qe=X.x,Ye=X.y,mt=X.z,he=X.w,le=he*ue+Ye*Te-mt*ye,de=he*ye+mt*ue-Qe*Te,xe=he*Te+Qe*ye-Ye*ue,Ee=-Qe*ue-Ye*ye-mt*Te;return this.x=le*he+Ee*-Qe+de*-mt-xe*-Ye,this.y=de*he+Ee*-Ye+xe*-Qe-le*-mt,this.z=xe*he+Ee*-mt+le*-Ye-de*-Qe,this},dot:function(X){return this.x*X.x+this.y*X.y+this.z*X.z},crossVectors:function(X,ue){var ye=X.x,Te=X.y,Qe=X.z,Ye=ue.x,mt=ue.y,he=ue.z;return this.x=Te*he-Qe*mt,this.y=Qe*Ye-ye*he,this.z=ye*mt-Te*Ye,this}};var Vt=function(X,ue,ye,Te){this.x=X||0,this.y=ue||0,this.z=ye||0,this.w=Te!==void 0?Te:1};Vt.prototype={constructor:Vt,set:function(X,ue,ye,Te){return this.x=X,this.y=ue,this.z=ye,this.w=Te,this},copy:function(X){return this.x=X.x,this.y=X.y,this.z=X.z,this.w=X.w,this},setFromEulerXYZ:function(X,ue,ye){var Te=Math.cos(X/2),Qe=Math.cos(ue/2),Ye=Math.cos(ye/2),mt=Math.sin(X/2),he=Math.sin(ue/2),le=Math.sin(ye/2);return this.x=mt*Qe*Ye+Te*he*le,this.y=Te*he*Ye-mt*Qe*le,this.z=Te*Qe*le+mt*he*Ye,this.w=Te*Qe*Ye-mt*he*le,this},setFromEulerYXZ:function(X,ue,ye){var Te=Math.cos(X/2),Qe=Math.cos(ue/2),Ye=Math.cos(ye/2),mt=Math.sin(X/2),he=Math.sin(ue/2),le=Math.sin(ye/2);return this.x=mt*Qe*Ye+Te*he*le,this.y=Te*he*Ye-mt*Qe*le,this.z=Te*Qe*le-mt*he*Ye,this.w=Te*Qe*Ye+mt*he*le,this},setFromAxisAngle:function(X,ue){var ye=ue/2,Te=Math.sin(ye);return this.x=X.x*Te,this.y=X.y*Te,this.z=X.z*Te,this.w=Math.cos(ye),this},multiply:function(X){return this.multiplyQuaternions(this,X)},multiplyQuaternions:function(X,ue){var ye=X.x,Te=X.y,Qe=X.z,Ye=X.w,mt=ue.x,he=ue.y,le=ue.z,de=ue.w;return this.x=ye*de+Ye*mt+Te*le-Qe*he,this.y=Te*de+Ye*he+Qe*mt-ye*le,this.z=Qe*de+Ye*le+ye*he-Te*mt,this.w=Ye*de-ye*mt-Te*he-Qe*le,this},inverse:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.normalize(),this},normalize:function(){var X=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return X===0?(this.x=0,this.y=0,this.z=0,this.w=1):(X=1/X,this.x=this.x*X,this.y=this.y*X,this.z=this.z*X,this.w=this.w*X),this},slerp:function(X,ue){if(ue===0)return this;if(ue===1)return this.copy(X);var ye=this.x,Te=this.y,Qe=this.z,Ye=this.w,mt=Ye*X.w+ye*X.x+Te*X.y+Qe*X.z;if(mt<0?(this.w=-X.w,this.x=-X.x,this.y=-X.y,this.z=-X.z,mt=-mt):this.copy(X),mt>=1)return this.w=Ye,this.x=ye,this.y=Te,this.z=Qe,this;var he=Math.acos(mt),le=Math.sqrt(1-mt*mt);if(Math.abs(le)<.001)return this.w=.5*(Ye+this.w),this.x=.5*(ye+this.x),this.y=.5*(Te+this.y),this.z=.5*(Qe+this.z),this;var de=Math.sin((1-ue)*he)/le,xe=Math.sin(ue*he)/le;return this.w=Ye*de+this.w*xe,this.x=ye*de+this.x*xe,this.y=Te*de+this.y*xe,this.z=Qe*de+this.z*xe,this},setFromUnitVectors:function(){var X,ue,ye=1e-6;return function(Te,Qe){return X===void 0&&(X=new xt),ue=Te.dot(Qe)+1,ue<ye?(ue=0,Math.abs(Te.x)>Math.abs(Te.z)?X.set(-Te.y,Te.x,0):X.set(0,-Te.z,Te.y)):X.crossVectors(Te,Qe),this.x=X.x,this.y=X.y,this.z=X.z,this.w=ue,this.normalize(),this}}()};function fi(X){this.width=X.width||Xe(),this.height=X.height||Je(),this.widthMeters=X.widthMeters,this.heightMeters=X.heightMeters,this.bevelMeters=X.bevelMeters}var xr=new fi({widthMeters:.11,heightMeters:.062,bevelMeters:.004}),ki=new fi({widthMeters:.1038,heightMeters:.0584,bevelMeters:.004}),mn={CardboardV1:new rn({id:"CardboardV1",label:"Cardboard I/O 2014",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]}),CardboardV2:new rn({id:"CardboardV2",label:"Cardboard I/O 2015",fov:60,interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-.0009904169,6183535e-11,-16981803e-13]})};function kr(X,ue){this.viewer=mn.CardboardV2,this.updateDeviceParams(X),this.distortion=new Ve(this.viewer.distortionCoefficients);for(var ye=0;ye<ue.length;ye++){var Te=ue[ye];mn[Te.id]=new rn(Te)}}kr.prototype.updateDeviceParams=function(X){this.device=this.determineDevice_(X)||this.device},kr.prototype.getDevice=function(){return this.device},kr.prototype.setViewer=function(X){this.viewer=X,this.distortion=new Ve(this.viewer.distortionCoefficients)},kr.prototype.determineDevice_=function(X){if(!X)return W()?(console.warn("Using fallback iOS device measurements."),ki):(console.warn("Using fallback Android device measurements."),xr);var ue=.0254,ye=ue/X.xdpi,Te=ue/X.ydpi,Qe=Xe(),Ye=Je();return new fi({widthMeters:ye*Qe,heightMeters:Te*Ye,bevelMeters:X.bevelMm*.001})},kr.prototype.getDistortedFieldOfViewLeftEye=function(){var X=this.viewer,ue=this.device,ye=this.distortion,Te=X.screenLensDistance,Qe=(ue.widthMeters-X.interLensDistance)/2,Ye=X.interLensDistance/2,mt=X.baselineLensDistance-ue.bevelMeters,he=ue.heightMeters-mt,le=Dt*Math.atan(ye.distort(Qe/Te)),de=Dt*Math.atan(ye.distort(Ye/Te)),xe=Dt*Math.atan(ye.distort(mt/Te)),Ee=Dt*Math.atan(ye.distort(he/Te));return{leftDegrees:Math.min(le,X.fov),rightDegrees:Math.min(de,X.fov),downDegrees:Math.min(xe,X.fov),upDegrees:Math.min(Ee,X.fov)}},kr.prototype.getLeftEyeVisibleTanAngles=function(){var X=this.viewer,ue=this.device,ye=this.distortion,Te=Math.tan(-pt*X.fov),Qe=Math.tan(pt*X.fov),Ye=Math.tan(pt*X.fov),mt=Math.tan(-pt*X.fov),he=ue.widthMeters/4,le=ue.heightMeters/2,de=X.baselineLensDistance-ue.bevelMeters-le,xe=X.interLensDistance/2-he,Ee=-de,ot=X.screenLensDistance,Mt=ye.distort((xe-he)/ot),Wt=ye.distort((Ee+le)/ot),ni=ye.distort((xe+he)/ot),Ai=ye.distort((Ee-le)/ot),qt=new Float32Array(4);return qt[0]=Math.max(Te,Mt),qt[1]=Math.min(Qe,Wt),qt[2]=Math.min(Ye,ni),qt[3]=Math.max(mt,Ai),qt},kr.prototype.getLeftEyeNoLensTanAngles=function(){var X=this.viewer,ue=this.device,ye=this.distortion,Te=new Float32Array(4),Qe=ye.distortInverse(Math.tan(-pt*X.fov)),Ye=ye.distortInverse(Math.tan(pt*X.fov)),mt=ye.distortInverse(Math.tan(pt*X.fov)),he=ye.distortInverse(Math.tan(-pt*X.fov)),le=ue.widthMeters/4,de=ue.heightMeters/2,xe=X.baselineLensDistance-ue.bevelMeters-de,Ee=X.interLensDistance/2-le,ot=-xe,Mt=X.screenLensDistance,Wt=(Ee-le)/Mt,ni=(ot+de)/Mt,Ai=(Ee+le)/Mt,qt=(ot-de)/Mt;return Te[0]=Math.max(Qe,Wt),Te[1]=Math.min(Ye,ni),Te[2]=Math.min(mt,Ai),Te[3]=Math.max(he,qt),Te},kr.prototype.getLeftEyeVisibleScreenRect=function(X){var ue=this.viewer,ye=this.device,Te=ue.screenLensDistance,Qe=(ye.widthMeters-ue.interLensDistance)/2,Ye=ue.baselineLensDistance-ye.bevelMeters,mt=(X[0]*Te+Qe)/ye.widthMeters,he=(X[1]*Te+Ye)/ye.heightMeters,le=(X[2]*Te+Qe)/ye.widthMeters,de=(X[3]*Te+Ye)/ye.heightMeters;return{x:mt,y:de,width:le-mt,height:he-de}},kr.prototype.getFieldOfViewLeftEye=function(X){return X?this.getUndistortedFieldOfViewLeftEye():this.getDistortedFieldOfViewLeftEye()},kr.prototype.getFieldOfViewRightEye=function(X){var ue=this.getFieldOfViewLeftEye(X);return{leftDegrees:ue.rightDegrees,rightDegrees:ue.leftDegrees,upDegrees:ue.upDegrees,downDegrees:ue.downDegrees}},kr.prototype.getUndistortedFieldOfViewLeftEye=function(){var X=this.getUndistortedParams_();return{leftDegrees:Dt*Math.atan(X.outerDist),rightDegrees:Dt*Math.atan(X.innerDist),downDegrees:Dt*Math.atan(X.bottomDist),upDegrees:Dt*Math.atan(X.topDist)}},kr.prototype.getUndistortedViewportLeftEye=function(){var X=this.getUndistortedParams_(),ue=this.viewer,ye=this.device,Te=ue.screenLensDistance,Qe=ye.widthMeters/Te,Ye=ye.heightMeters/Te,mt=ye.width/Qe,he=ye.height/Ye,le=Math.round((X.eyePosX-X.outerDist)*mt),de=Math.round((X.eyePosY-X.bottomDist)*he);return{x:le,y:de,width:Math.round((X.eyePosX+X.innerDist)*mt)-le,height:Math.round((X.eyePosY+X.topDist)*he)-de}},kr.prototype.getUndistortedParams_=function(){var X=this.viewer,ue=this.device,ye=this.distortion,Te=X.screenLensDistance,Qe=X.interLensDistance/2/Te,Ye=ue.widthMeters/Te,mt=ue.heightMeters/Te,he=Ye/2-Qe,le=(X.baselineLensDistance-ue.bevelMeters)/Te,de=X.fov,xe=ye.distortInverse(Math.tan(pt*de)),Ee=Math.min(he,xe),ot=Math.min(Qe,xe),Mt=Math.min(le,xe),Wt=Math.min(mt-le,xe);return{outerDist:Ee,innerDist:ot,topDist:Wt,bottomDist:Mt,eyePosX:he,eyePosY:le}};function rn(X){this.id=X.id,this.label=X.label,this.fov=X.fov,this.interLensDistance=X.interLensDistance,this.baselineLensDistance=X.baselineLensDistance,this.screenLensDistance=X.screenLensDistance,this.distortionCoefficients=X.distortionCoefficients,this.inverseCoefficients=X.inverseCoefficients}kr.Viewers=mn;var vs=1,gn="2019-11-09T17:36:14Z",Ls=[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X00PD/*"},{ua:"ASUS_X00PD"}],dpi:245,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X008D/*"},{ua:"ASUS_X008D"}],dpi:282,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2 XL/*"},{ua:"Pixel 2 XL"}],dpi:537.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3 XL/*"},{ua:"Pixel 3 XL"}],dpi:[558.5,553.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel XL/*"},{ua:"Pixel XL"}],dpi:[537.9,533],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3/*"},{ua:"Pixel 3"}],dpi:442.4,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2/*"},{ua:"Pixel 2"}],dpi:441,bw:3,ac:500},{type:"android",rules:[{mdmh:"Google/*/Pixel/*"},{ua:"Pixel"}],dpi:[432.6,436.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/BLN-L24/*"},{ua:"HONORBLN-L24"}],dpi:480,bw:4,ac:500},{type:"android",rules:[{mdmh:"Huawei/*/BKL-L09/*"},{ua:"BKL-L09"}],dpi:403,bw:3.47,ac:500},{type:"android",rules:[{mdmh:"LENOVO/*/Lenovo PB2-690Y/*"},{ua:"Lenovo PB2-690Y"}],dpi:[457.2,454.713],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},{ua:"VS985 4G"}],dpi:[537.9,535.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,401.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/G5/*"},{ua:"Moto G (5) Plus"}],dpi:[403.4,403],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},{ua:"XT830C"}],dpi:[254,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,327.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,316.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/G4/*"},{ua:"Moto G (4)"}],dpi:401,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1001/*"},{ua:"ONE E1001"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1003/*"},{ua:"ONE E1003"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2001/*"},{ua:"ONE A2001"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2003/*"},{ua:"ONE A2003"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3000/*"},{ua:"ONEPLUS A3000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3003/*"},{ua:"ONEPLUS A3003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3010/*"},{ua:"ONEPLUS A3010"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A5000/*"},{ua:"ONEPLUS A5000 "}],dpi:[403.411,399.737],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A5010/*"},{ua:"ONEPLUS A5010"}],dpi:[403,400],bw:2,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6000/*"},{ua:"ONEPLUS A6000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6003/*"},{ua:"ONEPLUS A6003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6010/*"},{ua:"ONEPLUS A6010"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6013/*"},{ua:"ONEPLUS A6013"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],dpi:[442.4,444.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},{ua:"GT-I9082"}],dpi:[184.7,185.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],dpi:[196.7,205.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],dpi:[217.7,231.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SGH-M919/*"},{ua:"SGH-M919"}],dpi:[440.8,437.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,136.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920P/*"},{ua:"SM-N920P"}],dpi:[386.3655,390.144],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920W8/*"},{ua:"SM-N920W8"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],dpi:285.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],dpi:[217.7,204.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G930F/*"},{ua:"SM-G930F"}],dpi:576.6,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G935F/*"},{ua:"SM-G935F"}],dpi:533,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G950F/*"},{ua:"SM-G950F"}],dpi:[562.707,565.293],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955U/*"},{ua:"SM-G955U"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955F/*"},{ua:"SM-G955F"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G960F/*"},{ua:"SM-G960F"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9600/*"},{ua:"SM-G9600"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960T/*"},{ua:"SM-G960T"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960N/*"},{ua:"SM-G960N"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960U/*"},{ua:"SM-G960U"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9608/*"},{ua:"SM-G9608"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960FD/*"},{ua:"SM-G960FD"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960W/*"},{ua:"SM-G960W"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G965F/*"},{ua:"SM-G965F"}],dpi:529,bw:2,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],dpi:[428.6,427.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],dpi:[480,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Fly/*/IQ4412/*"},{ua:"IQ4412"}],dpi:307.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"BENEVE/*/VR518/*"},{ua:"VR518"}],dpi:480,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1e3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1e3},{type:"ios",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2001]}],dpi:[410.9,415.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2436]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/EML-L29/*"},{ua:"EML-L29"}],dpi:428,bw:3.45,ac:500},{type:"android",rules:[{mdmh:"Nokia/*/Nokia 7.1/*"},{ua:"Nokia 7.1"}],dpi:[432,431.9],bw:3,ac:500},{type:"ios",rules:[{res:[1242,2688]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G570M/*"},{ua:"SM-G570M"}],dpi:320,bw:3.684,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G970F/*"},{ua:"SM-G970F"}],dpi:438,bw:2.281,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G973F/*"},{ua:"SM-G973F"}],dpi:550,bw:2.002,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G975F/*"},{ua:"SM-G975F"}],dpi:522,bw:2.054,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G977F/*"},{ua:"SM-G977F"}],dpi:505,bw:2.334,ac:500},{type:"ios",rules:[{res:[828,1792]}],dpi:326,bw:5,ac:500}],es={format:vs,last_updated:gn,devices:Ls};function bs(X,ue){if(this.dpdb=es,this.recalculateDeviceParams_(),X){this.onDeviceParamsUpdated=ue;var ye=new XMLHttpRequest,Te=this;ye.open("GET",X,!0),ye.addEventListener("load",function(){Te.loading=!1,ye.status>=200&&ye.status<=299?(Te.dpdb=JSON.parse(ye.response),Te.recalculateDeviceParams_()):console.error("Error loading online DPDB!")}),ye.send()}}bs.prototype.getDeviceParams=function(){return this.deviceParams},bs.prototype.recalculateDeviceParams_=function(){var X=this.calcDeviceParams_();X?(this.deviceParams=X,this.onDeviceParamsUpdated&&this.onDeviceParamsUpdated(this.deviceParams)):console.error("Failed to recalculate device parameters.")},bs.prototype.calcDeviceParams_=function(){var X=this.dpdb;if(!X)return console.error("DPDB not available."),null;if(X.format!=1)return console.error("DPDB has unexpected format version."),null;if(!X.devices||!X.devices.length)return console.error("DPDB does not have a devices section."),null;var ue=navigator.userAgent||navigator.vendor||window.opera,ye=Xe(),Te=Je();if(!X.devices)return console.error("DPDB has no devices section."),null;for(var Qe=0;Qe<X.devices.length;Qe++){var Ye=X.devices[Qe];if(!Ye.rules){console.warn("Device["+Qe+"] has no rules section.");continue}if(Ye.type!="ios"&&Ye.type!="android"){console.warn("Device["+Qe+"] has invalid type.");continue}if(W()==(Ye.type=="ios")){for(var mt=!1,he=0;he<Ye.rules.length;he++){var le=Ye.rules[he];if(this.ruleMatches_(le,ue,ye,Te)){mt=!0;break}}if(mt){var de=Ye.dpi[0]||Ye.dpi,xe=Ye.dpi[1]||Ye.dpi;return new pe({xdpi:de,ydpi:xe,bevelMm:Ye.bw})}}}return console.warn("No DPDB device match."),null},bs.prototype.ruleMatches_=function(X,ue,ye,Te){if(!X.ua&&!X.res||(X.ua&&X.ua.substring(0,2)==="SM"&&(X.ua=X.ua.substring(0,7)),X.ua&&ue.indexOf(X.ua)<0))return!1;if(X.res){if(!X.res[0]||!X.res[1])return!1;var Qe=X.res[0],Ye=X.res[1];if(Math.min(ye,Te)!=Math.min(Qe,Ye)||Math.max(ye,Te)!=Math.max(Qe,Ye))return!1}return!0};function pe(X){this.xdpi=X.xdpi,this.ydpi=X.ydpi,this.bevelMm=X.bevelMm}function ct(X,ue){this.set(X,ue)}ct.prototype.set=function(X,ue){this.sample=X,this.timestampS=ue},ct.prototype.copy=function(X){this.set(X.sample,X.timestampS)};function Rt(X,ue){this.kFilter=X,this.isDebug=ue,this.currentAccelMeasurement=new ct,this.currentGyroMeasurement=new ct,this.previousGyroMeasurement=new ct,W()?this.filterQ=new Vt(-1,0,0,1):this.filterQ=new Vt(1,0,0,1),this.previousFilterQ=new Vt,this.previousFilterQ.copy(this.filterQ),this.accelQ=new Vt,this.isOrientationInitialized=!1,this.estimatedGravity=new xt,this.measuredGravity=new xt,this.gyroIntegralQ=new Vt}Rt.prototype.addAccelMeasurement=function(X,ue){this.currentAccelMeasurement.set(X,ue)},Rt.prototype.addGyroMeasurement=function(X,ue){this.currentGyroMeasurement.set(X,ue);var ye=ue-this.previousGyroMeasurement.timestampS;Oe(ye)&&this.run_(),this.previousGyroMeasurement.copy(this.currentGyroMeasurement)},Rt.prototype.run_=function(){if(!this.isOrientationInitialized){this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),this.previousFilterQ.copy(this.accelQ),this.isOrientationInitialized=!0;return}var X=this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS,ue=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,X);this.gyroIntegralQ.multiply(ue),this.filterQ.copy(this.previousFilterQ),this.filterQ.multiply(ue);var ye=new Vt;ye.copy(this.filterQ),ye.inverse(),this.estimatedGravity.set(0,0,-1),this.estimatedGravity.applyQuaternion(ye),this.estimatedGravity.normalize(),this.measuredGravity.copy(this.currentAccelMeasurement.sample),this.measuredGravity.normalize();var Te=new Vt;Te.setFromUnitVectors(this.estimatedGravity,this.measuredGravity),Te.inverse(),this.isDebug&&console.log("Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)",Dt*Vi(Te),this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1));var Qe=new Vt;Qe.copy(this.filterQ),Qe.multiply(Te),this.filterQ.slerp(Qe,1-this.kFilter),this.previousFilterQ.copy(this.filterQ)},Rt.prototype.getOrientation=function(){return this.filterQ},Rt.prototype.accelToQuaternion_=function(X){var ue=new xt;ue.copy(X),ue.normalize();var ye=new Vt;return ye.setFromUnitVectors(new xt(0,0,-1),ue),ye.inverse(),ye},Rt.prototype.gyroToQuaternionDelta_=function(X,ue){var ye=new Vt,Te=new xt;return Te.copy(X),Te.normalize(),ye.setFromAxisAngle(Te,X.length()*ue),ye};function Kt(X,ue){this.predictionTimeS=X,this.isDebug=ue,this.previousQ=new Vt,this.previousTimestampS=null,this.deltaQ=new Vt,this.outQ=new Vt}Kt.prototype.getPrediction=function(X,ue,ye){if(!this.previousTimestampS)return this.previousQ.copy(X),this.previousTimestampS=ye,X;var Te=new xt;Te.copy(ue),Te.normalize();var Qe=ue.length();if(Qe<pt*20)return this.isDebug&&console.log("Moving slowly, at %s deg/s: no prediction",(Dt*Qe).toFixed(1)),this.outQ.copy(X),this.previousQ.copy(X),this.outQ;var Ye=Qe*this.predictionTimeS;return this.deltaQ.setFromAxisAngle(Te,Ye),this.outQ.copy(this.previousQ),this.outQ.multiply(this.deltaQ),this.previousQ.copy(X),this.previousTimestampS=ye,this.outQ};function Bi(X,ue,ye,Te){this.yawOnly=ye,this.accelerometer=new xt,this.gyroscope=new xt,this.filter=new Rt(X,Te),this.posePredictor=new Kt(ue,Te),this.isFirefoxAndroid=te(),this.isIOS=W();var Qe=Y();this.isDeviceMotionInRadians=!this.isIOS&&Qe&&Qe<66,this.isWithoutDeviceMotion=ve()||se(),this.filterToWorldQ=new Vt,W()?this.filterToWorldQ.setFromAxisAngle(new xt(1,0,0),Math.PI/2):this.filterToWorldQ.setFromAxisAngle(new xt(1,0,0),-Math.PI/2),this.inverseWorldToScreenQ=new Vt,this.worldToScreenQ=new Vt,this.originalPoseAdjustQ=new Vt,this.originalPoseAdjustQ.setFromAxisAngle(new xt(0,0,1),-window.orientation*Math.PI/180),this.setScreenTransform_(),me()&&this.filterToWorldQ.multiply(this.inverseWorldToScreenQ),this.resetQ=new Vt,this.orientationOut_=new Float32Array(4),this.start()}Bi.prototype.getPosition=function(){return null},Bi.prototype.getOrientation=function(){var X=void 0;if(this.isWithoutDeviceMotion&&this._deviceOrientationQ){this.deviceOrientationFixQ=this.deviceOrientationFixQ||function(){var Qe=new Vt().setFromAxisAngle(new xt(0,0,-1),0),Ye=new Vt;return window.orientation===-90?Ye.setFromAxisAngle(new xt(0,1,0),Math.PI/-2):Ye.setFromAxisAngle(new xt(0,1,0),Math.PI/2),Qe.multiply(Ye)}(),this.deviceOrientationFilterToWorldQ=this.deviceOrientationFilterToWorldQ||function(){var Qe=new Vt;return Qe.setFromAxisAngle(new xt(1,0,0),-Math.PI/2),Qe}(),X=this._deviceOrientationQ;var ye=new Vt;return ye.copy(X),ye.multiply(this.deviceOrientationFilterToWorldQ),ye.multiply(this.resetQ),ye.multiply(this.worldToScreenQ),ye.multiplyQuaternions(this.deviceOrientationFixQ,ye),this.yawOnly&&(ye.x=0,ye.z=0,ye.normalize()),this.orientationOut_[0]=ye.x,this.orientationOut_[1]=ye.y,this.orientationOut_[2]=ye.z,this.orientationOut_[3]=ye.w,this.orientationOut_}else{var ue=this.filter.getOrientation();X=this.posePredictor.getPrediction(ue,this.gyroscope,this.previousTimestampS)}var ye=new Vt;return ye.copy(this.filterToWorldQ),ye.multiply(this.resetQ),ye.multiply(X),ye.multiply(this.worldToScreenQ),this.yawOnly&&(ye.x=0,ye.z=0,ye.normalize()),this.orientationOut_[0]=ye.x,this.orientationOut_[1]=ye.y,this.orientationOut_[2]=ye.z,this.orientationOut_[3]=ye.w,this.orientationOut_},Bi.prototype.resetPose=function(){this.resetQ.copy(this.filter.getOrientation()),this.resetQ.x=0,this.resetQ.y=0,this.resetQ.z*=-1,this.resetQ.normalize(),me()&&this.resetQ.multiply(this.inverseWorldToScreenQ),this.resetQ.multiply(this.originalPoseAdjustQ)},Bi.prototype.onDeviceOrientation_=function(X){this._deviceOrientationQ=this._deviceOrientationQ||new Vt;var ue=X.alpha,ye=X.beta,Te=X.gamma;ue=(ue||0)*Math.PI/180,ye=(ye||0)*Math.PI/180,Te=(Te||0)*Math.PI/180,this._deviceOrientationQ.setFromEulerYXZ(ye,ue,-Te)},Bi.prototype.onDeviceMotion_=function(X){this.updateDeviceMotion_(X)},Bi.prototype.updateDeviceMotion_=function(X){var ue=X.accelerationIncludingGravity,ye=X.rotationRate,Te=X.timeStamp/1e3,Qe=Te-this.previousTimestampS;if(Qe<0){We("fusion-pose-sensor:invalid:non-monotonic","Invalid timestamps detected: non-monotonic timestamp from devicemotion"),this.previousTimestampS=Te;return}else if(Qe<=q||Qe>V){We("fusion-pose-sensor:invalid:outside-threshold","Invalid timestamps detected: Timestamp from devicemotion outside expected range."),this.previousTimestampS=Te;return}this.accelerometer.set(-ue.x,-ue.y,-ue.z),ye&&(Ae()?this.gyroscope.set(-ye.beta,ye.alpha,ye.gamma):this.gyroscope.set(ye.alpha,ye.beta,ye.gamma),this.isDeviceMotionInRadians||this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addGyroMeasurement(this.gyroscope,Te)),this.filter.addAccelMeasurement(this.accelerometer,Te),this.previousTimestampS=Te},Bi.prototype.onOrientationChange_=function(X){this.setScreenTransform_()},Bi.prototype.onMessage_=function(X){var ue=X.data;if(!(!ue||!ue.type)){var ye=ue.type.toLowerCase();ye==="devicemotion"&&this.updateDeviceMotion_(ue.deviceMotionEvent)}},Bi.prototype.setScreenTransform_=function(){switch(this.worldToScreenQ.set(0,0,0,1),window.orientation){case 0:break;case 90:this.worldToScreenQ.setFromAxisAngle(new xt(0,0,1),-Math.PI/2);break;case-90:this.worldToScreenQ.setFromAxisAngle(new xt(0,0,1),Math.PI/2);break}this.inverseWorldToScreenQ.copy(this.worldToScreenQ),this.inverseWorldToScreenQ.inverse()},Bi.prototype.start=function(){this.onDeviceMotionCallback_=this.onDeviceMotion_.bind(this),this.onOrientationChangeCallback_=this.onOrientationChange_.bind(this),this.onMessageCallback_=this.onMessage_.bind(this),this.onDeviceOrientationCallback_=this.onDeviceOrientation_.bind(this),W()&&Ei()&&window.addEventListener("message",this.onMessageCallback_),window.addEventListener("orientationchange",this.onOrientationChangeCallback_),this.isWithoutDeviceMotion?window.addEventListener("deviceorientation",this.onDeviceOrientationCallback_):window.addEventListener("devicemotion",this.onDeviceMotionCallback_)},Bi.prototype.stop=function(){window.removeEventListener("devicemotion",this.onDeviceMotionCallback_),window.removeEventListener("deviceorientation",this.onDeviceOrientationCallback_),window.removeEventListener("orientationchange",this.onOrientationChangeCallback_),window.removeEventListener("message",this.onMessageCallback_)};var sr=60,Di=new xt(1,0,0),Oi=new xt(0,0,1),Be=new Vt;Be.setFromAxisAngle(Di,-Math.PI/2),Be.multiply(new Vt().setFromAxisAngle(Oi,Math.PI/2));var ae=function(){function X(ue){D(this,X),this.config=ue,this.sensor=null,this.fusionSensor=null,this._out=new Float32Array(4),this.api=null,this.errors=[],this._sensorQ=new Vt,this._outQ=new Vt,this._onSensorRead=this._onSensorRead.bind(this),this._onSensorError=this._onSensorError.bind(this),this.init()}return P(X,[{key:"init",value:function(){var ue=null;try{ue=new RelativeOrientationSensor({frequency:sr,referenceFrame:"screen"}),ue.addEventListener("error",this._onSensorError)}catch(ye){this.errors.push(ye),ye.name==="SecurityError"?(console.error("Cannot construct sensors due to the Feature Policy"),console.warn('Attempting to fall back using "devicemotion"; however this will fail in the future without correct permissions.'),this.useDeviceMotion()):ye.name==="ReferenceError"?this.useDeviceMotion():console.error(ye)}ue&&(this.api="sensor",this.sensor=ue,this.sensor.addEventListener("reading",this._onSensorRead),this.sensor.start())}},{key:"useDeviceMotion",value:function(){this.api="devicemotion",this.fusionSensor=new Bi(this.config.K_FILTER,this.config.PREDICTION_TIME_S,this.config.YAW_ONLY,this.config.DEBUG),this.sensor&&(this.sensor.removeEventListener("reading",this._onSensorRead),this.sensor.removeEventListener("error",this._onSensorError),this.sensor=null)}},{key:"getOrientation",value:function(){if(this.fusionSensor)return this.fusionSensor.getOrientation();if(!this.sensor||!this.sensor.quaternion)return this._out[0]=this._out[1]=this._out[2]=0,this._out[3]=1,this._out;var ue=this.sensor.quaternion;this._sensorQ.set(ue[0],ue[1],ue[2],ue[3]);var ye=this._outQ;return ye.copy(Be),ye.multiply(this._sensorQ),this.config.YAW_ONLY&&(ye.x=ye.z=0,ye.normalize()),this._out[0]=ye.x,this._out[1]=ye.y,this._out[2]=ye.z,this._out[3]=ye.w,this._out}},{key:"_onSensorError",value:function(ue){this.errors.push(ue.error),ue.error.name==="NotAllowedError"?console.error("Permission to access sensor was denied"):ue.error.name==="NotReadableError"?console.error("Sensor could not be read"):console.error(ue.error),this.useDeviceMotion()}},{key:"_onSensorRead",value:function(){}}]),X}(),fe="<svg width='198' height='240' viewBox='0 0 198 240' xmlns='http://www.w3.org/2000/svg'><g fill='none' fill-rule='evenodd'><path d='M149.625 109.527l6.737 3.891v.886c0 .177.013.36.038.549.01.081.02.162.027.242.14 1.415.974 2.998 2.105 3.999l5.72 5.062.081-.09s4.382-2.53 5.235-3.024l25.97 14.993v54.001c0 .771-.386 1.217-.948 1.217-.233 0-.495-.076-.772-.236l-23.967-13.838-.014.024-27.322 15.775-.85-1.323c-4.731-1.529-9.748-2.74-14.951-3.61a.27.27 0 0 0-.007.024l-5.067 16.961-7.891 4.556-.037-.063v27.59c0 .772-.386 1.217-.948 1.217-.232 0-.495-.076-.772-.236l-42.473-24.522c-.95-.549-1.72-1.877-1.72-2.967v-1.035l-.021.047a5.111 5.111 0 0 0-1.816-.399 5.682 5.682 0 0 0-.546.001 13.724 13.724 0 0 1-1.918-.041c-1.655-.153-3.2-.6-4.404-1.296l-46.576-26.89.005.012-10.278-18.75c-1.001-1.827-.241-4.216 1.698-5.336l56.011-32.345a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.659 3.227 1.853l.005-.003.227.413-.006.004a9.63 9.63 0 0 0 1.477 2.018l.277.27c1.914 1.85 4.468 2.801 7.113 2.801 1.949 0 3.948-.517 5.775-1.572.013 0 7.319-4.219 7.319-4.219a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.658 3.226 1.853l3.25 5.928.022-.018 6.785 3.917-.105-.182 46.881-26.965m0-1.635c-.282 0-.563.073-.815.218l-46.169 26.556-5.41-3.124-3.005-5.481c-.913-1.667-2.699-2.702-4.66-2.703-1.011 0-2.02.274-2.917.792a3825 3825 0 0 1-7.275 4.195l-.044.024a9.937 9.937 0 0 1-4.957 1.353c-2.292 0-4.414-.832-5.976-2.342l-.252-.245a7.992 7.992 0 0 1-1.139-1.534 1.379 1.379 0 0 0-.06-.122l-.227-.414a1.718 1.718 0 0 0-.095-.154c-.938-1.574-2.673-2.545-4.571-2.545-1.011 0-2.02.274-2.917.792L3.125 155.502c-2.699 1.559-3.738 4.94-2.314 7.538l10.278 18.75c.177.323.448.563.761.704l46.426 26.804c1.403.81 3.157 1.332 5.072 1.508a15.661 15.661 0 0 0 2.146.046 4.766 4.766 0 0 1 .396 0c.096.004.19.011.283.022.109 1.593 1.159 3.323 2.529 4.114l42.472 24.522c.524.302 1.058.455 1.59.455 1.497 0 2.583-1.2 2.583-2.852v-26.562l7.111-4.105a1.64 1.64 0 0 0 .749-.948l4.658-15.593c4.414.797 8.692 1.848 12.742 3.128l.533.829a1.634 1.634 0 0 0 2.193.531l26.532-15.317L193 192.433c.523.302 1.058.455 1.59.455 1.497 0 2.583-1.199 2.583-2.852v-54.001c0-.584-.312-1.124-.818-1.416l-25.97-14.993a1.633 1.633 0 0 0-1.636.001c-.606.351-2.993 1.73-4.325 2.498l-4.809-4.255c-.819-.725-1.461-1.933-1.561-2.936a7.776 7.776 0 0 0-.033-.294 2.487 2.487 0 0 1-.023-.336v-.886c0-.584-.312-1.123-.817-1.416l-6.739-3.891a1.633 1.633 0 0 0-.817-.219' fill='#455A64'/><path d='M96.027 132.636l46.576 26.891c1.204.695 1.979 1.587 2.242 2.541l-.01.007-81.374 46.982h-.001c-1.654-.152-3.199-.6-4.403-1.295l-46.576-26.891 83.546-48.235' fill='#FAFAFA'/><path d='M63.461 209.174c-.008 0-.015 0-.022-.002-1.693-.156-3.228-.609-4.441-1.309l-46.576-26.89a.118.118 0 0 1 0-.203l83.546-48.235a.117.117 0 0 1 .117 0l46.576 26.891c1.227.708 2.021 1.612 2.296 2.611a.116.116 0 0 1-.042.124l-.021.016-81.375 46.981a.11.11 0 0 1-.058.016zm-50.747-28.303l46.401 26.79c1.178.68 2.671 1.121 4.32 1.276l81.272-46.922c-.279-.907-1.025-1.73-2.163-2.387l-46.517-26.857-83.313 48.1z' fill='#607D8B'/><path d='M148.327 165.471a5.85 5.85 0 0 1-.546.001c-1.894-.083-3.302-1.038-3.145-2.132a2.693 2.693 0 0 0-.072-1.105l-81.103 46.822c.628.058 1.272.073 1.918.042.182-.009.364-.009.546-.001 1.894.083 3.302 1.038 3.145 2.132l79.257-45.759' fill='#FFF'/><path d='M69.07 211.347a.118.118 0 0 1-.115-.134c.045-.317-.057-.637-.297-.925-.505-.61-1.555-1.022-2.738-1.074a5.966 5.966 0 0 0-.535.001 14.03 14.03 0 0 1-1.935-.041.117.117 0 0 1-.103-.092.116.116 0 0 1 .055-.126l81.104-46.822a.117.117 0 0 1 .171.07c.104.381.129.768.074 1.153-.045.316.057.637.296.925.506.61 1.555 1.021 2.739 1.073.178.008.357.008.535-.001a.117.117 0 0 1 .064.218l-79.256 45.759a.114.114 0 0 1-.059.016zm-3.405-2.372c.089 0 .177.002.265.006 1.266.056 2.353.488 2.908 1.158.227.274.35.575.36.882l78.685-45.429c-.036 0-.072-.001-.107-.003-1.267-.056-2.354-.489-2.909-1.158-.282-.34-.402-.724-.347-1.107a2.604 2.604 0 0 0-.032-.91L63.846 208.97a13.91 13.91 0 0 0 1.528.012c.097-.005.194-.007.291-.007z' fill='#607D8B'/><path d='M2.208 162.134c-1.001-1.827-.241-4.217 1.698-5.337l56.011-32.344c1.939-1.12 4.324-.546 5.326 1.281l.232.41a9.344 9.344 0 0 0 1.47 2.021l.278.27c3.325 3.214 8.583 3.716 12.888 1.23l7.319-4.22c1.94-1.119 4.324-.546 5.325 1.282l3.25 5.928-83.519 48.229-10.278-18.75z' fill='#FAFAFA'/><path d='M12.486 181.001a.112.112 0 0 1-.031-.005.114.114 0 0 1-.071-.056L2.106 162.19c-1.031-1.88-.249-4.345 1.742-5.494l56.01-32.344a4.328 4.328 0 0 1 2.158-.588c1.415 0 2.65.702 3.311 1.882.01.008.018.017.024.028l.227.414a.122.122 0 0 1 .013.038 9.508 9.508 0 0 0 1.439 1.959l.275.266c1.846 1.786 4.344 2.769 7.031 2.769 1.977 0 3.954-.538 5.717-1.557a.148.148 0 0 1 .035-.013l7.284-4.206a4.321 4.321 0 0 1 2.157-.588c1.427 0 2.672.716 3.329 1.914l3.249 5.929a.116.116 0 0 1-.044.157l-83.518 48.229a.116.116 0 0 1-.059.016zm49.53-57.004c-.704 0-1.41.193-2.041.557l-56.01 32.345c-1.882 1.086-2.624 3.409-1.655 5.179l10.221 18.645 83.317-48.112-3.195-5.829c-.615-1.122-1.783-1.792-3.124-1.792a4.08 4.08 0 0 0-2.04.557l-7.317 4.225a.148.148 0 0 1-.035.013 11.7 11.7 0 0 1-5.801 1.569c-2.748 0-5.303-1.007-7.194-2.835l-.278-.27a9.716 9.716 0 0 1-1.497-2.046.096.096 0 0 1-.013-.037l-.191-.347a.11.11 0 0 1-.023-.029c-.615-1.123-1.783-1.793-3.124-1.793z' fill='#607D8B'/><path d='M42.434 155.808c-2.51-.001-4.697-1.258-5.852-3.365-1.811-3.304-.438-7.634 3.059-9.654l12.291-7.098a7.599 7.599 0 0 1 3.789-1.033c2.51 0 4.697 1.258 5.852 3.365 1.811 3.304.439 7.634-3.059 9.654l-12.291 7.098a7.606 7.606 0 0 1-3.789 1.033zm13.287-20.683a7.128 7.128 0 0 0-3.555.971l-12.291 7.098c-3.279 1.893-4.573 5.942-2.883 9.024 1.071 1.955 3.106 3.122 5.442 3.122a7.13 7.13 0 0 0 3.556-.97l12.291-7.098c3.279-1.893 4.572-5.942 2.883-9.024-1.072-1.955-3.106-3.123-5.443-3.123z' fill='#607D8B'/><path d='M149.588 109.407l6.737 3.89v.887c0 .176.013.36.037.549.011.081.02.161.028.242.14 1.415.973 2.998 2.105 3.999l7.396 6.545c.177.156.358.295.541.415 1.579 1.04 2.95.466 3.062-1.282.049-.784.057-1.595.023-2.429l-.003-.16v-1.151l25.987 15.003v54c0 1.09-.77 1.53-1.72.982l-42.473-24.523c-.95-.548-1.72-1.877-1.72-2.966v-34.033' fill='#FAFAFA'/><path d='M194.553 191.25c-.257 0-.54-.085-.831-.253l-42.472-24.521c-.981-.567-1.779-1.943-1.779-3.068v-34.033h.234v34.033c0 1.051.745 2.336 1.661 2.866l42.473 24.521c.424.245.816.288 1.103.122.285-.164.442-.52.442-1.002v-53.933l-25.753-14.868.003 1.106c.034.832.026 1.654-.024 2.439-.054.844-.396 1.464-.963 1.746-.619.309-1.45.173-2.28-.373a5.023 5.023 0 0 1-.553-.426l-7.397-6.544c-1.158-1.026-1.999-2.625-2.143-4.076a9.624 9.624 0 0 0-.027-.238 4.241 4.241 0 0 1-.038-.564v-.82l-6.68-3.856.117-.202 6.738 3.89.058.034v.954c0 .171.012.351.036.533.011.083.021.165.029.246.138 1.395.948 2.935 2.065 3.923l7.397 6.545c.173.153.35.289.527.406.758.499 1.504.63 2.047.359.49-.243.786-.795.834-1.551.05-.778.057-1.591.024-2.417l-.004-.163v-1.355l.175.1 25.987 15.004.059.033v54.068c0 .569-.198.996-.559 1.204a1.002 1.002 0 0 1-.506.131' fill='#607D8B'/><path d='M145.685 163.161l24.115 13.922-25.978 14.998-1.462-.307c-6.534-2.17-13.628-3.728-21.019-4.616-4.365-.524-8.663 1.096-9.598 3.62a2.746 2.746 0 0 0-.011 1.928c1.538 4.267 4.236 8.363 7.995 12.135l.532.845-25.977 14.997-24.115-13.922 75.518-43.6' fill='#FFF'/><path d='M94.282 220.818l-.059-.033-24.29-14.024.175-.101 75.577-43.634.058.033 24.29 14.024-26.191 15.122-.045-.01-1.461-.307c-6.549-2.174-13.613-3.725-21.009-4.614a13.744 13.744 0 0 0-1.638-.097c-3.758 0-7.054 1.531-7.837 3.642a2.62 2.62 0 0 0-.01 1.848c1.535 4.258 4.216 8.326 7.968 12.091l.016.021.526.835.006.01.064.102-.105.061-25.977 14.998-.058.033zm-23.881-14.057l23.881 13.788 24.802-14.32c.546-.315.846-.489 1.017-.575l-.466-.74c-3.771-3.787-6.467-7.881-8.013-12.168a2.851 2.851 0 0 1 .011-2.008c.815-2.199 4.203-3.795 8.056-3.795.557 0 1.117.033 1.666.099 7.412.891 14.491 2.445 21.041 4.621.836.175 1.215.254 1.39.304l25.78-14.884-23.881-13.788-75.284 43.466z' fill='#607D8B'/><path d='M167.23 125.979v50.871l-27.321 15.773-6.461-14.167c-.91-1.996-3.428-1.738-5.624.574a10.238 10.238 0 0 0-2.33 4.018l-6.46 21.628-27.322 15.774v-50.871l75.518-43.6' fill='#FFF'/><path d='M91.712 220.567a.127.127 0 0 1-.059-.016.118.118 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.519-43.6a.117.117 0 0 1 .175.101v50.871c0 .041-.023.08-.059.1l-27.321 15.775a.118.118 0 0 1-.094.01.12.12 0 0 1-.071-.063l-6.46-14.168c-.375-.822-1.062-1.275-1.934-1.275-1.089 0-2.364.686-3.5 1.881a10.206 10.206 0 0 0-2.302 3.972l-6.46 21.627a.118.118 0 0 1-.054.068L91.77 220.551a.12.12 0 0 1-.058.016zm.117-50.92v50.601l27.106-15.65 6.447-21.583a10.286 10.286 0 0 1 2.357-4.065c1.18-1.242 2.517-1.954 3.669-1.954.969 0 1.731.501 2.146 1.411l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M168.543 126.213v50.87l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.624.574a10.248 10.248 0 0 0-2.33 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6' fill='#FFF'/><path d='M93.025 220.8a.123.123 0 0 1-.059-.015.12.12 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.518-43.6a.112.112 0 0 1 .117 0c.036.02.059.059.059.1v50.871a.116.116 0 0 1-.059.101l-27.321 15.774a.111.111 0 0 1-.094.01.115.115 0 0 1-.071-.062l-6.46-14.168c-.375-.823-1.062-1.275-1.935-1.275-1.088 0-2.363.685-3.499 1.881a10.19 10.19 0 0 0-2.302 3.971l-6.461 21.628a.108.108 0 0 1-.053.067l-27.322 15.775a.12.12 0 0 1-.058.015zm.117-50.919v50.6l27.106-15.649 6.447-21.584a10.293 10.293 0 0 1 2.357-4.065c1.179-1.241 2.516-1.954 3.668-1.954.969 0 1.732.502 2.147 1.412l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M169.8 177.083l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.625.574a10.246 10.246 0 0 0-2.329 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6v50.87z' fill='#FAFAFA'/><path d='M94.282 220.917a.234.234 0 0 1-.234-.233v-50.871c0-.083.045-.161.117-.202l75.518-43.601a.234.234 0 1 1 .35.202v50.871a.233.233 0 0 1-.116.202l-27.322 15.775a.232.232 0 0 1-.329-.106l-6.461-14.168c-.36-.789-.992-1.206-1.828-1.206-1.056 0-2.301.672-3.415 1.844a10.099 10.099 0 0 0-2.275 3.924l-6.46 21.628a.235.235 0 0 1-.107.136l-27.322 15.774a.23.23 0 0 1-.116.031zm.233-50.969v50.331l26.891-15.525 6.434-21.539a10.41 10.41 0 0 1 2.384-4.112c1.201-1.265 2.569-1.991 3.753-1.991 1.018 0 1.818.526 2.253 1.48l6.354 13.934 26.982-15.578v-50.331l-75.051 43.331z' fill='#607D8B'/><path d='M109.894 199.943c-1.774 0-3.241-.725-4.244-2.12a.224.224 0 0 1 .023-.294.233.233 0 0 1 .301-.023c.78.547 1.705.827 2.75.827 1.323 0 2.754-.439 4.256-1.306 5.311-3.067 9.631-10.518 9.631-16.611 0-1.927-.442-3.56-1.278-4.724a.232.232 0 0 1 .323-.327c1.671 1.172 2.591 3.381 2.591 6.219 0 6.242-4.426 13.863-9.865 17.003-1.574.908-3.084 1.356-4.488 1.356zm-2.969-1.542c.813.651 1.82.877 2.968.877h.001c1.321 0 2.753-.327 4.254-1.194 5.311-3.067 9.632-10.463 9.632-16.556 0-1.979-.463-3.599-1.326-4.761.411 1.035.625 2.275.625 3.635 0 6.243-4.426 13.883-9.865 17.023-1.574.909-3.084 1.317-4.49 1.317-.641 0-1.243-.149-1.799-.341z' fill='#607D8B'/><path d='M113.097 197.23c5.384-3.108 9.748-10.636 9.748-16.814 0-2.051-.483-3.692-1.323-4.86-1.784-1.252-4.374-1.194-7.257.47-5.384 3.108-9.748 10.636-9.748 16.814 0 2.051.483 3.692 1.323 4.86 1.784 1.252 4.374 1.194 7.257-.47' fill='#FAFAFA'/><path d='M108.724 198.614c-1.142 0-2.158-.213-3.019-.817-.021-.014-.04.014-.055-.007-.894-1.244-1.367-2.948-1.367-4.973 0-6.242 4.426-13.864 9.865-17.005 1.574-.908 3.084-1.363 4.49-1.363 1.142 0 2.158.309 3.018.913a.23.23 0 0 1 .056.056c.894 1.244 1.367 2.972 1.367 4.997 0 6.243-4.426 13.783-9.865 16.923-1.574.909-3.084 1.276-4.49 1.276zm-2.718-1.109c.774.532 1.688.776 2.718.776 1.323 0 2.754-.413 4.256-1.28 5.311-3.066 9.631-10.505 9.631-16.598 0-1.909-.434-3.523-1.255-4.685-.774-.533-1.688-.799-2.718-.799-1.323 0-2.755.441-4.256 1.308-5.311 3.066-9.631 10.506-9.631 16.599 0 1.909.434 3.517 1.255 4.679z' fill='#607D8B'/><path d='M149.318 114.262l-9.984 8.878 15.893 11.031 5.589-6.112-11.498-13.797' fill='#FAFAFA'/><path d='M169.676 120.84l-9.748 5.627c-3.642 2.103-9.528 2.113-13.147.024-3.62-2.089-3.601-5.488.041-7.591l9.495-5.608-6.729-3.885-81.836 47.071 45.923 26.514 3.081-1.779c.631-.365.869-.898.618-1.39-2.357-4.632-2.593-9.546-.683-14.262 5.638-13.92 24.509-24.815 48.618-28.07 8.169-1.103 16.68-.967 24.704.394.852.145 1.776.008 2.407-.357l3.081-1.778-25.825-14.91' fill='#FAFAFA'/><path d='M113.675 183.459a.47.47 0 0 1-.233-.062l-45.924-26.515a.468.468 0 0 1 .001-.809l81.836-47.071a.467.467 0 0 1 .466 0l6.729 3.885a.467.467 0 0 1-.467.809l-6.496-3.75-80.9 46.533 44.988 25.973 2.848-1.644c.192-.111.62-.409.435-.773-2.416-4.748-2.658-9.814-.7-14.65 2.806-6.927 8.885-13.242 17.582-18.263 8.657-4.998 19.518-8.489 31.407-10.094 8.198-1.107 16.79-.97 24.844.397.739.125 1.561.007 2.095-.301l2.381-1.374-25.125-14.506a.467.467 0 0 1 .467-.809l25.825 14.91a.467.467 0 0 1 0 .809l-3.081 1.779c-.721.417-1.763.575-2.718.413-7.963-1.351-16.457-1.486-24.563-.392-11.77 1.589-22.512 5.039-31.065 9.977-8.514 4.916-14.456 11.073-17.183 17.805-1.854 4.578-1.623 9.376.666 13.875.37.725.055 1.513-.8 2.006l-3.081 1.78a.476.476 0 0 1-.234.062' fill='#455A64'/><path d='M153.316 128.279c-2.413 0-4.821-.528-6.652-1.586-1.818-1.049-2.82-2.461-2.82-3.975 0-1.527 1.016-2.955 2.861-4.02l9.493-5.607a.233.233 0 1 1 .238.402l-9.496 5.609c-1.696.979-2.628 2.263-2.628 3.616 0 1.34.918 2.608 2.585 3.571 3.549 2.049 9.343 2.038 12.914-.024l9.748-5.628a.234.234 0 0 1 .234.405l-9.748 5.628c-1.858 1.072-4.296 1.609-6.729 1.609' fill='#607D8B'/><path d='M113.675 182.992l-45.913-26.508M113.675 183.342a.346.346 0 0 1-.175-.047l-45.913-26.508a.35.35 0 1 1 .35-.607l45.913 26.508a.35.35 0 0 1-.175.654' fill='#455A64'/><path d='M67.762 156.484v54.001c0 1.09.77 2.418 1.72 2.967l42.473 24.521c.95.549 1.72.11 1.72-.98v-54.001' fill='#FAFAFA'/><path d='M112.727 238.561c-.297 0-.62-.095-.947-.285l-42.473-24.521c-1.063-.613-1.895-2.05-1.895-3.27v-54.001a.35.35 0 1 1 .701 0v54.001c0 .96.707 2.18 1.544 2.663l42.473 24.522c.344.198.661.243.87.122.206-.119.325-.411.325-.799v-54.001a.35.35 0 1 1 .7 0v54.001c0 .655-.239 1.154-.675 1.406a1.235 1.235 0 0 1-.623.162' fill='#455A64'/><path d='M112.86 147.512h-.001c-2.318 0-4.499-.522-6.142-1.471-1.705-.984-2.643-2.315-2.643-3.749 0-1.445.952-2.791 2.68-3.788l12.041-6.953c1.668-.962 3.874-1.493 6.212-1.493 2.318 0 4.499.523 6.143 1.472 1.704.984 2.643 2.315 2.643 3.748 0 1.446-.952 2.791-2.68 3.789l-12.042 6.952c-1.668.963-3.874 1.493-6.211 1.493zm12.147-16.753c-2.217 0-4.298.497-5.861 1.399l-12.042 6.952c-1.502.868-2.33 1.998-2.33 3.182 0 1.173.815 2.289 2.293 3.142 1.538.889 3.596 1.378 5.792 1.378h.001c2.216 0 4.298-.497 5.861-1.399l12.041-6.953c1.502-.867 2.33-1.997 2.33-3.182 0-1.172-.814-2.288-2.292-3.142-1.539-.888-3.596-1.377-5.793-1.377z' fill='#607D8B'/><path d='M165.63 123.219l-5.734 3.311c-3.167 1.828-8.286 1.837-11.433.02-3.147-1.817-3.131-4.772.036-6.601l5.734-3.31 11.397 6.58' fill='#FAFAFA'/><path d='M154.233 117.448l9.995 5.771-4.682 2.704c-1.434.827-3.352 1.283-5.399 1.283-2.029 0-3.923-.449-5.333-1.263-1.29-.744-2-1.694-2-2.674 0-.991.723-1.955 2.036-2.713l5.383-3.108m0-.809l-5.734 3.31c-3.167 1.829-3.183 4.784-.036 6.601 1.568.905 3.623 1.357 5.684 1.357 2.077 0 4.159-.46 5.749-1.377l5.734-3.311-11.397-6.58M145.445 179.667c-1.773 0-3.241-.85-4.243-2.245-.067-.092-.057-.275.023-.356.08-.081.207-.12.3-.055.781.548 1.706.812 2.751.811 1.322 0 2.754-.446 4.256-1.313 5.31-3.066 9.631-10.522 9.631-16.615 0-1.927-.442-3.562-1.279-4.726a.235.235 0 0 1 .024-.301.232.232 0 0 1 .3-.027c1.67 1.172 2.59 3.38 2.59 6.219 0 6.242-4.425 13.987-9.865 17.127-1.573.908-3.083 1.481-4.488 1.481zM142.476 178c.814.651 1.82 1.002 2.969 1.002 1.322 0 2.753-.452 4.255-1.32 5.31-3.065 9.631-10.523 9.631-16.617 0-1.98-.463-3.63-1.325-4.793.411 1.035.624 2.26.624 3.62 0 6.242-4.425 13.875-9.865 17.015-1.573.909-3.084 1.376-4.489 1.376a5.49 5.49 0 0 1-1.8-.283z' fill='#607D8B'/><path d='M148.648 176.704c5.384-3.108 9.748-10.636 9.748-16.813 0-2.052-.483-3.693-1.322-4.861-1.785-1.252-4.375-1.194-7.258.471-5.383 3.108-9.748 10.636-9.748 16.813 0 2.051.484 3.692 1.323 4.86 1.785 1.253 4.374 1.195 7.257-.47' fill='#FAFAFA'/><path d='M144.276 178.276c-1.143 0-2.158-.307-3.019-.911a.217.217 0 0 1-.055-.054c-.895-1.244-1.367-2.972-1.367-4.997 0-6.241 4.425-13.875 9.865-17.016 1.573-.908 3.084-1.369 4.489-1.369 1.143 0 2.158.307 3.019.91a.24.24 0 0 1 .055.055c.894 1.244 1.367 2.971 1.367 4.997 0 6.241-4.425 13.875-9.865 17.016-1.573.908-3.084 1.369-4.489 1.369zm-2.718-1.172c.773.533 1.687.901 2.718.901 1.322 0 2.754-.538 4.256-1.405 5.31-3.066 9.631-10.567 9.631-16.661 0-1.908-.434-3.554-1.256-4.716-.774-.532-1.688-.814-2.718-.814-1.322 0-2.754.433-4.256 1.3-5.31 3.066-9.631 10.564-9.631 16.657 0 1.91.434 3.576 1.256 4.738z' fill='#607D8B'/><path d='M150.72 172.361l-.363-.295a24.105 24.105 0 0 0 2.148-3.128 24.05 24.05 0 0 0 1.977-4.375l.443.149a24.54 24.54 0 0 1-2.015 4.46 24.61 24.61 0 0 1-2.19 3.189M115.917 191.514l-.363-.294a24.174 24.174 0 0 0 2.148-3.128 24.038 24.038 0 0 0 1.976-4.375l.443.148a24.48 24.48 0 0 1-2.015 4.461 24.662 24.662 0 0 1-2.189 3.188M114 237.476V182.584 237.476' fill='#607D8B'/><g><path d='M81.822 37.474c.017-.135-.075-.28-.267-.392-.327-.188-.826-.21-1.109-.045l-6.012 3.471c-.131.076-.194.178-.191.285.002.132.002.461.002.578v.043l-.007.128-6.591 3.779c-.001 0-2.077 1.046-2.787 5.192 0 0-.912 6.961-.898 19.745.015 12.57.606 17.07 1.167 21.351.22 1.684 3.001 2.125 3.001 2.125.331.04.698-.027 1.08-.248l75.273-43.551c1.808-1.069 2.667-3.719 3.056-6.284 1.213-7.99 1.675-32.978-.275-39.878-.196-.693-.51-1.083-.868-1.282l-2.086-.79c-.727.028-1.416.467-1.534.535L82.032 37.072l-.21.402' fill='#FFF'/><path d='M144.311 1.701l2.085.79c.358.199.672.589.868 1.282 1.949 6.9 1.487 31.887.275 39.878-.39 2.565-1.249 5.215-3.056 6.284L69.21 93.486a1.78 1.78 0 0 1-.896.258l-.183-.011c0 .001-2.782-.44-3.003-2.124-.56-4.282-1.151-8.781-1.165-21.351-.015-12.784.897-19.745.897-19.745.71-4.146 2.787-5.192 2.787-5.192l6.591-3.779.007-.128v-.043c0-.117 0-.446-.002-.578-.003-.107.059-.21.191-.285l6.012-3.472a.98.98 0 0 1 .481-.11c.218 0 .449.053.627.156.193.112.285.258.268.392l.211-.402 60.744-34.836c.117-.068.806-.507 1.534-.535m0-.997l-.039.001c-.618.023-1.283.244-1.974.656l-.021.012-60.519 34.706a2.358 2.358 0 0 0-.831-.15c-.365 0-.704.084-.98.244l-6.012 3.471c-.442.255-.699.69-.689 1.166l.001.15-6.08 3.487c-.373.199-2.542 1.531-3.29 5.898l-.006.039c-.009.07-.92 7.173-.906 19.875.014 12.62.603 17.116 1.172 21.465l.002.015c.308 2.355 3.475 2.923 3.836 2.98l.034.004c.101.013.204.019.305.019a2.77 2.77 0 0 0 1.396-.392l75.273-43.552c1.811-1.071 2.999-3.423 3.542-6.997 1.186-7.814 1.734-33.096-.301-40.299-.253-.893-.704-1.527-1.343-1.882l-.132-.062-2.085-.789a.973.973 0 0 0-.353-.065' fill='#455A64'/><path d='M128.267 11.565l1.495.434-56.339 32.326' fill='#FFF'/><path d='M74.202 90.545a.5.5 0 0 1-.25-.931l18.437-10.645a.499.499 0 1 1 .499.864L74.451 90.478l-.249.067M75.764 42.654l-.108-.062.046-.171 5.135-2.964.17.045-.045.171-5.135 2.964-.063.017M70.52 90.375V46.421l.063-.036L137.84 7.554v43.954l-.062.036L70.52 90.375zm.25-43.811v43.38l66.821-38.579V7.985L70.77 46.564z' fill='#607D8B'/><path d='M86.986 83.182c-.23.149-.612.384-.849.523l-11.505 6.701c-.237.139-.206.252.068.252h.565c.275 0 .693-.113.93-.252L87.7 83.705c.237-.139.428-.253.425-.256a11.29 11.29 0 0 1-.006-.503c0-.274-.188-.377-.418-.227l-.715.463' fill='#607D8B'/><path d='M75.266 90.782H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.236-.138.615-.371.844-.519l.715-.464a.488.488 0 0 1 .266-.089c.172 0 .345.13.345.421 0 .214.001.363.003.437l.006.004-.004.069c-.003.075-.003.075-.486.356l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.108.866-.234l11.505-6.702c.168-.098.294-.173.361-.214-.004-.084-.004-.218-.004-.437l-.095-.171-.131.049-.714.463c-.232.15-.616.386-.854.525l-11.505 6.702-.029.018z' fill='#607D8B'/><path d='M75.266 89.871H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.258-.151.694-.268.993-.268h.565c.2 0 .316.056.346.166.03.11-.043.217-.215.317l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.107.866-.234l11.505-6.702.03-.018-.035-.001h-.565c-.252 0-.649.108-.867.234l-11.505 6.702-.029.018zM74.37 90.801v-1.247 1.247' fill='#607D8B'/><path d='M68.13 93.901c-.751-.093-1.314-.737-1.439-1.376-.831-4.238-1.151-8.782-1.165-21.352-.015-12.784.897-19.745.897-19.745.711-4.146 2.787-5.192 2.787-5.192l74.859-43.219c.223-.129 2.487-1.584 3.195.923 1.95 6.9 1.488 31.887.275 39.878-.389 2.565-1.248 5.215-3.056 6.283L69.21 93.653c-.382.221-.749.288-1.08.248 0 0-2.781-.441-3.001-2.125-.561-4.281-1.152-8.781-1.167-21.351-.014-12.784.898-19.745.898-19.745.71-4.146 2.787-5.191 2.787-5.191l6.598-3.81.871-.119 6.599-3.83.046-.461L68.13 93.901' fill='#FAFAFA'/><path d='M68.317 94.161l-.215-.013h-.001l-.244-.047c-.719-.156-2.772-.736-2.976-2.292-.568-4.34-1.154-8.813-1.168-21.384-.014-12.654.891-19.707.9-19.777.725-4.231 2.832-5.338 2.922-5.382l6.628-3.827.87-.119 6.446-3.742.034-.334a.248.248 0 0 1 .273-.223.248.248 0 0 1 .223.272l-.059.589-6.752 3.919-.87.118-6.556 3.785c-.031.016-1.99 1.068-2.666 5.018-.007.06-.908 7.086-.894 19.702.014 12.539.597 16.996 1.161 21.305.091.691.689 1.154 1.309 1.452a1.95 1.95 0 0 1-.236-.609c-.781-3.984-1.155-8.202-1.17-21.399-.014-12.653.891-19.707.9-19.777.725-4.231 2.832-5.337 2.922-5.382-.004.001 74.444-42.98 74.846-43.212l.028-.017c.904-.538 1.72-.688 2.36-.433.555.221.949.733 1.172 1.52 2.014 7.128 1.46 32.219.281 39.983-.507 3.341-1.575 5.515-3.175 6.462L69.335 93.869a2.023 2.023 0 0 1-1.018.292zm-.147-.507c.293.036.604-.037.915-.217l75.273-43.551c1.823-1.078 2.602-3.915 2.934-6.106 1.174-7.731 1.731-32.695-.268-39.772-.178-.631-.473-1.032-.876-1.192-.484-.193-1.166-.052-1.921.397l-.034.021-74.858 43.218c-.031.017-1.989 1.069-2.666 5.019-.007.059-.908 7.085-.894 19.702.015 13.155.386 17.351 1.161 21.303.09.461.476.983 1.037 1.139.114.025.185.037.196.039h.001z' fill='#455A64'/><path d='M69.317 68.982c.489-.281.885-.056.885.505 0 .56-.396 1.243-.885 1.525-.488.282-.884.057-.884-.504 0-.56.396-1.243.884-1.526' fill='#FFF'/><path d='M68.92 71.133c-.289 0-.487-.228-.487-.625 0-.56.396-1.243.884-1.526a.812.812 0 0 1 .397-.121c.289 0 .488.229.488.626 0 .56-.396 1.243-.885 1.525a.812.812 0 0 1-.397.121m.794-2.459a.976.976 0 0 0-.49.147c-.548.317-.978 1.058-.978 1.687 0 .486.271.812.674.812a.985.985 0 0 0 .491-.146c.548-.317.978-1.057.978-1.687 0-.486-.272-.813-.675-.813' fill='#8097A2'/><path d='M68.92 70.947c-.271 0-.299-.307-.299-.439 0-.491.361-1.116.79-1.363a.632.632 0 0 1 .303-.096c.272 0 .301.306.301.438 0 .491-.363 1.116-.791 1.364a.629.629 0 0 1-.304.096m.794-2.086a.812.812 0 0 0-.397.121c-.488.283-.884.966-.884 1.526 0 .397.198.625.487.625a.812.812 0 0 0 .397-.121c.489-.282.885-.965.885-1.525 0-.397-.199-.626-.488-.626' fill='#8097A2'/><path d='M69.444 85.35c.264-.152.477-.031.477.272 0 .303-.213.67-.477.822-.263.153-.477.031-.477-.271 0-.302.214-.671.477-.823' fill='#FFF'/><path d='M69.23 86.51c-.156 0-.263-.123-.263-.337 0-.302.214-.671.477-.823a.431.431 0 0 1 .214-.066c.156 0 .263.124.263.338 0 .303-.213.67-.477.822a.431.431 0 0 1-.214.066m.428-1.412c-.1 0-.203.029-.307.09-.32.185-.57.618-.57.985 0 .309.185.524.449.524a.63.63 0 0 0 .308-.09c.32-.185.57-.618.57-.985 0-.309-.185-.524-.45-.524' fill='#8097A2'/><path d='M69.23 86.322l-.076-.149c0-.235.179-.544.384-.661l.12-.041.076.151c0 .234-.179.542-.383.66l-.121.04m.428-1.038a.431.431 0 0 0-.214.066c-.263.152-.477.521-.477.823 0 .214.107.337.263.337a.431.431 0 0 0 .214-.066c.264-.152.477-.519.477-.822 0-.214-.107-.338-.263-.338' fill='#8097A2'/><path d='M139.278 7.769v43.667L72.208 90.16V46.493l67.07-38.724' fill='#455A64'/><path d='M72.083 90.375V46.421l.063-.036 67.257-38.831v43.954l-.062.036-67.258 38.831zm.25-43.811v43.38l66.821-38.579V7.985L72.333 46.564z' fill='#607D8B'/></g><path d='M125.737 88.647l-7.639 3.334V84l-11.459 4.713v8.269L99 100.315l13.369 3.646 13.368-15.314' fill='#455A64'/></g></svg>";function Le(){this.loadIcon_();var X=document.createElement("div"),mt=X.style;mt.position="fixed",mt.top=0,mt.right=0,mt.bottom=0,mt.left=0,mt.backgroundColor="gray",mt.fontFamily="sans-serif",mt.zIndex=1e6;var ue=document.createElement("img");ue.src=this.icon;var mt=ue.style;mt.marginLeft="25%",mt.marginTop="25%",mt.width="50%",X.appendChild(ue);var ye=document.createElement("div"),mt=ye.style;mt.textAlign="center",mt.fontSize="16px",mt.lineHeight="24px",mt.margin="24px 25%",mt.width="50%",ye.innerHTML="Place your phone into your Cardboard viewer.",X.appendChild(ye);var Te=document.createElement("div"),mt=Te.style;mt.backgroundColor="#CFD8DC",mt.position="fixed",mt.bottom=0,mt.width="100%",mt.height="48px",mt.padding="14px 24px",mt.boxSizing="border-box",mt.color="#656A6B",X.appendChild(Te);var Qe=document.createElement("div");Qe.style.float="left",Qe.innerHTML="No Cardboard viewer?";var Ye=document.createElement("a");Ye.href="https://www.google.com/get/cardboard/get-cardboard/",Ye.innerHTML="get one",Ye.target="_blank";var mt=Ye.style;mt.float="right",mt.fontWeight=600,mt.textTransform="uppercase",mt.borderLeft="1px solid gray",mt.paddingLeft="24px",mt.textDecoration="none",mt.color="#656A6B",Te.appendChild(Qe),Te.appendChild(Ye),this.overlay=X,this.text=ye,this.hide()}Le.prototype.show=function(X){!X&&!this.overlay.parentElement?document.body.appendChild(this.overlay):X&&(this.overlay.parentElement&&this.overlay.parentElement!=X&&this.overlay.parentElement.removeChild(this.overlay),X.appendChild(this.overlay)),this.overlay.style.display="block";var ue=this.overlay.querySelector("img"),ye=ue.style;me()?(ye.width="20%",ye.marginLeft="40%",ye.marginTop="3%"):(ye.width="50%",ye.marginLeft="25%",ye.marginTop="25%")},Le.prototype.hide=function(){this.overlay.style.display="none"},Le.prototype.showTemporarily=function(X,ue){this.show(ue),this.timer=setTimeout(this.hide.bind(this),X)},Le.prototype.disableShowTemporarily=function(){clearTimeout(this.timer)},Le.prototype.update=function(){this.disableShowTemporarily(),!me()&&$e()?this.show():this.hide()},Le.prototype.loadIcon_=function(){this.icon=j("image/svg+xml",fe)};var Ue="CardboardV1",Ke="WEBVR_CARDBOARD_VIEWER",lt="webvr-polyfill-viewer-selector";function Tt(X){try{this.selectedKey=localStorage.getItem(Ke)}catch(ue){console.error("Failed to load viewer profile: %s",ue)}this.selectedKey||(this.selectedKey=X||Ue),this.dialog=this.createDialog_(kr.Viewers),this.root=null,this.onChangeCallbacks_=[]}Tt.prototype.show=function(X){this.root=X,X.appendChild(this.dialog);var ue=this.dialog.querySelector("#"+this.selectedKey);ue.checked=!0,this.dialog.style.display="block"},Tt.prototype.hide=function(){this.root&&this.root.contains(this.dialog)&&this.root.removeChild(this.dialog),this.dialog.style.display="none"},Tt.prototype.getCurrentViewer=function(){return kr.Viewers[this.selectedKey]},Tt.prototype.getSelectedKey_=function(){var X=this.dialog.querySelector("input[name=field]:checked");return X?X.id:null},Tt.prototype.onChange=function(X){this.onChangeCallbacks_.push(X)},Tt.prototype.fireOnChange_=function(X){for(var ue=0;ue<this.onChangeCallbacks_.length;ue++)this.onChangeCallbacks_[ue](X)},Tt.prototype.onSave_=function(){if(this.selectedKey=this.getSelectedKey_(),!this.selectedKey||!kr.Viewers[this.selectedKey]){console.error("ViewerSelector.onSave_: this should never happen!");return}this.fireOnChange_(kr.Viewers[this.selectedKey]);try{localStorage.setItem(Ke,this.selectedKey)}catch(X){console.error("Failed to save viewer profile: %s",X)}this.hide()},Tt.prototype.createDialog_=function(X){var ue=document.createElement("div");ue.classList.add(lt),ue.style.display="none";var ye=document.createElement("div"),Ye=ye.style;Ye.position="fixed",Ye.left=0,Ye.top=0,Ye.width="100%",Ye.height="100%",Ye.background="rgba(0, 0, 0, 0.3)",ye.addEventListener("click",this.hide.bind(this));var Te=280,Qe=document.createElement("div"),Ye=Qe.style;Ye.boxSizing="border-box",Ye.position="fixed",Ye.top="24px",Ye.left="50%",Ye.marginLeft=-280/2+"px",Ye.width=Te+"px",Ye.padding="24px",Ye.overflow="hidden",Ye.background="#fafafa",Ye.fontFamily="'Roboto', sans-serif",Ye.boxShadow="0px 5px 20px #666",Qe.appendChild(this.createH1_("Select your viewer"));for(var mt in X)Qe.appendChild(this.createChoice_(mt,X[mt].label));return Qe.appendChild(this.createButton_("Save",this.onSave_.bind(this))),ue.appendChild(ye),ue.appendChild(Qe),ue},Tt.prototype.createH1_=function(X){var ue=document.createElement("h1"),ye=ue.style;return ye.color="black",ye.fontSize="20px",ye.fontWeight="bold",ye.marginTop=0,ye.marginBottom="24px",ue.innerHTML=X,ue},Tt.prototype.createChoice_=function(X,ue){var ye=document.createElement("div");ye.style.marginTop="8px",ye.style.color="black";var Te=document.createElement("input");Te.style.fontSize="30px",Te.setAttribute("id",X),Te.setAttribute("type","radio"),Te.setAttribute("value",X),Te.setAttribute("name","field");var Qe=document.createElement("label");return Qe.style.marginLeft="4px",Qe.setAttribute("for",X),Qe.innerHTML=ue,ye.appendChild(Te),ye.appendChild(Qe),ye},Tt.prototype.createButton_=function(X,ue){var ye=document.createElement("button");ye.innerHTML=X;var Te=ye.style;return Te.float="right",Te.textTransform="uppercase",Te.color="#1094f7",Te.fontSize="14px",Te.letterSpacing=0,Te.border=0,Te.background="none",Te.marginTop="16px",ye.addEventListener("click",ue),ye};var Yt=typeof window<"u"?window:typeof h<"u"?h:typeof self<"u"?self:{};function $t(X){return X&&X.__esModule&&Object.prototype.hasOwnProperty.call(X,"default")?X.default:X}function Bt(X,ue){return ue={exports:{}},X(ue,ue.exports),ue.exports}var ri=Bt(function(X,ue){(function(ye,Te){X.exports=Te()})(Yt,function(){return function(ye){var Te={};function Qe(Ye){if(Te[Ye])return Te[Ye].exports;var mt=Te[Ye]={i:Ye,l:!1,exports:{}};return ye[Ye].call(mt.exports,mt,mt.exports,Qe),mt.l=!0,mt.exports}return Qe.m=ye,Qe.c=Te,Qe.d=function(Ye,mt,he){Qe.o(Ye,mt)||Object.defineProperty(Ye,mt,{configurable:!1,enumerable:!0,get:he})},Qe.n=function(Ye){var mt=Ye&&Ye.__esModule?function(){return Ye.default}:function(){return Ye};return Qe.d(mt,"a",mt),mt},Qe.o=function(Ye,mt){return Object.prototype.hasOwnProperty.call(Ye,mt)},Qe.p="",Qe(Qe.s=0)}([function(ye,Te,Qe){var Ye=function(){function xe(Ee,ot){for(var Mt=0;Mt<ot.length;Mt++){var Wt=ot[Mt];Wt.enumerable=Wt.enumerable||!1,Wt.configurable=!0,"value"in Wt&&(Wt.writable=!0),Object.defineProperty(Ee,Wt.key,Wt)}}return function(Ee,ot,Mt){return ot&&xe(Ee.prototype,ot),Mt&&xe(Ee,Mt),Ee}}();function mt(xe,Ee){if(!(xe instanceof Ee))throw new TypeError("Cannot call a class as a function")}var he=Qe(1),le=typeof navigator<"u"&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,de=function(){function xe(){mt(this,xe),le?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("playsinline",""),this.noSleepVideo.setAttribute("src",he),this.noSleepVideo.addEventListener("timeupdate",(function(Ee){this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())}).bind(this)))}return Ye(xe,[{key:"enable",value:function(){le?(this.disable(),this.noSleepTimer=window.setInterval(function(){window.location.href="/",window.setTimeout(window.stop,0)},15e3)):this.noSleepVideo.play()}},{key:"disable",value:function(){le?this.noSleepTimer&&(window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause()}}]),xe}();ye.exports=de},function(ye,Te,Qe){ye.exports="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA="}])})}),wi=$t(ri),Ui=1e3,Sr=[0,0,.5,1],ur=[.5,0,.5,1],$i=window.requestAnimationFrame,_i=window.cancelAnimationFrame;function Mn(){this.leftProjectionMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.rightViewMatrix=new Float32Array(16),this.pose=null}function Xn(X){Object.defineProperties(this,{hasPosition:{writable:!1,enumerable:!0,value:X.hasPosition},hasExternalDisplay:{writable:!1,enumerable:!0,value:X.hasExternalDisplay},canPresent:{writable:!1,enumerable:!0,value:X.canPresent},maxLayers:{writable:!1,enumerable:!0,value:X.maxLayers},hasOrientation:{enumerable:!0,get:function(){return Ce("VRDisplayCapabilities.prototype.hasOrientation","VRDisplay.prototype.getFrameData"),X.hasOrientation}}})}function Ii(X){X=X||{};var ue="wakelock"in X?X.wakelock:!0;this.isPolyfilled=!0,this.displayId=Ui++,this.displayName="",this.depthNear=.01,this.depthFar=1e4,this.isPresenting=!1,Object.defineProperty(this,"isConnected",{get:function(){return Ce("VRDisplay.prototype.isConnected","VRDisplayCapabilities.prototype.hasExternalDisplay"),!1}}),this.capabilities=new Xn({hasPosition:!1,hasOrientation:!1,hasExternalDisplay:!1,canPresent:!1,maxLayers:1}),this.stageParameters=null,this.waitingForPresent_=!1,this.layer_=null,this.originalParent_=null,this.fullscreenElement_=null,this.fullscreenWrapper_=null,this.fullscreenElementCachedStyle_=null,this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null,ue&&$e()&&(this.wakelock_=new wi)}Ii.prototype.getFrameData=function(X){return Si(X,this._getPose(),this)},Ii.prototype.getPose=function(){return Ce("VRDisplay.prototype.getPose","VRDisplay.prototype.getFrameData"),this._getPose()},Ii.prototype.resetPose=function(){return Ce("VRDisplay.prototype.resetPose"),this._resetPose()},Ii.prototype.getImmediatePose=function(){return Ce("VRDisplay.prototype.getImmediatePose","VRDisplay.prototype.getFrameData"),this._getPose()},Ii.prototype.requestAnimationFrame=function(X){return $i(X)},Ii.prototype.cancelAnimationFrame=function(X){return _i(X)},Ii.prototype.wrapForFullscreen=function(X){if(W())return X;if(!this.fullscreenWrapper_){this.fullscreenWrapper_=document.createElement("div");var ue=["height: "+Math.min(screen.height,screen.width)+"px !important","top: 0 !important","left: 0 !important","right: 0 !important","border: 0","margin: 0","padding: 0","z-index: 999999 !important","position: fixed"];this.fullscreenWrapper_.setAttribute("style",ue.join("; ")+";"),this.fullscreenWrapper_.classList.add("webvr-polyfill-fullscreen-wrapper")}if(this.fullscreenElement_==X)return this.fullscreenWrapper_;if(this.fullscreenElement_&&(this.originalParent_?this.originalParent_.appendChild(this.fullscreenElement_):this.fullscreenElement_.parentElement.removeChild(this.fullscreenElement_)),this.fullscreenElement_=X,this.originalParent_=X.parentElement,this.originalParent_||document.body.appendChild(X),!this.fullscreenWrapper_.parentElement){var ye=this.fullscreenElement_.parentElement;ye.insertBefore(this.fullscreenWrapper_,this.fullscreenElement_),ye.removeChild(this.fullscreenElement_)}this.fullscreenWrapper_.insertBefore(this.fullscreenElement_,this.fullscreenWrapper_.firstChild),this.fullscreenElementCachedStyle_=this.fullscreenElement_.getAttribute("style");var Te=this;function Qe(){if(Te.fullscreenElement_){var Ye=["position: absolute","top: 0","left: 0","width: "+Math.max(screen.width,screen.height)+"px","height: "+Math.min(screen.height,screen.width)+"px","border: 0","margin: 0","padding: 0"];Te.fullscreenElement_.setAttribute("style",Ye.join("; ")+";")}}return Qe(),this.fullscreenWrapper_},Ii.prototype.removeFullscreenWrapper=function(){if(this.fullscreenElement_){var X=this.fullscreenElement_;this.fullscreenElementCachedStyle_?X.setAttribute("style",this.fullscreenElementCachedStyle_):X.removeAttribute("style"),this.fullscreenElement_=null,this.fullscreenElementCachedStyle_=null;var ue=this.fullscreenWrapper_.parentElement;return this.fullscreenWrapper_.removeChild(X),this.originalParent_===ue?ue.insertBefore(X,this.fullscreenWrapper_):this.originalParent_&&this.originalParent_.appendChild(X),ue.removeChild(this.fullscreenWrapper_),X}},Ii.prototype.requestPresent=function(X){var ue=this.isPresenting,ye=this;return X instanceof Array||(Ce("VRDisplay.prototype.requestPresent with non-array argument","an array of VRLayers as the first argument"),X=[X]),new Promise(function(Te,Qe){if(!ye.capabilities.canPresent){Qe(new Error("VRDisplay is not capable of presenting."));return}if(X.length==0||X.length>ye.capabilities.maxLayers){Qe(new Error("Invalid number of layers."));return}var Ye=X[0];if(!Ye.source){Te();return}var mt=Ye.leftBounds||Sr,he=Ye.rightBounds||ur;if(ue){var le=ye.layer_;le.source!==Ye.source&&(le.source=Ye.source);for(var de=0;de<4;de++)le.leftBounds[de]=mt[de],le.rightBounds[de]=he[de];ye.wrapForFullscreen(ye.layer_.source),ye.updatePresent_(),Te();return}if(ye.layer_={predistorted:Ye.predistorted,source:Ye.source,leftBounds:mt.slice(0),rightBounds:he.slice(0)},ye.waitingForPresent_=!1,ye.layer_&&ye.layer_.source){var xe=ye.wrapForFullscreen(ye.layer_.source),Ee=function(){var Mt=St();ye.isPresenting=xe===Mt,ye.isPresenting?(screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary").catch(function(Wt){console.error("screen.orientation.lock() failed due to",Wt.message)}),ye.waitingForPresent_=!1,ye.beginPresent_(),Te()):(screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),ye.removeFullscreenWrapper(),ye.disableWakeLock(),ye.endPresent_(),ye.removeFullscreenListeners_()),ye.fireVRDisplayPresentChange_()},ot=function(){ye.waitingForPresent_&&(ye.removeFullscreenWrapper(),ye.removeFullscreenListeners_(),ye.disableWakeLock(),ye.waitingForPresent_=!1,ye.isPresenting=!1,Qe(new Error("Unable to present.")))};ye.addFullscreenListeners_(xe,Ee,ot),it(xe)?(ye.enableWakeLock(),ye.waitingForPresent_=!0):(W()||G())&&(ye.enableWakeLock(),ye.isPresenting=!0,ye.beginPresent_(),ye.fireVRDisplayPresentChange_(),Te())}!ye.waitingForPresent_&&!W()&&(dt(),Qe(new Error("Unable to present.")))})},Ii.prototype.exitPresent=function(){var X=this.isPresenting,ue=this;return this.isPresenting=!1,this.layer_=null,this.disableWakeLock(),new Promise(function(ye,Te){X?(!dt()&&W()&&(ue.endPresent_(),ue.fireVRDisplayPresentChange_()),G()&&(ue.removeFullscreenWrapper(),ue.removeFullscreenListeners_(),ue.endPresent_(),ue.fireVRDisplayPresentChange_()),ye()):Te(new Error("Was not presenting to VRDisplay."))})},Ii.prototype.getLayers=function(){return this.layer_?[this.layer_]:[]},Ii.prototype.fireVRDisplayPresentChange_=function(){var X=new CustomEvent("vrdisplaypresentchange",{detail:{display:this}});window.dispatchEvent(X)},Ii.prototype.fireVRDisplayConnect_=function(){var X=new CustomEvent("vrdisplayconnect",{detail:{display:this}});window.dispatchEvent(X)},Ii.prototype.addFullscreenListeners_=function(X,ue,ye){this.removeFullscreenListeners_(),this.fullscreenEventTarget_=X,this.fullscreenChangeHandler_=ue,this.fullscreenErrorHandler_=ye,ue&&(document.fullscreenEnabled?X.addEventListener("fullscreenchange",ue,!1):document.webkitFullscreenEnabled?X.addEventListener("webkitfullscreenchange",ue,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenchange",ue,!1):document.msFullscreenEnabled&&X.addEventListener("msfullscreenchange",ue,!1)),ye&&(document.fullscreenEnabled?X.addEventListener("fullscreenerror",ye,!1):document.webkitFullscreenEnabled?X.addEventListener("webkitfullscreenerror",ye,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenerror",ye,!1):document.msFullscreenEnabled&&X.addEventListener("msfullscreenerror",ye,!1))},Ii.prototype.removeFullscreenListeners_=function(){if(this.fullscreenEventTarget_){var X=this.fullscreenEventTarget_;if(this.fullscreenChangeHandler_){var ue=this.fullscreenChangeHandler_;X.removeEventListener("fullscreenchange",ue,!1),X.removeEventListener("webkitfullscreenchange",ue,!1),document.removeEventListener("mozfullscreenchange",ue,!1),X.removeEventListener("msfullscreenchange",ue,!1)}if(this.fullscreenErrorHandler_){var ye=this.fullscreenErrorHandler_;X.removeEventListener("fullscreenerror",ye,!1),X.removeEventListener("webkitfullscreenerror",ye,!1),document.removeEventListener("mozfullscreenerror",ye,!1),X.removeEventListener("msfullscreenerror",ye,!1)}this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null}},Ii.prototype.enableWakeLock=function(){this.wakelock_&&this.wakelock_.enable()},Ii.prototype.disableWakeLock=function(){this.wakelock_&&this.wakelock_.disable()},Ii.prototype.beginPresent_=function(){},Ii.prototype.endPresent_=function(){},Ii.prototype.submitFrame=function(X){},Ii.prototype.getEyeParameters=function(X){return null};var ar={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1},hn={LEFT:"left",RIGHT:"right"};function qr(X){var ue=Fi({},ar);X=Fi(ue,X||{}),Ii.call(this,{wakelock:X.MOBILE_WAKE_LOCK}),this.config=X,this.displayName="Cardboard VRDisplay",this.capabilities=new Xn({hasPosition:!1,hasOrientation:!0,hasExternalDisplay:!1,canPresent:!0,maxLayers:1}),this.stageParameters=null,this.bufferScale_=this.config.BUFFER_SCALE,this.poseSensor_=new ae(this.config),this.distorter_=null,this.cardboardUI_=null,this.dpdb_=new bs(this.config.DPDB_URL,this.onDeviceParamsUpdated_.bind(this)),this.deviceInfo_=new kr(this.dpdb_.getDeviceParams(),X.ADDITIONAL_VIEWERS),this.viewerSelector_=new Tt(X.DEFAULT_VIEWER),this.viewerSelector_.onChange(this.onViewerChanged_.bind(this)),this.deviceInfo_.setViewer(this.viewerSelector_.getCurrentViewer()),this.config.ROTATE_INSTRUCTIONS_DISABLED||(this.rotateInstructions_=new Le),W()&&window.addEventListener("resize",this.onResize_.bind(this))}return qr.prototype=Object.create(Ii.prototype),qr.prototype._getPose=function(){return{position:null,orientation:this.poseSensor_.getOrientation(),linearVelocity:null,linearAcceleration:null,angularVelocity:null,angularAcceleration:null}},qr.prototype._resetPose=function(){this.poseSensor_.resetPose&&this.poseSensor_.resetPose()},qr.prototype._getFieldOfView=function(X){var ue;if(X==hn.LEFT)ue=this.deviceInfo_.getFieldOfViewLeftEye();else if(X==hn.RIGHT)ue=this.deviceInfo_.getFieldOfViewRightEye();else return console.error("Invalid eye provided: %s",X),null;return ue},qr.prototype._getEyeOffset=function(X){var ue;if(X==hn.LEFT)ue=[-this.deviceInfo_.viewer.interLensDistance*.5,0,0];else if(X==hn.RIGHT)ue=[this.deviceInfo_.viewer.interLensDistance*.5,0,0];else return console.error("Invalid eye provided: %s",X),null;return ue},qr.prototype.getEyeParameters=function(X){var ue=this._getEyeOffset(X),ye=this._getFieldOfView(X),Te={offset:ue,renderWidth:this.deviceInfo_.device.width*.5*this.bufferScale_,renderHeight:this.deviceInfo_.device.height*this.bufferScale_};return Object.defineProperty(Te,"fieldOfView",{enumerable:!0,get:function(){return Ce("VRFieldOfView","VRFrameData's projection matrices"),ye}}),Te},qr.prototype.onDeviceParamsUpdated_=function(X){this.config.DEBUG&&console.log("DPDB reported that device params were updated."),this.deviceInfo_.updateDeviceParams(X),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_)},qr.prototype.updateBounds_=function(){this.layer_&&this.distorter_&&(this.layer_.leftBounds||this.layer_.rightBounds)&&this.distorter_.setTextureBounds(this.layer_.leftBounds,this.layer_.rightBounds)},qr.prototype.beginPresent_=function(){var X=this.layer_.source.getContext("webgl");X||(X=this.layer_.source.getContext("experimental-webgl")),X||(X=this.layer_.source.getContext("webgl2")),X&&(this.layer_.predistorted?this.config.CARDBOARD_UI_DISABLED||(X.canvas.width=Xe()*this.bufferScale_,X.canvas.height=Je()*this.bufferScale_,this.cardboardUI_=new ze(X)):(this.config.CARDBOARD_UI_DISABLED||(this.cardboardUI_=new ze(X)),this.distorter_=new xi(X,this.cardboardUI_,this.config.BUFFER_SCALE,this.config.DIRTY_SUBMIT_FRAME_BINDINGS),this.distorter_.updateDeviceInfo(this.deviceInfo_)),this.cardboardUI_&&this.cardboardUI_.listen((function(ue){this.viewerSelector_.show(this.layer_.source.parentElement),ue.stopPropagation(),ue.preventDefault()}).bind(this),(function(ue){this.exitPresent(),ue.stopPropagation(),ue.preventDefault()}).bind(this)),this.rotateInstructions_&&(me()&&$e()?this.rotateInstructions_.showTemporarily(3e3,this.layer_.source.parentElement):this.rotateInstructions_.update()),this.orientationHandler=this.onOrientationChange_.bind(this),window.addEventListener("orientationchange",this.orientationHandler),this.vrdisplaypresentchangeHandler=this.updateBounds_.bind(this),window.addEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler),this.fireVRDisplayDeviceParamsChange_())},qr.prototype.endPresent_=function(){this.distorter_&&(this.distorter_.destroy(),this.distorter_=null),this.cardboardUI_&&(this.cardboardUI_.destroy(),this.cardboardUI_=null),this.rotateInstructions_&&this.rotateInstructions_.hide(),this.viewerSelector_.hide(),window.removeEventListener("orientationchange",this.orientationHandler),window.removeEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler)},qr.prototype.updatePresent_=function(){this.endPresent_(),this.beginPresent_()},qr.prototype.submitFrame=function(X){if(this.distorter_)this.updateBounds_(),this.distorter_.submitFrame();else if(this.cardboardUI_&&this.layer_){var ue=this.layer_.source.getContext("webgl");ue||(ue=this.layer_.source.getContext("experimental-webgl")),ue||(ue=this.layer_.source.getContext("webgl2"));var ye=ue.canvas;(ye.width!=this.lastWidth||ye.height!=this.lastHeight)&&this.cardboardUI_.onResize(),this.lastWidth=ye.width,this.lastHeight=ye.height,this.cardboardUI_.render()}},qr.prototype.onOrientationChange_=function(X){this.viewerSelector_.hide(),this.rotateInstructions_&&this.rotateInstructions_.update(),this.onResize_()},qr.prototype.onResize_=function(X){if(this.layer_){var ue=this.layer_.source.getContext("webgl");ue||(ue=this.layer_.source.getContext("experimental-webgl")),ue||(ue=this.layer_.source.getContext("webgl2"));var ye=["position: absolute","top: 0","left: 0","width: 100vw","height: 100vh","border: 0","margin: 0","padding: 0px","box-sizing: content-box"];ue.canvas.setAttribute("style",ye.join("; ")+";"),ui(ue.canvas)}},qr.prototype.onViewerChanged_=function(X){this.deviceInfo_.setViewer(X),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_),this.fireVRDisplayDeviceParamsChange_()},qr.prototype.fireVRDisplayDeviceParamsChange_=function(){var X=new CustomEvent("vrdisplaydeviceparamschange",{detail:{vrdisplay:this,deviceInfo:this.deviceInfo_}});window.dispatchEvent(X)},qr.VRFrameData=Mn,qr.VRDisplay=Ii,qr})}),v=p(b),_="0.10.12",T={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",PROVIDE_MOBILE_VRDISPLAY:!0,MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1};function E(I){this.config=y(y({},T),I),this.polyfillDisplays=[],this.enabled=!1,this.hasNative="getVRDisplays"in navigator,this.native={},this.native.getVRDisplays=navigator.getVRDisplays,this.native.VRFrameData=window.VRFrameData,this.native.VRDisplay=window.VRDisplay,(!this.hasNative||this.config.PROVIDE_MOBILE_VRDISPLAY&&g())&&(this.enable(),this.getVRDisplays().then(function(N){N&&N[0]&&N[0].fireVRDisplayConnect_&&N[0].fireVRDisplayConnect_()}))}E.prototype.getPolyfillDisplays=function(){if(this._polyfillDisplaysPopulated)return this.polyfillDisplays;if(g()){var I=new v({ADDITIONAL_VIEWERS:this.config.ADDITIONAL_VIEWERS,DEFAULT_VIEWER:this.config.DEFAULT_VIEWER,MOBILE_WAKE_LOCK:this.config.MOBILE_WAKE_LOCK,DEBUG:this.config.DEBUG,DPDB_URL:this.config.DPDB_URL,CARDBOARD_UI_DISABLED:this.config.CARDBOARD_UI_DISABLED,K_FILTER:this.config.K_FILTER,PREDICTION_TIME_S:this.config.PREDICTION_TIME_S,ROTATE_INSTRUCTIONS_DISABLED:this.config.ROTATE_INSTRUCTIONS_DISABLED,YAW_ONLY:this.config.YAW_ONLY,BUFFER_SCALE:this.config.BUFFER_SCALE,DIRTY_SUBMIT_FRAME_BINDINGS:this.config.DIRTY_SUBMIT_FRAME_BINDINGS});this.polyfillDisplays.push(I)}return this._polyfillDisplaysPopulated=!0,this.polyfillDisplays},E.prototype.enable=function(){if(this.enabled=!0,this.hasNative&&this.native.VRFrameData){var I=this.native.VRFrameData,N=new this.native.VRFrameData,D=this.native.VRDisplay.prototype.getFrameData;window.VRDisplay.prototype.getFrameData=function(P){if(P instanceof I){D.call(this,P);return}D.call(this,N),P.pose=N.pose,m(N.leftProjectionMatrix,P.leftProjectionMatrix),m(N.rightProjectionMatrix,P.rightProjectionMatrix),m(N.leftViewMatrix,P.leftViewMatrix),m(N.rightViewMatrix,P.rightViewMatrix)}}navigator.getVRDisplays=this.getVRDisplays.bind(this),window.VRDisplay=v.VRDisplay,window.VRFrameData=v.VRFrameData},E.prototype.getVRDisplays=function(){var I=this;return this.config,this.hasNative?this.native.getVRDisplays.call(navigator).then(function(N){return N.length>0?N:I.getPolyfillDisplays()}):Promise.resolve(this.getPolyfillDisplays())},E.version=_,E.VRFrameData=v.VRFrameData,E.VRDisplay=v.VRDisplay;var C=Object.freeze({default:E}),R=C&&E||C;typeof h<"u"&&h.window&&(h.document||(h.document=h.window.document),h.navigator||(h.navigator=h.window.navigator));var B=R;return B})},"./node_modules/word-wrapper/index.js":l=>{var u=/\n/,c=`
`,h=/\s/;l.exports=function(b,v){var _=l.exports.lines(b,v);return _.map(function(T){return b.substring(T.start,T.end)}).join(`
`)},l.exports.lines=function(b,v){if(v=v||{},v.width===0&&v.mode!=="nowrap")return[];b=b||"";var _=typeof v.width=="number"?v.width:Number.MAX_VALUE,T=Math.max(0,v.start||0),E=typeof v.end=="number"?v.end:b.length,C=v.mode,R=v.measure||y;return C==="pre"?g(R,b,T,E,_):m(R,b,T,E,_,C)};function p(b,v,_,T){var E=b.indexOf(v,_);return E===-1||E>T?T:E}function f(b){return h.test(b)}function g(b,v,_,T,E){for(var C=[],R=_,B=_;B<T&&B<v.length;B++){var I=v.charAt(B),N=u.test(I);if(N||B===T-1){var D=N?B:B+1,P=b(v,R,D,E);C.push(P),R=B+1}}return C}function m(b,v,_,T,E,C){var R=[],B=E;for(C==="nowrap"&&(B=Number.MAX_VALUE);_<T&&_<v.length;){for(var I=p(v,c,_,T);_<I&&f(v.charAt(_));)_++;var N=b(v,_,I,B),D=_+(N.end-N.start),P=D+c.length;if(D<I){for(;D>_&&!f(v.charAt(D));)D--;if(D===_)P>_+c.length&&P--,D=P;else for(P=D;D>_&&f(v.charAt(D-c.length));)D--}if(D>=_){var k=b(v,_,D,B);R.push(k)}_=P}return R}function y(b,v,_,T){var E=Math.min(T,_-v);return{start:v,end:v+E}}},"./node_modules/xhr/index.js":(l,u,c)=>{var h=c("./node_modules/global/window.js"),p=c("./node_modules/is-function/index.js"),f=c("./node_modules/parse-headers/parse-headers.js"),g=c("./node_modules/xtend/immutable.js");l.exports=v,l.exports.default=v,v.XMLHttpRequest=h.XMLHttpRequest||E,v.XDomainRequest="withCredentials"in new v.XMLHttpRequest?v.XMLHttpRequest:h.XDomainRequest,m(["get","put","post","patch","head","delete"],function(C){v[C==="delete"?"del":C]=function(R,B,I){return B=b(R,B,I),B.method=C.toUpperCase(),_(B)}});function m(C,R){for(var B=0;B<C.length;B++)R(C[B])}function y(C){for(var R in C)if(C.hasOwnProperty(R))return!1;return!0}function b(C,R,B){var I=C;return p(R)?(B=R,typeof C=="string"&&(I={uri:C})):I=g(R,{uri:C}),I.callback=B,I}function v(C,R,B){return R=b(C,R,B),_(R)}function _(C){if(typeof C.callback>"u")throw new Error("callback argument missing");var R=!1,B=function(ve,Ae,me){R||(R=!0,C.callback(ve,Ae,me))};function I(){k.readyState===4&&setTimeout(P,0)}function N(){var ve=void 0;if(k.response?ve=k.response:ve=k.responseText||T(k),te)try{ve=JSON.parse(ve)}catch{}return ve}function D(ve){return clearTimeout(Y),ve instanceof Error||(ve=new Error(""+(ve||"Unknown XMLHttpRequest Error"))),ve.statusCode=0,B(ve,se)}function P(){if(!V){var ve;clearTimeout(Y),C.useXDR&&k.status===void 0?ve=200:ve=k.status===1223?204:k.status;var Ae=se,me=null;return ve!==0?(Ae={body:N(),statusCode:ve,method:Q,headers:{},url:j,rawRequest:k},k.getAllResponseHeaders&&(Ae.headers=f(k.getAllResponseHeaders()))):me=new Error("Internal XMLHttpRequest Error"),B(me,Ae,Ae.body)}}var k=C.xhr||null;k||(C.cors||C.useXDR?k=new v.XDomainRequest:k=new v.XMLHttpRequest);var q,V,j=k.url=C.uri||C.url,Q=k.method=C.method||"GET",W=C.body||C.data,G=k.headers=C.headers||{},z=!!C.sync,te=!1,Y,se={body:void 0,headers:{},statusCode:0,method:Q,url:j,rawRequest:k};if("json"in C&&C.json!==!1&&(te=!0,G.accept||G.Accept||(G.Accept="application/json"),Q!=="GET"&&Q!=="HEAD"&&(G["content-type"]||G["Content-Type"]||(G["Content-Type"]="application/json"),W=JSON.stringify(C.json===!0?W:C.json))),k.onreadystatechange=I,k.onload=P,k.onerror=D,k.onprogress=function(){},k.onabort=function(){V=!0},k.ontimeout=D,k.open(Q,j,!z,C.username,C.password),z||(k.withCredentials=!!C.withCredentials),!z&&C.timeout>0&&(Y=setTimeout(function(){if(!V){V=!0,k.abort("timeout");var ve=new Error("XMLHttpRequest timeout");ve.code="ETIMEDOUT",D(ve)}},C.timeout)),k.setRequestHeader)for(q in G)G.hasOwnProperty(q)&&k.setRequestHeader(q,G[q]);else if(C.headers&&!y(C.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in C&&(k.responseType=C.responseType),"beforeSend"in C&&typeof C.beforeSend=="function"&&C.beforeSend(k),k.send(W||null),k}function T(C){try{if(C.responseType==="document")return C.responseXML;var R=C.responseXML&&C.responseXML.documentElement.nodeName==="parsererror";if(C.responseType===""&&!R)return C.responseXML}catch{}return null}function E(){}},"./node_modules/xml-parse-from-string/index.js":l=>{l.exports=function(){return typeof self.DOMParser<"u"?function(u){var c=new self.DOMParser;return c.parseFromString(u,"application/xml")}:typeof self.ActiveXObject<"u"&&new self.ActiveXObject("Microsoft.XMLDOM")?function(u){var c=new self.ActiveXObject("Microsoft.XMLDOM");return c.async="false",c.loadXML(u),c}:function(u){var c=document.createElement("div");return c.innerHTML=u,c}}()},"./node_modules/xtend/immutable.js":l=>{l.exports=c;var u=Object.prototype.hasOwnProperty;function c(){for(var h={},p=0;p<arguments.length;p++){var f=arguments[p];for(var g in f)u.call(f,g)&&(h[g]=f[g])}return h}},"./src/components/anchored.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/utils/index.js"),f=p.debug("components:anchored:warn");l.exports.Component=h("anchored",{schema:{persistent:{default:!1}},init:function(){var m=this.el.sceneEl,y=m.getAttribute("webxr"),b=y.optionalFeatures;b.indexOf("anchors")===-1&&(b.push("anchors"),this.el.sceneEl.setAttribute("webxr",y)),this.auxQuaternion=new THREE.Quaternion,this.onEnterVR=this.onEnterVR.bind(this),this.el.sceneEl.addEventListener("enter-vr",this.onEnterVR)},onEnterVR:function(){this.anchor=void 0,this.requestPersistentAnchorPending=this.data.persistent,this.requestAnchorPending=!this.data.persistent},tick:function(){var m=this.el.sceneEl,y=m.renderer.xr,b,v,_,T=this.el.object3D;!m.is("ar-mode")&&!m.is("vr-mode")||(!this.anchor&&this.requestPersistentAnchorPending&&this.restorePersistentAnchor(),!this.anchor&&this.requestAnchorPending&&this.createAnchor(),this.anchor&&(b=m.frame,v=y.getReferenceSpace(),_=b.getPose(this.anchor.anchorSpace,v),T.matrix.elements=_.transform.matrix,T.matrix.decompose(T.position,T.rotation,T.scale)))},createAnchor:async function(m,y){var b=this.el.sceneEl,v=b.renderer.xr,_,T,E,C,R=this.el.object3D;if(m=m||R.position,y=y||this.auxQuaternion.setFromEuler(R.rotation),!g(b)){f("This browser doesn't support the WebXR anchors module");return}this.anchor&&this.deleteAnchor(),_=b.frame,T=v.getReferenceSpace(),E=new XRRigidTransform({x:m.x,y:m.y,z:m.z},{x:y.x,y:y.y,z:y.z,w:y.w}),this.requestAnchorPending=!1,C=await _.createAnchor(E,T),this.data.persistent&&(this.el.id?(this.persistentHandle=await C.requestPersistentHandle(),localStorage.setItem(this.el.id,this.persistentHandle)):f("The anchor won't be persisted because the entity has no assigned id.")),b.object3D.attach(this.el.object3D),this.anchor=C},restorePersistentAnchor:async function(){var m=this.el.sceneEl.renderer.xr,y=m.getSession(),b=y.persistentAnchors,v;if(this.requestPersistentAnchorPending=!1,!this.el.id){f("The entity associated to the persistent anchor cannot be retrieved because it doesn't have an assigned id."),this.requestAnchorPending=!0;return}if(b){v=localStorage.getItem(this.el.id);for(var _=0;_<b.length;++_)if(v===b[_]){this.anchor=await y.restorePersistentAnchor(b[_]),this.anchor&&(this.persistentHandle=b[_]);break}this.anchor||(this.requestAnchorPending=!0)}else this.requestPersistentAnchorPending=!0},deleteAnchor:function(){var m,y,b=this.anchor;b&&(m=this.el.sceneEl.renderer.xr,y=m.getSession(),b.delete(),this.el.sceneEl.object3D.add(this.el.object3D),this.persistentHandle&&y.deletePersistentAnchor(this.persistentHandle),this.anchor=void 0)}});function g(m){var y=m.renderer.xr,b=y.getSession();return b&&b.restorePersistentAnchor}},"./src/components/animation.js":(l,u,c)=>{var h=c("./node_modules/super-animejs/lib/anime.es.js").default,p=c("./src/core/component.js").components,f=c("./src/core/component.js").registerComponent,g=c("./src/lib/three.js"),m=c("./src/utils/index.js"),y=new g.Color,b=new g.Color,v=m.entity.getComponentProperty,_=m.entity.setComponentProperty,T={},E="color",C="position",R="rotation",B="scale",I="components",N="object3D";l.exports.Component=f("animation",{schema:{autoplay:{default:!0},delay:{default:0},dir:{default:""},dur:{default:1e3},easing:{default:"easeInQuad"},elasticity:{default:400},enabled:{default:!0},from:{default:""},loop:{default:0,parse:function(G){return G===!0||G==="true"?!0:G===!1||G==="false"?!1:parseInt(G,10)}},property:{default:""},startEvents:{type:"array"},pauseEvents:{type:"array"},resumeEvents:{type:"array"},round:{default:!1},to:{default:""},type:{default:""},isRawProperty:{default:!1}},multiple:!0,init:function(){var G=this;this.eventDetail={name:this.attrName},this.time=0,this.animation=null,this.animationIsPlaying=!1,this.onStartEvent=this.onStartEvent.bind(this),this.beginAnimation=this.beginAnimation.bind(this),this.pauseAnimation=this.pauseAnimation.bind(this),this.resumeAnimation=this.resumeAnimation.bind(this),this.fromColor={},this.toColor={},this.targets={},this.targetsArray=[],this.updateConfigForDefault=this.updateConfigForDefault.bind(this),this.updateConfigForRawColor=this.updateConfigForRawColor.bind(this),this.config={complete:function(){G.animationIsPlaying=!1,G.el.emit("animationcomplete",G.eventDetail,!1),G.id&&G.el.emit("animationcomplete__"+G.id,G.eventDetail,!1)}}},update:function(G){var z=this.config,te=this.data;this.animationIsPlaying=!1,this.data.enabled&&te.property&&(z.autoplay=!1,z.direction=te.dir,z.duration=te.dur,z.easing=te.easing,z.elasticity=te.elasticity,z.loop=te.loop,z.round=te.round,this.createAndStartAnimation())},tick:function(G,z){this.animationIsPlaying&&(this.time+=z,this.animation.tick(this.time))},remove:function(){this.pauseAnimation(),this.removeEventListeners()},pause:function(){this.paused=!0,this.pausedWasPlaying=this.animationIsPlaying,this.pauseAnimation(),this.removeEventListeners()},play:function(){this.paused&&(this.paused=!1,this.addEventListeners(),this.pausedWasPlaying&&(this.resumeAnimation(),this.pausedWasPlaying=!1))},createAndStartAnimation:function(){var G=this.data;if(this.updateConfig(),this.animationIsPlaying=!1,this.animation=h(this.config),this.animation.began=!0,this.removeEventListeners(),this.addEventListeners(),!(!G.autoplay||G.startEvents&&G.startEvents.length)){if(G.delay){setTimeout(this.beginAnimation,G.delay);return}this.beginAnimation()}},beginAnimation:function(){this.updateConfig(),this.animation.began=!0,this.time=0,this.animationIsPlaying=!0,this.stopRelatedAnimations(),this.el.emit("animationbegin",this.eventDetail,!1)},pauseAnimation:function(){this.animationIsPlaying=!1},resumeAnimation:function(){this.animationIsPlaying=!0},onStartEvent:function(){if(this.data.enabled){if(this.updateConfig(),this.animation&&this.animation.pause(),this.animation=h(this.config),this.data.delay){setTimeout(this.beginAnimation,this.data.delay);return}this.beginAnimation()}},updateConfigForRawColor:function(){var G=this.config,z=this.data,te=this.el,Y,se,ve;if(!this.waitComponentInitRawProperty(this.updateConfigForRawColor)){Y=z.from===""?V(te,z.property):z.from,ve=z.to,this.setColorConfig(Y,ve),Y=this.fromColor,ve=this.toColor,this.targetsArray.length=0,this.targetsArray.push(Y),G.targets=this.targetsArray;for(se in ve)G[se]=ve[se];G.update=function(){var Ae={};return function(me){var Oe;Oe=me.animatables[0].target,!(Oe.r===Ae.r&&Oe.g===Ae.g&&Oe.b===Ae.b)&&j(te,z.property,Oe,z.type)}}()}},updateConfigForDefault:function(){var G=this.config,z=this.data,te=this.el,Y,se,ve,Ae;this.waitComponentInitRawProperty(this.updateConfigForDefault)||(z.from===""?Y=W(z)?V(te,z.property):v(te,z.property):Y=z.from,Ae=z.to,ve=!isNaN(Y||Ae),ve?(Y=parseFloat(Y),Ae=parseFloat(Ae)):(Y=Y&&Y.toString(),Ae=Ae&&Ae.toString()),se=z.to==="true"||z.to==="false"||z.to===!0||z.to===!1,se&&(Y=z.from==="true"||z.from===!0?1:0,Ae=z.to==="true"||z.to===!0?1:0),this.targets.aframeProperty=Y,G.targets=this.targets,G.aframeProperty=Ae,G.update=function(){var me;return function(Oe){var Xe;Xe=Oe.animatables[0].target.aframeProperty,Xe!==me&&(me=Xe,se&&(Xe=Xe>=1),W(z)?j(te,z.property,Xe,z.type):_(te,z.property,Xe))}}())},updateConfigForVector:function(){var G=this.config,z=this.data,te=this.el,Y,se,ve;se=z.from!==""?m.coordinates.parse(z.from):v(te,z.property),ve=m.coordinates.parse(z.to),z.property===R&&(P(se),P(ve)),this.targetsArray.length=0,this.targetsArray.push(se),G.targets=this.targetsArray;for(Y in ve)G[Y]=ve[Y];if(z.property===C||z.property===R||z.property===B){G.update=function(){var Ae={};return function(me){var Oe=me.animatables[0].target;Oe.x===Ae.x&&Oe.y===Ae.y&&Oe.z===Ae.z||(Ae.x=Oe.x,Ae.y=Oe.y,Ae.z=Oe.z,te.object3D[z.property].set(Oe.x,Oe.y,Oe.z))}}();return}G.update=function(){var Ae={};return function(me){var Oe=me.animatables[0].target;Oe.x===Ae.x&&Oe.y===Ae.y&&Oe.z===Ae.z||(Ae.x=Oe.x,Ae.y=Oe.y,Ae.z=Oe.z,_(te,z.property,Oe))}}()},updateConfig:function(){var G;G=D(this.el,this.data.property),W(this.data)&&this.data.type===E?this.updateConfigForRawColor():G==="vec2"||G==="vec3"||G==="vec4"?this.updateConfigForVector():this.updateConfigForDefault()},waitComponentInitRawProperty:function(G){var z,te=this.data,Y=this.el,se=this;return te.from!==""||!te.property.startsWith(I)||(z=Q(te.property)[1],Y.components[z])?!1:(Y.addEventListener("componentinitialized",function ve(Ae){Ae.detail.name===z&&(G(),se.animation=h(se.config),Y.removeEventListener("componentinitialized",ve))}),!0)},stopRelatedAnimations:function(){var G,z;for(z in this.el.components)G=this.el.components[z],z!==this.attrName&&G.name==="animation"&&G.animationIsPlaying&&G.data.property===this.data.property&&(G.animationIsPlaying=!1)},addEventListeners:function(){var G=this.data,z=this.el;k(z,G.startEvents,this.onStartEvent),k(z,G.pauseEvents,this.pauseAnimation),k(z,G.resumeEvents,this.resumeAnimation)},removeEventListeners:function(){var G=this.data,z=this.el;q(z,G.startEvents,this.onStartEvent),q(z,G.pauseEvents,this.pauseAnimation),q(z,G.resumeEvents,this.resumeAnimation)},setColorConfig:function(G,z){y.set(G),b.set(z),G=this.fromColor,z=this.toColor,G.r=y.r,G.g=y.g,G.b=y.b,z.r=b.r,z.g=b.g,z.b=b.b}});function D(G,z){var te,Y,se,ve;return se=z.split("."),Y=se[0],ve=se[1],te=G.components[Y]||p[Y],!te||ve&&!te.schema[ve]?null:ve?te.schema[ve].type:te.schema.type}function P(G){G.x=g.MathUtils.degToRad(G.x),G.y=g.MathUtils.degToRad(G.y),G.z=g.MathUtils.degToRad(G.z)}function k(G,z,te){var Y;for(Y=0;Y<z.length;Y++)G.addEventListener(z[Y],te)}function q(G,z,te){var Y;for(Y=0;Y<z.length;Y++)G.removeEventListener(z[Y],te)}function V(G,z){var te,Y,se;for(Y=Q(z),se=G,te=0;te<Y.length;te++)se=se[Y[te]];if(se===void 0)throw console.log(G),new Error("[animation] property ("+z+") could not be found");return se}function j(G,z,te,Y){var se,ve,Ae,me;for(z.startsWith("object3D.rotation")&&(te=g.MathUtils.degToRad(te)),ve=Q(z),me=G,se=0;se<ve.length-1;se++)me=me[ve[se]];if(Ae=ve[ve.length-1],Y===E){"r"in me[Ae]?(me[Ae].r=te.r,me[Ae].g=te.g,me[Ae].b=te.b):(me[Ae].x=te.r,me[Ae].y=te.g,me[Ae].z=te.b);return}me[Ae]=te}function Q(G){return G in T||(T[G]=G.split(".")),T[G]}function W(G){return G.isRawProperty||G.property.startsWith(I)||G.property.startsWith(N)}},"./src/components/camera.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/lib/three.js");l.exports.Component=h("camera",{schema:{active:{default:!0},far:{default:1e4},fov:{default:80,min:0},near:{default:.005,min:0},spectator:{default:!1},zoom:{default:1,min:0}},init:function(){var f,g=this.el;f=this.camera=new p.PerspectiveCamera,g.setObject3D("camera",f)},update:function(f){var g=this.data,m=this.camera;m.aspect=g.aspect||window.innerWidth/window.innerHeight,m.far=g.far,m.fov=g.fov,m.near=g.near,m.zoom=g.zoom,m.updateProjectionMatrix(),this.updateActiveCamera(f),this.updateSpectatorCamera(f)},updateActiveCamera:function(f){var g=this.data,m=this.el,y=this.system;f&&f.active===g.active||g.spectator||(g.active&&y.activeCameraEl!==m?y.setActiveCamera(m):!g.active&&y.activeCameraEl===m&&y.disableActiveCamera())},updateSpectatorCamera:function(f){var g=this.data,m=this.el,y=this.system;f&&f.spectator===g.spectator||(g.spectator&&y.spectatorCameraEl!==m?y.setSpectatorCamera(m):!g.spectator&&y.spectatorCameraEl===m&&y.disableSpectatorCamera())},remove:function(){this.el.removeObject3D("camera")}})},"./src/components/cursor.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/utils/index.js"),f={CLICK:"click",FUSING:"fusing",MOUSEENTER:"mouseenter",MOUSEDOWN:"mousedown",MOUSELEAVE:"mouseleave",MOUSEUP:"mouseup"},g={FUSING:"cursor-fusing",HOVERING:"cursor-hovering",HOVERED:"cursor-hovered"},m={DOWN:["mousedown","touchstart"],UP:["mouseup","touchend"]},y={DOWN:["selectstart"],UP:["selectend"]},b="a-mouse-cursor-hover";l.exports.Component=h("cursor",{dependencies:["raycaster"],schema:{downEvents:{default:[]},fuse:{default:p.device.isMobile()},fuseTimeout:{default:1500,min:0},mouseCursorStylesEnabled:{default:!0},upEvents:{default:[]},rayOrigin:{default:"entity",oneOf:["mouse","entity","xrselect"]}},after:["tracked-controls"],multiple:!0,init:function(){var v=this;this.fuseTimeout=void 0,this.cursorDownEl=null,this.intersectedEl=null,this.canvasBounds=document.body.getBoundingClientRect(),this.isCursorDown=!1,this.activeXRInput=null,this.updateCanvasBounds=p.debounce(function(){v.canvasBounds=v.el.sceneEl.canvas.getBoundingClientRect()},500),this.eventDetail={},this.intersectedEventDetail={cursorEl:this.el},this.onCursorDown=this.onCursorDown.bind(this),this.onCursorUp=this.onCursorUp.bind(this),this.onIntersection=this.onIntersection.bind(this),this.onIntersectionCleared=this.onIntersectionCleared.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onEnterVR=this.onEnterVR.bind(this)},update:function(v){this.data.rayOrigin!==v.rayOrigin&&this.updateMouseEventListeners()},tick:function(){var v=this.el.sceneEl.frame,_=this.activeXRInput;this.data.rayOrigin==="xrselect"&&v&&_&&this.onMouseMove({frame:v,inputSource:_,type:"fakeselectevent"})},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners()},remove:function(){var v=this.el;v.removeState(g.HOVERING),v.removeState(g.FUSING),clearTimeout(this.fuseTimeout),this.intersectedEl&&this.intersectedEl.removeState(g.HOVERED),this.removeEventListeners()},addEventListeners:function(){var v,_=this.data,T=this.el,E=this;function C(){v=T.sceneEl.canvas,!(_.downEvents.length||_.upEvents.length)&&(m.DOWN.forEach(function(R){v.addEventListener(R,E.onCursorDown,{passive:!1})}),m.UP.forEach(function(R){v.addEventListener(R,E.onCursorUp,{passive:!1})}))}v=T.sceneEl.canvas,v?C():T.sceneEl.addEventListener("render-target-loaded",C),_.downEvents.forEach(function(R){T.addEventListener(R,E.onCursorDown)}),_.upEvents.forEach(function(R){T.addEventListener(R,E.onCursorUp)}),T.addEventListener("raycaster-intersection",this.onIntersection),T.addEventListener("raycaster-closest-entity-changed",this.onIntersection),T.addEventListener("raycaster-intersection-cleared",this.onIntersectionCleared),T.sceneEl.addEventListener("rendererresize",this.updateCanvasBounds),T.sceneEl.addEventListener("enter-vr",this.onEnterVR),window.addEventListener("resize",this.updateCanvasBounds),window.addEventListener("scroll",this.updateCanvasBounds),this.updateMouseEventListeners()},removeEventListeners:function(){var v,_=this.data,T=this.el,E=this;v=T.sceneEl.canvas,v&&!_.downEvents.length&&!_.upEvents.length&&(m.DOWN.forEach(function(C){v.removeEventListener(C,E.onCursorDown)}),m.UP.forEach(function(C){v.removeEventListener(C,E.onCursorUp)})),_.downEvents.forEach(function(C){T.removeEventListener(C,E.onCursorDown)}),_.upEvents.forEach(function(C){T.removeEventListener(C,E.onCursorUp)}),T.removeEventListener("raycaster-intersection",this.onIntersection),T.removeEventListener("raycaster-intersection-cleared",this.onIntersectionCleared),v.removeEventListener("mousemove",this.onMouseMove),v.removeEventListener("touchstart",this.onMouseMove),v.removeEventListener("touchmove",this.onMouseMove),T.sceneEl.removeEventListener("rendererresize",this.updateCanvasBounds),T.sceneEl.removeEventListener("enter-vr",this.onEnterVR),window.removeEventListener("resize",this.updateCanvasBounds),window.removeEventListener("scroll",this.updateCanvasBounds)},updateMouseEventListeners:function(){var v,_=this.el;v=_.sceneEl.canvas,v.removeEventListener("mousemove",this.onMouseMove),v.removeEventListener("touchmove",this.onMouseMove),_.setAttribute("raycaster","useWorldCoordinates",!1),this.data.rayOrigin==="mouse"&&(v.addEventListener("mousemove",this.onMouseMove),v.addEventListener("touchmove",this.onMouseMove,{passive:!1}),_.setAttribute("raycaster","useWorldCoordinates",!0),this.updateCanvasBounds())},onMouseMove:function(){var v=new THREE.Vector3,_=new THREE.Vector2,T=new THREE.Vector3,E={origin:T,direction:v};return function(C){var R=this.canvasBounds,B=this.el.sceneEl.camera,I,N,D,P,k,q,V,j;B.parent.updateMatrixWorld(),C.type==="touchmove"||C.type==="touchstart"?N=C.touches.item(0):N=C,I=N.clientX-R.left,D=N.clientY-R.top,_.x=I/R.width*2-1,_.y=-(D/R.height)*2+1,this.data.rayOrigin==="xrselect"&&(C.type==="selectstart"||C.type==="fakeselectevent")?(P=C.frame,k=C.inputSource,q=this.el.renderer.xr.getReferenceSpace(),V=P.getPose(k.targetRaySpace,q),j=V.transform,v.set(0,0,-1),v.applyQuaternion(j.orientation),T.copy(j.position)):C.type==="fakeselectout"?(v.set(0,1,0),T.set(0,9999,0)):B&&B.isPerspectiveCamera?(T.setFromMatrixPosition(B.matrixWorld),v.set(_.x,_.y,.5).unproject(B).sub(T).normalize()):B&&B.isOrthographicCamera?(T.set(_.x,_.y,(B.near+B.far)/(B.near-B.far)).unproject(B),v.set(0,0,-1).transformDirection(B.matrixWorld)):console.error("AFRAME.Raycaster: Unsupported camera type: "+B.type),this.el.setAttribute("raycaster",E),C.type==="touchmove"&&C.preventDefault()}}(),onCursorDown:function(v){this.isCursorDown=!0,this.data.rayOrigin==="mouse"&&v.type==="touchstart"&&(this.onMouseMove(v),this.el.components.raycaster.checkIntersections(),v.preventDefault()),this.data.rayOrigin==="xrselect"&&v.type==="selectstart"&&(this.activeXRInput=v.inputSource,this.onMouseMove(v),this.el.components.raycaster.checkIntersections(),this.el.components.raycaster.intersectedEls.length&&this.el.sceneEl.components["ar-hit-test"]!==void 0&&this.el.sceneEl.getAttribute("ar-hit-test").enabled&&(this.el.sceneEl.setAttribute("ar-hit-test","enabled",!1),this.reenableARHitTest=!0)),this.twoWayEmit(f.MOUSEDOWN,v),this.cursorDownEl=this.intersectedEl},onCursorUp:function(v){if(this.isCursorDown){this.isCursorDown=!1;var _=this.data;this.twoWayEmit(f.MOUSEUP,v),this.reenableARHitTest===!0&&(this.el.sceneEl.setAttribute("ar-hit-test","enabled",!0),this.reenableARHitTest=void 0),this.cursorDownEl&&this.cursorDownEl!==this.intersectedEl&&(this.intersectedEventDetail.intersection=null,this.cursorDownEl.emit(f.MOUSEUP,this.intersectedEventDetail)),(!_.fuse||_.rayOrigin==="mouse"||_.rayOrigin==="xrselect")&&this.intersectedEl&&this.cursorDownEl===this.intersectedEl&&this.twoWayEmit(f.CLICK,v),_.rayOrigin==="xrselect"&&this.activeXRInput===v.inputSource&&this.onMouseMove({type:"fakeselectout"}),this.activeXRInput=null,this.cursorDownEl=null,v.type==="touchend"&&v.preventDefault()}},onIntersection:function(v){var _,T=this.el,E,C,R;E=v.detail.els[0]===T?1:0,R=v.detail.intersections[E],C=v.detail.els[E],C&&this.intersectedEl!==C&&(this.intersectedEl&&(_=this.el.components.raycaster.getIntersection(this.intersectedEl),_&&_.distance<=R.distance)||(this.clearCurrentIntersection(!0),this.setIntersection(C,R)))},onIntersectionCleared:function(v){var _=v.detail.clearedEls;_.indexOf(this.intersectedEl)!==-1&&this.clearCurrentIntersection()},onEnterVR:function(){this.clearCurrentIntersection(!0);var v=this.el.sceneEl.xrSession,_=this;v&&this.data.rayOrigin!=="mouse"&&(y.DOWN.forEach(function(T){v.addEventListener(T,_.onCursorDown)}),y.UP.forEach(function(T){v.addEventListener(T,_.onCursorUp)}))},setIntersection:function(v,_){var T=this.el,E=this.data,C=this;this.intersectedEl!==v&&(this.intersectedEl=v,T.addState(g.HOVERING),v.addState(g.HOVERED),this.twoWayEmit(f.MOUSEENTER),this.data.mouseCursorStylesEnabled&&this.data.rayOrigin==="mouse"&&this.el.sceneEl.canvas.classList.add(b),!(E.fuseTimeout===0||!E.fuse||E.rayOrigin==="xrselect"||E.rayOrigin==="mouse")&&(T.addState(g.FUSING),this.twoWayEmit(f.FUSING),this.fuseTimeout=setTimeout(function(){T.removeState(g.FUSING),C.twoWayEmit(f.CLICK)},E.fuseTimeout)))},clearCurrentIntersection:function(v){var _,T,E,C=this.el;this.intersectedEl&&(this.intersectedEl.removeState(g.HOVERED),C.removeState(g.HOVERING),C.removeState(g.FUSING),this.twoWayEmit(f.MOUSELEAVE),this.data.mouseCursorStylesEnabled&&this.data.rayOrigin==="mouse"&&this.el.sceneEl.canvas.classList.remove(b),this.intersectedEl=null,clearTimeout(this.fuseTimeout),v!==!0&&(E=this.el.components.raycaster.intersections,E.length!==0&&(_=E[0].object.el===C?1:0,T=E[_],T&&this.setIntersection(T.object.el,T))))},twoWayEmit:function(v,_){var T=this.el,E=this.intersectedEl,C;function R(B,I){_ instanceof MouseEvent?B.mouseEvent=_:typeof TouchEvent<"u"&&_ instanceof TouchEvent&&(B.touchEvent=_)}C=this.el.components.raycaster.getIntersection(E),this.eventDetail.intersectedEl=E,this.eventDetail.intersection=C,R(this.eventDetail),T.emit(v,this.eventDetail),E&&(this.intersectedEventDetail.intersection=C,R(this.intersectedEventDetail),E.emit(v,this.intersectedEventDetail))}})},"./src/components/generic-tracked-controller-controls.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/utils/tracked-controls.js"),f=p.checkControllerPresentAndSetup,g=p.emitIfAxesChanged,m=p.onButtonEvent,y="generic",b={axes:{touchpad:[0,1],thumbstick:[2,3]},buttons:["trigger","squeeze","touchpad","thumbstick"]};l.exports.Component=h("generic-tracked-controller-controls",{schema:{hand:{default:""},defaultModel:{default:!0},defaultModelColor:{default:"gray"},orientationOffset:{type:"vec3"},disabled:{default:!1}},after:["tracked-controls"],mapping:b,bindMethods:function(){this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},init:function(){var v=this;this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(_){m(_.detail.id,"down",v)},this.onButtonUp=function(_){m(_.detail.id,"up",v)},this.onButtonTouchStart=function(_){m(_.detail.id,"touchstart",v)},this.onButtonTouchEnd=function(_){m(_.detail.id,"touchend",v)},this.controllerPresent=!1,this.wasControllerConnected=!1,this.lastControllerCheck=0,this.bindMethods(),this.el.addEventListener("controllerconnected",function(_){_.detail.name!==v.name&&(v.wasControllerConnected=!0,v.removeEventListeners(),v.removeControllersUpdateListener())})},addEventListeners:function(){var v=this.el;v.addEventListener("buttonchanged",this.onButtonChanged),v.addEventListener("buttondown",this.onButtonDown),v.addEventListener("buttonup",this.onButtonUp),v.addEventListener("touchstart",this.onButtonTouchStart),v.addEventListener("touchend",this.onButtonTouchEnd),v.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var v=this.el;v.removeEventListener("buttonchanged",this.onButtonChanged),v.removeEventListener("buttondown",this.onButtonDown),v.removeEventListener("buttonup",this.onButtonUp),v.removeEventListener("touchstart",this.onButtonTouchStart),v.removeEventListener("touchend",this.onButtonTouchEnd),v.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var v=this.data,_=v.hand?v.hand:void 0;f(this,y,{hand:_,iterateControllerProfiles:!0})},play:function(){this.wasControllerConnected||(this.checkIfControllerPresent(),this.addControllersUpdateListener())},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var v=this.el,_=this.data;if(this.el.components["tracked-controls"]){this.removeEventListeners();return}v.setAttribute("tracked-controls",{hand:_.hand,idPrefix:y,orientationOffset:_.orientationOffset,iterateControllerProfiles:!0}),this.data.defaultModel&&this.initDefaultModel()},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.wasControllerConnected&&this.checkIfControllerPresent()},onButtonChanged:function(v){var _=this.mapping.buttons[v.detail.id];_&&this.el.emit(_+"changed",v.detail.state)},onAxisMoved:function(v){g(this,this.mapping.axes,v)},initDefaultModel:function(){var v=this.modelEl=document.createElement("a-entity");v.setAttribute("geometry",{primitive:"sphere",radius:.03}),v.setAttribute("material",{color:this.data.color}),this.el.appendChild(v),this.el.emit("controllermodelready",{name:"generic-tracked-controller-controls",model:this.modelEl,rayOrigin:{origin:{x:0,y:0,z:-.01},direction:{x:0,y:0,z:-1}}})}})},"./src/components/geometry.js":(l,u,c)=>{var h=c("./src/core/geometry.js").geometries,p=c("./src/core/geometry.js").geometryNames,f=c("./src/core/component.js").registerComponent,g=c("./src/lib/three.js"),m=new g.BufferGeometry;l.exports.Component=f("geometry",{schema:{buffer:{default:!0},primitive:{default:"box",oneOf:p,schemaChange:!0},skipCache:{default:!1}},init:function(){this.geometry=null},update:function(y){var b=this.data,v=this.el,_,T=this.system;this.geometry&&(T.unuseGeometry(y),this.geometry=null),this.geometry=T.getOrCreateGeometry(b),_=v.getObject3D("mesh"),_?_.geometry=this.geometry:(_=new g.Mesh,_.geometry=this.geometry,this.el.getAttribute("material")||(_.material=new g.MeshStandardMaterial({color:Math.random()*16777215,metalness:0,roughness:.5})),v.setObject3D("mesh",_))},remove:function(){this.system.unuseGeometry(this.data),this.el.getObject3D("mesh").geometry=m,this.geometry=null},updateSchema:function(y){var b=this.oldData&&this.oldData.primitive,v=y.primitive,_=h[v]&&h[v].schema;if(!_)throw new Error("Unknown geometry schema `"+v+"`");b&&b===v||this.extendSchema(_)}})},"./src/components/gltf-model.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/lib/three.js"),f=c("./src/utils/index.js"),g=f.debug("components:gltf-model:warn");l.exports.Component=h("gltf-model",{schema:{type:"model"},init:function(){var m=this,y=this.system.getDRACOLoader(),b=this.system.getMeshoptDecoder(),v=this.system.getKTX2Loader();this.model=null,this.loader=new p.GLTFLoader,y&&this.loader.setDRACOLoader(y),b?this.ready=b.then(function(_){m.loader.setMeshoptDecoder(_)}):this.ready=Promise.resolve(),v&&this.loader.setKTX2Loader(v)},update:function(){var m=this,y=this.el,b=this.data;b&&(this.remove(),this.ready.then(function(){m.loader.load(b,function(v){m.model=v.scene||v.scenes[0],m.model.animations=v.animations,y.setObject3D("mesh",m.model),y.emit("model-loaded",{format:"gltf",model:m.model})},void 0,function(v){var _=v&&v.message?v.message:"Failed to load glTF model";g(_),y.emit("model-error",{format:"gltf",src:b})})}))},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},"./src/components/grabbable.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent;h("grabbable",{init:function(){this.el.setAttribute("obb-collider","centerModel: true")}})},"./src/components/hand-controls.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/constants/index.js").AFRAME_CDN_ROOT,f={toonLeft:p+"controllers/hands/leftHand.glb",toonRight:p+"controllers/hands/rightHand.glb",lowPolyLeft:p+"controllers/hands/leftHandLow.glb",lowPolyRight:p+"controllers/hands/rightHandLow.glb",highPolyLeft:p+"controllers/hands/leftHandHigh.glb",highPolyRight:p+"controllers/hands/rightHandHigh.glb"},g={open:"Open",point:"Point",pointThumb:"Point + Thumb",fist:"Fist",hold:"Hold",thumbUp:"Thumb Up"},m={};m[g.fist]="grip",m[g.thumbUp]="pistol",m[g.point]="pointing",l.exports.Component=h("hand-controls",{schema:{color:{default:"white",type:"color"},hand:{default:"left"},handModelStyle:{default:"lowPoly",oneOf:["lowPoly","highPoly","toon"]}},after:["tracked-controls"],init:function(){var v=this,_=this.el;this.pressedButtons={},this.touchedButtons={},this.loader=new THREE.GLTFLoader,this.loader.setCrossOrigin("anonymous"),this.onGripDown=function(){v.handleButton("grip","down")},this.onGripUp=function(){v.handleButton("grip","up")},this.onTrackpadDown=function(){v.handleButton("trackpad","down")},this.onTrackpadUp=function(){v.handleButton("trackpad","up")},this.onTrackpadTouchStart=function(){v.handleButton("trackpad","touchstart")},this.onTrackpadTouchEnd=function(){v.handleButton("trackpad","touchend")},this.onTriggerDown=function(){v.handleButton("trigger","down")},this.onTriggerUp=function(){v.handleButton("trigger","up")},this.onTriggerTouchStart=function(){v.handleButton("trigger","touchstart")},this.onTriggerTouchEnd=function(){v.handleButton("trigger","touchend")},this.onGripTouchStart=function(){v.handleButton("grip","touchstart")},this.onGripTouchEnd=function(){v.handleButton("grip","touchend")},this.onThumbstickDown=function(){v.handleButton("thumbstick","down")},this.onThumbstickUp=function(){v.handleButton("thumbstick","up")},this.onAorXTouchStart=function(){v.handleButton("AorX","touchstart")},this.onAorXTouchEnd=function(){v.handleButton("AorX","touchend")},this.onBorYTouchStart=function(){v.handleButton("BorY","touchstart")},this.onBorYTouchEnd=function(){v.handleButton("BorY","touchend")},this.onSurfaceTouchStart=function(){v.handleButton("surface","touchstart")},this.onSurfaceTouchEnd=function(){v.handleButton("surface","touchend")},this.onControllerConnected=this.onControllerConnected.bind(this),this.onControllerDisconnected=this.onControllerDisconnected.bind(this),_.addEventListener("controllerconnected",this.onControllerConnected),_.addEventListener("controllerdisconnected",this.onControllerDisconnected),_.object3D.visible=!1},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners()},tick:function(v,_){var T=this.el.getObject3D("mesh");!T||!T.mixer||T.mixer.update(_/1e3)},onControllerConnected:function(){this.el.object3D.visible=!0},onControllerDisconnected:function(){this.el.object3D.visible=!1},addEventListeners:function(){var v=this.el;v.addEventListener("gripdown",this.onGripDown),v.addEventListener("gripup",this.onGripUp),v.addEventListener("trackpaddown",this.onTrackpadDown),v.addEventListener("trackpadup",this.onTrackpadUp),v.addEventListener("trackpadtouchstart",this.onTrackpadTouchStart),v.addEventListener("trackpadtouchend",this.onTrackpadTouchEnd),v.addEventListener("triggerdown",this.onTriggerDown),v.addEventListener("triggerup",this.onTriggerUp),v.addEventListener("triggertouchstart",this.onTriggerTouchStart),v.addEventListener("triggertouchend",this.onTriggerTouchEnd),v.addEventListener("griptouchstart",this.onGripTouchStart),v.addEventListener("griptouchend",this.onGripTouchEnd),v.addEventListener("thumbstickdown",this.onThumbstickDown),v.addEventListener("thumbstickup",this.onThumbstickUp),v.addEventListener("abuttontouchstart",this.onAorXTouchStart),v.addEventListener("abuttontouchend",this.onAorXTouchEnd),v.addEventListener("bbuttontouchstart",this.onBorYTouchStart),v.addEventListener("bbuttontouchend",this.onBorYTouchEnd),v.addEventListener("xbuttontouchstart",this.onAorXTouchStart),v.addEventListener("xbuttontouchend",this.onAorXTouchEnd),v.addEventListener("ybuttontouchstart",this.onBorYTouchStart),v.addEventListener("ybuttontouchend",this.onBorYTouchEnd),v.addEventListener("surfacetouchstart",this.onSurfaceTouchStart),v.addEventListener("surfacetouchend",this.onSurfaceTouchEnd)},removeEventListeners:function(){var v=this.el;v.removeEventListener("gripdown",this.onGripDown),v.removeEventListener("gripup",this.onGripUp),v.removeEventListener("trackpaddown",this.onTrackpadDown),v.removeEventListener("trackpadup",this.onTrackpadUp),v.removeEventListener("trackpadtouchstart",this.onTrackpadTouchStart),v.removeEventListener("trackpadtouchend",this.onTrackpadTouchEnd),v.removeEventListener("triggerdown",this.onTriggerDown),v.removeEventListener("triggerup",this.onTriggerUp),v.removeEventListener("triggertouchstart",this.onTriggerTouchStart),v.removeEventListener("triggertouchend",this.onTriggerTouchEnd),v.removeEventListener("griptouchstart",this.onGripTouchStart),v.removeEventListener("griptouchend",this.onGripTouchEnd),v.removeEventListener("thumbstickdown",this.onThumbstickDown),v.removeEventListener("thumbstickup",this.onThumbstickUp),v.removeEventListener("abuttontouchstart",this.onAorXTouchStart),v.removeEventListener("abuttontouchend",this.onAorXTouchEnd),v.removeEventListener("bbuttontouchstart",this.onBorYTouchStart),v.removeEventListener("bbuttontouchend",this.onBorYTouchEnd),v.removeEventListener("xbuttontouchstart",this.onAorXTouchStart),v.removeEventListener("xbuttontouchend",this.onAorXTouchEnd),v.removeEventListener("ybuttontouchstart",this.onBorYTouchStart),v.removeEventListener("ybuttontouchend",this.onBorYTouchEnd),v.removeEventListener("surfacetouchstart",this.onSurfaceTouchStart),v.removeEventListener("surfacetouchend",this.onSurfaceTouchEnd)},update:function(v){var _,T=this.el,E=this.data.hand,C=this.data.handModelStyle,R=this.data.color,B=this;if(_={hand:E,model:!1},E!==v){var I=f[C+E.charAt(0).toUpperCase()+E.slice(1)];this.loader.load(I,function(N){var D=N.scene.children[0],P=E==="left"?Math.PI/2:-Math.PI/2,k=T.sceneEl.hasWebXR?-Math.PI/2:0;D.mixer=new THREE.AnimationMixer(D),B.clips=N.animations,T.setObject3D("mesh",D),D.traverse(function(q){q.isMesh&&(q.material.color=new THREE.Color(R))}),D.position.set(0,0,0),D.rotation.set(k,0,P),T.setAttribute("magicleap-controls",_),T.setAttribute("vive-controls",_),T.setAttribute("oculus-touch-controls",_),T.setAttribute("pico-controls",_),T.setAttribute("windows-motion-controls",_),T.setAttribute("hp-mixed-reality-controls",_)})}},remove:function(){this.el.removeObject3D("mesh")},handleButton:function(v,_){var T,E=_==="down",C=_==="touchstart";if(_.indexOf("touch")===0){if(C===this.touchedButtons[v])return;this.touchedButtons[v]=C}else{if(E===this.pressedButtons[v])return;this.pressedButtons[v]=E}T=this.gesture,this.gesture=this.determineGesture(),this.gesture!==T&&(this.animateGesture(this.gesture,T),this.emitGestureEvents(this.gesture,T))},determineGesture:function(){var v,_=this.pressedButtons.grip,T=this.pressedButtons.surface||this.touchedButtons.surface,E=this.pressedButtons.trackpad||this.touchedButtons.trackpad,C=this.pressedButtons.trigger||this.touchedButtons.trigger,R=this.touchedButtons.AorX||this.touchedButtons.BorY,B=b(this.el.components["tracked-controls"]);return B?_||C?v=g.fist:E&&(v=g.point):_?T||R||E?v=C?g.fist:g.point:v=C?g.thumbUp:g.pointThumb:C&&(v=g.hold),v},getClip:function(v){var _,T;for(T=0;T<this.clips.length;T++)if(_=this.clips[T],_.name===v)return _},animateGesture:function(v,_){if(v){this.playAnimation(v||g.open,_,!1);return}this.playAnimation(_,_,!0)},emitGestureEvents:function(v,_){var T=this.el,E;_!==v&&(E=y(_,!1),E&&T.emit(E),E=y(v,!0),E&&T.emit(E))},playAnimation:function(v,_,T){var E,C,R=this.el.getObject3D("mesh"),B;if(R){if(E=this.getClip(v),B=R.mixer.clipAction(E),T){B.paused=!1,B.timeScale=-1;return}if(B.clampWhenFinished=!0,B.loop=THREE.LoopOnce,B.repetitions=0,B.timeScale=1,B.time=0,B.weight=1,!_){R.mixer.stopAllAction(),B.play();return}E=this.getClip(_),B.reset(),B.play(),C=R.mixer.clipAction(E),C.crossFadeTo(B,.15,!0)}}});function y(v,_){var T;if(v){if(T=m[v],T==="grip")return T+(_?"close":"open");if(T==="point")return T+(_?"up":"down");if(T==="pointing"||T==="pistol")return T+(_?"start":"end")}}function b(v){var _=v&&v.controller,T=_&&(_.id&&_.id.indexOf("OpenVR ")===0||_.profiles&&_.profiles[0]&&_.profiles[0]==="htc-vive");return T}},"./src/components/hand-tracking-controls.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/core/a-entity.js").AEntity,f=c("./src/utils/tracked-controls.js"),g=f.checkControllerPresentAndSetup,m=c("./src/constants/index.js").AFRAME_CDN_ROOT,y=m+"controllers/oculus-hands/v4/left.glb",b=m+"controllers/oculus-hands/v4/right.glb",v=["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"],_=0,T=4,E=9,C=.015,R=.1;l.exports.Component=h("hand-tracking-controls",{schema:{hand:{default:"right",oneOf:["left","right"]},modelStyle:{default:"mesh",oneOf:["dots","mesh"]},modelColor:{default:"white"},modelOpacity:{default:1}},after:["tracked-controls"],bindMethods:function(){this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this)},addEventListeners:function(){this.el.addEventListener("model-loaded",this.onModelLoaded);for(var B=0;B<this.jointEls.length;++B)this.jointEls[B].object3D.visible=!0},removeEventListeners:function(){this.el.removeEventListener("model-loaded",this.onModelLoaded);for(var B=0;B<this.jointEls.length;++B)this.jointEls[B].object3D.visible=!1},init:function(){var B=this.el.sceneEl,I=B.getAttribute("webxr"),N=I.optionalFeatures;N.indexOf("hand-tracking")===-1&&(N.push("hand-tracking"),B.setAttribute("webxr",I)),this.wristObject3D=new THREE.Object3D,this.el.sceneEl.object3D.add(this.wristObject3D),this.onModelLoaded=this.onModelLoaded.bind(this),this.onChildAttached=this.onChildAttached.bind(this),this.jointEls=[],this.controllerPresent=!1,this.isPinched=!1,this.pinchEventDetail={position:new THREE.Vector3,wristRotation:new THREE.Quaternion},this.indexTipPosition=new THREE.Vector3,this.hasPoses=!1,this.jointPoses=new Float32Array(16*v.length),this.jointRadii=new Float32Array(v.length),this.bindMethods(),this.updateReferenceSpace=this.updateReferenceSpace.bind(this),this.el.sceneEl.addEventListener("enter-vr",this.updateReferenceSpace),this.el.sceneEl.addEventListener("exit-vr",this.updateReferenceSpace),this.el.addEventListener("child-attached",this.onChildAttached),this.el.object3D.visible=!1,this.wristObject3D.visible=!1},onChildAttached:function(B){this.addChildEntity(B.detail.el)},update:function(){this.updateModelMaterial()},updateModelMaterial:function(){var B=this.jointEls,I=this.skinnedMesh,N=this.data.modelOpacity!==1;I&&(this.skinnedMesh.material.color.set(this.data.modelColor),this.skinnedMesh.material.transparent=N,this.skinnedMesh.material.opacity=this.data.modelOpacity);for(var D=0;D<B.length;D++)B[D].setAttribute("material",{color:this.data.modelColor,transparent:N,opacity:this.data.modelOpacity})},updateReferenceSpace:function(){var B=this,I=this.el.sceneEl.xrSession;if(this.referenceSpace=void 0,!!I){var N=B.el.sceneEl.systems.webxr.sessionReferenceSpaceType;I.requestReferenceSpace(N).then(function(D){B.referenceSpace=D}).catch(function(D){throw B.el.sceneEl.systems.webxr.warnIfFeatureNotRequested(N,"tracked-controls-webxr uses reference space "+N),D})}},checkIfControllerPresent:function(){var B=this.data,I=B.hand?B.hand:void 0;g(this,"",{hand:I,iterateControllerProfiles:!0,handTracking:!0})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},tick:function(){var B=this.el.sceneEl,I=this.el.components["tracked-controls"]&&this.el.components["tracked-controls"].controller,N=B.frame,D=this.el.components["tracked-controls-webxr"],P=this.referenceSpace;!I||!N||!P||!D||(this.hasPoses=!1,I.hand&&(this.el.object3D.position.set(0,0,0),this.el.object3D.rotation.set(0,0,0),this.hasPoses=N.fillPoses(I.hand.values(),P,this.jointPoses)&&N.fillJointRadii(I.hand.values(),this.jointRadii),this.updateHandModel(),this.detectGesture(),this.updateWristObject()))},updateWristObject:function(){var B=new THREE.Matrix4;return function(){var I=this.wristObject3D;!I||!this.hasPoses||(B.fromArray(this.jointPoses,_*16),I.position.setFromMatrixPosition(B),I.quaternion.setFromRotationMatrix(B))}}(),updateHandModel:function(){this.data.modelStyle==="dots"&&this.updateHandDotsModel(),this.data.modelStyle==="mesh"&&this.updateHandMeshModel()},getBone:function(B){for(var I=this.bones,N=0;N<I.length;N++)if(I[N].name===B)return I[N];return null},updateHandMeshModel:function(){var B=new THREE.Matrix4;return function(){var I=0,N=this.jointPoses,D=this.el.components["tracked-controls"]&&this.el.components["tracked-controls"].controller;if(!(!D||!this.mesh)&&(this.mesh.visible=!1,!!this.hasPoses))for(var P of D.hand.values()){var k=this.getBone(P.jointName);k!=null&&(this.mesh.visible=!0,B.fromArray(N,I*16),k.position.setFromMatrixPosition(B),k.quaternion.setFromRotationMatrix(B)),I++}}}(),updateHandDotsModel:function(){for(var B=this.jointPoses,I=this.jointRadii,N=this.el.components["tracked-controls"]&&this.el.components["tracked-controls"].controller,D,P,k=0;k<N.hand.size;k++)D=this.jointEls[k],P=D.object3D,D.object3D.visible=this.hasPoses,this.hasPoses&&(P.matrix.fromArray(B,k*16),P.matrix.decompose(P.position,P.rotation,P.scale),D.setAttribute("scale",{x:I[k],y:I[k],z:I[k]}))},detectGesture:function(){this.detectPinch()},detectPinch:function(){var B=new THREE.Vector3,I=new THREE.Matrix4;return function(){var N=this.indexTipPosition,D=this.pinchEventDetail;if(this.hasPoses){B.setFromMatrixPosition(I.fromArray(this.jointPoses,T*16)),N.setFromMatrixPosition(I.fromArray(this.jointPoses,E*16)),D.wristRotation.setFromRotationMatrix(I.fromArray(this.jointPoses,_*16));var P=N.distanceTo(B);P<C&&this.isPinched===!1&&(this.isPinched=!0,this.pinchDistance=P,D.position.copy(N).add(B).multiplyScalar(.5),this.el.emit("pinchstarted",D)),P>this.pinchDistance+this.pinchDistance*R&&this.isPinched===!0&&(this.isPinched=!1,D.position.copy(N).add(B).multiplyScalar(.5),this.el.emit("pinchended",D)),this.isPinched&&(D.position.copy(N).add(B).multiplyScalar(.5),this.el.emit("pinchmoved",D))}}}(),pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var B=this.el,I=this.data;if(B.setAttribute("tracked-controls",{id:"",hand:I.hand,iterateControllerProfiles:!0,handTrackingEnabled:!0}),this.mesh){this.mesh!==B.getObject3D("mesh")&&B.setObject3D("mesh",this.mesh);return}this.initDefaultModel()},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){var B=this.el,I;this.checkIfControllerPresent(),I=B.components["tracked-controls"]&&B.components["tracked-controls"].controller,this.mesh&&I&&I.hand&&I.hand instanceof XRHand&&B.setObject3D("mesh",this.mesh)},initDefaultModel:function(){var B=this.data;B.modelStyle==="dots"&&this.initDotsModel(),B.modelStyle==="mesh"&&this.initMeshHandModel(),this.el.object3D.visible=!0,this.wristObject3D.visible=!0},initDotsModel:function(){if(this.jointEls.length===0){for(var B=0;B<v.length;++B){var I=this.jointEl=document.createElement("a-entity");I.setAttribute("geometry",{primitive:"sphere",radius:1}),I.object3D.visible=!1,this.el.appendChild(I),this.jointEls.push(I)}this.updateModelMaterial()}},initMeshHandModel:function(){var B=this.data.hand==="left"?y:b;this.el.setAttribute("gltf-model",B)},onModelLoaded:function(){var B=this.mesh=this.el.getObject3D("mesh").children[0],I=this.skinnedMesh=B.getObjectByProperty("type","SkinnedMesh");this.skinnedMesh&&(this.bones=I.skeleton.bones,this.el.removeObject3D("mesh"),B.position.set(0,0,0),B.rotation.set(0,0,0),I.frustumCulled=!1,I.material=new THREE.MeshStandardMaterial,this.updateModelMaterial(),this.setupChildrenEntities(),this.el.setObject3D("mesh",B))},setupChildrenEntities:function(){for(var B=this.el.children,I=0;I<B.length;++I)B[I]instanceof p&&this.addChildEntity(B[I])},addChildEntity:function(B){B instanceof p&&this.wristObject3D.add(B.object3D)}})},"./src/components/hand-tracking-grab-controls.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/lib/three.js");h("hand-tracking-grab-controls",{schema:{hand:{default:"right",oneOf:["left","right"]},color:{type:"color",default:"white"},hoverColor:{type:"color",default:"#538df1"},hoverEnabled:{default:!1}},init:function(){var f=this.el,g=this.data,m;g.hand==="right"?m="components.hand-tracking-controls.bones.3":m="components.hand-tracking-controls.bones.21",f.setAttribute("hand-tracking-controls",{hand:g.hand}),f.setAttribute("obb-collider",{trackedObject3D:m,size:.04}),this.auxMatrix=new p.Matrix4,this.auxQuaternion=new p.Quaternion,this.auxQuaternion2=new p.Quaternion,this.auxVector=new p.Vector3,this.auxVector2=new p.Vector3,this.grabbingObjectPosition=new p.Vector3,this.grabbedObjectPosition=new p.Vector3,this.grabbedObjectPositionDelta=new p.Vector3,this.grabDeltaPosition=new p.Vector3,this.grabInitialRotation=new p.Quaternion,this.onCollisionStarted=this.onCollisionStarted.bind(this),this.el.addEventListener("obbcollisionstarted",this.onCollisionStarted),this.onCollisionEnded=this.onCollisionEnded.bind(this),this.el.addEventListener("obbcollisionended",this.onCollisionEnded),this.onPinchStarted=this.onPinchStarted.bind(this),this.el.addEventListener("pinchstarted",this.onPinchStarted),this.onPinchEnded=this.onPinchEnded.bind(this),this.el.addEventListener("pinchended",this.onPinchEnded),this.onPinchMoved=this.onPinchMoved.bind(this),this.el.addEventListener("pinchmoved",this.onPinchMoved)},transferEntityOwnership:function(){for(var f,g=this.el.sceneEl.querySelectorAll("[hand-tracking-grab-controls]"),m=0;m<g.length;++m)f=g[m].components["hand-tracking-grab-controls"],f!==this&&this.grabbedEl&&this.grabbedEl===f.grabbedEl&&f.releaseGrabbedEntity();return!1},onCollisionStarted:function(f){var g=f.detail.withEl;this.collidedEl||g.getAttribute("grabbable")&&(this.collidedEl=g,this.grabbingObject3D=f.detail.trackedObject3D,this.data.hoverEnabled&&this.el.setAttribute("hand-tracking-controls","modelColor",this.data.hoverColor))},onCollisionEnded:function(){this.collidedEl=void 0,!this.grabbedEl&&(this.grabbingObject3D=void 0,this.data.hoverEnabled&&this.el.setAttribute("hand-tracking-controls","modelColor",this.data.color))},onPinchStarted:function(f){this.collidedEl&&(this.pinchPosition=f.detail.position,this.wristRotation=f.detail.wristRotation,this.grabbedEl=this.collidedEl,this.transferEntityOwnership(),this.grab())},onPinchEnded:function(){this.releaseGrabbedEntity()},onPinchMoved:function(f){this.wristRotation=f.detail.wristRotation},releaseGrabbedEntity:function(){var f=this.grabbedEl;f&&(f.object3D.updateMatrixWorld=this.originalUpdateMatrixWorld,f.object3D.matrixAutoUpdate=!0,f.object3D.matrixWorldAutoUpdate=!0,f.object3D.matrixWorld.decompose(this.auxVector,this.auxQuaternion,this.auxVector2),f.object3D.position.copy(this.auxVector),f.object3D.quaternion.copy(this.auxQuaternion),this.el.emit("grabended",{grabbedEl:f}),this.grabbedEl=void 0)},grab:function(){var f=this.grabbedEl,g;g=f.object3D.getWorldPosition(this.grabbedObjectPosition),this.grabDeltaPosition.copy(g).sub(this.pinchPosition),this.grabInitialRotation.copy(this.auxQuaternion.copy(this.wristRotation).invert()),this.originalUpdateMatrixWorld=f.object3D.updateMatrixWorld,f.object3D.updateMatrixWorld=function(){},f.object3D.updateMatrixWorldChildren=function(m){for(var y=this.children,b=0,v=y.length;b<v;b++){var _=y[b];(_.matrixWorldAutoUpdate===!0||m===!0)&&_.updateMatrixWorld(!0)}},f.object3D.matrixAutoUpdate=!1,f.object3D.matrixWorldAutoUpdate=!1,this.el.emit("grabstarted",{grabbedEl:f})},tock:function(){var f=this.auxMatrix,g=this.auxQuaternion,m=this.auxQuaternion2,y,b=this.grabbedEl;b&&(y=b.object3D,y.getWorldQuaternion(m),y.matrixWorld.identity(),f.identity(),f.makeTranslation(this.pinchPosition),y.matrixWorld.multiply(f),f.identity(),f.makeRotationFromQuaternion(g.copy(this.wristRotation).multiply(this.grabInitialRotation)),y.matrixWorld.multiply(f),f.identity(),f.makeTranslation(this.grabDeltaPosition),y.matrixWorld.multiply(f),f.identity(),f.makeRotationFromQuaternion(m),y.matrixWorld.multiply(f),f.makeScale(b.object3D.scale.x,b.object3D.scale.y,b.object3D.scale.z),y.matrixWorld.multiply(f),y.updateMatrixWorldChildren())}})},"./src/components/hide-on-enter-ar.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent;l.exports.Component=h("hide-on-enter-ar",{init:function(){var p=this;this.el.sceneEl.addEventListener("enter-vr",function(){p.el.sceneEl.is("ar-mode")&&(p.el.object3D.visible=!1)}),this.el.sceneEl.addEventListener("exit-vr",function(){p.el.object3D.visible=!0})}})},"./src/components/hide-on-enter-vr.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent;l.exports.Component=h("hide-on-enter-vr",{init:function(){var p=this;this.el.sceneEl.addEventListener("enter-vr",function(){p.el.sceneEl.is("vr-mode")&&(p.el.object3D.visible=!1)}),this.el.sceneEl.addEventListener("exit-vr",function(){p.el.object3D.visible=!0})}})},"./src/components/hp-mixed-reality-controls.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/lib/three.js"),f=c("./src/utils/tracked-controls.js"),g=f.checkControllerPresentAndSetup,m=f.emitIfAxesChanged,y=f.onButtonEvent,b="hp-mixed-reality",v=c("./src/constants/index.js").AFRAME_CDN_ROOT,_=v+"controllers/hp/mixed-reality/",T={x:0,y:0,z:.06},E={_x:Math.PI/4,_y:0,_z:0,_order:"XYZ"},C={left:{axes:{touchpad:[2,3]},buttons:["trigger","grip","none","thumbstick","xbutton","ybutton"]},right:{axes:{touchpad:[2,3]},buttons:["trigger","grip","none","thumbstick","abutton","bbutton"]}};l.exports.Component=h("hp-mixed-reality-controls",{schema:{hand:{default:"none"},model:{default:!0},orientationOffset:{type:"vec3"}},mapping:C,init:function(){var R=this;this.controllerPresent=!1,this.lastControllerCheck=0,this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(B){y(B.detail.id,"down",R,R.data.hand)},this.onButtonUp=function(B){y(B.detail.id,"up",R,R.data.hand)},this.onButtonTouchEnd=function(B){y(B.detail.id,"touchend",R,R.data.hand)},this.onButtonTouchStart=function(B){y(B.detail.id,"touchstart",R,R.data.hand)},this.previousButtonValues={},this.bindMethods()},update:function(){var R=this.data;this.controllerIndex=R.hand==="right"?0:R.hand==="left"?1:2},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},addEventListeners:function(){var R=this.el;R.addEventListener("buttonchanged",this.onButtonChanged),R.addEventListener("buttondown",this.onButtonDown),R.addEventListener("buttonup",this.onButtonUp),R.addEventListener("touchstart",this.onButtonTouchStart),R.addEventListener("touchend",this.onButtonTouchEnd),R.addEventListener("axismove",this.onAxisMoved),R.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var R=this.el;R.removeEventListener("buttonchanged",this.onButtonChanged),R.removeEventListener("buttondown",this.onButtonDown),R.removeEventListener("buttonup",this.onButtonUp),R.removeEventListener("touchstart",this.onButtonTouchStart),R.removeEventListener("touchend",this.onButtonTouchEnd),R.removeEventListener("axismove",this.onAxisMoved),R.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var R=this.data;g(this,b,{index:this.controllerIndex,hand:R.hand})},injectTrackedControls:function(){var R=this.el,B=this.data;R.setAttribute("tracked-controls",{idPrefix:b,hand:B.hand,controller:this.controllerIndex,orientationOffset:B.orientationOffset}),this.data.model&&this.el.setAttribute("gltf-model",_+this.data.hand+".glb")},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(R){var B=this.mapping[this.data.hand].buttons[R.detail.id],I;B&&(B==="trigger"&&(I=R.detail.state.value,console.log("analog value of trigger press: "+I)),this.el.emit(B+"changed",R.detail.state))},onModelLoaded:function(R){var B=R.detail.model;this.data.model&&(B.position.copy(T),B.rotation.copy(E),this.el.emit("controllermodelready",{name:"hp-mixed-reality-controls",model:this.data.model,rayOrigin:new p.Vector3(0,0,0)}))},onAxisMoved:function(R){m(this,this.mapping.axes,R)}})},"./src/components/index.js":(l,u,c)=>{c("./src/components/animation.js"),c("./src/components/anchored.js"),c("./src/components/camera.js"),c("./src/components/cursor.js"),c("./src/components/geometry.js"),c("./src/components/generic-tracked-controller-controls.js"),c("./src/components/gltf-model.js"),c("./src/components/grabbable.js"),c("./src/components/hand-tracking-controls.js"),c("./src/components/hand-tracking-grab-controls.js"),c("./src/components/hand-controls.js"),c("./src/components/hide-on-enter-ar.js"),c("./src/components/hide-on-enter-vr.js"),c("./src/components/hp-mixed-reality-controls.js"),c("./src/components/layer.js"),c("./src/components/laser-controls.js"),c("./src/components/light.js"),c("./src/components/line.js"),c("./src/components/link.js"),c("./src/components/look-controls.js"),c("./src/components/magicleap-controls.js"),c("./src/components/material.js"),c("./src/components/obb-collider.js"),c("./src/components/obj-model.js"),c("./src/components/oculus-go-controls.js"),c("./src/components/oculus-touch-controls.js"),c("./src/components/pico-controls.js"),c("./src/components/position.js"),c("./src/components/raycaster.js"),c("./src/components/rotation.js"),c("./src/components/scale.js"),c("./src/components/shadow.js"),c("./src/components/sound.js"),c("./src/components/text.js"),c("./src/components/tracked-controls.js"),c("./src/components/tracked-controls-webvr.js"),c("./src/components/tracked-controls-webxr.js"),c("./src/components/visible.js"),c("./src/components/valve-index-controls.js"),c("./src/components/vive-controls.js"),c("./src/components/vive-focus-controls.js"),c("./src/components/wasd-controls.js"),c("./src/components/windows-motion-controls.js"),c("./src/components/scene/ar-hit-test.js"),c("./src/components/scene/background.js"),c("./src/components/scene/debug.js"),c("./src/components/scene/device-orientation-permission-ui.js"),c("./src/components/scene/embedded.js"),c("./src/components/scene/inspector.js"),c("./src/components/scene/fog.js"),c("./src/components/scene/keyboard-shortcuts.js"),c("./src/components/scene/pool.js"),c("./src/components/scene/real-world-meshing.js"),c("./src/components/scene/reflection.js"),c("./src/components/scene/screenshot.js"),c("./src/components/scene/stats.js"),c("./src/components/scene/xr-mode-ui.js")},"./src/components/laser-controls.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/utils/index.js");h("laser-controls",{schema:{hand:{default:"right"},model:{default:!0},defaultModelColor:{type:"color",default:"grey"}},init:function(){var f=this.config,g=this.data,m=this.el,y=this,b={hand:g.hand,model:g.model};m.setAttribute("hp-mixed-reality-controls",b),m.setAttribute("magicleap-controls",b),m.setAttribute("oculus-go-controls",b),m.setAttribute("oculus-touch-controls",b),m.setAttribute("pico-controls",b),m.setAttribute("valve-index-controls",b),m.setAttribute("vive-controls",b),m.setAttribute("vive-focus-controls",b),m.setAttribute("windows-motion-controls",b),m.setAttribute("generic-tracked-controller-controls",{hand:b.hand}),m.addEventListener("controllerconnected",v),m.addEventListener("controllerdisconnected",_),m.addEventListener("controllermodelready",function(T){v(T),y.modelReady=!0});function v(T){var E=f[T.detail.name];if(E){var C=p.extend({showLine:!0},E.raycaster||{});T.detail.rayOrigin&&(C.origin=T.detail.rayOrigin.origin,C.direction=T.detail.rayOrigin.direction,C.showLine=!0),T.detail.rayOrigin||!y.modelReady?m.setAttribute("raycaster",C):m.setAttribute("raycaster","showLine",!0),m.setAttribute("cursor",p.extend({fuse:!1},E.cursor))}}function _(T){var E=f[T.detail.name];E&&m.setAttribute("raycaster","showLine",!1)}},config:{"generic-tracked-controller-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]}},"hp-mixed-reality-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{origin:{x:0,y:0,z:0}}},"magicleap-controls":{cursor:{downEvents:["trackpaddown","triggerdown"],upEvents:["trackpadup","triggerup"]}},"oculus-go-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{origin:{x:0,y:5e-4,z:0}}},"oculus-touch-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{origin:{x:0,y:0,z:0}}},"pico-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]}},"valve-index-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]}},"vive-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]}},"vive-focus-controls":{cursor:{downEvents:["trackpaddown","triggerdown"],upEvents:["trackpadup","triggerup"]}},"windows-motion-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{showLine:!1}}}})},"./src/components/layer.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/utils/index.js"),f=p.debug("components:layer:warn");l.exports.Component=h("layer",{schema:{type:{default:"quad",oneOf:["quad","monocubemap","stereocubemap"]},src:{type:"map"},rotateCubemap:{default:!1},width:{default:0},height:{default:0}},init:function(){var m=this.el.sceneEl.renderer.getContext();this.quaternion=new THREE.Quaternion,this.position=new THREE.Vector3,this.bindMethods(),this.needsRedraw=!1,this.frameBuffer=m.createFramebuffer();var y=this.el.sceneEl.getAttribute("webxr"),b=y.requiredFeatures;b.indexOf("layers")===-1&&(b.push("layers"),this.el.sceneEl.setAttribute("webxr",y)),this.el.sceneEl.addEventListener("enter-vr",this.onEnterVR),this.el.sceneEl.addEventListener("exit-vr",this.onExitVR)},bindMethods:function(){this.onRequestedReferenceSpace=this.onRequestedReferenceSpace.bind(this),this.onEnterVR=this.onEnterVR.bind(this),this.onExitVR=this.onExitVR.bind(this)},update:function(m){this.data.src!==m.src&&this.updateSrc()},updateSrc:function(){var m=this.data.type;if(this.texture=void 0,m==="quad"){this.loadQuadImage();return}if(m==="monocubemap"||m==="stereocubemap"){this.loadCubeMapImages();return}},loadCubeMapImages:function(){var m,y=this.xrGLFactory,b=this.el.sceneEl.frame,v=this.data.src,_=this.data.type;this.visibilityChanged=!1,this.layer&&(_!=="monocubemap"&&_!=="stereocubemap"||(v.complete?this.pendingCubeMapUpdate=!1:this.pendingCubeMapUpdate=!0,this.loadingScreen?this.loadingScreen=!1:this.loadingScreen=!0,_==="monocubemap"?(m=y.getSubImage(this.layer,b),this.loadCubeMapImage(m.colorTexture,v,0)):(m=y.getSubImage(this.layer,b,"left"),this.loadCubeMapImage(m.colorTexture,v,0),m=y.getSubImage(this.layer,b,"right"),this.loadCubeMapImage(m.colorTexture,v,6))))},loadQuadImage:function(){var m=this.data.src,y=this;this.el.sceneEl.systems.material.loadTexture(m,{src:m},function(b){y.el.sceneEl.renderer.initTexture(b),y.texture=b,m.tagName==="VIDEO"&&setTimeout(function(){y.textureIsVideo=!0},1e3),y.layer&&(y.layer.height=y.data.height/2||y.texture.image.height/1e3,y.layer.width=y.data.width/2||y.texture.image.width/1e3,y.needsRedraw=!0),y.updateQuadPanel()})},preGenerateCubeMapTextures:function(m,y){this.data.type==="monocubemap"?this.generateCubeMapTextures(m,0,y):(this.generateCubeMapTextures(m,0,y),this.generateCubeMapTextures(m,6,y))},generateCubeMapTextures:function(m,y,b){for(var v=this.data,_=this.cubeFaceSize,T=Math.min(m.width,m.height),E=[],C,R,B=0;B<6;B++){var I=document.createElement("CANVAS");I.width=I.height=_;var N=I.getContext("2d");v.rotateCubemap&&(B===2||B===3)&&(N.save(),N.translate(_,_),N.rotate(Math.PI)),N.drawImage(m,(B+y)*T,0,T,T,0,0,_,_),N.restore(),b&&b(),E.push(I)}return v.rotateCubemap&&(C=E[0],R=E[1],E[0]=R,E[1]=C,C=E[4],R=E[5],E[4]=R,E[5]=C),b&&b(),E},loadCubeMapImage:function(m,y,b){var v=this.el.sceneEl.renderer.getContext(),_;v.pixelStorei(v.UNPACK_FLIP_Y_WEBGL,!1),v.bindTexture(v.TEXTURE_CUBE_MAP,m),!y.complete||this.loadingScreen?_=this.loadingScreenImages:_=this.generateCubeMapTextures(y,b);var T=0;_.forEach(function(E,C){v.texSubImage2D(v.TEXTURE_CUBE_MAP_POSITIVE_X+C,0,0,0,v.RGBA,v.UNSIGNED_BYTE,E),T=v.getError()}),T!==0&&console.log("renderingError, WebGL Error Code: "+T),v.bindTexture(v.TEXTURE_CUBE_MAP,null)},tick:function(){this.el.sceneEl.xrSession&&(!this.layer&&(this.el.sceneEl.is("vr-mode")||this.el.sceneEl.is("ar-mode"))&&this.initLayer(),this.updateTransform(),this.data.src.complete&&(this.pendingCubeMapUpdate||this.loadingScreen||this.visibilityChanged)&&this.loadCubeMapImages(),!(!this.needsRedraw&&!this.layer.needsRedraw&&!this.textureIsVideo)&&(this.data.type==="quad"&&this.draw(),this.needsRedraw=!1))},initLayer:function(){var m=this,y=this.data.type;if(this.el.sceneEl.xrSession.onvisibilitychange=function(b){m.visibilityChanged=b.session.visibilityState!=="hidden"},y==="quad"){this.initQuadLayer();return}if(y==="monocubemap"||y==="stereocubemap"){this.initCubeMapLayer();return}},initQuadLayer:function(){var m=this.el.sceneEl,y=m.renderer.getContext(),b=this.xrGLFactory=new XRWebGLBinding(m.xrSession,y);this.texture&&(this.layer=b.createQuadLayer({space:this.referenceSpace,viewPixelHeight:2048,viewPixelWidth:2048,height:this.data.height/2||this.texture.image.height/1e3,width:this.data.width/2||this.texture.image.width/1e3}),this.initLoadingScreenImages(),m.renderer.xr.addLayer(this.layer))},initCubeMapLayer:function(){var m=this.data.src,y=this.el.sceneEl,b=y.renderer.getContext(),v=b.getParameter(b.MAX_CUBE_MAP_TEXTURE_SIZE),_=this.cubeFaceSize=Math.min(v,Math.min(m.width,m.height)),T=this.xrGLFactory=new XRWebGLBinding(y.xrSession,b);this.layer=T.createCubeLayer({space:this.referenceSpace,viewPixelWidth:_,viewPixelHeight:_,layout:this.data.type==="monocubemap"?"mono":"stereo",isStatic:!1}),this.initLoadingScreenImages(),this.loadCubeMapImages(),y.renderer.xr.addLayer(this.layer)},initLoadingScreenImages:function(){for(var m=this.cubeFaceSize,y=this.loadingScreenImages=[],b=0;b<6;b++){var v=document.createElement("CANVAS");v.width=v.height=m;var _=v.getContext("2d");v.width=v.height=m,_.fillStyle="black",_.fillRect(0,0,m,m),b!==2&&b!==3&&(_.translate(m,0),_.scale(-1,1),_.fillStyle="white",_.font="30px Arial",_.fillText("Loading",m/2,m/2)),y.push(v)}},destroyLayer:function(){this.layer&&(this.el.sceneEl.renderer.xr.removeLayer(this.layer),this.layer.destroy(),this.layer=void 0)},toggleCompositorLayer:function(){this.enableCompositorLayer(!this.layerEnabled)},enableCompositorLayer:function(m){this.layerEnabled=m,this.quadPanelEl.object3D.visible=!this.layerEnabled},updateQuadPanel:function(){var m=this.quadPanelEl;this.quadPanelEl||(m=this.quadPanelEl=document.createElement("a-entity"),this.el.appendChild(m)),m.setAttribute("material",{shader:"flat",src:this.data.src,transparent:!0}),m.setAttribute("geometry",{primitive:"plane",height:this.data.height||this.texture.image.height/1e3,width:this.data.width||this.texture.image.height/1e3})},draw:function(){var m=this.el.sceneEl,y=this.el.sceneEl.renderer.getContext(),b=this.xrGLFactory.getSubImage(this.layer,m.frame),v=m.renderer.properties.get(this.texture).__webglTexture,_=y.getParameter(y.FRAMEBUFFER_BINDING);y.viewport(b.viewport.x,b.viewport.y,b.viewport.width,b.viewport.height),y.bindFramebuffer(y.FRAMEBUFFER,this.frameBuffer),y.framebufferTexture2D(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0,y.TEXTURE_2D,b.colorTexture,0),g(y,v,b,this.data.src),y.bindFramebuffer(y.FRAMEBUFFER,_)},updateTransform:function(){var m=this.el,y=this.position,b=this.quaternion;m.object3D.updateMatrixWorld(),y.setFromMatrixPosition(m.object3D.matrixWorld),b.setFromRotationMatrix(m.object3D.matrixWorld),this.layerEnabled||y.set(0,0,1e8),this.layer.transform=new XRRigidTransform(y,b)},onEnterVR:function(){var m=this.el.sceneEl,y=m.xrSession;if(!m.hasWebXR||!XRWebGLBinding||!y){f("The layer component requires WebXR and the layers API enabled");return}y.requestReferenceSpace("local-floor").then(this.onRequestedReferenceSpace),this.layerEnabled=!0,this.quadPanelEl&&(this.quadPanelEl.object3D.visible=!1),this.data.src.play&&this.data.src.play()},onExitVR:function(){this.quadPanelEl&&(this.quadPanelEl.object3D.visible=!0),this.destroyLayer()},onRequestedReferenceSpace:function(m){this.referenceSpace=m}});function g(m,y,b,v){var _=m.createFramebuffer(),T=b.viewport.x,E=b.viewport.y,C=b.viewport.x+b.viewport.width,R=b.viewport.y+b.viewport.height;v.tagName==="VIDEO"&&(m.bindTexture(m.TEXTURE_2D,y),m.texSubImage2D(m.TEXTURE_2D,0,0,0,v.width,v.height,m.RGB,m.UNSIGNED_BYTE,v)),m.bindFramebuffer(m.READ_FRAMEBUFFER,_),m.framebufferTexture2D(m.READ_FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,y,0),m.readBuffer(m.COLOR_ATTACHMENT0),m.blitFramebuffer(0,0,v.width,v.height,T,E,C,R,m.COLOR_BUFFER_BIT,m.NEAREST),m.bindFramebuffer(m.READ_FRAMEBUFFER,null),m.deleteFramebuffer(_)}},"./src/components/light.js":(l,u,c)=>{var h=c("./src/utils/index.js"),p=h.diff,f=c("./src/utils/debug.js"),g=c("./src/core/component.js").registerComponent,m=c("./src/lib/three.js"),y=c("./src/utils/math.js"),b=m.MathUtils.degToRad,v=f("components:light:warn"),_=new m.CubeTextureLoader,T={};l.exports.Component=g("light",{schema:{angle:{default:60,if:{type:["spot"]}},color:{type:"color",if:{type:["ambient","directional","hemisphere","point","spot"]}},envMap:{default:"",if:{type:["probe"]}},groundColor:{type:"color",if:{type:["hemisphere"]}},decay:{default:1,if:{type:["point","spot"]}},distance:{default:0,min:0,if:{type:["point","spot"]}},intensity:{default:1,min:0,if:{type:["ambient","directional","hemisphere","point","spot","probe"]}},penumbra:{default:0,min:0,max:1,if:{type:["spot"]}},type:{default:"directional",oneOf:["ambient","directional","hemisphere","point","spot","probe"],schemaChange:!0},target:{type:"selector",if:{type:["spot","directional"]}},castShadow:{default:!1,if:{type:["point","spot","directional"]}},shadowBias:{default:0,if:{castShadow:!0}},shadowCameraFar:{default:500,if:{castShadow:!0}},shadowCameraFov:{default:90,if:{castShadow:!0}},shadowCameraNear:{default:.5,if:{castShadow:!0}},shadowCameraTop:{default:5,if:{castShadow:!0}},shadowCameraRight:{default:5,if:{castShadow:!0}},shadowCameraBottom:{default:-5,if:{castShadow:!0}},shadowCameraLeft:{default:-5,if:{castShadow:!0}},shadowCameraVisible:{default:!1,if:{castShadow:!0}},shadowCameraAutomatic:{default:"",if:{type:["directional"]}},shadowMapHeight:{default:512,if:{castShadow:!0}},shadowMapWidth:{default:512,if:{castShadow:!0}},shadowRadius:{default:1,if:{castShadow:!0}}},init:function(){var E=this.el;this.light=null,this.defaultTarget=null,this.system.registerLight(E)},update:function(E){var C=this.data,R=p(C,E),B=this.light,I=this;if(B&&!("type"in R)){var N=!1;Object.keys(R).forEach(function(D){var P=C[D];switch(D){case"color":{B.color.set(P);break}case"groundColor":{B.groundColor.set(P);break}case"angle":{B.angle=b(P);break}case"target":{P===null?(C.type==="spot"||C.type==="directional")&&(B.target=I.defaultTarget):P.hasLoaded?I.onSetTarget(P,B):P.addEventListener("loaded",I.onSetTarget.bind(I,P,B));break}case"envMap":I.updateProbeMap(C,B);break;case"castShadow":case"shadowBias":case"shadowCameraFar":case"shadowCameraFov":case"shadowCameraNear":case"shadowCameraTop":case"shadowCameraRight":case"shadowCameraBottom":case"shadowCameraLeft":case"shadowCameraVisible":case"shadowMapHeight":case"shadowMapWidth":case"shadowRadius":N||(I.updateShadow(),N=!0);break;case"shadowCameraAutomatic":C.shadowCameraAutomatic?I.shadowCameraAutomaticEls=Array.from(document.querySelectorAll(C.shadowCameraAutomatic)):I.shadowCameraAutomaticEls=[];break;default:B[D]=P}});return}this.setLight(this.data),this.updateShadow()},tick:function(){var E=new m.Box3,C=new m.Vector3,R=new m.Vector3,B=new m.Matrix4,I=new m.Sphere,N=new m.Vector3;return function(){if(this.data.type==="directional"&&this.light.shadow&&this.light.shadow.camera instanceof m.OrthographicCamera&&this.shadowCameraAutomaticEls.length){var D=this.light.shadow.camera;D.getWorldDirection(C),D.getWorldPosition(R),B.copy(D.matrixWorld),B.invert(),D.near=1,D.left=1e5,D.right=-1e5,D.top=-1e5,D.bottom=1e5,this.shadowCameraAutomaticEls.forEach(function(P){E.setFromObject(P.object3D),E.getBoundingSphere(I);var k=y.distanceOfPointFromPlane(R,C,I.center),q=y.nearestPointInPlane(R,C,I.center,N),V=q.applyMatrix4(B);D.near=Math.min(-k-I.radius-1,D.near),D.left=Math.min(-I.radius+V.x,D.left),D.right=Math.max(I.radius+V.x,D.right),D.top=Math.max(I.radius+V.y,D.top),D.bottom=Math.min(-I.radius+V.y,D.bottom)}),D.updateProjectionMatrix()}}}(),setLight:function(E){var C=this.el,R=this.getLight(E);R&&(this.light&&C.removeObject3D("light"),this.light=R,this.light.el=C,C.setObject3D("light",this.light),(E.type==="spot"||E.type==="directional"||E.type==="hemisphere")&&C.getObject3D("light").translateY(-1),E.type==="spot"&&(C.setObject3D("light-target",this.defaultTarget),C.getObject3D("light-target").position.set(0,0,-1)),E.shadowCameraAutomatic?this.shadowCameraAutomaticEls=Array.from(document.querySelectorAll(E.shadowCameraAutomatic)):this.shadowCameraAutomaticEls=[])},updateShadow:function(){var E=this.el,C=this.data,R=this.light;R.castShadow=C.castShadow;var B=E.getObject3D("cameraHelper");if(C.shadowCameraVisible&&!B?E.setObject3D("cameraHelper",new m.CameraHelper(R.shadow.camera)):!C.shadowCameraVisible&&B&&E.removeObject3D("cameraHelper"),!C.castShadow)return R;R.shadow.bias=C.shadowBias,R.shadow.radius=C.shadowRadius,R.shadow.mapSize.height=C.shadowMapHeight,R.shadow.mapSize.width=C.shadowMapWidth,R.shadow.camera.near=C.shadowCameraNear,R.shadow.camera.far=C.shadowCameraFar,R.shadow.camera instanceof m.OrthographicCamera?(R.shadow.camera.top=C.shadowCameraTop,R.shadow.camera.right=C.shadowCameraRight,R.shadow.camera.bottom=C.shadowCameraBottom,R.shadow.camera.left=C.shadowCameraLeft):R.shadow.camera.fov=C.shadowCameraFov,R.shadow.camera.updateProjectionMatrix(),B&&B.update()},getLight:function(E){var C=E.angle,R=new m.Color(E.color);R=R.getHex();var B=E.decay,I=E.distance,N=new m.Color(E.groundColor);N=N.getHex();var D=E.intensity,P=E.type,k=E.target,q=null;switch(P.toLowerCase()){case"ambient":return new m.AmbientLight(R,D);case"directional":return q=new m.DirectionalLight(R,D),this.defaultTarget=q.target,k&&(k.hasLoaded?this.onSetTarget(k,q):k.addEventListener("loaded",this.onSetTarget.bind(this,k,q))),q;case"hemisphere":return new m.HemisphereLight(R,N,D);case"point":return new m.PointLight(R,D,I,B);case"spot":return q=new m.SpotLight(R,D,I,b(C),E.penumbra,B),this.defaultTarget=q.target,k&&(k.hasLoaded?this.onSetTarget(k,q):k.addEventListener("loaded",this.onSetTarget.bind(this,k,q))),q;case"probe":return q=new m.LightProbe,this.updateProbeMap(E,q),q;default:v("%s is not a valid light type. Choose from ambient, directional, hemisphere, point, spot.",P)}},updateProbeMap:function(E,C){E.envMap||C.copy(new m.LightProbe),T[E.envMap]instanceof window.Promise&&T[E.envMap].then(function(R){C.copy(R)}),T[E.envMap]instanceof m.LightProbe&&C.copy(T[E.envMap]),T[E.envMap]=new window.Promise(function(R){h.srcLoader.validateCubemapSrc(E.envMap,function(B){_.load(B,function(I){var N=m.LightProbeGenerator.fromCubeTexture(I);T[E.envMap]=N,C.copy(N)})})})},onSetTarget:function(E,C){C.target=E.object3D},remove:function(){var E=this.el;E.removeObject3D("light"),E.getObject3D("cameraHelper")&&E.removeObject3D("cameraHelper")}})},"./src/components/line.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent;l.exports.Component=h("line",{schema:{start:{type:"vec3",default:{x:0,y:0,z:0}},end:{type:"vec3",default:{x:0,y:0,z:0}},color:{type:"color",default:"#74BEC1"},opacity:{type:"number",default:1},visible:{default:!0}},multiple:!0,init:function(){var f=this.data,g,m;m=this.material=new THREE.LineBasicMaterial({color:f.color,opacity:f.opacity,transparent:f.opacity<1,visible:f.visible}),g=this.geometry=new THREE.BufferGeometry,g.setAttribute("position",new THREE.BufferAttribute(new Float32Array(6),3)),this.line=new THREE.Line(g,m),this.el.setObject3D(this.attrName,this.line)},update:function(f){var g=this.data,m=this.geometry,y=!1,b=this.material,v=m.attributes.position.array;p(g.start,f.start)||(v[0]=g.start.x,v[1]=g.start.y,v[2]=g.start.z,y=!0),p(g.end,f.end)||(v[3]=g.end.x,v[4]=g.end.y,v[5]=g.end.z,y=!0),y&&(m.attributes.position.needsUpdate=!0,m.computeBoundingSphere()),b.color.setStyle(g.color),b.opacity=g.opacity,b.transparent=g.opacity<1,b.visible=g.visible},remove:function(){this.el.removeObject3D(this.attrName,this.line)}});function p(f,g){return!f||!g?!1:f.x===g.x&&f.y===g.y&&f.z===g.z}},"./src/components/link.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/core/shader.js").registerShader,f=c("./src/lib/three.js");l.exports.Component=h("link",{schema:{backgroundColor:{default:"red",type:"color"},borderColor:{default:"white",type:"color"},highlighted:{default:!1},highlightedColor:{default:"#24CAFF",type:"color"},href:{default:""},image:{type:"asset"},on:{default:"click"},peekMode:{default:!1},title:{default:""},titleColor:{default:"white",type:"color"},visualAspectEnabled:{default:!1}},init:function(){this.navigate=this.navigate.bind(this),this.previousQuaternion=void 0,this.quaternionClone=new f.Quaternion,this.hiddenEls=[]},update:function(g){var m=this.data,y=this.el,b,v;m.visualAspectEnabled&&(this.initVisualAspect(),b=m.highlighted?m.highlightedColor:m.backgroundColor,v=m.highlighted?m.highlightedColor:m.borderColor,y.setAttribute("material","backgroundColor",b),y.setAttribute("material","strokeColor",v),m.on!==g.on&&this.updateEventListener(),g.peekMode!==void 0&&m.peekMode!==g.peekMode&&this.updatePeekMode(),!(!m.image||g.image===m.image)&&y.setAttribute("material","pano",typeof m.image=="string"?m.image:m.image.src))},updatePeekMode:function(){var g=this.el,m=this.sphereEl;this.data.peekMode?(this.hideAll(),g.getObject3D("mesh").visible=!1,m.setAttribute("visible",!0)):(this.showAll(),g.getObject3D("mesh").visible=!0,m.setAttribute("visible",!1))},play:function(){this.updateEventListener()},pause:function(){this.removeEventListener()},updateEventListener:function(){var g=this.el;g.isPlaying&&(this.removeEventListener(),g.addEventListener(this.data.on,this.navigate))},removeEventListener:function(){var g=this.data.on;g&&this.el.removeEventListener(g,this.navigate)},initVisualAspect:function(){var g=this.el,m,y,b;!this.data.visualAspectEnabled||this.visualAspectInitialized||(b=this.textEl=this.textEl||document.createElement("a-entity"),y=this.sphereEl=this.sphereEl||document.createElement("a-entity"),m=this.semiSphereEl=this.semiSphereEl||document.createElement("a-entity"),g.setAttribute("geometry",{primitive:"circle",radius:1,segments:64}),g.setAttribute("material",{shader:"portal",pano:this.data.image,side:"double"}),b.setAttribute("text",{color:this.data.titleColor,align:"center",font:"kelsonsans",value:this.data.title||this.data.href,width:4}),b.setAttribute("position","0 1.5 0"),g.appendChild(b),m.setAttribute("geometry",{primitive:"sphere",radius:1,phiStart:0,segmentsWidth:64,segmentsHeight:64,phiLength:180,thetaStart:0,thetaLength:360}),m.setAttribute("material",{shader:"portal",borderEnabled:0,pano:this.data.image,side:"back"}),m.setAttribute("rotation","0 180 0"),m.setAttribute("position","0 0 0"),m.setAttribute("visible",!1),g.appendChild(m),y.setAttribute("geometry",{primitive:"sphere",radius:10,segmentsWidth:64,segmentsHeight:64}),y.setAttribute("material",{shader:"portal",borderEnabled:0,pano:this.data.image,side:"back"}),y.setAttribute("visible",!1),g.appendChild(y),this.visualAspectInitialized=!0)},navigate:function(){window.location=this.data.href},tick:function(){var g=new f.Vector3,m=new f.Vector3,y=new f.Quaternion,b=new f.Vector3;return function(){var v=this.el,_=v.object3D,T=v.sceneEl.camera,E,C,R=this.textEl;if(this.data.visualAspectEnabled)if(_.updateMatrixWorld(),T.parent.updateMatrixWorld(),T.updateMatrixWorld(),_.matrix.decompose(m,y,b),m.setFromMatrixPosition(_.matrixWorld),g.setFromMatrixPosition(T.matrixWorld),C=m.distanceTo(g),C>20)this.previousQuaternion||(this.quaternionClone.copy(y),this.previousQuaternion=this.quaternionClone),_.lookAt(g);else{if(E=this.calculateCameraPortalOrientation(),C<.5){if(this.semiSphereEl.getAttribute("visible")===!0)return;R.setAttribute("text","width",1.5),E<=0?(R.setAttribute("position","0 0 0.75"),R.setAttribute("rotation","0 180 0"),this.semiSphereEl.setAttribute("rotation","0 0 0")):(R.setAttribute("position","0 0 -0.75"),R.setAttribute("rotation","0 0 0"),this.semiSphereEl.setAttribute("rotation","0 180 0")),v.getObject3D("mesh").visible=!1,this.semiSphereEl.setAttribute("visible",!0),this.peekCameraPortalOrientation=E}else E<=0?R.setAttribute("rotation","0 180 0"):R.setAttribute("rotation","0 0 0"),R.setAttribute("text","width",5),R.setAttribute("position","0 1.5 0"),v.getObject3D("mesh").visible=!0,this.semiSphereEl.setAttribute("visible",!1),this.peekCameraPortalOrientation=void 0;this.previousQuaternion&&(_.quaternion.copy(this.previousQuaternion),this.previousQuaternion=void 0)}}}(),hideAll:function(){var g=this.el,m=this.hiddenEls,y=this;m.length>0||g.sceneEl.object3D.traverse(function(b){b&&b.el&&b.el.hasAttribute("link-controls")||!b.el||b===g.sceneEl.object3D||b.el===g||b.el===y.sphereEl||b.el===g.sceneEl.cameraEl||b.el.getAttribute("visible")===!1||b.el===y.textEl||b.el===y.semiSphereEl||(b.el.setAttribute("visible",!1),m.push(b.el))})},showAll:function(){this.hiddenEls.forEach(function(g){g.setAttribute("visible",!0)}),this.hiddenEls=[]},calculateCameraPortalOrientation:function(){var g=new f.Matrix4,m=new f.Vector3,y=new f.Vector3(0,0,1),b=new f.Vector3(0,0,0);return function(){var v=this.el,_=v.sceneEl.camera;return m.set(0,0,0),y.set(0,0,1),b.set(0,0,0),v.object3D.matrixWorld.extractRotation(g),y.applyMatrix4(g),v.object3D.updateMatrixWorld(),v.object3D.localToWorld(b),_.parent.parent.updateMatrixWorld(),_.parent.updateMatrixWorld(),_.updateMatrixWorld(),_.localToWorld(m),m.sub(b).normalize(),y.normalize(),Math.sign(y.dot(m))}}(),remove:function(){this.removeEventListener()}}),p("portal",{schema:{borderEnabled:{default:1,type:"int",is:"uniform"},backgroundColor:{default:"red",type:"color",is:"uniform"},pano:{type:"map",is:"uniform"},strokeColor:{default:"white",type:"color",is:"uniform"}},vertexShader:["vec3 portalPosition;","varying vec3 vWorldPosition;","varying float vDistanceToCenter;","varying float vDistance;","void main() {","vDistanceToCenter = clamp(length(position - vec3(0.0, 0.0, 0.0)), 0.0, 1.0);","portalPosition = (modelMatrix * vec4(0.0, 0.0, 0.0, 1.0)).xyz;","vDistance = length(portalPosition - cameraPosition);","vWorldPosition = (modelMatrix * vec4(position, 1.0)).xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join(`
`),fragmentShader:["#define RECIPROCAL_PI2 0.15915494","uniform sampler2D pano;","uniform vec3 strokeColor;","uniform vec3 backgroundColor;","uniform float borderEnabled;","varying float vDistanceToCenter;","varying float vDistance;","varying vec3 vWorldPosition;","void main() {","vec3 direction = normalize(vWorldPosition - cameraPosition);","vec2 sampleUV;","float borderThickness = clamp(exp(-vDistance / 50.0), 0.6, 0.95);","sampleUV.y = clamp(direction.y * 0.5  + 0.5, 0.0, 1.0);","sampleUV.x = atan(direction.z, -direction.x) * -RECIPROCAL_PI2 + 0.5;","if (vDistanceToCenter > borderThickness && borderEnabled == 1.0) {","gl_FragColor = vec4(strokeColor, 1.0);","} else {","gl_FragColor = mix(texture2D(pano, sampleUV), vec4(backgroundColor, 1.0), clamp(pow((vDistance / 15.0), 2.0), 0.0, 1.0));","}","}"].join(`
`)})},"./src/components/look-controls.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/lib/three.js"),f=c("./src/utils/index.js"),g=Math.PI/2;l.exports.Component=h("look-controls",{dependencies:["position","rotation"],schema:{enabled:{default:!0},magicWindowTrackingEnabled:{default:!0},pointerLockEnabled:{default:!1},reverseMouseDrag:{default:!1},reverseTouchDrag:{default:!1},touchEnabled:{default:!0},mouseEnabled:{default:!0}},init:function(){this.deltaYaw=0,this.previousHMDPosition=new p.Vector3,this.hmdQuaternion=new p.Quaternion,this.magicWindowAbsoluteEuler=new p.Euler,this.magicWindowDeltaEuler=new p.Euler,this.position=new p.Vector3,this.magicWindowObject=new p.Object3D,this.rotation={},this.deltaRotation={},this.savedPose=null,this.pointerLocked=!1,this.setupMouseControls(),this.bindMethods(),this.previousMouseEvent={},this.setupMagicWindowControls(),this.savedPose={position:new p.Vector3,rotation:new p.Euler},(this.el.sceneEl.is("vr-mode")||this.el.sceneEl.is("ar-mode"))&&this.onEnterVR()},setupMagicWindowControls:function(){var m,y=this.data;(f.device.isMobile()||f.device.isMobileDeviceRequestingDesktopSite())&&(m=this.magicWindowControls=new p.DeviceOrientationControls(this.magicWindowObject),typeof DeviceOrientationEvent<"u"&&DeviceOrientationEvent.requestPermission&&(m.enabled=!1,this.el.sceneEl.components["device-orientation-permission-ui"].permissionGranted?m.enabled=y.magicWindowTrackingEnabled:this.el.sceneEl.addEventListener("deviceorientationpermissiongranted",function(){m.enabled=y.magicWindowTrackingEnabled})))},update:function(m){var y=this.data;y.enabled!==m.enabled&&this.updateGrabCursor(y.enabled),m&&!y.magicWindowTrackingEnabled&&m.magicWindowTrackingEnabled&&(this.magicWindowAbsoluteEuler.set(0,0,0),this.magicWindowDeltaEuler.set(0,0,0)),this.magicWindowControls&&(this.magicWindowControls.enabled=y.magicWindowTrackingEnabled),m&&!y.pointerLockEnabled!==m.pointerLockEnabled&&(this.removeEventListeners(),this.addEventListeners(),this.pointerLocked&&this.exitPointerLock())},tick:function(m){var y=this.data;y.enabled&&this.updateOrientation()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.pointerLocked&&this.exitPointerLock()},remove:function(){this.removeEventListeners(),this.pointerLocked&&this.exitPointerLock()},bindMethods:function(){this.onMouseDown=this.onMouseDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onEnterVR=this.onEnterVR.bind(this),this.onExitVR=this.onExitVR.bind(this),this.onPointerLockChange=this.onPointerLockChange.bind(this),this.onPointerLockError=this.onPointerLockError.bind(this)},setupMouseControls:function(){this.mouseDown=!1,this.pitchObject=new p.Object3D,this.yawObject=new p.Object3D,this.yawObject.position.y=10,this.yawObject.add(this.pitchObject)},addEventListeners:function(){var m=this.el.sceneEl,y=m.canvas;if(!y){m.addEventListener("render-target-loaded",this.addEventListeners.bind(this));return}y.addEventListener("mousedown",this.onMouseDown,!1),window.addEventListener("mousemove",this.onMouseMove,!1),window.addEventListener("mouseup",this.onMouseUp,!1),y.addEventListener("touchstart",this.onTouchStart,{passive:!0}),window.addEventListener("touchmove",this.onTouchMove,{passive:!0}),window.addEventListener("touchend",this.onTouchEnd,{passive:!0}),m.addEventListener("enter-vr",this.onEnterVR),m.addEventListener("exit-vr",this.onExitVR),this.data.pointerLockEnabled&&(document.addEventListener("pointerlockchange",this.onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",this.onPointerLockChange,!1),document.addEventListener("pointerlockerror",this.onPointerLockError,!1))},removeEventListeners:function(){var m=this.el.sceneEl,y=m&&m.canvas;y&&(y.removeEventListener("mousedown",this.onMouseDown),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mouseup",this.onMouseUp),y.removeEventListener("touchstart",this.onTouchStart),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd),m.removeEventListener("enter-vr",this.onEnterVR),m.removeEventListener("exit-vr",this.onExitVR),document.removeEventListener("pointerlockchange",this.onPointerLockChange,!1),document.removeEventListener("mozpointerlockchange",this.onPointerLockChange,!1),document.removeEventListener("pointerlockerror",this.onPointerLockError,!1))},updateOrientation:function(){var m=this.el.object3D,y=this.pitchObject,b=this.yawObject,v=this.el.sceneEl;(v.is("vr-mode")||v.is("ar-mode"))&&v.checkHeadsetConnected()||(this.updateMagicWindowOrientation(),m.rotation.x=this.magicWindowDeltaEuler.x+y.rotation.x,m.rotation.y=this.magicWindowDeltaEuler.y+b.rotation.y,m.rotation.z=this.magicWindowDeltaEuler.z)},updateMagicWindowOrientation:function(){var m=this.magicWindowAbsoluteEuler,y=this.magicWindowDeltaEuler;this.magicWindowControls&&this.magicWindowControls.enabled&&(this.magicWindowControls.update(),m.setFromQuaternion(this.magicWindowObject.quaternion,"YXZ"),!this.previousMagicWindowYaw&&m.y!==0&&(this.previousMagicWindowYaw=m.y),this.previousMagicWindowYaw&&(y.x=m.x,y.y+=m.y-this.previousMagicWindowYaw,y.z=m.z,this.previousMagicWindowYaw=m.y))},onMouseMove:function(m){var y,b,v,_=this.pitchObject,T=this.previousMouseEvent,E=this.yawObject;!this.data.enabled||!this.mouseDown&&!this.pointerLocked||(this.pointerLocked?(b=m.movementX||m.mozMovementX||0,v=m.movementY||m.mozMovementY||0):(b=m.screenX-T.screenX,v=m.screenY-T.screenY),this.previousMouseEvent.screenX=m.screenX,this.previousMouseEvent.screenY=m.screenY,y=this.data.reverseMouseDrag?1:-1,E.rotation.y+=b*.002*y,_.rotation.x+=v*.002*y,_.rotation.x=Math.max(-g,Math.min(g,_.rotation.x)))},onMouseDown:function(m){var y=this.el.sceneEl;if(!(!this.data.enabled||!this.data.mouseEnabled||(y.is("vr-mode")||y.is("ar-mode"))&&y.checkHeadsetConnected())&&m.button===0){var b=y&&y.canvas;this.mouseDown=!0,this.previousMouseEvent.screenX=m.screenX,this.previousMouseEvent.screenY=m.screenY,this.showGrabbingCursor(),this.data.pointerLockEnabled&&!this.pointerLocked&&(b.requestPointerLock?b.requestPointerLock():b.mozRequestPointerLock&&b.mozRequestPointerLock())}},showGrabbingCursor:function(){this.el.sceneEl.canvas.style.cursor="grabbing"},hideGrabbingCursor:function(){this.el.sceneEl.canvas.style.cursor=""},onMouseUp:function(){this.mouseDown=!1,this.hideGrabbingCursor()},onTouchStart:function(m){m.touches.length!==1||!this.data.touchEnabled||this.el.sceneEl.is("vr-mode")||this.el.sceneEl.is("ar-mode")||(this.touchStart={x:m.touches[0].pageX,y:m.touches[0].pageY},this.touchStarted=!0)},onTouchMove:function(m){var y,b=this.el.sceneEl.canvas,v,_=this.yawObject;!this.touchStarted||!this.data.touchEnabled||(v=2*Math.PI*(m.touches[0].pageX-this.touchStart.x)/b.clientWidth,y=this.data.reverseTouchDrag?1:-1,_.rotation.y-=v*.5*y,this.touchStart={x:m.touches[0].pageX,y:m.touches[0].pageY})},onTouchEnd:function(){this.touchStarted=!1},onEnterVR:function(){var m=this.el.sceneEl;m.checkHeadsetConnected()&&(this.saveCameraPose(),this.el.object3D.position.set(0,0,0),this.el.object3D.rotation.set(0,0,0),m.hasWebXR&&(this.el.object3D.matrixAutoUpdate=!1,this.el.object3D.updateMatrix()))},onExitVR:function(){this.el.sceneEl.checkHeadsetConnected()&&(this.restoreCameraPose(),this.previousHMDPosition.set(0,0,0),this.el.object3D.matrixAutoUpdate=!0)},onPointerLockChange:function(){this.pointerLocked=!!(document.pointerLockElement||document.mozPointerLockElement)},onPointerLockError:function(){this.pointerLocked=!1},exitPointerLock:function(){document.exitPointerLock(),this.pointerLocked=!1},updateGrabCursor:function(m){var y=this.el.sceneEl;function b(){y.canvas.classList.add("a-grab-cursor")}function v(){y.canvas.classList.remove("a-grab-cursor")}if(!y.canvas){m?y.addEventListener("render-target-loaded",b):y.addEventListener("render-target-loaded",v);return}if(m){b();return}v()},saveCameraPose:function(){var m=this.el;this.savedPose.position.copy(m.object3D.position),this.savedPose.rotation.copy(m.object3D.rotation),this.hasSavedPose=!0},restoreCameraPose:function(){var m=this.el,y=this.savedPose;this.hasSavedPose&&(m.object3D.position.copy(y.position),m.object3D.rotation.copy(y.rotation),this.hasSavedPose=!1)}})},"./src/components/magicleap-controls.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/utils/tracked-controls.js"),f=p.checkControllerPresentAndSetup,g=p.emitIfAxesChanged,m=p.onButtonEvent,y="magicleap",b="-one",v=y+b,_=c("./src/constants/index.js").AFRAME_CDN_ROOT,T=_+"controllers/magicleap/magicleap-one-controller.glb",E={axes:{touchpad:[0,1]},buttons:["trigger","grip","touchpad","menu"]};l.exports.Component=h("magicleap-controls",{schema:{hand:{default:"none"},model:{default:!0},orientationOffset:{type:"vec3"}},mapping:E,init:function(){var C=this;this.controllerPresent=!1,this.lastControllerCheck=0,this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(R){m(R.detail.id,"down",C)},this.onButtonUp=function(R){m(R.detail.id,"up",C)},this.onButtonTouchEnd=function(R){m(R.detail.id,"touchend",C)},this.onButtonTouchStart=function(R){m(R.detail.id,"touchstart",C)},this.previousButtonValues={},this.bindMethods()},update:function(){var C=this.data;this.controllerIndex=C.hand==="right"?0:C.hand==="left"?1:2},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},addEventListeners:function(){var C=this.el;C.addEventListener("buttonchanged",this.onButtonChanged),C.addEventListener("buttondown",this.onButtonDown),C.addEventListener("buttonup",this.onButtonUp),C.addEventListener("touchstart",this.onButtonTouchStart),C.addEventListener("touchend",this.onButtonTouchEnd),C.addEventListener("axismove",this.onAxisMoved),C.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var C=this.el;C.removeEventListener("buttonchanged",this.onButtonChanged),C.removeEventListener("buttondown",this.onButtonDown),C.removeEventListener("buttonup",this.onButtonUp),C.removeEventListener("touchstart",this.onButtonTouchStart),C.removeEventListener("touchend",this.onButtonTouchEnd),C.removeEventListener("axismove",this.onAxisMoved),C.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var C=this.data;f(this,v,{index:this.controllerIndex,hand:C.hand})},injectTrackedControls:function(){var C=this.el,R=this.data;C.setAttribute("tracked-controls",{idPrefix:v,hand:R.hand,controller:this.controllerIndex,orientationOffset:R.orientationOffset}),this.data.model&&this.el.setAttribute("gltf-model",T)},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(C){var R=this.mapping.buttons[C.detail.id],B;R&&(R==="trigger"&&(B=C.detail.state.value,console.log("analog value of trigger press: "+B)),this.el.emit(R+"changed",C.detail.state))},onModelLoaded:function(C){var R=C.detail.model;R.scale.set(.01,.01,.01)},onAxisMoved:function(C){g(this,this.mapping.axes,C)},updateModel:function(C,R){},setButtonColor:function(C,R){}})},"./src/components/material.js":(l,u,c)=>{var h=c("./src/utils/index.js"),p=c("./src/core/component.js"),f=c("./src/lib/three.js"),g=c("./src/core/shader.js"),m=h.debug("components:material:error"),y=p.registerComponent,b=g.shaders,v=g.shaderNames;l.exports.Component=y("material",{schema:{alphaTest:{default:0,min:0,max:1},depthTest:{default:!0},depthWrite:{default:!0},flatShading:{default:!1},npot:{default:!1},offset:{type:"vec2",default:{x:0,y:0}},opacity:{default:1,min:0,max:1},repeat:{type:"vec2",default:{x:1,y:1}},shader:{default:"standard",oneOf:v,schemaChange:!0},side:{default:"front",oneOf:["front","back","double"]},transparent:{default:!1},vertexColorsEnabled:{default:!1},visible:{default:!0},blending:{default:"normal",oneOf:["none","normal","additive","subtractive","multiply"]},dithering:{default:!0},anisotropy:{default:0,min:0}},init:function(){this.material=null},update:function(C){var R=this.data;(!this.shader||R.shader!==C.shader)&&this.updateShader(R.shader),this.shader.update(this.data),this.updateMaterial(C)},updateSchema:function(C){var R,B,I,N;B=C&&C.shader,R=this.oldData&&this.oldData.shader,N=B||R,I=b[N]&&b[N].schema,I||m("Unknown shader schema "+N),!(R&&B===R)&&(this.extendSchema(I),this.updateBehavior())},updateBehavior:function(){var C,R=this.el.sceneEl,B=this.schema,I=this,N;function D(P,k){var q;for(q in N)N[q]=P;I.shader.update(N)}this.tick=void 0,N={};for(C in B)B[C].type==="time"&&(this.tick=D,N[C]=!0);R&&(this.tick?R.addBehavior(this):R.removeBehavior(this))},updateShader:function(C){var R=this.data,B=b[C]&&b[C].Shader,I;if(!B)throw new Error("Unknown shader "+C);I=this.shader=new B,I.el=this.el,I.init(R),this.setMaterial(I.material),this.updateSchema(R)},updateMaterial:function(C){var R=this.data,B=this.material,I;B.alphaTest=R.alphaTest,B.depthTest=R.depthTest!==!1,B.depthWrite=R.depthWrite!==!1,B.opacity=R.opacity,B.flatShading=R.flatShading,B.side=_(R.side),B.transparent=R.transparent!==!1||R.opacity<1,B.vertexColors=R.vertexColorsEnabled,B.visible=R.visible,B.blending=T(R.blending),B.dithering=R.dithering;for(I in C)break;I&&(C.alphaTest!==R.alphaTest||C.side!==R.side||C.vertexColorsEnabled!==R.vertexColorsEnabled)&&(B.needsUpdate=!0)},remove:function(){var C=new f.MeshBasicMaterial,R=this.material,B=this.el.getObject3D("mesh");B&&(B.material=C),E(R,this.system)},setMaterial:function(C){var R=this.el,B,I=this.system;this.material&&E(this.material,I),this.material=C,I.registerMaterial(C),B=R.getObject3D("mesh"),B?B.material=C:R.addEventListener("object3dset",function N(D){D.detail.type!=="mesh"||D.target!==R||(R.getObject3D("mesh").material=C,R.removeEventListener("object3dset",N))})}});function _(C){switch(C){case"back":return f.BackSide;case"double":return f.DoubleSide;default:return f.FrontSide}}function T(C){switch(C){case"none":return f.NoBlending;case"additive":return f.AdditiveBlending;case"subtractive":return f.SubtractiveBlending;case"multiply":return f.MultiplyBlending;default:return f.NormalBlending}}function E(C,R){C.dispose(),R.unregisterMaterial(C),Object.keys(C).filter(function(B){return C[B]&&C[B].isTexture}).forEach(function(B){C[B].dispose()})}},"./src/components/obb-collider.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/lib/three.js");h("obb-collider",{schema:{size:{default:0},trackedObject3D:{default:""},minimumColliderDimension:{default:.02},centerModel:{default:!1}},init:function(){this.previousScale=new p.Vector3().copy(this.el.object3D.scale),this.auxEuler=new p.Euler,this.boundingBox=new p.Box3,this.boundingBoxSize=new p.Vector3,this.updateCollider=this.updateCollider.bind(this),this.onModelLoaded=this.onModelLoaded.bind(this),this.updateBoundingBox=this.updateBoundingBox.bind(this),this.el.addEventListener("model-loaded",this.onModelLoaded),this.updateCollider(),this.system.addCollider(this.el)},remove:function(){this.system.removeCollider(this.el)},update:function(){this.data.trackedObject3D&&(this.trackedObject3DPath=this.data.trackedObject3D.split("."))},onModelLoaded:function(){this.data.centerModel&&this.centerModel(),this.updateCollider()},centerModel:function(){var f=this.el,g=f.components["gltf-model"]&&f.components["gltf-model"].model,m,y;g&&(this.el.removeObject3D("mesh"),m=new p.Box3().setFromObject(g),y=m.getCenter(new p.Vector3),g.position.x+=g.position.x-y.x,g.position.y+=g.position.y-y.y,g.position.z+=g.position.z-y.z,this.el.setObject3D("mesh",g))},updateCollider:function(){var f=this.el,g=this.boundingBoxSize,m=this.aabb=this.aabb||new p.OBB;if(this.obb=this.obb||new p.OBB,!f.hasLoaded){f.addEventListener("loaded",this.updateCollider);return}this.updateBoundingBox(),m.halfSize.copy(g).multiplyScalar(.5),this.el.sceneEl.systems["obb-collider"].data.showColliders&&this.showCollider()},showCollider:function(){this.updateColliderMesh(),this.renderColliderMesh.visible=!0},updateColliderMesh:function(){var f=this.renderColliderMesh,g=this.boundingBoxSize;if(!f){this.initColliderMesh();return}f.geometry.dispose(),f.geometry=new p.BoxGeometry(g.x,g.y,g.z)},hideCollider:function(){this.renderColliderMesh&&(this.renderColliderMesh.visible=!1)},initColliderMesh:function(){var f,g,m;f=this.boundingBoxSize,g=this.renderColliderGeometry=new p.BoxGeometry(f.x,f.y,f.z),m=this.renderColliderMesh=new p.Mesh(g,new p.MeshLambertMaterial({color:65280,side:p.DoubleSide})),m.matrixAutoUpdate=!1,m.matrixWorldAutoUpdate=!1,m.updateMatrixWorld=function(){},this.el.sceneEl.object3D.add(m)},updateBoundingBox:function(){var f=new p.Vector3,g=new p.Vector3,m=new p.Quaternion,y=new p.Quaternion,b=new p.Matrix4;return function(){var v=this.auxEuler,_=this.boundingBox,T=this.data.size,E=this.trackedObject3D||this.el.object3D,C=this.boundingBoxSize,R=this.data.minimumColliderDimension;if(T){this.boundingBoxSize.x=T,this.boundingBoxSize.y=T,this.boundingBoxSize.z=T;return}v.copy(E.rotation),E.rotation.set(0,0,0),E.parent.matrixWorld.decompose(f,m,g),b.compose(f,y,g),E.parent.matrixWorld.copy(b),_.setFromObject(E,!0),_.getSize(C),C.x=C.x<R?R:C.x,C.y=C.y<R?R:C.y,C.z=C.z<R?R:C.z,E.parent.matrixWorld.compose(f,m,g),this.el.object3D.rotation.copy(v)}}(),checkTrackedObject:function(){var f=this.trackedObject3DPath,g;if(f&&f.length&&!this.trackedObject3D){g=this.el;for(var m=0;m<f.length&&(g=g[f[m]],!!g);m++);g&&(this.trackedObject3D=g,this.updateCollider())}return this.trackedObject3D},tick:function(){var f=new p.Vector3,g=new p.Vector3,m=new p.Quaternion,y=new p.Matrix4;return function(){var b=this.obb,v=this.renderColliderMesh,_=this.checkTrackedObject()||this.el.object3D;_&&(_.updateMatrix(),_.updateMatrixWorld(!0),_.matrixWorld.decompose(f,m,g),(Math.abs(g.x-this.previousScale.x)>1e-4||Math.abs(g.y-this.previousScale.y)>1e-4||Math.abs(g.z-this.previousScale.z)>1e-4)&&this.updateCollider(),this.previousScale.copy(g),g.set(1,1,1),y.compose(f,m,g),v&&v.matrixWorld.copy(y),b.copy(this.aabb),b.applyMatrix4(y))}}()})},"./src/components/obj-model.js":(l,u,c)=>{var h=c("./src/utils/debug.js"),p=c("./src/core/component.js").registerComponent,f=c("./src/lib/three.js"),g=h("components:obj-model:warn");l.exports.Component=p("obj-model",{schema:{mtl:{type:"model"},obj:{type:"model"}},init:function(){var m=this;this.model=null,this.objLoader=new f.OBJLoader,this.mtlLoader=new f.MTLLoader(this.objLoader.manager),this.mtlLoader.crossOrigin="",this.el.addEventListener("componentinitialized",function(y){m.model&&y.detail.name==="material"&&m.applyMaterial()})},update:function(){var m=this.data;m.obj&&(this.resetMesh(),this.loadObj(m.obj,m.mtl))},remove:function(){this.resetMesh()},resetMesh:function(){this.model&&this.el.removeObject3D("mesh")},loadObj:function(m,y){var b=this,v=this.el,_=this.mtlLoader,T=this.objLoader,E=this.el.sceneEl.systems.renderer,C=y.substr(0,y.lastIndexOf("/")+1);if(y){v.hasAttribute("material")&&g("Material component properties are ignored when a .MTL is provided"),_.setResourcePath(C),_.load(y,function(R){R.preload(),T.setMaterials(R),T.load(m,function(B){b.model=B,b.model.traverse(function(I){if(I.isMesh){var N=I.material;N.map&&E.applyColorCorrection(N.map),N.emissiveMap&&E.applyColorCorrection(N.emissiveMap)}}),v.setObject3D("mesh",B),v.emit("model-loaded",{format:"obj",model:B})})});return}T.load(m,function(R){b.model=R,b.applyMaterial(),v.setObject3D("mesh",R),v.emit("model-loaded",{format:"obj",model:R})})},applyMaterial:function(){var m=this.el.components.material;m&&this.model.traverse(function(y){y instanceof f.Mesh&&(y.material=m.material)})}})},"./src/components/oculus-go-controls.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/utils/tracked-controls.js"),f=p.checkControllerPresentAndSetup,g=p.emitIfAxesChanged,m=p.onButtonEvent,y=c("./src/utils/index.js").device.isWebXRAvailable,b="oculus-go",v="Oculus Go",_=c("./src/constants/index.js").AFRAME_CDN_ROOT,T=_+"controllers/oculus/go/oculus-go-controller.gltf",E=y?b:v,C={axes:{trackpad:[0,1]},buttons:["trackpad","trigger"]},R={axes:{touchpad:[0,1]},buttons:["trigger","none","touchpad"]},B=y?R:C;l.exports.Component=h("oculus-go-controls",{schema:{hand:{default:""},buttonColor:{type:"color",default:"#FFFFFF"},buttonTouchedColor:{type:"color",default:"#BBBBBB"},buttonHighlightColor:{type:"color",default:"#7A7A7A"},model:{default:!0},orientationOffset:{type:"vec3"},armModel:{default:!0}},mapping:B,bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},init:function(){var I=this;this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(N){m(N.detail.id,"down",I)},this.onButtonUp=function(N){m(N.detail.id,"up",I)},this.onButtonTouchStart=function(N){m(N.detail.id,"touchstart",I)},this.onButtonTouchEnd=function(N){m(N.detail.id,"touchend",I)},this.controllerPresent=!1,this.lastControllerCheck=0,this.bindMethods()},addEventListeners:function(){var I=this.el;I.addEventListener("buttonchanged",this.onButtonChanged),I.addEventListener("buttondown",this.onButtonDown),I.addEventListener("buttonup",this.onButtonUp),I.addEventListener("touchstart",this.onButtonTouchStart),I.addEventListener("touchend",this.onButtonTouchEnd),I.addEventListener("model-loaded",this.onModelLoaded),I.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var I=this.el;I.removeEventListener("buttonchanged",this.onButtonChanged),I.removeEventListener("buttondown",this.onButtonDown),I.removeEventListener("buttonup",this.onButtonUp),I.removeEventListener("touchstart",this.onButtonTouchStart),I.removeEventListener("touchend",this.onButtonTouchEnd),I.removeEventListener("model-loaded",this.onModelLoaded),I.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){f(this,E,this.data.hand?{hand:this.data.hand}:{})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var I=this.el,N=this.data;I.setAttribute("tracked-controls",{armModel:N.armModel,hand:N.hand,idPrefix:E,orientationOffset:N.orientationOffset}),this.data.model&&this.el.setAttribute("gltf-model",T)},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelLoaded:function(I){var N=I.detail.model,D;I.target!==this.el||!this.data.model||(D=this.buttonMeshes={},D.trigger=N.getObjectByName("oculus_go_button_trigger"),D.trackpad=N.getObjectByName("oculus_go_touchpad"),D.touchpad=N.getObjectByName("oculus_go_touchpad"))},onButtonChanged:function(I){var N=this.mapping.buttons[I.detail.id];N&&this.el.emit(N+"changed",I.detail.state)},onAxisMoved:function(I){g(this,this.mapping.axes,I)},updateModel:function(I,N){this.data.model&&this.updateButtonModel(I,N)},updateButtonModel:function(I,N){var D=this.buttonMeshes;if(!(!D||!D[I])){var P,k;switch(N){case"down":P=this.data.buttonHighlightColor;break;case"touchstart":P=this.data.buttonTouchedColor;break;default:P=this.data.buttonColor}k=D[I],k.material.color.set(P)}}})},"./src/components/oculus-touch-controls.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/lib/three.js"),f=c("./src/utils/tracked-controls.js"),g=f.checkControllerPresentAndSetup,m=f.emitIfAxesChanged,y=f.onButtonEvent,b=c("./src/utils/index.js").device.isWebXRAvailable,v="oculus-touch",_="Oculus Touch",T=b?v:_,E=c("./src/constants/index.js").AFRAME_CDN_ROOT,C=E+"controllers/oculus/oculus-touch-controller-",R=E+"controllers/meta/",B={left:{modelUrl:C+"left.gltf",rayOrigin:{origin:{x:.008,y:-.01,z:0},direction:{x:0,y:-.8,z:-1}},modelPivotOffset:new p.Vector3(-.005,.003,-.055),modelPivotRotation:new p.Euler(0,0,0)},right:{modelUrl:C+"right.gltf",rayOrigin:{origin:{x:-.008,y:-.01,z:0},direction:{x:0,y:-.8,z:-1}},modelPivotOffset:new p.Vector3(.005,.003,-.055),modelPivotRotation:new p.Euler(0,0,0)}},I={left:{modelUrl:C+"left.gltf",rayOrigin:{origin:{x:.002,y:-.005,z:-.03},direction:{x:0,y:-.8,z:-1}},modelPivotOffset:new p.Vector3(-.005,.036,-.037),modelPivotRotation:new p.Euler(Math.PI/4.5,0,0)},right:{modelUrl:C+"right.gltf",rayOrigin:{origin:{x:-.002,y:-.005,z:-.03},direction:{x:0,y:-.8,z:-1}},modelPivotOffset:new p.Vector3(.005,.036,-.037),modelPivotRotation:new p.Euler(Math.PI/4.5,0,0)}},N=b?I:B,D="oculus-touch",P={"oculus-touch":N,"oculus-touch-v2":{left:{modelUrl:C+"gen2-left.gltf",rayOrigin:{origin:{x:-.006,y:-.03,z:-.04},direction:{x:0,y:-.9,z:-1}},modelPivotOffset:new p.Vector3(0,-.007,-.021),modelPivotRotation:new p.Euler(-Math.PI/4,0,0)},right:{modelUrl:C+"gen2-right.gltf",rayOrigin:{origin:{x:.006,y:-.03,z:-.04},direction:{x:0,y:-.9,z:-1}},modelPivotOffset:new p.Vector3(0,-.007,-.021),modelPivotRotation:new p.Euler(-Math.PI/4,0,0)}},"oculus-touch-v3":{left:{modelUrl:C+"v3-left.glb",rayOrigin:{origin:{x:.0065,y:-.0186,z:-.05},direction:{x:.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new p.Vector3(0,0,0),modelPivotRotation:new p.Euler(0,0,0)},right:{modelUrl:C+"v3-right.glb",rayOrigin:{origin:{x:-.0065,y:-.0186,z:-.05},direction:{x:-.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new p.Vector3(0,0,0),modelPivotRotation:new p.Euler(0,0,0)}},"meta-quest-touch-pro":{left:{modelUrl:R+"quest-touch-pro-left.glb",rayOrigin:{origin:{x:.0065,y:-.0186,z:-.05},direction:{x:.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new p.Vector3(0,0,0),modelPivotRotation:new p.Euler(0,0,0)},right:{modelUrl:R+"quest-touch-pro-right.glb",rayOrigin:{origin:{x:-.0065,y:-.0186,z:-.05},direction:{x:-.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new p.Vector3(0,0,0),modelPivotRotation:new p.Euler(0,0,0)}},"meta-quest-touch-plus":{left:{modelUrl:R+"quest-touch-plus-left.glb",rayOrigin:{origin:{x:.0065,y:-.0186,z:-.05},direction:{x:.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new p.Vector3(0,0,0),modelPivotRotation:new p.Euler(0,0,0)},right:{modelUrl:R+"quest-touch-plus-right.glb",rayOrigin:{origin:{x:-.0065,y:-.0186,z:-.05},direction:{x:-.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new p.Vector3(0,0,0),modelPivotRotation:new p.Euler(0,0,0)}}},k={left:{axes:{thumbstick:[0,1]},buttons:["thumbstick","trigger","grip","xbutton","ybutton","surface"]},right:{axes:{thumbstick:[0,1]},buttons:["thumbstick","trigger","grip","abutton","bbutton","surface"]}},q={left:{axes:{thumbstick:[2,3]},buttons:["trigger","grip","none","thumbstick","xbutton","ybutton","surface"]},right:{axes:{thumbstick:[2,3]},buttons:["trigger","grip","none","thumbstick","abutton","bbutton","surface"]}},V=b?q:k;l.exports.Component=h("oculus-touch-controls",{schema:{hand:{default:"left"},buttonColor:{type:"color",default:"#999"},buttonTouchColor:{type:"color",default:"#8AB"},buttonHighlightColor:{type:"color",default:"#2DF"},model:{default:!0},controllerType:{default:"auto",oneOf:["auto","oculus-touch","oculus-touch-v2","oculus-touch-v3"]},orientationOffset:{type:"vec3",default:{x:43,y:0,z:0}}},after:["tracked-controls"],mapping:V,bindMethods:function(){this.onButtonChanged=this.onButtonChanged.bind(this),this.onThumbstickMoved=this.onThumbstickMoved.bind(this),this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},init:function(){var Q=this;this.onButtonDown=function(W){y(W.detail.id,"down",Q,Q.data.hand)},this.onButtonUp=function(W){y(W.detail.id,"up",Q,Q.data.hand)},this.onButtonTouchStart=function(W){y(W.detail.id,"touchstart",Q,Q.data.hand)},this.onButtonTouchEnd=function(W){y(W.detail.id,"touchend",Q,Q.data.hand)},this.controllerPresent=!1,this.lastControllerCheck=0,this.previousButtonValues={},this.bindMethods(),this.triggerEuler=new p.Euler},addEventListeners:function(){var Q=this.el;Q.addEventListener("buttonchanged",this.onButtonChanged),Q.addEventListener("buttondown",this.onButtonDown),Q.addEventListener("buttonup",this.onButtonUp),Q.addEventListener("touchstart",this.onButtonTouchStart),Q.addEventListener("touchend",this.onButtonTouchEnd),Q.addEventListener("axismove",this.onAxisMoved),Q.addEventListener("model-loaded",this.onModelLoaded),Q.addEventListener("thumbstickmoved",this.onThumbstickMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var Q=this.el;Q.removeEventListener("buttonchanged",this.onButtonChanged),Q.removeEventListener("buttondown",this.onButtonDown),Q.removeEventListener("buttonup",this.onButtonUp),Q.removeEventListener("touchstart",this.onButtonTouchStart),Q.removeEventListener("touchend",this.onButtonTouchEnd),Q.removeEventListener("axismove",this.onAxisMoved),Q.removeEventListener("model-loaded",this.onModelLoaded),Q.removeEventListener("thumbstickmoved",this.onThumbstickMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){g(this,T,{hand:this.data.hand,iterateControllerProfiles:!0})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},loadModel:function(Q){var W=this.data,G;if(W.model){if(this.controllerObject3D){this.el.setObject3D("mesh",this.controllerObject3D);return}if(this.displayModel=P[W.controllerType]||P[D],W.controllerType==="auto"){var z=this.el.sceneEl.systems["tracked-controls-webvr"];if(z&&z.vrDisplay){var te=z.vrDisplay.displayName;/^Oculus Quest$/.test(te)&&(this.displayModel=P["oculus-touch-v2"])}else{G=D;for(var Y=Object.keys(P),se=0;se<Q.profiles.length;se++)if(Y.indexOf(Q.profiles[se])!==-1){G=Q.profiles[se];break}this.displayModel=P[G]}}var ve=this.displayModel[W.hand].modelUrl;this.isTouchV3orPROorPlus=this.displayModel===P["oculus-touch-v3"]||this.displayModel===P["meta-quest-touch-pro"]||this.displayModel===P["meta-quest-touch-plus"],this.el.setAttribute("gltf-model",ve)}},injectTrackedControls:function(Q){var W=this.data,G=v,z=W.hand==="right"?"Oculus Touch (Right)":"Oculus Touch (Left)",te=b?G:z;this.el.setAttribute("tracked-controls",{id:te,hand:W.hand,orientationOffset:W.orientationOffset,handTrackingEnabled:!1,iterateControllerProfiles:!0,space:"gripSpace"}),this.loadModel(Q)},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(Q){var W=this.mapping[this.data.hand].buttons[Q.detail.id];if(W){if(this.isTouchV3orPROorPlus)this.onButtonChangedV3orPROorPlus(Q);else{var G=this.buttonMeshes,z;(W==="trigger"||W==="grip")&&(z=Q.detail.state.value),G&&(W==="trigger"&&G.trigger&&(G.trigger.rotation.x=this.originalXRotationTrigger-z*(Math.PI/26)),W==="grip"&&G.grip&&(z*=this.data.hand==="left"?-1:1,G.grip.position.x=this.originalXPositionGrip+z*.004))}this.el.emit(W+"changed",Q.detail.state)}},onButtonChangedV3orPROorPlus:function(Q){var W=this.mapping[this.data.hand].buttons[Q.detail.id],G=this.buttonObjects,z;!G||!G[W]||(z=Q.detail.state.value,G[W].quaternion.slerpQuaternions(this.buttonRanges[W].min.quaternion,this.buttonRanges[W].max.quaternion,z),G[W].position.lerpVectors(this.buttonRanges[W].min.position,this.buttonRanges[W].max.position,z))},onModelLoaded:function(Q){if(!(Q.target!==this.el||!this.data.model)){if(this.isTouchV3orPROorPlus)this.onTouchV3orPROorPlusModelLoaded(Q);else{var W=this.controllerObject3D=Q.detail.model,G;G=this.buttonMeshes={},G.grip=W.getObjectByName("buttonHand"),this.originalXPositionGrip=G.grip&&G.grip.position.x,G.trigger=W.getObjectByName("buttonTrigger"),this.originalXRotationTrigger=G.trigger&&G.trigger.rotation.x,G.thumbstick=W.getObjectByName("stick"),G.xbutton=W.getObjectByName("buttonX"),G.abutton=W.getObjectByName("buttonA"),G.ybutton=W.getObjectByName("buttonY"),G.bbutton=W.getObjectByName("buttonB")}for(var z in this.buttonMeshes)this.buttonMeshes[z]&&j(this.buttonMeshes[z]);this.applyOffset(Q.detail.model),this.el.emit("controllermodelready",{name:"oculus-touch-controls",model:this.data.model,rayOrigin:this.displayModel[this.data.hand].rayOrigin})}},applyOffset:function(Q){Q.position.copy(this.displayModel[this.data.hand].modelPivotOffset),Q.rotation.copy(this.displayModel[this.data.hand].modelPivotRotation)},onTouchV3orPROorPlusModelLoaded:function(Q){var W=this.controllerObject3D=Q.detail.model,G=this.buttonObjects={},z=this.buttonMeshes={},te=this.buttonRanges={};z.grip=W.getObjectByName("squeeze"),G.grip=W.getObjectByName("xr_standard_squeeze_pressed_value"),te.grip={min:W.getObjectByName("xr_standard_squeeze_pressed_min"),max:W.getObjectByName("xr_standard_squeeze_pressed_max")},G.grip.minX=G.grip.position.x,z.thumbstick=W.getObjectByName("thumbstick"),G.thumbstick=W.getObjectByName("xr_standard_thumbstick_pressed_value"),te.thumbstick={min:W.getObjectByName("xr_standard_thumbstick_pressed_min"),max:W.getObjectByName("xr_standard_thumbstick_pressed_max")},G.thumbstickXAxis=W.getObjectByName("xr_standard_thumbstick_xaxis_pressed_value"),te.thumbstickXAxis={min:W.getObjectByName("xr_standard_thumbstick_xaxis_pressed_min"),max:W.getObjectByName("xr_standard_thumbstick_xaxis_pressed_max")},G.thumbstickYAxis=W.getObjectByName("xr_standard_thumbstick_yaxis_pressed_value"),te.thumbstickYAxis={min:W.getObjectByName("xr_standard_thumbstick_yaxis_pressed_min"),max:W.getObjectByName("xr_standard_thumbstick_yaxis_pressed_max")},z.trigger=W.getObjectByName("trigger"),G.trigger=W.getObjectByName("xr_standard_trigger_pressed_value"),te.trigger={min:W.getObjectByName("xr_standard_trigger_pressed_min"),max:W.getObjectByName("xr_standard_trigger_pressed_max")},te.trigger.diff={x:Math.abs(te.trigger.max.rotation.x)-Math.abs(te.trigger.min.rotation.x),y:Math.abs(te.trigger.max.rotation.y)-Math.abs(te.trigger.min.rotation.y),z:Math.abs(te.trigger.max.rotation.z)-Math.abs(te.trigger.min.rotation.z)};var Y=this.data.hand==="left"?"x":"a",se=this.data.hand==="left"?"y":"b",ve=Y+"button",Ae=se+"button";z[ve]=W.getObjectByName(Y+"_button"),G[ve]=W.getObjectByName(Y+"_button_pressed_value"),te[ve]={min:W.getObjectByName(Y+"_button_pressed_min"),max:W.getObjectByName(Y+"_button_pressed_max")},z[Ae]=W.getObjectByName(se+"_button"),G[Ae]=W.getObjectByName(se+"_button_pressed_value"),te[Ae]={min:W.getObjectByName(se+"_button_pressed_min"),max:W.getObjectByName(se+"_button_pressed_max")}},onAxisMoved:function(Q){m(this,this.mapping[this.data.hand].axes,Q)},onThumbstickMoved:function(Q){if(!(!this.buttonMeshes||!this.buttonMeshes.thumbstick)){if(this.isTouchV3orPROorPlus){this.updateThumbstickTouchV3orPROorPlus(Q);return}for(var W in Q.detail)this.buttonObjects.thumbstick.rotation[this.axisMap[W]]=this.buttonRanges.thumbstick.originalRotation[this.axisMap[W]]-Math.PI/8*Q.detail[W]*(W==="y"||this.data.hand==="right"?-1:1)}},axisMap:{y:"x",x:"z"},updateThumbstickTouchV3orPROorPlus:function(Q){var W=(Q.detail.x+1)/2;this.buttonObjects.thumbstickXAxis.quaternion.slerpQuaternions(this.buttonRanges.thumbstickXAxis.min.quaternion,this.buttonRanges.thumbstickXAxis.max.quaternion,W);var G=(Q.detail.y+1)/2;this.buttonObjects.thumbstickYAxis.quaternion.slerpQuaternions(this.buttonRanges.thumbstickYAxis.min.quaternion,this.buttonRanges.thumbstickYAxis.max.quaternion,G)},updateModel:function(Q,W){this.data.model&&this.updateButtonModel(Q,W)},updateButtonModel:function(Q,W){var G=this.buttonMeshes,z,te;G&&G[Q]&&(te=W==="up"||W==="touchend"?G[Q].originalColor||this.data.buttonColor:W==="touchstart"?this.data.buttonTouchColor:this.data.buttonHighlightColor,z=G[Q],z.material.color.set(te))}});function j(Q){Q.traverse(function(W){var G;W.type==="Mesh"&&(G=W.material.clone(),Q.originalColor=W.material.color,W.material.dispose(),W.material=G)})}},"./src/components/pico-controls.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/lib/three.js"),f=c("./src/utils/tracked-controls.js"),g=f.checkControllerPresentAndSetup,m=f.emitIfAxesChanged,y=f.onButtonEvent,b="pico-4",v=c("./src/constants/index.js").AFRAME_CDN_ROOT,_=v+"controllers/pico/pico4/",T={left:{axes:{touchpad:[2,3]},buttons:["trigger","squeeze","none","thumbstick","xbutton","ybutton"]},right:{axes:{touchpad:[2,3]},buttons:["trigger","squeeze","none","thumbstick","abutton","bbutton"]}};l.exports.Component=h("pico-controls",{schema:{hand:{default:"none"},model:{default:!0},orientationOffset:{type:"vec3"}},mapping:T,init:function(){var E=this;this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(C){y(C.detail.id,"down",E,E.data.hand)},this.onButtonUp=function(C){y(C.detail.id,"up",E,E.data.hand)},this.onButtonTouchEnd=function(C){y(C.detail.id,"touchend",E,E.data.hand)},this.onButtonTouchStart=function(C){y(C.detail.id,"touchstart",E,E.data.hand)},this.bindMethods()},update:function(){var E=this.data;this.controllerIndex=E.hand==="right"?0:E.hand==="left"?1:2},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},addEventListeners:function(){var E=this.el;E.addEventListener("buttonchanged",this.onButtonChanged),E.addEventListener("buttondown",this.onButtonDown),E.addEventListener("buttonup",this.onButtonUp),E.addEventListener("touchstart",this.onButtonTouchStart),E.addEventListener("touchend",this.onButtonTouchEnd),E.addEventListener("axismove",this.onAxisMoved),E.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var E=this.el;E.removeEventListener("buttonchanged",this.onButtonChanged),E.removeEventListener("buttondown",this.onButtonDown),E.removeEventListener("buttonup",this.onButtonUp),E.removeEventListener("touchstart",this.onButtonTouchStart),E.removeEventListener("touchend",this.onButtonTouchEnd),E.removeEventListener("axismove",this.onAxisMoved),E.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var E=this.data;g(this,b,{index:this.controllerIndex,hand:E.hand})},injectTrackedControls:function(){var E=this.el,C=this.data;E.setAttribute("tracked-controls",{idPrefix:b,hand:C.hand,controller:this.controllerIndex,orientationOffset:C.orientationOffset}),this.data.model&&this.el.setAttribute("gltf-model",_+this.data.hand+".glb")},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(E){var C=this.mapping[this.data.hand].buttons[E.detail.id],R;C&&(C==="trigger"&&(R=E.detail.state.value,console.log("analog value of trigger press: "+R)),this.el.emit(C+"changed",E.detail.state))},onModelLoaded:function(E){E.target!==this.el||!this.data.model||this.el.emit("controllermodelready",{name:"pico-controls",model:this.data.model,rayOrigin:new p.Vector3(0,0,0)})},onAxisMoved:function(E){m(this,this.mapping.axes,E)}})},"./src/components/position.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent;l.exports.Component=h("position",{schema:{type:"vec3"},update:function(){var p=this.el.object3D,f=this.data;p.position.set(f.x,f.y,f.z)},remove:function(){this.el.object3D.position.set(0,0,0)}})},"./src/components/raycaster.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/lib/three.js"),f=c("./src/utils/index.js"),g=f.debug("components:raycaster:warn"),m=/^[\w\s-.,[\]#]*$/,y={childList:!0,attributes:!0,subtree:!0},b={INTERSECT:"raycaster-intersected",INTERSECTION:"raycaster-intersection",INTERSECT_CLEAR:"raycaster-intersected-cleared",INTERSECTION_CLEAR:"raycaster-intersection-cleared",INTERSECTION_CLOSEST_ENTITY_CHANGED:"raycaster-closest-entity-changed"};l.exports.Component=h("raycaster",{schema:{autoRefresh:{default:!0},direction:{type:"vec3",default:{x:0,y:0,z:-1}},enabled:{default:!0},far:{default:1e3},interval:{default:0},near:{default:0},objects:{default:""},origin:{type:"vec3"},showLine:{default:!1},lineColor:{default:"white"},lineOpacity:{default:1},useWorldCoordinates:{default:!1}},multiple:!0,init:function(){this.clearedIntersectedEls=[],this.unitLineEndVec3=new p.Vector3,this.intersectedEls=[],this.intersections=[],this.newIntersectedEls=[],this.newIntersections=[],this.objects=[],this.prevCheckTime=void 0,this.prevIntersectedEls=[],this.rawIntersections=[],this.raycaster=new p.Raycaster,this.updateOriginDirection(),this.setDirty=this.setDirty.bind(this),this.updateLine=this.updateLine.bind(this),this.observer=new MutationObserver(this.setDirty),this.dirty=!0,this.lineEndVec3=new p.Vector3,this.otherLineEndVec3=new p.Vector3,this.lineData={end:this.lineEndVec3},this.getIntersection=this.getIntersection.bind(this),this.intersectedDetail={el:this.el,getIntersection:this.getIntersection},this.intersectedClearedDetail={el:this.el},this.intersectionClearedDetail={clearedEls:this.clearedIntersectedEls},this.intersectionDetail={}},update:function(_){var T=this.data,E=this.el,C=this.raycaster;C.far=T.far,C.near=T.near,T.showLine&&(T.far!==_.far||T.origin!==_.origin||T.direction!==_.direction||!_.showLine)&&(this.unitLineEndVec3.copy(T.direction).normalize(),this.drawLine()),!T.showLine&&_.showLine&&E.removeAttribute("line"),T.objects!==_.objects&&!m.test(T.objects)&&g('[raycaster] Selector "'+T.objects+'" may not update automatically with DOM changes.'),T.objects||g('[raycaster] For performance, please define raycaster.objects when using raycaster or cursor components to whitelist which entities to intersect with. e.g., raycaster="objects: [data-raycastable]".'),T.autoRefresh!==_.autoRefresh&&E.isPlaying&&(T.autoRefresh?this.addEventListeners():this.removeEventListeners()),_.enabled&&!T.enabled&&this.clearAllIntersections(),this.setDirty()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners()},remove:function(){this.data.showLine&&this.el.removeAttribute("line"),this.clearAllIntersections()},addEventListeners:function(){this.data.autoRefresh&&(this.observer.observe(this.el.sceneEl,y),this.el.sceneEl.addEventListener("object3dset",this.setDirty),this.el.sceneEl.addEventListener("object3dremove",this.setDirty))},removeEventListeners:function(){this.observer.disconnect(),this.el.sceneEl.removeEventListener("object3dset",this.setDirty),this.el.sceneEl.removeEventListener("object3dremove",this.setDirty)},setDirty:function(){this.dirty=!0},refreshObjects:function(){var _=this.data,T;T=_.objects?this.el.sceneEl.querySelectorAll(_.objects):this.el.sceneEl.querySelectorAll("*"),this.objects=this.flattenObject3DMaps(T),this.dirty=!1},tock:function(_){var T=this.data,E=this.prevCheckTime;T.enabled&&(E&&_-E<T.interval||(this.prevCheckTime=_,this.checkIntersections()))},checkIntersections:function(){var _=this.clearedIntersectedEls,T=this.el,E=this.data,C,R=this.intersectedEls,B,I=this.intersections,N=this.newIntersectedEls,D=this.newIntersections,P=this.prevIntersectedEls,k=this.rawIntersections;for(this.dirty&&this.refreshObjects(),v(this.prevIntersectedEls,this.intersectedEls),this.updateOriginDirection(),k.length=0,this.raycaster.intersectObjects(this.objects,!0,k),I.length=0,R.length=0,C=0;C<k.length;C++)B=k[C],!(E.showLine&&B.object===T.getObject3D("line"))&&B.object.el&&(I.push(B),R.push(B.object.el));for(D.length=0,N.length=0,C=0;C<I.length;C++)P.indexOf(I[C].object.el)===-1&&(D.push(I[C]),N.push(I[C].object.el));for(_.length=0,C=0;C<P.length;C++)R.indexOf(P[C])===-1&&(P[C].emit(b.INTERSECT_CLEAR,this.intersectedClearedDetail),_.push(P[C]));for(_.length&&T.emit(b.INTERSECTION_CLEAR,this.intersectionClearedDetail),C=0;C<N.length;C++)N[C].emit(b.INTERSECT,this.intersectedDetail);D.length&&(this.intersectionDetail.els=N,this.intersectionDetail.intersections=D,T.emit(b.INTERSECTION,this.intersectionDetail)),(P.length===0&&I.length>0||P.length>0&&I.length===0||P.length&&I.length&&P[0]!==I[0].object.el)&&(this.intersectionDetail.els=this.intersectedEls,this.intersectionDetail.intersections=I,T.emit(b.INTERSECTION_CLOSEST_ENTITY_CHANGED,this.intersectionDetail)),E.showLine&&setTimeout(this.updateLine)},updateLine:function(){var _=this.el,T=this.intersections,E;T.length&&(T[0].object.el===_&&T[1]?E=T[1].distance:E=T[0].distance),this.drawLine(E)},getIntersection:function(_){var T,E;for(T=0;T<this.intersections.length;T++)if(E=this.intersections[T],E.object.el===_)return E;return null},updateOriginDirection:function(){var _=new p.Vector3,T=new p.Vector3;return function(){var E=this.el,C=this.data;if(C.useWorldCoordinates){this.raycaster.set(C.origin,C.direction);return}E.object3D.updateMatrixWorld(),T.setFromMatrixPosition(E.object3D.matrixWorld),(C.origin.x!==0||C.origin.y!==0||C.origin.z!==0)&&(T=E.object3D.localToWorld(T.copy(C.origin))),_.copy(C.direction).transformDirection(E.object3D.matrixWorld).normalize(),this.raycaster.set(T,_)}}(),drawLine:function(_){var T=this.data,E=this.el,C;C=this.lineData.end===this.lineEndVec3?this.otherLineEndVec3:this.lineEndVec3,_===void 0&&(_=T.far===1/0?1e3:T.far),this.lineData.start=T.origin,this.lineData.end=C.copy(this.unitLineEndVec3).multiplyScalar(_).add(T.origin),this.lineData.color=T.lineColor,this.lineData.opacity=T.lineOpacity,E.setAttribute("line",this.lineData)},flattenObject3DMaps:function(_){var T,E,C=this.objects,R=this.el.sceneEl.object3D;function B(N){return N.parent?B(N.parent):N===R}for(C.length=0,E=0;E<_.length;E++){var I=_[E];if(I.isEntity&&I.object3D&&B(I.object3D))for(T in I.object3DMap)C.push(I.getObject3D(T))}return C},clearAllIntersections:function(){var _;for(_=0;_<this.intersectedEls.length;_++)this.intersectedEls[_].emit(b.INTERSECT_CLEAR,this.intersectedClearedDetail);v(this.clearedIntersectedEls,this.intersectedEls),this.intersectedEls.length=0,this.intersections.length=0,this.el.emit(b.INTERSECTION_CLEAR,this.intersectionClearedDetail)}});function v(_,T){var E;for(_.length=T.length,E=0;E<T.length;E++)_[E]=T[E]}},"./src/components/rotation.js":(l,u,c)=>{var h=c("./src/lib/three.js").MathUtils.degToRad,p=c("./src/core/component.js").registerComponent;l.exports.Component=p("rotation",{schema:{type:"vec3"},update:function(){var f=this.data,g=this.el.object3D;g.rotation.set(h(f.x),h(f.y),h(f.z),"YXZ")},remove:function(){this.el.object3D.rotation.set(0,0,0)}})},"./src/components/scale.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent;l.exports.Component=h("scale",{schema:{type:"vec3",default:{x:1,y:1,z:1}},update:function(){var p=this.data,f=this.el.object3D;f.scale.set(p.x,p.y,p.z)},remove:function(){this.el.object3D.scale.set(1,1,1)}})},"./src/components/scene/ar-hit-test.js":(l,u,c)=>{var h="data:image/webp;base64,UklGRkQHAABXRUJQVlA4WAoAAAAQAAAA/wEA/wEAQUxQSL0DAAARDzD/ERGCjrY9sYYFfgo6aa1kJ7K0w9Lo3AadLSVeFxevQwj5kuM8RfR/Atw/C0+ozB/oUBrloFZs6ElSW88j1KA4yExNWQaqRZquIDF0JYmlq0hAuUDTFu66tng3teW7pa3cQf1V1edvur54M/Slm6Wv3Gx9zw0MXlQLntcsBN6wkHjTQuYtC4W3LTw8mGRVG57TbAROtxHfZNhInGkjc5aNwtk2Hg6Mvki14k+NkZzCwQgCxalcAv3kddRTPI1DcUrXId1FLf1uHpzaQz4tquhZVLlKesbVpqKeTj0n0F5PpXDlFN9UqmhalL/ImuZFo6KmToWLoKlddMprqlS8cKovBvHo2kTiFV2LN4msaxKZl3QNiair8xYRdDWivIvXVXmbcMqJ51UebZuFXxZt6xd4laxtciqRtA3Cv0nU1t+kEUFbI8JvCa+tvkm3FDlO/W+OR99+kWEp/YYo+tYfTVnf/K8cE/F///3vv//993eeL+a+uvjawLcX3xjYvJotBFY3kVjTRGFtE+BU2AiMbiQyhpHMWEYeBozAH5qNBYRDB5KBCaTDBKKBAZTDBoKBDjwHAN5ABeCJBsAZcAAC0YHHxAYSMYBiYgGZWEA2MYFCbCCZGAAIANFEB+AnYgMQTDQAYSJ2AN5EBZAm4gDgTDgAeSIu4DGygTIRN1CMLOCZiACykQlg4jsAycgA8AO+BxCNdJyDkcbwRirDGXGnx8w+FDPrkM3MQ9JQZMYhiiwV/RDMtIM3U1/DmXHUo+IR2kSR2ToWkQ1NIn2qf2J8LCqJKiDUiSADHY3whirhdHgZ94HKaR97PhE+twEUJUFoAcgyTct8hfSxSkShASDKdMJ/ritKHwgyQ0sD4D/miCxU5SbhOOUDTnZpccCjYP/i0bZ/8bAgtVGEoGapWIQXyzKVKLwgNJFk2rtMIgoNRJlOZF7SNSSyUEeQmbxBFKEmtYjEe8S8zOZ1AkJVCmS88FJOtF40Ksg4oUaFiygk3C8qlTVNyl8UTevCUdAE2t14PfVqU1FPp57TopKeQZWromddTQp6QOfTOEQt/ZDuipZ11w/wOiqO8dRORcc6BQEkDQMClaHcn5wV9yLbxsNZNgpn2sicYSNxuo34Js1G4FQbnuNsOPa28PCWhcKbFjJvWEi8ZiHwqgXPcxbc5db33Cx95WboSzddX7yp+vyN0+eul7ZyN7Xlu64t3jVt4c5pc4JLV5EYupJE0xUknC4nOjVlmaYpyLit53HCQ0+ScnqceNcS5dzUkd0/CwMAVlA4IGADAAAQXwCdASoAAgACP8ne6Wy/tjCpqJ/IA/A5CWlu4XYBG/Pz8AfwD8APz//f3v8E1fuHZnxKYACtfuHZnxKYACrYTb5mOslhxu843ecbvON3nG7zjd3a0VCn7G1MABVxwH/Xd25gAK1+4dmfEpe2+PHhQaj75++riG6FuYACtfuHZnxKYACRrK3q9xO8Ss3uWKnMhs/rDF1hi6wxdYYusMXWGI5QRcCFDZog5OgqNlse1NDuz/UoFa/cOzPiUwAEsAOK4/nu5eZHK2tlXxJfNYlMABWv3Dsz4bvNJ5YA/LtxJ38SmAArX7h2Z8Sk5vdZUYv7mZPiUwAFa/cOzPh21s5OgZxf1mfEpemRyFr/rM+JS9noA/LtxJ38SmAAlUJIotzAASn6TjdhK+D3Dsz4dyvB7h2Z8O2tnJ0DOL+sz4lL2nKLT4lL/+iSLOocxq639w7M34MNZdm55uJ8v8ra2cpVZnxKTq2F3PN/cNksAfl24k7+JTAASqrD37h2Z7b1W+VtbOUqsz4lJ1bC7nm/uGyWAPy7cSd/EpgAJVVh79w7M9t6rfK2tnKVWZ8Sk6thdzzf3DZLAH5duJO/iUwAEqqw9+4dme29VvlbWzlKrM+JSdWwu55v7hslgD8u3EnfxKYACVVYe/cOzPbeq3ytrZylVme0kYJ8557FLerqFrzIbPrrf3DZLAH5duJO/iUvaVMS9BoaF4p7pSDFTP1XMyfElelrM0DOL+sz4eBJ13nV1OppBGPuKb4YzXQgq9uH19uS/0+JS9t9fr6ZUlQBelDG6GMgq97otb5QMPJwtKyBTbFp8Sl7b6/X0ykkawEOsgdiE6Fi0vb/Eve6xkwsmug0Z4nGNHQO8839bpTsjpz7SWIJxKagvd1QWMa6FYT1KEw3j4XDT6vJ9Xk+nyfT5Pq8n1eEmk5dinMM/9Fcfz4Z3Dsz3KD2dw7LxBRxKrqUUGQPH/7zxr1KIfNpLEJ0MZB2ITM/0Z2EFoh12NlXnEcpYcbvON3nG7zjd5xu84vfcNIAAP7+y8ceyzbVxkakPYY4lcr72fqOnDwipv+yxC71wAADBrjKnAAAAAAAAAAAAAAw7oNGHttqWONcoFN/2WIDc2pa6WVFtFYROlsaMaTXdcOjXHz93+YxAglKa4AAAAA=",p=c("./src/core/component.js").registerComponent,f=c("./src/lib/three.js"),g=21,m=function(){var _=new f.Quaternion,T=new f.Vector3;function E(C,R,B){R.position.copy(C.transform.position),R.quaternion.copy(C.transform.orientation),T.copy(B),_.copy(C.transform.orientation),T.applyQuaternion(_),R.position.sub(T)}return E}();m.tempFakePose={transform:{orientation:new f.Quaternion,position:new f.Vector3}};function y(_,T){this.renderer=_,this.xrHitTestSource=null,_.xr.addEventListener("sessionend",(function(){this.xrHitTestSource=null}).bind(this)),_.xr.addEventListener("sessionstart",(function(){this.sessionStart(T)}).bind(this)),this.renderer.xr.isPresenting&&this.sessionStart(T)}y.prototype.previousFrameAnchors=new Set,y.prototype.anchorToObject3D=new Map;function b(_){console.warn(_.message),console.warn('Cannot requestHitTestSource Are you missing: webxr="optionalFeatures: hit-test;" from <a-scene>?')}y.prototype.sessionStart=function(_){if(this.session=this.renderer.xr.getSession(),!("requestHitTestSource"in this.session)){b({message:"No requestHitTestSource on the session."});return}_.space?this.session.requestHitTestSource(_).then((function(T){this.xrHitTestSource=T}).bind(this)).catch(b):_.profile&&this.session.requestHitTestSourceForTransientInput(_).then((function(T){this.xrHitTestSource=T,this.transient=!0}).bind(this)).catch(b)},y.prototype.anchorFromLastHitTestResult=function(_,T){var E=this.lastHitTest;if(E){var C={object3D:_,offset:T};Array.from(this.anchorToObject3D.entries()).forEach((function(R){var B=R[1].object3D,I=R[0];B===_&&(this.anchorToObject3D.delete(I),I.delete())}).bind(this)),E.createAnchor&&E.createAnchor().then((function(R){this.anchorToObject3D.set(R,C)}).bind(this)).catch(function(R){console.warn(R.message),console.warn('Cannot create anchor, are you missing: webxr="optionalFeatures: anchors;" from <a-scene>?')})}},y.prototype.doHit=function(_){if(this.renderer.xr.isPresenting){var T=this.renderer.xr.getReferenceSpace(),E=_.getViewerPose(T),C,R;if(this.xrHitTestSource&&E)return this.transient?(C=_.getHitTestResultsForTransientInput(this.xrHitTestSource),C.length>0?(R=C[0].results,R.length>0?(this.lastHitTest=R[0],R[0].getPose(T)):!1):!1):(C=_.getHitTestResults(this.xrHitTestSource),C.length>0?(this.lastHitTest=C[0],C[0].getPose(T)):!1)}},y.updateAnchorPoses=function(_,T){var E=_.trackedAnchors||y.prototype.previousFrameAnchors;y.prototype.previousFrameAnchors.forEach(function(C){E.has(C)||y.prototype.anchorToObject3D.delete(C)}),E.forEach(function(C){var R,B,I,N;try{R=_.getPose(C.anchorSpace,T)}catch{}if(R){if(B=y.prototype.anchorToObject3D.get(C),!B)return;I=B.offset,N=B.object3D,m(R,N,I)}})};var v;l.exports.Component=p("ar-hit-test",{schema:{target:{type:"selector"},enabled:{default:!0},src:{default:h,type:"map"},type:{default:"footprint",oneOf:["footprint","map"]},footprintDepth:{default:.1},mapSize:{type:"vec2",default:{x:.5,y:.5}}},sceneOnly:!0,init:function(){this.hitTest=null,this.imageDataArray=new Uint8ClampedArray(1048576),this.imageData=new ImageData(this.imageDataArray,512,512),this.textureCache=new Map,this.orthoCam=new f.OrthographicCamera,this.orthoCam.layers.set(g),this.textureTarget=new f.WebGLRenderTarget(512,512,{}),this.basicMaterial=new f.MeshBasicMaterial({color:0,side:f.DoubleSide}),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.context.imageSmoothingEnabled=!1,this.canvas.width=512,this.canvas.height=512,this.canvasTexture=new f.CanvasTexture(this.canvas,{alpha:!0}),this.canvasTexture.flipY=!1;var _=this.el.getAttribute("webxr"),T=_.optionalFeatures;(!T.includes("hit-test")||!T.includes("anchors"))&&(T.push("hit-test"),T.push("anchors"),this.el.setAttribute("webxr",_)),this.el.sceneEl.renderer.xr.addEventListener("sessionend",(function(){this.hitTest=null}).bind(this)),this.el.sceneEl.renderer.xr.addEventListener("sessionstart",(function(){if(this.el.is("ar-mode")){var E=this.el.sceneEl.renderer,C=this.session=E.xr.getSession();this.hasPosedOnce=!1,this.bboxMesh.visible=!1,v||(v=new Map),C.requestReferenceSpace("viewer").then((function(I){this.hitTest=new y(E,{space:I}),v.set(I,this.hitTest),this.el.emit("ar-hit-test-start")}).bind(this));var R="generic-touchscreen",B=new y(E,{profile:R});C.addEventListener("selectstart",(function(I){if(this.data.enabled===!0){var N=I.inputSource;this.bboxMesh.visible=!0,this.hasPosedOnce===!0&&(this.el.emit("ar-hit-test-select-start",{inputSource:N,position:this.bboxMesh.position,orientation:this.bboxMesh.quaternion}),N.profiles[0]===R?this.hitTest=B:(this.hitTest=v.get(N)||new y(E,{space:N.targetRaySpace}),v.set(N,this.hitTest)))}}).bind(this)),C.addEventListener("selectend",(function(I){if(!this.hitTest||this.data.enabled!==!0){this.hitTest=null;return}var N=I.inputSource,D;this.hasPosedOnce===!0&&(this.bboxMesh.visible=!1,this.data.target&&(D=this.data.target.object3D,D&&(m.tempFakePose.transform.position.copy(this.bboxMesh.position),m.tempFakePose.transform.orientation.copy(this.bboxMesh.quaternion),m(m.tempFakePose,D,this.bboxOffset),D.visible=!0,this.hitTest.anchorFromLastHitTestResult(D,this.bboxOffset))),this.el.emit("ar-hit-test-select",{inputSource:N,position:this.bboxMesh.position,orientation:this.bboxMesh.quaternion})),this.hitTest=null}).bind(this))}}).bind(this)),this.bboxOffset=new f.Vector3,this.update=this.update.bind(this),this.makeBBox()},update:function(){this.data.enabled===!1&&(this.hitTest=null,this.bboxMesh.visible=!1),this.data.target&&(this.data.target.object3D?(this.data.target.addEventListener("model-loaded",this.update),this.data.target.object3D.layers.enable(g),this.data.target.object3D.traverse(function(_){_.layers.enable(g)})):this.data.target.addEventListener("loaded",this.update,{once:!0})),this.bboxNeedsUpdate=!0},makeBBox:function(){var _=new f.PlaneGeometry(1,1),T=new f.MeshBasicMaterial({transparent:!0,color:16777215});_.rotateX(-Math.PI/2),_.rotateY(-Math.PI/2),this.bbox=new f.Box3,this.bboxMesh=new f.Mesh(_,T),this.el.setObject3D("ar-hit-test",this.bboxMesh),this.bboxMesh.visible=!1},updateFootprint:function(){var _,T=this.el.sceneEl.renderer,E,C,R=T.xr.enabled;this.bboxMesh.material.map=this.canvasTexture,this.bboxMesh.material.needsUpdate=!0,this.orthoCam.rotation.set(-Math.PI/2,0,-Math.PI/2),this.orthoCam.position.copy(this.bboxMesh.position),this.orthoCam.position.y-=this.bboxMesh.scale.y/2,this.orthoCam.near=.1,this.orthoCam.far=this.orthoCam.near+this.data.footprintDepth*this.bboxMesh.scale.y,this.orthoCam.position.y+=this.orthoCam.far,this.orthoCam.right=this.bboxMesh.scale.z/2,this.orthoCam.left=-this.bboxMesh.scale.z/2,this.orthoCam.top=this.bboxMesh.scale.x/2,this.orthoCam.bottom=-this.bboxMesh.scale.x/2,this.orthoCam.updateProjectionMatrix(),E=T.getRenderTarget(),T.setRenderTarget(this.textureTarget),T.xr.enabled=!1,C=this.el.object3D.background,this.el.object3D.overrideMaterial=this.basicMaterial,this.el.object3D.background=null,T.render(this.el.object3D,this.orthoCam),this.el.object3D.background=C,this.el.object3D.overrideMaterial=null,T.xr.enabled=R,T.setRenderTarget(E),T.readRenderTargetPixels(this.textureTarget,0,0,512,512,this.imageDataArray),this.context.putImageData(this.imageData,0,0),this.context.shadowColor="white",this.context.shadowBlur=10,this.context.drawImage(this.canvas,0,0),_=this.context.getImageData(0,0,512,512);for(var B=0;B<262144;B++)_.data[B*4+3]!==0&&_.data[B*4+3]!==255&&(_.data[B*4+3]=128);this.context.putImageData(_,0,0),this.canvasTexture.needsUpdate=!0},tick:function(){var _,T=this.el.sceneEl.frame,E=this.el.sceneEl.renderer;if(T&&y.updateAnchorPoses(T,E.xr.getReferenceSpace()),this.bboxNeedsUpdate){if(this.bboxNeedsUpdate=!1,!this.data.target||this.data.type==="map"){var C;this.textureCache.has(this.data.src)?C=this.textureCache.get(this.data.src):(C=new f.TextureLoader().load(this.data.src),this.textureCache.set(this.data.src,C)),this.bboxMesh.material.map=C,this.bboxMesh.material.needsUpdate=!0}this.data.target&&this.data.target.object3D?(this.bbox.setFromObject(this.data.target.object3D),this.bbox.getCenter(this.bboxMesh.position),this.bbox.getSize(this.bboxMesh.scale),this.data.type==="footprint"&&(this.bboxMesh.scale.x*=1.04,this.bboxMesh.scale.z*=1.04,this.updateFootprint()),this.bboxMesh.position.y-=this.bboxMesh.scale.y/2,this.bboxOffset.copy(this.bboxMesh.position),this.bboxOffset.sub(this.data.target.object3D.position)):this.bboxMesh.scale.set(this.data.mapSize.x,1,this.data.mapSize.y)}this.hitTest&&(_=this.hitTest.doHit(T),_&&(this.hasPosedOnce!==!0&&(this.hasPosedOnce=!0,this.el.emit("ar-hit-test-achieved")),this.bboxMesh.visible=!0,this.bboxMesh.position.copy(_.transform.position),this.bboxMesh.quaternion.copy(_.transform.orientation)))}})},"./src/components/scene/background.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent;l.exports.Component=h("background",{schema:{color:{type:"color",default:"black"},transparent:{default:!1}},sceneOnly:!0,update:function(){var p=this.data,f=this.el.object3D;p.transparent?f.background=null:f.background=new THREE.Color(p.color)},remove:function(){var p=this.el.object3D;p.background=null}})},"./src/components/scene/debug.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent;l.exports.Component=h("debug",{schema:{default:!0},sceneOnly:!0})},"./src/components/scene/device-orientation-permission-ui.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/constants/index.js"),f="a-modal",g="a-dialog",m="a-dialog-text",y="a-dialog-text-container",b="a-dialog-buttons-container",v="a-dialog-button",_="a-dialog-allow-button",T="a-dialog-deny-button",E="a-dialog-ok-button";l.exports.Component=h("device-orientation-permission-ui",{schema:{enabled:{default:!0},deviceMotionMessage:{default:"This immersive website requires access to your device motion sensors."},httpsMessage:{default:"Access this site over HTTPS to enter VR mode and grant access to the device sensors."},denyButtonText:{default:"Deny"},allowButtonText:{default:"Allow"},cancelButtonText:{default:"Cancel"}},sceneOnly:!0,init:function(){var I=this;if(this.data.enabled){if(window.isSecureContext||this.showHTTPAlert(),typeof DeviceOrientationEvent>"u"||!DeviceOrientationEvent.requestPermission){this.permissionGranted=!0;return}this.onDeviceMotionDialogAllowClicked=this.onDeviceMotionDialogAllowClicked.bind(this),this.onDeviceMotionDialogDenyClicked=this.onDeviceMotionDialogDenyClicked.bind(this),DeviceOrientationEvent.requestPermission().then(function(){I.el.emit("deviceorientationpermissiongranted"),I.permissionGranted=!0}).catch(function(){I.devicePermissionDialogEl=C(I.data.denyButtonText,I.data.allowButtonText,I.data.deviceMotionMessage,I.onDeviceMotionDialogAllowClicked,I.onDeviceMotionDialogDenyClicked),I.el.appendChild(I.devicePermissionDialogEl)})}},remove:function(){this.devicePermissionDialogEl&&this.el.removeChild(this.devicePermissionDialogEl)},onDeviceMotionDialogDenyClicked:function(){this.remove()},showHTTPAlert:function(){var I=this,N=R(I.data.cancelButtonText,I.data.httpsMessage,function(){I.el.removeChild(N)});this.el.appendChild(N)},onDeviceMotionDialogAllowClicked:function(){var I=this;this.el.emit("deviceorientationpermissionrequested"),DeviceOrientationEvent.requestPermission().then(function(N){N==="granted"?(I.el.emit("deviceorientationpermissiongranted"),I.permissionGranted=!0):I.el.emit("deviceorientationpermissionrejected"),I.remove()}).catch(console.error)}});function C(I,N,D,P,k){var q,V,j;return q=document.createElement("div"),q.classList.add(b),V=document.createElement("button"),V.classList.add(v,T),V.setAttribute(p.AFRAME_INJECTED,""),V.innerHTML=I,q.appendChild(V),j=document.createElement("button"),j.classList.add(v,_),j.setAttribute(p.AFRAME_INJECTED,""),j.innerHTML=N,q.appendChild(j),j.addEventListener("click",function(Q){Q.stopPropagation(),P()}),V.addEventListener("click",function(Q){Q.stopPropagation(),k()}),B(D,q)}function R(I,N,D){var P,k;return P=document.createElement("div"),P.classList.add(b),k=document.createElement("button"),k.classList.add(v,E),k.setAttribute(p.AFRAME_INJECTED,""),k.innerHTML=I,P.appendChild(k),k.addEventListener("click",function(q){q.stopPropagation(),D()}),B(N,P)}function B(I,N){var D,P,k,q;return D=document.createElement("div"),D.classList.add(f),D.setAttribute(p.AFRAME_INJECTED,""),P=document.createElement("div"),P.className=g,P.setAttribute(p.AFRAME_INJECTED,""),D.appendChild(P),k=document.createElement("div"),k.classList.add(y),P.appendChild(k),q=document.createElement("div"),q.classList.add(m),q.innerHTML=I,k.appendChild(q),P.appendChild(N),D}},"./src/components/scene/embedded.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent;l.exports.Component=h("embedded",{dependencies:["xr-mode-ui"],schema:{default:!0},sceneOnly:!0,update:function(){var p=this.el,f=p.querySelector(".a-enter-vr");this.data===!0?(f&&f.classList.add("embedded"),p.removeFullScreenStyles()):(f&&f.classList.remove("embedded"),p.addFullScreenStyles())}})},"./src/components/scene/fog.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/lib/three.js"),f=c("./src/utils/debug.js");f("components:fog:warn"),l.exports.Component=h("fog",{schema:{color:{type:"color",default:"#000"},density:{default:25e-5},far:{default:1e3,min:0},near:{default:1,min:0},type:{default:"linear",oneOf:["linear","exponential"]}},sceneOnly:!0,update:function(){var m=this.data,y=this.el,b=this.el.object3D.fog;if(!b||m.type!==b.name){y.object3D.fog=g(m);return}Object.keys(this.schema).forEach(function(v){var _=m[v];v==="color"&&(_=new p.Color(_)),b[v]=_})},remove:function(){var m=this.el,y=this.el.object3D.fog;y&&(m.object3D.fog=null)}});function g(m){var y;return m.type==="exponential"?y=new p.FogExp2(m.color,m.density):y=new p.Fog(m.color,m.near,m.far),y.name=m.type,y}},"./src/components/scene/inspector.js":(l,u,c)=>{var h=c("./src/constants/index.js").AFRAME_INJECTED,p=c("./package.json"),f=c("./src/core/component.js").registerComponent,g=c("./src/utils/index.js");function m(T){var E=T.split(".");return E[2]="x",E.join(".")}var y="https://unpkg.com/aframe-inspector@"+m(p.version)+"/dist/aframe-inspector.min.js",b=y,v="Loading Inspector",_="Error loading Inspector";l.exports.Component=f("inspector",{schema:{url:{default:b}},sceneOnly:!0,init:function(){this.firstPlay=!0,this.onKeydown=this.onKeydown.bind(this),this.onMessage=this.onMessage.bind(this),this.initOverlay(),window.addEventListener("keydown",this.onKeydown),window.addEventListener("message",this.onMessage)},play:function(){var T;this.firstPlay&&(T=g.getUrlParameter("inspector"),T!=="false"&&T&&(this.openInspector(),this.firstPlay=!1))},initOverlay:function(){var T='<span class="dots"><span>.</span><span>.</span><span>.</span></span>';this.loadingMessageEl=document.createElement("div"),this.loadingMessageEl.classList.add("a-inspector-loader"),this.loadingMessageEl.innerHTML=v+T},remove:function(){this.removeEventListeners()},onKeydown:function(T){var E=T.keyCode===73&&(T.ctrlKey&&T.altKey||T.getModifierState("AltGraph"));E&&this.openInspector()},showLoader:function(){document.body.appendChild(this.loadingMessageEl)},hideLoader:function(){document.body.removeChild(this.loadingMessageEl)},onMessage:function(T){T.data==="INJECT_AFRAME_INSPECTOR"&&this.openInspector()},openInspector:function(T){var E=this,C;if(AFRAME.INSPECTOR||AFRAME.inspectorInjected){AFRAME.INSPECTOR.open(T);return}this.showLoader(),C=document.createElement("script"),C.src=this.data.url,C.setAttribute("data-name","aframe-inspector"),C.setAttribute(h,""),C.onload=function(){AFRAME.INSPECTOR.open(T),E.hideLoader(),E.removeEventListeners()},C.onerror=function(){E.loadingMessageEl.innerHTML=_},document.head.appendChild(C),AFRAME.inspectorInjected=!0},removeEventListeners:function(){window.removeEventListener("keydown",this.onKeydown),window.removeEventListener("message",this.onMessage)}})},"./src/components/scene/keyboard-shortcuts.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/utils/index.js").shouldCaptureKeyEvent;l.exports.Component=h("keyboard-shortcuts",{schema:{enterVR:{default:!0},exitVR:{default:!0}},sceneOnly:!0,init:function(){this.onKeyup=this.onKeyup.bind(this)},update:function(f){var g=this.data;this.enterVREnabled=g.enterVR},play:function(){window.addEventListener("keyup",this.onKeyup,!1)},pause:function(){window.removeEventListener("keyup",this.onKeyup)},onKeyup:function(f){var g=this.el;p(f)&&(this.enterVREnabled&&f.keyCode===70&&g.enterVR(),this.enterVREnabled&&f.keyCode===27&&g.exitVR())}})},"./src/components/scene/pool.js":(l,u,c)=>{var h=c("./src/utils/debug.js"),p=c("./src/core/component.js").registerComponent,f=h("components:pool:warn");l.exports.Component=p("pool",{schema:{container:{default:""},mixin:{default:""},size:{default:0},dynamic:{default:!1}},sceneOnly:!0,multiple:!0,initPool:function(){var g;for(this.availableEls=[],this.usedEls=[],this.data.mixin||f("No mixin provided for pool component."),this.data.container&&(this.container=document.querySelector(this.data.container),this.container||f("Container "+this.data.container+" not found.")),this.container=this.container||this.el,g=0;g<this.data.size;++g)this.createEntity()},update:function(g){var m=this.data;(g.mixin!==m.mixin||g.size!==m.size)&&this.initPool()},createEntity:function(){var g;g=document.createElement("a-entity"),g.play=this.wrapPlay(g.play),g.setAttribute("mixin",this.data.mixin),g.object3D.visible=!1,g.pause(),this.container.appendChild(g),this.availableEls.push(g);var m=this.usedEls;g.addEventListener("loaded",function(){m.indexOf(g)===-1&&(g.object3DParent=g.object3D.parent,g.object3D.parent.remove(g.object3D))})},wrapPlay:function(g){var m=this.usedEls;return function(){m.indexOf(this)!==-1&&g.call(this)}},requestEntity:function(){var g;if(this.availableEls.length===0){if(this.data.dynamic===!1){f("Requested entity from empty pool: "+this.attrName);return}else f("Requested entity from empty pool. This pool is dynamic and will resize automatically. You might want to increase its initial size: "+this.attrName);this.createEntity()}return g=this.availableEls.shift(),this.usedEls.push(g),g.object3DParent&&(g.object3DParent.add(g.object3D),this.updateRaycasters()),g.object3D.visible=!0,g},returnEntity:function(g){var m=this.usedEls.indexOf(g);if(m===-1){f("The returned entity was not previously pooled from "+this.attrName);return}return this.usedEls.splice(m,1),this.availableEls.push(g),g.object3DParent=g.object3D.parent,g.object3D.parent.remove(g.object3D),this.updateRaycasters(),g.object3D.visible=!1,g.pause(),g},updateRaycasters:function(){var g=document.querySelectorAll("[raycaster]");g.forEach(function(m){m.components.raycaster.setDirty()})}})},"./src/components/scene/real-world-meshing.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/lib/three.js");l.exports.Component=h("real-world-meshing",{schema:{filterLabels:{type:"array"},meshesEnabled:{default:!0},meshMixin:{default:!0},planesEnabled:{default:!0},planeMixin:{default:""}},sceneOnly:!0,init:function(){var f=this.el.getAttribute("webxr"),g=f.requiredFeatures;g.indexOf("mesh-detection")===-1&&(g.push("mesh-detection"),this.el.setAttribute("webxr",f)),g.indexOf("plane-detection")===-1&&(g.push("plane-detection"),this.el.setAttribute("webxr",f)),this.meshEntities=[],this.initWorldMeshEntity=this.initWorldMeshEntity.bind(this)},tick:function(){this.el.is("ar-mode")&&(this.detectMeshes(),this.updateMeshes())},detectMeshes:function(){var f=this.data,g,m,y=this.el;y.renderer.xr;var b,v=this.meshEntities,_=!1,T=[],E=this.data.filterLabels;b=y.frame,g=b.detectedMeshes,m=b.detectedPlanes;for(var C=0;C<v.length;C++)v[C].present=!1;if(f.meshesEnabled){for(var R of g.values())if(!(E.length&&E.indexOf(R.semanticLabel)===-1)){for(C=0;C<v.length;C++)if(R===v[C].mesh){_=!0,v[C].present=!0,v[C].lastChangedTime<R.lastChangedTime&&this.updateMeshGeometry(v[C].el,R),v[C].lastChangedTime=R.lastChangedTime;break}_||T.push(R),_=!1}}if(f.planesEnabled){for(R of m.values())if(!(E.length&&E.indexOf(R.semanticLabel)===-1)){for(C=0;C<v.length;C++)if(R===v[C].mesh){_=!0,v[C].present=!0,v[C].lastChangedTime<R.lastChangedTime&&this.updateMeshGeometry(v[C].el,R),v[C].lastChangedTime=R.lastChangedTime;break}_||T.push(R),_=!1}}this.deleteMeshes(),this.createNewMeshes(T)},updateMeshes:function(){var f=new p.Matrix4;return function(){for(var g,m=this.el,y,b=m.frame,v=this.meshEntities,_=m.renderer.xr.getReferenceSpace(),T,E=0;E<v.length;E++)T=v[E].mesh.meshSpace||v[E].mesh.planeSpace,g=b.getPose(T,_),y=v[E].el,y.hasLoaded&&(f.fromArray(g.transform.matrix),f.decompose(y.object3D.position,y.object3D.quaternion,y.object3D.scale))}}(),deleteMeshes:function(){for(var f=this.meshEntities,g=[],m=0;m<f.length;m++)f[m].present?g.push(f[m]):this.el.removeChild(f[m]);this.meshEntities=g},createNewMeshes:function(f){for(var g,m=0;m<f.length;m++)g=document.createElement("a-entity"),this.meshEntities.push({mesh:f[m],el:g}),g.addEventListener("loaded",this.initWorldMeshEntity),this.el.appendChild(g)},initMeshGeometry:function(f){var g,m,y;if(f instanceof XRPlane){m=new p.Shape,y=f.polygon;for(var b=0;b<y.length;++b)b===0?m.moveTo(y[b].x,y[b].z):m.lineTo(y[b].x,y[b].z);return g=new p.ShapeGeometry(m),g.rotateX(Math.PI/2),g}return g=new p.BufferGeometry,g.setAttribute("position",new p.BufferAttribute(f.vertices,3)),g.setIndex(new p.BufferAttribute(f.indices,1)),g},initWorldMeshEntity:function(f){for(var g=f.target,m,y,b,v=this.meshEntities,_=0;_<v.length;_++)if(v[_].el===g){b=v[_];break}m=this.initMeshGeometry(b.mesh),y=new p.Mesh(m,new p.MeshBasicMaterial({color:Math.random()*16777215,side:p.DoubleSide})),g.setObject3D("mesh",y),b.mesh instanceof XRPlane&&this.data.planeMixin?g.setAttribute("mixin",this.data.planeMixin):this.data.meshMixin&&g.setAttribute("mixin",this.data.meshMixin),g.setAttribute("data-world-mesh",b.mesh.semanticLabel)},updateMeshGeometry:function(f,g){var m=f.getObject3D("mesh");m.geometry.dispose(),m.geometry=this.initMeshGeometry(g)}})},"./src/components/scene/reflection.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent;function p(f,g,m,y){var b=Math.max(f.primaryLightIntensity.x,Math.max(f.primaryLightIntensity.y,f.primaryLightIntensity.z));g.sh.fromArray(f.sphericalHarmonicsCoefficients),g.intensity=1,m&&(m.color.setRGB(f.primaryLightIntensity.x/b,f.primaryLightIntensity.y/b,f.primaryLightIntensity.z/b),m.intensity=b,y.copy(f.primaryLightDirection))}l.exports.Component=h("reflection",{schema:{directionalLight:{type:"selector"}},sceneOnly:!0,init:function(){var f=this;this.cubeRenderTarget=new THREE.WebGLCubeRenderTarget(16),this.cubeCamera=new THREE.CubeCamera(.1,1e3,this.cubeRenderTarget),this.lightingEstimationTexture=new THREE.WebGLCubeRenderTarget(16).texture,this.needsVREnvironmentUpdate=!0;var g=this.el.getAttribute("webxr"),m=g.optionalFeatures;m.includes("light-estimation")||(m.push("light-estimation"),this.el.setAttribute("webxr",g)),this.el.addEventListener("enter-vr",function(){if(f.el.is("ar-mode")){var y=f.el.renderer,b=y.xr.getSession();b.requestLightProbe&&f.startLightProbe()}}),this.el.addEventListener("exit-vr",function(){f.xrLightProbe&&f.stopLightProbe()}),this.el.object3D.environment=this.cubeRenderTarget.texture},stopLightProbe:function(){this.xrLightProbe=null,this.probeLight&&(this.probeLight.components.light.light.intensity=0),this.needsVREnvironmentUpdate=!0,this.el.object3D.environment=this.cubeRenderTarget.texture},startLightProbe:function(){this.needsLightProbeUpdate=!0},setupLightProbe:function(){var f=this.el.renderer,g=f.xr.getSession(),m=this,y=f.getContext();if(!this.probeLight){var b=document.createElement("a-light");b.setAttribute("type","probe"),b.setAttribute("intensity",0),this.el.appendChild(b),this.probeLight=b}switch(g.preferredReflectionFormat){case"srgba8":y.getExtension("EXT_sRGB");break;case"rgba16f":y.getExtension("OES_texture_half_float");break}this.glBinding=new XRWebGLBinding(g,y),y.getExtension("EXT_sRGB"),y.getExtension("OES_texture_half_float"),g.requestLightProbe().then(function(v){m.xrLightProbe=v,v.addEventListener("reflectionchange",m.updateXRCubeMap.bind(m))}).catch(function(v){console.warn("Lighting estimation not supported: "+v.message),console.warn('Are you missing: webxr="optionalFeatures: light-estimation;" from <a-scene>?')})},updateXRCubeMap:function(){var f=this.el.renderer,g=this.glBinding.getReflectionCubeMap(this.xrLightProbe);if(g){var m=f.properties.get(this.lightingEstimationTexture);m.__webglTexture=g,this.lightingEstimationTexture.needsPMREMUpdate=!0,this.el.object3D.environment=this.lightingEstimationTexture}},tick:function(){var f=this.el.object3D,g=this.el.renderer,m=this.el.frame;if(m&&this.xrLightProbe){var y=m.getLightEstimate(this.xrLightProbe);y&&p(y,this.probeLight.components.light.light,this.data.directionalLight&&this.data.directionalLight.components.light.light,this.data.directionalLight&&this.data.directionalLight.object3D.position)}this.needsVREnvironmentUpdate&&(f.environment=null,this.needsVREnvironmentUpdate=!1,this.cubeCamera.position.set(0,1.6,0),this.cubeCamera.update(g,f),f.environment=this.cubeRenderTarget.texture),this.needsLightProbeUpdate&&m&&(this.setupLightProbe(),this.needsLightProbeUpdate=!1)},remove:function(){this.el.object3D.environment=null,this.probeLight&&this.el.removeChild(this.probeLight)}})},"./src/components/scene/screenshot.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/lib/three.js"),f=["attribute vec3 position;","attribute vec2 uv;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","varying vec2 vUv;","void main()  {","  vUv = vec2( 1.- uv.x, uv.y );","  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),g=["precision mediump float;","uniform samplerCube map;","varying vec2 vUv;","#define M_PI 3.141592653589793238462643383279","void main() {","  vec2 uv = vUv;","  float longitude = uv.x * 2. * M_PI - M_PI + M_PI / 2.;","  float latitude = uv.y * M_PI;","  vec3 dir = vec3(","    - sin( longitude ) * sin( latitude ),","    cos( latitude ),","    - cos( longitude ) * sin( latitude )","  );","  normalize( dir );","  gl_FragColor = vec4( textureCube( map, dir ).rgb, 1.0 );","}"].join(`
`);l.exports.Component=h("screenshot",{schema:{width:{default:4096},height:{default:2048},camera:{type:"selector"}},sceneOnly:!0,setup:function(){var m=this.el;if(!this.canvas){var y=m.renderer.getContext();y&&(this.cubeMapSize=y.getParameter(y.MAX_CUBE_MAP_TEXTURE_SIZE),this.material=new p.RawShaderMaterial({uniforms:{map:{type:"t",value:null}},vertexShader:f,fragmentShader:g,side:p.DoubleSide}),this.quad=new p.Mesh(new p.PlaneGeometry(1,1),this.material),this.quad.visible=!1,this.camera=new p.OrthographicCamera(-.5,.5,.5,-.5,-1e4,1e4),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),m.object3D.add(this.quad),this.onKeyDown=this.onKeyDown.bind(this))}},getRenderTarget:function(m,y){return new p.WebGLRenderTarget(m,y,{colorSpace:this.el.sceneEl.renderer.outputColorSpace,minFilter:p.LinearFilter,magFilter:p.LinearFilter,wrapS:p.ClampToEdgeWrapping,wrapT:p.ClampToEdgeWrapping,format:p.RGBAFormat,type:p.UnsignedByteType})},resize:function(m,y){this.quad.scale.set(m,y,1),this.camera.left=-1*m/2,this.camera.right=m/2,this.camera.top=y/2,this.camera.bottom=-1*y/2,this.camera.updateProjectionMatrix(),this.canvas.width=m,this.canvas.height=y},play:function(){window.addEventListener("keydown",this.onKeyDown)},onKeyDown:function(m){var y=m.keyCode===83&&m.ctrlKey&&m.altKey;if(!(!this.data||!y)){var b=m.shiftKey?"equirectangular":"perspective";this.capture(b)}},setCapture:function(m){var y=this.el,b,v,_,T;return m==="perspective"?(this.quad.visible=!1,v=this.data.camera&&this.data.camera.components.camera.camera||y.camera,b={width:this.data.width,height:this.data.height}):(v=this.camera,T=new p.WebGLCubeRenderTarget(Math.min(this.cubeMapSize,2048),{format:p.RGBFormat,generateMipmaps:!0,minFilter:p.LinearMipmapLinearFilter,colorSpace:p.SRGBColorSpace}),_=new p.CubeCamera(y.camera.near,y.camera.far,T),y.camera.getWorldPosition(_.position),y.camera.getWorldQuaternion(_.quaternion),_.update(y.renderer,y.object3D),this.quad.material.uniforms.map.value=_.renderTarget.texture,b={width:this.data.width,height:this.data.height},this.quad.visible=!0),{camera:v,size:b,projection:m}},capture:function(m){var y=this.el.renderer.xr.enabled,b=this.el.renderer,v;this.setup(),b.xr.enabled=!1,v=this.setCapture(m),this.renderCapture(v.camera,v.size,v.projection),this.saveCapture(),b.xr.enabled=y},getCanvas:function(m){var y=this.el.renderer.xr.enabled,b=this.el.renderer;this.setup();var v=this.setCapture(m);return b.xr.enabled=!1,this.renderCapture(v.camera,v.size,v.projection),b.xr.enabled=y,this.canvas},renderCapture:function(m,y,b){var v=this.el.renderer.autoClear,_=this.el,T,E,C,R=_.renderer;E=this.getRenderTarget(y.width,y.height),C=new Uint8Array(4*y.width*y.height),this.resize(y.width,y.height),R.autoClear=!0,R.clear(),R.setRenderTarget(E),R.render(_.object3D,m),R.autoClear=v,R.readRenderTargetPixels(E,0,0,y.width,y.height,C),R.setRenderTarget(null),b==="perspective"&&(C=this.flipPixelsVertically(C,y.width,y.height)),T=new ImageData(new Uint8ClampedArray(C),y.width,y.height),this.quad.visible=!1,this.ctx.putImageData(T,0,0)},flipPixelsVertically:function(m,y,b){for(var v=m.slice(0),_=0;_<y;++_)for(var T=0;T<b;++T)v[_*4+T*y*4]=m[_*4+(b-T)*y*4],v[_*4+1+T*y*4]=m[_*4+1+(b-T)*y*4],v[_*4+2+T*y*4]=m[_*4+2+(b-T)*y*4],v[_*4+3+T*y*4]=m[_*4+3+(b-T)*y*4];return v},saveCapture:function(){this.canvas.toBlob(function(m){var y="screenshot-"+document.title.toLowerCase()+"-"+Date.now()+".png",b=document.createElement("a"),v=URL.createObjectURL(m);b.href=v,b.setAttribute("download",y),b.innerHTML="downloading...",b.style.display="none",document.body.appendChild(b),setTimeout(function(){b.click(),document.body.removeChild(b)},1)},"image/png")}})},"./src/components/scene/stats.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./vendor/rStats.js"),f=c("./src/utils/index.js");c("./vendor/rStats.extras.js"),c("./src/lib/rStatsAframe.js");var g=window.aframeStats,m="a-hidden",y=window.threeStats;l.exports.Component=h("stats",{schema:{default:!0},sceneOnly:!0,init:function(){var v=this.el;f.getUrlParameter("stats")!=="false"&&(this.stats=b(v),this.statsEl=document.querySelector(".rs-base"),this.hideBound=this.hide.bind(this),this.showBound=this.show.bind(this),v.addEventListener("enter-vr",this.hideBound),v.addEventListener("exit-vr",this.showBound))},update:function(){if(this.stats)return this.data?this.show():this.hide()},remove:function(){this.el.removeEventListener("enter-vr",this.hideBound),this.el.removeEventListener("exit-vr",this.showBound),this.statsEl&&this.statsEl.parentNode.removeChild(this.statsEl)},tick:function(){var v=this.stats;v&&(v("rAF").tick(),v("FPS").frame(),v().update())},hide:function(){this.statsEl.classList.add(m)},show:function(){this.statsEl.classList.remove(m)}});function b(v){var _=new y(v.renderer),T=new g(v),E=v.isMobile?[]:[_,T];return new p({css:[],values:{fps:{caption:"fps",below:30}},groups:[{caption:"Framerate",values:["fps","raf"]}],plugins:E})}},"./src/components/scene/xr-mode-ui.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/constants/index.js"),f=c("./src/utils/index.js"),g="a-enter-vr",m="a-enter-ar",y="a-enter-vr-button",b="a-enter-ar-button",v="a-hidden",_="a-orientation-modal";l.exports.Component=h("xr-mode-ui",{dependencies:["canvas"],schema:{enabled:{default:!0},cardboardModeEnabled:{default:!1},enterVRButton:{default:""},enterVREnabled:{default:!0},enterARButton:{default:""},enterAREnabled:{default:!0},XRMode:{default:"vr",oneOf:["vr","ar","xr"]}},sceneOnly:!0,init:function(){var B=this,I=this.el;f.getUrlParameter("ui")!=="false"&&(this.insideLoader=!1,this.enterVREl=null,this.enterAREl=null,this.orientationModalEl=null,this.bindMethods(),I.addEventListener("enter-vr",this.updateEnterInterfaces),I.addEventListener("exit-vr",this.updateEnterInterfaces),I.addEventListener("update-vr-devices",this.updateEnterInterfaces),window.addEventListener("message",function(N){N.data.type==="loaderReady"&&(B.insideLoader=!0,B.remove())}),window.addEventListener("orientationchange",this.toggleOrientationModalIfNeeded))},bindMethods:function(){this.onEnterVRButtonClick=this.onEnterVRButtonClick.bind(this),this.onEnterARButtonClick=this.onEnterARButtonClick.bind(this),this.onModalClick=this.onModalClick.bind(this),this.toggleOrientationModalIfNeeded=this.toggleOrientationModalIfNeeded.bind(this),this.updateEnterInterfaces=this.updateEnterInterfaces.bind(this)},onModalClick:function(){this.el.exitVR()},onEnterVRButtonClick:function(){this.el.enterVR()},onEnterARButtonClick:function(){this.el.enterAR()},update:function(){var B=this.data,I=this.el;if(!B.enabled||this.insideLoader||f.getUrlParameter("ui")==="false")return this.remove();this.enterVREl||this.enterAREl||this.orientationModalEl||(!this.enterVREl&&B.enterVREnabled&&(B.XRMode==="xr"||B.XRMode==="vr")&&(B.enterVRButton?(this.enterVREl=document.querySelector(B.enterVRButton),this.enterVREl.addEventListener("click",this.onEnterVRButtonClick)):(this.enterVREl=T(this.onEnterVRButtonClick),I.appendChild(this.enterVREl))),!this.enterAREl&&B.enterAREnabled&&(B.XRMode==="xr"||B.XRMode==="ar")&&(B.enterARButton?(this.enterAREl=document.querySelector(B.enterARButton),this.enterAREl.addEventListener("click",this.onEnterARButtonClick)):(this.enterAREl=E(this.onEnterARButtonClick,B.XRMode==="xr"),I.appendChild(this.enterAREl))),this.orientationModalEl=C(this.onModalClick),I.appendChild(this.orientationModalEl),this.updateEnterInterfaces())},remove:function(){[this.enterVREl,this.enterAREl,this.orientationModalEl].forEach(function(B){B&&B.parentNode&&B.parentNode.removeChild(B)}),this.enterVREl=void 0,this.enterAREl=void 0,this.orientationModalEl=void 0},updateEnterInterfaces:function(){this.toggleEnterVRButtonIfNeeded(),this.toggleEnterARButtonIfNeeded(),this.toggleOrientationModalIfNeeded()},toggleEnterVRButtonIfNeeded:function(){var B=this.el;this.enterVREl&&(B.is("vr-mode")||(B.isMobile||f.device.isMobileDeviceRequestingDesktopSite())&&!this.data.cardboardModeEnabled&&!f.device.checkVRSupport()?this.enterVREl.classList.add(v):(f.device.checkVRSupport()||this.enterVREl.classList.add("fullscreen"),this.enterVREl.classList.remove(v),B.enterVR(!1,!0)))},toggleEnterARButtonIfNeeded:function(){var B=this.el;this.enterAREl&&(B.is("vr-mode")||!f.device.checkARSupport()?this.enterAREl.classList.add(v):(this.enterAREl.classList.remove(v),B.enterVR(!0,!0)))},toggleOrientationModalIfNeeded:function(){var B=this.el,I=this.orientationModalEl;!I||!B.isMobile||(!f.device.isLandscape()&&B.is("vr-mode")?I.classList.remove(v):I.classList.add(v))}});function T(B){var I,N;return N=document.createElement("div"),N.classList.add(g),N.setAttribute(p.AFRAME_INJECTED,""),I=document.createElement("button"),I.className=y,I.setAttribute("title","Enter VR mode with a headset or fullscreen without"),I.setAttribute(p.AFRAME_INJECTED,""),f.device.isMobile()&&R(I),N.appendChild(I),I.addEventListener("click",function(D){B(),D.stopPropagation()}),N}function E(B,I){var N,D;return D=document.createElement("div"),D.classList.add(m),I&&D.classList.add("xr"),D.setAttribute(p.AFRAME_INJECTED,""),N=document.createElement("button"),N.className=b,N.setAttribute("title","Enter AR mode with a headset or handheld device."),N.setAttribute(p.AFRAME_INJECTED,""),f.device.isMobile()&&R(N),D.appendChild(N),N.addEventListener("click",function(P){B(),P.stopPropagation()}),D}function C(B){var I=document.createElement("div");I.className=_,I.classList.add(v),I.setAttribute(p.AFRAME_INJECTED,"");var N=document.createElement("button");return N.setAttribute(p.AFRAME_INJECTED,""),N.innerHTML="Exit VR",N.addEventListener("click",B),I.appendChild(N),I}function R(B){B.addEventListener("touchstart",function(){B.classList.remove("resethover")},{passive:!0}),B.addEventListener("touchend",function(){B.classList.add("resethover")},{passive:!0})}},"./src/components/shadow.js":(l,u,c)=>{var h=c("./src/core/component.js"),p=c("./src/lib/three.js"),f=h.registerComponent;l.exports.Component=f("shadow",{schema:{cast:{default:!0},receive:{default:!0}},init:function(){this.onMeshChanged=this.update.bind(this),this.el.addEventListener("object3dset",this.onMeshChanged),this.system.setShadowMapEnabled(!0)},update:function(){var g=this.data;this.updateDescendants(g.cast,g.receive)},remove:function(){var g=this.el;g.removeEventListener("object3dset",this.onMeshChanged),this.updateDescendants(!1,!1)},updateDescendants:function(g,m){var y=this.el.sceneEl;this.el.object3D.traverse(function(b){if(b instanceof p.Mesh&&(b.castShadow=g,b.receiveShadow=m,y.hasLoaded&&b.material))for(var v=Array.isArray(b.material)?b.material:[b.material],_=0;_<v.length;_++)v[_].needsUpdate=!0})}})},"./src/components/sound.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/utils/debug.js"),f=c("./src/lib/three.js"),g=p("components:sound:warn");l.exports.Component=h("sound",{schema:{autoplay:{default:!1},distanceModel:{default:"inverse",oneOf:["linear","inverse","exponential"]},loop:{default:!1},loopStart:{default:0},loopEnd:{default:0},maxDistance:{default:1e4},on:{default:""},poolSize:{default:1},positional:{default:!0},refDistance:{default:1},rolloffFactor:{default:1},src:{type:"audio"},volume:{default:1}},multiple:!0,init:function(){var m=this;this.listener=null,this.audioLoader=new f.AudioLoader,this.pool=new f.Group,this.loaded=!1,this.mustPlay=!1,this.playSoundBound=function(){m.playSound()}},update:function(m){var y=this.data,b,v,_=y.src!==m.src;if(_){if(!y.src)return;this.setupSound()}for(b=0;b<this.pool.children.length;b++)v=this.pool.children[b],y.positional&&(v.setDistanceModel(y.distanceModel),v.setMaxDistance(y.maxDistance),v.setRefDistance(y.refDistance),v.setRolloffFactor(y.rolloffFactor)),v.setLoop(y.loop),v.setLoopStart(y.loopStart),y.loopStart!==0&&y.loopEnd===0?v.setLoopEnd(v.buffer.duration):v.setLoopEnd(y.loopEnd),v.setVolume(y.volume),v.isPaused=!1;if(y.on!==m.on&&this.updateEventListener(m.on),_){var T=this;this.loaded=!1,this.audioLoader.load(y.src,function(E){for(b=0;b<T.pool.children.length;b++)v=T.pool.children[b],v.setBuffer(E);T.loaded=!0,f.Cache.remove(y.src),(T.data.autoplay||T.mustPlay)&&T.playSound(T.processSound),T.el.emit("sound-loaded",T.evtDetail,!1)})}},pause:function(){this.stopSound(),this.removeEventListener()},play:function(){this.data.autoplay&&this.playSound(),this.updateEventListener()},remove:function(){var m,y;this.removeEventListener(),this.el.getObject3D(this.attrName)&&this.el.removeObject3D(this.attrName);try{for(m=0;m<this.pool.children.length;m++)y=this.pool.children[m],y.disconnect()}catch{g("Audio source not properly disconnected")}},updateEventListener:function(m){var y=this.el;m&&y.removeEventListener(m,this.playSoundBound),y.addEventListener(this.data.on,this.playSoundBound)},removeEventListener:function(){this.el.removeEventListener(this.data.on,this.playSoundBound)},setupSound:function(){var m=this.el,y,b=m.sceneEl,v=this,_;this.pool.children.length>0&&(this.stopSound(),m.removeObject3D("sound"));var T=this.listener=b.audioListener||new f.AudioListener;for(b.audioListener=T,b.camera&&b.camera.add(T),b.addEventListener("camera-set-active",function(E){E.detail.cameraEl.getObject3D("camera").add(T)}),this.pool=new f.Group,y=0;y<this.data.poolSize;y++)_=this.data.positional?new f.PositionalAudio(T):new f.Audio(T),this.pool.add(_);for(m.setObject3D(this.attrName,this.pool),y=0;y<this.pool.children.length;y++)_=this.pool.children[y],_.onEnded=function(){this.isPlaying=!1,v.el.emit("sound-ended",v.evtDetail,!1)}},pauseSound:function(){var m,y;for(this.isPlaying=!1,m=0;m<this.pool.children.length;m++)y=this.pool.children[m],!(!y.source||!y.source.buffer||!y.isPlaying||y.isPaused)&&(y.isPaused=!0,y.pause())},playSound:function(m){var y,b,v;if(!this.loaded){g("Sound not loaded yet. It will be played once it finished loading"),this.mustPlay=!0,this.processSound=m;return}for(y=!1,this.isPlaying=!0,b=0;b<this.pool.children.length;b++)if(v=this.pool.children[b],!v.isPlaying&&v.buffer&&!y){m&&m(v),v.play(),v.isPaused=!1,y=!0;continue}if(!y){g("All the sounds are playing. If you need to play more sounds simultaneously consider increasing the size of pool with the `poolSize` attribute.",this.el);return}this.mustPlay=!1,this.processSound=void 0},stopSound:function(){var m,y;for(this.isPlaying=!1,m=0;m<this.pool.children.length;m++){if(y=this.pool.children[m],!y.source||!y.source.buffer)return;y.stop()}}})},"./src/components/text.js":(l,u,c)=>{var h=c("./node_modules/three-bmfont-text/index.js"),p=c("./node_modules/load-bmfont/browser.js"),f=c("./src/core/component.js").registerComponent,g=c("./src/core/shader.js"),m=c("./src/lib/three.js"),y=c("./src/utils/index.js"),b=y.debug("components:text:error"),v=g.shaders,_=y.debug("components:text:warn"),T=1,E=16,C=c("./src/constants/index.js").AFRAME_CDN_ROOT,R=C+"fonts/",B={aileronsemibold:R+"Aileron-Semibold.fnt",dejavu:R+"DejaVu-sdf.fnt",exo2bold:R+"Exo2Bold.fnt",exo2semibold:R+"Exo2SemiBold.fnt",kelsonsans:R+"KelsonSans.fnt",monoid:R+"Monoid.fnt",mozillavr:R+"mozillavr.fnt",roboto:R+"Roboto-msdf.json",sourcecodepro:R+"SourceCodePro.fnt"},I=["roboto"],N="roboto";l.exports.FONTS=B;var D=new te,P={},k={},q=/^\w+:/;l.exports.Component=f("text",{multiple:!0,schema:{align:{type:"string",default:"left",oneOf:["left","right","center"]},alphaTest:{default:.5},anchor:{default:"center",oneOf:["left","right","center","align"]},baseline:{default:"center",oneOf:["top","center","bottom"]},color:{type:"color",default:"#FFF"},font:{type:"string",default:N},fontImage:{type:"string"},height:{type:"number"},letterSpacing:{type:"number",default:0},lineHeight:{type:"number"},negate:{type:"boolean",default:!0},opacity:{type:"number",default:1},shader:{default:"sdf",oneOf:v},side:{default:"front",oneOf:["front","back","double"]},tabSize:{default:4},transparent:{default:!0},value:{type:"string"},whiteSpace:{default:"normal",oneOf:["normal","pre","nowrap"]},width:{type:"number"},wrapCount:{type:"number",default:40},wrapPixels:{type:"number"},xOffset:{type:"number",default:0},yOffset:{type:"number",default:0},zOffset:{type:"number",default:.001}},init:function(){this.shaderData={},this.geometry=h(),this.createOrUpdateMaterial(),this.explicitGeoDimensionsChecked=!1},update:function(Y){var se=this.data,ve=this.currentFont;if(k[se.font]?this.texture=k[se.font]:(this.texture=k[se.font]=new m.Texture,this.texture.anisotropy=E),this.createOrUpdateMaterial(),Y.font!==se.font){this.updateFont();return}ve&&(this.updateGeometry(this.geometry,ve),this.updateLayout())},remove:function(){this.geometry.dispose(),this.geometry=null,this.el.removeObject3D(this.attrName),this.material.dispose(),this.material=null,this.texture.dispose(),this.texture=null,this.shaderObject&&delete this.shaderObject},createOrUpdateMaterial:function(){var Y=this.data,se,ve=this.material,Ae,me=this.shaderData,Oe;if(Oe=Y.shader,I.indexOf(Y.font)!==-1||Y.font.indexOf("-msdf.")>=0?Oe="msdf":Y.font in B&&I.indexOf(Y.font)===-1&&(Oe="sdf"),se=(this.shaderObject&&this.shaderObject.name)!==Oe,me.alphaTest=Y.alphaTest,me.color=Y.color,me.map=this.texture,me.opacity=Y.opacity,me.side=V(Y.side),me.transparent=Y.transparent,me.negate=Y.negate,!se){this.shaderObject.update(me),ve.transparent=me.transparent,ve.side=me.side;return}Ae=W(this.el,Oe,me),this.material=Ae.material,this.shaderObject=Ae.shader,this.material.side=me.side,this.mesh&&(this.mesh.material=this.material)},updateFont:function(){var Y=this.data,se=this.el,ve,Ae=this.geometry,me=this;Y.font||_("No font specified. Using the default font."),this.mesh&&(this.mesh.visible=!1),ve=this.lookupFont(Y.font||N)||Y.font,D.get(ve,function(){return j(ve,Y.yOffset)}).then(function(Oe){var Xe;if(Oe.pages.length!==1)throw new Error("Currently only single-page bitmap fonts are supported.");P[ve]||(Oe.widthFactor=P[Oe]=z(Oe)),me.currentFont=Oe,Xe=me.getFontImageSrc(),D.get(Xe,function(){return Q(Xe)}).then(function(Je){var it=me.texture;it&&(it.image=Je,it.needsUpdate=!0,k[Y.font]=it,me.texture=it,me.initMesh(),me.currentFont=Oe,me.updateGeometry(Ae,Oe),me.updateLayout(),me.mesh.visible=!0,se.emit("textfontset",{font:Y.font,fontObj:Oe}))}).catch(function(Je){b(Je.message),b(Je.stack)})}).catch(function(Oe){b(Oe.message),b(Oe.stack)})},initMesh:function(){this.mesh||(this.mesh=new m.Mesh(this.geometry,this.material),this.el.setObject3D(this.attrName,this.mesh))},getFontImageSrc:function(){if(this.data.fontImage)return this.data.fontImage;var Y=this.lookupFont(this.data.font||N)||this.data.font,se=this.currentFont.pages[0];return se.match(q)&&se.indexOf("http")!==0?Y.replace(/(\.fnt)|(\.json)/,".png"):m.LoaderUtils.extractUrlBase(Y)+se},updateLayout:function(){var Y,se,ve=this.el,Ae=this.data,me=this.geometry,Oe,Xe,Je,it=this.mesh,dt,St,Qt,yt,bi;if(!(!it||!me.layout)){if(Oe=ve.getAttribute("geometry"),Qt=Ae.width||Oe&&Oe.width||T,dt=G(Ae.wrapPixels,Ae.wrapCount,this.currentFont.widthFactor),St=Qt/dt,Je=me.layout,Xe=St*(Je.height+Je.descender),Oe&&Oe.primitive==="plane"&&(this.explicitGeoDimensionsChecked||(this.explicitGeoDimensionsChecked=!0,this.hasExplicitGeoWidth=!!Oe.width,this.hasExplicitGeoHeight=!!Oe.height),this.hasExplicitGeoWidth||ve.setAttribute("geometry","width",Qt),this.hasExplicitGeoHeight||ve.setAttribute("geometry","height",Xe)),Y=Ae.anchor==="align"?Ae.align:Ae.anchor,Y==="left")yt=0;else if(Y==="right")yt=-1*Je.width;else if(Y==="center")yt=-1*Je.width/2;else throw new TypeError("Invalid text.anchor property value",Y);if(se=Ae.baseline,se==="bottom")bi=0;else if(se==="top")bi=-1*Je.height+Je.ascender;else if(se==="center")bi=-1*Je.height/2;else throw new TypeError("Invalid text.baseline property value",se);it.position.x=yt*St+Ae.xOffset,it.position.y=bi*St,it.position.z=Ae.zOffset,it.scale.set(St,-1*St,St)}},lookupFont:function(Y){return B[Y]},updateGeometry:function(){var Y={},se={},ve=/\\n/g,Ae=/\\t/g;return function(me,Oe){var Xe=this.data;se.font=Oe,se.lineHeight=Xe.lineHeight&&isFinite(Xe.lineHeight)?Xe.lineHeight:Oe.common.lineHeight,se.text=Xe.value.toString().replace(ve,`
`).replace(Ae,"	"),se.width=G(Xe.wrapPixels,Xe.wrapCount,Oe.widthFactor),me.update(y.extend(Y,Xe,se))}}()});function V(Y){switch(Y){case"back":return m.FrontSide;case"double":return m.DoubleSide;default:return m.BackSide}}function j(Y,se){return new Promise(function(ve,Ae){p(Y,function(me,Oe){if(me){b("Error loading font",Y),Ae(me);return}Y.indexOf("/Roboto-msdf.json")>=0&&(se=30),se&&Oe.chars.map(function(Xe){Xe.yoffset+=se}),ve(Oe)})})}function Q(Y){return new Promise(function(se,ve){new m.ImageLoader().load(Y,function(Ae){se(Ae)},void 0,function(){b("Error loading font image",Y),ve(null)})})}function W(Y,se,ve){var Ae,me;return me=new v[se].Shader,me.el=Y,me.init(ve),me.update(ve),Ae=me.material,Ae.transparent=ve.transparent,{material:Ae,shader:me}}function G(Y,se,ve){return Y||(.5+se)*ve}function z(Y){var se=0,ve=0,Ae=0;return Y.chars.map(function(me){se+=me.xadvance,me.id>=48&&me.id<=57&&(Ae++,ve+=me.xadvance)}),Ae?ve/Ae:se/Y.chars.length}function te(){var Y=this.cache={};this.get=function(se,ve){return se in Y||(Y[se]=ve()),Y[se]}}},"./src/components/tracked-controls-webvr.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/utils/tracked-controls.js"),f=c("./src/constants/index.js").DEFAULT_CAMERA_HEIGHT,g=c("./src/lib/three.js"),m=c("./src/constants/index.js").DEFAULT_HANDEDNESS,y={x:.175,y:-.3,z:-.03},b={x:0,y:0,z:-.175},v={touches:[]},_={AXISMOVE:"axismove",BUTTONCHANGED:"buttonchanged",BUTTONDOWN:"buttondown",BUTTONUP:"buttonup",TOUCHSTART:"touchstart",TOUCHEND:"touchend"};l.exports.Component=h("tracked-controls-webvr",{schema:{autoHide:{default:!0},controller:{default:0},id:{type:"string",default:""},hand:{type:"string",default:""},idPrefix:{type:"string",default:""},orientationOffset:{type:"vec3"},armModel:{default:!1},headElement:{type:"selector"}},init:function(){this.axis=this.el.components["tracked-controls"].axis=[0,0,0],this.buttonStates=this.el.components["tracked-controls"].buttonStates={},this.changedAxes=[],this.targetControllerNumber=this.data.controller,this.axisMoveEventDetail={axis:this.axis,changed:this.changedAxes},this.deltaControllerPosition=new g.Vector3,this.controllerQuaternion=new g.Quaternion,this.controllerEuler=new g.Euler,this.updateGamepad(),this.buttonEventDetails={}},tick:function(T,E){var C=this.el.getObject3D("mesh");C&&C.update&&C.update(E/1e3),this.updateGamepad(),this.updatePose(),this.updateButtons()},defaultUserHeight:function(){return f},getHeadElement:function(){return this.data.headElement||this.el.sceneEl.camera.el},updateGamepad:function(){var T=this.data,E=p.findMatchingControllerWebVR(this.system.controllers,T.id,T.idPrefix,T.hand,T.controller);this.controller=E,this.el.components["tracked-controls"].controller=E,this.data.autoHide&&(this.el.object3D.visible=!!this.controller)},applyArmModel:function(T){var E=this.controller,C=this.controllerEuler,R=this.controllerQuaternion,B=this.deltaControllerPosition,I,N,D,P,k;N=this.getHeadElement(),D=N.object3D,k=this.defaultUserHeight(),P=E.pose,I=(E?E.hand:void 0)||m,T.copy(D.position),B.set(y.x*(I==="left"?-1:I==="right"?1:0),y.y,y.z),B.multiplyScalar(k),B.applyAxisAngle(D.up,D.rotation.y),T.add(B),B.set(b.x,b.y,b.z),B.multiplyScalar(k),P.orientation?R.fromArray(P.orientation):R.copy(D.quaternion),C.setFromQuaternion(R),C.set(C.x,C.y,0),B.applyEuler(C),T.add(B)},updatePose:function(){var T=this.controller,E=this.data,C=this.el.object3D,R,B=this.system.vrDisplay,I;T&&(R=T.pose,R.position?C.position.fromArray(R.position):E.armModel&&this.applyArmModel(C.position),R.orientation&&C.quaternion.fromArray(R.orientation),B&&R.position&&(I=this.el.sceneEl.renderer.xr.getStandingMatrix(),C.matrix.compose(C.position,C.quaternion,C.scale),C.matrix.multiplyMatrices(I,C.matrix),C.matrix.decompose(C.position,C.quaternion,C.scale)),C.rotateX(this.data.orientationOffset.x*g.MathUtils.DEG2RAD),C.rotateY(this.data.orientationOffset.y*g.MathUtils.DEG2RAD),C.rotateZ(this.data.orientationOffset.z*g.MathUtils.DEG2RAD))},updateButtons:function(){var T,E=this.controller,C;if(E){for(C=0;C<E.buttons.length;++C)this.buttonStates[C]||(this.buttonStates[C]={pressed:!1,touched:!1,value:0}),this.buttonEventDetails[C]||(this.buttonEventDetails[C]={id:C,state:this.buttonStates[C]}),T=E.buttons[C],this.handleButton(C,T);this.handleAxes()}},handleButton:function(T,E){var C;return C=this.handlePress(T,E)|this.handleTouch(T,E)|this.handleValue(T,E),C?(this.el.emit(_.BUTTONCHANGED,this.buttonEventDetails[T],!1),!0):!1},handleAxes:function(){var T=!1,E=this.controller.axes,C,R=this.axis,B=this.changedAxes;for(this.changedAxes.splice(0,this.changedAxes.length),C=0;C<E.length;++C)B.push(R[C]!==E[C]),B[C]&&(T=!0);if(!T)return!1;for(this.axis.splice(0,this.axis.length),C=0;C<E.length;C++)this.axis.push(E[C]);return this.el.emit(_.AXISMOVE,this.axisMoveEventDetail,!1),!0},handlePress:function(T,E){var C,R=this.buttonStates[T];return E.pressed===R.pressed?!1:(C=E.pressed?_.BUTTONDOWN:_.BUTTONUP,this.el.emit(C,this.buttonEventDetails[T],!1),R.pressed=E.pressed,!0)},handleTouch:function(T,E){var C,R=this.buttonStates[T];return E.touched===R.touched?!1:(C=E.touched?_.TOUCHSTART:_.TOUCHEND,this.el.emit(C,this.buttonEventDetails[T],!1,v),R.touched=E.touched,!0)},handleValue:function(T,E){var C=this.buttonStates[T];return E.value===C.value?!1:(C.value=E.value,!0)}})},"./src/components/tracked-controls-webxr.js":(l,u,c)=>{var h=c("./src/utils/tracked-controls.js"),p=c("./src/core/component.js").registerComponent,f={AXISMOVE:"axismove",BUTTONCHANGED:"buttonchanged",BUTTONDOWN:"buttondown",BUTTONUP:"buttonup",TOUCHSTART:"touchstart",TOUCHEND:"touchend"};l.exports.Component=p("tracked-controls-webxr",{schema:{id:{type:"string",default:""},hand:{type:"string",default:""},handTrackingEnabled:{default:!1},index:{type:"int",default:-1},iterateControllerProfiles:{default:!1},space:{type:"string",oneOf:["targetRaySpace","gripSpace"],default:"gripSpace"}},init:function(){this.updateController=this.updateController.bind(this),this.buttonEventDetails={},this.buttonStates=this.el.components["tracked-controls"].buttonStates={},this.axis=this.el.components["tracked-controls"].axis=[0,0,0],this.changedAxes=[],this.axisMoveEventDetail={axis:this.axis,changed:this.changedAxes}},update:function(){this.updateController()},play:function(){var g=this.el.sceneEl;this.updateController(),g.addEventListener("controllersupdated",this.updateController)},pause:function(){var g=this.el.sceneEl;g.removeEventListener("controllersupdated",this.updateController)},isControllerPresent:function(g){return!(!this.controller||this.controller.gamepad||g.inputSource.handedness!=="none"&&g.inputSource.handedness!==this.data.hand)},updateController:function(){this.controller=h.findMatchingControllerWebXR(this.system.controllers,this.data.id,this.data.hand,this.data.index,this.data.iterateControllerProfiles,this.data.handTrackingEnabled),this.el.components["tracked-controls"].controller=this.controller,this.data.autoHide&&(this.el.object3D.visible=!!this.controller)},tick:function(){var g=this.el.sceneEl,m=this.controller,y=g.frame;!m||!g.frame||!this.system.referenceSpace||m.hand||(this.pose=y.getPose(m[this.data.space],this.system.referenceSpace),this.updatePose(),this.updateButtons())},updatePose:function(){var g=this.el.object3D,m=this.pose;m&&(g.matrix.elements=m.transform.matrix,g.matrix.decompose(g.position,g.rotation,g.scale))},updateButtons:function(){var g,m,y=this.controller,b;if(!(!y||!y.gamepad)){for(b=y.gamepad,m=0;m<b.buttons.length;++m)this.buttonStates[m]||(this.buttonStates[m]={pressed:!1,touched:!1,value:0}),this.buttonEventDetails[m]||(this.buttonEventDetails[m]={id:m,state:this.buttonStates[m]}),g=b.buttons[m],this.handleButton(m,g);this.handleAxes()}},handleButton:function(g,m){var y;return y=this.handlePress(g,m)|this.handleTouch(g,m)|this.handleValue(g,m),y?(this.el.emit(f.BUTTONCHANGED,this.buttonEventDetails[g],!1),!0):!1},handleAxes:function(){var g=!1,m=this.controller.gamepad.axes,y,b=this.axis,v=this.changedAxes;for(this.changedAxes.splice(0,this.changedAxes.length),y=0;y<m.length;++y)v.push(b[y]!==m[y]),v[y]&&(g=!0);if(!g)return!1;for(this.axis.splice(0,this.axis.length),y=0;y<m.length;y++)this.axis.push(m[y]);return this.el.emit(f.AXISMOVE,this.axisMoveEventDetail,!1),!0},handlePress:function(g,m){var y,b=this.buttonStates[g];return m.pressed===b.pressed?!1:(y=m.pressed?f.BUTTONDOWN:f.BUTTONUP,this.el.emit(y,this.buttonEventDetails[g],!1),b.pressed=m.pressed,!0)},handleTouch:function(g,m){var y,b=this.buttonStates[g];return m.touched===b.touched?!1:(y=m.touched?f.TOUCHSTART:f.TOUCHEND,this.el.emit(y,this.buttonEventDetails[g],!1),b.touched=m.touched,!0)},handleValue:function(g,m){var y=this.buttonStates[g];return m.value===y.value?!1:(y.value=m.value,!0)}})},"./src/components/tracked-controls.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent;l.exports.Component=h("tracked-controls",{schema:{autoHide:{default:!0},controller:{default:-1},id:{type:"string",default:""},hand:{type:"string",default:""},idPrefix:{type:"string",default:""},handTrackingEnabled:{default:!1},orientationOffset:{type:"vec3"},armModel:{default:!1},headElement:{type:"selector"},iterateControllerProfiles:{default:!1},space:{type:"string",oneOf:["targetRaySpace","gripSpace"],default:"targetRaySpace"}},after:["tracked-controls-webvr","tracked-controls-webxr"],update:function(){var p=this.data,f=this.el;f.sceneEl.hasWebXR?f.setAttribute("tracked-controls-webxr",{id:p.id,hand:p.hand,index:p.controller,iterateControllerProfiles:p.iterateControllerProfiles,handTrackingEnabled:p.handTrackingEnabled,space:p.space}):f.setAttribute("tracked-controls-webvr",p)}})},"./src/components/valve-index-controls.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/lib/three.js"),f=c("./src/utils/tracked-controls.js"),g=f.checkControllerPresentAndSetup,m=f.emitIfAxesChanged,y=f.onButtonEvent,b=c("./src/constants/index.js").AFRAME_CDN_ROOT,v=b+"controllers/valve/index/valve-index-",_={left:v+"left.glb",right:v+"right.glb"},T="valve",E=c("./src/utils/index.js").device.isWebXRAvailable,C={left:{x:-.00023692678902063457,y:.04724540367838371,z:-.061959880395271096},right:{x:.002471558599671131,y:.055765208987076195,z:-.061068168708348844}},R={left:{x:0,y:-.05,z:.06},right:{x:0,y:-.05,z:.06}},B={left:{_x:.692295102620542,_y:-.0627618864318427,_z:-.06265893149611756,_order:"XYZ"},right:{_x:.6484021229942998,_y:-.032563619881892894,_z:-.1327973171917482,_order:"XYZ"}},I={left:{_x:Math.PI/3,_y:0,_z:0,_order:"XYZ"},right:{_x:Math.PI/3,_y:0,_z:0,_order:"XYZ"}},N=E?I:B,D=E?R:C;l.exports.Component=h("valve-index-controls",{schema:{hand:{default:"left"},buttonColor:{type:"color",default:"#FAFAFA"},buttonHighlightColor:{type:"color",default:"#22D1EE"},model:{default:!0},orientationOffset:{type:"vec3"}},after:["tracked-controls"],mapping:{axes:{trackpad:[0,1],thumbstick:[2,3]},buttons:["trigger","grip","trackpad","thumbstick","abutton"]},init:function(){var P=this;this.controllerPresent=!1,this.lastControllerCheck=0,this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(k){y(k.detail.id,"down",P)},this.onButtonUp=function(k){y(k.detail.id,"up",P)},this.onButtonTouchEnd=function(k){y(k.detail.id,"touchend",P)},this.onButtonTouchStart=function(k){y(k.detail.id,"touchstart",P)},this.previousButtonValues={},this.bindMethods()},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},addEventListeners:function(){var P=this.el;P.addEventListener("buttonchanged",this.onButtonChanged),P.addEventListener("buttondown",this.onButtonDown),P.addEventListener("buttonup",this.onButtonUp),P.addEventListener("touchend",this.onButtonTouchEnd),P.addEventListener("touchstart",this.onButtonTouchStart),P.addEventListener("model-loaded",this.onModelLoaded),P.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var P=this.el;P.removeEventListener("buttonchanged",this.onButtonChanged),P.removeEventListener("buttondown",this.onButtonDown),P.removeEventListener("buttonup",this.onButtonUp),P.removeEventListener("touchend",this.onButtonTouchEnd),P.removeEventListener("touchstart",this.onButtonTouchStart),P.removeEventListener("model-loaded",this.onModelLoaded),P.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var P=this.data,k=P.hand==="right"?0:P.hand==="left"?1:2;g(this,T,{index:k,iterateControllerProfiles:!0,hand:P.hand})},injectTrackedControls:function(){var P=this.el,k=this.data;P.setAttribute("tracked-controls",{idPrefix:T,controller:k.hand==="right"?1:k.hand==="left"?0:2,hand:k.hand,orientationOffset:k.orientationOffset}),this.loadModel()},loadModel:function(){var P=this.data;P.model&&this.el.setAttribute("gltf-model",""+_[P.hand])},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(P){var k=this.mapping.buttons[P.detail.id],q=this.buttonMeshes,V;k&&(k==="trigger"&&(V=P.detail.state.value,q&&q.trigger&&(q.trigger.rotation.x=this.triggerOriginalRotationX-V*(Math.PI/40))),this.el.emit(k+"changed",P.detail.state))},onModelLoaded:function(P){var k,q=P.detail.model,V=this;P.target!==this.el||!this.data.model||(k=this.buttonMeshes={},k.grip={left:q.getObjectByName("leftgrip"),right:q.getObjectByName("rightgrip")},k.menu=q.getObjectByName("menubutton"),k.system=q.getObjectByName("systembutton"),k.trackpad=q.getObjectByName("touchpad"),k.trigger=q.getObjectByName("trigger"),this.triggerOriginalRotationX=k.trigger.rotation.x,Object.keys(k).forEach(function(j){V.setButtonColor(j,V.data.buttonColor)}),q.position.copy(D[this.data.hand]),q.rotation.copy(N[this.data.hand]),this.el.emit("controllermodelready",{name:"valve-index-controls",model:this.data.model,rayOrigin:new p.Vector3(0,0,0)}))},onAxisMoved:function(P){m(this,this.mapping.axes,P)},updateModel:function(P,k){var q,V;this.data.model&&(V=k.indexOf("touch")!==-1,!V&&(q=k==="up"?this.data.buttonColor:this.data.buttonHighlightColor,this.setButtonColor(P,q)))},setButtonColor:function(P,k){}})},"./src/components/visible.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent;l.exports.Component=h("visible",{schema:{default:!0},update:function(){this.el.object3D.visible=this.data}})},"./src/components/vive-controls.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/utils/tracked-controls.js"),f=p.checkControllerPresentAndSetup,g=p.emitIfAxesChanged,m=p.onButtonEvent,y=c("./src/constants/index.js").AFRAME_CDN_ROOT,b=y+"controllers/vive/vr_controller_vive.obj",v=y+"controllers/vive/vr_controller_vive.mtl",_=c("./src/utils/index.js").device.isWebXRAvailable,T="htc-vive",E="OpenVR ",C=_?T:E,R={axes:{trackpad:[0,1]},buttons:["trackpad","trigger","grip","menu","system"]},B={axes:{touchpad:[0,1]},buttons:["trigger","grip","touchpad","none"]},I=_?B:R;l.exports.Component=h("vive-controls",{schema:{hand:{default:"left"},buttonColor:{type:"color",default:"#FAFAFA"},buttonHighlightColor:{type:"color",default:"#22D1EE"},model:{default:!0},orientationOffset:{type:"vec3"}},after:["tracked-controls"],mapping:I,init:function(){var N=this;this.controllerPresent=!1,this.lastControllerCheck=0,this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(D){m(D.detail.id,"down",N)},this.onButtonUp=function(D){m(D.detail.id,"up",N)},this.onButtonTouchEnd=function(D){m(D.detail.id,"touchend",N)},this.onButtonTouchStart=function(D){m(D.detail.id,"touchstart",N)},this.previousButtonValues={},this.bindMethods()},update:function(){var N=this.data;this.controllerIndex=N.hand==="right"?0:N.hand==="left"?1:2},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},addEventListeners:function(){var N=this.el;N.addEventListener("buttonchanged",this.onButtonChanged),N.addEventListener("buttondown",this.onButtonDown),N.addEventListener("buttonup",this.onButtonUp),N.addEventListener("touchend",this.onButtonTouchEnd),N.addEventListener("touchstart",this.onButtonTouchStart),N.addEventListener("model-loaded",this.onModelLoaded),N.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var N=this.el;N.removeEventListener("buttonchanged",this.onButtonChanged),N.removeEventListener("buttondown",this.onButtonDown),N.removeEventListener("buttonup",this.onButtonUp),N.removeEventListener("touchend",this.onButtonTouchEnd),N.removeEventListener("touchstart",this.onButtonTouchStart),N.removeEventListener("model-loaded",this.onModelLoaded),N.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var N=this.data;f(this,C,{index:this.controllerIndex,hand:N.hand})},injectTrackedControls:function(){var N=this.el,D=this.data;N.setAttribute("tracked-controls",{idPrefix:C,hand:D.hand,controller:this.controllerIndex,orientationOffset:D.orientationOffset}),this.data.model&&this.el.setAttribute("obj-model",{obj:b,mtl:v})},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(N){var D=this.mapping.buttons[N.detail.id],P=this.buttonMeshes,k;D&&(D==="trigger"&&(k=N.detail.state.value,P&&P.trigger&&(P.trigger.rotation.x=-k*(Math.PI/12))),this.el.emit(D+"changed",N.detail.state))},onModelLoaded:function(N){var D,P=N.detail.model,k=this;N.target!==this.el||!this.data.model||(D=this.buttonMeshes={},D.grip={left:P.getObjectByName("leftgrip"),right:P.getObjectByName("rightgrip")},D.menu=P.getObjectByName("menubutton"),D.system=P.getObjectByName("systembutton"),D.trackpad=P.getObjectByName("touchpad"),D.touchpad=P.getObjectByName("touchpad"),D.trigger=P.getObjectByName("trigger"),Object.keys(D).forEach(function(q){k.setButtonColor(q,k.data.buttonColor)}),P.position.set(0,-.015,.04))},onAxisMoved:function(N){g(this,this.mapping.axes,N)},updateModel:function(N,D){var P,k;this.data.model&&(k=D.indexOf("touch")!==-1,!k&&(P=D==="up"?this.data.buttonColor:this.data.buttonHighlightColor,this.setButtonColor(N,P)))},setButtonColor:function(N,D){var P=this.buttonMeshes;if(P){if(N==="grip"){P.grip.left.material.color.set(D),P.grip.right.material.color.set(D);return}P[N].material.color.set(D)}}})},"./src/components/vive-focus-controls.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/utils/tracked-controls.js"),f=p.checkControllerPresentAndSetup,g=p.emitIfAxesChanged,m=p.onButtonEvent,y=c("./src/constants/index.js").AFRAME_CDN_ROOT,b=y+"controllers/vive/focus-controller/focus-controller.gltf",v=c("./src/utils/index.js").device.isWebXRAvailable,_="htc-vive-focus",T="HTC Vive Focus ",E=v?_:T,C={axes:{trackpad:[0,1]},buttons:["trackpad","trigger"]},R={axes:{touchpad:[0,1]},buttons:["trigger","none","touchpad","none","menu"]},B=v?R:C;l.exports.Component=h("vive-focus-controls",{schema:{hand:{default:""},buttonTouchedColor:{type:"color",default:"#BBBBBB"},buttonHighlightColor:{type:"color",default:"#7A7A7A"},model:{default:!0},orientationOffset:{type:"vec3"},armModel:{default:!0}},after:["tracked-controls"],mapping:B,bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},init:function(){var I=this;this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(N){m(N.detail.id,"down",I)},this.onButtonUp=function(N){m(N.detail.id,"up",I)},this.onButtonTouchStart=function(N){m(N.detail.id,"touchstart",I)},this.onButtonTouchEnd=function(N){m(N.detail.id,"touchend",I)},this.controllerPresent=!1,this.lastControllerCheck=0,this.bindMethods()},addEventListeners:function(){var I=this.el;I.addEventListener("buttonchanged",this.onButtonChanged),I.addEventListener("buttondown",this.onButtonDown),I.addEventListener("buttonup",this.onButtonUp),I.addEventListener("touchstart",this.onButtonTouchStart),I.addEventListener("touchend",this.onButtonTouchEnd),I.addEventListener("model-loaded",this.onModelLoaded),I.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0,this.addControllersUpdateListener()},removeEventListeners:function(){var I=this.el;I.removeEventListener("buttonchanged",this.onButtonChanged),I.removeEventListener("buttondown",this.onButtonDown),I.removeEventListener("buttonup",this.onButtonUp),I.removeEventListener("touchstart",this.onButtonTouchStart),I.removeEventListener("touchend",this.onButtonTouchEnd),I.removeEventListener("model-loaded",this.onModelLoaded),I.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1,this.removeControllersUpdateListener()},checkIfControllerPresent:function(){f(this,E,this.data.hand?{hand:this.data.hand}:{})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var I=this.el,N=this.data;I.setAttribute("tracked-controls",{armModel:N.armModel,idPrefix:E,orientationOffset:N.orientationOffset}),this.data.model&&this.el.setAttribute("gltf-model",b)},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelLoaded:function(I){var N=I.detail.model,D;I.target!==this.el||!this.data.model||(D=this.buttonMeshes={},D.trigger=N.getObjectByName("BumperKey"),D.triggerPressed=N.getObjectByName("BumperKey_Press"),D.triggerPressed&&(D.triggerPressed.visible=!1),D.trackpad=N.getObjectByName("TouchPad"),D.trackpadPressed=N.getObjectByName("TouchPad_Press"),D.trackpadPressed&&(D.trackpadPressed.visible=!1))},onButtonChanged:function(I){var N=this.mapping.buttons[I.detail.id];N&&this.el.emit(N+"changed",I.detail.state)},onAxisMoved:function(I){g(this,this.mapping.axes,I)},updateModel:function(I,N){this.data.model&&this.updateButtonModel(I,N)},updateButtonModel:function(I,N){var D=this.buttonMeshes,P=I+"Pressed";if(!(!D||!D[I]||!D[P])){var k;switch(N){case"down":k=this.data.buttonHighlightColor;break;case"touchstart":k=this.data.buttonTouchedColor;break}k&&D[P].material.color.set(k),D[P].visible=!!k,D[I].visible=!k}}})},"./src/components/wasd-controls.js":(l,u,c)=>{var h=c("./src/constants/index.js").keyboardevent.KEYCODE_TO_CODE,p=c("./src/core/component.js").registerComponent,f=c("./src/lib/three.js"),g=c("./src/utils/index.js"),m=g.shouldCaptureKeyEvent,y=1e-5,b=.2,v=["KeyW","KeyA","KeyS","KeyD","ArrowUp","ArrowLeft","ArrowRight","ArrowDown"];l.exports.Component=p("wasd-controls",{schema:{acceleration:{default:65},adAxis:{default:"x",oneOf:["x","y","z"]},adEnabled:{default:!0},adInverted:{default:!1},enabled:{default:!0},fly:{default:!1},wsAxis:{default:"z",oneOf:["x","y","z"]},wsEnabled:{default:!0},wsInverted:{default:!1}},after:["look-controls"],init:function(){this.keys={},this.easing=1.1,this.velocity=new f.Vector3,this.onBlur=this.onBlur.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.onFocus=this.onFocus.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.onVisibilityChange=this.onVisibilityChange.bind(this),this.attachVisibilityEventListeners()},tick:function(T,E){var C=this.data,R=this.el,B=this.velocity;!B[C.adAxis]&&!B[C.wsAxis]&&_(this.keys)||(E=E/1e3,this.updateVelocity(E),!(!B[C.adAxis]&&!B[C.wsAxis])&&R.object3D.position.add(this.getMovementVector(E)))},update:function(T){T.adAxis!==this.data.adAxis&&(this.velocity[T.adAxis]=0),T.wsAxis!==this.data.wsAxis&&(this.velocity[T.wsAxis]=0)},remove:function(){this.removeKeyEventListeners(),this.removeVisibilityEventListeners()},play:function(){this.attachKeyEventListeners()},pause:function(){this.keys={},this.removeKeyEventListeners()},updateVelocity:function(T){var E,C,R,B=this.data,I=this.keys,N=this.velocity,D,P;if(C=B.adAxis,D=B.wsAxis,T>b){N[C]=0,N[D]=0;return}var k=Math.pow(1/this.easing,T*60);N[C]!==0&&(N[C]=N[C]*k),N[D]!==0&&(N[D]=N[D]*k),Math.abs(N[C])<y&&(N[C]=0),Math.abs(N[D])<y&&(N[D]=0),B.enabled&&(E=B.acceleration,B.adEnabled&&(R=B.adInverted?-1:1,(I.KeyA||I.ArrowLeft)&&(N[C]-=R*E*T),(I.KeyD||I.ArrowRight)&&(N[C]+=R*E*T)),B.wsEnabled&&(P=B.wsInverted?-1:1,(I.KeyW||I.ArrowUp)&&(N[D]-=P*E*T),(I.KeyS||I.ArrowDown)&&(N[D]+=P*E*T)))},getMovementVector:function(){var T=new f.Vector3(0,0,0),E=new f.Euler(0,0,0,"YXZ");return function(C){var R=this.el.getAttribute("rotation"),B=this.velocity,I;return T.copy(B),T.multiplyScalar(C),R&&(I=this.data.fly?R.x:0,E.set(f.MathUtils.degToRad(I),f.MathUtils.degToRad(R.y),0),T.applyEuler(E)),T}}(),attachVisibilityEventListeners:function(){window.oncontextmenu=this.onContextMenu,window.addEventListener("blur",this.onBlur),window.addEventListener("focus",this.onFocus),document.addEventListener("visibilitychange",this.onVisibilityChange)},removeVisibilityEventListeners:function(){window.removeEventListener("blur",this.onBlur),window.removeEventListener("focus",this.onFocus),document.removeEventListener("visibilitychange",this.onVisibilityChange)},attachKeyEventListeners:function(){window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp)},removeKeyEventListeners:function(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)},onContextMenu:function(){for(var T=Object.keys(this.keys),E=0;E<T.length;E++)delete this.keys[T[E]]},onBlur:function(){this.pause()},onFocus:function(){this.play()},onVisibilityChange:function(){document.hidden?this.onBlur():this.onFocus()},onKeyDown:function(T){var E;m(T)&&(E=T.code||h[T.keyCode],v.indexOf(E)!==-1&&(this.keys[E]=!0))},onKeyUp:function(T){var E;E=T.code||h[T.keyCode],delete this.keys[E]}});function _(T){var E;for(E in T)return!1;return!0}},"./src/components/windows-motion-controls.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/utils/tracked-controls.js"),f=p.checkControllerPresentAndSetup,g=p.emitIfAxesChanged,m=p.onButtonEvent,y=c("./src/utils/index.js"),b=y.debug("components:windows-motion-controls:debug"),v=y.debug("components:windows-motion-controls:warn"),_=c("./src/constants/index.js").DEFAULT_HANDEDNESS,T=c("./src/constants/index.js").AFRAME_CDN_ROOT,E=T+"controllers/microsoft/",C={left:"left.glb",right:"right.glb",default:"universal.glb"},R=c("./src/utils/index.js").device.isWebXRAvailable,B="windows-mixed-reality",I="Spatial Controller (Spatial Interaction Source) ",N=/([0-9a-zA-Z]+-[0-9a-zA-Z]+)$/,D=R?B:I,P={axes:{thumbstick:[0,1],trackpad:[2,3]},buttons:["thumbstick","trigger","grip","menu","trackpad"],axisMeshNames:["THUMBSTICK_X","THUMBSTICK_Y","TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_Y"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",grip:"GRASP",thumbstick:"THUMBSTICK_PRESS",trackpad:"TOUCHPAD_PRESS"},pointingPoseMeshName:"POINTING_POSE"},k={axes:{touchpad:[0,1],thumbstick:[2,3]},buttons:["trigger","squeeze","touchpad","thumbstick","menu"],axisMeshNames:["TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_X","THUMBSTICK_X","THUMBSTICK_Y"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",squeeze:"GRASP",thumbstick:"THUMBSTICK_PRESS",touchpad:"TOUCHPAD_PRESS"},pointingPoseMeshName:"POINTING_POSE"},q=R?k:P;l.exports.Component=h("windows-motion-controls",{schema:{hand:{default:_},pair:{default:0},model:{default:!0},hideDisconnected:{default:!0}},after:["tracked-controls"],mapping:q,bindMethods:function(){this.onModelError=this.onModelError.bind(this),this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},init:function(){var V=this,j=this.el;this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(Q){m(Q.detail.id,"down",V)},this.onButtonUp=function(Q){m(Q.detail.id,"up",V)},this.onButtonTouchStart=function(Q){m(Q.detail.id,"touchstart",V)},this.onButtonTouchEnd=function(Q){m(Q.detail.id,"touchend",V)},this.onControllerConnected=function(){V.setModelVisibility(!0)},this.onControllerDisconnected=function(){V.setModelVisibility(!1)},this.controllerPresent=!1,this.lastControllerCheck=0,this.previousButtonValues={},this.bindMethods(),this.loadedMeshInfo={buttonMeshes:null,axisMeshes:null},this.rayOrigin={origin:new THREE.Vector3,direction:new THREE.Vector3(0,0,-1),createdFromMesh:!1},j.addEventListener("controllerconnected",this.onControllerConnected),j.addEventListener("controllerdisconnected",this.onControllerDisconnected)},addEventListeners:function(){var V=this.el;V.addEventListener("buttonchanged",this.onButtonChanged),V.addEventListener("buttondown",this.onButtonDown),V.addEventListener("buttonup",this.onButtonUp),V.addEventListener("touchstart",this.onButtonTouchStart),V.addEventListener("touchend",this.onButtonTouchEnd),V.addEventListener("axismove",this.onAxisMoved),V.addEventListener("model-error",this.onModelError),V.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var V=this.el;V.removeEventListener("buttonchanged",this.onButtonChanged),V.removeEventListener("buttondown",this.onButtonDown),V.removeEventListener("buttonup",this.onButtonUp),V.removeEventListener("touchstart",this.onButtonTouchStart),V.removeEventListener("touchend",this.onButtonTouchEnd),V.removeEventListener("axismove",this.onAxisMoved),V.removeEventListener("model-error",this.onModelError),V.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){f(this,D,{hand:this.data.hand,index:this.data.pair,iterateControllerProfiles:!0})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},updateControllerModel:function(){if(!this.data.model||this.rayOrigin.createdFromMesh){this.modelReady();return}var V=this.createControllerModelUrl();this.loadModel(V)},createControllerModelUrl:function(V){var j=this.el.components["tracked-controls"],Q=j?j.controller:null,W="default",G=this.data.hand,z;if(Q&&!window.hasNativeWebXRImplementation&&(G=Q.hand,!V)){var te=Q.id.match(N);W=te&&te[0]||W}return z=C[G]||C.default,E+W+"/"+z},injectTrackedControls:function(){var V=this.data;this.el.setAttribute("tracked-controls",{idPrefix:D,controller:V.pair,hand:V.hand,armModel:!1}),this.updateControllerModel()},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelError:function(V){var j=this.createControllerModelUrl(!0);V.detail.src!==j?(v("Failed to load controller model for device, attempting to load default."),this.loadModel(j)):v("Failed to load default controller model.")},loadModel:function(V){this.el.setAttribute("gltf-model","url("+V+")")},onModelLoaded:function(V){var j=this.controllerModel=V.detail.model,Q=this.loadedMeshInfo,W,G,z,te;if(V.target!==this.el)return;if(b("Processing model"),Q.buttonMeshes={},Q.axisMeshes={},j){for(W=0;W<this.mapping.buttons.length;W++){if(G=this.mapping.buttonMeshNames[this.mapping.buttons[W]],!G){b("Skipping unknown button at index: "+W+" with mapped name: "+this.mapping.buttons[W]);continue}if(z=j.getObjectByName(G),!z){v("Missing button mesh with name: "+G);continue}te={index:W,value:Y(z,"VALUE"),pressed:Y(z,"PRESSED"),unpressed:Y(z,"UNPRESSED")},te.value&&te.pressed&&te.unpressed?Q.buttonMeshes[this.mapping.buttons[W]]=te:v("Missing button submesh under mesh with name: "+G+"(VALUE: "+!!te.value+", PRESSED: "+!!te.pressed+", UNPRESSED:"+!!te.unpressed+")")}for(W=0;W<this.mapping.axisMeshNames.length;W++){if(G=this.mapping.axisMeshNames[W],!G){b("Skipping unknown axis at index: "+W);continue}if(z=j.getObjectByName(G),!z){v("Missing axis mesh with name: "+G);continue}te={index:W,value:Y(z,"VALUE"),min:Y(z,"MIN"),max:Y(z,"MAX")},te.value&&te.min&&te.max?Q.axisMeshes[W]=te:v("Missing axis submesh under mesh with name: "+G+"(VALUE: "+!!te.value+", MIN: "+!!te.min+", MAX:"+!!te.max+")")}this.calculateRayOriginFromMesh(j),this.setModelVisibility()}b("Model load complete.");function Y(se,ve){for(var Ae=0,me=se.children.length;Ae<me;Ae++){var Oe=se.children[Ae];if(Oe&&Oe.name===ve)return Oe}}},calculateRayOriginFromMesh:function(){var V=new THREE.Quaternion;return function(j){var Q;if(this.rayOrigin.origin.set(0,0,0),this.rayOrigin.direction.set(0,0,-1),this.rayOrigin.createdFromMesh=!0,Q=j.getObjectByName(this.mapping.pointingPoseMeshName),Q){var W=j.parent;W&&(j.parent=null,j.updateMatrixWorld(!0),j.parent=W),Q.getWorldPosition(this.rayOrigin.origin),Q.getWorldQuaternion(V),this.rayOrigin.direction.applyQuaternion(V),W&&j.updateMatrixWorld(!0)}else b("Mesh does not contain pointing origin data, defaulting to none.");this.modelReady()}}(),lerpAxisTransform:function(){var V=new THREE.Quaternion;return function(j,Q){var W=this.loadedMeshInfo.axisMeshes[j];if(W){var G=W.min,z=W.max,te=W.value,Y=Q*.5+.5;te.setRotationFromQuaternion(V.copy(G.quaternion).slerp(z.quaternion,Y)),te.position.lerpVectors(G.position,z.position,Y)}}}(),lerpButtonTransform:function(){var V=new THREE.Quaternion;return function(j,Q){var W=this.loadedMeshInfo.buttonMeshes[j];if(W){var G=W.unpressed,z=W.pressed,te=W.value;te.setRotationFromQuaternion(V.copy(G.quaternion).slerp(z.quaternion,Q)),te.position.lerpVectors(G.position,z.position,Q)}}}(),modelReady:function(){this.el.emit("controllermodelready",{name:"windows-motion-controls",model:this.data.model,rayOrigin:this.rayOrigin})},onButtonChanged:function(V){var j=this.mapping.buttons[V.detail.id];j&&(this.loadedMeshInfo&&this.loadedMeshInfo.buttonMeshes&&this.lerpButtonTransform(j,V.detail.state.value),this.el.emit(j+"changed",V.detail.state))},onAxisMoved:function(V){var j=this.mapping.axisMeshNames.length;if(this.loadedMeshInfo&&this.loadedMeshInfo.axisMeshes)for(var Q=0;Q<j;Q++)this.lerpAxisTransform(Q,V.detail.axis[Q]||0);g(this,this.mapping.axes,V)},setModelVisibility:function(V){var j=this.el.getObject3D("mesh");this.controllerPresent&&(V=V!==void 0?V:this.modelVisible,this.modelVisible=V,j&&(j.visible=V))}})},"./src/constants/index.js":(l,u,c)=>{l.exports={AFRAME_CDN_ROOT:window.AFRAME_CDN_ROOT||"https://cdn.aframe.io/",AFRAME_INJECTED:"aframe-injected",DEFAULT_CAMERA_HEIGHT:1.6,DEFAULT_HANDEDNESS:"right",keyboardevent:c("./src/constants/keyboardevent.js")}},"./src/constants/keyboardevent.js":l=>{l.exports={KEYCODE_TO_CODE:{38:"ArrowUp",37:"ArrowLeft",40:"ArrowDown",39:"ArrowRight",87:"KeyW",65:"KeyA",83:"KeyS",68:"KeyD"}}},"./src/core/a-assets.js":(l,u,c)=>{var h=c("./src/core/a-node.js").ANode,p=c("./src/utils/debug.js"),f=c("./src/lib/three.js"),g=new f.FileLoader,m=p("core:a-assets:warn");class y extends h{constructor(){super(),this.isAssets=!0,this.fileLoader=g,this.timeout=null}doConnectedCallback(){var I=this,N,D=[],P,k,q,V,j,Q;if(super.doConnectedCallback(),!this.parentNode.isScene)throw new Error("<a-assets> must be a child of a <a-scene>.");for(V=this.querySelectorAll("img"),N=0;N<V.length;N++)q=_(V[N]),D.push(new Promise(function(W,G){if(f.Cache.add(V[N].getAttribute("src"),q),q.complete){W();return}q.onload=W,q.onerror=G}));for(k=this.querySelectorAll("audio, video"),N=0;N<k.length;N++)P=_(k[N]),!P.src&&!P.srcObject&&m("Audio/video asset has neither `src` nor `srcObject` attributes."),D.push(v(P));Q=this.getChildren(),Q.forEach(function(W){!W.isAssetItem||!W.hasAttribute("src")||D.push(new Promise(function(G,z){if(W.hasLoaded)return G();W.addEventListener("loaded",G),W.addEventListener("error",z)}))}),Promise.allSettled(D).then(function(){I.timeout!==null&&I.load()}),j=parseInt(this.getAttribute("timeout"),10)||3e3,this.timeout=setTimeout(function(){I.hasLoaded||(m("Asset loading timed out in",j,"ms"),I.timeout=null,I.emit("timeout"),I.load())},j)}disconnectedCallback(){super.disconnectedCallback(),this.timeout&&clearTimeout(this.timeout)}load(){super.load.call(this,null,function(){return!1})}}customElements.define("a-assets",y);class b extends h{constructor(){super(),this.data=null,this.isAssetItem=!0}connectedCallback(){var I=this,N=this.getAttribute("src");g.setResponseType(this.getAttribute("response-type")||C(N)),g.load(N,function(D){I.data=D,h.prototype.load.call(I)},function(D){I.emit("progress",{loadedBytes:D.loaded,totalBytes:D.total,xhr:D})},function(D){I.emit("error",{xhr:D})})}}customElements.define("a-asset-item",b);function v(B){if(!(!B.hasAttribute("autoplay")&&B.getAttribute("preload")!=="auto"))return new Promise(function(I,N){if(B.readyState===4)return I();if(B.error)return N();B.addEventListener("loadeddata",D,!1),B.addEventListener("progress",D,!1),B.addEventListener("error",N,!1);function D(){for(var P=0,k=0;k<B.buffered.length;k++)P+=B.buffered.end(k)-B.buffered.start(k);P>=B.duration&&(B.tagName==="VIDEO"&&f.Cache.add(B.getAttribute("src"),B),I())}})}function _(B){var I=T(B);return I.tagName&&I.tagName.toLowerCase()==="video"&&(I.setAttribute("playsinline",""),I.setAttribute("webkit-playsinline","")),I!==B&&(B.parentNode.appendChild(I),B.parentNode.removeChild(B)),I}function T(B){var I,N;return B.hasAttribute("crossorigin")||(N=B.getAttribute("src"),N!==null&&(N.indexOf("://")===-1||E(N)===window.location.host))?B:(m('Cross-origin element (e.g., <img>) was requested without `crossorigin` set. A-Frame will re-request the asset with `crossorigin` attribute set. Please set `crossorigin` on the element (e.g., <img crossorigin="anonymous">)',N),B.crossOrigin="anonymous",I=B.cloneNode(!0),I)}function E(B){var I=B.indexOf("://")>-1?B.split("/")[2]:B.split("/")[0];return I.substring(0,I.indexOf(":"))}function C(B){var I=R(B),N=I.lastIndexOf(".");if(N>=0){var D=I.slice(N,B.search(/\?|#|$/));if(D===".glb")return"arraybuffer"}return"text"}l.exports.inferResponseType=C;function R(B){var I=document.createElement("a");I.href=B;var N=I.search.replace(/^\?/,""),D=B.replace(N,"").replace("?","");return D.substring(D.lastIndexOf("/")+1)}l.exports.getFileNameFromURL=R},"./src/core/a-cubemap.js":(l,u,c)=>{var h=c("./src/utils/debug.js"),p=h("core:cubemap:warn");class f extends HTMLElement{constructor(m){return m=super(m),m}onReadyStateChange(){document.readyState==="complete"&&this.doConnectedCallback()}connectedCallback(){if(document.readyState!=="complete"){document.addEventListener("readystatechange",this.onReadyStateChange.bind(this));return}f.prototype.doConnectedCallback.call(this)}doConnectedCallback(){this.srcs=this.validate()}validate(){var m=this.querySelectorAll("[src]"),y,b=[];if(m.length===6){for(y=0;y<m.length;y++)m[y].tagName==="IMG"?b.push(m[y]):b.push(m[y].getAttribute("src"));return b}p("<a-cubemap> did not contain exactly six elements each with a `src` attribute.")}}customElements.define("a-cubemap",f)},"./src/core/a-entity.js":(l,u,c)=>{var h=c("./src/core/a-node.js").ANode,p=c("./src/core/component.js").components,f=c("./src/lib/three.js"),g=c("./src/utils/index.js"),m=g.debug("core:a-entity:debug"),y=g.debug("core:a-entity:warn"),b="__",v=["position","rotation","scale","visible"],_={once:!0};class T extends h{constructor(){super(),this.components={},this.initializingComponents={},this.componentsToUpdate={},this.isEntity=!0,this.isPlaying=!1,this.object3D=new f.Group,this.object3D.rotation.order="YXZ",this.object3D.el=this,this.object3DMap={},this.parentEl=null,this.rotationObj={},this.states=[]}attributeChangedCallback(D,P,k){var q=this.components[D];if(super.attributeChangedCallback(),q&&q.justInitialized&&k===""){delete q.justInitialized;return}!q&&k===null||this.setEntityAttribute(D,P,k)}doConnectedCallback(){var D=this,P,k;if(super.doConnectedCallback(),k=this.sceneEl,this.addToParent(),!this.isScene){if(!k){this.load();return}if(P=k.querySelector("a-assets"),P&&!P.hasLoaded){P.addEventListener("loaded",function(){D.load()});return}this.load()}}disconnectedCallback(){var D;if(this.parentEl){for(D in this.components)this.removeComponent(D,!1);this.isScene||(this.removeFromParent(),super.disconnectedCallback(),this.object3D.el=null)}}getObject3D(D){return this.object3DMap[D]}setObject3D(D,P){var k,q=this;if(!(P instanceof f.Object3D))throw new Error("`Entity.setObject3D` was called with an object that was not an instance of THREE.Object3D.");k=this.getObject3D(D),k&&this.object3D.remove(k),P.el=this,P.children.length&&P.traverse(function(V){V.el=q}),this.object3D.add(P),this.object3DMap[D]=P,this.emit("object3dset",{object:P,type:D})}removeObject3D(D){var P=this.getObject3D(D);if(!P){y("Tried to remove `Object3D` of type:",D,"which was not defined.");return}this.object3D.remove(P),delete this.object3DMap[D],this.emit("object3dremove",{type:D})}getOrCreateObject3D(D,P){var k=this.getObject3D(D);return!k&&P&&(k=new P,this.setObject3D(D,k)),y("`getOrCreateObject3D` has been deprecated. Use `setObject3D()` and `object3dset` event instead."),k}add(D){if(!D.object3D)throw new Error("Trying to add an element that doesn't have an `object3D`");this.object3D.add(D.object3D),this.emit("child-attached",{el:D})}addToParent(){var D=this.parentEl=this.parentNode;!D||!D.add||this.attachedToParent||(D.add(this),this.attachedToParent=!0)}removeFromParent(){var D=this.parentEl;this.parentEl.remove(this),this.attachedToParent=!1,this.parentEl=null,D.emit("child-detached",{el:this})}load(){var D=this;this.hasLoaded||!this.parentEl||super.load.call(this,function(){D.parentEl&&(D.updateComponents(),(D.isScene||D.parentEl.isPlaying)&&D.play())})}remove(D){D?this.object3D.remove(D.object3D):this.parentNode.removeChild(this)}getChildEntities(){for(var D=this.children,P=[],k=0;k<D.length;k++){var q=D[k];q instanceof T&&P.push(q)}return P}initComponent(D,P,k){var q,V,j,Q,W;j=g.split(D,b),Q=j[0],V=j.length>2?j.slice(1).join("__"):j[1],p[Q]&&(W=E(this,D)||P!==void 0,!(!W&&!k)&&(D in this.components||(this.initComponentDependencies(Q),q=new p[Q].Component(this,P,V),this.isPlaying&&q.play(),this.hasAttribute(D)||(q.justInitialized=!0,window.HTMLElement.prototype.setAttribute.call(this,D,"")),m("Component initialized: %s",D))))}initComponentDependencies(D){var P=this,k=p[D],q,V;if(k&&(q=p[D].dependencies,!!q))for(V=0;V<q.length;V++)P.initComponent(q[V],window.HTMLElement.prototype.getAttribute.call(P,q[V])||void 0,!0)}removeComponent(D,P){var k;if(k=this.components[D],!!k){if(!k.initialized){this.addEventListener("componentinitialized",function q(V){V.detail.name===D&&(this.removeComponent(D,P),this.removeEventListener("componentinitialized",q))});return}k.pause(),k.remove(),P&&(k.destroy(),delete this.components[D],this.hasAttribute(D)&&window.HTMLElement.prototype.removeAttribute.call(this,D)),this.emit("componentremoved",k.evtDetail,!1)}}updateComponents(){var D,P,k,q,V=this.componentsToUpdate;if(!(!this.hasLoaded&&!this.isLoading)){for(k=0;k<this.mixinEls.length;k++)for(q in this.mixinEls[k].componentCache)B(q)&&(V[q]=!0);if(this.getExtraComponents){P=this.getExtraComponents();for(q in P)B(q)&&(V[q]=!0)}for(k=0;k<this.attributes.length;++k)q=this.attributes[k].name,v.indexOf(q)===-1&&B(q)&&(V[q]=!0);for(k=0;k<v.length;k++)q=v[k],this.hasAttribute(q)&&this.updateComponent(q,this.getDOMAttribute(q));for(q in V)D=R(this.getDOMAttribute(q),P&&P[q]),this.updateComponent(q,D),delete V[q]}}updateComponent(D,P,k){var q=this.components[D];if(q){if(P===null&&!E(this,D)){this.removeComponent(D,!0);return}q.updateProperties(P,k);return}this.initComponent(D,P,!1)}removeAttribute(D,P){var k=this.components[D];if(k&&P===void 0&&this.removeComponent(D,!0),k&&P!==void 0){k.resetProperty(P);return}D==="mixin"&&this.mixinUpdate(""),window.HTMLElement.prototype.removeAttribute.call(this,D)}play(){var D,P,k;if(!(this.isPlaying||!this.hasLoaded&&!this.isLoading)){this.isPlaying=!0;for(k in this.components)this.components[k].play();for(D=this.getChildEntities(),P=0;P<D.length;P++)D[P].play();this.emit("play")}}pause(){var D,P,k;if(this.isPlaying){this.isPlaying=!1;for(k in this.components)this.components[k].pause();for(D=this.getChildEntities(),P=0;P<D.length;P++)D[P].pause();this.emit("pause")}}setEntityAttribute(D,P,k){if(p[D]||this.components[D]){this.updateComponent(D,k);return}if(D==="mixin"){if(k===this.computedMixinStr)return;this.mixinUpdate(k,P)}}mixinUpdate(D,P,k){var q=T.componentsUpdated,V,j,Q,W,G=this;if(k||(P=P||this.getAttribute("mixin")),!this.hasLoaded){this.addEventListener("loaded-private",function(){G.mixinUpdate(D,P,!0)},_);return}for(Q=this.updateMixins(D,P),q.length=0,W=0;W<this.mixinEls.length;W++)for(V in this.mixinEls[W].componentCache)q.indexOf(V)===-1&&(this.components[V]?this.components[V].handleMixinUpdate():this.initComponent(V,null),q.push(V));for(W=0;W<Q.oldMixinIds.length;W++)if(j=document.getElementById(Q.oldMixinIds[W]),!!j)for(V in j.componentCache)q.indexOf(V)===-1&&this.components[V]&&(this.getDOMAttribute(V)?this.components[V].handleMixinUpdate():this.removeComponent(V,!0))}setAttribute(D,P,k){var q=T.singlePropUpdate,V,j,Q,W,G,z;if(W=D.indexOf(b),Q=W>0?D.substring(0,W):D,!p[Q]){D==="mixin"&&this.mixinUpdate(P),super.setAttribute.call(this,D,P);return}if(!this.components[D]&&this.hasAttribute(D)&&this.updateComponent(D,window.HTMLElement.prototype.getAttribute.call(this,D)),typeof k<"u"&&typeof P=="string"&&P.length>0&&typeof g.styleParser.parse(P)=="string"){for(z in q)delete q[z];V=q,V[P]=k,j=!1}else V=P,j=k===!0;this.updateComponent(D,V,j),G=this.sceneEl&&this.sceneEl.getAttribute("debug"),G&&this.components[D].flushToDOM()}flushToDOM(D){var P=this.components,k,q=this.children,V,j;for(j in P)P[j].flushToDOM();if(D)for(V=0;V<q.length;++V)k=q[V],k.flushToDOM&&k.flushToDOM(D)}getAttribute(D){var P;return D==="position"?this.object3D.position:D==="rotation"?I(this):D==="scale"?this.object3D.scale:D==="visible"?this.object3D.visible:(P=this.components[D],P?P.data:window.HTMLElement.prototype.getAttribute.call(this,D))}getDOMAttribute(D){var P=this.components[D];return P?P.attrValue:window.HTMLElement.prototype.getAttribute.call(this,D)}addState(D){this.is(D)||(this.states.push(D),this.emit("stateadded",D))}removeState(D){var P=this.states.indexOf(D);P!==-1&&(this.states.splice(P,1),this.emit("stateremoved",D))}is(D){return this.states.indexOf(D)!==-1}inspect(){this.sceneEl.components.inspector.openInspector(this)}destroy(){var D;if(this.parentNode){y("Entity can only be destroyed if detached from scenegraph.");return}for(D in this.components)this.components[D].destroy()}}function E(N,D){return N.components[D]&&N.components[D].attrValue?!0:C(D,N.mixinEls)}function C(N,D){var P,k=!1;for(P=0;P<D.length&&(k=D[P].hasAttribute(N),!k);++P);return k}function R(N,D){return D?D.constructor===Object?g.extend(D,g.styleParser.parse(N||{})):N||D:N}function B(N){return N.indexOf(b)!==-1&&(N=g.split(N,b)[0]),!!p[N]}function I(N){var D=f.MathUtils.radToDeg,P=N.object3D.rotation,k=N.rotationObj;return k.x=D(P.x),k.y=D(P.y),k.z=D(P.z),k}T.componentsUpdated=[],T.singlePropUpdate={},customElements.define("a-entity",T),l.exports.AEntity=T},"./src/core/a-mixin.js":(l,u,c)=>{var h=c("./src/core/a-node.js").ANode,p=c("./src/core/component.js").components,f=c("./src/utils/index.js"),g=f.styleParser,m="__";class y extends h{constructor(){super(),this.componentCache={},this.rawAttributeCache={},this.isMixin=!0}doConnectedCallback(){super.doConnectedCallback(),this.sceneEl=this.closestScene(),this.id=this.getAttribute("id"),this.cacheAttributes(),this.updateEntities(),this.load()}attributeChangedCallback(v,_,T){super.attributeChangedCallback(),this.cacheAttribute(v,T),this.updateEntities()}setAttribute(v,_){window.HTMLElement.prototype.setAttribute.call(this,v,_),this.cacheAttribute(v,_)}cacheAttribute(v,_){var T,E;E=f.split(v,m)[0],T=p[E],_===void 0&&(_=window.HTMLElement.prototype.getAttribute.call(this,v)),this.rawAttributeCache[v]=_,T&&(this.componentCache[v]=this.parseComponentAttrValue(T,_))}parseComponentAttrValue(v,_){var T;return typeof _!="string"?_:(v.isSingleProperty?(T=v.schema.parse(_),typeof T=="string"&&(T=_)):T=g.parse(_),T)}getAttribute(v){return this.componentCache[v]||window.HTMLElement.prototype.getAttribute.call(this,v)}cacheAttributes(){var v=this.attributes,_,T;for(T=0;T<v.length;T++)_=v[T].name,this.cacheAttribute(_)}updateEntities(){var v,_,T;if(this.sceneEl)for(_=this.sceneEl.querySelectorAll("[mixin~="+this.id+"]"),T=0;T<_.length;T++)v=_[T],!(!v.hasLoaded||v.isMixin)&&v.mixinUpdate(this.id)}}customElements.define("a-mixin",y)},"./src/core/a-node.js":(l,u,c)=>{var h=c("./src/utils/index.js"),p=c("./src/core/readyState.js"),f=h.debug("core:a-node:warn"),g={"a-scene":!0,"a-assets":!0,"a-assets-items":!0,"a-cubemap":!0,"a-mixin":!0,"a-node":!0,"a-entity":!0};function m(b){return b.tagName.toLowerCase()in g||b.isNode}class y extends HTMLElement{constructor(){super(),this.computedMixinStr="",this.hasLoaded=!1,this.isNode=!0,this.mixinEls=[]}connectedCallback(){if(!p.canInitializeElements){document.addEventListener("aframeready",this.connectedCallback.bind(this));return}this.doConnectedCallback()}doConnectedCallback(){var v;this.sceneEl=this.closestScene(),this.sceneEl||f("You are attempting to attach <"+this.tagName+"> outside of an A-Frame scene. Append this element to `<a-scene>` instead."),this.hasLoaded=!1,this.emit("nodeready",void 0,!1),this.isMixin||(v=this.getAttribute("mixin"),v&&this.updateMixins(v))}attributeChangedCallback(v,_,T){T!==this.computedMixinStr&&v==="mixin"&&!this.isMixin&&this.updateMixins(T,_)}closestScene(){for(var v=this;v&&!v.isScene;)v=v.parentElement;return v}closest(v){for(var _=this.matches||this.mozMatchesSelector||this.msMatchesSelector||this.oMatchesSelector||this.webkitMatchesSelector,T=this;T&&!_.call(T,v);)T=T.parentElement;return T}disconnectedCallback(){this.hasLoaded=!1}load(v,_){var T,E,C=this;this.hasLoaded||(_=_||m,T=this.getChildren(),E=T.filter(_).map(function(R){return new Promise(function(B,I){if(R.hasLoaded)return B();R.addEventListener("loaded",B),R.addEventListener("error",I)})}),Promise.allSettled(E).then(function(R){R.forEach(function(B){B.status==="rejected"&&f("Rendering scene with errors on node: ",B.reason.target)}),C.isLoading=!0,C.setupMutationObserver(),v&&v(),C.isLoading=!1,C.hasLoaded=!0,C.emit("loaded-private",void 0,!1),C.emit("loaded",void 0,!1)}))}setupMutationObserver(){var v=this,_={attributes:!0,attributeOldValue:!0},T=new MutationObserver(function(E){var C;for(C=0;C<E.length;C++)if(E[C].type==="attributes"){var R=E[C].attributeName,B=window.HTMLElement.prototype.getAttribute.call(v,R),I=E[C].oldValue;v.attributeChangedCallback(R,I,B)}});T.observe(this,_)}getChildren(){return Array.prototype.slice.call(this.children,0)}updateMixins(v,_){var T=y.newMixinIdArray,E=y.oldMixinIdArray,C=y.mixinIds,R,B,I;for(T.length=0,E.length=0,B=v?h.split(v.trim(),/\s+/):T,I=_?h.split(_.trim(),/\s+/):E,C.newMixinIds=B,C.oldMixinIds=I,R=0;R<I.length;R++)B.indexOf(I[R])===-1&&this.unregisterMixin(I[R]);for(this.computedMixinStr="",this.mixinEls.length=0,R=0;R<B.length;R++)this.registerMixin(B[R]);return this.computedMixinStr&&(this.computedMixinStr=this.computedMixinStr.trim(),window.HTMLElement.prototype.setAttribute.call(this,"mixin",this.computedMixinStr)),B.length===0&&window.HTMLElement.prototype.removeAttribute.call(this,"mixin"),C}registerMixin(v){var _,T,E,C=document.getElementById(v);if(!C){f("No mixin was found with id `%s`",v);return}if(E=C.getAttribute("mixin"),E)for(_=h.split(E.trim(),/\s+/),T=0;T<_.length;T++)this.registerMixin(_[T]);this.computedMixinStr=this.computedMixinStr+" "+C.id,this.mixinEls.push(C)}setAttribute(v,_){v==="mixin"&&this.updateMixins(_),window.HTMLElement.prototype.setAttribute.call(this,v,_)}unregisterMixin(v){var _,T=this.mixinEls,E;for(_=0;_<T.length;++_)if(E=T[_],v===E.id){T.splice(_,1);break}}emit(v,_,T,E){var C=y.evtData;T===void 0&&(T=!0),C.bubbles=!!T,C.detail=_,E&&(C=h.extend({},E,C)),this.dispatchEvent(new CustomEvent(v,C))}}y.evtData={},y.newMixinIdArray=[],y.oldMixinIdArray=[],y.mixinIds={},customElements.define("a-node",y),l.exports.ANode=y,l.exports.knownTags=g},"./src/core/component.js":(l,u,c)=>{var h=c("./src/core/schema.js"),p=c("./src/core/scene/scenes.js"),f=c("./src/core/system.js"),g=c("./src/utils/index.js"),m=l.exports.components={},y=h.parseProperty,b=h.process,v=h.isSingleProperty,_=h.stringifyProperties,T=h.stringifyProperty,E=g.styleParser,C=g.debug("core:component:warn"),R=document.currentScript,B=new RegExp("[A-Z]+"),I={},N=Object.freeze({}),D=[],P={get:function(z,te){return z.getComputedPropertyValue(te)},set:function(z,te,Y){return te in z.schema?z.recomputeProperty(te,Y):Y!==void 0&&z.handleUnknownProperty(te,Y),!0}},k=l.exports.Component=function(z,te,Y){var se=this;if(this.sceneOnly&&!z.isScene)throw new Error("Component `"+this.name+"` can only be applied to <a-scene>");if(Y&&!this.multiple)throw new Error("Trying to initialize multiple components of type `"+this.name+"`. There can only be one component of this type per entity.");this.el=z,this.id=Y,this.attrName=this.name+(Y?"__"+Y:""),this.evtDetail={id:this.id,name:this.name},this.initialized=!1,this.el.components[this.attrName]=this,this.objectPool=I[this.name];var ve=this.events;this.events={},q(this,ve),this.attrValue=void 0,this.isObjectBased?(this.data=this.objectPool.use(),g.objectPool.removeUnusedKeys(this.data,this.schema),this.oldData=this.objectPool.use(),g.objectPool.removeUnusedKeys(this.oldData,this.schema),this.attrValueProxy=new Proxy(this,P)):(this.data=void 0,this.oldData=void 0,this.attrValueProxy=void 0),this.deferUnknownPropertyWarnings=!!this.updateSchema,this.silenceUnknownPropertyWarnings=!1,this.throttledEmitComponentChanged=g.throttleLeadingAndTrailing(function(){z.emit("componentchanged",se.evtDetail,!1)},200),this.updateProperties(te,!0)};k.prototype={schema:{},init:function(){},events:{},update:function(z){},updateSchema:void 0,tick:void 0,tock:void 0,play:function(){},pause:function(){},remove:function(){},stringify:function(z){var te=this.schema;return typeof z=="string"?z:this.isSingleProperty?T(z,te):(z=_(z,te),E.stringify(z))},flushToDOM:function(z){var te=z?this.data:this.attrValue;te!=null&&window.HTMLElement.prototype.setAttribute.call(this.el,this.attrName,this.stringify(te))},updateProperties:function(z,te){var Y=this.el;this.updateData(z,te),!(!Y.hasLoaded&&!Y.isLoading)&&(this.initialized?this.callUpdateHandler():this.initComponent())},initComponent:function(){var z=this.el,te;z.initializingComponents[this.name]||(z.initializingComponents[this.name]=!0,this.init(),this.initialized=!0,delete z.initializingComponents[this.name],te=this.isObjectBased?N:void 0,this.dataChanged=!1,this.storeOldData(),this.update(te),z.isPlaying&&this.play(),z.emit("componentinitialized",this.evtDetail,!1))},updateData:function(z,te){if(this.isSingleProperty){this.recomputeProperty(void 0,z);return}te?(g.objectPool.clearObject(this.attrValue),this.recomputeData(z),this.schemaChangeRequired=!!this.updateSchema):typeof z=="string"?E.parse(z,this.attrValueProxy):g.extend(this.attrValueProxy,z),this.updateSchemaIfNeeded(z)},updateSchemaIfNeeded:function(z){if(!this.schemaChangeRequired||!this.updateSchema){for(var te=0;te<D.length;te++)C("Unknown property `"+D[te]+"` for component `"+this.name+"`.");D.length=0;return}D.length=0,this.updateSchema(this.data),g.objectPool.removeUnusedKeys(this.data,this.schema),this.silenceUnknownPropertyWarnings=!0,this.recomputeData(z),this.silenceUnknownPropertyWarnings=!1,this.schemaChangeRequired=!1},callUpdateHandler:function(){if(!(!this.isPositionRotationScale&&!this.dataChanged)){this.dataChanged=!1;var z=this.oldData;this.oldDataInUse=!0,this.update(z),z!==this.oldData&&this.objectPool.recycle(z),this.oldDataInUse=!1,this.storeOldData(),this.throttledEmitComponentChanged()}},handleMixinUpdate:function(){this.recomputeData(),this.updateSchemaIfNeeded(),this.callUpdateHandler()},resetProperty:function(z){!this.isSingleProperty&&!(z in this.schema)||(z?this.attrValue[z]=void 0:(this.isObjectBased&&this.objectPool.recycle(this.attrValue),this.attrValue=void 0),this.recomputeProperty(z,void 0),this.updateSchemaIfNeeded(),this.callUpdateHandler())},extendSchema:function(z){var te;te=g.extend({},m[this.name].schema),g.extend(te,z),this.schema=b(te),this.el.emit("schemachanged",this.evtDetail)},getComputedPropertyValue:function(z){var te=this.el.mixinEls,Y=this.attrValue&&z?this.attrValue[z]:this.attrValue;if(Y!==void 0)return Y;for(var se=te.length-1;se>=0;se--){var ve=te[se].getAttribute(this.attrName);if(!(ve===null||z&&!(z in ve)))return z?ve[z]:ve}var Ae=z?this.schema[z].default:this.schema.default;return Ae},recomputeProperty:function(z,te){var Y=z?this.schema[z]:this.schema;if(te!=null){this.attrValue===void 0&&this.isObjectBased&&(this.attrValue=this.objectPool.use());var se=z?this.attrValue[z]:this.attrValue;se=Y.isCacheable?y(te,Y,se):te,typeof se=="string"&&(se=te===""?void 0:te),z?this.attrValue[z]=se:this.attrValue=se}this.oldDataInUse&&(this.oldData=this.objectPool.use(),g.objectPool.removeUnusedKeys(this.oldData,this.schema),this.storeOldData(),this.oldDataInUse=!1);var ve=z?this.oldData[z]:this.oldData,Ae=z?this.data[z]:this.data,me=y(this.getComputedPropertyValue(z),Y,Ae);return Y.type==="array"&&!z&&(me=g.clone(me)),Y.equals(me,ve)||(this.dataChanged=!0,Y.schemaChange&&(this.schemaChangeRequired=!0)),z?this.data[z]=me:this.data=me,me},handleUnknownProperty:function(z,te){this.attrValue===void 0&&(this.attrValue=this.objectPool.use()),this.attrValue[z]=te,this.silenceUnknownPropertyWarnings||(this.deferUnknownPropertyWarnings?D.push(z):this.silenceUnknownPropertyWarnings||C("Unknown property `"+z+"` for component `"+this.name+"`."))},storeOldData:function(){if(!this.isObjectBased){this.oldData=this.data;return}if(this.isSingleProperty){this.oldData=y(this.data,this.schema,this.oldData);return}var z;for(z in this.schema)this.data[z]!==void 0&&(this.data[z]&&typeof this.data[z]=="object"?this.oldData[z]=y(this.data[z],this.schema[z],this.oldData[z]):this.oldData[z]=this.data[z])},recomputeData:function(z){var te;if(this.isSingleProperty){this.recomputeProperty(void 0,z);return}if(z&&typeof z=="object")for(te in this.schema)this.attrValueProxy[te]=z[te];else for(te in this.schema)this.attrValueProxy[te]=void 0;typeof z=="string"&&E.parse(z,this.attrValueProxy);for(te in this.attrValue)this.attrValue[te]!==void 0&&D.indexOf(te)!==-1&&(te in this.schema||C("Unknown property `"+te+"` for component `"+this.name+"`."))},eventsAttach:function(){var z;this.eventsDetach();for(z in this.events)this.el.addEventListener(z,this.events[z])},eventsDetach:function(){var z;for(z in this.events)this.el.removeEventListener(z,this.events[z])},destroy:function(){this.objectPool.recycle(this.attrValue),this.objectPool.recycle(this.data),this.objectPool.recycle(this.oldData),this.attrValue=this.data=this.oldData=this.attrValueProxy=void 0}};function q(z,te){var Y;for(Y in te)z.events[Y]=te[Y].bind(z)}if(window.debug)var V=l.exports.registrationOrderWarnings={};l.exports.registerComponent=function(z,te){var Y,se={},ve,Ae;if(document.currentScript&&document.currentScript!==R&&p.forEach(function(Oe){Oe.hasLoaded||document.currentScript.compareDocumentPosition(Oe)!==Node.DOCUMENT_POSITION_FOLLOWING&&(C("The component `"+z+"` was registered in a <script> tag after the scene. Component <script> tags in an HTML file should be declared *before* the scene such that the component is available to entities during scene initialization."),window.debug&&(V[z]=!0))}),B.test(z)===!0&&C("The component name `"+z+"` contains uppercase characters, but HTML will ignore the capitalization of attribute names. Change the name to be lowercase: `"+z.toLowerCase()+"`"),z.indexOf("__")!==-1)throw new Error("The component name `"+z+"` is not allowed. The sequence __ (double underscore) is reserved to specify an id for multiple components of the same type");if(Object.keys(te).forEach(function(Oe){se[Oe]={value:te[Oe],writable:!0}}),m[z])throw new Error("The component `"+z+"` has been already registered. Check that you are not loading two versions of the same component or two different components of the same name.");Y=function(Oe,Xe,Je){k.call(this,Oe,Xe,Je)},Y.prototype=Object.create(k.prototype,se),Y.prototype.name=z,Y.prototype.isPositionRotationScale=z==="position"||z==="rotation"||z==="scale",Y.prototype.constructor=Y,Y.prototype.system=f&&f.systems[z],Y.prototype.play=W(Y.prototype.play),Y.prototype.pause=Q(Y.prototype.pause),ve=g.extend(b(Y.prototype.schema,Y.prototype.name)),Y.prototype.isSingleProperty=Ae=v(Y.prototype.schema),Y.prototype.isObjectBased=!Ae||Ae&&(G(ve.default)||G(y(void 0,ve))),I[z]=g.objectPool.createPool(),m[z]={Component:Y,dependencies:Y.prototype.dependencies,before:Y.prototype.before,after:Y.prototype.after,isSingleProperty:Y.prototype.isSingleProperty,isObjectBased:Y.prototype.isObjectBased,multiple:Y.prototype.multiple,sceneOnly:Y.prototype.sceneOnly,name:z,schema:ve,stringify:Y.prototype.stringify};for(var me=0;me<p.length;me++)p[me].emit("componentregistered",{name:z},!1);return Y};function j(z){return z.tick||z.tock}function Q(z){return function(){var te=this.el.sceneEl;this.isPlaying&&(z.call(this),this.isPlaying=!1,this.eventsDetach(),j(this)&&te.removeBehavior(this))}}function W(z){return function(){var te=this.el.sceneEl,Y=this.el.isPlaying&&!this.isPlaying;!this.initialized||!Y||(z.call(this),this.isPlaying=!0,this.eventsAttach(),j(this)&&te.addBehavior(this))}}function G(z){return z&&z.constructor===Object&&!(z instanceof window.HTMLElement)}},"./src/core/geometry.js":(l,u,c)=>{var h=c("./src/core/schema.js"),p=h.process,f=l.exports.geometries={},g=l.exports.geometryNames=[],m=c("./src/lib/three.js"),y=l.exports.Geometry=function(){};y.prototype={schema:{},init:function(b){return this.geometry=new m.BufferGeometry,this.geometry},update:function(b){}},l.exports.registerGeometry=function(b,v){var _,T={};if(Object.keys(v).forEach(function(E){T[E]={value:v[E],writable:!0}}),f[b])throw new Error("The geometry `"+b+"` has been already registered");return _=function(){y.call(this)},_.prototype=Object.create(y.prototype,T),_.prototype.name=b,_.prototype.constructor=_,f[b]={Geometry:_,schema:p(_.prototype.schema)},g.push(b),_}},"./src/core/propertyTypes.js":(l,u,c)=>{var h=c("./src/utils/coordinates.js"),p=c("./node_modules/debug/src/browser.js"),f=p("core:propertyTypes:warn"),g=l.exports.propertyTypes={},m=/[,> .[\]:]/,y=/url\((.+)\)/;b("audio","",E),b("array",[],v,_,T),b("asset","",E),b("boolean",!1,I),b("color","#FFF"),b("int",0,N),b("number",0,D),b("map","",E),b("model","",E),b("selector",null,P,q,B,!1),b("selectorAll",null,k,V,T,!1),b("src","",j),b("string",""),b("time",0,N),b("vec2",{x:0,y:0},Q,h.stringify,h.equals),b("vec3",{x:0,y:0,z:0},Q,h.stringify,h.equals),b("vec4",{x:0,y:0,z:0,w:1},Q,h.stringify,h.equals);function b(z,te,Y,se,ve,Ae){if(z in g)throw new Error("Property type "+z+" is already registered.");g[z]={default:te,parse:Y||C,stringify:se||R,equals:ve||B,isCacheable:Ae!==!1}}l.exports.registerPropertyType=b;function v(z){if(Array.isArray(z))return z;if(!z||typeof z!="string")return[];return z.split(",").map(te);function te(Y){return Y.trim()}}function _(z){return z.join(", ")}function T(z,te){if(!Array.isArray(z)||!Array.isArray(te))return z===te;if(z.length!==te.length)return!1;for(var Y=0;Y<z.length;Y++)if(z[Y]!==te[Y])return!1;return!0}function E(z){var te,Y;if(typeof z!="string")return z;if(Y=z.match(y),Y)return Y[1];if(z.charAt(0)==="#"){if(te=document.getElementById(z.substring(1)),te)return te.tagName==="CANVAS"||te.tagName==="VIDEO"||te.tagName==="IMG"?te:te.getAttribute("src");f('"'+z+'" asset not found.');return}return z}function C(z){return z}function R(z){return z===null?"null":z.toString()}function B(z,te){return z===te}function I(z){return z!=="false"&&z!==!1}function N(z){return parseInt(z,10)}function D(z){return parseFloat(z,10)}function P(z){return z?typeof z!="string"?z:z[0]==="#"&&!m.test(z)?document.getElementById(z.substring(1)):document.querySelector(z):null}function k(z){return z?typeof z!="string"?z:Array.prototype.slice.call(document.querySelectorAll(z),0):null}function q(z){return z.getAttribute?"#"+z.getAttribute("id"):R(z)}function V(z){return z instanceof Array?z.map(function(te){return"#"+te.getAttribute("id")}).join(", "):R(z)}function j(z){return f("`src` property type is deprecated. Use `asset` instead."),E(z)}function Q(z,te,Y){return h.parse(z,te,Y)}function W(z,te){return z==="audio"&&typeof te!="string"||z==="array"&&!Array.isArray(te)||z==="asset"&&typeof te!="string"||z==="boolean"&&typeof te!="boolean"||z==="color"&&typeof te!="string"||z==="int"&&typeof te!="number"||z==="number"&&typeof te!="number"||z==="map"&&typeof te!="string"||z==="model"&&typeof te!="string"||z==="selector"&&typeof te!="string"&&te!==null||z==="selectorAll"&&typeof te!="string"&&te!==null||z==="src"&&typeof te!="string"||z==="string"&&typeof te!="string"||z==="time"&&typeof te!="number"?!1:z==="vec2"?G(te,2):z==="vec3"?G(te,3):z==="vec4"?G(te,4):!0}l.exports.isValidDefaultValue=W;function G(z,te){if(z===null)return!0;if(typeof z!="object"||Object.keys(z).length!==te)return!1;var Y=z.x,se=z.y,ve=z.z,Ae=z.w;return!(typeof Y!="number"||typeof se!="number"||te>2&&typeof ve!="number"||te>3&&typeof Ae!="number")}l.exports.isValidDefaultCoordinate=G},"./src/core/readyState.js":l=>{l.exports.canInitializeElements=!1;function u(){if(document.readyState==="complete"){c();return}document.addEventListener("readystatechange",function h(){document.readyState==="complete"&&(document.removeEventListener("readystatechange",h),c())})}l.exports.waitForDocumentReadyState=u;function c(){l.exports.canInitializeElements||(l.exports.canInitializeElements=!0,setTimeout(function(){document.dispatchEvent(new CustomEvent("aframeready"))}))}l.exports.emitReady=c},"./src/core/scene/a-scene.js":(l,u,c)=>{var h=c("./src/core/scene/metaTags.js").inject,p=c("./src/core/scene/wakelock.js"),f=c("./src/core/scene/loadingScreen.js"),g=c("./src/core/scene/scenes.js"),m=c("./src/core/system.js").systems,y=c("./src/core/component.js").components,b=c("./src/lib/three.js"),v=c("./src/utils/index.js"),_=v.debug("core:a-scene:warn"),T=c("./src/core/a-entity.js").AEntity,E=c("./src/core/a-node.js").ANode,C=c("./src/core/scene/postMessage.js"),R=v.device.isIOS(),B=v.device.isMobile(),I=v.device.isWebXRAvailable;R&&c("./src/utils/ios-orientationchange-blank-bug.js");class N extends T{constructor(){var G;super(),G=this,G.clock=new b.Clock,G.isIOS=R,G.isMobile=B,G.hasWebXR=I,G.isAR=!1,G.isScene=!0,G.object3D=new b.Scene,G.object3D.onAfterRender=function(z,te,Y){G.isPlaying&&G.tock(G.time,G.delta,Y)},G.resize=G.resize.bind(G),G.render=G.render.bind(G),G.systems={},G.systemNames=[],G.time=G.delta=0,G.usedOfferSession=!1,G.componentOrder=[],G.behaviors={},G.hasLoaded=!1,G.isPlaying=!1,G.originalHTML=G.innerHTML}addFullScreenStyles(){document.documentElement.classList.add("a-fullscreen")}removeFullScreenStyles(){document.documentElement.classList.remove("a-fullscreen")}doConnectedCallback(){var G=this,z=this.hasAttribute("embedded");this.setAttribute("inspector",""),this.setAttribute("keyboard-shortcuts",""),this.setAttribute("screenshot",""),this.setAttribute("xr-mode-ui",""),this.setAttribute("device-orientation-permission-ui",""),super.doConnectedCallback(),Q(this),this.setupRenderer(),f.setup(this,k),this.resize(),z||this.addFullScreenStyles(),C(this),h(this),p(this),this.onVRPresentChangeBound=this.onVRPresentChange.bind(this),window.addEventListener("vrdisplaypresentchange",this.onVRPresentChangeBound),this.enterVRBound=function(){G.enterVR()},this.exitVRBound=function(){G.exitVR()},this.exitVRTrueBound=function(){G.exitVR(!0)},this.pointerRestrictedBound=function(){G.pointerRestricted()},this.pointerUnrestrictedBound=function(){G.pointerUnrestricted()},G.hasWebXR||(window.addEventListener("vrdisplaydeactivate",this.exitVRBound),window.addEventListener("vrdisplaydisconnect",this.exitVRTrueBound),window.addEventListener("vrdisplaypointerrestricted",this.pointerRestrictedBound),window.addEventListener("vrdisplaypointerunrestricted",this.pointerUnrestrictedBound)),window.addEventListener("sessionend",this.resize),this.addEventListener("cameraready",function(){G.attachedCallbackPostCamera()}),this.initSystems(),this.componentOrder=D(y,this.componentOrder),this.addEventListener("componentregistered",function(){G.componentOrder=D(y,G.componentOrder)}),this.hasWebXR&&navigator.xr&&navigator.xr.addEventListener&&navigator.xr.addEventListener("sessiongranted",function(){G.enterVR()})}attachedCallbackPostCamera(){var G,z=this;window.addEventListener("load",G),window.addEventListener("resize",function(){z.isIOS?setTimeout(z.resize,100):z.resize()}),this.play(),g.push(this)}initSystems(){var G;this.initSystem("camera");for(G in m)G!=="camera"&&this.initSystem(G)}initSystem(G){this.systems[G]||(this.systems[G]=new m[G](this),this.systemNames.push(G))}disconnectedCallback(){var G=g.indexOf(this);super.disconnectedCallback(),g.splice(G,1),window.removeEventListener("vrdisplaypresentchange",this.onVRPresentChangeBound),window.removeEventListener("vrdisplayactivate",this.enterVRBound),window.removeEventListener("vrdisplaydeactivate",this.exitVRBound),window.removeEventListener("vrdisplayconnect",this.enterVRBound),window.removeEventListener("vrdisplaydisconnect",this.exitVRTrueBound),window.removeEventListener("vrdisplaypointerrestricted",this.pointerRestrictedBound),window.removeEventListener("vrdisplaypointerunrestricted",this.pointerUnrestrictedBound),window.removeEventListener("sessionend",this.resize),this.renderer.dispose()}addBehavior(G){var z,te=this.behaviors[G.name],Y;te||(te=this.behaviors[G.name]={tick:{inUse:!1,array:[],markedForRemoval:[]},tock:{inUse:!1,array:[],markedForRemoval:[]}});for(Y in te)if(G[Y]){if(z=te[Y],z.inUse){var se=z.markedForRemoval.indexOf(G);se!==-1&&z.markedForRemoval.splice(se,1)}z.array.indexOf(G)===-1&&z.array.push(G)}}getPointerLockElement(){return document.pointerLockElement}checkHeadsetConnected(){return v.device.checkHeadsetConnected()}enterAR(){var G;if(!this.hasWebXR)throw G="Failed to enter AR mode, WebXR not supported.",new Error(G);if(!v.device.checkARSupport())throw G="Failed to enter AR, WebXR immersive-ar mode not supported in your browser or device.",new Error(G);return this.enterVR(!0)}enterVR(G,z){var te=this,Y,se=te.renderer.xr,ve;if(z&&(!navigator.xr||!navigator.xr.offerSession))return Promise.resolve("OfferSession is not supported.");if(te.usedOfferSession&&z)return Promise.resolve("OfferSession was already called.");if(this.is("vr-mode"))return Promise.resolve("Already in VR.");if(this.checkHeadsetConnected()||this.isMobile){var Ae=te.getAttribute("renderer");if(se.enabled=!0,this.hasWebXR){this.xrSession&&this.xrSession.removeEventListener("end",this.exitVRBound);var me=this.sceneEl.systems.webxr.sessionReferenceSpaceType;se.setReferenceSpaceType(me);var Oe=G?"immersive-ar":"immersive-vr";return ve=this.sceneEl.systems.webxr.sessionConfiguration,new Promise(function(dt,St){var Qt=z?navigator.xr.offerSession.bind(navigator.xr):navigator.xr.requestSession.bind(navigator.xr);te.usedOfferSession|=z,Qt(Oe,ve).then(function(yt){z&&(te.usedOfferSession=!1),se.layersEnabled=ve.requiredFeatures.indexOf("layers")!==-1,se.setSession(yt).then(function(){se.setFoveation(Ae.foveationLevel),te.xrSession=yt,te.systems.renderer.setWebXRFrameRate(yt),yt.addEventListener("end",te.exitVRBound),Je(dt)})},function(yt){var bi=Oe==="immersive-ar",$e=bi?"AR":"VR";St(new Error("Failed to enter "+$e+" mode (`requestSession`)",{cause:yt}))})})}else{if(Y=v.device.getVRDisplay(),se.setDevice(Y),Y.isPresenting&&!window.hasNativeWebVRImplementation)return Je(),Promise.resolve();var Xe={highRefreshRate:Ae.highRefreshRate};return Y.requestPresent([{source:this.canvas,attributes:Xe}]).then(Je,it)}}return Je(),Promise.resolve();function Je(dt){var St;window.hasNativeWebVRImplementation&&!window.hasNativeWebXRImplementation&&(St=new CustomEvent("vrdisplaypresentchange",{detail:{display:v.device.getVRDisplay()}}),window.dispatchEvent(St)),G?te.addState("ar-mode"):te.addState("vr-mode"),te.emit("enter-vr",{target:te}),!te.hasWebXR&&te.isMobile&&screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape"),te.addFullScreenStyles(),!te.isMobile&&!te.checkHeadsetConnected()&&V(te.canvas),te.resize(),dt&&dt()}function it(dt){throw te.removeState("vr-mode"),dt&&dt.message?new Error("Failed to enter VR mode (`requestPresent`): "+dt.message):new Error("Failed to enter VR mode (`requestPresent`).")}}exitVR(){var G=this,z,te=this.renderer.xr;if(!this.is("vr-mode")&&!this.is("ar-mode"))return Promise.resolve("Not in immersive mode.");if(this.checkHeadsetConnected()||this.isMobile){if(te.enabled=!1,z=v.device.getVRDisplay(),this.hasWebXR)this.xrSession.removeEventListener("end",this.exitVRBound),this.xrSession.end().then(function(){},function(){}),this.xrSession=void 0;else if(z.isPresenting)return z.exitPresent().then(Y,se)}else j();return Y(),Promise.resolve();function Y(){G.removeState("vr-mode"),G.removeState("ar-mode"),G.isMobile&&screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),G.hasAttribute("embedded")&&G.removeFullScreenStyles(),G.resize(),G.isIOS&&v.forceCanvasResizeSafariMobile(G.canvas),G.renderer.setPixelRatio(window.devicePixelRatio),G.emit("exit-vr",{target:G})}function se(ve){throw ve&&ve.message?new Error("Failed to exit VR mode (`exitPresent`): "+ve.message):new Error("Failed to exit VR mode (`exitPresent`).")}}pointerRestricted(){if(this.canvas){var G=this.getPointerLockElement();G&&G!==this.canvas&&document.exitPointerLock&&document.exitPointerLock(),this.canvas.requestPointerLock&&this.canvas.requestPointerLock()}}pointerUnrestricted(){var G=this.getPointerLockElement();G&&G===this.canvas&&document.exitPointerLock&&document.exitPointerLock()}onVRPresentChange(G){var z=G.display||G.detail.display;if(z&&z.isPresenting){this.enterVR();return}this.exitVR()}getAttribute(G){var z=this.systems[G];return z?z.data:T.prototype.getAttribute.call(this,G)}getDOMAttribute(G){var z=this.systems[G];return z?z.data:T.prototype.getDOMAttribute.call(this,G)}setAttribute(G,z,te){if(m[G]){E.prototype.setAttribute.call(this,G,z);var Y=this.systems[G];Y&&Y.updateProperties(z);return}T.prototype.setAttribute.call(this,G,z,te)}removeBehavior(G){var z,te,Y=this.behaviors[G.name],se;for(te in Y)G[te]&&(z=Y[te],se=z.array.indexOf(G),se!==-1&&(z.inUse?z.markedForRemoval.indexOf(G)===-1&&z.markedForRemoval.push(G):(z.array[se]=z.array[z.array.length-1],z.array.pop())))}resize(){var G=this.camera,z=this.canvas,te,Y,se,ve=this.renderer.xr.isPresenting;Y=this.renderer.xr.enabled&&ve,!(!G||!z||this.is("vr-mode")&&(this.isMobile||Y))&&(te=this.getAttribute("embedded")&&!this.is("vr-mode"),se=k(z,te,this.maxCanvasSize,this.is("vr-mode")),G.aspect=se.width/se.height,G.updateProjectionMatrix(),this.renderer.setSize(se.width,se.height,!1),this.emit("rendererresize",null,!1))}setupRenderer(){var G=this,z,te,Y,se;se={alpha:!0,antialias:!B,canvas:this.canvas,logarithmicDepthBuffer:!1,powerPreference:"high-performance"},this.maxCanvasSize={height:-1,width:-1},this.hasAttribute("renderer")&&(Y=this.getAttribute("renderer"),te=v.styleParser.parse(Y),te.precision&&(se.precision=te.precision+"p"),te.antialias&&te.antialias!=="auto"&&(se.antialias=te.antialias==="true"),te.logarithmicDepthBuffer&&te.logarithmicDepthBuffer!=="auto"&&(se.logarithmicDepthBuffer=te.logarithmicDepthBuffer==="true"),te.alpha&&(se.alpha=te.alpha==="true"),te.stencil&&(se.stencil=te.stencil==="true"),te.multiviewStereo&&(se.multiviewStereo=te.multiviewStereo==="true"),this.maxCanvasSize={width:te.maxCanvasWidth?parseInt(te.maxCanvasWidth):this.maxCanvasSize.width,height:te.maxCanvasHeight?parseInt(te.maxCanvasHeight):this.maxCanvasSize.height}),z=this.renderer=new b.WebGLRenderer(se),z.setPixelRatio(window.devicePixelRatio),this.camera&&z.xr.setPoseTarget(this.camera.el.object3D),this.addEventListener("camera-set-active",function(){z.xr.setPoseTarget(G.camera.el.object3D)})}play(){var G=this,z=this;if(this.renderStarted){T.prototype.play.call(this);return}this.addEventListener("loaded",function(){var te=this.renderer,Y,se=this.renderer.xr;T.prototype.play.call(this),!z.renderStarted&&(z.resize(),z.renderer&&(window.performance&&window.performance.mark("render-started"),f.remove(),Y=v.device.getVRDisplay(),Y&&Y.isPresenting&&(se.setDevice(Y),se.enabled=!0,z.enterVR()),te.setAnimationLoop(this.render),z.renderStarted=!0,z.emit("renderstart")))}),setTimeout(function(){T.prototype.load.call(G)})}updateComponent(G){G in m||T.prototype.updateComponent.apply(this,arguments)}tick(G,z){var te,Y=this.systems;for(this.callComponentBehaviors("tick",G,z),te=0;te<this.systemNames.length;te++)Y[this.systemNames[te]].tick&&Y[this.systemNames[te]].tick(G,z)}tock(G,z,te){var Y,se=this.systems;for(this.callComponentBehaviors("tock",G,z),Y=0;Y<this.systemNames.length;Y++)se[this.systemNames[Y]].tock&&se[this.systemNames[Y]].tock(G,z,te)}render(G,z){var te=this.renderer;this.frame=z,this.delta=this.clock.getDelta()*1e3,this.time=this.clock.elapsedTime*1e3,this.isPlaying&&this.tick(this.time,this.delta);var Y=null;this.is("ar-mode")&&(Y=this.object3D.background,this.object3D.background=null),te.render(this.object3D,this.camera),Y&&(this.object3D.background=Y)}callComponentBehaviors(G,z,te){for(var Y,se=0;se<this.componentOrder.length;se++){var ve=this.behaviors[this.componentOrder[se]];if(ve){var Ae=ve[G];for(Ae.inUse=!0,Y=0;Y<Ae.array.length;Y++)Ae.array[Y].isPlaying&&Ae.array[Y][G](z,te);for(Ae.inUse=!1,Y=0;Y<Ae.markedForRemoval.length;Y++)this.removeBehavior(Ae.markedForRemoval[Y]);Ae.markedForRemoval.length=0}}}}function D(W,G){var z={},te,Y,se=G||[];se.length=0;for(Y in W){var ve=W[Y];if(ve!==void 0){var Ae=ve.before?ve.before.slice(0):[],me=ve.after?ve.after.slice(0):[];z[Y]={before:Ae,after:me,visited:!1,done:!1}}}for(Y in z)for(te=0;te<z[Y].before.length;te++){var Oe=z[Y].before[te];if(!(Oe in z)){_("Invalid ordering constraint, no component named `"+Oe+"` referenced by `"+Y+"`");continue}z[Oe].after.push(Y)}function Xe(Je){if(!(!(Je in z)||z[Je].done)){if(z[Je].visited){_("Cycle detected, ignoring one or more before/after constraints. The resulting order might be incorrect");return}z[Je].visited=!0;for(var it=0;it<z[Je].after.length;it++){var dt=z[Je].after[it];dt in z||_("Invalid before/after constraint, no component named `"+dt+"` referenced in `"+Je+"`"),Xe(dt)}z[Je].done=!0,se.push(Je)}}for(Y in z)z[Y].done||Xe(Y);return se}l.exports.determineComponentBehaviorOrder=D;function P(W,G){var z,te=window.devicePixelRatio;return!G||G.width===-1&&G.height===-1||W.width*te<G.width&&W.height*te<G.height||(z=W.width/W.height,W.width*te>G.width&&G.width!==-1&&(W.width=Math.round(G.width/te),W.height=Math.round(G.width/z/te)),W.height*te>G.height&&G.height!==-1&&(W.height=Math.round(G.height/te),W.width=Math.round(G.height*z/te))),W}customElements.define("a-scene",N);function k(W,G,z,te){if(!W.parentElement)return{height:0,width:0};if(G){var Y;return Y={height:W.parentElement.offsetHeight,width:W.parentElement.offsetWidth},P(Y,z)}return q(z,te)}function q(W,G){var z;return z={height:document.body.offsetHeight,width:document.body.offsetWidth},G?z:P(z,W)}function V(W){var G=W.requestFullscreen||W.webkitRequestFullscreen||W.mozRequestFullScreen||W.msRequestFullscreen;G.apply(W,[{navigationUI:"hide"}])}function j(){var W=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement;W&&(document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen())}function Q(W){var G;G=document.createElement("canvas"),G.classList.add("a-canvas"),G.dataset.aframeCanvas=!0,W.appendChild(G),document.addEventListener("fullscreenchange",z),document.addEventListener("mozfullscreenchange",z),document.addEventListener("webkitfullscreenchange",z),document.addEventListener("MSFullscreenChange",z),G.addEventListener("touchmove",function(te){te.preventDefault()},{passive:!1}),W.canvas=G,W.emit("render-target-loaded",{target:G}),setTimeout(W.resize.bind(W),0);function z(){var te=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement;te||W.exitVR(),document.activeElement.blur(),document.body.focus()}}l.exports.setupCanvas=Q,l.exports.AScene=N},"./src/core/scene/loadingScreen.js":(l,u,c)=>{var h=c("./src/utils/index.js"),p=h.styleParser,f,g,m,y="loading-screen",b="a-loader-title";l.exports.setup=function(T,E){f=T,m=E;var C=f.hasAttribute(y)?p.parse(f.getAttribute(y)):void 0,R=C&&C.dotsColor||"white",B=C&&C.backgroundColor||"#24CAFF",I=C===void 0||C.enabled==="true"||C.enabled===void 0,N,D,P,k,q,V,j,Q,W,G;I&&(N=new THREE.Scene,D=new THREE.SphereGeometry(.2,36,18,0,2*Math.PI,0,Math.PI),P=new THREE.MeshBasicMaterial({color:R}),k=new THREE.Mesh(D,P),q=k.clone(),V=k.clone(),j=new THREE.PerspectiveCamera(80,window.innerWidth/window.innerHeight,5e-4,1e4),Q=new THREE.Clock,W=0,G=function(){f.renderer.render(N,j),W=Q.getElapsedTime()%4,k.visible=W>=1,q.visible=W>=2,V.visible=W>=3},N.background=new THREE.Color(B),N.add(j),k.position.set(-1,0,-15),q.position.set(0,0,-15),V.position.set(1,0,-15),j.add(k),j.add(q),j.add(V),_(),setTimeout(function(){f.hasLoaded||(v(j),g.style.display="block",window.addEventListener("resize",function(){v(j)}),f.renderer.setAnimationLoop(G))},200))},l.exports.remove=function(){window.removeEventListener("resize",v),g&&(g.style.display="none")};function v(T){var E=f.hasAttribute("embedded"),C=m(f.canvas,E,f.maxCanvasSize,f.is("vr-mode"));T.aspect=C.width/C.height,T.updateProjectionMatrix(),f.renderer.setSize(C.width,C.height,!1)}function _(){g=document.createElement("div"),g.className=b,g.innerHTML=document.title,g.style.display="none",f.appendChild(g)}},"./src/core/scene/metaTags.js":(l,u,c)=>{var h=c("./src/constants/index.js"),p=c("./src/utils/index.js").extend,f=l.exports.MOBILE_HEAD_TAGS=[m({name:"viewport",content:"width=device-width,initial-scale=1,maximum-scale=1,shrink-to-fit=no,user-scalable=no,minimal-ui,viewport-fit=cover"}),m({name:"mobile-web-app-capable",content:"yes"}),m({name:"theme-color",content:"black"})],g=[m({name:"apple-mobile-web-app-capable",content:"yes"}),m({name:"apple-mobile-web-app-status-bar-style",content:"black"}),y({rel:"apple-touch-icon",href:"https://aframe.io/images/aframe-logo-152.png"})];function m(v){return{tagName:"meta",attributes:v,exists:function(){return document.querySelector('meta[name="'+v.name+'"]')}}}function y(v){return{tagName:"link",attributes:v,exists:function(){return document.querySelector('link[rel="'+v.rel+'"]')}}}l.exports.inject=function(v){var _=document.head,T=_.querySelector("script"),E,C=[];return f.forEach(R),v.isIOS&&g.forEach(R),C;function R(B){!B||B.exists()||(E=b(B),E&&(T?T.parentNode.insertBefore(E,T):_.appendChild(E),C.push(E)))}};function b(v){if(!(!v||!v.tagName)){var _=document.createElement(v.tagName);return _.setAttribute(h.AFRAME_INJECTED,""),p(_,v.attributes)}}},"./src/core/scene/postMessage.js":(l,u,c)=>{var h=c("./src/utils/index.js").isIframed;l.exports=function(f){h()&&window.addEventListener("message",p.bind(f))};function p(f){var g=this;if(f.data)switch(f.data.type){case"vr":switch(f.data.data){case"enter":g.enterVR();break;case"exit":g.exitVR();break}}}},"./src/core/scene/scenes.js":l=>{l.exports=[]},"./src/core/scene/wakelock.js":(l,u,c)=>{var h=c("./vendor/wakelock/wakelock.js");l.exports=function(p){if(p.isMobile){var f=p.wakelock=new h;p.addEventListener("enter-vr",function(){f.request()}),p.addEventListener("exit-vr",function(){f.release()})}}},"./src/core/schema.js":(l,u,c)=>{var h=c("./src/utils/index.js"),p=c("./src/core/propertyTypes.js"),f=h.debug,g=p.isValidDefaultValue,m=p.propertyTypes,y=f("core:schema:warn");function b(E){return"type"in E?typeof E.type=="string":"default"in E}l.exports.isSingleProperty=b,l.exports.process=function(E,C){var R;if(b(E))return v(E,C);for(R in E)E[R]=v(E[R],C);return E};function v(E,C){var R=E.default,B,I,N=E.type;return E.type?E.type==="bool"?N="boolean":E.type==="float"&&(N="number"):R!==void 0&&(typeof R=="boolean"||typeof R=="number")?N=typeof R:Array.isArray(R)?N="array":N="string",I=m[N],I||y("Unknown property type for component `"+C+"`: "+N),B=!!E.parse,E.parse=E.parse||I.parse,E.stringify=E.stringify||I.stringify,E.equals=E.equals||I.equals,E.isCacheable=E.isCacheable===!0||I.isCacheable,E.type=N,"default"in E?!B&&!g(N,R)&&y("Default value `"+R+"` does not match type `"+N+"` in component `"+C+"`"):E.default=I.default,E}l.exports.processPropertyDefinition=v,l.exports.parseProperties=function(){var E=[];return function(C,R,B,I,N){var D,P,k,q;E.length=0;for(P in B?C:R)B&&C[P]===void 0||E.push(P);if(C===null||typeof C!="object")return C;for(P in C)C[P]!==void 0&&!R[P]&&!N&&y("Unknown property `"+P+"` for component/system `"+I+"`.");for(D=0;D<E.length;D++){if(P=E[D],k=R[P],q=C[P],!R[P])return;C[P]=_(q,k)}return C}}();function _(E,C,R){return(E==null||E==="")&&(E=C.default,Array.isArray(E)&&(E=E.slice())),C.parse(E,C.default,R)}l.exports.parseProperty=_,l.exports.stringifyProperties=function(E,C){var R,B,I,N={},D;for(R in E)B=C[R],I=E[R],D=I,typeof D=="object"&&(D=T(I,B),B||y("Unknown component property: "+R)),N[R]=D;return N};function T(E,C){return typeof E!="object"?E:!C||E===null?JSON.stringify(E):C.stringify(E)}l.exports.stringifyProperty=T},"./src/core/shader.js":(l,u,c)=>{var h=c("./src/core/schema.js"),p=h.process,f=l.exports.shaders={},g=l.exports.shaderNames=[],m=c("./src/lib/three.js"),y=c("./src/utils/index.js"),b={array:"v3",color:"v3",int:"i",number:"f",map:"t",time:"f",vec2:"v2",vec3:"v3",vec4:"v4"},v=l.exports.Shader=function(){};v.prototype={schema:{},vertexShader:"void main() {gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);}",fragmentShader:"void main() {gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);}",init:function(_){return this.uniforms=this.initUniforms(),this.material=new(this.raw?m.RawShaderMaterial:m.ShaderMaterial)({uniforms:this.uniforms,glslVersion:this.raw||this.glsl3?m.GLSL3:null,vertexShader:this.vertexShader,fragmentShader:this.fragmentShader}),this.material},initUniforms:function(){var _,T=this.schema,E={},C;for(_ in T)T[_].is==="uniform"&&(C=b[T[_].type],E[_]={type:C,value:void 0});return E},update:function(_){var T,E,C=this.schema,R=this.uniforms;for(T in _)if(!(!C[T]||C[T].is!=="uniform")){if(C[T].type==="map"){if(!R[T]||R[T].value===_[T])continue;E="_texture_"+T,this.setMapOnTextureLoad(R,T,E),y.material.updateMapMaterialFromData(E,T,this,_);continue}R[T].value=this.parseValue(C[T].type,_[T]),R[T].needsUpdate=!0}},parseValue:function(_,T){var E;switch(_){case"vec2":return new m.Vector2(T.x,T.y);case"vec3":return new m.Vector3(T.x,T.y,T.z);case"vec4":return new m.Vector4(T.x,T.y,T.z,T.w);case"color":return E=new m.Color(T),new m.Vector3(E.r,E.g,E.b);default:return T}},setMapOnTextureLoad:function(_,T,E){var C=this;this.el.addEventListener("materialtextureloaded",function(){_[T].value=C.material[E],_[T].needsUpdate=!0})}},l.exports.registerShader=function(_,T){var E,C={};if(Object.keys(T).forEach(function(R){C[R]={value:T[R],writable:!0}}),f[_])throw new Error("The shader "+_+" has already been registered");return E=function(){v.call(this)},E.prototype=Object.create(v.prototype,C),E.prototype.name=_,E.prototype.constructor=E,f[_]={Shader:E,schema:p(E.prototype.schema)},g.push(_),E}},"./src/core/system.js":(l,u,c)=>{var h=c("./src/core/component.js"),p=c("./src/core/schema.js"),f=c("./src/utils/index.js"),g=c("./src/core/readyState.js"),m=p.parseProperties,y=p.parseProperty,b=p.process,v=p.isSingleProperty,_=f.styleParser,T=l.exports.systems={},E=l.exports.System=function(C){var R=h&&h.components[this.name];this.el=C,this.sceneEl=C,R&&(R.Component.prototype.system=this),this.buildData(),this.init(),this.update({})};E.prototype={schema:{},init:function(){},update:function(C){},updateProperties:function(C){var R=this.data;Object.keys(p).length&&(this.buildData(C),this.update(R))},buildData:function(C){var R=this.schema;Object.keys(R).length&&(C=C||window.HTMLElement.prototype.getAttribute.call(this.sceneEl,this.name),v(R)?this.data=y(C,R):this.data=m(_.parse(C)||{},R,!1,this.name))},tick:void 0,tock:void 0,play:function(){},pause:function(){}},l.exports.registerSystem=function(C,R){var B,I,N={},D=f.findAllScenes(document);if(Object.keys(R).forEach(function(P){N[P]={value:R[P],writable:!0}}),T[C])throw new Error("The system `"+C+"` has been already registered. Check that you are not loading two versions of the same system or two different systems of the same name.");if(I=function(P){E.call(this,P)},I.prototype=Object.create(E.prototype,N),I.prototype.name=C,I.prototype.constructor=I,I.prototype.schema=f.extend(b(I.prototype.schema)),T[C]=I,g.canInitializeElements)for(B=0;B<D.length;B++)D[B].initSystem(C)}},"./src/extras/components/index.js":(l,u,c)=>{c("./src/extras/components/pivot.js")},"./src/extras/components/pivot.js":(l,u,c)=>{var h=c("./src/core/component.js").registerComponent,p=c("./src/lib/three.js"),f=new p.Vector3,g=new p.Vector3;h("pivot",{dependencies:["position"],schema:{type:"vec3"},init:function(){var m=this.data,y=this.el,b=y.object3D.parent,v=y.object3D,_=new p.Group;f.copy(v.position),g.copy(v.rotation),b.remove(v),_.add(v),b.add(_),y.object3D=_,v.position.set(-1*m.x,-1*m.y,-1*m.z),_.position.set(m.x+f.x,m.y+f.y,m.z+f.z),_.rotation.copy(v.rotation),v.rotation.set(0,0,0)}})},"./src/extras/primitives/getMeshMixin.js":(l,u,c)=>{var h=c("./src/core/component.js").components,p=c("./src/core/shader.js").shaders,f=c("./src/utils/index.js"),g={};Object.keys(h.material.schema).forEach(m),Object.keys(p.standard.schema).forEach(m);function m(y){var b=y.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();y==="fog"&&(b="material-fog"),y==="visible"&&(b="material-visible"),g[b]="material."+y}l.exports=function(){return{defaultComponents:{material:{}},mappings:f.extend({},g)}}},"./src/extras/primitives/index.js":(l,u,c)=>{c("./src/extras/primitives/primitives/a-camera.js"),c("./src/extras/primitives/primitives/a-cursor.js"),c("./src/extras/primitives/primitives/a-curvedimage.js"),c("./src/extras/primitives/primitives/a-gltf-model.js"),c("./src/extras/primitives/primitives/a-image.js"),c("./src/extras/primitives/primitives/a-light.js"),c("./src/extras/primitives/primitives/a-link.js"),c("./src/extras/primitives/primitives/a-obj-model.js"),c("./src/extras/primitives/primitives/a-sky.js"),c("./src/extras/primitives/primitives/a-sound.js"),c("./src/extras/primitives/primitives/a-text.js"),c("./src/extras/primitives/primitives/a-video.js"),c("./src/extras/primitives/primitives/a-videosphere.js"),c("./src/extras/primitives/primitives/meshPrimitives.js")},"./src/extras/primitives/primitives.js":(l,u,c)=>{var h=c("./src/core/a-node.js").knownTags,p=c("./src/core/a-entity.js").AEntity,f=c("./src/core/component.js").components,g=c("./src/utils/index.js"),m=g.debug,y=g.entity.setComponentProperty,b=m("extras:primitives:debug"),v=m("extras:primitives:warn"),_=m("extras:primitives:error"),T=l.exports.primitives={};l.exports.registerPrimitive=function(B,I){if(B=B.toLowerCase(),h[B]){_("Trying to register primitive "+B+" that has been already previously registered");return}h[B]=!0,b("Registering <%s>",B),I.defaultAttributes&&v("The 'defaultAttributes' object is deprecated. Use 'defaultComponents' instead.");var N=I.mappings||{},D=class extends p{constructor(){super(),this.defaultComponentsFromPrimitive=I.defaultComponents||I.defaultAttributes||{},this.deprecated=I.deprecated||null,this.deprecatedMappings=I.deprecatedMappings||{},this.mappings=N,I.deprecated&&console.warn(I.deprecated),this.resolveMappingCollisions()}resolveMappingCollisions(){var P=this.mappings,k=this;Object.keys(P).forEach(function(q){var V;q!==q.toLowerCase()&&v("Mapping keys should be specified in lower case. The mapping key "+q+" may not be recognized"),f[q]&&(V=P[q].replace(".","-"),P[V]=P[q],delete P[q],console.warn("The primitive "+k.tagName.toLowerCase()+" has a mapping collision. The attribute "+q+" has the same name as a registered component and has been renamed to "+V))})}getExtraComponents(){var P,k,q,V,j,Q=this;for(k=g.clone(this.defaultComponentsFromPrimitive),j=this.getAttribute("mixin"),j&&(j=g.split(j.trim(),/\s+/),j.forEach(function(Y){var se=document.getElementById(Y);if(se){var ve=se.rawAttributeCache,Ae=se.componentCache;for(var me in ve){if(V=Q.mappings[me],V){E(V,ve[me],k);return}me in Ae&&(k[me]=W(k[me],Ae[me]))}}})),q=0;q<this.attributes.length;q++)P=this.attributes[q],V=this.mappings[P.name],V&&E(V,P.value,k);return k;function W(Y,se){return G(Y)?z(se):G(se)?z(Y):te(Y)&&te(se)?g.extendDeep(Y,se):z(se)}function G(Y){return typeof Y>"u"}function z(Y){return te(Y)?g.extendDeep({},Y):Y}function te(Y){return Y!==null&&Y.constructor===Object}}attributeChangedCallback(P,k,q){var V=this.mappings[P];if(P in this.deprecatedMappings&&console.warn(this.deprecatedMappings[P]),!P||!V){super.attributeChangedCallback(P,k,q);return}y(this,V,q)}};return customElements.define(B,D),D.mappings=N,T[B]=D,D};function E(B,I,N){var D=g.entity.getComponentPropertyPath(B);D.constructor===Array?(N[D[0]]=N[D[0]]||{},N[D[0]][D[1]]=I.trim()):N[D]=I.trim()}function C(B,I){var N=f[B].schema;Object.keys(N).map(function(D){var P=D.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();I[P]!==void 0&&(P=B+"-"+D),I[P]=B+"."+D})}function R(B,I,N){N=N||{},Object.keys(I).map(function(D){C(D,N)}),l.exports.registerPrimitive(B,g.extendDeep({},null,{defaultComponents:I,mappings:N}))}l.exports.definePrimitive=R},"./src/extras/primitives/primitives/a-camera.js":(l,u,c)=>{var h=c("./src/extras/primitives/primitives.js").registerPrimitive;h("a-camera",{defaultComponents:{camera:{},"look-controls":{},"wasd-controls":{},position:{x:0,y:1.6,z:0}},mappings:{active:"camera.active",far:"camera.far",fov:"camera.fov","look-controls-enabled":"look-controls.enabled",near:"camera.near","pointer-lock-enabled":"look-controls.pointerLockEnabled","wasd-controls-enabled":"wasd-controls.enabled","reverse-mouse-drag":"look-controls.reverseMouseDrag",zoom:"camera.zoom"}})},"./src/extras/primitives/primitives/a-cursor.js":(l,u,c)=>{var h=c("./src/extras/primitives/getMeshMixin.js"),p=c("./src/extras/primitives/primitives.js").registerPrimitive,f=c("./src/utils/index.js");p("a-cursor",f.extendDeep({},h(),{defaultComponents:{cursor:{},geometry:{primitive:"ring",radiusOuter:.016,radiusInner:.01,segmentsTheta:32},material:{color:"#000",shader:"flat",opacity:.8},position:{x:0,y:0,z:-1}},mappings:{far:"raycaster.far",fuse:"cursor.fuse","fuse-timeout":"cursor.fuseTimeout",interval:"raycaster.interval",objects:"raycaster.objects"}}))},"./src/extras/primitives/primitives/a-curvedimage.js":(l,u,c)=>{var h=c("./src/extras/primitives/getMeshMixin.js"),p=c("./src/extras/primitives/primitives.js").registerPrimitive,f=c("./src/utils/index.js");p("a-curvedimage",f.extendDeep({},h(),{defaultComponents:{geometry:{height:1,primitive:"cylinder",radius:2,segmentsRadial:48,thetaLength:270,openEnded:!0,thetaStart:0},material:{color:"#FFF",shader:"flat",side:"double",transparent:!0,repeat:"-1 1"}},mappings:{height:"geometry.height","open-ended":"geometry.openEnded",radius:"geometry.radius",segments:"geometry.segmentsRadial",start:"geometry.thetaStart","theta-length":"geometry.thetaLength","theta-start":"geometry.thetaStart",width:"geometry.thetaLength"}}))},"./src/extras/primitives/primitives/a-gltf-model.js":(l,u,c)=>{var h=c("./src/extras/primitives/primitives.js").registerPrimitive;h("a-gltf-model",{mappings:{src:"gltf-model"}})},"./src/extras/primitives/primitives/a-image.js":(l,u,c)=>{var h=c("./src/extras/primitives/getMeshMixin.js"),p=c("./src/extras/primitives/primitives.js").registerPrimitive,f=c("./src/utils/index.js");p("a-image",f.extendDeep({},h(),{defaultComponents:{geometry:{primitive:"plane"},material:{color:"#FFF",shader:"flat",side:"double",transparent:!0}},mappings:{height:"geometry.height",width:"geometry.width"}}))},"./src/extras/primitives/primitives/a-light.js":(l,u,c)=>{var h=c("./src/extras/primitives/primitives.js").registerPrimitive;h("a-light",{defaultComponents:{light:{}},mappings:{angle:"light.angle",color:"light.color","ground-color":"light.groundColor",decay:"light.decay",distance:"light.distance",intensity:"light.intensity",penumbra:"light.penumbra",type:"light.type",target:"light.target",envmap:"light.envMap","shadow-camera-automatic":"light.shadowCameraAutomatic"}})},"./src/extras/primitives/primitives/a-link.js":(l,u,c)=>{var h=c("./src/extras/primitives/primitives.js").registerPrimitive;h("a-link",{defaultComponents:{link:{visualAspectEnabled:!0}},mappings:{href:"link.href",image:"link.image",title:"link.title"}})},"./src/extras/primitives/primitives/a-obj-model.js":(l,u,c)=>{var h=c("./src/extras/primitives/getMeshMixin.js")(),p=c("./src/extras/primitives/primitives.js").registerPrimitive,f=c("./src/utils/index.js");p("a-obj-model",f.extendDeep({},h,{defaultComponents:{"obj-model":{}},mappings:{src:"obj-model.obj",mtl:"obj-model.mtl"}}))},"./src/extras/primitives/primitives/a-sky.js":(l,u,c)=>{var h=c("./src/extras/primitives/getMeshMixin.js"),p=c("./src/extras/primitives/primitives.js").registerPrimitive,f=c("./src/utils/index.js"),g=c("./src/extras/primitives/primitives/meshPrimitives.js");p("a-sky",f.extendDeep({},h(),{defaultComponents:{geometry:{primitive:"sphere",radius:500,segmentsWidth:64,segmentsHeight:32},material:{color:"#FFF",side:"back",shader:"flat",npot:!0},scale:"-1 1 1"},mappings:f.extendDeep({},g["a-sphere"].mappings)}))},"./src/extras/primitives/primitives/a-sound.js":(l,u,c)=>{var h=c("./src/extras/primitives/primitives.js").registerPrimitive;h("a-sound",{defaultComponents:{sound:{}},mappings:{src:"sound.src",on:"sound.on",autoplay:"sound.autoplay",loop:"sound.loop",volume:"sound.volume"}})},"./src/extras/primitives/primitives/a-text.js":(l,u,c)=>{var h=c("./src/extras/primitives/primitives.js").definePrimitive;h("a-text",{text:{anchor:"align",width:5}})},"./src/extras/primitives/primitives/a-video.js":(l,u,c)=>{var h=c("./src/extras/primitives/getMeshMixin.js"),p=c("./src/extras/primitives/primitives.js").registerPrimitive,f=c("./src/utils/index.js");p("a-video",f.extendDeep({},h(),{defaultComponents:{geometry:{primitive:"plane"},material:{color:"#FFF",shader:"flat",side:"double",transparent:!0}},mappings:{height:"geometry.height",width:"geometry.width"}}))},"./src/extras/primitives/primitives/a-videosphere.js":(l,u,c)=>{var h=c("./src/extras/primitives/getMeshMixin.js"),p=c("./src/extras/primitives/primitives.js").registerPrimitive,f=c("./src/utils/index.js");p("a-videosphere",f.extendDeep({},h(),{defaultComponents:{geometry:{primitive:"sphere",radius:500,segmentsWidth:64,segmentsHeight:32},material:{color:"#FFF",shader:"flat",side:"back",npot:!0},scale:"-1 1 1"},mappings:{radius:"geometry.radius","segments-height":"geometry.segmentsHeight","segments-width":"geometry.segmentsWidth"}}))},"./src/extras/primitives/primitives/meshPrimitives.js":(l,u,c)=>{var h=c("./src/extras/primitives/getMeshMixin.js"),p=c("./src/core/geometry.js").geometries,f=c("./src/core/geometry.js").geometryNames,g=c("./src/extras/primitives/primitives.js").registerPrimitive,m=c("./src/utils/index.js"),y=l.exports={};f.forEach(function(v){var _=p[v],T=b(v),E={};Object.keys(_.schema).forEach(function(B){E[b(B)]="geometry."+B});var C="a-"+T,R=g(C,m.extendDeep({},h(),{defaultComponents:{geometry:{primitive:v}},mappings:E}));y[C]=R});function b(v){return v.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}},"./src/geometries/box.js":(l,u,c)=>{var h=c("./src/core/geometry.js").registerGeometry,p=c("./src/lib/three.js");h("box",{schema:{depth:{default:1,min:0},height:{default:1,min:0},width:{default:1,min:0},segmentsHeight:{default:1,min:1,max:20,type:"int"},segmentsWidth:{default:1,min:1,max:20,type:"int"},segmentsDepth:{default:1,min:1,max:20,type:"int"}},init:function(f){this.geometry=new p.BoxGeometry(f.width,f.height,f.depth,f.segmentsWidth,f.segmentsHeight,f.segmentsDepth)}})},"./src/geometries/circle.js":(l,u,c)=>{var h=c("./src/core/geometry.js").registerGeometry,p=c("./src/lib/three.js"),f=p.MathUtils.degToRad;h("circle",{schema:{radius:{default:1,min:0},segments:{default:32,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(g){this.geometry=new p.CircleGeometry(g.radius,g.segments,f(g.thetaStart),f(g.thetaLength))}})},"./src/geometries/cone.js":(l,u,c)=>{var h=c("./src/core/geometry.js").registerGeometry,p=c("./src/lib/three.js"),f=p.MathUtils.degToRad;h("cone",{schema:{height:{default:1,min:0},openEnded:{default:!1},radiusBottom:{default:1,min:0},radiusTop:{default:.01,min:0},segmentsHeight:{default:18,min:1,type:"int"},segmentsRadial:{default:36,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(g){this.geometry=new p.CylinderGeometry(g.radiusTop,g.radiusBottom,g.height,g.segmentsRadial,g.segmentsHeight,g.openEnded,f(g.thetaStart),f(g.thetaLength))}})},"./src/geometries/cylinder.js":(l,u,c)=>{var h=c("./src/core/geometry.js").registerGeometry,p=c("./src/lib/three.js"),f=p.MathUtils.degToRad;h("cylinder",{schema:{height:{default:1,min:0},openEnded:{default:!1},radius:{default:1,min:0},segmentsHeight:{default:18,min:1,type:"int"},segmentsRadial:{default:36,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(g){this.geometry=new p.CylinderGeometry(g.radius,g.radius,g.height,g.segmentsRadial,g.segmentsHeight,g.openEnded,f(g.thetaStart),f(g.thetaLength))}})},"./src/geometries/dodecahedron.js":(l,u,c)=>{var h=c("./src/core/geometry.js").registerGeometry,p=c("./src/lib/three.js");h("dodecahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(f){this.geometry=new p.DodecahedronGeometry(f.radius,f.detail)}})},"./src/geometries/icosahedron.js":(l,u,c)=>{var h=c("./src/core/geometry.js").registerGeometry,p=c("./src/lib/three.js");h("icosahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(f){this.geometry=new p.IcosahedronGeometry(f.radius,f.detail)}})},"./src/geometries/index.js":(l,u,c)=>{c("./src/geometries/box.js"),c("./src/geometries/circle.js"),c("./src/geometries/cone.js"),c("./src/geometries/cylinder.js"),c("./src/geometries/dodecahedron.js"),c("./src/geometries/icosahedron.js"),c("./src/geometries/octahedron.js"),c("./src/geometries/plane.js"),c("./src/geometries/ring.js"),c("./src/geometries/sphere.js"),c("./src/geometries/tetrahedron.js"),c("./src/geometries/torus.js"),c("./src/geometries/torusKnot.js"),c("./src/geometries/triangle.js")},"./src/geometries/octahedron.js":(l,u,c)=>{var h=c("./src/core/geometry.js").registerGeometry,p=c("./src/lib/three.js");h("octahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(f){this.geometry=new p.OctahedronGeometry(f.radius,f.detail)}})},"./src/geometries/plane.js":(l,u,c)=>{var h=c("./src/core/geometry.js").registerGeometry,p=c("./src/lib/three.js");h("plane",{schema:{height:{default:1,min:0},width:{default:1,min:0},segmentsHeight:{default:1,min:1,max:20,type:"int"},segmentsWidth:{default:1,min:1,max:20,type:"int"}},init:function(f){this.geometry=new p.PlaneGeometry(f.width,f.height,f.segmentsWidth,f.segmentsHeight)}})},"./src/geometries/ring.js":(l,u,c)=>{var h=c("./src/core/geometry.js").registerGeometry,p=c("./src/lib/three.js"),f=p.MathUtils.degToRad;h("ring",{schema:{radiusInner:{default:.8,min:0},radiusOuter:{default:1.2,min:0},segmentsPhi:{default:10,min:1,type:"int"},segmentsTheta:{default:32,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(g){this.geometry=new p.RingGeometry(g.radiusInner,g.radiusOuter,g.segmentsTheta,g.segmentsPhi,f(g.thetaStart),f(g.thetaLength))}})},"./src/geometries/sphere.js":(l,u,c)=>{var h=c("./src/core/geometry.js").registerGeometry,p=c("./src/lib/three.js"),f=p.MathUtils.degToRad;h("sphere",{schema:{radius:{default:1,min:0},phiLength:{default:360},phiStart:{default:0,min:0},thetaLength:{default:180,min:0},thetaStart:{default:0},segmentsHeight:{default:18,min:2,type:"int"},segmentsWidth:{default:36,min:3,type:"int"}},init:function(g){this.geometry=new p.SphereGeometry(g.radius,g.segmentsWidth,g.segmentsHeight,f(g.phiStart),f(g.phiLength),f(g.thetaStart),f(g.thetaLength))}})},"./src/geometries/tetrahedron.js":(l,u,c)=>{var h=c("./src/core/geometry.js").registerGeometry,p=c("./src/lib/three.js");h("tetrahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(f){this.geometry=new p.TetrahedronGeometry(f.radius,f.detail)}})},"./src/geometries/torus.js":(l,u,c)=>{var h=c("./src/core/geometry.js").registerGeometry,p=c("./src/lib/three.js"),f=p.MathUtils.degToRad;h("torus",{schema:{arc:{default:360},radius:{default:1,min:0},radiusTubular:{default:.2,min:0},segmentsRadial:{default:36,min:2,type:"int"},segmentsTubular:{default:32,min:3,type:"int"}},init:function(g){this.geometry=new p.TorusGeometry(g.radius,g.radiusTubular*2,g.segmentsRadial,g.segmentsTubular,f(g.arc))}})},"./src/geometries/torusKnot.js":(l,u,c)=>{var h=c("./src/core/geometry.js").registerGeometry,p=c("./src/lib/three.js");h("torusKnot",{schema:{p:{default:2,min:1},q:{default:3,min:1},radius:{default:1,min:0},radiusTubular:{default:.2,min:0},segmentsRadial:{default:8,min:3,type:"int"},segmentsTubular:{default:100,min:3,type:"int"}},init:function(f){this.geometry=new p.TorusKnotGeometry(f.radius,f.radiusTubular*2,f.segmentsTubular,f.segmentsRadial,f.p,f.q)}})},"./src/geometries/triangle.js":(l,u,c)=>{var h=c("./src/core/geometry.js").registerGeometry,p=c("./src/lib/three.js"),f=new p.Quaternion,g=new p.Vector3(0,0,1),m=new p.Vector2,y=new p.Vector2,b=new p.Vector2;h("triangle",{schema:{vertexA:{type:"vec3",default:{x:0,y:.5,z:0}},vertexB:{type:"vec3",default:{x:-.5,y:-.5,z:0}},vertexC:{type:"vec3",default:{x:.5,y:-.5,z:0}}},init:function(v){var _,T,E,C,R,B,I,N,D;E=new p.Triangle,E.a.set(v.vertexA.x,v.vertexA.y,v.vertexA.z),E.b.set(v.vertexB.x,v.vertexB.y,v.vertexB.z),E.c.set(v.vertexC.x,v.vertexC.y,v.vertexC.z),T=E.getNormal(new p.Vector3),f.setFromUnitVectors(T,g),C=E.a.clone().applyQuaternion(f),R=E.b.clone().applyQuaternion(f),B=E.c.clone().applyQuaternion(f),m.set(Math.min(C.x,R.x,B.x),Math.min(C.y,R.y,B.y)),y.set(Math.max(C.x,R.x,B.x),Math.max(C.y,R.y,B.y)),b.set(0,0).subVectors(y,m),C=new p.Vector2().subVectors(C,m).divide(b),R=new p.Vector2().subVectors(R,m).divide(b),B=new p.Vector2().subVectors(B,m).divide(b),_=this.geometry=new p.BufferGeometry,I=[E.a.x,E.a.y,E.a.z,E.b.x,E.b.y,E.b.z,E.c.x,E.c.y,E.c.z],N=[T.x,T.y,T.z,T.x,T.y,T.z,T.x,T.y,T.z],D=[C.x,C.y,R.x,R.y,B.x,B.y],_.setAttribute("position",new p.Float32BufferAttribute(I,3)),_.setAttribute("normal",new p.Float32BufferAttribute(N,3)),_.setAttribute("uv",new p.Float32BufferAttribute(D,2))}})},"./src/index.js":(l,u,c)=>{if(window.hasNativeWebVRImplementation=!!window.navigator.getVRDisplays||!!window.navigator.getVRDevices,window.hasNativeWebXRImplementation=navigator.xr!==void 0,!window.hasNativeWebXRImplementation&&!window.hasNativeWebVRImplementation){var h=c("./src/utils/isIOSOlderThan10.js"),p=h(window.navigator.userAgent)?1/window.devicePixelRatio:1,f=c("./node_modules/webvr-polyfill/build/webvr-polyfill.js"),g={BUFFER_SCALE:p,CARDBOARD_UI_DISABLED:!0,ROTATE_INSTRUCTIONS_DISABLED:!0,MOBILE_WAKE_LOCK:!!window.cordova};window.webvrpolyfill=new f(g)}var m=c("./src/utils/index.js"),y=m.debug,b=y("A-Frame:error"),v=y("A-Frame:warn");window.document.currentScript&&window.document.currentScript.parentNode!==window.document.head&&!window.debug&&v("Put the A-Frame <script> tag in the <head> of the HTML *before* the scene to ensure everything for A-Frame is properly registered before they are used from HTML."),!window.cordova&&window.location.protocol==="file:"&&b("This HTML file is currently being served via the file:// protocol. Assets, textures, and models WILL NOT WORK due to cross-origin policy! Please use a local or hosted server: https://aframe.io/docs/1.4.0/introduction/installation.html#use-a-local-server."),m.device.isBrowserEnvironment&&(c("./src/style/aframe.css"),c("./src/style/rStats.css"));var _=c("./src/core/scene/a-scene.js").AScene,T=c("./src/core/component.js").components,E=c("./src/core/component.js").registerComponent,C=c("./src/core/geometry.js").registerGeometry,R=c("./src/extras/primitives/primitives.js").registerPrimitive,B=c("./src/core/shader.js").registerShader,I=c("./src/core/system.js").registerSystem,N=c("./src/core/shader.js").shaders,D=c("./src/core/system.js").systems,P=window.THREE=c("./src/lib/three.js"),k=c("./src/core/readyState.js"),q=c("./package.json");c("./src/components/index.js"),c("./src/geometries/index.js"),c("./src/shaders/index.js"),c("./src/systems/index.js");var V=c("./src/core/a-node.js").ANode,j=c("./src/core/a-entity.js").AEntity;c("./src/core/a-assets.js"),c("./src/core/a-cubemap.js"),c("./src/core/a-mixin.js"),c("./src/extras/components/index.js"),c("./src/extras/primitives/index.js"),console.log("A-Frame Version: 1.6.0 (Date 2024-05-23, Commit #e6c47761)"),console.log("THREE Version (https://github.com/supermedium/three.js):",P.REVISION),console.log("WebVR Polyfill Version:",q.dependencies["webvr-polyfill"]),window.AFRAME_ASYNC||k.waitForDocumentReadyState(),l.exports=window.AFRAME={AComponent:c("./src/core/component.js").Component,AEntity:j,ANode:V,ANIME:c("./node_modules/super-animejs/lib/anime.es.js").default,AScene:_,components:T,coreComponents:Object.keys(T),geometries:c("./src/core/geometry.js").geometries,registerComponent:E,registerGeometry:C,registerPrimitive:R,registerShader:B,registerSystem:I,primitives:{getMeshMixin:c("./src/extras/primitives/getMeshMixin.js"),primitives:c("./src/extras/primitives/primitives.js").primitives},scenes:c("./src/core/scene/scenes.js"),schema:c("./src/core/schema.js"),shaders:N,systems:D,emitReady:k.emitReady,THREE:P,utils:m,version:q.version}},"./src/lib/rStatsAframe.js":l=>{window.aframeStats=function(u){var c=null,h=u,p={te:{caption:"Entities"},lt:{caption:"Load Time"}},f=[{caption:"A-Frame",values:["te","lt"]}];function g(){c("te").set(m()),window.performance.getEntriesByName&&c("lt").set(window.performance.getEntriesByName("render-started")[0].startTime.toFixed(0))}function m(){var _=h.querySelectorAll("*");return Array.prototype.slice.call(_).filter(function(T){return T.isEntity}),_.length}function y(){}function b(){}function v(_){c=_}return{update:g,start:y,end:b,attach:v,values:p,groups:f,fractions:[]}},l.exports={aframeStats:window.aframeStats}},"./src/lib/three.js":(l,u,c)=>{var h=c("./src/lib/three.mjs").default;c.g.THREE=h,c("./vendor/DeviceOrientationControls.js"),h.Cache&&(h.Cache.enabled=!0),l.exports=h},"./src/shaders/flat.js":(l,u,c)=>{var h=c("./src/core/shader.js").registerShader,p=c("./src/lib/three.js"),f=c("./src/utils/index.js");l.exports.Shader=h("flat",{schema:{color:{type:"color"},fog:{default:!0},height:{default:256},offset:{type:"vec2",default:{x:0,y:0}},repeat:{type:"vec2",default:{x:1,y:1}},src:{type:"map"},width:{default:512},wireframe:{default:!1},wireframeLinewidth:{default:2},toneMapped:{default:!0}},init:function(m){this.materialData={color:new p.Color},g(m,this.materialData),this.material=new p.MeshBasicMaterial(this.materialData)},update:function(m){this.updateMaterial(m),f.material.updateMap(this,m)},updateMaterial:function(m){var y;g(m,this.materialData);for(y in this.materialData)this.material[y]=this.materialData[y]}});function g(m,y){return y.color.set(m.color),y.fog=m.fog,y.wireframe=m.wireframe,y.toneMapped=m.toneMapped,y.wireframeLinewidth=m.wireframeLinewidth,y}},"./src/shaders/index.js":(l,u,c)=>{c("./src/shaders/flat.js"),c("./src/shaders/standard.js"),c("./src/shaders/phong.js"),c("./src/shaders/sdf.js"),c("./src/shaders/msdf.js"),c("./src/shaders/shadow.js")},"./src/shaders/msdf.js":(l,u,c)=>{var h=c("./src/core/shader.js").registerShader,p=c("./src/lib/three.js"),f=["#include <common>","#include <fog_pars_vertex>","#include <logdepthbuf_pars_vertex>","out vec2 vUV;","void main(void) {","  vUV = uv;","  #include <begin_vertex>","  #include <project_vertex>","  #include <logdepthbuf_vertex>","  #include <fog_vertex>","}"].join(`
`),g=["#include <common>","#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","uniform bool negate;","uniform float alphaTest;","uniform float opacity;","uniform sampler2D map;","uniform vec3 color;","in vec2 vUV;","float median(float r, float g, float b) {","  return max(min(r, g), min(max(r, g), b));","}","#define BIG_ENOUGH 0.001","#define MODIFIED_ALPHATEST (0.02 * isBigEnough / BIG_ENOUGH)","void main() {","  vec3 sampleColor = texture(map, vUV).rgb;","  if (negate) { sampleColor = 1.0 - sampleColor; }","  float sigDist = median(sampleColor.r, sampleColor.g, sampleColor.b) - 0.5;","  float alpha = clamp(sigDist / fwidth(sigDist) + 0.5, 0.0, 1.0);","  float dscale = 0.353505;","  vec2 duv = dscale * (dFdx(vUV) + dFdy(vUV));","  float isBigEnough = max(abs(duv.x), abs(duv.y));","  // Do modified alpha test.","  if (isBigEnough > BIG_ENOUGH) {","    float ratio = BIG_ENOUGH / isBigEnough;","    alpha = ratio * alpha + (1.0 - ratio) * (sigDist + 0.5);","  }","  // Do modified alpha test.","  if (alpha < alphaTest * MODIFIED_ALPHATEST) { discard; return; }","  gl_FragColor = vec4(color.xyz, alpha * opacity);","  #include <logdepthbuf_fragment>","  #include <tonemapping_fragment>","  #include <colorspace_fragment>","  #include <fog_fragment>","}"].join(`
`);l.exports.Shader=h("msdf",{schema:{alphaTest:{type:"number",is:"uniform",default:.5},color:{type:"color",is:"uniform",default:"white"},map:{type:"map",is:"uniform"},negate:{type:"boolean",is:"uniform",default:!0},opacity:{type:"number",is:"uniform",default:1}},vertexShader:f,fragmentShader:g,init:function(){return this.uniforms=p.UniformsUtils.merge([p.UniformsLib.fog,this.initUniforms()]),this.material=new p.ShaderMaterial({uniforms:this.uniforms,vertexShader:this.vertexShader,fragmentShader:this.fragmentShader,fog:!0}),this.material}})},"./src/shaders/phong.js":(l,u,c)=>{var h=c("./src/core/shader.js").registerShader,p=c("./src/lib/three.js"),f=c("./src/utils/index.js");l.exports.Shader=h("phong",{schema:{color:{type:"color"},emissive:{type:"color",default:"black"},emissiveIntensity:{default:1},specular:{type:"color",default:"#111111"},transparent:{default:!1},fog:{default:!0},offset:{type:"vec2",default:{x:0,y:0}},repeat:{type:"vec2",default:{x:1,y:1}},src:{type:"map"},envMap:{default:""},sphericalEnvMap:{type:"map"},shininess:{default:30},flatShading:{default:!1},wireframe:{default:!1},wireframeLinewidth:{default:2},combine:{oneOF:["multiply","mix","add"],default:"mix"},reflectivity:{default:.9},refractionRatio:{default:.98},refract:{default:!1},normalMap:{type:"map"},normalScale:{type:"vec2",default:{x:1,y:1}},normalTextureOffset:{type:"vec2"},normalTextureRepeat:{type:"vec2",default:{x:1,y:1}},ambientOcclusionMap:{type:"map"},ambientOcclusionMapIntensity:{default:1},displacementMap:{type:"map"},displacementScale:{default:1},displacementBias:{default:.5},displacementTextureOffset:{type:"vec2"},displacementTextureRepeat:{type:"vec2",default:{x:1,y:1}},bumpMap:{type:"map"},bumpMapScale:{default:1},bumpTextureOffset:{type:"vec2"},bumpTextureRepeat:{type:"vec2",default:{x:1,y:1}}},init:function(m){this.materialData={color:new p.Color,specular:new p.Color,emissive:new p.Color},g(m,this.materialData),this.material=new p.MeshPhongMaterial(this.materialData);var y=this.el.sceneEl;Object.defineProperty(this.material,"envMap",{get:function(){return this._envMap||y.object3D.environment},set:function(b){this._envMap=b}})},update:function(m){this.updateMaterial(m),f.material.updateMap(this,m),f.material.updateDistortionMap("normal",this,m),f.material.updateDistortionMap("displacement",this,m),f.material.updateDistortionMap("ambientOcclusion",this,m),f.material.updateDistortionMap("bump",this,m),f.material.updateEnvMap(this,m)},updateMaterial:function(m){var y;g(m,this.materialData);for(y in this.materialData)this.material[y]=this.materialData[y]}});function g(m,y){switch(y.color.set(m.color),y.specular.set(m.specular),y.emissive.set(m.emissive),y.emissiveIntensity=m.emissiveIntensity,y.fog=m.fog,y.transparent=m.transparent,y.wireframe=m.wireframe,y.wireframeLinewidth=m.wireframeLinewidth,y.shininess=m.shininess,y.flatShading=m.flatShading,y.wireframe=m.wireframe,y.wireframeLinewidth=m.wireframeLinewidth,y.reflectivity=m.reflectivity,y.refractionRatio=m.refractionRatio,m.combine){case"mix":y.combine=p.MixOperation;break;case"multiply":y.combine=p.MultiplyOperation;break;case"add":y.combine=p.AddOperation;break}return m.normalMap&&(y.normalScale=m.normalScale),m.ambientOcclusionMap&&(y.aoMapIntensity=m.ambientOcclusionMapIntensity),m.bumpMap&&(y.bumpScale=m.bumpMapScale),m.displacementMap&&(y.displacementScale=m.displacementScale,y.displacementBias=m.displacementBias),y}},"./src/shaders/sdf.js":(l,u,c)=>{var h=c("./src/core/shader.js").registerShader,p=c("./src/lib/three.js"),f=["#include <common>","#include <fog_pars_vertex>","#include <logdepthbuf_pars_vertex>","out vec2 vUV;","void main(void) {","  vUV = uv;","  #include <begin_vertex>","  #include <project_vertex>","  #include <logdepthbuf_vertex>","  #include <fog_vertex>","}"].join(`
`),g=["#include <common>","#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","uniform float alphaTest;","uniform float opacity;","uniform sampler2D map;","uniform vec3 color;","in vec2 vUV;","float contour(float width, float value) {","  return smoothstep(0.5 - value, 0.5 + value, width);","}","#define BIG_ENOUGH 0.001","#define MODIFIED_ALPHATEST (0.02 * isBigEnough / BIG_ENOUGH)","void main() {","  vec2 uv = vUV;","  vec4 texColor = texture(map, uv);","  float dist = texColor.a;","  float width = fwidth(dist);","  float alpha = contour(dist, width);","  float dscale = 0.353505;","  vec2 duv = dscale * (dFdx(uv) + dFdy(uv));","  float isBigEnough = max(abs(duv.x), abs(duv.y));","  if (isBigEnough > BIG_ENOUGH) {","    float ratio = BIG_ENOUGH / isBigEnough;","    alpha = ratio * alpha + (1.0 - ratio) * dist;","  }","  if (isBigEnough <= BIG_ENOUGH) {","    vec4 box = vec4 (uv - duv, uv + duv);","    alpha = (alpha + 0.5 * (","      contour(texture(map, box.xy).a, width)","      + contour(texture(map, box.zw).a, width)","      + contour(texture(map, box.xw).a, width)","      + contour(texture(map, box.zy).a, width)","    )) / 3.0;","  }","  if (alpha < alphaTest * MODIFIED_ALPHATEST) { discard; return; }","  gl_FragColor = vec4(color, opacity * alpha);","  #include <logdepthbuf_fragment>","  #include <tonemapping_fragment>","  #include <colorspace_fragment>","  #include <fog_fragment>","}"].join(`
`);l.exports.Shader=h("sdf",{schema:{alphaTest:{type:"number",is:"uniform",default:.5},color:{type:"color",is:"uniform",default:"white"},map:{type:"map",is:"uniform"},opacity:{type:"number",is:"uniform",default:1}},vertexShader:f,fragmentShader:g,init:function(){return this.uniforms=p.UniformsUtils.merge([p.UniformsLib.fog,this.initUniforms()]),this.material=new p.ShaderMaterial({uniforms:this.uniforms,vertexShader:this.vertexShader,fragmentShader:this.fragmentShader,fog:!0}),this.material}})},"./src/shaders/shadow.js":(l,u,c)=>{var h=c("./src/core/shader.js").registerShader,p=c("./src/lib/three.js");l.exports.Shader=h("shadow",{schema:{opacity:{default:.5},transparent:{default:!0},alphaToCoverage:{default:!0}},init:function(f){this.material=new p.ShadowMaterial},update:function(f){this.material.opacity=f.opacity,this.material.alphaToCoverage=f.alphaToCoverage,this.material.transparent=f.transparent}})},"./src/shaders/standard.js":(l,u,c)=>{var h=c("./src/core/shader.js").registerShader,p=c("./src/lib/three.js"),f=c("./src/utils/index.js");l.exports.Shader=h("standard",{schema:{ambientOcclusionMap:{type:"map"},ambientOcclusionMapIntensity:{default:1},ambientOcclusionTextureOffset:{type:"vec2"},ambientOcclusionTextureRepeat:{type:"vec2",default:{x:1,y:1}},color:{type:"color"},displacementMap:{type:"map"},displacementScale:{default:1},displacementBias:{default:.5},displacementTextureOffset:{type:"vec2"},displacementTextureRepeat:{type:"vec2",default:{x:1,y:1}},emissive:{type:"color",default:"#000"},emissiveIntensity:{default:1},envMap:{default:""},fog:{default:!0},height:{default:256},metalness:{default:0,min:0,max:1},metalnessMap:{type:"map"},metalnessTextureOffset:{type:"vec2"},metalnessTextureRepeat:{type:"vec2",default:{x:1,y:1}},normalMap:{type:"map"},normalScale:{type:"vec2",default:{x:1,y:1}},normalTextureOffset:{type:"vec2"},normalTextureRepeat:{type:"vec2",default:{x:1,y:1}},offset:{type:"vec2",default:{x:0,y:0}},repeat:{type:"vec2",default:{x:1,y:1}},roughness:{default:.5,min:0,max:1},roughnessMap:{type:"map"},roughnessTextureOffset:{type:"vec2"},roughnessTextureRepeat:{type:"vec2",default:{x:1,y:1}},sphericalEnvMap:{type:"map"},src:{type:"map"},width:{default:512},wireframe:{default:!1},wireframeLinewidth:{default:2}},init:function(m){this.materialData={color:new p.Color,emissive:new p.Color},g(m,this.materialData),this.material=new p.MeshStandardMaterial(this.materialData)},update:function(m){this.updateMaterial(m),f.material.updateMap(this,m),f.material.updateDistortionMap("normal",this,m),f.material.updateDistortionMap("displacement",this,m),f.material.updateDistortionMap("ambientOcclusion",this,m),f.material.updateDistortionMap("metalness",this,m),f.material.updateDistortionMap("roughness",this,m),f.material.updateEnvMap(this,m)},updateMaterial:function(m){var y,b=this.material;g(m,this.materialData);for(y in this.materialData)b[y]=this.materialData[y]}});function g(m,y){return y.color.set(m.color),y.emissive.set(m.emissive),y.emissiveIntensity=m.emissiveIntensity,y.fog=m.fog,y.metalness=m.metalness,y.roughness=m.roughness,y.wireframe=m.wireframe,y.wireframeLinewidth=m.wireframeLinewidth,m.normalMap&&(y.normalScale=m.normalScale),m.ambientOcclusionMap&&(y.aoMapIntensity=m.ambientOcclusionMapIntensity),m.displacementMap&&(y.displacementScale=m.displacementScale,y.displacementBias=m.displacementBias),y}},"./src/systems/camera.js":(l,u,c)=>{var h=c("./src/constants/index.js"),p=c("./src/core/system.js").registerSystem,f="data-aframe-default-camera";l.exports.System=p("camera",{init:function(){this.activeCameraEl=null,this.render=this.render.bind(this),this.unwrapRender=this.unwrapRender.bind(this),this.wrapRender=this.wrapRender.bind(this),this.initialCameraFound=!1,this.numUserCameras=0,this.numUserCamerasChecked=0,this.setupInitialCamera()},setupInitialCamera:function(){var m,y,b=this.sceneEl,v=this;if(b.camera&&!b.camera.el.getAttribute("camera").spectator){b.emit("cameraready",{cameraEl:b.camera.el});return}if(m=b.querySelectorAll("a-camera, :not(a-mixin)[camera]"),!m.length){this.createDefaultCamera();return}for(this.numUserCameras=m.length,y=0;y<m.length;y++)m[y].addEventListener("object3dset",function(_){_.detail.type==="camera"&&v.checkUserCamera(this)}),m[y].isNode?m[y].load():m[y].addEventListener("nodeready",function(){this.load()})},checkUserCamera:function(m){var y,b=this.el.sceneEl;if(this.numUserCamerasChecked++,!this.initialCameraFound){if(y=m.getAttribute("camera"),!y.active||y.spectator){this.numUserCamerasChecked===this.numUserCameras&&this.createDefaultCamera();return}this.initialCameraFound=!0,b.camera=m.getObject3D("camera"),b.emit("cameraready",{cameraEl:m})}},createDefaultCamera:function(){var m,y=this.sceneEl;m=document.createElement("a-entity"),m.setAttribute("camera",{active:!0}),m.setAttribute("position",{x:0,y:h.DEFAULT_CAMERA_HEIGHT,z:0}),m.setAttribute("wasd-controls",""),m.setAttribute("look-controls",""),m.setAttribute(h.AFRAME_INJECTED,""),m.addEventListener("object3dset",function(b){b.detail.type==="camera"&&(y.camera=b.detail.object,y.emit("cameraready",{cameraEl:m}))}),y.appendChild(m)},disableActiveCamera:function(){var m,y;m=this.sceneEl.querySelectorAll(":not(a-mixin)[camera]"),y=m[m.length-1],y.setAttribute("camera","active",!0)},setActiveCamera:function(m){var y,b,v,_,T=this.activeCameraEl,E=this.sceneEl;if(_=m.getObject3D("camera"),!(!_||m===this.activeCameraEl)){var C=E.querySelector("["+f+"]"),R=C&&C.querySelector(":not(a-mixin)[camera]");for(m!==R&&g(E),this.activeCameraEl=m,this.activeCameraEl.play(),E.camera=_,T&&T.setAttribute("camera","active",!1),b=E.querySelectorAll(":not(a-mixin)[camera]"),v=0;v<b.length;v++)y=b[v],!(!y.isEntity||m===y)&&(y.setAttribute("camera","active",!1),y.pause());E.emit("camera-set-active",{cameraEl:m})}},setSpectatorCamera:function(m){var y,b=this.spectatorCameraEl,v=this.sceneEl,_;y=m.getObject3D("camera"),!(!y||m===this.spectatorCameraEl)&&(b&&b.setAttribute("camera","spectator",!1),_=this.spectatorCameraEl=m,v.addEventListener("enter-vr",this.wrapRender),v.addEventListener("exit-vr",this.unwrapRender),_.setAttribute("camera","active",!1),_.play(),v.emit("camera-set-spectator",{cameraEl:m}))},disableSpectatorCamera:function(){this.spectatorCameraEl=void 0},wrapRender:function(){!this.spectatorCameraEl||this.originalRender||(this.originalRender=this.sceneEl.renderer.render,this.sceneEl.renderer.render=this.render)},unwrapRender:function(){this.originalRender&&(this.sceneEl.renderer.render=this.originalRender,this.originalRender=void 0)},render:function(m,y){var b,v=this.sceneEl,_;b=v.renderer.xr.enabled,this.originalRender.call(v.renderer,m,y),!(!this.spectatorCameraEl||v.isMobile||!b)&&(_=this.spectatorCameraEl.components.camera.camera,v.renderer.xr.enabled=!1,this.originalRender.call(v.renderer,m,_),v.renderer.xr.enabled=b)}});function g(m){var y,b=m.camera;b&&(y=m.querySelector("["+f+"]"),y&&m.removeChild(y))}},"./src/systems/geometry.js":(l,u,c)=>{var h=c("./src/core/geometry.js").geometries,p=c("./src/core/system.js").registerSystem;l.exports.System=p("geometry",{init:function(){this.cache={},this.cacheCount={}},clearCache:function(){this.cache={},this.cacheCount={}},getOrCreateGeometry:function(y){var b=this.cache,v,_;return y.skipCache?f(y):(_=this.hash(y),v=b[_],m(this.cacheCount,_),v||(v=f(y),b[_]=v,v))},unuseGeometry:function(y){var b=this.cache,v=this.cacheCount,_,T;y.skipCache||(T=this.hash(y),b[T]&&(g(v,T),!(v[T]>0)&&(_=b[T],_.dispose(),delete b[T],delete v[T])))},hash:function(y){return JSON.stringify(y)}});function f(y){var b=y.primitive,v=h[b]&&h[b].Geometry,_=new v;if(!v)throw new Error("Unknown geometry `"+b+"`");return _.init(y),_.geometry}function g(y,b){y[b]--}function m(y,b){y[b]=y[b]===void 0?1:y[b]+1}},"./src/systems/gltf-model.js":(l,u,c)=>{var h=c("./src/core/system.js").registerSystem,p=c("./src/lib/three.js");function f(g){return new Promise(function(m,y){var b=document.createElement("script");document.body.appendChild(b),b.onload=m,b.onerror=y,b.async=!0,b.src=g})}l.exports.System=h("gltf-model",{schema:{dracoDecoderPath:{default:"https://www.gstatic.com/draco/versioned/decoders/1.5.6/"},basisTranscoderPath:{default:""},meshoptDecoderPath:{default:""}},init:function(){this.update()},update:function(){var g=this.data.dracoDecoderPath,m=this.data.basisTranscoderPath,y=this.data.meshoptDecoderPath;!this.dracoLoader&&g&&(this.dracoLoader=new p.DRACOLoader,this.dracoLoader.setDecoderPath(g)),!this.ktx2Loader&&m&&(this.ktx2Loader=new p.KTX2Loader,this.ktx2Loader.setTranscoderPath(m).detectSupport(this.el.renderer)),!this.meshoptDecoder&&y&&(this.meshoptDecoder=f(y).then(function(){return window.MeshoptDecoder.ready}).then(function(){return window.MeshoptDecoder}))},getDRACOLoader:function(){return this.dracoLoader},getKTX2Loader:function(){return this.ktx2Loader},getMeshoptDecoder:function(){return this.meshoptDecoder}})},"./src/systems/index.js":(l,u,c)=>{c("./src/systems/camera.js"),c("./src/systems/geometry.js"),c("./src/systems/gltf-model.js"),c("./src/systems/light.js"),c("./src/systems/material.js"),c("./src/systems/obb-collider.js"),c("./src/systems/renderer.js"),c("./src/systems/shadow.js"),c("./src/systems/tracked-controls-webvr.js"),c("./src/systems/tracked-controls-webxr.js"),c("./src/systems/webxr.js")},"./src/systems/light.js":(l,u,c)=>{var h=c("./src/core/system.js").registerSystem,p=c("./src/constants/index.js"),f="data-aframe-default-light";l.exports.System=h("light",{schema:{defaultLightsEnabled:{default:!0}},init:function(){this.defaultLights=!1,this.userDefinedLights=!1,this.sceneEl.addEventListener("loaded",this.setupDefaultLights.bind(this))},registerLight:function(g){g.hasAttribute(f)||(this.removeDefaultLights(),this.userDefinedLights=!0)},removeDefaultLights:function(){var g,m=this.sceneEl;if(this.defaultLights){g=document.querySelectorAll("["+f+"]");for(var y=0;y<g.length;y++)m.removeChild(g[y]);this.defaultLights=!1}},setupDefaultLights:function(){var g=this.sceneEl,m,y;this.userDefinedLights||this.defaultLights||!this.data.defaultLightsEnabled||(m=document.createElement("a-entity"),m.setAttribute("light",{color:"#BBB",type:"ambient"}),m.setAttribute(f,""),m.setAttribute(p.AFRAME_INJECTED,""),g.appendChild(m),y=document.createElement("a-entity"),y.setAttribute("light",{color:"#FFF",intensity:.6,castShadow:!0}),y.setAttribute("position",{x:-.5,y:1,z:1}),y.setAttribute(f,""),y.setAttribute(p.AFRAME_INJECTED,""),g.appendChild(y),this.defaultLights=!0)}})},"./src/systems/material.js":(l,u,c)=>{var h=c("./src/core/system.js").registerSystem,p=c("./src/lib/three.js"),f=c("./src/utils/index.js"),g=c("./src/utils/material.js").setTextureProperties,m=c("./src/utils/material.js").createCompatibleTexture,y=f.debug,b=y("components:texture:error"),v=y("components:texture:warn"),_=new p.ImageLoader;l.exports.System=h("material",{init:function(){this.materials={},this.sourceCache={}},clearTextureSourceCache:function(){this.sourceCache={}},loadTexture:function(R,B,I){this.loadTextureSource(R,function(N){var D=m(N);g(D,B),I(D)})},loadTextureSource:function(R,B){var I=this,N=this.sourceCache,D=this.hash(R);if(N[D]){N[D].then(B);return}if(R.tagName==="CANVAS"){k(new p.Source(R));return}k(new Promise(P));function P(q,V){f.srcLoader.validateSrc(R,j,Q);function j(W){I.loadImage(W,q)}function Q(W){I.loadVideo(W,q)}}function k(q){N[D]=Promise.resolve(q),N[D].then(B)}},loadCubeMapTexture:function(R,B){var I=this,N=0,D=new p.CubeTexture;D.colorSpace=p.SRGBColorSpace;function P(q){I.loadTextureSource(R[q],function(V){D.images[q]=V,N++,N===6&&(D.needsUpdate=!0,B(D))})}if(R.length!==6){v("Cube map texture requires exactly 6 sources, got only %s sources",R.length);return}for(var k=0;k<R.length;k++)P(k)},loadImage:function(R,B){if(typeof R!="string"){B(new p.Source(R));return}B(T(R))},loadVideo:function(R,B){var I;typeof R!="string"&&(I=R,C(I)),I=I||E(R),B(new p.Source(I))},hash:function(R){return R.tagName&&(R.id||R.src)||R},registerMaterial:function(R){this.materials[R.uuid]=R},unregisterMaterial:function(R){delete this.materials[R.uuid]}});function T(R){return new Promise(B);function B(I,N){_.load(R,D,function(){},function(P){b("`$s` could not be fetched (Error code: %s; Response: %s)",P.status,P.statusText)});function D(P){I(new p.Source(P))}}}function E(R){var B=document.createElement("video");return B.setAttribute("playsinline",""),B.setAttribute("webkit-playsinline",""),B.autoplay=!0,B.loop=!0,B.crossOrigin="anonymous",B.addEventListener("error",function(){v("`%s` is not a valid video",R)},!0),B.src=R,B}function C(R){return R.autoplay=R.hasAttribute("autoplay")&&R.getAttribute("autoplay")!=="false",R.controls=R.hasAttribute("controls")&&R.getAttribute("controls")!=="false",R.getAttribute("loop")==="false"&&R.removeAttribute("loop"),R.getAttribute("preload")==="false"&&(R.preload="none"),R.crossOrigin=R.crossOrigin||"anonymous",R.setAttribute("playsinline",""),R.setAttribute("webkit-playsinline",""),R}},"./src/systems/obb-collider.js":(l,u,c)=>{var h=c("./src/core/system.js").registerSystem;h("obb-collider",{schema:{showColliders:{default:!1}},init:function(){this.collisions=[],this.colliderEls=[]},addCollider:function(p){this.colliderEls.push(p),this.data.showColliders?p.components["obb-collider"].showCollider():p.components["obb-collider"].hideCollider(),this.tick=this.detectCollisions},removeCollider:function(p){var f=this.colliderEls,g=f.indexOf(p);p.components["obb-collider"].hideCollider(),g>-1&&f.splice(g,1),f.length===0&&(this.tick=void 0)},registerCollision:function(p,f){var g=this.collisions,m=!1,y=p.obb,b=f.obb,v=p.renderColliderMesh,_=f.renderColliderMesh;v&&v.material.color.set(16711680),_&&_.material.color.set(16711680);for(var T=0;T<g.length;T++)if(g[T].componentA.obb===y&&g[T].componentB.obb===b||g[T].componentA.obb===b&&g[T].componentB.obb===y){m=!0,g[T].detected=!0;break}m||(g.push({componentA:p,componentB:f,detected:!0}),p.el.emit("obbcollisionstarted",{trackedObject3D:p.trackedObject3D,withEl:f.el}),f.el.emit("obbcollisionstarted",{trackedObject3D:f.trackedObject3D,withEl:p.el}))},resetCollisions:function(){for(var p=this.collisions,f=0;f<p.length;f++)p[f].detected=!1},clearCollisions:function(){for(var p=this.collisions,f=[],g,m,y,b,v=0;v<p.length;v++)p[v].detected?f.push(p[v]):(g=p[v].componentA,m=p[v].componentB,y=g.renderColliderMesh,b=m.renderColliderMesh,y&&y.material.color.set(65280),g.el.emit("obbcollisionended",{trackedObject3D:this.trackedObject3D,withEl:m.el}),b&&b.material.color.set(65280),m.el.emit("obbcollisionended",{trackedObject3D:this.trackedObject3D,withEl:g.el}));this.collisions=f},detectCollisions:function(){var p,f,g,m,y=this.colliderEls;if(!(y.length<2)){this.resetCollisions();for(var b=0;b<y.length;b++)if(g=y[b].components["obb-collider"],p=y[b].components["obb-collider"].obb,!(p.halfSize.x===0||p.halfSize.y===0||p.halfSize.z===0))for(var v=b+1;v<y.length;v++)m=y[v].components["obb-collider"],f=m.obb,!(f.halfSize.x===0||f.halfSize.y===0||f.halfSize.z===0)&&p.intersectsOBB(f)&&this.registerCollision(g,m);this.clearCollisions()}}})},"./src/systems/renderer.js":(l,u,c)=>{var h=c("./src/core/system.js").registerSystem,p=c("./src/utils/index.js"),f=c("./src/lib/three.js"),g=p.debug,m=g("components:renderer:warn");l.exports.System=h("renderer",{schema:{antialias:{default:"auto",oneOf:["true","false","auto"]},highRefreshRate:{default:p.device.isOculusBrowser()},logarithmicDepthBuffer:{default:"auto",oneOf:["true","false","auto"]},maxCanvasWidth:{default:-1},maxCanvasHeight:{default:-1},multiviewStereo:{default:!1},physicallyCorrectLights:{default:!1},exposure:{default:1,if:{toneMapping:["ACESFilmic","linear","reinhard","cineon"]}},toneMapping:{default:"no",oneOf:["no","ACESFilmic","linear","reinhard","cineon"]},precision:{default:"high",oneOf:["high","medium","low"]},anisotropy:{default:1},sortTransparentObjects:{default:!1},colorManagement:{default:!0},alpha:{default:!0},stencil:{default:!1},foveationLevel:{default:1}},init:function(){var _=this.data,T=this.el,E=this.data.toneMapping.charAt(0).toUpperCase()+this.data.toneMapping.slice(1),C=T.renderer;_.physicallyCorrectLights||(C.useLegacyLights=!_.physicallyCorrectLights),C.toneMapping=f[E+"ToneMapping"],f.Texture.DEFAULT_ANISOTROPY=_.anisotropy,f.ColorManagement.enabled=_.colorManagement,C.outputColorSpace=_.colorManagement?f.SRGBColorSpace:f.LinearSRGBColorSpace,T.hasAttribute("antialias")&&m('Component `antialias` is deprecated. Use `renderer="antialias: true"` instead.'),T.hasAttribute("logarithmicDepthBuffer")&&m('Component `logarithmicDepthBuffer` is deprecated. Use `renderer="logarithmicDepthBuffer: true"` instead.'),C.sortObjects=!0,C.setOpaqueSort(y)},update:function(){var _=this.data,T=this.el,E=T.renderer,C=this.data.toneMapping.charAt(0).toUpperCase()+this.data.toneMapping.slice(1);E.toneMapping=f[C+"ToneMapping"],E.toneMappingExposure=_.exposure,E.xr.setFoveation(_.foveationLevel),_.sortObjects&&m('`sortObjects` property is deprecated. Use `renderer="sortTransparentObjects: true"` instead.'),_.sortTransparentObjects?E.setTransparentSort(v):E.setTransparentSort(b)},applyColorCorrection:function(_){!this.data.colorManagement||!_||_.isTexture&&_.colorSpace!==f.SRGBColorSpace&&(_.colorSpace=f.SRGBColorSpace,_.needsUpdate=!0)},setWebXRFrameRate:function(_){var T=this.data,E=_.supportedFrameRates;if(E&&_.updateTargetFrameRate){var C;E.includes(90)?C=T.highRefreshRate?90:72:C=T.highRefreshRate?72:60,_.updateTargetFrameRate(C).catch(function(R){console.warn("failed to set target frame rate of "+C+". Error info: "+R)})}}});function y(_,T){return _.groupOrder!==T.groupOrder?_.groupOrder-T.groupOrder:_.renderOrder!==T.renderOrder?_.renderOrder-T.renderOrder:_.z-T.z}function b(_,T){return _.groupOrder!==T.groupOrder?_.groupOrder-T.groupOrder:_.renderOrder-T.renderOrder}function v(_,T){return _.groupOrder!==T.groupOrder?_.groupOrder-T.groupOrder:_.renderOrder!==T.renderOrder?_.renderOrder-T.renderOrder:T.z-_.z}l.exports.sortFrontToBack=y,l.exports.sortRenderOrderOnly=b,l.exports.sortBackToFront=v},"./src/systems/shadow.js":(l,u,c)=>{var h=c("./src/core/system.js").registerSystem,p=c("./src/lib/three.js"),f={basic:p.BasicShadowMap,pcf:p.PCFShadowMap,pcfsoft:p.PCFSoftShadowMap};l.exports.System=h("shadow",{schema:{enabled:{default:!0},autoUpdate:{default:!0},type:{default:"pcf",oneOf:["basic","pcf","pcfsoft"]}},init:function(){var m=this.sceneEl,y=this.data;this.shadowMapEnabled=!1,m.renderer.shadowMap.type=f[y.type],m.renderer.shadowMap.autoUpdate=y.autoUpdate},update:function(m){m.enabled!==this.data.enabled&&this.setShadowMapEnabled(this.shadowMapEnabled)},setShadowMapEnabled:function(m){var y=this.sceneEl,b=this.sceneEl.renderer;this.shadowMapEnabled=m;var v=this.data.enabled&&this.shadowMapEnabled;b&&v!==b.shadowMap.enabled&&(b.shadowMap.enabled=v,g(y))}});function g(m){m.hasLoaded&&m.object3D.traverse(function(y){if(y.material)for(var b=Array.isArray(y.material)?y.material:[y.material],v=0;v<b.length;v++)b[v].needsUpdate=!0})}},"./src/systems/tracked-controls-webvr.js":(l,u,c)=>{var h=c("./src/core/system.js").registerSystem,p=c("./src/utils/index.js"),f=p.device.isWebXRAvailable;l.exports.System=h("tracked-controls-webvr",{init:function(){var g=this;this.controllers=[],this.isChrome=navigator.userAgent.indexOf("Chrome")!==-1,this.updateControllerList(),this.throttledUpdateControllerList=p.throttle(this.updateControllerList,500,this),!f&&navigator.getVRDisplays&&this.sceneEl.addEventListener("enter-vr",function(){navigator.getVRDisplays().then(function(m){m.length&&(g.vrDisplay=m[0])})})},tick:function(){this.isChrome?this.updateControllerList():this.throttledUpdateControllerList()},updateControllerList:function(){var g=this.controllers,m,y,b,v;if(y=navigator.getGamepads&&navigator.getGamepads(),!!y){for(v=g.length,g.length=0,b=0;b<y.length;++b)m=y[b],m&&m.pose&&g.push(m);g.length!==v&&this.el.emit("controllersupdated",void 0,!1)}}})},"./src/systems/tracked-controls-webxr.js":(l,u,c)=>{var h=c("./src/core/system.js").registerSystem,p=c("./src/utils/index.js");l.exports.System=h("tracked-controls-webxr",{init:function(){this.controllers=[],this.oldControllers=[],this.oldControllersLength=0,this.throttledUpdateControllerList=p.throttle(this.updateControllerList,500,this),this.updateReferenceSpace=this.updateReferenceSpace.bind(this),this.el.addEventListener("enter-vr",this.updateReferenceSpace),this.el.addEventListener("exit-vr",this.updateReferenceSpace)},tick:function(){this.throttledUpdateControllerList()},updateReferenceSpace:function(){var f=this,g=this.el.xrSession;if(!g){this.referenceSpace=void 0,this.controllers=[],this.oldControllersLength>0&&(this.oldControllersLength=0,this.el.emit("controllersupdated",void 0,!1));return}var m=f.el.sceneEl.systems.webxr.sessionReferenceSpaceType;g.requestReferenceSpace(m).then(function(y){f.referenceSpace=y}).catch(function(y){throw f.el.sceneEl.systems.webxr.warnIfFeatureNotRequested(m,'tracked-controls-webxr uses reference space "'+m+'".'),y})},updateControllerList:function(){var f=this.el.xrSession,g=this.oldControllers,m;if(!f){if(this.oldControllersLength===0)return;this.oldControllersLength=0,this.controllers=[],this.el.emit("controllersupdated",void 0,!1);return}if(f.inputSources){if(this.controllers=f.inputSources,this.oldControllersLength===this.controllers.length){var y=!0;for(m=0;m<this.controllers.length;++m)if(!(this.controllers[m]===g[m]&&this.controllers[m].gamepad===g[m].gamepad)){y=!1;break}if(y)return}for(g.length=0,m=0;m<this.controllers.length;m++)g.push(this.controllers[m]);this.oldControllersLength=this.controllers.length,this.el.emit("controllersupdated",void 0,!1)}}})},"./src/systems/webxr.js":(l,u,c)=>{var h=c("./src/core/system.js").registerSystem,p=c("./src/utils/index.js"),f=p.debug("systems:webxr:warn");l.exports.System=h("webxr",{schema:{referenceSpaceType:{type:"string",default:"local-floor"},requiredFeatures:{type:"array",default:["local-floor"]},optionalFeatures:{type:"array",default:["bounded-floor"]},overlayElement:{type:"selector"}},update:function(){var g=this.data;this.sessionConfiguration={requiredFeatures:g.requiredFeatures,optionalFeatures:g.optionalFeatures},this.sessionReferenceSpaceType=g.referenceSpaceType,g.overlayElement&&(g.overlayElement.classList.remove("a-dom-overlay"),g.optionalFeatures.includes("dom-overlay")||(g.optionalFeatures.push("dom-overlay"),this.el.setAttribute("webxr",g)),this.warnIfFeatureNotRequested("dom-overlay"),this.sessionConfiguration.domOverlay={root:g.overlayElement},g.overlayElement.classList.add("a-dom-overlay"))},wasFeatureRequested:function(g){return!!(g==="viewer"||g==="local"||this.sessionConfiguration.requiredFeatures.includes(g)||this.sessionConfiguration.optionalFeatures.includes(g))},warnIfFeatureNotRequested:function(g,m){if(!this.wasFeatureRequested(g)){var y='Please add the feature "'+g+`" to a-scene's webxr system options in requiredFeatures/optionalFeatures.`;f((m?m+" ":"")+y)}}})},"./src/utils/coordinates.js":(l,u,c)=>{var h=c("./src/utils/debug.js"),p=h("utils:coordinates:warn"),f=["x","y","z","w"],g=/^\s*((-?\d*\.{0,1}\d+(e-?\d+)?)\s+){2,3}(-?\d*\.{0,1}\d+(e-?\d+)?)\s*$/;l.exports.regex=g;var m=/\s+/g;function y(E,C,R){var B,I,N,D,P=R&&typeof R=="object"?R:{},k,q,V,j;if(E&&E instanceof Object)return k=E.x===void 0?C&&C.x:E.x,q=E.y===void 0?C&&C.y:E.y,V=E.z===void 0?C&&C.z:E.z,j=E.w===void 0?C&&C.w:E.w,k!=null&&(P.x=T(k)),q!=null&&(P.y=T(q)),V!=null&&(P.z=T(V)),j!=null&&(P.w=T(j)),P;if(E==null)return typeof C=="object"?Object.assign(P,C):C;for(B=E.trim().split(m),D=0;D<f.length;D++)if(N=f[D],B[D])P[N]=parseFloat(B[D],10);else{if(I=C&&C[N],I===void 0)continue;P[N]=T(I)}return P}l.exports.parse=y;function b(E){var C;return typeof E!="object"?E:(C=E.x+" "+E.y,E.z!=null&&(C+=" "+E.z),E.w!=null&&(C+=" "+E.w),C)}l.exports.stringify=b;function v(E,C){return typeof E!="object"||typeof C!="object"?E===C:E.x===C.x&&E.y===C.y&&E.z===C.z&&E.w===C.w}l.exports.equals=v;function _(E){return g.test(E)}l.exports.isCoordinates=_,l.exports.isCoordinate=function(E){return p("`AFRAME.utils.isCoordinate` has been renamed to `AFRAME.utils.isCoordinates`"),_(E)};function T(E){return E!=null&&E.constructor===String?parseFloat(E,10):E}l.exports.toVector3=function(E){return new THREE.Vector3(E.x,E.y,E.z)}},"./src/utils/debug.js":(l,u,c)=>{var h=c("./node_modules/debug/src/browser.js"),p=c("./src/utils/device.js").isBrowserEnvironment,f={colors:{debug:"gray",error:"red",info:"gray",warn:"orange"}};h.formatArgs=g;function g(_){if(_[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+_[0]+(this.useColors?"%c ":" "),!!this.useColors){this.color=y(this.namespace);var T="color: "+this.color;_.splice(1,0,T,"color: inherit");var E=0,C=0;_[0].replace(/%[a-zA-Z%]/g,function(R){R!=="%%"&&(E++,R==="%c"&&(C=E))}),_.splice(C,0,T)}}function m(_){var T=_.split(":");return T[T.length-1]}function y(_){var T=m(_),E=f.colors&&f.colors[T];return E||null}function b(){try{return window.localStorage}catch{}}var v=b();v&&(parseInt(v.logs,10)||v.logs==="true")?h.enable("*"):h.enable("*:error,*:info,*:warn"),p&&(window.logs=h),l.exports=h},"./src/utils/device.js":(l,u,c)=>{var h=c("./node_modules/debug/src/browser.js")("device:error"),p,f=!1,g=!1,m=l.exports.isWebXRAvailable=navigator.xr!==void 0;if(window.addEventListener("vrdisplayactivate",function(V){var j;m||(j=document.createElement("canvas"),p=V.display,j.getContext("webgl",{}),p.requestPresent([{source:j}]).then(function(){},function(){}))}),m){var y=function(){var V=document.querySelector("a-scene");if(!V){window.addEventListener("DOMContentLoaded",y);return}V.hasLoaded?V.components["xr-mode-ui"].updateEnterInterfaces():V.addEventListener("loaded",y)},b=function(V){h("WebXR session support error: "+V.message)};navigator.xr.isSessionSupported?(navigator.xr.isSessionSupported("immersive-vr").then(function(V){f=V,y()}).catch(b),navigator.xr.isSessionSupported("immersive-ar").then(function(V){g=V,y()}).catch(function(){})):navigator.xr.supportsSession?(navigator.xr.supportsSession("immersive-vr").then(function(){f=!0,y()}).catch(b),navigator.xr.supportsSession("immersive-ar").then(function(){g=!0,y()}).catch(function(){})):h("WebXR has neither isSessionSupported or supportsSession?!")}else navigator.getVRDisplays&&navigator.getVRDisplays().then(function(V){var j=document.querySelector("a-scene");p=V.length&&V[0],j&&j.emit("displayconnected",{vrDisplay:p})});function v(){return p}l.exports.getVRDisplay=v;function _(){return f||g||!!v()}l.exports.checkHeadsetConnected=_;function T(){return g}l.exports.checkARSupport=T;function E(){return f}l.exports.checkVRSupport=E;var C=function(){var V=!1;return function(j){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(j)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(j.substr(0,4)))&&(V=!0),(I()||R()||q())&&(V=!0),k()&&(V=!1)}(window.navigator.userAgent||window.navigator.vendor||window.opera),function(){return V}}();l.exports.isMobile=C;function R(V){var j=V||window.navigator.userAgent,Q=/Nexus (7|9)|xoom|sch-i800|playbook|tablet|kindle/i.test(j);return Q||B()}l.exports.isTablet=R;function B(V,j,Q){var W=V||window.navigator.userAgent,G=j||window.navigator.platform,z=Q||window.navigator.maxTouchPoints||0;return(G==="iPad"||G==="MacIntel")&&z>0&&/Macintosh|Intel|iPad|ipad/i.test(W)&&!window.MSStream}l.exports.isIpad=B;function I(){return/iPad|iPhone|iPod/.test(window.navigator.platform)}l.exports.isIOS=I;function N(){return!C()&&!k()&&window.orientation!==void 0}l.exports.isMobileDeviceRequestingDesktopSite=N;function D(){return/(OculusBrowser)/i.test(window.navigator.userAgent)}l.exports.isOculusBrowser=D;function P(){return/(Mobile VR)/i.test(window.navigator.userAgent)}l.exports.isFirefoxReality=P;function k(){return D()||P()}l.exports.isMobileVR=k;function q(){return/R7 Build/.test(window.navigator.userAgent)}l.exports.isR7=q,l.exports.isLandscape=function(){var V=window.orientation;return q()&&(V+=90),V===90||V===-90},l.exports.isBrowserEnvironment=typeof process>"u"||process.browser===!0,l.exports.isNodeEnvironment=!l.exports.isBrowserEnvironment},"./src/utils/entity.js":(l,u,c)=>{var h=c("./src/utils/split.js").split;function p(f,g){g=g||".";var m=h(f,g);return m.length===1?m[0]:m}l.exports.getComponentPropertyPath=p,l.exports.getComponentProperty=function(f,g,m){var y;return m=m||".",g.indexOf(m)!==-1?(y=p(g,m),y.constructor===String?f.getAttribute(y):f.getAttribute(y[0])[y[1]]):f.getAttribute(g)},l.exports.setComponentProperty=function(f,g,m,y){var b;if(y=y||".",g.indexOf(y)!==-1){b=p(g,y),b.constructor===String?f.setAttribute(b,m):f.setAttribute(b[0],b[1],m);return}f.setAttribute(g,m)}},"./src/utils/forceCanvasResizeSafariMobile.js":l=>{l.exports=function(u){var c=u.style.width,h=u.style.height;u.style.width=parseInt(c,10)+1+"px",u.style.height=parseInt(h,10)+1+"px",setTimeout(function(){u.style.width=c,u.style.height=h},200)}},"./src/utils/index.js":(l,u,c)=>{var h=c("./src/utils/debug.js"),p=c("./node_modules/deep-assign/index.js"),f=c("./src/utils/device.js"),g=c("./src/utils/object-pool.js"),m=h("utils:warn");l.exports.bind=function(b){return b.bind.apply(b,Array.prototype.slice.call(arguments,1))},l.exports.coordinates=c("./src/utils/coordinates.js"),l.exports.debug=h,l.exports.device=f,l.exports.entity=c("./src/utils/entity.js"),l.exports.forceCanvasResizeSafariMobile=c("./src/utils/forceCanvasResizeSafariMobile.js"),l.exports.material=c("./src/utils/material.js"),l.exports.objectPool=g,l.exports.split=c("./src/utils/split.js").split,l.exports.styleParser=c("./src/utils/styleParser.js"),l.exports.trackedControls=c("./src/utils/tracked-controls.js"),l.exports.checkHeadsetConnected=function(){return m("`utils.checkHeadsetConnected` has moved to `utils.device.checkHeadsetConnected`"),f.checkHeadsetConnected(arguments)},l.exports.isGearVR=l.exports.device.isGearVR=function(){m("`utils.isGearVR` has been deprecated, use `utils.device.isMobileVR`")},l.exports.isIOS=function(){return m("`utils.isIOS` has moved to `utils.device.isIOS`"),f.isIOS(arguments)},l.exports.isOculusGo=l.exports.device.isOculusGo=function(){m("`utils.isOculusGo` has been deprecated, use `utils.device.isMobileVR`")},l.exports.isMobile=function(){return m("`utils.isMobile has moved to `utils.device.isMobile`"),f.isMobile(arguments)},l.exports.throttle=function(b,v,_){var T;return _&&(b=b.bind(_)),function(){var E=Date.now(),C=typeof T>"u"?v:E-T;(typeof T>"u"||C>=v)&&(T=E,b.apply(null,arguments))}},l.exports.throttleLeadingAndTrailing=function(b,v,_){var T,E;_&&(b=b.bind(_));var C,R=function(){T=Date.now(),b.apply(this,C),E=void 0};return function(){var B=Date.now(),I=typeof T>"u"?v:B-T;I>=v?(clearTimeout(E),E=void 0,T=B,b.apply(null,arguments)):(E=E||setTimeout(R,v-I),C=arguments)}},l.exports.throttleTick=function(b,v,_){var T;return _&&(b=b.bind(_)),function(E,C){var R=typeof T>"u"?C:E-T;(typeof T>"u"||R>=v)&&(T=E,b(E,R))}},l.exports.debounce=function(b,v,_){var T;return function(){var E=this,C=arguments,R=function(){T=null,_||b.apply(E,C)},B=_&&!T;clearTimeout(T),T=setTimeout(R,v),B&&b.apply(E,C)}},l.exports.extend=Object.assign,l.exports.extendDeep=p,l.exports.clone=function(b){return JSON.parse(JSON.stringify(b))};var y=function(){var b=g.createPool(function(){return[]});return function(v,_){var T,E,C,R,B,I;if(v===void 0||_===void 0||v===null||_===null||!(v&&_&&v.constructor===Object&&_.constructor===Object||v.constructor===Array&&_.constructor===Array))return v===_;E=b.use(),C=b.use(),E.length=0,C.length=0;for(T in v)E.push(T);for(T in _)C.push(T);if(E.length!==C.length)return b.recycle(E),b.recycle(C),!1;for(R=0;R<E.length;++R)if(B=v[E[R]],I=_[E[R]],typeof B=="object"||typeof I=="object"||Array.isArray(B)&&Array.isArray(I)){if(B===I)continue;if(!y(B,I))return b.recycle(E),b.recycle(C),!1}else if(B!==I)return b.recycle(E),b.recycle(C),!1;return b.recycle(E),b.recycle(C),!0}}();l.exports.deepEqual=y,l.exports.diff=function(){var b=[];return function(v,_,T){var E,C,R,B,I,N,D;B=T||{},b.length=0;for(I in v)b.push(I);if(!_)return B;for(R in _)b.indexOf(R)===-1&&b.push(R);for(N=0;N<b.length;N++)I=b[N],E=v[I],C=_[I],D=E&&C&&E.constructor===Object&&C.constructor===Object,(D&&!y(E,C)||!D&&E!==C)&&(B[I]=C);return B}}(),l.exports.shouldCaptureKeyEvent=function(b){return b.metaKey?!1:document.activeElement===document.body},l.exports.splitString=function(b,v){typeof v>"u"&&(v=" ");var _=new RegExp(v,"g");return b=(b||"").replace(_,v),b.split(v)},l.exports.getElData=function(b,v){v=v||{};var _={};Object.keys(v).forEach(T);function T(E){b.hasAttribute(E)&&(_[E]=b.getAttribute(E))}return _},l.exports.getUrlParameter=function(b){b=b.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var v=new RegExp("[\\?&]"+b+"=([^&#]*)"),_=v.exec(location.search);return _===null?"":decodeURIComponent(_[1].replace(/\+/g," "))},l.exports.isIframed=function(){return window.top!==window.self},l.exports.findAllScenes=function(b){for(var v=[],_=b.getElementsByTagName("*"),T=0,E=_.length;T<E;T++)_[T].isScene&&v.push(_[T]);return v},l.exports.srcLoader=c("./src/utils/src-loader.js")},"./src/utils/ios-orientationchange-blank-bug.js":()=>{window.addEventListener("orientationchange",function(){document.documentElement.style.height="initial",setTimeout(function(){document.documentElement.style.height="100%",setTimeout(function(){window.scrollTo(0,1)},500)},500)})},"./src/utils/isIOSOlderThan10.js":l=>{l.exports=function(u){return/(iphone|ipod|ipad).*os.(7_|8_|9_)/i.test(u)}},"./src/utils/material.js":(l,u,c)=>{var h=c("./src/lib/three.js"),p=c("./src/utils/src-loader.js"),f=c("./src/utils/debug.js"),g=f("utils:material:warn"),m=new Set(["emissiveMap","envMap","map","specularMap"]);function y(E,C){var R=C.offset||{x:0,y:0},B=C.repeat||{x:1,y:1},I=C.npot||!1,N=C.anisotropy||h.Texture.DEFAULT_ANISOTROPY,D=E.wrapS,P=E.wrapT,k=E.magFilter,q=E.minFilter;I&&(D=h.ClampToEdgeWrapping,P=h.ClampToEdgeWrapping,k=h.LinearFilter,q=h.LinearFilter),(B.x!==1||B.y!==1)&&(D=h.RepeatWrapping,P=h.RepeatWrapping),E.offset.set(R.x,R.y),E.repeat.set(B.x,B.y),(E.wrapS!==D||E.wrapT!==P||E.magFilter!==k||E.minFilter!==q||E.anisotropy!==N)&&(E.wrapS=D,E.wrapT=P,E.magFilter=k,E.minFilter=q,E.anisotropy=N,E.needsUpdate=!0)}l.exports.setTextureProperties=y,l.exports.updateMapMaterialFromData=function(E,C,R,B){var I=R.el,N=R.material,D=I.sceneEl.systems.renderer,P=B[C];if(R.materialSrcs||(R.materialSrcs={}),!P){delete R.materialSrcs[E],q(null);return}if(P===R.materialSrcs[E]&&N[E]){y(N[E],B);return}R.materialSrcs[E]=P,P instanceof h.Texture?q(P):I.sceneEl.systems.material.loadTextureSource(P,k);function k(V){if(R.materialSrcs[E]===P){var j=N[E];j&&(V===null||!_(j,V))&&(j=null),!j&&V&&(j=T(V)),j&&(j.source!==V&&(j.source=V,j.needsUpdate=!0),m.has(E)&&D.applyColorCorrection(j),y(j,B)),q(j)}}function q(V){N[E]!==V&&(N[E]&&N[E].dispose(),N[E]=V,N.needsUpdate=!0,v(I,V))}},l.exports.updateMap=function(E,C){return l.exports.updateMapMaterialFromData("map","src",E,C)},l.exports.updateDistortionMap=function(E,C,R){var B=E;E==="ambientOcclusion"&&(B="ao");var I={};return I.src=R[E+"Map"],I.offset=R[E+"TextureOffset"],I.repeat=R[E+"TextureRepeat"],I.wrap=R[E+"TextureWrap"],l.exports.updateMapMaterialFromData(B+"Map","src",C,I)};var b={};l.exports.updateEnvMap=function(E,C){var R=E.material,B=E.el,I="envMap",N=C.envMap,D=C.sphericalEnvMap,P=C.refract;if(D&&(N=D,g("`sphericalEnvMap` property is deprecated, using spherical map as equirectangular map instead. Use `envMap` property with a CubeMap or Equirectangular image instead.")),E.materialSrcs||(E.materialSrcs={}),!N){delete E.materialSrcs[I],R.envMap=null,R.needsUpdate=!0;return}if(E.materialSrcs[I]=N,b[N]){b[N].then(k);return}b[N]=new Promise(function(q){p.validateEnvMapSrc(N,function(V){B.sceneEl.systems.material.loadCubeMapTexture(V,function(j){j.mapping=P?h.CubeRefractionMapping:h.CubeReflectionMapping,k(j),q(j)})},function(V){B.sceneEl.systems.material.loadTexture(V,{src:V},function(j){j.mapping=P?h.EquirectangularRefractionMapping:h.EquirectangularReflectionMapping,k(j),q(j)})})});function k(q){E.materialSrcs[I]===N&&(R.envMap=q,R.needsUpdate=!0,v(B,q))}};function v(E,C){if(!C||(E.emit("materialtextureloaded",{src:C.image,texture:C}),!C.image||C.image.tagName!=="VIDEO"))return;C.image.addEventListener("loadeddata",R),C.image.addEventListener("ended",B);function R(){E.emit("materialvideoloadeddata",{src:C.image,texture:C})}function B(){E.emit("materialvideoended",{src:C.image,texture:C})}C.addEventListener("dispose",function(){C.image.removeEventListener("loadeddata",R),C.image.removeEventListener("ended",B)})}l.exports.handleTextureEvents=v;function _(E,C){return C.data instanceof HTMLCanvasElement?E.isCanvasTexture:C.data instanceof HTMLVideoElement?E.isVideoTexture&&E.source===C:E.isTexture&&!E.isCanvasTexture&&!E.isVideoTexture}l.exports.isCompatibleTexture=_;function T(E){var C;return E.data instanceof HTMLCanvasElement?C=new h.CanvasTexture:E.data instanceof HTMLVideoElement?C=new h.VideoTexture(E.data):C=new h.Texture,C.source=E,C.needsUpdate=!0,C}l.exports.createCompatibleTexture=T},"./src/utils/math.js":l=>{function u(h,p,f){var g=p.dot(h);return(g-p.dot(f))/p.length()}function c(h,p,f,g){var m=u(h,p,f);return g.copy(p),g.multiplyScalar(m),g.add(f),g}l.exports.distanceOfPointFromPlane=u,l.exports.nearestPointInPlane=c},"./src/utils/object-pool.js":l=>{var u=Object.freeze(Object.create(null));function c(){return{}}l.exports.createPool=function(f){var g=[],m=null;f=f||c;function y(){var T;return(m===null||m===g.length)&&v(g.length||5),T=g[m],g[m++]=u,h(T),T}function b(T){if(T instanceof Object){if(m===null||m===-1){g[g.length]=T;return}g[--m]=T}}function v(T){var E,C;if(T=T===void 0?g.length:T,T>0&&m==null&&(m=0),T>0)for(E=g.length,g.length+=Number(T),C=E;C<g.length;C++)g[C]=f();return g.length}function _(){return g.length}return{grow:v,pool:g,recycle:b,size:_,use:y}};function h(f){var g;if(!(!f||f.constructor!==Object))for(g in f)f[g]=void 0}l.exports.clearObject=h;function p(f,g){var m;if(!(!f||f.constructor!==Object))for(m in f)m in g||delete f[m]}l.exports.removeUnusedKeys=p},"./src/utils/split.js":l=>{l.exports.split=function(){var u={};return function(c,h){return h in u||(u[h]={}),c in u[h]||(u[h][c]=c.split(h)),u[h][c]}}()},"./src/utils/src-loader.js":(l,u,c)=>{var h=c("./src/utils/debug.js"),p=h("utils:src-loader:warn");function f(T,E,C){b(T,function(R){if(R){E(T);return}C(T)})}function g(T,E,C){var R,B="",I,N,D=[];if(typeof T=="string"){let k=function(q){D.push(q),D.length===6&&E(D)};for(I=0;I<5;I++)B+="(url\\((?:[^\\)]+)\\),\\s*)";if(B+="(url\\((?:[^\\)]+)\\)\\s*)",N=T.match(new RegExp(B)),N){for(I=1;I<7;I++)f(y(N[I]),k);return}if(!T.startsWith("#")){var P=y(T);f(P||T,C);return}}if(T.tagName?R=T:R=_(T),!!R){if(R.tagName==="A-CUBEMAP"&&R.srcs)return E(R.srcs);if(R.tagName==="IMG")return C(R);p('Selector "%s" does not point to <a-cubemap> or <img>',T)}}function m(T,E){return g(T,E,function(){p("Expected cubemap but got image")})}function y(T){var E=T.match(/url\((.+)\)/);if(E)return E[1]}function b(T,E){var C;if(T.tagName){E(T.tagName==="IMG");return}C=new XMLHttpRequest,C.open("HEAD",T),C.addEventListener("load",function(R){var B;C.status>=200&&C.status<300?(B=C.getResponseHeader("Content-Type"),B==null?v(T,E):B.startsWith("image")?E(!0):E(!1)):v(T,E),C.abort()}),C.send()}function v(T,E){var C=new Image;C.addEventListener("load",R);function R(){E(!0)}C.addEventListener("error",B);function B(){E(!1)}C.src=T}function _(T){try{var E=document.querySelector(T);return E||p('No element was found matching the selector: "%s"',T),E}catch{p('"%s" is not a valid selector',T);return}}l.exports={parseUrl:y,validateSrc:f,validateCubemapSrc:m,validateEnvMapSrc:g}},"./src/utils/styleParser.js":l=>{var u=/-([a-z])/g;l.exports.parse=function(m,y){var b;return typeof m!="string"||(b=p(m,y),b[""])?m:b},l.exports.stringify=function(m){return typeof m=="string"?m:f(m)};function c(m){return m.replace(u,g)}l.exports.toCamelCase=c;var h=function(){var m=[],y=/url\([^)]+$/;return function(b){var v="",_,T=0,E=";";for(m.length=0;T<b.length;){if(_=b.indexOf(E,T),_===-1&&(_=b.length),v+=b.substring(T,_),y.test(v)){v+=";",T=_+1;continue}m.push(v.trim()),v="",T=_+1}return m}}();function p(m,y){var b,v,_,T,E,C;for(y=y||{},b=h(m),v=0;v<b.length;v++)_=b[v],_&&(T=_.indexOf(":"),E=_.substr(0,T).trim(),C=_.substr(T+1).trim(),y[c(E)]=C);return y}function f(m){var y,b=0,v=0,_="";for(y in m)b++;for(y in m)_+=y+": "+m[y],v<b-1&&(_+="; "),v++;return _}function g(m){return m[1].toUpperCase()}},"./src/utils/tracked-controls.js":(l,u,c)=>{var h=c("./src/constants/index.js").DEFAULT_HANDEDNESS,p=["x","y","z","w"],f=2;l.exports.checkControllerPresentAndSetup=function(v,_,T){var E=v.el,C,R=E.sceneEl.hasWebXR,B=R?m:g,I;if(C=B(v,_,T),I=!!C,v.controllerPresent&&!v.controllerEventsActive&&!R&&v.addEventListeners(),I===v.controllerPresent)return I;v.controllerPresent=I,I?(v.addEventListeners(),v.injectTrackedControls(C),E.emit("controllerconnected",{name:v.name,component:v})):(v.removeEventListeners(),E.emit("controllerdisconnected",{name:v.name,component:v}))};function g(v,_,T){var E,C=v.el.sceneEl,R,B=T.index||0;return!_||(R=C&&C.systems["tracked-controls-webvr"],!R)||(E=R.controllers,!E.length)?!1:!!y(E,null,_,T.hand,B)}function m(v,_,T){var E,C=v.el.sceneEl,R=C&&C.systems["tracked-controls-webxr"];return!R||(E=R.controllers,!E||!E.length)?!1:b(E,_,T.hand,T.index,T.iterateControllerProfiles,T.handTracking)}l.exports.isControllerPresentWebVR=g,l.exports.isControllerPresentWebXR=m;function y(v,_,T,E,C){var R,B,I=0,N=C>=0?C:0;for(B=0;B<v.length;B++)if(R=v[B],!(T&&!R.id.startsWith(T))&&!(!T&&R.id!==_)&&!(E&&R.hand&&E!==R.hand)){if(E&&!R.hand)N=f*C+(E===h?0:1);else return R;if(I===N)return R;++I}}function b(v,_,T,E,C,R){var B,I,N,D=!1,P,k;for(B=0;B<v.length;B++){if(N=v[B],k=N.profiles,R)D=N.hand;else if(C)for(I=0;I<k.length&&(D=k[I].startsWith(_),!D);I++);else D=k.length>0&&k[0].startsWith(_);if(D){if(P=N.handedness==="right"||N.handedness==="left",P){if(N.handedness===T)return v[B]}else if(B===E)return v[B]}}}l.exports.findMatchingControllerWebVR=y,l.exports.findMatchingControllerWebXR=b,l.exports.emitIfAxesChanged=function(v,_,T){var E,C,R,B,I;for(C in _){for(E=_[C],R=!1,I=0;I<E.length;I++)T.detail.changed[E[I]]&&(R=!0);if(R){for(B={},I=0;I<E.length;I++)B[p[I]]=T.detail.axis[E[I]];v.el.emit(C+"moved",B)}}},l.exports.onButtonEvent=function(v,_,T,E){var C=E?T.mapping[E]:T.mapping,R=C.buttons[v];T.el.emit(R+_),T.updateModel&&T.updateModel(R,_)}},"./vendor/DeviceOrientationControls.js":()=>{THREE.DeviceOrientationControls=function(l){var u=this;this.object=l,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0,this.alphaOffset=0;var c=function(f){u.deviceOrientation=f},h=function(){u.screenOrientation=window.orientation||0},p=function(){var f=new THREE.Vector3(0,0,1),g=new THREE.Euler,m=new THREE.Quaternion,y=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5));return function(b,v,_,T,E){g.set(_,v,-T,"YXZ"),b.setFromEuler(g),b.multiply(y),b.multiply(m.setFromAxisAngle(f,-E))}}();this.connect=function(){h(),window.addEventListener("orientationchange",h,!1),window.addEventListener("deviceorientation",c,!1),u.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",h,!1),window.removeEventListener("deviceorientation",c,!1),u.enabled=!1},this.update=function(){if(u.enabled!==!1){var f=u.deviceOrientation;if(f){var g=f.alpha?THREE.MathUtils.degToRad(f.alpha)+u.alphaOffset:0,m=f.beta?THREE.MathUtils.degToRad(f.beta):0,y=f.gamma?THREE.MathUtils.degToRad(f.gamma):0,b=u.screenOrientation?THREE.MathUtils.degToRad(u.screenOrientation):0;p(u.object.quaternion,g,m,y,b)}}},this.dispose=function(){u.disconnect()},this.connect()}},"./vendor/rStats.extras.js":l=>{window.glStats=function(){var u=null,c=0,h=0,p=0,f=0,g=0,m=0,y=0;function b(I,N){return function(){N.apply(this,arguments),I.apply(this,arguments)}}WebGLRenderingContext.prototype.drawArrays=b(WebGLRenderingContext.prototype.drawArrays,function(){c++,arguments[0]==this.POINTS?m+=arguments[2]:g+=arguments[2]}),WebGLRenderingContext.prototype.drawElements=b(WebGLRenderingContext.prototype.drawElements,function(){h++,f+=arguments[1]/3,g+=arguments[1]}),WebGLRenderingContext.prototype.useProgram=b(WebGLRenderingContext.prototype.useProgram,function(){p++}),WebGLRenderingContext.prototype.bindTexture=b(WebGLRenderingContext.prototype.bindTexture,function(){y++});var v={allcalls:{over:3e3,caption:"Calls (hook)"},drawelements:{caption:"drawElements (hook)"},drawarrays:{caption:"drawArrays (hook)"}},_=[{caption:"WebGL",values:["allcalls","drawelements","drawarrays","useprogram","bindtexture","glfaces","glvertices","glpoints"]}],T=[{base:"allcalls",steps:["drawelements","drawarrays"]}];function E(){u("allcalls").set(c+h),u("drawElements").set(h),u("drawArrays").set(c),u("bindTexture").set(y),u("useProgram").set(p),u("glfaces").set(f),u("glvertices").set(g),u("glpoints").set(m)}function C(){c=0,h=0,p=0,f=0,g=0,m=0,y=0}function R(){}function B(I){u=I}return{update:E,start:C,end:R,attach:B,values:v,groups:_,fractions:T}},window.threeStats=function(u){var c=null,h={"renderer.info.memory.geometries":{caption:"Geometries"},"renderer.info.memory.textures":{caption:"Textures"},"renderer.info.programs":{caption:"Programs"},"renderer.info.render.calls":{caption:"Calls"},"renderer.info.render.triangles":{caption:"Triangles",over:1e3},"renderer.info.render.points":{caption:"Points"}},p=[{caption:"Three.js - Memory",values:["renderer.info.memory.geometries","renderer.info.programs","renderer.info.memory.textures"]},{caption:"Three.js - Render",values:["renderer.info.render.calls","renderer.info.render.triangles","renderer.info.render.points"]}],f=[];function g(){c("renderer.info.memory.geometries").set(u.info.memory.geometries),c("renderer.info.programs").set(u.info.programs.length),c("renderer.info.memory.textures").set(u.info.memory.textures),c("renderer.info.render.calls").set(u.info.render.calls),c("renderer.info.render.triangles").set(u.info.render.triangles),c("renderer.info.render.points").set(u.info.render.points)}function m(){}function y(){}function b(v){c=v}return{update:g,start:m,end:y,attach:b,values:h,groups:p,fractions:f}},window.BrowserStats=function(){var u=null,c=0,h=0;window.performance&&!performance.memory&&(performance.memory={usedJSHeapSize:0,totalJSHeapSize:0}),performance.memory.totalJSHeapSize===0&&console.warn("totalJSHeapSize === 0... performance.memory is only available in Chrome .");var p={memory:{caption:"Used Memory",average:!0,avgMs:1e3,over:22},total:{caption:"Total Memory"}},f=[{caption:"Browser",values:["memory","total"]}],g=[{base:"total",steps:["memory"]}],m=Math.log(1024);function y(E){var C=100,R=Math.floor(Math.log(E)/m);return Math.round(E*C/Math.pow(1024,R))/C}function b(){c=y(performance.memory.usedJSHeapSize),h=y(performance.memory.totalJSHeapSize),u("memory").set(c),u("total").set(h)}function v(){c=0}function _(){}function T(E){u=E}return{update:b,start:v,end:_,attach:T,values:p,groups:f,fractions:g}},l.exports={glStats:window.glStats,threeStats:window.threeStats,BrowserStats:window.BrowserStats}},"./vendor/rStats.js":l=>{(function(){"performance"in window||(window.performance={});var u=window.performance;if(!("now"in u)){var c=Date.now();u.timing&&u.timing.navigationStart&&(c=u.timing.navigationStart),u.now=function(){return Date.now()-c}}u.mark||(u.mark=function(){}),u.measure||(u.measure=function(){})})(),window.rStats=function(u){function c(P,k){for(var q=Object.keys(P),V=0,j=q.length;V<j;V++)k(q[V])}function h(P){var k=document.createElement("link");k.href=P,k.rel="stylesheet",k.type="text/css",document.getElementsByTagName("head")[0].appendChild(k)}var p=u||{},f=p.colours||["#850700","#c74900","#fcb300","#284280","#4c7c0c"],g="https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700,300",m=(p.CSSPath?p.CSSPath:"")+"rStats.css",y=p.css||[g,m];y.forEach(function(P){h(P)}),p.values||(p.values={});var b,v,_=10,T=200,E={};function C(P,k,q){var V=q||{},j=document.createElement("canvas"),Q=j.getContext("2d"),W=0,G=0,z=V.color?V.color:"#666666",te=document.createElement("canvas"),Y=te.getContext("2d");te.width=1,te.height=2*_,Y.fillStyle="#444444",Y.fillRect(0,0,1,2*_),Y.fillStyle=z,Y.fillRect(0,_,1,_),Y.fillStyle="#ffffff",Y.globalAlpha=.5,Y.fillRect(0,_,1,1),Y.globalAlpha=1;var se=document.createElement("canvas"),ve=se.getContext("2d");se.width=1,se.height=2*_,ve.fillStyle="#444444",ve.fillRect(0,0,1,2*_),ve.fillStyle="#b70000",ve.fillRect(0,_,1,_),ve.globalAlpha=.5,ve.fillStyle="#ffffff",ve.fillRect(0,_,1,1),ve.globalAlpha=1;function Ae(){j.width=T,j.height=_,j.style.width=j.width+"px",j.style.height=j.height+"px",j.className="rs-canvas",P.appendChild(j),Q.fillStyle="#444444",Q.fillRect(0,0,j.width,j.height)}function me(Oe,Xe){G+=(Oe-G)*.1,W*=.99,G>W&&(W=G),Q.drawImage(j,1,0,j.width-1,j.height,0,0,j.width-1,j.height),Xe?Q.drawImage(se,j.width-1,j.height-G*j.height/W-_):Q.drawImage(te,j.width-1,j.height-G*j.height/W-_)}return Ae(),{draw:me}}function R(P,k){var q=document.createElement("canvas"),V=q.getContext("2d");function j(){q.width=T,q.height=_*k,q.style.width=q.width+"px",q.style.height=q.height+"px",q.className="rs-canvas",P.appendChild(q),V.fillStyle="#444444",V.fillRect(0,0,q.width,q.height)}function Q(W){V.drawImage(q,1,0,q.width-1,q.height,0,0,q.width-1,q.height);var G=0;c(W,function(z){var te=W[z]*q.height;V.fillStyle=f[z],V.fillRect(q.width-1,G,1,te),G+=te})}return j(),{draw:Q}}function B(P,k){var q=P,V,j=0,Q=0,W=0,G=0,z=performance.now(),te=0,Y=document.createElement("div"),se=document.createElement("span"),ve=document.createElement("div"),Ae=document.createTextNode(""),me=p?p.values[q.toLowerCase()]:null,Oe=new C(Y,q,me),Xe=!1;se.className="rs-counter-id",se.textContent=me&&me.caption?me.caption:q,ve.className="rs-counter-value",ve.appendChild(Ae),Y.appendChild(se),Y.appendChild(ve),k?k.div.appendChild(Y):v.appendChild(Y),V=performance.now();function Je($e){if(me&&me.average){G+=$e,te++;var Fi=performance.now();Fi-z>=(me.avgMs||1e3)&&(W=G/te,G=0,z=Fi,te=0)}}function it(){V=performance.now(),p.userTimingAPI&&performance.mark(q+"-start"),Xe=!0}function dt(){j=performance.now()-V,p.userTimingAPI&&(performance.mark(q+"-end"),Xe&&performance.measure(q,q+"-start",q+"-end")),Je(j)}function St(){dt(),it()}function Qt(){var $e=me&&me.average?W:j;Ae.nodeValue=Math.round($e*100)/100;var Fi=me&&(me.below&&j<me.below||me.over&&j>me.over);Oe.draw(j,Fi),Y.className=Fi?"rs-counter-base alarm":"rs-counter-base"}function yt(){var $e=performance.now(),Fi=$e-V;Q++,Fi>1e3&&(me&&me.interpolate===!1?j=Q:j=Q*1e3/Fi,Q=0,V=$e,Je(j))}function bi($e){j=$e,Je(j)}return{set:bi,start:it,tick:St,end:dt,frame:yt,value:function(){return j},draw:Qt}}function I(P){var k=P.toLowerCase();if(k===void 0&&(k="default"),E[k])return E[k];var q=null;p&&p.groups&&c(p.groups,function(j){var Q=p.groups[parseInt(j,10)];!q&&Q.values.indexOf(k.toLowerCase())!==-1&&(q=Q)});var V=new B(k,q);return E[k]=V,V}function N(){if(p.plugins){p.values||(p.values={}),p.groups||(p.groups=[]),p.fractions||(p.fractions=[]);for(var P=0;P<p.plugins.length;P++)p.plugins[P].attach(I),c(p.plugins[P].values,function(k){p.values[k]=p.plugins[P].values[k]}),p.groups=p.groups.concat(p.plugins[P].groups),p.fractions=p.fractions.concat(p.plugins[P].fractions)}else p.plugins={};b=document.createElement("div"),b.className="rs-base",v=document.createElement("div"),v.className="rs-container",v.style.height="auto",b.appendChild(v),document.body.appendChild(b),p&&(p.groups&&c(p.groups,function(k){var q=p.groups[parseInt(k,10)],V=document.createElement("div");V.className="rs-group",q.div=V;var j=document.createElement("h1");j.textContent=q.caption,j.addEventListener("click",(function(Q){this.classList.toggle("hidden"),Q.preventDefault()}).bind(V)),v.appendChild(j),v.appendChild(V)}),p.fractions&&c(p.fractions,function(k){var q=p.fractions[parseInt(k,10)],V=document.createElement("div");V.className="rs-fraction";var j=document.createElement("div");j.className="rs-legend";var Q=0;c(p.fractions[k].steps,function(G){var z=document.createElement("p");z.textContent=p.fractions[k].steps[G],z.style.color=f[Q],j.appendChild(z),Q++}),V.appendChild(j),V.style.height=Q*_+"px",q.div=V;var W=new R(V,Q);q.graph=W,v.appendChild(V)}))}function D(){c(p.plugins,function(P){p.plugins[P].update()}),c(E,function(P){E[P].draw()}),p&&p.fractions&&c(p.fractions,function(P){var k=p.fractions[parseInt(P,10)],q=[],V=E[k.base.toLowerCase()];V&&(V=V.value(),c(p.fractions[P].steps,function(j){var Q=p.fractions[P].steps[parseInt(j,10)].toLowerCase(),W=E[Q];W&&q.push(W.value()/V)})),k.graph.draw(q)})}return N(),function(P){return P?I(P):{element:b,update:D}}},l.exports=window.rStats},"./vendor/wakelock/util.js":l=>{var u={};u.base64=function(c,h){return"data:"+c+";base64,"+h},u.isMobile=function(){var c=!1;return function(h){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(h)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(h.substr(0,4)))&&(c=!0)}(navigator.userAgent||navigator.vendor||window.opera),c},u.isIOS=function(){return/(iPad|iPhone|iPod)/g.test(navigator.userAgent)},u.isIFrame=function(){try{return window.self!==window.top}catch{return!0}},u.appendQueryParameter=function(c,h,p){var f=c.indexOf("?")<0?"?":"&";return c+=f+h+"="+p,c},u.getQueryParameter=function(c){c=c.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var h=new RegExp("[\\?&]"+c+"=([^&#]*)"),p=h.exec(location.search);return p===null?"":decodeURIComponent(p[1].replace(/\+/g," "))},u.isLandscapeMode=function(){return window.orientation==90||window.orientation==-90},l.exports=u},"./vendor/wakelock/wakelock.js":(l,u,c)=>{var h=c("./vendor/wakelock/util.js");function p(){var m=document.createElement("video");m.addEventListener("ended",function(){m.play()}),this.request=function(){m.paused&&(m.src=h.base64("video/webm","GkXfowEAAAAAAAAfQoaBAUL3gQFC8oEEQvOBCEKChHdlYm1Ch4ECQoWBAhhTgGcBAAAAAAAH4xFNm3RALE27i1OrhBVJqWZTrIHfTbuMU6uEFlSua1OsggEwTbuMU6uEHFO7a1OsggfG7AEAAAAAAACkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmAQAAAAAAAEUq17GDD0JATYCNTGF2ZjU2LjQwLjEwMVdBjUxhdmY1Ni40MC4xMDFzpJAGSJTMbsLpDt/ySkipgX1fRImIQO1MAAAAAAAWVK5rAQAAAAAAADuuAQAAAAAAADLXgQFzxYEBnIEAIrWcg3VuZIaFVl9WUDmDgQEj44OEO5rKAOABAAAAAAAABrCBsLqBkB9DtnUBAAAAAAAAo+eBAKOmgQAAgKJJg0IAAV4BHsAHBIODCoAACmH2MAAAZxgz4dPSTFi5JACjloED6ACmAECSnABMQAADYAAAWi0quoCjloEH0ACmAECSnABNwAADYAAAWi0quoCjloELuACmAECSnABNgAADYAAAWi0quoCjloEPoACmAECSnABNYAADYAAAWi0quoCjloETiACmAECSnABNIAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTnghdwo5aBAAAApgBAkpwATOAAA2AAAFotKrqAo5aBA+gApgBAkpwATMAAA2AAAFotKrqAo5aBB9AApgBAkpwATIAAA2AAAFotKrqAo5aBC7gApgBAkpwATEAAA2AAAFotKrqAo5aBD6AApgDAkpwAQ2AAA2AAAFotKrqAo5aBE4gApgBAkpwATCAAA2AAAFotKrqAH0O2dQEAAAAAAACU54Iu4KOWgQAAAKYAQJKcAEvAAANgAABaLSq6gKOWgQPoAKYAQJKcAEtgAANgAABaLSq6gKOWgQfQAKYAQJKcAEsAAANgAABaLSq6gKOWgQu4AKYAQJKcAEqAAANgAABaLSq6gKOWgQ+gAKYAQJKcAEogAANgAABaLSq6gKOWgROIAKYAQJKcAEnAAANgAABaLSq6gB9DtnUBAAAAAAAAlOeCRlCjloEAAACmAECSnABJgAADYAAAWi0quoCjloED6ACmAECSnABJIAADYAAAWi0quoCjloEH0ACmAMCSnABDYAADYAAAWi0quoCjloELuACmAECSnABI4AADYAAAWi0quoCjloEPoACmAECSnABIoAADYAAAWi0quoCjloETiACmAECSnABIYAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTngl3Ao5aBAAAApgBAkpwASCAAA2AAAFotKrqAo5aBA+gApgBAkpwASAAAA2AAAFotKrqAo5aBB9AApgBAkpwAR8AAA2AAAFotKrqAo5aBC7gApgBAkpwAR4AAA2AAAFotKrqAo5aBD6AApgBAkpwAR2AAA2AAAFotKrqAo5aBE4gApgBAkpwARyAAA2AAAFotKrqAH0O2dQEAAAAAAACU54J1MKOWgQAAAKYAwJKcAENgAANgAABaLSq6gKOWgQPoAKYAQJKcAEbgAANgAABaLSq6gKOWgQfQAKYAQJKcAEagAANgAABaLSq6gKOWgQu4AKYAQJKcAEaAAANgAABaLSq6gKOWgQ+gAKYAQJKcAEZAAANgAABaLSq6gKOWgROIAKYAQJKcAEYAAANgAABaLSq6gB9DtnUBAAAAAAAAlOeCjKCjloEAAACmAECSnABF4AADYAAAWi0quoCjloED6ACmAECSnABFwAADYAAAWi0quoCjloEH0ACmAECSnABFoAADYAAAWi0quoCjloELuACmAECSnABFgAADYAAAWi0quoCjloEPoACmAMCSnABDYAADYAAAWi0quoCjloETiACmAECSnABFYAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTngqQQo5aBAAAApgBAkpwARUAAA2AAAFotKrqAo5aBA+gApgBAkpwARSAAA2AAAFotKrqAo5aBB9AApgBAkpwARQAAA2AAAFotKrqAo5aBC7gApgBAkpwARQAAA2AAAFotKrqAo5aBD6AApgBAkpwAROAAA2AAAFotKrqAo5aBE4gApgBAkpwARMAAA2AAAFotKrqAH0O2dQEAAAAAAACU54K7gKOWgQAAAKYAQJKcAESgAANgAABaLSq6gKOWgQPoAKYAQJKcAESAAANgAABaLSq6gKOWgQfQAKYAwJKcAENgAANgAABaLSq6gKOWgQu4AKYAQJKcAERgAANgAABaLSq6gKOWgQ+gAKYAQJKcAERAAANgAABaLSq6gKOWgROIAKYAQJKcAEQgAANgAABaLSq6gB9DtnUBAAAAAAAAlOeC0vCjloEAAACmAECSnABEIAADYAAAWi0quoCjloED6ACmAECSnABEAAADYAAAWi0quoCjloEH0ACmAECSnABD4AADYAAAWi0quoCjloELuACmAECSnABDwAADYAAAWi0quoCjloEPoACmAECSnABDoAADYAAAWi0quoCjloETiACmAECSnABDgAADYAAAWi0quoAcU7trAQAAAAAAABG7j7OBALeK94EB8YIBd/CBAw=="),m.play())},this.release=function(){m.pause(),m.src=""}}function f(){var m=null;this.request=function(){m||(m=setInterval(function(){window.location.href="/",setTimeout(window.stop,0)},15e3))},this.release=function(){m&&(clearInterval(m),m=null)}}function g(){var m=navigator.userAgent||navigator.vendor||window.opera;return m.match(/iPhone/i)||m.match(/iPod/i)?f:p}l.exports=g()},"./node_modules/css-loader/dist/cjs.js!./src/style/aframe.css":(l,u,c)=>{c.r(u),c.d(u,{default:()=>P});var h=c("./node_modules/css-loader/dist/runtime/sourceMaps.js"),p=c.n(h),f=c("./node_modules/css-loader/dist/runtime/api.js"),g=c.n(f),m=c("./node_modules/css-loader/dist/runtime/getUrl.js"),y=c.n(m),b=new URL(c("data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27%3E%3Ctitle%3Eaframe-vrmode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M68.81,21.56H64.23v8.27h4.58a4.13,4.13,0,0,0,3.1-1.09,4.2,4.2,0,0,0,1-3,4.24,4.24,0,0,0-1-3A4.05,4.05,0,0,0,68.81,21.56Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0ZM41.9,46H34L24,16h8l6,21.84,6-21.84H52Zm39.29,0H73.44L68.15,35.39H64.23V46H57V16H68.81q5.32,0,8.34,2.37a8,8,0,0,1,3,6.69,9.68,9.68,0,0,1-1.27,5.18,8.9,8.9,0,0,1-4,3.34l6.26,12.11Z%27 fill=%27%23fff%27/%3E%3C/svg%3E"),c.b),v=new URL(c("data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27%3E%3Ctitle%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0Zm8,50a8,8,0,0,1-8,8H12a8,8,0,0,1-8-8V12a8,8,0,0,1,8-8H96a8,8,0,0,1,8,8Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M43.35,39.82H32.51L30.45,46H23.88L35,16h5.73L52,46H45.43Zm-9.17-5h7.5L37.91,23.58Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M68.11,35H63.18V46H57V16H68.15q5.31,0,8.2,2.37a8.18,8.18,0,0,1,2.88,6.7,9.22,9.22,0,0,1-1.33,5.12,9.09,9.09,0,0,1-4,3.26l6.49,12.26V46H73.73Zm-4.93-5h5a5.09,5.09,0,0,0,3.6-1.18,4.21,4.21,0,0,0,1.28-3.27,4.56,4.56,0,0,0-1.2-3.34A5,5,0,0,0,68.15,21h-5Z%27 fill=%27%23fff%27/%3E%3C/svg%3E"),c.b),_=new URL(c("data:image/svg+xml,%3C%3Fxml version=%271.0%27 encoding=%27UTF-8%27 standalone=%27no%27%3F%3E%3Csvg width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27 version=%271.1%27 id=%27svg320%27 sodipodi:docname=%27fullscreen-aframe.svg%27 xml:space=%27preserve%27 inkscape:version=%271.2.1 %289c6d41e  2022-07-14%29%27 xmlns:inkscape=%27http://www.inkscape.org/namespaces/inkscape%27 xmlns:sodipodi=%27http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd%27 xmlns=%27http://www.w3.org/2000/svg%27 xmlns:svg=%27http://www.w3.org/2000/svg%27 xmlns:rdf=%27http://www.w3.org/1999/02/22-rdf-syntax-ns%23%27 xmlns:cc=%27http://creativecommons.org/ns%23%27 xmlns:dc=%27http://purl.org/dc/elements/1.1/%27%3E%3Cdefs id=%27defs324%27 /%3E%3Csodipodi:namedview id=%27namedview322%27 pagecolor=%27%23ffffff%27 bordercolor=%27%23000000%27 borderopacity=%270.25%27 inkscape:showpageshadow=%272%27 inkscape:pageopacity=%270.0%27 inkscape:pagecheckerboard=%270%27 inkscape:deskcolor=%27%23d1d1d1%27 showgrid=%27false%27 inkscape:zoom=%273.8064516%27 inkscape:cx=%2791.423729%27 inkscape:cy=%27-1.4449153%27 inkscape:window-width=%271440%27 inkscape:window-height=%27847%27 inkscape:window-x=%2732%27 inkscape:window-y=%2725%27 inkscape:window-maximized=%270%27 inkscape:current-layer=%27svg320%27 /%3E%3Ctitle id=%27title312%27%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M96 0H12A12 12 0 0 0 0 12V50A12 12 0 0 0 12 62H96a12 12 0 0 0 12-12V12A12 12 0 0 0 96 0Zm8 50a8 8 0 0 1-8 8H12a8 8 0 0 1-8-8V12a8 8 0 0 1 8-8H96a8 8 0 0 1 8 8Z%27 fill=%27%23fff%27 id=%27path314%27 style=%27fill:%23ffffff%27 /%3E%3Cg id=%27g356%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g358%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g360%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g362%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g364%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g366%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g368%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g370%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g372%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g374%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g376%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g378%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g380%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g382%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g384%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cmetadata id=%27metadata561%27%3E%3Crdf:RDF%3E%3Ccc:Work rdf:about=%27%27%3E%3Cdc:title%3Eaframe-armode-noborder-reduced-tracking%3C/dc:title%3E%3C/cc:Work%3E%3C/rdf:RDF%3E%3C/metadata%3E%3Cpath d=%27m 98.168511 40.083649 c 0 -1.303681 -0.998788 -2.358041 -2.239389 -2.358041 -1.230088 0.0031 -2.240892 1.05436 -2.240892 2.358041 v 4.881296 l -9.041661 -9.041662 c -0.874129 -0.875631 -2.288954 -0.875631 -3.16308 0 -0.874129 0.874126 -0.874129 2.293459 0 3.167585 l 8.995101 8.992101 h -4.858767 c -1.323206 0.0031 -2.389583 1.004796 -2.389583 2.239386 0 1.237598 1.066377 2.237888 2.389583 2.237888 h 10.154599 c 1.323206 0 2.388082 -0.998789 2.392587 -2.237888 -0.0044 -0.03305 -0.009 -0.05858 -0.0134 -0.09161 0.0046 -0.04207 0.0134 -0.08712 0.0134 -0.13066 V 40.085172 h -1.52e-4%27 id=%27path596%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 23.091002 35.921781 -9.026643 9.041662 v -4.881296 c 0 -1.303681 -1.009302 -2.355037 -2.242393 -2.358041 -1.237598 0 -2.237888 1.05436 -2.237888 2.358041 l -0.0031 10.016421 c 0 0.04356 0.01211 0.08862 0.0015 0.130659 -0.0031 0.03153 -0.009 0.05709 -0.01211 0.09161 0.0031 1.239099 1.069379 2.237888 2.391085 2.237888 h 10.156101 c 1.320202 0 2.388079 -1.000291 2.388079 -2.237888 0 -1.234591 -1.067877 -2.236383 -2.388079 -2.239387 h -4.858767 l 8.995101 -8.9921 c 0.871126 -0.874127 0.871126 -2.293459 0 -3.167586 -0.875628 -0.877132 -2.291957 -0.877132 -3.169087 -1.52e-4%27 id=%27path598%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 84.649572 25.978033 9.041662 -9.041664 v 4.881298 c 0 1.299176 1.010806 2.350532 2.240891 2.355037 1.240601 0 2.23939 -1.055861 2.23939 -2.355037 V 11.798242 c 0 -0.04356 -0.009 -0.08862 -0.0134 -0.127671 0.0044 -0.03153 0.009 -0.06157 0.0134 -0.09313 -0.0044 -1.240598 -1.069379 -2.2393873 -2.391085 -2.2393873 h -10.1546 c -1.323205 0 -2.38958 0.9987893 -2.38958 2.2393873 0 1.233091 1.066375 2.237887 2.38958 2.240891 h 4.858768 l -8.995102 8.9921 c -0.874129 0.872625 -0.874129 2.288954 0 3.161578 0.874127 0.880137 2.288951 0.880137 3.16308 1.5e-4%27 id=%27path600%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 17.264988 13.822853 h 4.857265 c 1.320202 -0.0031 2.388079 -1.0078 2.388079 -2.240889 0 -1.240601 -1.067877 -2.2393893 -2.388079 -2.2393893 H 11.967654 c -1.321707 0 -2.388082 0.9987883 -2.391085 2.2393893 0.0031 0.03153 0.009 0.06157 0.01211 0.09313 -0.0031 0.03905 -0.0015 0.08262 -0.0015 0.127671 l 0.0031 10.020926 c 0 1.299176 1.00029 2.355038 2.237887 2.355038 1.233092 -0.0044 2.242393 -1.055862 2.242393 -2.355038 v -4.881295 l 9.026644 9.041661 c 0.877132 0.878635 2.293459 0.878635 3.169087 0 0.871125 -0.872624 0.871125 -2.288953 0 -3.161577 l -8.995282 -8.993616%27 id=%27path602%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3C/svg%3E"),c.b),T=new URL(c("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%2090%2090%22%20enable-background%3D%22new%200%200%2090%2090%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpolygon%20points%3D%220%2C0%200%2C0%200%2C0%20%22%3E%3C/polygon%3E%3Cg%3E%3Cpath%20d%3D%22M71.545%2C48.145h-31.98V20.743c0-2.627-2.138-4.765-4.765-4.765H18.456c-2.628%2C0-4.767%2C2.138-4.767%2C4.765v42.789%20%20%20c0%2C2.628%2C2.138%2C4.766%2C4.767%2C4.766h5.535v0.959c0%2C2.628%2C2.138%2C4.765%2C4.766%2C4.765h42.788c2.628%2C0%2C4.766-2.137%2C4.766-4.765V52.914%20%20%20C76.311%2C50.284%2C74.173%2C48.145%2C71.545%2C48.145z%20M18.455%2C16.935h16.344c2.1%2C0%2C3.808%2C1.708%2C3.808%2C3.808v27.401H37.25V22.636%20%20%20c0-0.264-0.215-0.478-0.479-0.478H16.482c-0.264%2C0-0.479%2C0.214-0.479%2C0.478v36.585c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h7.507v7.644%20%20%20h-5.534c-2.101%2C0-3.81-1.709-3.81-3.81V20.743C14.645%2C18.643%2C16.354%2C16.935%2C18.455%2C16.935z%20M16.96%2C23.116h19.331v25.031h-7.535%20%20%20c-2.628%2C0-4.766%2C2.139-4.766%2C4.768v5.828h-7.03V23.116z%20M71.545%2C73.064H28.757c-2.101%2C0-3.81-1.708-3.81-3.808V52.914%20%20%20c0-2.102%2C1.709-3.812%2C3.81-3.812h42.788c2.1%2C0%2C3.809%2C1.71%2C3.809%2C3.812v16.343C75.354%2C71.356%2C73.645%2C73.064%2C71.545%2C73.064z%22%3E%3C/path%3E%3Cpath%20d%3D%22M28.919%2C58.424c-1.466%2C0-2.659%2C1.193-2.659%2C2.66c0%2C1.466%2C1.193%2C2.658%2C2.659%2C2.658c1.468%2C0%2C2.662-1.192%2C2.662-2.658%20%20%20C31.581%2C59.617%2C30.387%2C58.424%2C28.919%2C58.424z%20M28.919%2C62.786c-0.939%2C0-1.703-0.764-1.703-1.702c0-0.939%2C0.764-1.704%2C1.703-1.704%20%20%20c0.94%2C0%2C1.705%2C0.765%2C1.705%2C1.704C30.623%2C62.022%2C29.858%2C62.786%2C28.919%2C62.786z%22%3E%3C/path%3E%3Cpath%20d%3D%22M69.654%2C50.461H33.069c-0.264%2C0-0.479%2C0.215-0.479%2C0.479v20.288c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h36.585%20%20%20c0.263%2C0%2C0.477-0.214%2C0.477-0.478V50.939C70.131%2C50.676%2C69.917%2C50.461%2C69.654%2C50.461z%20M69.174%2C51.417V70.75H33.548V51.417H69.174z%22%3E%3C/path%3E%3Cpath%20d%3D%22M45.201%2C30.296c6.651%2C0%2C12.233%2C5.351%2C12.551%2C11.977l-3.033-2.638c-0.193-0.165-0.507-0.142-0.675%2C0.048%20%20%20c-0.174%2C0.198-0.153%2C0.501%2C0.045%2C0.676l3.883%2C3.375c0.09%2C0.075%2C0.198%2C0.115%2C0.312%2C0.115c0.141%2C0%2C0.273-0.061%2C0.362-0.166%20%20%20l3.371-3.877c0.173-0.2%2C0.151-0.502-0.047-0.675c-0.194-0.166-0.508-0.144-0.676%2C0.048l-2.592%2C2.979%20%20%20c-0.18-3.417-1.629-6.605-4.099-9.001c-2.538-2.461-5.877-3.817-9.404-3.817c-0.264%2C0-0.479%2C0.215-0.479%2C0.479%20%20%20C44.72%2C30.083%2C44.936%2C30.296%2C45.201%2C30.296z%22%3E%3C/path%3E%3C/g%3E%3C/svg%3E"),c.b),E=new URL(c("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%20100%20100%22%20enable-background%3D%22new%200%200%20100%20100%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpath%20fill%3D%22%23000000%22%20d%3D%22M55.209%2C50l17.803-17.803c1.416-1.416%2C1.416-3.713%2C0-5.129c-1.416-1.417-3.713-1.417-5.129%2C0L50.08%2C44.872%20%20L32.278%2C27.069c-1.416-1.417-3.714-1.417-5.129%2C0c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129L44.951%2C50L27.149%2C67.803%20%20c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129c0.708%2C0.708%2C1.636%2C1.062%2C2.564%2C1.062c0.928%2C0%2C1.856-0.354%2C2.564-1.062L50.08%2C55.13l17.803%2C17.802%20%20c0.708%2C0.708%2C1.637%2C1.062%2C2.564%2C1.062s1.856-0.354%2C2.564-1.062c1.416-1.416%2C1.416-3.713%2C0-5.129L55.209%2C50z%22%3E%3C/path%3E%3C/svg%3E"),c.b),C=g()(p()),R=y()(b),B=y()(v),I=y()(_),N=y()(T),D=y()(E);C.push([l.id,`/* .a-fullscreen means not embedded. */
html.a-fullscreen {
  bottom: 0;
  left: 0;
  position: fixed;
  right: 0;
  top: 0;
}

html.a-fullscreen body {
  height: 100%;
  margin: 0;
  overflow: hidden;
  padding: 0;
  width: 100%;
}

/* Class is removed when doing <a-scene embedded>. */
html.a-fullscreen .a-canvas {
  width: 100% !important;
  height: 100% !important;
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  bottom: 0 !important;
  position: fixed !important;
}

html:not(.a-fullscreen) .a-enter-vr,
html:not(.a-fullscreen) .a-enter-ar {
  right: 5px;
  bottom: 5px;
}

html:not(.a-fullscreen) .a-enter-ar {
  right: 60px;
}

/* In chrome mobile the user agent stylesheet set it to white  */
:-webkit-full-screen {
  background-color: transparent;
}

.a-hidden {
  display: none !important;
}

.a-canvas {
  height: 100%;
  left: 0;
  position: absolute;
  top: 0;
  width: 100%;
}

.a-canvas.a-grab-cursor:hover {
  cursor: grab;
  cursor: -moz-grab;
  cursor: -webkit-grab;
}

canvas.a-canvas.a-mouse-cursor-hover:hover {
  cursor: pointer;
}

.a-inspector-loader {
  background-color: #ed3160;
  position: fixed;
  left: 3px;
  top: 3px;
  padding: 6px 10px;
  color: #fff;
  text-decoration: none;
  font-size: 12px;
  font-family: Roboto,sans-serif;
  text-align: center;
  z-index: 99999;
  width: 204px;
}

/* Inspector loader animation */
@keyframes dots-1 { from { opacity: 0; } 25% { opacity: 1; } }
@keyframes dots-2 { from { opacity: 0; } 50% { opacity: 1; } }
@keyframes dots-3 { from { opacity: 0; } 75% { opacity: 1; } }
@-webkit-keyframes dots-1 { from { opacity: 0; } 25% { opacity: 1; } }
@-webkit-keyframes dots-2 { from { opacity: 0; } 50% { opacity: 1; } }
@-webkit-keyframes dots-3 { from { opacity: 0; } 75% { opacity: 1; } }

.a-inspector-loader .dots span {
  animation: dots-1 2s infinite steps(1);
  -webkit-animation: dots-1 2s infinite steps(1);
}

.a-inspector-loader .dots span:first-child + span {
  animation-name: dots-2;
  -webkit-animation-name: dots-2;
}

.a-inspector-loader .dots span:first-child + span + span {
  animation-name: dots-3;
  -webkit-animation-name: dots-3;
}

a-scene {
  display: block;
  position: relative;
  height: 100%;
  width: 100%;
}

a-assets,
a-scene video,
a-scene img,
a-scene audio {
  display: none;
}

.a-enter-vr-modal,
.a-orientation-modal {
  font-family: Consolas, Andale Mono, Courier New, monospace;
}

.a-enter-vr-modal a {
  border-bottom: 1px solid #fff;
  padding: 2px 0;
  text-decoration: none;
  transition: .1s color ease-in;
}

.a-enter-vr-modal a:hover {
  background-color: #fff;
  color: #111;
  padding: 2px 4px;
  position: relative;
  left: -4px;
}

.a-enter-vr,
.a-enter-ar {
  font-family: sans-serif, monospace;
  font-size: 13px;
  width: 100%;
  font-weight: 200;
  line-height: 16px;
  position: absolute;
  right: 20px;
  bottom: 20px;
}

.a-enter-ar.xr {
  right: 90px;
}

.a-enter-vr-button,
.a-enter-vr-modal,
.a-enter-vr-modal a {
  color: #fff;
  user-select: none;
  outline: none;
}

.a-enter-vr-button {
  background: rgba(0, 0, 0, 0.35) url(`+R+`) 50% 50% no-repeat;
}

.a-enter-ar-button {
  background: rgba(0, 0, 0, 0.20) url(`+B+`) 50% 50% no-repeat;
}

.a-enter-vr.fullscreen .a-enter-vr-button {
  background-image: url(`+I+`);
}

.a-enter-vr-button,
.a-enter-ar-button {
  background-size: 90% 90%;
  border: 0;
  bottom: 0;
  cursor: pointer;
  min-width: 58px;
  min-height: 34px;
  /* 1.74418604651 */
  /*
    In order to keep the aspect ratio when resizing
    padding-top percentages are relative to the containing block's width.
    http://stackoverflow.com/questions/12121090/responsively-change-div-size-keeping-aspect-ratio
  */
  padding-right: 0;
  padding-top: 0;
  position: absolute;
  right: 0;
  transition: background-color .05s ease;
  -webkit-transition: background-color .05s ease;
  z-index: 9999;
  border-radius: 8px;
  touch-action: manipulation; /* Prevent iOS double tap zoom on the button */
}

.a-enter-ar-button {
  background-size: 100% 90%;
  border-radius: 7px;
}

.a-enter-ar-button:active,
.a-enter-ar-button:hover,
.a-enter-vr-button:active,
.a-enter-vr-button:hover {
  background-color: #ef2d5e;
}

.a-enter-vr-button.resethover {
  background-color: rgba(0, 0, 0, 0.35);
}

.a-enter-vr-modal {
  background-color: #666;
  border-radius: 0;
  display: none;
  min-height: 32px;
  margin-right: 70px;
  padding: 9px;
  width: 280px;
  right: 2%;
  position: absolute;
}

.a-enter-vr-modal:after {
  border-bottom: 10px solid transparent;
  border-left: 10px solid #666;
  border-top: 10px solid transparent;
  display: inline-block;
  content: '';
  position: absolute;
  right: -5px;
  top: 5px;
  width: 0;
  height: 0;
}

.a-enter-vr-modal p,
.a-enter-vr-modal a {
  display: inline;
}

.a-enter-vr-modal p {
  margin: 0;
}

.a-enter-vr-modal p:after {
  content: ' ';
}

.a-orientation-modal {
  background: rgba(244, 244, 244, 1) url(`+N+`) center no-repeat;
  background-size: 50% 50%;
  bottom: 0;
  font-size: 14px;
  font-weight: 600;
  left: 0;
  line-height: 20px;
  right: 0;
  position: fixed;
  top: 0;
  z-index: 9999999;
}

.a-orientation-modal:after {
  color: #666;
  content: "Insert phone into Cardboard holder.";
  display: block;
  position: absolute;
  text-align: center;
  top: 70%;
  transform: translateY(-70%);
  width: 100%;
}

.a-orientation-modal button {
  background: url(`+D+`) no-repeat;
  border: none;
  height: 50px;
  text-indent: -9999px;
  width: 50px;
}

.a-loader-title {
  background-color: rgba(0, 0, 0, 0.6);
  font-family: sans-serif, monospace;
  text-align: center;
  font-size: 20px;
  height: 50px;
  font-weight: 300;
  line-height: 50px;
  position: absolute;
  right: 0px;
  left: 0px;
  top: 0px;
  color: white;
}

.a-modal {
  position: absolute;
  background: rgba(0, 0, 0, 0.60);
  background-size: 50% 50%;
  bottom: 0;
  font-size: 14px;
  font-weight: 600;
  left: 0;
  line-height: 20px;
  right: 0;
  position: fixed;
  top: 0;
  z-index: 9999999;
}

.a-dialog {
  position: relative;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  z-index: 199995;
  width: 300px;
  height: 200px;
  background-size: contain;
  background-color: white;
  font-family: sans-serif, monospace;
  font-size: 20px;
  border-radius: 3px;
  padding: 6px;
}

.a-dialog-text-container {
  width: 100%;
  height: 70%;
  align-self: flex-start;
  display: flex;
  justify-content: center;
  align-content: center;
  flex-direction: column;
}

.a-dialog-text {
  display: inline-block;
  font-weight: normal;
  font-size: 14pt;
  margin: 8px;
}

.a-dialog-buttons-container {
  display: inline-flex;
  align-self: flex-end;
  width: 100%;
  height: 30%;
}

.a-dialog-button {
  cursor: pointer;
  align-self: center;
  opacity: 0.9;
  height: 80%;
  width: 50%;
  font-size: 12pt;
  margin: 4px;
  border-radius: 2px;
  text-align:center;
  border: none;
  display: inline-block;
  -webkit-transition: all 0.25s ease-in-out;
  transition: all 0.25s ease-in-out;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.10), 0 1px 2px rgba(0, 0, 0, 0.20);
  user-select: none;
}

.a-dialog-permission-button:hover {
  box-shadow: 0 7px 14px rgba(0,0,0,0.20), 0 2px 2px rgba(0,0,0,0.20);
}

.a-dialog-allow-button {
  background-color: #00ceff;
}

.a-dialog-deny-button {
  background-color: #ff005b;
}

.a-dialog-ok-button {
  background-color: #00ceff;
  width: 100%;
}

.a-dom-overlay:not(.a-no-style) {
  overflow: hidden;
  position: absolute;
  pointer-events: none;
  box-sizing: border-box;
  bottom: 0;
  left: 0;
  right: 0;
  top: 0;
  padding: 1em;
}

.a-dom-overlay:not(.a-no-style)>* {
  pointer-events: auto;
}
`,"",{version:3,sources:["webpack://./src/style/aframe.css"],names:[],mappings:"AAAA,sCAAsC;AACtC;EACE,SAAS;EACT,OAAO;EACP,eAAe;EACf,QAAQ;EACR,MAAM;AACR;;AAEA;EACE,YAAY;EACZ,SAAS;EACT,gBAAgB;EAChB,UAAU;EACV,WAAW;AACb;;AAEA,oDAAoD;AACpD;EACE,sBAAsB;EACtB,uBAAuB;EACvB,iBAAiB;EACjB,kBAAkB;EAClB,mBAAmB;EACnB,oBAAoB;EACpB,0BAA0B;AAC5B;;AAEA;;EAEE,UAAU;EACV,WAAW;AACb;;AAEA;EACE,WAAW;AACb;;AAEA,gEAAgE;AAChE;EACE,6BAA6B;AAC/B;;AAEA;EACE,wBAAwB;AAC1B;;AAEA;EACE,YAAY;EACZ,OAAO;EACP,kBAAkB;EAClB,MAAM;EACN,WAAW;AACb;;AAEA;EACE,YAAY;EACZ,iBAAiB;EACjB,oBAAoB;AACtB;;AAEA;EACE,eAAe;AACjB;;AAEA;EACE,yBAAyB;EACzB,eAAe;EACf,SAAS;EACT,QAAQ;EACR,iBAAiB;EACjB,WAAW;EACX,qBAAqB;EACrB,eAAe;EACf,8BAA8B;EAC9B,kBAAkB;EAClB,cAAc;EACd,YAAY;AACd;;AAEA,+BAA+B;AAC/B,oBAAoB,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;AAC7D,oBAAoB,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;AAC7D,oBAAoB,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;AAC7D,4BAA4B,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;AACrE,4BAA4B,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;AACrE,4BAA4B,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;;AAErE;EACE,sCAAsC;EACtC,8CAA8C;AAChD;;AAEA;EACE,sBAAsB;EACtB,8BAA8B;AAChC;;AAEA;EACE,sBAAsB;EACtB,8BAA8B;AAChC;;AAEA;EACE,cAAc;EACd,kBAAkB;EAClB,YAAY;EACZ,WAAW;AACb;;AAEA;;;;EAIE,aAAa;AACf;;AAEA;;EAEE,0DAA0D;AAC5D;;AAEA;EACE,6BAA6B;EAC7B,cAAc;EACd,qBAAqB;EACrB,6BAA6B;AAC/B;;AAEA;EACE,sBAAsB;EACtB,WAAW;EACX,gBAAgB;EAChB,kBAAkB;EAClB,UAAU;AACZ;;AAEA;;EAEE,kCAAkC;EAClC,eAAe;EACf,WAAW;EACX,gBAAgB;EAChB,iBAAiB;EACjB,kBAAkB;EAClB,WAAW;EACX,YAAY;AACd;;AAEA;EACE,WAAW;AACb;;AAEA;;;EAGE,WAAW;EACX,iBAAiB;EACjB,aAAa;AACf;;AAEA;EACE,yFAA4qB;AAC9qB;;AAEA;EACE,yFAAkzB;AACpzB;;AAEA;EACE,yDAA2qK;AAC7qK;;AAEA;;EAEE,wBAAwB;EACxB,SAAS;EACT,SAAS;EACT,eAAe;EACf,eAAe;EACf,gBAAgB;EAChB,kBAAkB;EAClB;;;;GAIC;EACD,gBAAgB;EAChB,cAAc;EACd,kBAAkB;EAClB,QAAQ;EACR,sCAAsC;EACtC,8CAA8C;EAC9C,aAAa;EACb,kBAAkB;EAClB,0BAA0B,EAAE,8CAA8C;AAC5E;;AAEA;EACE,yBAAyB;EACzB,kBAAkB;AACpB;;AAEA;;;;EAIE,yBAAyB;AAC3B;;AAEA;EACE,qCAAqC;AACvC;;AAEA;EACE,sBAAsB;EACtB,gBAAgB;EAChB,aAAa;EACb,gBAAgB;EAChB,kBAAkB;EAClB,YAAY;EACZ,YAAY;EACZ,SAAS;EACT,kBAAkB;AACpB;;AAEA;EACE,qCAAqC;EACrC,4BAA4B;EAC5B,kCAAkC;EAClC,qBAAqB;EACrB,WAAW;EACX,kBAAkB;EAClB,WAAW;EACX,QAAQ;EACR,QAAQ;EACR,SAAS;AACX;;AAEA;;EAEE,eAAe;AACjB;;AAEA;EACE,SAAS;AACX;;AAEA;EACE,YAAY;AACd;;AAEA;EACE,2FAAivF;EACjvF,wBAAwB;EACxB,SAAS;EACT,eAAe;EACf,gBAAgB;EAChB,OAAO;EACP,iBAAiB;EACjB,QAAQ;EACR,eAAe;EACf,MAAM;EACN,gBAAgB;AAClB;;AAEA;EACE,WAAW;EACX,8CAA8C;EAC9C,cAAc;EACd,kBAAkB;EAClB,kBAAkB;EAClB,QAAQ;EACR,2BAA2B;EAC3B,WAAW;AACb;;AAEA;EACE,6DAA25B;EAC35B,YAAY;EACZ,YAAY;EACZ,oBAAoB;EACpB,WAAW;AACb;;AAEA;EACE,oCAAoC;EACpC,kCAAkC;EAClC,kBAAkB;EAClB,eAAe;EACf,YAAY;EACZ,gBAAgB;EAChB,iBAAiB;EACjB,kBAAkB;EAClB,UAAU;EACV,SAAS;EACT,QAAQ;EACR,YAAY;AACd;;AAEA;EACE,kBAAkB;EAClB,+BAA+B;EAC/B,wBAAwB;EACxB,SAAS;EACT,eAAe;EACf,gBAAgB;EAChB,OAAO;EACP,iBAAiB;EACjB,QAAQ;EACR,eAAe;EACf,MAAM;EACN,gBAAgB;AAClB;;AAEA;EACE,kBAAkB;EAClB,SAAS;EACT,QAAQ;EACR,gCAAgC;EAChC,eAAe;EACf,YAAY;EACZ,aAAa;EACb,wBAAwB;EACxB,uBAAuB;EACvB,kCAAkC;EAClC,eAAe;EACf,kBAAkB;EAClB,YAAY;AACd;;AAEA;EACE,WAAW;EACX,WAAW;EACX,sBAAsB;EACtB,aAAa;EACb,uBAAuB;EACvB,qBAAqB;EACrB,sBAAsB;AACxB;;AAEA;EACE,qBAAqB;EACrB,mBAAmB;EACnB,eAAe;EACf,WAAW;AACb;;AAEA;EACE,oBAAoB;EACpB,oBAAoB;EACpB,WAAW;EACX,WAAW;AACb;;AAEA;EACE,eAAe;EACf,kBAAkB;EAClB,YAAY;EACZ,WAAW;EACX,UAAU;EACV,eAAe;EACf,WAAW;EACX,kBAAkB;EAClB,iBAAiB;EACjB,YAAY;EACZ,qBAAqB;EACrB,yCAAyC;EACzC,iCAAiC;EACjC,wEAAwE;EACxE,iBAAiB;AACnB;;AAEA;EACE,mEAAmE;AACrE;;AAEA;EACE,yBAAyB;AAC3B;;AAEA;EACE,yBAAyB;AAC3B;;AAEA;EACE,yBAAyB;EACzB,WAAW;AACb;;AAEA;EACE,gBAAgB;EAChB,kBAAkB;EAClB,oBAAoB;EACpB,sBAAsB;EACtB,SAAS;EACT,OAAO;EACP,QAAQ;EACR,MAAM;EACN,YAAY;AACd;;AAEA;EACE,oBAAoB;AACtB",sourcesContent:[`/* .a-fullscreen means not embedded. */
html.a-fullscreen {
  bottom: 0;
  left: 0;
  position: fixed;
  right: 0;
  top: 0;
}

html.a-fullscreen body {
  height: 100%;
  margin: 0;
  overflow: hidden;
  padding: 0;
  width: 100%;
}

/* Class is removed when doing <a-scene embedded>. */
html.a-fullscreen .a-canvas {
  width: 100% !important;
  height: 100% !important;
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  bottom: 0 !important;
  position: fixed !important;
}

html:not(.a-fullscreen) .a-enter-vr,
html:not(.a-fullscreen) .a-enter-ar {
  right: 5px;
  bottom: 5px;
}

html:not(.a-fullscreen) .a-enter-ar {
  right: 60px;
}

/* In chrome mobile the user agent stylesheet set it to white  */
:-webkit-full-screen {
  background-color: transparent;
}

.a-hidden {
  display: none !important;
}

.a-canvas {
  height: 100%;
  left: 0;
  position: absolute;
  top: 0;
  width: 100%;
}

.a-canvas.a-grab-cursor:hover {
  cursor: grab;
  cursor: -moz-grab;
  cursor: -webkit-grab;
}

canvas.a-canvas.a-mouse-cursor-hover:hover {
  cursor: pointer;
}

.a-inspector-loader {
  background-color: #ed3160;
  position: fixed;
  left: 3px;
  top: 3px;
  padding: 6px 10px;
  color: #fff;
  text-decoration: none;
  font-size: 12px;
  font-family: Roboto,sans-serif;
  text-align: center;
  z-index: 99999;
  width: 204px;
}

/* Inspector loader animation */
@keyframes dots-1 { from { opacity: 0; } 25% { opacity: 1; } }
@keyframes dots-2 { from { opacity: 0; } 50% { opacity: 1; } }
@keyframes dots-3 { from { opacity: 0; } 75% { opacity: 1; } }
@-webkit-keyframes dots-1 { from { opacity: 0; } 25% { opacity: 1; } }
@-webkit-keyframes dots-2 { from { opacity: 0; } 50% { opacity: 1; } }
@-webkit-keyframes dots-3 { from { opacity: 0; } 75% { opacity: 1; } }

.a-inspector-loader .dots span {
  animation: dots-1 2s infinite steps(1);
  -webkit-animation: dots-1 2s infinite steps(1);
}

.a-inspector-loader .dots span:first-child + span {
  animation-name: dots-2;
  -webkit-animation-name: dots-2;
}

.a-inspector-loader .dots span:first-child + span + span {
  animation-name: dots-3;
  -webkit-animation-name: dots-3;
}

a-scene {
  display: block;
  position: relative;
  height: 100%;
  width: 100%;
}

a-assets,
a-scene video,
a-scene img,
a-scene audio {
  display: none;
}

.a-enter-vr-modal,
.a-orientation-modal {
  font-family: Consolas, Andale Mono, Courier New, monospace;
}

.a-enter-vr-modal a {
  border-bottom: 1px solid #fff;
  padding: 2px 0;
  text-decoration: none;
  transition: .1s color ease-in;
}

.a-enter-vr-modal a:hover {
  background-color: #fff;
  color: #111;
  padding: 2px 4px;
  position: relative;
  left: -4px;
}

.a-enter-vr,
.a-enter-ar {
  font-family: sans-serif, monospace;
  font-size: 13px;
  width: 100%;
  font-weight: 200;
  line-height: 16px;
  position: absolute;
  right: 20px;
  bottom: 20px;
}

.a-enter-ar.xr {
  right: 90px;
}

.a-enter-vr-button,
.a-enter-vr-modal,
.a-enter-vr-modal a {
  color: #fff;
  user-select: none;
  outline: none;
}

.a-enter-vr-button {
  background: rgba(0, 0, 0, 0.35) url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='108' height='62' viewBox='0 0 108 62'%3E%3Ctitle%3Eaframe-vrmode-noborder-reduced-tracking%3C/title%3E%3Cpath d='M68.81,21.56H64.23v8.27h4.58a4.13,4.13,0,0,0,3.1-1.09,4.2,4.2,0,0,0,1-3,4.24,4.24,0,0,0-1-3A4.05,4.05,0,0,0,68.81,21.56Z' fill='%23fff'/%3E%3Cpath d='M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0ZM41.9,46H34L24,16h8l6,21.84,6-21.84H52Zm39.29,0H73.44L68.15,35.39H64.23V46H57V16H68.81q5.32,0,8.34,2.37a8,8,0,0,1,3,6.69,9.68,9.68,0,0,1-1.27,5.18,8.9,8.9,0,0,1-4,3.34l6.26,12.11Z' fill='%23fff'/%3E%3C/svg%3E") 50% 50% no-repeat;
}

.a-enter-ar-button {
  background: rgba(0, 0, 0, 0.20) url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='108' height='62' viewBox='0 0 108 62'%3E%3Ctitle%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d='M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0Zm8,50a8,8,0,0,1-8,8H12a8,8,0,0,1-8-8V12a8,8,0,0,1,8-8H96a8,8,0,0,1,8,8Z' fill='%23fff'/%3E%3Cpath d='M43.35,39.82H32.51L30.45,46H23.88L35,16h5.73L52,46H45.43Zm-9.17-5h7.5L37.91,23.58Z' fill='%23fff'/%3E%3Cpath d='M68.11,35H63.18V46H57V16H68.15q5.31,0,8.2,2.37a8.18,8.18,0,0,1,2.88,6.7,9.22,9.22,0,0,1-1.33,5.12,9.09,9.09,0,0,1-4,3.26l6.49,12.26V46H73.73Zm-4.93-5h5a5.09,5.09,0,0,0,3.6-1.18,4.21,4.21,0,0,0,1.28-3.27,4.56,4.56,0,0,0-1.2-3.34A5,5,0,0,0,68.15,21h-5Z' fill='%23fff'/%3E%3C/svg%3E") 50% 50% no-repeat;
}

.a-enter-vr.fullscreen .a-enter-vr-button {
  background-image: url("data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8' standalone='no'%3F%3E%3Csvg width='108' height='62' viewBox='0 0 108 62' version='1.1' id='svg320' sodipodi:docname='fullscreen-aframe.svg' xml:space='preserve' inkscape:version='1.2.1 (9c6d41e  2022-07-14)' xmlns:inkscape='http://www.inkscape.org/namespaces/inkscape' xmlns:sodipodi='http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd' xmlns='http://www.w3.org/2000/svg' xmlns:svg='http://www.w3.org/2000/svg' xmlns:rdf='http://www.w3.org/1999/02/22-rdf-syntax-ns%23' xmlns:cc='http://creativecommons.org/ns%23' xmlns:dc='http://purl.org/dc/elements/1.1/'%3E%3Cdefs id='defs324' /%3E%3Csodipodi:namedview id='namedview322' pagecolor='%23ffffff' bordercolor='%23000000' borderopacity='0.25' inkscape:showpageshadow='2' inkscape:pageopacity='0.0' inkscape:pagecheckerboard='0' inkscape:deskcolor='%23d1d1d1' showgrid='false' inkscape:zoom='3.8064516' inkscape:cx='91.423729' inkscape:cy='-1.4449153' inkscape:window-width='1440' inkscape:window-height='847' inkscape:window-x='32' inkscape:window-y='25' inkscape:window-maximized='0' inkscape:current-layer='svg320' /%3E%3Ctitle id='title312'%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d='M96 0H12A12 12 0 0 0 0 12V50A12 12 0 0 0 12 62H96a12 12 0 0 0 12-12V12A12 12 0 0 0 96 0Zm8 50a8 8 0 0 1-8 8H12a8 8 0 0 1-8-8V12a8 8 0 0 1 8-8H96a8 8 0 0 1 8 8Z' fill='%23fff' id='path314' style='fill:%23ffffff' /%3E%3Cg id='g356' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g358' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g360' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g362' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g364' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g366' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g368' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g370' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g372' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g374' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g376' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g378' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g380' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g382' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g384' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cmetadata id='metadata561'%3E%3Crdf:RDF%3E%3Ccc:Work rdf:about=''%3E%3Cdc:title%3Eaframe-armode-noborder-reduced-tracking%3C/dc:title%3E%3C/cc:Work%3E%3C/rdf:RDF%3E%3C/metadata%3E%3Cpath d='m 98.168511 40.083649 c 0 -1.303681 -0.998788 -2.358041 -2.239389 -2.358041 -1.230088 0.0031 -2.240892 1.05436 -2.240892 2.358041 v 4.881296 l -9.041661 -9.041662 c -0.874129 -0.875631 -2.288954 -0.875631 -3.16308 0 -0.874129 0.874126 -0.874129 2.293459 0 3.167585 l 8.995101 8.992101 h -4.858767 c -1.323206 0.0031 -2.389583 1.004796 -2.389583 2.239386 0 1.237598 1.066377 2.237888 2.389583 2.237888 h 10.154599 c 1.323206 0 2.388082 -0.998789 2.392587 -2.237888 -0.0044 -0.03305 -0.009 -0.05858 -0.0134 -0.09161 0.0046 -0.04207 0.0134 -0.08712 0.0134 -0.13066 V 40.085172 h -1.52e-4' id='path596' style='fill:%23ffffff%3Bstroke-width:1.50194' /%3E%3Cpath d='m 23.091002 35.921781 -9.026643 9.041662 v -4.881296 c 0 -1.303681 -1.009302 -2.355037 -2.242393 -2.358041 -1.237598 0 -2.237888 1.05436 -2.237888 2.358041 l -0.0031 10.016421 c 0 0.04356 0.01211 0.08862 0.0015 0.130659 -0.0031 0.03153 -0.009 0.05709 -0.01211 0.09161 0.0031 1.239099 1.069379 2.237888 2.391085 2.237888 h 10.156101 c 1.320202 0 2.388079 -1.000291 2.388079 -2.237888 0 -1.234591 -1.067877 -2.236383 -2.388079 -2.239387 h -4.858767 l 8.995101 -8.9921 c 0.871126 -0.874127 0.871126 -2.293459 0 -3.167586 -0.875628 -0.877132 -2.291957 -0.877132 -3.169087 -1.52e-4' id='path598' style='fill:%23ffffff%3Bstroke-width:1.50194' /%3E%3Cpath d='m 84.649572 25.978033 9.041662 -9.041664 v 4.881298 c 0 1.299176 1.010806 2.350532 2.240891 2.355037 1.240601 0 2.23939 -1.055861 2.23939 -2.355037 V 11.798242 c 0 -0.04356 -0.009 -0.08862 -0.0134 -0.127671 0.0044 -0.03153 0.009 -0.06157 0.0134 -0.09313 -0.0044 -1.240598 -1.069379 -2.2393873 -2.391085 -2.2393873 h -10.1546 c -1.323205 0 -2.38958 0.9987893 -2.38958 2.2393873 0 1.233091 1.066375 2.237887 2.38958 2.240891 h 4.858768 l -8.995102 8.9921 c -0.874129 0.872625 -0.874129 2.288954 0 3.161578 0.874127 0.880137 2.288951 0.880137 3.16308 1.5e-4' id='path600' style='fill:%23ffffff%3Bstroke-width:1.50194' /%3E%3Cpath d='m 17.264988 13.822853 h 4.857265 c 1.320202 -0.0031 2.388079 -1.0078 2.388079 -2.240889 0 -1.240601 -1.067877 -2.2393893 -2.388079 -2.2393893 H 11.967654 c -1.321707 0 -2.388082 0.9987883 -2.391085 2.2393893 0.0031 0.03153 0.009 0.06157 0.01211 0.09313 -0.0031 0.03905 -0.0015 0.08262 -0.0015 0.127671 l 0.0031 10.020926 c 0 1.299176 1.00029 2.355038 2.237887 2.355038 1.233092 -0.0044 2.242393 -1.055862 2.242393 -2.355038 v -4.881295 l 9.026644 9.041661 c 0.877132 0.878635 2.293459 0.878635 3.169087 0 0.871125 -0.872624 0.871125 -2.288953 0 -3.161577 l -8.995282 -8.993616' id='path602' style='fill:%23ffffff%3Bstroke-width:1.50194' /%3E%3C/svg%3E");
}

.a-enter-vr-button,
.a-enter-ar-button {
  background-size: 90% 90%;
  border: 0;
  bottom: 0;
  cursor: pointer;
  min-width: 58px;
  min-height: 34px;
  /* 1.74418604651 */
  /*
    In order to keep the aspect ratio when resizing
    padding-top percentages are relative to the containing block's width.
    http://stackoverflow.com/questions/12121090/responsively-change-div-size-keeping-aspect-ratio
  */
  padding-right: 0;
  padding-top: 0;
  position: absolute;
  right: 0;
  transition: background-color .05s ease;
  -webkit-transition: background-color .05s ease;
  z-index: 9999;
  border-radius: 8px;
  touch-action: manipulation; /* Prevent iOS double tap zoom on the button */
}

.a-enter-ar-button {
  background-size: 100% 90%;
  border-radius: 7px;
}

.a-enter-ar-button:active,
.a-enter-ar-button:hover,
.a-enter-vr-button:active,
.a-enter-vr-button:hover {
  background-color: #ef2d5e;
}

.a-enter-vr-button.resethover {
  background-color: rgba(0, 0, 0, 0.35);
}

.a-enter-vr-modal {
  background-color: #666;
  border-radius: 0;
  display: none;
  min-height: 32px;
  margin-right: 70px;
  padding: 9px;
  width: 280px;
  right: 2%;
  position: absolute;
}

.a-enter-vr-modal:after {
  border-bottom: 10px solid transparent;
  border-left: 10px solid #666;
  border-top: 10px solid transparent;
  display: inline-block;
  content: '';
  position: absolute;
  right: -5px;
  top: 5px;
  width: 0;
  height: 0;
}

.a-enter-vr-modal p,
.a-enter-vr-modal a {
  display: inline;
}

.a-enter-vr-modal p {
  margin: 0;
}

.a-enter-vr-modal p:after {
  content: ' ';
}

.a-orientation-modal {
  background: rgba(244, 244, 244, 1) url(data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%2090%2090%22%20enable-background%3D%22new%200%200%2090%2090%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpolygon%20points%3D%220%2C0%200%2C0%200%2C0%20%22%3E%3C/polygon%3E%3Cg%3E%3Cpath%20d%3D%22M71.545%2C48.145h-31.98V20.743c0-2.627-2.138-4.765-4.765-4.765H18.456c-2.628%2C0-4.767%2C2.138-4.767%2C4.765v42.789%20%20%20c0%2C2.628%2C2.138%2C4.766%2C4.767%2C4.766h5.535v0.959c0%2C2.628%2C2.138%2C4.765%2C4.766%2C4.765h42.788c2.628%2C0%2C4.766-2.137%2C4.766-4.765V52.914%20%20%20C76.311%2C50.284%2C74.173%2C48.145%2C71.545%2C48.145z%20M18.455%2C16.935h16.344c2.1%2C0%2C3.808%2C1.708%2C3.808%2C3.808v27.401H37.25V22.636%20%20%20c0-0.264-0.215-0.478-0.479-0.478H16.482c-0.264%2C0-0.479%2C0.214-0.479%2C0.478v36.585c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h7.507v7.644%20%20%20h-5.534c-2.101%2C0-3.81-1.709-3.81-3.81V20.743C14.645%2C18.643%2C16.354%2C16.935%2C18.455%2C16.935z%20M16.96%2C23.116h19.331v25.031h-7.535%20%20%20c-2.628%2C0-4.766%2C2.139-4.766%2C4.768v5.828h-7.03V23.116z%20M71.545%2C73.064H28.757c-2.101%2C0-3.81-1.708-3.81-3.808V52.914%20%20%20c0-2.102%2C1.709-3.812%2C3.81-3.812h42.788c2.1%2C0%2C3.809%2C1.71%2C3.809%2C3.812v16.343C75.354%2C71.356%2C73.645%2C73.064%2C71.545%2C73.064z%22%3E%3C/path%3E%3Cpath%20d%3D%22M28.919%2C58.424c-1.466%2C0-2.659%2C1.193-2.659%2C2.66c0%2C1.466%2C1.193%2C2.658%2C2.659%2C2.658c1.468%2C0%2C2.662-1.192%2C2.662-2.658%20%20%20C31.581%2C59.617%2C30.387%2C58.424%2C28.919%2C58.424z%20M28.919%2C62.786c-0.939%2C0-1.703-0.764-1.703-1.702c0-0.939%2C0.764-1.704%2C1.703-1.704%20%20%20c0.94%2C0%2C1.705%2C0.765%2C1.705%2C1.704C30.623%2C62.022%2C29.858%2C62.786%2C28.919%2C62.786z%22%3E%3C/path%3E%3Cpath%20d%3D%22M69.654%2C50.461H33.069c-0.264%2C0-0.479%2C0.215-0.479%2C0.479v20.288c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h36.585%20%20%20c0.263%2C0%2C0.477-0.214%2C0.477-0.478V50.939C70.131%2C50.676%2C69.917%2C50.461%2C69.654%2C50.461z%20M69.174%2C51.417V70.75H33.548V51.417H69.174z%22%3E%3C/path%3E%3Cpath%20d%3D%22M45.201%2C30.296c6.651%2C0%2C12.233%2C5.351%2C12.551%2C11.977l-3.033-2.638c-0.193-0.165-0.507-0.142-0.675%2C0.048%20%20%20c-0.174%2C0.198-0.153%2C0.501%2C0.045%2C0.676l3.883%2C3.375c0.09%2C0.075%2C0.198%2C0.115%2C0.312%2C0.115c0.141%2C0%2C0.273-0.061%2C0.362-0.166%20%20%20l3.371-3.877c0.173-0.2%2C0.151-0.502-0.047-0.675c-0.194-0.166-0.508-0.144-0.676%2C0.048l-2.592%2C2.979%20%20%20c-0.18-3.417-1.629-6.605-4.099-9.001c-2.538-2.461-5.877-3.817-9.404-3.817c-0.264%2C0-0.479%2C0.215-0.479%2C0.479%20%20%20C44.72%2C30.083%2C44.936%2C30.296%2C45.201%2C30.296z%22%3E%3C/path%3E%3C/g%3E%3C/svg%3E) center no-repeat;
  background-size: 50% 50%;
  bottom: 0;
  font-size: 14px;
  font-weight: 600;
  left: 0;
  line-height: 20px;
  right: 0;
  position: fixed;
  top: 0;
  z-index: 9999999;
}

.a-orientation-modal:after {
  color: #666;
  content: "Insert phone into Cardboard holder.";
  display: block;
  position: absolute;
  text-align: center;
  top: 70%;
  transform: translateY(-70%);
  width: 100%;
}

.a-orientation-modal button {
  background: url(data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%20100%20100%22%20enable-background%3D%22new%200%200%20100%20100%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpath%20fill%3D%22%23000000%22%20d%3D%22M55.209%2C50l17.803-17.803c1.416-1.416%2C1.416-3.713%2C0-5.129c-1.416-1.417-3.713-1.417-5.129%2C0L50.08%2C44.872%20%20L32.278%2C27.069c-1.416-1.417-3.714-1.417-5.129%2C0c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129L44.951%2C50L27.149%2C67.803%20%20c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129c0.708%2C0.708%2C1.636%2C1.062%2C2.564%2C1.062c0.928%2C0%2C1.856-0.354%2C2.564-1.062L50.08%2C55.13l17.803%2C17.802%20%20c0.708%2C0.708%2C1.637%2C1.062%2C2.564%2C1.062s1.856-0.354%2C2.564-1.062c1.416-1.416%2C1.416-3.713%2C0-5.129L55.209%2C50z%22%3E%3C/path%3E%3C/svg%3E) no-repeat;
  border: none;
  height: 50px;
  text-indent: -9999px;
  width: 50px;
}

.a-loader-title {
  background-color: rgba(0, 0, 0, 0.6);
  font-family: sans-serif, monospace;
  text-align: center;
  font-size: 20px;
  height: 50px;
  font-weight: 300;
  line-height: 50px;
  position: absolute;
  right: 0px;
  left: 0px;
  top: 0px;
  color: white;
}

.a-modal {
  position: absolute;
  background: rgba(0, 0, 0, 0.60);
  background-size: 50% 50%;
  bottom: 0;
  font-size: 14px;
  font-weight: 600;
  left: 0;
  line-height: 20px;
  right: 0;
  position: fixed;
  top: 0;
  z-index: 9999999;
}

.a-dialog {
  position: relative;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  z-index: 199995;
  width: 300px;
  height: 200px;
  background-size: contain;
  background-color: white;
  font-family: sans-serif, monospace;
  font-size: 20px;
  border-radius: 3px;
  padding: 6px;
}

.a-dialog-text-container {
  width: 100%;
  height: 70%;
  align-self: flex-start;
  display: flex;
  justify-content: center;
  align-content: center;
  flex-direction: column;
}

.a-dialog-text {
  display: inline-block;
  font-weight: normal;
  font-size: 14pt;
  margin: 8px;
}

.a-dialog-buttons-container {
  display: inline-flex;
  align-self: flex-end;
  width: 100%;
  height: 30%;
}

.a-dialog-button {
  cursor: pointer;
  align-self: center;
  opacity: 0.9;
  height: 80%;
  width: 50%;
  font-size: 12pt;
  margin: 4px;
  border-radius: 2px;
  text-align:center;
  border: none;
  display: inline-block;
  -webkit-transition: all 0.25s ease-in-out;
  transition: all 0.25s ease-in-out;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.10), 0 1px 2px rgba(0, 0, 0, 0.20);
  user-select: none;
}

.a-dialog-permission-button:hover {
  box-shadow: 0 7px 14px rgba(0,0,0,0.20), 0 2px 2px rgba(0,0,0,0.20);
}

.a-dialog-allow-button {
  background-color: #00ceff;
}

.a-dialog-deny-button {
  background-color: #ff005b;
}

.a-dialog-ok-button {
  background-color: #00ceff;
  width: 100%;
}

.a-dom-overlay:not(.a-no-style) {
  overflow: hidden;
  position: absolute;
  pointer-events: none;
  box-sizing: border-box;
  bottom: 0;
  left: 0;
  right: 0;
  top: 0;
  padding: 1em;
}

.a-dom-overlay:not(.a-no-style)>* {
  pointer-events: auto;
}
`],sourceRoot:""}]);const P=C},"./node_modules/css-loader/dist/cjs.js!./src/style/rStats.css":(l,u,c)=>{c.r(u),c.d(u,{default:()=>y});var h=c("./node_modules/css-loader/dist/runtime/sourceMaps.js"),p=c.n(h),f=c("./node_modules/css-loader/dist/runtime/api.js"),g=c.n(f),m=g()(p());m.push([l.id,`.rs-base {
  background-color: #333;
  color: #fafafa;
  border-radius: 0;
  font: 10px monospace;
  left: 5px;
  line-height: 1em;
  opacity: 0.85;
  overflow: hidden;
  padding: 10px;
  position: fixed;
  top: 5px;
  width: 300px;
  z-index: 10000;
}

.rs-base div.hidden {
  display: none;
}

.rs-base h1 {
  color: #fff;
  cursor: pointer;
  font-size: 1.4em;
  font-weight: 300;
  margin: 0 0 5px;
  padding: 0;
}

.rs-group {
  display: -webkit-box;
  display: -webkit-flex;
  display: flex;
  -webkit-flex-direction: column-reverse;
  flex-direction: column-reverse;
  margin-bottom: 5px;
}

.rs-group:last-child {
  margin-bottom: 0;
}

.rs-counter-base {
  align-items: center;
  display: -webkit-box;
  display: -webkit-flex;
  display: flex;
  height: 10px;
  -webkit-justify-content: space-between;
  justify-content: space-between;
  margin: 2px 0;
}

.rs-counter-base.alarm {
  color: #b70000;
  text-shadow: 0 0 0 #b70000,
               0 0 1px #fff,
               0 0 1px #fff,
               0 0 2px #fff,
               0 0 2px #fff,
               0 0 3px #fff,
               0 0 3px #fff,
               0 0 4px #fff,
               0 0 4px #fff;
}

.rs-counter-id {
  font-weight: 300;
  -webkit-box-ordinal-group: 0;
  -webkit-order: 0;
  order: 0;
  width: 54px;
}

.rs-counter-value {
  font-weight: 300;
  -webkit-box-ordinal-group: 1;
  -webkit-order: 1;
  order: 1;
  text-align: right;
  width: 35px;
}

.rs-canvas {
  -webkit-box-ordinal-group: 2;
  -webkit-order: 2;
  order: 2;
}

@media (min-width: 480px) {
  .rs-base {
    left: 20px;
    top: 20px;
  }
}
`,"",{version:3,sources:["webpack://./src/style/rStats.css"],names:[],mappings:"AAAA;EACE,sBAAsB;EACtB,cAAc;EACd,gBAAgB;EAChB,oBAAoB;EACpB,SAAS;EACT,gBAAgB;EAChB,aAAa;EACb,gBAAgB;EAChB,aAAa;EACb,eAAe;EACf,QAAQ;EACR,YAAY;EACZ,cAAc;AAChB;;AAEA;EACE,aAAa;AACf;;AAEA;EACE,WAAW;EACX,eAAe;EACf,gBAAgB;EAChB,gBAAgB;EAChB,eAAe;EACf,UAAU;AACZ;;AAEA;EACE,oBAAoB;EACpB,qBAAqB;EACrB,aAAa;EACb,sCAAsC;EACtC,8BAA8B;EAC9B,kBAAkB;AACpB;;AAEA;EACE,gBAAgB;AAClB;;AAEA;EACE,mBAAmB;EACnB,oBAAoB;EACpB,qBAAqB;EACrB,aAAa;EACb,YAAY;EACZ,sCAAsC;EACtC,8BAA8B;EAC9B,aAAa;AACf;;AAEA;EACE,cAAc;EACd;;;;;;;;2BAQyB;AAC3B;;AAEA;EACE,gBAAgB;EAChB,4BAA4B;EAC5B,gBAAgB;EAChB,QAAQ;EACR,WAAW;AACb;;AAEA;EACE,gBAAgB;EAChB,4BAA4B;EAC5B,gBAAgB;EAChB,QAAQ;EACR,iBAAiB;EACjB,WAAW;AACb;;AAEA;EACE,4BAA4B;EAC5B,gBAAgB;EAChB,QAAQ;AACV;;AAEA;EACE;IACE,UAAU;IACV,SAAS;EACX;AACF",sourcesContent:[`.rs-base {
  background-color: #333;
  color: #fafafa;
  border-radius: 0;
  font: 10px monospace;
  left: 5px;
  line-height: 1em;
  opacity: 0.85;
  overflow: hidden;
  padding: 10px;
  position: fixed;
  top: 5px;
  width: 300px;
  z-index: 10000;
}

.rs-base div.hidden {
  display: none;
}

.rs-base h1 {
  color: #fff;
  cursor: pointer;
  font-size: 1.4em;
  font-weight: 300;
  margin: 0 0 5px;
  padding: 0;
}

.rs-group {
  display: -webkit-box;
  display: -webkit-flex;
  display: flex;
  -webkit-flex-direction: column-reverse;
  flex-direction: column-reverse;
  margin-bottom: 5px;
}

.rs-group:last-child {
  margin-bottom: 0;
}

.rs-counter-base {
  align-items: center;
  display: -webkit-box;
  display: -webkit-flex;
  display: flex;
  height: 10px;
  -webkit-justify-content: space-between;
  justify-content: space-between;
  margin: 2px 0;
}

.rs-counter-base.alarm {
  color: #b70000;
  text-shadow: 0 0 0 #b70000,
               0 0 1px #fff,
               0 0 1px #fff,
               0 0 2px #fff,
               0 0 2px #fff,
               0 0 3px #fff,
               0 0 3px #fff,
               0 0 4px #fff,
               0 0 4px #fff;
}

.rs-counter-id {
  font-weight: 300;
  -webkit-box-ordinal-group: 0;
  -webkit-order: 0;
  order: 0;
  width: 54px;
}

.rs-counter-value {
  font-weight: 300;
  -webkit-box-ordinal-group: 1;
  -webkit-order: 1;
  order: 1;
  text-align: right;
  width: 35px;
}

.rs-canvas {
  -webkit-box-ordinal-group: 2;
  -webkit-order: 2;
  order: 2;
}

@media (min-width: 480px) {
  .rs-base {
    left: 20px;
    top: 20px;
  }
}
`],sourceRoot:""}]);const y=m},"./src/style/aframe.css":(l,u,c)=>{c.r(u),c.d(u,{default:()=>I});var h=c("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),p=c.n(h),f=c("./node_modules/style-loader/dist/runtime/styleDomAPI.js"),g=c.n(f),m=c("./node_modules/style-loader/dist/runtime/insertBySelector.js"),y=c.n(m),b=c("./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js"),v=c.n(b),_=c("./node_modules/style-loader/dist/runtime/insertStyleElement.js"),T=c.n(_),E=c("./node_modules/style-loader/dist/runtime/styleTagTransform.js"),C=c.n(E),R=c("./node_modules/css-loader/dist/cjs.js!./src/style/aframe.css"),B={};B.styleTagTransform=C(),B.setAttributes=v(),B.insert=y().bind(null,"head"),B.domAPI=g(),B.insertStyleElement=T(),p()(R.default,B);const I=R.default&&R.default.locals?R.default.locals:void 0},"./src/style/rStats.css":(l,u,c)=>{c.r(u),c.d(u,{default:()=>I});var h=c("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),p=c.n(h),f=c("./node_modules/style-loader/dist/runtime/styleDomAPI.js"),g=c.n(f),m=c("./node_modules/style-loader/dist/runtime/insertBySelector.js"),y=c.n(m),b=c("./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js"),v=c.n(b),_=c("./node_modules/style-loader/dist/runtime/insertStyleElement.js"),T=c.n(_),E=c("./node_modules/style-loader/dist/runtime/styleTagTransform.js"),C=c.n(E),R=c("./node_modules/css-loader/dist/cjs.js!./src/style/rStats.css"),B={};B.styleTagTransform=C(),B.setAttributes=v(),B.insert=y().bind(null,"head"),B.domAPI=g(),B.insertStyleElement=T(),p()(R.default,B);const I=R.default&&R.default.locals?R.default.locals:void 0},"./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js":l=>{var u=[];function c(f){for(var g=-1,m=0;m<u.length;m++)if(u[m].identifier===f){g=m;break}return g}function h(f,g){for(var m={},y=[],b=0;b<f.length;b++){var v=f[b],_=g.base?v[0]+g.base:v[0],T=m[_]||0,E="".concat(_," ").concat(T);m[_]=T+1;var C=c(E),R={css:v[1],media:v[2],sourceMap:v[3],supports:v[4],layer:v[5]};if(C!==-1)u[C].references++,u[C].updater(R);else{var B=p(R,g);g.byIndex=b,u.splice(b,0,{identifier:E,updater:B,references:1})}y.push(E)}return y}function p(f,g){var m=g.domAPI(g);m.update(f);var y=function(b){if(b){if(b.css===f.css&&b.media===f.media&&b.sourceMap===f.sourceMap&&b.supports===f.supports&&b.layer===f.layer)return;m.update(f=b)}else m.remove()};return y}l.exports=function(f,g){g=g||{},f=f||[];var m=h(f,g);return function(y){y=y||[];for(var b=0;b<m.length;b++){var v=m[b],_=c(v);u[_].references--}for(var T=h(y,g),E=0;E<m.length;E++){var C=m[E],R=c(C);u[R].references===0&&(u[R].updater(),u.splice(R,1))}m=T}}},"./node_modules/style-loader/dist/runtime/insertBySelector.js":l=>{var u={};function c(p){if(typeof u[p]>"u"){var f=document.querySelector(p);if(window.HTMLIFrameElement&&f instanceof window.HTMLIFrameElement)try{f=f.contentDocument.head}catch{f=null}u[p]=f}return u[p]}function h(p,f){var g=c(p);if(!g)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");g.appendChild(f)}l.exports=h},"./node_modules/style-loader/dist/runtime/insertStyleElement.js":l=>{function u(c){var h=document.createElement("style");return c.setAttributes(h,c.attributes),c.insert(h,c.options),h}l.exports=u},"./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js":(l,u,c)=>{function h(p){var f=c.nc;f&&p.setAttribute("nonce",f)}l.exports=h},"./node_modules/style-loader/dist/runtime/styleDomAPI.js":l=>{function u(p,f,g){var m="";g.supports&&(m+="@supports (".concat(g.supports,") {")),g.media&&(m+="@media ".concat(g.media," {"));var y=typeof g.layer<"u";y&&(m+="@layer".concat(g.layer.length>0?" ".concat(g.layer):""," {")),m+=g.css,y&&(m+="}"),g.media&&(m+="}"),g.supports&&(m+="}");var b=g.sourceMap;b&&typeof btoa<"u"&&(m+=`
/*# sourceMappingURL=data:application/json;base64,`.concat(btoa(unescape(encodeURIComponent(JSON.stringify(b))))," */")),f.styleTagTransform(m,p,f.options)}function c(p){if(p.parentNode===null)return!1;p.parentNode.removeChild(p)}function h(p){if(typeof document>"u")return{update:function(){},remove:function(){}};var f=p.insertStyleElement(p);return{update:function(g){u(f,p,g)},remove:function(){c(f)}}}l.exports=h},"./node_modules/style-loader/dist/runtime/styleTagTransform.js":l=>{function u(c,h){if(h.styleSheet)h.styleSheet.cssText=c;else{for(;h.firstChild;)h.removeChild(h.firstChild);h.appendChild(document.createTextNode(c))}}l.exports=u},"data:image/svg+xml,%3C%3Fxml version=%271.0%27 encoding=%27UTF-8%27 standalone=%27no%27%3F%3E%3Csvg width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27 version=%271.1%27 id=%27svg320%27 sodipodi:docname=%27fullscreen-aframe.svg%27 xml:space=%27preserve%27 inkscape:version=%271.2.1 %289c6d41e  2022-07-14%29%27 xmlns:inkscape=%27http://www.inkscape.org/namespaces/inkscape%27 xmlns:sodipodi=%27http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd%27 xmlns=%27http://www.w3.org/2000/svg%27 xmlns:svg=%27http://www.w3.org/2000/svg%27 xmlns:rdf=%27http://www.w3.org/1999/02/22-rdf-syntax-ns%23%27 xmlns:cc=%27http://creativecommons.org/ns%23%27 xmlns:dc=%27http://purl.org/dc/elements/1.1/%27%3E%3Cdefs id=%27defs324%27 /%3E%3Csodipodi:namedview id=%27namedview322%27 pagecolor=%27%23ffffff%27 bordercolor=%27%23000000%27 borderopacity=%270.25%27 inkscape:showpageshadow=%272%27 inkscape:pageopacity=%270.0%27 inkscape:pagecheckerboard=%270%27 inkscape:deskcolor=%27%23d1d1d1%27 showgrid=%27false%27 inkscape:zoom=%273.8064516%27 inkscape:cx=%2791.423729%27 inkscape:cy=%27-1.4449153%27 inkscape:window-width=%271440%27 inkscape:window-height=%27847%27 inkscape:window-x=%2732%27 inkscape:window-y=%2725%27 inkscape:window-maximized=%270%27 inkscape:current-layer=%27svg320%27 /%3E%3Ctitle id=%27title312%27%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M96 0H12A12 12 0 0 0 0 12V50A12 12 0 0 0 12 62H96a12 12 0 0 0 12-12V12A12 12 0 0 0 96 0Zm8 50a8 8 0 0 1-8 8H12a8 8 0 0 1-8-8V12a8 8 0 0 1 8-8H96a8 8 0 0 1 8 8Z%27 fill=%27%23fff%27 id=%27path314%27 style=%27fill:%23ffffff%27 /%3E%3Cg id=%27g356%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g358%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g360%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g362%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g364%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g366%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g368%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g370%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g372%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g374%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g376%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g378%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g380%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g382%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g384%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cmetadata id=%27metadata561%27%3E%3Crdf:RDF%3E%3Ccc:Work rdf:about=%27%27%3E%3Cdc:title%3Eaframe-armode-noborder-reduced-tracking%3C/dc:title%3E%3C/cc:Work%3E%3C/rdf:RDF%3E%3C/metadata%3E%3Cpath d=%27m 98.168511 40.083649 c 0 -1.303681 -0.998788 -2.358041 -2.239389 -2.358041 -1.230088 0.0031 -2.240892 1.05436 -2.240892 2.358041 v 4.881296 l -9.041661 -9.041662 c -0.874129 -0.875631 -2.288954 -0.875631 -3.16308 0 -0.874129 0.874126 -0.874129 2.293459 0 3.167585 l 8.995101 8.992101 h -4.858767 c -1.323206 0.0031 -2.389583 1.004796 -2.389583 2.239386 0 1.237598 1.066377 2.237888 2.389583 2.237888 h 10.154599 c 1.323206 0 2.388082 -0.998789 2.392587 -2.237888 -0.0044 -0.03305 -0.009 -0.05858 -0.0134 -0.09161 0.0046 -0.04207 0.0134 -0.08712 0.0134 -0.13066 V 40.085172 h -1.52e-4%27 id=%27path596%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 23.091002 35.921781 -9.026643 9.041662 v -4.881296 c 0 -1.303681 -1.009302 -2.355037 -2.242393 -2.358041 -1.237598 0 -2.237888 1.05436 -2.237888 2.358041 l -0.0031 10.016421 c 0 0.04356 0.01211 0.08862 0.0015 0.130659 -0.0031 0.03153 -0.009 0.05709 -0.01211 0.09161 0.0031 1.239099 1.069379 2.237888 2.391085 2.237888 h 10.156101 c 1.320202 0 2.388079 -1.000291 2.388079 -2.237888 0 -1.234591 -1.067877 -2.236383 -2.388079 -2.239387 h -4.858767 l 8.995101 -8.9921 c 0.871126 -0.874127 0.871126 -2.293459 0 -3.167586 -0.875628 -0.877132 -2.291957 -0.877132 -3.169087 -1.52e-4%27 id=%27path598%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 84.649572 25.978033 9.041662 -9.041664 v 4.881298 c 0 1.299176 1.010806 2.350532 2.240891 2.355037 1.240601 0 2.23939 -1.055861 2.23939 -2.355037 V 11.798242 c 0 -0.04356 -0.009 -0.08862 -0.0134 -0.127671 0.0044 -0.03153 0.009 -0.06157 0.0134 -0.09313 -0.0044 -1.240598 -1.069379 -2.2393873 -2.391085 -2.2393873 h -10.1546 c -1.323205 0 -2.38958 0.9987893 -2.38958 2.2393873 0 1.233091 1.066375 2.237887 2.38958 2.240891 h 4.858768 l -8.995102 8.9921 c -0.874129 0.872625 -0.874129 2.288954 0 3.161578 0.874127 0.880137 2.288951 0.880137 3.16308 1.5e-4%27 id=%27path600%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 17.264988 13.822853 h 4.857265 c 1.320202 -0.0031 2.388079 -1.0078 2.388079 -2.240889 0 -1.240601 -1.067877 -2.2393893 -2.388079 -2.2393893 H 11.967654 c -1.321707 0 -2.388082 0.9987883 -2.391085 2.2393893 0.0031 0.03153 0.009 0.06157 0.01211 0.09313 -0.0031 0.03905 -0.0015 0.08262 -0.0015 0.127671 l 0.0031 10.020926 c 0 1.299176 1.00029 2.355038 2.237887 2.355038 1.233092 -0.0044 2.242393 -1.055862 2.242393 -2.355038 v -4.881295 l 9.026644 9.041661 c 0.877132 0.878635 2.293459 0.878635 3.169087 0 0.871125 -0.872624 0.871125 -2.288953 0 -3.161577 l -8.995282 -8.993616%27 id=%27path602%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3C/svg%3E":l=>{l.exports="data:image/svg+xml,%3C%3Fxml version=%271.0%27 encoding=%27UTF-8%27 standalone=%27no%27%3F%3E%3Csvg width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27 version=%271.1%27 id=%27svg320%27 sodipodi:docname=%27fullscreen-aframe.svg%27 xml:space=%27preserve%27 inkscape:version=%271.2.1 %289c6d41e  2022-07-14%29%27 xmlns:inkscape=%27http://www.inkscape.org/namespaces/inkscape%27 xmlns:sodipodi=%27http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd%27 xmlns=%27http://www.w3.org/2000/svg%27 xmlns:svg=%27http://www.w3.org/2000/svg%27 xmlns:rdf=%27http://www.w3.org/1999/02/22-rdf-syntax-ns%23%27 xmlns:cc=%27http://creativecommons.org/ns%23%27 xmlns:dc=%27http://purl.org/dc/elements/1.1/%27%3E%3Cdefs id=%27defs324%27 /%3E%3Csodipodi:namedview id=%27namedview322%27 pagecolor=%27%23ffffff%27 bordercolor=%27%23000000%27 borderopacity=%270.25%27 inkscape:showpageshadow=%272%27 inkscape:pageopacity=%270.0%27 inkscape:pagecheckerboard=%270%27 inkscape:deskcolor=%27%23d1d1d1%27 showgrid=%27false%27 inkscape:zoom=%273.8064516%27 inkscape:cx=%2791.423729%27 inkscape:cy=%27-1.4449153%27 inkscape:window-width=%271440%27 inkscape:window-height=%27847%27 inkscape:window-x=%2732%27 inkscape:window-y=%2725%27 inkscape:window-maximized=%270%27 inkscape:current-layer=%27svg320%27 /%3E%3Ctitle id=%27title312%27%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M96 0H12A12 12 0 0 0 0 12V50A12 12 0 0 0 12 62H96a12 12 0 0 0 12-12V12A12 12 0 0 0 96 0Zm8 50a8 8 0 0 1-8 8H12a8 8 0 0 1-8-8V12a8 8 0 0 1 8-8H96a8 8 0 0 1 8 8Z%27 fill=%27%23fff%27 id=%27path314%27 style=%27fill:%23ffffff%27 /%3E%3Cg id=%27g356%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g358%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g360%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g362%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g364%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g366%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g368%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g370%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g372%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g374%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g376%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g378%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g380%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g382%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g384%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cmetadata id=%27metadata561%27%3E%3Crdf:RDF%3E%3Ccc:Work rdf:about=%27%27%3E%3Cdc:title%3Eaframe-armode-noborder-reduced-tracking%3C/dc:title%3E%3C/cc:Work%3E%3C/rdf:RDF%3E%3C/metadata%3E%3Cpath d=%27m 98.168511 40.083649 c 0 -1.303681 -0.998788 -2.358041 -2.239389 -2.358041 -1.230088 0.0031 -2.240892 1.05436 -2.240892 2.358041 v 4.881296 l -9.041661 -9.041662 c -0.874129 -0.875631 -2.288954 -0.875631 -3.16308 0 -0.874129 0.874126 -0.874129 2.293459 0 3.167585 l 8.995101 8.992101 h -4.858767 c -1.323206 0.0031 -2.389583 1.004796 -2.389583 2.239386 0 1.237598 1.066377 2.237888 2.389583 2.237888 h 10.154599 c 1.323206 0 2.388082 -0.998789 2.392587 -2.237888 -0.0044 -0.03305 -0.009 -0.05858 -0.0134 -0.09161 0.0046 -0.04207 0.0134 -0.08712 0.0134 -0.13066 V 40.085172 h -1.52e-4%27 id=%27path596%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 23.091002 35.921781 -9.026643 9.041662 v -4.881296 c 0 -1.303681 -1.009302 -2.355037 -2.242393 -2.358041 -1.237598 0 -2.237888 1.05436 -2.237888 2.358041 l -0.0031 10.016421 c 0 0.04356 0.01211 0.08862 0.0015 0.130659 -0.0031 0.03153 -0.009 0.05709 -0.01211 0.09161 0.0031 1.239099 1.069379 2.237888 2.391085 2.237888 h 10.156101 c 1.320202 0 2.388079 -1.000291 2.388079 -2.237888 0 -1.234591 -1.067877 -2.236383 -2.388079 -2.239387 h -4.858767 l 8.995101 -8.9921 c 0.871126 -0.874127 0.871126 -2.293459 0 -3.167586 -0.875628 -0.877132 -2.291957 -0.877132 -3.169087 -1.52e-4%27 id=%27path598%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 84.649572 25.978033 9.041662 -9.041664 v 4.881298 c 0 1.299176 1.010806 2.350532 2.240891 2.355037 1.240601 0 2.23939 -1.055861 2.23939 -2.355037 V 11.798242 c 0 -0.04356 -0.009 -0.08862 -0.0134 -0.127671 0.0044 -0.03153 0.009 -0.06157 0.0134 -0.09313 -0.0044 -1.240598 -1.069379 -2.2393873 -2.391085 -2.2393873 h -10.1546 c -1.323205 0 -2.38958 0.9987893 -2.38958 2.2393873 0 1.233091 1.066375 2.237887 2.38958 2.240891 h 4.858768 l -8.995102 8.9921 c -0.874129 0.872625 -0.874129 2.288954 0 3.161578 0.874127 0.880137 2.288951 0.880137 3.16308 1.5e-4%27 id=%27path600%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 17.264988 13.822853 h 4.857265 c 1.320202 -0.0031 2.388079 -1.0078 2.388079 -2.240889 0 -1.240601 -1.067877 -2.2393893 -2.388079 -2.2393893 H 11.967654 c -1.321707 0 -2.388082 0.9987883 -2.391085 2.2393893 0.0031 0.03153 0.009 0.06157 0.01211 0.09313 -0.0031 0.03905 -0.0015 0.08262 -0.0015 0.127671 l 0.0031 10.020926 c 0 1.299176 1.00029 2.355038 2.237887 2.355038 1.233092 -0.0044 2.242393 -1.055862 2.242393 -2.355038 v -4.881295 l 9.026644 9.041661 c 0.877132 0.878635 2.293459 0.878635 3.169087 0 0.871125 -0.872624 0.871125 -2.288953 0 -3.161577 l -8.995282 -8.993616%27 id=%27path602%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3C/svg%3E"},"data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27%3E%3Ctitle%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0Zm8,50a8,8,0,0,1-8,8H12a8,8,0,0,1-8-8V12a8,8,0,0,1,8-8H96a8,8,0,0,1,8,8Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M43.35,39.82H32.51L30.45,46H23.88L35,16h5.73L52,46H45.43Zm-9.17-5h7.5L37.91,23.58Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M68.11,35H63.18V46H57V16H68.15q5.31,0,8.2,2.37a8.18,8.18,0,0,1,2.88,6.7,9.22,9.22,0,0,1-1.33,5.12,9.09,9.09,0,0,1-4,3.26l6.49,12.26V46H73.73Zm-4.93-5h5a5.09,5.09,0,0,0,3.6-1.18,4.21,4.21,0,0,0,1.28-3.27,4.56,4.56,0,0,0-1.2-3.34A5,5,0,0,0,68.15,21h-5Z%27 fill=%27%23fff%27/%3E%3C/svg%3E":l=>{l.exports="data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27%3E%3Ctitle%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0Zm8,50a8,8,0,0,1-8,8H12a8,8,0,0,1-8-8V12a8,8,0,0,1,8-8H96a8,8,0,0,1,8,8Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M43.35,39.82H32.51L30.45,46H23.88L35,16h5.73L52,46H45.43Zm-9.17-5h7.5L37.91,23.58Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M68.11,35H63.18V46H57V16H68.15q5.31,0,8.2,2.37a8.18,8.18,0,0,1,2.88,6.7,9.22,9.22,0,0,1-1.33,5.12,9.09,9.09,0,0,1-4,3.26l6.49,12.26V46H73.73Zm-4.93-5h5a5.09,5.09,0,0,0,3.6-1.18,4.21,4.21,0,0,0,1.28-3.27,4.56,4.56,0,0,0-1.2-3.34A5,5,0,0,0,68.15,21h-5Z%27 fill=%27%23fff%27/%3E%3C/svg%3E"},"data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27%3E%3Ctitle%3Eaframe-vrmode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M68.81,21.56H64.23v8.27h4.58a4.13,4.13,0,0,0,3.1-1.09,4.2,4.2,0,0,0,1-3,4.24,4.24,0,0,0-1-3A4.05,4.05,0,0,0,68.81,21.56Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0ZM41.9,46H34L24,16h8l6,21.84,6-21.84H52Zm39.29,0H73.44L68.15,35.39H64.23V46H57V16H68.81q5.32,0,8.34,2.37a8,8,0,0,1,3,6.69,9.68,9.68,0,0,1-1.27,5.18,8.9,8.9,0,0,1-4,3.34l6.26,12.11Z%27 fill=%27%23fff%27/%3E%3C/svg%3E":l=>{l.exports="data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27%3E%3Ctitle%3Eaframe-vrmode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M68.81,21.56H64.23v8.27h4.58a4.13,4.13,0,0,0,3.1-1.09,4.2,4.2,0,0,0,1-3,4.24,4.24,0,0,0-1-3A4.05,4.05,0,0,0,68.81,21.56Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0ZM41.9,46H34L24,16h8l6,21.84,6-21.84H52Zm39.29,0H73.44L68.15,35.39H64.23V46H57V16H68.81q5.32,0,8.34,2.37a8,8,0,0,1,3,6.69,9.68,9.68,0,0,1-1.27,5.18,8.9,8.9,0,0,1-4,3.34l6.26,12.11Z%27 fill=%27%23fff%27/%3E%3C/svg%3E"},"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%20100%20100%22%20enable-background%3D%22new%200%200%20100%20100%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpath%20fill%3D%22%23000000%22%20d%3D%22M55.209%2C50l17.803-17.803c1.416-1.416%2C1.416-3.713%2C0-5.129c-1.416-1.417-3.713-1.417-5.129%2C0L50.08%2C44.872%20%20L32.278%2C27.069c-1.416-1.417-3.714-1.417-5.129%2C0c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129L44.951%2C50L27.149%2C67.803%20%20c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129c0.708%2C0.708%2C1.636%2C1.062%2C2.564%2C1.062c0.928%2C0%2C1.856-0.354%2C2.564-1.062L50.08%2C55.13l17.803%2C17.802%20%20c0.708%2C0.708%2C1.637%2C1.062%2C2.564%2C1.062s1.856-0.354%2C2.564-1.062c1.416-1.416%2C1.416-3.713%2C0-5.129L55.209%2C50z%22%3E%3C/path%3E%3C/svg%3E":l=>{l.exports="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%20100%20100%22%20enable-background%3D%22new%200%200%20100%20100%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpath%20fill%3D%22%23000000%22%20d%3D%22M55.209%2C50l17.803-17.803c1.416-1.416%2C1.416-3.713%2C0-5.129c-1.416-1.417-3.713-1.417-5.129%2C0L50.08%2C44.872%20%20L32.278%2C27.069c-1.416-1.417-3.714-1.417-5.129%2C0c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129L44.951%2C50L27.149%2C67.803%20%20c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129c0.708%2C0.708%2C1.636%2C1.062%2C2.564%2C1.062c0.928%2C0%2C1.856-0.354%2C2.564-1.062L50.08%2C55.13l17.803%2C17.802%20%20c0.708%2C0.708%2C1.637%2C1.062%2C2.564%2C1.062s1.856-0.354%2C2.564-1.062c1.416-1.416%2C1.416-3.713%2C0-5.129L55.209%2C50z%22%3E%3C/path%3E%3C/svg%3E"},"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%2090%2090%22%20enable-background%3D%22new%200%200%2090%2090%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpolygon%20points%3D%220%2C0%200%2C0%200%2C0%20%22%3E%3C/polygon%3E%3Cg%3E%3Cpath%20d%3D%22M71.545%2C48.145h-31.98V20.743c0-2.627-2.138-4.765-4.765-4.765H18.456c-2.628%2C0-4.767%2C2.138-4.767%2C4.765v42.789%20%20%20c0%2C2.628%2C2.138%2C4.766%2C4.767%2C4.766h5.535v0.959c0%2C2.628%2C2.138%2C4.765%2C4.766%2C4.765h42.788c2.628%2C0%2C4.766-2.137%2C4.766-4.765V52.914%20%20%20C76.311%2C50.284%2C74.173%2C48.145%2C71.545%2C48.145z%20M18.455%2C16.935h16.344c2.1%2C0%2C3.808%2C1.708%2C3.808%2C3.808v27.401H37.25V22.636%20%20%20c0-0.264-0.215-0.478-0.479-0.478H16.482c-0.264%2C0-0.479%2C0.214-0.479%2C0.478v36.585c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h7.507v7.644%20%20%20h-5.534c-2.101%2C0-3.81-1.709-3.81-3.81V20.743C14.645%2C18.643%2C16.354%2C16.935%2C18.455%2C16.935z%20M16.96%2C23.116h19.331v25.031h-7.535%20%20%20c-2.628%2C0-4.766%2C2.139-4.766%2C4.768v5.828h-7.03V23.116z%20M71.545%2C73.064H28.757c-2.101%2C0-3.81-1.708-3.81-3.808V52.914%20%20%20c0-2.102%2C1.709-3.812%2C3.81-3.812h42.788c2.1%2C0%2C3.809%2C1.71%2C3.809%2C3.812v16.343C75.354%2C71.356%2C73.645%2C73.064%2C71.545%2C73.064z%22%3E%3C/path%3E%3Cpath%20d%3D%22M28.919%2C58.424c-1.466%2C0-2.659%2C1.193-2.659%2C2.66c0%2C1.466%2C1.193%2C2.658%2C2.659%2C2.658c1.468%2C0%2C2.662-1.192%2C2.662-2.658%20%20%20C31.581%2C59.617%2C30.387%2C58.424%2C28.919%2C58.424z%20M28.919%2C62.786c-0.939%2C0-1.703-0.764-1.703-1.702c0-0.939%2C0.764-1.704%2C1.703-1.704%20%20%20c0.94%2C0%2C1.705%2C0.765%2C1.705%2C1.704C30.623%2C62.022%2C29.858%2C62.786%2C28.919%2C62.786z%22%3E%3C/path%3E%3Cpath%20d%3D%22M69.654%2C50.461H33.069c-0.264%2C0-0.479%2C0.215-0.479%2C0.479v20.288c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h36.585%20%20%20c0.263%2C0%2C0.477-0.214%2C0.477-0.478V50.939C70.131%2C50.676%2C69.917%2C50.461%2C69.654%2C50.461z%20M69.174%2C51.417V70.75H33.548V51.417H69.174z%22%3E%3C/path%3E%3Cpath%20d%3D%22M45.201%2C30.296c6.651%2C0%2C12.233%2C5.351%2C12.551%2C11.977l-3.033-2.638c-0.193-0.165-0.507-0.142-0.675%2C0.048%20%20%20c-0.174%2C0.198-0.153%2C0.501%2C0.045%2C0.676l3.883%2C3.375c0.09%2C0.075%2C0.198%2C0.115%2C0.312%2C0.115c0.141%2C0%2C0.273-0.061%2C0.362-0.166%20%20%20l3.371-3.877c0.173-0.2%2C0.151-0.502-0.047-0.675c-0.194-0.166-0.508-0.144-0.676%2C0.048l-2.592%2C2.979%20%20%20c-0.18-3.417-1.629-6.605-4.099-9.001c-2.538-2.461-5.877-3.817-9.404-3.817c-0.264%2C0-0.479%2C0.215-0.479%2C0.479%20%20%20C44.72%2C30.083%2C44.936%2C30.296%2C45.201%2C30.296z%22%3E%3C/path%3E%3C/g%3E%3C/svg%3E":l=>{l.exports="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%2090%2090%22%20enable-background%3D%22new%200%200%2090%2090%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpolygon%20points%3D%220%2C0%200%2C0%200%2C0%20%22%3E%3C/polygon%3E%3Cg%3E%3Cpath%20d%3D%22M71.545%2C48.145h-31.98V20.743c0-2.627-2.138-4.765-4.765-4.765H18.456c-2.628%2C0-4.767%2C2.138-4.767%2C4.765v42.789%20%20%20c0%2C2.628%2C2.138%2C4.766%2C4.767%2C4.766h5.535v0.959c0%2C2.628%2C2.138%2C4.765%2C4.766%2C4.765h42.788c2.628%2C0%2C4.766-2.137%2C4.766-4.765V52.914%20%20%20C76.311%2C50.284%2C74.173%2C48.145%2C71.545%2C48.145z%20M18.455%2C16.935h16.344c2.1%2C0%2C3.808%2C1.708%2C3.808%2C3.808v27.401H37.25V22.636%20%20%20c0-0.264-0.215-0.478-0.479-0.478H16.482c-0.264%2C0-0.479%2C0.214-0.479%2C0.478v36.585c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h7.507v7.644%20%20%20h-5.534c-2.101%2C0-3.81-1.709-3.81-3.81V20.743C14.645%2C18.643%2C16.354%2C16.935%2C18.455%2C16.935z%20M16.96%2C23.116h19.331v25.031h-7.535%20%20%20c-2.628%2C0-4.766%2C2.139-4.766%2C4.768v5.828h-7.03V23.116z%20M71.545%2C73.064H28.757c-2.101%2C0-3.81-1.708-3.81-3.808V52.914%20%20%20c0-2.102%2C1.709-3.812%2C3.81-3.812h42.788c2.1%2C0%2C3.809%2C1.71%2C3.809%2C3.812v16.343C75.354%2C71.356%2C73.645%2C73.064%2C71.545%2C73.064z%22%3E%3C/path%3E%3Cpath%20d%3D%22M28.919%2C58.424c-1.466%2C0-2.659%2C1.193-2.659%2C2.66c0%2C1.466%2C1.193%2C2.658%2C2.659%2C2.658c1.468%2C0%2C2.662-1.192%2C2.662-2.658%20%20%20C31.581%2C59.617%2C30.387%2C58.424%2C28.919%2C58.424z%20M28.919%2C62.786c-0.939%2C0-1.703-0.764-1.703-1.702c0-0.939%2C0.764-1.704%2C1.703-1.704%20%20%20c0.94%2C0%2C1.705%2C0.765%2C1.705%2C1.704C30.623%2C62.022%2C29.858%2C62.786%2C28.919%2C62.786z%22%3E%3C/path%3E%3Cpath%20d%3D%22M69.654%2C50.461H33.069c-0.264%2C0-0.479%2C0.215-0.479%2C0.479v20.288c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h36.585%20%20%20c0.263%2C0%2C0.477-0.214%2C0.477-0.478V50.939C70.131%2C50.676%2C69.917%2C50.461%2C69.654%2C50.461z%20M69.174%2C51.417V70.75H33.548V51.417H69.174z%22%3E%3C/path%3E%3Cpath%20d%3D%22M45.201%2C30.296c6.651%2C0%2C12.233%2C5.351%2C12.551%2C11.977l-3.033-2.638c-0.193-0.165-0.507-0.142-0.675%2C0.048%20%20%20c-0.174%2C0.198-0.153%2C0.501%2C0.045%2C0.676l3.883%2C3.375c0.09%2C0.075%2C0.198%2C0.115%2C0.312%2C0.115c0.141%2C0%2C0.273-0.061%2C0.362-0.166%20%20%20l3.371-3.877c0.173-0.2%2C0.151-0.502-0.047-0.675c-0.194-0.166-0.508-0.144-0.676%2C0.048l-2.592%2C2.979%20%20%20c-0.18-3.417-1.629-6.605-4.099-9.001c-2.538-2.461-5.877-3.817-9.404-3.817c-0.264%2C0-0.479%2C0.215-0.479%2C0.479%20%20%20C44.72%2C30.083%2C44.936%2C30.296%2C45.201%2C30.296z%22%3E%3C/path%3E%3C/g%3E%3C/svg%3E"},"./node_modules/three/build/three.module.js":(l,u,c)=>{c.r(u),c.d(u,{ACESFilmicToneMapping:()=>vt,AddEquation:()=>V,AddOperation:()=>At,AdditiveAnimationBlendMode:()=>Nr,AdditiveBlending:()=>D,AgXToneMapping:()=>be,AlphaFormat:()=>Be,AlwaysCompare:()=>hE,AlwaysDepth:()=>$e,AlwaysStencilFunc:()=>rv,AmbientLight:()=>kV,AnimationAction:()=>$V,AnimationClip:()=>Ov,AnimationLoader:()=>gMe,AnimationMixer:()=>WMe,AnimationObjectGroup:()=>GMe,AnimationUtils:()=>dMe,ArcCurve:()=>$9,ArrayCamera:()=>KB,ArrowHelper:()=>p3e,AttachedBindMode:()=>Se,Audio:()=>KV,AudioAnalyser:()=>DMe,AudioContext:()=>IL,AudioListener:()=>IMe,AudioLoader:()=>TMe,AxesHelper:()=>f3e,BackSide:()=>R,BasicDepthPacking:()=>tu,BasicShadowMap:()=>v,BatchedMesh:()=>H9,Bone:()=>iL,BooleanKeyframeTrack:()=>Cf,Box2:()=>$Me,Box3:()=>Ds,Box3Helper:()=>h3e,BoxGeometry:()=>pf,BoxHelper:()=>u3e,BufferAttribute:()=>ss,BufferGeometry:()=>dn,BufferGeometryLoader:()=>VV,ByteType:()=>Ls,Cache:()=>Th,Camera:()=>NE,CameraHelper:()=>c3e,CanvasTexture:()=>OTe,CapsuleGeometry:()=>cw,CatmullRomCurve3:()=>eV,CineonToneMapping:()=>xi,CircleGeometry:()=>uw,ClampToEdgeWrapping:()=>Ve,Clock:()=>qV,Color:()=>or,ColorKeyframeTrack:()=>wL,ColorManagement:()=>Yn,CompressedArrayTexture:()=>NTe,CompressedCubeTexture:()=>PTe,CompressedTexture:()=>sw,CompressedTextureLoader:()=>AMe,ConeGeometry:()=>hw,ConstantAlphaFactor:()=>Qt,ConstantColorFactor:()=>dt,CubeCamera:()=>Qj,CubeReflectionMapping:()=>U,CubeRefractionMapping:()=>$,CubeTexture:()=>fv,CubeTextureLoader:()=>yMe,CubeUVReflectionMapping:()=>ce,CubicBezierCurve:()=>dL,CubicBezierCurve3:()=>iV,CubicInterpolant:()=>SV,CullFaceBack:()=>m,CullFaceFront:()=>y,CullFaceFrontBack:()=>b,CullFaceNone:()=>g,Curve:()=>Dc,CurvePath:()=>nV,CustomBlending:()=>q,CustomToneMapping:()=>ge,CylinderGeometry:()=>C0,Cylindrical:()=>ZMe,Data3DTexture:()=>Yr,DataArrayTexture:()=>Zg,DataTexture:()=>jd,DataTextureLoader:()=>vMe,DataUtils:()=>cwe,DecrementStencilOp:()=>jI,DecrementWrapStencilOp:()=>GI,DefaultLoadingManager:()=>RV,DepthFormat:()=>Ke,DepthStencilFormat:()=>lt,DepthTexture:()=>WB,DetachedBindMode:()=>Fe,DirectionalLight:()=>OV,DirectionalLightHelper:()=>l3e,DiscreteInterpolant:()=>TV,DisplayP3ColorSpace:()=>Xg,DodecahedronGeometry:()=>dw,DoubleSide:()=>B,DstAlphaFactor:()=>me,DstColorFactor:()=>Xe,DynamicCopyUsage:()=>nB,DynamicDrawUsage:()=>ZI,DynamicReadUsage:()=>tB,EdgesGeometry:()=>sV,EllipseCurve:()=>aw,EqualCompare:()=>oE,EqualDepth:()=>Si,EqualStencilFunc:()=>qI,EquirectangularReflectionMapping:()=>re,EquirectangularRefractionMapping:()=>Me,Euler:()=>Tl,EventDispatcher:()=>Mo,ExtrudeGeometry:()=>vw,FileLoader:()=>Rh,Float16BufferAttribute:()=>mwe,Float32BufferAttribute:()=>vr,FloatType:()=>Rt,Fog:()=>VE,FogExp2:()=>jE,FramebufferTexture:()=>DTe,FrontSide:()=>C,Frustum:()=>mv,GLBufferAttribute:()=>YMe,GLSL1:()=>aB,GLSL3:()=>sv,GreaterCompare:()=>lE,GreaterDepth:()=>Zi,GreaterEqualCompare:()=>uE,GreaterEqualDepth:()=>Ei,GreaterEqualStencilFunc:()=>JI,GreaterStencilFunc:()=>YI,GridHelper:()=>a3e,Group:()=>yf,HalfFloatType:()=>Kt,HemisphereLight:()=>IV,HemisphereLightHelper:()=>s3e,IcosahedronGeometry:()=>bw,ImageBitmapLoader:()=>SMe,ImageLoader:()=>kv,ImageUtils:()=>Nd,IncrementStencilOp:()=>zI,IncrementWrapStencilOp:()=>VI,InstancedBufferAttribute:()=>_0,InstancedBufferGeometry:()=>jV,InstancedInterleavedBuffer:()=>XMe,InstancedMesh:()=>j9,Int16BufferAttribute:()=>pwe,Int32BufferAttribute:()=>fwe,Int8BufferAttribute:()=>uwe,IntType:()=>pe,InterleavedBuffer:()=>GE,InterleavedBufferAttribute:()=>bf,Interpolant:()=>Dv,InterpolateDiscrete:()=>wr,InterpolateLinear:()=>Tr,InterpolateSmooth:()=>Fr,InvertStencilOp:()=>HI,KeepStencilOp:()=>yh,KeyframeTrack:()=>Nc,LOD:()=>B9,LatheGeometry:()=>Tv,Layers:()=>_E,LessCompare:()=>aE,LessDepth:()=>Fi,LessEqualCompare:()=>nv,LessEqualDepth:()=>ui,LessEqualStencilFunc:()=>XI,LessStencilFunc:()=>QI,Light:()=>Wd,LightProbe:()=>zV,Line:()=>Gd,Line3:()=>e3e,LineBasicMaterial:()=>Do,LineCurve:()=>pL,LineCurve3:()=>rV,LineDashedMaterial:()=>EV,LineLoop:()=>Y9,LineSegments:()=>au,LinearDisplayP3ColorSpace:()=>nf,LinearFilter:()=>ki,LinearInterpolant:()=>EL,LinearMipMapLinearFilter:()=>vs,LinearMipMapNearestFilter:()=>kr,LinearMipmapLinearFilter:()=>rn,LinearMipmapNearestFilter:()=>mn,LinearSRGBColorSpace:()=>Rc,LinearToneMapping:()=>Zt,LinearTransfer:()=>sf,Loader:()=>tl,LoaderUtils:()=>RL,LoadingManager:()=>CL,LoopOnce:()=>dr,LoopPingPong:()=>Wi,LoopRepeat:()=>pr,LuminanceAlphaFormat:()=>Ue,LuminanceFormat:()=>Le,MOUSE:()=>p,Material:()=>co,MaterialLoader:()=>Tw,MathUtils:()=>EB,Matrix3:()=>Xr,Matrix4:()=>fr,MaxEquation:()=>G,Mesh:()=>ua,MeshBasicMaterial:()=>Fd,MeshDepthMaterial:()=>XB,MeshDistanceMaterial:()=>YB,MeshLambertMaterial:()=>xV,MeshMatcapMaterial:()=>_V,MeshNormalMaterial:()=>bV,MeshPhongMaterial:()=>yV,MeshPhysicalMaterial:()=>AV,MeshStandardMaterial:()=>bL,MeshToonMaterial:()=>vV,MinEquation:()=>W,MirroredRepeatWrapping:()=>pt,MixOperation:()=>Ce,MultiplyBlending:()=>k,MultiplyOperation:()=>We,NearestFilter:()=>Dt,NearestMipMapLinearFilter:()=>xr,NearestMipMapNearestFilter:()=>Vt,NearestMipmapLinearFilter:()=>fi,NearestMipmapNearestFilter:()=>xt,NeutralToneMapping:()=>Ne,NeverCompare:()=>sE,NeverDepth:()=>bi,NeverStencilFunc:()=>WI,NoBlending:()=>I,NoColorSpace:()=>Wa,NoToneMapping:()=>Ot,NormalAnimationBlendMode:()=>us,NormalBlending:()=>N,NotEqualCompare:()=>cE,NotEqualDepth:()=>Vi,NotEqualStencilFunc:()=>KI,NumberKeyframeTrack:()=>Nv,Object3D:()=>Gn,ObjectLoader:()=>wMe,ObjectSpaceNormalMap:()=>ru,OctahedronGeometry:()=>Bv,OneFactor:()=>te,OneMinusConstantAlphaFactor:()=>yt,OneMinusConstantColorFactor:()=>St,OneMinusDstAlphaFactor:()=>Oe,OneMinusDstColorFactor:()=>Je,OneMinusSrcAlphaFactor:()=>Ae,OneMinusSrcColorFactor:()=>se,OrthographicCamera:()=>kE,P3Primaries:()=>of,PCFShadowMap:()=>_,PCFSoftShadowMap:()=>T,PMREMGenerator:()=>GB,Path:()=>Sv,PerspectiveCamera:()=>va,Plane:()=>zd,PlaneGeometry:()=>f0,PlaneHelper:()=>d3e,PointLight:()=>PV,PointLightHelper:()=>r3e,Points:()=>J9,PointsMaterial:()=>aL,PolarGridHelper:()=>o3e,PolyhedronGeometry:()=>Hd,PositionalAudio:()=>LMe,PropertyBinding:()=>Un,PropertyMixer:()=>ZV,QuadraticBezierCurve:()=>fL,QuadraticBezierCurve3:()=>mL,Quaternion:()=>Vn,QuaternionKeyframeTrack:()=>T0,QuaternionLinearInterpolant:()=>MV,RED_GREEN_RGTC2_Format:()=>Li,RED_RGTC1_Format:()=>Ai,REVISION:()=>h,RGBADepthPacking:()=>iu,RGBAFormat:()=>fe,RGBAIntegerFormat:()=>ri,RGBA_ASTC_10x10_Format:()=>xe,RGBA_ASTC_10x5_Format:()=>he,RGBA_ASTC_10x6_Format:()=>le,RGBA_ASTC_10x8_Format:()=>de,RGBA_ASTC_12x10_Format:()=>Ee,RGBA_ASTC_12x12_Format:()=>ot,RGBA_ASTC_4x4_Format:()=>qr,RGBA_ASTC_5x4_Format:()=>X,RGBA_ASTC_5x5_Format:()=>ue,RGBA_ASTC_6x5_Format:()=>ye,RGBA_ASTC_6x6_Format:()=>Te,RGBA_ASTC_8x5_Format:()=>Qe,RGBA_ASTC_8x6_Format:()=>Ye,RGBA_ASTC_8x8_Format:()=>mt,RGBA_BPTC_Format:()=>Mt,RGBA_ETC2_EAC_Format:()=>hn,RGBA_PVRTC_2BPPV1_Format:()=>Xn,RGBA_PVRTC_4BPPV1_Format:()=>Mn,RGBA_S3TC_DXT1_Format:()=>Ui,RGBA_S3TC_DXT3_Format:()=>Sr,RGBA_S3TC_DXT5_Format:()=>ur,RGBFormat:()=>ae,RGB_BPTC_SIGNED_Format:()=>Wt,RGB_BPTC_UNSIGNED_Format:()=>ni,RGB_ETC1_Format:()=>Ii,RGB_ETC2_Format:()=>ar,RGB_PVRTC_2BPPV1_Format:()=>_i,RGB_PVRTC_4BPPV1_Format:()=>$i,RGB_S3TC_DXT1_Format:()=>wi,RGFormat:()=>$t,RGIntegerFormat:()=>Bt,RawShaderMaterial:()=>gV,Ray:()=>ya,Raycaster:()=>KMe,Rec709Primaries:()=>af,RectAreaLight:()=>FV,RedFormat:()=>Tt,RedIntegerFormat:()=>Yt,ReinhardToneMapping:()=>jt,RenderTarget:()=>Jg,RepeatWrapping:()=>ze,ReplaceStencilOp:()=>UI,ReverseSubtractEquation:()=>Q,RingGeometry:()=>xw,SIGNED_RED_GREEN_RGTC2_Format:()=>yr,SIGNED_RED_RGTC1_Format:()=>qt,SRGBColorSpace:()=>Nn,SRGBTransfer:()=>ls,Scene:()=>C9,ShaderChunk:()=>an,ShaderLib:()=>Lc,ShaderMaterial:()=>Bc,ShadowMaterial:()=>mV,Shape:()=>_f,ShapeGeometry:()=>_w,ShapePath:()=>m3e,ShapeUtils:()=>ou,ShortType:()=>es,Skeleton:()=>YE,SkeletonHelper:()=>i3e,SkinnedMesh:()=>k9,Source:()=>xs,Sphere:()=>Aa,SphereGeometry:()=>Lv,Spherical:()=>JMe,SphericalHarmonics3:()=>UV,SplineCurve:()=>gL,SpotLight:()=>DV,SpotLightHelper:()=>t3e,Sprite:()=>R9,SpriteMaterial:()=>ZB,SrcAlphaFactor:()=>ve,SrcAlphaSaturateFactor:()=>it,SrcColorFactor:()=>Y,StaticCopyUsage:()=>rB,StaticDrawUsage:()=>lf,StaticReadUsage:()=>eB,StereoCamera:()=>MMe,StreamCopyUsage:()=>sB,StreamDrawUsage:()=>$I,StreamReadUsage:()=>iB,StringKeyframeTrack:()=>Sf,SubtractEquation:()=>j,SubtractiveBlending:()=>P,TOUCH:()=>f,TangentSpaceNormalMap:()=>ao,TetrahedronGeometry:()=>Ew,Texture:()=>hs,TextureLoader:()=>bMe,TorusGeometry:()=>ww,TorusKnotGeometry:()=>Cw,Triangle:()=>Ml,TriangleFanDrawMode:()=>Mc,TriangleStripDrawMode:()=>Ko,TrianglesDrawMode:()=>El,TubeGeometry:()=>Sw,UVMapping:()=>Ie,Uint16BufferAttribute:()=>LB,Uint32BufferAttribute:()=>DB,Uint8BufferAttribute:()=>hwe,Uint8ClampedBufferAttribute:()=>dwe,Uniform:()=>DL,UniformsGroup:()=>qMe,UniformsLib:()=>Qi,UniformsUtils:()=>Gj,UnsignedByteType:()=>gn,UnsignedInt248Type:()=>Di,UnsignedInt5999Type:()=>Oi,UnsignedIntType:()=>ct,UnsignedShort4444Type:()=>Bi,UnsignedShort5551Type:()=>sr,UnsignedShortType:()=>bs,VSMShadowMap:()=>E,Vector2:()=>ai,Vector3:()=>He,Vector4:()=>Fn,VectorKeyframeTrack:()=>Pv,VideoTexture:()=>LTe,WebGL3DRenderTarget:()=>In,WebGLArrayRenderTarget:()=>hr,WebGLCoordinateSystem:()=>Gl,WebGLCubeRenderTarget:()=>qj,WebGLMultipleRenderTargets:()=>g3e,WebGLRenderTarget:()=>Jo,WebGLRenderer:()=>ETe,WebGLUtils:()=>b9,WebGPUCoordinateSystem:()=>cf,WireframeGeometry:()=>dV,WrapAroundEnding:()=>jr,ZeroCurvatureEnding:()=>Vr,ZeroFactor:()=>z,ZeroSlopeEnding:()=>bn,ZeroStencilOp:()=>FI,createCanvasElement:()=>fE});/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const h="164",p={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},f={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},g=0,m=1,y=2,b=3,v=0,_=1,T=2,E=3,C=0,R=1,B=2,I=0,N=1,D=2,P=3,k=4,q=5,V=100,j=101,Q=102,W=103,G=104,z=200,te=201,Y=202,se=203,ve=204,Ae=205,me=206,Oe=207,Xe=208,Je=209,it=210,dt=211,St=212,Qt=213,yt=214,bi=0,$e=1,Fi=2,ui=3,Si=4,Ei=5,Zi=6,Vi=7,We=0,Ce=1,At=2,Ot=0,Zt=1,jt=2,xi=3,vt=4,ge=5,be=6,Ne=7,Se="attached",Fe="detached",Ie=300,U=301,$=302,re=303,Me=304,ce=306,ze=1e3,Ve=1001,pt=1002,Dt=1003,xt=1004,Vt=1004,fi=1005,xr=1005,ki=1006,mn=1007,kr=1007,rn=1008,vs=1008,gn=1009,Ls=1010,es=1011,bs=1012,pe=1013,ct=1014,Rt=1015,Kt=1016,Bi=1017,sr=1018,Di=1020,Oi=35902,Be=1021,ae=1022,fe=1023,Le=1024,Ue=1025,Ke=1026,lt=1027,Tt=1028,Yt=1029,$t=1030,Bt=1031,ri=1033,wi=33776,Ui=33777,Sr=33778,ur=33779,$i=35840,_i=35841,Mn=35842,Xn=35843,Ii=36196,ar=37492,hn=37496,qr=37808,X=37809,ue=37810,ye=37811,Te=37812,Qe=37813,Ye=37814,mt=37815,he=37816,le=37817,de=37818,xe=37819,Ee=37820,ot=37821,Mt=36492,Wt=36494,ni=36495,Ai=36283,qt=36284,Li=36285,yr=36286,dr=2200,pr=2201,Wi=2202,wr=2300,Tr=2301,Fr=2302,Vr=2400,bn=2401,jr=2402,us=2500,Nr=2501,El=0,Ko=1,Mc=2,tu=3200,iu=3201,ao=0,ru=1,Wa="",Nn="srgb",Rc="srgb-linear",Xg="display-p3",nf="display-p3-linear",sf="linear",ls="srgb",af="rec709",of="p3",FI=0,yh=7680,UI=7681,zI=7682,jI=7683,VI=34055,GI=34056,HI=5386,WI=512,QI=513,qI=514,XI=515,YI=516,KI=517,JI=518,rv=519,sE=512,aE=513,oE=514,nv=515,lE=516,cE=517,uE=518,hE=519,lf=35044,ZI=35048,$I=35040,eB=35045,tB=35049,iB=35041,rB=35046,nB=35050,sB=35042,aB="100",sv="300 es",Gl=2e3,cf=2001;class Mo{addEventListener(a,d){this._listeners===void 0&&(this._listeners={});const A=this._listeners;A[a]===void 0&&(A[a]=[]),A[a].indexOf(d)===-1&&A[a].push(d)}hasEventListener(a,d){if(this._listeners===void 0)return!1;const A=this._listeners;return A[a]!==void 0&&A[a].indexOf(d)!==-1}removeEventListener(a,d){if(this._listeners===void 0)return;const A=this._listeners[a];if(A!==void 0){const x=A.indexOf(d);x!==-1&&A.splice(x,1)}}dispatchEvent(a){if(this._listeners===void 0)return;const d=this._listeners[a.type];if(d!==void 0){a.target=this;const A=d.slice(0);for(let x=0,w=A.length;x<w;x++)A[x].call(this,a);a.target=null}}}const Ba=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let dE=1234567;const vh=Math.PI/180,Bd=180/Math.PI;function Ro(){const S=Math.random()*4294967295|0,a=Math.random()*4294967295|0,d=Math.random()*4294967295|0,A=Math.random()*4294967295|0;return(Ba[S&255]+Ba[S>>8&255]+Ba[S>>16&255]+Ba[S>>24&255]+"-"+Ba[a&255]+Ba[a>>8&255]+"-"+Ba[a>>16&15|64]+Ba[a>>24&255]+"-"+Ba[d&63|128]+Ba[d>>8&255]+"-"+Ba[d>>16&255]+Ba[d>>24&255]+Ba[A&255]+Ba[A>>8&255]+Ba[A>>16&255]+Ba[A>>24&255]).toLowerCase()}function Ts(S,a,d){return Math.max(a,Math.min(d,S))}function av(S,a){return(S%a+a)%a}function oB(S,a,d,A,x){return A+(S-a)*(x-A)/(d-a)}function lB(S,a,d){return S!==a?(d-S)/(a-S):0}function uf(S,a,d){return(1-d)*S+d*a}function cB(S,a,d,A){return uf(S,a,1-Math.exp(-d*A))}function uB(S,a=1){return a-Math.abs(av(S,a*2)-a)}function hB(S,a,d){return S<=a?0:S>=d?1:(S=(S-a)/(d-a),S*S*(3-2*S))}function dB(S,a,d){return S<=a?0:S>=d?1:(S=(S-a)/(d-a),S*S*S*(S*(S*6-15)+10))}function pB(S,a){return S+Math.floor(Math.random()*(a-S+1))}function fB(S,a){return S+Math.random()*(a-S)}function mB(S){return S*(.5-Math.random())}function gB(S){S!==void 0&&(dE=S);let a=dE+=1831565813;return a=Math.imul(a^a>>>15,a|1),a^=a+Math.imul(a^a>>>7,a|61),((a^a>>>14)>>>0)/4294967296}function AB(S){return S*vh}function yB(S){return S*Bd}function vB(S){return(S&S-1)===0&&S!==0}function bB(S){return Math.pow(2,Math.ceil(Math.log(S)/Math.LN2))}function xB(S){return Math.pow(2,Math.floor(Math.log(S)/Math.LN2))}function _B(S,a,d,A,x){const w=Math.cos,M=Math.sin,L=w(d/2),O=M(d/2),F=w((a+A)/2),H=M((a+A)/2),J=w((a-A)/2),K=M((a-A)/2),Z=w((A-a)/2),ie=M((A-a)/2);switch(x){case"XYX":S.set(L*H,O*J,O*K,L*F);break;case"YZY":S.set(O*K,L*H,O*J,L*F);break;case"ZXZ":S.set(O*J,O*K,L*H,L*F);break;case"XZX":S.set(L*H,O*ie,O*Z,L*F);break;case"YXY":S.set(O*Z,L*H,O*ie,L*F);break;case"ZYZ":S.set(O*ie,O*Z,L*H,L*F);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+x)}}function Qa(S,a){switch(a.constructor){case Float32Array:return S;case Uint32Array:return S/4294967295;case Uint16Array:return S/65535;case Uint8Array:return S/255;case Int32Array:return Math.max(S/2147483647,-1);case Int16Array:return Math.max(S/32767,-1);case Int8Array:return Math.max(S/127,-1);default:throw new Error("Invalid component type.")}}function Kr(S,a){switch(a.constructor){case Float32Array:return S;case Uint32Array:return Math.round(S*4294967295);case Uint16Array:return Math.round(S*65535);case Uint8Array:return Math.round(S*255);case Int32Array:return Math.round(S*2147483647);case Int16Array:return Math.round(S*32767);case Int8Array:return Math.round(S*127);default:throw new Error("Invalid component type.")}}const EB={DEG2RAD:vh,RAD2DEG:Bd,generateUUID:Ro,clamp:Ts,euclideanModulo:av,mapLinear:oB,inverseLerp:lB,lerp:uf,damp:cB,pingpong:uB,smoothstep:hB,smootherstep:dB,randInt:pB,randFloat:fB,randFloatSpread:mB,seededRandom:gB,degToRad:AB,radToDeg:yB,isPowerOfTwo:vB,ceilPowerOfTwo:bB,floorPowerOfTwo:xB,setQuaternionFromProperEuler:_B,normalize:Kr,denormalize:Qa};class ai{constructor(a=0,d=0){ai.prototype.isVector2=!0,this.x=a,this.y=d}get width(){return this.x}set width(a){this.x=a}get height(){return this.y}set height(a){this.y=a}set(a,d){return this.x=a,this.y=d,this}setScalar(a){return this.x=a,this.y=a,this}setX(a){return this.x=a,this}setY(a){return this.y=a,this}setComponent(a,d){switch(a){case 0:this.x=d;break;case 1:this.y=d;break;default:throw new Error("index is out of range: "+a)}return this}getComponent(a){switch(a){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+a)}}clone(){return new this.constructor(this.x,this.y)}copy(a){return this.x=a.x,this.y=a.y,this}add(a){return this.x+=a.x,this.y+=a.y,this}addScalar(a){return this.x+=a,this.y+=a,this}addVectors(a,d){return this.x=a.x+d.x,this.y=a.y+d.y,this}addScaledVector(a,d){return this.x+=a.x*d,this.y+=a.y*d,this}sub(a){return this.x-=a.x,this.y-=a.y,this}subScalar(a){return this.x-=a,this.y-=a,this}subVectors(a,d){return this.x=a.x-d.x,this.y=a.y-d.y,this}multiply(a){return this.x*=a.x,this.y*=a.y,this}multiplyScalar(a){return this.x*=a,this.y*=a,this}divide(a){return this.x/=a.x,this.y/=a.y,this}divideScalar(a){return this.multiplyScalar(1/a)}applyMatrix3(a){const d=this.x,A=this.y,x=a.elements;return this.x=x[0]*d+x[3]*A+x[6],this.y=x[1]*d+x[4]*A+x[7],this}min(a){return this.x=Math.min(this.x,a.x),this.y=Math.min(this.y,a.y),this}max(a){return this.x=Math.max(this.x,a.x),this.y=Math.max(this.y,a.y),this}clamp(a,d){return this.x=Math.max(a.x,Math.min(d.x,this.x)),this.y=Math.max(a.y,Math.min(d.y,this.y)),this}clampScalar(a,d){return this.x=Math.max(a,Math.min(d,this.x)),this.y=Math.max(a,Math.min(d,this.y)),this}clampLength(a,d){const A=this.length();return this.divideScalar(A||1).multiplyScalar(Math.max(a,Math.min(d,A)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(a){return this.x*a.x+this.y*a.y}cross(a){return this.x*a.y-this.y*a.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(a){const d=Math.sqrt(this.lengthSq()*a.lengthSq());if(d===0)return Math.PI/2;const A=this.dot(a)/d;return Math.acos(Ts(A,-1,1))}distanceTo(a){return Math.sqrt(this.distanceToSquared(a))}distanceToSquared(a){const d=this.x-a.x,A=this.y-a.y;return d*d+A*A}manhattanDistanceTo(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)}setLength(a){return this.normalize().multiplyScalar(a)}lerp(a,d){return this.x+=(a.x-this.x)*d,this.y+=(a.y-this.y)*d,this}lerpVectors(a,d,A){return this.x=a.x+(d.x-a.x)*A,this.y=a.y+(d.y-a.y)*A,this}equals(a){return a.x===this.x&&a.y===this.y}fromArray(a,d=0){return this.x=a[d],this.y=a[d+1],this}toArray(a=[],d=0){return a[d]=this.x,a[d+1]=this.y,a}fromBufferAttribute(a,d){return this.x=a.getX(d),this.y=a.getY(d),this}rotateAround(a,d){const A=Math.cos(d),x=Math.sin(d),w=this.x-a.x,M=this.y-a.y;return this.x=w*A-M*x+a.x,this.y=w*x+M*A+a.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Xr{constructor(a,d,A,x,w,M,L,O,F){Xr.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],a!==void 0&&this.set(a,d,A,x,w,M,L,O,F)}set(a,d,A,x,w,M,L,O,F){const H=this.elements;return H[0]=a,H[1]=x,H[2]=L,H[3]=d,H[4]=w,H[5]=O,H[6]=A,H[7]=M,H[8]=F,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(a){const d=this.elements,A=a.elements;return d[0]=A[0],d[1]=A[1],d[2]=A[2],d[3]=A[3],d[4]=A[4],d[5]=A[5],d[6]=A[6],d[7]=A[7],d[8]=A[8],this}extractBasis(a,d,A){return a.setFromMatrix3Column(this,0),d.setFromMatrix3Column(this,1),A.setFromMatrix3Column(this,2),this}setFromMatrix4(a){const d=a.elements;return this.set(d[0],d[4],d[8],d[1],d[5],d[9],d[2],d[6],d[10]),this}multiply(a){return this.multiplyMatrices(this,a)}premultiply(a){return this.multiplyMatrices(a,this)}multiplyMatrices(a,d){const A=a.elements,x=d.elements,w=this.elements,M=A[0],L=A[3],O=A[6],F=A[1],H=A[4],J=A[7],K=A[2],Z=A[5],ie=A[8],oe=x[0],ne=x[3],ee=x[6],Re=x[1],we=x[4],_e=x[7],st=x[2],qe=x[5],Ze=x[8];return w[0]=M*oe+L*Re+O*st,w[3]=M*ne+L*we+O*qe,w[6]=M*ee+L*_e+O*Ze,w[1]=F*oe+H*Re+J*st,w[4]=F*ne+H*we+J*qe,w[7]=F*ee+H*_e+J*Ze,w[2]=K*oe+Z*Re+ie*st,w[5]=K*ne+Z*we+ie*qe,w[8]=K*ee+Z*_e+ie*Ze,this}multiplyScalar(a){const d=this.elements;return d[0]*=a,d[3]*=a,d[6]*=a,d[1]*=a,d[4]*=a,d[7]*=a,d[2]*=a,d[5]*=a,d[8]*=a,this}determinant(){const a=this.elements,d=a[0],A=a[1],x=a[2],w=a[3],M=a[4],L=a[5],O=a[6],F=a[7],H=a[8];return d*M*H-d*L*F-A*w*H+A*L*O+x*w*F-x*M*O}invert(){const a=this.elements,d=a[0],A=a[1],x=a[2],w=a[3],M=a[4],L=a[5],O=a[6],F=a[7],H=a[8],J=H*M-L*F,K=L*O-H*w,Z=F*w-M*O,ie=d*J+A*K+x*Z;if(ie===0)return this.set(0,0,0,0,0,0,0,0,0);const oe=1/ie;return a[0]=J*oe,a[1]=(x*F-H*A)*oe,a[2]=(L*A-x*M)*oe,a[3]=K*oe,a[4]=(H*d-x*O)*oe,a[5]=(x*w-L*d)*oe,a[6]=Z*oe,a[7]=(A*O-F*d)*oe,a[8]=(M*d-A*w)*oe,this}transpose(){let a;const d=this.elements;return a=d[1],d[1]=d[3],d[3]=a,a=d[2],d[2]=d[6],d[6]=a,a=d[5],d[5]=d[7],d[7]=a,this}getNormalMatrix(a){return this.setFromMatrix4(a).invert().transpose()}transposeIntoArray(a){const d=this.elements;return a[0]=d[0],a[1]=d[3],a[2]=d[6],a[3]=d[1],a[4]=d[4],a[5]=d[7],a[6]=d[2],a[7]=d[5],a[8]=d[8],this}setUvTransform(a,d,A,x,w,M,L){const O=Math.cos(w),F=Math.sin(w);return this.set(A*O,A*F,-A*(O*M+F*L)+M+a,-x*F,x*O,-x*(-F*M+O*L)+L+d,0,0,1),this}scale(a,d){return this.premultiply(ov.makeScale(a,d)),this}rotate(a){return this.premultiply(ov.makeRotation(-a)),this}translate(a,d){return this.premultiply(ov.makeTranslation(a,d)),this}makeTranslation(a,d){return a.isVector2?this.set(1,0,a.x,0,1,a.y,0,0,1):this.set(1,0,a,0,1,d,0,0,1),this}makeRotation(a){const d=Math.cos(a),A=Math.sin(a);return this.set(d,-A,0,A,d,0,0,0,1),this}makeScale(a,d){return this.set(a,0,0,0,d,0,0,0,1),this}equals(a){const d=this.elements,A=a.elements;for(let x=0;x<9;x++)if(d[x]!==A[x])return!1;return!0}fromArray(a,d=0){for(let A=0;A<9;A++)this.elements[A]=a[A+d];return this}toArray(a=[],d=0){const A=this.elements;return a[d]=A[0],a[d+1]=A[1],a[d+2]=A[2],a[d+3]=A[3],a[d+4]=A[4],a[d+5]=A[5],a[d+6]=A[6],a[d+7]=A[7],a[d+8]=A[8],a}clone(){return new this.constructor().fromArray(this.elements)}}const ov=new Xr;function pE(S){for(let a=S.length-1;a>=0;--a)if(S[a]>=65535)return!0;return!1}const wB={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Ld(S,a){return new wB[S](a)}function hf(S){return document.createElementNS("http://www.w3.org/1999/xhtml",S)}function fE(){const S=hf("canvas");return S.style.display="block",S}const mE={};function gE(S){S in mE||(mE[S]=!0,console.warn(S))}const AE=new Xr().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),yE=new Xr().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),Yg={[Rc]:{transfer:sf,primaries:af,toReference:S=>S,fromReference:S=>S},[Nn]:{transfer:ls,primaries:af,toReference:S=>S.convertSRGBToLinear(),fromReference:S=>S.convertLinearToSRGB()},[nf]:{transfer:sf,primaries:of,toReference:S=>S.applyMatrix3(yE),fromReference:S=>S.applyMatrix3(AE)},[Xg]:{transfer:ls,primaries:of,toReference:S=>S.convertSRGBToLinear().applyMatrix3(yE),fromReference:S=>S.applyMatrix3(AE).convertLinearToSRGB()}},CB=new Set([Rc,nf]),Yn={enabled:!0,_workingColorSpace:Rc,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(S){if(!CB.has(S))throw new Error(`Unsupported working color space, "${S}".`);this._workingColorSpace=S},convert:function(S,a,d){if(this.enabled===!1||a===d||!a||!d)return S;const A=Yg[a].toReference,x=Yg[d].fromReference;return x(A(S))},fromWorkingColorSpace:function(S,a){return this.convert(S,this._workingColorSpace,a)},toWorkingColorSpace:function(S,a){return this.convert(S,a,this._workingColorSpace)},getPrimaries:function(S){return Yg[S].primaries},getTransfer:function(S){return S===Wa?sf:Yg[S].transfer}};function Dd(S){return S<.04045?S*.0773993808:Math.pow(S*.9478672986+.0521327014,2.4)}function lv(S){return S<.0031308?S*12.92:1.055*Math.pow(S,.41666)-.055}let bh;class Nd{static getDataURL(a){if(/^data:/i.test(a.src)||typeof HTMLCanvasElement>"u")return a.src;let d;if(a instanceof HTMLCanvasElement)d=a;else{bh===void 0&&(bh=hf("canvas")),bh.width=a.width,bh.height=a.height;const A=bh.getContext("2d");a instanceof ImageData?A.putImageData(a,0,0):A.drawImage(a,0,0,a.width,a.height),d=bh}return d.width>2048||d.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",a),d.toDataURL("image/jpeg",.6)):d.toDataURL("image/png")}static sRGBToLinear(a){if(typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&a instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&a instanceof ImageBitmap){const d=hf("canvas");d.width=a.width,d.height=a.height;const A=d.getContext("2d");A.drawImage(a,0,0,a.width,a.height);const x=A.getImageData(0,0,a.width,a.height),w=x.data;for(let M=0;M<w.length;M++)w[M]=Dd(w[M]/255)*255;return A.putImageData(x,0,0),d}else if(a.data){const d=a.data.slice(0);for(let A=0;A<d.length;A++)d instanceof Uint8Array||d instanceof Uint8ClampedArray?d[A]=Math.floor(Dd(d[A]/255)*255):d[A]=Dd(d[A]);return{data:d,width:a.width,height:a.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),a}}let vE=0;class xs{constructor(a=null){this.isSource=!0,Object.defineProperty(this,"id",{value:vE++}),this.uuid=Ro(),this.data=a,this.dataReady=!0,this.version=0}set needsUpdate(a){a===!0&&this.version++}toJSON(a){const d=a===void 0||typeof a=="string";if(!d&&a.images[this.uuid]!==void 0)return a.images[this.uuid];const A={uuid:this.uuid,url:""},x=this.data;if(x!==null){let w;if(Array.isArray(x)){w=[];for(let M=0,L=x.length;M<L;M++)x[M].isDataTexture?w.push(Kg(x[M].image)):w.push(Kg(x[M]))}else w=Kg(x);A.url=w}return d||(a.images[this.uuid]=A),A}}function Kg(S){return typeof HTMLImageElement<"u"&&S instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&S instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&S instanceof ImageBitmap?Nd.getDataURL(S):S.data?{data:Array.from(S.data),width:S.width,height:S.height,type:S.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let bE=0;class hs extends Mo{constructor(a=hs.DEFAULT_IMAGE,d=hs.DEFAULT_MAPPING,A=Ve,x=Ve,w=ki,M=rn,L=fe,O=gn,F=hs.DEFAULT_ANISOTROPY,H=Wa){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:bE++}),this.uuid=Ro(),this.name="",this.source=new xs(a),this.mipmaps=[],this.mapping=d,this.channel=0,this.wrapS=A,this.wrapT=x,this.magFilter=w,this.minFilter=M,this.anisotropy=F,this.format=L,this.internalFormat=null,this.type=O,this.offset=new ai(0,0),this.repeat=new ai(1,1),this.center=new ai(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Xr,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=H,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(a=null){this.source.data=a}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(a){return this.name=a.name,this.source=a.source,this.mipmaps=a.mipmaps.slice(0),this.mapping=a.mapping,this.channel=a.channel,this.wrapS=a.wrapS,this.wrapT=a.wrapT,this.magFilter=a.magFilter,this.minFilter=a.minFilter,this.anisotropy=a.anisotropy,this.format=a.format,this.internalFormat=a.internalFormat,this.type=a.type,this.offset.copy(a.offset),this.repeat.copy(a.repeat),this.center.copy(a.center),this.rotation=a.rotation,this.matrixAutoUpdate=a.matrixAutoUpdate,this.matrix.copy(a.matrix),this.generateMipmaps=a.generateMipmaps,this.premultiplyAlpha=a.premultiplyAlpha,this.flipY=a.flipY,this.unpackAlignment=a.unpackAlignment,this.colorSpace=a.colorSpace,this.userData=JSON.parse(JSON.stringify(a.userData)),this.needsUpdate=!0,this}toJSON(a){const d=a===void 0||typeof a=="string";if(!d&&a.textures[this.uuid]!==void 0)return a.textures[this.uuid];const A={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(a).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(A.userData=this.userData),d||(a.textures[this.uuid]=A),A}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(a){if(this.mapping!==Ie)return a;if(a.applyMatrix3(this.matrix),a.x<0||a.x>1)switch(this.wrapS){case ze:a.x=a.x-Math.floor(a.x);break;case Ve:a.x=a.x<0?0:1;break;case pt:Math.abs(Math.floor(a.x)%2)===1?a.x=Math.ceil(a.x)-a.x:a.x=a.x-Math.floor(a.x);break}if(a.y<0||a.y>1)switch(this.wrapT){case ze:a.y=a.y-Math.floor(a.y);break;case Ve:a.y=a.y<0?0:1;break;case pt:Math.abs(Math.floor(a.y)%2)===1?a.y=Math.ceil(a.y)-a.y:a.y=a.y-Math.floor(a.y);break}return this.flipY&&(a.y=1-a.y),a}set needsUpdate(a){a===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(a){a===!0&&this.pmremVersion++}}hs.DEFAULT_IMAGE=null,hs.DEFAULT_MAPPING=Ie,hs.DEFAULT_ANISOTROPY=1;class Fn{constructor(a=0,d=0,A=0,x=1){Fn.prototype.isVector4=!0,this.x=a,this.y=d,this.z=A,this.w=x}get width(){return this.z}set width(a){this.z=a}get height(){return this.w}set height(a){this.w=a}set(a,d,A,x){return this.x=a,this.y=d,this.z=A,this.w=x,this}setScalar(a){return this.x=a,this.y=a,this.z=a,this.w=a,this}setX(a){return this.x=a,this}setY(a){return this.y=a,this}setZ(a){return this.z=a,this}setW(a){return this.w=a,this}setComponent(a,d){switch(a){case 0:this.x=d;break;case 1:this.y=d;break;case 2:this.z=d;break;case 3:this.w=d;break;default:throw new Error("index is out of range: "+a)}return this}getComponent(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+a)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(a){return this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w!==void 0?a.w:1,this}add(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this.w+=a.w,this}addScalar(a){return this.x+=a,this.y+=a,this.z+=a,this.w+=a,this}addVectors(a,d){return this.x=a.x+d.x,this.y=a.y+d.y,this.z=a.z+d.z,this.w=a.w+d.w,this}addScaledVector(a,d){return this.x+=a.x*d,this.y+=a.y*d,this.z+=a.z*d,this.w+=a.w*d,this}sub(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this.w-=a.w,this}subScalar(a){return this.x-=a,this.y-=a,this.z-=a,this.w-=a,this}subVectors(a,d){return this.x=a.x-d.x,this.y=a.y-d.y,this.z=a.z-d.z,this.w=a.w-d.w,this}multiply(a){return this.x*=a.x,this.y*=a.y,this.z*=a.z,this.w*=a.w,this}multiplyScalar(a){return this.x*=a,this.y*=a,this.z*=a,this.w*=a,this}applyMatrix4(a){const d=this.x,A=this.y,x=this.z,w=this.w,M=a.elements;return this.x=M[0]*d+M[4]*A+M[8]*x+M[12]*w,this.y=M[1]*d+M[5]*A+M[9]*x+M[13]*w,this.z=M[2]*d+M[6]*A+M[10]*x+M[14]*w,this.w=M[3]*d+M[7]*A+M[11]*x+M[15]*w,this}divideScalar(a){return this.multiplyScalar(1/a)}setAxisAngleFromQuaternion(a){this.w=2*Math.acos(a.w);const d=Math.sqrt(1-a.w*a.w);return d<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=a.x/d,this.y=a.y/d,this.z=a.z/d),this}setAxisAngleFromRotationMatrix(a){let d,A,x,w;const M=a.elements,L=M[0],O=M[4],F=M[8],H=M[1],J=M[5],K=M[9],Z=M[2],ie=M[6],oe=M[10];if(Math.abs(O-H)<.01&&Math.abs(F-Z)<.01&&Math.abs(K-ie)<.01){if(Math.abs(O+H)<.1&&Math.abs(F+Z)<.1&&Math.abs(K+ie)<.1&&Math.abs(L+J+oe-3)<.1)return this.set(1,0,0,0),this;d=Math.PI;const ee=(L+1)/2,Re=(J+1)/2,we=(oe+1)/2,_e=(O+H)/4,st=(F+Z)/4,qe=(K+ie)/4;return ee>Re&&ee>we?ee<.01?(A=0,x=.707106781,w=.707106781):(A=Math.sqrt(ee),x=_e/A,w=st/A):Re>we?Re<.01?(A=.707106781,x=0,w=.707106781):(x=Math.sqrt(Re),A=_e/x,w=qe/x):we<.01?(A=.707106781,x=.707106781,w=0):(w=Math.sqrt(we),A=st/w,x=qe/w),this.set(A,x,w,d),this}let ne=Math.sqrt((ie-K)*(ie-K)+(F-Z)*(F-Z)+(H-O)*(H-O));return Math.abs(ne)<.001&&(ne=1),this.x=(ie-K)/ne,this.y=(F-Z)/ne,this.z=(H-O)/ne,this.w=Math.acos((L+J+oe-1)/2),this}min(a){return this.x=Math.min(this.x,a.x),this.y=Math.min(this.y,a.y),this.z=Math.min(this.z,a.z),this.w=Math.min(this.w,a.w),this}max(a){return this.x=Math.max(this.x,a.x),this.y=Math.max(this.y,a.y),this.z=Math.max(this.z,a.z),this.w=Math.max(this.w,a.w),this}clamp(a,d){return this.x=Math.max(a.x,Math.min(d.x,this.x)),this.y=Math.max(a.y,Math.min(d.y,this.y)),this.z=Math.max(a.z,Math.min(d.z,this.z)),this.w=Math.max(a.w,Math.min(d.w,this.w)),this}clampScalar(a,d){return this.x=Math.max(a,Math.min(d,this.x)),this.y=Math.max(a,Math.min(d,this.y)),this.z=Math.max(a,Math.min(d,this.z)),this.w=Math.max(a,Math.min(d,this.w)),this}clampLength(a,d){const A=this.length();return this.divideScalar(A||1).multiplyScalar(Math.max(a,Math.min(d,A)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(a){return this.normalize().multiplyScalar(a)}lerp(a,d){return this.x+=(a.x-this.x)*d,this.y+=(a.y-this.y)*d,this.z+=(a.z-this.z)*d,this.w+=(a.w-this.w)*d,this}lerpVectors(a,d,A){return this.x=a.x+(d.x-a.x)*A,this.y=a.y+(d.y-a.y)*A,this.z=a.z+(d.z-a.z)*A,this.w=a.w+(d.w-a.w)*A,this}equals(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w}fromArray(a,d=0){return this.x=a[d],this.y=a[d+1],this.z=a[d+2],this.w=a[d+3],this}toArray(a=[],d=0){return a[d]=this.x,a[d+1]=this.y,a[d+2]=this.z,a[d+3]=this.w,a}fromBufferAttribute(a,d){return this.x=a.getX(d),this.y=a.getY(d),this.z=a.getZ(d),this.w=a.getW(d),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Jg extends Mo{constructor(a=1,d=1,A={}){super(),this.isRenderTarget=!0,this.width=a,this.height=d,this.depth=1,this.scissor=new Fn(0,0,a,d),this.scissorTest=!1,this.viewport=new Fn(0,0,a,d);const x={width:a,height:d,depth:1};A=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:ki,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},A);const w=new hs(x,A.mapping,A.wrapS,A.wrapT,A.magFilter,A.minFilter,A.format,A.type,A.anisotropy,A.colorSpace);w.flipY=!1,w.generateMipmaps=A.generateMipmaps,w.internalFormat=A.internalFormat,this.textures=[];const M=A.count;for(let L=0;L<M;L++)this.textures[L]=w.clone(),this.textures[L].isRenderTargetTexture=!0;this.depthBuffer=A.depthBuffer,this.stencilBuffer=A.stencilBuffer,this.resolveDepthBuffer=A.resolveDepthBuffer,this.resolveStencilBuffer=A.resolveStencilBuffer,this.depthTexture=A.depthTexture,this.samples=A.samples}get texture(){return this.textures[0]}set texture(a){this.textures[0]=a}setSize(a,d,A=1){if(this.width!==a||this.height!==d||this.depth!==A){this.width=a,this.height=d,this.depth=A;for(let x=0,w=this.textures.length;x<w;x++)this.textures[x].image.width=a,this.textures[x].image.height=d,this.textures[x].image.depth=A;this.dispose()}this.viewport.set(0,0,a,d),this.scissor.set(0,0,a,d)}clone(){return new this.constructor().copy(this)}copy(a){this.width=a.width,this.height=a.height,this.depth=a.depth,this.scissor.copy(a.scissor),this.scissorTest=a.scissorTest,this.viewport.copy(a.viewport),this.textures.length=0;for(let A=0,x=a.textures.length;A<x;A++)this.textures[A]=a.textures[A].clone(),this.textures[A].isRenderTargetTexture=!0;const d=Object.assign({},a.texture.image);return this.texture.source=new xs(d),this.depthBuffer=a.depthBuffer,this.stencilBuffer=a.stencilBuffer,this.resolveDepthBuffer=a.resolveDepthBuffer,this.resolveStencilBuffer=a.resolveStencilBuffer,a.depthTexture!==null&&(this.depthTexture=a.depthTexture.clone()),this.samples=a.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Jo extends Jg{constructor(a=1,d=1,A={}){super(a,d,A),this.isWebGLRenderTarget=!0}}class Zg extends hs{constructor(a=null,d=1,A=1,x=1){super(null),this.isDataArrayTexture=!0,this.image={data:a,width:d,height:A,depth:x},this.magFilter=Dt,this.minFilter=Dt,this.wrapR=Ve,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class hr extends Jo{constructor(a=1,d=1,A=1,x={}){super(a,d,x),this.isWebGLArrayRenderTarget=!0,this.depth=A,this.texture=new Zg(null,a,d,A),this.texture.isRenderTargetTexture=!0}}class Yr extends hs{constructor(a=null,d=1,A=1,x=1){super(null),this.isData3DTexture=!0,this.image={data:a,width:d,height:A,depth:x},this.magFilter=Dt,this.minFilter=Dt,this.wrapR=Ve,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class In extends Jo{constructor(a=1,d=1,A=1,x={}){super(a,d,x),this.isWebGL3DRenderTarget=!0,this.depth=A,this.texture=new Yr(null,a,d,A),this.texture.isRenderTargetTexture=!0}}class Vn{constructor(a=0,d=0,A=0,x=1){this.isQuaternion=!0,this._x=a,this._y=d,this._z=A,this._w=x}static slerpFlat(a,d,A,x,w,M,L){let O=A[x+0],F=A[x+1],H=A[x+2],J=A[x+3];const K=w[M+0],Z=w[M+1],ie=w[M+2],oe=w[M+3];if(L===0){a[d+0]=O,a[d+1]=F,a[d+2]=H,a[d+3]=J;return}if(L===1){a[d+0]=K,a[d+1]=Z,a[d+2]=ie,a[d+3]=oe;return}if(J!==oe||O!==K||F!==Z||H!==ie){let ne=1-L;const ee=O*K+F*Z+H*ie+J*oe,Re=ee>=0?1:-1,we=1-ee*ee;if(we>Number.EPSILON){const st=Math.sqrt(we),qe=Math.atan2(st,ee*Re);ne=Math.sin(ne*qe)/st,L=Math.sin(L*qe)/st}const _e=L*Re;if(O=O*ne+K*_e,F=F*ne+Z*_e,H=H*ne+ie*_e,J=J*ne+oe*_e,ne===1-L){const st=1/Math.sqrt(O*O+F*F+H*H+J*J);O*=st,F*=st,H*=st,J*=st}}a[d]=O,a[d+1]=F,a[d+2]=H,a[d+3]=J}static multiplyQuaternionsFlat(a,d,A,x,w,M){const L=A[x],O=A[x+1],F=A[x+2],H=A[x+3],J=w[M],K=w[M+1],Z=w[M+2],ie=w[M+3];return a[d]=L*ie+H*J+O*Z-F*K,a[d+1]=O*ie+H*K+F*J-L*Z,a[d+2]=F*ie+H*Z+L*K-O*J,a[d+3]=H*ie-L*J-O*K-F*Z,a}get x(){return this._x}set x(a){this._x=a,this._onChangeCallback()}get y(){return this._y}set y(a){this._y=a,this._onChangeCallback()}get z(){return this._z}set z(a){this._z=a,this._onChangeCallback()}get w(){return this._w}set w(a){this._w=a,this._onChangeCallback()}set(a,d,A,x){return this._x=a,this._y=d,this._z=A,this._w=x,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(a){return this._x=a.x,this._y=a.y,this._z=a.z,this._w=a.w,this._onChangeCallback(),this}setFromEuler(a,d=!0){const A=a._x,x=a._y,w=a._z,M=a._order,L=Math.cos,O=Math.sin,F=L(A/2),H=L(x/2),J=L(w/2),K=O(A/2),Z=O(x/2),ie=O(w/2);switch(M){case"XYZ":this._x=K*H*J+F*Z*ie,this._y=F*Z*J-K*H*ie,this._z=F*H*ie+K*Z*J,this._w=F*H*J-K*Z*ie;break;case"YXZ":this._x=K*H*J+F*Z*ie,this._y=F*Z*J-K*H*ie,this._z=F*H*ie-K*Z*J,this._w=F*H*J+K*Z*ie;break;case"ZXY":this._x=K*H*J-F*Z*ie,this._y=F*Z*J+K*H*ie,this._z=F*H*ie+K*Z*J,this._w=F*H*J-K*Z*ie;break;case"ZYX":this._x=K*H*J-F*Z*ie,this._y=F*Z*J+K*H*ie,this._z=F*H*ie-K*Z*J,this._w=F*H*J+K*Z*ie;break;case"YZX":this._x=K*H*J+F*Z*ie,this._y=F*Z*J+K*H*ie,this._z=F*H*ie-K*Z*J,this._w=F*H*J-K*Z*ie;break;case"XZY":this._x=K*H*J-F*Z*ie,this._y=F*Z*J-K*H*ie,this._z=F*H*ie+K*Z*J,this._w=F*H*J+K*Z*ie;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+M)}return d===!0&&this._onChangeCallback(),this}setFromAxisAngle(a,d){const A=d/2,x=Math.sin(A);return this._x=a.x*x,this._y=a.y*x,this._z=a.z*x,this._w=Math.cos(A),this._onChangeCallback(),this}setFromRotationMatrix(a){const d=a.elements,A=d[0],x=d[4],w=d[8],M=d[1],L=d[5],O=d[9],F=d[2],H=d[6],J=d[10],K=A+L+J;if(K>0){const Z=.5/Math.sqrt(K+1);this._w=.25/Z,this._x=(H-O)*Z,this._y=(w-F)*Z,this._z=(M-x)*Z}else if(A>L&&A>J){const Z=2*Math.sqrt(1+A-L-J);this._w=(H-O)/Z,this._x=.25*Z,this._y=(x+M)/Z,this._z=(w+F)/Z}else if(L>J){const Z=2*Math.sqrt(1+L-A-J);this._w=(w-F)/Z,this._x=(x+M)/Z,this._y=.25*Z,this._z=(O+H)/Z}else{const Z=2*Math.sqrt(1+J-A-L);this._w=(M-x)/Z,this._x=(w+F)/Z,this._y=(O+H)/Z,this._z=.25*Z}return this._onChangeCallback(),this}setFromUnitVectors(a,d){let A=a.dot(d)+1;return A<Number.EPSILON?(A=0,Math.abs(a.x)>Math.abs(a.z)?(this._x=-a.y,this._y=a.x,this._z=0,this._w=A):(this._x=0,this._y=-a.z,this._z=a.y,this._w=A)):(this._x=a.y*d.z-a.z*d.y,this._y=a.z*d.x-a.x*d.z,this._z=a.x*d.y-a.y*d.x,this._w=A),this.normalize()}angleTo(a){return 2*Math.acos(Math.abs(Ts(this.dot(a),-1,1)))}rotateTowards(a,d){const A=this.angleTo(a);if(A===0)return this;const x=Math.min(1,d/A);return this.slerp(a,x),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(a){return this._x*a._x+this._y*a._y+this._z*a._z+this._w*a._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let a=this.length();return a===0?(this._x=0,this._y=0,this._z=0,this._w=1):(a=1/a,this._x=this._x*a,this._y=this._y*a,this._z=this._z*a,this._w=this._w*a),this._onChangeCallback(),this}multiply(a){return this.multiplyQuaternions(this,a)}premultiply(a){return this.multiplyQuaternions(a,this)}multiplyQuaternions(a,d){const A=a._x,x=a._y,w=a._z,M=a._w,L=d._x,O=d._y,F=d._z,H=d._w;return this._x=A*H+M*L+x*F-w*O,this._y=x*H+M*O+w*L-A*F,this._z=w*H+M*F+A*O-x*L,this._w=M*H-A*L-x*O-w*F,this._onChangeCallback(),this}slerp(a,d){if(d===0)return this;if(d===1)return this.copy(a);const A=this._x,x=this._y,w=this._z,M=this._w;let L=M*a._w+A*a._x+x*a._y+w*a._z;if(L<0?(this._w=-a._w,this._x=-a._x,this._y=-a._y,this._z=-a._z,L=-L):this.copy(a),L>=1)return this._w=M,this._x=A,this._y=x,this._z=w,this;const O=1-L*L;if(O<=Number.EPSILON){const Z=1-d;return this._w=Z*M+d*this._w,this._x=Z*A+d*this._x,this._y=Z*x+d*this._y,this._z=Z*w+d*this._z,this.normalize(),this}const F=Math.sqrt(O),H=Math.atan2(F,L),J=Math.sin((1-d)*H)/F,K=Math.sin(d*H)/F;return this._w=M*J+this._w*K,this._x=A*J+this._x*K,this._y=x*J+this._y*K,this._z=w*J+this._z*K,this._onChangeCallback(),this}slerpQuaternions(a,d,A){return this.copy(a).slerp(d,A)}random(){const a=2*Math.PI*Math.random(),d=2*Math.PI*Math.random(),A=Math.random(),x=Math.sqrt(1-A),w=Math.sqrt(A);return this.set(x*Math.sin(a),x*Math.cos(a),w*Math.sin(d),w*Math.cos(d))}equals(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w}fromArray(a,d=0){return this._x=a[d],this._y=a[d+1],this._z=a[d+2],this._w=a[d+3],this._onChangeCallback(),this}toArray(a=[],d=0){return a[d]=this._x,a[d+1]=this._y,a[d+2]=this._z,a[d+3]=this._w,a}fromBufferAttribute(a,d){return this._x=a.getX(d),this._y=a.getY(d),this._z=a.getZ(d),this._w=a.getW(d),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(a){return this._onChangeCallback=a,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class He{constructor(a=0,d=0,A=0){He.prototype.isVector3=!0,this.x=a,this.y=d,this.z=A}set(a,d,A){return A===void 0&&(A=this.z),this.x=a,this.y=d,this.z=A,this}setScalar(a){return this.x=a,this.y=a,this.z=a,this}setX(a){return this.x=a,this}setY(a){return this.y=a,this}setZ(a){return this.z=a,this}setComponent(a,d){switch(a){case 0:this.x=d;break;case 1:this.y=d;break;case 2:this.z=d;break;default:throw new Error("index is out of range: "+a)}return this}getComponent(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+a)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(a){return this.x=a.x,this.y=a.y,this.z=a.z,this}add(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this}addScalar(a){return this.x+=a,this.y+=a,this.z+=a,this}addVectors(a,d){return this.x=a.x+d.x,this.y=a.y+d.y,this.z=a.z+d.z,this}addScaledVector(a,d){return this.x+=a.x*d,this.y+=a.y*d,this.z+=a.z*d,this}sub(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this}subScalar(a){return this.x-=a,this.y-=a,this.z-=a,this}subVectors(a,d){return this.x=a.x-d.x,this.y=a.y-d.y,this.z=a.z-d.z,this}multiply(a){return this.x*=a.x,this.y*=a.y,this.z*=a.z,this}multiplyScalar(a){return this.x*=a,this.y*=a,this.z*=a,this}multiplyVectors(a,d){return this.x=a.x*d.x,this.y=a.y*d.y,this.z=a.z*d.z,this}applyEuler(a){return this.applyQuaternion(Vs.setFromEuler(a))}applyAxisAngle(a,d){return this.applyQuaternion(Vs.setFromAxisAngle(a,d))}applyMatrix3(a){const d=this.x,A=this.y,x=this.z,w=a.elements;return this.x=w[0]*d+w[3]*A+w[6]*x,this.y=w[1]*d+w[4]*A+w[7]*x,this.z=w[2]*d+w[5]*A+w[8]*x,this}applyNormalMatrix(a){return this.applyMatrix3(a).normalize()}applyMatrix4(a){const d=this.x,A=this.y,x=this.z,w=a.elements,M=1/(w[3]*d+w[7]*A+w[11]*x+w[15]);return this.x=(w[0]*d+w[4]*A+w[8]*x+w[12])*M,this.y=(w[1]*d+w[5]*A+w[9]*x+w[13])*M,this.z=(w[2]*d+w[6]*A+w[10]*x+w[14])*M,this}applyQuaternion(a){const d=this.x,A=this.y,x=this.z,w=a.x,M=a.y,L=a.z,O=a.w,F=2*(M*x-L*A),H=2*(L*d-w*x),J=2*(w*A-M*d);return this.x=d+O*F+M*J-L*H,this.y=A+O*H+L*F-w*J,this.z=x+O*J+w*H-M*F,this}project(a){return this.applyMatrix4(a.matrixWorldInverse).applyMatrix4(a.projectionMatrix)}unproject(a){return this.applyMatrix4(a.projectionMatrixInverse).applyMatrix4(a.matrixWorld)}transformDirection(a){const d=this.x,A=this.y,x=this.z,w=a.elements;return this.x=w[0]*d+w[4]*A+w[8]*x,this.y=w[1]*d+w[5]*A+w[9]*x,this.z=w[2]*d+w[6]*A+w[10]*x,this.normalize()}divide(a){return this.x/=a.x,this.y/=a.y,this.z/=a.z,this}divideScalar(a){return this.multiplyScalar(1/a)}min(a){return this.x=Math.min(this.x,a.x),this.y=Math.min(this.y,a.y),this.z=Math.min(this.z,a.z),this}max(a){return this.x=Math.max(this.x,a.x),this.y=Math.max(this.y,a.y),this.z=Math.max(this.z,a.z),this}clamp(a,d){return this.x=Math.max(a.x,Math.min(d.x,this.x)),this.y=Math.max(a.y,Math.min(d.y,this.y)),this.z=Math.max(a.z,Math.min(d.z,this.z)),this}clampScalar(a,d){return this.x=Math.max(a,Math.min(d,this.x)),this.y=Math.max(a,Math.min(d,this.y)),this.z=Math.max(a,Math.min(d,this.z)),this}clampLength(a,d){const A=this.length();return this.divideScalar(A||1).multiplyScalar(Math.max(a,Math.min(d,A)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(a){return this.x*a.x+this.y*a.y+this.z*a.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(a){return this.normalize().multiplyScalar(a)}lerp(a,d){return this.x+=(a.x-this.x)*d,this.y+=(a.y-this.y)*d,this.z+=(a.z-this.z)*d,this}lerpVectors(a,d,A){return this.x=a.x+(d.x-a.x)*A,this.y=a.y+(d.y-a.y)*A,this.z=a.z+(d.z-a.z)*A,this}cross(a){return this.crossVectors(this,a)}crossVectors(a,d){const A=a.x,x=a.y,w=a.z,M=d.x,L=d.y,O=d.z;return this.x=x*O-w*L,this.y=w*M-A*O,this.z=A*L-x*M,this}projectOnVector(a){const d=a.lengthSq();if(d===0)return this.set(0,0,0);const A=a.dot(this)/d;return this.copy(a).multiplyScalar(A)}projectOnPlane(a){return wl.copy(this).projectOnVector(a),this.sub(wl)}reflect(a){return this.sub(wl.copy(a).multiplyScalar(2*this.dot(a)))}angleTo(a){const d=Math.sqrt(this.lengthSq()*a.lengthSq());if(d===0)return Math.PI/2;const A=this.dot(a)/d;return Math.acos(Ts(A,-1,1))}distanceTo(a){return Math.sqrt(this.distanceToSquared(a))}distanceToSquared(a){const d=this.x-a.x,A=this.y-a.y,x=this.z-a.z;return d*d+A*A+x*x}manhattanDistanceTo(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)+Math.abs(this.z-a.z)}setFromSpherical(a){return this.setFromSphericalCoords(a.radius,a.phi,a.theta)}setFromSphericalCoords(a,d,A){const x=Math.sin(d)*a;return this.x=x*Math.sin(A),this.y=Math.cos(d)*a,this.z=x*Math.cos(A),this}setFromCylindrical(a){return this.setFromCylindricalCoords(a.radius,a.theta,a.y)}setFromCylindricalCoords(a,d,A){return this.x=a*Math.sin(d),this.y=A,this.z=a*Math.cos(d),this}setFromMatrixPosition(a){const d=a.elements;return this.x=d[12],this.y=d[13],this.z=d[14],this}setFromMatrixScale(a){const d=this.setFromMatrixColumn(a,0).length(),A=this.setFromMatrixColumn(a,1).length(),x=this.setFromMatrixColumn(a,2).length();return this.x=d,this.y=A,this.z=x,this}setFromMatrixColumn(a,d){return this.fromArray(a.elements,d*4)}setFromMatrix3Column(a,d){return this.fromArray(a.elements,d*3)}setFromEuler(a){return this.x=a._x,this.y=a._y,this.z=a._z,this}setFromColor(a){return this.x=a.r,this.y=a.g,this.z=a.b,this}equals(a){return a.x===this.x&&a.y===this.y&&a.z===this.z}fromArray(a,d=0){return this.x=a[d],this.y=a[d+1],this.z=a[d+2],this}toArray(a=[],d=0){return a[d]=this.x,a[d+1]=this.y,a[d+2]=this.z,a}fromBufferAttribute(a,d){return this.x=a.getX(d),this.y=a.getY(d),this.z=a.getZ(d),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const a=Math.random()*Math.PI*2,d=Math.random()*2-1,A=Math.sqrt(1-d*d);return this.x=A*Math.cos(a),this.y=d,this.z=A*Math.sin(a),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const wl=new He,Vs=new Vn;class Ds{constructor(a=new He(1/0,1/0,1/0),d=new He(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=a,this.max=d}set(a,d){return this.min.copy(a),this.max.copy(d),this}setFromArray(a){this.makeEmpty();for(let d=0,A=a.length;d<A;d+=3)this.expandByPoint(oo.fromArray(a,d));return this}setFromBufferAttribute(a){this.makeEmpty();for(let d=0,A=a.count;d<A;d++)this.expandByPoint(oo.fromBufferAttribute(a,d));return this}setFromPoints(a){this.makeEmpty();for(let d=0,A=a.length;d<A;d++)this.expandByPoint(a[d]);return this}setFromCenterAndSize(a,d){const A=oo.copy(d).multiplyScalar(.5);return this.min.copy(a).sub(A),this.max.copy(a).add(A),this}setFromObject(a,d=!1){return this.makeEmpty(),this.expandByObject(a,d)}clone(){return new this.constructor().copy(this)}copy(a){return this.min.copy(a.min),this.max.copy(a.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(a){return this.isEmpty()?a.set(0,0,0):a.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(a){return this.isEmpty()?a.set(0,0,0):a.subVectors(this.max,this.min)}expandByPoint(a){return this.min.min(a),this.max.max(a),this}expandByVector(a){return this.min.sub(a),this.max.add(a),this}expandByScalar(a){return this.min.addScalar(-a),this.max.addScalar(a),this}expandByObject(a,d=!1){a.updateWorldMatrix(!1,!1);const A=a.geometry;if(A!==void 0){const w=A.getAttribute("position");if(d===!0&&w!==void 0&&a.isInstancedMesh!==!0)for(let M=0,L=w.count;M<L;M++)a.isMesh===!0?a.getVertexPosition(M,oo):oo.fromBufferAttribute(w,M),oo.applyMatrix4(a.matrixWorld),this.expandByPoint(oo);else a.boundingBox!==void 0?(a.boundingBox===null&&a.computeBoundingBox(),nu.copy(a.boundingBox)):(A.boundingBox===null&&A.computeBoundingBox(),nu.copy(A.boundingBox)),nu.applyMatrix4(a.matrixWorld),this.union(nu)}const x=a.children;for(let w=0,M=x.length;w<M;w++)this.expandByObject(x[w],d);return this}containsPoint(a){return!(a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<this.min.z||a.z>this.max.z)}containsBox(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z}getParameter(a,d){return d.set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(a){return!(a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<this.min.z||a.min.z>this.max.z)}intersectsSphere(a){return this.clampPoint(a.center,oo),oo.distanceToSquared(a.center)<=a.radius*a.radius}intersectsPlane(a){let d,A;return a.normal.x>0?(d=a.normal.x*this.min.x,A=a.normal.x*this.max.x):(d=a.normal.x*this.max.x,A=a.normal.x*this.min.x),a.normal.y>0?(d+=a.normal.y*this.min.y,A+=a.normal.y*this.max.y):(d+=a.normal.y*this.max.y,A+=a.normal.y*this.min.y),a.normal.z>0?(d+=a.normal.z*this.min.z,A+=a.normal.z*this.max.z):(d+=a.normal.z*this.max.z,A+=a.normal.z*this.min.z),d<=-a.constant&&A>=-a.constant}intersectsTriangle(a){if(this.isEmpty())return!1;this.getCenter(Pn),ns.subVectors(this.max,Pn),Zo.subVectors(a.a,Pn),La.subVectors(a.b,Pn),nn.subVectors(a.c,Pn),qa.subVectors(La,Zo),Cl.subVectors(nn,La),Da.subVectors(Zo,nn);let d=[0,-qa.z,qa.y,0,-Cl.z,Cl.y,0,-Da.z,Da.y,qa.z,0,-qa.x,Cl.z,0,-Cl.x,Da.z,0,-Da.x,-qa.y,qa.x,0,-Cl.y,Cl.x,0,-Da.y,Da.x,0];return!Io(d,Zo,La,nn,ns)||(d=[1,0,0,0,1,0,0,0,1],!Io(d,Zo,La,nn,ns))?!1:(sn.crossVectors(qa,Cl),d=[sn.x,sn.y,sn.z],Io(d,Zo,La,nn,ns))}clampPoint(a,d){return d.copy(a).clamp(this.min,this.max)}distanceToPoint(a){return this.clampPoint(a,oo).distanceTo(a)}getBoundingSphere(a){return this.isEmpty()?a.makeEmpty():(this.getCenter(a.center),a.radius=this.getSize(oo).length()*.5),a}intersect(a){return this.min.max(a.min),this.max.min(a.max),this.isEmpty()&&this.makeEmpty(),this}union(a){return this.min.min(a.min),this.max.max(a.max),this}applyMatrix4(a){return this.isEmpty()?this:(En[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(a),En[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(a),En[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(a),En[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(a),En[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(a),En[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(a),En[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(a),En[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(a),this.setFromPoints(En),this)}translate(a){return this.min.add(a),this.max.add(a),this}equals(a){return a.min.equals(this.min)&&a.max.equals(this.max)}}const En=[new He,new He,new He,new He,new He,new He,new He,new He],oo=new He,nu=new Ds,Zo=new He,La=new He,nn=new He,qa=new He,Cl=new He,Da=new He,Pn=new He,ns=new He,sn=new He,On=new He;function Io(S,a,d,A,x){for(let w=0,M=S.length-3;w<=M;w+=3){On.fromArray(S,w);const L=x.x*Math.abs(On.x)+x.y*Math.abs(On.y)+x.z*Math.abs(On.z),O=a.dot(On),F=d.dot(On),H=A.dot(On);if(Math.max(-Math.max(O,F,H),Math.min(O,F,H))>L)return!1}return!0}const Pd=new Ds,xh=new He,$g=new He;class Aa{constructor(a=new He,d=-1){this.isSphere=!0,this.center=a,this.radius=d}set(a,d){return this.center.copy(a),this.radius=d,this}setFromPoints(a,d){const A=this.center;d!==void 0?A.copy(d):Pd.setFromPoints(a).getCenter(A);let x=0;for(let w=0,M=a.length;w<M;w++)x=Math.max(x,A.distanceToSquared(a[w]));return this.radius=Math.sqrt(x),this}copy(a){return this.center.copy(a.center),this.radius=a.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(a){return a.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(a){return a.distanceTo(this.center)-this.radius}intersectsSphere(a){const d=this.radius+a.radius;return a.center.distanceToSquared(this.center)<=d*d}intersectsBox(a){return a.intersectsSphere(this)}intersectsPlane(a){return Math.abs(a.distanceToPoint(this.center))<=this.radius}clampPoint(a,d){const A=this.center.distanceToSquared(a);return d.copy(a),A>this.radius*this.radius&&(d.sub(this.center).normalize(),d.multiplyScalar(this.radius).add(this.center)),d}getBoundingBox(a){return this.isEmpty()?(a.makeEmpty(),a):(a.set(this.center,this.center),a.expandByScalar(this.radius),a)}applyMatrix4(a){return this.center.applyMatrix4(a),this.radius=this.radius*a.getMaxScaleOnAxis(),this}translate(a){return this.center.add(a),this}expandByPoint(a){if(this.isEmpty())return this.center.copy(a),this.radius=0,this;xh.subVectors(a,this.center);const d=xh.lengthSq();if(d>this.radius*this.radius){const A=Math.sqrt(d),x=(A-this.radius)*.5;this.center.addScaledVector(xh,x/A),this.radius+=x}return this}union(a){return a.isEmpty()?this:this.isEmpty()?(this.copy(a),this):(this.center.equals(a.center)===!0?this.radius=Math.max(this.radius,a.radius):($g.subVectors(a.center,this.center).setLength(a.radius),this.expandByPoint(xh.copy(a.center).add($g)),this.expandByPoint(xh.copy(a.center).sub($g))),this)}equals(a){return a.center.equals(this.center)&&a.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Hl=new He,e0=new He,t0=new He,su=new He,cv=new He,i0=new He,uv=new He;class ya{constructor(a=new He,d=new He(0,0,-1)){this.origin=a,this.direction=d}set(a,d){return this.origin.copy(a),this.direction.copy(d),this}copy(a){return this.origin.copy(a.origin),this.direction.copy(a.direction),this}at(a,d){return d.copy(this.origin).addScaledVector(this.direction,a)}lookAt(a){return this.direction.copy(a).sub(this.origin).normalize(),this}recast(a){return this.origin.copy(this.at(a,Hl)),this}closestPointToPoint(a,d){d.subVectors(a,this.origin);const A=d.dot(this.direction);return A<0?d.copy(this.origin):d.copy(this.origin).addScaledVector(this.direction,A)}distanceToPoint(a){return Math.sqrt(this.distanceSqToPoint(a))}distanceSqToPoint(a){const d=Hl.subVectors(a,this.origin).dot(this.direction);return d<0?this.origin.distanceToSquared(a):(Hl.copy(this.origin).addScaledVector(this.direction,d),Hl.distanceToSquared(a))}distanceSqToSegment(a,d,A,x){e0.copy(a).add(d).multiplyScalar(.5),t0.copy(d).sub(a).normalize(),su.copy(this.origin).sub(e0);const w=a.distanceTo(d)*.5,M=-this.direction.dot(t0),L=su.dot(this.direction),O=-su.dot(t0),F=su.lengthSq(),H=Math.abs(1-M*M);let J,K,Z,ie;if(H>0)if(J=M*O-L,K=M*L-O,ie=w*H,J>=0)if(K>=-ie)if(K<=ie){const oe=1/H;J*=oe,K*=oe,Z=J*(J+M*K+2*L)+K*(M*J+K+2*O)+F}else K=w,J=Math.max(0,-(M*K+L)),Z=-J*J+K*(K+2*O)+F;else K=-w,J=Math.max(0,-(M*K+L)),Z=-J*J+K*(K+2*O)+F;else K<=-ie?(J=Math.max(0,-(-M*w+L)),K=J>0?-w:Math.min(Math.max(-w,-O),w),Z=-J*J+K*(K+2*O)+F):K<=ie?(J=0,K=Math.min(Math.max(-w,-O),w),Z=K*(K+2*O)+F):(J=Math.max(0,-(M*w+L)),K=J>0?w:Math.min(Math.max(-w,-O),w),Z=-J*J+K*(K+2*O)+F);else K=M>0?-w:w,J=Math.max(0,-(M*K+L)),Z=-J*J+K*(K+2*O)+F;return A&&A.copy(this.origin).addScaledVector(this.direction,J),x&&x.copy(e0).addScaledVector(t0,K),Z}intersectSphere(a,d){Hl.subVectors(a.center,this.origin);const A=Hl.dot(this.direction),x=Hl.dot(Hl)-A*A,w=a.radius*a.radius;if(x>w)return null;const M=Math.sqrt(w-x),L=A-M,O=A+M;return O<0?null:L<0?this.at(O,d):this.at(L,d)}intersectsSphere(a){return this.distanceSqToPoint(a.center)<=a.radius*a.radius}distanceToPlane(a){const d=a.normal.dot(this.direction);if(d===0)return a.distanceToPoint(this.origin)===0?0:null;const A=-(this.origin.dot(a.normal)+a.constant)/d;return A>=0?A:null}intersectPlane(a,d){const A=this.distanceToPlane(a);return A===null?null:this.at(A,d)}intersectsPlane(a){const d=a.distanceToPoint(this.origin);return d===0||a.normal.dot(this.direction)*d<0}intersectBox(a,d){let A,x,w,M,L,O;const F=1/this.direction.x,H=1/this.direction.y,J=1/this.direction.z,K=this.origin;return F>=0?(A=(a.min.x-K.x)*F,x=(a.max.x-K.x)*F):(A=(a.max.x-K.x)*F,x=(a.min.x-K.x)*F),H>=0?(w=(a.min.y-K.y)*H,M=(a.max.y-K.y)*H):(w=(a.max.y-K.y)*H,M=(a.min.y-K.y)*H),A>M||w>x||((w>A||isNaN(A))&&(A=w),(M<x||isNaN(x))&&(x=M),J>=0?(L=(a.min.z-K.z)*J,O=(a.max.z-K.z)*J):(L=(a.max.z-K.z)*J,O=(a.min.z-K.z)*J),A>O||L>x)||((L>A||A!==A)&&(A=L),(O<x||x!==x)&&(x=O),x<0)?null:this.at(A>=0?A:x,d)}intersectsBox(a){return this.intersectBox(a,Hl)!==null}intersectTriangle(a,d,A,x,w){cv.subVectors(d,a),i0.subVectors(A,a),uv.crossVectors(cv,i0);let M=this.direction.dot(uv),L;if(M>0){if(x)return null;L=1}else if(M<0)L=-1,M=-M;else return null;su.subVectors(this.origin,a);const O=L*this.direction.dot(i0.crossVectors(su,i0));if(O<0)return null;const F=L*this.direction.dot(cv.cross(su));if(F<0||O+F>M)return null;const H=-L*su.dot(uv);return H<0?null:this.at(H/M,w)}applyMatrix4(a){return this.origin.applyMatrix4(a),this.direction.transformDirection(a),this}equals(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class fr{constructor(a,d,A,x,w,M,L,O,F,H,J,K,Z,ie,oe,ne){fr.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],a!==void 0&&this.set(a,d,A,x,w,M,L,O,F,H,J,K,Z,ie,oe,ne)}set(a,d,A,x,w,M,L,O,F,H,J,K,Z,ie,oe,ne){const ee=this.elements;return ee[0]=a,ee[4]=d,ee[8]=A,ee[12]=x,ee[1]=w,ee[5]=M,ee[9]=L,ee[13]=O,ee[2]=F,ee[6]=H,ee[10]=J,ee[14]=K,ee[3]=Z,ee[7]=ie,ee[11]=oe,ee[15]=ne,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new fr().fromArray(this.elements)}copy(a){const d=this.elements,A=a.elements;return d[0]=A[0],d[1]=A[1],d[2]=A[2],d[3]=A[3],d[4]=A[4],d[5]=A[5],d[6]=A[6],d[7]=A[7],d[8]=A[8],d[9]=A[9],d[10]=A[10],d[11]=A[11],d[12]=A[12],d[13]=A[13],d[14]=A[14],d[15]=A[15],this}copyPosition(a){const d=this.elements,A=a.elements;return d[12]=A[12],d[13]=A[13],d[14]=A[14],this}setFromMatrix3(a){const d=a.elements;return this.set(d[0],d[3],d[6],0,d[1],d[4],d[7],0,d[2],d[5],d[8],0,0,0,0,1),this}extractBasis(a,d,A){return a.setFromMatrixColumn(this,0),d.setFromMatrixColumn(this,1),A.setFromMatrixColumn(this,2),this}makeBasis(a,d,A){return this.set(a.x,d.x,A.x,0,a.y,d.y,A.y,0,a.z,d.z,A.z,0,0,0,0,1),this}extractRotation(a){const d=this.elements,A=a.elements,x=1/_h.setFromMatrixColumn(a,0).length(),w=1/_h.setFromMatrixColumn(a,1).length(),M=1/_h.setFromMatrixColumn(a,2).length();return d[0]=A[0]*x,d[1]=A[1]*x,d[2]=A[2]*x,d[3]=0,d[4]=A[4]*w,d[5]=A[5]*w,d[6]=A[6]*w,d[7]=0,d[8]=A[8]*M,d[9]=A[9]*M,d[10]=A[10]*M,d[11]=0,d[12]=0,d[13]=0,d[14]=0,d[15]=1,this}makeRotationFromEuler(a){const d=this.elements,A=a.x,x=a.y,w=a.z,M=Math.cos(A),L=Math.sin(A),O=Math.cos(x),F=Math.sin(x),H=Math.cos(w),J=Math.sin(w);if(a.order==="XYZ"){const K=M*H,Z=M*J,ie=L*H,oe=L*J;d[0]=O*H,d[4]=-O*J,d[8]=F,d[1]=Z+ie*F,d[5]=K-oe*F,d[9]=-L*O,d[2]=oe-K*F,d[6]=ie+Z*F,d[10]=M*O}else if(a.order==="YXZ"){const K=O*H,Z=O*J,ie=F*H,oe=F*J;d[0]=K+oe*L,d[4]=ie*L-Z,d[8]=M*F,d[1]=M*J,d[5]=M*H,d[9]=-L,d[2]=Z*L-ie,d[6]=oe+K*L,d[10]=M*O}else if(a.order==="ZXY"){const K=O*H,Z=O*J,ie=F*H,oe=F*J;d[0]=K-oe*L,d[4]=-M*J,d[8]=ie+Z*L,d[1]=Z+ie*L,d[5]=M*H,d[9]=oe-K*L,d[2]=-M*F,d[6]=L,d[10]=M*O}else if(a.order==="ZYX"){const K=M*H,Z=M*J,ie=L*H,oe=L*J;d[0]=O*H,d[4]=ie*F-Z,d[8]=K*F+oe,d[1]=O*J,d[5]=oe*F+K,d[9]=Z*F-ie,d[2]=-F,d[6]=L*O,d[10]=M*O}else if(a.order==="YZX"){const K=M*O,Z=M*F,ie=L*O,oe=L*F;d[0]=O*H,d[4]=oe-K*J,d[8]=ie*J+Z,d[1]=J,d[5]=M*H,d[9]=-L*H,d[2]=-F*H,d[6]=Z*J+ie,d[10]=K-oe*J}else if(a.order==="XZY"){const K=M*O,Z=M*F,ie=L*O,oe=L*F;d[0]=O*H,d[4]=-J,d[8]=F*H,d[1]=K*J+oe,d[5]=M*H,d[9]=Z*J-ie,d[2]=ie*J-Z,d[6]=L*H,d[10]=oe*J+K}return d[3]=0,d[7]=0,d[11]=0,d[12]=0,d[13]=0,d[14]=0,d[15]=1,this}makeRotationFromQuaternion(a){return this.compose(twe,a,iwe)}lookAt(a,d,A){const x=this.elements;return Sl.subVectors(a,d),Sl.lengthSq()===0&&(Sl.z=1),Sl.normalize(),Od.crossVectors(A,Sl),Od.lengthSq()===0&&(Math.abs(A.z)===1?Sl.x+=1e-4:Sl.z+=1e-4,Sl.normalize(),Od.crossVectors(A,Sl)),Od.normalize(),xE.crossVectors(Sl,Od),x[0]=Od.x,x[4]=xE.x,x[8]=Sl.x,x[1]=Od.y,x[5]=xE.y,x[9]=Sl.y,x[2]=Od.z,x[6]=xE.z,x[10]=Sl.z,this}multiply(a){return this.multiplyMatrices(this,a)}premultiply(a){return this.multiplyMatrices(a,this)}multiplyMatrices(a,d){const A=a.elements,x=d.elements,w=this.elements,M=A[0],L=A[4],O=A[8],F=A[12],H=A[1],J=A[5],K=A[9],Z=A[13],ie=A[2],oe=A[6],ne=A[10],ee=A[14],Re=A[3],we=A[7],_e=A[11],st=A[15],qe=x[0],Ze=x[4],rt=x[8],je=x[12],ke=x[1],nt=x[5],gt=x[9],ft=x[13],It=x[2],Ft=x[6],pi=x[10],Ni=x[14],Ut=x[3],yi=x[7],Pi=x[11],Ur=x[15];return w[0]=M*qe+L*ke+O*It+F*Ut,w[4]=M*Ze+L*nt+O*Ft+F*yi,w[8]=M*rt+L*gt+O*pi+F*Pi,w[12]=M*je+L*ft+O*Ni+F*Ur,w[1]=H*qe+J*ke+K*It+Z*Ut,w[5]=H*Ze+J*nt+K*Ft+Z*yi,w[9]=H*rt+J*gt+K*pi+Z*Pi,w[13]=H*je+J*ft+K*Ni+Z*Ur,w[2]=ie*qe+oe*ke+ne*It+ee*Ut,w[6]=ie*Ze+oe*nt+ne*Ft+ee*yi,w[10]=ie*rt+oe*gt+ne*pi+ee*Pi,w[14]=ie*je+oe*ft+ne*Ni+ee*Ur,w[3]=Re*qe+we*ke+_e*It+st*Ut,w[7]=Re*Ze+we*nt+_e*Ft+st*yi,w[11]=Re*rt+we*gt+_e*pi+st*Pi,w[15]=Re*je+we*ft+_e*Ni+st*Ur,this}multiplyScalar(a){const d=this.elements;return d[0]*=a,d[4]*=a,d[8]*=a,d[12]*=a,d[1]*=a,d[5]*=a,d[9]*=a,d[13]*=a,d[2]*=a,d[6]*=a,d[10]*=a,d[14]*=a,d[3]*=a,d[7]*=a,d[11]*=a,d[15]*=a,this}determinant(){const a=this.elements,d=a[0],A=a[4],x=a[8],w=a[12],M=a[1],L=a[5],O=a[9],F=a[13],H=a[2],J=a[6],K=a[10],Z=a[14],ie=a[3],oe=a[7],ne=a[11],ee=a[15];return ie*(+w*O*J-x*F*J-w*L*K+A*F*K+x*L*Z-A*O*Z)+oe*(+d*O*Z-d*F*K+w*M*K-x*M*Z+x*F*H-w*O*H)+ne*(+d*F*J-d*L*Z-w*M*J+A*M*Z+w*L*H-A*F*H)+ee*(-x*L*H-d*O*J+d*L*K+x*M*J-A*M*K+A*O*H)}transpose(){const a=this.elements;let d;return d=a[1],a[1]=a[4],a[4]=d,d=a[2],a[2]=a[8],a[8]=d,d=a[6],a[6]=a[9],a[9]=d,d=a[3],a[3]=a[12],a[12]=d,d=a[7],a[7]=a[13],a[13]=d,d=a[11],a[11]=a[14],a[14]=d,this}setPosition(a,d,A){const x=this.elements;return a.isVector3?(x[12]=a.x,x[13]=a.y,x[14]=a.z):(x[12]=a,x[13]=d,x[14]=A),this}invert(){const a=this.elements,d=a[0],A=a[1],x=a[2],w=a[3],M=a[4],L=a[5],O=a[6],F=a[7],H=a[8],J=a[9],K=a[10],Z=a[11],ie=a[12],oe=a[13],ne=a[14],ee=a[15],Re=J*ne*F-oe*K*F+oe*O*Z-L*ne*Z-J*O*ee+L*K*ee,we=ie*K*F-H*ne*F-ie*O*Z+M*ne*Z+H*O*ee-M*K*ee,_e=H*oe*F-ie*J*F+ie*L*Z-M*oe*Z-H*L*ee+M*J*ee,st=ie*J*O-H*oe*O-ie*L*K+M*oe*K+H*L*ne-M*J*ne,qe=d*Re+A*we+x*_e+w*st;if(qe===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const Ze=1/qe;return a[0]=Re*Ze,a[1]=(oe*K*w-J*ne*w-oe*x*Z+A*ne*Z+J*x*ee-A*K*ee)*Ze,a[2]=(L*ne*w-oe*O*w+oe*x*F-A*ne*F-L*x*ee+A*O*ee)*Ze,a[3]=(J*O*w-L*K*w-J*x*F+A*K*F+L*x*Z-A*O*Z)*Ze,a[4]=we*Ze,a[5]=(H*ne*w-ie*K*w+ie*x*Z-d*ne*Z-H*x*ee+d*K*ee)*Ze,a[6]=(ie*O*w-M*ne*w-ie*x*F+d*ne*F+M*x*ee-d*O*ee)*Ze,a[7]=(M*K*w-H*O*w+H*x*F-d*K*F-M*x*Z+d*O*Z)*Ze,a[8]=_e*Ze,a[9]=(ie*J*w-H*oe*w-ie*A*Z+d*oe*Z+H*A*ee-d*J*ee)*Ze,a[10]=(M*oe*w-ie*L*w+ie*A*F-d*oe*F-M*A*ee+d*L*ee)*Ze,a[11]=(H*L*w-M*J*w-H*A*F+d*J*F+M*A*Z-d*L*Z)*Ze,a[12]=st*Ze,a[13]=(H*oe*x-ie*J*x+ie*A*K-d*oe*K-H*A*ne+d*J*ne)*Ze,a[14]=(ie*L*x-M*oe*x-ie*A*O+d*oe*O+M*A*ne-d*L*ne)*Ze,a[15]=(M*J*x-H*L*x+H*A*O-d*J*O-M*A*K+d*L*K)*Ze,this}scale(a){const d=this.elements,A=a.x,x=a.y,w=a.z;return d[0]*=A,d[4]*=x,d[8]*=w,d[1]*=A,d[5]*=x,d[9]*=w,d[2]*=A,d[6]*=x,d[10]*=w,d[3]*=A,d[7]*=x,d[11]*=w,this}getMaxScaleOnAxis(){const a=this.elements,d=a[0]*a[0]+a[1]*a[1]+a[2]*a[2],A=a[4]*a[4]+a[5]*a[5]+a[6]*a[6],x=a[8]*a[8]+a[9]*a[9]+a[10]*a[10];return Math.sqrt(Math.max(d,A,x))}makeTranslation(a,d,A){return a.isVector3?this.set(1,0,0,a.x,0,1,0,a.y,0,0,1,a.z,0,0,0,1):this.set(1,0,0,a,0,1,0,d,0,0,1,A,0,0,0,1),this}makeRotationX(a){const d=Math.cos(a),A=Math.sin(a);return this.set(1,0,0,0,0,d,-A,0,0,A,d,0,0,0,0,1),this}makeRotationY(a){const d=Math.cos(a),A=Math.sin(a);return this.set(d,0,A,0,0,1,0,0,-A,0,d,0,0,0,0,1),this}makeRotationZ(a){const d=Math.cos(a),A=Math.sin(a);return this.set(d,-A,0,0,A,d,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(a,d){const A=Math.cos(d),x=Math.sin(d),w=1-A,M=a.x,L=a.y,O=a.z,F=w*M,H=w*L;return this.set(F*M+A,F*L-x*O,F*O+x*L,0,F*L+x*O,H*L+A,H*O-x*M,0,F*O-x*L,H*O+x*M,w*O*O+A,0,0,0,0,1),this}makeScale(a,d,A){return this.set(a,0,0,0,0,d,0,0,0,0,A,0,0,0,0,1),this}makeShear(a,d,A,x,w,M){return this.set(1,A,w,0,a,1,M,0,d,x,1,0,0,0,0,1),this}compose(a,d,A){const x=this.elements,w=d._x,M=d._y,L=d._z,O=d._w,F=w+w,H=M+M,J=L+L,K=w*F,Z=w*H,ie=w*J,oe=M*H,ne=M*J,ee=L*J,Re=O*F,we=O*H,_e=O*J,st=A.x,qe=A.y,Ze=A.z;return x[0]=(1-(oe+ee))*st,x[1]=(Z+_e)*st,x[2]=(ie-we)*st,x[3]=0,x[4]=(Z-_e)*qe,x[5]=(1-(K+ee))*qe,x[6]=(ne+Re)*qe,x[7]=0,x[8]=(ie+we)*Ze,x[9]=(ne-Re)*Ze,x[10]=(1-(K+oe))*Ze,x[11]=0,x[12]=a.x,x[13]=a.y,x[14]=a.z,x[15]=1,this}decompose(a,d,A){const x=this.elements;let w=_h.set(x[0],x[1],x[2]).length();const M=_h.set(x[4],x[5],x[6]).length(),L=_h.set(x[8],x[9],x[10]).length();this.determinant()<0&&(w=-w),a.x=x[12],a.y=x[13],a.z=x[14],$o.copy(this);const O=1/w,F=1/M,H=1/L;return $o.elements[0]*=O,$o.elements[1]*=O,$o.elements[2]*=O,$o.elements[4]*=F,$o.elements[5]*=F,$o.elements[6]*=F,$o.elements[8]*=H,$o.elements[9]*=H,$o.elements[10]*=H,d.setFromRotationMatrix($o),A.x=w,A.y=M,A.z=L,this}makePerspective(a,d,A,x,w,M,L=Gl){const O=this.elements,F=2*w/(d-a),H=2*w/(A-x),J=(d+a)/(d-a),K=(A+x)/(A-x);let Z,ie;if(L===Gl)Z=-(M+w)/(M-w),ie=-2*M*w/(M-w);else if(L===cf)Z=-M/(M-w),ie=-M*w/(M-w);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+L);return O[0]=F,O[4]=0,O[8]=J,O[12]=0,O[1]=0,O[5]=H,O[9]=K,O[13]=0,O[2]=0,O[6]=0,O[10]=Z,O[14]=ie,O[3]=0,O[7]=0,O[11]=-1,O[15]=0,this}makeOrthographic(a,d,A,x,w,M,L=Gl){const O=this.elements,F=1/(d-a),H=1/(A-x),J=1/(M-w),K=(d+a)*F,Z=(A+x)*H;let ie,oe;if(L===Gl)ie=(M+w)*J,oe=-2*J;else if(L===cf)ie=w*J,oe=-1*J;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+L);return O[0]=2*F,O[4]=0,O[8]=0,O[12]=-K,O[1]=0,O[5]=2*H,O[9]=0,O[13]=-Z,O[2]=0,O[6]=0,O[10]=oe,O[14]=-ie,O[3]=0,O[7]=0,O[11]=0,O[15]=1,this}equals(a){const d=this.elements,A=a.elements;for(let x=0;x<16;x++)if(d[x]!==A[x])return!1;return!0}fromArray(a,d=0){for(let A=0;A<16;A++)this.elements[A]=a[A+d];return this}toArray(a=[],d=0){const A=this.elements;return a[d]=A[0],a[d+1]=A[1],a[d+2]=A[2],a[d+3]=A[3],a[d+4]=A[4],a[d+5]=A[5],a[d+6]=A[6],a[d+7]=A[7],a[d+8]=A[8],a[d+9]=A[9],a[d+10]=A[10],a[d+11]=A[11],a[d+12]=A[12],a[d+13]=A[13],a[d+14]=A[14],a[d+15]=A[15],a}}const _h=new He,$o=new fr,twe=new He(0,0,0),iwe=new He(1,1,1),Od=new He,xE=new He,Sl=new He,Mj=new fr,Rj=new Vn;class Tl{constructor(a=0,d=0,A=0,x=Tl.DEFAULT_ORDER){this.isEuler=!0,this._x=a,this._y=d,this._z=A,this._order=x}get x(){return this._x}set x(a){this._x=a,this._onChangeCallback()}get y(){return this._y}set y(a){this._y=a,this._onChangeCallback()}get z(){return this._z}set z(a){this._z=a,this._onChangeCallback()}get order(){return this._order}set order(a){this._order=a,this._onChangeCallback()}set(a,d,A,x=this._order){return this._x=a,this._y=d,this._z=A,this._order=x,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(a){return this._x=a._x,this._y=a._y,this._z=a._z,this._order=a._order,this._onChangeCallback(),this}setFromRotationMatrix(a,d=this._order,A=!0){const x=a.elements,w=x[0],M=x[4],L=x[8],O=x[1],F=x[5],H=x[9],J=x[2],K=x[6],Z=x[10];switch(d){case"XYZ":this._y=Math.asin(Ts(L,-1,1)),Math.abs(L)<.9999999?(this._x=Math.atan2(-H,Z),this._z=Math.atan2(-M,w)):(this._x=Math.atan2(K,F),this._z=0);break;case"YXZ":this._x=Math.asin(-Ts(H,-1,1)),Math.abs(H)<.9999999?(this._y=Math.atan2(L,Z),this._z=Math.atan2(O,F)):(this._y=Math.atan2(-J,w),this._z=0);break;case"ZXY":this._x=Math.asin(Ts(K,-1,1)),Math.abs(K)<.9999999?(this._y=Math.atan2(-J,Z),this._z=Math.atan2(-M,F)):(this._y=0,this._z=Math.atan2(O,w));break;case"ZYX":this._y=Math.asin(-Ts(J,-1,1)),Math.abs(J)<.9999999?(this._x=Math.atan2(K,Z),this._z=Math.atan2(O,w)):(this._x=0,this._z=Math.atan2(-M,F));break;case"YZX":this._z=Math.asin(Ts(O,-1,1)),Math.abs(O)<.9999999?(this._x=Math.atan2(-H,F),this._y=Math.atan2(-J,w)):(this._x=0,this._y=Math.atan2(L,Z));break;case"XZY":this._z=Math.asin(-Ts(M,-1,1)),Math.abs(M)<.9999999?(this._x=Math.atan2(K,F),this._y=Math.atan2(L,w)):(this._x=Math.atan2(-H,Z),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+d)}return this._order=d,A===!0&&this._onChangeCallback(),this}setFromQuaternion(a,d,A){return Mj.makeRotationFromQuaternion(a),this.setFromRotationMatrix(Mj,d,A)}setFromVector3(a,d=this._order){return this.set(a.x,a.y,a.z,d)}reorder(a){return Rj.setFromEuler(this),this.setFromQuaternion(Rj,a)}equals(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._order===this._order}fromArray(a){return this._x=a[0],this._y=a[1],this._z=a[2],a[3]!==void 0&&(this._order=a[3]),this._onChangeCallback(),this}toArray(a=[],d=0){return a[d]=this._x,a[d+1]=this._y,a[d+2]=this._z,a[d+3]=this._order,a}_onChange(a){return this._onChangeCallback=a,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Tl.DEFAULT_ORDER="XYZ";class _E{constructor(){this.mask=1}set(a){this.mask=(1<<a|0)>>>0}enable(a){this.mask|=1<<a|0}enableAll(){this.mask=-1}toggle(a){this.mask^=1<<a|0}disable(a){this.mask&=~(1<<a|0)}disableAll(){this.mask=0}test(a){return(this.mask&a.mask)!==0}isEnabled(a){return(this.mask&(1<<a|0))!==0}}let rwe=0;const Ij=new He,r0=new Vn,Eh=new fr,EE=new He,hv=new He,nwe=new He,swe=new Vn,Bj=new He(1,0,0),Lj=new He(0,1,0),Dj=new He(0,0,1),Nj={type:"added"},awe={type:"removed"},n0={type:"childadded",child:null},SB={type:"childremoved",child:null};class Gn extends Mo{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:rwe++}),this.uuid=Ro(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Gn.DEFAULT_UP.clone();const a=new He,d=new Tl,A=new Vn,x=new He(1,1,1);function w(){A.setFromEuler(d,!1)}function M(){d.setFromQuaternion(A,void 0,!1)}d._onChange(w),A._onChange(M),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:a},rotation:{configurable:!0,enumerable:!0,value:d},quaternion:{configurable:!0,enumerable:!0,value:A},scale:{configurable:!0,enumerable:!0,value:x},modelViewMatrix:{value:new fr},normalMatrix:{value:new Xr}}),this.matrix=new fr,this.matrixWorld=new fr,this.matrixAutoUpdate=Gn.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Gn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new _E,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(a){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(a),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(a){return this.quaternion.premultiply(a),this}setRotationFromAxisAngle(a,d){this.quaternion.setFromAxisAngle(a,d)}setRotationFromEuler(a){this.quaternion.setFromEuler(a,!0)}setRotationFromMatrix(a){this.quaternion.setFromRotationMatrix(a)}setRotationFromQuaternion(a){this.quaternion.copy(a)}rotateOnAxis(a,d){return r0.setFromAxisAngle(a,d),this.quaternion.multiply(r0),this}rotateOnWorldAxis(a,d){return r0.setFromAxisAngle(a,d),this.quaternion.premultiply(r0),this}rotateX(a){return this.rotateOnAxis(Bj,a)}rotateY(a){return this.rotateOnAxis(Lj,a)}rotateZ(a){return this.rotateOnAxis(Dj,a)}translateOnAxis(a,d){return Ij.copy(a).applyQuaternion(this.quaternion),this.position.add(Ij.multiplyScalar(d)),this}translateX(a){return this.translateOnAxis(Bj,a)}translateY(a){return this.translateOnAxis(Lj,a)}translateZ(a){return this.translateOnAxis(Dj,a)}localToWorld(a){return this.updateWorldMatrix(!0,!1),a.applyMatrix4(this.matrixWorld)}worldToLocal(a){return this.updateWorldMatrix(!0,!1),a.applyMatrix4(Eh.copy(this.matrixWorld).invert())}lookAt(a,d,A){a.isVector3?EE.copy(a):EE.set(a,d,A);const x=this.parent;this.updateWorldMatrix(!0,!1),hv.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Eh.lookAt(hv,EE,this.up):Eh.lookAt(EE,hv,this.up),this.quaternion.setFromRotationMatrix(Eh),x&&(Eh.extractRotation(x.matrixWorld),r0.setFromRotationMatrix(Eh),this.quaternion.premultiply(r0.invert()))}add(a){if(arguments.length>1){for(let d=0;d<arguments.length;d++)this.add(arguments[d]);return this}return a===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",a),this):(a&&a.isObject3D?(a.removeFromParent(),a.parent=this,this.children.push(a),a.dispatchEvent(Nj),n0.child=a,this.dispatchEvent(n0),n0.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",a),this)}remove(a){if(arguments.length>1){for(let A=0;A<arguments.length;A++)this.remove(arguments[A]);return this}const d=this.children.indexOf(a);return d!==-1&&(a.parent=null,this.children.splice(d,1),a.dispatchEvent(awe),SB.child=a,this.dispatchEvent(SB),SB.child=null),this}removeFromParent(){const a=this.parent;return a!==null&&a.remove(this),this}clear(){return this.remove(...this.children)}attach(a){return this.updateWorldMatrix(!0,!1),Eh.copy(this.matrixWorld).invert(),a.parent!==null&&(a.parent.updateWorldMatrix(!0,!1),Eh.multiply(a.parent.matrixWorld)),a.applyMatrix4(Eh),a.removeFromParent(),a.parent=this,this.children.push(a),a.updateWorldMatrix(!1,!0),a.dispatchEvent(Nj),n0.child=a,this.dispatchEvent(n0),n0.child=null,this}getObjectById(a){return this.getObjectByProperty("id",a)}getObjectByName(a){return this.getObjectByProperty("name",a)}getObjectByProperty(a,d){if(this[a]===d)return this;for(let A=0,x=this.children.length;A<x;A++){const w=this.children[A].getObjectByProperty(a,d);if(w!==void 0)return w}}getObjectsByProperty(a,d,A=[]){this[a]===d&&A.push(this);const x=this.children;for(let w=0,M=x.length;w<M;w++)x[w].getObjectsByProperty(a,d,A);return A}getWorldPosition(a){return this.updateWorldMatrix(!0,!1),a.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(a){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(hv,a,nwe),a}getWorldScale(a){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(hv,swe,a),a}getWorldDirection(a){this.updateWorldMatrix(!0,!1);const d=this.matrixWorld.elements;return a.set(d[8],d[9],d[10]).normalize()}raycast(){}traverse(a){a(this);const d=this.children;for(let A=0,x=d.length;A<x;A++)d[A].traverse(a)}traverseVisible(a){if(this.visible===!1)return;a(this);const d=this.children;for(let A=0,x=d.length;A<x;A++)d[A].traverseVisible(a)}traverseAncestors(a){const d=this.parent;d!==null&&(a(d),d.traverseAncestors(a))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(a){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||a)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0);const d=this.children;for(let A=0,x=d.length;A<x;A++){const w=d[A];(w.matrixWorldAutoUpdate===!0||a===!0)&&w.updateMatrixWorld(a)}}updateWorldMatrix(a,d){const A=this.parent;if(a===!0&&A!==null&&A.matrixWorldAutoUpdate===!0&&A.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),d===!0){const x=this.children;for(let w=0,M=x.length;w<M;w++){const L=x[w];L.matrixWorldAutoUpdate===!0&&L.updateWorldMatrix(!1,!0)}}}toJSON(a){const d=a===void 0||typeof a=="string",A={};d&&(a={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},A.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const x={};x.uuid=this.uuid,x.type=this.type,this.name!==""&&(x.name=this.name),this.castShadow===!0&&(x.castShadow=!0),this.receiveShadow===!0&&(x.receiveShadow=!0),this.visible===!1&&(x.visible=!1),this.frustumCulled===!1&&(x.frustumCulled=!1),this.renderOrder!==0&&(x.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(x.userData=this.userData),x.layers=this.layers.mask,x.matrix=this.matrix.toArray(),x.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(x.matrixAutoUpdate=!1),this.isInstancedMesh&&(x.type="InstancedMesh",x.count=this.count,x.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(x.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(x.type="BatchedMesh",x.perObjectFrustumCulled=this.perObjectFrustumCulled,x.sortObjects=this.sortObjects,x.drawRanges=this._drawRanges,x.reservedRanges=this._reservedRanges,x.visibility=this._visibility,x.active=this._active,x.bounds=this._bounds.map(L=>({boxInitialized:L.boxInitialized,boxMin:L.box.min.toArray(),boxMax:L.box.max.toArray(),sphereInitialized:L.sphereInitialized,sphereRadius:L.sphere.radius,sphereCenter:L.sphere.center.toArray()})),x.maxGeometryCount=this._maxGeometryCount,x.maxVertexCount=this._maxVertexCount,x.maxIndexCount=this._maxIndexCount,x.geometryInitialized=this._geometryInitialized,x.geometryCount=this._geometryCount,x.matricesTexture=this._matricesTexture.toJSON(a),this.boundingSphere!==null&&(x.boundingSphere={center:x.boundingSphere.center.toArray(),radius:x.boundingSphere.radius}),this.boundingBox!==null&&(x.boundingBox={min:x.boundingBox.min.toArray(),max:x.boundingBox.max.toArray()}));function w(L,O){return L[O.uuid]===void 0&&(L[O.uuid]=O.toJSON(a)),O.uuid}if(this.isScene)this.background&&(this.background.isColor?x.background=this.background.toJSON():this.background.isTexture&&(x.background=this.background.toJSON(a).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(x.environment=this.environment.toJSON(a).uuid);else if(this.isMesh||this.isLine||this.isPoints){x.geometry=w(a.geometries,this.geometry);const L=this.geometry.parameters;if(L!==void 0&&L.shapes!==void 0){const O=L.shapes;if(Array.isArray(O))for(let F=0,H=O.length;F<H;F++){const J=O[F];w(a.shapes,J)}else w(a.shapes,O)}}if(this.isSkinnedMesh&&(x.bindMode=this.bindMode,x.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(w(a.skeletons,this.skeleton),x.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const L=[];for(let O=0,F=this.material.length;O<F;O++)L.push(w(a.materials,this.material[O]));x.material=L}else x.material=w(a.materials,this.material);if(this.children.length>0){x.children=[];for(let L=0;L<this.children.length;L++)x.children.push(this.children[L].toJSON(a).object)}if(this.animations.length>0){x.animations=[];for(let L=0;L<this.animations.length;L++){const O=this.animations[L];x.animations.push(w(a.animations,O))}}if(d){const L=M(a.geometries),O=M(a.materials),F=M(a.textures),H=M(a.images),J=M(a.shapes),K=M(a.skeletons),Z=M(a.animations),ie=M(a.nodes);L.length>0&&(A.geometries=L),O.length>0&&(A.materials=O),F.length>0&&(A.textures=F),H.length>0&&(A.images=H),J.length>0&&(A.shapes=J),K.length>0&&(A.skeletons=K),Z.length>0&&(A.animations=Z),ie.length>0&&(A.nodes=ie)}return A.object=x,A;function M(L){const O=[];for(const F in L){const H=L[F];delete H.metadata,O.push(H)}return O}}clone(a){return new this.constructor().copy(this,a)}copy(a,d=!0){if(this.name=a.name,this.up.copy(a.up),this.position.copy(a.position),this.rotation.order=a.rotation.order,this.quaternion.copy(a.quaternion),this.scale.copy(a.scale),this.matrix.copy(a.matrix),this.matrixWorld.copy(a.matrixWorld),this.matrixAutoUpdate=a.matrixAutoUpdate,this.matrixWorldAutoUpdate=a.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=a.matrixWorldNeedsUpdate,this.layers.mask=a.layers.mask,this.visible=a.visible,this.castShadow=a.castShadow,this.receiveShadow=a.receiveShadow,this.frustumCulled=a.frustumCulled,this.renderOrder=a.renderOrder,this.animations=a.animations.slice(),this.userData=JSON.parse(JSON.stringify(a.userData)),d===!0)for(let A=0;A<a.children.length;A++){const x=a.children[A];this.add(x.clone())}return this}}Gn.DEFAULT_UP=new He(0,1,0),Gn.DEFAULT_MATRIX_AUTO_UPDATE=!0,Gn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Ic=new He,wh=new He,TB=new He,Ch=new He,s0=new He,a0=new He,Pj=new He,MB=new He,RB=new He,IB=new He;class Ml{constructor(a=new He,d=new He,A=new He){this.a=a,this.b=d,this.c=A}static getNormal(a,d,A,x){x.subVectors(A,d),Ic.subVectors(a,d),x.cross(Ic);const w=x.lengthSq();return w>0?x.multiplyScalar(1/Math.sqrt(w)):x.set(0,0,0)}static getBarycoord(a,d,A,x,w){Ic.subVectors(x,d),wh.subVectors(A,d),TB.subVectors(a,d);const M=Ic.dot(Ic),L=Ic.dot(wh),O=Ic.dot(TB),F=wh.dot(wh),H=wh.dot(TB),J=M*F-L*L;if(J===0)return w.set(0,0,0),null;const K=1/J,Z=(F*O-L*H)*K,ie=(M*H-L*O)*K;return w.set(1-Z-ie,ie,Z)}static containsPoint(a,d,A,x){return this.getBarycoord(a,d,A,x,Ch)===null?!1:Ch.x>=0&&Ch.y>=0&&Ch.x+Ch.y<=1}static getInterpolation(a,d,A,x,w,M,L,O){return this.getBarycoord(a,d,A,x,Ch)===null?(O.x=0,O.y=0,"z"in O&&(O.z=0),"w"in O&&(O.w=0),null):(O.setScalar(0),O.addScaledVector(w,Ch.x),O.addScaledVector(M,Ch.y),O.addScaledVector(L,Ch.z),O)}static isFrontFacing(a,d,A,x){return Ic.subVectors(A,d),wh.subVectors(a,d),Ic.cross(wh).dot(x)<0}set(a,d,A){return this.a.copy(a),this.b.copy(d),this.c.copy(A),this}setFromPointsAndIndices(a,d,A,x){return this.a.copy(a[d]),this.b.copy(a[A]),this.c.copy(a[x]),this}setFromAttributeAndIndices(a,d,A,x){return this.a.fromBufferAttribute(a,d),this.b.fromBufferAttribute(a,A),this.c.fromBufferAttribute(a,x),this}clone(){return new this.constructor().copy(this)}copy(a){return this.a.copy(a.a),this.b.copy(a.b),this.c.copy(a.c),this}getArea(){return Ic.subVectors(this.c,this.b),wh.subVectors(this.a,this.b),Ic.cross(wh).length()*.5}getMidpoint(a){return a.addVectors(this.a,this.b).add(this.c).multiplyScalar(.3333333333333333)}getNormal(a){return Ml.getNormal(this.a,this.b,this.c,a)}getPlane(a){return a.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(a,d){return Ml.getBarycoord(a,this.a,this.b,this.c,d)}getInterpolation(a,d,A,x,w){return Ml.getInterpolation(a,this.a,this.b,this.c,d,A,x,w)}containsPoint(a){return Ml.containsPoint(a,this.a,this.b,this.c)}isFrontFacing(a){return Ml.isFrontFacing(this.a,this.b,this.c,a)}intersectsBox(a){return a.intersectsTriangle(this)}closestPointToPoint(a,d){const A=this.a,x=this.b,w=this.c;let M,L;s0.subVectors(x,A),a0.subVectors(w,A),MB.subVectors(a,A);const O=s0.dot(MB),F=a0.dot(MB);if(O<=0&&F<=0)return d.copy(A);RB.subVectors(a,x);const H=s0.dot(RB),J=a0.dot(RB);if(H>=0&&J<=H)return d.copy(x);const K=O*J-H*F;if(K<=0&&O>=0&&H<=0)return M=O/(O-H),d.copy(A).addScaledVector(s0,M);IB.subVectors(a,w);const Z=s0.dot(IB),ie=a0.dot(IB);if(ie>=0&&Z<=ie)return d.copy(w);const oe=Z*F-O*ie;if(oe<=0&&F>=0&&ie<=0)return L=F/(F-ie),d.copy(A).addScaledVector(a0,L);const ne=H*ie-Z*J;if(ne<=0&&J-H>=0&&Z-ie>=0)return Pj.subVectors(w,x),L=(J-H)/(J-H+(Z-ie)),d.copy(x).addScaledVector(Pj,L);const ee=1/(ne+oe+K);return M=oe*ee,L=K*ee,d.copy(A).addScaledVector(s0,M).addScaledVector(a0,L)}equals(a){return a.a.equals(this.a)&&a.b.equals(this.b)&&a.c.equals(this.c)}}const Oj={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},kd={h:0,s:0,l:0},wE={h:0,s:0,l:0};function BB(S,a,d){return d<0&&(d+=1),d>1&&(d-=1),d<.16666666666666666?S+(a-S)*6*d:d<.5?a:d<.6666666666666666?S+(a-S)*6*(.6666666666666666-d):S}class or{constructor(a,d,A){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(a,d,A)}set(a,d,A){if(d===void 0&&A===void 0){const x=a;x&&x.isColor?this.copy(x):typeof x=="number"?this.setHex(x):typeof x=="string"&&this.setStyle(x)}else this.setRGB(a,d,A);return this}setScalar(a){return this.r=a,this.g=a,this.b=a,this}setHex(a,d=Nn){return a=Math.floor(a),this.r=(a>>16&255)/255,this.g=(a>>8&255)/255,this.b=(a&255)/255,Yn.toWorkingColorSpace(this,d),this}setRGB(a,d,A,x=Yn.workingColorSpace){return this.r=a,this.g=d,this.b=A,Yn.toWorkingColorSpace(this,x),this}setHSL(a,d,A,x=Yn.workingColorSpace){if(a=av(a,1),d=Ts(d,0,1),A=Ts(A,0,1),d===0)this.r=this.g=this.b=A;else{const w=A<=.5?A*(1+d):A+d-A*d,M=2*A-w;this.r=BB(M,w,a+.3333333333333333),this.g=BB(M,w,a),this.b=BB(M,w,a-.3333333333333333)}return Yn.toWorkingColorSpace(this,x),this}setStyle(a,d=Nn){function A(w){w!==void 0&&parseFloat(w)<1&&console.warn("THREE.Color: Alpha component of "+a+" will be ignored.")}let x;if(x=/^(\w+)\(([^\)]*)\)/.exec(a)){let w;const M=x[1],L=x[2];switch(M){case"rgb":case"rgba":if(w=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(L))return A(w[4]),this.setRGB(Math.min(255,parseInt(w[1],10))/255,Math.min(255,parseInt(w[2],10))/255,Math.min(255,parseInt(w[3],10))/255,d);if(w=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(L))return A(w[4]),this.setRGB(Math.min(100,parseInt(w[1],10))/100,Math.min(100,parseInt(w[2],10))/100,Math.min(100,parseInt(w[3],10))/100,d);break;case"hsl":case"hsla":if(w=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(L))return A(w[4]),this.setHSL(parseFloat(w[1])/360,parseFloat(w[2])/100,parseFloat(w[3])/100,d);break;default:console.warn("THREE.Color: Unknown color model "+a)}}else if(x=/^\#([A-Fa-f\d]+)$/.exec(a)){const w=x[1],M=w.length;if(M===3)return this.setRGB(parseInt(w.charAt(0),16)/15,parseInt(w.charAt(1),16)/15,parseInt(w.charAt(2),16)/15,d);if(M===6)return this.setHex(parseInt(w,16),d);console.warn("THREE.Color: Invalid hex color "+a)}else if(a&&a.length>0)return this.setColorName(a,d);return this}setColorName(a,d=Nn){const A=Oj[a.toLowerCase()];return A!==void 0?this.setHex(A,d):console.warn("THREE.Color: Unknown color "+a),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(a){return this.r=a.r,this.g=a.g,this.b=a.b,this}copySRGBToLinear(a){return this.r=Dd(a.r),this.g=Dd(a.g),this.b=Dd(a.b),this}copyLinearToSRGB(a){return this.r=lv(a.r),this.g=lv(a.g),this.b=lv(a.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(a=Nn){return Yn.fromWorkingColorSpace(lo.copy(this),a),Math.round(Ts(lo.r*255,0,255))*65536+Math.round(Ts(lo.g*255,0,255))*256+Math.round(Ts(lo.b*255,0,255))}getHexString(a=Nn){return("000000"+this.getHex(a).toString(16)).slice(-6)}getHSL(a,d=Yn.workingColorSpace){Yn.fromWorkingColorSpace(lo.copy(this),d);const A=lo.r,x=lo.g,w=lo.b,M=Math.max(A,x,w),L=Math.min(A,x,w);let O,F;const H=(L+M)/2;if(L===M)O=0,F=0;else{const J=M-L;switch(F=H<=.5?J/(M+L):J/(2-M-L),M){case A:O=(x-w)/J+(x<w?6:0);break;case x:O=(w-A)/J+2;break;case w:O=(A-x)/J+4;break}O/=6}return a.h=O,a.s=F,a.l=H,a}getRGB(a,d=Yn.workingColorSpace){return Yn.fromWorkingColorSpace(lo.copy(this),d),a.r=lo.r,a.g=lo.g,a.b=lo.b,a}getStyle(a=Nn){Yn.fromWorkingColorSpace(lo.copy(this),a);const d=lo.r,A=lo.g,x=lo.b;return a!==Nn?`color(${a} ${d.toFixed(3)} ${A.toFixed(3)} ${x.toFixed(3)})`:`rgb(${Math.round(d*255)},${Math.round(A*255)},${Math.round(x*255)})`}offsetHSL(a,d,A){return this.getHSL(kd),this.setHSL(kd.h+a,kd.s+d,kd.l+A)}add(a){return this.r+=a.r,this.g+=a.g,this.b+=a.b,this}addColors(a,d){return this.r=a.r+d.r,this.g=a.g+d.g,this.b=a.b+d.b,this}addScalar(a){return this.r+=a,this.g+=a,this.b+=a,this}sub(a){return this.r=Math.max(0,this.r-a.r),this.g=Math.max(0,this.g-a.g),this.b=Math.max(0,this.b-a.b),this}multiply(a){return this.r*=a.r,this.g*=a.g,this.b*=a.b,this}multiplyScalar(a){return this.r*=a,this.g*=a,this.b*=a,this}lerp(a,d){return this.r+=(a.r-this.r)*d,this.g+=(a.g-this.g)*d,this.b+=(a.b-this.b)*d,this}lerpColors(a,d,A){return this.r=a.r+(d.r-a.r)*A,this.g=a.g+(d.g-a.g)*A,this.b=a.b+(d.b-a.b)*A,this}lerpHSL(a,d){this.getHSL(kd),a.getHSL(wE);const A=uf(kd.h,wE.h,d),x=uf(kd.s,wE.s,d),w=uf(kd.l,wE.l,d);return this.setHSL(A,x,w),this}setFromVector3(a){return this.r=a.x,this.g=a.y,this.b=a.z,this}applyMatrix3(a){const d=this.r,A=this.g,x=this.b,w=a.elements;return this.r=w[0]*d+w[3]*A+w[6]*x,this.g=w[1]*d+w[4]*A+w[7]*x,this.b=w[2]*d+w[5]*A+w[8]*x,this}equals(a){return a.r===this.r&&a.g===this.g&&a.b===this.b}fromArray(a,d=0){return this.r=a[d],this.g=a[d+1],this.b=a[d+2],this}toArray(a=[],d=0){return a[d]=this.r,a[d+1]=this.g,a[d+2]=this.b,a}fromBufferAttribute(a,d){return this.r=a.getX(d),this.g=a.getY(d),this.b=a.getZ(d),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const lo=new or;or.NAMES=Oj;let owe=0;class co extends Mo{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:owe++}),this.uuid=Ro(),this.name="",this.type="Material",this.blending=N,this.side=C,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=ve,this.blendDst=Ae,this.blendEquation=V,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new or(0,0,0),this.blendAlpha=0,this.depthFunc=ui,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=rv,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=yh,this.stencilZFail=yh,this.stencilZPass=yh,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(a){this._alphaTest>0!=a>0&&this.version++,this._alphaTest=a}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(a){if(a!==void 0)for(const d in a){const A=a[d];if(A===void 0){console.warn(`THREE.Material: parameter '${d}' has value of undefined.`);continue}const x=this[d];if(x===void 0){console.warn(`THREE.Material: '${d}' is not a property of THREE.${this.type}.`);continue}x&&x.isColor?x.set(A):x&&x.isVector3&&A&&A.isVector3?x.copy(A):this[d]=A}}toJSON(a){const d=a===void 0||typeof a=="string";d&&(a={textures:{},images:{}});const A={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};A.uuid=this.uuid,A.type=this.type,this.name!==""&&(A.name=this.name),this.color&&this.color.isColor&&(A.color=this.color.getHex()),this.roughness!==void 0&&(A.roughness=this.roughness),this.metalness!==void 0&&(A.metalness=this.metalness),this.sheen!==void 0&&(A.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(A.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(A.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(A.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(A.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(A.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(A.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(A.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(A.shininess=this.shininess),this.clearcoat!==void 0&&(A.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(A.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(A.clearcoatMap=this.clearcoatMap.toJSON(a).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(A.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(a).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(A.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(a).uuid,A.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(A.dispersion=this.dispersion),this.iridescence!==void 0&&(A.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(A.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(A.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(A.iridescenceMap=this.iridescenceMap.toJSON(a).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(A.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(a).uuid),this.anisotropy!==void 0&&(A.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(A.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(A.anisotropyMap=this.anisotropyMap.toJSON(a).uuid),this.map&&this.map.isTexture&&(A.map=this.map.toJSON(a).uuid),this.matcap&&this.matcap.isTexture&&(A.matcap=this.matcap.toJSON(a).uuid),this.alphaMap&&this.alphaMap.isTexture&&(A.alphaMap=this.alphaMap.toJSON(a).uuid),this.lightMap&&this.lightMap.isTexture&&(A.lightMap=this.lightMap.toJSON(a).uuid,A.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(A.aoMap=this.aoMap.toJSON(a).uuid,A.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(A.bumpMap=this.bumpMap.toJSON(a).uuid,A.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(A.normalMap=this.normalMap.toJSON(a).uuid,A.normalMapType=this.normalMapType,A.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(A.displacementMap=this.displacementMap.toJSON(a).uuid,A.displacementScale=this.displacementScale,A.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(A.roughnessMap=this.roughnessMap.toJSON(a).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(A.metalnessMap=this.metalnessMap.toJSON(a).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(A.emissiveMap=this.emissiveMap.toJSON(a).uuid),this.specularMap&&this.specularMap.isTexture&&(A.specularMap=this.specularMap.toJSON(a).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(A.specularIntensityMap=this.specularIntensityMap.toJSON(a).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(A.specularColorMap=this.specularColorMap.toJSON(a).uuid),this.envMap&&this.envMap.isTexture&&(A.envMap=this.envMap.toJSON(a).uuid,this.combine!==void 0&&(A.combine=this.combine)),this.envMapRotation!==void 0&&(A.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(A.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(A.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(A.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(A.gradientMap=this.gradientMap.toJSON(a).uuid),this.transmission!==void 0&&(A.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(A.transmissionMap=this.transmissionMap.toJSON(a).uuid),this.thickness!==void 0&&(A.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(A.thicknessMap=this.thicknessMap.toJSON(a).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(A.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(A.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(A.size=this.size),this.shadowSide!==null&&(A.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(A.sizeAttenuation=this.sizeAttenuation),this.blending!==N&&(A.blending=this.blending),this.side!==C&&(A.side=this.side),this.vertexColors===!0&&(A.vertexColors=!0),this.opacity<1&&(A.opacity=this.opacity),this.transparent===!0&&(A.transparent=!0),this.blendSrc!==ve&&(A.blendSrc=this.blendSrc),this.blendDst!==Ae&&(A.blendDst=this.blendDst),this.blendEquation!==V&&(A.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(A.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(A.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(A.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(A.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(A.blendAlpha=this.blendAlpha),this.depthFunc!==ui&&(A.depthFunc=this.depthFunc),this.depthTest===!1&&(A.depthTest=this.depthTest),this.depthWrite===!1&&(A.depthWrite=this.depthWrite),this.colorWrite===!1&&(A.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(A.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==rv&&(A.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(A.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(A.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==yh&&(A.stencilFail=this.stencilFail),this.stencilZFail!==yh&&(A.stencilZFail=this.stencilZFail),this.stencilZPass!==yh&&(A.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(A.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(A.rotation=this.rotation),this.polygonOffset===!0&&(A.polygonOffset=!0),this.polygonOffsetFactor!==0&&(A.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(A.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(A.linewidth=this.linewidth),this.dashSize!==void 0&&(A.dashSize=this.dashSize),this.gapSize!==void 0&&(A.gapSize=this.gapSize),this.scale!==void 0&&(A.scale=this.scale),this.dithering===!0&&(A.dithering=!0),this.alphaTest>0&&(A.alphaTest=this.alphaTest),this.alphaHash===!0&&(A.alphaHash=!0),this.alphaToCoverage===!0&&(A.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(A.premultipliedAlpha=!0),this.forceSinglePass===!0&&(A.forceSinglePass=!0),this.wireframe===!0&&(A.wireframe=!0),this.wireframeLinewidth>1&&(A.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(A.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(A.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(A.flatShading=!0),this.visible===!1&&(A.visible=!1),this.toneMapped===!1&&(A.toneMapped=!1),this.fog===!1&&(A.fog=!1),Object.keys(this.userData).length>0&&(A.userData=this.userData);function x(w){const M=[];for(const L in w){const O=w[L];delete O.metadata,M.push(O)}return M}if(d){const w=x(a.textures),M=x(a.images);w.length>0&&(A.textures=w),M.length>0&&(A.images=M)}return A}clone(){return new this.constructor().copy(this)}copy(a){this.name=a.name,this.blending=a.blending,this.side=a.side,this.vertexColors=a.vertexColors,this.opacity=a.opacity,this.transparent=a.transparent,this.blendSrc=a.blendSrc,this.blendDst=a.blendDst,this.blendEquation=a.blendEquation,this.blendSrcAlpha=a.blendSrcAlpha,this.blendDstAlpha=a.blendDstAlpha,this.blendEquationAlpha=a.blendEquationAlpha,this.blendColor.copy(a.blendColor),this.blendAlpha=a.blendAlpha,this.depthFunc=a.depthFunc,this.depthTest=a.depthTest,this.depthWrite=a.depthWrite,this.stencilWriteMask=a.stencilWriteMask,this.stencilFunc=a.stencilFunc,this.stencilRef=a.stencilRef,this.stencilFuncMask=a.stencilFuncMask,this.stencilFail=a.stencilFail,this.stencilZFail=a.stencilZFail,this.stencilZPass=a.stencilZPass,this.stencilWrite=a.stencilWrite;const d=a.clippingPlanes;let A=null;if(d!==null){const x=d.length;A=new Array(x);for(let w=0;w!==x;++w)A[w]=d[w].clone()}return this.clippingPlanes=A,this.clipIntersection=a.clipIntersection,this.clipShadows=a.clipShadows,this.shadowSide=a.shadowSide,this.colorWrite=a.colorWrite,this.precision=a.precision,this.polygonOffset=a.polygonOffset,this.polygonOffsetFactor=a.polygonOffsetFactor,this.polygonOffsetUnits=a.polygonOffsetUnits,this.dithering=a.dithering,this.alphaTest=a.alphaTest,this.alphaHash=a.alphaHash,this.alphaToCoverage=a.alphaToCoverage,this.premultipliedAlpha=a.premultipliedAlpha,this.forceSinglePass=a.forceSinglePass,this.visible=a.visible,this.toneMapped=a.toneMapped,this.userData=JSON.parse(JSON.stringify(a.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(a){a===!0&&this.version++}}class Fd extends co{constructor(a){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new or(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Tl,this.combine=We,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.map=a.map,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.specularMap=a.specularMap,this.alphaMap=a.alphaMap,this.envMap=a.envMap,this.envMapRotation.copy(a.envMapRotation),this.combine=a.combine,this.reflectivity=a.reflectivity,this.refractionRatio=a.refractionRatio,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.fog=a.fog,this}}const Sh=lwe();function lwe(){const S=new ArrayBuffer(4),a=new Float32Array(S),d=new Uint32Array(S),A=new Uint32Array(512),x=new Uint32Array(512);for(let O=0;O<256;++O){const F=O-127;F<-27?(A[O]=0,A[O|256]=32768,x[O]=24,x[O|256]=24):F<-14?(A[O]=1024>>-F-14,A[O|256]=1024>>-F-14|32768,x[O]=-F-1,x[O|256]=-F-1):F<=15?(A[O]=F+15<<10,A[O|256]=F+15<<10|32768,x[O]=13,x[O|256]=13):F<128?(A[O]=31744,A[O|256]=64512,x[O]=24,x[O|256]=24):(A[O]=31744,A[O|256]=64512,x[O]=13,x[O|256]=13)}const w=new Uint32Array(2048),M=new Uint32Array(64),L=new Uint32Array(64);for(let O=1;O<1024;++O){let F=O<<13,H=0;for(;!(F&8388608);)F<<=1,H-=8388608;F&=-8388609,H+=947912704,w[O]=F|H}for(let O=1024;O<2048;++O)w[O]=939524096+(O-1024<<13);for(let O=1;O<31;++O)M[O]=O<<23;M[31]=1199570944,M[32]=2147483648;for(let O=33;O<63;++O)M[O]=2147483648+(O-32<<23);M[63]=3347054592;for(let O=1;O<64;++O)O!==32&&(L[O]=1024);return{floatView:a,uint32View:d,baseTable:A,shiftTable:x,mantissaTable:w,exponentTable:M,offsetTable:L}}function el(S){Math.abs(S)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),S=Ts(S,-65504,65504),Sh.floatView[0]=S;const a=Sh.uint32View[0],d=a>>23&511;return Sh.baseTable[d]+((a&8388607)>>Sh.shiftTable[d])}function dv(S){const a=S>>10;return Sh.uint32View[0]=Sh.mantissaTable[Sh.offsetTable[a]+(S&1023)]+Sh.exponentTable[a],Sh.floatView[0]}const cwe={toHalfFloat:el,fromHalfFloat:dv},ca=new He,CE=new ai;class ss{constructor(a,d,A=!1){if(Array.isArray(a))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=a,this.itemSize=d,this.count=a!==void 0?a.length/d:0,this.normalized=A,this.usage=lf,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=Rt,this.version=0}onUploadCallback(){}set needsUpdate(a){a===!0&&this.version++}get updateRange(){return gE("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(a){return this.usage=a,this}addUpdateRange(a,d){this.updateRanges.push({start:a,count:d})}clearUpdateRanges(){this.updateRanges.length=0}copy(a){return this.name=a.name,this.array=new a.array.constructor(a.array),this.itemSize=a.itemSize,this.count=a.count,this.normalized=a.normalized,this.usage=a.usage,this.gpuType=a.gpuType,this}copyAt(a,d,A){a*=this.itemSize,A*=d.itemSize;for(let x=0,w=this.itemSize;x<w;x++)this.array[a+x]=d.array[A+x];return this}copyArray(a){return this.array.set(a),this}applyMatrix3(a){if(this.itemSize===2)for(let d=0,A=this.count;d<A;d++)CE.fromBufferAttribute(this,d),CE.applyMatrix3(a),this.setXY(d,CE.x,CE.y);else if(this.itemSize===3)for(let d=0,A=this.count;d<A;d++)ca.fromBufferAttribute(this,d),ca.applyMatrix3(a),this.setXYZ(d,ca.x,ca.y,ca.z);return this}applyMatrix4(a){for(let d=0,A=this.count;d<A;d++)ca.fromBufferAttribute(this,d),ca.applyMatrix4(a),this.setXYZ(d,ca.x,ca.y,ca.z);return this}applyNormalMatrix(a){for(let d=0,A=this.count;d<A;d++)ca.fromBufferAttribute(this,d),ca.applyNormalMatrix(a),this.setXYZ(d,ca.x,ca.y,ca.z);return this}transformDirection(a){for(let d=0,A=this.count;d<A;d++)ca.fromBufferAttribute(this,d),ca.transformDirection(a),this.setXYZ(d,ca.x,ca.y,ca.z);return this}set(a,d=0){return this.array.set(a,d),this}getComponent(a,d){let A=this.array[a*this.itemSize+d];return this.normalized&&(A=Qa(A,this.array)),A}setComponent(a,d,A){return this.normalized&&(A=Kr(A,this.array)),this.array[a*this.itemSize+d]=A,this}getX(a){let d=this.array[a*this.itemSize];return this.normalized&&(d=Qa(d,this.array)),d}setX(a,d){return this.normalized&&(d=Kr(d,this.array)),this.array[a*this.itemSize]=d,this}getY(a){let d=this.array[a*this.itemSize+1];return this.normalized&&(d=Qa(d,this.array)),d}setY(a,d){return this.normalized&&(d=Kr(d,this.array)),this.array[a*this.itemSize+1]=d,this}getZ(a){let d=this.array[a*this.itemSize+2];return this.normalized&&(d=Qa(d,this.array)),d}setZ(a,d){return this.normalized&&(d=Kr(d,this.array)),this.array[a*this.itemSize+2]=d,this}getW(a){let d=this.array[a*this.itemSize+3];return this.normalized&&(d=Qa(d,this.array)),d}setW(a,d){return this.normalized&&(d=Kr(d,this.array)),this.array[a*this.itemSize+3]=d,this}setXY(a,d,A){return a*=this.itemSize,this.normalized&&(d=Kr(d,this.array),A=Kr(A,this.array)),this.array[a+0]=d,this.array[a+1]=A,this}setXYZ(a,d,A,x){return a*=this.itemSize,this.normalized&&(d=Kr(d,this.array),A=Kr(A,this.array),x=Kr(x,this.array)),this.array[a+0]=d,this.array[a+1]=A,this.array[a+2]=x,this}setXYZW(a,d,A,x,w){return a*=this.itemSize,this.normalized&&(d=Kr(d,this.array),A=Kr(A,this.array),x=Kr(x,this.array),w=Kr(w,this.array)),this.array[a+0]=d,this.array[a+1]=A,this.array[a+2]=x,this.array[a+3]=w,this}onUpload(a){return this.onUploadCallback=a,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const a={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(a.name=this.name),this.usage!==lf&&(a.usage=this.usage),a}}class uwe extends ss{constructor(a,d,A){super(new Int8Array(a),d,A)}}class hwe extends ss{constructor(a,d,A){super(new Uint8Array(a),d,A)}}class dwe extends ss{constructor(a,d,A){super(new Uint8ClampedArray(a),d,A)}}class pwe extends ss{constructor(a,d,A){super(new Int16Array(a),d,A)}}class LB extends ss{constructor(a,d,A){super(new Uint16Array(a),d,A)}}class fwe extends ss{constructor(a,d,A){super(new Int32Array(a),d,A)}}class DB extends ss{constructor(a,d,A){super(new Uint32Array(a),d,A)}}class mwe extends ss{constructor(a,d,A){super(new Uint16Array(a),d,A),this.isFloat16BufferAttribute=!0}getX(a){let d=dv(this.array[a*this.itemSize]);return this.normalized&&(d=Qa(d,this.array)),d}setX(a,d){return this.normalized&&(d=Kr(d,this.array)),this.array[a*this.itemSize]=el(d),this}getY(a){let d=dv(this.array[a*this.itemSize+1]);return this.normalized&&(d=Qa(d,this.array)),d}setY(a,d){return this.normalized&&(d=Kr(d,this.array)),this.array[a*this.itemSize+1]=el(d),this}getZ(a){let d=dv(this.array[a*this.itemSize+2]);return this.normalized&&(d=Qa(d,this.array)),d}setZ(a,d){return this.normalized&&(d=Kr(d,this.array)),this.array[a*this.itemSize+2]=el(d),this}getW(a){let d=dv(this.array[a*this.itemSize+3]);return this.normalized&&(d=Qa(d,this.array)),d}setW(a,d){return this.normalized&&(d=Kr(d,this.array)),this.array[a*this.itemSize+3]=el(d),this}setXY(a,d,A){return a*=this.itemSize,this.normalized&&(d=Kr(d,this.array),A=Kr(A,this.array)),this.array[a+0]=el(d),this.array[a+1]=el(A),this}setXYZ(a,d,A,x){return a*=this.itemSize,this.normalized&&(d=Kr(d,this.array),A=Kr(A,this.array),x=Kr(x,this.array)),this.array[a+0]=el(d),this.array[a+1]=el(A),this.array[a+2]=el(x),this}setXYZW(a,d,A,x,w){return a*=this.itemSize,this.normalized&&(d=Kr(d,this.array),A=Kr(A,this.array),x=Kr(x,this.array),w=Kr(w,this.array)),this.array[a+0]=el(d),this.array[a+1]=el(A),this.array[a+2]=el(x),this.array[a+3]=el(w),this}}class vr extends ss{constructor(a,d,A){super(new Float32Array(a),d,A)}}let gwe=0;const Wl=new fr,NB=new Gn,o0=new He,Rl=new Ds,pv=new Ds,Na=new He;class dn extends Mo{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:gwe++}),this.uuid=Ro(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(a){return Array.isArray(a)?this.index=new(pE(a)?DB:LB)(a,1):this.index=a,this}getAttribute(a){return this.attributes[a]}setAttribute(a,d){return this.attributes[a]=d,this}deleteAttribute(a){return delete this.attributes[a],this}hasAttribute(a){return this.attributes[a]!==void 0}addGroup(a,d,A=0){this.groups.push({start:a,count:d,materialIndex:A})}clearGroups(){this.groups=[]}setDrawRange(a,d){this.drawRange.start=a,this.drawRange.count=d}applyMatrix4(a){const d=this.attributes.position;d!==void 0&&(d.applyMatrix4(a),d.needsUpdate=!0);const A=this.attributes.normal;if(A!==void 0){const w=new Xr().getNormalMatrix(a);A.applyNormalMatrix(w),A.needsUpdate=!0}const x=this.attributes.tangent;return x!==void 0&&(x.transformDirection(a),x.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(a){return Wl.makeRotationFromQuaternion(a),this.applyMatrix4(Wl),this}rotateX(a){return Wl.makeRotationX(a),this.applyMatrix4(Wl),this}rotateY(a){return Wl.makeRotationY(a),this.applyMatrix4(Wl),this}rotateZ(a){return Wl.makeRotationZ(a),this.applyMatrix4(Wl),this}translate(a,d,A){return Wl.makeTranslation(a,d,A),this.applyMatrix4(Wl),this}scale(a,d,A){return Wl.makeScale(a,d,A),this.applyMatrix4(Wl),this}lookAt(a){return NB.lookAt(a),NB.updateMatrix(),this.applyMatrix4(NB.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(o0).negate(),this.translate(o0.x,o0.y,o0.z),this}setFromPoints(a){const d=[];for(let A=0,x=a.length;A<x;A++){const w=a[A];d.push(w.x,w.y,w.z||0)}return this.setAttribute("position",new vr(d,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ds);const a=this.attributes.position,d=this.morphAttributes.position;if(a&&a.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new He(-1/0,-1/0,-1/0),new He(1/0,1/0,1/0));return}if(a!==void 0){if(this.boundingBox.setFromBufferAttribute(a),d)for(let A=0,x=d.length;A<x;A++){const w=d[A];Rl.setFromBufferAttribute(w),this.morphTargetsRelative?(Na.addVectors(this.boundingBox.min,Rl.min),this.boundingBox.expandByPoint(Na),Na.addVectors(this.boundingBox.max,Rl.max),this.boundingBox.expandByPoint(Na)):(this.boundingBox.expandByPoint(Rl.min),this.boundingBox.expandByPoint(Rl.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Aa);const a=this.attributes.position,d=this.morphAttributes.position;if(a&&a.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new He,1/0);return}if(a){const A=this.boundingSphere.center;if(Rl.setFromBufferAttribute(a),d)for(let w=0,M=d.length;w<M;w++){const L=d[w];pv.setFromBufferAttribute(L),this.morphTargetsRelative?(Na.addVectors(Rl.min,pv.min),Rl.expandByPoint(Na),Na.addVectors(Rl.max,pv.max),Rl.expandByPoint(Na)):(Rl.expandByPoint(pv.min),Rl.expandByPoint(pv.max))}Rl.getCenter(A);let x=0;for(let w=0,M=a.count;w<M;w++)Na.fromBufferAttribute(a,w),x=Math.max(x,A.distanceToSquared(Na));if(d)for(let w=0,M=d.length;w<M;w++){const L=d[w],O=this.morphTargetsRelative;for(let F=0,H=L.count;F<H;F++)Na.fromBufferAttribute(L,F),O&&(o0.fromBufferAttribute(a,F),Na.add(o0)),x=Math.max(x,A.distanceToSquared(Na))}this.boundingSphere.radius=Math.sqrt(x),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const a=this.index,d=this.attributes;if(a===null||d.position===void 0||d.normal===void 0||d.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const A=d.position,x=d.normal,w=d.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new ss(new Float32Array(4*A.count),4));const M=this.getAttribute("tangent"),L=[],O=[];for(let rt=0;rt<A.count;rt++)L[rt]=new He,O[rt]=new He;const F=new He,H=new He,J=new He,K=new ai,Z=new ai,ie=new ai,oe=new He,ne=new He;function ee(rt,je,ke){F.fromBufferAttribute(A,rt),H.fromBufferAttribute(A,je),J.fromBufferAttribute(A,ke),K.fromBufferAttribute(w,rt),Z.fromBufferAttribute(w,je),ie.fromBufferAttribute(w,ke),H.sub(F),J.sub(F),Z.sub(K),ie.sub(K);const nt=1/(Z.x*ie.y-ie.x*Z.y);isFinite(nt)&&(oe.copy(H).multiplyScalar(ie.y).addScaledVector(J,-Z.y).multiplyScalar(nt),ne.copy(J).multiplyScalar(Z.x).addScaledVector(H,-ie.x).multiplyScalar(nt),L[rt].add(oe),L[je].add(oe),L[ke].add(oe),O[rt].add(ne),O[je].add(ne),O[ke].add(ne))}let Re=this.groups;Re.length===0&&(Re=[{start:0,count:a.count}]);for(let rt=0,je=Re.length;rt<je;++rt){const ke=Re[rt],nt=ke.start,gt=ke.count;for(let ft=nt,It=nt+gt;ft<It;ft+=3)ee(a.getX(ft+0),a.getX(ft+1),a.getX(ft+2))}const we=new He,_e=new He,st=new He,qe=new He;function Ze(rt){st.fromBufferAttribute(x,rt),qe.copy(st);const je=L[rt];we.copy(je),we.sub(st.multiplyScalar(st.dot(je))).normalize(),_e.crossVectors(qe,je);const ke=_e.dot(O[rt])<0?-1:1;M.setXYZW(rt,we.x,we.y,we.z,ke)}for(let rt=0,je=Re.length;rt<je;++rt){const ke=Re[rt],nt=ke.start,gt=ke.count;for(let ft=nt,It=nt+gt;ft<It;ft+=3)Ze(a.getX(ft+0)),Ze(a.getX(ft+1)),Ze(a.getX(ft+2))}}computeVertexNormals(){const a=this.index,d=this.getAttribute("position");if(d!==void 0){let A=this.getAttribute("normal");if(A===void 0)A=new ss(new Float32Array(d.count*3),3),this.setAttribute("normal",A);else for(let K=0,Z=A.count;K<Z;K++)A.setXYZ(K,0,0,0);const x=new He,w=new He,M=new He,L=new He,O=new He,F=new He,H=new He,J=new He;if(a)for(let K=0,Z=a.count;K<Z;K+=3){const ie=a.getX(K+0),oe=a.getX(K+1),ne=a.getX(K+2);x.fromBufferAttribute(d,ie),w.fromBufferAttribute(d,oe),M.fromBufferAttribute(d,ne),H.subVectors(M,w),J.subVectors(x,w),H.cross(J),L.fromBufferAttribute(A,ie),O.fromBufferAttribute(A,oe),F.fromBufferAttribute(A,ne),L.add(H),O.add(H),F.add(H),A.setXYZ(ie,L.x,L.y,L.z),A.setXYZ(oe,O.x,O.y,O.z),A.setXYZ(ne,F.x,F.y,F.z)}else for(let K=0,Z=d.count;K<Z;K+=3)x.fromBufferAttribute(d,K+0),w.fromBufferAttribute(d,K+1),M.fromBufferAttribute(d,K+2),H.subVectors(M,w),J.subVectors(x,w),H.cross(J),A.setXYZ(K+0,H.x,H.y,H.z),A.setXYZ(K+1,H.x,H.y,H.z),A.setXYZ(K+2,H.x,H.y,H.z);this.normalizeNormals(),A.needsUpdate=!0}}normalizeNormals(){const a=this.attributes.normal;for(let d=0,A=a.count;d<A;d++)Na.fromBufferAttribute(a,d),Na.normalize(),a.setXYZ(d,Na.x,Na.y,Na.z)}toNonIndexed(){function a(L,O){const F=L.array,H=L.itemSize,J=L.normalized,K=new F.constructor(O.length*H);let Z=0,ie=0;for(let oe=0,ne=O.length;oe<ne;oe++){L.isInterleavedBufferAttribute?Z=O[oe]*L.data.stride+L.offset:Z=O[oe]*H;for(let ee=0;ee<H;ee++)K[ie++]=F[Z++]}return new ss(K,H,J)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const d=new dn,A=this.index.array,x=this.attributes;for(const L in x){const O=x[L],F=a(O,A);d.setAttribute(L,F)}const w=this.morphAttributes;for(const L in w){const O=[],F=w[L];for(let H=0,J=F.length;H<J;H++){const K=F[H],Z=a(K,A);O.push(Z)}d.morphAttributes[L]=O}d.morphTargetsRelative=this.morphTargetsRelative;const M=this.groups;for(let L=0,O=M.length;L<O;L++){const F=M[L];d.addGroup(F.start,F.count,F.materialIndex)}return d}toJSON(){const a={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(a.uuid=this.uuid,a.type=this.type,this.name!==""&&(a.name=this.name),Object.keys(this.userData).length>0&&(a.userData=this.userData),this.parameters!==void 0){const O=this.parameters;for(const F in O)O[F]!==void 0&&(a[F]=O[F]);return a}a.data={attributes:{}};const d=this.index;d!==null&&(a.data.index={type:d.array.constructor.name,array:Array.prototype.slice.call(d.array)});const A=this.attributes;for(const O in A){const F=A[O];a.data.attributes[O]=F.toJSON(a.data)}const x={};let w=!1;for(const O in this.morphAttributes){const F=this.morphAttributes[O],H=[];for(let J=0,K=F.length;J<K;J++){const Z=F[J];H.push(Z.toJSON(a.data))}H.length>0&&(x[O]=H,w=!0)}w&&(a.data.morphAttributes=x,a.data.morphTargetsRelative=this.morphTargetsRelative);const M=this.groups;M.length>0&&(a.data.groups=JSON.parse(JSON.stringify(M)));const L=this.boundingSphere;return L!==null&&(a.data.boundingSphere={center:L.center.toArray(),radius:L.radius}),a}clone(){return new this.constructor().copy(this)}copy(a){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const d={};this.name=a.name;const A=a.index;A!==null&&this.setIndex(A.clone(d));const x=a.attributes;for(const F in x){const H=x[F];this.setAttribute(F,H.clone(d))}const w=a.morphAttributes;for(const F in w){const H=[],J=w[F];for(let K=0,Z=J.length;K<Z;K++)H.push(J[K].clone(d));this.morphAttributes[F]=H}this.morphTargetsRelative=a.morphTargetsRelative;const M=a.groups;for(let F=0,H=M.length;F<H;F++){const J=M[F];this.addGroup(J.start,J.count,J.materialIndex)}const L=a.boundingBox;L!==null&&(this.boundingBox=L.clone());const O=a.boundingSphere;return O!==null&&(this.boundingSphere=O.clone()),this.drawRange.start=a.drawRange.start,this.drawRange.count=a.drawRange.count,this.userData=a.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const kj=new fr,df=new ya,SE=new Aa,Fj=new He,l0=new He,c0=new He,u0=new He,PB=new He,TE=new He,ME=new ai,RE=new ai,IE=new ai,Uj=new He,zj=new He,jj=new He,BE=new He,LE=new He;class ua extends Gn{constructor(a=new dn,d=new Fd){super(),this.isMesh=!0,this.type="Mesh",this.geometry=a,this.material=d,this.updateMorphTargets()}copy(a,d){return super.copy(a,d),a.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=a.morphTargetInfluences.slice()),a.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},a.morphTargetDictionary)),this.material=Array.isArray(a.material)?a.material.slice():a.material,this.geometry=a.geometry,this}updateMorphTargets(){const a=this.geometry.morphAttributes,d=Object.keys(a);if(d.length>0){const A=a[d[0]];if(A!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let x=0,w=A.length;x<w;x++){const M=A[x].name||String(x);this.morphTargetInfluences.push(0),this.morphTargetDictionary[M]=x}}}}getVertexPosition(a,d){const A=this.geometry,x=A.attributes.position,w=A.morphAttributes.position,M=A.morphTargetsRelative;d.fromBufferAttribute(x,a);const L=this.morphTargetInfluences;if(w&&L){TE.set(0,0,0);for(let O=0,F=w.length;O<F;O++){const H=L[O],J=w[O];H!==0&&(PB.fromBufferAttribute(J,a),M?TE.addScaledVector(PB,H):TE.addScaledVector(PB.sub(d),H))}d.add(TE)}return d}raycast(a,d){const A=this.geometry,x=this.material,w=this.matrixWorld;x!==void 0&&(A.boundingSphere===null&&A.computeBoundingSphere(),SE.copy(A.boundingSphere),SE.applyMatrix4(w),df.copy(a.ray).recast(a.near),!(SE.containsPoint(df.origin)===!1&&(df.intersectSphere(SE,Fj)===null||df.origin.distanceToSquared(Fj)>(a.far-a.near)**2))&&(kj.copy(w).invert(),df.copy(a.ray).applyMatrix4(kj),!(A.boundingBox!==null&&df.intersectsBox(A.boundingBox)===!1)&&this._computeIntersections(a,d,df)))}_computeIntersections(a,d,A){let x;const w=this.geometry,M=this.material,L=w.index,O=w.attributes.position,F=w.attributes.uv,H=w.attributes.uv1,J=w.attributes.normal,K=w.groups,Z=w.drawRange;if(L!==null)if(Array.isArray(M))for(let ie=0,oe=K.length;ie<oe;ie++){const ne=K[ie],ee=M[ne.materialIndex],Re=Math.max(ne.start,Z.start),we=Math.min(L.count,Math.min(ne.start+ne.count,Z.start+Z.count));for(let _e=Re,st=we;_e<st;_e+=3){const qe=L.getX(_e),Ze=L.getX(_e+1),rt=L.getX(_e+2);x=DE(this,ee,a,A,F,H,J,qe,Ze,rt),x&&(x.faceIndex=Math.floor(_e/3),x.face.materialIndex=ne.materialIndex,d.push(x))}}else{const ie=Math.max(0,Z.start),oe=Math.min(L.count,Z.start+Z.count);for(let ne=ie,ee=oe;ne<ee;ne+=3){const Re=L.getX(ne),we=L.getX(ne+1),_e=L.getX(ne+2);x=DE(this,M,a,A,F,H,J,Re,we,_e),x&&(x.faceIndex=Math.floor(ne/3),d.push(x))}}else if(O!==void 0)if(Array.isArray(M))for(let ie=0,oe=K.length;ie<oe;ie++){const ne=K[ie],ee=M[ne.materialIndex],Re=Math.max(ne.start,Z.start),we=Math.min(O.count,Math.min(ne.start+ne.count,Z.start+Z.count));for(let _e=Re,st=we;_e<st;_e+=3){const qe=_e,Ze=_e+1,rt=_e+2;x=DE(this,ee,a,A,F,H,J,qe,Ze,rt),x&&(x.faceIndex=Math.floor(_e/3),x.face.materialIndex=ne.materialIndex,d.push(x))}}else{const ie=Math.max(0,Z.start),oe=Math.min(O.count,Z.start+Z.count);for(let ne=ie,ee=oe;ne<ee;ne+=3){const Re=ne,we=ne+1,_e=ne+2;x=DE(this,M,a,A,F,H,J,Re,we,_e),x&&(x.faceIndex=Math.floor(ne/3),d.push(x))}}}}function Awe(S,a,d,A,x,w,M,L){let O;if(a.side===R?O=A.intersectTriangle(M,w,x,!0,L):O=A.intersectTriangle(x,w,M,a.side===C,L),O===null)return null;LE.copy(L),LE.applyMatrix4(S.matrixWorld);const F=d.ray.origin.distanceTo(LE);return F<d.near||F>d.far?null:{distance:F,point:LE.clone(),object:S}}function DE(S,a,d,A,x,w,M,L,O,F){S.getVertexPosition(L,l0),S.getVertexPosition(O,c0),S.getVertexPosition(F,u0);const H=Awe(S,a,d,A,l0,c0,u0,BE);if(H){x&&(ME.fromBufferAttribute(x,L),RE.fromBufferAttribute(x,O),IE.fromBufferAttribute(x,F),H.uv=Ml.getInterpolation(BE,l0,c0,u0,ME,RE,IE,new ai)),w&&(ME.fromBufferAttribute(w,L),RE.fromBufferAttribute(w,O),IE.fromBufferAttribute(w,F),H.uv1=Ml.getInterpolation(BE,l0,c0,u0,ME,RE,IE,new ai)),M&&(Uj.fromBufferAttribute(M,L),zj.fromBufferAttribute(M,O),jj.fromBufferAttribute(M,F),H.normal=Ml.getInterpolation(BE,l0,c0,u0,Uj,zj,jj,new He),H.normal.dot(A.direction)>0&&H.normal.multiplyScalar(-1));const J={a:L,b:O,c:F,normal:new He,materialIndex:0};Ml.getNormal(l0,c0,u0,J.normal),H.face=J}return H}class pf extends dn{constructor(a=1,d=1,A=1,x=1,w=1,M=1){super(),this.type="BoxGeometry",this.parameters={width:a,height:d,depth:A,widthSegments:x,heightSegments:w,depthSegments:M};const L=this;x=Math.floor(x),w=Math.floor(w),M=Math.floor(M);const O=[],F=[],H=[],J=[];let K=0,Z=0;ie("z","y","x",-1,-1,A,d,a,M,w,0),ie("z","y","x",1,-1,A,d,-a,M,w,1),ie("x","z","y",1,1,a,A,d,x,M,2),ie("x","z","y",1,-1,a,A,-d,x,M,3),ie("x","y","z",1,-1,a,d,A,x,w,4),ie("x","y","z",-1,-1,a,d,-A,x,w,5),this.setIndex(O),this.setAttribute("position",new vr(F,3)),this.setAttribute("normal",new vr(H,3)),this.setAttribute("uv",new vr(J,2));function ie(oe,ne,ee,Re,we,_e,st,qe,Ze,rt,je){const ke=_e/Ze,nt=st/rt,gt=_e/2,ft=st/2,It=qe/2,Ft=Ze+1,pi=rt+1;let Ni=0,Ut=0;const yi=new He;for(let Pi=0;Pi<pi;Pi++){const Ur=Pi*nt-ft;for(let xn=0;xn<Ft;xn++){const ts=xn*ke-gt;yi[oe]=ts*Re,yi[ne]=Ur*we,yi[ee]=It,F.push(yi.x,yi.y,yi.z),yi[oe]=0,yi[ne]=0,yi[ee]=qe>0?1:-1,H.push(yi.x,yi.y,yi.z),J.push(xn/Ze),J.push(1-Pi/rt),Ni+=1}}for(let Pi=0;Pi<rt;Pi++)for(let Ur=0;Ur<Ze;Ur++){const xn=K+Ur+Ft*Pi,ts=K+Ur+Ft*(Pi+1),ds=K+(Ur+1)+Ft*(Pi+1),zn=K+(Ur+1)+Ft*Pi;O.push(xn,ts,zn),O.push(ts,ds,zn),Ut+=6}L.addGroup(Z,Ut,je),Z+=Ut,K+=Ni}}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new pf(a.width,a.height,a.depth,a.widthSegments,a.heightSegments,a.depthSegments)}}function h0(S){const a={};for(const d in S){a[d]={};for(const A in S[d]){const x=S[d][A];x&&(x.isColor||x.isMatrix3||x.isMatrix4||x.isVector2||x.isVector3||x.isVector4||x.isTexture||x.isQuaternion)?x.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),a[d][A]=null):a[d][A]=x.clone():Array.isArray(x)?a[d][A]=x.slice():a[d][A]=x}}return a}function Bo(S){const a={};for(let d=0;d<S.length;d++){const A=h0(S[d]);for(const x in A)a[x]=A[x]}return a}function ywe(S){const a=[];for(let d=0;d<S.length;d++)a.push(S[d].clone());return a}function Vj(S){const a=S.getRenderTarget();return a===null?S.outputColorSpace:a.isXRRenderTarget===!0?a.texture.colorSpace:Yn.workingColorSpace}const Gj={clone:h0,merge:Bo};var vwe=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,bwe=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Bc extends co{constructor(a){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=vwe,this.fragmentShader=bwe,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,a!==void 0&&this.setValues(a)}copy(a){return super.copy(a),this.fragmentShader=a.fragmentShader,this.vertexShader=a.vertexShader,this.uniforms=h0(a.uniforms),this.uniformsGroups=ywe(a.uniformsGroups),this.defines=Object.assign({},a.defines),this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.fog=a.fog,this.lights=a.lights,this.clipping=a.clipping,this.extensions=Object.assign({},a.extensions),this.glslVersion=a.glslVersion,this}toJSON(a){const d=super.toJSON(a);d.glslVersion=this.glslVersion,d.uniforms={};for(const x in this.uniforms){const w=this.uniforms[x].value;w&&w.isTexture?d.uniforms[x]={type:"t",value:w.toJSON(a).uuid}:w&&w.isColor?d.uniforms[x]={type:"c",value:w.getHex()}:w&&w.isVector2?d.uniforms[x]={type:"v2",value:w.toArray()}:w&&w.isVector3?d.uniforms[x]={type:"v3",value:w.toArray()}:w&&w.isVector4?d.uniforms[x]={type:"v4",value:w.toArray()}:w&&w.isMatrix3?d.uniforms[x]={type:"m3",value:w.toArray()}:w&&w.isMatrix4?d.uniforms[x]={type:"m4",value:w.toArray()}:d.uniforms[x]={value:w}}Object.keys(this.defines).length>0&&(d.defines=this.defines),d.vertexShader=this.vertexShader,d.fragmentShader=this.fragmentShader,d.lights=this.lights,d.clipping=this.clipping;const A={};for(const x in this.extensions)this.extensions[x]===!0&&(A[x]=!0);return Object.keys(A).length>0&&(d.extensions=A),d}}class NE extends Gn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new fr,this.projectionMatrix=new fr,this.projectionMatrixInverse=new fr,this.coordinateSystem=Gl}copy(a,d){return super.copy(a,d),this.matrixWorldInverse.copy(a.matrixWorldInverse),this.projectionMatrix.copy(a.projectionMatrix),this.projectionMatrixInverse.copy(a.projectionMatrixInverse),this.coordinateSystem=a.coordinateSystem,this}getWorldDirection(a){return super.getWorldDirection(a).negate()}updateMatrixWorld(a){super.updateMatrixWorld(a),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(a,d){super.updateWorldMatrix(a,d),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const Ud=new He,Hj=new ai,Wj=new ai;class va extends NE{constructor(a=50,d=1,A=.1,x=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=a,this.zoom=1,this.near=A,this.far=x,this.focus=10,this.aspect=d,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(a,d){return super.copy(a,d),this.fov=a.fov,this.zoom=a.zoom,this.near=a.near,this.far=a.far,this.focus=a.focus,this.aspect=a.aspect,this.view=a.view===null?null:Object.assign({},a.view),this.filmGauge=a.filmGauge,this.filmOffset=a.filmOffset,this}setFocalLength(a){const d=.5*this.getFilmHeight()/a;this.fov=Bd*2*Math.atan(d),this.updateProjectionMatrix()}getFocalLength(){const a=Math.tan(vh*.5*this.fov);return .5*this.getFilmHeight()/a}getEffectiveFOV(){return Bd*2*Math.atan(Math.tan(vh*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(a,d,A){Ud.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),d.set(Ud.x,Ud.y).multiplyScalar(-a/Ud.z),Ud.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),A.set(Ud.x,Ud.y).multiplyScalar(-a/Ud.z)}getViewSize(a,d){return this.getViewBounds(a,Hj,Wj),d.subVectors(Wj,Hj)}setViewOffset(a,d,A,x,w,M){this.aspect=a/d,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=a,this.view.fullHeight=d,this.view.offsetX=A,this.view.offsetY=x,this.view.width=w,this.view.height=M,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const a=this.near;let d=a*Math.tan(vh*.5*this.fov)/this.zoom,A=2*d,x=this.aspect*A,w=-.5*x;const M=this.view;if(this.view!==null&&this.view.enabled){const O=M.fullWidth,F=M.fullHeight;w+=M.offsetX*x/O,d-=M.offsetY*A/F,x*=M.width/O,A*=M.height/F}const L=this.filmOffset;L!==0&&(w+=a*L/this.getFilmWidth()),this.projectionMatrix.makePerspective(w,w+x,d,d-A,a,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(a){const d=super.toJSON(a);return d.object.fov=this.fov,d.object.zoom=this.zoom,d.object.near=this.near,d.object.far=this.far,d.object.focus=this.focus,d.object.aspect=this.aspect,this.view!==null&&(d.object.view=Object.assign({},this.view)),d.object.filmGauge=this.filmGauge,d.object.filmOffset=this.filmOffset,d}}const d0=-90,p0=1;class Qj extends Gn{constructor(a,d,A){super(),this.type="CubeCamera",this.renderTarget=A,this.coordinateSystem=null,this.activeMipmapLevel=0;const x=new va(d0,p0,a,d);x.layers=this.layers,this.add(x);const w=new va(d0,p0,a,d);w.layers=this.layers,this.add(w);const M=new va(d0,p0,a,d);M.layers=this.layers,this.add(M);const L=new va(d0,p0,a,d);L.layers=this.layers,this.add(L);const O=new va(d0,p0,a,d);O.layers=this.layers,this.add(O);const F=new va(d0,p0,a,d);F.layers=this.layers,this.add(F)}updateCoordinateSystem(){const a=this.coordinateSystem,d=this.children.concat(),[A,x,w,M,L,O]=d;for(const F of d)this.remove(F);if(a===Gl)A.up.set(0,1,0),A.lookAt(1,0,0),x.up.set(0,1,0),x.lookAt(-1,0,0),w.up.set(0,0,-1),w.lookAt(0,1,0),M.up.set(0,0,1),M.lookAt(0,-1,0),L.up.set(0,1,0),L.lookAt(0,0,1),O.up.set(0,1,0),O.lookAt(0,0,-1);else if(a===cf)A.up.set(0,-1,0),A.lookAt(-1,0,0),x.up.set(0,-1,0),x.lookAt(1,0,0),w.up.set(0,0,1),w.lookAt(0,1,0),M.up.set(0,0,-1),M.lookAt(0,-1,0),L.up.set(0,-1,0),L.lookAt(0,0,1),O.up.set(0,-1,0),O.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+a);for(const F of d)this.add(F),F.updateMatrixWorld()}update(a,d){this.parent===null&&this.updateMatrixWorld();const{renderTarget:A,activeMipmapLevel:x}=this;this.coordinateSystem!==a.coordinateSystem&&(this.coordinateSystem=a.coordinateSystem,this.updateCoordinateSystem());const[w,M,L,O,F,H]=this.children,J=a.getRenderTarget(),K=a.getActiveCubeFace(),Z=a.getActiveMipmapLevel(),ie=a.xr.enabled;a.xr.enabled=!1;const oe=A.texture.generateMipmaps;A.texture.generateMipmaps=!1,a.setRenderTarget(A,0,x),a.render(d,w),a.setRenderTarget(A,1,x),a.render(d,M),a.setRenderTarget(A,2,x),a.render(d,L),a.setRenderTarget(A,3,x),a.render(d,O),a.setRenderTarget(A,4,x),a.render(d,F),A.texture.generateMipmaps=oe,a.setRenderTarget(A,5,x),a.render(d,H),a.setRenderTarget(J,K,Z),a.xr.enabled=ie,A.texture.needsPMREMUpdate=!0}}class fv extends hs{constructor(a,d,A,x,w,M,L,O,F,H){a=a!==void 0?a:[],d=d!==void 0?d:U,super(a,d,A,x,w,M,L,O,F,H),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(a){this.image=a}}class qj extends Jo{constructor(a=1,d={}){super(a,a,d),this.isWebGLCubeRenderTarget=!0;const A={width:a,height:a,depth:1},x=[A,A,A,A,A,A];this.texture=new fv(x,d.mapping,d.wrapS,d.wrapT,d.magFilter,d.minFilter,d.format,d.type,d.anisotropy,d.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=d.generateMipmaps!==void 0?d.generateMipmaps:!1,this.texture.minFilter=d.minFilter!==void 0?d.minFilter:ki}fromEquirectangularTexture(a,d){this.texture.type=d.type,this.texture.colorSpace=d.colorSpace,this.texture.generateMipmaps=d.generateMipmaps,this.texture.minFilter=d.minFilter,this.texture.magFilter=d.magFilter;const A={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},x=new pf(5,5,5),w=new Bc({name:"CubemapFromEquirect",uniforms:h0(A.uniforms),vertexShader:A.vertexShader,fragmentShader:A.fragmentShader,side:R,blending:I});w.uniforms.tEquirect.value=d;const M=new ua(x,w),L=d.minFilter;return d.minFilter===rn&&(d.minFilter=ki),new Qj(1,10,this).update(a,M),d.minFilter=L,M.geometry.dispose(),M.material.dispose(),this}clear(a,d,A,x){const w=a.getRenderTarget();for(let M=0;M<6;M++)a.setRenderTarget(this,M),a.clear(d,A,x);a.setRenderTarget(w)}}const OB=new He,xwe=new He,_we=new Xr;class zd{constructor(a=new He(1,0,0),d=0){this.isPlane=!0,this.normal=a,this.constant=d}set(a,d){return this.normal.copy(a),this.constant=d,this}setComponents(a,d,A,x){return this.normal.set(a,d,A),this.constant=x,this}setFromNormalAndCoplanarPoint(a,d){return this.normal.copy(a),this.constant=-d.dot(this.normal),this}setFromCoplanarPoints(a,d,A){const x=OB.subVectors(A,d).cross(xwe.subVectors(a,d)).normalize();return this.setFromNormalAndCoplanarPoint(x,a),this}copy(a){return this.normal.copy(a.normal),this.constant=a.constant,this}normalize(){const a=1/this.normal.length();return this.normal.multiplyScalar(a),this.constant*=a,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(a){return this.normal.dot(a)+this.constant}distanceToSphere(a){return this.distanceToPoint(a.center)-a.radius}projectPoint(a,d){return d.copy(a).addScaledVector(this.normal,-this.distanceToPoint(a))}intersectLine(a,d){const A=a.delta(OB),x=this.normal.dot(A);if(x===0)return this.distanceToPoint(a.start)===0?d.copy(a.start):null;const w=-(a.start.dot(this.normal)+this.constant)/x;return w<0||w>1?null:d.copy(a.start).addScaledVector(A,w)}intersectsLine(a){const d=this.distanceToPoint(a.start),A=this.distanceToPoint(a.end);return d<0&&A>0||A<0&&d>0}intersectsBox(a){return a.intersectsPlane(this)}intersectsSphere(a){return a.intersectsPlane(this)}coplanarPoint(a){return a.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(a,d){const A=d||_we.getNormalMatrix(a),x=this.coplanarPoint(OB).applyMatrix4(a),w=this.normal.applyMatrix3(A).normalize();return this.constant=-x.dot(w),this}translate(a){return this.constant-=a.dot(this.normal),this}equals(a){return a.normal.equals(this.normal)&&a.constant===this.constant}clone(){return new this.constructor().copy(this)}}const ff=new Aa,PE=new He;class mv{constructor(a=new zd,d=new zd,A=new zd,x=new zd,w=new zd,M=new zd){this.planes=[a,d,A,x,w,M]}set(a,d,A,x,w,M){const L=this.planes;return L[0].copy(a),L[1].copy(d),L[2].copy(A),L[3].copy(x),L[4].copy(w),L[5].copy(M),this}copy(a){const d=this.planes;for(let A=0;A<6;A++)d[A].copy(a.planes[A]);return this}setFromProjectionMatrix(a,d=Gl){const A=this.planes,x=a.elements,w=x[0],M=x[1],L=x[2],O=x[3],F=x[4],H=x[5],J=x[6],K=x[7],Z=x[8],ie=x[9],oe=x[10],ne=x[11],ee=x[12],Re=x[13],we=x[14],_e=x[15];if(A[0].setComponents(O-w,K-F,ne-Z,_e-ee).normalize(),A[1].setComponents(O+w,K+F,ne+Z,_e+ee).normalize(),A[2].setComponents(O+M,K+H,ne+ie,_e+Re).normalize(),A[3].setComponents(O-M,K-H,ne-ie,_e-Re).normalize(),A[4].setComponents(O-L,K-J,ne-oe,_e-we).normalize(),d===Gl)A[5].setComponents(O+L,K+J,ne+oe,_e+we).normalize();else if(d===cf)A[5].setComponents(L,J,oe,we).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+d);return this}intersectsObject(a){if(a.boundingSphere!==void 0)a.boundingSphere===null&&a.computeBoundingSphere(),ff.copy(a.boundingSphere).applyMatrix4(a.matrixWorld);else{const d=a.geometry;d.boundingSphere===null&&d.computeBoundingSphere(),ff.copy(d.boundingSphere).applyMatrix4(a.matrixWorld)}return this.intersectsSphere(ff)}intersectsSprite(a){return ff.center.set(0,0,0),ff.radius=.7071067811865476,ff.applyMatrix4(a.matrixWorld),this.intersectsSphere(ff)}intersectsSphere(a){const d=this.planes,A=a.center,x=-a.radius;for(let w=0;w<6;w++)if(d[w].distanceToPoint(A)<x)return!1;return!0}intersectsBox(a){const d=this.planes;for(let A=0;A<6;A++){const x=d[A];if(PE.x=x.normal.x>0?a.max.x:a.min.x,PE.y=x.normal.y>0?a.max.y:a.min.y,PE.z=x.normal.z>0?a.max.z:a.min.z,x.distanceToPoint(PE)<0)return!1}return!0}containsPoint(a){const d=this.planes;for(let A=0;A<6;A++)if(d[A].distanceToPoint(a)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function kB(){let S=null,a=!1,d=null,A=null;function x(w,M){d(w,M),A=S.requestAnimationFrame(x)}return{start:function(){a!==!0&&d!==null&&(A=S.requestAnimationFrame(x),a=!0)},stop:function(){S.cancelAnimationFrame(A),a=!1},setAnimationLoop:function(w){d=w},setContext:function(w){S=w}}}function Ewe(S){const a=new WeakMap;function d(L,O){const F=L.array,H=L.usage,J=F.byteLength,K=S.createBuffer();S.bindBuffer(O,K),S.bufferData(O,F,H),L.onUploadCallback();let Z;if(F instanceof Float32Array)Z=S.FLOAT;else if(F instanceof Uint16Array)L.isFloat16BufferAttribute?Z=S.HALF_FLOAT:Z=S.UNSIGNED_SHORT;else if(F instanceof Int16Array)Z=S.SHORT;else if(F instanceof Uint32Array)Z=S.UNSIGNED_INT;else if(F instanceof Int32Array)Z=S.INT;else if(F instanceof Int8Array)Z=S.BYTE;else if(F instanceof Uint8Array)Z=S.UNSIGNED_BYTE;else if(F instanceof Uint8ClampedArray)Z=S.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+F);return{buffer:K,type:Z,bytesPerElement:F.BYTES_PER_ELEMENT,version:L.version,size:J}}function A(L,O,F){const H=O.array,J=O._updateRange,K=O.updateRanges;if(S.bindBuffer(F,L),J.count===-1&&K.length===0&&S.bufferSubData(F,0,H),K.length!==0){for(let Z=0,ie=K.length;Z<ie;Z++){const oe=K[Z];S.bufferSubData(F,oe.start*H.BYTES_PER_ELEMENT,H,oe.start,oe.count)}O.clearUpdateRanges()}J.count!==-1&&(S.bufferSubData(F,J.offset*H.BYTES_PER_ELEMENT,H,J.offset,J.count),J.count=-1),O.onUploadCallback()}function x(L){return L.isInterleavedBufferAttribute&&(L=L.data),a.get(L)}function w(L){L.isInterleavedBufferAttribute&&(L=L.data);const O=a.get(L);O&&(S.deleteBuffer(O.buffer),a.delete(L))}function M(L,O){if(L.isGLBufferAttribute){const H=a.get(L);(!H||H.version<L.version)&&a.set(L,{buffer:L.buffer,type:L.type,bytesPerElement:L.elementSize,version:L.version});return}L.isInterleavedBufferAttribute&&(L=L.data);const F=a.get(L);if(F===void 0)a.set(L,d(L,O));else if(F.version<L.version){if(F.size!==L.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");A(F.buffer,L,O),F.version=L.version}}return{get:x,remove:w,update:M}}class f0 extends dn{constructor(a=1,d=1,A=1,x=1){super(),this.type="PlaneGeometry",this.parameters={width:a,height:d,widthSegments:A,heightSegments:x};const w=a/2,M=d/2,L=Math.floor(A),O=Math.floor(x),F=L+1,H=O+1,J=a/L,K=d/O,Z=[],ie=[],oe=[],ne=[];for(let ee=0;ee<H;ee++){const Re=ee*K-M;for(let we=0;we<F;we++){const _e=we*J-w;ie.push(_e,-Re,0),oe.push(0,0,1),ne.push(we/L),ne.push(1-ee/O)}}for(let ee=0;ee<O;ee++)for(let Re=0;Re<L;Re++){const we=Re+F*ee,_e=Re+F*(ee+1),st=Re+1+F*(ee+1),qe=Re+1+F*ee;Z.push(we,_e,qe),Z.push(_e,st,qe)}this.setIndex(Z),this.setAttribute("position",new vr(ie,3)),this.setAttribute("normal",new vr(oe,3)),this.setAttribute("uv",new vr(ne,2))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new f0(a.width,a.height,a.widthSegments,a.heightSegments)}}var wwe=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,Cwe=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,Swe=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,Twe=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Mwe=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,Rwe=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,Iwe=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,Bwe=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,Lwe=`#ifdef USE_BATCHING
	attribute float batchId;
	uniform highp sampler2D batchingTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,Dwe=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( batchId );
#endif`,Nwe=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,Pwe=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,Owe=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,kwe=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,Fwe=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,Uwe=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,zwe=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,jwe=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,Vwe=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,Gwe=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,Hwe=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,Wwe=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,Qwe=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,qwe=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,Xwe=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,Ywe=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,Kwe=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,Jwe=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,Zwe=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,$we=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,e2e="gl_FragColor = linearToOutputTexel( gl_FragColor );",t2e=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return sRGBTransferOETF( value );
}`,i2e=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,r2e=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,n2e=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,s2e=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,a2e=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,o2e=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,l2e=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,c2e=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,u2e=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,h2e=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,d2e=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,p2e=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,f2e=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,m2e=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,g2e=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,A2e=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,y2e=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,v2e=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,b2e=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,x2e=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,_2e=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,E2e=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,w2e=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,C2e=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,S2e=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,T2e=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,M2e=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,R2e=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,I2e=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,B2e=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,L2e=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,D2e=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,N2e=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,P2e=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,O2e=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[MORPHTARGETS_COUNT];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,k2e=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,F2e=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,U2e=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
	#endif
	#ifdef MORPHTARGETS_TEXTURE
		#ifndef USE_INSTANCING_MORPH
			uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		#endif
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,z2e=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,j2e=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,V2e=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,G2e=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,H2e=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,W2e=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,Q2e=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,q2e=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,X2e=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,Y2e=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,K2e=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,J2e=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,Z2e=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,$2e=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,eCe=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,tCe=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,iCe=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,rCe=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,nCe=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,sCe=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return shadow;
	}
#endif`,aCe=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,oCe=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,lCe=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,cCe=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,uCe=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,hCe=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,dCe=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,pCe=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,fCe=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,mCe=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,gCe=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,ACe=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,yCe=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
		
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
		
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		
		#else
		
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,vCe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,bCe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,xCe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,_Ce=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const an={alphahash_fragment:wwe,alphahash_pars_fragment:Cwe,alphamap_fragment:Swe,alphamap_pars_fragment:Twe,alphatest_fragment:Mwe,alphatest_pars_fragment:Rwe,aomap_fragment:Iwe,aomap_pars_fragment:Bwe,batching_pars_vertex:Lwe,batching_vertex:Dwe,begin_vertex:Nwe,beginnormal_vertex:Pwe,bsdfs:Owe,iridescence_fragment:kwe,bumpmap_pars_fragment:Fwe,clipping_planes_fragment:Uwe,clipping_planes_pars_fragment:zwe,clipping_planes_pars_vertex:jwe,clipping_planes_vertex:Vwe,color_fragment:Gwe,color_pars_fragment:Hwe,color_pars_vertex:Wwe,color_vertex:Qwe,common:qwe,cube_uv_reflection_fragment:Xwe,defaultnormal_vertex:Ywe,displacementmap_pars_vertex:Kwe,displacementmap_vertex:Jwe,emissivemap_fragment:Zwe,emissivemap_pars_fragment:$we,colorspace_fragment:e2e,colorspace_pars_fragment:t2e,envmap_fragment:i2e,envmap_common_pars_fragment:r2e,envmap_pars_fragment:n2e,envmap_pars_vertex:s2e,envmap_physical_pars_fragment:g2e,envmap_vertex:a2e,fog_vertex:o2e,fog_pars_vertex:l2e,fog_fragment:c2e,fog_pars_fragment:u2e,gradientmap_pars_fragment:h2e,lightmap_pars_fragment:d2e,lights_lambert_fragment:p2e,lights_lambert_pars_fragment:f2e,lights_pars_begin:m2e,lights_toon_fragment:A2e,lights_toon_pars_fragment:y2e,lights_phong_fragment:v2e,lights_phong_pars_fragment:b2e,lights_physical_fragment:x2e,lights_physical_pars_fragment:_2e,lights_fragment_begin:E2e,lights_fragment_maps:w2e,lights_fragment_end:C2e,logdepthbuf_fragment:S2e,logdepthbuf_pars_fragment:T2e,logdepthbuf_pars_vertex:M2e,logdepthbuf_vertex:R2e,map_fragment:I2e,map_pars_fragment:B2e,map_particle_fragment:L2e,map_particle_pars_fragment:D2e,metalnessmap_fragment:N2e,metalnessmap_pars_fragment:P2e,morphinstance_vertex:O2e,morphcolor_vertex:k2e,morphnormal_vertex:F2e,morphtarget_pars_vertex:U2e,morphtarget_vertex:z2e,normal_fragment_begin:j2e,normal_fragment_maps:V2e,normal_pars_fragment:G2e,normal_pars_vertex:H2e,normal_vertex:W2e,normalmap_pars_fragment:Q2e,clearcoat_normal_fragment_begin:q2e,clearcoat_normal_fragment_maps:X2e,clearcoat_pars_fragment:Y2e,iridescence_pars_fragment:K2e,opaque_fragment:J2e,packing:Z2e,premultiplied_alpha_fragment:$2e,project_vertex:eCe,dithering_fragment:tCe,dithering_pars_fragment:iCe,roughnessmap_fragment:rCe,roughnessmap_pars_fragment:nCe,shadowmap_pars_fragment:sCe,shadowmap_pars_vertex:aCe,shadowmap_vertex:oCe,shadowmask_pars_fragment:lCe,skinbase_vertex:cCe,skinning_pars_vertex:uCe,skinning_vertex:hCe,skinnormal_vertex:dCe,specularmap_fragment:pCe,specularmap_pars_fragment:fCe,tonemapping_fragment:mCe,tonemapping_pars_fragment:gCe,transmission_fragment:ACe,transmission_pars_fragment:yCe,uv_pars_fragment:vCe,uv_pars_vertex:bCe,uv_vertex:xCe,worldpos_vertex:_Ce,background_vert:`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,background_frag:`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,backgroundCube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,backgroundCube_frag:`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,cube_frag:`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,depth_vert:`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,meshbasic_vert:`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshnormal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,meshnormal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,shadow_vert:`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`},Qi={common:{diffuse:{value:new or(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Xr},alphaMap:{value:null},alphaMapTransform:{value:new Xr},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Xr}},envmap:{envMap:{value:null},envMapRotation:{value:new Xr},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Xr}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Xr}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Xr},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Xr},normalScale:{value:new ai(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Xr},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Xr}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Xr}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Xr}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new or(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new or(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Xr},alphaTest:{value:0},uvTransform:{value:new Xr}},sprite:{diffuse:{value:new or(16777215)},opacity:{value:1},center:{value:new ai(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Xr},alphaMap:{value:null},alphaMapTransform:{value:new Xr},alphaTest:{value:0}}},Lc={basic:{uniforms:Bo([Qi.common,Qi.specularmap,Qi.envmap,Qi.aomap,Qi.lightmap,Qi.fog]),vertexShader:an.meshbasic_vert,fragmentShader:an.meshbasic_frag},lambert:{uniforms:Bo([Qi.common,Qi.specularmap,Qi.envmap,Qi.aomap,Qi.lightmap,Qi.emissivemap,Qi.bumpmap,Qi.normalmap,Qi.displacementmap,Qi.fog,Qi.lights,{emissive:{value:new or(0)}}]),vertexShader:an.meshlambert_vert,fragmentShader:an.meshlambert_frag},phong:{uniforms:Bo([Qi.common,Qi.specularmap,Qi.envmap,Qi.aomap,Qi.lightmap,Qi.emissivemap,Qi.bumpmap,Qi.normalmap,Qi.displacementmap,Qi.fog,Qi.lights,{emissive:{value:new or(0)},specular:{value:new or(1118481)},shininess:{value:30}}]),vertexShader:an.meshphong_vert,fragmentShader:an.meshphong_frag},standard:{uniforms:Bo([Qi.common,Qi.envmap,Qi.aomap,Qi.lightmap,Qi.emissivemap,Qi.bumpmap,Qi.normalmap,Qi.displacementmap,Qi.roughnessmap,Qi.metalnessmap,Qi.fog,Qi.lights,{emissive:{value:new or(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:an.meshphysical_vert,fragmentShader:an.meshphysical_frag},toon:{uniforms:Bo([Qi.common,Qi.aomap,Qi.lightmap,Qi.emissivemap,Qi.bumpmap,Qi.normalmap,Qi.displacementmap,Qi.gradientmap,Qi.fog,Qi.lights,{emissive:{value:new or(0)}}]),vertexShader:an.meshtoon_vert,fragmentShader:an.meshtoon_frag},matcap:{uniforms:Bo([Qi.common,Qi.bumpmap,Qi.normalmap,Qi.displacementmap,Qi.fog,{matcap:{value:null}}]),vertexShader:an.meshmatcap_vert,fragmentShader:an.meshmatcap_frag},points:{uniforms:Bo([Qi.points,Qi.fog]),vertexShader:an.points_vert,fragmentShader:an.points_frag},dashed:{uniforms:Bo([Qi.common,Qi.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:an.linedashed_vert,fragmentShader:an.linedashed_frag},depth:{uniforms:Bo([Qi.common,Qi.displacementmap]),vertexShader:an.depth_vert,fragmentShader:an.depth_frag},normal:{uniforms:Bo([Qi.common,Qi.bumpmap,Qi.normalmap,Qi.displacementmap,{opacity:{value:1}}]),vertexShader:an.meshnormal_vert,fragmentShader:an.meshnormal_frag},sprite:{uniforms:Bo([Qi.sprite,Qi.fog]),vertexShader:an.sprite_vert,fragmentShader:an.sprite_frag},background:{uniforms:{uvTransform:{value:new Xr},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:an.background_vert,fragmentShader:an.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Xr}},vertexShader:an.backgroundCube_vert,fragmentShader:an.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:an.cube_vert,fragmentShader:an.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:an.equirect_vert,fragmentShader:an.equirect_frag},distanceRGBA:{uniforms:Bo([Qi.common,Qi.displacementmap,{referencePosition:{value:new He},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:an.distanceRGBA_vert,fragmentShader:an.distanceRGBA_frag},shadow:{uniforms:Bo([Qi.lights,Qi.fog,{color:{value:new or(0)},opacity:{value:1}}]),vertexShader:an.shadow_vert,fragmentShader:an.shadow_frag}};Lc.physical={uniforms:Bo([Lc.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Xr},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Xr},clearcoatNormalScale:{value:new ai(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Xr},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Xr},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Xr},sheen:{value:0},sheenColor:{value:new or(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Xr},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Xr},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Xr},transmissionSamplerSize:{value:new ai},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Xr},attenuationDistance:{value:0},attenuationColor:{value:new or(0)},specularColor:{value:new or(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Xr},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Xr},anisotropyVector:{value:new ai},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Xr}}]),vertexShader:an.meshphysical_vert,fragmentShader:an.meshphysical_frag};const OE={r:0,b:0,g:0},mf=new Tl,ECe=new fr;function wCe(S,a,d,A,x,w,M){const L=new or(0);let O=w===!0?0:1,F,H,J=null,K=0,Z=null;function ie(Re){let we=Re.isScene===!0?Re.background:null;return we&&we.isTexture&&(we=(Re.backgroundBlurriness>0?d:a).get(we)),we}function oe(Re){let we=!1;const _e=ie(Re);_e===null?ee(L,O):_e&&_e.isColor&&(ee(_e,1),we=!0);const st=S.xr.getEnvironmentBlendMode();st==="additive"?A.buffers.color.setClear(0,0,0,1,M):st==="alpha-blend"&&A.buffers.color.setClear(0,0,0,0,M),(S.autoClear||we)&&S.clear(S.autoClearColor,S.autoClearDepth,S.autoClearStencil)}function ne(Re,we){const _e=ie(we);_e&&(_e.isCubeTexture||_e.mapping===ce)?(H===void 0&&(H=new ua(new pf(1e4,1e4,1e4),new Bc({name:"BackgroundCubeMaterial",uniforms:h0(Lc.backgroundCube.uniforms),vertexShader:Lc.backgroundCube.vertexShader,fragmentShader:Lc.backgroundCube.fragmentShader,side:R,depthTest:!1,depthWrite:!1,fog:!1})),H.geometry.deleteAttribute("normal"),H.geometry.deleteAttribute("uv"),H.onBeforeRender=function(st,qe,Ze){this.matrixWorld.copyPosition(Ze.matrixWorld)},Object.defineProperty(H.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),x.update(H)),mf.copy(we.backgroundRotation),mf.x*=-1,mf.y*=-1,mf.z*=-1,_e.isCubeTexture&&_e.isRenderTargetTexture===!1&&(mf.y*=-1,mf.z*=-1),H.material.uniforms.envMap.value=_e,H.material.uniforms.flipEnvMap.value=_e.isCubeTexture&&_e.isRenderTargetTexture===!1?-1:1,H.material.uniforms.backgroundBlurriness.value=we.backgroundBlurriness,H.material.uniforms.backgroundIntensity.value=we.backgroundIntensity,H.material.uniforms.backgroundRotation.value.setFromMatrix4(ECe.makeRotationFromEuler(mf)),H.material.toneMapped=Yn.getTransfer(_e.colorSpace)!==ls,(J!==_e||K!==_e.version||Z!==S.toneMapping)&&(H.material.needsUpdate=!0,J=_e,K=_e.version,Z=S.toneMapping),H.layers.enableAll(),Re.unshift(H,H.geometry,H.material,0,0,null)):_e&&_e.isTexture&&(F===void 0&&(F=new ua(new f0(2,2),new Bc({name:"BackgroundMaterial",uniforms:h0(Lc.background.uniforms),vertexShader:Lc.background.vertexShader,fragmentShader:Lc.background.fragmentShader,side:C,depthTest:!1,depthWrite:!1,fog:!1})),F.geometry.deleteAttribute("normal"),Object.defineProperty(F.material,"map",{get:function(){return this.uniforms.t2D.value}}),x.update(F)),F.material.uniforms.t2D.value=_e,F.material.uniforms.backgroundIntensity.value=we.backgroundIntensity,F.material.toneMapped=Yn.getTransfer(_e.colorSpace)!==ls,_e.matrixAutoUpdate===!0&&_e.updateMatrix(),F.material.uniforms.uvTransform.value.copy(_e.matrix),(J!==_e||K!==_e.version||Z!==S.toneMapping)&&(F.material.needsUpdate=!0,J=_e,K=_e.version,Z=S.toneMapping),F.layers.enableAll(),Re.unshift(F,F.geometry,F.material,0,0,null))}function ee(Re,we){Re.getRGB(OE,Vj(S)),A.buffers.color.setClear(OE.r,OE.g,OE.b,we,M)}return{getClearColor:function(){return L},setClearColor:function(Re,we=1){L.set(Re),O=we,ee(L,O)},getClearAlpha:function(){return O},setClearAlpha:function(Re){O=Re,ee(L,O)},render:oe,addToRenderList:ne}}function CCe(S,a){const d=S.getParameter(S.MAX_VERTEX_ATTRIBS),A={},x=K(null);let w=x,M=!1;function L(ke,nt,gt,ft,It){let Ft=!1;const pi=J(ft,gt,nt);w!==pi&&(w=pi,F(w.object)),Ft=Z(ke,ft,gt,It),Ft&&ie(ke,ft,gt,It),It!==null&&a.update(It,S.ELEMENT_ARRAY_BUFFER),(Ft||M)&&(M=!1,_e(ke,nt,gt,ft),It!==null&&S.bindBuffer(S.ELEMENT_ARRAY_BUFFER,a.get(It).buffer))}function O(){return S.createVertexArray()}function F(ke){return S.bindVertexArray(ke)}function H(ke){return S.deleteVertexArray(ke)}function J(ke,nt,gt){const ft=gt.wireframe===!0;let It=A[ke.id];It===void 0&&(It={},A[ke.id]=It);let Ft=It[nt.id];Ft===void 0&&(Ft={},It[nt.id]=Ft);let pi=Ft[ft];return pi===void 0&&(pi=K(O()),Ft[ft]=pi),pi}function K(ke){const nt=[],gt=[],ft=[];for(let It=0;It<d;It++)nt[It]=0,gt[It]=0,ft[It]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:nt,enabledAttributes:gt,attributeDivisors:ft,object:ke,attributes:{},index:null}}function Z(ke,nt,gt,ft){const It=w.attributes,Ft=nt.attributes;let pi=0;const Ni=gt.getAttributes();for(const Ut in Ni)if(Ni[Ut].location>=0){const yi=It[Ut];let Pi=Ft[Ut];if(Pi===void 0&&(Ut==="instanceMatrix"&&ke.instanceMatrix&&(Pi=ke.instanceMatrix),Ut==="instanceColor"&&ke.instanceColor&&(Pi=ke.instanceColor)),yi===void 0||yi.attribute!==Pi||Pi&&yi.data!==Pi.data)return!0;pi++}return w.attributesNum!==pi||w.index!==ft}function ie(ke,nt,gt,ft){const It={},Ft=nt.attributes;let pi=0;const Ni=gt.getAttributes();for(const Ut in Ni)if(Ni[Ut].location>=0){let yi=Ft[Ut];yi===void 0&&(Ut==="instanceMatrix"&&ke.instanceMatrix&&(yi=ke.instanceMatrix),Ut==="instanceColor"&&ke.instanceColor&&(yi=ke.instanceColor));const Pi={};Pi.attribute=yi,yi&&yi.data&&(Pi.data=yi.data),It[Ut]=Pi,pi++}w.attributes=It,w.attributesNum=pi,w.index=ft}function oe(){const ke=w.newAttributes;for(let nt=0,gt=ke.length;nt<gt;nt++)ke[nt]=0}function ne(ke){ee(ke,0)}function ee(ke,nt){const gt=w.newAttributes,ft=w.enabledAttributes,It=w.attributeDivisors;gt[ke]=1,ft[ke]===0&&(S.enableVertexAttribArray(ke),ft[ke]=1),It[ke]!==nt&&(S.vertexAttribDivisor(ke,nt),It[ke]=nt)}function Re(){const ke=w.newAttributes,nt=w.enabledAttributes;for(let gt=0,ft=nt.length;gt<ft;gt++)nt[gt]!==ke[gt]&&(S.disableVertexAttribArray(gt),nt[gt]=0)}function we(ke,nt,gt,ft,It,Ft,pi){pi===!0?S.vertexAttribIPointer(ke,nt,gt,It,Ft):S.vertexAttribPointer(ke,nt,gt,ft,It,Ft)}function _e(ke,nt,gt,ft){oe();const It=ft.attributes,Ft=gt.getAttributes(),pi=nt.defaultAttributeValues;for(const Ni in Ft){const Ut=Ft[Ni];if(Ut.location>=0){let yi=It[Ni];if(yi===void 0&&(Ni==="instanceMatrix"&&ke.instanceMatrix&&(yi=ke.instanceMatrix),Ni==="instanceColor"&&ke.instanceColor&&(yi=ke.instanceColor)),yi!==void 0){const Pi=yi.normalized,Ur=yi.itemSize,xn=a.get(yi);if(xn===void 0)continue;const ts=xn.buffer,ds=xn.type,zn=xn.bytesPerElement,Bn=ds===S.INT||ds===S.UNSIGNED_INT||yi.gpuType===pe;if(yi.isInterleavedBufferAttribute){const Cr=yi.data,hi=Cr.stride,Ci=yi.offset;if(Cr.isInstancedInterleavedBuffer){for(let qi=0;qi<Ut.locationSize;qi++)ee(Ut.location+qi,Cr.meshPerAttribute);ke.isInstancedMesh!==!0&&ft._maxInstanceCount===void 0&&(ft._maxInstanceCount=Cr.meshPerAttribute*Cr.count)}else for(let qi=0;qi<Ut.locationSize;qi++)ne(Ut.location+qi);S.bindBuffer(S.ARRAY_BUFFER,ts);for(let qi=0;qi<Ut.locationSize;qi++)we(Ut.location+qi,Ur/Ut.locationSize,ds,Pi,hi*zn,(Ci+Ur/Ut.locationSize*qi)*zn,Bn)}else{if(yi.isInstancedBufferAttribute){for(let Cr=0;Cr<Ut.locationSize;Cr++)ee(Ut.location+Cr,yi.meshPerAttribute);ke.isInstancedMesh!==!0&&ft._maxInstanceCount===void 0&&(ft._maxInstanceCount=yi.meshPerAttribute*yi.count)}else for(let Cr=0;Cr<Ut.locationSize;Cr++)ne(Ut.location+Cr);S.bindBuffer(S.ARRAY_BUFFER,ts);for(let Cr=0;Cr<Ut.locationSize;Cr++)we(Ut.location+Cr,Ur/Ut.locationSize,ds,Pi,Ur*zn,Ur/Ut.locationSize*Cr*zn,Bn)}}else if(pi!==void 0){const Pi=pi[Ni];if(Pi!==void 0)switch(Pi.length){case 2:S.vertexAttrib2fv(Ut.location,Pi);break;case 3:S.vertexAttrib3fv(Ut.location,Pi);break;case 4:S.vertexAttrib4fv(Ut.location,Pi);break;default:S.vertexAttrib1fv(Ut.location,Pi)}}}}Re()}function st(){rt();for(const ke in A){const nt=A[ke];for(const gt in nt){const ft=nt[gt];for(const It in ft)H(ft[It].object),delete ft[It];delete nt[gt]}delete A[ke]}}function qe(ke){if(A[ke.id]===void 0)return;const nt=A[ke.id];for(const gt in nt){const ft=nt[gt];for(const It in ft)H(ft[It].object),delete ft[It];delete nt[gt]}delete A[ke.id]}function Ze(ke){for(const nt in A){const gt=A[nt];if(gt[ke.id]===void 0)continue;const ft=gt[ke.id];for(const It in ft)H(ft[It].object),delete ft[It];delete gt[ke.id]}}function rt(){je(),M=!0,w!==x&&(w=x,F(w.object))}function je(){x.geometry=null,x.program=null,x.wireframe=!1}return{setup:L,reset:rt,resetDefaultState:je,dispose:st,releaseStatesOfGeometry:qe,releaseStatesOfProgram:Ze,initAttributes:oe,enableAttribute:ne,disableUnusedAttributes:Re}}function SCe(S,a,d){let A;function x(F){A=F}function w(F,H){S.drawArrays(A,F,H),d.update(H,A,1)}function M(F,H,J){J!==0&&(S.drawArraysInstanced(A,F,H,J),d.update(H,A,J))}function L(F,H,J){if(J===0)return;const K=a.get("WEBGL_multi_draw");if(K===null)for(let Z=0;Z<J;Z++)this.render(F[Z],H[Z]);else{K.multiDrawArraysWEBGL(A,F,0,H,0,J);let Z=0;for(let ie=0;ie<J;ie++)Z+=H[ie];d.update(Z,A,1)}}function O(F,H,J,K){if(J===0)return;const Z=a.get("WEBGL_multi_draw");if(Z===null)for(let ie=0;ie<F.length;ie++)M(F[ie],H[ie],K[ie]);else{Z.multiDrawArraysInstancedWEBGL(A,F,0,H,0,K,0,J);let ie=0;for(let oe=0;oe<J;oe++)ie+=H[oe];for(let oe=0;oe<K.length;oe++)d.update(ie,A,K[oe])}}this.setMode=x,this.render=w,this.renderInstances=M,this.renderMultiDraw=L,this.renderMultiDrawInstances=O}function TCe(S,a,d,A){let x;function w(){if(x!==void 0)return x;if(a.has("EXT_texture_filter_anisotropic")===!0){const qe=a.get("EXT_texture_filter_anisotropic");x=S.getParameter(qe.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else x=0;return x}function M(qe){return!(qe!==fe&&A.convert(qe)!==S.getParameter(S.IMPLEMENTATION_COLOR_READ_FORMAT))}function L(qe){const Ze=qe===Kt&&(a.has("EXT_color_buffer_half_float")||a.has("EXT_color_buffer_float"));return!(qe!==gn&&A.convert(qe)!==S.getParameter(S.IMPLEMENTATION_COLOR_READ_TYPE)&&qe!==Rt&&!Ze)}function O(qe){if(qe==="highp"){if(S.getShaderPrecisionFormat(S.VERTEX_SHADER,S.HIGH_FLOAT).precision>0&&S.getShaderPrecisionFormat(S.FRAGMENT_SHADER,S.HIGH_FLOAT).precision>0)return"highp";qe="mediump"}return qe==="mediump"&&S.getShaderPrecisionFormat(S.VERTEX_SHADER,S.MEDIUM_FLOAT).precision>0&&S.getShaderPrecisionFormat(S.FRAGMENT_SHADER,S.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let F=d.precision!==void 0?d.precision:"highp";const H=O(F);H!==F&&(console.warn("THREE.WebGLRenderer:",F,"not supported, using",H,"instead."),F=H);const J=d.logarithmicDepthBuffer===!0,K=S.getParameter(S.MAX_TEXTURE_IMAGE_UNITS),Z=S.getParameter(S.MAX_VERTEX_TEXTURE_IMAGE_UNITS),ie=S.getParameter(S.MAX_TEXTURE_SIZE),oe=S.getParameter(S.MAX_CUBE_MAP_TEXTURE_SIZE),ne=S.getParameter(S.MAX_VERTEX_ATTRIBS),ee=S.getParameter(S.MAX_VERTEX_UNIFORM_VECTORS),Re=S.getParameter(S.MAX_VARYING_VECTORS),we=S.getParameter(S.MAX_FRAGMENT_UNIFORM_VECTORS),_e=Z>0,st=S.getParameter(S.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:w,getMaxPrecision:O,textureFormatReadable:M,textureTypeReadable:L,precision:F,logarithmicDepthBuffer:J,maxTextures:K,maxVertexTextures:Z,maxTextureSize:ie,maxCubemapSize:oe,maxAttributes:ne,maxVertexUniforms:ee,maxVaryings:Re,maxFragmentUniforms:we,vertexTextures:_e,maxSamples:st}}function MCe(S){const a=this;let d=null,A=0,x=!1,w=!1;const M=new zd,L=new Xr,O={value:null,needsUpdate:!1};this.uniform=O,this.numPlanes=0,this.numIntersection=0,this.init=function(J,K){const Z=J.length!==0||K||A!==0||x;return x=K,A=J.length,Z},this.beginShadows=function(){w=!0,H(null)},this.endShadows=function(){w=!1},this.setGlobalState=function(J,K){d=H(J,K,0)},this.setState=function(J,K,Z){const ie=J.clippingPlanes,oe=J.clipIntersection,ne=J.clipShadows,ee=S.get(J);if(!x||ie===null||ie.length===0||w&&!ne)w?H(null):F();else{const Re=w?0:A,we=Re*4;let _e=ee.clippingState||null;O.value=_e,_e=H(ie,K,we,Z);for(let st=0;st!==we;++st)_e[st]=d[st];ee.clippingState=_e,this.numIntersection=oe?this.numPlanes:0,this.numPlanes+=Re}};function F(){O.value!==d&&(O.value=d,O.needsUpdate=A>0),a.numPlanes=A,a.numIntersection=0}function H(J,K,Z,ie){const oe=J!==null?J.length:0;let ne=null;if(oe!==0){if(ne=O.value,ie!==!0||ne===null){const ee=Z+oe*4,Re=K.matrixWorldInverse;L.getNormalMatrix(Re),(ne===null||ne.length<ee)&&(ne=new Float32Array(ee));for(let we=0,_e=Z;we!==oe;++we,_e+=4)M.copy(J[we]).applyMatrix4(Re,L),M.normal.toArray(ne,_e),ne[_e+3]=M.constant}O.value=ne,O.needsUpdate=!0}return a.numPlanes=oe,a.numIntersection=0,ne}}function RCe(S){let a=new WeakMap;function d(M,L){return L===re?M.mapping=U:L===Me&&(M.mapping=$),M}function A(M){if(M&&M.isTexture){const L=M.mapping;if(L===re||L===Me)if(a.has(M)){const O=a.get(M).texture;return d(O,M.mapping)}else{const O=M.image;if(O&&O.height>0){const F=new qj(O.height);return F.fromEquirectangularTexture(S,M),a.set(M,F),M.addEventListener("dispose",x),d(F.texture,M.mapping)}else return null}}return M}function x(M){const L=M.target;L.removeEventListener("dispose",x);const O=a.get(L);O!==void 0&&(a.delete(L),O.dispose())}function w(){a=new WeakMap}return{get:A,dispose:w}}class kE extends NE{constructor(a=-1,d=1,A=1,x=-1,w=.1,M=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=a,this.right=d,this.top=A,this.bottom=x,this.near=w,this.far=M,this.updateProjectionMatrix()}copy(a,d){return super.copy(a,d),this.left=a.left,this.right=a.right,this.top=a.top,this.bottom=a.bottom,this.near=a.near,this.far=a.far,this.zoom=a.zoom,this.view=a.view===null?null:Object.assign({},a.view),this}setViewOffset(a,d,A,x,w,M){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=a,this.view.fullHeight=d,this.view.offsetX=A,this.view.offsetY=x,this.view.width=w,this.view.height=M,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const a=(this.right-this.left)/(2*this.zoom),d=(this.top-this.bottom)/(2*this.zoom),A=(this.right+this.left)/2,x=(this.top+this.bottom)/2;let w=A-a,M=A+a,L=x+d,O=x-d;if(this.view!==null&&this.view.enabled){const F=(this.right-this.left)/this.view.fullWidth/this.zoom,H=(this.top-this.bottom)/this.view.fullHeight/this.zoom;w+=F*this.view.offsetX,M=w+F*this.view.width,L-=H*this.view.offsetY,O=L-H*this.view.height}this.projectionMatrix.makeOrthographic(w,M,L,O,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(a){const d=super.toJSON(a);return d.object.zoom=this.zoom,d.object.left=this.left,d.object.right=this.right,d.object.top=this.top,d.object.bottom=this.bottom,d.object.near=this.near,d.object.far=this.far,this.view!==null&&(d.object.view=Object.assign({},this.view)),d}}const m0=4,Xj=[.125,.215,.35,.446,.526,.582],gf=20,FB=new kE,Yj=new or;let UB=null,zB=0,jB=0,VB=!1;const Af=(1+Math.sqrt(5))/2,g0=1/Af,Kj=[new He(-Af,g0,0),new He(Af,g0,0),new He(-g0,0,Af),new He(g0,0,Af),new He(0,Af,-g0),new He(0,Af,g0),new He(-1,1,-1),new He(1,1,-1),new He(-1,1,1),new He(1,1,1)];class GB{constructor(a){this._renderer=a,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(a,d=0,A=.1,x=100){UB=this._renderer.getRenderTarget(),zB=this._renderer.getActiveCubeFace(),jB=this._renderer.getActiveMipmapLevel(),VB=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const w=this._allocateTargets();return w.depthBuffer=!0,this._sceneToCubeUV(a,A,x,w),d>0&&this._blur(w,0,0,d),this._applyPMREM(w),this._cleanup(w),w}fromEquirectangular(a,d=null){return this._fromTexture(a,d)}fromCubemap(a,d=null){return this._fromTexture(a,d)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=$j(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=Zj(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(a){this._lodMax=Math.floor(Math.log2(a)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let a=0;a<this._lodPlanes.length;a++)this._lodPlanes[a].dispose()}_cleanup(a){this._renderer.setRenderTarget(UB,zB,jB),this._renderer.xr.enabled=VB,a.scissorTest=!1,FE(a,0,0,a.width,a.height)}_fromTexture(a,d){a.mapping===U||a.mapping===$?this._setSize(a.image.length===0?16:a.image[0].width||a.image[0].image.width):this._setSize(a.image.width/4),UB=this._renderer.getRenderTarget(),zB=this._renderer.getActiveCubeFace(),jB=this._renderer.getActiveMipmapLevel(),VB=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const A=d||this._allocateTargets();return this._textureToCubeUV(a,A),this._applyPMREM(A),this._cleanup(A),A}_allocateTargets(){const a=3*Math.max(this._cubeSize,112),d=4*this._cubeSize,A={magFilter:ki,minFilter:ki,generateMipmaps:!1,type:Kt,format:fe,colorSpace:Rc,depthBuffer:!1},x=Jj(a,d,A);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==a||this._pingPongRenderTarget.height!==d){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=Jj(a,d,A);const{_lodMax:w}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=ICe(w)),this._blurMaterial=BCe(w,a,d)}return x}_compileMaterial(a){const d=new ua(this._lodPlanes[0],a);this._renderer.compile(d,FB)}_sceneToCubeUV(a,d,A,x){const w=new va(90,1,d,A),M=[1,-1,1,1,1,1],L=[1,1,1,-1,-1,-1],O=this._renderer,F=O.autoClear,H=O.toneMapping;O.getClearColor(Yj),O.toneMapping=Ot,O.autoClear=!1;const J=new Fd({name:"PMREM.Background",side:R,depthWrite:!1,depthTest:!1}),K=new ua(new pf,J);let Z=!1;const ie=a.background;ie?ie.isColor&&(J.color.copy(ie),a.background=null,Z=!0):(J.color.copy(Yj),Z=!0);for(let oe=0;oe<6;oe++){const ne=oe%3;ne===0?(w.up.set(0,M[oe],0),w.lookAt(L[oe],0,0)):ne===1?(w.up.set(0,0,M[oe]),w.lookAt(0,L[oe],0)):(w.up.set(0,M[oe],0),w.lookAt(0,0,L[oe]));const ee=this._cubeSize;FE(x,ne*ee,oe>2?ee:0,ee,ee),O.setRenderTarget(x),Z&&O.render(K,w),O.render(a,w)}K.geometry.dispose(),K.material.dispose(),O.toneMapping=H,O.autoClear=F,a.background=ie}_textureToCubeUV(a,d){const A=this._renderer,x=a.mapping===U||a.mapping===$;x?(this._cubemapMaterial===null&&(this._cubemapMaterial=$j()),this._cubemapMaterial.uniforms.flipEnvMap.value=a.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=Zj());const w=x?this._cubemapMaterial:this._equirectMaterial,M=new ua(this._lodPlanes[0],w),L=w.uniforms;L.envMap.value=a;const O=this._cubeSize;FE(d,0,0,3*O,2*O),A.setRenderTarget(d),A.render(M,FB)}_applyPMREM(a){const d=this._renderer,A=d.autoClear;d.autoClear=!1;const x=this._lodPlanes.length;for(let w=1;w<x;w++){const M=Math.sqrt(this._sigmas[w]*this._sigmas[w]-this._sigmas[w-1]*this._sigmas[w-1]),L=Kj[(x-w-1)%Kj.length];this._blur(a,w-1,w,M,L)}d.autoClear=A}_blur(a,d,A,x,w){const M=this._pingPongRenderTarget;this._halfBlur(a,M,d,A,x,"latitudinal",w),this._halfBlur(M,a,A,A,x,"longitudinal",w)}_halfBlur(a,d,A,x,w,M,L){const O=this._renderer,F=this._blurMaterial;M!=="latitudinal"&&M!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const H=3,J=new ua(this._lodPlanes[x],F),K=F.uniforms,Z=this._sizeLods[A]-1,ie=isFinite(w)?Math.PI/(2*Z):2*Math.PI/(2*gf-1),oe=w/ie,ne=isFinite(w)?1+Math.floor(H*oe):gf;ne>gf&&console.warn(`sigmaRadians, ${w}, is too large and will clip, as it requested ${ne} samples when the maximum is set to ${gf}`);const ee=[];let Re=0;for(let Ze=0;Ze<gf;++Ze){const rt=Ze/oe,je=Math.exp(-rt*rt/2);ee.push(je),Ze===0?Re+=je:Ze<ne&&(Re+=2*je)}for(let Ze=0;Ze<ee.length;Ze++)ee[Ze]=ee[Ze]/Re;K.envMap.value=a.texture,K.samples.value=ne,K.weights.value=ee,K.latitudinal.value=M==="latitudinal",L&&(K.poleAxis.value=L);const{_lodMax:we}=this;K.dTheta.value=ie,K.mipInt.value=we-A;const _e=this._sizeLods[x],st=3*_e*(x>we-m0?x-we+m0:0),qe=4*(this._cubeSize-_e);FE(d,st,qe,3*_e,2*_e),O.setRenderTarget(d),O.render(J,FB)}}function ICe(S){const a=[],d=[],A=[];let x=S;const w=S-m0+1+Xj.length;for(let M=0;M<w;M++){const L=Math.pow(2,x);d.push(L);let O=1/L;M>S-m0?O=Xj[M-S+m0-1]:M===0&&(O=0),A.push(O);const F=1/(L-2),H=-F,J=1+F,K=[H,H,J,H,J,J,H,H,J,J,H,J],Z=6,ie=6,oe=3,ne=2,ee=1,Re=new Float32Array(oe*ie*Z),we=new Float32Array(ne*ie*Z),_e=new Float32Array(ee*ie*Z);for(let qe=0;qe<Z;qe++){const Ze=qe%3*2/3-1,rt=qe>2?0:-1,je=[Ze,rt,0,Ze+2/3,rt,0,Ze+2/3,rt+1,0,Ze,rt,0,Ze+2/3,rt+1,0,Ze,rt+1,0];Re.set(je,oe*ie*qe),we.set(K,ne*ie*qe);const ke=[qe,qe,qe,qe,qe,qe];_e.set(ke,ee*ie*qe)}const st=new dn;st.setAttribute("position",new ss(Re,oe)),st.setAttribute("uv",new ss(we,ne)),st.setAttribute("faceIndex",new ss(_e,ee)),a.push(st),x>m0&&x--}return{lodPlanes:a,sizeLods:d,sigmas:A}}function Jj(S,a,d){const A=new Jo(S,a,d);return A.texture.mapping=ce,A.texture.name="PMREM.cubeUv",A.scissorTest=!0,A}function FE(S,a,d,A,x){S.viewport.set(a,d,A,x),S.scissor.set(a,d,A,x)}function BCe(S,a,d){const A=new Float32Array(gf),x=new He(0,1,0);return new Bc({name:"SphericalGaussianBlur",defines:{n:gf,CUBEUV_TEXEL_WIDTH:1/a,CUBEUV_TEXEL_HEIGHT:1/d,CUBEUV_MAX_MIP:`${S}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:A},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:x}},vertexShader:HB(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:I,depthTest:!1,depthWrite:!1})}function Zj(){return new Bc({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:HB(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:I,depthTest:!1,depthWrite:!1})}function $j(){return new Bc({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:HB(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:I,depthTest:!1,depthWrite:!1})}function HB(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function LCe(S){let a=new WeakMap,d=null;function A(L){if(L&&L.isTexture){const O=L.mapping,F=O===re||O===Me,H=O===U||O===$;if(F||H){let J=a.get(L);const K=J!==void 0?J.texture.pmremVersion:0;if(L.isRenderTargetTexture&&L.pmremVersion!==K)return d===null&&(d=new GB(S)),J=F?d.fromEquirectangular(L,J):d.fromCubemap(L,J),J.texture.pmremVersion=L.pmremVersion,a.set(L,J),J.texture;if(J!==void 0)return J.texture;{const Z=L.image;return F&&Z&&Z.height>0||H&&Z&&x(Z)?(d===null&&(d=new GB(S)),J=F?d.fromEquirectangular(L):d.fromCubemap(L),J.texture.pmremVersion=L.pmremVersion,a.set(L,J),L.addEventListener("dispose",w),J.texture):null}}}return L}function x(L){let O=0;const F=6;for(let H=0;H<F;H++)L[H]!==void 0&&O++;return O===F}function w(L){const O=L.target;O.removeEventListener("dispose",w);const F=a.get(O);F!==void 0&&(a.delete(O),F.dispose())}function M(){a=new WeakMap,d!==null&&(d.dispose(),d=null)}return{get:A,dispose:M}}function DCe(S){const a={};function d(A){if(a[A]!==void 0)return a[A];let x;switch(A){case"WEBGL_depth_texture":x=S.getExtension("WEBGL_depth_texture")||S.getExtension("MOZ_WEBGL_depth_texture")||S.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":x=S.getExtension("EXT_texture_filter_anisotropic")||S.getExtension("MOZ_EXT_texture_filter_anisotropic")||S.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":x=S.getExtension("WEBGL_compressed_texture_s3tc")||S.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||S.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":x=S.getExtension("WEBGL_compressed_texture_pvrtc")||S.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:x=S.getExtension(A)}return a[A]=x,x}return{has:function(A){return d(A)!==null},init:function(){d("EXT_color_buffer_float"),d("WEBGL_clip_cull_distance"),d("OES_texture_float_linear"),d("EXT_color_buffer_half_float"),d("WEBGL_multisampled_render_to_texture"),d("WEBGL_render_shared_exponent")},get:function(A){const x=d(A);return x===null&&console.warn("THREE.WebGLRenderer: "+A+" extension not supported."),x}}}function NCe(S,a,d,A){const x={},w=new WeakMap;function M(J){const K=J.target;K.index!==null&&a.remove(K.index);for(const ie in K.attributes)a.remove(K.attributes[ie]);for(const ie in K.morphAttributes){const oe=K.morphAttributes[ie];for(let ne=0,ee=oe.length;ne<ee;ne++)a.remove(oe[ne])}K.removeEventListener("dispose",M),delete x[K.id];const Z=w.get(K);Z&&(a.remove(Z),w.delete(K)),A.releaseStatesOfGeometry(K),K.isInstancedBufferGeometry===!0&&delete K._maxInstanceCount,d.memory.geometries--}function L(J,K){return x[K.id]===!0||(K.addEventListener("dispose",M),x[K.id]=!0,d.memory.geometries++),K}function O(J){const K=J.attributes;for(const ie in K)a.update(K[ie],S.ARRAY_BUFFER);const Z=J.morphAttributes;for(const ie in Z){const oe=Z[ie];for(let ne=0,ee=oe.length;ne<ee;ne++)a.update(oe[ne],S.ARRAY_BUFFER)}}function F(J){const K=[],Z=J.index,ie=J.attributes.position;let oe=0;if(Z!==null){const Re=Z.array;oe=Z.version;for(let we=0,_e=Re.length;we<_e;we+=3){const st=Re[we+0],qe=Re[we+1],Ze=Re[we+2];K.push(st,qe,qe,Ze,Ze,st)}}else if(ie!==void 0){const Re=ie.array;oe=ie.version;for(let we=0,_e=Re.length/3-1;we<_e;we+=3){const st=we+0,qe=we+1,Ze=we+2;K.push(st,qe,qe,Ze,Ze,st)}}else return;const ne=new(pE(K)?DB:LB)(K,1);ne.version=oe;const ee=w.get(J);ee&&a.remove(ee),w.set(J,ne)}function H(J){const K=w.get(J);if(K){const Z=J.index;Z!==null&&K.version<Z.version&&F(J)}else F(J);return w.get(J)}return{get:L,update:O,getWireframeAttribute:H}}function PCe(S,a,d){let A;function x(K){A=K}let w,M;function L(K){w=K.type,M=K.bytesPerElement}function O(K,Z){S.drawElements(A,Z,w,K*M),d.update(Z,A,1)}function F(K,Z,ie){ie!==0&&(S.drawElementsInstanced(A,Z,w,K*M,ie),d.update(Z,A,ie))}function H(K,Z,ie){if(ie===0)return;const oe=a.get("WEBGL_multi_draw");if(oe===null)for(let ne=0;ne<ie;ne++)this.render(K[ne]/M,Z[ne]);else{oe.multiDrawElementsWEBGL(A,Z,0,w,K,0,ie);let ne=0;for(let ee=0;ee<ie;ee++)ne+=Z[ee];d.update(ne,A,1)}}function J(K,Z,ie,oe){if(ie===0)return;const ne=a.get("WEBGL_multi_draw");if(ne===null)for(let ee=0;ee<K.length;ee++)F(K[ee]/M,Z[ee],oe[ee]);else{ne.multiDrawElementsInstancedWEBGL(A,Z,0,w,K,0,oe,0,ie);let ee=0;for(let Re=0;Re<ie;Re++)ee+=Z[Re];for(let Re=0;Re<oe.length;Re++)d.update(ee,A,oe[Re])}}this.setMode=x,this.setIndex=L,this.render=O,this.renderInstances=F,this.renderMultiDraw=H,this.renderMultiDrawInstances=J}function OCe(S){const a={geometries:0,textures:0},d={frame:0,calls:0,triangles:0,points:0,lines:0};function A(w,M,L){switch(d.calls++,M){case S.TRIANGLES:d.triangles+=L*(w/3);break;case S.LINES:d.lines+=L*(w/2);break;case S.LINE_STRIP:d.lines+=L*(w-1);break;case S.LINE_LOOP:d.lines+=L*w;break;case S.POINTS:d.points+=L*w;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",M);break}}function x(){d.calls=0,d.triangles=0,d.points=0,d.lines=0}return{memory:a,render:d,programs:null,autoReset:!0,reset:x,update:A}}function kCe(S,a,d){const A=new WeakMap,x=new Fn;function w(M,L,O){const F=M.morphTargetInfluences,H=L.morphAttributes.position||L.morphAttributes.normal||L.morphAttributes.color,J=H!==void 0?H.length:0;let K=A.get(L);if(K===void 0||K.count!==J){let Z=function(){rt.dispose(),A.delete(L),L.removeEventListener("dispose",Z)};K!==void 0&&K.texture.dispose();const ie=L.morphAttributes.position!==void 0,oe=L.morphAttributes.normal!==void 0,ne=L.morphAttributes.color!==void 0,ee=L.morphAttributes.position||[],Re=L.morphAttributes.normal||[],we=L.morphAttributes.color||[];let _e=0;ie===!0&&(_e=1),oe===!0&&(_e=2),ne===!0&&(_e=3);let st=L.attributes.position.count*_e,qe=1;st>a.maxTextureSize&&(qe=Math.ceil(st/a.maxTextureSize),st=a.maxTextureSize);const Ze=new Float32Array(st*qe*4*J),rt=new Zg(Ze,st,qe,J);rt.type=Rt,rt.needsUpdate=!0;const je=_e*4;for(let ke=0;ke<J;ke++){const nt=ee[ke],gt=Re[ke],ft=we[ke],It=st*qe*4*ke;for(let Ft=0;Ft<nt.count;Ft++){const pi=Ft*je;ie===!0&&(x.fromBufferAttribute(nt,Ft),Ze[It+pi+0]=x.x,Ze[It+pi+1]=x.y,Ze[It+pi+2]=x.z,Ze[It+pi+3]=0),oe===!0&&(x.fromBufferAttribute(gt,Ft),Ze[It+pi+4]=x.x,Ze[It+pi+5]=x.y,Ze[It+pi+6]=x.z,Ze[It+pi+7]=0),ne===!0&&(x.fromBufferAttribute(ft,Ft),Ze[It+pi+8]=x.x,Ze[It+pi+9]=x.y,Ze[It+pi+10]=x.z,Ze[It+pi+11]=ft.itemSize===4?x.w:1)}}K={count:J,texture:rt,size:new ai(st,qe)},A.set(L,K),L.addEventListener("dispose",Z)}if(M.isInstancedMesh===!0&&M.morphTexture!==null)O.getUniforms().setValue(S,"morphTexture",M.morphTexture,d);else{let Z=0;for(let oe=0;oe<F.length;oe++)Z+=F[oe];const ie=L.morphTargetsRelative?1:1-Z;O.getUniforms().setValue(S,"morphTargetBaseInfluence",ie),O.getUniforms().setValue(S,"morphTargetInfluences",F)}O.getUniforms().setValue(S,"morphTargetsTexture",K.texture,d),O.getUniforms().setValue(S,"morphTargetsTextureSize",K.size)}return{update:w}}class FCe{constructor(a,d,A){if(this.renderer=a,this.DEFAULT_NUMVIEWS=2,this.maxNumViews=0,this.gl=A,this.extensions=d,this.available=this.extensions.has("OCULUS_multiview"),this.available){const w=this.extensions.get("OCULUS_multiview");this.maxNumViews=this.gl.getParameter(w.MAX_VIEWS_OVR),this.mat4=[],this.mat3=[],this.cameraArray=[];for(var x=0;x<this.maxNumViews;x++)this.mat4[x]=new fr,this.mat3[x]=new Xr}}getCameraArray(a){return a.isArrayCamera?a.cameras:(this.cameraArray[0]=a,this.cameraArray)}updateCameraProjectionMatricesUniform(a,d){for(var A=this.getCameraArray(a),x=0;x<A.length;x++)this.mat4[x].copy(A[x].projectionMatrix);d.setValue(this.gl,"projectionMatrices",this.mat4)}updateCameraViewMatricesUniform(a,d){for(var A=this.getCameraArray(a),x=0;x<A.length;x++)this.mat4[x].copy(A[x].matrixWorldInverse);d.setValue(this.gl,"viewMatrices",this.mat4)}updateObjectMatricesUniforms(a,d,A){for(var x=this.getCameraArray(d),w=0;w<x.length;w++)this.mat4[w].multiplyMatrices(x[w].matrixWorldInverse,a.matrixWorld),this.mat3[w].getNormalMatrix(this.mat4[w]);A.setValue(this.gl,"modelViewMatrices",this.mat4),A.setValue(this.gl,"normalMatrices",this.mat3)}}function UCe(S,a,d,A){let x=new WeakMap;function w(O){const F=A.render.frame,H=O.geometry,J=a.get(O,H);if(x.get(J)!==F&&(a.update(J),x.set(J,F)),O.isInstancedMesh&&(O.hasEventListener("dispose",L)===!1&&O.addEventListener("dispose",L),x.get(O)!==F&&(d.update(O.instanceMatrix,S.ARRAY_BUFFER),O.instanceColor!==null&&d.update(O.instanceColor,S.ARRAY_BUFFER),x.set(O,F))),O.isSkinnedMesh){const K=O.skeleton;x.get(K)!==F&&(K.update(),x.set(K,F))}return J}function M(){x=new WeakMap}function L(O){const F=O.target;F.removeEventListener("dispose",L),d.remove(F.instanceMatrix),F.instanceColor!==null&&d.remove(F.instanceColor)}return{update:w,dispose:M}}class WB extends hs{constructor(a,d,A,x,w,M,L,O,F,H){if(H=H!==void 0?H:Ke,H!==Ke&&H!==lt)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");A===void 0&&H===Ke&&(A=ct),A===void 0&&H===lt&&(A=Di),super(null,x,w,M,L,O,H,A,F),this.isDepthTexture=!0,this.image={width:a,height:d},this.magFilter=L!==void 0?L:Dt,this.minFilter=O!==void 0?O:Dt,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(a){return super.copy(a),this.compareFunction=a.compareFunction,this}toJSON(a){const d=super.toJSON(a);return this.compareFunction!==null&&(d.compareFunction=this.compareFunction),d}}const e9=new hs,t9=new WB(1,1);t9.compareFunction=nv;const i9=new Zg,r9=new Yr,n9=new fv,s9=[],a9=[],o9=new Float32Array(16),l9=new Float32Array(9),c9=new Float32Array(4);function A0(S,a,d){const A=S[0];if(A<=0||A>0)return S;const x=a*d;let w=s9[x];if(w===void 0&&(w=new Float32Array(x),s9[x]=w),a!==0){A.toArray(w,0);for(let M=1,L=0;M!==a;++M)L+=d,S[M].toArray(w,L)}return w}function ba(S,a){if(S.length!==a.length)return!1;for(let d=0,A=S.length;d<A;d++)if(S[d]!==a[d])return!1;return!0}function xa(S,a){for(let d=0,A=a.length;d<A;d++)S[d]=a[d]}function UE(S,a){let d=a9[a];d===void 0&&(d=new Int32Array(a),a9[a]=d);for(let A=0;A!==a;++A)d[A]=S.allocateTextureUnit();return d}function zCe(S,a){const d=this.cache;d[0]!==a&&(S.uniform1f(this.addr,a),d[0]=a)}function jCe(S,a){const d=this.cache;if(a.x!==void 0)(d[0]!==a.x||d[1]!==a.y)&&(S.uniform2f(this.addr,a.x,a.y),d[0]=a.x,d[1]=a.y);else{if(ba(d,a))return;S.uniform2fv(this.addr,a),xa(d,a)}}function VCe(S,a){const d=this.cache;if(a.x!==void 0)(d[0]!==a.x||d[1]!==a.y||d[2]!==a.z)&&(S.uniform3f(this.addr,a.x,a.y,a.z),d[0]=a.x,d[1]=a.y,d[2]=a.z);else if(a.r!==void 0)(d[0]!==a.r||d[1]!==a.g||d[2]!==a.b)&&(S.uniform3f(this.addr,a.r,a.g,a.b),d[0]=a.r,d[1]=a.g,d[2]=a.b);else{if(ba(d,a))return;S.uniform3fv(this.addr,a),xa(d,a)}}function GCe(S,a){const d=this.cache;if(a.x!==void 0)(d[0]!==a.x||d[1]!==a.y||d[2]!==a.z||d[3]!==a.w)&&(S.uniform4f(this.addr,a.x,a.y,a.z,a.w),d[0]=a.x,d[1]=a.y,d[2]=a.z,d[3]=a.w);else{if(ba(d,a))return;S.uniform4fv(this.addr,a),xa(d,a)}}function HCe(S,a){const d=this.cache,A=a.elements;if(A===void 0){if(ba(d,a))return;S.uniformMatrix2fv(this.addr,!1,a),xa(d,a)}else{if(ba(d,A))return;c9.set(A),S.uniformMatrix2fv(this.addr,!1,c9),xa(d,A)}}function WCe(S,a){const d=this.cache,A=a.elements;if(A===void 0){if(ba(d,a))return;S.uniformMatrix3fv(this.addr,!1,a),xa(d,a)}else{if(ba(d,A))return;l9.set(A),S.uniformMatrix3fv(this.addr,!1,l9),xa(d,A)}}function QCe(S,a){const d=this.cache,A=a.elements;if(A===void 0){if(ba(d,a))return;S.uniformMatrix4fv(this.addr,!1,a),xa(d,a)}else{if(ba(d,A))return;o9.set(A),S.uniformMatrix4fv(this.addr,!1,o9),xa(d,A)}}function qCe(S,a){const d=this.cache;d[0]!==a&&(S.uniform1i(this.addr,a),d[0]=a)}function XCe(S,a){const d=this.cache;if(a.x!==void 0)(d[0]!==a.x||d[1]!==a.y)&&(S.uniform2i(this.addr,a.x,a.y),d[0]=a.x,d[1]=a.y);else{if(ba(d,a))return;S.uniform2iv(this.addr,a),xa(d,a)}}function YCe(S,a){const d=this.cache;if(a.x!==void 0)(d[0]!==a.x||d[1]!==a.y||d[2]!==a.z)&&(S.uniform3i(this.addr,a.x,a.y,a.z),d[0]=a.x,d[1]=a.y,d[2]=a.z);else{if(ba(d,a))return;S.uniform3iv(this.addr,a),xa(d,a)}}function KCe(S,a){const d=this.cache;if(a.x!==void 0)(d[0]!==a.x||d[1]!==a.y||d[2]!==a.z||d[3]!==a.w)&&(S.uniform4i(this.addr,a.x,a.y,a.z,a.w),d[0]=a.x,d[1]=a.y,d[2]=a.z,d[3]=a.w);else{if(ba(d,a))return;S.uniform4iv(this.addr,a),xa(d,a)}}function JCe(S,a){const d=this.cache;d[0]!==a&&(S.uniform1ui(this.addr,a),d[0]=a)}function ZCe(S,a){const d=this.cache;if(a.x!==void 0)(d[0]!==a.x||d[1]!==a.y)&&(S.uniform2ui(this.addr,a.x,a.y),d[0]=a.x,d[1]=a.y);else{if(ba(d,a))return;S.uniform2uiv(this.addr,a),xa(d,a)}}function $Ce(S,a){const d=this.cache;if(a.x!==void 0)(d[0]!==a.x||d[1]!==a.y||d[2]!==a.z)&&(S.uniform3ui(this.addr,a.x,a.y,a.z),d[0]=a.x,d[1]=a.y,d[2]=a.z);else{if(ba(d,a))return;S.uniform3uiv(this.addr,a),xa(d,a)}}function eSe(S,a){const d=this.cache;if(a.x!==void 0)(d[0]!==a.x||d[1]!==a.y||d[2]!==a.z||d[3]!==a.w)&&(S.uniform4ui(this.addr,a.x,a.y,a.z,a.w),d[0]=a.x,d[1]=a.y,d[2]=a.z,d[3]=a.w);else{if(ba(d,a))return;S.uniform4uiv(this.addr,a),xa(d,a)}}function tSe(S,a,d){const A=this.cache,x=d.allocateTextureUnit();A[0]!==x&&(S.uniform1i(this.addr,x),A[0]=x);const w=this.type===S.SAMPLER_2D_SHADOW?t9:e9;d.setTexture2D(a||w,x)}function iSe(S,a,d){const A=this.cache,x=d.allocateTextureUnit();A[0]!==x&&(S.uniform1i(this.addr,x),A[0]=x),d.setTexture3D(a||r9,x)}function rSe(S,a,d){const A=this.cache,x=d.allocateTextureUnit();A[0]!==x&&(S.uniform1i(this.addr,x),A[0]=x),d.setTextureCube(a||n9,x)}function nSe(S,a,d){const A=this.cache,x=d.allocateTextureUnit();A[0]!==x&&(S.uniform1i(this.addr,x),A[0]=x),d.setTexture2DArray(a||i9,x)}function sSe(S){switch(S){case 5126:return zCe;case 35664:return jCe;case 35665:return VCe;case 35666:return GCe;case 35674:return HCe;case 35675:return WCe;case 35676:return QCe;case 5124:case 35670:return qCe;case 35667:case 35671:return XCe;case 35668:case 35672:return YCe;case 35669:case 35673:return KCe;case 5125:return JCe;case 36294:return ZCe;case 36295:return $Ce;case 36296:return eSe;case 35678:case 36198:case 36298:case 36306:case 35682:return tSe;case 35679:case 36299:case 36307:return iSe;case 35680:case 36300:case 36308:case 36293:return rSe;case 36289:case 36303:case 36311:case 36292:return nSe}}function aSe(S,a){S.uniform1fv(this.addr,a)}function oSe(S,a){const d=A0(a,this.size,2);S.uniform2fv(this.addr,d)}function lSe(S,a){const d=A0(a,this.size,3);S.uniform3fv(this.addr,d)}function cSe(S,a){const d=A0(a,this.size,4);S.uniform4fv(this.addr,d)}function uSe(S,a){const d=A0(a,this.size,4);S.uniformMatrix2fv(this.addr,!1,d)}function hSe(S,a){const d=A0(a,this.size,9);S.uniformMatrix3fv(this.addr,!1,d)}function dSe(S,a){const d=A0(a,this.size,16);S.uniformMatrix4fv(this.addr,!1,d)}function pSe(S,a){S.uniform1iv(this.addr,a)}function fSe(S,a){S.uniform2iv(this.addr,a)}function mSe(S,a){S.uniform3iv(this.addr,a)}function gSe(S,a){S.uniform4iv(this.addr,a)}function ASe(S,a){S.uniform1uiv(this.addr,a)}function ySe(S,a){S.uniform2uiv(this.addr,a)}function vSe(S,a){S.uniform3uiv(this.addr,a)}function bSe(S,a){S.uniform4uiv(this.addr,a)}function xSe(S,a,d){const A=this.cache,x=a.length,w=UE(d,x);ba(A,w)||(S.uniform1iv(this.addr,w),xa(A,w));for(let M=0;M!==x;++M)d.setTexture2D(a[M]||e9,w[M])}function _Se(S,a,d){const A=this.cache,x=a.length,w=UE(d,x);ba(A,w)||(S.uniform1iv(this.addr,w),xa(A,w));for(let M=0;M!==x;++M)d.setTexture3D(a[M]||r9,w[M])}function ESe(S,a,d){const A=this.cache,x=a.length,w=UE(d,x);ba(A,w)||(S.uniform1iv(this.addr,w),xa(A,w));for(let M=0;M!==x;++M)d.setTextureCube(a[M]||n9,w[M])}function wSe(S,a,d){const A=this.cache,x=a.length,w=UE(d,x);ba(A,w)||(S.uniform1iv(this.addr,w),xa(A,w));for(let M=0;M!==x;++M)d.setTexture2DArray(a[M]||i9,w[M])}function CSe(S){switch(S){case 5126:return aSe;case 35664:return oSe;case 35665:return lSe;case 35666:return cSe;case 35674:return uSe;case 35675:return hSe;case 35676:return dSe;case 5124:case 35670:return pSe;case 35667:case 35671:return fSe;case 35668:case 35672:return mSe;case 35669:case 35673:return gSe;case 5125:return ASe;case 36294:return ySe;case 36295:return vSe;case 36296:return bSe;case 35678:case 36198:case 36298:case 36306:case 35682:return xSe;case 35679:case 36299:case 36307:return _Se;case 35680:case 36300:case 36308:case 36293:return ESe;case 36289:case 36303:case 36311:case 36292:return wSe}}class SSe{constructor(a,d,A){this.id=a,this.addr=A,this.cache=[],this.type=d.type,this.setValue=sSe(d.type)}}class TSe{constructor(a,d,A){this.id=a,this.addr=A,this.cache=[],this.type=d.type,this.size=d.size,this.setValue=CSe(d.type)}}class MSe{constructor(a){this.id=a,this.seq=[],this.map={}}setValue(a,d,A){const x=this.seq;for(let w=0,M=x.length;w!==M;++w){const L=x[w];L.setValue(a,d[L.id],A)}}}const QB=/(\w+)(\])?(\[|\.)?/g;function u9(S,a){S.seq.push(a),S.map[a.id]=a}function RSe(S,a,d){const A=S.name,x=A.length;for(QB.lastIndex=0;;){const w=QB.exec(A),M=QB.lastIndex;let L=w[1];const O=w[2]==="]",F=w[3];if(O&&(L=L|0),F===void 0||F==="["&&M+2===x){u9(d,F===void 0?new SSe(L,S,a):new TSe(L,S,a));break}else{let H=d.map[L];H===void 0&&(H=new MSe(L),u9(d,H)),d=H}}}class zE{constructor(a,d){this.seq=[],this.map={};const A=a.getProgramParameter(d,a.ACTIVE_UNIFORMS);for(let x=0;x<A;++x){const w=a.getActiveUniform(d,x),M=a.getUniformLocation(d,w.name);RSe(w,M,this)}}setValue(a,d,A,x){const w=this.map[d];w!==void 0&&w.setValue(a,A,x)}setOptional(a,d,A){const x=d[A];x!==void 0&&this.setValue(a,A,x)}static upload(a,d,A,x){for(let w=0,M=d.length;w!==M;++w){const L=d[w],O=A[L.id];O.needsUpdate!==!1&&L.setValue(a,O.value,x)}}static seqWithValue(a,d){const A=[];for(let x=0,w=a.length;x!==w;++x){const M=a[x];M.id in d&&A.push(M)}return A}}function h9(S,a,d){const A=S.createShader(a);return S.shaderSource(A,d),S.compileShader(A),A}const ISe=37297;let BSe=0;function LSe(S,a){const d=S.split(`
`),A=[],x=Math.max(a-6,0),w=Math.min(a+6,d.length);for(let M=x;M<w;M++){const L=M+1;A.push(`${L===a?">":" "} ${L}: ${d[M]}`)}return A.join(`
`)}function DSe(S){const a=Yn.getPrimaries(Yn.workingColorSpace),d=Yn.getPrimaries(S);let A;switch(a===d?A="":a===of&&d===af?A="LinearDisplayP3ToLinearSRGB":a===af&&d===of&&(A="LinearSRGBToLinearDisplayP3"),S){case Rc:case nf:return[A,"LinearTransferOETF"];case Nn:case Xg:return[A,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",S),[A,"LinearTransferOETF"]}}function d9(S,a,d){const A=S.getShaderParameter(a,S.COMPILE_STATUS),x=S.getShaderInfoLog(a).trim();if(A&&x==="")return"";const w=/ERROR: 0:(\d+)/.exec(x);if(w){const M=parseInt(w[1]);return d.toUpperCase()+`

`+x+`

`+LSe(S.getShaderSource(a),M)}else return x}function NSe(S,a){const d=DSe(a);return`vec4 ${S}( vec4 value ) { return ${d[0]}( ${d[1]}( value ) ); }`}function PSe(S,a){let d;switch(a){case Zt:d="Linear";break;case jt:d="Reinhard";break;case xi:d="OptimizedCineon";break;case vt:d="ACESFilmic";break;case be:d="AgX";break;case Ne:d="Neutral";break;case ge:d="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",a),d="Linear"}return"vec3 "+S+"( vec3 color ) { return "+d+"ToneMapping( color ); }"}function OSe(S){return[S.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",S.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(gv).join(`
`)}function kSe(S){const a=[];for(const d in S){const A=S[d];A!==!1&&a.push("#define "+d+" "+A)}return a.join(`
`)}function FSe(S,a){const d={},A=S.getProgramParameter(a,S.ACTIVE_ATTRIBUTES);for(let x=0;x<A;x++){const w=S.getActiveAttrib(a,x),M=w.name;let L=1;w.type===S.FLOAT_MAT2&&(L=2),w.type===S.FLOAT_MAT3&&(L=3),w.type===S.FLOAT_MAT4&&(L=4),d[M]={type:w.type,location:S.getAttribLocation(a,M),locationSize:L}}return d}function gv(S){return S!==""}function p9(S,a){const d=a.numSpotLightShadows+a.numSpotLightMaps-a.numSpotLightShadowsWithMaps;return S.replace(/NUM_DIR_LIGHTS/g,a.numDirLights).replace(/NUM_SPOT_LIGHTS/g,a.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,a.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,d).replace(/NUM_RECT_AREA_LIGHTS/g,a.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,a.numPointLights).replace(/NUM_HEMI_LIGHTS/g,a.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,a.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,a.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,a.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,a.numPointLightShadows)}function f9(S,a){return S.replace(/NUM_CLIPPING_PLANES/g,a.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,a.numClippingPlanes-a.numClipIntersection)}const USe=/^[ \t]*#include +<([\w\d./]+)>/gm;function qB(S){return S.replace(USe,jSe)}const zSe=new Map;function jSe(S,a){let d=an[a];if(d===void 0){const A=zSe.get(a);if(A!==void 0)d=an[A],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',a,A);else throw new Error("Can not resolve #include <"+a+">")}return qB(d)}const VSe=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function m9(S){return S.replace(VSe,GSe)}function GSe(S,a,d,A){let x="";for(let w=parseInt(a);w<parseInt(d);w++)x+=A.replace(/\[\s*i\s*\]/g,"[ "+w+" ]").replace(/UNROLLED_LOOP_INDEX/g,w);return x}function g9(S){let a=`precision ${S.precision} float;
	precision ${S.precision} int;
	precision ${S.precision} sampler2D;
	precision ${S.precision} samplerCube;
	precision ${S.precision} sampler3D;
	precision ${S.precision} sampler2DArray;
	precision ${S.precision} sampler2DShadow;
	precision ${S.precision} samplerCubeShadow;
	precision ${S.precision} sampler2DArrayShadow;
	precision ${S.precision} isampler2D;
	precision ${S.precision} isampler3D;
	precision ${S.precision} isamplerCube;
	precision ${S.precision} isampler2DArray;
	precision ${S.precision} usampler2D;
	precision ${S.precision} usampler3D;
	precision ${S.precision} usamplerCube;
	precision ${S.precision} usampler2DArray;
	`;return S.precision==="highp"?a+=`
#define HIGH_PRECISION`:S.precision==="mediump"?a+=`
#define MEDIUM_PRECISION`:S.precision==="lowp"&&(a+=`
#define LOW_PRECISION`),a}function HSe(S){let a="SHADOWMAP_TYPE_BASIC";return S.shadowMapType===_?a="SHADOWMAP_TYPE_PCF":S.shadowMapType===T?a="SHADOWMAP_TYPE_PCF_SOFT":S.shadowMapType===E&&(a="SHADOWMAP_TYPE_VSM"),a}function WSe(S){let a="ENVMAP_TYPE_CUBE";if(S.envMap)switch(S.envMapMode){case U:case $:a="ENVMAP_TYPE_CUBE";break;case ce:a="ENVMAP_TYPE_CUBE_UV";break}return a}function QSe(S){let a="ENVMAP_MODE_REFLECTION";if(S.envMap)switch(S.envMapMode){case $:a="ENVMAP_MODE_REFRACTION";break}return a}function qSe(S){let a="ENVMAP_BLENDING_NONE";if(S.envMap)switch(S.combine){case We:a="ENVMAP_BLENDING_MULTIPLY";break;case Ce:a="ENVMAP_BLENDING_MIX";break;case At:a="ENVMAP_BLENDING_ADD";break}return a}function XSe(S){const a=S.envMapCubeUVHeight;if(a===null)return null;const d=Math.log2(a)-2,A=1/a;return{texelWidth:1/(3*Math.max(Math.pow(2,d),112)),texelHeight:A,maxMip:d}}function YSe(S,a,d,A){const x=S.getContext(),w=d.defines;let M=d.vertexShader,L=d.fragmentShader;const O=HSe(d),F=WSe(d),H=QSe(d),J=qSe(d),K=XSe(d),Z=OSe(d),ie=kSe(w),oe=x.createProgram();let ne,ee,Re=d.glslVersion?"#version "+d.glslVersion+`
`:"";const we=d.numMultiviewViews;d.isRawShaderMaterial?(ne=["#define SHADER_TYPE "+d.shaderType,"#define SHADER_NAME "+d.shaderName,ie].filter(gv).join(`
`),ne.length>0&&(ne+=`
`),ee=["#define SHADER_TYPE "+d.shaderType,"#define SHADER_NAME "+d.shaderName,ie].filter(gv).join(`
`),ee.length>0&&(ee+=`
`)):(ne=[g9(d),"#define SHADER_TYPE "+d.shaderType,"#define SHADER_NAME "+d.shaderName,ie,d.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",d.batching?"#define USE_BATCHING":"",d.instancing?"#define USE_INSTANCING":"",d.instancingColor?"#define USE_INSTANCING_COLOR":"",d.instancingMorph?"#define USE_INSTANCING_MORPH":"",d.useFog&&d.fog?"#define USE_FOG":"",d.useFog&&d.fogExp2?"#define FOG_EXP2":"",d.map?"#define USE_MAP":"",d.envMap?"#define USE_ENVMAP":"",d.envMap?"#define "+H:"",d.lightMap?"#define USE_LIGHTMAP":"",d.aoMap?"#define USE_AOMAP":"",d.bumpMap?"#define USE_BUMPMAP":"",d.normalMap?"#define USE_NORMALMAP":"",d.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",d.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",d.displacementMap?"#define USE_DISPLACEMENTMAP":"",d.emissiveMap?"#define USE_EMISSIVEMAP":"",d.anisotropy?"#define USE_ANISOTROPY":"",d.anisotropyMap?"#define USE_ANISOTROPYMAP":"",d.clearcoatMap?"#define USE_CLEARCOATMAP":"",d.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",d.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",d.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",d.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",d.specularMap?"#define USE_SPECULARMAP":"",d.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",d.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",d.roughnessMap?"#define USE_ROUGHNESSMAP":"",d.metalnessMap?"#define USE_METALNESSMAP":"",d.alphaMap?"#define USE_ALPHAMAP":"",d.alphaHash?"#define USE_ALPHAHASH":"",d.transmission?"#define USE_TRANSMISSION":"",d.transmissionMap?"#define USE_TRANSMISSIONMAP":"",d.thicknessMap?"#define USE_THICKNESSMAP":"",d.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",d.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",d.mapUv?"#define MAP_UV "+d.mapUv:"",d.alphaMapUv?"#define ALPHAMAP_UV "+d.alphaMapUv:"",d.lightMapUv?"#define LIGHTMAP_UV "+d.lightMapUv:"",d.aoMapUv?"#define AOMAP_UV "+d.aoMapUv:"",d.emissiveMapUv?"#define EMISSIVEMAP_UV "+d.emissiveMapUv:"",d.bumpMapUv?"#define BUMPMAP_UV "+d.bumpMapUv:"",d.normalMapUv?"#define NORMALMAP_UV "+d.normalMapUv:"",d.displacementMapUv?"#define DISPLACEMENTMAP_UV "+d.displacementMapUv:"",d.metalnessMapUv?"#define METALNESSMAP_UV "+d.metalnessMapUv:"",d.roughnessMapUv?"#define ROUGHNESSMAP_UV "+d.roughnessMapUv:"",d.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+d.anisotropyMapUv:"",d.clearcoatMapUv?"#define CLEARCOATMAP_UV "+d.clearcoatMapUv:"",d.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+d.clearcoatNormalMapUv:"",d.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+d.clearcoatRoughnessMapUv:"",d.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+d.iridescenceMapUv:"",d.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+d.iridescenceThicknessMapUv:"",d.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+d.sheenColorMapUv:"",d.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+d.sheenRoughnessMapUv:"",d.specularMapUv?"#define SPECULARMAP_UV "+d.specularMapUv:"",d.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+d.specularColorMapUv:"",d.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+d.specularIntensityMapUv:"",d.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+d.transmissionMapUv:"",d.thicknessMapUv?"#define THICKNESSMAP_UV "+d.thicknessMapUv:"",d.vertexTangents&&d.flatShading===!1?"#define USE_TANGENT":"",d.vertexColors?"#define USE_COLOR":"",d.vertexAlphas?"#define USE_COLOR_ALPHA":"",d.vertexUv1s?"#define USE_UV1":"",d.vertexUv2s?"#define USE_UV2":"",d.vertexUv3s?"#define USE_UV3":"",d.pointsUvs?"#define USE_POINTS_UV":"",d.flatShading?"#define FLAT_SHADED":"",d.skinning?"#define USE_SKINNING":"",d.morphTargets?"#define USE_MORPHTARGETS":"",d.morphNormals&&d.flatShading===!1?"#define USE_MORPHNORMALS":"",d.morphColors?"#define USE_MORPHCOLORS":"",d.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE":"",d.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+d.morphTextureStride:"",d.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+d.morphTargetsCount:"",d.doubleSided?"#define DOUBLE_SIDED":"",d.flipSided?"#define FLIP_SIDED":"",d.shadowMapEnabled?"#define USE_SHADOWMAP":"",d.shadowMapEnabled?"#define "+O:"",d.sizeAttenuation?"#define USE_SIZEATTENUATION":"",d.numLightProbes>0?"#define USE_LIGHT_PROBES":"",d.useLegacyLights?"#define LEGACY_LIGHTS":"",d.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(gv).join(`
`),ee=[g9(d),"#define SHADER_TYPE "+d.shaderType,"#define SHADER_NAME "+d.shaderName,ie,d.useFog&&d.fog?"#define USE_FOG":"",d.useFog&&d.fogExp2?"#define FOG_EXP2":"",d.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",d.map?"#define USE_MAP":"",d.matcap?"#define USE_MATCAP":"",d.envMap?"#define USE_ENVMAP":"",d.envMap?"#define "+F:"",d.envMap?"#define "+H:"",d.envMap?"#define "+J:"",K?"#define CUBEUV_TEXEL_WIDTH "+K.texelWidth:"",K?"#define CUBEUV_TEXEL_HEIGHT "+K.texelHeight:"",K?"#define CUBEUV_MAX_MIP "+K.maxMip+".0":"",d.lightMap?"#define USE_LIGHTMAP":"",d.aoMap?"#define USE_AOMAP":"",d.bumpMap?"#define USE_BUMPMAP":"",d.normalMap?"#define USE_NORMALMAP":"",d.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",d.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",d.emissiveMap?"#define USE_EMISSIVEMAP":"",d.anisotropy?"#define USE_ANISOTROPY":"",d.anisotropyMap?"#define USE_ANISOTROPYMAP":"",d.clearcoat?"#define USE_CLEARCOAT":"",d.clearcoatMap?"#define USE_CLEARCOATMAP":"",d.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",d.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",d.dispersion?"#define USE_DISPERSION":"",d.iridescence?"#define USE_IRIDESCENCE":"",d.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",d.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",d.specularMap?"#define USE_SPECULARMAP":"",d.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",d.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",d.roughnessMap?"#define USE_ROUGHNESSMAP":"",d.metalnessMap?"#define USE_METALNESSMAP":"",d.alphaMap?"#define USE_ALPHAMAP":"",d.alphaTest?"#define USE_ALPHATEST":"",d.alphaHash?"#define USE_ALPHAHASH":"",d.sheen?"#define USE_SHEEN":"",d.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",d.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",d.transmission?"#define USE_TRANSMISSION":"",d.transmissionMap?"#define USE_TRANSMISSIONMAP":"",d.thicknessMap?"#define USE_THICKNESSMAP":"",d.vertexTangents&&d.flatShading===!1?"#define USE_TANGENT":"",d.vertexColors||d.instancingColor?"#define USE_COLOR":"",d.vertexAlphas?"#define USE_COLOR_ALPHA":"",d.vertexUv1s?"#define USE_UV1":"",d.vertexUv2s?"#define USE_UV2":"",d.vertexUv3s?"#define USE_UV3":"",d.pointsUvs?"#define USE_POINTS_UV":"",d.gradientMap?"#define USE_GRADIENTMAP":"",d.flatShading?"#define FLAT_SHADED":"",d.doubleSided?"#define DOUBLE_SIDED":"",d.flipSided?"#define FLIP_SIDED":"",d.shadowMapEnabled?"#define USE_SHADOWMAP":"",d.shadowMapEnabled?"#define "+O:"",d.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",d.numLightProbes>0?"#define USE_LIGHT_PROBES":"",d.useLegacyLights?"#define LEGACY_LIGHTS":"",d.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",d.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",d.toneMapping!==Ot?"#define TONE_MAPPING":"",d.toneMapping!==Ot?an.tonemapping_pars_fragment:"",d.toneMapping!==Ot?PSe("toneMapping",d.toneMapping):"",d.dithering?"#define DITHERING":"",d.opaque?"#define OPAQUE":"",an.colorspace_pars_fragment,NSe("linearToOutputTexel",d.outputColorSpace),d.useDepthPacking?"#define DEPTH_PACKING "+d.depthPacking:"",`
`].filter(gv).join(`
`)),M=qB(M),M=p9(M,d),M=f9(M,d),L=qB(L),L=p9(L,d),L=f9(L,d),M=m9(M),L=m9(L),d.isRawShaderMaterial!==!0&&(Re=`#version 300 es
`,ne=[Z,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+ne,ee=["#define varying in",d.glslVersion===sv?"":"layout(location = 0) out highp vec4 pc_fragColor;",d.glslVersion===sv?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+ee,we>0&&(ne=["#extension GL_OVR_multiview : require","layout(num_views = "+we+") in;","#define VIEW_ID gl_ViewID_OVR"].join(`
`)+`
`+ne,ne=ne.replace(["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;"].join(`
`),["uniform mat4 modelViewMatrices["+we+"];","uniform mat4 projectionMatrices["+we+"];","uniform mat4 viewMatrices["+we+"];","uniform mat3 normalMatrices["+we+"];","#define modelViewMatrix modelViewMatrices[VIEW_ID]","#define projectionMatrix projectionMatrices[VIEW_ID]","#define viewMatrix viewMatrices[VIEW_ID]","#define normalMatrix normalMatrices[VIEW_ID]"].join(`
`)),ee=["#extension GL_OVR_multiview : require","#define VIEW_ID gl_ViewID_OVR"].join(`
`)+`
`+ee,ee=ee.replace("uniform mat4 viewMatrix;",["uniform mat4 viewMatrices["+we+"];","#define viewMatrix viewMatrices[VIEW_ID]"].join(`
`))));const _e=Re+ne+M,st=Re+ee+L,qe=h9(x,x.VERTEX_SHADER,_e),Ze=h9(x,x.FRAGMENT_SHADER,st);x.attachShader(oe,qe),x.attachShader(oe,Ze),d.index0AttributeName!==void 0?x.bindAttribLocation(oe,0,d.index0AttributeName):d.morphTargets===!0&&x.bindAttribLocation(oe,0,"position"),x.linkProgram(oe);function rt(gt){if(S.debug.checkShaderErrors){const ft=x.getProgramInfoLog(oe).trim(),It=x.getShaderInfoLog(qe).trim(),Ft=x.getShaderInfoLog(Ze).trim();let pi=!0,Ni=!0;if(x.getProgramParameter(oe,x.LINK_STATUS)===!1)if(pi=!1,typeof S.debug.onShaderError=="function")S.debug.onShaderError(x,oe,qe,Ze);else{const Ut=d9(x,qe,"vertex"),yi=d9(x,Ze,"fragment");console.error("THREE.WebGLProgram: Shader Error "+x.getError()+" - VALIDATE_STATUS "+x.getProgramParameter(oe,x.VALIDATE_STATUS)+`

Material Name: `+gt.name+`
Material Type: `+gt.type+`

Program Info Log: `+ft+`
`+Ut+`
`+yi)}else ft!==""?console.warn("THREE.WebGLProgram: Program Info Log:",ft):(It===""||Ft==="")&&(Ni=!1);Ni&&(gt.diagnostics={runnable:pi,programLog:ft,vertexShader:{log:It,prefix:ne},fragmentShader:{log:Ft,prefix:ee}})}x.deleteShader(qe),x.deleteShader(Ze),je=new zE(x,oe),ke=FSe(x,oe)}let je;this.getUniforms=function(){return je===void 0&&rt(this),je};let ke;this.getAttributes=function(){return ke===void 0&&rt(this),ke};let nt=d.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return nt===!1&&(nt=x.getProgramParameter(oe,ISe)),nt},this.destroy=function(){A.releaseStatesOfProgram(this),x.deleteProgram(oe),this.program=void 0},this.type=d.shaderType,this.name=d.shaderName,this.id=BSe++,this.cacheKey=a,this.usedTimes=1,this.program=oe,this.vertexShader=qe,this.fragmentShader=Ze,this.numMultiviewViews=we,this}let KSe=0;class JSe{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(a){const d=a.vertexShader,A=a.fragmentShader,x=this._getShaderStage(d),w=this._getShaderStage(A),M=this._getShaderCacheForMaterial(a);return M.has(x)===!1&&(M.add(x),x.usedTimes++),M.has(w)===!1&&(M.add(w),w.usedTimes++),this}remove(a){const d=this.materialCache.get(a);for(const A of d)A.usedTimes--,A.usedTimes===0&&this.shaderCache.delete(A.code);return this.materialCache.delete(a),this}getVertexShaderID(a){return this._getShaderStage(a.vertexShader).id}getFragmentShaderID(a){return this._getShaderStage(a.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(a){const d=this.materialCache;let A=d.get(a);return A===void 0&&(A=new Set,d.set(a,A)),A}_getShaderStage(a){const d=this.shaderCache;let A=d.get(a);return A===void 0&&(A=new ZSe(a),d.set(a,A)),A}}class ZSe{constructor(a){this.id=KSe++,this.code=a,this.usedTimes=0}}function $Se(S,a,d,A,x,w,M){const L=new _E,O=new JSe,F=new Set,H=[],J=x.logarithmicDepthBuffer,K=x.vertexTextures;let Z=x.precision;const ie={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function oe(je){return F.add(je),je===0?"uv":`uv${je}`}function ne(je,ke,nt,gt,ft){const It=gt.fog,Ft=ft.geometry,pi=je.isMeshStandardMaterial?gt.environment:null,Ni=(je.isMeshStandardMaterial?d:a).get(je.envMap||pi),Ut=Ni&&Ni.mapping===ce?Ni.image.height:null,yi=ie[je.type];je.precision!==null&&(Z=x.getMaxPrecision(je.precision),Z!==je.precision&&console.warn("THREE.WebGLProgram.getParameters:",je.precision,"not supported, using",Z,"instead."));const Pi=Ft.morphAttributes.position||Ft.morphAttributes.normal||Ft.morphAttributes.color,Ur=Pi!==void 0?Pi.length:0;let xn=0;Ft.morphAttributes.position!==void 0&&(xn=1),Ft.morphAttributes.normal!==void 0&&(xn=2),Ft.morphAttributes.color!==void 0&&(xn=3);let ts,ds,zn,Bn;if(yi){const Ql=Lc[yi];ts=Ql.vertexShader,ds=Ql.fragmentShader}else ts=je.vertexShader,ds=je.fragmentShader,O.update(je),zn=O.getVertexShaderID(je),Bn=O.getFragmentShaderID(je);const Cr=S.getRenderTarget(),hi=Cr&&Cr.isWebGLMultiviewRenderTarget?Cr.numViews:0,Ci=ft.isInstancedMesh===!0,qi=ft.isBatchedMesh===!0,tt=!!je.map,mi=!!je.matcap,ti=!!Ni,er=!!je.aoMap,li=!!je.lightMap,ir=!!je.bumpMap,tr=!!je.normalMap,Ar=!!je.displacementMap,An=!!je.emissiveMap,Wr=!!je.metalnessMap,ha=!!je.roughnessMap,Ys=je.anisotropy>0,Hn=je.clearcoat>0,et=je.dispersion>0,Pe=je.iridescence>0,zt=je.sheen>0,di=je.transmission>0,gi=Ys&&!!je.anisotropyMap,oi=Hn&&!!je.clearcoatMap,Rr=Hn&&!!je.clearcoatNormalMap,zi=Hn&&!!je.clearcoatRoughnessMap,cr=Pe&&!!je.iridescenceMap,Wn=Pe&&!!je.iridescenceThicknessMap,lr=zt&&!!je.sheenColorMap,_r=zt&&!!je.sheenRoughnessMap,_n=!!je.specularMap,zr=!!je.specularColorMap,ut=!!je.specularIntensityMap,vi=di&&!!je.transmissionMap,Ri=di&&!!je.thicknessMap,Mr=!!je.gradientMap,rr=!!je.alphaMap,on=je.alphaTest>0,nr=!!je.alphaHash,Ji=!!je.extensions;let yn=Ot;je.toneMapped&&(Cr===null||Cr.isXRRenderTarget===!0)&&(yn=S.toneMapping);const Ir={shaderID:yi,shaderType:je.type,shaderName:je.name,vertexShader:ts,fragmentShader:ds,defines:je.defines,customVertexShaderID:zn,customFragmentShaderID:Bn,isRawShaderMaterial:je.isRawShaderMaterial===!0,glslVersion:je.glslVersion,precision:Z,batching:qi,instancing:Ci,instancingColor:Ci&&ft.instanceColor!==null,instancingMorph:Ci&&ft.morphTexture!==null,supportsVertexTextures:K,numMultiviewViews:hi,outputColorSpace:Cr===null?S.outputColorSpace:Cr.isXRRenderTarget===!0?Cr.texture.colorSpace:Rc,alphaToCoverage:!!je.alphaToCoverage,map:tt,matcap:mi,envMap:ti,envMapMode:ti&&Ni.mapping,envMapCubeUVHeight:Ut,aoMap:er,lightMap:li,bumpMap:ir,normalMap:tr,displacementMap:K&&Ar,emissiveMap:An,normalMapObjectSpace:tr&&je.normalMapType===ru,normalMapTangentSpace:tr&&je.normalMapType===ao,metalnessMap:Wr,roughnessMap:ha,anisotropy:Ys,anisotropyMap:gi,clearcoat:Hn,clearcoatMap:oi,clearcoatNormalMap:Rr,clearcoatRoughnessMap:zi,dispersion:et,iridescence:Pe,iridescenceMap:cr,iridescenceThicknessMap:Wn,sheen:zt,sheenColorMap:lr,sheenRoughnessMap:_r,specularMap:_n,specularColorMap:zr,specularIntensityMap:ut,transmission:di,transmissionMap:vi,thicknessMap:Ri,gradientMap:Mr,opaque:je.transparent===!1&&je.blending===N&&je.alphaToCoverage===!1,alphaMap:rr,alphaTest:on,alphaHash:nr,combine:je.combine,mapUv:tt&&oe(je.map.channel),aoMapUv:er&&oe(je.aoMap.channel),lightMapUv:li&&oe(je.lightMap.channel),bumpMapUv:ir&&oe(je.bumpMap.channel),normalMapUv:tr&&oe(je.normalMap.channel),displacementMapUv:Ar&&oe(je.displacementMap.channel),emissiveMapUv:An&&oe(je.emissiveMap.channel),metalnessMapUv:Wr&&oe(je.metalnessMap.channel),roughnessMapUv:ha&&oe(je.roughnessMap.channel),anisotropyMapUv:gi&&oe(je.anisotropyMap.channel),clearcoatMapUv:oi&&oe(je.clearcoatMap.channel),clearcoatNormalMapUv:Rr&&oe(je.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:zi&&oe(je.clearcoatRoughnessMap.channel),iridescenceMapUv:cr&&oe(je.iridescenceMap.channel),iridescenceThicknessMapUv:Wn&&oe(je.iridescenceThicknessMap.channel),sheenColorMapUv:lr&&oe(je.sheenColorMap.channel),sheenRoughnessMapUv:_r&&oe(je.sheenRoughnessMap.channel),specularMapUv:_n&&oe(je.specularMap.channel),specularColorMapUv:zr&&oe(je.specularColorMap.channel),specularIntensityMapUv:ut&&oe(je.specularIntensityMap.channel),transmissionMapUv:vi&&oe(je.transmissionMap.channel),thicknessMapUv:Ri&&oe(je.thicknessMap.channel),alphaMapUv:rr&&oe(je.alphaMap.channel),vertexTangents:!!Ft.attributes.tangent&&(tr||Ys),vertexColors:je.vertexColors,vertexAlphas:je.vertexColors===!0&&!!Ft.attributes.color&&Ft.attributes.color.itemSize===4,pointsUvs:ft.isPoints===!0&&!!Ft.attributes.uv&&(tt||rr),fog:!!It,useFog:je.fog===!0,fogExp2:!!It&&It.isFogExp2,flatShading:je.flatShading===!0,sizeAttenuation:je.sizeAttenuation===!0,logarithmicDepthBuffer:J,skinning:ft.isSkinnedMesh===!0,morphTargets:Ft.morphAttributes.position!==void 0,morphNormals:Ft.morphAttributes.normal!==void 0,morphColors:Ft.morphAttributes.color!==void 0,morphTargetsCount:Ur,morphTextureStride:xn,numDirLights:ke.directional.length,numPointLights:ke.point.length,numSpotLights:ke.spot.length,numSpotLightMaps:ke.spotLightMap.length,numRectAreaLights:ke.rectArea.length,numHemiLights:ke.hemi.length,numDirLightShadows:ke.directionalShadowMap.length,numPointLightShadows:ke.pointShadowMap.length,numSpotLightShadows:ke.spotShadowMap.length,numSpotLightShadowsWithMaps:ke.numSpotLightShadowsWithMaps,numLightProbes:ke.numLightProbes,numClippingPlanes:M.numPlanes,numClipIntersection:M.numIntersection,dithering:je.dithering,shadowMapEnabled:S.shadowMap.enabled&&nt.length>0,shadowMapType:S.shadowMap.type,toneMapping:yn,useLegacyLights:S._useLegacyLights,decodeVideoTexture:tt&&je.map.isVideoTexture===!0&&Yn.getTransfer(je.map.colorSpace)===ls,premultipliedAlpha:je.premultipliedAlpha,doubleSided:je.side===B,flipSided:je.side===R,useDepthPacking:je.depthPacking>=0,depthPacking:je.depthPacking||0,index0AttributeName:je.index0AttributeName,extensionClipCullDistance:Ji&&je.extensions.clipCullDistance===!0&&A.has("WEBGL_clip_cull_distance"),extensionMultiDraw:Ji&&je.extensions.multiDraw===!0&&A.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:A.has("KHR_parallel_shader_compile"),customProgramCacheKey:je.customProgramCacheKey()};return Ir.vertexUv1s=F.has(1),Ir.vertexUv2s=F.has(2),Ir.vertexUv3s=F.has(3),F.clear(),Ir}function ee(je){const ke=[];if(je.shaderID?ke.push(je.shaderID):(ke.push(je.customVertexShaderID),ke.push(je.customFragmentShaderID)),je.defines!==void 0)for(const nt in je.defines)ke.push(nt),ke.push(je.defines[nt]);return je.isRawShaderMaterial===!1&&(Re(ke,je),we(ke,je),ke.push(S.outputColorSpace)),ke.push(je.customProgramCacheKey),ke.join()}function Re(je,ke){je.push(ke.precision),je.push(ke.outputColorSpace),je.push(ke.envMapMode),je.push(ke.envMapCubeUVHeight),je.push(ke.mapUv),je.push(ke.alphaMapUv),je.push(ke.lightMapUv),je.push(ke.aoMapUv),je.push(ke.bumpMapUv),je.push(ke.normalMapUv),je.push(ke.displacementMapUv),je.push(ke.emissiveMapUv),je.push(ke.metalnessMapUv),je.push(ke.roughnessMapUv),je.push(ke.anisotropyMapUv),je.push(ke.clearcoatMapUv),je.push(ke.clearcoatNormalMapUv),je.push(ke.clearcoatRoughnessMapUv),je.push(ke.iridescenceMapUv),je.push(ke.iridescenceThicknessMapUv),je.push(ke.sheenColorMapUv),je.push(ke.sheenRoughnessMapUv),je.push(ke.specularMapUv),je.push(ke.specularColorMapUv),je.push(ke.specularIntensityMapUv),je.push(ke.transmissionMapUv),je.push(ke.thicknessMapUv),je.push(ke.combine),je.push(ke.fogExp2),je.push(ke.sizeAttenuation),je.push(ke.morphTargetsCount),je.push(ke.morphAttributeCount),je.push(ke.numDirLights),je.push(ke.numPointLights),je.push(ke.numSpotLights),je.push(ke.numSpotLightMaps),je.push(ke.numHemiLights),je.push(ke.numRectAreaLights),je.push(ke.numDirLightShadows),je.push(ke.numPointLightShadows),je.push(ke.numSpotLightShadows),je.push(ke.numSpotLightShadowsWithMaps),je.push(ke.numLightProbes),je.push(ke.shadowMapType),je.push(ke.toneMapping),je.push(ke.numClippingPlanes),je.push(ke.numClipIntersection),je.push(ke.depthPacking)}function we(je,ke){L.disableAll(),ke.supportsVertexTextures&&L.enable(0),ke.instancing&&L.enable(1),ke.instancingColor&&L.enable(2),ke.instancingMorph&&L.enable(3),ke.matcap&&L.enable(4),ke.envMap&&L.enable(5),ke.normalMapObjectSpace&&L.enable(6),ke.normalMapTangentSpace&&L.enable(7),ke.clearcoat&&L.enable(8),ke.iridescence&&L.enable(9),ke.alphaTest&&L.enable(10),ke.vertexColors&&L.enable(11),ke.vertexAlphas&&L.enable(12),ke.vertexUv1s&&L.enable(13),ke.vertexUv2s&&L.enable(14),ke.vertexUv3s&&L.enable(15),ke.vertexTangents&&L.enable(16),ke.anisotropy&&L.enable(17),ke.alphaHash&&L.enable(18),ke.batching&&L.enable(19),ke.dispersion&&L.enable(20),je.push(L.mask),L.disableAll(),ke.fog&&L.enable(0),ke.useFog&&L.enable(1),ke.flatShading&&L.enable(2),ke.logarithmicDepthBuffer&&L.enable(3),ke.skinning&&L.enable(4),ke.morphTargets&&L.enable(5),ke.morphNormals&&L.enable(6),ke.morphColors&&L.enable(7),ke.premultipliedAlpha&&L.enable(8),ke.shadowMapEnabled&&L.enable(9),ke.useLegacyLights&&L.enable(10),ke.doubleSided&&L.enable(11),ke.flipSided&&L.enable(12),ke.useDepthPacking&&L.enable(13),ke.dithering&&L.enable(14),ke.transmission&&L.enable(15),ke.sheen&&L.enable(16),ke.opaque&&L.enable(17),ke.pointsUvs&&L.enable(18),ke.decodeVideoTexture&&L.enable(19),ke.alphaToCoverage&&L.enable(20),ke.numMultiviewViews&&L.enable(21),je.push(L.mask)}function _e(je){const ke=ie[je.type];let nt;if(ke){const gt=Lc[ke];nt=Gj.clone(gt.uniforms)}else nt=je.uniforms;return nt}function st(je,ke){let nt;for(let gt=0,ft=H.length;gt<ft;gt++){const It=H[gt];if(It.cacheKey===ke){nt=It,++nt.usedTimes;break}}return nt===void 0&&(nt=new YSe(S,ke,je,w),H.push(nt)),nt}function qe(je){if(--je.usedTimes===0){const ke=H.indexOf(je);H[ke]=H[H.length-1],H.pop(),je.destroy()}}function Ze(je){O.remove(je)}function rt(){O.dispose()}return{getParameters:ne,getProgramCacheKey:ee,getUniforms:_e,acquireProgram:st,releaseProgram:qe,releaseShaderCache:Ze,programs:H,dispose:rt}}function eTe(){let S=new WeakMap;function a(w){let M=S.get(w);return M===void 0&&(M={},S.set(w,M)),M}function d(w){S.delete(w)}function A(w,M,L){S.get(w)[M]=L}function x(){S=new WeakMap}return{get:a,remove:d,update:A,dispose:x}}function tTe(S,a){return S.groupOrder!==a.groupOrder?S.groupOrder-a.groupOrder:S.renderOrder!==a.renderOrder?S.renderOrder-a.renderOrder:S.material.id!==a.material.id?S.material.id-a.material.id:S.z!==a.z?S.z-a.z:S.id-a.id}function A9(S,a){return S.groupOrder!==a.groupOrder?S.groupOrder-a.groupOrder:S.renderOrder!==a.renderOrder?S.renderOrder-a.renderOrder:S.z!==a.z?a.z-S.z:S.id-a.id}function y9(){const S=[];let a=0;const d=[],A=[],x=[];function w(){a=0,d.length=0,A.length=0,x.length=0}function M(J,K,Z,ie,oe,ne){let ee=S[a];return ee===void 0?(ee={id:J.id,object:J,geometry:K,material:Z,groupOrder:ie,renderOrder:J.renderOrder,z:oe,group:ne},S[a]=ee):(ee.id=J.id,ee.object=J,ee.geometry=K,ee.material=Z,ee.groupOrder=ie,ee.renderOrder=J.renderOrder,ee.z=oe,ee.group=ne),a++,ee}function L(J,K,Z,ie,oe,ne){const ee=M(J,K,Z,ie,oe,ne);Z.transmission>0?A.push(ee):Z.transparent===!0?x.push(ee):d.push(ee)}function O(J,K,Z,ie,oe,ne){const ee=M(J,K,Z,ie,oe,ne);Z.transmission>0?A.unshift(ee):Z.transparent===!0?x.unshift(ee):d.unshift(ee)}function F(J,K){d.length>1&&d.sort(J||tTe),A.length>1&&A.sort(K||A9),x.length>1&&x.sort(K||A9)}function H(){for(let J=a,K=S.length;J<K;J++){const Z=S[J];if(Z.id===null)break;Z.id=null,Z.object=null,Z.geometry=null,Z.material=null,Z.group=null}}return{opaque:d,transmissive:A,transparent:x,init:w,push:L,unshift:O,finish:H,sort:F}}function iTe(){let S=new WeakMap;function a(A,x){const w=S.get(A);let M;return w===void 0?(M=new y9,S.set(A,[M])):x>=w.length?(M=new y9,w.push(M)):M=w[x],M}function d(){S=new WeakMap}return{get:a,dispose:d}}function rTe(){const S={};return{get:function(a){if(S[a.id]!==void 0)return S[a.id];let d;switch(a.type){case"DirectionalLight":d={direction:new He,color:new or};break;case"SpotLight":d={position:new He,direction:new He,color:new or,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":d={position:new He,color:new or,distance:0,decay:0};break;case"HemisphereLight":d={direction:new He,skyColor:new or,groundColor:new or};break;case"RectAreaLight":d={color:new or,position:new He,halfWidth:new He,halfHeight:new He};break}return S[a.id]=d,d}}}function nTe(){const S={};return{get:function(a){if(S[a.id]!==void 0)return S[a.id];let d;switch(a.type){case"DirectionalLight":d={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ai};break;case"SpotLight":d={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ai};break;case"PointLight":d={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ai,shadowCameraNear:1,shadowCameraFar:1e3};break}return S[a.id]=d,d}}}let sTe=0;function aTe(S,a){return(a.castShadow?2:0)-(S.castShadow?2:0)+(a.map?1:0)-(S.map?1:0)}function oTe(S){const a=new rTe,d=nTe(),A={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let F=0;F<9;F++)A.probe.push(new He);const x=new He,w=new fr,M=new fr;function L(F,H){let J=0,K=0,Z=0;for(let nt=0;nt<9;nt++)A.probe[nt].set(0,0,0);let ie=0,oe=0,ne=0,ee=0,Re=0,we=0,_e=0,st=0,qe=0,Ze=0,rt=0;F.sort(aTe);const je=H===!0?Math.PI:1;for(let nt=0,gt=F.length;nt<gt;nt++){const ft=F[nt],It=ft.color,Ft=ft.intensity,pi=ft.distance,Ni=ft.shadow&&ft.shadow.map?ft.shadow.map.texture:null;if(ft.isAmbientLight)J+=It.r*Ft*je,K+=It.g*Ft*je,Z+=It.b*Ft*je;else if(ft.isLightProbe){for(let Ut=0;Ut<9;Ut++)A.probe[Ut].addScaledVector(ft.sh.coefficients[Ut],Ft);rt++}else if(ft.isDirectionalLight){const Ut=a.get(ft);if(Ut.color.copy(ft.color).multiplyScalar(ft.intensity*je),ft.castShadow){const yi=ft.shadow,Pi=d.get(ft);Pi.shadowBias=yi.bias,Pi.shadowNormalBias=yi.normalBias,Pi.shadowRadius=yi.radius,Pi.shadowMapSize=yi.mapSize,A.directionalShadow[ie]=Pi,A.directionalShadowMap[ie]=Ni,A.directionalShadowMatrix[ie]=ft.shadow.matrix,we++}A.directional[ie]=Ut,ie++}else if(ft.isSpotLight){const Ut=a.get(ft);Ut.position.setFromMatrixPosition(ft.matrixWorld),Ut.color.copy(It).multiplyScalar(Ft*je),Ut.distance=pi,Ut.coneCos=Math.cos(ft.angle),Ut.penumbraCos=Math.cos(ft.angle*(1-ft.penumbra)),Ut.decay=ft.decay,A.spot[ne]=Ut;const yi=ft.shadow;if(ft.map&&(A.spotLightMap[qe]=ft.map,qe++,yi.updateMatrices(ft),ft.castShadow&&Ze++),A.spotLightMatrix[ne]=yi.matrix,ft.castShadow){const Pi=d.get(ft);Pi.shadowBias=yi.bias,Pi.shadowNormalBias=yi.normalBias,Pi.shadowRadius=yi.radius,Pi.shadowMapSize=yi.mapSize,A.spotShadow[ne]=Pi,A.spotShadowMap[ne]=Ni,st++}ne++}else if(ft.isRectAreaLight){const Ut=a.get(ft);Ut.color.copy(It).multiplyScalar(Ft),Ut.halfWidth.set(ft.width*.5,0,0),Ut.halfHeight.set(0,ft.height*.5,0),A.rectArea[ee]=Ut,ee++}else if(ft.isPointLight){const Ut=a.get(ft);if(Ut.color.copy(ft.color).multiplyScalar(ft.intensity*je),Ut.distance=ft.distance,Ut.decay=ft.decay,ft.castShadow){const yi=ft.shadow,Pi=d.get(ft);Pi.shadowBias=yi.bias,Pi.shadowNormalBias=yi.normalBias,Pi.shadowRadius=yi.radius,Pi.shadowMapSize=yi.mapSize,Pi.shadowCameraNear=yi.camera.near,Pi.shadowCameraFar=yi.camera.far,A.pointShadow[oe]=Pi,A.pointShadowMap[oe]=Ni,A.pointShadowMatrix[oe]=ft.shadow.matrix,_e++}A.point[oe]=Ut,oe++}else if(ft.isHemisphereLight){const Ut=a.get(ft);Ut.skyColor.copy(ft.color).multiplyScalar(Ft*je),Ut.groundColor.copy(ft.groundColor).multiplyScalar(Ft*je),A.hemi[Re]=Ut,Re++}}ee>0&&(S.has("OES_texture_float_linear")===!0?(A.rectAreaLTC1=Qi.LTC_FLOAT_1,A.rectAreaLTC2=Qi.LTC_FLOAT_2):(A.rectAreaLTC1=Qi.LTC_HALF_1,A.rectAreaLTC2=Qi.LTC_HALF_2)),A.ambient[0]=J,A.ambient[1]=K,A.ambient[2]=Z;const ke=A.hash;(ke.directionalLength!==ie||ke.pointLength!==oe||ke.spotLength!==ne||ke.rectAreaLength!==ee||ke.hemiLength!==Re||ke.numDirectionalShadows!==we||ke.numPointShadows!==_e||ke.numSpotShadows!==st||ke.numSpotMaps!==qe||ke.numLightProbes!==rt)&&(A.directional.length=ie,A.spot.length=ne,A.rectArea.length=ee,A.point.length=oe,A.hemi.length=Re,A.directionalShadow.length=we,A.directionalShadowMap.length=we,A.pointShadow.length=_e,A.pointShadowMap.length=_e,A.spotShadow.length=st,A.spotShadowMap.length=st,A.directionalShadowMatrix.length=we,A.pointShadowMatrix.length=_e,A.spotLightMatrix.length=st+qe-Ze,A.spotLightMap.length=qe,A.numSpotLightShadowsWithMaps=Ze,A.numLightProbes=rt,ke.directionalLength=ie,ke.pointLength=oe,ke.spotLength=ne,ke.rectAreaLength=ee,ke.hemiLength=Re,ke.numDirectionalShadows=we,ke.numPointShadows=_e,ke.numSpotShadows=st,ke.numSpotMaps=qe,ke.numLightProbes=rt,A.version=sTe++)}function O(F,H){let J=0,K=0,Z=0,ie=0,oe=0;const ne=H.matrixWorldInverse;for(let ee=0,Re=F.length;ee<Re;ee++){const we=F[ee];if(we.isDirectionalLight){const _e=A.directional[J];_e.direction.setFromMatrixPosition(we.matrixWorld),x.setFromMatrixPosition(we.target.matrixWorld),_e.direction.sub(x),_e.direction.transformDirection(ne),J++}else if(we.isSpotLight){const _e=A.spot[Z];_e.position.setFromMatrixPosition(we.matrixWorld),_e.position.applyMatrix4(ne),_e.direction.setFromMatrixPosition(we.matrixWorld),x.setFromMatrixPosition(we.target.matrixWorld),_e.direction.sub(x),_e.direction.transformDirection(ne),Z++}else if(we.isRectAreaLight){const _e=A.rectArea[ie];_e.position.setFromMatrixPosition(we.matrixWorld),_e.position.applyMatrix4(ne),M.identity(),w.copy(we.matrixWorld),w.premultiply(ne),M.extractRotation(w),_e.halfWidth.set(we.width*.5,0,0),_e.halfHeight.set(0,we.height*.5,0),_e.halfWidth.applyMatrix4(M),_e.halfHeight.applyMatrix4(M),ie++}else if(we.isPointLight){const _e=A.point[K];_e.position.setFromMatrixPosition(we.matrixWorld),_e.position.applyMatrix4(ne),K++}else if(we.isHemisphereLight){const _e=A.hemi[oe];_e.direction.setFromMatrixPosition(we.matrixWorld),_e.direction.transformDirection(ne),oe++}}}return{setup:L,setupView:O,state:A}}function v9(S){const a=new oTe(S),d=[],A=[];function x(H){F.camera=H,d.length=0,A.length=0}function w(H){d.push(H)}function M(H){A.push(H)}function L(H){a.setup(d,H)}function O(H){a.setupView(d,H)}const F={lightsArray:d,shadowsArray:A,camera:null,lights:a,transmissionRenderTarget:{}};return{init:x,state:F,setupLights:L,setupLightsView:O,pushLight:w,pushShadow:M}}function lTe(S){let a=new WeakMap;function d(x,w=0){const M=a.get(x);let L;return M===void 0?(L=new v9(S),a.set(x,[L])):w>=M.length?(L=new v9(S),M.push(L)):L=M[w],L}function A(){a=new WeakMap}return{get:d,dispose:A}}class XB extends co{constructor(a){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=tu,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(a)}copy(a){return super.copy(a),this.depthPacking=a.depthPacking,this.map=a.map,this.alphaMap=a.alphaMap,this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this}}class YB extends co{constructor(a){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(a)}copy(a){return super.copy(a),this.map=a.map,this.alphaMap=a.alphaMap,this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this}}const cTe=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,uTe=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function hTe(S,a,d){let A=new mv;const x=new ai,w=new ai,M=new Fn,L=new XB({depthPacking:iu}),O=new YB,F={},H=d.maxTextureSize,J={[C]:R,[R]:C,[B]:B},K=new Bc({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ai},radius:{value:4}},vertexShader:cTe,fragmentShader:uTe}),Z=K.clone();Z.defines.HORIZONTAL_PASS=1;const ie=new dn;ie.setAttribute("position",new ss(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const oe=new ua(ie,K),ne=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=_;let ee=this.type;this.render=function(qe,Ze,rt){if(ne.enabled===!1||ne.autoUpdate===!1&&ne.needsUpdate===!1||qe.length===0)return;const je=S.getRenderTarget(),ke=S.getActiveCubeFace(),nt=S.getActiveMipmapLevel(),gt=S.state;gt.setBlending(I),gt.buffers.color.setClear(1,1,1,1),gt.buffers.depth.setTest(!0),gt.setScissorTest(!1);const ft=ee!==E&&this.type===E,It=ee===E&&this.type!==E;for(let Ft=0,pi=qe.length;Ft<pi;Ft++){const Ni=qe[Ft],Ut=Ni.shadow;if(Ut===void 0){console.warn("THREE.WebGLShadowMap:",Ni,"has no shadow.");continue}if(Ut.autoUpdate===!1&&Ut.needsUpdate===!1)continue;x.copy(Ut.mapSize);const yi=Ut.getFrameExtents();if(x.multiply(yi),w.copy(Ut.mapSize),(x.x>H||x.y>H)&&(x.x>H&&(w.x=Math.floor(H/yi.x),x.x=w.x*yi.x,Ut.mapSize.x=w.x),x.y>H&&(w.y=Math.floor(H/yi.y),x.y=w.y*yi.y,Ut.mapSize.y=w.y)),Ut.map===null||ft===!0||It===!0){const Ur=this.type!==E?{minFilter:Dt,magFilter:Dt}:{};Ut.map!==null&&Ut.map.dispose(),Ut.map=new Jo(x.x,x.y,Ur),Ut.map.texture.name=Ni.name+".shadowMap",Ut.camera.updateProjectionMatrix()}S.setRenderTarget(Ut.map),S.clear();const Pi=Ut.getViewportCount();for(let Ur=0;Ur<Pi;Ur++){const xn=Ut.getViewport(Ur);M.set(w.x*xn.x,w.y*xn.y,w.x*xn.z,w.y*xn.w),gt.viewport(M),Ut.updateMatrices(Ni,Ur),A=Ut.getFrustum(),_e(Ze,rt,Ut.camera,Ni,this.type)}Ut.isPointLightShadow!==!0&&this.type===E&&Re(Ut,rt),Ut.needsUpdate=!1}ee=this.type,ne.needsUpdate=!1,S.setRenderTarget(je,ke,nt)};function Re(qe,Ze){const rt=a.update(oe);K.defines.VSM_SAMPLES!==qe.blurSamples&&(K.defines.VSM_SAMPLES=qe.blurSamples,Z.defines.VSM_SAMPLES=qe.blurSamples,K.needsUpdate=!0,Z.needsUpdate=!0),qe.mapPass===null&&(qe.mapPass=new Jo(x.x,x.y)),K.uniforms.shadow_pass.value=qe.map.texture,K.uniforms.resolution.value=qe.mapSize,K.uniforms.radius.value=qe.radius,S.setRenderTarget(qe.mapPass),S.clear(),S.renderBufferDirect(Ze,null,rt,K,oe,null),Z.uniforms.shadow_pass.value=qe.mapPass.texture,Z.uniforms.resolution.value=qe.mapSize,Z.uniforms.radius.value=qe.radius,S.setRenderTarget(qe.map),S.clear(),S.renderBufferDirect(Ze,null,rt,Z,oe,null)}function we(qe,Ze,rt,je){let ke=null;const nt=rt.isPointLight===!0?qe.customDistanceMaterial:qe.customDepthMaterial;if(nt!==void 0)ke=nt;else if(ke=rt.isPointLight===!0?O:L,S.localClippingEnabled&&Ze.clipShadows===!0&&Array.isArray(Ze.clippingPlanes)&&Ze.clippingPlanes.length!==0||Ze.displacementMap&&Ze.displacementScale!==0||Ze.alphaMap&&Ze.alphaTest>0||Ze.map&&Ze.alphaTest>0){const gt=ke.uuid,ft=Ze.uuid;let It=F[gt];It===void 0&&(It={},F[gt]=It);let Ft=It[ft];Ft===void 0&&(Ft=ke.clone(),It[ft]=Ft,Ze.addEventListener("dispose",st)),ke=Ft}if(ke.visible=Ze.visible,ke.wireframe=Ze.wireframe,je===E?ke.side=Ze.shadowSide!==null?Ze.shadowSide:Ze.side:ke.side=Ze.shadowSide!==null?Ze.shadowSide:J[Ze.side],ke.alphaMap=Ze.alphaMap,ke.alphaTest=Ze.alphaTest,ke.map=Ze.map,ke.clipShadows=Ze.clipShadows,ke.clippingPlanes=Ze.clippingPlanes,ke.clipIntersection=Ze.clipIntersection,ke.displacementMap=Ze.displacementMap,ke.displacementScale=Ze.displacementScale,ke.displacementBias=Ze.displacementBias,ke.wireframeLinewidth=Ze.wireframeLinewidth,ke.linewidth=Ze.linewidth,rt.isPointLight===!0&&ke.isMeshDistanceMaterial===!0){const gt=S.properties.get(ke);gt.light=rt}return ke}function _e(qe,Ze,rt,je,ke){if(qe.visible===!1)return;if(qe.layers.test(Ze.layers)&&(qe.isMesh||qe.isLine||qe.isPoints)&&(qe.castShadow||qe.receiveShadow&&ke===E)&&(!qe.frustumCulled||A.intersectsObject(qe))){qe.modelViewMatrix.multiplyMatrices(rt.matrixWorldInverse,qe.matrixWorld);const gt=a.update(qe),ft=qe.material;if(Array.isArray(ft)){const It=gt.groups;for(let Ft=0,pi=It.length;Ft<pi;Ft++){const Ni=It[Ft],Ut=ft[Ni.materialIndex];if(Ut&&Ut.visible){const yi=we(qe,Ut,je,ke);qe.onBeforeShadow(S,qe,Ze,rt,gt,yi,Ni),S.renderBufferDirect(rt,null,gt,yi,qe,Ni),qe.onAfterShadow(S,qe,Ze,rt,gt,yi,Ni)}}}else if(ft.visible){const It=we(qe,ft,je,ke);qe.onBeforeShadow(S,qe,Ze,rt,gt,It,null),S.renderBufferDirect(rt,null,gt,It,qe,null),qe.onAfterShadow(S,qe,Ze,rt,gt,It,null)}}const nt=qe.children;for(let gt=0,ft=nt.length;gt<ft;gt++)_e(nt[gt],Ze,rt,je,ke)}function st(qe){qe.target.removeEventListener("dispose",st);for(const Ze in F){const rt=F[Ze],je=qe.target.uuid;je in rt&&(rt[je].dispose(),delete rt[je])}}}function dTe(S){function a(){let ut=!1;const vi=new Fn;let Ri=null;const Mr=new Fn(0,0,0,0);return{setMask:function(rr){Ri!==rr&&!ut&&(S.colorMask(rr,rr,rr,rr),Ri=rr)},setLocked:function(rr){ut=rr},setClear:function(rr,on,nr,Ji,yn){yn===!0&&(rr*=Ji,on*=Ji,nr*=Ji),vi.set(rr,on,nr,Ji),Mr.equals(vi)===!1&&(S.clearColor(rr,on,nr,Ji),Mr.copy(vi))},reset:function(){ut=!1,Ri=null,Mr.set(-1,0,0,0)}}}function d(){let ut=!1,vi=null,Ri=null,Mr=null;return{setTest:function(rr){rr?Bn(S.DEPTH_TEST):Cr(S.DEPTH_TEST)},setMask:function(rr){vi!==rr&&!ut&&(S.depthMask(rr),vi=rr)},setFunc:function(rr){if(Ri!==rr){switch(rr){case bi:S.depthFunc(S.NEVER);break;case $e:S.depthFunc(S.ALWAYS);break;case Fi:S.depthFunc(S.LESS);break;case ui:S.depthFunc(S.LEQUAL);break;case Si:S.depthFunc(S.EQUAL);break;case Ei:S.depthFunc(S.GEQUAL);break;case Zi:S.depthFunc(S.GREATER);break;case Vi:S.depthFunc(S.NOTEQUAL);break;default:S.depthFunc(S.LEQUAL)}Ri=rr}},setLocked:function(rr){ut=rr},setClear:function(rr){Mr!==rr&&(S.clearDepth(rr),Mr=rr)},reset:function(){ut=!1,vi=null,Ri=null,Mr=null}}}function A(){let ut=!1,vi=null,Ri=null,Mr=null,rr=null,on=null,nr=null,Ji=null,yn=null;return{setTest:function(Ir){ut||(Ir?Bn(S.STENCIL_TEST):Cr(S.STENCIL_TEST))},setMask:function(Ir){vi!==Ir&&!ut&&(S.stencilMask(Ir),vi=Ir)},setFunc:function(Ir,Ql,lu){(Ri!==Ir||Mr!==Ql||rr!==lu)&&(S.stencilFunc(Ir,Ql,lu),Ri=Ir,Mr=Ql,rr=lu)},setOp:function(Ir,Ql,lu){(on!==Ir||nr!==Ql||Ji!==lu)&&(S.stencilOp(Ir,Ql,lu),on=Ir,nr=Ql,Ji=lu)},setLocked:function(Ir){ut=Ir},setClear:function(Ir){yn!==Ir&&(S.clearStencil(Ir),yn=Ir)},reset:function(){ut=!1,vi=null,Ri=null,Mr=null,rr=null,on=null,nr=null,Ji=null,yn=null}}}const x=new a,w=new d,M=new A,L=new WeakMap,O=new WeakMap;let F={},H={},J=new WeakMap,K=[],Z=null,ie=!1,oe=null,ne=null,ee=null,Re=null,we=null,_e=null,st=null,qe=new or(0,0,0),Ze=0,rt=!1,je=null,ke=null,nt=null,gt=null,ft=null;const It=S.getParameter(S.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let Ft=!1,pi=0;const Ni=S.getParameter(S.VERSION);Ni.indexOf("WebGL")!==-1?(pi=parseFloat(/^WebGL (\d)/.exec(Ni)[1]),Ft=pi>=1):Ni.indexOf("OpenGL ES")!==-1&&(pi=parseFloat(/^OpenGL ES (\d)/.exec(Ni)[1]),Ft=pi>=2);let Ut=null,yi={};const Pi=S.getParameter(S.SCISSOR_BOX),Ur=S.getParameter(S.VIEWPORT),xn=new Fn().fromArray(Pi),ts=new Fn().fromArray(Ur);function ds(ut,vi,Ri,Mr){const rr=new Uint8Array(4),on=S.createTexture();S.bindTexture(ut,on),S.texParameteri(ut,S.TEXTURE_MIN_FILTER,S.NEAREST),S.texParameteri(ut,S.TEXTURE_MAG_FILTER,S.NEAREST);for(let nr=0;nr<Ri;nr++)ut===S.TEXTURE_3D||ut===S.TEXTURE_2D_ARRAY?S.texImage3D(vi,0,S.RGBA,1,1,Mr,0,S.RGBA,S.UNSIGNED_BYTE,rr):S.texImage2D(vi+nr,0,S.RGBA,1,1,0,S.RGBA,S.UNSIGNED_BYTE,rr);return on}const zn={};zn[S.TEXTURE_2D]=ds(S.TEXTURE_2D,S.TEXTURE_2D,1),zn[S.TEXTURE_CUBE_MAP]=ds(S.TEXTURE_CUBE_MAP,S.TEXTURE_CUBE_MAP_POSITIVE_X,6),zn[S.TEXTURE_2D_ARRAY]=ds(S.TEXTURE_2D_ARRAY,S.TEXTURE_2D_ARRAY,1,1),zn[S.TEXTURE_3D]=ds(S.TEXTURE_3D,S.TEXTURE_3D,1,1),x.setClear(0,0,0,1),w.setClear(1),M.setClear(0),Bn(S.DEPTH_TEST),w.setFunc(ui),li(!1),ir(m),Bn(S.CULL_FACE),ti(I);function Bn(ut){F[ut]!==!0&&(S.enable(ut),F[ut]=!0)}function Cr(ut){F[ut]!==!1&&(S.disable(ut),F[ut]=!1)}function hi(ut,vi){return H[ut]!==vi?(S.bindFramebuffer(ut,vi),H[ut]=vi,ut===S.DRAW_FRAMEBUFFER&&(H[S.FRAMEBUFFER]=vi),ut===S.FRAMEBUFFER&&(H[S.DRAW_FRAMEBUFFER]=vi),!0):!1}function Ci(ut,vi){let Ri=K,Mr=!1;if(ut){Ri=J.get(vi),Ri===void 0&&(Ri=[],J.set(vi,Ri));const rr=ut.textures;if(Ri.length!==rr.length||Ri[0]!==S.COLOR_ATTACHMENT0){for(let on=0,nr=rr.length;on<nr;on++)Ri[on]=S.COLOR_ATTACHMENT0+on;Ri.length=rr.length,Mr=!0}}else Ri[0]!==S.BACK&&(Ri[0]=S.BACK,Mr=!0);Mr&&S.drawBuffers(Ri)}function qi(ut){return Z!==ut?(S.useProgram(ut),Z=ut,!0):!1}const tt={[V]:S.FUNC_ADD,[j]:S.FUNC_SUBTRACT,[Q]:S.FUNC_REVERSE_SUBTRACT};tt[W]=S.MIN,tt[G]=S.MAX;const mi={[z]:S.ZERO,[te]:S.ONE,[Y]:S.SRC_COLOR,[ve]:S.SRC_ALPHA,[it]:S.SRC_ALPHA_SATURATE,[Xe]:S.DST_COLOR,[me]:S.DST_ALPHA,[se]:S.ONE_MINUS_SRC_COLOR,[Ae]:S.ONE_MINUS_SRC_ALPHA,[Je]:S.ONE_MINUS_DST_COLOR,[Oe]:S.ONE_MINUS_DST_ALPHA,[dt]:S.CONSTANT_COLOR,[St]:S.ONE_MINUS_CONSTANT_COLOR,[Qt]:S.CONSTANT_ALPHA,[yt]:S.ONE_MINUS_CONSTANT_ALPHA};function ti(ut,vi,Ri,Mr,rr,on,nr,Ji,yn,Ir){if(ut===I){ie===!0&&(Cr(S.BLEND),ie=!1);return}if(ie===!1&&(Bn(S.BLEND),ie=!0),ut!==q){if(ut!==oe||Ir!==rt){if((ne!==V||we!==V)&&(S.blendEquation(S.FUNC_ADD),ne=V,we=V),Ir)switch(ut){case N:S.blendFuncSeparate(S.ONE,S.ONE_MINUS_SRC_ALPHA,S.ONE,S.ONE_MINUS_SRC_ALPHA);break;case D:S.blendFunc(S.ONE,S.ONE);break;case P:S.blendFuncSeparate(S.ZERO,S.ONE_MINUS_SRC_COLOR,S.ZERO,S.ONE);break;case k:S.blendFuncSeparate(S.ZERO,S.SRC_COLOR,S.ZERO,S.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",ut);break}else switch(ut){case N:S.blendFuncSeparate(S.SRC_ALPHA,S.ONE_MINUS_SRC_ALPHA,S.ONE,S.ONE_MINUS_SRC_ALPHA);break;case D:S.blendFunc(S.SRC_ALPHA,S.ONE);break;case P:S.blendFuncSeparate(S.ZERO,S.ONE_MINUS_SRC_COLOR,S.ZERO,S.ONE);break;case k:S.blendFunc(S.ZERO,S.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",ut);break}ee=null,Re=null,_e=null,st=null,qe.set(0,0,0),Ze=0,oe=ut,rt=Ir}return}rr=rr||vi,on=on||Ri,nr=nr||Mr,(vi!==ne||rr!==we)&&(S.blendEquationSeparate(tt[vi],tt[rr]),ne=vi,we=rr),(Ri!==ee||Mr!==Re||on!==_e||nr!==st)&&(S.blendFuncSeparate(mi[Ri],mi[Mr],mi[on],mi[nr]),ee=Ri,Re=Mr,_e=on,st=nr),(Ji.equals(qe)===!1||yn!==Ze)&&(S.blendColor(Ji.r,Ji.g,Ji.b,yn),qe.copy(Ji),Ze=yn),oe=ut,rt=!1}function er(ut,vi){ut.side===B?Cr(S.CULL_FACE):Bn(S.CULL_FACE);let Ri=ut.side===R;vi&&(Ri=!Ri),li(Ri),ut.blending===N&&ut.transparent===!1?ti(I):ti(ut.blending,ut.blendEquation,ut.blendSrc,ut.blendDst,ut.blendEquationAlpha,ut.blendSrcAlpha,ut.blendDstAlpha,ut.blendColor,ut.blendAlpha,ut.premultipliedAlpha),w.setFunc(ut.depthFunc),w.setTest(ut.depthTest),w.setMask(ut.depthWrite),x.setMask(ut.colorWrite);const Mr=ut.stencilWrite;M.setTest(Mr),Mr&&(M.setMask(ut.stencilWriteMask),M.setFunc(ut.stencilFunc,ut.stencilRef,ut.stencilFuncMask),M.setOp(ut.stencilFail,ut.stencilZFail,ut.stencilZPass)),Ar(ut.polygonOffset,ut.polygonOffsetFactor,ut.polygonOffsetUnits),ut.alphaToCoverage===!0?Bn(S.SAMPLE_ALPHA_TO_COVERAGE):Cr(S.SAMPLE_ALPHA_TO_COVERAGE)}function li(ut){je!==ut&&(ut?S.frontFace(S.CW):S.frontFace(S.CCW),je=ut)}function ir(ut){ut!==g?(Bn(S.CULL_FACE),ut!==ke&&(ut===m?S.cullFace(S.BACK):ut===y?S.cullFace(S.FRONT):S.cullFace(S.FRONT_AND_BACK))):Cr(S.CULL_FACE),ke=ut}function tr(ut){ut!==nt&&(Ft&&S.lineWidth(ut),nt=ut)}function Ar(ut,vi,Ri){ut?(Bn(S.POLYGON_OFFSET_FILL),(gt!==vi||ft!==Ri)&&(S.polygonOffset(vi,Ri),gt=vi,ft=Ri)):Cr(S.POLYGON_OFFSET_FILL)}function An(ut){ut?Bn(S.SCISSOR_TEST):Cr(S.SCISSOR_TEST)}function Wr(ut){ut===void 0&&(ut=S.TEXTURE0+It-1),Ut!==ut&&(S.activeTexture(ut),Ut=ut)}function ha(ut,vi,Ri){Ri===void 0&&(Ut===null?Ri=S.TEXTURE0+It-1:Ri=Ut);let Mr=yi[Ri];Mr===void 0&&(Mr={type:void 0,texture:void 0},yi[Ri]=Mr),(Mr.type!==ut||Mr.texture!==vi)&&(Ut!==Ri&&(S.activeTexture(Ri),Ut=Ri),S.bindTexture(ut,vi||zn[ut]),Mr.type=ut,Mr.texture=vi)}function Ys(){const ut=yi[Ut];ut!==void 0&&ut.type!==void 0&&(S.bindTexture(ut.type,null),ut.type=void 0,ut.texture=void 0)}function Hn(){try{S.compressedTexImage2D.apply(S,arguments)}catch(ut){console.error("THREE.WebGLState:",ut)}}function et(){try{S.compressedTexImage3D.apply(S,arguments)}catch(ut){console.error("THREE.WebGLState:",ut)}}function Pe(){try{S.texSubImage2D.apply(S,arguments)}catch(ut){console.error("THREE.WebGLState:",ut)}}function zt(){try{S.texSubImage3D.apply(S,arguments)}catch(ut){console.error("THREE.WebGLState:",ut)}}function di(){try{S.compressedTexSubImage2D.apply(S,arguments)}catch(ut){console.error("THREE.WebGLState:",ut)}}function gi(){try{S.compressedTexSubImage3D.apply(S,arguments)}catch(ut){console.error("THREE.WebGLState:",ut)}}function oi(){try{S.texStorage2D.apply(S,arguments)}catch(ut){console.error("THREE.WebGLState:",ut)}}function Rr(){try{S.texStorage3D.apply(S,arguments)}catch(ut){console.error("THREE.WebGLState:",ut)}}function zi(){try{S.texImage2D.apply(S,arguments)}catch(ut){console.error("THREE.WebGLState:",ut)}}function cr(){try{S.texImage3D.apply(S,arguments)}catch(ut){console.error("THREE.WebGLState:",ut)}}function Wn(ut){xn.equals(ut)===!1&&(S.scissor(ut.x,ut.y,ut.z,ut.w),xn.copy(ut))}function lr(ut){ts.equals(ut)===!1&&(S.viewport(ut.x,ut.y,ut.z,ut.w),ts.copy(ut))}function _r(ut,vi){let Ri=O.get(vi);Ri===void 0&&(Ri=new WeakMap,O.set(vi,Ri));let Mr=Ri.get(ut);Mr===void 0&&(Mr=S.getUniformBlockIndex(vi,ut.name),Ri.set(ut,Mr))}function _n(ut,vi){const Ri=O.get(vi).get(ut);L.get(vi)!==Ri&&(S.uniformBlockBinding(vi,Ri,ut.__bindingPointIndex),L.set(vi,Ri))}function zr(){S.disable(S.BLEND),S.disable(S.CULL_FACE),S.disable(S.DEPTH_TEST),S.disable(S.POLYGON_OFFSET_FILL),S.disable(S.SCISSOR_TEST),S.disable(S.STENCIL_TEST),S.disable(S.SAMPLE_ALPHA_TO_COVERAGE),S.blendEquation(S.FUNC_ADD),S.blendFunc(S.ONE,S.ZERO),S.blendFuncSeparate(S.ONE,S.ZERO,S.ONE,S.ZERO),S.blendColor(0,0,0,0),S.colorMask(!0,!0,!0,!0),S.clearColor(0,0,0,0),S.depthMask(!0),S.depthFunc(S.LESS),S.clearDepth(1),S.stencilMask(4294967295),S.stencilFunc(S.ALWAYS,0,4294967295),S.stencilOp(S.KEEP,S.KEEP,S.KEEP),S.clearStencil(0),S.cullFace(S.BACK),S.frontFace(S.CCW),S.polygonOffset(0,0),S.activeTexture(S.TEXTURE0),S.bindFramebuffer(S.FRAMEBUFFER,null),S.bindFramebuffer(S.DRAW_FRAMEBUFFER,null),S.bindFramebuffer(S.READ_FRAMEBUFFER,null),S.useProgram(null),S.lineWidth(1),S.scissor(0,0,S.canvas.width,S.canvas.height),S.viewport(0,0,S.canvas.width,S.canvas.height),F={},Ut=null,yi={},H={},J=new WeakMap,K=[],Z=null,ie=!1,oe=null,ne=null,ee=null,Re=null,we=null,_e=null,st=null,qe=new or(0,0,0),Ze=0,rt=!1,je=null,ke=null,nt=null,gt=null,ft=null,xn.set(0,0,S.canvas.width,S.canvas.height),ts.set(0,0,S.canvas.width,S.canvas.height),x.reset(),w.reset(),M.reset()}return{buffers:{color:x,depth:w,stencil:M},enable:Bn,disable:Cr,bindFramebuffer:hi,drawBuffers:Ci,useProgram:qi,setBlending:ti,setMaterial:er,setFlipSided:li,setCullFace:ir,setLineWidth:tr,setPolygonOffset:Ar,setScissorTest:An,activeTexture:Wr,bindTexture:ha,unbindTexture:Ys,compressedTexImage2D:Hn,compressedTexImage3D:et,texImage2D:zi,texImage3D:cr,updateUBOMapping:_r,uniformBlockBinding:_n,texStorage2D:oi,texStorage3D:Rr,texSubImage2D:Pe,texSubImage3D:zt,compressedTexSubImage2D:di,compressedTexSubImage3D:gi,scissor:Wn,viewport:lr,reset:zr}}function pTe(S,a,d,A,x,w,M){const L=a.has("WEBGL_multisampled_render_to_texture")?a.get("WEBGL_multisampled_render_to_texture"):null,O=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),F=a.has("OCULUS_multiview")?a.get("OCULUS_multiview"):null,H=new ai,J=new WeakMap;let K;const Z=new WeakMap;let ie=[],oe=!1,ne=!1;try{ne=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function ee(et,Pe){return ne?new OffscreenCanvas(et,Pe):hf("canvas")}function Re(et,Pe,zt){let di=1;const gi=Hn(et);if((gi.width>zt||gi.height>zt)&&(di=zt/Math.max(gi.width,gi.height)),di<1)if(typeof HTMLImageElement<"u"&&et instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&et instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&et instanceof ImageBitmap||typeof VideoFrame<"u"&&et instanceof VideoFrame){const oi=Math.floor(di*gi.width),Rr=Math.floor(di*gi.height);K===void 0&&(K=ee(oi,Rr));const zi=Pe?ee(oi,Rr):K;return zi.width=oi,zi.height=Rr,zi.getContext("2d").drawImage(et,0,0,oi,Rr),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+gi.width+"x"+gi.height+") to ("+oi+"x"+Rr+")."),zi}else return"data"in et&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+gi.width+"x"+gi.height+")."),et;return et}function we(et){return et.generateMipmaps&&et.minFilter!==Dt&&et.minFilter!==ki}function _e(et){S.generateMipmap(et)}function st(et,Pe,zt,di,gi=!1){if(et!==null){if(S[et]!==void 0)return S[et];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+et+"'")}let oi=Pe;if(Pe===S.RED&&(zt===S.FLOAT&&(oi=S.R32F),zt===S.HALF_FLOAT&&(oi=S.R16F),zt===S.UNSIGNED_BYTE&&(oi=S.R8)),Pe===S.RED_INTEGER&&(zt===S.UNSIGNED_BYTE&&(oi=S.R8UI),zt===S.UNSIGNED_SHORT&&(oi=S.R16UI),zt===S.UNSIGNED_INT&&(oi=S.R32UI),zt===S.BYTE&&(oi=S.R8I),zt===S.SHORT&&(oi=S.R16I),zt===S.INT&&(oi=S.R32I)),Pe===S.RG&&(zt===S.FLOAT&&(oi=S.RG32F),zt===S.HALF_FLOAT&&(oi=S.RG16F),zt===S.UNSIGNED_BYTE&&(oi=S.RG8)),Pe===S.RG_INTEGER&&(zt===S.UNSIGNED_BYTE&&(oi=S.RG8UI),zt===S.UNSIGNED_SHORT&&(oi=S.RG16UI),zt===S.UNSIGNED_INT&&(oi=S.RG32UI),zt===S.BYTE&&(oi=S.RG8I),zt===S.SHORT&&(oi=S.RG16I),zt===S.INT&&(oi=S.RG32I)),Pe===S.RGB&&zt===S.UNSIGNED_INT_5_9_9_9_REV&&(oi=S.RGB9_E5),Pe===S.RGBA){const Rr=gi?sf:Yn.getTransfer(di);zt===S.FLOAT&&(oi=S.RGBA32F),zt===S.HALF_FLOAT&&(oi=S.RGBA16F),zt===S.UNSIGNED_BYTE&&(oi=Rr===ls?S.SRGB8_ALPHA8:S.RGBA8),zt===S.UNSIGNED_SHORT_4_4_4_4&&(oi=S.RGBA4),zt===S.UNSIGNED_SHORT_5_5_5_1&&(oi=S.RGB5_A1)}return(oi===S.R16F||oi===S.R32F||oi===S.RG16F||oi===S.RG32F||oi===S.RGBA16F||oi===S.RGBA32F)&&a.get("EXT_color_buffer_float"),oi}function qe(et,Pe){return we(et)===!0||et.isFramebufferTexture&&et.minFilter!==Dt&&et.minFilter!==ki?Math.log2(Math.max(Pe.width,Pe.height))+1:et.mipmaps!==void 0&&et.mipmaps.length>0?et.mipmaps.length:et.isCompressedTexture&&Array.isArray(et.image)?Pe.mipmaps.length:1}function Ze(et){const Pe=et.target;Pe.removeEventListener("dispose",Ze),je(Pe),Pe.isVideoTexture&&J.delete(Pe)}function rt(et){const Pe=et.target;Pe.removeEventListener("dispose",rt),nt(Pe)}function je(et){const Pe=A.get(et);if(Pe.__webglInit===void 0)return;const zt=et.source,di=Z.get(zt);if(di){const gi=di[Pe.__cacheKey];gi.usedTimes--,gi.usedTimes===0&&ke(et),Object.keys(di).length===0&&Z.delete(zt)}A.remove(et)}function ke(et){const Pe=A.get(et);S.deleteTexture(Pe.__webglTexture);const zt=et.source,di=Z.get(zt);delete di[Pe.__cacheKey],M.memory.textures--}function nt(et){const Pe=A.get(et);if(et.depthTexture&&et.depthTexture.dispose(),et.isWebGLCubeRenderTarget)for(let di=0;di<6;di++){if(Array.isArray(Pe.__webglFramebuffer[di]))for(let gi=0;gi<Pe.__webglFramebuffer[di].length;gi++)S.deleteFramebuffer(Pe.__webglFramebuffer[di][gi]);else S.deleteFramebuffer(Pe.__webglFramebuffer[di]);Pe.__webglDepthbuffer&&S.deleteRenderbuffer(Pe.__webglDepthbuffer[di])}else{if(Array.isArray(Pe.__webglFramebuffer))for(let di=0;di<Pe.__webglFramebuffer.length;di++)S.deleteFramebuffer(Pe.__webglFramebuffer[di]);else S.deleteFramebuffer(Pe.__webglFramebuffer);if(Pe.__webglDepthbuffer&&S.deleteRenderbuffer(Pe.__webglDepthbuffer),Pe.__webglMultisampledFramebuffer&&S.deleteFramebuffer(Pe.__webglMultisampledFramebuffer),Pe.__webglColorRenderbuffer)for(let di=0;di<Pe.__webglColorRenderbuffer.length;di++)Pe.__webglColorRenderbuffer[di]&&S.deleteRenderbuffer(Pe.__webglColorRenderbuffer[di]);Pe.__webglDepthRenderbuffer&&S.deleteRenderbuffer(Pe.__webglDepthRenderbuffer)}const zt=et.textures;for(let di=0,gi=zt.length;di<gi;di++){const oi=A.get(zt[di]);oi.__webglTexture&&(S.deleteTexture(oi.__webglTexture),M.memory.textures--),A.remove(zt[di])}A.remove(et)}let gt=0;function ft(){gt=0}function It(){const et=gt;return et>=x.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+et+" texture units while this GPU supports only "+x.maxTextures),gt+=1,et}function Ft(et){const Pe=[];return Pe.push(et.wrapS),Pe.push(et.wrapT),Pe.push(et.wrapR||0),Pe.push(et.magFilter),Pe.push(et.minFilter),Pe.push(et.anisotropy),Pe.push(et.internalFormat),Pe.push(et.format),Pe.push(et.type),Pe.push(et.generateMipmaps),Pe.push(et.premultiplyAlpha),Pe.push(et.flipY),Pe.push(et.unpackAlignment),Pe.push(et.colorSpace),Pe.join()}function pi(et,Pe){const zt=A.get(et);if(et.isVideoTexture&&ha(et),et.isRenderTargetTexture===!1&&et.version>0&&zt.__version!==et.version){const di=et.image;if(di===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(di.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else if(Cr(zt,et,Pe))return}d.bindTexture(S.TEXTURE_2D,zt.__webglTexture,S.TEXTURE0+Pe)}function Ni(et,Pe){const zt=A.get(et);if(et.version>0&&zt.__version!==et.version){Cr(zt,et,Pe);return}d.bindTexture(S.TEXTURE_2D_ARRAY,zt.__webglTexture,S.TEXTURE0+Pe)}function Ut(et,Pe){const zt=A.get(et);if(et.version>0&&zt.__version!==et.version){Cr(zt,et,Pe);return}d.bindTexture(S.TEXTURE_3D,zt.__webglTexture,S.TEXTURE0+Pe)}function yi(et,Pe){const zt=A.get(et);if(et.version>0&&zt.__version!==et.version){hi(zt,et,Pe);return}d.bindTexture(S.TEXTURE_CUBE_MAP,zt.__webglTexture,S.TEXTURE0+Pe)}const Pi={[ze]:S.REPEAT,[Ve]:S.CLAMP_TO_EDGE,[pt]:S.MIRRORED_REPEAT},Ur={[Dt]:S.NEAREST,[xt]:S.NEAREST_MIPMAP_NEAREST,[fi]:S.NEAREST_MIPMAP_LINEAR,[ki]:S.LINEAR,[mn]:S.LINEAR_MIPMAP_NEAREST,[rn]:S.LINEAR_MIPMAP_LINEAR},xn={[sE]:S.NEVER,[hE]:S.ALWAYS,[aE]:S.LESS,[nv]:S.LEQUAL,[oE]:S.EQUAL,[uE]:S.GEQUAL,[lE]:S.GREATER,[cE]:S.NOTEQUAL};function ts(et,Pe){if(Pe.type===Rt&&a.has("OES_texture_float_linear")===!1&&(Pe.magFilter===ki||Pe.magFilter===mn||Pe.magFilter===fi||Pe.magFilter===rn||Pe.minFilter===ki||Pe.minFilter===mn||Pe.minFilter===fi||Pe.minFilter===rn)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),S.texParameteri(et,S.TEXTURE_WRAP_S,Pi[Pe.wrapS]),S.texParameteri(et,S.TEXTURE_WRAP_T,Pi[Pe.wrapT]),(et===S.TEXTURE_3D||et===S.TEXTURE_2D_ARRAY)&&S.texParameteri(et,S.TEXTURE_WRAP_R,Pi[Pe.wrapR]),S.texParameteri(et,S.TEXTURE_MAG_FILTER,Ur[Pe.magFilter]),S.texParameteri(et,S.TEXTURE_MIN_FILTER,Ur[Pe.minFilter]),Pe.compareFunction&&(S.texParameteri(et,S.TEXTURE_COMPARE_MODE,S.COMPARE_REF_TO_TEXTURE),S.texParameteri(et,S.TEXTURE_COMPARE_FUNC,xn[Pe.compareFunction])),a.has("EXT_texture_filter_anisotropic")===!0){if(Pe.magFilter===Dt||Pe.minFilter!==fi&&Pe.minFilter!==rn||Pe.type===Rt&&a.has("OES_texture_float_linear")===!1)return;if(Pe.anisotropy>1||A.get(Pe).__currentAnisotropy){const zt=a.get("EXT_texture_filter_anisotropic");S.texParameterf(et,zt.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Pe.anisotropy,x.getMaxAnisotropy())),A.get(Pe).__currentAnisotropy=Pe.anisotropy}}}function ds(et,Pe){let zt=!1;et.__webglInit===void 0&&(et.__webglInit=!0,Pe.addEventListener("dispose",Ze));const di=Pe.source;let gi=Z.get(di);gi===void 0&&(gi={},Z.set(di,gi));const oi=Ft(Pe);if(oi!==et.__cacheKey){gi[oi]===void 0&&(gi[oi]={texture:S.createTexture(),usedTimes:0},M.memory.textures++,zt=!0),gi[oi].usedTimes++;const Rr=gi[et.__cacheKey];Rr!==void 0&&(gi[et.__cacheKey].usedTimes--,Rr.usedTimes===0&&ke(Pe)),et.__cacheKey=oi,et.__webglTexture=gi[oi].texture}return zt}function zn(et){oe=et}function Bn(){const et=oe;oe=!1;for(const Pe of ie)Cr(Pe.textureProperties,Pe.texture,Pe.slot),Pe.texture.isPendingDeferredUpload=!1;ie=[],oe=et}function Cr(et,Pe,zt){if(oe)return Pe.isPendingDeferredUpload||(Pe.isPendingDeferredUpload=!0,ie.push({textureProperties:et,texture:Pe,slot:zt})),!1;let di=S.TEXTURE_2D;(Pe.isDataArrayTexture||Pe.isCompressedArrayTexture)&&(di=S.TEXTURE_2D_ARRAY),Pe.isData3DTexture&&(di=S.TEXTURE_3D);const gi=ds(et,Pe),oi=Pe.source;d.bindTexture(di,et.__webglTexture,S.TEXTURE0+zt);const Rr=A.get(oi);if(oi.version!==Rr.__version||gi===!0){d.activeTexture(S.TEXTURE0+zt);const zi=Yn.getPrimaries(Yn.workingColorSpace),cr=Pe.colorSpace===Wa?null:Yn.getPrimaries(Pe.colorSpace),Wn=Pe.colorSpace===Wa||zi===cr?S.NONE:S.BROWSER_DEFAULT_WEBGL;S.pixelStorei(S.UNPACK_FLIP_Y_WEBGL,Pe.flipY),S.pixelStorei(S.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Pe.premultiplyAlpha),S.pixelStorei(S.UNPACK_ALIGNMENT,Pe.unpackAlignment),S.pixelStorei(S.UNPACK_COLORSPACE_CONVERSION_WEBGL,Wn);let lr=Re(Pe.image,!1,x.maxTextureSize);lr=Ys(Pe,lr);const _r=w.convert(Pe.format,Pe.colorSpace),_n=w.convert(Pe.type);let zr=st(Pe.internalFormat,_r,_n,Pe.colorSpace,Pe.isVideoTexture);ts(di,Pe);let ut;const vi=Pe.mipmaps,Ri=Pe.isVideoTexture!==!0,Mr=Rr.__version===void 0||gi===!0,rr=oi.dataReady,on=qe(Pe,lr);if(Pe.isDepthTexture)zr=S.DEPTH_COMPONENT16,Pe.type===Rt?zr=S.DEPTH_COMPONENT32F:Pe.type===ct?zr=S.DEPTH_COMPONENT24:Pe.type===Di&&(zr=S.DEPTH24_STENCIL8),Mr&&(Ri?d.texStorage2D(S.TEXTURE_2D,1,zr,lr.width,lr.height):d.texImage2D(S.TEXTURE_2D,0,zr,lr.width,lr.height,0,_r,_n,null));else if(Pe.isDataTexture)if(vi.length>0){Ri&&Mr&&d.texStorage2D(S.TEXTURE_2D,on,zr,vi[0].width,vi[0].height);for(let nr=0,Ji=vi.length;nr<Ji;nr++)ut=vi[nr],Ri?rr&&d.texSubImage2D(S.TEXTURE_2D,nr,0,0,ut.width,ut.height,_r,_n,ut.data):d.texImage2D(S.TEXTURE_2D,nr,zr,ut.width,ut.height,0,_r,_n,ut.data);Pe.generateMipmaps=!1}else Ri?(Mr&&d.texStorage2D(S.TEXTURE_2D,on,zr,lr.width,lr.height),rr&&d.texSubImage2D(S.TEXTURE_2D,0,0,0,lr.width,lr.height,_r,_n,lr.data)):d.texImage2D(S.TEXTURE_2D,0,zr,lr.width,lr.height,0,_r,_n,lr.data);else if(Pe.isCompressedTexture)if(Pe.isCompressedArrayTexture){Ri&&Mr&&d.texStorage3D(S.TEXTURE_2D_ARRAY,on,zr,vi[0].width,vi[0].height,lr.depth);for(let nr=0,Ji=vi.length;nr<Ji;nr++)ut=vi[nr],Pe.format!==fe?_r!==null?Ri?rr&&d.compressedTexSubImage3D(S.TEXTURE_2D_ARRAY,nr,0,0,0,ut.width,ut.height,lr.depth,_r,ut.data,0,0):d.compressedTexImage3D(S.TEXTURE_2D_ARRAY,nr,zr,ut.width,ut.height,lr.depth,0,ut.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ri?rr&&d.texSubImage3D(S.TEXTURE_2D_ARRAY,nr,0,0,0,ut.width,ut.height,lr.depth,_r,_n,ut.data):d.texImage3D(S.TEXTURE_2D_ARRAY,nr,zr,ut.width,ut.height,lr.depth,0,_r,_n,ut.data)}else{Ri&&Mr&&d.texStorage2D(S.TEXTURE_2D,on,zr,vi[0].width,vi[0].height);for(let nr=0,Ji=vi.length;nr<Ji;nr++)ut=vi[nr],Pe.format!==fe?_r!==null?Ri?rr&&d.compressedTexSubImage2D(S.TEXTURE_2D,nr,0,0,ut.width,ut.height,_r,ut.data):d.compressedTexImage2D(S.TEXTURE_2D,nr,zr,ut.width,ut.height,0,ut.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ri?rr&&d.texSubImage2D(S.TEXTURE_2D,nr,0,0,ut.width,ut.height,_r,_n,ut.data):d.texImage2D(S.TEXTURE_2D,nr,zr,ut.width,ut.height,0,_r,_n,ut.data)}else if(Pe.isDataArrayTexture)Ri?(Mr&&d.texStorage3D(S.TEXTURE_2D_ARRAY,on,zr,lr.width,lr.height,lr.depth),rr&&d.texSubImage3D(S.TEXTURE_2D_ARRAY,0,0,0,0,lr.width,lr.height,lr.depth,_r,_n,lr.data)):d.texImage3D(S.TEXTURE_2D_ARRAY,0,zr,lr.width,lr.height,lr.depth,0,_r,_n,lr.data);else if(Pe.isData3DTexture)Ri?(Mr&&d.texStorage3D(S.TEXTURE_3D,on,zr,lr.width,lr.height,lr.depth),rr&&d.texSubImage3D(S.TEXTURE_3D,0,0,0,0,lr.width,lr.height,lr.depth,_r,_n,lr.data)):d.texImage3D(S.TEXTURE_3D,0,zr,lr.width,lr.height,lr.depth,0,_r,_n,lr.data);else if(Pe.isFramebufferTexture){if(Mr)if(Ri)d.texStorage2D(S.TEXTURE_2D,on,zr,lr.width,lr.height);else{let nr=lr.width,Ji=lr.height;for(let yn=0;yn<on;yn++)d.texImage2D(S.TEXTURE_2D,yn,zr,nr,Ji,0,_r,_n,null),nr>>=1,Ji>>=1}}else if(vi.length>0){if(Ri&&Mr){const nr=Hn(vi[0]);d.texStorage2D(S.TEXTURE_2D,on,zr,nr.width,nr.height)}for(let nr=0,Ji=vi.length;nr<Ji;nr++)ut=vi[nr],Ri?rr&&d.texSubImage2D(S.TEXTURE_2D,nr,0,0,_r,_n,ut):d.texImage2D(S.TEXTURE_2D,nr,zr,_r,_n,ut);Pe.generateMipmaps=!1}else if(Ri){if(Mr){const nr=Hn(lr);d.texStorage2D(S.TEXTURE_2D,on,zr,nr.width,nr.height)}rr&&d.texSubImage2D(S.TEXTURE_2D,0,0,0,_r,_n,lr)}else d.texImage2D(S.TEXTURE_2D,0,zr,_r,_n,lr);we(Pe)&&_e(di),Rr.__version=oi.version,Pe.onUpdate&&Pe.onUpdate(Pe)}return et.__version=Pe.version,!0}function hi(et,Pe,zt){if(Pe.image.length!==6)return;const di=ds(et,Pe),gi=Pe.source;d.bindTexture(S.TEXTURE_CUBE_MAP,et.__webglTexture,S.TEXTURE0+zt);const oi=A.get(gi);if(gi.version!==oi.__version||di===!0){d.activeTexture(S.TEXTURE0+zt);const Rr=Yn.getPrimaries(Yn.workingColorSpace),zi=Pe.colorSpace===Wa?null:Yn.getPrimaries(Pe.colorSpace),cr=Pe.colorSpace===Wa||Rr===zi?S.NONE:S.BROWSER_DEFAULT_WEBGL;S.pixelStorei(S.UNPACK_FLIP_Y_WEBGL,Pe.flipY),S.pixelStorei(S.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Pe.premultiplyAlpha),S.pixelStorei(S.UNPACK_ALIGNMENT,Pe.unpackAlignment),S.pixelStorei(S.UNPACK_COLORSPACE_CONVERSION_WEBGL,cr);const Wn=Pe.isCompressedTexture||Pe.image[0].isCompressedTexture,lr=Pe.image[0]&&Pe.image[0].isDataTexture,_r=[];for(let Ji=0;Ji<6;Ji++)!Wn&&!lr?_r[Ji]=Re(Pe.image[Ji],!0,x.maxCubemapSize):_r[Ji]=lr?Pe.image[Ji].image:Pe.image[Ji],_r[Ji]=Ys(Pe,_r[Ji]);const _n=_r[0],zr=w.convert(Pe.format,Pe.colorSpace),ut=w.convert(Pe.type),vi=st(Pe.internalFormat,zr,ut,Pe.colorSpace),Ri=Pe.isVideoTexture!==!0,Mr=oi.__version===void 0||di===!0,rr=gi.dataReady;let on=qe(Pe,_n);ts(S.TEXTURE_CUBE_MAP,Pe);let nr;if(Wn){Ri&&Mr&&d.texStorage2D(S.TEXTURE_CUBE_MAP,on,vi,_n.width,_n.height);for(let Ji=0;Ji<6;Ji++){nr=_r[Ji].mipmaps;for(let yn=0;yn<nr.length;yn++){const Ir=nr[yn];Pe.format!==fe?zr!==null?Ri?rr&&d.compressedTexSubImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+Ji,yn,0,0,Ir.width,Ir.height,zr,Ir.data):d.compressedTexImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+Ji,yn,vi,Ir.width,Ir.height,0,Ir.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Ri?rr&&d.texSubImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+Ji,yn,0,0,Ir.width,Ir.height,zr,ut,Ir.data):d.texImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+Ji,yn,vi,Ir.width,Ir.height,0,zr,ut,Ir.data)}}}else{if(nr=Pe.mipmaps,Ri&&Mr){nr.length>0&&on++;const Ji=Hn(_r[0]);d.texStorage2D(S.TEXTURE_CUBE_MAP,on,vi,Ji.width,Ji.height)}for(let Ji=0;Ji<6;Ji++)if(lr){Ri?rr&&d.texSubImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+Ji,0,0,0,_r[Ji].width,_r[Ji].height,zr,ut,_r[Ji].data):d.texImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+Ji,0,vi,_r[Ji].width,_r[Ji].height,0,zr,ut,_r[Ji].data);for(let yn=0;yn<nr.length;yn++){const Ir=nr[yn].image[Ji].image;Ri?rr&&d.texSubImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+Ji,yn+1,0,0,Ir.width,Ir.height,zr,ut,Ir.data):d.texImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+Ji,yn+1,vi,Ir.width,Ir.height,0,zr,ut,Ir.data)}}else{Ri?rr&&d.texSubImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+Ji,0,0,0,zr,ut,_r[Ji]):d.texImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+Ji,0,vi,zr,ut,_r[Ji]);for(let yn=0;yn<nr.length;yn++){const Ir=nr[yn];Ri?rr&&d.texSubImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+Ji,yn+1,0,0,zr,ut,Ir.image[Ji]):d.texImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+Ji,yn+1,vi,zr,ut,Ir.image[Ji])}}}we(Pe)&&_e(S.TEXTURE_CUBE_MAP),oi.__version=gi.version,Pe.onUpdate&&Pe.onUpdate(Pe)}et.__version=Pe.version}function Ci(et,Pe,zt,di,gi,oi){const Rr=w.convert(zt.format,zt.colorSpace),zi=w.convert(zt.type),cr=st(zt.internalFormat,Rr,zi,zt.colorSpace);if(!A.get(Pe).__hasExternalTextures){const lr=Math.max(1,Pe.width>>oi),_r=Math.max(1,Pe.height>>oi);Pe.isWebGLMultiviewRenderTarget===!0?d.texStorage3D(S.TEXTURE_2D_ARRAY,0,cr,Pe.width,Pe.height,Pe.numViews):gi===S.TEXTURE_3D||gi===S.TEXTURE_2D_ARRAY?d.texImage3D(gi,oi,cr,lr,_r,Pe.depth,0,Rr,zi,null):d.texImage2D(gi,oi,cr,lr,_r,0,Rr,zi,null)}d.bindFramebuffer(S.FRAMEBUFFER,et);const Wn=Wr(Pe);Pe.isWebGLMultiviewRenderTarget===!0?Wn?F.framebufferTextureMultisampleMultiviewOVR(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,A.get(zt).__webglTexture,0,An(Pe),0,Pe.numViews):F.framebufferTextureMultiviewOVR(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,A.get(zt).__webglTexture,0,0,Pe.numViews):(gi===S.TEXTURE_2D||gi>=S.TEXTURE_CUBE_MAP_POSITIVE_X&&gi<=S.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&(Wn?L.framebufferTexture2DMultisampleEXT(S.FRAMEBUFFER,di,gi,A.get(zt).__webglTexture,0,An(Pe)):S.framebufferTexture2D(S.FRAMEBUFFER,di,gi,A.get(zt).__webglTexture,oi)),d.bindFramebuffer(S.FRAMEBUFFER,null)}function qi(et,Pe,zt){if(S.bindRenderbuffer(S.RENDERBUFFER,et),Pe.isWebGLMultiviewRenderTarget===!0){const di=Wr(Pe),gi=Pe.numViews,oi=Pe.depthTexture;let Rr=S.DEPTH_COMPONENT24,zi=S.DEPTH_ATTACHMENT;oi&&oi.isDepthTexture&&(oi.type===Rt?Rr=S.DEPTH_COMPONENT32F:oi.type===Di&&(Rr=S.DEPTH24_STENCIL8,zi=S.DEPTH_STENCIL_ATTACHMENT));let cr=A.get(Pe.depthTexture).__webglTexture;cr===void 0&&(cr=S.createTexture(),S.bindTexture(S.TEXTURE_2D_ARRAY,cr),S.texStorage3D(S.TEXTURE_2D_ARRAY,1,Rr,Pe.width,Pe.height,gi)),di?F.framebufferTextureMultisampleMultiviewOVR(S.FRAMEBUFFER,zi,cr,0,An(Pe),0,gi):F.framebufferTextureMultiviewOVR(S.FRAMEBUFFER,zi,cr,0,0,gi)}else if(Pe.depthBuffer&&!Pe.stencilBuffer){let di=S.DEPTH_COMPONENT24;if(zt||Wr(Pe)){const gi=Pe.depthTexture;gi&&gi.isDepthTexture&&(gi.type===Rt?di=S.DEPTH_COMPONENT32F:gi.type===ct&&(di=S.DEPTH_COMPONENT24));const oi=An(Pe);Wr(Pe)?L.renderbufferStorageMultisampleEXT(S.RENDERBUFFER,oi,di,Pe.width,Pe.height):S.renderbufferStorageMultisample(S.RENDERBUFFER,oi,di,Pe.width,Pe.height)}else S.renderbufferStorage(S.RENDERBUFFER,di,Pe.width,Pe.height);S.framebufferRenderbuffer(S.FRAMEBUFFER,S.DEPTH_ATTACHMENT,S.RENDERBUFFER,et)}else if(Pe.depthBuffer&&Pe.stencilBuffer){const di=An(Pe);zt&&Wr(Pe)===!1?S.renderbufferStorageMultisample(S.RENDERBUFFER,di,S.DEPTH24_STENCIL8,Pe.width,Pe.height):Wr(Pe)?L.renderbufferStorageMultisampleEXT(S.RENDERBUFFER,di,S.DEPTH24_STENCIL8,Pe.width,Pe.height):S.renderbufferStorage(S.RENDERBUFFER,S.DEPTH_STENCIL,Pe.width,Pe.height),S.framebufferRenderbuffer(S.FRAMEBUFFER,S.DEPTH_STENCIL_ATTACHMENT,S.RENDERBUFFER,et)}else{const di=Pe.textures;for(let gi=0;gi<di.length;gi++){const oi=di[gi],Rr=w.convert(oi.format,oi.colorSpace),zi=w.convert(oi.type),cr=st(oi.internalFormat,Rr,zi,oi.colorSpace),Wn=An(Pe);zt&&Wr(Pe)===!1?S.renderbufferStorageMultisample(S.RENDERBUFFER,Wn,cr,Pe.width,Pe.height):Wr(Pe)?L.renderbufferStorageMultisampleEXT(S.RENDERBUFFER,Wn,cr,Pe.width,Pe.height):S.renderbufferStorage(S.RENDERBUFFER,cr,Pe.width,Pe.height)}}S.bindRenderbuffer(S.RENDERBUFFER,null)}function tt(et,Pe){if(Pe&&Pe.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(d.bindFramebuffer(S.FRAMEBUFFER,et),!(Pe.depthTexture&&Pe.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!A.get(Pe.depthTexture).__webglTexture||Pe.depthTexture.image.width!==Pe.width||Pe.depthTexture.image.height!==Pe.height)&&(Pe.depthTexture.image.width=Pe.width,Pe.depthTexture.image.height=Pe.height,Pe.depthTexture.needsUpdate=!0),pi(Pe.depthTexture,0),Pe.depthTexture.image.depth!=1?Ni(Pe.depthTexture,0):pi(Pe.depthTexture,0);const zt=A.get(Pe.depthTexture).__webglTexture,di=An(Pe);if(Pe.isWebGLMultiviewRenderTarget===!0){const gi=Wr(Pe),oi=Pe.numViews;if(Pe.depthTexture.format===Ke)gi?F.framebufferTextureMultisampleMultiviewOVR(S.FRAMEBUFFER,S.DEPTH_ATTACHMENT,zt,0,di,0,oi):F.framebufferTextureMultiviewOVR(S.FRAMEBUFFER,S.DEPTH_ATTACHMENT,zt,0,0,oi);else if(Pe.depthTexture.format===lt)gi?F.framebufferTextureMultisampleMultiviewOVR(S.FRAMEBUFFER,S.DEPTH_STENCIL_ATTACHMENT,zt,0,di,0,oi):F.framebufferTextureMultiviewOVR(S.FRAMEBUFFER,S.DEPTH_STENCIL_ATTACHMENT,zt,0,0,oi);else throw new Error("Unknown depthTexture format")}else if(Pe.depthTexture.format===Ke)Wr(Pe)?L.framebufferTexture2DMultisampleEXT(S.FRAMEBUFFER,S.DEPTH_ATTACHMENT,S.TEXTURE_2D,zt,0,di):S.framebufferTexture2D(S.FRAMEBUFFER,S.DEPTH_ATTACHMENT,S.TEXTURE_2D,zt,0);else if(Pe.depthTexture.format===lt)Wr(Pe)?L.framebufferTexture2DMultisampleEXT(S.FRAMEBUFFER,S.DEPTH_STENCIL_ATTACHMENT,S.TEXTURE_2D,zt,0,di):S.framebufferTexture2D(S.FRAMEBUFFER,S.DEPTH_STENCIL_ATTACHMENT,S.TEXTURE_2D,zt,0);else throw new Error("Unknown depthTexture format")}function mi(et){const Pe=A.get(et),zt=et.isWebGLCubeRenderTarget===!0;if(et.depthTexture&&!Pe.__autoAllocateDepthBuffer){if(zt)throw new Error("target.depthTexture not supported in Cube render targets");tt(Pe.__webglFramebuffer,et)}else if(zt){Pe.__webglDepthbuffer=[];for(let di=0;di<6;di++)d.bindFramebuffer(S.FRAMEBUFFER,Pe.__webglFramebuffer[di]),Pe.__webglDepthbuffer[di]=S.createRenderbuffer(),qi(Pe.__webglDepthbuffer[di],et,!1)}else d.bindFramebuffer(S.FRAMEBUFFER,Pe.__webglFramebuffer),Pe.__webglDepthbuffer=S.createRenderbuffer(),qi(Pe.__webglDepthbuffer,et,!1);d.bindFramebuffer(S.FRAMEBUFFER,null)}function ti(et,Pe,zt){const di=A.get(et);Pe!==void 0&&Ci(di.__webglFramebuffer,et,et.texture,S.COLOR_ATTACHMENT0,S.TEXTURE_2D,0),zt!==void 0&&mi(et)}function er(et){const Pe=et.texture,zt=A.get(et),di=A.get(Pe);et.addEventListener("dispose",rt);const gi=et.textures,oi=et.isWebGLCubeRenderTarget===!0,Rr=gi.length>1;if(Rr||(di.__webglTexture===void 0&&(di.__webglTexture=S.createTexture()),di.__version=Pe.version,M.memory.textures++),oi){zt.__webglFramebuffer=[];for(let zi=0;zi<6;zi++)if(Pe.mipmaps&&Pe.mipmaps.length>0){zt.__webglFramebuffer[zi]=[];for(let cr=0;cr<Pe.mipmaps.length;cr++)zt.__webglFramebuffer[zi][cr]=S.createFramebuffer()}else zt.__webglFramebuffer[zi]=S.createFramebuffer()}else{if(Pe.mipmaps&&Pe.mipmaps.length>0){zt.__webglFramebuffer=[];for(let zi=0;zi<Pe.mipmaps.length;zi++)zt.__webglFramebuffer[zi]=S.createFramebuffer()}else zt.__webglFramebuffer=S.createFramebuffer();if(Rr)for(let zi=0,cr=gi.length;zi<cr;zi++){const Wn=A.get(gi[zi]);Wn.__webglTexture===void 0&&(Wn.__webglTexture=S.createTexture(),M.memory.textures++)}if(et.samples>0&&Wr(et)===!1){zt.__webglMultisampledFramebuffer=S.createFramebuffer(),zt.__webglColorRenderbuffer=[],d.bindFramebuffer(S.FRAMEBUFFER,zt.__webglMultisampledFramebuffer);for(let zi=0;zi<gi.length;zi++){const cr=gi[zi];zt.__webglColorRenderbuffer[zi]=S.createRenderbuffer(),S.bindRenderbuffer(S.RENDERBUFFER,zt.__webglColorRenderbuffer[zi]);const Wn=w.convert(cr.format,cr.colorSpace),lr=w.convert(cr.type),_r=st(cr.internalFormat,Wn,lr,cr.colorSpace,et.isXRRenderTarget===!0),_n=An(et);S.renderbufferStorageMultisample(S.RENDERBUFFER,_n,_r,et.width,et.height),S.framebufferRenderbuffer(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0+zi,S.RENDERBUFFER,zt.__webglColorRenderbuffer[zi])}S.bindRenderbuffer(S.RENDERBUFFER,null),et.depthBuffer&&(zt.__webglDepthRenderbuffer=S.createRenderbuffer(),qi(zt.__webglDepthRenderbuffer,et,!0)),d.bindFramebuffer(S.FRAMEBUFFER,null)}}if(oi){d.bindTexture(S.TEXTURE_CUBE_MAP,di.__webglTexture),ts(S.TEXTURE_CUBE_MAP,Pe);for(let zi=0;zi<6;zi++)if(Pe.mipmaps&&Pe.mipmaps.length>0)for(let cr=0;cr<Pe.mipmaps.length;cr++)Ci(zt.__webglFramebuffer[zi][cr],et,Pe,S.COLOR_ATTACHMENT0,S.TEXTURE_CUBE_MAP_POSITIVE_X+zi,cr);else Ci(zt.__webglFramebuffer[zi],et,Pe,S.COLOR_ATTACHMENT0,S.TEXTURE_CUBE_MAP_POSITIVE_X+zi,0);we(Pe)&&_e(S.TEXTURE_CUBE_MAP),d.unbindTexture()}else if(Rr){for(let zi=0,cr=gi.length;zi<cr;zi++){const Wn=gi[zi],lr=A.get(Wn);d.bindTexture(S.TEXTURE_2D,lr.__webglTexture),ts(S.TEXTURE_2D,Wn),Ci(zt.__webglFramebuffer,et,Wn,S.COLOR_ATTACHMENT0+zi,S.TEXTURE_2D,0),we(Wn)&&_e(S.TEXTURE_2D)}d.unbindTexture()}else{let zi=S.TEXTURE_2D;if((et.isWebGL3DRenderTarget||et.isWebGLArrayRenderTarget)&&(zi=et.isWebGL3DRenderTarget?S.TEXTURE_3D:S.TEXTURE_2D_ARRAY),et.isWebGLMultiviewRenderTarget===!0&&(zi=S.TEXTURE_2D_ARRAY),d.bindTexture(zi,di.__webglTexture),ts(zi,Pe),Pe.mipmaps&&Pe.mipmaps.length>0)for(let cr=0;cr<Pe.mipmaps.length;cr++)Ci(zt.__webglFramebuffer[cr],et,Pe,S.COLOR_ATTACHMENT0,zi,cr);else Ci(zt.__webglFramebuffer,et,Pe,S.COLOR_ATTACHMENT0,zi,0);we(Pe)&&_e(zi),d.unbindTexture()}(et.depthBuffer||et.isWebGLMultiviewRenderTarget===!0)&&this.setupDepthRenderbuffer(et)}function li(et){const Pe=et.textures;for(let zt=0,di=Pe.length;zt<di;zt++){const gi=Pe[zt];if(we(gi)){const oi=et.isWebGLCubeRenderTarget?S.TEXTURE_CUBE_MAP:S.TEXTURE_2D,Rr=A.get(gi).__webglTexture;d.bindTexture(oi,Rr),_e(oi),d.unbindTexture()}}}const ir=[],tr=[];function Ar(et){if(et.samples>0){if(Wr(et)===!1){const Pe=et.textures,zt=et.width,di=et.height;let gi=S.COLOR_BUFFER_BIT;const oi=et.stencilBuffer?S.DEPTH_STENCIL_ATTACHMENT:S.DEPTH_ATTACHMENT,Rr=A.get(et),zi=Pe.length>1;if(zi)for(let cr=0;cr<Pe.length;cr++)d.bindFramebuffer(S.FRAMEBUFFER,Rr.__webglMultisampledFramebuffer),S.framebufferRenderbuffer(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0+cr,S.RENDERBUFFER,null),d.bindFramebuffer(S.FRAMEBUFFER,Rr.__webglFramebuffer),S.framebufferTexture2D(S.DRAW_FRAMEBUFFER,S.COLOR_ATTACHMENT0+cr,S.TEXTURE_2D,null,0);d.bindFramebuffer(S.READ_FRAMEBUFFER,Rr.__webglMultisampledFramebuffer),d.bindFramebuffer(S.DRAW_FRAMEBUFFER,Rr.__webglFramebuffer);for(let cr=0;cr<Pe.length;cr++){if(et.resolveDepthBuffer&&(et.depthBuffer&&(gi|=S.DEPTH_BUFFER_BIT),et.stencilBuffer&&et.resolveStencilBuffer&&(gi|=S.STENCIL_BUFFER_BIT)),zi){S.framebufferRenderbuffer(S.READ_FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.RENDERBUFFER,Rr.__webglColorRenderbuffer[cr]);const Wn=A.get(Pe[cr]).__webglTexture;S.framebufferTexture2D(S.DRAW_FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_2D,Wn,0)}S.blitFramebuffer(0,0,zt,di,0,0,zt,di,gi,S.NEAREST),O===!0&&(ir.length=0,tr.length=0,ir.push(S.COLOR_ATTACHMENT0+cr),et.depthBuffer&&et.resolveDepthBuffer===!1&&(ir.push(oi),tr.push(oi),S.invalidateFramebuffer(S.DRAW_FRAMEBUFFER,tr)),S.invalidateFramebuffer(S.READ_FRAMEBUFFER,ir))}if(d.bindFramebuffer(S.READ_FRAMEBUFFER,null),d.bindFramebuffer(S.DRAW_FRAMEBUFFER,null),zi)for(let cr=0;cr<Pe.length;cr++){d.bindFramebuffer(S.FRAMEBUFFER,Rr.__webglMultisampledFramebuffer),S.framebufferRenderbuffer(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0+cr,S.RENDERBUFFER,Rr.__webglColorRenderbuffer[cr]);const Wn=A.get(Pe[cr]).__webglTexture;d.bindFramebuffer(S.FRAMEBUFFER,Rr.__webglFramebuffer),S.framebufferTexture2D(S.DRAW_FRAMEBUFFER,S.COLOR_ATTACHMENT0+cr,S.TEXTURE_2D,Wn,0)}d.bindFramebuffer(S.DRAW_FRAMEBUFFER,Rr.__webglMultisampledFramebuffer)}else if(et.depthBuffer&&et.resolveDepthBuffer===!1&&O){const Pe=et.stencilBuffer?S.DEPTH_STENCIL_ATTACHMENT:S.DEPTH_ATTACHMENT;S.invalidateFramebuffer(S.DRAW_FRAMEBUFFER,[Pe])}}}function An(et){return Math.min(x.maxSamples,et.samples)}function Wr(et){const Pe=A.get(et);return et.samples>0&&a.has("WEBGL_multisampled_render_to_texture")===!0&&Pe.__useRenderToTexture!==!1}function ha(et){const Pe=M.render.frame;J.get(et)!==Pe&&(J.set(et,Pe),et.update())}function Ys(et,Pe){const zt=et.colorSpace,di=et.format,gi=et.type;return et.isCompressedTexture===!0||et.isVideoTexture===!0||zt!==Rc&&zt!==Wa&&(Yn.getTransfer(zt)===ls?(di!==fe||gi!==gn)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",zt)),Pe}function Hn(et){return typeof HTMLImageElement<"u"&&et instanceof HTMLImageElement?(H.width=et.naturalWidth||et.width,H.height=et.naturalHeight||et.height):typeof VideoFrame<"u"&&et instanceof VideoFrame?(H.width=et.displayWidth,H.height=et.displayHeight):(H.width=et.width,H.height=et.height),H}this.allocateTextureUnit=It,this.resetTextureUnits=ft,this.setTexture2D=pi,this.setTexture2DArray=Ni,this.setTexture3D=Ut,this.setTextureCube=yi,this.rebindTextures=ti,this.uploadTexture=Cr,this.setupRenderTarget=er,this.updateRenderTargetMipmap=li,this.updateMultisampleRenderTarget=Ar,this.setupDepthTexture=tt,this.setupDepthRenderbuffer=mi,this.setupFrameBufferTexture=Ci,this.useMultisampledRTT=Wr,this.runDeferredUploads=Bn,this.setDeferTextureUploads=zn}function b9(S,a){function d(A,x=Wa){let w;const M=Yn.getTransfer(x);if(A===gn)return S.UNSIGNED_BYTE;if(A===Bi)return S.UNSIGNED_SHORT_4_4_4_4;if(A===sr)return S.UNSIGNED_SHORT_5_5_5_1;if(A===Oi)return S.UNSIGNED_INT_5_9_9_9_REV;if(A===Ls)return S.BYTE;if(A===es)return S.SHORT;if(A===bs)return S.UNSIGNED_SHORT;if(A===pe)return S.INT;if(A===ct)return S.UNSIGNED_INT;if(A===Rt)return S.FLOAT;if(A===Kt)return S.HALF_FLOAT;if(A===Be)return S.ALPHA;if(A===ae)return S.RGB;if(A===fe)return S.RGBA;if(A===Le)return S.LUMINANCE;if(A===Ue)return S.LUMINANCE_ALPHA;if(A===Ke)return S.DEPTH_COMPONENT;if(A===lt)return S.DEPTH_STENCIL;if(A===Tt)return S.RED;if(A===Yt)return S.RED_INTEGER;if(A===$t)return S.RG;if(A===Bt)return S.RG_INTEGER;if(A===ri)return S.RGBA_INTEGER;if(A===wi||A===Ui||A===Sr||A===ur)if(M===ls)if(w=a.get("WEBGL_compressed_texture_s3tc_srgb"),w!==null){if(A===wi)return w.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(A===Ui)return w.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(A===Sr)return w.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(A===ur)return w.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(w=a.get("WEBGL_compressed_texture_s3tc"),w!==null){if(A===wi)return w.COMPRESSED_RGB_S3TC_DXT1_EXT;if(A===Ui)return w.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(A===Sr)return w.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(A===ur)return w.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(A===$i||A===_i||A===Mn||A===Xn)if(w=a.get("WEBGL_compressed_texture_pvrtc"),w!==null){if(A===$i)return w.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(A===_i)return w.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(A===Mn)return w.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(A===Xn)return w.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(A===Ii||A===ar||A===hn)if(w=a.get("WEBGL_compressed_texture_etc"),w!==null){if(A===Ii||A===ar)return M===ls?w.COMPRESSED_SRGB8_ETC2:w.COMPRESSED_RGB8_ETC2;if(A===hn)return M===ls?w.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:w.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(A===qr||A===X||A===ue||A===ye||A===Te||A===Qe||A===Ye||A===mt||A===he||A===le||A===de||A===xe||A===Ee||A===ot)if(w=a.get("WEBGL_compressed_texture_astc"),w!==null){if(A===qr)return M===ls?w.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:w.COMPRESSED_RGBA_ASTC_4x4_KHR;if(A===X)return M===ls?w.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:w.COMPRESSED_RGBA_ASTC_5x4_KHR;if(A===ue)return M===ls?w.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:w.COMPRESSED_RGBA_ASTC_5x5_KHR;if(A===ye)return M===ls?w.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:w.COMPRESSED_RGBA_ASTC_6x5_KHR;if(A===Te)return M===ls?w.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:w.COMPRESSED_RGBA_ASTC_6x6_KHR;if(A===Qe)return M===ls?w.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:w.COMPRESSED_RGBA_ASTC_8x5_KHR;if(A===Ye)return M===ls?w.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:w.COMPRESSED_RGBA_ASTC_8x6_KHR;if(A===mt)return M===ls?w.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:w.COMPRESSED_RGBA_ASTC_8x8_KHR;if(A===he)return M===ls?w.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:w.COMPRESSED_RGBA_ASTC_10x5_KHR;if(A===le)return M===ls?w.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:w.COMPRESSED_RGBA_ASTC_10x6_KHR;if(A===de)return M===ls?w.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:w.COMPRESSED_RGBA_ASTC_10x8_KHR;if(A===xe)return M===ls?w.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:w.COMPRESSED_RGBA_ASTC_10x10_KHR;if(A===Ee)return M===ls?w.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:w.COMPRESSED_RGBA_ASTC_12x10_KHR;if(A===ot)return M===ls?w.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:w.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(A===Mt||A===Wt||A===ni)if(w=a.get("EXT_texture_compression_bptc"),w!==null){if(A===Mt)return M===ls?w.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:w.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(A===Wt)return w.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(A===ni)return w.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(A===Ai||A===qt||A===Li||A===yr)if(w=a.get("EXT_texture_compression_rgtc"),w!==null){if(A===Mt)return w.COMPRESSED_RED_RGTC1_EXT;if(A===qt)return w.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(A===Li)return w.COMPRESSED_RED_GREEN_RGTC2_EXT;if(A===yr)return w.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return A===Di?S.UNSIGNED_INT_24_8:S[A]!==void 0?S[A]:null}return{convert:d}}class yf extends Gn{constructor(){super(),this.isGroup=!0,this.type="Group"}}class KB extends va{constructor(a=[]){super(),this.isArrayCamera=!0,this.cameras=a}}var x9=new He,_9=new He;function fTe(S,a,d){x9.setFromMatrixPosition(a.matrixWorld),_9.setFromMatrixPosition(d.matrixWorld);var A=x9.distanceTo(_9),x=a.projectionMatrix.elements,w=d.projectionMatrix.elements,M=x[14]/(x[10]-1),L=x[14]/(x[10]+1),O=(x[9]+1)/x[5],F=(x[9]-1)/x[5],H=(x[8]-1)/x[0],J=(w[8]+1)/w[0],K=M*H,Z=M*J,ie=A/(-H+J),oe=ie*-H;a.matrixWorld.decompose(S.position,S.quaternion,S.scale),S.translateX(oe),S.translateZ(ie),S.matrixWorld.compose(S.position,S.quaternion,S.scale),S.matrixWorldInverse.copy(S.matrixWorld).invert();var ne=M+ie,ee=L+ie,Re=K-oe,we=Z+(A-oe),_e=O*L/ee*ne,st=F*L/ee*ne;S.projectionMatrix.makePerspective(Re,we,_e,st,ne,ee)}function E9(S){var a,d,A=this,x=null,w=null,M=null,L=[],O=new fr,F=new fr,H=1,J="local-floor";typeof window<"u"&&"VRFrameData"in window&&(w=new window.VRFrameData,window.addEventListener("vrdisplaypresentchange",_e,!1));var K=new fr,Z=new Vn,ie=new He,oe=new va;oe.viewport=new Fn,oe.layers.enable(1);var ne=new va;ne.viewport=new Fn,ne.layers.enable(2);var ee=new KB([oe,ne]);ee.layers.enable(1),ee.layers.enable(2);var Re=new ai,we;function _e(){var nt=A.isPresenting=x!==null&&x.isPresenting===!0;if(nt){var gt=x.getEyeParameters("left");a=2*gt.renderWidth*H,d=gt.renderHeight*H,we=S.getPixelRatio(),S.getSize(Re),S.setDrawingBufferSize(a,d,1),oe.viewport.set(0,0,a/2,d),ne.viewport.set(a/2,0,a/2,d),ke.start(),A.dispatchEvent({type:"sessionstart"})}else A.enabled&&S.setDrawingBufferSize(Re.width,Re.height,we),ke.stop(),A.dispatchEvent({type:"sessionend"})}var st=[],qe=[];function Ze(nt){for(var gt=navigator.getGamepads&&navigator.getGamepads(),ft=0,It=gt.length;ft<It;ft++){var Ft=gt[ft];if(Ft&&(Ft.id==="Daydream Controller"||Ft.id==="Gear VR Controller"||Ft.id==="Oculus Go Controller"||Ft.id==="OpenVR Gamepad"||Ft.id.startsWith("Oculus Touch")||Ft.id.startsWith("HTC Vive Focus")||Ft.id.startsWith("Spatial Controller"))){var pi=Ft.hand;if(nt===0&&(pi===""||pi==="right")||nt===1&&pi==="left")return Ft}}}function rt(){for(var nt=0;nt<L.length;nt++){var gt=L[nt],ft=Ze(nt);if(ft!==void 0&&ft.pose!==void 0){if(ft.pose===null)return;var It=ft.pose;It.hasPosition===!1&&gt.position.set(.2,-.6,-.05),It.position!==null&&gt.position.fromArray(It.position),It.orientation!==null&&gt.quaternion.fromArray(It.orientation),gt.matrix.compose(gt.position,gt.quaternion,gt.scale),gt.matrix.premultiply(O),gt.matrix.decompose(gt.position,gt.quaternion,gt.scale),gt.matrixWorldNeedsUpdate=!0,gt.visible=!0;var Ft=ft.id==="Daydream Controller"?0:1;st[nt]===void 0&&(st[nt]=!1),st[nt]!==ft.buttons[Ft].pressed&&(st[nt]=ft.buttons[Ft].pressed,st[nt]===!0?gt.dispatchEvent({type:"selectstart"}):(gt.dispatchEvent({type:"selectend"}),gt.dispatchEvent({type:"select"}))),Ft=2,qe[nt]===void 0&&(qe[nt]=!1),ft.buttons[Ft]!==void 0&&qe[nt]!==ft.buttons[Ft].pressed&&(qe[nt]=ft.buttons[Ft].pressed,qe[nt]===!0?gt.dispatchEvent({type:"squeezestart"}):(gt.dispatchEvent({type:"squeezeend"}),gt.dispatchEvent({type:"squeeze"})))}else gt.visible=!1}}function je(nt,gt){gt!==null&&gt.length===4&&nt.set(gt[0]*a,gt[1]*d,gt[2]*a,gt[3]*d)}this.enabled=!1,this.getController=function(nt){var gt=L[nt];return gt===void 0&&(gt=new yf,gt.matrixAutoUpdate=!1,gt.visible=!1,L[nt]=gt),gt},this.getDevice=function(){return x},this.setDevice=function(nt){nt!==void 0&&(x=nt),ke.setContext(nt)},this.setFramebufferScaleFactor=function(nt){H=nt},this.setReferenceSpaceType=function(nt){J=nt},this.setPoseTarget=function(nt){nt!==void 0&&(M=nt)},this.cameraAutoUpdate=!0,this.updateCamera=function(nt){var gt=J==="local-floor"?1.6:0;if(x.depthNear=nt.near,x.depthFar=nt.far,x.getFrameData(w),J==="local-floor"){var ft=x.stageParameters;ft?O.fromArray(ft.sittingToStandingTransform):O.makeTranslation(0,gt,0)}var It=w.pose,Ft=M!==null?M:nt;Ft.matrix.copy(O),Ft.matrix.decompose(Ft.position,Ft.quaternion,Ft.scale),It.orientation!==null&&(Z.fromArray(It.orientation),Ft.quaternion.multiply(Z)),It.position!==null&&(Z.setFromRotationMatrix(O),ie.fromArray(It.position),ie.applyQuaternion(Z),Ft.position.add(ie)),Ft.updateMatrixWorld();for(var pi=Ft.children,Ni=0,Ut=pi.length;Ni<Ut;Ni++)pi[Ni].updateMatrixWorld(!0);oe.near=nt.near,ne.near=nt.near,oe.far=nt.far,ne.far=nt.far,oe.matrixWorldInverse.fromArray(w.leftViewMatrix),ne.matrixWorldInverse.fromArray(w.rightViewMatrix),F.copy(O).invert(),J==="local-floor"&&(oe.matrixWorldInverse.multiply(F),ne.matrixWorldInverse.multiply(F));var yi=Ft.parent;yi!==null&&(K.copy(yi.matrixWorld).invert(),oe.matrixWorldInverse.multiply(K),ne.matrixWorldInverse.multiply(K)),oe.matrixWorld.copy(oe.matrixWorldInverse).invert(),ne.matrixWorld.copy(ne.matrixWorldInverse).invert(),oe.projectionMatrix.fromArray(w.leftProjectionMatrix),ne.projectionMatrix.fromArray(w.rightProjectionMatrix),fTe(ee,oe,ne);var Pi=x.getLayers();if(Pi.length){var Ur=Pi[0];je(oe.viewport,Ur.leftBounds),je(ne.viewport,Ur.rightBounds)}return rt(),ee},this.getCamera=function(){return ee},this.getFoveation=function(){return 1},this.setFoveation=function(nt){nt!==1&&console.warn("THREE.WebVRManager: setFoveation() not used in WebVR.")},this.getEnvironmentBlendMode=function(){if(A.isPresenting)return"opaque"},this.getStandingMatrix=function(){return O},this.isPresenting=!1;var ke=new kB;this.setAnimationLoop=function(nt){ke.setAnimationLoop(nt),this.isPresenting&&ke.start()},this.submitFrame=function(){this.isPresenting&&x.submitFrame()},this.dispose=function(){typeof window<"u"&&window.removeEventListener("vrdisplaypresentchange",_e)},this.setFrameOfReferenceType=function(){console.warn("THREE.WebVRManager: setFrameOfReferenceType() has been deprecated.")}}Object.assign(E9.prototype,{addEventListener:Mo.prototype.addEventListener,hasEventListener:Mo.prototype.hasEventListener,removeEventListener:Mo.prototype.removeEventListener,dispatchEvent:Mo.prototype.dispatchEvent});class w9 extends Jo{constructor(a,d,A,x={}){super(a,d,x),this.depthBuffer=!1,this.stencilBuffer=!1,this.numViews=A}copy(a){return super.copy(a),this.numViews=a.numViews,this}}w9.prototype.isWebGLMultiviewRenderTarget=!0;const mTe={type:"move"};class JB{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new yf,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new yf,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new He,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new He),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new yf,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new He,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new He),this._grip}dispatchEvent(a){return this._targetRay!==null&&this._targetRay.dispatchEvent(a),this._grip!==null&&this._grip.dispatchEvent(a),this._hand!==null&&this._hand.dispatchEvent(a),this}connect(a){if(a&&a.hand){const d=this._hand;if(d)for(const A of a.hand.values())this._getHandJoint(d,A)}return this.dispatchEvent({type:"connected",data:a}),this}disconnect(a){return this.dispatchEvent({type:"disconnected",data:a}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(a,d,A){let x=null,w=null,M=null;const L=this._targetRay,O=this._grip,F=this._hand;if(a&&d.session.visibilityState!=="visible-blurred"){if(F&&a.hand){M=!0;for(const oe of a.hand.values()){const ne=d.getJointPose(oe,A),ee=this._getHandJoint(F,oe);ne!==null&&(ee.matrix.fromArray(ne.transform.matrix),ee.matrix.decompose(ee.position,ee.rotation,ee.scale),ee.matrixWorldNeedsUpdate=!0,ee.jointRadius=ne.radius),ee.visible=ne!==null}const H=F.joints["index-finger-tip"],J=F.joints["thumb-tip"],K=H.position.distanceTo(J.position),Z=.02,ie=.005;F.inputState.pinching&&K>Z+ie?(F.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:a.handedness,target:this})):!F.inputState.pinching&&K<=Z-ie&&(F.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:a.handedness,target:this}))}else O!==null&&a.gripSpace&&(w=d.getPose(a.gripSpace,A),w!==null&&(O.matrix.fromArray(w.transform.matrix),O.matrix.decompose(O.position,O.rotation,O.scale),O.matrixWorldNeedsUpdate=!0,w.linearVelocity?(O.hasLinearVelocity=!0,O.linearVelocity.copy(w.linearVelocity)):O.hasLinearVelocity=!1,w.angularVelocity?(O.hasAngularVelocity=!0,O.angularVelocity.copy(w.angularVelocity)):O.hasAngularVelocity=!1));L!==null&&(x=d.getPose(a.targetRaySpace,A),x===null&&w!==null&&(x=w),x!==null&&(L.matrix.fromArray(x.transform.matrix),L.matrix.decompose(L.position,L.rotation,L.scale),L.matrixWorldNeedsUpdate=!0,x.linearVelocity?(L.hasLinearVelocity=!0,L.linearVelocity.copy(x.linearVelocity)):L.hasLinearVelocity=!1,x.angularVelocity?(L.hasAngularVelocity=!0,L.angularVelocity.copy(x.angularVelocity)):L.hasAngularVelocity=!1,this.dispatchEvent(mTe)))}return L!==null&&(L.visible=x!==null),O!==null&&(O.visible=w!==null),F!==null&&(F.visible=M!==null),this}_getHandJoint(a,d){if(a.joints[d.jointName]===void 0){const A=new yf;A.matrixAutoUpdate=!1,A.visible=!1,a.joints[d.jointName]=A,a.add(A)}return a.joints[d.jointName]}}const gTe=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,ATe=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class yTe{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(a,d,A){if(this.texture===null){const x=new hs,w=a.properties.get(x);w.__webglTexture=d.texture,(d.depthNear!=A.depthNear||d.depthFar!=A.depthFar)&&(this.depthNear=d.depthNear,this.depthFar=d.depthFar),this.texture=x}}render(a,d){if(this.texture!==null){if(this.mesh===null){const A=d.cameras[0].viewport,x=new Bc({vertexShader:gTe,fragmentShader:ATe,uniforms:{depthColor:{value:this.texture},depthWidth:{value:A.z},depthHeight:{value:A.w}}});this.mesh=new ua(new f0(20,20),x)}a.render(this.mesh,d)}}reset(){this.texture=null,this.mesh=null}}class vTe extends Mo{constructor(a,d,A,x){super();const w=this;let M=null,L=1;var O=null;let F=null,H="local-floor",J=1,K=null,Z=null;var ie=[];let oe=null,ne=null,ee=null,Re=null;const we=new yTe,_e=d.getContextAttributes();let st=null,qe=null;const Ze=[],rt=[],je=new ai;let ke=null;const nt=new va;nt.layers.enable(1),nt.viewport=new Fn;const gt=new va;gt.layers.enable(2),gt.viewport=new Fn;const ft=[nt,gt],It=new KB;It.layers.enable(1),It.layers.enable(2);let Ft=null,pi=null;this.cameraAutoUpdate=!0,this.layersEnabled=!1,this.enabled=!1,this.isPresenting=!1,this.isMultiview=!1,this.getCameraPose=function(){return Z},this.getController=function(hi){let Ci=Ze[hi];return Ci===void 0&&(Ci=new JB,Ze[hi]=Ci),Ci.getTargetRaySpace()},this.getControllerGrip=function(hi){let Ci=Ze[hi];return Ci===void 0&&(Ci=new JB,Ze[hi]=Ci),Ci.getGripSpace()},this.getHand=function(hi){let Ci=Ze[hi];return Ci===void 0&&(Ci=new JB,Ze[hi]=Ci),Ci.getHandSpace()};function Ni(hi){const Ci=rt.indexOf(hi.inputSource);if(Ci===-1)return;const qi=Ze[Ci];qi!==void 0&&(qi.update(hi.inputSource,hi.frame,K||F),qi.dispatchEvent({type:hi.type,data:hi.inputSource}))}function Ut(){M.removeEventListener("select",Ni),M.removeEventListener("selectstart",Ni),M.removeEventListener("selectend",Ni),M.removeEventListener("squeeze",Ni),M.removeEventListener("squeezestart",Ni),M.removeEventListener("squeezeend",Ni),M.removeEventListener("end",Ut),M.removeEventListener("inputsourceschange",yi);for(let hi=0;hi<Ze.length;hi++){const Ci=rt[hi];Ci!==null&&(rt[hi]=null,Ze[hi].disconnect(Ci))}Ft=null,pi=null,we.reset(),a.setRenderTarget(st),ee=null,ne=null,oe=null,M=null,qe=null,Cr.stop(),w.isPresenting=!1,a.setPixelRatio(ke),a.setSize(je.width,je.height,!1),w.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(hi){L=hi,w.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(hi){H=hi,w.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return K||F},this.setReferenceSpace=function(hi){K=hi},this.getBaseLayer=function(){return ne!==null?ne:ee},this.getBinding=function(){return oe},this.getFrame=function(){return Re},this.getSession=function(){return M},this.setSession=async function(hi){if(M=hi,M!==null){if(st=a.getRenderTarget(),M.addEventListener("select",Ni),M.addEventListener("selectstart",Ni),M.addEventListener("selectend",Ni),M.addEventListener("squeeze",Ni),M.addEventListener("squeezestart",Ni),M.addEventListener("squeezeend",Ni),M.addEventListener("end",Ut),M.addEventListener("inputsourceschange",yi),_e.xrCompatible!==!0&&await d.makeXRCompatible(),ke=a.getPixelRatio(),a.getSize(je),M.renderState.layers===void 0){const Ci={antialias:_e.antialias,alpha:!0,depth:_e.depth,stencil:_e.stencil,framebufferScaleFactor:L};ee=new XRWebGLLayer(M,d,Ci),M.updateRenderState({baseLayer:ee}),a.setPixelRatio(1),a.setSize(ee.framebufferWidth,ee.framebufferHeight,!1),qe=new Jo(ee.framebufferWidth,ee.framebufferHeight,{format:fe,type:gn,colorSpace:a.outputColorSpace,stencilBuffer:_e.stencil})}else{let Ci=null,qi=null,tt=null;_e.depth&&(tt=_e.stencil?d.DEPTH24_STENCIL8:d.DEPTH_COMPONENT24,Ci=_e.stencil?lt:Ke,qi=_e.stencil?Di:ct),w.isMultiview=x&&A.has("OCULUS_multiview");const mi={colorFormat:d.RGBA8,depthFormat:tt,scaleFactor:L};w.isMultiview&&(mi.textureType="texture-array"),oe=new XRWebGLBinding(M,d),ne=oe.createProjectionLayer(mi),M.updateRenderState({layers:[ne]}),a.setPixelRatio(1),a.setSize(ne.textureWidth,ne.textureHeight,!1);const ti={format:fe,type:gn,depthTexture:new WB(ne.textureWidth,ne.textureHeight,qi,void 0,void 0,void 0,void 0,void 0,void 0,Ci),stencilBuffer:_e.stencil,colorSpace:a.outputColorSpace,samples:_e.antialias?4:0,resolveDepthBuffer:ne.ignoreDepthValues===!1};if(w.isMultiview){const er=A.get("OCULUS_multiview");this.maxNumViews=d.getParameter(er.MAX_VIEWS_OVR),qe=new w9(ne.textureWidth,ne.textureHeight,2,ti)}else qe=new Jo(ne.textureWidth,ne.textureHeight,ti)}qe.isXRRenderTarget=!0,this.setFoveation(J),K=null,F=await M.requestReferenceSpace(H),Cr.setContext(M),Cr.start(),w.isPresenting=!0,w.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(M!==null)return M.environmentBlendMode},this.addLayer=function(hi){!window.XRWebGLBinding||!this.layersEnabled||!M||(ie.push(hi),this.updateLayers())},this.removeLayer=function(hi){ie.splice(ie.indexOf(hi),1),!(!window.XRWebGLBinding||!this.layersEnabled||!M)&&this.updateLayers()},this.updateLayers=function(){var hi=ie.map(function(Ci){return Ci});hi.unshift(M.renderState.layers[0]),M.updateRenderState({layers:hi})};function yi(hi){for(let Ci=0;Ci<hi.removed.length;Ci++){const qi=hi.removed[Ci],tt=rt.indexOf(qi);tt>=0&&(rt[tt]=null,Ze[tt].disconnect(qi))}for(let Ci=0;Ci<hi.added.length;Ci++){const qi=hi.added[Ci];let tt=rt.indexOf(qi);if(tt===-1){for(let ti=0;ti<Ze.length;ti++)if(ti>=rt.length){rt.push(qi),tt=ti;break}else if(rt[ti]===null){rt[ti]=qi,tt=ti;break}if(tt===-1)break}const mi=Ze[tt];mi&&mi.connect(qi)}}const Pi=new He,Ur=new He;function xn(hi,Ci,qi){Pi.setFromMatrixPosition(Ci.matrixWorld),Ur.setFromMatrixPosition(qi.matrixWorld);const tt=Pi.distanceTo(Ur),mi=Ci.projectionMatrix.elements,ti=qi.projectionMatrix.elements,er=mi[14]/(mi[10]-1),li=mi[14]/(mi[10]+1),ir=(mi[9]+1)/mi[5],tr=(mi[9]-1)/mi[5],Ar=(mi[8]-1)/mi[0],An=(ti[8]+1)/ti[0],Wr=er*Ar,ha=er*An,Ys=tt/(-Ar+An),Hn=Ys*-Ar;Ci.matrixWorld.decompose(hi.position,hi.quaternion,hi.scale),hi.translateX(Hn),hi.translateZ(Ys),hi.matrixWorld.compose(hi.position,hi.quaternion,hi.scale),hi.matrixWorldInverse.copy(hi.matrixWorld).invert();const et=er+Ys,Pe=li+Ys,zt=Wr-Hn,di=ha+(tt-Hn),gi=ir*li/Pe*et,oi=tr*li/Pe*et;hi.projectionMatrix.makePerspective(zt,di,gi,oi,et,Pe),hi.projectionMatrixInverse.copy(hi.projectionMatrix).invert()}function ts(hi,Ci){Ci===null?hi.matrixWorld.copy(hi.matrix):hi.matrixWorld.multiplyMatrices(Ci.matrixWorld,hi.matrix),hi.matrixWorldInverse.copy(hi.matrixWorld).invert()}this.setPoseTarget=function(hi){hi!==void 0&&(O=hi)},this.updateCamera=function(hi){if(M===null)return;we.texture!==null&&(hi.near=we.depthNear,hi.far=we.depthFar),It.near=gt.near=nt.near=hi.near,It.far=gt.far=nt.far=hi.far,(Ft!==It.near||pi!==It.far)&&(M.updateRenderState({depthNear:It.near,depthFar:It.far}),Ft=It.near,pi=It.far,nt.near=Ft,nt.far=pi,gt.near=Ft,gt.far=pi,nt.updateProjectionMatrix(),gt.updateProjectionMatrix(),hi.updateProjectionMatrix());const Ci=It.cameras;var qi=O||hi;const tt=qi.parent;ts(It,tt);for(let mi=0;mi<Ci.length;mi++)ts(Ci[mi],tt);Ci.length===2?xn(It,nt,gt):It.projectionMatrix.copy(nt.projectionMatrix),ds(hi,It,qi)};function ds(hi,Ci,qi){Ci.matrixWorld.decompose(Ci.position,Ci.quaternion,Ci.scale),qi.parent===null?qi.matrix.copy(Ci.matrixWorld):(qi.matrix.copy(qi.parent.matrixWorld),qi.matrix.invert(),qi.matrix.multiply(Ci.matrixWorld)),qi.matrix.decompose(qi.position,qi.quaternion,qi.scale),qi.updateMatrixWorld(!0),hi.projectionMatrix.copy(Ci.projectionMatrix),hi.projectionMatrixInverse.copy(Ci.projectionMatrixInverse),hi.isPerspectiveCamera&&(hi.fov=Bd*2*Math.atan(1/hi.projectionMatrix.elements[5]),hi.zoom=1)}this.getCamera=function(){return It},this.getFoveation=function(){if(!(ne===null&&ee===null))return J},this.setFoveation=function(hi){J=hi,ne!==null&&(ne.fixedFoveation=hi),ee!==null&&ee.fixedFoveation!==void 0&&(ee.fixedFoveation=hi)},this.hasDepthSensing=function(){return we.texture!==null};let zn=null;function Bn(hi,Ci){if(Z=Ci.getViewerPose(K||F),Re=Ci,Z!==null){const qi=Z.views;ee!==null&&(a.setRenderTargetFramebuffer(qe,ee.framebuffer),a.setRenderTarget(qe));let tt=!1;qi.length!==It.cameras.length&&(It.cameras.length=0,tt=!0);for(let ti=0;ti<qi.length;ti++){const er=qi[ti];let li=null;if(ee!==null)li=ee.getViewport(er);else{const tr=oe.getViewSubImage(ne,er);li=tr.viewport,ti===0&&(a.setRenderTargetTextures(qe,tr.colorTexture,ne.ignoreDepthValues?void 0:tr.depthStencilTexture),a.setRenderTarget(qe))}let ir=ft[ti];ir===void 0&&(ir=new va,ir.layers.enable(ti),ir.viewport=new Fn,ft[ti]=ir),ir.matrix.fromArray(er.transform.matrix),ir.matrix.decompose(ir.position,ir.quaternion,ir.scale),ir.projectionMatrix.fromArray(er.projectionMatrix),ir.projectionMatrixInverse.copy(ir.projectionMatrix).invert(),ir.viewport.set(li.x,li.y,li.width,li.height),ti===0&&(It.matrix.copy(ir.matrix),It.matrix.decompose(It.position,It.quaternion,It.scale)),tt===!0&&It.cameras.push(ir)}const mi=M.enabledFeatures;if(mi&&mi.includes("depth-sensing")){const ti=oe.getDepthInformation(qi[0]);ti&&ti.isValid&&ti.texture&&we.init(a,ti,M.renderState)}}for(let qi=0;qi<Ze.length;qi++){const tt=rt[qi],mi=Ze[qi];tt!==null&&mi!==void 0&&mi.update(tt,Ci,K||F)}we.render(a,It),zn&&zn(hi,Ci),Ci.detectedPlanes&&w.dispatchEvent({type:"planesdetected",data:Ci}),Re=null}const Cr=new kB;Cr.setAnimationLoop(Bn),this.setAnimationLoop=function(hi){zn=hi},this.dispose=function(){}}}const vf=new Tl,bTe=new fr;function xTe(S,a){function d(ne,ee){ne.matrixAutoUpdate===!0&&ne.updateMatrix(),ee.value.copy(ne.matrix)}function A(ne,ee){ee.color.getRGB(ne.fogColor.value,Vj(S)),ee.isFog?(ne.fogNear.value=ee.near,ne.fogFar.value=ee.far):ee.isFogExp2&&(ne.fogDensity.value=ee.density)}function x(ne,ee,Re,we,_e){ee.isMeshBasicMaterial||ee.isMeshLambertMaterial?w(ne,ee):ee.isMeshToonMaterial?(w(ne,ee),J(ne,ee)):ee.isMeshPhongMaterial?(w(ne,ee),H(ne,ee)):ee.isMeshStandardMaterial?(w(ne,ee),K(ne,ee),ee.isMeshPhysicalMaterial&&Z(ne,ee,_e)):ee.isMeshMatcapMaterial?(w(ne,ee),ie(ne,ee)):ee.isMeshDepthMaterial?w(ne,ee):ee.isMeshDistanceMaterial?(w(ne,ee),oe(ne,ee)):ee.isMeshNormalMaterial?w(ne,ee):ee.isLineBasicMaterial?(M(ne,ee),ee.isLineDashedMaterial&&L(ne,ee)):ee.isPointsMaterial?O(ne,ee,Re,we):ee.isSpriteMaterial?F(ne,ee):ee.isShadowMaterial?(ne.color.value.copy(ee.color),ne.opacity.value=ee.opacity):ee.isShaderMaterial&&(ee.uniformsNeedUpdate=!1)}function w(ne,ee){ne.opacity.value=ee.opacity,ee.color&&ne.diffuse.value.copy(ee.color),ee.emissive&&ne.emissive.value.copy(ee.emissive).multiplyScalar(ee.emissiveIntensity),ee.map&&(ne.map.value=ee.map,d(ee.map,ne.mapTransform)),ee.alphaMap&&(ne.alphaMap.value=ee.alphaMap,d(ee.alphaMap,ne.alphaMapTransform)),ee.bumpMap&&(ne.bumpMap.value=ee.bumpMap,d(ee.bumpMap,ne.bumpMapTransform),ne.bumpScale.value=ee.bumpScale,ee.side===R&&(ne.bumpScale.value*=-1)),ee.normalMap&&(ne.normalMap.value=ee.normalMap,d(ee.normalMap,ne.normalMapTransform),ne.normalScale.value.copy(ee.normalScale),ee.side===R&&ne.normalScale.value.negate()),ee.displacementMap&&(ne.displacementMap.value=ee.displacementMap,d(ee.displacementMap,ne.displacementMapTransform),ne.displacementScale.value=ee.displacementScale,ne.displacementBias.value=ee.displacementBias),ee.emissiveMap&&(ne.emissiveMap.value=ee.emissiveMap,d(ee.emissiveMap,ne.emissiveMapTransform)),ee.specularMap&&(ne.specularMap.value=ee.specularMap,d(ee.specularMap,ne.specularMapTransform)),ee.alphaTest>0&&(ne.alphaTest.value=ee.alphaTest);const Re=a.get(ee),we=Re.envMap,_e=Re.envMapRotation;if(we&&(ne.envMap.value=we,vf.copy(_e),vf.x*=-1,vf.y*=-1,vf.z*=-1,we.isCubeTexture&&we.isRenderTargetTexture===!1&&(vf.y*=-1,vf.z*=-1),ne.envMapRotation.value.setFromMatrix4(bTe.makeRotationFromEuler(vf)),ne.flipEnvMap.value=we.isCubeTexture&&we.isRenderTargetTexture===!1?-1:1,ne.reflectivity.value=ee.reflectivity,ne.ior.value=ee.ior,ne.refractionRatio.value=ee.refractionRatio),ee.lightMap){ne.lightMap.value=ee.lightMap;const st=S._useLegacyLights===!0?Math.PI:1;ne.lightMapIntensity.value=ee.lightMapIntensity*st,d(ee.lightMap,ne.lightMapTransform)}ee.aoMap&&(ne.aoMap.value=ee.aoMap,ne.aoMapIntensity.value=ee.aoMapIntensity,d(ee.aoMap,ne.aoMapTransform))}function M(ne,ee){ne.diffuse.value.copy(ee.color),ne.opacity.value=ee.opacity,ee.map&&(ne.map.value=ee.map,d(ee.map,ne.mapTransform))}function L(ne,ee){ne.dashSize.value=ee.dashSize,ne.totalSize.value=ee.dashSize+ee.gapSize,ne.scale.value=ee.scale}function O(ne,ee,Re,we){ne.diffuse.value.copy(ee.color),ne.opacity.value=ee.opacity,ne.size.value=ee.size*Re,ne.scale.value=we*.5,ee.map&&(ne.map.value=ee.map,d(ee.map,ne.uvTransform)),ee.alphaMap&&(ne.alphaMap.value=ee.alphaMap,d(ee.alphaMap,ne.alphaMapTransform)),ee.alphaTest>0&&(ne.alphaTest.value=ee.alphaTest)}function F(ne,ee){ne.diffuse.value.copy(ee.color),ne.opacity.value=ee.opacity,ne.rotation.value=ee.rotation,ee.map&&(ne.map.value=ee.map,d(ee.map,ne.mapTransform)),ee.alphaMap&&(ne.alphaMap.value=ee.alphaMap,d(ee.alphaMap,ne.alphaMapTransform)),ee.alphaTest>0&&(ne.alphaTest.value=ee.alphaTest)}function H(ne,ee){ne.specular.value.copy(ee.specular),ne.shininess.value=Math.max(ee.shininess,1e-4)}function J(ne,ee){ee.gradientMap&&(ne.gradientMap.value=ee.gradientMap)}function K(ne,ee){ne.metalness.value=ee.metalness,ee.metalnessMap&&(ne.metalnessMap.value=ee.metalnessMap,d(ee.metalnessMap,ne.metalnessMapTransform)),ne.roughness.value=ee.roughness,ee.roughnessMap&&(ne.roughnessMap.value=ee.roughnessMap,d(ee.roughnessMap,ne.roughnessMapTransform)),ee.envMap&&(ne.envMapIntensity.value=ee.envMapIntensity)}function Z(ne,ee,Re){ne.ior.value=ee.ior,ee.sheen>0&&(ne.sheenColor.value.copy(ee.sheenColor).multiplyScalar(ee.sheen),ne.sheenRoughness.value=ee.sheenRoughness,ee.sheenColorMap&&(ne.sheenColorMap.value=ee.sheenColorMap,d(ee.sheenColorMap,ne.sheenColorMapTransform)),ee.sheenRoughnessMap&&(ne.sheenRoughnessMap.value=ee.sheenRoughnessMap,d(ee.sheenRoughnessMap,ne.sheenRoughnessMapTransform))),ee.clearcoat>0&&(ne.clearcoat.value=ee.clearcoat,ne.clearcoatRoughness.value=ee.clearcoatRoughness,ee.clearcoatMap&&(ne.clearcoatMap.value=ee.clearcoatMap,d(ee.clearcoatMap,ne.clearcoatMapTransform)),ee.clearcoatRoughnessMap&&(ne.clearcoatRoughnessMap.value=ee.clearcoatRoughnessMap,d(ee.clearcoatRoughnessMap,ne.clearcoatRoughnessMapTransform)),ee.clearcoatNormalMap&&(ne.clearcoatNormalMap.value=ee.clearcoatNormalMap,d(ee.clearcoatNormalMap,ne.clearcoatNormalMapTransform),ne.clearcoatNormalScale.value.copy(ee.clearcoatNormalScale),ee.side===R&&ne.clearcoatNormalScale.value.negate())),ee.dispersion>0&&(ne.dispersion.value=ee.dispersion),ee.iridescence>0&&(ne.iridescence.value=ee.iridescence,ne.iridescenceIOR.value=ee.iridescenceIOR,ne.iridescenceThicknessMinimum.value=ee.iridescenceThicknessRange[0],ne.iridescenceThicknessMaximum.value=ee.iridescenceThicknessRange[1],ee.iridescenceMap&&(ne.iridescenceMap.value=ee.iridescenceMap,d(ee.iridescenceMap,ne.iridescenceMapTransform)),ee.iridescenceThicknessMap&&(ne.iridescenceThicknessMap.value=ee.iridescenceThicknessMap,d(ee.iridescenceThicknessMap,ne.iridescenceThicknessMapTransform))),ee.transmission>0&&(ne.transmission.value=ee.transmission,ne.transmissionSamplerMap.value=Re.texture,ne.transmissionSamplerSize.value.set(Re.width,Re.height),ee.transmissionMap&&(ne.transmissionMap.value=ee.transmissionMap,d(ee.transmissionMap,ne.transmissionMapTransform)),ne.thickness.value=ee.thickness,ee.thicknessMap&&(ne.thicknessMap.value=ee.thicknessMap,d(ee.thicknessMap,ne.thicknessMapTransform)),ne.attenuationDistance.value=ee.attenuationDistance,ne.attenuationColor.value.copy(ee.attenuationColor)),ee.anisotropy>0&&(ne.anisotropyVector.value.set(ee.anisotropy*Math.cos(ee.anisotropyRotation),ee.anisotropy*Math.sin(ee.anisotropyRotation)),ee.anisotropyMap&&(ne.anisotropyMap.value=ee.anisotropyMap,d(ee.anisotropyMap,ne.anisotropyMapTransform))),ne.specularIntensity.value=ee.specularIntensity,ne.specularColor.value.copy(ee.specularColor),ee.specularColorMap&&(ne.specularColorMap.value=ee.specularColorMap,d(ee.specularColorMap,ne.specularColorMapTransform)),ee.specularIntensityMap&&(ne.specularIntensityMap.value=ee.specularIntensityMap,d(ee.specularIntensityMap,ne.specularIntensityMapTransform))}function ie(ne,ee){ee.matcap&&(ne.matcap.value=ee.matcap)}function oe(ne,ee){const Re=a.get(ee).light;ne.referencePosition.value.setFromMatrixPosition(Re.matrixWorld),ne.nearDistance.value=Re.shadow.camera.near,ne.farDistance.value=Re.shadow.camera.far}return{refreshFogUniforms:A,refreshMaterialUniforms:x}}function _Te(S,a,d,A){let x={},w={},M=[];const L=S.getParameter(S.MAX_UNIFORM_BUFFER_BINDINGS);function O(Re,we){const _e=we.program;A.uniformBlockBinding(Re,_e)}function F(Re,we){let _e=x[Re.id];_e===void 0&&(ie(Re),_e=H(Re),x[Re.id]=_e,Re.addEventListener("dispose",ne));const st=we.program;A.updateUBOMapping(Re,st);const qe=a.render.frame;w[Re.id]!==qe&&(K(Re),w[Re.id]=qe)}function H(Re){const we=J();Re.__bindingPointIndex=we;const _e=S.createBuffer(),st=Re.__size,qe=Re.usage;return S.bindBuffer(S.UNIFORM_BUFFER,_e),S.bufferData(S.UNIFORM_BUFFER,st,qe),S.bindBuffer(S.UNIFORM_BUFFER,null),S.bindBufferBase(S.UNIFORM_BUFFER,we,_e),_e}function J(){for(let Re=0;Re<L;Re++)if(M.indexOf(Re)===-1)return M.push(Re),Re;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function K(Re){const we=x[Re.id],_e=Re.uniforms,st=Re.__cache;S.bindBuffer(S.UNIFORM_BUFFER,we);for(let qe=0,Ze=_e.length;qe<Ze;qe++){const rt=Array.isArray(_e[qe])?_e[qe]:[_e[qe]];for(let je=0,ke=rt.length;je<ke;je++){const nt=rt[je];if(Z(nt,qe,je,st)===!0){const gt=nt.__offset,ft=Array.isArray(nt.value)?nt.value:[nt.value];let It=0;for(let Ft=0;Ft<ft.length;Ft++){const pi=ft[Ft],Ni=oe(pi);typeof pi=="number"||typeof pi=="boolean"?(nt.__data[0]=pi,S.bufferSubData(S.UNIFORM_BUFFER,gt+It,nt.__data)):pi.isMatrix3?(nt.__data[0]=pi.elements[0],nt.__data[1]=pi.elements[1],nt.__data[2]=pi.elements[2],nt.__data[3]=0,nt.__data[4]=pi.elements[3],nt.__data[5]=pi.elements[4],nt.__data[6]=pi.elements[5],nt.__data[7]=0,nt.__data[8]=pi.elements[6],nt.__data[9]=pi.elements[7],nt.__data[10]=pi.elements[8],nt.__data[11]=0):(pi.toArray(nt.__data,It),It+=Ni.storage/Float32Array.BYTES_PER_ELEMENT)}S.bufferSubData(S.UNIFORM_BUFFER,gt,nt.__data)}}}S.bindBuffer(S.UNIFORM_BUFFER,null)}function Z(Re,we,_e,st){const qe=Re.value,Ze=we+"_"+_e;if(st[Ze]===void 0)return typeof qe=="number"||typeof qe=="boolean"?st[Ze]=qe:st[Ze]=qe.clone(),!0;{const rt=st[Ze];if(typeof qe=="number"||typeof qe=="boolean"){if(rt!==qe)return st[Ze]=qe,!0}else if(rt.equals(qe)===!1)return rt.copy(qe),!0}return!1}function ie(Re){const we=Re.uniforms;let _e=0;const st=16;for(let Ze=0,rt=we.length;Ze<rt;Ze++){const je=Array.isArray(we[Ze])?we[Ze]:[we[Ze]];for(let ke=0,nt=je.length;ke<nt;ke++){const gt=je[ke],ft=Array.isArray(gt.value)?gt.value:[gt.value];for(let It=0,Ft=ft.length;It<Ft;It++){const pi=ft[It],Ni=oe(pi),Ut=_e%st;Ut!==0&&st-Ut<Ni.boundary&&(_e+=st-Ut),gt.__data=new Float32Array(Ni.storage/Float32Array.BYTES_PER_ELEMENT),gt.__offset=_e,_e+=Ni.storage}}}const qe=_e%st;return qe>0&&(_e+=st-qe),Re.__size=_e,Re.__cache={},this}function oe(Re){const we={boundary:0,storage:0};return typeof Re=="number"||typeof Re=="boolean"?(we.boundary=4,we.storage=4):Re.isVector2?(we.boundary=8,we.storage=8):Re.isVector3||Re.isColor?(we.boundary=16,we.storage=12):Re.isVector4?(we.boundary=16,we.storage=16):Re.isMatrix3?(we.boundary=48,we.storage=48):Re.isMatrix4?(we.boundary=64,we.storage=64):Re.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",Re),we}function ne(Re){const we=Re.target;we.removeEventListener("dispose",ne);const _e=M.indexOf(we.__bindingPointIndex);M.splice(_e,1),S.deleteBuffer(x[we.id]),delete x[we.id],delete w[we.id]}function ee(){for(const Re in x)S.deleteBuffer(x[Re]);M=[],x={},w={}}return{bind:O,update:F,dispose:ee}}class ETe{constructor(a={}){const{canvas:d=fE(),context:A=null,depth:x=!0,stencil:w=!1,alpha:M=!1,antialias:L=!1,premultipliedAlpha:O=!0,preserveDrawingBuffer:F=!1,powerPreference:H="default",failIfMajorPerformanceCaveat:J=!1,multiviewStereo:K=!1}=a;this.isWebGLRenderer=!0;let Z;if(A!==null){if(typeof WebGLRenderingContext<"u"&&A instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");Z=A.getContextAttributes().alpha}else Z=M;const ie=new Uint32Array(4),oe=new Int32Array(4);let ne=null,ee=null;const Re=[],we=[];this.domElement=d,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Nn,this._useLegacyLights=!1,this.toneMapping=Ot,this.toneMappingExposure=1;const _e=this;let st=!1,qe=0,Ze=0,rt=null,je=-1,ke=null;const nt=new Fn,gt=new Fn;let ft=null;const It=new or(0);let Ft=0,pi=d.width,Ni=d.height,Ut=1,yi=null,Pi=null;const Ur=new Fn(0,0,pi,Ni),xn=new Fn(0,0,pi,Ni);let ts=!1;const ds=new mv;let zn=!1,Bn=!1;const Cr=new fr,hi=new He,Ci={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function qi(){return rt===null?Ut:1}let tt=A;function mi(Ge,wt){return d.getContext(Ge,wt)}try{const Ge={alpha:!0,depth:x,stencil:w,antialias:L,premultipliedAlpha:O,preserveDrawingBuffer:F,powerPreference:H,failIfMajorPerformanceCaveat:J};if("setAttribute"in d&&d.setAttribute("data-engine",`three.js r${h}`),d.addEventListener("webglcontextlost",Ri,!1),d.addEventListener("webglcontextrestored",Mr,!1),d.addEventListener("webglcontextcreationerror",rr,!1),tt===null){const wt="webgl2";if(tt=mi(wt,Ge),tt===null)throw mi(wt)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(Ge){throw console.error("THREE.WebGLRenderer: "+Ge.message),Ge}let ti,er,li,ir,tr,Ar,An,Wr,ha,Ys,Hn,et,Pe,zt,di,gi,oi,Rr,zi,cr,Wn,lr,_r,_n,zr;function ut(){ti=new DCe(tt),ti.init(),_r=new b9(tt,ti),er=new TCe(tt,ti,a,_r),li=new dTe(tt),ir=new OCe(tt),tr=new eTe,Ar=new pTe(tt,ti,li,tr,er,_r,ir),An=new RCe(_e),Wr=new LCe(_e),ha=new Ewe(tt),_n=new CCe(tt,ha),Ys=new NCe(tt,ha,ir,_n),Hn=new UCe(tt,Ys,ha,ir),cr=new kCe(tt,er,Ar),gi=new MCe(tr),et=new $Se(_e,An,Wr,ti,er,_n,gi),Pe=new xTe(_e,tr),zt=new iTe,di=new lTe(ti),zi=new wCe(_e,An,Wr,li,Hn,Z,O),Rr=new FCe(_e,ti,tt),oi=new hTe(_e,Hn,er),zr=new _Te(tt,ir,er,li),Wn=new SCe(tt,ti,ir),lr=new PCe(tt,ti,ir),ir.programs=et.programs,_e.capabilities=er,_e.extensions=ti,_e.properties=tr,_e.renderLists=zt,_e.shadowMap=oi,_e.state=li,_e.info=ir}ut();const vi=typeof navigator<"u"&&"xr"in navigator?new vTe(_e,tt,ti,K):new E9(_e);this.xr=vi,this.getContext=function(){return tt},this.getContextAttributes=function(){return tt.getContextAttributes()},this.forceContextLoss=function(){const Ge=ti.get("WEBGL_lose_context");Ge&&Ge.loseContext()},this.forceContextRestore=function(){const Ge=ti.get("WEBGL_lose_context");Ge&&Ge.restoreContext()},this.getPixelRatio=function(){return Ut},this.setPixelRatio=function(Ge){Ge!==void 0&&(Ut=Ge,this.setSize(pi,Ni,!1))},this.getSize=function(Ge){return Ge.set(pi,Ni)},this.setSize=function(Ge,wt,Gt=!0){if(vi.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}pi=Ge,Ni=wt,d.width=Math.floor(Ge*Ut),d.height=Math.floor(wt*Ut),Gt===!0&&(d.style.width=Ge+"px",d.style.height=wt+"px"),this.setViewport(0,0,Ge,wt)},this.getDrawingBufferSize=function(Ge){return Ge.set(pi*Ut,Ni*Ut).floor()},this.setDrawingBufferSize=function(Ge,wt,Gt){pi=Ge,Ni=wt,Ut=Gt,d.width=Math.floor(Ge*Gt),d.height=Math.floor(wt*Gt),this.setViewport(0,0,Ge,wt)},this.getCurrentViewport=function(Ge){return Ge.copy(nt)},this.getViewport=function(Ge){return Ge.copy(Ur)},this.setViewport=function(Ge,wt,Gt,kt){Ge.isVector4?Ur.set(Ge.x,Ge.y,Ge.z,Ge.w):Ur.set(Ge,wt,Gt,kt),li.viewport(nt.copy(Ur).multiplyScalar(Ut).round())},this.getScissor=function(Ge){return Ge.copy(xn)},this.setScissor=function(Ge,wt,Gt,kt){Ge.isVector4?xn.set(Ge.x,Ge.y,Ge.z,Ge.w):xn.set(Ge,wt,Gt,kt),li.scissor(gt.copy(xn).multiplyScalar(Ut).round())},this.getScissorTest=function(){return ts},this.setScissorTest=function(Ge){li.setScissorTest(ts=Ge)},this.setOpaqueSort=function(Ge){yi=Ge},this.setTransparentSort=function(Ge){Pi=Ge},this.getClearColor=function(Ge){return Ge.copy(zi.getClearColor())},this.setClearColor=function(){zi.setClearColor.apply(zi,arguments)},this.getClearAlpha=function(){return zi.getClearAlpha()},this.setClearAlpha=function(){zi.setClearAlpha.apply(zi,arguments)},this.clear=function(Ge=!0,wt=!0,Gt=!0){let kt=0;if(Ge){let Nt=!1;if(rt!==null){const Hi=rt.texture.format;Nt=Hi===ri||Hi===Bt||Hi===Yt}if(Nt){const Hi=rt.texture.type,Lr=Hi===gn||Hi===ct||Hi===bs||Hi===Di||Hi===Bi||Hi===sr,Br=zi.getClearColor(),Gr=zi.getClearAlpha(),ln=Br.r,Ln=Br.g,Rn=Br.b;Lr?(ie[0]=ln,ie[1]=Ln,ie[2]=Rn,ie[3]=Gr,tt.clearBufferuiv(tt.COLOR,0,ie)):(oe[0]=ln,oe[1]=Ln,oe[2]=Rn,oe[3]=Gr,tt.clearBufferiv(tt.COLOR,0,oe))}else kt|=tt.COLOR_BUFFER_BIT}wt&&(kt|=tt.DEPTH_BUFFER_BIT),Gt&&(kt|=tt.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),tt.clear(kt)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){d.removeEventListener("webglcontextlost",Ri,!1),d.removeEventListener("webglcontextrestored",Mr,!1),d.removeEventListener("webglcontextcreationerror",rr,!1),zt.dispose(),di.dispose(),tr.dispose(),An.dispose(),Wr.dispose(),Hn.dispose(),_n.dispose(),zr.dispose(),et.dispose(),vi.dispose(),vi.removeEventListener("sessionstart",lu),vi.removeEventListener("sessionend",hG),Lf.stop()};function Ri(Ge){Ge.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),st=!0}function Mr(){console.log("THREE.WebGLRenderer: Context Restored."),st=!1;const Ge=ir.autoReset,wt=oi.enabled,Gt=oi.autoUpdate,kt=oi.needsUpdate,Nt=oi.type;ut(),ir.autoReset=Ge,oi.enabled=wt,oi.autoUpdate=Gt,oi.needsUpdate=kt,oi.type=Nt}function rr(Ge){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",Ge.statusMessage)}function on(Ge){const wt=Ge.target;wt.removeEventListener("dispose",on),nr(wt)}function nr(Ge){Ji(Ge),tr.remove(Ge)}function Ji(Ge){const wt=tr.get(Ge).programs;wt!==void 0&&(wt.forEach(function(Gt){et.releaseProgram(Gt)}),Ge.isShaderMaterial&&et.releaseShaderCache(Ge))}this.renderBufferDirect=function(Ge,wt,Gt,kt,Nt,Hi){wt===null&&(wt=Ci);const Lr=Nt.isMesh&&Nt.matrixWorld.determinant()<0,Br=A3e(Ge,wt,Gt,kt,Nt);li.setMaterial(kt,Lr);let Gr=Gt.index,ln=1;if(kt.wireframe===!0){if(Gr=Ys.getWireframeAttribute(Gt),Gr===void 0)return;ln=2}const Ln=Gt.drawRange,Rn=Gt.attributes.position;let _a=Ln.start*ln,il=(Ln.start+Ln.count)*ln;Hi!==null&&(_a=Math.max(_a,Hi.start*ln),il=Math.min(il,(Hi.start+Hi.count)*ln)),Gr!==null?(_a=Math.max(_a,0),il=Math.min(il,Gr.count)):Rn!=null&&(_a=Math.max(_a,0),il=Math.min(il,Rn.count));const ql=il-_a;if(ql<0||ql===1/0)return;_n.setup(Nt,kt,Br,Gt,Gr);let rl,_s=Wn;if(Gr!==null&&(rl=ha.get(Gr),_s=lr,_s.setIndex(rl)),Nt.isMesh)kt.wireframe===!0?(li.setLineWidth(kt.wireframeLinewidth*qi()),_s.setMode(tt.LINES)):_s.setMode(tt.TRIANGLES);else if(Nt.isLine){let Ih=kt.linewidth;Ih===void 0&&(Ih=1),li.setLineWidth(Ih*qi()),Nt.isLineSegments?_s.setMode(tt.LINES):Nt.isLineLoop?_s.setMode(tt.LINE_LOOP):_s.setMode(tt.LINE_STRIP)}else Nt.isPoints?_s.setMode(tt.POINTS):Nt.isSprite&&_s.setMode(tt.TRIANGLES);if(Nt.isBatchedMesh)Nt._multiDrawInstances!==null?_s.renderMultiDrawInstances(Nt._multiDrawStarts,Nt._multiDrawCounts,Nt._multiDrawCount,Nt._multiDrawInstances):_s.renderMultiDraw(Nt._multiDrawStarts,Nt._multiDrawCounts,Nt._multiDrawCount);else if(Nt.isInstancedMesh)_s.renderInstances(_a,ql,Nt.count);else if(Gt.isInstancedBufferGeometry){const Ih=Gt._maxInstanceCount!==void 0?Gt._maxInstanceCount:1/0,wn=Math.min(Gt.instanceCount,Ih);_s.renderInstances(_a,ql,wn)}else _s.render(_a,ql)};function yn(Ge,wt,Gt){Ge.transparent===!0&&Ge.side===B&&Ge.forceSinglePass===!1?(Ge.side=R,Ge.needsUpdate=!0,Ow(Ge,wt,Gt),Ge.side=C,Ge.needsUpdate=!0,Ow(Ge,wt,Gt),Ge.side=B):Ow(Ge,wt,Gt)}this.compile=function(Ge,wt,Gt=null){Gt===null&&(Gt=Ge),ee=di.get(Gt),ee.init(wt),we.push(ee),Gt.traverseVisible(function(Nt){Nt.isLight&&Nt.layers.test(wt.layers)&&(ee.pushLight(Nt),Nt.castShadow&&ee.pushShadow(Nt))}),Ge!==Gt&&Ge.traverseVisible(function(Nt){Nt.isLight&&Nt.layers.test(wt.layers)&&(ee.pushLight(Nt),Nt.castShadow&&ee.pushShadow(Nt))}),ee.setupLights(_e._useLegacyLights);const kt=new Set;return Ge.traverse(function(Nt){const Hi=Nt.material;if(Hi)if(Array.isArray(Hi))for(let Lr=0;Lr<Hi.length;Lr++){const Br=Hi[Lr];yn(Br,Gt,Nt),kt.add(Br)}else yn(Hi,Gt,Nt),kt.add(Hi)}),we.pop(),ee=null,kt},this.compileAsync=function(Ge,wt,Gt=null){const kt=this.compile(Ge,wt,Gt);return new Promise(Nt=>{function Hi(){if(kt.forEach(function(Lr){tr.get(Lr).currentProgram.isReady()&&kt.delete(Lr)}),kt.size===0){Nt(Ge);return}setTimeout(Hi,10)}ti.get("KHR_parallel_shader_compile")!==null?Hi():setTimeout(Hi,10)})};let Ir=null;function Ql(Ge){Ir&&Ir(Ge)}function lu(){Lf.stop()}function hG(){Lf.start()}const Lf=new kB;Lf.setAnimationLoop(Ql),typeof self<"u"&&Lf.setContext(self),this.setAnimationLoop=function(Ge){Ir=Ge,vi.setAnimationLoop(Ge),Ge===null?Lf.stop():Lf.start()},vi.addEventListener("sessionstart",lu),vi.addEventListener("sessionend",hG),this.render=function(Ge,wt){if(wt!==void 0&&wt.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(st===!0)return;Ge.matrixWorldAutoUpdate===!0&&Ge.updateMatrixWorld(),wt.parent===null&&wt.matrixWorldAutoUpdate===!0&&wt.updateMatrixWorld(),vi.enabled===!0&&vi.isPresenting===!0&&(vi.cameraAutoUpdate===!0&&vi.updateCamera(wt),wt=vi.getCamera()),Ge.isScene===!0&&Ge.onBeforeRender(_e,Ge,wt,rt),ee=di.get(Ge,we.length),ee.init(wt),we.push(ee),Cr.multiplyMatrices(wt.projectionMatrix,wt.matrixWorldInverse),ds.setFromProjectionMatrix(Cr),Bn=this.localClippingEnabled,zn=gi.init(this.clippingPlanes,Bn),ne=zt.get(Ge,Re.length),ne.init(),Re.push(ne),dG(Ge,wt,0,_e.sortObjects),ne.finish(),_e.sortObjects===!0&&ne.sort(yi,Pi);const Gt=vi.enabled===!1||vi.isPresenting===!1||vi.hasDepthSensing()===!1;Gt&&zi.addToRenderList(ne,Ge),this.info.render.frame++,zn===!0&&gi.beginShadows();const kt=ee.state.shadowsArray;oi.render(kt,Ge,wt),zn===!0&&gi.endShadows(),this.info.autoReset===!0&&this.info.reset();const Nt=ne.opaque,Hi=ne.transmissive;if(ee.setupLights(_e._useLegacyLights),wt.isArrayCamera){const Lr=wt.cameras;if(Hi.length>0)for(let Br=0,Gr=Lr.length;Br<Gr;Br++){const ln=Lr[Br];pG(Nt,Hi,Ge,ln)}if(Gt&&zi.render(Ge),vi.enabled&&vi.isMultiview)Ar.setDeferTextureUploads(!0),kL(ne,Ge,wt,wt.cameras[0].viewport);else for(let Br=0,Gr=Lr.length;Br<Gr;Br++){const ln=Lr[Br];kL(ne,Ge,ln,ln.viewport)}}else Hi.length>0&&pG(Nt,Hi,Ge,wt),Gt&&zi.render(Ge),kL(ne,Ge,wt);rt!==null&&(Ar.updateMultisampleRenderTarget(rt),Ar.updateRenderTargetMipmap(rt)),Ge.isScene===!0&&Ge.onAfterRender(_e,Ge,wt),Ar.runDeferredUploads(),vi.enabled&&vi.submitFrame&&vi.submitFrame(),_n.resetDefaultState(),je=-1,ke=null,we.pop(),we.length>0?(ee=we[we.length-1],zn===!0&&gi.setGlobalState(_e.clippingPlanes,ee.state.camera)):ee=null,Re.pop(),Re.length>0?ne=Re[Re.length-1]:ne=null};function dG(Ge,wt,Gt,kt){if(Ge.visible===!1)return;if(Ge.layers.test(wt.layers)){if(Ge.isGroup)Gt=Ge.renderOrder;else if(Ge.isLOD)Ge.autoUpdate===!0&&Ge.update(wt);else if(Ge.isLight)ee.pushLight(Ge),Ge.castShadow&&ee.pushShadow(Ge);else if(Ge.isSprite){if(!Ge.frustumCulled||ds.intersectsSprite(Ge)){kt&&hi.setFromMatrixPosition(Ge.matrixWorld).applyMatrix4(Cr);const Hi=Hn.update(Ge),Lr=Ge.material;Lr.visible&&ne.push(Ge,Hi,Lr,Gt,hi.z,null)}}else if((Ge.isMesh||Ge.isLine||Ge.isPoints)&&(!Ge.frustumCulled||ds.intersectsObject(Ge))){const Hi=Hn.update(Ge),Lr=Ge.material;if(kt&&(Ge.boundingSphere!==void 0?(Ge.boundingSphere===null&&Ge.computeBoundingSphere(),hi.copy(Ge.boundingSphere.center)):(Hi.boundingSphere===null&&Hi.computeBoundingSphere(),hi.copy(Hi.boundingSphere.center)),hi.applyMatrix4(Ge.matrixWorld).applyMatrix4(Cr)),Array.isArray(Lr)){const Br=Hi.groups;for(let Gr=0,ln=Br.length;Gr<ln;Gr++){const Ln=Br[Gr],Rn=Lr[Ln.materialIndex];Rn&&Rn.visible&&ne.push(Ge,Hi,Rn,Gt,hi.z,Ln)}}else Lr.visible&&ne.push(Ge,Hi,Lr,Gt,hi.z,null)}}const Nt=Ge.children;for(let Hi=0,Lr=Nt.length;Hi<Lr;Hi++)dG(Nt[Hi],wt,Gt,kt)}function kL(Ge,wt,Gt,kt){const Nt=Ge.opaque,Hi=Ge.transmissive,Lr=Ge.transparent;ee.setupLightsView(Gt),zn===!0&&gi.setGlobalState(_e.clippingPlanes,Gt),kt&&li.viewport(nt.copy(kt)),Nt.length>0&&Pw(Nt,wt,Gt),Hi.length>0&&Pw(Hi,wt,Gt),Lr.length>0&&Pw(Lr,wt,Gt),li.buffers.depth.setTest(!0),li.buffers.depth.setMask(!0),li.buffers.color.setMask(!0),li.setPolygonOffset(!1)}function pG(Ge,wt,Gt,kt){if((Gt.isScene===!0?Gt.overrideMaterial:null)!==null)return;ee.state.transmissionRenderTarget[kt.id]===void 0&&(ee.state.transmissionRenderTarget[kt.id]=new Jo(1,1,{generateMipmaps:!0,type:ti.has("EXT_color_buffer_half_float")||ti.has("EXT_color_buffer_float")?Kt:gn,minFilter:rn,samples:4,stencilBuffer:w,resolveDepthBuffer:!1,resolveStencilBuffer:!1}));const Nt=ee.state.transmissionRenderTarget[kt.id],Hi=kt.viewport||nt;Nt.setSize(Hi.z,Hi.w);const Lr=_e.getRenderTarget();_e.setRenderTarget(Nt),_e.getClearColor(It),Ft=_e.getClearAlpha(),Ft<1&&_e.setClearColor(16777215,.5),_e.clear();const Br=_e.toneMapping;_e.toneMapping=Ot;const Gr=kt.viewport;if(kt.viewport!==void 0&&(kt.viewport=void 0),ee.setupLightsView(kt),zn===!0&&gi.setGlobalState(_e.clippingPlanes,kt),Pw(Ge,Gt,kt),Ar.updateMultisampleRenderTarget(Nt),Ar.updateRenderTargetMipmap(Nt),ti.has("WEBGL_multisampled_render_to_texture")===!1){let ln=!1;for(let Ln=0,Rn=wt.length;Ln<Rn;Ln++){const _a=wt[Ln],il=_a.object,ql=_a.geometry,rl=_a.material,_s=_a.group;if(rl.side===B&&il.layers.test(kt.layers)){const Ih=rl.side;rl.side=R,rl.needsUpdate=!0,fG(il,Gt,kt,ql,rl,_s),rl.side=Ih,rl.needsUpdate=!0,ln=!0}}ln===!0&&(Ar.updateMultisampleRenderTarget(Nt),Ar.updateRenderTargetMipmap(Nt))}_e.setRenderTarget(Lr),_e.setClearColor(It,Ft),Gr!==void 0&&(kt.viewport=Gr),_e.toneMapping=Br}function Pw(Ge,wt,Gt){const kt=wt.isScene===!0?wt.overrideMaterial:null;for(let Nt=0,Hi=Ge.length;Nt<Hi;Nt++){const Lr=Ge[Nt],Br=Lr.object,Gr=Lr.geometry,ln=kt===null?Lr.material:kt,Ln=Lr.group;Br.layers.test(Gt.layers)&&fG(Br,wt,Gt,Gr,ln,Ln)}}function fG(Ge,wt,Gt,kt,Nt,Hi){Ge.onBeforeRender(_e,wt,Gt,kt,Nt,Hi),Ge.modelViewMatrix.multiplyMatrices(Gt.matrixWorldInverse,Ge.matrixWorld),Ge.normalMatrix.getNormalMatrix(Ge.modelViewMatrix),Nt.onBeforeRender(_e,wt,Gt,kt,Ge,Hi),Nt.transparent===!0&&Nt.side===B&&Nt.forceSinglePass===!1?(Nt.side=R,Nt.needsUpdate=!0,_e.renderBufferDirect(Gt,wt,kt,Nt,Ge,Hi),Nt.side=C,Nt.needsUpdate=!0,_e.renderBufferDirect(Gt,wt,kt,Nt,Ge,Hi),Nt.side=B):_e.renderBufferDirect(Gt,wt,kt,Nt,Ge,Hi),Ge.onAfterRender(_e,wt,Gt,kt,Nt,Hi)}function Ow(Ge,wt,Gt){wt.isScene!==!0&&(wt=Ci);const kt=tr.get(Ge),Nt=ee.state.lights,Hi=ee.state.shadowsArray,Lr=Nt.state.version,Br=et.getParameters(Ge,Nt.state,Hi,wt,Gt),Gr=et.getProgramCacheKey(Br);let ln=kt.programs;kt.environment=Ge.isMeshStandardMaterial?wt.environment:null,kt.fog=wt.fog,kt.envMap=(Ge.isMeshStandardMaterial?Wr:An).get(Ge.envMap||kt.environment),kt.envMapRotation=kt.environment!==null&&Ge.envMap===null?wt.environmentRotation:Ge.envMapRotation,ln===void 0&&(Ge.addEventListener("dispose",on),ln=new Map,kt.programs=ln);let Ln=ln.get(Gr);if(Ln!==void 0){if(kt.currentProgram===Ln&&kt.lightsStateVersion===Lr)return gG(Ge,Br),Ln}else Br.uniforms=et.getUniforms(Ge),Ge.onBuild(Gt,Br,_e),Ge.onBeforeCompile(Br,_e),Ln=et.acquireProgram(Br,Gr),ln.set(Gr,Ln),kt.uniforms=Br.uniforms;const Rn=kt.uniforms;return(!Ge.isShaderMaterial&&!Ge.isRawShaderMaterial||Ge.clipping===!0)&&(Rn.clippingPlanes=gi.uniform),gG(Ge,Br),kt.needsLights=v3e(Ge),kt.lightsStateVersion=Lr,kt.needsLights&&(Rn.ambientLightColor.value=Nt.state.ambient,Rn.lightProbe.value=Nt.state.probe,Rn.directionalLights.value=Nt.state.directional,Rn.directionalLightShadows.value=Nt.state.directionalShadow,Rn.spotLights.value=Nt.state.spot,Rn.spotLightShadows.value=Nt.state.spotShadow,Rn.rectAreaLights.value=Nt.state.rectArea,Rn.ltc_1.value=Nt.state.rectAreaLTC1,Rn.ltc_2.value=Nt.state.rectAreaLTC2,Rn.pointLights.value=Nt.state.point,Rn.pointLightShadows.value=Nt.state.pointShadow,Rn.hemisphereLights.value=Nt.state.hemi,Rn.directionalShadowMap.value=Nt.state.directionalShadowMap,Rn.directionalShadowMatrix.value=Nt.state.directionalShadowMatrix,Rn.spotShadowMap.value=Nt.state.spotShadowMap,Rn.spotLightMatrix.value=Nt.state.spotLightMatrix,Rn.spotLightMap.value=Nt.state.spotLightMap,Rn.pointShadowMap.value=Nt.state.pointShadowMap,Rn.pointShadowMatrix.value=Nt.state.pointShadowMatrix),kt.currentProgram=Ln,kt.uniformsList=null,Ln}function mG(Ge){if(Ge.uniformsList===null){const wt=Ge.currentProgram.getUniforms();Ge.uniformsList=zE.seqWithValue(wt.seq,Ge.uniforms)}return Ge.uniformsList}function gG(Ge,wt){const Gt=tr.get(Ge);Gt.outputColorSpace=wt.outputColorSpace,Gt.batching=wt.batching,Gt.instancing=wt.instancing,Gt.instancingColor=wt.instancingColor,Gt.instancingMorph=wt.instancingMorph,Gt.skinning=wt.skinning,Gt.morphTargets=wt.morphTargets,Gt.morphNormals=wt.morphNormals,Gt.morphColors=wt.morphColors,Gt.morphTargetsCount=wt.morphTargetsCount,Gt.numClippingPlanes=wt.numClippingPlanes,Gt.numIntersection=wt.numClipIntersection,Gt.vertexAlphas=wt.vertexAlphas,Gt.vertexTangents=wt.vertexTangents,Gt.toneMapping=wt.toneMapping,Gt.numMultiviewViews=wt.numMultiviewViews}function A3e(Ge,wt,Gt,kt,Nt){wt.isScene!==!0&&(wt=Ci),Ar.resetTextureUnits();const Hi=wt.fog,Lr=kt.isMeshStandardMaterial?wt.environment:null,Br=rt===null?_e.outputColorSpace:rt.isXRRenderTarget===!0?rt.texture.colorSpace:Rc,Gr=(kt.isMeshStandardMaterial?Wr:An).get(kt.envMap||Lr),ln=kt.vertexColors===!0&&!!Gt.attributes.color&&Gt.attributes.color.itemSize===4,Ln=!!Gt.attributes.tangent&&(!!kt.normalMap||kt.anisotropy>0),Rn=!!Gt.morphAttributes.position,_a=!!Gt.morphAttributes.normal,il=!!Gt.morphAttributes.color;let ql=Ot;kt.toneMapped&&(rt===null||rt.isXRRenderTarget===!0)&&(ql=_e.toneMapping);const rl=rt&&rt.isWebGLMultiviewRenderTarget?rt.numViews:0,_s=Gt.morphAttributes.position||Gt.morphAttributes.normal||Gt.morphAttributes.color,Ih=_s!==void 0?_s.length:0,wn=tr.get(kt),b3e=ee.state.lights;if(zn===!0&&(Bn===!0||Ge!==ke)){const Xl=Ge===ke&&kt.id===je;gi.setState(kt,Ge,Xl)}let FL=!1;kt.version===wn.__version?(wn.needsLights&&wn.lightsStateVersion!==b3e.state.version||wn.outputColorSpace!==Br||Nt.isBatchedMesh&&wn.batching===!1||!Nt.isBatchedMesh&&wn.batching===!0||Nt.isInstancedMesh&&wn.instancing===!1||!Nt.isInstancedMesh&&wn.instancing===!0||Nt.isSkinnedMesh&&wn.skinning===!1||!Nt.isSkinnedMesh&&wn.skinning===!0||Nt.isInstancedMesh&&wn.instancingColor===!0&&Nt.instanceColor===null||Nt.isInstancedMesh&&wn.instancingColor===!1&&Nt.instanceColor!==null||Nt.isInstancedMesh&&wn.instancingMorph===!0&&Nt.morphTexture===null||Nt.isInstancedMesh&&wn.instancingMorph===!1&&Nt.morphTexture!==null||wn.envMap!==Gr||kt.fog===!0&&wn.fog!==Hi||wn.numClippingPlanes!==void 0&&(wn.numClippingPlanes!==gi.numPlanes||wn.numIntersection!==gi.numIntersection)||wn.vertexAlphas!==ln||wn.vertexTangents!==Ln||wn.morphTargets!==Rn||wn.morphNormals!==_a||wn.morphColors!==il||wn.toneMapping!==ql||wn.morphTargetsCount!==Ih||wn.numMultiviewViews!==rl)&&(FL=!0):(FL=!0,wn.__version=kt.version);let Bh=wn.currentProgram;FL===!0&&(Bh=Ow(kt,wt,Nt));let AG=!1,Uv=!1,UL=!1;const Ea=Bh.getUniforms(),qd=wn.uniforms;if(li.useProgram(Bh.program)&&(AG=!0,Uv=!0,UL=!0),kt.id!==je&&(je=kt.id,Uv=!0),AG||ke!==Ge){Bh.numMultiviewViews>0?(Rr.updateCameraProjectionMatricesUniform(Ge,Ea),Rr.updateCameraViewMatricesUniform(Ge,Ea)):(Ea.setValue(tt,"projectionMatrix",Ge.projectionMatrix),Ea.setValue(tt,"viewMatrix",Ge.matrixWorldInverse));const Xl=Ea.map.cameraPosition;Xl!==void 0&&Xl.setValue(tt,hi.setFromMatrixPosition(Ge.matrixWorld)),er.logarithmicDepthBuffer&&Ea.setValue(tt,"logDepthBufFC",2/(Math.log(Ge.far+1)/Math.LN2)),(kt.isMeshPhongMaterial||kt.isMeshToonMaterial||kt.isMeshLambertMaterial||kt.isMeshBasicMaterial||kt.isMeshStandardMaterial||kt.isShaderMaterial)&&Ea.setValue(tt,"isOrthographic",Ge.isOrthographicCamera===!0),ke!==Ge&&(ke=Ge,Uv=!0,UL=!0)}if(Nt.isSkinnedMesh){Ea.setOptional(tt,Nt,"bindMatrix"),Ea.setOptional(tt,Nt,"bindMatrixInverse");const Xl=Nt.skeleton;Xl&&(Xl.boneTexture===null&&Xl.computeBoneTexture(),Ea.setValue(tt,"boneTexture",Xl.boneTexture,Ar))}Nt.isBatchedMesh&&(Ea.setOptional(tt,Nt,"batchingTexture"),Ea.setValue(tt,"batchingTexture",Nt._matricesTexture,Ar));const zL=Gt.morphAttributes;if((zL.position!==void 0||zL.normal!==void 0||zL.color!==void 0)&&cr.update(Nt,Gt,Bh),(Uv||wn.receiveShadow!==Nt.receiveShadow)&&(wn.receiveShadow=Nt.receiveShadow,Ea.setValue(tt,"receiveShadow",Nt.receiveShadow)),kt.isMeshGouraudMaterial&&kt.envMap!==null&&(qd.envMap.value=Gr,qd.flipEnvMap.value=Gr.isCubeTexture&&Gr.isRenderTargetTexture===!1?-1:1),kt.isMeshStandardMaterial&&kt.envMap===null&&wt.environment!==null&&(qd.envMapIntensity.value=wt.environmentIntensity),Uv&&(Ea.setValue(tt,"toneMappingExposure",_e.toneMappingExposure),wn.needsLights&&y3e(qd,UL),Hi&&kt.fog===!0&&Pe.refreshFogUniforms(qd,Hi),Pe.refreshMaterialUniforms(qd,kt,Ut,Ni,ee.state.transmissionRenderTarget[Ge.id]),zE.upload(tt,mG(wn),qd,Ar)),kt.isShaderMaterial&&kt.uniformsNeedUpdate===!0&&(zE.upload(tt,mG(wn),qd,Ar),kt.uniformsNeedUpdate=!1),kt.isSpriteMaterial&&Ea.setValue(tt,"center",Nt.center),Bh.numMultiviewViews>0?Rr.updateObjectMatricesUniforms(Nt,Ge,Ea):(Ea.setValue(tt,"modelViewMatrix",Nt.modelViewMatrix),Ea.setValue(tt,"normalMatrix",Nt.normalMatrix)),Ea.setValue(tt,"modelMatrix",Nt.matrixWorld),kt.isShaderMaterial||kt.isRawShaderMaterial){const Xl=kt.uniformsGroups;for(let jL=0,x3e=Xl.length;jL<x3e;jL++){const yG=Xl[jL];zr.update(yG,Bh),zr.bind(yG,Bh)}}return Bh}function y3e(Ge,wt){Ge.ambientLightColor.needsUpdate=wt,Ge.lightProbe.needsUpdate=wt,Ge.directionalLights.needsUpdate=wt,Ge.directionalLightShadows.needsUpdate=wt,Ge.pointLights.needsUpdate=wt,Ge.pointLightShadows.needsUpdate=wt,Ge.spotLights.needsUpdate=wt,Ge.spotLightShadows.needsUpdate=wt,Ge.rectAreaLights.needsUpdate=wt,Ge.hemisphereLights.needsUpdate=wt}function v3e(Ge){return Ge.isMeshLambertMaterial||Ge.isMeshToonMaterial||Ge.isMeshPhongMaterial||Ge.isMeshStandardMaterial||Ge.isShadowMaterial||Ge.isShaderMaterial&&Ge.lights===!0}this.setTexture2D=function(){var Ge=!1;return function(wt,Gt){wt&&wt.isWebGLRenderTarget&&(Ge||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),Ge=!0),wt=wt.texture),Ar.setTexture2D(wt,Gt)}}(),this.getActiveCubeFace=function(){return qe},this.getActiveMipmapLevel=function(){return Ze},this.getRenderTarget=function(){return rt},this.setRenderTargetTextures=function(Ge,wt,Gt){tr.get(Ge.texture).__webglTexture=wt,tr.get(Ge.depthTexture).__webglTexture=Gt;const kt=tr.get(Ge);kt.__hasExternalTextures=!0,kt.__autoAllocateDepthBuffer=Gt===void 0,!kt.__autoAllocateDepthBuffer&&(!rt||!rt.isWebGLMultiviewRenderTarget)&&ti.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),kt.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(Ge,wt){const Gt=tr.get(Ge);Gt.__webglFramebuffer=wt,Gt.__useDefaultFramebuffer=wt===void 0},this.setRenderTarget=function(Ge,wt=0,Gt=0){rt=Ge,qe=wt,Ze=Gt;let kt=!0,Nt=null,Hi=!1,Lr=!1;if(Ge){const Br=tr.get(Ge);Br.__useDefaultFramebuffer!==void 0?(li.bindFramebuffer(tt.FRAMEBUFFER,null),kt=!1):Br.__webglFramebuffer===void 0?Ar.setupRenderTarget(Ge):Br.__hasExternalTextures&&Ar.rebindTextures(Ge,tr.get(Ge.texture).__webglTexture,tr.get(Ge.depthTexture).__webglTexture);const Gr=Ge.texture;(Gr.isData3DTexture||Gr.isDataArrayTexture||Gr.isCompressedArrayTexture)&&(Lr=!0);const ln=tr.get(Ge).__webglFramebuffer;Ge.isWebGLCubeRenderTarget?(Array.isArray(ln[wt])?Nt=ln[wt][Gt]:Nt=ln[wt],Hi=!0):Ge.samples>0&&Ar.useMultisampledRTT(Ge)===!1?Nt=tr.get(Ge).__webglMultisampledFramebuffer:Array.isArray(ln)?Nt=ln[Gt]:Nt=ln,nt.copy(Ge.viewport),gt.copy(Ge.scissor),ft=Ge.scissorTest}else nt.copy(Ur).multiplyScalar(Ut).floor(),gt.copy(xn).multiplyScalar(Ut).floor(),ft=ts;if(li.bindFramebuffer(tt.FRAMEBUFFER,Nt)&&kt&&li.drawBuffers(Ge,Nt),li.viewport(nt),li.scissor(gt),li.setScissorTest(ft),Hi){const Br=tr.get(Ge.texture);tt.framebufferTexture2D(tt.FRAMEBUFFER,tt.COLOR_ATTACHMENT0,tt.TEXTURE_CUBE_MAP_POSITIVE_X+wt,Br.__webglTexture,Gt)}else if(Lr){const Br=tr.get(Ge.texture),Gr=wt||0;tt.framebufferTextureLayer(tt.FRAMEBUFFER,tt.COLOR_ATTACHMENT0,Br.__webglTexture,Gt||0,Gr)}je=-1},this.readRenderTargetPixels=function(Ge,wt,Gt,kt,Nt,Hi,Lr){if(!(Ge&&Ge.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Br=tr.get(Ge).__webglFramebuffer;if(Ge.isWebGLCubeRenderTarget&&Lr!==void 0&&(Br=Br[Lr]),Br){li.bindFramebuffer(tt.FRAMEBUFFER,Br);try{const Gr=Ge.texture,ln=Gr.format,Ln=Gr.type;if(!er.textureFormatReadable(ln)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!er.textureTypeReadable(Ln)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}wt>=0&&wt<=Ge.width-kt&&Gt>=0&&Gt<=Ge.height-Nt&&tt.readPixels(wt,Gt,kt,Nt,_r.convert(ln),_r.convert(Ln),Hi)}finally{const Gr=rt!==null?tr.get(rt).__webglFramebuffer:null;li.bindFramebuffer(tt.FRAMEBUFFER,Gr)}}},this.copyFramebufferToTexture=function(Ge,wt,Gt=0){const kt=Math.pow(2,-Gt),Nt=Math.floor(wt.image.width*kt),Hi=Math.floor(wt.image.height*kt);Ar.setTexture2D(wt,0),tt.copyTexSubImage2D(tt.TEXTURE_2D,Gt,0,0,Ge.x,Ge.y,Nt,Hi),li.unbindTexture()},this.copyTextureToTexture=function(Ge,wt,Gt,kt=0){const Nt=wt.image.width,Hi=wt.image.height,Lr=_r.convert(Gt.format),Br=_r.convert(Gt.type);Ar.setTexture2D(Gt,0),tt.pixelStorei(tt.UNPACK_FLIP_Y_WEBGL,Gt.flipY),tt.pixelStorei(tt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Gt.premultiplyAlpha),tt.pixelStorei(tt.UNPACK_ALIGNMENT,Gt.unpackAlignment),wt.isDataTexture?tt.texSubImage2D(tt.TEXTURE_2D,kt,Ge.x,Ge.y,Nt,Hi,Lr,Br,wt.image.data):wt.isCompressedTexture?tt.compressedTexSubImage2D(tt.TEXTURE_2D,kt,Ge.x,Ge.y,wt.mipmaps[0].width,wt.mipmaps[0].height,Lr,wt.mipmaps[0].data):tt.texSubImage2D(tt.TEXTURE_2D,kt,Ge.x,Ge.y,Lr,Br,wt.image),kt===0&&Gt.generateMipmaps&&tt.generateMipmap(tt.TEXTURE_2D),li.unbindTexture()},this.copyTextureToTexture3D=function(Ge,wt,Gt,kt,Nt=0){const Hi=Ge.max.x-Ge.min.x,Lr=Ge.max.y-Ge.min.y,Br=Ge.max.z-Ge.min.z,Gr=_r.convert(kt.format),ln=_r.convert(kt.type);let Ln;if(kt.isData3DTexture)Ar.setTexture3D(kt,0),Ln=tt.TEXTURE_3D;else if(kt.isDataArrayTexture||kt.isCompressedArrayTexture)Ar.setTexture2DArray(kt,0),Ln=tt.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}tt.pixelStorei(tt.UNPACK_FLIP_Y_WEBGL,kt.flipY),tt.pixelStorei(tt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,kt.premultiplyAlpha),tt.pixelStorei(tt.UNPACK_ALIGNMENT,kt.unpackAlignment);const Rn=tt.getParameter(tt.UNPACK_ROW_LENGTH),_a=tt.getParameter(tt.UNPACK_IMAGE_HEIGHT),il=tt.getParameter(tt.UNPACK_SKIP_PIXELS),ql=tt.getParameter(tt.UNPACK_SKIP_ROWS),rl=tt.getParameter(tt.UNPACK_SKIP_IMAGES),_s=Gt.isCompressedTexture?Gt.mipmaps[Nt]:Gt.image;tt.pixelStorei(tt.UNPACK_ROW_LENGTH,_s.width),tt.pixelStorei(tt.UNPACK_IMAGE_HEIGHT,_s.height),tt.pixelStorei(tt.UNPACK_SKIP_PIXELS,Ge.min.x),tt.pixelStorei(tt.UNPACK_SKIP_ROWS,Ge.min.y),tt.pixelStorei(tt.UNPACK_SKIP_IMAGES,Ge.min.z),Gt.isDataTexture||Gt.isData3DTexture?tt.texSubImage3D(Ln,Nt,wt.x,wt.y,wt.z,Hi,Lr,Br,Gr,ln,_s.data):kt.isCompressedArrayTexture?tt.compressedTexSubImage3D(Ln,Nt,wt.x,wt.y,wt.z,Hi,Lr,Br,Gr,_s.data):tt.texSubImage3D(Ln,Nt,wt.x,wt.y,wt.z,Hi,Lr,Br,Gr,ln,_s),tt.pixelStorei(tt.UNPACK_ROW_LENGTH,Rn),tt.pixelStorei(tt.UNPACK_IMAGE_HEIGHT,_a),tt.pixelStorei(tt.UNPACK_SKIP_PIXELS,il),tt.pixelStorei(tt.UNPACK_SKIP_ROWS,ql),tt.pixelStorei(tt.UNPACK_SKIP_IMAGES,rl),Nt===0&&kt.generateMipmaps&&tt.generateMipmap(Ln),li.unbindTexture()},this.initTexture=function(Ge){Ge.isCubeTexture?Ar.setTextureCube(Ge,0):Ge.isData3DTexture?Ar.setTexture3D(Ge,0):Ge.isDataArrayTexture||Ge.isCompressedArrayTexture?Ar.setTexture2DArray(Ge,0):Ar.setTexture2D(Ge,0),li.unbindTexture()},this.resetState=function(){qe=0,Ze=0,rt=null,li.reset(),_n.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Gl}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(a){this._outputColorSpace=a;const d=this.getContext();d.drawingBufferColorSpace=a===Xg?"display-p3":"srgb",d.unpackColorSpace=Yn.workingColorSpace===nf?"display-p3":"srgb"}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(a){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=a}}class jE{constructor(a,d=25e-5){this.isFogExp2=!0,this.name="",this.color=new or(a),this.density=d}clone(){return new jE(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class VE{constructor(a,d=1,A=1e3){this.isFog=!0,this.name="",this.color=new or(a),this.near=d,this.far=A}clone(){return new VE(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class C9 extends Gn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Tl,this.environmentIntensity=1,this.environmentRotation=new Tl,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(a,d){return super.copy(a,d),a.background!==null&&(this.background=a.background.clone()),a.environment!==null&&(this.environment=a.environment.clone()),a.fog!==null&&(this.fog=a.fog.clone()),this.backgroundBlurriness=a.backgroundBlurriness,this.backgroundIntensity=a.backgroundIntensity,this.backgroundRotation.copy(a.backgroundRotation),this.environmentIntensity=a.environmentIntensity,this.environmentRotation.copy(a.environmentRotation),a.overrideMaterial!==null&&(this.overrideMaterial=a.overrideMaterial.clone()),this.matrixAutoUpdate=a.matrixAutoUpdate,this}toJSON(a){const d=super.toJSON(a);return this.fog!==null&&(d.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(d.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(d.object.backgroundIntensity=this.backgroundIntensity),d.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(d.object.environmentIntensity=this.environmentIntensity),d.object.environmentRotation=this.environmentRotation.toArray(),d}}class GE{constructor(a,d){this.isInterleavedBuffer=!0,this.array=a,this.stride=d,this.count=a!==void 0?a.length/d:0,this.usage=lf,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=Ro()}onUploadCallback(){}set needsUpdate(a){a===!0&&this.version++}get updateRange(){return gE("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(a){return this.usage=a,this}addUpdateRange(a,d){this.updateRanges.push({start:a,count:d})}clearUpdateRanges(){this.updateRanges.length=0}copy(a){return this.array=new a.array.constructor(a.array),this.count=a.count,this.stride=a.stride,this.usage=a.usage,this}copyAt(a,d,A){a*=this.stride,A*=d.stride;for(let x=0,w=this.stride;x<w;x++)this.array[a+x]=d.array[A+x];return this}set(a,d=0){return this.array.set(a,d),this}clone(a){a.arrayBuffers===void 0&&(a.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ro()),a.arrayBuffers[this.array.buffer._uuid]===void 0&&(a.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const d=new this.array.constructor(a.arrayBuffers[this.array.buffer._uuid]),A=new this.constructor(d,this.stride);return A.setUsage(this.usage),A}onUpload(a){return this.onUploadCallback=a,this}toJSON(a){return a.arrayBuffers===void 0&&(a.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ro()),a.arrayBuffers[this.array.buffer._uuid]===void 0&&(a.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Lo=new He;class bf{constructor(a,d,A,x=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=a,this.itemSize=d,this.offset=A,this.normalized=x}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(a){this.data.needsUpdate=a}applyMatrix4(a){for(let d=0,A=this.data.count;d<A;d++)Lo.fromBufferAttribute(this,d),Lo.applyMatrix4(a),this.setXYZ(d,Lo.x,Lo.y,Lo.z);return this}applyNormalMatrix(a){for(let d=0,A=this.count;d<A;d++)Lo.fromBufferAttribute(this,d),Lo.applyNormalMatrix(a),this.setXYZ(d,Lo.x,Lo.y,Lo.z);return this}transformDirection(a){for(let d=0,A=this.count;d<A;d++)Lo.fromBufferAttribute(this,d),Lo.transformDirection(a),this.setXYZ(d,Lo.x,Lo.y,Lo.z);return this}getComponent(a,d){let A=this.array[a*this.data.stride+this.offset+d];return this.normalized&&(A=Qa(A,this.array)),A}setComponent(a,d,A){return this.normalized&&(A=Kr(A,this.array)),this.data.array[a*this.data.stride+this.offset+d]=A,this}setX(a,d){return this.normalized&&(d=Kr(d,this.array)),this.data.array[a*this.data.stride+this.offset]=d,this}setY(a,d){return this.normalized&&(d=Kr(d,this.array)),this.data.array[a*this.data.stride+this.offset+1]=d,this}setZ(a,d){return this.normalized&&(d=Kr(d,this.array)),this.data.array[a*this.data.stride+this.offset+2]=d,this}setW(a,d){return this.normalized&&(d=Kr(d,this.array)),this.data.array[a*this.data.stride+this.offset+3]=d,this}getX(a){let d=this.data.array[a*this.data.stride+this.offset];return this.normalized&&(d=Qa(d,this.array)),d}getY(a){let d=this.data.array[a*this.data.stride+this.offset+1];return this.normalized&&(d=Qa(d,this.array)),d}getZ(a){let d=this.data.array[a*this.data.stride+this.offset+2];return this.normalized&&(d=Qa(d,this.array)),d}getW(a){let d=this.data.array[a*this.data.stride+this.offset+3];return this.normalized&&(d=Qa(d,this.array)),d}setXY(a,d,A){return a=a*this.data.stride+this.offset,this.normalized&&(d=Kr(d,this.array),A=Kr(A,this.array)),this.data.array[a+0]=d,this.data.array[a+1]=A,this}setXYZ(a,d,A,x){return a=a*this.data.stride+this.offset,this.normalized&&(d=Kr(d,this.array),A=Kr(A,this.array),x=Kr(x,this.array)),this.data.array[a+0]=d,this.data.array[a+1]=A,this.data.array[a+2]=x,this}setXYZW(a,d,A,x,w){return a=a*this.data.stride+this.offset,this.normalized&&(d=Kr(d,this.array),A=Kr(A,this.array),x=Kr(x,this.array),w=Kr(w,this.array)),this.data.array[a+0]=d,this.data.array[a+1]=A,this.data.array[a+2]=x,this.data.array[a+3]=w,this}clone(a){if(a===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const d=[];for(let A=0;A<this.count;A++){const x=A*this.data.stride+this.offset;for(let w=0;w<this.itemSize;w++)d.push(this.data.array[x+w])}return new ss(new this.array.constructor(d),this.itemSize,this.normalized)}else return a.interleavedBuffers===void 0&&(a.interleavedBuffers={}),a.interleavedBuffers[this.data.uuid]===void 0&&(a.interleavedBuffers[this.data.uuid]=this.data.clone(a)),new bf(a.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(a){if(a===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const d=[];for(let A=0;A<this.count;A++){const x=A*this.data.stride+this.offset;for(let w=0;w<this.itemSize;w++)d.push(this.data.array[x+w])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:d,normalized:this.normalized}}else return a.interleavedBuffers===void 0&&(a.interleavedBuffers={}),a.interleavedBuffers[this.data.uuid]===void 0&&(a.interleavedBuffers[this.data.uuid]=this.data.toJSON(a)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class ZB extends co{constructor(a){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new or(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.map=a.map,this.alphaMap=a.alphaMap,this.rotation=a.rotation,this.sizeAttenuation=a.sizeAttenuation,this.fog=a.fog,this}}let y0;const Av=new He,v0=new He,b0=new He,x0=new ai,yv=new ai,S9=new fr,HE=new He,vv=new He,WE=new He,T9=new ai,$B=new ai,M9=new ai;class R9 extends Gn{constructor(a=new ZB){if(super(),this.isSprite=!0,this.type="Sprite",y0===void 0){y0=new dn;const d=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),A=new GE(d,5);y0.setIndex([0,1,2,0,2,3]),y0.setAttribute("position",new bf(A,3,0,!1)),y0.setAttribute("uv",new bf(A,2,3,!1))}this.geometry=y0,this.material=a,this.center=new ai(.5,.5)}raycast(a,d){a.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),v0.setFromMatrixScale(this.matrixWorld),S9.copy(a.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(a.camera.matrixWorldInverse,this.matrixWorld),b0.setFromMatrixPosition(this.modelViewMatrix),a.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&v0.multiplyScalar(-b0.z);const A=this.material.rotation;let x,w;A!==0&&(w=Math.cos(A),x=Math.sin(A));const M=this.center;QE(HE.set(-.5,-.5,0),b0,M,v0,x,w),QE(vv.set(.5,-.5,0),b0,M,v0,x,w),QE(WE.set(.5,.5,0),b0,M,v0,x,w),T9.set(0,0),$B.set(1,0),M9.set(1,1);let L=a.ray.intersectTriangle(HE,vv,WE,!1,Av);if(L===null&&(QE(vv.set(-.5,.5,0),b0,M,v0,x,w),$B.set(0,1),L=a.ray.intersectTriangle(HE,WE,vv,!1,Av),L===null))return;const O=a.ray.origin.distanceTo(Av);O<a.near||O>a.far||d.push({distance:O,point:Av.clone(),uv:Ml.getInterpolation(Av,HE,vv,WE,T9,$B,M9,new ai),face:null,object:this})}copy(a,d){return super.copy(a,d),a.center!==void 0&&this.center.copy(a.center),this.material=a.material,this}}function QE(S,a,d,A,x,w){x0.subVectors(S,d).addScalar(.5).multiply(A),x!==void 0?(yv.x=w*x0.x-x*x0.y,yv.y=x*x0.x+w*x0.y):yv.copy(x0),S.copy(a),S.x+=yv.x,S.y+=yv.y,S.applyMatrix4(S9)}const qE=new He,I9=new He;class B9 extends Gn{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(a){super.copy(a,!1);const d=a.levels;for(let A=0,x=d.length;A<x;A++){const w=d[A];this.addLevel(w.object.clone(),w.distance,w.hysteresis)}return this.autoUpdate=a.autoUpdate,this}addLevel(a,d=0,A=0){d=Math.abs(d);const x=this.levels;let w;for(w=0;w<x.length&&!(d<x[w].distance);w++);return x.splice(w,0,{distance:d,hysteresis:A,object:a}),this.add(a),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(a){const d=this.levels;if(d.length>0){let A,x;for(A=1,x=d.length;A<x;A++){let w=d[A].distance;if(d[A].object.visible&&(w-=w*d[A].hysteresis),a<w)break}return d[A-1].object}return null}raycast(a,d){if(this.levels.length>0){qE.setFromMatrixPosition(this.matrixWorld);const A=a.ray.origin.distanceTo(qE);this.getObjectForDistance(A).raycast(a,d)}}update(a){const d=this.levels;if(d.length>1){qE.setFromMatrixPosition(a.matrixWorld),I9.setFromMatrixPosition(this.matrixWorld);const A=qE.distanceTo(I9)/a.zoom;d[0].object.visible=!0;let x,w;for(x=1,w=d.length;x<w;x++){let M=d[x].distance;if(d[x].object.visible&&(M-=M*d[x].hysteresis),A>=M)d[x-1].object.visible=!1,d[x].object.visible=!0;else break}for(this._currentLevel=x-1;x<w;x++)d[x].object.visible=!1}}toJSON(a){const d=super.toJSON(a);this.autoUpdate===!1&&(d.object.autoUpdate=!1),d.object.levels=[];const A=this.levels;for(let x=0,w=A.length;x<w;x++){const M=A[x];d.object.levels.push({object:M.object.uuid,distance:M.distance,hysteresis:M.hysteresis})}return d}}const L9=new He,D9=new Fn,N9=new Fn,wTe=new He,P9=new fr,XE=new He,eL=new Aa,O9=new fr,tL=new ya;class k9 extends ua{constructor(a,d){super(a,d),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=Se,this.bindMatrix=new fr,this.bindMatrixInverse=new fr,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const a=this.geometry;this.boundingBox===null&&(this.boundingBox=new Ds),this.boundingBox.makeEmpty();const d=a.getAttribute("position");for(let A=0;A<d.count;A++)this.getVertexPosition(A,XE),this.boundingBox.expandByPoint(XE)}computeBoundingSphere(){const a=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Aa),this.boundingSphere.makeEmpty();const d=a.getAttribute("position");for(let A=0;A<d.count;A++)this.getVertexPosition(A,XE),this.boundingSphere.expandByPoint(XE)}copy(a,d){return super.copy(a,d),this.bindMode=a.bindMode,this.bindMatrix.copy(a.bindMatrix),this.bindMatrixInverse.copy(a.bindMatrixInverse),this.skeleton=a.skeleton,a.boundingBox!==null&&(this.boundingBox=a.boundingBox.clone()),a.boundingSphere!==null&&(this.boundingSphere=a.boundingSphere.clone()),this}raycast(a,d){const A=this.material,x=this.matrixWorld;A!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),eL.copy(this.boundingSphere),eL.applyMatrix4(x),a.ray.intersectsSphere(eL)!==!1&&(O9.copy(x).invert(),tL.copy(a.ray).applyMatrix4(O9),!(this.boundingBox!==null&&tL.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(a,d,tL)))}getVertexPosition(a,d){return super.getVertexPosition(a,d),this.applyBoneTransform(a,d),d}bind(a,d){this.skeleton=a,d===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),d=this.matrixWorld),this.bindMatrix.copy(d),this.bindMatrixInverse.copy(d).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const a=new Fn,d=this.geometry.attributes.skinWeight;for(let A=0,x=d.count;A<x;A++){a.fromBufferAttribute(d,A);const w=1/a.manhattanLength();w!==1/0?a.multiplyScalar(w):a.set(1,0,0,0),d.setXYZW(A,a.x,a.y,a.z,a.w)}}updateMatrixWorld(a){super.updateMatrixWorld(a),this.bindMode===Se?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===Fe?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(a,d){const A=this.skeleton,x=this.geometry;D9.fromBufferAttribute(x.attributes.skinIndex,a),N9.fromBufferAttribute(x.attributes.skinWeight,a),L9.copy(d).applyMatrix4(this.bindMatrix),d.set(0,0,0);for(let w=0;w<4;w++){const M=N9.getComponent(w);if(M!==0){const L=D9.getComponent(w);P9.multiplyMatrices(A.bones[L].matrixWorld,A.boneInverses[L]),d.addScaledVector(wTe.copy(L9).applyMatrix4(P9),M)}}return d.applyMatrix4(this.bindMatrixInverse)}}class iL extends Gn{constructor(){super(),this.isBone=!0,this.type="Bone"}}class jd extends hs{constructor(a=null,d=1,A=1,x,w,M,L,O,F=Dt,H=Dt,J,K){super(null,M,L,O,F,H,x,w,J,K),this.isDataTexture=!0,this.image={data:a,width:d,height:A},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const F9=new fr,CTe=new fr;class YE{constructor(a=[],d=[]){this.uuid=Ro(),this.bones=a.slice(0),this.boneInverses=d,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const a=this.bones,d=this.boneInverses;if(this.boneMatrices=new Float32Array(a.length*16),d.length===0)this.calculateInverses();else if(a.length!==d.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let A=0,x=this.bones.length;A<x;A++)this.boneInverses.push(new fr)}}calculateInverses(){this.boneInverses.length=0;for(let a=0,d=this.bones.length;a<d;a++){const A=new fr;this.bones[a]&&A.copy(this.bones[a].matrixWorld).invert(),this.boneInverses.push(A)}}pose(){for(let a=0,d=this.bones.length;a<d;a++){const A=this.bones[a];A&&A.matrixWorld.copy(this.boneInverses[a]).invert()}for(let a=0,d=this.bones.length;a<d;a++){const A=this.bones[a];A&&(A.parent&&A.parent.isBone?(A.matrix.copy(A.parent.matrixWorld).invert(),A.matrix.multiply(A.matrixWorld)):A.matrix.copy(A.matrixWorld),A.matrix.decompose(A.position,A.quaternion,A.scale))}}update(){const a=this.bones,d=this.boneInverses,A=this.boneMatrices,x=this.boneTexture;for(let w=0,M=a.length;w<M;w++){const L=a[w]?a[w].matrixWorld:CTe;F9.multiplyMatrices(L,d[w]),F9.toArray(A,w*16)}x!==null&&(x.needsUpdate=!0)}clone(){return new YE(this.bones,this.boneInverses)}computeBoneTexture(){let a=Math.sqrt(this.bones.length*4);a=Math.ceil(a/4)*4,a=Math.max(a,4);const d=new Float32Array(a*a*4);d.set(this.boneMatrices);const A=new jd(d,a,a,fe,Rt);return A.needsUpdate=!0,this.boneMatrices=d,this.boneTexture=A,this}getBoneByName(a){for(let d=0,A=this.bones.length;d<A;d++){const x=this.bones[d];if(x.name===a)return x}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(a,d){this.uuid=a.uuid;for(let A=0,x=a.bones.length;A<x;A++){const w=a.bones[A];let M=d[w];M===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",w),M=new iL),this.bones.push(M),this.boneInverses.push(new fr().fromArray(a.boneInverses[A]))}return this.init(),this}toJSON(){const a={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};a.uuid=this.uuid;const d=this.bones,A=this.boneInverses;for(let x=0,w=d.length;x<w;x++){const M=d[x];a.bones.push(M.uuid);const L=A[x];a.boneInverses.push(L.toArray())}return a}}class _0 extends ss{constructor(a,d,A,x=1){super(a,d,A),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=x}copy(a){return super.copy(a),this.meshPerAttribute=a.meshPerAttribute,this}toJSON(){const a=super.toJSON();return a.meshPerAttribute=this.meshPerAttribute,a.isInstancedBufferAttribute=!0,a}}const E0=new fr,U9=new fr,KE=[],z9=new Ds,STe=new fr,bv=new ua,xv=new Aa;class j9 extends ua{constructor(a,d,A){super(a,d),this.isInstancedMesh=!0,this.instanceMatrix=new _0(new Float32Array(A*16),16),this.instanceColor=null,this.morphTexture=null,this.count=A,this.boundingBox=null,this.boundingSphere=null;for(let x=0;x<A;x++)this.setMatrixAt(x,STe)}computeBoundingBox(){const a=this.geometry,d=this.count;this.boundingBox===null&&(this.boundingBox=new Ds),a.boundingBox===null&&a.computeBoundingBox(),this.boundingBox.makeEmpty();for(let A=0;A<d;A++)this.getMatrixAt(A,E0),z9.copy(a.boundingBox).applyMatrix4(E0),this.boundingBox.union(z9)}computeBoundingSphere(){const a=this.geometry,d=this.count;this.boundingSphere===null&&(this.boundingSphere=new Aa),a.boundingSphere===null&&a.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let A=0;A<d;A++)this.getMatrixAt(A,E0),xv.copy(a.boundingSphere).applyMatrix4(E0),this.boundingSphere.union(xv)}copy(a,d){return super.copy(a,d),this.instanceMatrix.copy(a.instanceMatrix),a.morphTexture!==null&&(this.morphTexture=a.morphTexture.clone()),a.instanceColor!==null&&(this.instanceColor=a.instanceColor.clone()),this.count=a.count,a.boundingBox!==null&&(this.boundingBox=a.boundingBox.clone()),a.boundingSphere!==null&&(this.boundingSphere=a.boundingSphere.clone()),this}getColorAt(a,d){d.fromArray(this.instanceColor.array,a*3)}getMatrixAt(a,d){d.fromArray(this.instanceMatrix.array,a*16)}getMorphAt(a,d){const A=d.morphTargetInfluences,x=this.morphTexture.source.data.data,w=A.length+1,M=a*w+1;for(let L=0;L<A.length;L++)A[L]=x[M+L]}raycast(a,d){const A=this.matrixWorld,x=this.count;if(bv.geometry=this.geometry,bv.material=this.material,bv.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),xv.copy(this.boundingSphere),xv.applyMatrix4(A),a.ray.intersectsSphere(xv)!==!1))for(let w=0;w<x;w++){this.getMatrixAt(w,E0),U9.multiplyMatrices(A,E0),bv.matrixWorld=U9,bv.raycast(a,KE);for(let M=0,L=KE.length;M<L;M++){const O=KE[M];O.instanceId=w,O.object=this,d.push(O)}KE.length=0}}setColorAt(a,d){this.instanceColor===null&&(this.instanceColor=new _0(new Float32Array(this.instanceMatrix.count*3),3)),d.toArray(this.instanceColor.array,a*3)}setMatrixAt(a,d){d.toArray(this.instanceMatrix.array,a*16)}setMorphAt(a,d){const A=d.morphTargetInfluences,x=A.length+1;this.morphTexture===null&&(this.morphTexture=new jd(new Float32Array(x*this.count),x,this.count,Tt,Rt));const w=this.morphTexture.source.data.data;let M=0;for(let F=0;F<A.length;F++)M+=A[F];const L=this.geometry.morphTargetsRelative?1:1-M,O=x*a;w[O]=L,w.set(A,O+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}}function TTe(S,a){return S.z-a.z}function MTe(S,a){return a.z-S.z}class RTe{constructor(){this.index=0,this.pool=[],this.list=[]}push(a,d){const A=this.pool,x=this.list;this.index>=A.length&&A.push({start:-1,count:-1,z:-1});const w=A[this.index];x.push(w),this.index++,w.start=a.start,w.count=a.count,w.z=d}reset(){this.list.length=0,this.index=0}}const w0="batchId",Vd=new fr,V9=new fr,ITe=new fr,G9=new fr,rL=new mv,JE=new Ds,xf=new Aa,_v=new He,nL=new RTe,uo=new ua,ZE=[];function BTe(S,a,d=0){const A=a.itemSize;if(S.isInterleavedBufferAttribute||S.array.constructor!==a.array.constructor){const x=S.count;for(let w=0;w<x;w++)for(let M=0;M<A;M++)a.setComponent(w+d,M,S.getComponent(w,M))}else a.array.set(S.array,d*A);a.needsUpdate=!0}class H9 extends ua{get maxGeometryCount(){return this._maxGeometryCount}constructor(a,d,A=d*2,x){super(new dn,x),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._drawRanges=[],this._reservedRanges=[],this._visibility=[],this._active=[],this._bounds=[],this._maxGeometryCount=a,this._maxVertexCount=d,this._maxIndexCount=A,this._geometryInitialized=!1,this._geometryCount=0,this._multiDrawCounts=new Int32Array(a),this._multiDrawStarts=new Int32Array(a),this._multiDrawCount=0,this._multiDrawInstances=null,this._visibilityChanged=!0,this._matricesTexture=null,this._initMatricesTexture()}_initMatricesTexture(){let a=Math.sqrt(this._maxGeometryCount*4);a=Math.ceil(a/4)*4,a=Math.max(a,4);const d=new Float32Array(a*a*4),A=new jd(d,a,a,fe,Rt);this._matricesTexture=A}_initializeGeometry(a){const d=this.geometry,A=this._maxVertexCount,x=this._maxGeometryCount,w=this._maxIndexCount;if(this._geometryInitialized===!1){for(const L in a.attributes){const O=a.getAttribute(L),{array:F,itemSize:H,normalized:J}=O,K=new F.constructor(A*H),Z=new ss(K,H,J);d.setAttribute(L,Z)}if(a.getIndex()!==null){const L=A>65536?new Uint32Array(w):new Uint16Array(w);d.setIndex(new ss(L,1))}const M=x>65536?new Uint32Array(A):new Uint16Array(A);d.setAttribute(w0,new ss(M,1)),this._geometryInitialized=!0}}_validateGeometry(a){if(a.getAttribute(w0))throw new Error(`BatchedMesh: Geometry cannot use attribute "${w0}"`);const d=this.geometry;if(!!a.getIndex()!=!!d.getIndex())throw new Error('BatchedMesh: All geometries must consistently have "index".');for(const A in d.attributes){if(A===w0)continue;if(!a.hasAttribute(A))throw new Error(`BatchedMesh: Added geometry missing "${A}". All geometries must have consistent attributes.`);const x=a.getAttribute(A),w=d.getAttribute(A);if(x.itemSize!==w.itemSize||x.normalized!==w.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(a){return this.customSort=a,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ds);const a=this._geometryCount,d=this.boundingBox,A=this._active;d.makeEmpty();for(let x=0;x<a;x++)A[x]!==!1&&(this.getMatrixAt(x,Vd),this.getBoundingBoxAt(x,JE).applyMatrix4(Vd),d.union(JE))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Aa);const a=this._geometryCount,d=this.boundingSphere,A=this._active;d.makeEmpty();for(let x=0;x<a;x++)A[x]!==!1&&(this.getMatrixAt(x,Vd),this.getBoundingSphereAt(x,xf).applyMatrix4(Vd),d.union(xf))}addGeometry(a,d=-1,A=-1){if(this._initializeGeometry(a),this._validateGeometry(a),this._geometryCount>=this._maxGeometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");const x={vertexStart:-1,vertexCount:-1,indexStart:-1,indexCount:-1};let w=null;const M=this._reservedRanges,L=this._drawRanges,O=this._bounds;this._geometryCount!==0&&(w=M[M.length-1]),d===-1?x.vertexCount=a.getAttribute("position").count:x.vertexCount=d,w===null?x.vertexStart=0:x.vertexStart=w.vertexStart+w.vertexCount;const F=a.getIndex(),H=F!==null;if(H&&(A===-1?x.indexCount=F.count:x.indexCount=A,w===null?x.indexStart=0:x.indexStart=w.indexStart+w.indexCount),x.indexStart!==-1&&x.indexStart+x.indexCount>this._maxIndexCount||x.vertexStart+x.vertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");const J=this._visibility,K=this._active,Z=this._matricesTexture,ie=this._matricesTexture.image.data;J.push(!0),K.push(!0);const oe=this._geometryCount;this._geometryCount++,ITe.toArray(ie,oe*16),Z.needsUpdate=!0,M.push(x),L.push({start:H?x.indexStart:x.vertexStart,count:-1}),O.push({boxInitialized:!1,box:new Ds,sphereInitialized:!1,sphere:new Aa});const ne=this.geometry.getAttribute(w0);for(let ee=0;ee<x.vertexCount;ee++)ne.setX(x.vertexStart+ee,oe);return ne.needsUpdate=!0,this.setGeometryAt(oe,a),oe}setGeometryAt(a,d){if(a>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(d);const A=this.geometry,x=A.getIndex()!==null,w=A.getIndex(),M=d.getIndex(),L=this._reservedRanges[a];if(x&&M.count>L.indexCount||d.attributes.position.count>L.vertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");const O=L.vertexStart,F=L.vertexCount;for(const Z in A.attributes){if(Z===w0)continue;const ie=d.getAttribute(Z),oe=A.getAttribute(Z);BTe(ie,oe,O);const ne=ie.itemSize;for(let ee=ie.count,Re=F;ee<Re;ee++){const we=O+ee;for(let _e=0;_e<ne;_e++)oe.setComponent(we,_e,0)}oe.needsUpdate=!0,oe.addUpdateRange(O*ne,F*ne)}if(x){const Z=L.indexStart;for(let ie=0;ie<M.count;ie++)w.setX(Z+ie,O+M.getX(ie));for(let ie=M.count,oe=L.indexCount;ie<oe;ie++)w.setX(Z+ie,O);w.needsUpdate=!0,w.addUpdateRange(Z,L.indexCount)}const H=this._bounds[a];d.boundingBox!==null?(H.box.copy(d.boundingBox),H.boxInitialized=!0):H.boxInitialized=!1,d.boundingSphere!==null?(H.sphere.copy(d.boundingSphere),H.sphereInitialized=!0):H.sphereInitialized=!1;const J=this._drawRanges[a],K=d.getAttribute("position");return J.count=x?M.count:K.count,this._visibilityChanged=!0,a}deleteGeometry(a){const d=this._active;return a>=d.length||d[a]===!1?this:(d[a]=!1,this._visibilityChanged=!0,this)}getInstanceCountAt(a){return this._multiDrawInstances===null?null:this._multiDrawInstances[a]}setInstanceCountAt(a,d){return this._multiDrawInstances===null&&(this._multiDrawInstances=new Int32Array(this._maxGeometryCount).fill(1)),this._multiDrawInstances[a]=d,a}getBoundingBoxAt(a,d){if(this._active[a]===!1)return null;const A=this._bounds[a],x=A.box,w=this.geometry;if(A.boxInitialized===!1){x.makeEmpty();const M=w.index,L=w.attributes.position,O=this._drawRanges[a];for(let F=O.start,H=O.start+O.count;F<H;F++){let J=F;M&&(J=M.getX(J)),x.expandByPoint(_v.fromBufferAttribute(L,J))}A.boxInitialized=!0}return d.copy(x),d}getBoundingSphereAt(a,d){if(this._active[a]===!1)return null;const A=this._bounds[a],x=A.sphere,w=this.geometry;if(A.sphereInitialized===!1){x.makeEmpty(),this.getBoundingBoxAt(a,JE),JE.getCenter(x.center);const M=w.index,L=w.attributes.position,O=this._drawRanges[a];let F=0;for(let H=O.start,J=O.start+O.count;H<J;H++){let K=H;M&&(K=M.getX(K)),_v.fromBufferAttribute(L,K),F=Math.max(F,x.center.distanceToSquared(_v))}x.radius=Math.sqrt(F),A.sphereInitialized=!0}return d.copy(x),d}setMatrixAt(a,d){const A=this._active,x=this._matricesTexture,w=this._matricesTexture.image.data,M=this._geometryCount;return a>=M||A[a]===!1?this:(d.toArray(w,a*16),x.needsUpdate=!0,this)}getMatrixAt(a,d){const A=this._active,x=this._matricesTexture.image.data,w=this._geometryCount;return a>=w||A[a]===!1?null:d.fromArray(x,a*16)}setVisibleAt(a,d){const A=this._visibility,x=this._active,w=this._geometryCount;return a>=w||x[a]===!1||A[a]===d?this:(A[a]=d,this._visibilityChanged=!0,this)}getVisibleAt(a){const d=this._visibility,A=this._active,x=this._geometryCount;return a>=x||A[a]===!1?!1:d[a]}raycast(a,d){const A=this._visibility,x=this._active,w=this._drawRanges,M=this._geometryCount,L=this.matrixWorld,O=this.geometry;uo.material=this.material,uo.geometry.index=O.index,uo.geometry.attributes=O.attributes,uo.geometry.boundingBox===null&&(uo.geometry.boundingBox=new Ds),uo.geometry.boundingSphere===null&&(uo.geometry.boundingSphere=new Aa);for(let F=0;F<M;F++){if(!A[F]||!x[F])continue;const H=w[F];uo.geometry.setDrawRange(H.start,H.count),this.getMatrixAt(F,uo.matrixWorld).premultiply(L),this.getBoundingBoxAt(F,uo.geometry.boundingBox),this.getBoundingSphereAt(F,uo.geometry.boundingSphere),uo.raycast(a,ZE);for(let J=0,K=ZE.length;J<K;J++){const Z=ZE[J];Z.object=this,Z.batchId=F,d.push(Z)}ZE.length=0}uo.material=null,uo.geometry.index=null,uo.geometry.attributes={},uo.geometry.setDrawRange(0,1/0)}copy(a){return super.copy(a),this.geometry=a.geometry.clone(),this.perObjectFrustumCulled=a.perObjectFrustumCulled,this.sortObjects=a.sortObjects,this.boundingBox=a.boundingBox!==null?a.boundingBox.clone():null,this.boundingSphere=a.boundingSphere!==null?a.boundingSphere.clone():null,this._drawRanges=a._drawRanges.map(d=>({...d})),this._reservedRanges=a._reservedRanges.map(d=>({...d})),this._visibility=a._visibility.slice(),this._active=a._active.slice(),this._bounds=a._bounds.map(d=>({boxInitialized:d.boxInitialized,box:d.box.clone(),sphereInitialized:d.sphereInitialized,sphere:d.sphere.clone()})),this._maxGeometryCount=a._maxGeometryCount,this._maxVertexCount=a._maxVertexCount,this._maxIndexCount=a._maxIndexCount,this._geometryInitialized=a._geometryInitialized,this._geometryCount=a._geometryCount,this._multiDrawCounts=a._multiDrawCounts.slice(),this._multiDrawStarts=a._multiDrawStarts.slice(),this._matricesTexture=a._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.slice(),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this}onBeforeRender(a,d,A,x,w){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const M=x.getIndex(),L=M===null?1:M.array.BYTES_PER_ELEMENT,O=this._active,F=this._visibility,H=this._multiDrawStarts,J=this._multiDrawCounts,K=this._drawRanges,Z=this.perObjectFrustumCulled;Z&&(G9.multiplyMatrices(A.projectionMatrix,A.matrixWorldInverse).multiply(this.matrixWorld),rL.setFromProjectionMatrix(G9,a.coordinateSystem));let ie=0;if(this.sortObjects){V9.copy(this.matrixWorld).invert(),_v.setFromMatrixPosition(A.matrixWorld).applyMatrix4(V9);for(let ee=0,Re=F.length;ee<Re;ee++)if(F[ee]&&O[ee]){this.getMatrixAt(ee,Vd),this.getBoundingSphereAt(ee,xf).applyMatrix4(Vd);let we=!1;if(Z&&(we=!rL.intersectsSphere(xf)),!we){const _e=_v.distanceTo(xf.center);nL.push(K[ee],_e)}}const oe=nL.list,ne=this.customSort;ne===null?oe.sort(w.transparent?MTe:TTe):ne.call(this,oe,A);for(let ee=0,Re=oe.length;ee<Re;ee++){const we=oe[ee];H[ie]=we.start*L,J[ie]=we.count,ie++}nL.reset()}else for(let oe=0,ne=F.length;oe<ne;oe++)if(F[oe]&&O[oe]){let ee=!1;if(Z&&(this.getMatrixAt(oe,Vd),this.getBoundingSphereAt(oe,xf).applyMatrix4(Vd),ee=!rL.intersectsSphere(xf)),!ee){const Re=K[oe];H[ie]=Re.start*L,J[ie]=Re.count,ie++}}this._multiDrawCount=ie,this._visibilityChanged=!1}onBeforeShadow(a,d,A,x,w,M){this.onBeforeRender(a,null,x,w,M)}}class Do extends co{constructor(a){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new or(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.map=a.map,this.linewidth=a.linewidth,this.linecap=a.linecap,this.linejoin=a.linejoin,this.fog=a.fog,this}}const $E=new He,ew=new He,W9=new fr,Ev=new ya,tw=new Aa,sL=new He,Q9=new He;class Gd extends Gn{constructor(a=new dn,d=new Do){super(),this.isLine=!0,this.type="Line",this.geometry=a,this.material=d,this.updateMorphTargets()}copy(a,d){return super.copy(a,d),this.material=Array.isArray(a.material)?a.material.slice():a.material,this.geometry=a.geometry,this}computeLineDistances(){const a=this.geometry;if(a.index===null){const d=a.attributes.position,A=[0];for(let x=1,w=d.count;x<w;x++)$E.fromBufferAttribute(d,x-1),ew.fromBufferAttribute(d,x),A[x]=A[x-1],A[x]+=$E.distanceTo(ew);a.setAttribute("lineDistance",new vr(A,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(a,d){const A=this.geometry,x=this.matrixWorld,w=a.params.Line.threshold,M=A.drawRange;if(A.boundingSphere===null&&A.computeBoundingSphere(),tw.copy(A.boundingSphere),tw.applyMatrix4(x),tw.radius+=w,a.ray.intersectsSphere(tw)===!1)return;W9.copy(x).invert(),Ev.copy(a.ray).applyMatrix4(W9);const L=w/((this.scale.x+this.scale.y+this.scale.z)/3),O=L*L,F=this.isLineSegments?2:1,H=A.index,J=A.attributes.position;if(H!==null){const K=Math.max(0,M.start),Z=Math.min(H.count,M.start+M.count);for(let ie=K,oe=Z-1;ie<oe;ie+=F){const ne=H.getX(ie),ee=H.getX(ie+1),Re=iw(this,a,Ev,O,ne,ee);Re&&d.push(Re)}if(this.isLineLoop){const ie=H.getX(Z-1),oe=H.getX(K),ne=iw(this,a,Ev,O,ie,oe);ne&&d.push(ne)}}else{const K=Math.max(0,M.start),Z=Math.min(J.count,M.start+M.count);for(let ie=K,oe=Z-1;ie<oe;ie+=F){const ne=iw(this,a,Ev,O,ie,ie+1);ne&&d.push(ne)}if(this.isLineLoop){const ie=iw(this,a,Ev,O,Z-1,K);ie&&d.push(ie)}}}updateMorphTargets(){const a=this.geometry.morphAttributes,d=Object.keys(a);if(d.length>0){const A=a[d[0]];if(A!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let x=0,w=A.length;x<w;x++){const M=A[x].name||String(x);this.morphTargetInfluences.push(0),this.morphTargetDictionary[M]=x}}}}}function iw(S,a,d,A,x,w){const M=S.geometry.attributes.position;if($E.fromBufferAttribute(M,x),ew.fromBufferAttribute(M,w),d.distanceSqToSegment($E,ew,sL,Q9)>A)return;sL.applyMatrix4(S.matrixWorld);const L=a.ray.origin.distanceTo(sL);if(!(L<a.near||L>a.far))return{distance:L,point:Q9.clone().applyMatrix4(S.matrixWorld),index:x,face:null,faceIndex:null,object:S}}const q9=new He,X9=new He;class au extends Gd{constructor(a,d){super(a,d),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const a=this.geometry;if(a.index===null){const d=a.attributes.position,A=[];for(let x=0,w=d.count;x<w;x+=2)q9.fromBufferAttribute(d,x),X9.fromBufferAttribute(d,x+1),A[x]=x===0?0:A[x-1],A[x+1]=A[x]+q9.distanceTo(X9);a.setAttribute("lineDistance",new vr(A,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class Y9 extends Gd{constructor(a,d){super(a,d),this.isLineLoop=!0,this.type="LineLoop"}}class aL extends co{constructor(a){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new or(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.map=a.map,this.alphaMap=a.alphaMap,this.size=a.size,this.sizeAttenuation=a.sizeAttenuation,this.fog=a.fog,this}}const K9=new fr,oL=new ya,rw=new Aa,nw=new He;class J9 extends Gn{constructor(a=new dn,d=new aL){super(),this.isPoints=!0,this.type="Points",this.geometry=a,this.material=d,this.updateMorphTargets()}copy(a,d){return super.copy(a,d),this.material=Array.isArray(a.material)?a.material.slice():a.material,this.geometry=a.geometry,this}raycast(a,d){const A=this.geometry,x=this.matrixWorld,w=a.params.Points.threshold,M=A.drawRange;if(A.boundingSphere===null&&A.computeBoundingSphere(),rw.copy(A.boundingSphere),rw.applyMatrix4(x),rw.radius+=w,a.ray.intersectsSphere(rw)===!1)return;K9.copy(x).invert(),oL.copy(a.ray).applyMatrix4(K9);const L=w/((this.scale.x+this.scale.y+this.scale.z)/3),O=L*L,F=A.index,H=A.attributes.position;if(F!==null){const J=Math.max(0,M.start),K=Math.min(F.count,M.start+M.count);for(let Z=J,ie=K;Z<ie;Z++){const oe=F.getX(Z);nw.fromBufferAttribute(H,oe),Z9(nw,oe,O,x,a,d,this)}}else{const J=Math.max(0,M.start),K=Math.min(H.count,M.start+M.count);for(let Z=J,ie=K;Z<ie;Z++)nw.fromBufferAttribute(H,Z),Z9(nw,Z,O,x,a,d,this)}}updateMorphTargets(){const a=this.geometry.morphAttributes,d=Object.keys(a);if(d.length>0){const A=a[d[0]];if(A!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let x=0,w=A.length;x<w;x++){const M=A[x].name||String(x);this.morphTargetInfluences.push(0),this.morphTargetDictionary[M]=x}}}}}function Z9(S,a,d,A,x,w,M){const L=oL.distanceSqToPoint(S);if(L<d){const O=new He;oL.closestPointToPoint(S,O),O.applyMatrix4(A);const F=x.ray.origin.distanceTo(O);if(F<x.near||F>x.far)return;w.push({distance:F,distanceToRay:Math.sqrt(L),point:O,index:a,face:null,object:M})}}class LTe extends hs{constructor(a,d,A,x,w,M,L,O,F){super(a,d,A,x,w,M,L,O,F),this.isVideoTexture=!0,this.minFilter=M!==void 0?M:ki,this.magFilter=w!==void 0?w:ki,this.generateMipmaps=!1;const H=this;function J(){H.needsUpdate=!0,a.requestVideoFrameCallback(J)}"requestVideoFrameCallback"in a&&a.requestVideoFrameCallback(J)}clone(){return new this.constructor(this.image).copy(this)}update(){const a=this.image;!("requestVideoFrameCallback"in a)&&a.readyState>=a.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class DTe extends hs{constructor(a,d){super({width:a,height:d}),this.isFramebufferTexture=!0,this.magFilter=Dt,this.minFilter=Dt,this.generateMipmaps=!1,this.needsUpdate=!0}}class sw extends hs{constructor(a,d,A,x,w,M,L,O,F,H,J,K){super(null,M,L,O,F,H,x,w,J,K),this.isCompressedTexture=!0,this.image={width:d,height:A},this.mipmaps=a,this.flipY=!1,this.generateMipmaps=!1}}class NTe extends sw{constructor(a,d,A,x,w,M){super(a,d,A,w,M),this.isCompressedArrayTexture=!0,this.image.depth=x,this.wrapR=Ve}}class PTe extends sw{constructor(a,d,A){super(void 0,a[0].width,a[0].height,d,A,U),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=a}}class OTe extends hs{constructor(a,d,A,x,w,M,L,O,F){super(a,d,A,x,w,M,L,O,F),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Dc{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(a,d){const A=this.getUtoTmapping(a);return this.getPoint(A,d)}getPoints(a=5){const d=[];for(let A=0;A<=a;A++)d.push(this.getPoint(A/a));return d}getSpacedPoints(a=5){const d=[];for(let A=0;A<=a;A++)d.push(this.getPointAt(A/a));return d}getLength(){const a=this.getLengths();return a[a.length-1]}getLengths(a=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===a+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const d=[];let A,x=this.getPoint(0),w=0;d.push(0);for(let M=1;M<=a;M++)A=this.getPoint(M/a),w+=A.distanceTo(x),d.push(w),x=A;return this.cacheArcLengths=d,d}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(a,d){const A=this.getLengths();let x=0;const w=A.length;let M;d?M=d:M=a*A[w-1];let L=0,O=w-1,F;for(;L<=O;)if(x=Math.floor(L+(O-L)/2),F=A[x]-M,F<0)L=x+1;else if(F>0)O=x-1;else{O=x;break}if(x=O,A[x]===M)return x/(w-1);const H=A[x],J=A[x+1]-H,K=(M-H)/J;return(x+K)/(w-1)}getTangent(a,d){let A=a-1e-4,x=a+1e-4;A<0&&(A=0),x>1&&(x=1);const w=this.getPoint(A),M=this.getPoint(x),L=d||(w.isVector2?new ai:new He);return L.copy(M).sub(w).normalize(),L}getTangentAt(a,d){const A=this.getUtoTmapping(a);return this.getTangent(A,d)}computeFrenetFrames(a,d){const A=new He,x=[],w=[],M=[],L=new He,O=new fr;for(let Z=0;Z<=a;Z++){const ie=Z/a;x[Z]=this.getTangentAt(ie,new He)}w[0]=new He,M[0]=new He;let F=Number.MAX_VALUE;const H=Math.abs(x[0].x),J=Math.abs(x[0].y),K=Math.abs(x[0].z);H<=F&&(F=H,A.set(1,0,0)),J<=F&&(F=J,A.set(0,1,0)),K<=F&&A.set(0,0,1),L.crossVectors(x[0],A).normalize(),w[0].crossVectors(x[0],L),M[0].crossVectors(x[0],w[0]);for(let Z=1;Z<=a;Z++){if(w[Z]=w[Z-1].clone(),M[Z]=M[Z-1].clone(),L.crossVectors(x[Z-1],x[Z]),L.length()>Number.EPSILON){L.normalize();const ie=Math.acos(Ts(x[Z-1].dot(x[Z]),-1,1));w[Z].applyMatrix4(O.makeRotationAxis(L,ie))}M[Z].crossVectors(x[Z],w[Z])}if(d===!0){let Z=Math.acos(Ts(w[0].dot(w[a]),-1,1));Z/=a,x[0].dot(L.crossVectors(w[0],w[a]))>0&&(Z=-Z);for(let ie=1;ie<=a;ie++)w[ie].applyMatrix4(O.makeRotationAxis(x[ie],Z*ie)),M[ie].crossVectors(x[ie],w[ie])}return{tangents:x,normals:w,binormals:M}}clone(){return new this.constructor().copy(this)}copy(a){return this.arcLengthDivisions=a.arcLengthDivisions,this}toJSON(){const a={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return a.arcLengthDivisions=this.arcLengthDivisions,a.type=this.type,a}fromJSON(a){return this.arcLengthDivisions=a.arcLengthDivisions,this}}class aw extends Dc{constructor(a=0,d=0,A=1,x=1,w=0,M=Math.PI*2,L=!1,O=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=a,this.aY=d,this.xRadius=A,this.yRadius=x,this.aStartAngle=w,this.aEndAngle=M,this.aClockwise=L,this.aRotation=O}getPoint(a,d=new ai){const A=d,x=Math.PI*2;let w=this.aEndAngle-this.aStartAngle;const M=Math.abs(w)<Number.EPSILON;for(;w<0;)w+=x;for(;w>x;)w-=x;w<Number.EPSILON&&(M?w=0:w=x),this.aClockwise===!0&&!M&&(w===x?w=-x:w=w-x);const L=this.aStartAngle+a*w;let O=this.aX+this.xRadius*Math.cos(L),F=this.aY+this.yRadius*Math.sin(L);if(this.aRotation!==0){const H=Math.cos(this.aRotation),J=Math.sin(this.aRotation),K=O-this.aX,Z=F-this.aY;O=K*H-Z*J+this.aX,F=K*J+Z*H+this.aY}return A.set(O,F)}copy(a){return super.copy(a),this.aX=a.aX,this.aY=a.aY,this.xRadius=a.xRadius,this.yRadius=a.yRadius,this.aStartAngle=a.aStartAngle,this.aEndAngle=a.aEndAngle,this.aClockwise=a.aClockwise,this.aRotation=a.aRotation,this}toJSON(){const a=super.toJSON();return a.aX=this.aX,a.aY=this.aY,a.xRadius=this.xRadius,a.yRadius=this.yRadius,a.aStartAngle=this.aStartAngle,a.aEndAngle=this.aEndAngle,a.aClockwise=this.aClockwise,a.aRotation=this.aRotation,a}fromJSON(a){return super.fromJSON(a),this.aX=a.aX,this.aY=a.aY,this.xRadius=a.xRadius,this.yRadius=a.yRadius,this.aStartAngle=a.aStartAngle,this.aEndAngle=a.aEndAngle,this.aClockwise=a.aClockwise,this.aRotation=a.aRotation,this}}class $9 extends aw{constructor(a,d,A,x,w,M){super(a,d,A,A,x,w,M),this.isArcCurve=!0,this.type="ArcCurve"}}function lL(){let S=0,a=0,d=0,A=0;function x(w,M,L,O){S=w,a=L,d=-3*w+3*M-2*L-O,A=2*w-2*M+L+O}return{initCatmullRom:function(w,M,L,O,F){x(M,L,F*(L-w),F*(O-M))},initNonuniformCatmullRom:function(w,M,L,O,F,H,J){let K=(M-w)/F-(L-w)/(F+H)+(L-M)/H,Z=(L-M)/H-(O-M)/(H+J)+(O-L)/J;K*=H,Z*=H,x(M,L,K,Z)},calc:function(w){const M=w*w,L=M*w;return S+a*w+d*M+A*L}}}const ow=new He,cL=new lL,uL=new lL,hL=new lL;class eV extends Dc{constructor(a=[],d=!1,A="centripetal",x=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=a,this.closed=d,this.curveType=A,this.tension=x}getPoint(a,d=new He){const A=d,x=this.points,w=x.length,M=(w-(this.closed?0:1))*a;let L=Math.floor(M),O=M-L;this.closed?L+=L>0?0:(Math.floor(Math.abs(L)/w)+1)*w:O===0&&L===w-1&&(L=w-2,O=1);let F,H;this.closed||L>0?F=x[(L-1)%w]:(ow.subVectors(x[0],x[1]).add(x[0]),F=ow);const J=x[L%w],K=x[(L+1)%w];if(this.closed||L+2<w?H=x[(L+2)%w]:(ow.subVectors(x[w-1],x[w-2]).add(x[w-1]),H=ow),this.curveType==="centripetal"||this.curveType==="chordal"){const Z=this.curveType==="chordal"?.5:.25;let ie=Math.pow(F.distanceToSquared(J),Z),oe=Math.pow(J.distanceToSquared(K),Z),ne=Math.pow(K.distanceToSquared(H),Z);oe<1e-4&&(oe=1),ie<1e-4&&(ie=oe),ne<1e-4&&(ne=oe),cL.initNonuniformCatmullRom(F.x,J.x,K.x,H.x,ie,oe,ne),uL.initNonuniformCatmullRom(F.y,J.y,K.y,H.y,ie,oe,ne),hL.initNonuniformCatmullRom(F.z,J.z,K.z,H.z,ie,oe,ne)}else this.curveType==="catmullrom"&&(cL.initCatmullRom(F.x,J.x,K.x,H.x,this.tension),uL.initCatmullRom(F.y,J.y,K.y,H.y,this.tension),hL.initCatmullRom(F.z,J.z,K.z,H.z,this.tension));return A.set(cL.calc(O),uL.calc(O),hL.calc(O)),A}copy(a){super.copy(a),this.points=[];for(let d=0,A=a.points.length;d<A;d++){const x=a.points[d];this.points.push(x.clone())}return this.closed=a.closed,this.curveType=a.curveType,this.tension=a.tension,this}toJSON(){const a=super.toJSON();a.points=[];for(let d=0,A=this.points.length;d<A;d++){const x=this.points[d];a.points.push(x.toArray())}return a.closed=this.closed,a.curveType=this.curveType,a.tension=this.tension,a}fromJSON(a){super.fromJSON(a),this.points=[];for(let d=0,A=a.points.length;d<A;d++){const x=a.points[d];this.points.push(new He().fromArray(x))}return this.closed=a.closed,this.curveType=a.curveType,this.tension=a.tension,this}}function tV(S,a,d,A,x){const w=(A-a)*.5,M=(x-d)*.5,L=S*S,O=S*L;return(2*d-2*A+w+M)*O+(-3*d+3*A-2*w-M)*L+w*S+d}function kTe(S,a){const d=1-S;return d*d*a}function FTe(S,a){return 2*(1-S)*S*a}function UTe(S,a){return S*S*a}function wv(S,a,d,A){return kTe(S,a)+FTe(S,d)+UTe(S,A)}function zTe(S,a){const d=1-S;return d*d*d*a}function jTe(S,a){const d=1-S;return 3*d*d*S*a}function VTe(S,a){return 3*(1-S)*S*S*a}function GTe(S,a){return S*S*S*a}function Cv(S,a,d,A,x){return zTe(S,a)+jTe(S,d)+VTe(S,A)+GTe(S,x)}class dL extends Dc{constructor(a=new ai,d=new ai,A=new ai,x=new ai){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=a,this.v1=d,this.v2=A,this.v3=x}getPoint(a,d=new ai){const A=d,x=this.v0,w=this.v1,M=this.v2,L=this.v3;return A.set(Cv(a,x.x,w.x,M.x,L.x),Cv(a,x.y,w.y,M.y,L.y)),A}copy(a){return super.copy(a),this.v0.copy(a.v0),this.v1.copy(a.v1),this.v2.copy(a.v2),this.v3.copy(a.v3),this}toJSON(){const a=super.toJSON();return a.v0=this.v0.toArray(),a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a.v3=this.v3.toArray(),a}fromJSON(a){return super.fromJSON(a),this.v0.fromArray(a.v0),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this.v3.fromArray(a.v3),this}}class iV extends Dc{constructor(a=new He,d=new He,A=new He,x=new He){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=a,this.v1=d,this.v2=A,this.v3=x}getPoint(a,d=new He){const A=d,x=this.v0,w=this.v1,M=this.v2,L=this.v3;return A.set(Cv(a,x.x,w.x,M.x,L.x),Cv(a,x.y,w.y,M.y,L.y),Cv(a,x.z,w.z,M.z,L.z)),A}copy(a){return super.copy(a),this.v0.copy(a.v0),this.v1.copy(a.v1),this.v2.copy(a.v2),this.v3.copy(a.v3),this}toJSON(){const a=super.toJSON();return a.v0=this.v0.toArray(),a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a.v3=this.v3.toArray(),a}fromJSON(a){return super.fromJSON(a),this.v0.fromArray(a.v0),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this.v3.fromArray(a.v3),this}}class pL extends Dc{constructor(a=new ai,d=new ai){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=a,this.v2=d}getPoint(a,d=new ai){const A=d;return a===1?A.copy(this.v2):(A.copy(this.v2).sub(this.v1),A.multiplyScalar(a).add(this.v1)),A}getPointAt(a,d){return this.getPoint(a,d)}getTangent(a,d=new ai){return d.subVectors(this.v2,this.v1).normalize()}getTangentAt(a,d){return this.getTangent(a,d)}copy(a){return super.copy(a),this.v1.copy(a.v1),this.v2.copy(a.v2),this}toJSON(){const a=super.toJSON();return a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a}fromJSON(a){return super.fromJSON(a),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this}}class rV extends Dc{constructor(a=new He,d=new He){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=a,this.v2=d}getPoint(a,d=new He){const A=d;return a===1?A.copy(this.v2):(A.copy(this.v2).sub(this.v1),A.multiplyScalar(a).add(this.v1)),A}getPointAt(a,d){return this.getPoint(a,d)}getTangent(a,d=new He){return d.subVectors(this.v2,this.v1).normalize()}getTangentAt(a,d){return this.getTangent(a,d)}copy(a){return super.copy(a),this.v1.copy(a.v1),this.v2.copy(a.v2),this}toJSON(){const a=super.toJSON();return a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a}fromJSON(a){return super.fromJSON(a),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this}}class fL extends Dc{constructor(a=new ai,d=new ai,A=new ai){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=a,this.v1=d,this.v2=A}getPoint(a,d=new ai){const A=d,x=this.v0,w=this.v1,M=this.v2;return A.set(wv(a,x.x,w.x,M.x),wv(a,x.y,w.y,M.y)),A}copy(a){return super.copy(a),this.v0.copy(a.v0),this.v1.copy(a.v1),this.v2.copy(a.v2),this}toJSON(){const a=super.toJSON();return a.v0=this.v0.toArray(),a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a}fromJSON(a){return super.fromJSON(a),this.v0.fromArray(a.v0),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this}}class mL extends Dc{constructor(a=new He,d=new He,A=new He){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=a,this.v1=d,this.v2=A}getPoint(a,d=new He){const A=d,x=this.v0,w=this.v1,M=this.v2;return A.set(wv(a,x.x,w.x,M.x),wv(a,x.y,w.y,M.y),wv(a,x.z,w.z,M.z)),A}copy(a){return super.copy(a),this.v0.copy(a.v0),this.v1.copy(a.v1),this.v2.copy(a.v2),this}toJSON(){const a=super.toJSON();return a.v0=this.v0.toArray(),a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a}fromJSON(a){return super.fromJSON(a),this.v0.fromArray(a.v0),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this}}class gL extends Dc{constructor(a=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=a}getPoint(a,d=new ai){const A=d,x=this.points,w=(x.length-1)*a,M=Math.floor(w),L=w-M,O=x[M===0?M:M-1],F=x[M],H=x[M>x.length-2?x.length-1:M+1],J=x[M>x.length-3?x.length-1:M+2];return A.set(tV(L,O.x,F.x,H.x,J.x),tV(L,O.y,F.y,H.y,J.y)),A}copy(a){super.copy(a),this.points=[];for(let d=0,A=a.points.length;d<A;d++){const x=a.points[d];this.points.push(x.clone())}return this}toJSON(){const a=super.toJSON();a.points=[];for(let d=0,A=this.points.length;d<A;d++){const x=this.points[d];a.points.push(x.toArray())}return a}fromJSON(a){super.fromJSON(a),this.points=[];for(let d=0,A=a.points.length;d<A;d++){const x=a.points[d];this.points.push(new ai().fromArray(x))}return this}}var lw=Object.freeze({__proto__:null,ArcCurve:$9,CatmullRomCurve3:eV,CubicBezierCurve:dL,CubicBezierCurve3:iV,EllipseCurve:aw,LineCurve:pL,LineCurve3:rV,QuadraticBezierCurve:fL,QuadraticBezierCurve3:mL,SplineCurve:gL});class nV extends Dc{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(a){this.curves.push(a)}closePath(){const a=this.curves[0].getPoint(0),d=this.curves[this.curves.length-1].getPoint(1);if(!a.equals(d)){const A=a.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new lw[A](d,a))}return this}getPoint(a,d){const A=a*this.getLength(),x=this.getCurveLengths();let w=0;for(;w<x.length;){if(x[w]>=A){const M=x[w]-A,L=this.curves[w],O=L.getLength(),F=O===0?0:1-M/O;return L.getPointAt(F,d)}w++}return null}getLength(){const a=this.getCurveLengths();return a[a.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const a=[];let d=0;for(let A=0,x=this.curves.length;A<x;A++)d+=this.curves[A].getLength(),a.push(d);return this.cacheLengths=a,a}getSpacedPoints(a=40){const d=[];for(let A=0;A<=a;A++)d.push(this.getPoint(A/a));return this.autoClose&&d.push(d[0]),d}getPoints(a=12){const d=[];let A;for(let x=0,w=this.curves;x<w.length;x++){const M=w[x],L=M.isEllipseCurve?a*2:M.isLineCurve||M.isLineCurve3?1:M.isSplineCurve?a*M.points.length:a,O=M.getPoints(L);for(let F=0;F<O.length;F++){const H=O[F];A&&A.equals(H)||(d.push(H),A=H)}}return this.autoClose&&d.length>1&&!d[d.length-1].equals(d[0])&&d.push(d[0]),d}copy(a){super.copy(a),this.curves=[];for(let d=0,A=a.curves.length;d<A;d++){const x=a.curves[d];this.curves.push(x.clone())}return this.autoClose=a.autoClose,this}toJSON(){const a=super.toJSON();a.autoClose=this.autoClose,a.curves=[];for(let d=0,A=this.curves.length;d<A;d++){const x=this.curves[d];a.curves.push(x.toJSON())}return a}fromJSON(a){super.fromJSON(a),this.autoClose=a.autoClose,this.curves=[];for(let d=0,A=a.curves.length;d<A;d++){const x=a.curves[d];this.curves.push(new lw[x.type]().fromJSON(x))}return this}}class Sv extends nV{constructor(a){super(),this.type="Path",this.currentPoint=new ai,a&&this.setFromPoints(a)}setFromPoints(a){this.moveTo(a[0].x,a[0].y);for(let d=1,A=a.length;d<A;d++)this.lineTo(a[d].x,a[d].y);return this}moveTo(a,d){return this.currentPoint.set(a,d),this}lineTo(a,d){const A=new pL(this.currentPoint.clone(),new ai(a,d));return this.curves.push(A),this.currentPoint.set(a,d),this}quadraticCurveTo(a,d,A,x){const w=new fL(this.currentPoint.clone(),new ai(a,d),new ai(A,x));return this.curves.push(w),this.currentPoint.set(A,x),this}bezierCurveTo(a,d,A,x,w,M){const L=new dL(this.currentPoint.clone(),new ai(a,d),new ai(A,x),new ai(w,M));return this.curves.push(L),this.currentPoint.set(w,M),this}splineThru(a){const d=[this.currentPoint.clone()].concat(a),A=new gL(d);return this.curves.push(A),this.currentPoint.copy(a[a.length-1]),this}arc(a,d,A,x,w,M){const L=this.currentPoint.x,O=this.currentPoint.y;return this.absarc(a+L,d+O,A,x,w,M),this}absarc(a,d,A,x,w,M){return this.absellipse(a,d,A,A,x,w,M),this}ellipse(a,d,A,x,w,M,L,O){const F=this.currentPoint.x,H=this.currentPoint.y;return this.absellipse(a+F,d+H,A,x,w,M,L,O),this}absellipse(a,d,A,x,w,M,L,O){const F=new aw(a,d,A,x,w,M,L,O);if(this.curves.length>0){const J=F.getPoint(0);J.equals(this.currentPoint)||this.lineTo(J.x,J.y)}this.curves.push(F);const H=F.getPoint(1);return this.currentPoint.copy(H),this}copy(a){return super.copy(a),this.currentPoint.copy(a.currentPoint),this}toJSON(){const a=super.toJSON();return a.currentPoint=this.currentPoint.toArray(),a}fromJSON(a){return super.fromJSON(a),this.currentPoint.fromArray(a.currentPoint),this}}class Tv extends dn{constructor(a=[new ai(0,-.5),new ai(.5,0),new ai(0,.5)],d=12,A=0,x=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:a,segments:d,phiStart:A,phiLength:x},d=Math.floor(d),x=Ts(x,0,Math.PI*2);const w=[],M=[],L=[],O=[],F=[],H=1/d,J=new He,K=new ai,Z=new He,ie=new He,oe=new He;let ne=0,ee=0;for(let Re=0;Re<=a.length-1;Re++)switch(Re){case 0:ne=a[Re+1].x-a[Re].x,ee=a[Re+1].y-a[Re].y,Z.x=ee*1,Z.y=-ne,Z.z=ee*0,oe.copy(Z),Z.normalize(),O.push(Z.x,Z.y,Z.z);break;case a.length-1:O.push(oe.x,oe.y,oe.z);break;default:ne=a[Re+1].x-a[Re].x,ee=a[Re+1].y-a[Re].y,Z.x=ee*1,Z.y=-ne,Z.z=ee*0,ie.copy(Z),Z.x+=oe.x,Z.y+=oe.y,Z.z+=oe.z,Z.normalize(),O.push(Z.x,Z.y,Z.z),oe.copy(ie)}for(let Re=0;Re<=d;Re++){const we=A+Re*H*x,_e=Math.sin(we),st=Math.cos(we);for(let qe=0;qe<=a.length-1;qe++){J.x=a[qe].x*_e,J.y=a[qe].y,J.z=a[qe].x*st,M.push(J.x,J.y,J.z),K.x=Re/d,K.y=qe/(a.length-1),L.push(K.x,K.y);const Ze=O[3*qe+0]*_e,rt=O[3*qe+1],je=O[3*qe+0]*st;F.push(Ze,rt,je)}}for(let Re=0;Re<d;Re++)for(let we=0;we<a.length-1;we++){const _e=we+Re*a.length,st=_e,qe=_e+a.length,Ze=_e+a.length+1,rt=_e+1;w.push(st,qe,rt),w.push(Ze,rt,qe)}this.setIndex(w),this.setAttribute("position",new vr(M,3)),this.setAttribute("uv",new vr(L,2)),this.setAttribute("normal",new vr(F,3))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new Tv(a.points,a.segments,a.phiStart,a.phiLength)}}class cw extends Tv{constructor(a=1,d=1,A=4,x=8){const w=new Sv;w.absarc(0,-d/2,a,Math.PI*1.5,0),w.absarc(0,d/2,a,0,Math.PI*.5),super(w.getPoints(A),x),this.type="CapsuleGeometry",this.parameters={radius:a,length:d,capSegments:A,radialSegments:x}}static fromJSON(a){return new cw(a.radius,a.length,a.capSegments,a.radialSegments)}}class uw extends dn{constructor(a=1,d=32,A=0,x=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:a,segments:d,thetaStart:A,thetaLength:x},d=Math.max(3,d);const w=[],M=[],L=[],O=[],F=new He,H=new ai;M.push(0,0,0),L.push(0,0,1),O.push(.5,.5);for(let J=0,K=3;J<=d;J++,K+=3){const Z=A+J/d*x;F.x=a*Math.cos(Z),F.y=a*Math.sin(Z),M.push(F.x,F.y,F.z),L.push(0,0,1),H.x=(M[K]/a+1)/2,H.y=(M[K+1]/a+1)/2,O.push(H.x,H.y)}for(let J=1;J<=d;J++)w.push(J,J+1,0);this.setIndex(w),this.setAttribute("position",new vr(M,3)),this.setAttribute("normal",new vr(L,3)),this.setAttribute("uv",new vr(O,2))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new uw(a.radius,a.segments,a.thetaStart,a.thetaLength)}}class C0 extends dn{constructor(a=1,d=1,A=1,x=32,w=1,M=!1,L=0,O=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:a,radiusBottom:d,height:A,radialSegments:x,heightSegments:w,openEnded:M,thetaStart:L,thetaLength:O};const F=this;x=Math.floor(x),w=Math.floor(w);const H=[],J=[],K=[],Z=[];let ie=0;const oe=[],ne=A/2;let ee=0;Re(),M===!1&&(a>0&&we(!0),d>0&&we(!1)),this.setIndex(H),this.setAttribute("position",new vr(J,3)),this.setAttribute("normal",new vr(K,3)),this.setAttribute("uv",new vr(Z,2));function Re(){const _e=new He,st=new He;let qe=0;const Ze=(d-a)/A;for(let rt=0;rt<=w;rt++){const je=[],ke=rt/w,nt=ke*(d-a)+a;for(let gt=0;gt<=x;gt++){const ft=gt/x,It=ft*O+L,Ft=Math.sin(It),pi=Math.cos(It);st.x=nt*Ft,st.y=-ke*A+ne,st.z=nt*pi,J.push(st.x,st.y,st.z),_e.set(Ft,Ze,pi).normalize(),K.push(_e.x,_e.y,_e.z),Z.push(ft,1-ke),je.push(ie++)}oe.push(je)}for(let rt=0;rt<x;rt++)for(let je=0;je<w;je++){const ke=oe[je][rt],nt=oe[je+1][rt],gt=oe[je+1][rt+1],ft=oe[je][rt+1];H.push(ke,nt,ft),H.push(nt,gt,ft),qe+=6}F.addGroup(ee,qe,0),ee+=qe}function we(_e){const st=ie,qe=new ai,Ze=new He;let rt=0;const je=_e===!0?a:d,ke=_e===!0?1:-1;for(let gt=1;gt<=x;gt++)J.push(0,ne*ke,0),K.push(0,ke,0),Z.push(.5,.5),ie++;const nt=ie;for(let gt=0;gt<=x;gt++){const ft=gt/x*O+L,It=Math.cos(ft),Ft=Math.sin(ft);Ze.x=je*Ft,Ze.y=ne*ke,Ze.z=je*It,J.push(Ze.x,Ze.y,Ze.z),K.push(0,ke,0),qe.x=It*.5+.5,qe.y=Ft*.5*ke+.5,Z.push(qe.x,qe.y),ie++}for(let gt=0;gt<x;gt++){const ft=st+gt,It=nt+gt;_e===!0?H.push(It,It+1,ft):H.push(It+1,It,ft),rt+=3}F.addGroup(ee,rt,_e===!0?1:2),ee+=rt}}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new C0(a.radiusTop,a.radiusBottom,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength)}}class hw extends C0{constructor(a=1,d=1,A=32,x=1,w=!1,M=0,L=Math.PI*2){super(0,a,d,A,x,w,M,L),this.type="ConeGeometry",this.parameters={radius:a,height:d,radialSegments:A,heightSegments:x,openEnded:w,thetaStart:M,thetaLength:L}}static fromJSON(a){return new hw(a.radius,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength)}}class Hd extends dn{constructor(a=[],d=[],A=1,x=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:a,indices:d,radius:A,detail:x};const w=[],M=[];L(x),F(A),H(),this.setAttribute("position",new vr(w,3)),this.setAttribute("normal",new vr(w.slice(),3)),this.setAttribute("uv",new vr(M,2)),x===0?this.computeVertexNormals():this.normalizeNormals();function L(Re){const we=new He,_e=new He,st=new He;for(let qe=0;qe<d.length;qe+=3)Z(d[qe+0],we),Z(d[qe+1],_e),Z(d[qe+2],st),O(we,_e,st,Re)}function O(Re,we,_e,st){const qe=st+1,Ze=[];for(let rt=0;rt<=qe;rt++){Ze[rt]=[];const je=Re.clone().lerp(_e,rt/qe),ke=we.clone().lerp(_e,rt/qe),nt=qe-rt;for(let gt=0;gt<=nt;gt++)gt===0&&rt===qe?Ze[rt][gt]=je:Ze[rt][gt]=je.clone().lerp(ke,gt/nt)}for(let rt=0;rt<qe;rt++)for(let je=0;je<2*(qe-rt)-1;je++){const ke=Math.floor(je/2);je%2===0?(K(Ze[rt][ke+1]),K(Ze[rt+1][ke]),K(Ze[rt][ke])):(K(Ze[rt][ke+1]),K(Ze[rt+1][ke+1]),K(Ze[rt+1][ke]))}}function F(Re){const we=new He;for(let _e=0;_e<w.length;_e+=3)we.x=w[_e+0],we.y=w[_e+1],we.z=w[_e+2],we.normalize().multiplyScalar(Re),w[_e+0]=we.x,w[_e+1]=we.y,w[_e+2]=we.z}function H(){const Re=new He;for(let we=0;we<w.length;we+=3){Re.x=w[we+0],Re.y=w[we+1],Re.z=w[we+2];const _e=ne(Re)/2/Math.PI+.5,st=ee(Re)/Math.PI+.5;M.push(_e,1-st)}ie(),J()}function J(){for(let Re=0;Re<M.length;Re+=6){const we=M[Re+0],_e=M[Re+2],st=M[Re+4],qe=Math.max(we,_e,st),Ze=Math.min(we,_e,st);qe>.9&&Ze<.1&&(we<.2&&(M[Re+0]+=1),_e<.2&&(M[Re+2]+=1),st<.2&&(M[Re+4]+=1))}}function K(Re){w.push(Re.x,Re.y,Re.z)}function Z(Re,we){const _e=Re*3;we.x=a[_e+0],we.y=a[_e+1],we.z=a[_e+2]}function ie(){const Re=new He,we=new He,_e=new He,st=new He,qe=new ai,Ze=new ai,rt=new ai;for(let je=0,ke=0;je<w.length;je+=9,ke+=6){Re.set(w[je+0],w[je+1],w[je+2]),we.set(w[je+3],w[je+4],w[je+5]),_e.set(w[je+6],w[je+7],w[je+8]),qe.set(M[ke+0],M[ke+1]),Ze.set(M[ke+2],M[ke+3]),rt.set(M[ke+4],M[ke+5]),st.copy(Re).add(we).add(_e).divideScalar(3);const nt=ne(st);oe(qe,ke+0,Re,nt),oe(Ze,ke+2,we,nt),oe(rt,ke+4,_e,nt)}}function oe(Re,we,_e,st){st<0&&Re.x===1&&(M[we]=Re.x-1),_e.x===0&&_e.z===0&&(M[we]=st/2/Math.PI+.5)}function ne(Re){return Math.atan2(Re.z,-Re.x)}function ee(Re){return Math.atan2(-Re.y,Math.sqrt(Re.x*Re.x+Re.z*Re.z))}}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new Hd(a.vertices,a.indices,a.radius,a.details)}}class dw extends Hd{constructor(a=1,d=0){const A=(1+Math.sqrt(5))/2,x=1/A,w=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-x,-A,0,-x,A,0,x,-A,0,x,A,-x,-A,0,-x,A,0,x,-A,0,x,A,0,-A,0,-x,A,0,-x,-A,0,x,A,0,x],M=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(w,M,a,d),this.type="DodecahedronGeometry",this.parameters={radius:a,detail:d}}static fromJSON(a){return new dw(a.radius,a.detail)}}const pw=new He,fw=new He,AL=new He,mw=new Ml;class sV extends dn{constructor(a=null,d=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:a,thresholdAngle:d},a!==null){const A=Math.pow(10,4),x=Math.cos(vh*d),w=a.getIndex(),M=a.getAttribute("position"),L=w?w.count:M.count,O=[0,0,0],F=["a","b","c"],H=new Array(3),J={},K=[];for(let Z=0;Z<L;Z+=3){w?(O[0]=w.getX(Z),O[1]=w.getX(Z+1),O[2]=w.getX(Z+2)):(O[0]=Z,O[1]=Z+1,O[2]=Z+2);const{a:ie,b:oe,c:ne}=mw;if(ie.fromBufferAttribute(M,O[0]),oe.fromBufferAttribute(M,O[1]),ne.fromBufferAttribute(M,O[2]),mw.getNormal(AL),H[0]=`${Math.round(ie.x*A)},${Math.round(ie.y*A)},${Math.round(ie.z*A)}`,H[1]=`${Math.round(oe.x*A)},${Math.round(oe.y*A)},${Math.round(oe.z*A)}`,H[2]=`${Math.round(ne.x*A)},${Math.round(ne.y*A)},${Math.round(ne.z*A)}`,!(H[0]===H[1]||H[1]===H[2]||H[2]===H[0]))for(let ee=0;ee<3;ee++){const Re=(ee+1)%3,we=H[ee],_e=H[Re],st=mw[F[ee]],qe=mw[F[Re]],Ze=`${we}_${_e}`,rt=`${_e}_${we}`;rt in J&&J[rt]?(AL.dot(J[rt].normal)<=x&&(K.push(st.x,st.y,st.z),K.push(qe.x,qe.y,qe.z)),J[rt]=null):Ze in J||(J[Ze]={index0:O[ee],index1:O[Re],normal:AL.clone()})}}for(const Z in J)if(J[Z]){const{index0:ie,index1:oe}=J[Z];pw.fromBufferAttribute(M,ie),fw.fromBufferAttribute(M,oe),K.push(pw.x,pw.y,pw.z),K.push(fw.x,fw.y,fw.z)}this.setAttribute("position",new vr(K,3))}}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}}class _f extends Sv{constructor(a){super(a),this.uuid=Ro(),this.type="Shape",this.holes=[]}getPointsHoles(a){const d=[];for(let A=0,x=this.holes.length;A<x;A++)d[A]=this.holes[A].getPoints(a);return d}extractPoints(a){return{shape:this.getPoints(a),holes:this.getPointsHoles(a)}}copy(a){super.copy(a),this.holes=[];for(let d=0,A=a.holes.length;d<A;d++){const x=a.holes[d];this.holes.push(x.clone())}return this}toJSON(){const a=super.toJSON();a.uuid=this.uuid,a.holes=[];for(let d=0,A=this.holes.length;d<A;d++){const x=this.holes[d];a.holes.push(x.toJSON())}return a}fromJSON(a){super.fromJSON(a),this.uuid=a.uuid,this.holes=[];for(let d=0,A=a.holes.length;d<A;d++){const x=a.holes[d];this.holes.push(new Sv().fromJSON(x))}return this}}const HTe={triangulate:function(S,a,d=2){const A=a&&a.length,x=A?a[0]*d:S.length;let w=aV(S,0,x,d,!0);const M=[];if(!w||w.next===w.prev)return M;let L,O,F,H,J,K,Z;if(A&&(w=YTe(S,a,w,d)),S.length>80*d){L=F=S[0],O=H=S[1];for(let ie=d;ie<x;ie+=d)J=S[ie],K=S[ie+1],J<L&&(L=J),K<O&&(O=K),J>F&&(F=J),K>H&&(H=K);Z=Math.max(F-L,H-O),Z=Z!==0?32767/Z:0}return Mv(w,M,d,L,O,Z,0),M}};function aV(S,a,d,A,x){let w,M;if(x===aMe(S,a,d,A)>0)for(w=a;w<d;w+=A)M=cV(w,S[w],S[w+1],M);else for(w=d-A;w>=a;w-=A)M=cV(w,S[w],S[w+1],M);return M&&gw(M,M.next)&&(Iv(M),M=M.next),M}function Ef(S,a){if(!S)return S;a||(a=S);let d=S,A;do if(A=!1,!d.steiner&&(gw(d,d.next)||Ns(d.prev,d,d.next)===0)){if(Iv(d),d=a=d.prev,d===d.next)break;A=!0}else d=d.next;while(A||d!==a);return a}function Mv(S,a,d,A,x,w,M){if(!S)return;!M&&w&&eMe(S,A,x,w);let L=S,O,F;for(;S.prev!==S.next;){if(O=S.prev,F=S.next,w?QTe(S,A,x,w):WTe(S)){a.push(O.i/d|0),a.push(S.i/d|0),a.push(F.i/d|0),Iv(S),S=F.next,L=F.next;continue}if(S=F,S===L){M?M===1?(S=qTe(Ef(S),a,d),Mv(S,a,d,A,x,w,2)):M===2&&XTe(S,a,d,A,x,w):Mv(Ef(S),a,d,A,x,w,1);break}}}function WTe(S){const a=S.prev,d=S,A=S.next;if(Ns(a,d,A)>=0)return!1;const x=a.x,w=d.x,M=A.x,L=a.y,O=d.y,F=A.y,H=x<w?x<M?x:M:w<M?w:M,J=L<O?L<F?L:F:O<F?O:F,K=x>w?x>M?x:M:w>M?w:M,Z=L>O?L>F?L:F:O>F?O:F;let ie=A.next;for(;ie!==a;){if(ie.x>=H&&ie.x<=K&&ie.y>=J&&ie.y<=Z&&S0(x,L,w,O,M,F,ie.x,ie.y)&&Ns(ie.prev,ie,ie.next)>=0)return!1;ie=ie.next}return!0}function QTe(S,a,d,A){const x=S.prev,w=S,M=S.next;if(Ns(x,w,M)>=0)return!1;const L=x.x,O=w.x,F=M.x,H=x.y,J=w.y,K=M.y,Z=L<O?L<F?L:F:O<F?O:F,ie=H<J?H<K?H:K:J<K?J:K,oe=L>O?L>F?L:F:O>F?O:F,ne=H>J?H>K?H:K:J>K?J:K,ee=yL(Z,ie,a,d,A),Re=yL(oe,ne,a,d,A);let we=S.prevZ,_e=S.nextZ;for(;we&&we.z>=ee&&_e&&_e.z<=Re;){if(we.x>=Z&&we.x<=oe&&we.y>=ie&&we.y<=ne&&we!==x&&we!==M&&S0(L,H,O,J,F,K,we.x,we.y)&&Ns(we.prev,we,we.next)>=0||(we=we.prevZ,_e.x>=Z&&_e.x<=oe&&_e.y>=ie&&_e.y<=ne&&_e!==x&&_e!==M&&S0(L,H,O,J,F,K,_e.x,_e.y)&&Ns(_e.prev,_e,_e.next)>=0))return!1;_e=_e.nextZ}for(;we&&we.z>=ee;){if(we.x>=Z&&we.x<=oe&&we.y>=ie&&we.y<=ne&&we!==x&&we!==M&&S0(L,H,O,J,F,K,we.x,we.y)&&Ns(we.prev,we,we.next)>=0)return!1;we=we.prevZ}for(;_e&&_e.z<=Re;){if(_e.x>=Z&&_e.x<=oe&&_e.y>=ie&&_e.y<=ne&&_e!==x&&_e!==M&&S0(L,H,O,J,F,K,_e.x,_e.y)&&Ns(_e.prev,_e,_e.next)>=0)return!1;_e=_e.nextZ}return!0}function qTe(S,a,d){let A=S;do{const x=A.prev,w=A.next.next;!gw(x,w)&&oV(x,A,A.next,w)&&Rv(x,w)&&Rv(w,x)&&(a.push(x.i/d|0),a.push(A.i/d|0),a.push(w.i/d|0),Iv(A),Iv(A.next),A=S=w),A=A.next}while(A!==S);return Ef(A)}function XTe(S,a,d,A,x,w){let M=S;do{let L=M.next.next;for(;L!==M.prev;){if(M.i!==L.i&&rMe(M,L)){let O=lV(M,L);M=Ef(M,M.next),O=Ef(O,O.next),Mv(M,a,d,A,x,w,0),Mv(O,a,d,A,x,w,0);return}L=L.next}M=M.next}while(M!==S)}function YTe(S,a,d,A){const x=[];let w,M,L,O,F;for(w=0,M=a.length;w<M;w++)L=a[w]*A,O=w<M-1?a[w+1]*A:S.length,F=aV(S,L,O,A,!1),F===F.next&&(F.steiner=!0),x.push(iMe(F));for(x.sort(KTe),w=0;w<x.length;w++)d=JTe(x[w],d);return d}function KTe(S,a){return S.x-a.x}function JTe(S,a){const d=ZTe(S,a);if(!d)return a;const A=lV(d,S);return Ef(A,A.next),Ef(d,d.next)}function ZTe(S,a){let d=a,A=-1/0,x;const w=S.x,M=S.y;do{if(M<=d.y&&M>=d.next.y&&d.next.y!==d.y){const K=d.x+(M-d.y)*(d.next.x-d.x)/(d.next.y-d.y);if(K<=w&&K>A&&(A=K,x=d.x<d.next.x?d:d.next,K===w))return x}d=d.next}while(d!==a);if(!x)return null;const L=x,O=x.x,F=x.y;let H=1/0,J;d=x;do w>=d.x&&d.x>=O&&w!==d.x&&S0(M<F?w:A,M,O,F,M<F?A:w,M,d.x,d.y)&&(J=Math.abs(M-d.y)/(w-d.x),Rv(d,S)&&(J<H||J===H&&(d.x>x.x||d.x===x.x&&$Te(x,d)))&&(x=d,H=J)),d=d.next;while(d!==L);return x}function $Te(S,a){return Ns(S.prev,S,a.prev)<0&&Ns(a.next,S,S.next)<0}function eMe(S,a,d,A){let x=S;do x.z===0&&(x.z=yL(x.x,x.y,a,d,A)),x.prevZ=x.prev,x.nextZ=x.next,x=x.next;while(x!==S);x.prevZ.nextZ=null,x.prevZ=null,tMe(x)}function tMe(S){let a,d,A,x,w,M,L,O,F=1;do{for(d=S,S=null,w=null,M=0;d;){for(M++,A=d,L=0,a=0;a<F&&(L++,A=A.nextZ,!!A);a++);for(O=F;L>0||O>0&&A;)L!==0&&(O===0||!A||d.z<=A.z)?(x=d,d=d.nextZ,L--):(x=A,A=A.nextZ,O--),w?w.nextZ=x:S=x,x.prevZ=w,w=x;d=A}w.nextZ=null,F*=2}while(M>1);return S}function yL(S,a,d,A,x){return S=(S-d)*x|0,a=(a-A)*x|0,S=(S|S<<8)&16711935,S=(S|S<<4)&252645135,S=(S|S<<2)&858993459,S=(S|S<<1)&1431655765,a=(a|a<<8)&16711935,a=(a|a<<4)&252645135,a=(a|a<<2)&858993459,a=(a|a<<1)&1431655765,S|a<<1}function iMe(S){let a=S,d=S;do(a.x<d.x||a.x===d.x&&a.y<d.y)&&(d=a),a=a.next;while(a!==S);return d}function S0(S,a,d,A,x,w,M,L){return(x-M)*(a-L)>=(S-M)*(w-L)&&(S-M)*(A-L)>=(d-M)*(a-L)&&(d-M)*(w-L)>=(x-M)*(A-L)}function rMe(S,a){return S.next.i!==a.i&&S.prev.i!==a.i&&!nMe(S,a)&&(Rv(S,a)&&Rv(a,S)&&sMe(S,a)&&(Ns(S.prev,S,a.prev)||Ns(S,a.prev,a))||gw(S,a)&&Ns(S.prev,S,S.next)>0&&Ns(a.prev,a,a.next)>0)}function Ns(S,a,d){return(a.y-S.y)*(d.x-a.x)-(a.x-S.x)*(d.y-a.y)}function gw(S,a){return S.x===a.x&&S.y===a.y}function oV(S,a,d,A){const x=yw(Ns(S,a,d)),w=yw(Ns(S,a,A)),M=yw(Ns(d,A,S)),L=yw(Ns(d,A,a));return!!(x!==w&&M!==L||x===0&&Aw(S,d,a)||w===0&&Aw(S,A,a)||M===0&&Aw(d,S,A)||L===0&&Aw(d,a,A))}function Aw(S,a,d){return a.x<=Math.max(S.x,d.x)&&a.x>=Math.min(S.x,d.x)&&a.y<=Math.max(S.y,d.y)&&a.y>=Math.min(S.y,d.y)}function yw(S){return S>0?1:S<0?-1:0}function nMe(S,a){let d=S;do{if(d.i!==S.i&&d.next.i!==S.i&&d.i!==a.i&&d.next.i!==a.i&&oV(d,d.next,S,a))return!0;d=d.next}while(d!==S);return!1}function Rv(S,a){return Ns(S.prev,S,S.next)<0?Ns(S,a,S.next)>=0&&Ns(S,S.prev,a)>=0:Ns(S,a,S.prev)<0||Ns(S,S.next,a)<0}function sMe(S,a){let d=S,A=!1;const x=(S.x+a.x)/2,w=(S.y+a.y)/2;do d.y>w!=d.next.y>w&&d.next.y!==d.y&&x<(d.next.x-d.x)*(w-d.y)/(d.next.y-d.y)+d.x&&(A=!A),d=d.next;while(d!==S);return A}function lV(S,a){const d=new vL(S.i,S.x,S.y),A=new vL(a.i,a.x,a.y),x=S.next,w=a.prev;return S.next=a,a.prev=S,d.next=x,x.prev=d,A.next=d,d.prev=A,w.next=A,A.prev=w,A}function cV(S,a,d,A){const x=new vL(S,a,d);return A?(x.next=A.next,x.prev=A,A.next.prev=x,A.next=x):(x.prev=x,x.next=x),x}function Iv(S){S.next.prev=S.prev,S.prev.next=S.next,S.prevZ&&(S.prevZ.nextZ=S.nextZ),S.nextZ&&(S.nextZ.prevZ=S.prevZ)}function vL(S,a,d){this.i=S,this.x=a,this.y=d,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function aMe(S,a,d,A){let x=0;for(let w=a,M=d-A;w<d;w+=A)x+=(S[M]-S[w])*(S[w+1]+S[M+1]),M=w;return x}class ou{static area(a){const d=a.length;let A=0;for(let x=d-1,w=0;w<d;x=w++)A+=a[x].x*a[w].y-a[w].x*a[x].y;return A*.5}static isClockWise(a){return ou.area(a)<0}static triangulateShape(a,d){const A=[],x=[],w=[];uV(a),hV(A,a);let M=a.length;d.forEach(uV);for(let O=0;O<d.length;O++)x.push(M),M+=d[O].length,hV(A,d[O]);const L=HTe.triangulate(A,x);for(let O=0;O<L.length;O+=3)w.push(L.slice(O,O+3));return w}}function uV(S){const a=S.length;a>2&&S[a-1].equals(S[0])&&S.pop()}function hV(S,a){for(let d=0;d<a.length;d++)S.push(a[d].x),S.push(a[d].y)}class vw extends dn{constructor(a=new _f([new ai(.5,.5),new ai(-.5,.5),new ai(-.5,-.5),new ai(.5,-.5)]),d={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:a,options:d},a=Array.isArray(a)?a:[a];const A=this,x=[],w=[];for(let L=0,O=a.length;L<O;L++){const F=a[L];M(F)}this.setAttribute("position",new vr(x,3)),this.setAttribute("uv",new vr(w,2)),this.computeVertexNormals();function M(L){const O=[],F=d.curveSegments!==void 0?d.curveSegments:12,H=d.steps!==void 0?d.steps:1,J=d.depth!==void 0?d.depth:1;let K=d.bevelEnabled!==void 0?d.bevelEnabled:!0,Z=d.bevelThickness!==void 0?d.bevelThickness:.2,ie=d.bevelSize!==void 0?d.bevelSize:Z-.1,oe=d.bevelOffset!==void 0?d.bevelOffset:0,ne=d.bevelSegments!==void 0?d.bevelSegments:3;const ee=d.extrudePath,Re=d.UVGenerator!==void 0?d.UVGenerator:oMe;let we,_e=!1,st,qe,Ze,rt;ee&&(we=ee.getSpacedPoints(H),_e=!0,K=!1,st=ee.computeFrenetFrames(H,!1),qe=new He,Ze=new He,rt=new He),K||(ne=0,Z=0,ie=0,oe=0);const je=L.extractPoints(F);let ke=je.shape;const nt=je.holes;if(!ou.isClockWise(ke)){ke=ke.reverse();for(let tt=0,mi=nt.length;tt<mi;tt++){const ti=nt[tt];ou.isClockWise(ti)&&(nt[tt]=ti.reverse())}}const gt=ou.triangulateShape(ke,nt),ft=ke;for(let tt=0,mi=nt.length;tt<mi;tt++){const ti=nt[tt];ke=ke.concat(ti)}function It(tt,mi,ti){return mi||console.error("THREE.ExtrudeGeometry: vec does not exist"),tt.clone().addScaledVector(mi,ti)}const Ft=ke.length,pi=gt.length;function Ni(tt,mi,ti){let er,li,ir;const tr=tt.x-mi.x,Ar=tt.y-mi.y,An=ti.x-tt.x,Wr=ti.y-tt.y,ha=tr*tr+Ar*Ar,Ys=tr*Wr-Ar*An;if(Math.abs(Ys)>Number.EPSILON){const Hn=Math.sqrt(ha),et=Math.sqrt(An*An+Wr*Wr),Pe=mi.x-Ar/Hn,zt=mi.y+tr/Hn,di=ti.x-Wr/et,gi=ti.y+An/et,oi=((di-Pe)*Wr-(gi-zt)*An)/(tr*Wr-Ar*An);er=Pe+tr*oi-tt.x,li=zt+Ar*oi-tt.y;const Rr=er*er+li*li;if(Rr<=2)return new ai(er,li);ir=Math.sqrt(Rr/2)}else{let Hn=!1;tr>Number.EPSILON?An>Number.EPSILON&&(Hn=!0):tr<-Number.EPSILON?An<-Number.EPSILON&&(Hn=!0):Math.sign(Ar)===Math.sign(Wr)&&(Hn=!0),Hn?(er=-Ar,li=tr,ir=Math.sqrt(ha)):(er=tr,li=Ar,ir=Math.sqrt(ha/2))}return new ai(er/ir,li/ir)}const Ut=[];for(let tt=0,mi=ft.length,ti=mi-1,er=tt+1;tt<mi;tt++,ti++,er++)ti===mi&&(ti=0),er===mi&&(er=0),Ut[tt]=Ni(ft[tt],ft[ti],ft[er]);const yi=[];let Pi,Ur=Ut.concat();for(let tt=0,mi=nt.length;tt<mi;tt++){const ti=nt[tt];Pi=[];for(let er=0,li=ti.length,ir=li-1,tr=er+1;er<li;er++,ir++,tr++)ir===li&&(ir=0),tr===li&&(tr=0),Pi[er]=Ni(ti[er],ti[ir],ti[tr]);yi.push(Pi),Ur=Ur.concat(Pi)}for(let tt=0;tt<ne;tt++){const mi=tt/ne,ti=Z*Math.cos(mi*Math.PI/2),er=ie*Math.sin(mi*Math.PI/2)+oe;for(let li=0,ir=ft.length;li<ir;li++){const tr=It(ft[li],Ut[li],er);Bn(tr.x,tr.y,-ti)}for(let li=0,ir=nt.length;li<ir;li++){const tr=nt[li];Pi=yi[li];for(let Ar=0,An=tr.length;Ar<An;Ar++){const Wr=It(tr[Ar],Pi[Ar],er);Bn(Wr.x,Wr.y,-ti)}}}const xn=ie+oe;for(let tt=0;tt<Ft;tt++){const mi=K?It(ke[tt],Ur[tt],xn):ke[tt];_e?(Ze.copy(st.normals[0]).multiplyScalar(mi.x),qe.copy(st.binormals[0]).multiplyScalar(mi.y),rt.copy(we[0]).add(Ze).add(qe),Bn(rt.x,rt.y,rt.z)):Bn(mi.x,mi.y,0)}for(let tt=1;tt<=H;tt++)for(let mi=0;mi<Ft;mi++){const ti=K?It(ke[mi],Ur[mi],xn):ke[mi];_e?(Ze.copy(st.normals[tt]).multiplyScalar(ti.x),qe.copy(st.binormals[tt]).multiplyScalar(ti.y),rt.copy(we[tt]).add(Ze).add(qe),Bn(rt.x,rt.y,rt.z)):Bn(ti.x,ti.y,J/H*tt)}for(let tt=ne-1;tt>=0;tt--){const mi=tt/ne,ti=Z*Math.cos(mi*Math.PI/2),er=ie*Math.sin(mi*Math.PI/2)+oe;for(let li=0,ir=ft.length;li<ir;li++){const tr=It(ft[li],Ut[li],er);Bn(tr.x,tr.y,J+ti)}for(let li=0,ir=nt.length;li<ir;li++){const tr=nt[li];Pi=yi[li];for(let Ar=0,An=tr.length;Ar<An;Ar++){const Wr=It(tr[Ar],Pi[Ar],er);_e?Bn(Wr.x,Wr.y+we[H-1].y,we[H-1].x+ti):Bn(Wr.x,Wr.y,J+ti)}}}ts(),ds();function ts(){const tt=x.length/3;if(K){let mi=0,ti=Ft*mi;for(let er=0;er<pi;er++){const li=gt[er];Cr(li[2]+ti,li[1]+ti,li[0]+ti)}mi=H+ne*2,ti=Ft*mi;for(let er=0;er<pi;er++){const li=gt[er];Cr(li[0]+ti,li[1]+ti,li[2]+ti)}}else{for(let mi=0;mi<pi;mi++){const ti=gt[mi];Cr(ti[2],ti[1],ti[0])}for(let mi=0;mi<pi;mi++){const ti=gt[mi];Cr(ti[0]+Ft*H,ti[1]+Ft*H,ti[2]+Ft*H)}}A.addGroup(tt,x.length/3-tt,0)}function ds(){const tt=x.length/3;let mi=0;zn(ft,mi),mi+=ft.length;for(let ti=0,er=nt.length;ti<er;ti++){const li=nt[ti];zn(li,mi),mi+=li.length}A.addGroup(tt,x.length/3-tt,1)}function zn(tt,mi){let ti=tt.length;for(;--ti>=0;){const er=ti;let li=ti-1;li<0&&(li=tt.length-1);for(let ir=0,tr=H+ne*2;ir<tr;ir++){const Ar=Ft*ir,An=Ft*(ir+1),Wr=mi+er+Ar,ha=mi+li+Ar,Ys=mi+li+An,Hn=mi+er+An;hi(Wr,ha,Ys,Hn)}}}function Bn(tt,mi,ti){O.push(tt),O.push(mi),O.push(ti)}function Cr(tt,mi,ti){Ci(tt),Ci(mi),Ci(ti);const er=x.length/3,li=Re.generateTopUV(A,x,er-3,er-2,er-1);qi(li[0]),qi(li[1]),qi(li[2])}function hi(tt,mi,ti,er){Ci(tt),Ci(mi),Ci(er),Ci(mi),Ci(ti),Ci(er);const li=x.length/3,ir=Re.generateSideWallUV(A,x,li-6,li-3,li-2,li-1);qi(ir[0]),qi(ir[1]),qi(ir[3]),qi(ir[1]),qi(ir[2]),qi(ir[3])}function Ci(tt){x.push(O[tt*3+0]),x.push(O[tt*3+1]),x.push(O[tt*3+2])}function qi(tt){w.push(tt.x),w.push(tt.y)}}}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}toJSON(){const a=super.toJSON(),d=this.parameters.shapes,A=this.parameters.options;return lMe(d,A,a)}static fromJSON(a,d){const A=[];for(let w=0,M=a.shapes.length;w<M;w++){const L=d[a.shapes[w]];A.push(L)}const x=a.options.extrudePath;return x!==void 0&&(a.options.extrudePath=new lw[x.type]().fromJSON(x)),new vw(A,a.options)}}const oMe={generateTopUV:function(S,a,d,A,x){const w=a[d*3],M=a[d*3+1],L=a[A*3],O=a[A*3+1],F=a[x*3],H=a[x*3+1];return[new ai(w,M),new ai(L,O),new ai(F,H)]},generateSideWallUV:function(S,a,d,A,x,w){const M=a[d*3],L=a[d*3+1],O=a[d*3+2],F=a[A*3],H=a[A*3+1],J=a[A*3+2],K=a[x*3],Z=a[x*3+1],ie=a[x*3+2],oe=a[w*3],ne=a[w*3+1],ee=a[w*3+2];return Math.abs(L-H)<Math.abs(M-F)?[new ai(M,1-O),new ai(F,1-J),new ai(K,1-ie),new ai(oe,1-ee)]:[new ai(L,1-O),new ai(H,1-J),new ai(Z,1-ie),new ai(ne,1-ee)]}};function lMe(S,a,d){if(d.shapes=[],Array.isArray(S))for(let A=0,x=S.length;A<x;A++){const w=S[A];d.shapes.push(w.uuid)}else d.shapes.push(S.uuid);return d.options=Object.assign({},a),a.extrudePath!==void 0&&(d.options.extrudePath=a.extrudePath.toJSON()),d}class bw extends Hd{constructor(a=1,d=0){const A=(1+Math.sqrt(5))/2,x=[-1,A,0,1,A,0,-1,-A,0,1,-A,0,0,-1,A,0,1,A,0,-1,-A,0,1,-A,A,0,-1,A,0,1,-A,0,-1,-A,0,1],w=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(x,w,a,d),this.type="IcosahedronGeometry",this.parameters={radius:a,detail:d}}static fromJSON(a){return new bw(a.radius,a.detail)}}class Bv extends Hd{constructor(a=1,d=0){const A=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],x=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(A,x,a,d),this.type="OctahedronGeometry",this.parameters={radius:a,detail:d}}static fromJSON(a){return new Bv(a.radius,a.detail)}}class xw extends dn{constructor(a=.5,d=1,A=32,x=1,w=0,M=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:a,outerRadius:d,thetaSegments:A,phiSegments:x,thetaStart:w,thetaLength:M},A=Math.max(3,A),x=Math.max(1,x);const L=[],O=[],F=[],H=[];let J=a;const K=(d-a)/x,Z=new He,ie=new ai;for(let oe=0;oe<=x;oe++){for(let ne=0;ne<=A;ne++){const ee=w+ne/A*M;Z.x=J*Math.cos(ee),Z.y=J*Math.sin(ee),O.push(Z.x,Z.y,Z.z),F.push(0,0,1),ie.x=(Z.x/d+1)/2,ie.y=(Z.y/d+1)/2,H.push(ie.x,ie.y)}J+=K}for(let oe=0;oe<x;oe++){const ne=oe*(A+1);for(let ee=0;ee<A;ee++){const Re=ee+ne,we=Re,_e=Re+A+1,st=Re+A+2,qe=Re+1;L.push(we,_e,qe),L.push(_e,st,qe)}}this.setIndex(L),this.setAttribute("position",new vr(O,3)),this.setAttribute("normal",new vr(F,3)),this.setAttribute("uv",new vr(H,2))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new xw(a.innerRadius,a.outerRadius,a.thetaSegments,a.phiSegments,a.thetaStart,a.thetaLength)}}class _w extends dn{constructor(a=new _f([new ai(0,.5),new ai(-.5,-.5),new ai(.5,-.5)]),d=12){super(),this.type="ShapeGeometry",this.parameters={shapes:a,curveSegments:d};const A=[],x=[],w=[],M=[];let L=0,O=0;if(Array.isArray(a)===!1)F(a);else for(let H=0;H<a.length;H++)F(a[H]),this.addGroup(L,O,H),L+=O,O=0;this.setIndex(A),this.setAttribute("position",new vr(x,3)),this.setAttribute("normal",new vr(w,3)),this.setAttribute("uv",new vr(M,2));function F(H){const J=x.length/3,K=H.extractPoints(d);let Z=K.shape;const ie=K.holes;ou.isClockWise(Z)===!1&&(Z=Z.reverse());for(let ne=0,ee=ie.length;ne<ee;ne++){const Re=ie[ne];ou.isClockWise(Re)===!0&&(ie[ne]=Re.reverse())}const oe=ou.triangulateShape(Z,ie);for(let ne=0,ee=ie.length;ne<ee;ne++){const Re=ie[ne];Z=Z.concat(Re)}for(let ne=0,ee=Z.length;ne<ee;ne++){const Re=Z[ne];x.push(Re.x,Re.y,0),w.push(0,0,1),M.push(Re.x,Re.y)}for(let ne=0,ee=oe.length;ne<ee;ne++){const Re=oe[ne],we=Re[0]+J,_e=Re[1]+J,st=Re[2]+J;A.push(we,_e,st),O+=3}}}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}toJSON(){const a=super.toJSON(),d=this.parameters.shapes;return cMe(d,a)}static fromJSON(a,d){const A=[];for(let x=0,w=a.shapes.length;x<w;x++){const M=d[a.shapes[x]];A.push(M)}return new _w(A,a.curveSegments)}}function cMe(S,a){if(a.shapes=[],Array.isArray(S))for(let d=0,A=S.length;d<A;d++){const x=S[d];a.shapes.push(x.uuid)}else a.shapes.push(S.uuid);return a}class Lv extends dn{constructor(a=1,d=32,A=16,x=0,w=Math.PI*2,M=0,L=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:a,widthSegments:d,heightSegments:A,phiStart:x,phiLength:w,thetaStart:M,thetaLength:L},d=Math.max(3,Math.floor(d)),A=Math.max(2,Math.floor(A));const O=Math.min(M+L,Math.PI);let F=0;const H=[],J=new He,K=new He,Z=[],ie=[],oe=[],ne=[];for(let ee=0;ee<=A;ee++){const Re=[],we=ee/A;let _e=0;ee===0&&M===0?_e=.5/d:ee===A&&O===Math.PI&&(_e=-.5/d);for(let st=0;st<=d;st++){const qe=st/d;J.x=-a*Math.cos(x+qe*w)*Math.sin(M+we*L),J.y=a*Math.cos(M+we*L),J.z=a*Math.sin(x+qe*w)*Math.sin(M+we*L),ie.push(J.x,J.y,J.z),K.copy(J).normalize(),oe.push(K.x,K.y,K.z),ne.push(qe+_e,1-we),Re.push(F++)}H.push(Re)}for(let ee=0;ee<A;ee++)for(let Re=0;Re<d;Re++){const we=H[ee][Re+1],_e=H[ee][Re],st=H[ee+1][Re],qe=H[ee+1][Re+1];(ee!==0||M>0)&&Z.push(we,_e,qe),(ee!==A-1||O<Math.PI)&&Z.push(_e,st,qe)}this.setIndex(Z),this.setAttribute("position",new vr(ie,3)),this.setAttribute("normal",new vr(oe,3)),this.setAttribute("uv",new vr(ne,2))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new Lv(a.radius,a.widthSegments,a.heightSegments,a.phiStart,a.phiLength,a.thetaStart,a.thetaLength)}}class Ew extends Hd{constructor(a=1,d=0){const A=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],x=[2,1,0,0,3,2,1,3,0,2,3,1];super(A,x,a,d),this.type="TetrahedronGeometry",this.parameters={radius:a,detail:d}}static fromJSON(a){return new Ew(a.radius,a.detail)}}class ww extends dn{constructor(a=1,d=.4,A=12,x=48,w=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:a,tube:d,radialSegments:A,tubularSegments:x,arc:w},A=Math.floor(A),x=Math.floor(x);const M=[],L=[],O=[],F=[],H=new He,J=new He,K=new He;for(let Z=0;Z<=A;Z++)for(let ie=0;ie<=x;ie++){const oe=ie/x*w,ne=Z/A*Math.PI*2;J.x=(a+d*Math.cos(ne))*Math.cos(oe),J.y=(a+d*Math.cos(ne))*Math.sin(oe),J.z=d*Math.sin(ne),L.push(J.x,J.y,J.z),H.x=a*Math.cos(oe),H.y=a*Math.sin(oe),K.subVectors(J,H).normalize(),O.push(K.x,K.y,K.z),F.push(ie/x),F.push(Z/A)}for(let Z=1;Z<=A;Z++)for(let ie=1;ie<=x;ie++){const oe=(x+1)*Z+ie-1,ne=(x+1)*(Z-1)+ie-1,ee=(x+1)*(Z-1)+ie,Re=(x+1)*Z+ie;M.push(oe,ne,Re),M.push(ne,ee,Re)}this.setIndex(M),this.setAttribute("position",new vr(L,3)),this.setAttribute("normal",new vr(O,3)),this.setAttribute("uv",new vr(F,2))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new ww(a.radius,a.tube,a.radialSegments,a.tubularSegments,a.arc)}}class Cw extends dn{constructor(a=1,d=.4,A=64,x=8,w=2,M=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:a,tube:d,tubularSegments:A,radialSegments:x,p:w,q:M},A=Math.floor(A),x=Math.floor(x);const L=[],O=[],F=[],H=[],J=new He,K=new He,Z=new He,ie=new He,oe=new He,ne=new He,ee=new He;for(let we=0;we<=A;++we){const _e=we/A*w*Math.PI*2;Re(_e,w,M,a,Z),Re(_e+.01,w,M,a,ie),ne.subVectors(ie,Z),ee.addVectors(ie,Z),oe.crossVectors(ne,ee),ee.crossVectors(oe,ne),oe.normalize(),ee.normalize();for(let st=0;st<=x;++st){const qe=st/x*Math.PI*2,Ze=-d*Math.cos(qe),rt=d*Math.sin(qe);J.x=Z.x+(Ze*ee.x+rt*oe.x),J.y=Z.y+(Ze*ee.y+rt*oe.y),J.z=Z.z+(Ze*ee.z+rt*oe.z),O.push(J.x,J.y,J.z),K.subVectors(J,Z).normalize(),F.push(K.x,K.y,K.z),H.push(we/A),H.push(st/x)}}for(let we=1;we<=A;we++)for(let _e=1;_e<=x;_e++){const st=(x+1)*(we-1)+(_e-1),qe=(x+1)*we+(_e-1),Ze=(x+1)*we+_e,rt=(x+1)*(we-1)+_e;L.push(st,qe,rt),L.push(qe,Ze,rt)}this.setIndex(L),this.setAttribute("position",new vr(O,3)),this.setAttribute("normal",new vr(F,3)),this.setAttribute("uv",new vr(H,2));function Re(we,_e,st,qe,Ze){const rt=Math.cos(we),je=Math.sin(we),ke=st/_e*we,nt=Math.cos(ke);Ze.x=qe*(2+nt)*.5*rt,Ze.y=qe*(2+nt)*je*.5,Ze.z=qe*Math.sin(ke)*.5}}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new Cw(a.radius,a.tube,a.tubularSegments,a.radialSegments,a.p,a.q)}}class Sw extends dn{constructor(a=new mL(new He(-1,-1,0),new He(-1,1,0),new He(1,1,0)),d=64,A=1,x=8,w=!1){super(),this.type="TubeGeometry",this.parameters={path:a,tubularSegments:d,radius:A,radialSegments:x,closed:w};const M=a.computeFrenetFrames(d,w);this.tangents=M.tangents,this.normals=M.normals,this.binormals=M.binormals;const L=new He,O=new He,F=new ai;let H=new He;const J=[],K=[],Z=[],ie=[];oe(),this.setIndex(ie),this.setAttribute("position",new vr(J,3)),this.setAttribute("normal",new vr(K,3)),this.setAttribute("uv",new vr(Z,2));function oe(){for(let we=0;we<d;we++)ne(we);ne(w===!1?d:0),Re(),ee()}function ne(we){H=a.getPointAt(we/d,H);const _e=M.normals[we],st=M.binormals[we];for(let qe=0;qe<=x;qe++){const Ze=qe/x*Math.PI*2,rt=Math.sin(Ze),je=-Math.cos(Ze);O.x=je*_e.x+rt*st.x,O.y=je*_e.y+rt*st.y,O.z=je*_e.z+rt*st.z,O.normalize(),K.push(O.x,O.y,O.z),L.x=H.x+A*O.x,L.y=H.y+A*O.y,L.z=H.z+A*O.z,J.push(L.x,L.y,L.z)}}function ee(){for(let we=1;we<=d;we++)for(let _e=1;_e<=x;_e++){const st=(x+1)*(we-1)+(_e-1),qe=(x+1)*we+(_e-1),Ze=(x+1)*we+_e,rt=(x+1)*(we-1)+_e;ie.push(st,qe,rt),ie.push(qe,Ze,rt)}}function Re(){for(let we=0;we<=d;we++)for(let _e=0;_e<=x;_e++)F.x=we/d,F.y=_e/x,Z.push(F.x,F.y)}}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}toJSON(){const a=super.toJSON();return a.path=this.parameters.path.toJSON(),a}static fromJSON(a){return new Sw(new lw[a.path.type]().fromJSON(a.path),a.tubularSegments,a.radius,a.radialSegments,a.closed)}}class dV extends dn{constructor(a=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:a},a!==null){const d=[],A=new Set,x=new He,w=new He;if(a.index!==null){const M=a.attributes.position,L=a.index;let O=a.groups;O.length===0&&(O=[{start:0,count:L.count,materialIndex:0}]);for(let F=0,H=O.length;F<H;++F){const J=O[F],K=J.start,Z=J.count;for(let ie=K,oe=K+Z;ie<oe;ie+=3)for(let ne=0;ne<3;ne++){const ee=L.getX(ie+ne),Re=L.getX(ie+(ne+1)%3);x.fromBufferAttribute(M,ee),w.fromBufferAttribute(M,Re),pV(x,w,A)===!0&&(d.push(x.x,x.y,x.z),d.push(w.x,w.y,w.z))}}}else{const M=a.attributes.position;for(let L=0,O=M.count/3;L<O;L++)for(let F=0;F<3;F++){const H=3*L+F,J=3*L+(F+1)%3;x.fromBufferAttribute(M,H),w.fromBufferAttribute(M,J),pV(x,w,A)===!0&&(d.push(x.x,x.y,x.z),d.push(w.x,w.y,w.z))}}this.setAttribute("position",new vr(d,3))}}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}}function pV(S,a,d){const A=`${S.x},${S.y},${S.z}-${a.x},${a.y},${a.z}`,x=`${a.x},${a.y},${a.z}-${S.x},${S.y},${S.z}`;return d.has(A)===!0||d.has(x)===!0?!1:(d.add(A),d.add(x),!0)}var fV=Object.freeze({__proto__:null,BoxGeometry:pf,CapsuleGeometry:cw,CircleGeometry:uw,ConeGeometry:hw,CylinderGeometry:C0,DodecahedronGeometry:dw,EdgesGeometry:sV,ExtrudeGeometry:vw,IcosahedronGeometry:bw,LatheGeometry:Tv,OctahedronGeometry:Bv,PlaneGeometry:f0,PolyhedronGeometry:Hd,RingGeometry:xw,ShapeGeometry:_w,SphereGeometry:Lv,TetrahedronGeometry:Ew,TorusGeometry:ww,TorusKnotGeometry:Cw,TubeGeometry:Sw,WireframeGeometry:dV});class mV extends co{constructor(a){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new or(0),this.transparent=!0,this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.fog=a.fog,this}}class gV extends Bc{constructor(a){super(a),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class bL extends co{constructor(a){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new or(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new or(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ao,this.normalScale=new ai(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Tl,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.defines={STANDARD:""},this.color.copy(a.color),this.roughness=a.roughness,this.metalness=a.metalness,this.map=a.map,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.emissive.copy(a.emissive),this.emissiveMap=a.emissiveMap,this.emissiveIntensity=a.emissiveIntensity,this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.roughnessMap=a.roughnessMap,this.metalnessMap=a.metalnessMap,this.alphaMap=a.alphaMap,this.envMap=a.envMap,this.envMapRotation.copy(a.envMapRotation),this.envMapIntensity=a.envMapIntensity,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.flatShading=a.flatShading,this.fog=a.fog,this}}class AV extends bL{constructor(a){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new ai(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Ts(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(d){this.ior=(1+.4*d)/(1-.4*d)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new or(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new or(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new or(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(a)}get anisotropy(){return this._anisotropy}set anisotropy(a){this._anisotropy>0!=a>0&&this.version++,this._anisotropy=a}get clearcoat(){return this._clearcoat}set clearcoat(a){this._clearcoat>0!=a>0&&this.version++,this._clearcoat=a}get iridescence(){return this._iridescence}set iridescence(a){this._iridescence>0!=a>0&&this.version++,this._iridescence=a}get dispersion(){return this._dispersion}set dispersion(a){this._dispersion>0!=a>0&&this.version++,this._dispersion=a}get sheen(){return this._sheen}set sheen(a){this._sheen>0!=a>0&&this.version++,this._sheen=a}get transmission(){return this._transmission}set transmission(a){this._transmission>0!=a>0&&this.version++,this._transmission=a}copy(a){return super.copy(a),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=a.anisotropy,this.anisotropyRotation=a.anisotropyRotation,this.anisotropyMap=a.anisotropyMap,this.clearcoat=a.clearcoat,this.clearcoatMap=a.clearcoatMap,this.clearcoatRoughness=a.clearcoatRoughness,this.clearcoatRoughnessMap=a.clearcoatRoughnessMap,this.clearcoatNormalMap=a.clearcoatNormalMap,this.clearcoatNormalScale.copy(a.clearcoatNormalScale),this.dispersion=a.dispersion,this.ior=a.ior,this.iridescence=a.iridescence,this.iridescenceMap=a.iridescenceMap,this.iridescenceIOR=a.iridescenceIOR,this.iridescenceThicknessRange=[...a.iridescenceThicknessRange],this.iridescenceThicknessMap=a.iridescenceThicknessMap,this.sheen=a.sheen,this.sheenColor.copy(a.sheenColor),this.sheenColorMap=a.sheenColorMap,this.sheenRoughness=a.sheenRoughness,this.sheenRoughnessMap=a.sheenRoughnessMap,this.transmission=a.transmission,this.transmissionMap=a.transmissionMap,this.thickness=a.thickness,this.thicknessMap=a.thicknessMap,this.attenuationDistance=a.attenuationDistance,this.attenuationColor.copy(a.attenuationColor),this.specularIntensity=a.specularIntensity,this.specularIntensityMap=a.specularIntensityMap,this.specularColor.copy(a.specularColor),this.specularColorMap=a.specularColorMap,this}}class yV extends co{constructor(a){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new or(16777215),this.specular=new or(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new or(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ao,this.normalScale=new ai(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Tl,this.combine=We,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.specular.copy(a.specular),this.shininess=a.shininess,this.map=a.map,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.emissive.copy(a.emissive),this.emissiveMap=a.emissiveMap,this.emissiveIntensity=a.emissiveIntensity,this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.specularMap=a.specularMap,this.alphaMap=a.alphaMap,this.envMap=a.envMap,this.envMapRotation.copy(a.envMapRotation),this.combine=a.combine,this.reflectivity=a.reflectivity,this.refractionRatio=a.refractionRatio,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.flatShading=a.flatShading,this.fog=a.fog,this}}class vV extends co{constructor(a){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new or(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new or(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ao,this.normalScale=new ai(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.map=a.map,this.gradientMap=a.gradientMap,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.emissive.copy(a.emissive),this.emissiveMap=a.emissiveMap,this.emissiveIntensity=a.emissiveIntensity,this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.alphaMap=a.alphaMap,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.fog=a.fog,this}}class bV extends co{constructor(a){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ao,this.normalScale=new ai(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(a)}copy(a){return super.copy(a),this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.flatShading=a.flatShading,this}}class xV extends co{constructor(a){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new or(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new or(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ao,this.normalScale=new ai(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Tl,this.combine=We,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.map=a.map,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.emissive.copy(a.emissive),this.emissiveMap=a.emissiveMap,this.emissiveIntensity=a.emissiveIntensity,this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.specularMap=a.specularMap,this.alphaMap=a.alphaMap,this.envMap=a.envMap,this.envMapRotation.copy(a.envMapRotation),this.combine=a.combine,this.reflectivity=a.reflectivity,this.refractionRatio=a.refractionRatio,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.flatShading=a.flatShading,this.fog=a.fog,this}}class _V extends co{constructor(a){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new or(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ao,this.normalScale=new ai(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.defines={MATCAP:""},this.color.copy(a.color),this.matcap=a.matcap,this.map=a.map,this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.alphaMap=a.alphaMap,this.flatShading=a.flatShading,this.fog=a.fog,this}}class EV extends Do{constructor(a){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(a)}copy(a){return super.copy(a),this.scale=a.scale,this.dashSize=a.dashSize,this.gapSize=a.gapSize,this}}function wf(S,a,d){return!S||!d&&S.constructor===a?S:typeof a.BYTES_PER_ELEMENT=="number"?new a(S):Array.prototype.slice.call(S)}function wV(S){return ArrayBuffer.isView(S)&&!(S instanceof DataView)}function CV(S){function a(x,w){return S[x]-S[w]}const d=S.length,A=new Array(d);for(let x=0;x!==d;++x)A[x]=x;return A.sort(a),A}function xL(S,a,d){const A=S.length,x=new S.constructor(A);for(let w=0,M=0;M!==A;++w){const L=d[w]*a;for(let O=0;O!==a;++O)x[M++]=S[L+O]}return x}function _L(S,a,d,A){let x=1,w=S[0];for(;w!==void 0&&w[A]===void 0;)w=S[x++];if(w===void 0)return;let M=w[A];if(M!==void 0)if(Array.isArray(M))do M=w[A],M!==void 0&&(a.push(w.time),d.push.apply(d,M)),w=S[x++];while(w!==void 0);else if(M.toArray!==void 0)do M=w[A],M!==void 0&&(a.push(w.time),M.toArray(d,d.length)),w=S[x++];while(w!==void 0);else do M=w[A],M!==void 0&&(a.push(w.time),d.push(M)),w=S[x++];while(w!==void 0)}function uMe(S,a,d,A,x=30){const w=S.clone();w.name=a;const M=[];for(let O=0;O<w.tracks.length;++O){const F=w.tracks[O],H=F.getValueSize(),J=[],K=[];for(let Z=0;Z<F.times.length;++Z){const ie=F.times[Z]*x;if(!(ie<d||ie>=A)){J.push(F.times[Z]);for(let oe=0;oe<H;++oe)K.push(F.values[Z*H+oe])}}J.length!==0&&(F.times=wf(J,F.times.constructor),F.values=wf(K,F.values.constructor),M.push(F))}w.tracks=M;let L=1/0;for(let O=0;O<w.tracks.length;++O)L>w.tracks[O].times[0]&&(L=w.tracks[O].times[0]);for(let O=0;O<w.tracks.length;++O)w.tracks[O].shift(-1*L);return w.resetDuration(),w}function hMe(S,a=0,d=S,A=30){A<=0&&(A=30);const x=d.tracks.length,w=a/A;for(let M=0;M<x;++M){const L=d.tracks[M],O=L.ValueTypeName;if(O==="bool"||O==="string")continue;const F=S.tracks.find(function(ee){return ee.name===L.name&&ee.ValueTypeName===O});if(F===void 0)continue;let H=0;const J=L.getValueSize();L.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(H=J/3);let K=0;const Z=F.getValueSize();F.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(K=Z/3);const ie=L.times.length-1;let oe;if(w<=L.times[0]){const ee=H,Re=J-H;oe=L.values.slice(ee,Re)}else if(w>=L.times[ie]){const ee=ie*J+H,Re=ee+J-H;oe=L.values.slice(ee,Re)}else{const ee=L.createInterpolant(),Re=H,we=J-H;ee.evaluate(w),oe=ee.resultBuffer.slice(Re,we)}O==="quaternion"&&new Vn().fromArray(oe).normalize().conjugate().toArray(oe);const ne=F.times.length;for(let ee=0;ee<ne;++ee){const Re=ee*Z+K;if(O==="quaternion")Vn.multiplyQuaternionsFlat(F.values,Re,oe,0,F.values,Re);else{const we=Z-K*2;for(let _e=0;_e<we;++_e)F.values[Re+_e]-=oe[_e]}}}return S.blendMode=Nr,S}const dMe={convertArray:wf,isTypedArray:wV,getKeyframeOrder:CV,sortedArray:xL,flattenJSON:_L,subclip:uMe,makeClipAdditive:hMe};class Dv{constructor(a,d,A,x){this.parameterPositions=a,this._cachedIndex=0,this.resultBuffer=x!==void 0?x:new d.constructor(A),this.sampleValues=d,this.valueSize=A,this.settings=null,this.DefaultSettings_={}}evaluate(a){const d=this.parameterPositions;let A=this._cachedIndex,x=d[A],w=d[A-1];i:{e:{let M;t:{r:if(!(a<x)){for(let L=A+2;;){if(x===void 0){if(a<w)break r;return A=d.length,this._cachedIndex=A,this.copySampleValue_(A-1)}if(A===L)break;if(w=x,x=d[++A],a<x)break e}M=d.length;break t}if(!(a>=w)){const L=d[1];a<L&&(A=2,w=L);for(let O=A-2;;){if(w===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(A===O)break;if(x=w,w=d[--A-1],a>=w)break e}M=A,A=0;break t}break i}for(;A<M;){const L=A+M>>>1;a<d[L]?M=L:A=L+1}if(x=d[A],w=d[A-1],w===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(x===void 0)return A=d.length,this._cachedIndex=A,this.copySampleValue_(A-1)}this._cachedIndex=A,this.intervalChanged_(A,w,x)}return this.interpolate_(A,w,a,x)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(a){const d=this.resultBuffer,A=this.sampleValues,x=this.valueSize,w=a*x;for(let M=0;M!==x;++M)d[M]=A[w+M];return d}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class SV extends Dv{constructor(a,d,A,x){super(a,d,A,x),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Vr,endingEnd:Vr}}intervalChanged_(a,d,A){const x=this.parameterPositions;let w=a-2,M=a+1,L=x[w],O=x[M];if(L===void 0)switch(this.getSettings_().endingStart){case bn:w=a,L=2*d-A;break;case jr:w=x.length-2,L=d+x[w]-x[w+1];break;default:w=a,L=A}if(O===void 0)switch(this.getSettings_().endingEnd){case bn:M=a,O=2*A-d;break;case jr:M=1,O=A+x[1]-x[0];break;default:M=a-1,O=d}const F=(A-d)*.5,H=this.valueSize;this._weightPrev=F/(d-L),this._weightNext=F/(O-A),this._offsetPrev=w*H,this._offsetNext=M*H}interpolate_(a,d,A,x){const w=this.resultBuffer,M=this.sampleValues,L=this.valueSize,O=a*L,F=O-L,H=this._offsetPrev,J=this._offsetNext,K=this._weightPrev,Z=this._weightNext,ie=(A-d)/(x-d),oe=ie*ie,ne=oe*ie,ee=-K*ne+2*K*oe-K*ie,Re=(1+K)*ne+(-1.5-2*K)*oe+(-.5+K)*ie+1,we=(-1-Z)*ne+(1.5+Z)*oe+.5*ie,_e=Z*ne-Z*oe;for(let st=0;st!==L;++st)w[st]=ee*M[H+st]+Re*M[F+st]+we*M[O+st]+_e*M[J+st];return w}}class EL extends Dv{constructor(a,d,A,x){super(a,d,A,x)}interpolate_(a,d,A,x){const w=this.resultBuffer,M=this.sampleValues,L=this.valueSize,O=a*L,F=O-L,H=(A-d)/(x-d),J=1-H;for(let K=0;K!==L;++K)w[K]=M[F+K]*J+M[O+K]*H;return w}}class TV extends Dv{constructor(a,d,A,x){super(a,d,A,x)}interpolate_(a){return this.copySampleValue_(a-1)}}class Nc{constructor(a,d,A,x){if(a===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(d===void 0||d.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+a);this.name=a,this.times=wf(d,this.TimeBufferType),this.values=wf(A,this.ValueBufferType),this.setInterpolation(x||this.DefaultInterpolation)}static toJSON(a){const d=a.constructor;let A;if(d.toJSON!==this.toJSON)A=d.toJSON(a);else{A={name:a.name,times:wf(a.times,Array),values:wf(a.values,Array)};const x=a.getInterpolation();x!==a.DefaultInterpolation&&(A.interpolation=x)}return A.type=a.ValueTypeName,A}InterpolantFactoryMethodDiscrete(a){return new TV(this.times,this.values,this.getValueSize(),a)}InterpolantFactoryMethodLinear(a){return new EL(this.times,this.values,this.getValueSize(),a)}InterpolantFactoryMethodSmooth(a){return new SV(this.times,this.values,this.getValueSize(),a)}setInterpolation(a){let d;switch(a){case wr:d=this.InterpolantFactoryMethodDiscrete;break;case Tr:d=this.InterpolantFactoryMethodLinear;break;case Fr:d=this.InterpolantFactoryMethodSmooth;break}if(d===void 0){const A="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(a!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(A);return console.warn("THREE.KeyframeTrack:",A),this}return this.createInterpolant=d,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return wr;case this.InterpolantFactoryMethodLinear:return Tr;case this.InterpolantFactoryMethodSmooth:return Fr}}getValueSize(){return this.values.length/this.times.length}shift(a){if(a!==0){const d=this.times;for(let A=0,x=d.length;A!==x;++A)d[A]+=a}return this}scale(a){if(a!==1){const d=this.times;for(let A=0,x=d.length;A!==x;++A)d[A]*=a}return this}trim(a,d){const A=this.times,x=A.length;let w=0,M=x-1;for(;w!==x&&A[w]<a;)++w;for(;M!==-1&&A[M]>d;)--M;if(++M,w!==0||M!==x){w>=M&&(M=Math.max(M,1),w=M-1);const L=this.getValueSize();this.times=A.slice(w,M),this.values=this.values.slice(w*L,M*L)}return this}validate(){let a=!0;const d=this.getValueSize();d-Math.floor(d)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),a=!1);const A=this.times,x=this.values,w=A.length;w===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),a=!1);let M=null;for(let L=0;L!==w;L++){const O=A[L];if(typeof O=="number"&&isNaN(O)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,L,O),a=!1;break}if(M!==null&&M>O){console.error("THREE.KeyframeTrack: Out of order keys.",this,L,O,M),a=!1;break}M=O}if(x!==void 0&&wV(x))for(let L=0,O=x.length;L!==O;++L){const F=x[L];if(isNaN(F)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,L,F),a=!1;break}}return a}optimize(){const a=this.times.slice(),d=this.values.slice(),A=this.getValueSize(),x=this.getInterpolation()===Fr,w=a.length-1;let M=1;for(let L=1;L<w;++L){let O=!1;const F=a[L],H=a[L+1];if(F!==H&&(L!==1||F!==a[0]))if(x)O=!0;else{const J=L*A,K=J-A,Z=J+A;for(let ie=0;ie!==A;++ie){const oe=d[J+ie];if(oe!==d[K+ie]||oe!==d[Z+ie]){O=!0;break}}}if(O){if(L!==M){a[M]=a[L];const J=L*A,K=M*A;for(let Z=0;Z!==A;++Z)d[K+Z]=d[J+Z]}++M}}if(w>0){a[M]=a[w];for(let L=w*A,O=M*A,F=0;F!==A;++F)d[O+F]=d[L+F];++M}return M!==a.length?(this.times=a.slice(0,M),this.values=d.slice(0,M*A)):(this.times=a,this.values=d),this}clone(){const a=this.times.slice(),d=this.values.slice(),A=this.constructor,x=new A(this.name,a,d);return x.createInterpolant=this.createInterpolant,x}}Nc.prototype.TimeBufferType=Float32Array,Nc.prototype.ValueBufferType=Float32Array,Nc.prototype.DefaultInterpolation=Tr;class Cf extends Nc{}Cf.prototype.ValueTypeName="bool",Cf.prototype.ValueBufferType=Array,Cf.prototype.DefaultInterpolation=wr,Cf.prototype.InterpolantFactoryMethodLinear=void 0,Cf.prototype.InterpolantFactoryMethodSmooth=void 0;class wL extends Nc{}wL.prototype.ValueTypeName="color";class Nv extends Nc{}Nv.prototype.ValueTypeName="number";class MV extends Dv{constructor(a,d,A,x){super(a,d,A,x)}interpolate_(a,d,A,x){const w=this.resultBuffer,M=this.sampleValues,L=this.valueSize,O=(A-d)/(x-d);let F=a*L;for(let H=F+L;F!==H;F+=4)Vn.slerpFlat(w,0,M,F-L,M,F,O);return w}}class T0 extends Nc{InterpolantFactoryMethodLinear(a){return new MV(this.times,this.values,this.getValueSize(),a)}}T0.prototype.ValueTypeName="quaternion",T0.prototype.DefaultInterpolation=Tr,T0.prototype.InterpolantFactoryMethodSmooth=void 0;class Sf extends Nc{}Sf.prototype.ValueTypeName="string",Sf.prototype.ValueBufferType=Array,Sf.prototype.DefaultInterpolation=wr,Sf.prototype.InterpolantFactoryMethodLinear=void 0,Sf.prototype.InterpolantFactoryMethodSmooth=void 0;class Pv extends Nc{}Pv.prototype.ValueTypeName="vector";class Ov{constructor(a="",d=-1,A=[],x=us){this.name=a,this.tracks=A,this.duration=d,this.blendMode=x,this.uuid=Ro(),this.duration<0&&this.resetDuration()}static parse(a){const d=[],A=a.tracks,x=1/(a.fps||1);for(let M=0,L=A.length;M!==L;++M)d.push(fMe(A[M]).scale(x));const w=new this(a.name,a.duration,d,a.blendMode);return w.uuid=a.uuid,w}static toJSON(a){const d=[],A=a.tracks,x={name:a.name,duration:a.duration,tracks:d,uuid:a.uuid,blendMode:a.blendMode};for(let w=0,M=A.length;w!==M;++w)d.push(Nc.toJSON(A[w]));return x}static CreateFromMorphTargetSequence(a,d,A,x){const w=d.length,M=[];for(let L=0;L<w;L++){let O=[],F=[];O.push((L+w-1)%w,L,(L+1)%w),F.push(0,1,0);const H=CV(O);O=xL(O,1,H),F=xL(F,1,H),!x&&O[0]===0&&(O.push(w),F.push(F[0])),M.push(new Nv(".morphTargetInfluences["+d[L].name+"]",O,F).scale(1/A))}return new this(a,-1,M)}static findByName(a,d){let A=a;if(!Array.isArray(a)){const x=a;A=x.geometry&&x.geometry.animations||x.animations}for(let x=0;x<A.length;x++)if(A[x].name===d)return A[x];return null}static CreateClipsFromMorphTargetSequences(a,d,A){const x={},w=/^([\w-]*?)([\d]+)$/;for(let L=0,O=a.length;L<O;L++){const F=a[L],H=F.name.match(w);if(H&&H.length>1){const J=H[1];let K=x[J];K||(x[J]=K=[]),K.push(F)}}const M=[];for(const L in x)M.push(this.CreateFromMorphTargetSequence(L,x[L],d,A));return M}static parseAnimation(a,d){if(!a)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const A=function(H,J,K,Z,ie){if(K.length!==0){const oe=[],ne=[];_L(K,oe,ne,Z),oe.length!==0&&ie.push(new H(J,oe,ne))}},x=[],w=a.name||"default",M=a.fps||30,L=a.blendMode;let O=a.length||-1;const F=a.hierarchy||[];for(let H=0;H<F.length;H++){const J=F[H].keys;if(!(!J||J.length===0))if(J[0].morphTargets){const K={};let Z;for(Z=0;Z<J.length;Z++)if(J[Z].morphTargets)for(let ie=0;ie<J[Z].morphTargets.length;ie++)K[J[Z].morphTargets[ie]]=-1;for(const ie in K){const oe=[],ne=[];for(let ee=0;ee!==J[Z].morphTargets.length;++ee){const Re=J[Z];oe.push(Re.time),ne.push(Re.morphTarget===ie?1:0)}x.push(new Nv(".morphTargetInfluence["+ie+"]",oe,ne))}O=K.length*M}else{const K=".bones["+d[H].name+"]";A(Pv,K+".position",J,"pos",x),A(T0,K+".quaternion",J,"rot",x),A(Pv,K+".scale",J,"scl",x)}}return x.length===0?null:new this(w,O,x,L)}resetDuration(){const a=this.tracks;let d=0;for(let A=0,x=a.length;A!==x;++A){const w=this.tracks[A];d=Math.max(d,w.times[w.times.length-1])}return this.duration=d,this}trim(){for(let a=0;a<this.tracks.length;a++)this.tracks[a].trim(0,this.duration);return this}validate(){let a=!0;for(let d=0;d<this.tracks.length;d++)a=a&&this.tracks[d].validate();return a}optimize(){for(let a=0;a<this.tracks.length;a++)this.tracks[a].optimize();return this}clone(){const a=[];for(let d=0;d<this.tracks.length;d++)a.push(this.tracks[d].clone());return new this.constructor(this.name,this.duration,a,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function pMe(S){switch(S.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Nv;case"vector":case"vector2":case"vector3":case"vector4":return Pv;case"color":return wL;case"quaternion":return T0;case"bool":case"boolean":return Cf;case"string":return Sf}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+S)}function fMe(S){if(S.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const a=pMe(S.type);if(S.times===void 0){const d=[],A=[];_L(S.keys,d,A,"value"),S.times=d,S.values=A}return a.parse!==void 0?a.parse(S):new a(S.name,S.times,S.values,S.interpolation)}const Th={enabled:!1,files:{},add:function(S,a){this.enabled!==!1&&(this.files[S]=a)},get:function(S){if(this.enabled!==!1)return this.files[S]},remove:function(S){delete this.files[S]},clear:function(){this.files={}}};class CL{constructor(a,d,A){const x=this;let w=!1,M=0,L=0,O;const F=[];this.onStart=void 0,this.onLoad=a,this.onProgress=d,this.onError=A,this.itemStart=function(H){L++,w===!1&&x.onStart!==void 0&&x.onStart(H,M,L),w=!0},this.itemEnd=function(H){M++,x.onProgress!==void 0&&x.onProgress(H,M,L),M===L&&(w=!1,x.onLoad!==void 0&&x.onLoad())},this.itemError=function(H){x.onError!==void 0&&x.onError(H)},this.resolveURL=function(H){return O?O(H):H},this.setURLModifier=function(H){return O=H,this},this.addHandler=function(H,J){return F.push(H,J),this},this.removeHandler=function(H){const J=F.indexOf(H);return J!==-1&&F.splice(J,2),this},this.getHandler=function(H){for(let J=0,K=F.length;J<K;J+=2){const Z=F[J],ie=F[J+1];if(Z.global&&(Z.lastIndex=0),Z.test(H))return ie}return null}}}const RV=new CL;class tl{constructor(a){this.manager=a!==void 0?a:RV,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(a,d){const A=this;return new Promise(function(x,w){A.load(a,x,d,w)})}parse(){}setCrossOrigin(a){return this.crossOrigin=a,this}setWithCredentials(a){return this.withCredentials=a,this}setPath(a){return this.path=a,this}setResourcePath(a){return this.resourcePath=a,this}setRequestHeader(a){return this.requestHeader=a,this}}tl.DEFAULT_MATERIAL_NAME="__DEFAULT";const Mh={};class mMe extends Error{constructor(a,d){super(a),this.response=d}}class Rh extends tl{constructor(a){super(a)}load(a,d,A,x){a===void 0&&(a=""),this.path!==void 0&&(a=this.path+a),a=this.manager.resolveURL(a);const w=Th.get(a);if(w!==void 0)return this.manager.itemStart(a),setTimeout(()=>{d&&d(w),this.manager.itemEnd(a)},0),w;if(Mh[a]!==void 0){Mh[a].push({onLoad:d,onProgress:A,onError:x});return}Mh[a]=[],Mh[a].push({onLoad:d,onProgress:A,onError:x});const M=new Request(a,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),L=this.mimeType,O=this.responseType;fetch(M).then(F=>{if(F.status===200||F.status===0){if(F.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||F.body===void 0||F.body.getReader===void 0)return F;const H=Mh[a],J=F.body.getReader(),K=F.headers.get("X-File-Size")||F.headers.get("Content-Length"),Z=K?parseInt(K):0,ie=Z!==0;let oe=0;const ne=new ReadableStream({start(ee){Re();function Re(){J.read().then(({done:we,value:_e})=>{if(we)ee.close();else{oe+=_e.byteLength;const st=new ProgressEvent("progress",{lengthComputable:ie,loaded:oe,total:Z});for(let qe=0,Ze=H.length;qe<Ze;qe++){const rt=H[qe];rt.onProgress&&rt.onProgress(st)}ee.enqueue(_e),Re()}})}}});return new Response(ne)}else throw new mMe(`fetch for "${F.url}" responded with ${F.status}: ${F.statusText}`,F)}).then(F=>{switch(O){case"arraybuffer":return F.arrayBuffer();case"blob":return F.blob();case"document":return F.text().then(H=>new DOMParser().parseFromString(H,L));case"json":return F.json();default:if(L===void 0)return F.text();{const H=/charset="?([^;"\s]*)"?/i.exec(L),J=H&&H[1]?H[1].toLowerCase():void 0,K=new TextDecoder(J);return F.arrayBuffer().then(Z=>K.decode(Z))}}}).then(F=>{Th.add(a,F);const H=Mh[a];delete Mh[a];for(let J=0,K=H.length;J<K;J++){const Z=H[J];Z.onLoad&&Z.onLoad(F)}}).catch(F=>{const H=Mh[a];if(H===void 0)throw this.manager.itemError(a),F;delete Mh[a];for(let J=0,K=H.length;J<K;J++){const Z=H[J];Z.onError&&Z.onError(F)}this.manager.itemError(a)}).finally(()=>{this.manager.itemEnd(a)}),this.manager.itemStart(a)}setResponseType(a){return this.responseType=a,this}setMimeType(a){return this.mimeType=a,this}}class gMe extends tl{constructor(a){super(a)}load(a,d,A,x){const w=this,M=new Rh(this.manager);M.setPath(this.path),M.setRequestHeader(this.requestHeader),M.setWithCredentials(this.withCredentials),M.load(a,function(L){try{d(w.parse(JSON.parse(L)))}catch(O){x?x(O):console.error(O),w.manager.itemError(a)}},A,x)}parse(a){const d=[];for(let A=0;A<a.length;A++){const x=Ov.parse(a[A]);d.push(x)}return d}}class AMe extends tl{constructor(a){super(a)}load(a,d,A,x){const w=this,M=[],L=new sw,O=new Rh(this.manager);O.setPath(this.path),O.setResponseType("arraybuffer"),O.setRequestHeader(this.requestHeader),O.setWithCredentials(w.withCredentials);let F=0;function H(J){O.load(a[J],function(K){const Z=w.parse(K,!0);M[J]={width:Z.width,height:Z.height,format:Z.format,mipmaps:Z.mipmaps},F+=1,F===6&&(Z.mipmapCount===1&&(L.minFilter=ki),L.image=M,L.format=Z.format,L.needsUpdate=!0,d&&d(L))},A,x)}if(Array.isArray(a))for(let J=0,K=a.length;J<K;++J)H(J);else O.load(a,function(J){const K=w.parse(J,!0);if(K.isCubemap){const Z=K.mipmaps.length/K.mipmapCount;for(let ie=0;ie<Z;ie++){M[ie]={mipmaps:[]};for(let oe=0;oe<K.mipmapCount;oe++)M[ie].mipmaps.push(K.mipmaps[ie*K.mipmapCount+oe]),M[ie].format=K.format,M[ie].width=K.width,M[ie].height=K.height}L.image=M}else L.image.width=K.width,L.image.height=K.height,L.mipmaps=K.mipmaps;K.mipmapCount===1&&(L.minFilter=ki),L.format=K.format,L.needsUpdate=!0,d&&d(L)},A,x);return L}}class kv extends tl{constructor(a){super(a)}load(a,d,A,x){this.path!==void 0&&(a=this.path+a),a=this.manager.resolveURL(a);const w=this,M=Th.get(a);if(M!==void 0)return w.manager.itemStart(a),setTimeout(function(){d&&d(M),w.manager.itemEnd(a)},0),M;const L=hf("img");function O(){H(),Th.add(a,this),d&&d(this),w.manager.itemEnd(a)}function F(J){H(),x&&x(J),w.manager.itemError(a),w.manager.itemEnd(a)}function H(){L.removeEventListener("load",O,!1),L.removeEventListener("error",F,!1)}return L.addEventListener("load",O,!1),L.addEventListener("error",F,!1),a.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(L.crossOrigin=this.crossOrigin),w.manager.itemStart(a),L.src=a,L}}class yMe extends tl{constructor(a){super(a)}load(a,d,A,x){const w=new fv;w.colorSpace=Nn;const M=new kv(this.manager);M.setCrossOrigin(this.crossOrigin),M.setPath(this.path);let L=0;function O(F){M.load(a[F],function(H){w.images[F]=H,L++,L===6&&(w.needsUpdate=!0,d&&d(w))},void 0,x)}for(let F=0;F<a.length;++F)O(F);return w}}class vMe extends tl{constructor(a){super(a)}load(a,d,A,x){const w=this,M=new jd,L=new Rh(this.manager);return L.setResponseType("arraybuffer"),L.setRequestHeader(this.requestHeader),L.setPath(this.path),L.setWithCredentials(w.withCredentials),L.load(a,function(O){let F;try{F=w.parse(O)}catch(H){if(x!==void 0)x(H);else{console.error(H);return}}F.image!==void 0?M.image=F.image:F.data!==void 0&&(M.image.width=F.width,M.image.height=F.height,M.image.data=F.data),M.wrapS=F.wrapS!==void 0?F.wrapS:Ve,M.wrapT=F.wrapT!==void 0?F.wrapT:Ve,M.magFilter=F.magFilter!==void 0?F.magFilter:ki,M.minFilter=F.minFilter!==void 0?F.minFilter:ki,M.anisotropy=F.anisotropy!==void 0?F.anisotropy:1,F.colorSpace!==void 0&&(M.colorSpace=F.colorSpace),F.flipY!==void 0&&(M.flipY=F.flipY),F.format!==void 0&&(M.format=F.format),F.type!==void 0&&(M.type=F.type),F.mipmaps!==void 0&&(M.mipmaps=F.mipmaps,M.minFilter=rn),F.mipmapCount===1&&(M.minFilter=ki),F.generateMipmaps!==void 0&&(M.generateMipmaps=F.generateMipmaps),M.needsUpdate=!0,d&&d(M,F)},A,x),M}}class bMe extends tl{constructor(a){super(a)}load(a,d,A,x){const w=new hs,M=new kv(this.manager);return M.setCrossOrigin(this.crossOrigin),M.setPath(this.path),M.load(a,function(L){w.image=L,w.needsUpdate=!0,d!==void 0&&d(w)},A,x),w}}class Wd extends Gn{constructor(a,d=1){super(),this.isLight=!0,this.type="Light",this.color=new or(a),this.intensity=d}dispose(){}copy(a,d){return super.copy(a,d),this.color.copy(a.color),this.intensity=a.intensity,this}toJSON(a){const d=super.toJSON(a);return d.object.color=this.color.getHex(),d.object.intensity=this.intensity,this.groundColor!==void 0&&(d.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(d.object.distance=this.distance),this.angle!==void 0&&(d.object.angle=this.angle),this.decay!==void 0&&(d.object.decay=this.decay),this.penumbra!==void 0&&(d.object.penumbra=this.penumbra),this.shadow!==void 0&&(d.object.shadow=this.shadow.toJSON()),d}}class IV extends Wd{constructor(a,d,A){super(a,A),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Gn.DEFAULT_UP),this.updateMatrix(),this.groundColor=new or(d)}copy(a,d){return super.copy(a,d),this.groundColor.copy(a.groundColor),this}}const SL=new fr,BV=new He,LV=new He;class TL{constructor(a){this.camera=a,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ai(512,512),this.map=null,this.mapPass=null,this.matrix=new fr,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new mv,this._frameExtents=new ai(1,1),this._viewportCount=1,this._viewports=[new Fn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(a){const d=this.camera,A=this.matrix;BV.setFromMatrixPosition(a.matrixWorld),d.position.copy(BV),LV.setFromMatrixPosition(a.target.matrixWorld),d.lookAt(LV),d.updateMatrixWorld(),SL.multiplyMatrices(d.projectionMatrix,d.matrixWorldInverse),this._frustum.setFromProjectionMatrix(SL),A.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),A.multiply(SL)}getViewport(a){return this._viewports[a]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(a){return this.camera=a.camera.clone(),this.bias=a.bias,this.radius=a.radius,this.mapSize.copy(a.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const a={};return this.bias!==0&&(a.bias=this.bias),this.normalBias!==0&&(a.normalBias=this.normalBias),this.radius!==1&&(a.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(a.mapSize=this.mapSize.toArray()),a.camera=this.camera.toJSON(!1).object,delete a.camera.matrix,a}}class xMe extends TL{constructor(){super(new va(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(a){const d=this.camera,A=Bd*2*a.angle*this.focus,x=this.mapSize.width/this.mapSize.height,w=a.distance||d.far;(A!==d.fov||x!==d.aspect||w!==d.far)&&(d.fov=A,d.aspect=x,d.far=w,d.updateProjectionMatrix()),super.updateMatrices(a)}copy(a){return super.copy(a),this.focus=a.focus,this}}class DV extends Wd{constructor(a,d,A=0,x=Math.PI/3,w=0,M=2){super(a,d),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Gn.DEFAULT_UP),this.updateMatrix(),this.target=new Gn,this.distance=A,this.angle=x,this.penumbra=w,this.decay=M,this.map=null,this.shadow=new xMe}get power(){return this.intensity*Math.PI}set power(a){this.intensity=a/Math.PI}dispose(){this.shadow.dispose()}copy(a,d){return super.copy(a,d),this.distance=a.distance,this.angle=a.angle,this.penumbra=a.penumbra,this.decay=a.decay,this.target=a.target.clone(),this.shadow=a.shadow.clone(),this}}const NV=new fr,Fv=new He,ML=new He;class _Me extends TL{constructor(){super(new va(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new ai(4,2),this._viewportCount=6,this._viewports=[new Fn(2,1,1,1),new Fn(0,1,1,1),new Fn(3,1,1,1),new Fn(1,1,1,1),new Fn(3,0,1,1),new Fn(1,0,1,1)],this._cubeDirections=[new He(1,0,0),new He(-1,0,0),new He(0,0,1),new He(0,0,-1),new He(0,1,0),new He(0,-1,0)],this._cubeUps=[new He(0,1,0),new He(0,1,0),new He(0,1,0),new He(0,1,0),new He(0,0,1),new He(0,0,-1)]}updateMatrices(a,d=0){const A=this.camera,x=this.matrix,w=a.distance||A.far;w!==A.far&&(A.far=w,A.updateProjectionMatrix()),Fv.setFromMatrixPosition(a.matrixWorld),A.position.copy(Fv),ML.copy(A.position),ML.add(this._cubeDirections[d]),A.up.copy(this._cubeUps[d]),A.lookAt(ML),A.updateMatrixWorld(),x.makeTranslation(-Fv.x,-Fv.y,-Fv.z),NV.multiplyMatrices(A.projectionMatrix,A.matrixWorldInverse),this._frustum.setFromProjectionMatrix(NV)}}class PV extends Wd{constructor(a,d,A=0,x=2){super(a,d),this.isPointLight=!0,this.type="PointLight",this.distance=A,this.decay=x,this.shadow=new _Me}get power(){return this.intensity*4*Math.PI}set power(a){this.intensity=a/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(a,d){return super.copy(a,d),this.distance=a.distance,this.decay=a.decay,this.shadow=a.shadow.clone(),this}}class EMe extends TL{constructor(){super(new kE(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class OV extends Wd{constructor(a,d){super(a,d),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Gn.DEFAULT_UP),this.updateMatrix(),this.target=new Gn,this.shadow=new EMe}dispose(){this.shadow.dispose()}copy(a){return super.copy(a),this.target=a.target.clone(),this.shadow=a.shadow.clone(),this}}class kV extends Wd{constructor(a,d){super(a,d),this.isAmbientLight=!0,this.type="AmbientLight"}}class FV extends Wd{constructor(a,d,A=10,x=10){super(a,d),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=A,this.height=x}get power(){return this.intensity*this.width*this.height*Math.PI}set power(a){this.intensity=a/(this.width*this.height*Math.PI)}copy(a){return super.copy(a),this.width=a.width,this.height=a.height,this}toJSON(a){const d=super.toJSON(a);return d.object.width=this.width,d.object.height=this.height,d}}class UV{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let a=0;a<9;a++)this.coefficients.push(new He)}set(a){for(let d=0;d<9;d++)this.coefficients[d].copy(a[d]);return this}zero(){for(let a=0;a<9;a++)this.coefficients[a].set(0,0,0);return this}getAt(a,d){const A=a.x,x=a.y,w=a.z,M=this.coefficients;return d.copy(M[0]).multiplyScalar(.282095),d.addScaledVector(M[1],.488603*x),d.addScaledVector(M[2],.488603*w),d.addScaledVector(M[3],.488603*A),d.addScaledVector(M[4],1.092548*(A*x)),d.addScaledVector(M[5],1.092548*(x*w)),d.addScaledVector(M[6],.315392*(3*w*w-1)),d.addScaledVector(M[7],1.092548*(A*w)),d.addScaledVector(M[8],.546274*(A*A-x*x)),d}getIrradianceAt(a,d){const A=a.x,x=a.y,w=a.z,M=this.coefficients;return d.copy(M[0]).multiplyScalar(.886227),d.addScaledVector(M[1],1.023328*x),d.addScaledVector(M[2],1.023328*w),d.addScaledVector(M[3],1.023328*A),d.addScaledVector(M[4],.858086*A*x),d.addScaledVector(M[5],.858086*x*w),d.addScaledVector(M[6],.743125*w*w-.247708),d.addScaledVector(M[7],.858086*A*w),d.addScaledVector(M[8],.429043*(A*A-x*x)),d}add(a){for(let d=0;d<9;d++)this.coefficients[d].add(a.coefficients[d]);return this}addScaledSH(a,d){for(let A=0;A<9;A++)this.coefficients[A].addScaledVector(a.coefficients[A],d);return this}scale(a){for(let d=0;d<9;d++)this.coefficients[d].multiplyScalar(a);return this}lerp(a,d){for(let A=0;A<9;A++)this.coefficients[A].lerp(a.coefficients[A],d);return this}equals(a){for(let d=0;d<9;d++)if(!this.coefficients[d].equals(a.coefficients[d]))return!1;return!0}copy(a){return this.set(a.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(a,d=0){const A=this.coefficients;for(let x=0;x<9;x++)A[x].fromArray(a,d+x*3);return this}toArray(a=[],d=0){const A=this.coefficients;for(let x=0;x<9;x++)A[x].toArray(a,d+x*3);return a}static getBasisAt(a,d){const A=a.x,x=a.y,w=a.z;d[0]=.282095,d[1]=.488603*x,d[2]=.488603*w,d[3]=.488603*A,d[4]=1.092548*A*x,d[5]=1.092548*x*w,d[6]=.315392*(3*w*w-1),d[7]=1.092548*A*w,d[8]=.546274*(A*A-x*x)}}class zV extends Wd{constructor(a=new UV,d=1){super(void 0,d),this.isLightProbe=!0,this.sh=a}copy(a){return super.copy(a),this.sh.copy(a.sh),this}fromJSON(a){return this.intensity=a.intensity,this.sh.fromArray(a.sh),this}toJSON(a){const d=super.toJSON(a);return d.object.sh=this.sh.toArray(),d}}class Tw extends tl{constructor(a){super(a),this.textures={}}load(a,d,A,x){const w=this,M=new Rh(w.manager);M.setPath(w.path),M.setRequestHeader(w.requestHeader),M.setWithCredentials(w.withCredentials),M.load(a,function(L){try{d(w.parse(JSON.parse(L)))}catch(O){x?x(O):console.error(O),w.manager.itemError(a)}},A,x)}parse(a){const d=this.textures;function A(w){return d[w]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",w),d[w]}const x=Tw.createMaterialFromType(a.type);if(a.uuid!==void 0&&(x.uuid=a.uuid),a.name!==void 0&&(x.name=a.name),a.color!==void 0&&x.color!==void 0&&x.color.setHex(a.color),a.roughness!==void 0&&(x.roughness=a.roughness),a.metalness!==void 0&&(x.metalness=a.metalness),a.sheen!==void 0&&(x.sheen=a.sheen),a.sheenColor!==void 0&&(x.sheenColor=new or().setHex(a.sheenColor)),a.sheenRoughness!==void 0&&(x.sheenRoughness=a.sheenRoughness),a.emissive!==void 0&&x.emissive!==void 0&&x.emissive.setHex(a.emissive),a.specular!==void 0&&x.specular!==void 0&&x.specular.setHex(a.specular),a.specularIntensity!==void 0&&(x.specularIntensity=a.specularIntensity),a.specularColor!==void 0&&x.specularColor!==void 0&&x.specularColor.setHex(a.specularColor),a.shininess!==void 0&&(x.shininess=a.shininess),a.clearcoat!==void 0&&(x.clearcoat=a.clearcoat),a.clearcoatRoughness!==void 0&&(x.clearcoatRoughness=a.clearcoatRoughness),a.dispersion!==void 0&&(x.dispersion=a.dispersion),a.iridescence!==void 0&&(x.iridescence=a.iridescence),a.iridescenceIOR!==void 0&&(x.iridescenceIOR=a.iridescenceIOR),a.iridescenceThicknessRange!==void 0&&(x.iridescenceThicknessRange=a.iridescenceThicknessRange),a.transmission!==void 0&&(x.transmission=a.transmission),a.thickness!==void 0&&(x.thickness=a.thickness),a.attenuationDistance!==void 0&&(x.attenuationDistance=a.attenuationDistance),a.attenuationColor!==void 0&&x.attenuationColor!==void 0&&x.attenuationColor.setHex(a.attenuationColor),a.anisotropy!==void 0&&(x.anisotropy=a.anisotropy),a.anisotropyRotation!==void 0&&(x.anisotropyRotation=a.anisotropyRotation),a.fog!==void 0&&(x.fog=a.fog),a.flatShading!==void 0&&(x.flatShading=a.flatShading),a.blending!==void 0&&(x.blending=a.blending),a.combine!==void 0&&(x.combine=a.combine),a.side!==void 0&&(x.side=a.side),a.shadowSide!==void 0&&(x.shadowSide=a.shadowSide),a.opacity!==void 0&&(x.opacity=a.opacity),a.transparent!==void 0&&(x.transparent=a.transparent),a.alphaTest!==void 0&&(x.alphaTest=a.alphaTest),a.alphaHash!==void 0&&(x.alphaHash=a.alphaHash),a.depthFunc!==void 0&&(x.depthFunc=a.depthFunc),a.depthTest!==void 0&&(x.depthTest=a.depthTest),a.depthWrite!==void 0&&(x.depthWrite=a.depthWrite),a.colorWrite!==void 0&&(x.colorWrite=a.colorWrite),a.blendSrc!==void 0&&(x.blendSrc=a.blendSrc),a.blendDst!==void 0&&(x.blendDst=a.blendDst),a.blendEquation!==void 0&&(x.blendEquation=a.blendEquation),a.blendSrcAlpha!==void 0&&(x.blendSrcAlpha=a.blendSrcAlpha),a.blendDstAlpha!==void 0&&(x.blendDstAlpha=a.blendDstAlpha),a.blendEquationAlpha!==void 0&&(x.blendEquationAlpha=a.blendEquationAlpha),a.blendColor!==void 0&&x.blendColor!==void 0&&x.blendColor.setHex(a.blendColor),a.blendAlpha!==void 0&&(x.blendAlpha=a.blendAlpha),a.stencilWriteMask!==void 0&&(x.stencilWriteMask=a.stencilWriteMask),a.stencilFunc!==void 0&&(x.stencilFunc=a.stencilFunc),a.stencilRef!==void 0&&(x.stencilRef=a.stencilRef),a.stencilFuncMask!==void 0&&(x.stencilFuncMask=a.stencilFuncMask),a.stencilFail!==void 0&&(x.stencilFail=a.stencilFail),a.stencilZFail!==void 0&&(x.stencilZFail=a.stencilZFail),a.stencilZPass!==void 0&&(x.stencilZPass=a.stencilZPass),a.stencilWrite!==void 0&&(x.stencilWrite=a.stencilWrite),a.wireframe!==void 0&&(x.wireframe=a.wireframe),a.wireframeLinewidth!==void 0&&(x.wireframeLinewidth=a.wireframeLinewidth),a.wireframeLinecap!==void 0&&(x.wireframeLinecap=a.wireframeLinecap),a.wireframeLinejoin!==void 0&&(x.wireframeLinejoin=a.wireframeLinejoin),a.rotation!==void 0&&(x.rotation=a.rotation),a.linewidth!==void 0&&(x.linewidth=a.linewidth),a.dashSize!==void 0&&(x.dashSize=a.dashSize),a.gapSize!==void 0&&(x.gapSize=a.gapSize),a.scale!==void 0&&(x.scale=a.scale),a.polygonOffset!==void 0&&(x.polygonOffset=a.polygonOffset),a.polygonOffsetFactor!==void 0&&(x.polygonOffsetFactor=a.polygonOffsetFactor),a.polygonOffsetUnits!==void 0&&(x.polygonOffsetUnits=a.polygonOffsetUnits),a.dithering!==void 0&&(x.dithering=a.dithering),a.alphaToCoverage!==void 0&&(x.alphaToCoverage=a.alphaToCoverage),a.premultipliedAlpha!==void 0&&(x.premultipliedAlpha=a.premultipliedAlpha),a.forceSinglePass!==void 0&&(x.forceSinglePass=a.forceSinglePass),a.visible!==void 0&&(x.visible=a.visible),a.toneMapped!==void 0&&(x.toneMapped=a.toneMapped),a.userData!==void 0&&(x.userData=a.userData),a.vertexColors!==void 0&&(typeof a.vertexColors=="number"?x.vertexColors=a.vertexColors>0:x.vertexColors=a.vertexColors),a.uniforms!==void 0)for(const w in a.uniforms){const M=a.uniforms[w];switch(x.uniforms[w]={},M.type){case"t":x.uniforms[w].value=A(M.value);break;case"c":x.uniforms[w].value=new or().setHex(M.value);break;case"v2":x.uniforms[w].value=new ai().fromArray(M.value);break;case"v3":x.uniforms[w].value=new He().fromArray(M.value);break;case"v4":x.uniforms[w].value=new Fn().fromArray(M.value);break;case"m3":x.uniforms[w].value=new Xr().fromArray(M.value);break;case"m4":x.uniforms[w].value=new fr().fromArray(M.value);break;default:x.uniforms[w].value=M.value}}if(a.defines!==void 0&&(x.defines=a.defines),a.vertexShader!==void 0&&(x.vertexShader=a.vertexShader),a.fragmentShader!==void 0&&(x.fragmentShader=a.fragmentShader),a.glslVersion!==void 0&&(x.glslVersion=a.glslVersion),a.extensions!==void 0)for(const w in a.extensions)x.extensions[w]=a.extensions[w];if(a.lights!==void 0&&(x.lights=a.lights),a.clipping!==void 0&&(x.clipping=a.clipping),a.size!==void 0&&(x.size=a.size),a.sizeAttenuation!==void 0&&(x.sizeAttenuation=a.sizeAttenuation),a.map!==void 0&&(x.map=A(a.map)),a.matcap!==void 0&&(x.matcap=A(a.matcap)),a.alphaMap!==void 0&&(x.alphaMap=A(a.alphaMap)),a.bumpMap!==void 0&&(x.bumpMap=A(a.bumpMap)),a.bumpScale!==void 0&&(x.bumpScale=a.bumpScale),a.normalMap!==void 0&&(x.normalMap=A(a.normalMap)),a.normalMapType!==void 0&&(x.normalMapType=a.normalMapType),a.normalScale!==void 0){let w=a.normalScale;Array.isArray(w)===!1&&(w=[w,w]),x.normalScale=new ai().fromArray(w)}return a.displacementMap!==void 0&&(x.displacementMap=A(a.displacementMap)),a.displacementScale!==void 0&&(x.displacementScale=a.displacementScale),a.displacementBias!==void 0&&(x.displacementBias=a.displacementBias),a.roughnessMap!==void 0&&(x.roughnessMap=A(a.roughnessMap)),a.metalnessMap!==void 0&&(x.metalnessMap=A(a.metalnessMap)),a.emissiveMap!==void 0&&(x.emissiveMap=A(a.emissiveMap)),a.emissiveIntensity!==void 0&&(x.emissiveIntensity=a.emissiveIntensity),a.specularMap!==void 0&&(x.specularMap=A(a.specularMap)),a.specularIntensityMap!==void 0&&(x.specularIntensityMap=A(a.specularIntensityMap)),a.specularColorMap!==void 0&&(x.specularColorMap=A(a.specularColorMap)),a.envMap!==void 0&&(x.envMap=A(a.envMap)),a.envMapRotation!==void 0&&x.envMapRotation.fromArray(a.envMapRotation),a.envMapIntensity!==void 0&&(x.envMapIntensity=a.envMapIntensity),a.reflectivity!==void 0&&(x.reflectivity=a.reflectivity),a.refractionRatio!==void 0&&(x.refractionRatio=a.refractionRatio),a.lightMap!==void 0&&(x.lightMap=A(a.lightMap)),a.lightMapIntensity!==void 0&&(x.lightMapIntensity=a.lightMapIntensity),a.aoMap!==void 0&&(x.aoMap=A(a.aoMap)),a.aoMapIntensity!==void 0&&(x.aoMapIntensity=a.aoMapIntensity),a.gradientMap!==void 0&&(x.gradientMap=A(a.gradientMap)),a.clearcoatMap!==void 0&&(x.clearcoatMap=A(a.clearcoatMap)),a.clearcoatRoughnessMap!==void 0&&(x.clearcoatRoughnessMap=A(a.clearcoatRoughnessMap)),a.clearcoatNormalMap!==void 0&&(x.clearcoatNormalMap=A(a.clearcoatNormalMap)),a.clearcoatNormalScale!==void 0&&(x.clearcoatNormalScale=new ai().fromArray(a.clearcoatNormalScale)),a.iridescenceMap!==void 0&&(x.iridescenceMap=A(a.iridescenceMap)),a.iridescenceThicknessMap!==void 0&&(x.iridescenceThicknessMap=A(a.iridescenceThicknessMap)),a.transmissionMap!==void 0&&(x.transmissionMap=A(a.transmissionMap)),a.thicknessMap!==void 0&&(x.thicknessMap=A(a.thicknessMap)),a.anisotropyMap!==void 0&&(x.anisotropyMap=A(a.anisotropyMap)),a.sheenColorMap!==void 0&&(x.sheenColorMap=A(a.sheenColorMap)),a.sheenRoughnessMap!==void 0&&(x.sheenRoughnessMap=A(a.sheenRoughnessMap)),x}setTextures(a){return this.textures=a,this}static createMaterialFromType(a){const d={ShadowMaterial:mV,SpriteMaterial:ZB,RawShaderMaterial:gV,ShaderMaterial:Bc,PointsMaterial:aL,MeshPhysicalMaterial:AV,MeshStandardMaterial:bL,MeshPhongMaterial:yV,MeshToonMaterial:vV,MeshNormalMaterial:bV,MeshLambertMaterial:xV,MeshDepthMaterial:XB,MeshDistanceMaterial:YB,MeshBasicMaterial:Fd,MeshMatcapMaterial:_V,LineDashedMaterial:EV,LineBasicMaterial:Do,Material:co};return new d[a]}}class RL{static decodeText(a){if(typeof TextDecoder<"u")return new TextDecoder().decode(a);let d="";for(let A=0,x=a.length;A<x;A++)d+=String.fromCharCode(a[A]);try{return decodeURIComponent(escape(d))}catch{return d}}static extractUrlBase(a){const d=a.lastIndexOf("/");return d===-1?"./":a.slice(0,d+1)}static resolveURL(a,d){return typeof a!="string"||a===""?"":(/^https?:\/\//i.test(d)&&/^\//.test(a)&&(d=d.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(a)||/^data:.*,.*$/i.test(a)||/^blob:.*$/i.test(a)?a:d+a)}}class jV extends dn{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(a){return super.copy(a),this.instanceCount=a.instanceCount,this}toJSON(){const a=super.toJSON();return a.instanceCount=this.instanceCount,a.isInstancedBufferGeometry=!0,a}}class VV extends tl{constructor(a){super(a)}load(a,d,A,x){const w=this,M=new Rh(w.manager);M.setPath(w.path),M.setRequestHeader(w.requestHeader),M.setWithCredentials(w.withCredentials),M.load(a,function(L){try{d(w.parse(JSON.parse(L)))}catch(O){x?x(O):console.error(O),w.manager.itemError(a)}},A,x)}parse(a){const d={},A={};function x(K,Z){if(d[Z]!==void 0)return d[Z];const ie=K.interleavedBuffers[Z],oe=w(K,ie.buffer),ne=Ld(ie.type,oe),ee=new GE(ne,ie.stride);return ee.uuid=ie.uuid,d[Z]=ee,ee}function w(K,Z){if(A[Z]!==void 0)return A[Z];const ie=K.arrayBuffers[Z],oe=new Uint32Array(ie).buffer;return A[Z]=oe,oe}const M=a.isInstancedBufferGeometry?new jV:new dn,L=a.data.index;if(L!==void 0){const K=Ld(L.type,L.array);M.setIndex(new ss(K,1))}const O=a.data.attributes;for(const K in O){const Z=O[K];let ie;if(Z.isInterleavedBufferAttribute){const oe=x(a.data,Z.data);ie=new bf(oe,Z.itemSize,Z.offset,Z.normalized)}else{const oe=Ld(Z.type,Z.array),ne=Z.isInstancedBufferAttribute?_0:ss;ie=new ne(oe,Z.itemSize,Z.normalized)}Z.name!==void 0&&(ie.name=Z.name),Z.usage!==void 0&&ie.setUsage(Z.usage),M.setAttribute(K,ie)}const F=a.data.morphAttributes;if(F)for(const K in F){const Z=F[K],ie=[];for(let oe=0,ne=Z.length;oe<ne;oe++){const ee=Z[oe];let Re;if(ee.isInterleavedBufferAttribute){const we=x(a.data,ee.data);Re=new bf(we,ee.itemSize,ee.offset,ee.normalized)}else{const we=Ld(ee.type,ee.array);Re=new ss(we,ee.itemSize,ee.normalized)}ee.name!==void 0&&(Re.name=ee.name),ie.push(Re)}M.morphAttributes[K]=ie}a.data.morphTargetsRelative&&(M.morphTargetsRelative=!0);const H=a.data.groups||a.data.drawcalls||a.data.offsets;if(H!==void 0)for(let K=0,Z=H.length;K!==Z;++K){const ie=H[K];M.addGroup(ie.start,ie.count,ie.materialIndex)}const J=a.data.boundingSphere;if(J!==void 0){const K=new He;J.center!==void 0&&K.fromArray(J.center),M.boundingSphere=new Aa(K,J.radius)}return a.name&&(M.name=a.name),a.userData&&(M.userData=a.userData),M}}class wMe extends tl{constructor(a){super(a)}load(a,d,A,x){const w=this,M=this.path===""?RL.extractUrlBase(a):this.path;this.resourcePath=this.resourcePath||M;const L=new Rh(this.manager);L.setPath(this.path),L.setRequestHeader(this.requestHeader),L.setWithCredentials(this.withCredentials),L.load(a,function(O){let F=null;try{F=JSON.parse(O)}catch(J){x!==void 0&&x(J),console.error("THREE:ObjectLoader: Can't parse "+a+".",J.message);return}const H=F.metadata;if(H===void 0||H.type===void 0||H.type.toLowerCase()==="geometry"){x!==void 0&&x(new Error("THREE.ObjectLoader: Can't load "+a)),console.error("THREE.ObjectLoader: Can't load "+a);return}w.parse(F,d)},A,x)}async loadAsync(a,d){const A=this,x=this.path===""?RL.extractUrlBase(a):this.path;this.resourcePath=this.resourcePath||x;const w=new Rh(this.manager);w.setPath(this.path),w.setRequestHeader(this.requestHeader),w.setWithCredentials(this.withCredentials);const M=await w.loadAsync(a,d),L=JSON.parse(M),O=L.metadata;if(O===void 0||O.type===void 0||O.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+a);return await A.parseAsync(L)}parse(a,d){const A=this.parseAnimations(a.animations),x=this.parseShapes(a.shapes),w=this.parseGeometries(a.geometries,x),M=this.parseImages(a.images,function(){d!==void 0&&d(F)}),L=this.parseTextures(a.textures,M),O=this.parseMaterials(a.materials,L),F=this.parseObject(a.object,w,O,L,A),H=this.parseSkeletons(a.skeletons,F);if(this.bindSkeletons(F,H),d!==void 0){let J=!1;for(const K in M)if(M[K].data instanceof HTMLImageElement){J=!0;break}J===!1&&d(F)}return F}async parseAsync(a){const d=this.parseAnimations(a.animations),A=this.parseShapes(a.shapes),x=this.parseGeometries(a.geometries,A),w=await this.parseImagesAsync(a.images),M=this.parseTextures(a.textures,w),L=this.parseMaterials(a.materials,M),O=this.parseObject(a.object,x,L,M,d),F=this.parseSkeletons(a.skeletons,O);return this.bindSkeletons(O,F),O}parseShapes(a){const d={};if(a!==void 0)for(let A=0,x=a.length;A<x;A++){const w=new _f().fromJSON(a[A]);d[w.uuid]=w}return d}parseSkeletons(a,d){const A={},x={};if(d.traverse(function(w){w.isBone&&(x[w.uuid]=w)}),a!==void 0)for(let w=0,M=a.length;w<M;w++){const L=new YE().fromJSON(a[w],x);A[L.uuid]=L}return A}parseGeometries(a,d){const A={};if(a!==void 0){const w=new VV;for(let M=0,L=a.length;M<L;M++){let O;const F=a[M];switch(F.type){case"BufferGeometry":case"InstancedBufferGeometry":O=w.parse(F);break;case"Geometry":if("THREE"in window&&"LegacyJSONLoader"in THREE){var x=new THREE.LegacyJSONLoader;O=x.parse(F,this.resourcePath).geometry}else console.error('THREE.ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type "Geometry".');break;default:F.type in fV?O=fV[F.type].fromJSON(F,d):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${F.type}"`)}O.uuid=F.uuid,F.name!==void 0&&(O.name=F.name),F.userData!==void 0&&(O.userData=F.userData),A[F.uuid]=O}}return A}parseMaterials(a,d){const A={},x={};if(a!==void 0){const w=new Tw;w.setTextures(d);for(let M=0,L=a.length;M<L;M++){const O=a[M];A[O.uuid]===void 0&&(A[O.uuid]=w.parse(O)),x[O.uuid]=A[O.uuid]}}return x}parseAnimations(a){const d={};if(a!==void 0)for(let A=0;A<a.length;A++){const x=a[A],w=Ov.parse(x);d[w.uuid]=w}return d}parseImages(a,d){const A=this,x={};let w;function M(O){return A.manager.itemStart(O),w.load(O,function(){A.manager.itemEnd(O)},void 0,function(){A.manager.itemError(O),A.manager.itemEnd(O)})}function L(O){if(typeof O=="string"){const F=O,H=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(F)?F:A.resourcePath+F;return M(H)}else return O.data?{data:Ld(O.type,O.data),width:O.width,height:O.height}:null}if(a!==void 0&&a.length>0){const O=new CL(d);w=new kv(O),w.setCrossOrigin(this.crossOrigin);for(let F=0,H=a.length;F<H;F++){const J=a[F],K=J.url;if(Array.isArray(K)){const Z=[];for(let ie=0,oe=K.length;ie<oe;ie++){const ne=K[ie],ee=L(ne);ee!==null&&(ee instanceof HTMLImageElement?Z.push(ee):Z.push(new jd(ee.data,ee.width,ee.height)))}x[J.uuid]=new xs(Z)}else{const Z=L(J.url);x[J.uuid]=new xs(Z)}}}return x}async parseImagesAsync(a){const d=this,A={};let x;async function w(M){if(typeof M=="string"){const L=M,O=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(L)?L:d.resourcePath+L;return await x.loadAsync(O)}else return M.data?{data:Ld(M.type,M.data),width:M.width,height:M.height}:null}if(a!==void 0&&a.length>0){x=new kv(this.manager),x.setCrossOrigin(this.crossOrigin);for(let M=0,L=a.length;M<L;M++){const O=a[M],F=O.url;if(Array.isArray(F)){const H=[];for(let J=0,K=F.length;J<K;J++){const Z=F[J],ie=await w(Z);ie!==null&&(ie instanceof HTMLImageElement?H.push(ie):H.push(new jd(ie.data,ie.width,ie.height)))}A[O.uuid]=new xs(H)}else{const H=await w(O.url);A[O.uuid]=new xs(H)}}}return A}parseTextures(a,d){function A(w,M){return typeof w=="number"?w:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",w),M[w])}const x={};if(a!==void 0)for(let w=0,M=a.length;w<M;w++){const L=a[w];L.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',L.uuid),d[L.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",L.image);const O=d[L.image],F=O.data;let H;Array.isArray(F)?(H=new fv,F.length===6&&(H.needsUpdate=!0)):(F&&F.data?H=new jd:H=new hs,F&&(H.needsUpdate=!0)),H.source=O,H.uuid=L.uuid,L.name!==void 0&&(H.name=L.name),L.mapping!==void 0&&(H.mapping=A(L.mapping,CMe)),L.channel!==void 0&&(H.channel=L.channel),L.offset!==void 0&&H.offset.fromArray(L.offset),L.repeat!==void 0&&H.repeat.fromArray(L.repeat),L.center!==void 0&&H.center.fromArray(L.center),L.rotation!==void 0&&(H.rotation=L.rotation),L.wrap!==void 0&&(H.wrapS=A(L.wrap[0],GV),H.wrapT=A(L.wrap[1],GV)),L.format!==void 0&&(H.format=L.format),L.internalFormat!==void 0&&(H.internalFormat=L.internalFormat),L.type!==void 0&&(H.type=L.type),L.colorSpace!==void 0&&(H.colorSpace=L.colorSpace),L.minFilter!==void 0&&(H.minFilter=A(L.minFilter,HV)),L.magFilter!==void 0&&(H.magFilter=A(L.magFilter,HV)),L.anisotropy!==void 0&&(H.anisotropy=L.anisotropy),L.flipY!==void 0&&(H.flipY=L.flipY),L.generateMipmaps!==void 0&&(H.generateMipmaps=L.generateMipmaps),L.premultiplyAlpha!==void 0&&(H.premultiplyAlpha=L.premultiplyAlpha),L.unpackAlignment!==void 0&&(H.unpackAlignment=L.unpackAlignment),L.compareFunction!==void 0&&(H.compareFunction=L.compareFunction),L.userData!==void 0&&(H.userData=L.userData),x[L.uuid]=H}return x}parseObject(a,d,A,x,w){let M;function L(K){return d[K]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",K),d[K]}function O(K){if(K!==void 0){if(Array.isArray(K)){const Z=[];for(let ie=0,oe=K.length;ie<oe;ie++){const ne=K[ie];A[ne]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",ne),Z.push(A[ne])}return Z}return A[K]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",K),A[K]}}function F(K){return x[K]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",K),x[K]}let H,J;switch(a.type){case"Scene":M=new C9,a.background!==void 0&&(Number.isInteger(a.background)?M.background=new or(a.background):M.background=F(a.background)),a.environment!==void 0&&(M.environment=F(a.environment)),a.fog!==void 0&&(a.fog.type==="Fog"?M.fog=new VE(a.fog.color,a.fog.near,a.fog.far):a.fog.type==="FogExp2"&&(M.fog=new jE(a.fog.color,a.fog.density)),a.fog.name!==""&&(M.fog.name=a.fog.name)),a.backgroundBlurriness!==void 0&&(M.backgroundBlurriness=a.backgroundBlurriness),a.backgroundIntensity!==void 0&&(M.backgroundIntensity=a.backgroundIntensity),a.backgroundRotation!==void 0&&M.backgroundRotation.fromArray(a.backgroundRotation),a.environmentIntensity!==void 0&&(M.environmentIntensity=a.environmentIntensity),a.environmentRotation!==void 0&&M.environmentRotation.fromArray(a.environmentRotation);break;case"PerspectiveCamera":M=new va(a.fov,a.aspect,a.near,a.far),a.focus!==void 0&&(M.focus=a.focus),a.zoom!==void 0&&(M.zoom=a.zoom),a.filmGauge!==void 0&&(M.filmGauge=a.filmGauge),a.filmOffset!==void 0&&(M.filmOffset=a.filmOffset),a.view!==void 0&&(M.view=Object.assign({},a.view));break;case"OrthographicCamera":M=new kE(a.left,a.right,a.top,a.bottom,a.near,a.far),a.zoom!==void 0&&(M.zoom=a.zoom),a.view!==void 0&&(M.view=Object.assign({},a.view));break;case"AmbientLight":M=new kV(a.color,a.intensity);break;case"DirectionalLight":M=new OV(a.color,a.intensity);break;case"PointLight":M=new PV(a.color,a.intensity,a.distance,a.decay);break;case"RectAreaLight":M=new FV(a.color,a.intensity,a.width,a.height);break;case"SpotLight":M=new DV(a.color,a.intensity,a.distance,a.angle,a.penumbra,a.decay);break;case"HemisphereLight":M=new IV(a.color,a.groundColor,a.intensity);break;case"LightProbe":M=new zV().fromJSON(a);break;case"SkinnedMesh":H=L(a.geometry),J=O(a.material),M=new k9(H,J),a.bindMode!==void 0&&(M.bindMode=a.bindMode),a.bindMatrix!==void 0&&M.bindMatrix.fromArray(a.bindMatrix),a.skeleton!==void 0&&(M.skeleton=a.skeleton);break;case"Mesh":H=L(a.geometry),J=O(a.material),M=new ua(H,J);break;case"InstancedMesh":H=L(a.geometry),J=O(a.material);const K=a.count,Z=a.instanceMatrix,ie=a.instanceColor;M=new j9(H,J,K),M.instanceMatrix=new _0(new Float32Array(Z.array),16),ie!==void 0&&(M.instanceColor=new _0(new Float32Array(ie.array),ie.itemSize));break;case"BatchedMesh":H=L(a.geometry),J=O(a.material),M=new H9(a.maxGeometryCount,a.maxVertexCount,a.maxIndexCount,J),M.geometry=H,M.perObjectFrustumCulled=a.perObjectFrustumCulled,M.sortObjects=a.sortObjects,M._drawRanges=a.drawRanges,M._reservedRanges=a.reservedRanges,M._visibility=a.visibility,M._active=a.active,M._bounds=a.bounds.map(oe=>{const ne=new Ds;ne.min.fromArray(oe.boxMin),ne.max.fromArray(oe.boxMax);const ee=new Aa;return ee.radius=oe.sphereRadius,ee.center.fromArray(oe.sphereCenter),{boxInitialized:oe.boxInitialized,box:ne,sphereInitialized:oe.sphereInitialized,sphere:ee}}),M._maxGeometryCount=a.maxGeometryCount,M._maxVertexCount=a.maxVertexCount,M._maxIndexCount=a.maxIndexCount,M._geometryInitialized=a.geometryInitialized,M._geometryCount=a.geometryCount,M._matricesTexture=F(a.matricesTexture.uuid);break;case"LOD":M=new B9;break;case"Line":M=new Gd(L(a.geometry),O(a.material));break;case"LineLoop":M=new Y9(L(a.geometry),O(a.material));break;case"LineSegments":M=new au(L(a.geometry),O(a.material));break;case"PointCloud":case"Points":M=new J9(L(a.geometry),O(a.material));break;case"Sprite":M=new R9(O(a.material));break;case"Group":M=new yf;break;case"Bone":M=new iL;break;default:M=new Gn}if(M.uuid=a.uuid,a.name!==void 0&&(M.name=a.name),a.matrix!==void 0?(M.matrix.fromArray(a.matrix),a.matrixAutoUpdate!==void 0&&(M.matrixAutoUpdate=a.matrixAutoUpdate),M.matrixAutoUpdate&&M.matrix.decompose(M.position,M.quaternion,M.scale)):(a.position!==void 0&&M.position.fromArray(a.position),a.rotation!==void 0&&M.rotation.fromArray(a.rotation),a.quaternion!==void 0&&M.quaternion.fromArray(a.quaternion),a.scale!==void 0&&M.scale.fromArray(a.scale)),a.up!==void 0&&M.up.fromArray(a.up),a.castShadow!==void 0&&(M.castShadow=a.castShadow),a.receiveShadow!==void 0&&(M.receiveShadow=a.receiveShadow),a.shadow&&(a.shadow.bias!==void 0&&(M.shadow.bias=a.shadow.bias),a.shadow.normalBias!==void 0&&(M.shadow.normalBias=a.shadow.normalBias),a.shadow.radius!==void 0&&(M.shadow.radius=a.shadow.radius),a.shadow.mapSize!==void 0&&M.shadow.mapSize.fromArray(a.shadow.mapSize),a.shadow.camera!==void 0&&(M.shadow.camera=this.parseObject(a.shadow.camera))),a.visible!==void 0&&(M.visible=a.visible),a.frustumCulled!==void 0&&(M.frustumCulled=a.frustumCulled),a.renderOrder!==void 0&&(M.renderOrder=a.renderOrder),a.userData!==void 0&&(M.userData=a.userData),a.layers!==void 0&&(M.layers.mask=a.layers),a.children!==void 0){const K=a.children;for(let Z=0;Z<K.length;Z++)M.add(this.parseObject(K[Z],d,A,x,w))}if(a.animations!==void 0){const K=a.animations;for(let Z=0;Z<K.length;Z++){const ie=K[Z];M.animations.push(w[ie])}}if(a.type==="LOD"){a.autoUpdate!==void 0&&(M.autoUpdate=a.autoUpdate);const K=a.levels;for(let Z=0;Z<K.length;Z++){const ie=K[Z],oe=M.getObjectByProperty("uuid",ie.object);oe!==void 0&&M.addLevel(oe,ie.distance,ie.hysteresis)}}return M}bindSkeletons(a,d){Object.keys(d).length!==0&&a.traverse(function(A){if(A.isSkinnedMesh===!0&&A.skeleton!==void 0){const x=d[A.skeleton];x===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",A.skeleton):A.bind(x,A.bindMatrix)}})}}const CMe={UVMapping:Ie,CubeReflectionMapping:U,CubeRefractionMapping:$,EquirectangularReflectionMapping:re,EquirectangularRefractionMapping:Me,CubeUVReflectionMapping:ce},GV={RepeatWrapping:ze,ClampToEdgeWrapping:Ve,MirroredRepeatWrapping:pt},HV={NearestFilter:Dt,NearestMipmapNearestFilter:xt,NearestMipmapLinearFilter:fi,LinearFilter:ki,LinearMipmapNearestFilter:mn,LinearMipmapLinearFilter:rn};class SMe extends tl{constructor(a){super(a),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(a){return this.options=a,this}load(a,d,A,x){a===void 0&&(a=""),this.path!==void 0&&(a=this.path+a),a=this.manager.resolveURL(a);const w=this,M=Th.get(a);if(M!==void 0){if(w.manager.itemStart(a),M.then){M.then(F=>{d&&d(F),w.manager.itemEnd(a)}).catch(F=>{x&&x(F)});return}return setTimeout(function(){d&&d(M),w.manager.itemEnd(a)},0),M}const L={};L.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",L.headers=this.requestHeader;const O=fetch(a,L).then(function(F){return F.blob()}).then(function(F){return createImageBitmap(F,Object.assign(w.options,{colorSpaceConversion:"none"}))}).then(function(F){return Th.add(a,F),d&&d(F),w.manager.itemEnd(a),F}).catch(function(F){x&&x(F),Th.remove(a),w.manager.itemError(a),w.manager.itemEnd(a)});Th.add(a,O),w.manager.itemStart(a)}}let Mw;class IL{static getContext(){return Mw===void 0&&(Mw=new(window.AudioContext||window.webkitAudioContext)),Mw}static setContext(a){Mw=a}}class TMe extends tl{constructor(a){super(a)}load(a,d,A,x){const w=this,M=new Rh(this.manager);M.setResponseType("arraybuffer"),M.setPath(this.path),M.setRequestHeader(this.requestHeader),M.setWithCredentials(this.withCredentials),M.load(a,function(O){try{const F=O.slice(0);IL.getContext().decodeAudioData(F,function(H){d(H)}).catch(L)}catch(F){L(F)}},A,x);function L(O){x?x(O):console.error(O),w.manager.itemError(a)}}}const WV=new fr,QV=new fr,Tf=new fr;class MMe{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new va,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new va,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(a){const d=this._cache;if(d.focus!==a.focus||d.fov!==a.fov||d.aspect!==a.aspect*this.aspect||d.near!==a.near||d.far!==a.far||d.zoom!==a.zoom||d.eyeSep!==this.eyeSep){d.focus=a.focus,d.fov=a.fov,d.aspect=a.aspect*this.aspect,d.near=a.near,d.far=a.far,d.zoom=a.zoom,d.eyeSep=this.eyeSep,Tf.copy(a.projectionMatrix);const A=d.eyeSep/2,x=A*d.near/d.focus,w=d.near*Math.tan(vh*d.fov*.5)/d.zoom;let M,L;QV.elements[12]=-A,WV.elements[12]=A,M=-w*d.aspect+x,L=w*d.aspect+x,Tf.elements[0]=2*d.near/(L-M),Tf.elements[8]=(L+M)/(L-M),this.cameraL.projectionMatrix.copy(Tf),M=-w*d.aspect-x,L=w*d.aspect-x,Tf.elements[0]=2*d.near/(L-M),Tf.elements[8]=(L+M)/(L-M),this.cameraR.projectionMatrix.copy(Tf)}this.cameraL.matrixWorld.copy(a.matrixWorld).multiply(QV),this.cameraR.matrixWorld.copy(a.matrixWorld).multiply(WV)}}class qV{constructor(a=!0){this.autoStart=a,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=XV(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let a=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const d=XV();a=(d-this.oldTime)/1e3,this.oldTime=d,this.elapsedTime+=a}return a}}function XV(){return(typeof performance>"u"?Date:performance).now()}const Mf=new He,YV=new Vn,RMe=new He,Rf=new He;class IMe extends Gn{constructor(){super(),this.type="AudioListener",this.context=IL.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new qV}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(a){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=a,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(a){return this.gain.gain.setTargetAtTime(a,this.context.currentTime,.01),this}updateMatrixWorld(a){super.updateMatrixWorld(a);const d=this.context.listener,A=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Mf,YV,RMe),Rf.set(0,0,-1).applyQuaternion(YV),d.positionX){const x=this.context.currentTime+this.timeDelta;d.positionX.linearRampToValueAtTime(Mf.x,x),d.positionY.linearRampToValueAtTime(Mf.y,x),d.positionZ.linearRampToValueAtTime(Mf.z,x),d.forwardX.linearRampToValueAtTime(Rf.x,x),d.forwardY.linearRampToValueAtTime(Rf.y,x),d.forwardZ.linearRampToValueAtTime(Rf.z,x),d.upX.linearRampToValueAtTime(A.x,x),d.upY.linearRampToValueAtTime(A.y,x),d.upZ.linearRampToValueAtTime(A.z,x)}else d.setPosition(Mf.x,Mf.y,Mf.z),d.setOrientation(Rf.x,Rf.y,Rf.z,A.x,A.y,A.z)}}class KV extends Gn{constructor(a){super(),this.type="Audio",this.listener=a,this.context=a.context,this.gain=this.context.createGain(),this.gain.connect(a.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(a){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=a,this.connect(),this}setMediaElementSource(a){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(a),this.connect(),this}setMediaStreamSource(a){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(a),this.connect(),this}setBuffer(a){return this.buffer=a,this.sourceType="buffer",this.autoplay&&this.play(),this}play(a=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+a;const d=this.context.createBufferSource();return d.buffer=this.buffer,d.loop=this.loop,d.loopStart=this.loopStart,d.loopEnd=this.loopEnd,d.onended=this.onEnded.bind(this),d.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=d,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let a=1,d=this.filters.length;a<d;a++)this.filters[a-1].connect(this.filters[a]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let a=1,d=this.filters.length;a<d;a++)this.filters[a-1].disconnect(this.filters[a]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(a){return a||(a=[]),this._connected===!0?(this.disconnect(),this.filters=a.slice(),this.connect()):this.filters=a.slice(),this}setDetune(a){return this.detune=a,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(a){return this.setFilters(a?[a]:[])}setPlaybackRate(a){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=a,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(a){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=a,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(a){return this.loopStart=a,this}setLoopEnd(a){return this.loopEnd=a,this}getVolume(){return this.gain.gain.value}setVolume(a){return this.gain.gain.setTargetAtTime(a,this.context.currentTime,.01),this}}const If=new He,JV=new Vn,BMe=new He,Bf=new He;class LMe extends KV{constructor(a){super(a),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(a){return this.panner.refDistance=a,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(a){return this.panner.rolloffFactor=a,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(a){return this.panner.distanceModel=a,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(a){return this.panner.maxDistance=a,this}setDirectionalCone(a,d,A){return this.panner.coneInnerAngle=a,this.panner.coneOuterAngle=d,this.panner.coneOuterGain=A,this}updateMatrixWorld(a){if(super.updateMatrixWorld(a),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(If,JV,BMe),Bf.set(0,0,1).applyQuaternion(JV);const d=this.panner;if(d.positionX){const A=this.context.currentTime+this.listener.timeDelta;d.positionX.linearRampToValueAtTime(If.x,A),d.positionY.linearRampToValueAtTime(If.y,A),d.positionZ.linearRampToValueAtTime(If.z,A),d.orientationX.linearRampToValueAtTime(Bf.x,A),d.orientationY.linearRampToValueAtTime(Bf.y,A),d.orientationZ.linearRampToValueAtTime(Bf.z,A)}else d.setPosition(If.x,If.y,If.z),d.setOrientation(Bf.x,Bf.y,Bf.z)}}class DMe{constructor(a,d=2048){this.analyser=a.context.createAnalyser(),this.analyser.fftSize=d,this.data=new Uint8Array(this.analyser.frequencyBinCount),a.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let a=0;const d=this.getFrequencyData();for(let A=0;A<d.length;A++)a+=d[A];return a/d.length}}class ZV{constructor(a,d,A){this.binding=a,this.valueSize=A;let x,w,M;switch(d){case"quaternion":x=this._slerp,w=this._slerpAdditive,M=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(A*6),this._workIndex=5;break;case"string":case"bool":x=this._select,w=this._select,M=this._setAdditiveIdentityOther,this.buffer=new Array(A*5);break;default:x=this._lerp,w=this._lerpAdditive,M=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(A*5)}this._mixBufferRegion=x,this._mixBufferRegionAdditive=w,this._setIdentity=M,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(a,d){const A=this.buffer,x=this.valueSize,w=a*x+x;let M=this.cumulativeWeight;if(M===0){for(let L=0;L!==x;++L)A[w+L]=A[L];M=d}else{M+=d;const L=d/M;this._mixBufferRegion(A,w,0,L,x)}this.cumulativeWeight=M}accumulateAdditive(a){const d=this.buffer,A=this.valueSize,x=A*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(d,x,0,a,A),this.cumulativeWeightAdditive+=a}apply(a){const d=this.valueSize,A=this.buffer,x=a*d+d,w=this.cumulativeWeight,M=this.cumulativeWeightAdditive,L=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,w<1){const O=d*this._origIndex;this._mixBufferRegion(A,x,O,1-w,d)}M>0&&this._mixBufferRegionAdditive(A,x,this._addIndex*d,1,d);for(let O=d,F=d+d;O!==F;++O)if(A[O]!==A[O+d]){L.setValue(A,x);break}}saveOriginalState(){const a=this.binding,d=this.buffer,A=this.valueSize,x=A*this._origIndex;a.getValue(d,x);for(let w=A,M=x;w!==M;++w)d[w]=d[x+w%A];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const a=this.valueSize*3;this.binding.setValue(this.buffer,a)}_setAdditiveIdentityNumeric(){const a=this._addIndex*this.valueSize,d=a+this.valueSize;for(let A=a;A<d;A++)this.buffer[A]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const a=this._origIndex*this.valueSize,d=this._addIndex*this.valueSize;for(let A=0;A<this.valueSize;A++)this.buffer[d+A]=this.buffer[a+A]}_select(a,d,A,x,w){if(x>=.5)for(let M=0;M!==w;++M)a[d+M]=a[A+M]}_slerp(a,d,A,x){Vn.slerpFlat(a,d,a,d,a,A,x)}_slerpAdditive(a,d,A,x,w){const M=this._workIndex*w;Vn.multiplyQuaternionsFlat(a,M,a,d,a,A),Vn.slerpFlat(a,d,a,d,a,M,x)}_lerp(a,d,A,x,w){const M=1-x;for(let L=0;L!==w;++L){const O=d+L;a[O]=a[O]*M+a[A+L]*x}}_lerpAdditive(a,d,A,x,w){for(let M=0;M!==w;++M){const L=d+M;a[L]=a[L]+a[A+M]*x}}}const BL="\\[\\]\\.:\\/",NMe=new RegExp("["+BL+"]","g"),LL="[^"+BL+"]",PMe="[^"+BL.replace("\\.","")+"]",OMe=/((?:WC+[\/:])*)/.source.replace("WC",LL),kMe=/(WCOD+)?/.source.replace("WCOD",PMe),FMe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",LL),UMe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",LL),zMe=new RegExp("^"+OMe+kMe+FMe+UMe+"$"),jMe=["material","materials","bones","map"];class VMe{constructor(a,d,A){const x=A||Un.parseTrackName(d);this._targetGroup=a,this._bindings=a.subscribe_(d,x)}getValue(a,d){this.bind();const A=this._targetGroup.nCachedObjects_,x=this._bindings[A];x!==void 0&&x.getValue(a,d)}setValue(a,d){const A=this._bindings;for(let x=this._targetGroup.nCachedObjects_,w=A.length;x!==w;++x)A[x].setValue(a,d)}bind(){const a=this._bindings;for(let d=this._targetGroup.nCachedObjects_,A=a.length;d!==A;++d)a[d].bind()}unbind(){const a=this._bindings;for(let d=this._targetGroup.nCachedObjects_,A=a.length;d!==A;++d)a[d].unbind()}}class Un{constructor(a,d,A){this.path=d,this.parsedPath=A||Un.parseTrackName(d),this.node=Un.findNode(a,this.parsedPath.nodeName),this.rootNode=a,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(a,d,A){return a&&a.isAnimationObjectGroup?new Un.Composite(a,d,A):new Un(a,d,A)}static sanitizeNodeName(a){return a.replace(/\s/g,"_").replace(NMe,"")}static parseTrackName(a){const d=zMe.exec(a);if(d===null)throw new Error("PropertyBinding: Cannot parse trackName: "+a);const A={nodeName:d[2],objectName:d[3],objectIndex:d[4],propertyName:d[5],propertyIndex:d[6]},x=A.nodeName&&A.nodeName.lastIndexOf(".");if(x!==void 0&&x!==-1){const w=A.nodeName.substring(x+1);jMe.indexOf(w)!==-1&&(A.nodeName=A.nodeName.substring(0,x),A.objectName=w)}if(A.propertyName===null||A.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+a);return A}static findNode(a,d){if(d===void 0||d===""||d==="."||d===-1||d===a.name||d===a.uuid)return a;if(a.skeleton){const A=a.skeleton.getBoneByName(d);if(A!==void 0)return A}if(a.children){const A=function(w){for(let M=0;M<w.length;M++){const L=w[M];if(L.name===d||L.uuid===d)return L;const O=A(L.children);if(O)return O}return null},x=A(a.children);if(x)return x}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(a,d){a[d]=this.targetObject[this.propertyName]}_getValue_array(a,d){const A=this.resolvedProperty;for(let x=0,w=A.length;x!==w;++x)a[d++]=A[x]}_getValue_arrayElement(a,d){a[d]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(a,d){this.resolvedProperty.toArray(a,d)}_setValue_direct(a,d){this.targetObject[this.propertyName]=a[d]}_setValue_direct_setNeedsUpdate(a,d){this.targetObject[this.propertyName]=a[d],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(a,d){this.targetObject[this.propertyName]=a[d],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(a,d){const A=this.resolvedProperty;for(let x=0,w=A.length;x!==w;++x)A[x]=a[d++]}_setValue_array_setNeedsUpdate(a,d){const A=this.resolvedProperty;for(let x=0,w=A.length;x!==w;++x)A[x]=a[d++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(a,d){const A=this.resolvedProperty;for(let x=0,w=A.length;x!==w;++x)A[x]=a[d++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(a,d){this.resolvedProperty[this.propertyIndex]=a[d]}_setValue_arrayElement_setNeedsUpdate(a,d){this.resolvedProperty[this.propertyIndex]=a[d],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(a,d){this.resolvedProperty[this.propertyIndex]=a[d],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(a,d){this.resolvedProperty.fromArray(a,d)}_setValue_fromArray_setNeedsUpdate(a,d){this.resolvedProperty.fromArray(a,d),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(a,d){this.resolvedProperty.fromArray(a,d),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(a,d){this.bind(),this.getValue(a,d)}_setValue_unbound(a,d){this.bind(),this.setValue(a,d)}bind(){let a=this.node;const d=this.parsedPath,A=d.objectName,x=d.propertyName;let w=d.propertyIndex;if(a||(a=Un.findNode(this.rootNode,d.nodeName),this.node=a),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!a){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(A){let F=d.objectIndex;switch(A){case"materials":if(!a.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!a.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}a=a.material.materials;break;case"bones":if(!a.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}a=a.skeleton.bones;for(let H=0;H<a.length;H++)if(a[H].name===F){F=H;break}break;case"map":if("map"in a){a=a.map;break}if(!a.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!a.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}a=a.material.map;break;default:if(a[A]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}a=a[A]}if(F!==void 0){if(a[F]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,a);return}a=a[F]}}const M=a[x];if(M===void 0){const F=d.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+F+"."+x+" but it wasn't found.",a);return}let L=this.Versioning.None;this.targetObject=a,a.needsUpdate!==void 0?L=this.Versioning.NeedsUpdate:a.matrixWorldNeedsUpdate!==void 0&&(L=this.Versioning.MatrixWorldNeedsUpdate);let O=this.BindingType.Direct;if(w!==void 0){if(x==="morphTargetInfluences"){if(!a.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!a.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}a.morphTargetDictionary[w]!==void 0&&(w=a.morphTargetDictionary[w])}O=this.BindingType.ArrayElement,this.resolvedProperty=M,this.propertyIndex=w}else M.fromArray!==void 0&&M.toArray!==void 0?(O=this.BindingType.HasFromToArray,this.resolvedProperty=M):Array.isArray(M)?(O=this.BindingType.EntireArray,this.resolvedProperty=M):this.propertyName=x;this.getValue=this.GetterByBindingType[O],this.setValue=this.SetterByBindingTypeAndVersioning[O][L]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Un.Composite=VMe,Un.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Un.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Un.prototype.GetterByBindingType=[Un.prototype._getValue_direct,Un.prototype._getValue_array,Un.prototype._getValue_arrayElement,Un.prototype._getValue_toArray],Un.prototype.SetterByBindingTypeAndVersioning=[[Un.prototype._setValue_direct,Un.prototype._setValue_direct_setNeedsUpdate,Un.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Un.prototype._setValue_array,Un.prototype._setValue_array_setNeedsUpdate,Un.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Un.prototype._setValue_arrayElement,Un.prototype._setValue_arrayElement_setNeedsUpdate,Un.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Un.prototype._setValue_fromArray,Un.prototype._setValue_fromArray_setNeedsUpdate,Un.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class GMe{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Ro(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const a={};this._indicesByUUID=a;for(let A=0,x=arguments.length;A!==x;++A)a[arguments[A].uuid]=A;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const d=this;this.stats={objects:{get total(){return d._objects.length},get inUse(){return this.total-d.nCachedObjects_}},get bindingsPerObject(){return d._bindings.length}}}add(){const a=this._objects,d=this._indicesByUUID,A=this._paths,x=this._parsedPaths,w=this._bindings,M=w.length;let L,O=a.length,F=this.nCachedObjects_;for(let H=0,J=arguments.length;H!==J;++H){const K=arguments[H],Z=K.uuid;let ie=d[Z];if(ie===void 0){ie=O++,d[Z]=ie,a.push(K);for(let oe=0,ne=M;oe!==ne;++oe)w[oe].push(new Un(K,A[oe],x[oe]))}else if(ie<F){L=a[ie];const oe=--F,ne=a[oe];d[ne.uuid]=ie,a[ie]=ne,d[Z]=oe,a[oe]=K;for(let ee=0,Re=M;ee!==Re;++ee){const we=w[ee],_e=we[oe];let st=we[ie];we[ie]=_e,st===void 0&&(st=new Un(K,A[ee],x[ee])),we[oe]=st}}else a[ie]!==L&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=F}remove(){const a=this._objects,d=this._indicesByUUID,A=this._bindings,x=A.length;let w=this.nCachedObjects_;for(let M=0,L=arguments.length;M!==L;++M){const O=arguments[M],F=O.uuid,H=d[F];if(H!==void 0&&H>=w){const J=w++,K=a[J];d[K.uuid]=H,a[H]=K,d[F]=J,a[J]=O;for(let Z=0,ie=x;Z!==ie;++Z){const oe=A[Z],ne=oe[J],ee=oe[H];oe[H]=ne,oe[J]=ee}}}this.nCachedObjects_=w}uncache(){const a=this._objects,d=this._indicesByUUID,A=this._bindings,x=A.length;let w=this.nCachedObjects_,M=a.length;for(let L=0,O=arguments.length;L!==O;++L){const F=arguments[L],H=F.uuid,J=d[H];if(J!==void 0)if(delete d[H],J<w){const K=--w,Z=a[K],ie=--M,oe=a[ie];d[Z.uuid]=J,a[J]=Z,d[oe.uuid]=K,a[K]=oe,a.pop();for(let ne=0,ee=x;ne!==ee;++ne){const Re=A[ne],we=Re[K],_e=Re[ie];Re[J]=we,Re[K]=_e,Re.pop()}}else{const K=--M,Z=a[K];K>0&&(d[Z.uuid]=J),a[J]=Z,a.pop();for(let ie=0,oe=x;ie!==oe;++ie){const ne=A[ie];ne[J]=ne[K],ne.pop()}}}this.nCachedObjects_=w}subscribe_(a,d){const A=this._bindingsIndicesByPath;let x=A[a];const w=this._bindings;if(x!==void 0)return w[x];const M=this._paths,L=this._parsedPaths,O=this._objects,F=O.length,H=this.nCachedObjects_,J=new Array(F);x=w.length,A[a]=x,M.push(a),L.push(d),w.push(J);for(let K=H,Z=O.length;K!==Z;++K){const ie=O[K];J[K]=new Un(ie,a,d)}return J}unsubscribe_(a){const d=this._bindingsIndicesByPath,A=d[a];if(A!==void 0){const x=this._paths,w=this._parsedPaths,M=this._bindings,L=M.length-1,O=M[L],F=a[L];d[F]=A,M[A]=O,M.pop(),w[A]=w[L],w.pop(),x[A]=x[L],x.pop()}}}class $V{constructor(a,d,A=null,x=d.blendMode){this._mixer=a,this._clip=d,this._localRoot=A,this.blendMode=x;const w=d.tracks,M=w.length,L=new Array(M),O={endingStart:Vr,endingEnd:Vr};for(let F=0;F!==M;++F){const H=w[F].createInterpolant(null);L[F]=H,H.settings=O}this._interpolantSettings=O,this._interpolants=L,this._propertyBindings=new Array(M),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=pr,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(a){return this._startTime=a,this}setLoop(a,d){return this.loop=a,this.repetitions=d,this}setEffectiveWeight(a){return this.weight=a,this._effectiveWeight=this.enabled?a:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(a){return this._scheduleFading(a,0,1)}fadeOut(a){return this._scheduleFading(a,1,0)}crossFadeFrom(a,d,A){if(a.fadeOut(d),this.fadeIn(d),A){const x=this._clip.duration,w=a._clip.duration,M=w/x,L=x/w;a.warp(1,M,d),this.warp(L,1,d)}return this}crossFadeTo(a,d,A){return a.crossFadeFrom(this,d,A)}stopFading(){const a=this._weightInterpolant;return a!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(a)),this}setEffectiveTimeScale(a){return this.timeScale=a,this._effectiveTimeScale=this.paused?0:a,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(a){return this.timeScale=this._clip.duration/a,this.stopWarping()}syncWith(a){return this.time=a.time,this.timeScale=a.timeScale,this.stopWarping()}halt(a){return this.warp(this._effectiveTimeScale,0,a)}warp(a,d,A){const x=this._mixer,w=x.time,M=this.timeScale;let L=this._timeScaleInterpolant;L===null&&(L=x._lendControlInterpolant(),this._timeScaleInterpolant=L);const O=L.parameterPositions,F=L.sampleValues;return O[0]=w,O[1]=w+A,F[0]=a/M,F[1]=d/M,this}stopWarping(){const a=this._timeScaleInterpolant;return a!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(a)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(a,d,A,x){if(!this.enabled){this._updateWeight(a);return}const w=this._startTime;if(w!==null){const O=(a-w)*A;O<0||A===0?d=0:(this._startTime=null,d=A*O)}d*=this._updateTimeScale(a);const M=this._updateTime(d),L=this._updateWeight(a);if(L>0){const O=this._interpolants,F=this._propertyBindings;switch(this.blendMode){case Nr:for(let H=0,J=O.length;H!==J;++H)O[H].evaluate(M),F[H].accumulateAdditive(L);break;case us:default:for(let H=0,J=O.length;H!==J;++H)O[H].evaluate(M),F[H].accumulate(x,L)}}}_updateWeight(a){let d=0;if(this.enabled){d=this.weight;const A=this._weightInterpolant;if(A!==null){const x=A.evaluate(a)[0];d*=x,a>A.parameterPositions[1]&&(this.stopFading(),x===0&&(this.enabled=!1))}}return this._effectiveWeight=d,d}_updateTimeScale(a){let d=0;if(!this.paused){d=this.timeScale;const A=this._timeScaleInterpolant;if(A!==null){const x=A.evaluate(a)[0];d*=x,a>A.parameterPositions[1]&&(this.stopWarping(),d===0?this.paused=!0:this.timeScale=d)}}return this._effectiveTimeScale=d,d}_updateTime(a){const d=this._clip.duration,A=this.loop;let x=this.time+a,w=this._loopCount;const M=A===Wi;if(a===0)return w===-1?x:M&&(w&1)===1?d-x:x;if(A===dr){w===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));i:{if(x>=d)x=d;else if(x<0)x=0;else{this.time=x;break i}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=x,this._mixer.dispatchEvent({type:"finished",action:this,direction:a<0?-1:1})}}else{if(w===-1&&(a>=0?(w=0,this._setEndings(!0,this.repetitions===0,M)):this._setEndings(this.repetitions===0,!0,M)),x>=d||x<0){const L=Math.floor(x/d);x-=d*L,w+=Math.abs(L);const O=this.repetitions-w;if(O<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,x=a>0?d:0,this.time=x,this._mixer.dispatchEvent({type:"finished",action:this,direction:a>0?1:-1});else{if(O===1){const F=a<0;this._setEndings(F,!F,M)}else this._setEndings(!1,!1,M);this._loopCount=w,this.time=x,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:L})}}else this.time=x;if(M&&(w&1)===1)return d-x}return x}_setEndings(a,d,A){const x=this._interpolantSettings;A?(x.endingStart=bn,x.endingEnd=bn):(a?x.endingStart=this.zeroSlopeAtStart?bn:Vr:x.endingStart=jr,d?x.endingEnd=this.zeroSlopeAtEnd?bn:Vr:x.endingEnd=jr)}_scheduleFading(a,d,A){const x=this._mixer,w=x.time;let M=this._weightInterpolant;M===null&&(M=x._lendControlInterpolant(),this._weightInterpolant=M);const L=M.parameterPositions,O=M.sampleValues;return L[0]=w,O[0]=d,L[1]=w+a,O[1]=A,this}}const HMe=new Float32Array(1);class WMe extends Mo{constructor(a){super(),this._root=a,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(a,d){const A=a._localRoot||this._root,x=a._clip.tracks,w=x.length,M=a._propertyBindings,L=a._interpolants,O=A.uuid,F=this._bindingsByRootAndName;let H=F[O];H===void 0&&(H={},F[O]=H);for(let J=0;J!==w;++J){const K=x[J],Z=K.name;let ie=H[Z];if(ie!==void 0)++ie.referenceCount,M[J]=ie;else{if(ie=M[J],ie!==void 0){ie._cacheIndex===null&&(++ie.referenceCount,this._addInactiveBinding(ie,O,Z));continue}const oe=d&&d._propertyBindings[J].binding.parsedPath;ie=new ZV(Un.create(A,Z,oe),K.ValueTypeName,K.getValueSize()),++ie.referenceCount,this._addInactiveBinding(ie,O,Z),M[J]=ie}L[J].resultBuffer=ie.buffer}}_activateAction(a){if(!this._isActiveAction(a)){if(a._cacheIndex===null){const A=(a._localRoot||this._root).uuid,x=a._clip.uuid,w=this._actionsByClip[x];this._bindAction(a,w&&w.knownActions[0]),this._addInactiveAction(a,x,A)}const d=a._propertyBindings;for(let A=0,x=d.length;A!==x;++A){const w=d[A];w.useCount++===0&&(this._lendBinding(w),w.saveOriginalState())}this._lendAction(a)}}_deactivateAction(a){if(this._isActiveAction(a)){const d=a._propertyBindings;for(let A=0,x=d.length;A!==x;++A){const w=d[A];--w.useCount===0&&(w.restoreOriginalState(),this._takeBackBinding(w))}this._takeBackAction(a)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const a=this;this.stats={actions:{get total(){return a._actions.length},get inUse(){return a._nActiveActions}},bindings:{get total(){return a._bindings.length},get inUse(){return a._nActiveBindings}},controlInterpolants:{get total(){return a._controlInterpolants.length},get inUse(){return a._nActiveControlInterpolants}}}}_isActiveAction(a){const d=a._cacheIndex;return d!==null&&d<this._nActiveActions}_addInactiveAction(a,d,A){const x=this._actions,w=this._actionsByClip;let M=w[d];if(M===void 0)M={knownActions:[a],actionByRoot:{}},a._byClipCacheIndex=0,w[d]=M;else{const L=M.knownActions;a._byClipCacheIndex=L.length,L.push(a)}a._cacheIndex=x.length,x.push(a),M.actionByRoot[A]=a}_removeInactiveAction(a){const d=this._actions,A=d[d.length-1],x=a._cacheIndex;A._cacheIndex=x,d[x]=A,d.pop(),a._cacheIndex=null;const w=a._clip.uuid,M=this._actionsByClip,L=M[w],O=L.knownActions,F=O[O.length-1],H=a._byClipCacheIndex;F._byClipCacheIndex=H,O[H]=F,O.pop(),a._byClipCacheIndex=null;const J=L.actionByRoot,K=(a._localRoot||this._root).uuid;delete J[K],O.length===0&&delete M[w],this._removeInactiveBindingsForAction(a)}_removeInactiveBindingsForAction(a){const d=a._propertyBindings;for(let A=0,x=d.length;A!==x;++A){const w=d[A];--w.referenceCount===0&&this._removeInactiveBinding(w)}}_lendAction(a){const d=this._actions,A=a._cacheIndex,x=this._nActiveActions++,w=d[x];a._cacheIndex=x,d[x]=a,w._cacheIndex=A,d[A]=w}_takeBackAction(a){const d=this._actions,A=a._cacheIndex,x=--this._nActiveActions,w=d[x];a._cacheIndex=x,d[x]=a,w._cacheIndex=A,d[A]=w}_addInactiveBinding(a,d,A){const x=this._bindingsByRootAndName,w=this._bindings;let M=x[d];M===void 0&&(M={},x[d]=M),M[A]=a,a._cacheIndex=w.length,w.push(a)}_removeInactiveBinding(a){const d=this._bindings,A=a.binding,x=A.rootNode.uuid,w=A.path,M=this._bindingsByRootAndName,L=M[x],O=d[d.length-1],F=a._cacheIndex;O._cacheIndex=F,d[F]=O,d.pop(),delete L[w],Object.keys(L).length===0&&delete M[x]}_lendBinding(a){const d=this._bindings,A=a._cacheIndex,x=this._nActiveBindings++,w=d[x];a._cacheIndex=x,d[x]=a,w._cacheIndex=A,d[A]=w}_takeBackBinding(a){const d=this._bindings,A=a._cacheIndex,x=--this._nActiveBindings,w=d[x];a._cacheIndex=x,d[x]=a,w._cacheIndex=A,d[A]=w}_lendControlInterpolant(){const a=this._controlInterpolants,d=this._nActiveControlInterpolants++;let A=a[d];return A===void 0&&(A=new EL(new Float32Array(2),new Float32Array(2),1,HMe),A.__cacheIndex=d,a[d]=A),A}_takeBackControlInterpolant(a){const d=this._controlInterpolants,A=a.__cacheIndex,x=--this._nActiveControlInterpolants,w=d[x];a.__cacheIndex=x,d[x]=a,w.__cacheIndex=A,d[A]=w}clipAction(a,d,A){const x=d||this._root,w=x.uuid;let M=typeof a=="string"?Ov.findByName(x,a):a;const L=M!==null?M.uuid:a,O=this._actionsByClip[L];let F=null;if(A===void 0&&(M!==null?A=M.blendMode:A=us),O!==void 0){const J=O.actionByRoot[w];if(J!==void 0&&J.blendMode===A)return J;F=O.knownActions[0],M===null&&(M=F._clip)}if(M===null)return null;const H=new $V(this,M,d,A);return this._bindAction(H,F),this._addInactiveAction(H,L,w),H}existingAction(a,d){const A=d||this._root,x=A.uuid,w=typeof a=="string"?Ov.findByName(A,a):a,M=w?w.uuid:a,L=this._actionsByClip[M];return L!==void 0&&L.actionByRoot[x]||null}stopAllAction(){const a=this._actions,d=this._nActiveActions;for(let A=d-1;A>=0;--A)a[A].stop();return this}update(a){a*=this.timeScale;const d=this._actions,A=this._nActiveActions,x=this.time+=a,w=Math.sign(a),M=this._accuIndex^=1;for(let F=0;F!==A;++F)d[F]._update(x,a,w,M);const L=this._bindings,O=this._nActiveBindings;for(let F=0;F!==O;++F)L[F].apply(M);return this}setTime(a){this.time=0;for(let d=0;d<this._actions.length;d++)this._actions[d].time=0;return this.update(a)}getRoot(){return this._root}uncacheClip(a){const d=this._actions,A=a.uuid,x=this._actionsByClip,w=x[A];if(w!==void 0){const M=w.knownActions;for(let L=0,O=M.length;L!==O;++L){const F=M[L];this._deactivateAction(F);const H=F._cacheIndex,J=d[d.length-1];F._cacheIndex=null,F._byClipCacheIndex=null,J._cacheIndex=H,d[H]=J,d.pop(),this._removeInactiveBindingsForAction(F)}delete x[A]}}uncacheRoot(a){const d=a.uuid,A=this._actionsByClip;for(const M in A){const L=A[M].actionByRoot,O=L[d];O!==void 0&&(this._deactivateAction(O),this._removeInactiveAction(O))}const x=this._bindingsByRootAndName,w=x[d];if(w!==void 0)for(const M in w){const L=w[M];L.restoreOriginalState(),this._removeInactiveBinding(L)}}uncacheAction(a,d){const A=this.existingAction(a,d);A!==null&&(this._deactivateAction(A),this._removeInactiveAction(A))}}class DL{constructor(a){this.value=a}clone(){return new DL(this.value.clone===void 0?this.value:this.value.clone())}}let QMe=0;class qMe extends Mo{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:QMe++}),this.name="",this.usage=lf,this.uniforms=[]}add(a){return this.uniforms.push(a),this}remove(a){const d=this.uniforms.indexOf(a);return d!==-1&&this.uniforms.splice(d,1),this}setName(a){return this.name=a,this}setUsage(a){return this.usage=a,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(a){this.name=a.name,this.usage=a.usage;const d=a.uniforms;this.uniforms.length=0;for(let A=0,x=d.length;A<x;A++){const w=Array.isArray(d[A])?d[A]:[d[A]];for(let M=0;M<w.length;M++)this.uniforms.push(w[M].clone())}return this}clone(){return new this.constructor().copy(this)}}class XMe extends GE{constructor(a,d,A=1){super(a,d),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=A}copy(a){return super.copy(a),this.meshPerAttribute=a.meshPerAttribute,this}clone(a){const d=super.clone(a);return d.meshPerAttribute=this.meshPerAttribute,d}toJSON(a){const d=super.toJSON(a);return d.isInstancedInterleavedBuffer=!0,d.meshPerAttribute=this.meshPerAttribute,d}}class YMe{constructor(a,d,A,x,w){this.isGLBufferAttribute=!0,this.name="",this.buffer=a,this.type=d,this.itemSize=A,this.elementSize=x,this.count=w,this.version=0}set needsUpdate(a){a===!0&&this.version++}setBuffer(a){return this.buffer=a,this}setType(a,d){return this.type=a,this.elementSize=d,this}setItemSize(a){return this.itemSize=a,this}setCount(a){return this.count=a,this}}const eG=new fr;class KMe{constructor(a,d,A=0,x=1/0){this.ray=new ya(a,d),this.near=A,this.far=x,this.camera=null,this.layers=new _E,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(a,d){this.ray.set(a,d)}setFromCamera(a,d){d.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(d.matrixWorld),this.ray.direction.set(a.x,a.y,.5).unproject(d).sub(this.ray.origin).normalize(),this.camera=d):d.isOrthographicCamera?(this.ray.origin.set(a.x,a.y,(d.near+d.far)/(d.near-d.far)).unproject(d),this.ray.direction.set(0,0,-1).transformDirection(d.matrixWorld),this.camera=d):console.error("THREE.Raycaster: Unsupported camera type: "+d.type)}setFromXRController(a){return eG.identity().extractRotation(a.matrixWorld),this.ray.origin.setFromMatrixPosition(a.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(eG),this}intersectObject(a,d=!0,A=[]){return NL(a,this,A,d),A.sort(tG),A}intersectObjects(a,d=!0,A=[]){for(let x=0,w=a.length;x<w;x++)NL(a[x],this,A,d);return A.sort(tG),A}}function tG(S,a){return S.distance-a.distance}function NL(S,a,d,A){if(S.layers.test(a.layers)&&S.raycast(a,d),A===!0){const x=S.children;for(let w=0,M=x.length;w<M;w++)NL(x[w],a,d,!0)}}class JMe{constructor(a=1,d=0,A=0){return this.radius=a,this.phi=d,this.theta=A,this}set(a,d,A){return this.radius=a,this.phi=d,this.theta=A,this}copy(a){return this.radius=a.radius,this.phi=a.phi,this.theta=a.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(a){return this.setFromCartesianCoords(a.x,a.y,a.z)}setFromCartesianCoords(a,d,A){return this.radius=Math.sqrt(a*a+d*d+A*A),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(a,A),this.phi=Math.acos(Ts(d/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class ZMe{constructor(a=1,d=0,A=0){return this.radius=a,this.theta=d,this.y=A,this}set(a,d,A){return this.radius=a,this.theta=d,this.y=A,this}copy(a){return this.radius=a.radius,this.theta=a.theta,this.y=a.y,this}setFromVector3(a){return this.setFromCartesianCoords(a.x,a.y,a.z)}setFromCartesianCoords(a,d,A){return this.radius=Math.sqrt(a*a+A*A),this.theta=Math.atan2(a,A),this.y=d,this}clone(){return new this.constructor().copy(this)}}const iG=new ai;class $Me{constructor(a=new ai(1/0,1/0),d=new ai(-1/0,-1/0)){this.isBox2=!0,this.min=a,this.max=d}set(a,d){return this.min.copy(a),this.max.copy(d),this}setFromPoints(a){this.makeEmpty();for(let d=0,A=a.length;d<A;d++)this.expandByPoint(a[d]);return this}setFromCenterAndSize(a,d){const A=iG.copy(d).multiplyScalar(.5);return this.min.copy(a).sub(A),this.max.copy(a).add(A),this}clone(){return new this.constructor().copy(this)}copy(a){return this.min.copy(a.min),this.max.copy(a.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(a){return this.isEmpty()?a.set(0,0):a.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(a){return this.isEmpty()?a.set(0,0):a.subVectors(this.max,this.min)}expandByPoint(a){return this.min.min(a),this.max.max(a),this}expandByVector(a){return this.min.sub(a),this.max.add(a),this}expandByScalar(a){return this.min.addScalar(-a),this.max.addScalar(a),this}containsPoint(a){return!(a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y)}containsBox(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y}getParameter(a,d){return d.set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(a){return!(a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y)}clampPoint(a,d){return d.copy(a).clamp(this.min,this.max)}distanceToPoint(a){return this.clampPoint(a,iG).distanceTo(a)}intersect(a){return this.min.max(a.min),this.max.min(a.max),this.isEmpty()&&this.makeEmpty(),this}union(a){return this.min.min(a.min),this.max.max(a.max),this}translate(a){return this.min.add(a),this.max.add(a),this}equals(a){return a.min.equals(this.min)&&a.max.equals(this.max)}}const rG=new He,Rw=new He;class e3e{constructor(a=new He,d=new He){this.start=a,this.end=d}set(a,d){return this.start.copy(a),this.end.copy(d),this}copy(a){return this.start.copy(a.start),this.end.copy(a.end),this}getCenter(a){return a.addVectors(this.start,this.end).multiplyScalar(.5)}delta(a){return a.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(a,d){return this.delta(d).multiplyScalar(a).add(this.start)}closestPointToPointParameter(a,d){rG.subVectors(a,this.start),Rw.subVectors(this.end,this.start);const A=Rw.dot(Rw);let x=Rw.dot(rG)/A;return d&&(x=Ts(x,0,1)),x}closestPointToPoint(a,d,A){const x=this.closestPointToPointParameter(a,d);return this.delta(A).multiplyScalar(x).add(this.start)}applyMatrix4(a){return this.start.applyMatrix4(a),this.end.applyMatrix4(a),this}equals(a){return a.start.equals(this.start)&&a.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const nG=new He;class t3e extends Gn{constructor(a,d){super(),this.light=a,this.matrixAutoUpdate=!1,this.color=d,this.type="SpotLightHelper";const A=new dn,x=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let M=0,L=1,O=32;M<O;M++,L++){const F=M/O*Math.PI*2,H=L/O*Math.PI*2;x.push(Math.cos(F),Math.sin(F),1,Math.cos(H),Math.sin(H),1)}A.setAttribute("position",new vr(x,3));const w=new Do({fog:!1,toneMapped:!1});this.cone=new au(A,w),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const a=this.light.distance?this.light.distance:1e3,d=a*Math.tan(this.light.angle);this.cone.scale.set(d,d,a),nG.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(nG),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Qd=new He,Iw=new fr,PL=new fr;class i3e extends au{constructor(a){const d=sG(a),A=new dn,x=[],w=[],M=new or(0,0,1),L=new or(0,1,0);for(let F=0;F<d.length;F++){const H=d[F];H.parent&&H.parent.isBone&&(x.push(0,0,0),x.push(0,0,0),w.push(M.r,M.g,M.b),w.push(L.r,L.g,L.b))}A.setAttribute("position",new vr(x,3)),A.setAttribute("color",new vr(w,3));const O=new Do({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(A,O),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=a,this.bones=d,this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(a){const d=this.bones,A=this.geometry,x=A.getAttribute("position");PL.copy(this.root.matrixWorld).invert();for(let w=0,M=0;w<d.length;w++){const L=d[w];L.parent&&L.parent.isBone&&(Iw.multiplyMatrices(PL,L.matrixWorld),Qd.setFromMatrixPosition(Iw),x.setXYZ(M,Qd.x,Qd.y,Qd.z),Iw.multiplyMatrices(PL,L.parent.matrixWorld),Qd.setFromMatrixPosition(Iw),x.setXYZ(M+1,Qd.x,Qd.y,Qd.z),M+=2)}A.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(a)}dispose(){this.geometry.dispose(),this.material.dispose()}}function sG(S){const a=[];S.isBone===!0&&a.push(S);for(let d=0;d<S.children.length;d++)a.push.apply(a,sG(S.children[d]));return a}class r3e extends ua{constructor(a,d,A){const x=new Lv(d,4,2),w=new Fd({wireframe:!0,fog:!1,toneMapped:!1});super(x,w),this.light=a,this.color=A,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const n3e=new He,aG=new or,oG=new or;class s3e extends Gn{constructor(a,d,A){super(),this.light=a,this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1,this.color=A,this.type="HemisphereLightHelper";const x=new Bv(d);x.rotateY(Math.PI*.5),this.material=new Fd({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const w=x.getAttribute("position"),M=new Float32Array(w.count*3);x.setAttribute("color",new ss(M,3)),this.add(new ua(x,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const a=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const d=a.geometry.getAttribute("color");aG.copy(this.light.color),oG.copy(this.light.groundColor);for(let A=0,x=d.count;A<x;A++){const w=A<x/2?aG:oG;d.setXYZ(A,w.r,w.g,w.b)}d.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),a.lookAt(n3e.setFromMatrixPosition(this.light.matrixWorld).negate())}}class a3e extends au{constructor(a=10,d=10,A=4473924,x=8947848){A=new or(A),x=new or(x);const w=d/2,M=a/d,L=a/2,O=[],F=[];for(let K=0,Z=0,ie=-L;K<=d;K++,ie+=M){O.push(-L,0,ie,L,0,ie),O.push(ie,0,-L,ie,0,L);const oe=K===w?A:x;oe.toArray(F,Z),Z+=3,oe.toArray(F,Z),Z+=3,oe.toArray(F,Z),Z+=3,oe.toArray(F,Z),Z+=3}const H=new dn;H.setAttribute("position",new vr(O,3)),H.setAttribute("color",new vr(F,3));const J=new Do({vertexColors:!0,toneMapped:!1});super(H,J),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class o3e extends au{constructor(a=10,d=16,A=8,x=64,w=4473924,M=8947848){w=new or(w),M=new or(M);const L=[],O=[];if(d>1)for(let J=0;J<d;J++){const K=J/d*(Math.PI*2),Z=Math.sin(K)*a,ie=Math.cos(K)*a;L.push(0,0,0),L.push(Z,0,ie);const oe=J&1?w:M;O.push(oe.r,oe.g,oe.b),O.push(oe.r,oe.g,oe.b)}for(let J=0;J<A;J++){const K=J&1?w:M,Z=a-a/A*J;for(let ie=0;ie<x;ie++){let oe=ie/x*(Math.PI*2),ne=Math.sin(oe)*Z,ee=Math.cos(oe)*Z;L.push(ne,0,ee),O.push(K.r,K.g,K.b),oe=(ie+1)/x*(Math.PI*2),ne=Math.sin(oe)*Z,ee=Math.cos(oe)*Z,L.push(ne,0,ee),O.push(K.r,K.g,K.b)}}const F=new dn;F.setAttribute("position",new vr(L,3)),F.setAttribute("color",new vr(O,3));const H=new Do({vertexColors:!0,toneMapped:!1});super(F,H),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const lG=new He,Bw=new He,cG=new He;class l3e extends Gn{constructor(a,d,A){super(),this.light=a,this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1,this.color=A,this.type="DirectionalLightHelper",d===void 0&&(d=1);let x=new dn;x.setAttribute("position",new vr([-d,d,0,d,d,0,d,-d,0,-d,-d,0,-d,d,0],3));const w=new Do({fog:!1,toneMapped:!1});this.lightPlane=new Gd(x,w),this.add(this.lightPlane),x=new dn,x.setAttribute("position",new vr([0,0,0,0,0,1],3)),this.targetLine=new Gd(x,w),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),lG.setFromMatrixPosition(this.light.matrixWorld),Bw.setFromMatrixPosition(this.light.target.matrixWorld),cG.subVectors(Bw,lG),this.lightPlane.lookAt(Bw),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Bw),this.targetLine.scale.z=cG.length()}}const Lw=new He,Gs=new NE;class c3e extends au{constructor(a){const d=new dn,A=new Do({color:16777215,vertexColors:!0,toneMapped:!1}),x=[],w=[],M={};L("n1","n2"),L("n2","n4"),L("n4","n3"),L("n3","n1"),L("f1","f2"),L("f2","f4"),L("f4","f3"),L("f3","f1"),L("n1","f1"),L("n2","f2"),L("n3","f3"),L("n4","f4"),L("p","n1"),L("p","n2"),L("p","n3"),L("p","n4"),L("u1","u2"),L("u2","u3"),L("u3","u1"),L("c","t"),L("p","c"),L("cn1","cn2"),L("cn3","cn4"),L("cf1","cf2"),L("cf3","cf4");function L(ie,oe){O(ie),O(oe)}function O(ie){x.push(0,0,0),w.push(0,0,0),M[ie]===void 0&&(M[ie]=[]),M[ie].push(x.length/3-1)}d.setAttribute("position",new vr(x,3)),d.setAttribute("color",new vr(w,3)),super(d,A),this.type="CameraHelper",this.camera=a,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=M,this.update();const F=new or(16755200),H=new or(16711680),J=new or(43775),K=new or(16777215),Z=new or(3355443);this.setColors(F,H,J,K,Z)}setColors(a,d,A,x,w){const M=this.geometry.getAttribute("color");M.setXYZ(0,a.r,a.g,a.b),M.setXYZ(1,a.r,a.g,a.b),M.setXYZ(2,a.r,a.g,a.b),M.setXYZ(3,a.r,a.g,a.b),M.setXYZ(4,a.r,a.g,a.b),M.setXYZ(5,a.r,a.g,a.b),M.setXYZ(6,a.r,a.g,a.b),M.setXYZ(7,a.r,a.g,a.b),M.setXYZ(8,a.r,a.g,a.b),M.setXYZ(9,a.r,a.g,a.b),M.setXYZ(10,a.r,a.g,a.b),M.setXYZ(11,a.r,a.g,a.b),M.setXYZ(12,a.r,a.g,a.b),M.setXYZ(13,a.r,a.g,a.b),M.setXYZ(14,a.r,a.g,a.b),M.setXYZ(15,a.r,a.g,a.b),M.setXYZ(16,a.r,a.g,a.b),M.setXYZ(17,a.r,a.g,a.b),M.setXYZ(18,a.r,a.g,a.b),M.setXYZ(19,a.r,a.g,a.b),M.setXYZ(20,a.r,a.g,a.b),M.setXYZ(21,a.r,a.g,a.b),M.setXYZ(22,a.r,a.g,a.b),M.setXYZ(23,a.r,a.g,a.b),M.setXYZ(24,d.r,d.g,d.b),M.setXYZ(25,d.r,d.g,d.b),M.setXYZ(26,d.r,d.g,d.b),M.setXYZ(27,d.r,d.g,d.b),M.setXYZ(28,d.r,d.g,d.b),M.setXYZ(29,d.r,d.g,d.b),M.setXYZ(30,d.r,d.g,d.b),M.setXYZ(31,d.r,d.g,d.b),M.setXYZ(32,A.r,A.g,A.b),M.setXYZ(33,A.r,A.g,A.b),M.setXYZ(34,A.r,A.g,A.b),M.setXYZ(35,A.r,A.g,A.b),M.setXYZ(36,A.r,A.g,A.b),M.setXYZ(37,A.r,A.g,A.b),M.setXYZ(38,x.r,x.g,x.b),M.setXYZ(39,x.r,x.g,x.b),M.setXYZ(40,w.r,w.g,w.b),M.setXYZ(41,w.r,w.g,w.b),M.setXYZ(42,w.r,w.g,w.b),M.setXYZ(43,w.r,w.g,w.b),M.setXYZ(44,w.r,w.g,w.b),M.setXYZ(45,w.r,w.g,w.b),M.setXYZ(46,w.r,w.g,w.b),M.setXYZ(47,w.r,w.g,w.b),M.setXYZ(48,w.r,w.g,w.b),M.setXYZ(49,w.r,w.g,w.b),M.needsUpdate=!0}update(){const a=this.geometry,d=this.pointMap,A=1,x=1;Gs.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Xs("c",d,a,Gs,0,0,-1),Xs("t",d,a,Gs,0,0,1),Xs("n1",d,a,Gs,-1,-1,-1),Xs("n2",d,a,Gs,A,-1,-1),Xs("n3",d,a,Gs,-1,x,-1),Xs("n4",d,a,Gs,A,x,-1),Xs("f1",d,a,Gs,-1,-1,1),Xs("f2",d,a,Gs,A,-1,1),Xs("f3",d,a,Gs,-1,x,1),Xs("f4",d,a,Gs,A,x,1),Xs("u1",d,a,Gs,A*.7,x*1.1,-1),Xs("u2",d,a,Gs,-.7,x*1.1,-1),Xs("u3",d,a,Gs,0,x*2,-1),Xs("cf1",d,a,Gs,-1,0,1),Xs("cf2",d,a,Gs,A,0,1),Xs("cf3",d,a,Gs,0,-1,1),Xs("cf4",d,a,Gs,0,x,1),Xs("cn1",d,a,Gs,-1,0,-1),Xs("cn2",d,a,Gs,A,0,-1),Xs("cn3",d,a,Gs,0,-1,-1),Xs("cn4",d,a,Gs,0,x,-1),a.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Xs(S,a,d,A,x,w,M){Lw.set(x,w,M).unproject(A);const L=a[S];if(L!==void 0){const O=d.getAttribute("position");for(let F=0,H=L.length;F<H;F++)O.setXYZ(L[F],Lw.x,Lw.y,Lw.z)}}const Dw=new Ds;class u3e extends au{constructor(a,d=16776960){const A=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),x=new Float32Array(8*3),w=new dn;w.setIndex(new ss(A,1)),w.setAttribute("position",new ss(x,3)),super(w,new Do({color:d,toneMapped:!1})),this.object=a,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(a){if(a!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&Dw.setFromObject(this.object),Dw.isEmpty())return;const d=Dw.min,A=Dw.max,x=this.geometry.attributes.position,w=x.array;w[0]=A.x,w[1]=A.y,w[2]=A.z,w[3]=d.x,w[4]=A.y,w[5]=A.z,w[6]=d.x,w[7]=d.y,w[8]=A.z,w[9]=A.x,w[10]=d.y,w[11]=A.z,w[12]=A.x,w[13]=A.y,w[14]=d.z,w[15]=d.x,w[16]=A.y,w[17]=d.z,w[18]=d.x,w[19]=d.y,w[20]=d.z,w[21]=A.x,w[22]=d.y,w[23]=d.z,x.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(a){return this.object=a,this.update(),this}copy(a,d){return super.copy(a,d),this.object=a.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class h3e extends au{constructor(a,d=16776960){const A=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),x=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],w=new dn;w.setIndex(new ss(A,1)),w.setAttribute("position",new vr(x,3)),super(w,new Do({color:d,toneMapped:!1})),this.box=a,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(a){const d=this.box;d.isEmpty()||(d.getCenter(this.position),d.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(a))}dispose(){this.geometry.dispose(),this.material.dispose()}}class d3e extends Gd{constructor(a,d=1,A=16776960){const x=A,w=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],M=new dn;M.setAttribute("position",new vr(w,3)),M.computeBoundingSphere(),super(M,new Do({color:x,toneMapped:!1})),this.type="PlaneHelper",this.plane=a,this.size=d;const L=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],O=new dn;O.setAttribute("position",new vr(L,3)),O.computeBoundingSphere(),this.add(new ua(O,new Fd({color:x,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(a){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(a)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const uG=new He;let Nw,OL;class p3e extends Gn{constructor(a=new He(0,0,1),d=new He(0,0,0),A=1,x=16776960,w=A*.2,M=w*.2){super(),this.type="ArrowHelper",Nw===void 0&&(Nw=new dn,Nw.setAttribute("position",new vr([0,0,0,0,1,0],3)),OL=new C0(0,.5,1,5,1),OL.translate(0,-.5,0)),this.position.copy(d),this.line=new Gd(Nw,new Do({color:x,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new ua(OL,new Fd({color:x,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(a),this.setLength(A,w,M)}setDirection(a){if(a.y>.99999)this.quaternion.set(0,0,0,1);else if(a.y<-.99999)this.quaternion.set(1,0,0,0);else{uG.set(a.z,0,-a.x).normalize();const d=Math.acos(a.y);this.quaternion.setFromAxisAngle(uG,d)}}setLength(a,d=a*.2,A=d*.2){this.line.scale.set(1,Math.max(1e-4,a-d),1),this.line.updateMatrix(),this.cone.scale.set(A,d,A),this.cone.position.y=a,this.cone.updateMatrix()}setColor(a){this.line.material.color.set(a),this.cone.material.color.set(a)}copy(a){return super.copy(a,!1),this.line.copy(a.line),this.cone.copy(a.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class f3e extends au{constructor(a=1){const d=[0,0,0,a,0,0,0,0,0,0,a,0,0,0,0,0,0,a],A=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],x=new dn;x.setAttribute("position",new vr(d,3)),x.setAttribute("color",new vr(A,3));const w=new Do({vertexColors:!0,toneMapped:!1});super(x,w),this.type="AxesHelper"}setColors(a,d,A){const x=new or,w=this.geometry.attributes.color.array;return x.set(a),x.toArray(w,0),x.toArray(w,3),x.set(d),x.toArray(w,6),x.toArray(w,9),x.set(A),x.toArray(w,12),x.toArray(w,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class m3e{constructor(){this.type="ShapePath",this.color=new or,this.subPaths=[],this.currentPath=null}moveTo(a,d){return this.currentPath=new Sv,this.subPaths.push(this.currentPath),this.currentPath.moveTo(a,d),this}lineTo(a,d){return this.currentPath.lineTo(a,d),this}quadraticCurveTo(a,d,A,x){return this.currentPath.quadraticCurveTo(a,d,A,x),this}bezierCurveTo(a,d,A,x,w,M){return this.currentPath.bezierCurveTo(a,d,A,x,w,M),this}splineThru(a){return this.currentPath.splineThru(a),this}toShapes(a){function d(ee){const Re=[];for(let we=0,_e=ee.length;we<_e;we++){const st=ee[we],qe=new _f;qe.curves=st.curves,Re.push(qe)}return Re}function A(ee,Re){const we=Re.length;let _e=!1;for(let st=we-1,qe=0;qe<we;st=qe++){let Ze=Re[st],rt=Re[qe],je=rt.x-Ze.x,ke=rt.y-Ze.y;if(Math.abs(ke)>Number.EPSILON){if(ke<0&&(Ze=Re[qe],je=-je,rt=Re[st],ke=-ke),ee.y<Ze.y||ee.y>rt.y)continue;if(ee.y===Ze.y){if(ee.x===Ze.x)return!0}else{const nt=ke*(ee.x-Ze.x)-je*(ee.y-Ze.y);if(nt===0)return!0;if(nt<0)continue;_e=!_e}}else{if(ee.y!==Ze.y)continue;if(rt.x<=ee.x&&ee.x<=Ze.x||Ze.x<=ee.x&&ee.x<=rt.x)return!0}}return _e}const x=ou.isClockWise,w=this.subPaths;if(w.length===0)return[];let M,L,O;const F=[];if(w.length===1)return L=w[0],O=new _f,O.curves=L.curves,F.push(O),F;let H=!x(w[0].getPoints());H=a?!H:H;const J=[],K=[];let Z=[],ie=0,oe;K[ie]=void 0,Z[ie]=[];for(let ee=0,Re=w.length;ee<Re;ee++)L=w[ee],oe=L.getPoints(),M=x(oe),M=a?!M:M,M?(!H&&K[ie]&&ie++,K[ie]={s:new _f,p:oe},K[ie].s.curves=L.curves,H&&ie++,Z[ie]=[]):Z[ie].push({h:L,p:oe[0]});if(!K[0])return d(w);if(K.length>1){let ee=!1,Re=0;for(let we=0,_e=K.length;we<_e;we++)J[we]=[];for(let we=0,_e=K.length;we<_e;we++){const st=Z[we];for(let qe=0;qe<st.length;qe++){const Ze=st[qe];let rt=!0;for(let je=0;je<K.length;je++)A(Ze.p,K[je].p)&&(we!==je&&Re++,rt?(rt=!1,J[je].push(Ze)):ee=!0);rt&&J[we].push(Ze)}}Re>0&&ee===!1&&(Z=J)}let ne;for(let ee=0,Re=K.length;ee<Re;ee++){O=K[ee].s,F.push(O),ne=Z[ee];for(let we=0,_e=ne.length;we<_e;we++)O.holes.push(ne[we].h)}return F}}class g3e extends Jo{constructor(a=1,d=1,A=1,x={}){console.warn('THREE.WebGLMultipleRenderTargets has been deprecated and will be removed in r172. Use THREE.WebGLRenderTarget and set the "count" parameter to enable MRT.'),super(a,d,{...x,count:A}),this.isWebGLMultipleRenderTargets=!0}get texture(){return this.textures}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:h}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=h)},"./node_modules/three/examples/jsm/libs/ktx-parse.module.js":(l,u,c)=>{c.r(u),c.d(u,{KHR_DF_CHANNEL_RGBSDA_ALPHA:()=>Zt,KHR_DF_CHANNEL_RGBSDA_BLUE:()=>Ce,KHR_DF_CHANNEL_RGBSDA_DEPTH:()=>Ot,KHR_DF_CHANNEL_RGBSDA_GREEN:()=>We,KHR_DF_CHANNEL_RGBSDA_RED:()=>Vi,KHR_DF_CHANNEL_RGBSDA_STENCIL:()=>At,KHR_DF_FLAG_ALPHA_PREMULTIPLIED:()=>N,KHR_DF_FLAG_ALPHA_STRAIGHT:()=>I,KHR_DF_KHR_DESCRIPTORTYPE_BASICFORMAT:()=>y,KHR_DF_MODEL_ASTC:()=>R,KHR_DF_MODEL_ETC1:()=>E,KHR_DF_MODEL_ETC1S:()=>B,KHR_DF_MODEL_ETC2:()=>C,KHR_DF_MODEL_RGBSDA:()=>T,KHR_DF_MODEL_UNSPECIFIED:()=>_,KHR_DF_PRIMARIES_ACES:()=>$e,KHR_DF_PRIMARIES_ACESCC:()=>Fi,KHR_DF_PRIMARIES_ADOBERGB:()=>Zi,KHR_DF_PRIMARIES_BT2020:()=>yt,KHR_DF_PRIMARIES_BT601_EBU:()=>St,KHR_DF_PRIMARIES_BT601_SMPTE:()=>Qt,KHR_DF_PRIMARIES_BT709:()=>dt,KHR_DF_PRIMARIES_CIEXYZ:()=>bi,KHR_DF_PRIMARIES_DISPLAYP3:()=>Ei,KHR_DF_PRIMARIES_NTSC1953:()=>ui,KHR_DF_PRIMARIES_PAL525:()=>Si,KHR_DF_PRIMARIES_UNSPECIFIED:()=>it,KHR_DF_SAMPLE_DATATYPE_EXPONENT:()=>vt,KHR_DF_SAMPLE_DATATYPE_FLOAT:()=>jt,KHR_DF_SAMPLE_DATATYPE_LINEAR:()=>ge,KHR_DF_SAMPLE_DATATYPE_SIGNED:()=>xi,KHR_DF_TRANSFER_ACESCC:()=>Oe,KHR_DF_TRANSFER_ACESCCT:()=>Xe,KHR_DF_TRANSFER_ADOBERGB:()=>Je,KHR_DF_TRANSFER_BT1886:()=>W,KHR_DF_TRANSFER_DCIP3:()=>se,KHR_DF_TRANSFER_HLG_EOTF:()=>z,KHR_DF_TRANSFER_HLG_OETF:()=>G,KHR_DF_TRANSFER_ITU:()=>q,KHR_DF_TRANSFER_LINEAR:()=>P,KHR_DF_TRANSFER_NTSC:()=>V,KHR_DF_TRANSFER_PAL625_EOTF:()=>Ae,KHR_DF_TRANSFER_PAL_OETF:()=>ve,KHR_DF_TRANSFER_PQ_EOTF:()=>te,KHR_DF_TRANSFER_PQ_OETF:()=>Y,KHR_DF_TRANSFER_SLOG:()=>j,KHR_DF_TRANSFER_SLOG2:()=>Q,KHR_DF_TRANSFER_SRGB:()=>k,KHR_DF_TRANSFER_ST240:()=>me,KHR_DF_TRANSFER_UNSPECIFIED:()=>D,KHR_DF_VENDORID_KHRONOS:()=>b,KHR_DF_VERSION:()=>v,KHR_SUPERCOMPRESSION_BASISLZ:()=>f,KHR_SUPERCOMPRESSION_NONE:()=>p,KHR_SUPERCOMPRESSION_ZLIB:()=>m,KHR_SUPERCOMPRESSION_ZSTD:()=>g,KTX2Container:()=>bh,VK_FORMAT_A1R5G5B5_UNORM_PACK16:()=>Me,VK_FORMAT_A2B10G10R10_SINT_PACK32:()=>ri,VK_FORMAT_A2B10G10R10_SNORM_PACK32:()=>$t,VK_FORMAT_A2B10G10R10_UINT_PACK32:()=>Bt,VK_FORMAT_A2B10G10R10_UNORM_PACK32:()=>Yt,VK_FORMAT_A2R10G10B10_SINT_PACK32:()=>Tt,VK_FORMAT_A2R10G10B10_SNORM_PACK32:()=>Ke,VK_FORMAT_A2R10G10B10_UINT_PACK32:()=>lt,VK_FORMAT_A2R10G10B10_UNORM_PACK32:()=>Ue,VK_FORMAT_A4B4G4R4_UNORM_PACK16_EXT:()=>lv,VK_FORMAT_A4R4G4B4_UNORM_PACK16_EXT:()=>Dd,VK_FORMAT_ASTC_10x10_SFLOAT_BLOCK_EXT:()=>Yg,VK_FORMAT_ASTC_10x10_SRGB_BLOCK:()=>Ts,VK_FORMAT_ASTC_10x10_UNORM_BLOCK:()=>Ro,VK_FORMAT_ASTC_10x5_SFLOAT_BLOCK_EXT:()=>gE,VK_FORMAT_ASTC_10x5_SRGB_BLOCK:()=>Mo,VK_FORMAT_ASTC_10x5_UNORM_BLOCK:()=>cf,VK_FORMAT_ASTC_10x6_SFLOAT_BLOCK_EXT:()=>AE,VK_FORMAT_ASTC_10x6_SRGB_BLOCK:()=>dE,VK_FORMAT_ASTC_10x6_UNORM_BLOCK:()=>Ba,VK_FORMAT_ASTC_10x8_SFLOAT_BLOCK_EXT:()=>yE,VK_FORMAT_ASTC_10x8_SRGB_BLOCK:()=>Bd,VK_FORMAT_ASTC_10x8_UNORM_BLOCK:()=>vh,VK_FORMAT_ASTC_12x10_SFLOAT_BLOCK_EXT:()=>CB,VK_FORMAT_ASTC_12x10_SRGB_BLOCK:()=>oB,VK_FORMAT_ASTC_12x10_UNORM_BLOCK:()=>av,VK_FORMAT_ASTC_12x12_SFLOAT_BLOCK_EXT:()=>Yn,VK_FORMAT_ASTC_12x12_SRGB_BLOCK:()=>uf,VK_FORMAT_ASTC_12x12_UNORM_BLOCK:()=>lB,VK_FORMAT_ASTC_4x4_SFLOAT_BLOCK_EXT:()=>Xr,VK_FORMAT_ASTC_4x4_SRGB_BLOCK:()=>cE,VK_FORMAT_ASTC_4x4_UNORM_BLOCK:()=>lE,VK_FORMAT_ASTC_5x4_SFLOAT_BLOCK_EXT:()=>ov,VK_FORMAT_ASTC_5x4_SRGB_BLOCK:()=>hE,VK_FORMAT_ASTC_5x4_UNORM_BLOCK:()=>uE,VK_FORMAT_ASTC_5x5_SFLOAT_BLOCK_EXT:()=>pE,VK_FORMAT_ASTC_5x5_SRGB_BLOCK:()=>ZI,VK_FORMAT_ASTC_5x5_UNORM_BLOCK:()=>lf,VK_FORMAT_ASTC_6x5_SFLOAT_BLOCK_EXT:()=>wB,VK_FORMAT_ASTC_6x5_SRGB_BLOCK:()=>eB,VK_FORMAT_ASTC_6x5_UNORM_BLOCK:()=>$I,VK_FORMAT_ASTC_6x6_SFLOAT_BLOCK_EXT:()=>Ld,VK_FORMAT_ASTC_6x6_SRGB_BLOCK:()=>iB,VK_FORMAT_ASTC_6x6_UNORM_BLOCK:()=>tB,VK_FORMAT_ASTC_8x5_SFLOAT_BLOCK_EXT:()=>hf,VK_FORMAT_ASTC_8x5_SRGB_BLOCK:()=>nB,VK_FORMAT_ASTC_8x5_UNORM_BLOCK:()=>rB,VK_FORMAT_ASTC_8x6_SFLOAT_BLOCK_EXT:()=>fE,VK_FORMAT_ASTC_8x6_SRGB_BLOCK:()=>aB,VK_FORMAT_ASTC_8x6_UNORM_BLOCK:()=>sB,VK_FORMAT_ASTC_8x8_SFLOAT_BLOCK_EXT:()=>mE,VK_FORMAT_ASTC_8x8_SRGB_BLOCK:()=>Gl,VK_FORMAT_ASTC_8x8_UNORM_BLOCK:()=>sv,VK_FORMAT_B10G11R11_UFLOAT_PACK32:()=>Ko,VK_FORMAT_B10X6G10X6R10X6G10X6_422_UNORM_4PACK16:()=>pB,VK_FORMAT_B12X4G12X4R12X4G12X4_422_UNORM_4PACK16:()=>yB,VK_FORMAT_B4G4R4A4_UNORM_PACK16:()=>Fe,VK_FORMAT_B5G5R5A1_UNORM_PACK16:()=>re,VK_FORMAT_B5G6R5_UNORM_PACK16:()=>U,VK_FORMAT_B8G8R8A8_SINT:()=>fe,VK_FORMAT_B8G8R8A8_SNORM:()=>Be,VK_FORMAT_B8G8R8A8_SRGB:()=>Le,VK_FORMAT_B8G8R8A8_UINT:()=>ae,VK_FORMAT_B8G8R8A8_UNORM:()=>Oi,VK_FORMAT_B8G8R8_SINT:()=>pe,VK_FORMAT_B8G8R8_SNORM:()=>es,VK_FORMAT_B8G8R8_SRGB:()=>ct,VK_FORMAT_B8G8R8_UINT:()=>bs,VK_FORMAT_B8G8R8_UNORM:()=>Ls,VK_FORMAT_BC1_RGBA_SRGB_BLOCK:()=>ls,VK_FORMAT_BC1_RGBA_UNORM_BLOCK:()=>sf,VK_FORMAT_BC1_RGB_SRGB_BLOCK:()=>nf,VK_FORMAT_BC1_RGB_UNORM_BLOCK:()=>Xg,VK_FORMAT_BC2_SRGB_BLOCK:()=>of,VK_FORMAT_BC2_UNORM_BLOCK:()=>af,VK_FORMAT_BC3_SRGB_BLOCK:()=>yh,VK_FORMAT_BC3_UNORM_BLOCK:()=>FI,VK_FORMAT_BC4_SNORM_BLOCK:()=>zI,VK_FORMAT_BC4_UNORM_BLOCK:()=>UI,VK_FORMAT_BC5_SNORM_BLOCK:()=>VI,VK_FORMAT_BC5_UNORM_BLOCK:()=>jI,VK_FORMAT_BC6H_SFLOAT_BLOCK:()=>HI,VK_FORMAT_BC6H_UFLOAT_BLOCK:()=>GI,VK_FORMAT_BC7_SRGB_BLOCK:()=>QI,VK_FORMAT_BC7_UNORM_BLOCK:()=>WI,VK_FORMAT_D16_UNORM:()=>tu,VK_FORMAT_D16_UNORM_S8_UINT:()=>Wa,VK_FORMAT_D24_UNORM_S8_UINT:()=>Nn,VK_FORMAT_D32_SFLOAT:()=>ao,VK_FORMAT_D32_SFLOAT_S8_UINT:()=>Rc,VK_FORMAT_E5B9G9R9_UFLOAT_PACK32:()=>Mc,VK_FORMAT_EAC_R11G11_SNORM_BLOCK:()=>nv,VK_FORMAT_EAC_R11G11_UNORM_BLOCK:()=>oE,VK_FORMAT_EAC_R11_SNORM_BLOCK:()=>aE,VK_FORMAT_EAC_R11_UNORM_BLOCK:()=>sE,VK_FORMAT_ETC2_R8G8B8A1_SRGB_BLOCK:()=>KI,VK_FORMAT_ETC2_R8G8B8A1_UNORM_BLOCK:()=>YI,VK_FORMAT_ETC2_R8G8B8A8_SRGB_BLOCK:()=>rv,VK_FORMAT_ETC2_R8G8B8A8_UNORM_BLOCK:()=>JI,VK_FORMAT_ETC2_R8G8B8_SRGB_BLOCK:()=>XI,VK_FORMAT_ETC2_R8G8B8_UNORM_BLOCK:()=>qI,VK_FORMAT_G10X6B10X6G10X6R10X6_422_UNORM_4PACK16:()=>dB,VK_FORMAT_G12X4B12X4G12X4R12X4_422_UNORM_4PACK16:()=>AB,VK_FORMAT_PVRTC1_2BPP_SRGB_BLOCK_IMG:()=>Qa,VK_FORMAT_PVRTC1_2BPP_UNORM_BLOCK_IMG:()=>vB,VK_FORMAT_PVRTC1_4BPP_SRGB_BLOCK_IMG:()=>Kr,VK_FORMAT_PVRTC1_4BPP_UNORM_BLOCK_IMG:()=>bB,VK_FORMAT_PVRTC2_2BPP_SRGB_BLOCK_IMG:()=>EB,VK_FORMAT_PVRTC2_2BPP_UNORM_BLOCK_IMG:()=>xB,VK_FORMAT_PVRTC2_4BPP_SRGB_BLOCK_IMG:()=>ai,VK_FORMAT_PVRTC2_4BPP_UNORM_BLOCK_IMG:()=>_B,VK_FORMAT_R10X6G10X6B10X6A10X6_UNORM_4PACK16:()=>hB,VK_FORMAT_R10X6G10X6_UNORM_2PACK16:()=>uB,VK_FORMAT_R10X6_UNORM_PACK16:()=>cB,VK_FORMAT_R12X4G12X4B12X4A12X4_UNORM_4PACK16:()=>gB,VK_FORMAT_R12X4G12X4_UNORM_2PACK16:()=>mB,VK_FORMAT_R12X4_UNORM_PACK16:()=>fB,VK_FORMAT_R16G16B16A16_SFLOAT:()=>he,VK_FORMAT_R16G16B16A16_SINT:()=>mt,VK_FORMAT_R16G16B16A16_SNORM:()=>Qe,VK_FORMAT_R16G16B16A16_UINT:()=>Ye,VK_FORMAT_R16G16B16A16_UNORM:()=>Te,VK_FORMAT_R16G16B16_SFLOAT:()=>ye,VK_FORMAT_R16G16B16_SINT:()=>ue,VK_FORMAT_R16G16B16_SNORM:()=>qr,VK_FORMAT_R16G16B16_UINT:()=>X,VK_FORMAT_R16G16B16_UNORM:()=>hn,VK_FORMAT_R16G16_SFLOAT:()=>ar,VK_FORMAT_R16G16_SINT:()=>Ii,VK_FORMAT_R16G16_SNORM:()=>Mn,VK_FORMAT_R16G16_UINT:()=>Xn,VK_FORMAT_R16G16_UNORM:()=>_i,VK_FORMAT_R16_SFLOAT:()=>$i,VK_FORMAT_R16_SINT:()=>ur,VK_FORMAT_R16_SNORM:()=>Ui,VK_FORMAT_R16_UINT:()=>Sr,VK_FORMAT_R16_UNORM:()=>wi,VK_FORMAT_R32G32B32A32_SFLOAT:()=>yr,VK_FORMAT_R32G32B32A32_SINT:()=>Li,VK_FORMAT_R32G32B32A32_UINT:()=>qt,VK_FORMAT_R32G32B32_SFLOAT:()=>Ai,VK_FORMAT_R32G32B32_SINT:()=>ni,VK_FORMAT_R32G32B32_UINT:()=>Wt,VK_FORMAT_R32G32_SFLOAT:()=>Mt,VK_FORMAT_R32G32_SINT:()=>ot,VK_FORMAT_R32G32_UINT:()=>Ee,VK_FORMAT_R32_SFLOAT:()=>xe,VK_FORMAT_R32_SINT:()=>de,VK_FORMAT_R32_UINT:()=>le,VK_FORMAT_R4G4B4A4_UNORM_PACK16:()=>Se,VK_FORMAT_R4G4_UNORM_PACK8:()=>Ne,VK_FORMAT_R5G5B5A1_UNORM_PACK16:()=>$,VK_FORMAT_R5G6B5_UNORM_PACK16:()=>Ie,VK_FORMAT_R64G64B64A64_SFLOAT:()=>El,VK_FORMAT_R64G64B64A64_SINT:()=>Nr,VK_FORMAT_R64G64B64A64_UINT:()=>us,VK_FORMAT_R64G64B64_SFLOAT:()=>jr,VK_FORMAT_R64G64B64_SINT:()=>bn,VK_FORMAT_R64G64B64_UINT:()=>Vr,VK_FORMAT_R64G64_SFLOAT:()=>Fr,VK_FORMAT_R64G64_SINT:()=>Tr,VK_FORMAT_R64G64_UINT:()=>wr,VK_FORMAT_R64_SFLOAT:()=>Wi,VK_FORMAT_R64_SINT:()=>pr,VK_FORMAT_R64_UINT:()=>dr,VK_FORMAT_R8G8B8A8_SINT:()=>sr,VK_FORMAT_R8G8B8A8_SNORM:()=>Kt,VK_FORMAT_R8G8B8A8_SRGB:()=>Di,VK_FORMAT_R8G8B8A8_UINT:()=>Bi,VK_FORMAT_R8G8B8A8_UNORM:()=>Rt,VK_FORMAT_R8G8B8_SINT:()=>vs,VK_FORMAT_R8G8B8_SNORM:()=>kr,VK_FORMAT_R8G8B8_SRGB:()=>gn,VK_FORMAT_R8G8B8_UINT:()=>rn,VK_FORMAT_R8G8B8_UNORM:()=>mn,VK_FORMAT_R8G8_SINT:()=>xr,VK_FORMAT_R8G8_SNORM:()=>Vt,VK_FORMAT_R8G8_SRGB:()=>ki,VK_FORMAT_R8G8_UINT:()=>fi,VK_FORMAT_R8G8_UNORM:()=>xt,VK_FORMAT_R8_SINT:()=>pt,VK_FORMAT_R8_SNORM:()=>ze,VK_FORMAT_R8_SRGB:()=>Dt,VK_FORMAT_R8_UINT:()=>Ve,VK_FORMAT_R8_UNORM:()=>ce,VK_FORMAT_S8_UINT:()=>ru,VK_FORMAT_UNDEFINED:()=>be,VK_FORMAT_X8_D24_UNORM_PACK32:()=>iu,read:()=>Fn,write:()=>Zg});var h=c("./node_modules/buffer/index.js").Buffer;const p=0,f=1,g=2,m=3,y=0,b=0,v=2,_=0,T=1,E=160,C=161,R=162,B=163,I=0,N=1,D=0,P=1,k=2,q=3,V=4,j=5,Q=6,W=7,G=8,z=9,te=10,Y=11,se=12,ve=13,Ae=14,me=15,Oe=16,Xe=17,Je=18,it=0,dt=1,St=2,Qt=3,yt=4,bi=5,$e=6,Fi=7,ui=8,Si=9,Ei=10,Zi=11,Vi=0,We=1,Ce=2,At=13,Ot=14,Zt=15,jt=128,xi=64,vt=32,ge=16,be=0,Ne=1,Se=2,Fe=3,Ie=4,U=5,$=6,re=7,Me=8,ce=9,ze=10,Ve=13,pt=14,Dt=15,xt=16,Vt=17,fi=20,xr=21,ki=22,mn=23,kr=24,rn=27,vs=28,gn=29,Ls=30,es=31,bs=34,pe=35,ct=36,Rt=37,Kt=38,Bi=41,sr=42,Di=43,Oi=44,Be=45,ae=48,fe=49,Le=50,Ue=58,Ke=59,lt=62,Tt=63,Yt=64,$t=65,Bt=68,ri=69,wi=70,Ui=71,Sr=74,ur=75,$i=76,_i=77,Mn=78,Xn=81,Ii=82,ar=83,hn=84,qr=85,X=88,ue=89,ye=90,Te=91,Qe=92,Ye=95,mt=96,he=97,le=98,de=99,xe=100,Ee=101,ot=102,Mt=103,Wt=104,ni=105,Ai=106,qt=107,Li=108,yr=109,dr=110,pr=111,Wi=112,wr=113,Tr=114,Fr=115,Vr=116,bn=117,jr=118,us=119,Nr=120,El=121,Ko=122,Mc=123,tu=124,iu=125,ao=126,ru=127,Wa=128,Nn=129,Rc=130,Xg=131,nf=132,sf=133,ls=134,af=135,of=136,FI=137,yh=138,UI=139,zI=140,jI=141,VI=142,GI=143,HI=144,WI=145,QI=146,qI=147,XI=148,YI=149,KI=150,JI=151,rv=152,sE=153,aE=154,oE=155,nv=156,lE=157,cE=158,uE=159,hE=160,lf=161,ZI=162,$I=163,eB=164,tB=165,iB=166,rB=167,nB=168,sB=169,aB=170,sv=171,Gl=172,cf=173,Mo=174,Ba=175,dE=176,vh=177,Bd=178,Ro=179,Ts=180,av=181,oB=182,lB=183,uf=184,cB=1000156007,uB=1000156008,hB=1000156009,dB=1000156010,pB=1000156011,fB=1000156017,mB=1000156018,gB=1000156019,AB=1000156020,yB=1000156021,vB=1000054e3,bB=1000054001,xB=1000054002,_B=1000054003,Qa=1000054004,Kr=1000054005,EB=1000054006,ai=1000054007,Xr=1000066e3,ov=1000066001,pE=1000066002,wB=1000066003,Ld=1000066004,hf=1000066005,fE=1000066006,mE=1000066007,gE=1000066008,AE=1000066009,yE=1000066010,Yg=1000066011,CB=1000066012,Yn=1000066013,Dd=100034e4,lv=1000340001;class bh{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Nd{constructor(Yr,In,Vn,He){this._dataView=new DataView(Yr.buffer,Yr.byteOffset+In,Vn),this._littleEndian=He,this._offset=0}_nextUint8(){const Yr=this._dataView.getUint8(this._offset);return this._offset+=1,Yr}_nextUint16(){const Yr=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,Yr}_nextUint32(){const Yr=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,Yr}_nextUint64(){const Yr=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,Yr}_nextInt32(){const Yr=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,Yr}_skip(Yr){return this._offset+=Yr,this}_scan(Yr,In=0){const Vn=this._offset;let He=0;for(;this._dataView.getUint8(this._offset)!==In&&He<Yr;)He++,this._offset++;return He<Yr&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+Vn,He)}}const vE=new Uint8Array([0]),xs=[171,75,84,88,32,50,48,187,13,10,26,10];function Kg(hr){return typeof TextEncoder<"u"?new TextEncoder().encode(hr):h.from(hr)}function bE(hr){return typeof TextDecoder<"u"?new TextDecoder().decode(hr):h.from(hr).toString("utf8")}function hs(hr){let Yr=0;for(const He of hr)Yr+=He.byteLength;const In=new Uint8Array(Yr);let Vn=0;for(const He of hr)In.set(new Uint8Array(He),Vn),Vn+=He.byteLength;return In}function Fn(hr){const Yr=new Uint8Array(hr.buffer,hr.byteOffset,xs.length);if(Yr[0]!==xs[0]||Yr[1]!==xs[1]||Yr[2]!==xs[2]||Yr[3]!==xs[3]||Yr[4]!==xs[4]||Yr[5]!==xs[5]||Yr[6]!==xs[6]||Yr[7]!==xs[7]||Yr[8]!==xs[8]||Yr[9]!==xs[9]||Yr[10]!==xs[10]||Yr[11]!==xs[11])throw new Error("Missing KTX 2.0 identifier.");const In=new bh,Vn=17*Uint32Array.BYTES_PER_ELEMENT,He=new Nd(hr,xs.length,Vn,!0);In.vkFormat=He._nextUint32(),In.typeSize=He._nextUint32(),In.pixelWidth=He._nextUint32(),In.pixelHeight=He._nextUint32(),In.pixelDepth=He._nextUint32(),In.layerCount=He._nextUint32(),In.faceCount=He._nextUint32();const wl=He._nextUint32();In.supercompressionScheme=He._nextUint32();const Vs=He._nextUint32(),Ds=He._nextUint32(),En=He._nextUint32(),oo=He._nextUint32(),nu=He._nextUint64(),Zo=He._nextUint64(),La=new Nd(hr,xs.length+Vn,3*wl*8,!0);for(let ya=0;ya<wl;ya++)In.levels.push({levelData:new Uint8Array(hr.buffer,hr.byteOffset+La._nextUint64(),La._nextUint64()),uncompressedByteLength:La._nextUint64()});const nn=new Nd(hr,Vs,Ds,!0),qa={vendorId:nn._skip(4)._nextUint16(),descriptorType:nn._nextUint16(),versionNumber:nn._nextUint16(),descriptorBlockSize:nn._nextUint16(),colorModel:nn._nextUint8(),colorPrimaries:nn._nextUint8(),transferFunction:nn._nextUint8(),flags:nn._nextUint8(),texelBlockDimension:[nn._nextUint8(),nn._nextUint8(),nn._nextUint8(),nn._nextUint8()],bytesPlane:[nn._nextUint8(),nn._nextUint8(),nn._nextUint8(),nn._nextUint8(),nn._nextUint8(),nn._nextUint8(),nn._nextUint8(),nn._nextUint8()],samples:[]},Cl=(qa.descriptorBlockSize/4-6)/4;for(let ya=0;ya<Cl;ya++){const fr={bitOffset:nn._nextUint16(),bitLength:nn._nextUint8(),channelType:nn._nextUint8(),samplePosition:[nn._nextUint8(),nn._nextUint8(),nn._nextUint8(),nn._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&fr.channelType?(fr.sampleLower=nn._nextInt32(),fr.sampleUpper=nn._nextInt32()):(fr.sampleLower=nn._nextUint32(),fr.sampleUpper=nn._nextUint32()),qa.samples[ya]=fr}In.dataFormatDescriptor.length=0,In.dataFormatDescriptor.push(qa);const Da=new Nd(hr,En,oo,!0);for(;Da._offset<oo;){const ya=Da._nextUint32(),fr=Da._scan(ya),_h=bE(fr),$o=Da._scan(ya-fr.byteLength);In.keyValue[_h]=_h.match(/^ktx/i)?bE($o):$o,Da._offset%4&&Da._skip(4-Da._offset%4)}if(Zo<=0)return In;const Pn=new Nd(hr,nu,Zo,!0),ns=Pn._nextUint16(),sn=Pn._nextUint16(),On=Pn._nextUint32(),Io=Pn._nextUint32(),Pd=Pn._nextUint32(),xh=Pn._nextUint32(),$g=[];for(let ya=0;ya<wl;ya++)$g.push({imageFlags:Pn._nextUint32(),rgbSliceByteOffset:Pn._nextUint32(),rgbSliceByteLength:Pn._nextUint32(),alphaSliceByteOffset:Pn._nextUint32(),alphaSliceByteLength:Pn._nextUint32()});const Aa=nu+Pn._offset,Hl=Aa+On,e0=Hl+Io,t0=e0+Pd,su=new Uint8Array(hr.buffer,hr.byteOffset+Aa,On),cv=new Uint8Array(hr.buffer,hr.byteOffset+Hl,Io),i0=new Uint8Array(hr.buffer,hr.byteOffset+e0,Pd),uv=new Uint8Array(hr.buffer,hr.byteOffset+t0,xh);return In.globalData={endpointCount:ns,selectorCount:sn,imageDescs:$g,endpointsData:su,selectorsData:cv,tablesData:i0,extendedData:uv},In}function Jg(){return(Jg=Object.assign||function(hr){for(var Yr=1;Yr<arguments.length;Yr++){var In=arguments[Yr];for(var Vn in In)Object.prototype.hasOwnProperty.call(In,Vn)&&(hr[Vn]=In[Vn])}return hr}).apply(this,arguments)}const Jo={keepWriter:!1};function Zg(hr,Yr={}){Yr=Jg({},Jo,Yr);let In=new ArrayBuffer(0);if(hr.globalData){const ns=new ArrayBuffer(20+5*hr.globalData.imageDescs.length*4),sn=new DataView(ns);sn.setUint16(0,hr.globalData.endpointCount,!0),sn.setUint16(2,hr.globalData.selectorCount,!0),sn.setUint32(4,hr.globalData.endpointsData.byteLength,!0),sn.setUint32(8,hr.globalData.selectorsData.byteLength,!0),sn.setUint32(12,hr.globalData.tablesData.byteLength,!0),sn.setUint32(16,hr.globalData.extendedData.byteLength,!0);for(let On=0;On<hr.globalData.imageDescs.length;On++){const Io=hr.globalData.imageDescs[On];sn.setUint32(20+5*On*4+0,Io.imageFlags,!0),sn.setUint32(20+5*On*4+4,Io.rgbSliceByteOffset,!0),sn.setUint32(20+5*On*4+8,Io.rgbSliceByteLength,!0),sn.setUint32(20+5*On*4+12,Io.alphaSliceByteOffset,!0),sn.setUint32(20+5*On*4+16,Io.alphaSliceByteLength,!0)}In=hs([ns,hr.globalData.endpointsData,hr.globalData.selectorsData,hr.globalData.tablesData,hr.globalData.extendedData])}const Vn=[];let He=hr.keyValue;Yr.keepWriter||(He=Jg({},hr.keyValue,{KTXwriter:"KTX-Parse v0.3.1"}));for(const ns in He){const sn=He[ns],On=Kg(ns),Io=typeof sn=="string"?Kg(sn):sn,Pd=On.byteLength+1+Io.byteLength+1,xh=Pd%4?4-Pd%4:0;Vn.push(hs([new Uint32Array([Pd]),On,vE,Io,vE,new Uint8Array(xh).fill(0)]))}const wl=hs(Vn);if(hr.dataFormatDescriptor.length!==1||hr.dataFormatDescriptor[0].descriptorType!==0)throw new Error("Only BASICFORMAT Data Format Descriptor output supported.");const Vs=hr.dataFormatDescriptor[0],Ds=new ArrayBuffer(28+16*Vs.samples.length),En=new DataView(Ds),oo=24+16*Vs.samples.length;if(En.setUint32(0,Ds.byteLength,!0),En.setUint16(4,Vs.vendorId,!0),En.setUint16(6,Vs.descriptorType,!0),En.setUint16(8,Vs.versionNumber,!0),En.setUint16(10,oo,!0),En.setUint8(12,Vs.colorModel),En.setUint8(13,Vs.colorPrimaries),En.setUint8(14,Vs.transferFunction),En.setUint8(15,Vs.flags),!Array.isArray(Vs.texelBlockDimension))throw new Error("texelBlockDimension is now an array. For dimensionality `d`, set `d - 1`.");En.setUint8(16,Vs.texelBlockDimension[0]),En.setUint8(17,Vs.texelBlockDimension[1]),En.setUint8(18,Vs.texelBlockDimension[2]),En.setUint8(19,Vs.texelBlockDimension[3]);for(let ns=0;ns<8;ns++)En.setUint8(20+ns,Vs.bytesPlane[ns]);for(let ns=0;ns<Vs.samples.length;ns++){const sn=Vs.samples[ns],On=28+16*ns;if(sn.channelID)throw new Error("channelID has been renamed to channelType.");En.setUint16(On+0,sn.bitOffset,!0),En.setUint8(On+2,sn.bitLength),En.setUint8(On+3,sn.channelType),En.setUint8(On+4,sn.samplePosition[0]),En.setUint8(On+5,sn.samplePosition[1]),En.setUint8(On+6,sn.samplePosition[2]),En.setUint8(On+7,sn.samplePosition[3]),64&sn.channelType?(En.setInt32(On+8,sn.sampleLower,!0),En.setInt32(On+12,sn.sampleUpper,!0)):(En.setUint32(On+8,sn.sampleLower,!0),En.setUint32(On+12,sn.sampleUpper,!0))}const nu=xs.length+68+3*hr.levels.length*8,Zo=nu+Ds.byteLength;let La=In.byteLength>0?Zo+wl.byteLength:0;La%8&&(La+=8-La%8);const nn=[],qa=new DataView(new ArrayBuffer(3*hr.levels.length*8));let Cl=(La||Zo+wl.byteLength)+In.byteLength;for(let ns=0;ns<hr.levels.length;ns++){const sn=hr.levels[ns];nn.push(sn.levelData),qa.setBigUint64(24*ns+0,BigInt(Cl),!0),qa.setBigUint64(24*ns+8,BigInt(sn.levelData.byteLength),!0),qa.setBigUint64(24*ns+16,BigInt(sn.uncompressedByteLength),!0),Cl+=sn.levelData.byteLength}const Da=new ArrayBuffer(68),Pn=new DataView(Da);return Pn.setUint32(0,hr.vkFormat,!0),Pn.setUint32(4,hr.typeSize,!0),Pn.setUint32(8,hr.pixelWidth,!0),Pn.setUint32(12,hr.pixelHeight,!0),Pn.setUint32(16,hr.pixelDepth,!0),Pn.setUint32(20,hr.layerCount,!0),Pn.setUint32(24,hr.faceCount,!0),Pn.setUint32(28,hr.levels.length,!0),Pn.setUint32(32,hr.supercompressionScheme,!0),Pn.setUint32(36,nu,!0),Pn.setUint32(40,Ds.byteLength,!0),Pn.setUint32(44,Zo,!0),Pn.setUint32(48,wl.byteLength,!0),Pn.setBigUint64(52,BigInt(In.byteLength>0?La:0),!0),Pn.setBigUint64(60,BigInt(In.byteLength),!0),new Uint8Array(hs([new Uint8Array(xs).buffer,Da,qa.buffer,Ds,wl,La>0?new ArrayBuffer(La-(Zo+wl.byteLength)):new ArrayBuffer(0),In,...nn]))}},"./node_modules/three/examples/jsm/libs/zstddec.module.js":(l,u,c)=>{c.r(u),c.d(u,{ZSTDDecoder:()=>y});var h=c("./node_modules/buffer/index.js").Buffer;let p,f,g;const m={env:{emscripten_notify_memory_growth:function(v){g=new Uint8Array(f.exports.memory.buffer)}}};class y{init(){return p||(p=typeof fetch<"u"?fetch("data:application/wasm;base64,"+b).then(_=>_.arrayBuffer()).then(_=>WebAssembly.instantiate(_,m)).then(this._init):WebAssembly.instantiate(h.from(b,"base64"),m).then(this._init),p)}_init(_){f=_.instance,m.env.emscripten_notify_memory_growth(0)}decode(_,T=0){if(!f)throw new Error("ZSTDDecoder: Await .init() before decoding.");const E=_.byteLength,C=f.exports.malloc(E);g.set(_,C),T=T||Number(f.exports.ZSTD_findDecompressedSize(C,E));const R=f.exports.malloc(T),B=f.exports.ZSTD_decompress(R,T,C,E),I=g.slice(R,R+B);return f.exports.free(C),f.exports.free(R),I}}const b="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ"},"./node_modules/three/examples/jsm/lights/LightProbeGenerator.js":(l,u,c)=>{c.r(u),c.d(u,{LightProbeGenerator:()=>p});var h=c("./node_modules/three/build/three.module.js");class p{static fromCubeTexture(m){let y=0;const b=new h.Vector3,v=new h.Vector3,_=new h.Color,T=[0,0,0,0,0,0,0,0,0],E=new h.SphericalHarmonics3,C=E.coefficients;for(let B=0;B<6;B++){const I=m.image[B],N=I.width,D=I.height,P=document.createElement("canvas");P.width=N,P.height=D;const k=P.getContext("2d");k.drawImage(I,0,0,N,D);const q=k.getImageData(0,0,N,D),V=q.data,j=q.width,Q=2/j;for(let W=0,G=V.length;W<G;W+=4){_.setRGB(V[W]/255,V[W+1]/255,V[W+2]/255),f(_,m.colorSpace);const z=W/4,te=-1+(z%j+.5)*Q,Y=1-(Math.floor(z/j)+.5)*Q;switch(B){case 0:b.set(-1,Y,-te);break;case 1:b.set(1,Y,te);break;case 2:b.set(-te,1,-Y);break;case 3:b.set(-te,-1,Y);break;case 4:b.set(-te,Y,1);break;case 5:b.set(te,Y,-1);break}const se=b.lengthSq(),ve=4/(Math.sqrt(se)*se);y+=ve,v.copy(b).normalize(),h.SphericalHarmonics3.getBasisAt(v,T);for(let Ae=0;Ae<9;Ae++)C[Ae].x+=T[Ae]*_.r*ve,C[Ae].y+=T[Ae]*_.g*ve,C[Ae].z+=T[Ae]*_.b*ve}}const R=4*Math.PI/y;for(let B=0;B<9;B++)C[B].x*=R,C[B].y*=R,C[B].z*=R;return new h.LightProbe(E)}static fromCubeRenderTarget(m,y){let b=0;const v=new h.Vector3,_=new h.Vector3,T=new h.Color,E=[0,0,0,0,0,0,0,0,0],C=new h.SphericalHarmonics3,R=C.coefficients,B=y.texture.type;for(let N=0;N<6;N++){const D=y.width;let P;B===h.HalfFloatType?P=new Uint16Array(D*D*4):P=new Uint8Array(D*D*4),m.readRenderTargetPixels(y,0,0,D,D,P,N);const k=2/D;for(let q=0,V=P.length;q<V;q+=4){let j,Q,W;B===h.HalfFloatType?(j=h.DataUtils.fromHalfFloat(P[q]),Q=h.DataUtils.fromHalfFloat(P[q+1]),W=h.DataUtils.fromHalfFloat(P[q+2])):(j=P[q]/255,Q=P[q+1]/255,W=P[q+2]/255),T.setRGB(j,Q,W),f(T,y.texture.colorSpace);const G=q/4,z=-1+(G%D+.5)*k,te=1-(Math.floor(G/D)+.5)*k;switch(N){case 0:v.set(1,te,-z);break;case 1:v.set(-1,te,z);break;case 2:v.set(z,1,-te);break;case 3:v.set(z,-1,te);break;case 4:v.set(z,te,1);break;case 5:v.set(-z,te,-1);break}const Y=v.lengthSq(),se=4/(Math.sqrt(Y)*Y);b+=se,_.copy(v).normalize(),h.SphericalHarmonics3.getBasisAt(_,E);for(let ve=0;ve<9;ve++)R[ve].x+=E[ve]*T.r*se,R[ve].y+=E[ve]*T.g*se,R[ve].z+=E[ve]*T.b*se}}const I=4*Math.PI/b;for(let N=0;N<9;N++)R[N].x*=I,R[N].y*=I,R[N].z*=I;return new h.LightProbe(C)}}function f(g,m){switch(m){case h.SRGBColorSpace:g.convertSRGBToLinear();break;case h.LinearSRGBColorSpace:case h.NoColorSpace:break;default:console.warn("WARNING: LightProbeGenerator convertColorToLinear() encountered an unsupported color space.");break}return g}},"./node_modules/three/examples/jsm/loaders/DRACOLoader.js":(l,u,c)=>{c.r(u),c.d(u,{DRACOLoader:()=>f});var h=c("./node_modules/three/build/three.module.js");const p=new WeakMap;class f extends h.Loader{constructor(y){super(y),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(y){return this.decoderPath=y,this}setDecoderConfig(y){return this.decoderConfig=y,this}setWorkerLimit(y){return this.workerLimit=y,this}load(y,b,v,_){const T=new h.FileLoader(this.manager);T.setPath(this.path),T.setResponseType("arraybuffer"),T.setRequestHeader(this.requestHeader),T.setWithCredentials(this.withCredentials),T.load(y,E=>{this.parse(E,b,_)},v,_)}parse(y,b,v=()=>{}){this.decodeDracoFile(y,b,null,null,h.SRGBColorSpace).catch(v)}decodeDracoFile(y,b,v,_,T=h.LinearSRGBColorSpace,E=()=>{}){const C={attributeIDs:v||this.defaultAttributeIDs,attributeTypes:_||this.defaultAttributeTypes,useUniqueIDs:!!v,vertexColorSpace:T};return this.decodeGeometry(y,C).then(b).catch(E)}decodeGeometry(y,b){const v=JSON.stringify(b);if(p.has(y)){const R=p.get(y);if(R.key===v)return R.promise;if(y.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let _;const T=this.workerNextTaskID++,E=y.byteLength,C=this._getWorker(T,E).then(R=>(_=R,new Promise((B,I)=>{_._callbacks[T]={resolve:B,reject:I},_.postMessage({type:"decode",id:T,taskConfig:b,buffer:y},[y])}))).then(R=>this._createGeometry(R.geometry));return C.catch(()=>!0).then(()=>{_&&T&&this._releaseTask(_,T)}),p.set(y,{key:v,promise:C}),C}_createGeometry(y){const b=new h.BufferGeometry;y.index&&b.setIndex(new h.BufferAttribute(y.index.array,1));for(let v=0;v<y.attributes.length;v++){const _=y.attributes[v],T=_.name,E=_.array,C=_.itemSize,R=new h.BufferAttribute(E,C);T==="color"&&(this._assignVertexColorSpace(R,_.vertexColorSpace),R.normalized=!(E instanceof Float32Array)),b.setAttribute(T,R)}return b}_assignVertexColorSpace(y,b){if(b!==h.SRGBColorSpace)return;const v=new h.Color;for(let _=0,T=y.count;_<T;_++)v.fromBufferAttribute(y,_).convertSRGBToLinear(),y.setXYZ(_,v.r,v.g,v.b)}_loadLibrary(y,b){const v=new h.FileLoader(this.manager);return v.setPath(this.decoderPath),v.setResponseType(b),v.setWithCredentials(this.withCredentials),new Promise((_,T)=>{v.load(y,_,void 0,T)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const y=typeof WebAssembly!="object"||this.decoderConfig.type==="js",b=[];return y?b.push(this._loadLibrary("draco_decoder.js","text")):(b.push(this._loadLibrary("draco_wasm_wrapper.js","text")),b.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(b).then(v=>{const _=v[0];y||(this.decoderConfig.wasmBinary=v[1]);const T=g.toString(),E=["/* draco decoder */",_,"","/* worker */",T.substring(T.indexOf("{")+1,T.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([E]))}),this.decoderPending}_getWorker(y,b){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const _=new Worker(this.workerSourceURL);_._callbacks={},_._taskCosts={},_._taskLoad=0,_.postMessage({type:"init",decoderConfig:this.decoderConfig}),_.onmessage=function(T){const E=T.data;switch(E.type){case"decode":_._callbacks[E.id].resolve(E);break;case"error":_._callbacks[E.id].reject(E);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+E.type+'"')}},this.workerPool.push(_)}else this.workerPool.sort(function(_,T){return _._taskLoad>T._taskLoad?-1:1});const v=this.workerPool[this.workerPool.length-1];return v._taskCosts[y]=b,v._taskLoad+=b,v})}_releaseTask(y,b){y._taskLoad-=y._taskCosts[b],delete y._callbacks[b],delete y._taskCosts[b]}debug(){console.log("Task load: ",this.workerPool.map(y=>y._taskLoad))}dispose(){for(let y=0;y<this.workerPool.length;++y)this.workerPool[y].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function g(){let m,y;onmessage=function(E){const C=E.data;switch(C.type){case"init":m=C.decoderConfig,y=new Promise(function(I){m.onModuleLoaded=function(N){I({draco:N})},DracoDecoderModule(m)});break;case"decode":const R=C.buffer,B=C.taskConfig;y.then(I=>{const N=I.draco,D=new N.Decoder;try{const P=b(N,D,new Int8Array(R),B),k=P.attributes.map(q=>q.array.buffer);P.index&&k.push(P.index.array.buffer),self.postMessage({type:"decode",id:C.id,geometry:P},k)}catch(P){console.error(P),self.postMessage({type:"error",id:C.id,error:P.message})}finally{N.destroy(D)}});break}};function b(E,C,R,B){const I=B.attributeIDs,N=B.attributeTypes;let D,P;const k=C.GetEncodedGeometryType(R);if(k===E.TRIANGULAR_MESH)D=new E.Mesh,P=C.DecodeArrayToMesh(R,R.byteLength,D);else if(k===E.POINT_CLOUD)D=new E.PointCloud,P=C.DecodeArrayToPointCloud(R,R.byteLength,D);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!P.ok()||D.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+P.error_msg());const q={index:null,attributes:[]};for(const V in I){const j=self[N[V]];let Q,W;if(B.useUniqueIDs)W=I[V],Q=C.GetAttributeByUniqueId(D,W);else{if(W=C.GetAttributeId(D,E[I[V]]),W===-1)continue;Q=C.GetAttribute(D,W)}const G=_(E,C,D,V,j,Q);V==="color"&&(G.vertexColorSpace=B.vertexColorSpace),q.attributes.push(G)}return k===E.TRIANGULAR_MESH&&(q.index=v(E,C,D)),E.destroy(D),q}function v(E,C,R){const B=R.num_faces()*3,I=B*4,N=E._malloc(I);C.GetTrianglesUInt32Array(R,I,N);const D=new Uint32Array(E.HEAPF32.buffer,N,B).slice();return E._free(N),{array:D,itemSize:1}}function _(E,C,R,B,I,N){const D=N.num_components(),P=R.num_points()*D,k=P*I.BYTES_PER_ELEMENT,q=T(E,I),V=E._malloc(k);C.GetAttributeDataArrayForAllPoints(R,N,q,k,V);const j=new I(E.HEAPF32.buffer,V,P).slice();return E._free(V),{name:B,array:j,itemSize:D}}function T(E,C){switch(C){case Float32Array:return E.DT_FLOAT32;case Int8Array:return E.DT_INT8;case Int16Array:return E.DT_INT16;case Int32Array:return E.DT_INT32;case Uint8Array:return E.DT_UINT8;case Uint16Array:return E.DT_UINT16;case Uint32Array:return E.DT_UINT32}}}},"./node_modules/three/examples/jsm/loaders/GLTFLoader.js":(l,u,c)=>{c.r(u),c.d(u,{GLTFLoader:()=>f});var h=c("./node_modules/three/build/three.module.js"),p=c("./node_modules/three/examples/jsm/utils/BufferGeometryUtils.js");class f extends h.Loader{constructor(ge){super(ge),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(be){return new _(be)}),this.register(function(be){return new T(be)}),this.register(function(be){return new k(be)}),this.register(function(be){return new q(be)}),this.register(function(be){return new V(be)}),this.register(function(be){return new C(be)}),this.register(function(be){return new R(be)}),this.register(function(be){return new B(be)}),this.register(function(be){return new I(be)}),this.register(function(be){return new v(be)}),this.register(function(be){return new N(be)}),this.register(function(be){return new E(be)}),this.register(function(be){return new P(be)}),this.register(function(be){return new D(be)}),this.register(function(be){return new y(be)}),this.register(function(be){return new j(be)}),this.register(function(be){return new Q(be)})}load(ge,be,Ne,Se){const Fe=this;let Ie;if(this.resourcePath!=="")Ie=this.resourcePath;else if(this.path!==""){const re=h.LoaderUtils.extractUrlBase(ge);Ie=h.LoaderUtils.resolveURL(re,this.path)}else Ie=h.LoaderUtils.extractUrlBase(ge);this.manager.itemStart(ge);const U=function(re){Se?Se(re):console.error(re),Fe.manager.itemError(ge),Fe.manager.itemEnd(ge)},$=new h.FileLoader(this.manager);$.setPath(this.path),$.setResponseType("arraybuffer"),$.setRequestHeader(this.requestHeader),$.setWithCredentials(this.withCredentials),$.load(ge,function(re){try{Fe.parse(re,Ie,function(Me){be(Me),Fe.manager.itemEnd(ge)},U)}catch(Me){U(Me)}},Ne,U)}setDRACOLoader(ge){return this.dracoLoader=ge,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(ge){return this.ktx2Loader=ge,this}setMeshoptDecoder(ge){return this.meshoptDecoder=ge,this}register(ge){return this.pluginCallbacks.indexOf(ge)===-1&&this.pluginCallbacks.push(ge),this}unregister(ge){return this.pluginCallbacks.indexOf(ge)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(ge),1),this}parse(ge,be,Ne,Se){let Fe;const Ie={},U={},$=new TextDecoder;if(typeof ge=="string")Fe=JSON.parse(ge);else if(ge instanceof ArrayBuffer)if($.decode(new Uint8Array(ge,0,4))===W){try{Ie[m.KHR_BINARY_GLTF]=new te(ge)}catch(Me){Se&&Se(Me);return}Fe=JSON.parse(Ie[m.KHR_BINARY_GLTF].content)}else Fe=JSON.parse($.decode(ge));else Fe=ge;if(Fe.asset===void 0||Fe.asset.version[0]<2){Se&&Se(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const re=new Zt(Fe,{path:be||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});re.fileLoader.setRequestHeader(this.requestHeader);for(let Me=0;Me<this.pluginCallbacks.length;Me++){const ce=this.pluginCallbacks[Me](re);ce.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),U[ce.name]=ce,Ie[ce.name]=!0}if(Fe.extensionsUsed)for(let Me=0;Me<Fe.extensionsUsed.length;++Me){const ce=Fe.extensionsUsed[Me],ze=Fe.extensionsRequired||[];switch(ce){case m.KHR_MATERIALS_UNLIT:Ie[ce]=new b;break;case m.KHR_DRACO_MESH_COMPRESSION:Ie[ce]=new Y(Fe,this.dracoLoader);break;case m.KHR_TEXTURE_TRANSFORM:Ie[ce]=new se;break;case m.KHR_MESH_QUANTIZATION:Ie[ce]=new ve;break;default:ze.indexOf(ce)>=0&&U[ce]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+ce+'".')}}re.setExtensions(Ie),re.setPlugins(U),re.parse(Ne,Se)}parseAsync(ge,be){const Ne=this;return new Promise(function(Se,Fe){Ne.parse(ge,be,Se,Fe)})}}function g(){let vt={};return{get:function(ge){return vt[ge]},add:function(ge,be){vt[ge]=be},remove:function(ge){delete vt[ge]},removeAll:function(){vt={}}}}const m={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class y{constructor(ge){this.parser=ge,this.name=m.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const ge=this.parser,be=this.parser.json.nodes||[];for(let Ne=0,Se=be.length;Ne<Se;Ne++){const Fe=be[Ne];Fe.extensions&&Fe.extensions[this.name]&&Fe.extensions[this.name].light!==void 0&&ge._addNodeRef(this.cache,Fe.extensions[this.name].light)}}_loadLight(ge){const be=this.parser,Ne="light:"+ge;let Se=be.cache.get(Ne);if(Se)return Se;const Fe=be.json,Ie=((Fe.extensions&&Fe.extensions[this.name]||{}).lights||[])[ge];let U;const $=new h.Color(16777215);Ie.color!==void 0&&$.setRGB(Ie.color[0],Ie.color[1],Ie.color[2],h.LinearSRGBColorSpace);const re=Ie.range!==void 0?Ie.range:0;switch(Ie.type){case"directional":U=new h.DirectionalLight($),U.target.position.set(0,0,-1),U.add(U.target);break;case"point":U=new h.PointLight($),U.distance=re;break;case"spot":U=new h.SpotLight($),U.distance=re,Ie.spot=Ie.spot||{},Ie.spot.innerConeAngle=Ie.spot.innerConeAngle!==void 0?Ie.spot.innerConeAngle:0,Ie.spot.outerConeAngle=Ie.spot.outerConeAngle!==void 0?Ie.spot.outerConeAngle:Math.PI/4,U.angle=Ie.spot.outerConeAngle,U.penumbra=1-Ie.spot.innerConeAngle/Ie.spot.outerConeAngle,U.target.position.set(0,0,-1),U.add(U.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+Ie.type)}return U.position.set(0,0,0),U.decay=2,Si(U,Ie),Ie.intensity!==void 0&&(U.intensity=Ie.intensity),U.name=be.createUniqueName(Ie.name||"light_"+ge),Se=Promise.resolve(U),be.cache.add(Ne,Se),Se}getDependency(ge,be){if(ge==="light")return this._loadLight(be)}createNodeAttachment(ge){const be=this,Ne=this.parser,Se=Ne.json.nodes[ge],Fe=(Se.extensions&&Se.extensions[this.name]||{}).light;return Fe===void 0?null:this._loadLight(Fe).then(function(Ie){return Ne._getNodeRef(be.cache,Fe,Ie)})}}class b{constructor(){this.name=m.KHR_MATERIALS_UNLIT}getMaterialType(){return h.MeshBasicMaterial}extendParams(ge,be,Ne){const Se=[];ge.color=new h.Color(1,1,1),ge.opacity=1;const Fe=be.pbrMetallicRoughness;if(Fe){if(Array.isArray(Fe.baseColorFactor)){const Ie=Fe.baseColorFactor;ge.color.setRGB(Ie[0],Ie[1],Ie[2],h.LinearSRGBColorSpace),ge.opacity=Ie[3]}Fe.baseColorTexture!==void 0&&Se.push(Ne.assignTexture(ge,"map",Fe.baseColorTexture,h.SRGBColorSpace))}return Promise.all(Se)}}class v{constructor(ge){this.parser=ge,this.name=m.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(ge,be){const Ne=this.parser.json.materials[ge];if(!Ne.extensions||!Ne.extensions[this.name])return Promise.resolve();const Se=Ne.extensions[this.name].emissiveStrength;return Se!==void 0&&(be.emissiveIntensity=Se),Promise.resolve()}}class _{constructor(ge){this.parser=ge,this.name=m.KHR_MATERIALS_CLEARCOAT}getMaterialType(ge){const be=this.parser.json.materials[ge];return!be.extensions||!be.extensions[this.name]?null:h.MeshPhysicalMaterial}extendMaterialParams(ge,be){const Ne=this.parser,Se=Ne.json.materials[ge];if(!Se.extensions||!Se.extensions[this.name])return Promise.resolve();const Fe=[],Ie=Se.extensions[this.name];if(Ie.clearcoatFactor!==void 0&&(be.clearcoat=Ie.clearcoatFactor),Ie.clearcoatTexture!==void 0&&Fe.push(Ne.assignTexture(be,"clearcoatMap",Ie.clearcoatTexture)),Ie.clearcoatRoughnessFactor!==void 0&&(be.clearcoatRoughness=Ie.clearcoatRoughnessFactor),Ie.clearcoatRoughnessTexture!==void 0&&Fe.push(Ne.assignTexture(be,"clearcoatRoughnessMap",Ie.clearcoatRoughnessTexture)),Ie.clearcoatNormalTexture!==void 0&&(Fe.push(Ne.assignTexture(be,"clearcoatNormalMap",Ie.clearcoatNormalTexture)),Ie.clearcoatNormalTexture.scale!==void 0)){const U=Ie.clearcoatNormalTexture.scale;be.clearcoatNormalScale=new h.Vector2(U,U)}return Promise.all(Fe)}}class T{constructor(ge){this.parser=ge,this.name=m.KHR_MATERIALS_DISPERSION}getMaterialType(ge){const be=this.parser.json.materials[ge];return!be.extensions||!be.extensions[this.name]?null:h.MeshPhysicalMaterial}extendMaterialParams(ge,be){const Ne=this.parser.json.materials[ge];if(!Ne.extensions||!Ne.extensions[this.name])return Promise.resolve();const Se=Ne.extensions[this.name];return be.dispersion=Se.dispersion!==void 0?Se.dispersion:0,Promise.resolve()}}class E{constructor(ge){this.parser=ge,this.name=m.KHR_MATERIALS_IRIDESCENCE}getMaterialType(ge){const be=this.parser.json.materials[ge];return!be.extensions||!be.extensions[this.name]?null:h.MeshPhysicalMaterial}extendMaterialParams(ge,be){const Ne=this.parser,Se=Ne.json.materials[ge];if(!Se.extensions||!Se.extensions[this.name])return Promise.resolve();const Fe=[],Ie=Se.extensions[this.name];return Ie.iridescenceFactor!==void 0&&(be.iridescence=Ie.iridescenceFactor),Ie.iridescenceTexture!==void 0&&Fe.push(Ne.assignTexture(be,"iridescenceMap",Ie.iridescenceTexture)),Ie.iridescenceIor!==void 0&&(be.iridescenceIOR=Ie.iridescenceIor),be.iridescenceThicknessRange===void 0&&(be.iridescenceThicknessRange=[100,400]),Ie.iridescenceThicknessMinimum!==void 0&&(be.iridescenceThicknessRange[0]=Ie.iridescenceThicknessMinimum),Ie.iridescenceThicknessMaximum!==void 0&&(be.iridescenceThicknessRange[1]=Ie.iridescenceThicknessMaximum),Ie.iridescenceThicknessTexture!==void 0&&Fe.push(Ne.assignTexture(be,"iridescenceThicknessMap",Ie.iridescenceThicknessTexture)),Promise.all(Fe)}}class C{constructor(ge){this.parser=ge,this.name=m.KHR_MATERIALS_SHEEN}getMaterialType(ge){const be=this.parser.json.materials[ge];return!be.extensions||!be.extensions[this.name]?null:h.MeshPhysicalMaterial}extendMaterialParams(ge,be){const Ne=this.parser,Se=Ne.json.materials[ge];if(!Se.extensions||!Se.extensions[this.name])return Promise.resolve();const Fe=[];be.sheenColor=new h.Color(0,0,0),be.sheenRoughness=0,be.sheen=1;const Ie=Se.extensions[this.name];if(Ie.sheenColorFactor!==void 0){const U=Ie.sheenColorFactor;be.sheenColor.setRGB(U[0],U[1],U[2],h.LinearSRGBColorSpace)}return Ie.sheenRoughnessFactor!==void 0&&(be.sheenRoughness=Ie.sheenRoughnessFactor),Ie.sheenColorTexture!==void 0&&Fe.push(Ne.assignTexture(be,"sheenColorMap",Ie.sheenColorTexture,h.SRGBColorSpace)),Ie.sheenRoughnessTexture!==void 0&&Fe.push(Ne.assignTexture(be,"sheenRoughnessMap",Ie.sheenRoughnessTexture)),Promise.all(Fe)}}class R{constructor(ge){this.parser=ge,this.name=m.KHR_MATERIALS_TRANSMISSION}getMaterialType(ge){const be=this.parser.json.materials[ge];return!be.extensions||!be.extensions[this.name]?null:h.MeshPhysicalMaterial}extendMaterialParams(ge,be){const Ne=this.parser,Se=Ne.json.materials[ge];if(!Se.extensions||!Se.extensions[this.name])return Promise.resolve();const Fe=[],Ie=Se.extensions[this.name];return Ie.transmissionFactor!==void 0&&(be.transmission=Ie.transmissionFactor),Ie.transmissionTexture!==void 0&&Fe.push(Ne.assignTexture(be,"transmissionMap",Ie.transmissionTexture)),Promise.all(Fe)}}class B{constructor(ge){this.parser=ge,this.name=m.KHR_MATERIALS_VOLUME}getMaterialType(ge){const be=this.parser.json.materials[ge];return!be.extensions||!be.extensions[this.name]?null:h.MeshPhysicalMaterial}extendMaterialParams(ge,be){const Ne=this.parser,Se=Ne.json.materials[ge];if(!Se.extensions||!Se.extensions[this.name])return Promise.resolve();const Fe=[],Ie=Se.extensions[this.name];be.thickness=Ie.thicknessFactor!==void 0?Ie.thicknessFactor:0,Ie.thicknessTexture!==void 0&&Fe.push(Ne.assignTexture(be,"thicknessMap",Ie.thicknessTexture)),be.attenuationDistance=Ie.attenuationDistance||1/0;const U=Ie.attenuationColor||[1,1,1];return be.attenuationColor=new h.Color().setRGB(U[0],U[1],U[2],h.LinearSRGBColorSpace),Promise.all(Fe)}}class I{constructor(ge){this.parser=ge,this.name=m.KHR_MATERIALS_IOR}getMaterialType(ge){const be=this.parser.json.materials[ge];return!be.extensions||!be.extensions[this.name]?null:h.MeshPhysicalMaterial}extendMaterialParams(ge,be){const Ne=this.parser.json.materials[ge];if(!Ne.extensions||!Ne.extensions[this.name])return Promise.resolve();const Se=Ne.extensions[this.name];return be.ior=Se.ior!==void 0?Se.ior:1.5,Promise.resolve()}}class N{constructor(ge){this.parser=ge,this.name=m.KHR_MATERIALS_SPECULAR}getMaterialType(ge){const be=this.parser.json.materials[ge];return!be.extensions||!be.extensions[this.name]?null:h.MeshPhysicalMaterial}extendMaterialParams(ge,be){const Ne=this.parser,Se=Ne.json.materials[ge];if(!Se.extensions||!Se.extensions[this.name])return Promise.resolve();const Fe=[],Ie=Se.extensions[this.name];be.specularIntensity=Ie.specularFactor!==void 0?Ie.specularFactor:1,Ie.specularTexture!==void 0&&Fe.push(Ne.assignTexture(be,"specularIntensityMap",Ie.specularTexture));const U=Ie.specularColorFactor||[1,1,1];return be.specularColor=new h.Color().setRGB(U[0],U[1],U[2],h.LinearSRGBColorSpace),Ie.specularColorTexture!==void 0&&Fe.push(Ne.assignTexture(be,"specularColorMap",Ie.specularColorTexture,h.SRGBColorSpace)),Promise.all(Fe)}}class D{constructor(ge){this.parser=ge,this.name=m.EXT_MATERIALS_BUMP}getMaterialType(ge){const be=this.parser.json.materials[ge];return!be.extensions||!be.extensions[this.name]?null:h.MeshPhysicalMaterial}extendMaterialParams(ge,be){const Ne=this.parser,Se=Ne.json.materials[ge];if(!Se.extensions||!Se.extensions[this.name])return Promise.resolve();const Fe=[],Ie=Se.extensions[this.name];return be.bumpScale=Ie.bumpFactor!==void 0?Ie.bumpFactor:1,Ie.bumpTexture!==void 0&&Fe.push(Ne.assignTexture(be,"bumpMap",Ie.bumpTexture)),Promise.all(Fe)}}class P{constructor(ge){this.parser=ge,this.name=m.KHR_MATERIALS_ANISOTROPY}getMaterialType(ge){const be=this.parser.json.materials[ge];return!be.extensions||!be.extensions[this.name]?null:h.MeshPhysicalMaterial}extendMaterialParams(ge,be){const Ne=this.parser,Se=Ne.json.materials[ge];if(!Se.extensions||!Se.extensions[this.name])return Promise.resolve();const Fe=[],Ie=Se.extensions[this.name];return Ie.anisotropyStrength!==void 0&&(be.anisotropy=Ie.anisotropyStrength),Ie.anisotropyRotation!==void 0&&(be.anisotropyRotation=Ie.anisotropyRotation),Ie.anisotropyTexture!==void 0&&Fe.push(Ne.assignTexture(be,"anisotropyMap",Ie.anisotropyTexture)),Promise.all(Fe)}}class k{constructor(ge){this.parser=ge,this.name=m.KHR_TEXTURE_BASISU}loadTexture(ge){const be=this.parser,Ne=be.json,Se=Ne.textures[ge];if(!Se.extensions||!Se.extensions[this.name])return null;const Fe=Se.extensions[this.name],Ie=be.options.ktx2Loader;if(!Ie){if(Ne.extensionsRequired&&Ne.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return be.loadTextureImage(ge,Fe.source,Ie)}}class q{constructor(ge){this.parser=ge,this.name=m.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(ge){const be=this.name,Ne=this.parser,Se=Ne.json,Fe=Se.textures[ge];if(!Fe.extensions||!Fe.extensions[be])return null;const Ie=Fe.extensions[be],U=Se.images[Ie.source];let $=Ne.textureLoader;if(U.uri){const re=Ne.options.manager.getHandler(U.uri);re!==null&&($=re)}return this.detectSupport().then(function(re){if(re)return Ne.loadTextureImage(ge,Ie.source,$);if(Se.extensionsRequired&&Se.extensionsRequired.indexOf(be)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return Ne.loadTexture(ge)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(ge){const be=new Image;be.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",be.onload=be.onerror=function(){ge(be.height===1)}})),this.isSupported}}class V{constructor(ge){this.parser=ge,this.name=m.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(ge){const be=this.name,Ne=this.parser,Se=Ne.json,Fe=Se.textures[ge];if(!Fe.extensions||!Fe.extensions[be])return null;const Ie=Fe.extensions[be],U=Se.images[Ie.source];let $=Ne.textureLoader;if(U.uri){const re=Ne.options.manager.getHandler(U.uri);re!==null&&($=re)}return this.detectSupport().then(function(re){if(re)return Ne.loadTextureImage(ge,Ie.source,$);if(Se.extensionsRequired&&Se.extensionsRequired.indexOf(be)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return Ne.loadTexture(ge)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(ge){const be=new Image;be.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",be.onload=be.onerror=function(){ge(be.height===1)}})),this.isSupported}}class j{constructor(ge){this.name=m.EXT_MESHOPT_COMPRESSION,this.parser=ge}loadBufferView(ge){const be=this.parser.json,Ne=be.bufferViews[ge];if(Ne.extensions&&Ne.extensions[this.name]){const Se=Ne.extensions[this.name],Fe=this.parser.getDependency("buffer",Se.buffer),Ie=this.parser.options.meshoptDecoder;if(!Ie||!Ie.supported){if(be.extensionsRequired&&be.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Fe.then(function(U){const $=Se.byteOffset||0,re=Se.byteLength||0,Me=Se.count,ce=Se.byteStride,ze=new Uint8Array(U,$,re);return Ie.decodeGltfBufferAsync?Ie.decodeGltfBufferAsync(Me,ce,ze,Se.mode,Se.filter).then(function(Ve){return Ve.buffer}):Ie.ready.then(function(){const Ve=new ArrayBuffer(Me*ce);return Ie.decodeGltfBuffer(new Uint8Array(Ve),Me,ce,ze,Se.mode,Se.filter),Ve})})}else return null}}class Q{constructor(ge){this.name=m.EXT_MESH_GPU_INSTANCING,this.parser=ge}createNodeMesh(ge){const be=this.parser.json,Ne=be.nodes[ge];if(!Ne.extensions||!Ne.extensions[this.name]||Ne.mesh===void 0)return null;const Se=be.meshes[Ne.mesh];for(const $ of Se.primitives)if($.mode!==Xe.TRIANGLES&&$.mode!==Xe.TRIANGLE_STRIP&&$.mode!==Xe.TRIANGLE_FAN&&$.mode!==void 0)return null;const Fe=Ne.extensions[this.name].attributes,Ie=[],U={};for(const $ in Fe)Ie.push(this.parser.getDependency("accessor",Fe[$]).then(re=>(U[$]=re,U[$])));return Ie.length<1?null:(Ie.push(this.parser.createNodeMesh(ge)),Promise.all(Ie).then($=>{const re=$.pop(),Me=re.isGroup?re.children:[re],ce=$[0].count,ze=[];for(const Ve of Me){const pt=new h.Matrix4,Dt=new h.Vector3,xt=new h.Quaternion,Vt=new h.Vector3(1,1,1),fi=new h.InstancedMesh(Ve.geometry,Ve.material,ce);for(let xr=0;xr<ce;xr++)U.TRANSLATION&&Dt.fromBufferAttribute(U.TRANSLATION,xr),U.ROTATION&&xt.fromBufferAttribute(U.ROTATION,xr),U.SCALE&&Vt.fromBufferAttribute(U.SCALE,xr),fi.setMatrixAt(xr,pt.compose(Dt,xt,Vt));for(const xr in U)if(xr==="_COLOR_0"){const ki=U[xr];fi.instanceColor=new h.InstancedBufferAttribute(ki.array,ki.itemSize,ki.normalized)}else xr!=="TRANSLATION"&&xr!=="ROTATION"&&xr!=="SCALE"&&Ve.geometry.setAttribute(xr,U[xr]);h.Object3D.prototype.copy.call(fi,Ve),this.parser.assignFinalMaterial(fi),ze.push(fi)}return re.isGroup?(re.clear(),re.add(...ze),re):ze[0]}))}}const W="glTF",G=12,z={JSON:1313821514,BIN:5130562};class te{constructor(ge){this.name=m.KHR_BINARY_GLTF,this.content=null,this.body=null;const be=new DataView(ge,0,G),Ne=new TextDecoder;if(this.header={magic:Ne.decode(new Uint8Array(ge.slice(0,4))),version:be.getUint32(4,!0),length:be.getUint32(8,!0)},this.header.magic!==W)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const Se=this.header.length-G,Fe=new DataView(ge,G);let Ie=0;for(;Ie<Se;){const U=Fe.getUint32(Ie,!0);Ie+=4;const $=Fe.getUint32(Ie,!0);if(Ie+=4,$===z.JSON){const re=new Uint8Array(ge,G+Ie,U);this.content=Ne.decode(re)}else if($===z.BIN){const re=G+Ie;this.body=ge.slice(re,re+U)}Ie+=U}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Y{constructor(ge,be){if(!be)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=m.KHR_DRACO_MESH_COMPRESSION,this.json=ge,this.dracoLoader=be,this.dracoLoader.preload()}decodePrimitive(ge,be){const Ne=this.json,Se=this.dracoLoader,Fe=ge.extensions[this.name].bufferView,Ie=ge.extensions[this.name].attributes,U={},$={},re={};for(const Me in Ie){const ce=Qt[Me]||Me.toLowerCase();U[ce]=Ie[Me]}for(const Me in ge.attributes){const ce=Qt[Me]||Me.toLowerCase();if(Ie[Me]!==void 0){const ze=Ne.accessors[ge.attributes[Me]],Ve=Je[ze.componentType];re[ce]=Ve.name,$[ce]=ze.normalized===!0}}return be.getDependency("bufferView",Fe).then(function(Me){return new Promise(function(ce,ze){Se.decodeDracoFile(Me,function(Ve){for(const pt in Ve.attributes){const Dt=Ve.attributes[pt],xt=$[pt];xt!==void 0&&(Dt.normalized=xt)}ce(Ve)},U,re,h.LinearSRGBColorSpace,ze)})})}}class se{constructor(){this.name=m.KHR_TEXTURE_TRANSFORM}extendTexture(ge,be){return(be.texCoord===void 0||be.texCoord===ge.channel)&&be.offset===void 0&&be.rotation===void 0&&be.scale===void 0||(ge=ge.clone(),be.texCoord!==void 0&&(ge.channel=be.texCoord),be.offset!==void 0&&ge.offset.fromArray(be.offset),be.rotation!==void 0&&(ge.rotation=be.rotation),be.scale!==void 0&&ge.repeat.fromArray(be.scale),ge.needsUpdate=!0),ge}}class ve{constructor(){this.name=m.KHR_MESH_QUANTIZATION}}class Ae extends h.Interpolant{constructor(ge,be,Ne,Se){super(ge,be,Ne,Se)}copySampleValue_(ge){const be=this.resultBuffer,Ne=this.sampleValues,Se=this.valueSize,Fe=ge*Se*3+Se;for(let Ie=0;Ie!==Se;Ie++)be[Ie]=Ne[Fe+Ie];return be}interpolate_(ge,be,Ne,Se){const Fe=this.resultBuffer,Ie=this.sampleValues,U=this.valueSize,$=U*2,re=U*3,Me=Se-be,ce=(Ne-be)/Me,ze=ce*ce,Ve=ze*ce,pt=ge*re,Dt=pt-re,xt=-2*Ve+3*ze,Vt=Ve-ze,fi=1-xt,xr=Vt-ze+ce;for(let ki=0;ki!==U;ki++){const mn=Ie[Dt+ki+U],kr=Ie[Dt+ki+$]*Me,rn=Ie[pt+ki+U],vs=Ie[pt+ki]*Me;Fe[ki]=fi*mn+xr*kr+xt*rn+Vt*vs}return Fe}}const me=new h.Quaternion;class Oe extends Ae{interpolate_(ge,be,Ne,Se){const Fe=super.interpolate_(ge,be,Ne,Se);return me.fromArray(Fe).normalize().toArray(Fe),Fe}}const Xe={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Je={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},it={9728:h.NearestFilter,9729:h.LinearFilter,9984:h.NearestMipmapNearestFilter,9985:h.LinearMipmapNearestFilter,9986:h.NearestMipmapLinearFilter,9987:h.LinearMipmapLinearFilter},dt={33071:h.ClampToEdgeWrapping,33648:h.MirroredRepeatWrapping,10497:h.RepeatWrapping},St={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Qt={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},yt={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},bi={CUBICSPLINE:void 0,LINEAR:h.InterpolateLinear,STEP:h.InterpolateDiscrete},$e={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Fi(vt){return vt.DefaultMaterial===void 0&&(vt.DefaultMaterial=new h.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:h.FrontSide})),vt.DefaultMaterial}function ui(vt,ge,be){for(const Ne in be.extensions)vt[Ne]===void 0&&(ge.userData.gltfExtensions=ge.userData.gltfExtensions||{},ge.userData.gltfExtensions[Ne]=be.extensions[Ne])}function Si(vt,ge){ge.extras!==void 0&&(typeof ge.extras=="object"?Object.assign(vt.userData,ge.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+ge.extras))}function Ei(vt,ge,be){let Ne=!1,Se=!1,Fe=!1;for(let re=0,Me=ge.length;re<Me;re++){const ce=ge[re];if(ce.POSITION!==void 0&&(Ne=!0),ce.NORMAL!==void 0&&(Se=!0),ce.COLOR_0!==void 0&&(Fe=!0),Ne&&Se&&Fe)break}if(!Ne&&!Se&&!Fe)return Promise.resolve(vt);const Ie=[],U=[],$=[];for(let re=0,Me=ge.length;re<Me;re++){const ce=ge[re];if(Ne){const ze=ce.POSITION!==void 0?be.getDependency("accessor",ce.POSITION):vt.attributes.position;Ie.push(ze)}if(Se){const ze=ce.NORMAL!==void 0?be.getDependency("accessor",ce.NORMAL):vt.attributes.normal;U.push(ze)}if(Fe){const ze=ce.COLOR_0!==void 0?be.getDependency("accessor",ce.COLOR_0):vt.attributes.color;$.push(ze)}}return Promise.all([Promise.all(Ie),Promise.all(U),Promise.all($)]).then(function(re){const Me=re[0],ce=re[1],ze=re[2];return Ne&&(vt.morphAttributes.position=Me),Se&&(vt.morphAttributes.normal=ce),Fe&&(vt.morphAttributes.color=ze),vt.morphTargetsRelative=!0,vt})}function Zi(vt,ge){if(vt.updateMorphTargets(),ge.weights!==void 0)for(let be=0,Ne=ge.weights.length;be<Ne;be++)vt.morphTargetInfluences[be]=ge.weights[be];if(ge.extras&&Array.isArray(ge.extras.targetNames)){const be=ge.extras.targetNames;if(vt.morphTargetInfluences.length===be.length){vt.morphTargetDictionary={};for(let Ne=0,Se=be.length;Ne<Se;Ne++)vt.morphTargetDictionary[be[Ne]]=Ne}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Vi(vt){let ge;const be=vt.extensions&&vt.extensions[m.KHR_DRACO_MESH_COMPRESSION];if(be?ge="draco:"+be.bufferView+":"+be.indices+":"+We(be.attributes):ge=vt.indices+":"+We(vt.attributes)+":"+vt.mode,vt.targets!==void 0)for(let Ne=0,Se=vt.targets.length;Ne<Se;Ne++)ge+=":"+We(vt.targets[Ne]);return ge}function We(vt){let ge="";const be=Object.keys(vt).sort();for(let Ne=0,Se=be.length;Ne<Se;Ne++)ge+=be[Ne]+":"+vt[be[Ne]]+";";return ge}function Ce(vt){switch(vt){case Int8Array:return .007874015748031496;case Uint8Array:return .00392156862745098;case Int16Array:return 3051850947599719e-20;case Uint16Array:return 15259021896696422e-21;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function At(vt){return vt.search(/\.jpe?g($|\?)/i)>0||vt.search(/^data\:image\/jpeg/)===0?"image/jpeg":vt.search(/\.webp($|\?)/i)>0||vt.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const Ot=new h.Matrix4;class Zt{constructor(ge={},be={}){this.json=ge,this.extensions={},this.plugins={},this.options=be,this.cache=new g,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let Ne=!1,Se=!1,Fe=-1;typeof navigator<"u"&&(Ne=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,Se=navigator.userAgent.indexOf("Firefox")>-1,Fe=Se?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||Ne||Se&&Fe<98?this.textureLoader=new h.TextureLoader(this.options.manager):this.textureLoader=new h.ImageBitmapLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new h.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(ge){this.extensions=ge}setPlugins(ge){this.plugins=ge}parse(ge,be){const Ne=this,Se=this.json,Fe=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(Ie){return Ie._markDefs&&Ie._markDefs()}),Promise.all(this._invokeAll(function(Ie){return Ie.beforeRoot&&Ie.beforeRoot()})).then(function(){return Promise.all([Ne.getDependencies("scene"),Ne.getDependencies("animation"),Ne.getDependencies("camera")])}).then(function(Ie){const U={scene:Ie[0][Se.scene||0],scenes:Ie[0],animations:Ie[1],cameras:Ie[2],asset:Se.asset,parser:Ne,userData:{}};return ui(Fe,U,Se),Si(U,Se),Promise.all(Ne._invokeAll(function($){return $.afterRoot&&$.afterRoot(U)})).then(function(){for(const $ of U.scenes)$.updateMatrixWorld();ge(U)})}).catch(be)}_markDefs(){const ge=this.json.nodes||[],be=this.json.skins||[],Ne=this.json.meshes||[];for(let Se=0,Fe=be.length;Se<Fe;Se++){const Ie=be[Se].joints;for(let U=0,$=Ie.length;U<$;U++)ge[Ie[U]].isBone=!0}for(let Se=0,Fe=ge.length;Se<Fe;Se++){const Ie=ge[Se];Ie.mesh!==void 0&&(this._addNodeRef(this.meshCache,Ie.mesh),Ie.skin!==void 0&&(Ne[Ie.mesh].isSkinnedMesh=!0)),Ie.camera!==void 0&&this._addNodeRef(this.cameraCache,Ie.camera)}}_addNodeRef(ge,be){be!==void 0&&(ge.refs[be]===void 0&&(ge.refs[be]=ge.uses[be]=0),ge.refs[be]++)}_getNodeRef(ge,be,Ne){if(ge.refs[be]<=1)return Ne;const Se=Ne.clone(),Fe=(Ie,U)=>{const $=this.associations.get(Ie);$!=null&&this.associations.set(U,$);for(const[re,Me]of Ie.children.entries())Fe(Me,U.children[re])};return Fe(Ne,Se),Se.name+="_instance_"+ge.uses[be]++,Se}_invokeOne(ge){const be=Object.values(this.plugins);be.push(this);for(let Ne=0;Ne<be.length;Ne++){const Se=ge(be[Ne]);if(Se)return Se}return null}_invokeAll(ge){const be=Object.values(this.plugins);be.unshift(this);const Ne=[];for(let Se=0;Se<be.length;Se++){const Fe=ge(be[Se]);Fe&&Ne.push(Fe)}return Ne}getDependency(ge,be){const Ne=ge+":"+be;let Se=this.cache.get(Ne);if(!Se){switch(ge){case"scene":Se=this.loadScene(be);break;case"node":Se=this._invokeOne(function(Fe){return Fe.loadNode&&Fe.loadNode(be)});break;case"mesh":Se=this._invokeOne(function(Fe){return Fe.loadMesh&&Fe.loadMesh(be)});break;case"accessor":Se=this.loadAccessor(be);break;case"bufferView":Se=this._invokeOne(function(Fe){return Fe.loadBufferView&&Fe.loadBufferView(be)});break;case"buffer":Se=this.loadBuffer(be);break;case"material":Se=this._invokeOne(function(Fe){return Fe.loadMaterial&&Fe.loadMaterial(be)});break;case"texture":Se=this._invokeOne(function(Fe){return Fe.loadTexture&&Fe.loadTexture(be)});break;case"skin":Se=this.loadSkin(be);break;case"animation":Se=this._invokeOne(function(Fe){return Fe.loadAnimation&&Fe.loadAnimation(be)});break;case"camera":Se=this.loadCamera(be);break;default:if(Se=this._invokeOne(function(Fe){return Fe!=this&&Fe.getDependency&&Fe.getDependency(ge,be)}),!Se)throw new Error("Unknown type: "+ge);break}this.cache.add(Ne,Se)}return Se}getDependencies(ge){let be=this.cache.get(ge);if(!be){const Ne=this,Se=this.json[ge+(ge==="mesh"?"es":"s")]||[];be=Promise.all(Se.map(function(Fe,Ie){return Ne.getDependency(ge,Ie)})),this.cache.add(ge,be)}return be}loadBuffer(ge){const be=this.json.buffers[ge],Ne=this.fileLoader;if(be.type&&be.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+be.type+" buffer type is not supported.");if(be.uri===void 0&&ge===0)return Promise.resolve(this.extensions[m.KHR_BINARY_GLTF].body);const Se=this.options;return new Promise(function(Fe,Ie){Ne.load(h.LoaderUtils.resolveURL(be.uri,Se.path),Fe,void 0,function(){Ie(new Error('THREE.GLTFLoader: Failed to load buffer "'+be.uri+'".'))})})}loadBufferView(ge){const be=this.json.bufferViews[ge];return this.getDependency("buffer",be.buffer).then(function(Ne){const Se=be.byteLength||0,Fe=be.byteOffset||0;return Ne.slice(Fe,Fe+Se)})}loadAccessor(ge){const be=this,Ne=this.json,Se=this.json.accessors[ge];if(Se.bufferView===void 0&&Se.sparse===void 0){const Ie=St[Se.type],U=Je[Se.componentType],$=Se.normalized===!0,re=new U(Se.count*Ie);return Promise.resolve(new h.BufferAttribute(re,Ie,$))}const Fe=[];return Se.bufferView!==void 0?Fe.push(this.getDependency("bufferView",Se.bufferView)):Fe.push(null),Se.sparse!==void 0&&(Fe.push(this.getDependency("bufferView",Se.sparse.indices.bufferView)),Fe.push(this.getDependency("bufferView",Se.sparse.values.bufferView))),Promise.all(Fe).then(function(Ie){const U=Ie[0],$=St[Se.type],re=Je[Se.componentType],Me=re.BYTES_PER_ELEMENT,ce=Me*$,ze=Se.byteOffset||0,Ve=Se.bufferView!==void 0?Ne.bufferViews[Se.bufferView].byteStride:void 0,pt=Se.normalized===!0;let Dt,xt;if(Ve&&Ve!==ce){const Vt=Math.floor(ze/Ve),fi="InterleavedBuffer:"+Se.bufferView+":"+Se.componentType+":"+Vt+":"+Se.count;let xr=be.cache.get(fi);xr||(Dt=new re(U,Vt*Ve,Se.count*Ve/Me),xr=new h.InterleavedBuffer(Dt,Ve/Me),be.cache.add(fi,xr)),xt=new h.InterleavedBufferAttribute(xr,$,ze%Ve/Me,pt)}else U===null?Dt=new re(Se.count*$):Dt=new re(U,ze,Se.count*$),xt=new h.BufferAttribute(Dt,$,pt);if(Se.sparse!==void 0){const Vt=St.SCALAR,fi=Je[Se.sparse.indices.componentType],xr=Se.sparse.indices.byteOffset||0,ki=Se.sparse.values.byteOffset||0,mn=new fi(Ie[1],xr,Se.sparse.count*Vt),kr=new re(Ie[2],ki,Se.sparse.count*$);U!==null&&(xt=new h.BufferAttribute(xt.array.slice(),xt.itemSize,xt.normalized));for(let rn=0,vs=mn.length;rn<vs;rn++){const gn=mn[rn];if(xt.setX(gn,kr[rn*$]),$>=2&&xt.setY(gn,kr[rn*$+1]),$>=3&&xt.setZ(gn,kr[rn*$+2]),$>=4&&xt.setW(gn,kr[rn*$+3]),$>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return xt})}loadTexture(ge){const be=this.json,Ne=this.options,Se=be.textures[ge].source,Fe=be.images[Se];let Ie=this.textureLoader;if(Fe.uri){const U=Ne.manager.getHandler(Fe.uri);U!==null&&(Ie=U)}return this.loadTextureImage(ge,Se,Ie)}loadTextureImage(ge,be,Ne){const Se=this,Fe=this.json,Ie=Fe.textures[ge],U=Fe.images[be],$=(U.uri||U.bufferView)+":"+Ie.sampler;if(this.textureCache[$])return this.textureCache[$];const re=this.loadImageSource(be,Ne).then(function(Me){Me.flipY=!1,Me.name=Ie.name||U.name||"",Me.name===""&&typeof U.uri=="string"&&U.uri.startsWith("data:image/")===!1&&(Me.name=U.uri);const ce=(Fe.samplers||{})[Ie.sampler]||{};return Me.magFilter=it[ce.magFilter]||h.LinearFilter,Me.minFilter=it[ce.minFilter]||h.LinearMipmapLinearFilter,Me.wrapS=dt[ce.wrapS]||h.RepeatWrapping,Me.wrapT=dt[ce.wrapT]||h.RepeatWrapping,Se.associations.set(Me,{textures:ge}),Me}).catch(function(){return null});return this.textureCache[$]=re,re}loadImageSource(ge,be){const Ne=this,Se=this.json,Fe=this.options;if(this.sourceCache[ge]!==void 0)return this.sourceCache[ge].then(ce=>ce.clone());const Ie=Se.images[ge],U=self.URL||self.webkitURL;let $=Ie.uri||"",re=!1;if(Ie.bufferView!==void 0)$=Ne.getDependency("bufferView",Ie.bufferView).then(function(ce){re=!0;const ze=new Blob([ce],{type:Ie.mimeType});return $=U.createObjectURL(ze),$});else if(Ie.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+ge+" is missing URI and bufferView");const Me=Promise.resolve($).then(function(ce){return new Promise(function(ze,Ve){let pt=ze;be.isImageBitmapLoader===!0&&(pt=function(Dt){const xt=new h.Texture(Dt);xt.needsUpdate=!0,ze(xt)}),be.load(h.LoaderUtils.resolveURL(ce,Fe.path),pt,void 0,Ve)})}).then(function(ce){return re===!0&&U.revokeObjectURL($),ce.userData.mimeType=Ie.mimeType||At(Ie.uri),ce}).catch(function(ce){throw console.error("THREE.GLTFLoader: Couldn't load texture",$),ce});return this.sourceCache[ge]=Me,Me}assignTexture(ge,be,Ne,Se){const Fe=this;return this.getDependency("texture",Ne.index).then(function(Ie){if(!Ie)return null;if(Ne.texCoord!==void 0&&Ne.texCoord>0&&(Ie=Ie.clone(),Ie.channel=Ne.texCoord),Fe.extensions[m.KHR_TEXTURE_TRANSFORM]){const U=Ne.extensions!==void 0?Ne.extensions[m.KHR_TEXTURE_TRANSFORM]:void 0;if(U){const $=Fe.associations.get(Ie);Ie=Fe.extensions[m.KHR_TEXTURE_TRANSFORM].extendTexture(Ie,U),Fe.associations.set(Ie,$)}}return Se!==void 0&&(Ie.colorSpace=Se),ge[be]=Ie,Ie})}assignFinalMaterial(ge){const be=ge.geometry;let Ne=ge.material;const Se=be.attributes.tangent===void 0,Fe=be.attributes.color!==void 0,Ie=be.attributes.normal===void 0;if(ge.isPoints){const U="PointsMaterial:"+Ne.uuid;let $=this.cache.get(U);$||($=new h.PointsMaterial,h.Material.prototype.copy.call($,Ne),$.color.copy(Ne.color),$.map=Ne.map,$.sizeAttenuation=!1,this.cache.add(U,$)),Ne=$}else if(ge.isLine){const U="LineBasicMaterial:"+Ne.uuid;let $=this.cache.get(U);$||($=new h.LineBasicMaterial,h.Material.prototype.copy.call($,Ne),$.color.copy(Ne.color),$.map=Ne.map,this.cache.add(U,$)),Ne=$}if(Se||Fe||Ie){let U="ClonedMaterial:"+Ne.uuid+":";Se&&(U+="derivative-tangents:"),Fe&&(U+="vertex-colors:"),Ie&&(U+="flat-shading:");let $=this.cache.get(U);$||($=Ne.clone(),Fe&&($.vertexColors=!0),Ie&&($.flatShading=!0),Se&&($.normalScale&&($.normalScale.y*=-1),$.clearcoatNormalScale&&($.clearcoatNormalScale.y*=-1)),this.cache.add(U,$),this.associations.set($,this.associations.get(Ne))),Ne=$}ge.material=Ne}getMaterialType(){return h.MeshStandardMaterial}loadMaterial(ge){const be=this,Ne=this.json,Se=this.extensions,Fe=Ne.materials[ge];let Ie;const U={},$=Fe.extensions||{},re=[];if($[m.KHR_MATERIALS_UNLIT]){const ce=Se[m.KHR_MATERIALS_UNLIT];Ie=ce.getMaterialType(),re.push(ce.extendParams(U,Fe,be))}else{const ce=Fe.pbrMetallicRoughness||{};if(U.color=new h.Color(1,1,1),U.opacity=1,Array.isArray(ce.baseColorFactor)){const ze=ce.baseColorFactor;U.color.setRGB(ze[0],ze[1],ze[2],h.LinearSRGBColorSpace),U.opacity=ze[3]}ce.baseColorTexture!==void 0&&re.push(be.assignTexture(U,"map",ce.baseColorTexture,h.SRGBColorSpace)),U.metalness=ce.metallicFactor!==void 0?ce.metallicFactor:1,U.roughness=ce.roughnessFactor!==void 0?ce.roughnessFactor:1,ce.metallicRoughnessTexture!==void 0&&(re.push(be.assignTexture(U,"metalnessMap",ce.metallicRoughnessTexture)),re.push(be.assignTexture(U,"roughnessMap",ce.metallicRoughnessTexture))),Ie=this._invokeOne(function(ze){return ze.getMaterialType&&ze.getMaterialType(ge)}),re.push(Promise.all(this._invokeAll(function(ze){return ze.extendMaterialParams&&ze.extendMaterialParams(ge,U)})))}Fe.doubleSided===!0&&(U.side=h.DoubleSide);const Me=Fe.alphaMode||$e.OPAQUE;if(Me===$e.BLEND?(U.transparent=!0,U.depthWrite=!1):(U.transparent=!1,Me===$e.MASK&&(U.alphaTest=Fe.alphaCutoff!==void 0?Fe.alphaCutoff:.5)),Fe.normalTexture!==void 0&&Ie!==h.MeshBasicMaterial&&(re.push(be.assignTexture(U,"normalMap",Fe.normalTexture)),U.normalScale=new h.Vector2(1,1),Fe.normalTexture.scale!==void 0)){const ce=Fe.normalTexture.scale;U.normalScale.set(ce,ce)}if(Fe.occlusionTexture!==void 0&&Ie!==h.MeshBasicMaterial&&(re.push(be.assignTexture(U,"aoMap",Fe.occlusionTexture)),Fe.occlusionTexture.strength!==void 0&&(U.aoMapIntensity=Fe.occlusionTexture.strength)),Fe.emissiveFactor!==void 0&&Ie!==h.MeshBasicMaterial){const ce=Fe.emissiveFactor;U.emissive=new h.Color().setRGB(ce[0],ce[1],ce[2],h.LinearSRGBColorSpace)}return Fe.emissiveTexture!==void 0&&Ie!==h.MeshBasicMaterial&&re.push(be.assignTexture(U,"emissiveMap",Fe.emissiveTexture,h.SRGBColorSpace)),Promise.all(re).then(function(){const ce=new Ie(U);return Fe.name&&(ce.name=Fe.name),Si(ce,Fe),be.associations.set(ce,{materials:ge}),Fe.extensions&&ui(Se,ce,Fe),ce})}createUniqueName(ge){const be=h.PropertyBinding.sanitizeNodeName(ge||"");return be in this.nodeNamesUsed?be+"_"+ ++this.nodeNamesUsed[be]:(this.nodeNamesUsed[be]=0,be)}loadGeometries(ge){const be=this,Ne=this.extensions,Se=this.primitiveCache;function Fe(U){return Ne[m.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(U,be).then(function($){return xi($,U,be)})}const Ie=[];for(let U=0,$=ge.length;U<$;U++){const re=ge[U],Me=Vi(re),ce=Se[Me];if(ce)Ie.push(ce.promise);else{let ze;re.extensions&&re.extensions[m.KHR_DRACO_MESH_COMPRESSION]?ze=Fe(re):ze=xi(new h.BufferGeometry,re,be),Se[Me]={primitive:re,promise:ze},Ie.push(ze)}}return Promise.all(Ie)}loadMesh(ge){const be=this,Ne=this.json,Se=this.extensions,Fe=Ne.meshes[ge],Ie=Fe.primitives,U=[];for(let $=0,re=Ie.length;$<re;$++){const Me=Ie[$].material===void 0?Fi(this.cache):this.getDependency("material",Ie[$].material);U.push(Me)}return U.push(be.loadGeometries(Ie)),Promise.all(U).then(function($){const re=$.slice(0,$.length-1),Me=$[$.length-1],ce=[];for(let Ve=0,pt=Me.length;Ve<pt;Ve++){const Dt=Me[Ve],xt=Ie[Ve];let Vt;const fi=re[Ve];if(xt.mode===Xe.TRIANGLES||xt.mode===Xe.TRIANGLE_STRIP||xt.mode===Xe.TRIANGLE_FAN||xt.mode===void 0)Vt=Fe.isSkinnedMesh===!0?new h.SkinnedMesh(Dt,fi):new h.Mesh(Dt,fi),Vt.isSkinnedMesh===!0&&Vt.normalizeSkinWeights(),xt.mode===Xe.TRIANGLE_STRIP?Vt.geometry=(0,p.toTrianglesDrawMode)(Vt.geometry,h.TriangleStripDrawMode):xt.mode===Xe.TRIANGLE_FAN&&(Vt.geometry=(0,p.toTrianglesDrawMode)(Vt.geometry,h.TriangleFanDrawMode));else if(xt.mode===Xe.LINES)Vt=new h.LineSegments(Dt,fi);else if(xt.mode===Xe.LINE_STRIP)Vt=new h.Line(Dt,fi);else if(xt.mode===Xe.LINE_LOOP)Vt=new h.LineLoop(Dt,fi);else if(xt.mode===Xe.POINTS)Vt=new h.Points(Dt,fi);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+xt.mode);Object.keys(Vt.geometry.morphAttributes).length>0&&Zi(Vt,Fe),Vt.name=be.createUniqueName(Fe.name||"mesh_"+ge),Si(Vt,Fe),xt.extensions&&ui(Se,Vt,xt),be.assignFinalMaterial(Vt),ce.push(Vt)}for(let Ve=0,pt=ce.length;Ve<pt;Ve++)be.associations.set(ce[Ve],{meshes:ge,primitives:Ve});if(ce.length===1)return Fe.extensions&&ui(Se,ce[0],Fe),ce[0];const ze=new h.Group;Fe.extensions&&ui(Se,ze,Fe),be.associations.set(ze,{meshes:ge});for(let Ve=0,pt=ce.length;Ve<pt;Ve++)ze.add(ce[Ve]);return ze})}loadCamera(ge){let be;const Ne=this.json.cameras[ge],Se=Ne[Ne.type];if(!Se){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return Ne.type==="perspective"?be=new h.PerspectiveCamera(h.MathUtils.radToDeg(Se.yfov),Se.aspectRatio||1,Se.znear||1,Se.zfar||2e6):Ne.type==="orthographic"&&(be=new h.OrthographicCamera(-Se.xmag,Se.xmag,Se.ymag,-Se.ymag,Se.znear,Se.zfar)),Ne.name&&(be.name=this.createUniqueName(Ne.name)),Si(be,Ne),Promise.resolve(be)}loadSkin(ge){const be=this.json.skins[ge],Ne=[];for(let Se=0,Fe=be.joints.length;Se<Fe;Se++)Ne.push(this._loadNodeShallow(be.joints[Se]));return be.inverseBindMatrices!==void 0?Ne.push(this.getDependency("accessor",be.inverseBindMatrices)):Ne.push(null),Promise.all(Ne).then(function(Se){const Fe=Se.pop(),Ie=Se,U=[],$=[];for(let re=0,Me=Ie.length;re<Me;re++){const ce=Ie[re];if(ce){U.push(ce);const ze=new h.Matrix4;Fe!==null&&ze.fromArray(Fe.array,re*16),$.push(ze)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',be.joints[re])}return new h.Skeleton(U,$)})}loadAnimation(ge){const be=this.json,Ne=this,Se=be.animations[ge],Fe=Se.name?Se.name:"animation_"+ge,Ie=[],U=[],$=[],re=[],Me=[];for(let ce=0,ze=Se.channels.length;ce<ze;ce++){const Ve=Se.channels[ce],pt=Se.samplers[Ve.sampler],Dt=Ve.target,xt=Dt.node,Vt=Se.parameters!==void 0?Se.parameters[pt.input]:pt.input,fi=Se.parameters!==void 0?Se.parameters[pt.output]:pt.output;Dt.node!==void 0&&(Ie.push(this.getDependency("node",xt)),U.push(this.getDependency("accessor",Vt)),$.push(this.getDependency("accessor",fi)),re.push(pt),Me.push(Dt))}return Promise.all([Promise.all(Ie),Promise.all(U),Promise.all($),Promise.all(re),Promise.all(Me)]).then(function(ce){const ze=ce[0],Ve=ce[1],pt=ce[2],Dt=ce[3],xt=ce[4],Vt=[];for(let fi=0,xr=ze.length;fi<xr;fi++){const ki=ze[fi],mn=Ve[fi],kr=pt[fi],rn=Dt[fi],vs=xt[fi];if(ki===void 0)continue;ki.updateMatrix&&ki.updateMatrix();const gn=Ne._createAnimationTracks(ki,mn,kr,rn,vs);if(gn)for(let Ls=0;Ls<gn.length;Ls++)Vt.push(gn[Ls])}return new h.AnimationClip(Fe,void 0,Vt)})}createNodeMesh(ge){const be=this.json,Ne=this,Se=be.nodes[ge];return Se.mesh===void 0?null:Ne.getDependency("mesh",Se.mesh).then(function(Fe){const Ie=Ne._getNodeRef(Ne.meshCache,Se.mesh,Fe);return Se.weights!==void 0&&Ie.traverse(function(U){if(U.isMesh)for(let $=0,re=Se.weights.length;$<re;$++)U.morphTargetInfluences[$]=Se.weights[$]}),Ie})}loadNode(ge){const be=this.json,Ne=this,Se=be.nodes[ge],Fe=Ne._loadNodeShallow(ge),Ie=[],U=Se.children||[];for(let re=0,Me=U.length;re<Me;re++)Ie.push(Ne.getDependency("node",U[re]));const $=Se.skin===void 0?Promise.resolve(null):Ne.getDependency("skin",Se.skin);return Promise.all([Fe,Promise.all(Ie),$]).then(function(re){const Me=re[0],ce=re[1],ze=re[2];ze!==null&&Me.traverse(function(Ve){Ve.isSkinnedMesh&&Ve.bind(ze,Ot)});for(let Ve=0,pt=ce.length;Ve<pt;Ve++)Me.add(ce[Ve]);return Me})}_loadNodeShallow(ge){const be=this.json,Ne=this.extensions,Se=this;if(this.nodeCache[ge]!==void 0)return this.nodeCache[ge];const Fe=be.nodes[ge],Ie=Fe.name?Se.createUniqueName(Fe.name):"",U=[],$=Se._invokeOne(function(re){return re.createNodeMesh&&re.createNodeMesh(ge)});return $&&U.push($),Fe.camera!==void 0&&U.push(Se.getDependency("camera",Fe.camera).then(function(re){return Se._getNodeRef(Se.cameraCache,Fe.camera,re)})),Se._invokeAll(function(re){return re.createNodeAttachment&&re.createNodeAttachment(ge)}).forEach(function(re){U.push(re)}),this.nodeCache[ge]=Promise.all(U).then(function(re){let Me;if(Fe.isBone===!0?Me=new h.Bone:re.length>1?Me=new h.Group:re.length===1?Me=re[0]:Me=new h.Object3D,Me!==re[0])for(let ce=0,ze=re.length;ce<ze;ce++)Me.add(re[ce]);if(Fe.name&&(Me.userData.name=Fe.name,Me.name=Ie),Si(Me,Fe),Fe.extensions&&ui(Ne,Me,Fe),Fe.matrix!==void 0){const ce=new h.Matrix4;ce.fromArray(Fe.matrix),Me.applyMatrix4(ce)}else Fe.translation!==void 0&&Me.position.fromArray(Fe.translation),Fe.rotation!==void 0&&Me.quaternion.fromArray(Fe.rotation),Fe.scale!==void 0&&Me.scale.fromArray(Fe.scale);return Se.associations.has(Me)||Se.associations.set(Me,{}),Se.associations.get(Me).nodes=ge,Me}),this.nodeCache[ge]}loadScene(ge){const be=this.extensions,Ne=this.json.scenes[ge],Se=this,Fe=new h.Group;Ne.name&&(Fe.name=Se.createUniqueName(Ne.name)),Si(Fe,Ne),Ne.extensions&&ui(be,Fe,Ne);const Ie=Ne.nodes||[],U=[];for(let $=0,re=Ie.length;$<re;$++)U.push(Se.getDependency("node",Ie[$]));return Promise.all(U).then(function($){for(let Me=0,ce=$.length;Me<ce;Me++)Fe.add($[Me]);const re=Me=>{const ce=new Map;for(const[ze,Ve]of Se.associations)(ze instanceof h.Material||ze instanceof h.Texture)&&ce.set(ze,Ve);return Me.traverse(ze=>{const Ve=Se.associations.get(ze);Ve!=null&&ce.set(ze,Ve)}),ce};return Se.associations=re(Fe),Fe})}_createAnimationTracks(ge,be,Ne,Se,Fe){const Ie=[],U=ge.name?ge.name:ge.uuid,$=[];yt[Fe.path]===yt.weights?ge.traverse(function(ze){ze.morphTargetInfluences&&$.push(ze.name?ze.name:ze.uuid)}):$.push(U);let re;switch(yt[Fe.path]){case yt.weights:re=h.NumberKeyframeTrack;break;case yt.rotation:re=h.QuaternionKeyframeTrack;break;case yt.position:case yt.scale:re=h.VectorKeyframeTrack;break;default:switch(Ne.itemSize){case 1:re=h.NumberKeyframeTrack;break;case 2:case 3:default:re=h.VectorKeyframeTrack;break}break}const Me=Se.interpolation!==void 0?bi[Se.interpolation]:h.InterpolateLinear,ce=this._getArrayFromAccessor(Ne);for(let ze=0,Ve=$.length;ze<Ve;ze++){const pt=new re($[ze]+"."+yt[Fe.path],be.array,ce,Me);Se.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(pt),Ie.push(pt)}return Ie}_getArrayFromAccessor(ge){let be=ge.array;if(ge.normalized){const Ne=Ce(be.constructor),Se=new Float32Array(be.length);for(let Fe=0,Ie=be.length;Fe<Ie;Fe++)Se[Fe]=be[Fe]*Ne;be=Se}return be}_createCubicSplineTrackInterpolant(ge){ge.createInterpolant=function(be){const Ne=this instanceof h.QuaternionKeyframeTrack?Oe:Ae;return new Ne(this.times,this.values,this.getValueSize()/3,be)},ge.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function jt(vt,ge,be){const Ne=ge.attributes,Se=new h.Box3;if(Ne.POSITION!==void 0){const U=be.json.accessors[Ne.POSITION],$=U.min,re=U.max;if($!==void 0&&re!==void 0){if(Se.set(new h.Vector3($[0],$[1],$[2]),new h.Vector3(re[0],re[1],re[2])),U.normalized){const Me=Ce(Je[U.componentType]);Se.min.multiplyScalar(Me),Se.max.multiplyScalar(Me)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const Fe=ge.targets;if(Fe!==void 0){const U=new h.Vector3,$=new h.Vector3;for(let re=0,Me=Fe.length;re<Me;re++){const ce=Fe[re];if(ce.POSITION!==void 0){const ze=be.json.accessors[ce.POSITION],Ve=ze.min,pt=ze.max;if(Ve!==void 0&&pt!==void 0){if($.setX(Math.max(Math.abs(Ve[0]),Math.abs(pt[0]))),$.setY(Math.max(Math.abs(Ve[1]),Math.abs(pt[1]))),$.setZ(Math.max(Math.abs(Ve[2]),Math.abs(pt[2]))),ze.normalized){const Dt=Ce(Je[ze.componentType]);$.multiplyScalar(Dt)}U.max($)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}Se.expandByVector(U)}vt.boundingBox=Se;const Ie=new h.Sphere;Se.getCenter(Ie.center),Ie.radius=Se.min.distanceTo(Se.max)/2,vt.boundingSphere=Ie}function xi(vt,ge,be){const Ne=ge.attributes,Se=[];function Fe(Ie,U){return be.getDependency("accessor",Ie).then(function($){vt.setAttribute(U,$)})}for(const Ie in Ne){const U=Qt[Ie]||Ie.toLowerCase();U in vt.attributes||Se.push(Fe(Ne[Ie],U))}if(ge.indices!==void 0&&!vt.index){const Ie=be.getDependency("accessor",ge.indices).then(function(U){vt.setIndex(U)});Se.push(Ie)}return h.ColorManagement.workingColorSpace!==h.LinearSRGBColorSpace&&"COLOR_0"in Ne&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${h.ColorManagement.workingColorSpace}" not supported.`),Si(vt,ge),jt(vt,ge,be),Promise.all(Se).then(function(){return ge.targets!==void 0?Ei(vt,ge.targets,be):vt})}},"./node_modules/three/examples/jsm/loaders/KTX2Loader.js":(l,u,c)=>{c.r(u),c.d(u,{KTX2Loader:()=>v});var h=c("./node_modules/three/build/three.module.js"),p=c("./node_modules/three/examples/jsm/utils/WorkerPool.js"),f=c("./node_modules/three/examples/jsm/libs/ktx-parse.module.js"),g=c("./node_modules/three/examples/jsm/libs/zstddec.module.js");const m=new WeakMap;let y=0,b;class v extends h.Loader{constructor(I){super(I),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new p.WorkerPool,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(I){return this.transcoderPath=I,this}setWorkerLimit(I){return this.workerPool.setWorkerLimit(I),this}async detectSupportAsync(I){return this.workerConfig={astcSupported:await I.hasFeatureAsync("texture-compression-astc"),etc1Supported:await I.hasFeatureAsync("texture-compression-etc1"),etc2Supported:await I.hasFeatureAsync("texture-compression-etc2"),dxtSupported:await I.hasFeatureAsync("texture-compression-bc"),bptcSupported:await I.hasFeatureAsync("texture-compression-bptc"),pvrtcSupported:await I.hasFeatureAsync("texture-compression-pvrtc")},this}detectSupport(I){return I.isWebGPURenderer===!0?this.workerConfig={astcSupported:I.hasFeature("texture-compression-astc"),etc1Supported:I.hasFeature("texture-compression-etc1"),etc2Supported:I.hasFeature("texture-compression-etc2"),dxtSupported:I.hasFeature("texture-compression-bc"),bptcSupported:I.hasFeature("texture-compression-bptc"),pvrtcSupported:I.hasFeature("texture-compression-pvrtc")}:this.workerConfig={astcSupported:I.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:I.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:I.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:I.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:I.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:I.extensions.has("WEBGL_compressed_texture_pvrtc")||I.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}init(){if(!this.transcoderPending){const I=new h.FileLoader(this.manager);I.setPath(this.transcoderPath),I.setWithCredentials(this.withCredentials);const N=I.loadAsync("basis_transcoder.js"),D=new h.FileLoader(this.manager);D.setPath(this.transcoderPath),D.setResponseType("arraybuffer"),D.setWithCredentials(this.withCredentials);const P=D.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([N,P]).then(([k,q])=>{const V=v.BasisWorker.toString(),j=["/* constants */","let _EngineFormat = "+JSON.stringify(v.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(v.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(v.BasisFormat),"/* basis_transcoder.js */",k,"/* worker */",V.substring(V.indexOf("{")+1,V.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([j])),this.transcoderBinary=q,this.workerPool.setWorkerCreator(()=>{const Q=new Worker(this.workerSourceURL),W=this.transcoderBinary.slice(0);return Q.postMessage({type:"init",config:this.workerConfig,transcoderBinary:W},[W]),Q})}),y>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),y++}return this.transcoderPending}load(I,N,D,P){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const k=new h.FileLoader(this.manager);k.setResponseType("arraybuffer"),k.setWithCredentials(this.withCredentials),k.load(I,q=>{if(m.has(q))return m.get(q).promise.then(N).catch(P);this._createTexture(q).then(V=>N?N(V):null).catch(P)},D,P)}_createTextureFrom(I,N){const{faces:D,width:P,height:k,format:q,type:V,error:j,dfdFlags:Q}=I;if(V==="error")return Promise.reject(j);let W;if(N.faceCount===6)W=new h.CompressedCubeTexture(D,q,h.UnsignedByteType);else{const G=D[0].mipmaps;W=N.layerCount>1?new h.CompressedArrayTexture(G,P,k,N.layerCount,q,h.UnsignedByteType):new h.CompressedTexture(G,P,k,q,h.UnsignedByteType)}return W.minFilter=D[0].mipmaps.length===1?h.LinearFilter:h.LinearMipmapLinearFilter,W.magFilter=h.LinearFilter,W.generateMipmaps=!1,W.needsUpdate=!0,W.colorSpace=R(N),W.premultiplyAlpha=!!(Q&f.KHR_DF_FLAG_ALPHA_PREMULTIPLIED),W}async _createTexture(I,N={}){const D=(0,f.read)(new Uint8Array(I));if(D.vkFormat!==f.VK_FORMAT_UNDEFINED)return C(D);const P=N,k=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:I,taskConfig:P},[I])).then(q=>this._createTextureFrom(q.data,D));return m.set(I,{promise:k}),k}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),y--,this}}v.BasisFormat={ETC1S:0,UASTC_4x4:1},v.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},v.EngineFormat={RGBAFormat:h.RGBAFormat,RGBA_ASTC_4x4_Format:h.RGBA_ASTC_4x4_Format,RGBA_BPTC_Format:h.RGBA_BPTC_Format,RGBA_ETC2_EAC_Format:h.RGBA_ETC2_EAC_Format,RGBA_PVRTC_4BPPV1_Format:h.RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT5_Format:h.RGBA_S3TC_DXT5_Format,RGB_ETC1_Format:h.RGB_ETC1_Format,RGB_ETC2_Format:h.RGB_ETC2_Format,RGB_PVRTC_4BPPV1_Format:h.RGB_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT1_Format:h.RGBA_S3TC_DXT1_Format},v.BasisWorker=function(){let B,I,N;const D=_EngineFormat,P=_TranscoderFormat,k=_BasisFormat;self.addEventListener("message",function(Y){const se=Y.data;switch(se.type){case"init":B=se.config,q(se.transcoderBinary);break;case"transcode":I.then(()=>{try{const{faces:ve,buffers:Ae,width:me,height:Oe,hasAlpha:Xe,format:Je,dfdFlags:it}=V(se.buffer);self.postMessage({type:"transcode",id:se.id,faces:ve,width:me,height:Oe,hasAlpha:Xe,format:Je,dfdFlags:it},Ae)}catch(ve){console.error(ve),self.postMessage({type:"error",id:se.id,error:ve.message})}});break}});function q(Y){I=new Promise(se=>{N={wasmBinary:Y,onRuntimeInitialized:se},BASIS(N)}).then(()=>{N.initializeBasis(),N.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function V(Y){const se=new N.KTX2File(new Uint8Array(Y));function ve(){se.close(),se.delete()}if(!se.isValid())throw ve(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");const Ae=se.isUASTC()?k.UASTC_4x4:k.ETC1S,me=se.getWidth(),Oe=se.getHeight(),Xe=se.getLayers()||1,Je=se.getLevels(),it=se.getFaces(),dt=se.getHasAlpha(),St=se.getDFDFlags(),{transcoderFormat:Qt,engineFormat:yt}=G(Ae,me,Oe,dt);if(!me||!Oe||!Je)throw ve(),new Error("THREE.KTX2Loader:	Invalid texture");if(!se.startTranscoding())throw ve(),new Error("THREE.KTX2Loader: .startTranscoding failed");const bi=[],$e=[];for(let Fi=0;Fi<it;Fi++){const ui=[];for(let Si=0;Si<Je;Si++){const Ei=[];let Zi,Vi;for(let Ce=0;Ce<Xe;Ce++){const At=se.getImageLevelInfo(Si,Ce,Fi);Fi===0&&Si===0&&Ce===0&&(At.origWidth%4!==0||At.origHeight%4!==0)&&console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),Je>1?(Zi=At.origWidth,Vi=At.origHeight):(Zi=At.width,Vi=At.height);const Ot=new Uint8Array(se.getImageTranscodedSizeInBytes(Si,Ce,0,Qt));if(!se.transcodeImage(Ot,Si,Ce,Fi,Qt,0,-1,-1))throw ve(),new Error("THREE.KTX2Loader: .transcodeImage failed.");Ei.push(Ot)}const We=te(Ei);ui.push({data:We,width:Zi,height:Vi}),$e.push(We.buffer)}bi.push({mipmaps:ui,width:me,height:Oe,format:yt})}return ve(),{faces:bi,buffers:$e,width:me,height:Oe,hasAlpha:dt,format:yt,dfdFlags:St}}const j=[{if:"astcSupported",basisFormat:[k.UASTC_4x4],transcoderFormat:[P.ASTC_4x4,P.ASTC_4x4],engineFormat:[D.RGBA_ASTC_4x4_Format,D.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[k.ETC1S,k.UASTC_4x4],transcoderFormat:[P.BC7_M5,P.BC7_M5],engineFormat:[D.RGBA_BPTC_Format,D.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[k.ETC1S,k.UASTC_4x4],transcoderFormat:[P.BC1,P.BC3],engineFormat:[D.RGBA_S3TC_DXT1_Format,D.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[k.ETC1S,k.UASTC_4x4],transcoderFormat:[P.ETC1,P.ETC2],engineFormat:[D.RGB_ETC2_Format,D.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[k.ETC1S,k.UASTC_4x4],transcoderFormat:[P.ETC1],engineFormat:[D.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[k.ETC1S,k.UASTC_4x4],transcoderFormat:[P.PVRTC1_4_RGB,P.PVRTC1_4_RGBA],engineFormat:[D.RGB_PVRTC_4BPPV1_Format,D.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],Q=j.sort(function(Y,se){return Y.priorityETC1S-se.priorityETC1S}),W=j.sort(function(Y,se){return Y.priorityUASTC-se.priorityUASTC});function G(Y,se,ve,Ae){let me,Oe;const Xe=Y===k.ETC1S?Q:W;for(let Je=0;Je<Xe.length;Je++){const it=Xe[Je];if(B[it.if]&&it.basisFormat.includes(Y)&&!(Ae&&it.transcoderFormat.length<2)&&!(it.needsPowerOfTwo&&!(z(se)&&z(ve))))return me=it.transcoderFormat[Ae?1:0],Oe=it.engineFormat[Ae?1:0],{transcoderFormat:me,engineFormat:Oe}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),me=P.RGBA32,Oe=D.RGBAFormat,{transcoderFormat:me,engineFormat:Oe}}function z(Y){return Y<=2?!0:(Y&Y-1)===0&&Y!==0}function te(Y){if(Y.length===1)return Y[0];let se=0;for(let me=0;me<Y.length;me++){const Oe=Y[me];se+=Oe.byteLength}const ve=new Uint8Array(se);let Ae=0;for(let me=0;me<Y.length;me++){const Oe=Y[me];ve.set(Oe,Ae),Ae+=Oe.byteLength}return ve}};const _=new Set([h.RGBAFormat,h.RGFormat,h.RedFormat]),T={[f.VK_FORMAT_R32G32B32A32_SFLOAT]:h.RGBAFormat,[f.VK_FORMAT_R16G16B16A16_SFLOAT]:h.RGBAFormat,[f.VK_FORMAT_R8G8B8A8_UNORM]:h.RGBAFormat,[f.VK_FORMAT_R8G8B8A8_SRGB]:h.RGBAFormat,[f.VK_FORMAT_R32G32_SFLOAT]:h.RGFormat,[f.VK_FORMAT_R16G16_SFLOAT]:h.RGFormat,[f.VK_FORMAT_R8G8_UNORM]:h.RGFormat,[f.VK_FORMAT_R8G8_SRGB]:h.RGFormat,[f.VK_FORMAT_R32_SFLOAT]:h.RedFormat,[f.VK_FORMAT_R16_SFLOAT]:h.RedFormat,[f.VK_FORMAT_R8_SRGB]:h.RedFormat,[f.VK_FORMAT_R8_UNORM]:h.RedFormat,[f.VK_FORMAT_ASTC_6x6_SRGB_BLOCK]:h.RGBA_ASTC_6x6_Format,[f.VK_FORMAT_ASTC_6x6_UNORM_BLOCK]:h.RGBA_ASTC_6x6_Format},E={[f.VK_FORMAT_R32G32B32A32_SFLOAT]:h.FloatType,[f.VK_FORMAT_R16G16B16A16_SFLOAT]:h.HalfFloatType,[f.VK_FORMAT_R8G8B8A8_UNORM]:h.UnsignedByteType,[f.VK_FORMAT_R8G8B8A8_SRGB]:h.UnsignedByteType,[f.VK_FORMAT_R32G32_SFLOAT]:h.FloatType,[f.VK_FORMAT_R16G16_SFLOAT]:h.HalfFloatType,[f.VK_FORMAT_R8G8_UNORM]:h.UnsignedByteType,[f.VK_FORMAT_R8G8_SRGB]:h.UnsignedByteType,[f.VK_FORMAT_R32_SFLOAT]:h.FloatType,[f.VK_FORMAT_R16_SFLOAT]:h.HalfFloatType,[f.VK_FORMAT_R8_SRGB]:h.UnsignedByteType,[f.VK_FORMAT_R8_UNORM]:h.UnsignedByteType,[f.VK_FORMAT_ASTC_6x6_SRGB_BLOCK]:h.UnsignedByteType,[f.VK_FORMAT_ASTC_6x6_UNORM_BLOCK]:h.UnsignedByteType};async function C(B){const{vkFormat:I}=B;if(T[I]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let N;B.supercompressionScheme===f.KHR_SUPERCOMPRESSION_ZSTD&&(b||(b=new Promise(async k=>{const q=new g.ZSTDDecoder;await q.init(),k(q)})),N=await b);const D=[];for(let k=0;k<B.levels.length;k++){const q=Math.max(1,B.pixelWidth>>k),V=Math.max(1,B.pixelHeight>>k),j=B.pixelDepth?Math.max(1,B.pixelDepth>>k):0,Q=B.levels[k];let W;if(B.supercompressionScheme===f.KHR_SUPERCOMPRESSION_NONE)W=Q.levelData;else if(B.supercompressionScheme===f.KHR_SUPERCOMPRESSION_ZSTD)W=N.decode(Q.levelData,Q.uncompressedByteLength);else throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");let G;E[I]===h.FloatType?G=new Float32Array(W.buffer,W.byteOffset,W.byteLength/Float32Array.BYTES_PER_ELEMENT):E[I]===h.HalfFloatType?G=new Uint16Array(W.buffer,W.byteOffset,W.byteLength/Uint16Array.BYTES_PER_ELEMENT):G=W,D.push({data:G,width:q,height:V,depth:j})}let P;if(_.has(T[I]))P=B.pixelDepth===0?new h.DataTexture(D[0].data,B.pixelWidth,B.pixelHeight):new h.Data3DTexture(D[0].data,B.pixelWidth,B.pixelHeight,B.pixelDepth);else{if(B.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");P=new h.CompressedTexture(D,B.pixelWidth,B.pixelHeight)}return P.mipmaps=D,P.type=E[I],P.format=T[I],P.colorSpace=R(B),P.needsUpdate=!0,Promise.resolve(P)}function R(B){const I=B.dataFormatDescriptor[0];return I.colorPrimaries===f.KHR_DF_PRIMARIES_BT709?I.transferFunction===f.KHR_DF_TRANSFER_SRGB?h.SRGBColorSpace:h.LinearSRGBColorSpace:I.colorPrimaries===f.KHR_DF_PRIMARIES_DISPLAYP3?I.transferFunction===f.KHR_DF_TRANSFER_SRGB?h.DisplayP3ColorSpace:h.LinearDisplayP3ColorSpace:(I.colorPrimaries===f.KHR_DF_PRIMARIES_UNSPECIFIED||console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${I.colorPrimaries}"`),h.NoColorSpace)}},"./node_modules/three/examples/jsm/loaders/MTLLoader.js":(l,u,c)=>{c.r(u),c.d(u,{MTLLoader:()=>p});var h=c("./node_modules/three/build/three.module.js");class p extends h.Loader{constructor(m){super(m)}load(m,y,b,v){const _=this,T=this.path===""?h.LoaderUtils.extractUrlBase(m):this.path,E=new h.FileLoader(this.manager);E.setPath(this.path),E.setRequestHeader(this.requestHeader),E.setWithCredentials(this.withCredentials),E.load(m,function(C){try{y(_.parse(C,T))}catch(R){v?v(R):console.error(R),_.manager.itemError(m)}},b,v)}setMaterialOptions(m){return this.materialOptions=m,this}parse(m,y){const b=m.split(`
`);let v={};const _=/\s+/,T={};for(let C=0;C<b.length;C++){let R=b[C];if(R=R.trim(),R.length===0||R.charAt(0)==="#")continue;const B=R.indexOf(" ");let I=B>=0?R.substring(0,B):R;I=I.toLowerCase();let N=B>=0?R.substring(B+1):"";if(N=N.trim(),I==="newmtl")v={name:N},T[N]=v;else if(I==="ka"||I==="kd"||I==="ks"||I==="ke"){const D=N.split(_,3);v[I]=[parseFloat(D[0]),parseFloat(D[1]),parseFloat(D[2])]}else v[I]=N}const E=new f(this.resourcePath||y,this.materialOptions);return E.setCrossOrigin(this.crossOrigin),E.setManager(this.manager),E.setMaterials(T),E}}class f{constructor(m="",y={}){this.baseUrl=m,this.options=y,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:h.FrontSide,this.wrap=this.options.wrap!==void 0?this.options.wrap:h.RepeatWrapping}setCrossOrigin(m){return this.crossOrigin=m,this}setManager(m){this.manager=m}setMaterials(m){this.materialsInfo=this.convert(m),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(m){if(!this.options)return m;const y={};for(const b in m){const v=m[b],_={};y[b]=_;for(const T in v){let E=!0,C=v[T];const R=T.toLowerCase();switch(R){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(C=[C[0]/255,C[1]/255,C[2]/255]),this.options&&this.options.ignoreZeroRGBs&&C[0]===0&&C[1]===0&&C[2]===0&&(E=!1);break}E&&(_[R]=C)}}return y}preload(){for(const m in this.materialsInfo)this.create(m)}getIndex(m){return this.nameLookup[m]}getAsArray(){let m=0;for(const y in this.materialsInfo)this.materialsArray[m]=this.create(y),this.nameLookup[y]=m,m++;return this.materialsArray}create(m){return this.materials[m]===void 0&&this.createMaterial_(m),this.materials[m]}createMaterial_(m){const y=this,b=this.materialsInfo[m],v={name:m,side:this.side};function _(E,C){return typeof C!="string"||C===""?"":/^https?:\/\//i.test(C)?C:E+C}function T(E,C){if(v[E])return;const R=y.getTextureParams(C,v),B=y.loadTexture(_(y.baseUrl,R.url));B.repeat.copy(R.scale),B.offset.copy(R.offset),B.wrapS=y.wrap,B.wrapT=y.wrap,(E==="map"||E==="emissiveMap")&&(B.colorSpace=h.SRGBColorSpace),v[E]=B}for(const E in b){const C=b[E];let R;if(C!=="")switch(E.toLowerCase()){case"kd":v.color=new h.Color().fromArray(C).convertSRGBToLinear();break;case"ks":v.specular=new h.Color().fromArray(C).convertSRGBToLinear();break;case"ke":v.emissive=new h.Color().fromArray(C).convertSRGBToLinear();break;case"map_kd":T("map",C);break;case"map_ks":T("specularMap",C);break;case"map_ke":T("emissiveMap",C);break;case"norm":T("normalMap",C);break;case"map_bump":case"bump":T("bumpMap",C);break;case"map_d":T("alphaMap",C),v.transparent=!0;break;case"ns":v.shininess=parseFloat(C);break;case"d":R=parseFloat(C),R<1&&(v.opacity=R,v.transparent=!0);break;case"tr":R=parseFloat(C),this.options&&this.options.invertTrProperty&&(R=1-R),R>0&&(v.opacity=1-R,v.transparent=!0);break}}return this.materials[m]=new h.MeshPhongMaterial(v),this.materials[m]}getTextureParams(m,y){const b={scale:new h.Vector2(1,1),offset:new h.Vector2(0,0)},v=m.split(/\s+/);let _;return _=v.indexOf("-bm"),_>=0&&(y.bumpScale=parseFloat(v[_+1]),v.splice(_,2)),_=v.indexOf("-s"),_>=0&&(b.scale.set(parseFloat(v[_+1]),parseFloat(v[_+2])),v.splice(_,4)),_=v.indexOf("-o"),_>=0&&(b.offset.set(parseFloat(v[_+1]),parseFloat(v[_+2])),v.splice(_,4)),b.url=v.join(" ").trim(),b}loadTexture(m,y,b,v,_){const T=this.manager!==void 0?this.manager:h.DefaultLoadingManager;let E=T.getHandler(m);E===null&&(E=new h.TextureLoader(T)),E.setCrossOrigin&&E.setCrossOrigin(this.crossOrigin);const C=E.load(m,b,v,_);return y!==void 0&&(C.mapping=y),C}}},"./node_modules/three/examples/jsm/loaders/OBJLoader.js":(l,u,c)=>{c.r(u),c.d(u,{OBJLoader:()=>B});var h=c("./node_modules/three/build/three.module.js");const p=/^[og]\s*(.+)?/,f=/^mtllib /,g=/^usemtl /,m=/^usemap /,y=/\s+/,b=new h.Vector3,v=new h.Vector3,_=new h.Vector3,T=new h.Vector3,E=new h.Vector3,C=new h.Color;function R(){const I={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(N,D){if(this.object&&this.object.fromDeclaration===!1){this.object.name=N,this.object.fromDeclaration=D!==!1;return}const P=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:N||"",fromDeclaration:D!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(k,q){const V=this._finalize(!1);V&&(V.inherited||V.groupCount<=0)&&this.materials.splice(V.index,1);const j={index:this.materials.length,name:k||"",mtllib:Array.isArray(q)&&q.length>0?q[q.length-1]:"",smooth:V!==void 0?V.smooth:this.smooth,groupStart:V!==void 0?V.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(Q){const W={index:typeof Q=="number"?Q:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return W.clone=this.clone.bind(W),W}};return this.materials.push(j),j},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(k){const q=this.currentMaterial();if(q&&q.groupEnd===-1&&(q.groupEnd=this.geometry.vertices.length/3,q.groupCount=q.groupEnd-q.groupStart,q.inherited=!1),k&&this.materials.length>1)for(let V=this.materials.length-1;V>=0;V--)this.materials[V].groupCount<=0&&this.materials.splice(V,1);return k&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),q}},P&&P.name&&typeof P.clone=="function"){const k=P.clone(0);k.inherited=!0,this.object.materials.push(k)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(N,D){const P=parseInt(N,10);return(P>=0?P-1:P+D/3)*3},parseNormalIndex:function(N,D){const P=parseInt(N,10);return(P>=0?P-1:P+D/3)*3},parseUVIndex:function(N,D){const P=parseInt(N,10);return(P>=0?P-1:P+D/2)*2},addVertex:function(N,D,P){const k=this.vertices,q=this.object.geometry.vertices;q.push(k[N+0],k[N+1],k[N+2]),q.push(k[D+0],k[D+1],k[D+2]),q.push(k[P+0],k[P+1],k[P+2])},addVertexPoint:function(N){const D=this.vertices;this.object.geometry.vertices.push(D[N+0],D[N+1],D[N+2])},addVertexLine:function(N){const D=this.vertices;this.object.geometry.vertices.push(D[N+0],D[N+1],D[N+2])},addNormal:function(N,D,P){const k=this.normals,q=this.object.geometry.normals;q.push(k[N+0],k[N+1],k[N+2]),q.push(k[D+0],k[D+1],k[D+2]),q.push(k[P+0],k[P+1],k[P+2])},addFaceNormal:function(N,D,P){const k=this.vertices,q=this.object.geometry.normals;b.fromArray(k,N),v.fromArray(k,D),_.fromArray(k,P),E.subVectors(_,v),T.subVectors(b,v),E.cross(T),E.normalize(),q.push(E.x,E.y,E.z),q.push(E.x,E.y,E.z),q.push(E.x,E.y,E.z)},addColor:function(N,D,P){const k=this.colors,q=this.object.geometry.colors;k[N]!==void 0&&q.push(k[N+0],k[N+1],k[N+2]),k[D]!==void 0&&q.push(k[D+0],k[D+1],k[D+2]),k[P]!==void 0&&q.push(k[P+0],k[P+1],k[P+2])},addUV:function(N,D,P){const k=this.uvs,q=this.object.geometry.uvs;q.push(k[N+0],k[N+1]),q.push(k[D+0],k[D+1]),q.push(k[P+0],k[P+1])},addDefaultUV:function(){const N=this.object.geometry.uvs;N.push(0,0),N.push(0,0),N.push(0,0)},addUVLine:function(N){const D=this.uvs;this.object.geometry.uvs.push(D[N+0],D[N+1])},addFace:function(N,D,P,k,q,V,j,Q,W){const G=this.vertices.length;let z=this.parseVertexIndex(N,G),te=this.parseVertexIndex(D,G),Y=this.parseVertexIndex(P,G);if(this.addVertex(z,te,Y),this.addColor(z,te,Y),j!==void 0&&j!==""){const se=this.normals.length;z=this.parseNormalIndex(j,se),te=this.parseNormalIndex(Q,se),Y=this.parseNormalIndex(W,se),this.addNormal(z,te,Y)}else this.addFaceNormal(z,te,Y);if(k!==void 0&&k!==""){const se=this.uvs.length;z=this.parseUVIndex(k,se),te=this.parseUVIndex(q,se),Y=this.parseUVIndex(V,se),this.addUV(z,te,Y),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(N){this.object.geometry.type="Points";const D=this.vertices.length;for(let P=0,k=N.length;P<k;P++){const q=this.parseVertexIndex(N[P],D);this.addVertexPoint(q),this.addColor(q)}},addLineGeometry:function(N,D){this.object.geometry.type="Line";const P=this.vertices.length,k=this.uvs.length;for(let q=0,V=N.length;q<V;q++)this.addVertexLine(this.parseVertexIndex(N[q],P));for(let q=0,V=D.length;q<V;q++)this.addUVLine(this.parseUVIndex(D[q],k))}};return I.startObject("",!1),I}class B extends h.Loader{constructor(N){super(N),this.materials=null}load(N,D,P,k){const q=this,V=new h.FileLoader(this.manager);V.setPath(this.path),V.setRequestHeader(this.requestHeader),V.setWithCredentials(this.withCredentials),V.load(N,function(j){try{D(q.parse(j))}catch(Q){k?k(Q):console.error(Q),q.manager.itemError(N)}},P,k)}setMaterials(N){return this.materials=N,this}parse(N){const D=new R;N.indexOf(`\r
`)!==-1&&(N=N.replace(/\r\n/g,`
`)),N.indexOf(`\\
`)!==-1&&(N=N.replace(/\\\n/g,""));const P=N.split(`
`);let k=[];for(let V=0,j=P.length;V<j;V++){const Q=P[V].trimStart();if(Q.length===0)continue;const W=Q.charAt(0);if(W!=="#")if(W==="v"){const G=Q.split(y);switch(G[0]){case"v":D.vertices.push(parseFloat(G[1]),parseFloat(G[2]),parseFloat(G[3])),G.length>=7?(C.setRGB(parseFloat(G[4]),parseFloat(G[5]),parseFloat(G[6])).convertSRGBToLinear(),D.colors.push(C.r,C.g,C.b)):D.colors.push(void 0,void 0,void 0);break;case"vn":D.normals.push(parseFloat(G[1]),parseFloat(G[2]),parseFloat(G[3]));break;case"vt":D.uvs.push(parseFloat(G[1]),parseFloat(G[2]));break}}else if(W==="f"){const G=Q.slice(1).trim().split(y),z=[];for(let Y=0,se=G.length;Y<se;Y++){const ve=G[Y];if(ve.length>0){const Ae=ve.split("/");z.push(Ae)}}const te=z[0];for(let Y=1,se=z.length-1;Y<se;Y++){const ve=z[Y],Ae=z[Y+1];D.addFace(te[0],ve[0],Ae[0],te[1],ve[1],Ae[1],te[2],ve[2],Ae[2])}}else if(W==="l"){const G=Q.substring(1).trim().split(" ");let z=[];const te=[];if(Q.indexOf("/")===-1)z=G;else for(let Y=0,se=G.length;Y<se;Y++){const ve=G[Y].split("/");ve[0]!==""&&z.push(ve[0]),ve[1]!==""&&te.push(ve[1])}D.addLineGeometry(z,te)}else if(W==="p"){const G=Q.slice(1).trim().split(" ");D.addPointGeometry(G)}else if((k=p.exec(Q))!==null){const G=(" "+k[0].slice(1).trim()).slice(1);D.startObject(G)}else if(g.test(Q))D.object.startMaterial(Q.substring(7).trim(),D.materialLibraries);else if(f.test(Q))D.materialLibraries.push(Q.substring(7).trim());else if(m.test(Q))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(W==="s"){if(k=Q.split(" "),k.length>1){const z=k[1].trim().toLowerCase();D.object.smooth=z!=="0"&&z!=="off"}else D.object.smooth=!0;const G=D.object.currentMaterial();G&&(G.smooth=D.object.smooth)}else{if(Q==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+Q+'"')}}D.finalize();const q=new h.Group;if(q.materialLibraries=[].concat(D.materialLibraries),!(D.objects.length===1&&D.objects[0].geometry.vertices.length===0))for(let V=0,j=D.objects.length;V<j;V++){const Q=D.objects[V],W=Q.geometry,G=Q.materials,z=W.type==="Line",te=W.type==="Points";let Y=!1;if(W.vertices.length===0)continue;const se=new h.BufferGeometry;se.setAttribute("position",new h.Float32BufferAttribute(W.vertices,3)),W.normals.length>0&&se.setAttribute("normal",new h.Float32BufferAttribute(W.normals,3)),W.colors.length>0&&(Y=!0,se.setAttribute("color",new h.Float32BufferAttribute(W.colors,3))),W.hasUVIndices===!0&&se.setAttribute("uv",new h.Float32BufferAttribute(W.uvs,2));const ve=[];for(let me=0,Oe=G.length;me<Oe;me++){const Xe=G[me],Je=Xe.name+"_"+Xe.smooth+"_"+Y;let it=D.materials[Je];if(this.materials!==null){if(it=this.materials.create(Xe.name),z&&it&&!(it instanceof h.LineBasicMaterial)){const dt=new h.LineBasicMaterial;h.Material.prototype.copy.call(dt,it),dt.color.copy(it.color),it=dt}else if(te&&it&&!(it instanceof h.PointsMaterial)){const dt=new h.PointsMaterial({size:10,sizeAttenuation:!1});h.Material.prototype.copy.call(dt,it),dt.color.copy(it.color),dt.map=it.map,it=dt}}it===void 0&&(z?it=new h.LineBasicMaterial:te?it=new h.PointsMaterial({size:1,sizeAttenuation:!1}):it=new h.MeshPhongMaterial,it.name=Xe.name,it.flatShading=!Xe.smooth,it.vertexColors=Y,D.materials[Je]=it),ve.push(it)}let Ae;if(ve.length>1){for(let me=0,Oe=G.length;me<Oe;me++){const Xe=G[me];se.addGroup(Xe.groupStart,Xe.groupCount,me)}z?Ae=new h.LineSegments(se,ve):te?Ae=new h.Points(se,ve):Ae=new h.Mesh(se,ve)}else z?Ae=new h.LineSegments(se,ve[0]):te?Ae=new h.Points(se,ve[0]):Ae=new h.Mesh(se,ve[0]);Ae.name=Q.name,q.add(Ae)}else if(D.vertices.length>0){const V=new h.PointsMaterial({size:1,sizeAttenuation:!1}),j=new h.BufferGeometry;j.setAttribute("position",new h.Float32BufferAttribute(D.vertices,3)),D.colors.length>0&&D.colors[0]!==void 0&&(j.setAttribute("color",new h.Float32BufferAttribute(D.colors,3)),V.vertexColors=!0);const Q=new h.Points(j,V);q.add(Q)}return q}}},"./node_modules/three/examples/jsm/math/OBB.js":(l,u,c)=>{c.r(u),c.d(u,{OBB:()=>P});var h=c("./node_modules/three/build/three.module.js");const p={c:null,u:[new h.Vector3,new h.Vector3,new h.Vector3],e:[]},f={c:null,u:[new h.Vector3,new h.Vector3,new h.Vector3],e:[]},g=[[],[],[]],m=[[],[],[]],y=[],b=new h.Vector3,v=new h.Vector3,_=new h.Vector3,T=new h.Vector3,E=new h.Vector3,C=new h.Vector3,R=new h.Matrix3,B=new h.Box3,I=new h.Matrix4,N=new h.Matrix4,D=new h.Ray;class P{constructor(V=new h.Vector3,j=new h.Vector3,Q=new h.Matrix3){this.center=V,this.halfSize=j,this.rotation=Q}set(V,j,Q){return this.center=V,this.halfSize=j,this.rotation=Q,this}copy(V){return this.center.copy(V.center),this.halfSize.copy(V.halfSize),this.rotation.copy(V.rotation),this}clone(){return new this.constructor().copy(this)}getSize(V){return V.copy(this.halfSize).multiplyScalar(2)}clampPoint(V,j){const Q=this.halfSize;T.subVectors(V,this.center),this.rotation.extractBasis(b,v,_),j.copy(this.center);const W=h.MathUtils.clamp(T.dot(b),-Q.x,Q.x);j.add(b.multiplyScalar(W));const G=h.MathUtils.clamp(T.dot(v),-Q.y,Q.y);j.add(v.multiplyScalar(G));const z=h.MathUtils.clamp(T.dot(_),-Q.z,Q.z);return j.add(_.multiplyScalar(z)),j}containsPoint(V){return T.subVectors(V,this.center),this.rotation.extractBasis(b,v,_),Math.abs(T.dot(b))<=this.halfSize.x&&Math.abs(T.dot(v))<=this.halfSize.y&&Math.abs(T.dot(_))<=this.halfSize.z}intersectsBox3(V){return this.intersectsOBB(k.fromBox3(V))}intersectsSphere(V){return this.clampPoint(V.center,C),C.distanceToSquared(V.center)<=V.radius*V.radius}intersectsOBB(V,j=Number.EPSILON){p.c=this.center,p.e[0]=this.halfSize.x,p.e[1]=this.halfSize.y,p.e[2]=this.halfSize.z,this.rotation.extractBasis(p.u[0],p.u[1],p.u[2]),f.c=V.center,f.e[0]=V.halfSize.x,f.e[1]=V.halfSize.y,f.e[2]=V.halfSize.z,V.rotation.extractBasis(f.u[0],f.u[1],f.u[2]);for(let G=0;G<3;G++)for(let z=0;z<3;z++)g[G][z]=p.u[G].dot(f.u[z]);T.subVectors(f.c,p.c),y[0]=T.dot(p.u[0]),y[1]=T.dot(p.u[1]),y[2]=T.dot(p.u[2]);for(let G=0;G<3;G++)for(let z=0;z<3;z++)m[G][z]=Math.abs(g[G][z])+j;let Q,W;for(let G=0;G<3;G++)if(Q=p.e[G],W=f.e[0]*m[G][0]+f.e[1]*m[G][1]+f.e[2]*m[G][2],Math.abs(y[G])>Q+W)return!1;for(let G=0;G<3;G++)if(Q=p.e[0]*m[0][G]+p.e[1]*m[1][G]+p.e[2]*m[2][G],W=f.e[G],Math.abs(y[0]*g[0][G]+y[1]*g[1][G]+y[2]*g[2][G])>Q+W)return!1;return Q=p.e[1]*m[2][0]+p.e[2]*m[1][0],W=f.e[1]*m[0][2]+f.e[2]*m[0][1],!(Math.abs(y[2]*g[1][0]-y[1]*g[2][0])>Q+W||(Q=p.e[1]*m[2][1]+p.e[2]*m[1][1],W=f.e[0]*m[0][2]+f.e[2]*m[0][0],Math.abs(y[2]*g[1][1]-y[1]*g[2][1])>Q+W)||(Q=p.e[1]*m[2][2]+p.e[2]*m[1][2],W=f.e[0]*m[0][1]+f.e[1]*m[0][0],Math.abs(y[2]*g[1][2]-y[1]*g[2][2])>Q+W)||(Q=p.e[0]*m[2][0]+p.e[2]*m[0][0],W=f.e[1]*m[1][2]+f.e[2]*m[1][1],Math.abs(y[0]*g[2][0]-y[2]*g[0][0])>Q+W)||(Q=p.e[0]*m[2][1]+p.e[2]*m[0][1],W=f.e[0]*m[1][2]+f.e[2]*m[1][0],Math.abs(y[0]*g[2][1]-y[2]*g[0][1])>Q+W)||(Q=p.e[0]*m[2][2]+p.e[2]*m[0][2],W=f.e[0]*m[1][1]+f.e[1]*m[1][0],Math.abs(y[0]*g[2][2]-y[2]*g[0][2])>Q+W)||(Q=p.e[0]*m[1][0]+p.e[1]*m[0][0],W=f.e[1]*m[2][2]+f.e[2]*m[2][1],Math.abs(y[1]*g[0][0]-y[0]*g[1][0])>Q+W)||(Q=p.e[0]*m[1][1]+p.e[1]*m[0][1],W=f.e[0]*m[2][2]+f.e[2]*m[2][0],Math.abs(y[1]*g[0][1]-y[0]*g[1][1])>Q+W)||(Q=p.e[0]*m[1][2]+p.e[1]*m[0][2],W=f.e[0]*m[2][1]+f.e[1]*m[2][0],Math.abs(y[1]*g[0][2]-y[0]*g[1][2])>Q+W))}intersectsPlane(V){this.rotation.extractBasis(b,v,_);const j=this.halfSize.x*Math.abs(V.normal.dot(b))+this.halfSize.y*Math.abs(V.normal.dot(v))+this.halfSize.z*Math.abs(V.normal.dot(_)),Q=V.normal.dot(this.center)-V.constant;return Math.abs(Q)<=j}intersectRay(V,j){return this.getSize(E),B.setFromCenterAndSize(T.set(0,0,0),E),I.setFromMatrix3(this.rotation),I.setPosition(this.center),N.copy(I).invert(),D.copy(V).applyMatrix4(N),D.intersectBox(B,j)?j.applyMatrix4(I):null}intersectsRay(V){return this.intersectRay(V,T)!==null}fromBox3(V){return V.getCenter(this.center),V.getSize(this.halfSize).multiplyScalar(.5),this.rotation.identity(),this}equals(V){return V.center.equals(this.center)&&V.halfSize.equals(this.halfSize)&&V.rotation.equals(this.rotation)}applyMatrix4(V){const j=V.elements;let Q=T.set(j[0],j[1],j[2]).length();const W=T.set(j[4],j[5],j[6]).length(),G=T.set(j[8],j[9],j[10]).length();V.determinant()<0&&(Q=-Q),R.setFromMatrix4(V);const z=1/Q,te=1/W,Y=1/G;return R.elements[0]*=z,R.elements[1]*=z,R.elements[2]*=z,R.elements[3]*=te,R.elements[4]*=te,R.elements[5]*=te,R.elements[6]*=Y,R.elements[7]*=Y,R.elements[8]*=Y,this.rotation.multiply(R),this.halfSize.x*=Q,this.halfSize.y*=W,this.halfSize.z*=G,T.setFromMatrixPosition(V),this.center.add(T),this}}const k=new P},"./node_modules/three/examples/jsm/utils/BufferGeometryUtils.js":(l,u,c)=>{c.r(u),c.d(u,{computeMikkTSpaceTangents:()=>p,computeMorphedAttributes:()=>C,deepCloneAttribute:()=>m,deinterleaveAttribute:()=>b,deinterleaveGeometry:()=>v,estimateBytesUsed:()=>_,interleaveAttributes:()=>y,mergeAttributes:()=>g,mergeGeometries:()=>f,mergeGroups:()=>R,mergeVertices:()=>T,toCreasedNormals:()=>B,toTrianglesDrawMode:()=>E});var h=c("./node_modules/three/build/three.module.js");function p(I,N,D=!0){if(!N||!N.isReady)throw new Error("BufferGeometryUtils: Initialized MikkTSpace library required.");if(!I.hasAttribute("position")||!I.hasAttribute("normal")||!I.hasAttribute("uv"))throw new Error('BufferGeometryUtils: Tangents require "position", "normal", and "uv" attributes.');function P(V){if(V.normalized||V.isInterleavedBufferAttribute){const j=new Float32Array(V.count*V.itemSize);for(let Q=0,W=0;Q<V.count;Q++)j[W++]=V.getX(Q),j[W++]=V.getY(Q),V.itemSize>2&&(j[W++]=V.getZ(Q));return j}return V.array instanceof Float32Array?V.array:new Float32Array(V.array)}const k=I.index?I.toNonIndexed():I,q=N.generateTangents(P(k.attributes.position),P(k.attributes.normal),P(k.attributes.uv));if(D)for(let V=3;V<q.length;V+=4)q[V]*=-1;return k.setAttribute("tangent",new h.BufferAttribute(q,4)),I!==k&&I.copy(k),I}function f(I,N=!1){const D=I[0].index!==null,P=new Set(Object.keys(I[0].attributes)),k=new Set(Object.keys(I[0].morphAttributes)),q={},V={},j=I[0].morphTargetsRelative,Q=new h.BufferGeometry;let W=0;for(let G=0;G<I.length;++G){const z=I[G];let te=0;if(D!==(z.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+G+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const Y in z.attributes){if(!P.has(Y))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+G+'. All geometries must have compatible attributes; make sure "'+Y+'" attribute exists among all geometries, or in none of them.'),null;q[Y]===void 0&&(q[Y]=[]),q[Y].push(z.attributes[Y]),te++}if(te!==P.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+G+". Make sure all geometries have the same number of attributes."),null;if(j!==z.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+G+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const Y in z.morphAttributes){if(!k.has(Y))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+G+".  .morphAttributes must be consistent throughout all geometries."),null;V[Y]===void 0&&(V[Y]=[]),V[Y].push(z.morphAttributes[Y])}if(N){let Y;if(D)Y=z.index.count;else if(z.attributes.position!==void 0)Y=z.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+G+". The geometry must have either an index or a position attribute"),null;Q.addGroup(W,Y,G),W+=Y}}if(D){let G=0;const z=[];for(let te=0;te<I.length;++te){const Y=I[te].index;for(let se=0;se<Y.count;++se)z.push(Y.getX(se)+G);G+=I[te].attributes.position.count}Q.setIndex(z)}for(const G in q){const z=g(q[G]);if(!z)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+G+" attribute."),null;Q.setAttribute(G,z)}for(const G in V){const z=V[G][0].length;if(z===0)break;Q.morphAttributes=Q.morphAttributes||{},Q.morphAttributes[G]=[];for(let te=0;te<z;++te){const Y=[];for(let ve=0;ve<V[G].length;++ve)Y.push(V[G][ve][te]);const se=g(Y);if(!se)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+G+" morphAttribute."),null;Q.morphAttributes[G].push(se)}}return Q}function g(I){let N,D,P,k=-1,q=0;for(let W=0;W<I.length;++W){const G=I[W];if(N===void 0&&(N=G.array.constructor),N!==G.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(D===void 0&&(D=G.itemSize),D!==G.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(P===void 0&&(P=G.normalized),P!==G.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(k===-1&&(k=G.gpuType),k!==G.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;q+=G.count*D}const V=new N(q),j=new h.BufferAttribute(V,D,P);let Q=0;for(let W=0;W<I.length;++W){const G=I[W];if(G.isInterleavedBufferAttribute){const z=Q/D;for(let te=0,Y=G.count;te<Y;te++)for(let se=0;se<D;se++){const ve=G.getComponent(te,se);j.setComponent(te+z,se,ve)}}else V.set(G.array,Q);Q+=G.count*D}return k!==void 0&&(j.gpuType=k),j}function m(I){return I.isInstancedInterleavedBufferAttribute||I.isInterleavedBufferAttribute?b(I):I.isInstancedBufferAttribute?new h.InstancedBufferAttribute().copy(I):new h.BufferAttribute().copy(I)}function y(I){let N,D=0,P=0;for(let W=0,G=I.length;W<G;++W){const z=I[W];if(N===void 0&&(N=z.array.constructor),N!==z.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;D+=z.array.length,P+=z.itemSize}const k=new h.InterleavedBuffer(new N(D),P);let q=0;const V=[],j=["getX","getY","getZ","getW"],Q=["setX","setY","setZ","setW"];for(let W=0,G=I.length;W<G;W++){const z=I[W],te=z.itemSize,Y=z.count,se=new h.InterleavedBufferAttribute(k,te,q,z.normalized);V.push(se),q+=te;for(let ve=0;ve<Y;ve++)for(let Ae=0;Ae<te;Ae++)se[Q[Ae]](ve,z[j[Ae]](ve))}return V}function b(I){const N=I.data.array.constructor,D=I.count,P=I.itemSize,k=I.normalized,q=new N(D*P);let V;I.isInstancedInterleavedBufferAttribute?V=new h.InstancedBufferAttribute(q,P,k,I.meshPerAttribute):V=new h.BufferAttribute(q,P,k);for(let j=0;j<D;j++)V.setX(j,I.getX(j)),P>=2&&V.setY(j,I.getY(j)),P>=3&&V.setZ(j,I.getZ(j)),P>=4&&V.setW(j,I.getW(j));return V}function v(I){const N=I.attributes,D=I.morphTargets,P=new Map;for(const k in N){const q=N[k];q.isInterleavedBufferAttribute&&(P.has(q)||P.set(q,b(q)),N[k]=P.get(q))}for(const k in D){const q=D[k];q.isInterleavedBufferAttribute&&(P.has(q)||P.set(q,b(q)),D[k]=P.get(q))}}function _(I){let N=0;for(const P in I.attributes){const k=I.getAttribute(P);N+=k.count*k.itemSize*k.array.BYTES_PER_ELEMENT}const D=I.getIndex();return N+=D?D.count*D.itemSize*D.array.BYTES_PER_ELEMENT:0,N}function T(I,N=1e-4){N=Math.max(N,Number.EPSILON);const D={},P=I.getIndex(),k=I.getAttribute("position"),q=P?P.count:k.count;let V=0;const j=Object.keys(I.attributes),Q={},W={},G=[],z=["getX","getY","getZ","getW"],te=["setX","setY","setZ","setW"];for(let Oe=0,Xe=j.length;Oe<Xe;Oe++){const Je=j[Oe],it=I.attributes[Je];Q[Je]=new h.BufferAttribute(new it.array.constructor(it.count*it.itemSize),it.itemSize,it.normalized);const dt=I.morphAttributes[Je];dt&&(W[Je]=new h.BufferAttribute(new dt.array.constructor(dt.count*dt.itemSize),dt.itemSize,dt.normalized))}const Y=N*.5,se=Math.log10(1/N),ve=Math.pow(10,se),Ae=Y*ve;for(let Oe=0;Oe<q;Oe++){const Xe=P?P.getX(Oe):Oe;let Je="";for(let it=0,dt=j.length;it<dt;it++){const St=j[it],Qt=I.getAttribute(St),yt=Qt.itemSize;for(let bi=0;bi<yt;bi++)Je+=`${~~(Qt[z[bi]](Xe)*ve+Ae)},`}if(Je in D)G.push(D[Je]);else{for(let it=0,dt=j.length;it<dt;it++){const St=j[it],Qt=I.getAttribute(St),yt=I.morphAttributes[St],bi=Qt.itemSize,$e=Q[St],Fi=W[St];for(let ui=0;ui<bi;ui++){const Si=z[ui],Ei=te[ui];if($e[Ei](V,Qt[Si](Xe)),yt)for(let Zi=0,Vi=yt.length;Zi<Vi;Zi++)Fi[Zi][Ei](V,yt[Zi][Si](Xe))}}D[Je]=V,G.push(V),V++}}const me=I.clone();for(const Oe in I.attributes){const Xe=Q[Oe];if(me.setAttribute(Oe,new h.BufferAttribute(Xe.array.slice(0,V*Xe.itemSize),Xe.itemSize,Xe.normalized)),Oe in W)for(let Je=0;Je<W[Oe].length;Je++){const it=W[Oe][Je];me.morphAttributes[Oe][Je]=new h.BufferAttribute(it.array.slice(0,V*it.itemSize),it.itemSize,it.normalized)}}return me.setIndex(G),me}function E(I,N){if(N===h.TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),I;if(N===h.TriangleFanDrawMode||N===h.TriangleStripDrawMode){let D=I.getIndex();if(D===null){const V=[],j=I.getAttribute("position");if(j!==void 0){for(let Q=0;Q<j.count;Q++)V.push(Q);I.setIndex(V),D=I.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),I}const P=D.count-2,k=[];if(N===h.TriangleFanDrawMode)for(let V=1;V<=P;V++)k.push(D.getX(0)),k.push(D.getX(V)),k.push(D.getX(V+1));else for(let V=0;V<P;V++)V%2===0?(k.push(D.getX(V)),k.push(D.getX(V+1)),k.push(D.getX(V+2))):(k.push(D.getX(V+2)),k.push(D.getX(V+1)),k.push(D.getX(V)));k.length/3!==P&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const q=I.clone();return q.setIndex(k),q.clearGroups(),q}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",N),I}function C(I){const N=new h.Vector3,D=new h.Vector3,P=new h.Vector3,k=new h.Vector3,q=new h.Vector3,V=new h.Vector3,j=new h.Vector3,Q=new h.Vector3,W=new h.Vector3;function G(Ce,At,Ot,Zt,jt,xi,vt,ge){N.fromBufferAttribute(At,jt),D.fromBufferAttribute(At,xi),P.fromBufferAttribute(At,vt);const be=Ce.morphTargetInfluences;if(Ot&&be){j.set(0,0,0),Q.set(0,0,0),W.set(0,0,0);for(let Ne=0,Se=Ot.length;Ne<Se;Ne++){const Fe=be[Ne],Ie=Ot[Ne];Fe!==0&&(k.fromBufferAttribute(Ie,jt),q.fromBufferAttribute(Ie,xi),V.fromBufferAttribute(Ie,vt),Zt?(j.addScaledVector(k,Fe),Q.addScaledVector(q,Fe),W.addScaledVector(V,Fe)):(j.addScaledVector(k.sub(N),Fe),Q.addScaledVector(q.sub(D),Fe),W.addScaledVector(V.sub(P),Fe)))}N.add(j),D.add(Q),P.add(W)}Ce.isSkinnedMesh&&(Ce.applyBoneTransform(jt,N),Ce.applyBoneTransform(xi,D),Ce.applyBoneTransform(vt,P)),ge[jt*3+0]=N.x,ge[jt*3+1]=N.y,ge[jt*3+2]=N.z,ge[xi*3+0]=D.x,ge[xi*3+1]=D.y,ge[xi*3+2]=D.z,ge[vt*3+0]=P.x,ge[vt*3+1]=P.y,ge[vt*3+2]=P.z}const z=I.geometry,te=I.material;let Y,se,ve;const Ae=z.index,me=z.attributes.position,Oe=z.morphAttributes.position,Xe=z.morphTargetsRelative,Je=z.attributes.normal,it=z.morphAttributes.position,dt=z.groups,St=z.drawRange;let Qt,yt,bi,$e,Fi,ui,Si;const Ei=new Float32Array(me.count*me.itemSize),Zi=new Float32Array(Je.count*Je.itemSize);if(Ae!==null)if(Array.isArray(te))for(Qt=0,bi=dt.length;Qt<bi;Qt++)for(Fi=dt[Qt],ui=Math.max(Fi.start,St.start),Si=Math.min(Fi.start+Fi.count,St.start+St.count),yt=ui,$e=Si;yt<$e;yt+=3)Y=Ae.getX(yt),se=Ae.getX(yt+1),ve=Ae.getX(yt+2),G(I,me,Oe,Xe,Y,se,ve,Ei),G(I,Je,it,Xe,Y,se,ve,Zi);else for(ui=Math.max(0,St.start),Si=Math.min(Ae.count,St.start+St.count),Qt=ui,bi=Si;Qt<bi;Qt+=3)Y=Ae.getX(Qt),se=Ae.getX(Qt+1),ve=Ae.getX(Qt+2),G(I,me,Oe,Xe,Y,se,ve,Ei),G(I,Je,it,Xe,Y,se,ve,Zi);else if(Array.isArray(te))for(Qt=0,bi=dt.length;Qt<bi;Qt++)for(Fi=dt[Qt],ui=Math.max(Fi.start,St.start),Si=Math.min(Fi.start+Fi.count,St.start+St.count),yt=ui,$e=Si;yt<$e;yt+=3)Y=yt,se=yt+1,ve=yt+2,G(I,me,Oe,Xe,Y,se,ve,Ei),G(I,Je,it,Xe,Y,se,ve,Zi);else for(ui=Math.max(0,St.start),Si=Math.min(me.count,St.start+St.count),Qt=ui,bi=Si;Qt<bi;Qt+=3)Y=Qt,se=Qt+1,ve=Qt+2,G(I,me,Oe,Xe,Y,se,ve,Ei),G(I,Je,it,Xe,Y,se,ve,Zi);const Vi=new h.Float32BufferAttribute(Ei,3),We=new h.Float32BufferAttribute(Zi,3);return{positionAttribute:me,normalAttribute:Je,morphedPositionAttribute:Vi,morphedNormalAttribute:We}}function R(I){if(I.groups.length===0)return console.warn("THREE.BufferGeometryUtils.mergeGroups(): No groups are defined. Nothing to merge."),I;let N=I.groups;if(N=N.sort((V,j)=>V.materialIndex!==j.materialIndex?V.materialIndex-j.materialIndex:V.start-j.start),I.getIndex()===null){const V=I.getAttribute("position"),j=[];for(let Q=0;Q<V.count;Q+=3)j.push(Q,Q+1,Q+2);I.setIndex(j)}const D=I.getIndex(),P=[];for(let V=0;V<N.length;V++){const j=N[V],Q=j.start,W=Q+j.count;for(let G=Q;G<W;G++)P.push(D.getX(G))}I.dispose(),I.setIndex(P);let k=0;for(let V=0;V<N.length;V++){const j=N[V];j.start=k,k+=j.count}let q=N[0];I.groups=[q];for(let V=1;V<N.length;V++){const j=N[V];q.materialIndex===j.materialIndex?q.count+=j.count:(q=j,I.groups.push(q))}return I}function B(I,N=Math.PI/3){const D=Math.cos(N),P=(1+1e-10)*100,k=[new h.Vector3,new h.Vector3,new h.Vector3],q=new h.Vector3,V=new h.Vector3,j=new h.Vector3,Q=new h.Vector3;function W(ve){const Ae=~~(ve.x*P),me=~~(ve.y*P),Oe=~~(ve.z*P);return`${Ae},${me},${Oe}`}const G=I.index?I.toNonIndexed():I,z=G.attributes.position,te={};for(let ve=0,Ae=z.count/3;ve<Ae;ve++){const me=3*ve,Oe=k[0].fromBufferAttribute(z,me+0),Xe=k[1].fromBufferAttribute(z,me+1),Je=k[2].fromBufferAttribute(z,me+2);q.subVectors(Je,Xe),V.subVectors(Oe,Xe);const it=new h.Vector3().crossVectors(q,V).normalize();for(let dt=0;dt<3;dt++){const St=k[dt],Qt=W(St);Qt in te||(te[Qt]=[]),te[Qt].push(it)}}const Y=new Float32Array(z.count*3),se=new h.BufferAttribute(Y,3,!1);for(let ve=0,Ae=z.count/3;ve<Ae;ve++){const me=3*ve,Oe=k[0].fromBufferAttribute(z,me+0),Xe=k[1].fromBufferAttribute(z,me+1),Je=k[2].fromBufferAttribute(z,me+2);q.subVectors(Je,Xe),V.subVectors(Oe,Xe),j.crossVectors(q,V).normalize();for(let it=0;it<3;it++){const dt=k[it],St=W(dt),Qt=te[St];Q.set(0,0,0);for(let yt=0,bi=Qt.length;yt<bi;yt++){const $e=Qt[yt];j.dot($e)>D&&Q.add($e)}Q.normalize(),se.setXYZ(me+it,Q.x,Q.y,Q.z)}}return G.setAttribute("normal",se),G}},"./node_modules/three/examples/jsm/utils/WorkerPool.js":(l,u,c)=>{c.r(u),c.d(u,{WorkerPool:()=>h});class h{constructor(f=4){this.pool=f,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(f){if(!this.workers[f]){const g=this.workerCreator();g.addEventListener("message",this._onMessage.bind(this,f)),this.workers[f]=g}}_getIdleWorker(){for(let f=0;f<this.pool;f++)if(!(this.workerStatus&1<<f))return f;return-1}_onMessage(f,g){const m=this.workersResolve[f];if(m&&m(g),this.queue.length){const{resolve:y,msg:b,transfer:v}=this.queue.shift();this.workersResolve[f]=y,this.workers[f].postMessage(b,v)}else this.workerStatus^=1<<f}setWorkerCreator(f){this.workerCreator=f}setWorkerLimit(f){this.pool=f}postMessage(f,g){return new Promise(m=>{const y=this._getIdleWorker();y!==-1?(this._initWorker(y),this.workerStatus|=1<<y,this.workersResolve[y]=m,this.workers[y].postMessage(f,g)):this.queue.push({resolve:m,msg:f,transfer:g})})}dispose(){this.workers.forEach(f=>f.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}},"./src/lib/three.mjs":(l,u,c)=>{c.r(u),c.d(u,{default:()=>E});var h=c("./node_modules/three/build/three.module.js"),p=c("./node_modules/three/examples/jsm/loaders/DRACOLoader.js"),f=c("./node_modules/three/examples/jsm/loaders/GLTFLoader.js"),g=c("./node_modules/three/examples/jsm/loaders/KTX2Loader.js"),m=c("./node_modules/three/examples/jsm/math/OBB.js"),y=c("./node_modules/three/examples/jsm/loaders/OBJLoader.js"),b=c("./node_modules/three/examples/jsm/loaders/MTLLoader.js"),v=c("./node_modules/three/examples/jsm/utils/BufferGeometryUtils.js"),_=c("./node_modules/three/examples/jsm/lights/LightProbeGenerator.js"),T={...h};T.DRACOLoader=p.DRACOLoader,T.GLTFLoader=f.GLTFLoader,T.KTX2Loader=g.KTX2Loader,T.OBJLoader=y.OBJLoader,T.MTLLoader=b.MTLLoader,T.OBB=m.OBB,T.BufferGeometryUtils=v,T.LightProbeGenerator=_.LightProbeGenerator;const E=T},"./package.json":l=>{l.exports=JSON.parse('{"name":"aframe","version":"1.6.0","description":"A web framework for building virtual reality experiences.","homepage":"https://aframe.io/","main":"dist/aframe-master.js","scripts":{"dev":"cross-env INSPECTOR_VERSION=dev webpack serve --port 8080","dist":"node scripts/updateVersionLog.js && npm run dist:min && npm run dist:max","dist:max":"webpack --config webpack.config.js","dist:min":"webpack --config webpack.prod.config.js","docs":"markserv --dir docs --port 9001","preghpages":"node ./scripts/preghpages.js","ghpages":"ghpages -p gh-pages/","lint":"standardx -v | snazzy","lint:fix":"standardx --fix","precommit":"npm run lint","prepush":"node scripts/testOnlyCheck.js","prerelease":"node scripts/release.js 1.5.0 1.6.0","start":"npm run dev","start:https":"npm run dev -- --server-type https","test":"karma start ./tests/karma.conf.js","test:docs":"node scripts/docsLint.js","test:firefox":"npm test -- --browsers Firefox","test:chrome":"npm test -- --browsers Chrome","test:nobrowser":"NO_BROWSER=true npm test","test:node":"node --experimental-require-module ./node_modules/mocha/bin/mocha --ui tdd tests/node"},"repository":"aframevr/aframe","license":"MIT","files":["dist/*","docs/**/*","src/**/*","vendor/**/*"],"dependencies":{"buffer":"^6.0.3","debug":"^4.3.4","deep-assign":"^2.0.0","load-bmfont":"^1.2.3","super-animejs":"^3.1.0","three":"npm:super-three@0.164.0","three-bmfont-text":"dmarcos/three-bmfont-text#eed4878795be9b3e38cf6aec6b903f56acd1f695","webvr-polyfill":"^0.10.12"},"devDependencies":{"@babel/core":"^7.17.10","babel-loader":"^8.2.5","babel-plugin-istanbul":"^6.1.1","chai":"^4.3.6","chai-shallow-deep-equal":"^1.4.0","chalk":"^1.1.3","cross-env":"^7.0.3","css-loader":"^6.7.1","eslint":"^8.45.0","eslint-config-semistandard":"^17.0.0","eslint-config-standard-jsx":"^11.0.0","ghpages":"0.0.8","git-rev":"^0.2.1","glob":"^8.0.3","husky":"^0.11.7","jsdom":"^24.0.0","jsdom-global":"^3.0.2","karma":"^6.4.0","karma-chai-shallow-deep-equal":"0.0.4","karma-chrome-launcher":"^3.1.1","karma-coverage":"^2.2.0","karma-env-preprocessor":"^0.1.1","karma-firefox-launcher":"^2.1.2","karma-mocha":"^2.0.1","karma-mocha-reporter":"^2.2.5","karma-sinon-chai":"^2.0.2","karma-webpack":"^5.0.0","markserv":"github:sukima/markserv#feature/fix-broken-websoketio-link","mocha":"^10.0.0","replace-in-file":"^2.5.3","shelljs":"^0.7.7","shx":"^0.2.2","sinon":"<12.0.0","sinon-chai":"^3.7.0","snazzy":"^5.0.0","standardx":"^7.0.0","style-loader":"^3.3.1","too-wordy":"ngokevin/too-wordy","webpack":"^5.73.0","webpack-cli":"^4.10.0","webpack-dev-server":"^4.11.0","webpack-merge":"^5.8.0","write-good":"^1.0.8"},"link":true,"standardx":{"ignore":["build/**","dist/**","examples/**/shaders/*.js","**/vendor/**"]},"keywords":["3d","aframe","cardboard","components","oculus","three","three.js","rift","vive","vr","quest","meta","web-components","webvr","webxr"],"engines":{"node":">= 4.6.0","npm":">= 2.15.9"}}')}},n={};function s(l){var u=n[l];if(u!==void 0)return u.exports;var c=n[l]={id:l,exports:{}};return i[l].call(c.exports,c,c.exports,s),c.exports}s.m=i,s.n=l=>{var u=l&&l.__esModule?()=>l.default:()=>l;return s.d(u,{a:u}),u},s.d=(l,u)=>{for(var c in u)s.o(u,c)&&!s.o(l,c)&&Object.defineProperty(l,c,{enumerable:!0,get:u[c]})},s.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),s.o=(l,u)=>Object.prototype.hasOwnProperty.call(l,u),s.r=l=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(l,"__esModule",{value:!0})},s.b=document.baseURI||self.location.href,s.nc=void 0;var o=s("./src/index.js");return o})())})(aQ);const tN=.1;AFRAME.registerComponent("checkpoint-controls",{schema:{enabled:{default:!0},mode:{default:"teleport",oneOf:["teleport","animate"]},animateSpeed:{default:3}},init:function(){this.active=!0,this.checkpoint=null,this.isNavMeshConstrained=!1,this.offset=new THREE.Vector3,this.position=new THREE.Vector3,this.targetPosition=new THREE.Vector3},play:function(){this.active=!0},pause:function(){this.active=!1},setCheckpoint:function(r){const e=this.el;if(this.active&&this.checkpoint!==r){if(this.checkpoint&&e.emit("navigation-end",{checkpoint:this.checkpoint}),this.checkpoint=r,this.sync(),this.position.distanceTo(this.targetPosition)<tN){this.checkpoint=null;return}e.emit("navigation-start",{checkpoint:r}),this.data.mode==="teleport"&&(this.el.setAttribute("position",this.targetPosition),this.checkpoint=null,e.emit("navigation-end",{checkpoint:r}),e.components["movement-controls"].updateNavLocation())}},isVelocityActive:function(){return!!(this.active&&this.checkpoint)},getVelocity:function(){if(!this.active)return;const r=this.data,e=this.offset,i=this.position,n=this.targetPosition,s=this.checkpoint;return this.sync(),i.distanceTo(n)<tN?(this.checkpoint=null,this.el.emit("navigation-end",{checkpoint:s}),e.set(0,0,0)):(e.setLength(r.animateSpeed),e)},sync:function(){const r=this.offset,e=this.position,i=this.targetPosition;e.copy(this.el.getAttribute("position")),this.checkpoint.object3D.getWorldPosition(i),i.add(this.checkpoint.components.checkpoint.getOffset()),r.copy(i).sub(e)}});var oQ=Object.assign(function(){},{FACE_1:0,FACE_2:1,FACE_3:2,FACE_4:3,L_SHOULDER_1:4,R_SHOULDER_1:5,L_SHOULDER_2:6,R_SHOULDER_2:7,SELECT:8,START:9,DPAD_UP:12,DPAD_DOWN:13,DPAD_LEFT:14,DPAD_RIGHT:15,VENDOR:16});function lQ(r,e,i){this.type=r,this.index=e,this.pressed=i.pressed,this.value=i.value}var cQ=lQ;const kf=oQ,h2=cQ,Lh=.2,uu={LEFT:"left",RIGHT:"right"},hu={MOVEMENT:1,ROTATION:2};AFRAME.registerComponent("gamepad-controls",{GamepadButton:kf,schema:{enabled:{default:!0},rotationSensitivity:{default:2}},init:function(){const r=this.el.sceneEl;this.system=r.systems["tracked-controls-webxr"]||{controllers:[]},this.prevTime=window.performance.now(),this.buttons={};const e=this.el.object3D.rotation;this.pitch=new THREE.Object3D,this.pitch.rotation.x=e.x,this.yaw=new THREE.Object3D,this.yaw.position.y=10,this.yaw.rotation.y=e.y,this.yaw.add(this.pitch),this._lookVector=new THREE.Vector2,this._moveVector=new THREE.Vector2,this._dpadVector=new THREE.Vector2,r.addBehavior(this)},update:function(){this.tick()},tick:function(r,e){this.updateButtonState(),this.updateRotation(e)},remove:function(){},isVelocityActive:function(){if(!this.data.enabled||!this.isConnected())return!1;const r=this._dpadVector,e=this._moveVector;this.getDpad(r),this.getJoystick(hu.MOVEMENT,e);const i=r.x||e.x,n=r.y||e.y;return Math.abs(i)>Lh||Math.abs(n)>Lh},getVelocityDelta:function(){const r=this._dpadVector,e=this._moveVector;this.getDpad(r),this.getJoystick(hu.MOVEMENT,e);const i=r.x||e.x,n=r.y||e.y,s=new THREE.Vector3;return Math.abs(i)>Lh&&(s.x+=i),Math.abs(n)>Lh&&(s.z+=n),s},isRotationActive:function(){if(!this.data.enabled||!this.isConnected())return!1;const r=this._lookVector;return this.getJoystick(hu.ROTATION,r),Math.abs(r.x)>Lh||Math.abs(r.y)>Lh},updateRotation:function(r){if(!this.isRotationActive())return;const e=this.data,i=this.yaw,n=this.pitch;i.rotation.y=this.el.object3D.rotation.y,n.rotation.x=this.el.object3D.rotation.x;const s=this._lookVector;this.getJoystick(hu.ROTATION,s),Math.abs(s.x)<=Lh&&(s.x=0),Math.abs(s.y)<=Lh&&(s.y=0),s.multiplyScalar(e.rotationSensitivity*r/1e3),i.rotation.y-=s.x,n.rotation.x-=s.y,n.rotation.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,n.rotation.x)),this.el.object3D.rotation.set(n.rotation.x,i.rotation.y,0)},updateButtonState:function(){const r=this.getGamepad(uu.RIGHT);if(this.data.enabled&&r)for(var e=0;e<r.buttons.length;e++)r.buttons[e].pressed&&!this.buttons[e]?this.emit(new h2("gamepadbuttondown",e,r.buttons[e])):!r.buttons[e].pressed&&this.buttons[e]&&this.emit(new h2("gamepadbuttonup",e,r.buttons[e])),this.buttons[e]=r.buttons[e].pressed;else for(const i in this.buttons)this.buttons[i]=!1},emit:function(r){this.el.emit(r.type,r),this.el.emit(r.type+":"+r.index,new h2(r.type,r.index,r))},getGamepad:function(){const r=[],e=[];return function(i){const n=this.el.sceneEl.components["proxy-controls"],s=n&&n.isConnected()&&n.getGamepad(0);if(s)return s;r.length=0;for(let l=0;l<this.system.controllers.length;l++){const u=this.system.controllers[l],c=u?u.gamepad:null;if(r.push(c),c&&u.handedness===i)return c}const o=navigator.getGamepads?navigator.getGamepads():e;for(let l=0;l<o.length;l++){const u=o[l];if(u&&u.hand===i)return u}return r[0]||o[0]}}(),getButton:function(r){return this.getGamepad(uu.RIGHT).buttons[r]},getAxis:function(r){return this.getGamepad(r>1?uu.RIGHT:uu.LEFT).axes[r]},getJoystick:function(r,e){const i=this.getGamepad(r===hu.MOVEMENT?uu.LEFT:uu.RIGHT);if(!i)return e.set(0,0);if(i.mapping==="xr-standard")switch(r){case hu.MOVEMENT:return e.set(i.axes[2],i.axes[3]);case hu.ROTATION:return e.set(i.axes[2],0)}else switch(r){case hu.MOVEMENT:return e.set(i.axes[0],i.axes[1]);case hu.ROTATION:return e.set(i.axes[2],i.axes[3])}throw new Error('Unexpected joystick index "%d".',r)},getDpad:function(r){const e=this.getGamepad(uu.LEFT);return!e||!e.buttons[kf.DPAD_RIGHT]?r.set(0,0):r.set((e.buttons[kf.DPAD_RIGHT].pressed?1:0)+(e.buttons[kf.DPAD_LEFT].pressed?-1:0),(e.buttons[kf.DPAD_UP].pressed?-1:0)+(e.buttons[kf.DPAD_DOWN].pressed?1:0))},isConnected:function(){const r=this.getGamepad(uu.LEFT);return!!(r&&r.connected)},getID:function(){return this.getGamepad(uu.LEFT).id}}),function(r){var e="KeyboardEvent"in r;e||(r.KeyboardEvent=function(){throw TypeError("Illegal constructor")}),"DOM_KEY_LOCATION_STANDARD"in r.KeyboardEvent||(r.KeyboardEvent.DOM_KEY_LOCATION_STANDARD=0),"DOM_KEY_LOCATION_LEFT"in r.KeyboardEvent||(r.KeyboardEvent.DOM_KEY_LOCATION_LEFT=1),"DOM_KEY_LOCATION_RIGHT"in r.KeyboardEvent||(r.KeyboardEvent.DOM_KEY_LOCATION_RIGHT=2),"DOM_KEY_LOCATION_NUMPAD"in r.KeyboardEvent||(r.KeyboardEvent.DOM_KEY_LOCATION_NUMPAD=3);var i=window.KeyboardEvent.DOM_KEY_LOCATION_STANDARD,n=window.KeyboardEvent.DOM_KEY_LOCATION_LEFT,s=window.KeyboardEvent.DOM_KEY_LOCATION_RIGHT,o=window.KeyboardEvent.DOM_KEY_LOCATION_NUMPAD;function l(R,B){return String(R).indexOf(B)!==-1}var u=function(){return l(navigator.platform,"Win")?"win":l(navigator.platform,"Mac")?"mac":l(navigator.platform,"CrOS")?"cros":l(navigator.platform,"Linux")?"linux":l(navigator.userAgent,"iPad")||l(navigator.platform,"iPod")||l(navigator.platform,"iPhone")?"ios":""}(),c=function(){return l(navigator.userAgent,"Chrome/")?"chrome":l(navigator.vendor,"Apple")?"safari":l(navigator.userAgent,"MSIE")?"ie":l(navigator.userAgent,"Gecko/")?"moz":l(navigator.userAgent,"Opera/")?"opera":""}(),h=c+"-"+u;function p(R,B,I){(h===B||c===B||u===B)&&Object.keys(I).forEach(function(N){R[N]=I[N]})}function f(R,B){var I={};return Object.keys(R).forEach(function(N){var D=R[N];B in D&&(I[D[B]]=D)}),I}var g={3:{code:"Cancel"},6:{code:"Help"},8:{code:"Backspace"},9:{code:"Tab"},12:{code:"Clear"},13:{code:"Enter"},16:{code:"Shift"},17:{code:"Control"},18:{code:"Alt"},19:{code:"Pause"},20:{code:"CapsLock"},21:{code:"KanaMode"},22:{code:"HangulMode"},23:{code:"JunjaMode"},24:{code:"FinalMode"},25:{code:"KanjiMode"},27:{code:"Escape"},28:{code:"Convert"},29:{code:"NonConvert"},30:{code:"Accept"},31:{code:"ModeChange"},32:{code:"Space"},33:{code:"PageUp"},34:{code:"PageDown"},35:{code:"End"},36:{code:"Home"},37:{code:"ArrowLeft"},38:{code:"ArrowUp"},39:{code:"ArrowRight"},40:{code:"ArrowDown"},41:{code:"Select"},42:{code:"Print"},43:{code:"Execute"},44:{code:"PrintScreen"},45:{code:"Insert"},46:{code:"Delete"},47:{code:"Help"},48:{code:"Digit0",keyCap:"0"},49:{code:"Digit1",keyCap:"1"},50:{code:"Digit2",keyCap:"2"},51:{code:"Digit3",keyCap:"3"},52:{code:"Digit4",keyCap:"4"},53:{code:"Digit5",keyCap:"5"},54:{code:"Digit6",keyCap:"6"},55:{code:"Digit7",keyCap:"7"},56:{code:"Digit8",keyCap:"8"},57:{code:"Digit9",keyCap:"9"},65:{code:"KeyA",keyCap:"a"},66:{code:"KeyB",keyCap:"b"},67:{code:"KeyC",keyCap:"c"},68:{code:"KeyD",keyCap:"d"},69:{code:"KeyE",keyCap:"e"},70:{code:"KeyF",keyCap:"f"},71:{code:"KeyG",keyCap:"g"},72:{code:"KeyH",keyCap:"h"},73:{code:"KeyI",keyCap:"i"},74:{code:"KeyJ",keyCap:"j"},75:{code:"KeyK",keyCap:"k"},76:{code:"KeyL",keyCap:"l"},77:{code:"KeyM",keyCap:"m"},78:{code:"KeyN",keyCap:"n"},79:{code:"KeyO",keyCap:"o"},80:{code:"KeyP",keyCap:"p"},81:{code:"KeyQ",keyCap:"q"},82:{code:"KeyR",keyCap:"r"},83:{code:"KeyS",keyCap:"s"},84:{code:"KeyT",keyCap:"t"},85:{code:"KeyU",keyCap:"u"},86:{code:"KeyV",keyCap:"v"},87:{code:"KeyW",keyCap:"w"},88:{code:"KeyX",keyCap:"x"},89:{code:"KeyY",keyCap:"y"},90:{code:"KeyZ",keyCap:"z"},91:{code:"OSLeft",location:n},92:{code:"OSRight",location:s},93:{code:"ContextMenu"},95:{code:"Standby"},96:{code:"Numpad0",keyCap:"0",location:o},97:{code:"Numpad1",keyCap:"1",location:o},98:{code:"Numpad2",keyCap:"2",location:o},99:{code:"Numpad3",keyCap:"3",location:o},100:{code:"Numpad4",keyCap:"4",location:o},101:{code:"Numpad5",keyCap:"5",location:o},102:{code:"Numpad6",keyCap:"6",location:o},103:{code:"Numpad7",keyCap:"7",location:o},104:{code:"Numpad8",keyCap:"8",location:o},105:{code:"Numpad9",keyCap:"9",location:o},106:{code:"NumpadMultiply",keyCap:"*",location:o},107:{code:"NumpadAdd",keyCap:"+",location:o},108:{code:"NumpadComma",keyCap:",",location:o},109:{code:"NumpadSubtract",keyCap:"-",location:o},110:{code:"NumpadDecimal",keyCap:".",location:o},111:{code:"NumpadDivide",keyCap:"/",location:o},112:{code:"F1"},113:{code:"F2"},114:{code:"F3"},115:{code:"F4"},116:{code:"F5"},117:{code:"F6"},118:{code:"F7"},119:{code:"F8"},120:{code:"F9"},121:{code:"F10"},122:{code:"F11"},123:{code:"F12"},124:{code:"F13"},125:{code:"F14"},126:{code:"F15"},127:{code:"F16"},128:{code:"F17"},129:{code:"F18"},130:{code:"F19"},131:{code:"F20"},132:{code:"F21"},133:{code:"F22"},134:{code:"F23"},135:{code:"F24"},144:{code:"NumLock",location:o},145:{code:"ScrollLock"},160:{code:"ShiftLeft",location:n},161:{code:"ShiftRight",location:s},162:{code:"ControlLeft",location:n},163:{code:"ControlRight",location:s},164:{code:"AltLeft",location:n},165:{code:"AltRight",location:s},166:{code:"BrowserBack"},167:{code:"BrowserForward"},168:{code:"BrowserRefresh"},169:{code:"BrowserStop"},170:{code:"BrowserSearch"},171:{code:"BrowserFavorites"},172:{code:"BrowserHome"},173:{code:"VolumeMute"},174:{code:"VolumeDown"},175:{code:"VolumeUp"},176:{code:"MediaTrackNext"},177:{code:"MediaTrackPrevious"},178:{code:"MediaStop"},179:{code:"MediaPlayPause"},180:{code:"LaunchMail"},181:{code:"MediaSelect"},182:{code:"LaunchApp1"},183:{code:"LaunchApp2"},186:{code:"Semicolon",keyCap:";"},187:{code:"Equal",keyCap:"="},188:{code:"Comma",keyCap:","},189:{code:"Minus",keyCap:"-"},190:{code:"Period",keyCap:"."},191:{code:"Slash",keyCap:"/"},192:{code:"Backquote",keyCap:"`"},219:{code:"BracketLeft",keyCap:"["},220:{code:"Backslash",keyCap:"\\"},221:{code:"BracketRight",keyCap:"]"},222:{code:"Quote",keyCap:"'"},226:{code:"IntlBackslash",keyCap:"\\"},229:{code:"Process"},246:{code:"Attn"},247:{code:"CrSel"},248:{code:"ExSel"},249:{code:"EraseEof"},250:{code:"Play"},251:{code:"ZoomToggle"},254:{code:"Clear"}};p(g,"moz",{59:{code:"Semicolon",keyCap:";"},61:{code:"Equal",keyCap:"="},107:{code:"Equal",keyCap:"="},109:{code:"Minus",keyCap:"-"},187:{code:"NumpadAdd",keyCap:"+",location:o},189:{code:"NumpadSubtract",keyCap:"-",location:o}}),p(g,"moz-mac",{12:{code:"NumLock",location:o},173:{code:"Minus",keyCap:"-"}}),p(g,"moz-win",{173:{code:"Minus",keyCap:"-"}}),p(g,"chrome-mac",{93:{code:"OSRight",location:s}}),p(g,"safari",{3:{code:"Enter"},25:{code:"Tab"}}),p(g,"ios",{10:{code:"Enter",location:i}}),p(g,"safari-mac",{91:{code:"OSLeft",location:n},93:{code:"OSRight",location:s},229:{code:"KeyQ",keyCap:"Q"}});var m={};u==="cros"&&(m["U+00A0"]={code:"ShiftLeft",location:n},m["U+00A1"]={code:"ShiftRight",location:s},m["U+00A2"]={code:"ControlLeft",location:n},m["U+00A3"]={code:"ControlRight",location:s},m["U+00A4"]={code:"AltLeft",location:n},m["U+00A5"]={code:"AltRight",location:s}),h==="chrome-mac"&&(m["U+0010"]={code:"ContextMenu"}),h==="safari-mac"&&(m["U+0010"]={code:"ContextMenu"}),u==="ios"&&(m["U+0010"]={code:"Function"},m["U+001C"]={code:"ArrowLeft"},m["U+001D"]={code:"ArrowRight"},m["U+001E"]={code:"ArrowUp"},m["U+001F"]={code:"ArrowDown"},m["U+0001"]={code:"Home"},m["U+0004"]={code:"End"},m["U+000B"]={code:"PageUp"},m["U+000C"]={code:"PageDown"});var y=[];y[n]={16:{code:"ShiftLeft",location:n},17:{code:"ControlLeft",location:n},18:{code:"AltLeft",location:n}},y[s]={16:{code:"ShiftRight",location:s},17:{code:"ControlRight",location:s},18:{code:"AltRight",location:s}},y[o]={13:{code:"NumpadEnter",location:o}},p(y[o],"moz",{109:{code:"NumpadSubtract",location:o},107:{code:"NumpadAdd",location:o}}),p(y[n],"moz-mac",{224:{code:"OSLeft",location:n}}),p(y[s],"moz-mac",{224:{code:"OSRight",location:s}}),p(y[s],"moz-win",{91:{code:"OSRight",location:s}}),p(y[s],"mac",{93:{code:"OSRight",location:s}}),p(y[o],"chrome-mac",{12:{code:"NumLock",location:o}}),p(y[o],"safari-mac",{12:{code:"NumLock",location:o},187:{code:"NumpadAdd",location:o},189:{code:"NumpadSubtract",location:o},190:{code:"NumpadDecimal",location:o},191:{code:"NumpadDivide",location:o}});var b={ShiftLeft:{key:"Shift"},ShiftRight:{key:"Shift"},ControlLeft:{key:"Control"},ControlRight:{key:"Control"},AltLeft:{key:"Alt"},AltRight:{key:"Alt"},OSLeft:{key:"OS"},OSRight:{key:"OS"},NumpadEnter:{key:"Enter"},Space:{key:" "},Digit0:{key:"0",shiftKey:")"},Digit1:{key:"1",shiftKey:"!"},Digit2:{key:"2",shiftKey:"@"},Digit3:{key:"3",shiftKey:"#"},Digit4:{key:"4",shiftKey:"$"},Digit5:{key:"5",shiftKey:"%"},Digit6:{key:"6",shiftKey:"^"},Digit7:{key:"7",shiftKey:"&"},Digit8:{key:"8",shiftKey:"*"},Digit9:{key:"9",shiftKey:"("},KeyA:{key:"a",shiftKey:"A"},KeyB:{key:"b",shiftKey:"B"},KeyC:{key:"c",shiftKey:"C"},KeyD:{key:"d",shiftKey:"D"},KeyE:{key:"e",shiftKey:"E"},KeyF:{key:"f",shiftKey:"F"},KeyG:{key:"g",shiftKey:"G"},KeyH:{key:"h",shiftKey:"H"},KeyI:{key:"i",shiftKey:"I"},KeyJ:{key:"j",shiftKey:"J"},KeyK:{key:"k",shiftKey:"K"},KeyL:{key:"l",shiftKey:"L"},KeyM:{key:"m",shiftKey:"M"},KeyN:{key:"n",shiftKey:"N"},KeyO:{key:"o",shiftKey:"O"},KeyP:{key:"p",shiftKey:"P"},KeyQ:{key:"q",shiftKey:"Q"},KeyR:{key:"r",shiftKey:"R"},KeyS:{key:"s",shiftKey:"S"},KeyT:{key:"t",shiftKey:"T"},KeyU:{key:"u",shiftKey:"U"},KeyV:{key:"v",shiftKey:"V"},KeyW:{key:"w",shiftKey:"W"},KeyX:{key:"x",shiftKey:"X"},KeyY:{key:"y",shiftKey:"Y"},KeyZ:{key:"z",shiftKey:"Z"},Numpad0:{key:"0"},Numpad1:{key:"1"},Numpad2:{key:"2"},Numpad3:{key:"3"},Numpad4:{key:"4"},Numpad5:{key:"5"},Numpad6:{key:"6"},Numpad7:{key:"7"},Numpad8:{key:"8"},Numpad9:{key:"9"},NumpadMultiply:{key:"*"},NumpadAdd:{key:"+"},NumpadComma:{key:","},NumpadSubtract:{key:"-"},NumpadDecimal:{key:"."},NumpadDivide:{key:"/"},Semicolon:{key:";",shiftKey:":"},Equal:{key:"=",shiftKey:"+"},Comma:{key:",",shiftKey:"<"},Minus:{key:"-",shiftKey:"_"},Period:{key:".",shiftKey:">"},Slash:{key:"/",shiftKey:"?"},Backquote:{key:"`",shiftKey:"~"},BracketLeft:{key:"[",shiftKey:"{"},Backslash:{key:"\\",shiftKey:"|"},BracketRight:{key:"]",shiftKey:"}"},Quote:{key:"'",shiftKey:'"'},IntlBackslash:{key:"\\",shiftKey:"|"}};p(b,"mac",{OSLeft:{key:"Meta"},OSRight:{key:"Meta"}});var v={Esc:"Escape",Nonconvert:"NonConvert",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Menu:"ContextMenu",MediaNextTrack:"MediaTrackNext",MediaPreviousTrack:"MediaTrackPrevious",SelectMedia:"MediaSelect",HalfWidth:"Hankaku",FullWidth:"Zenkaku",RomanCharacters:"Romaji",Crsel:"CrSel",Exsel:"ExSel",Zoom:"ZoomToggle"},_=f(g,"code");try{var T=e&&"location"in new KeyboardEvent("")}catch{}function E(R){var B="keyCode"in R?R.keyCode:"which"in R?R.which:0,I=function(){if(T||"keyLocation"in R){var D=T?R.location:R.keyLocation;if(D&&B in y[D])return y[D][B]}return"keyIdentifier"in R&&R.keyIdentifier in m?m[R.keyIdentifier]:B in g?g[B]:null}();if(!I)return null;var N=function(){var D=b[I.code];return D?R.shiftKey&&"shiftKey"in D?D.shiftKey:D.key:I.code}();return{code:I.code,key:N,location:I.location,keyCap:I.keyCap}}function C(R,B){if(R=String(R),!_.hasOwnProperty(R))return"Undefined";if(B&&String(B).toLowerCase()!=="en-us")throw Error("Unsupported locale");var I=_[R];return I.keyCap||I.code||"Undefined"}"KeyboardEvent"in r&&"defineProperty"in Object&&function(){function R(I,N,D){N in I||Object.defineProperty(I,N,D)}if(R(KeyboardEvent.prototype,"code",{get:function(){var I=E(this);return I?I.code:""}}),"key"in KeyboardEvent.prototype){var B=Object.getOwnPropertyDescriptor(KeyboardEvent.prototype,"key");Object.defineProperty(KeyboardEvent.prototype,"key",{get:function(){var I=B.get.call(this);return v.hasOwnProperty(I)?v[I]:I}})}R(KeyboardEvent.prototype,"key",{get:function(){var I=E(this);return I&&"key"in I?I.key:"Unidentified"}}),R(KeyboardEvent.prototype,"location",{get:function(){var I=E(this);return I&&"location"in I?I.location:i}}),R(KeyboardEvent.prototype,"locale",{get:function(){return""}})}(),"queryKeyCap"in r.KeyboardEvent||(r.KeyboardEvent.queryKeyCap=C),r.identifyKey=function(R){if(!("code"in R)){var B=E(R);R.code=B?B.code:"",R.key=B&&"key"in B?B.key:"Unidentified",R.location="location"in R?R.location:"keyLocation"in R?R.keyLocation:B&&"location"in B?B.location:i,R.locale=""}}}(window);const uQ="__keyboard-controls-proxy",hQ=window.KeyboardEvent;AFRAME.registerComponent("keyboard-controls",{schema:{enabled:{default:!0},debug:{default:!1}},init:function(){this.dVelocity=new THREE.Vector3,this.localKeys={},this.listeners={keydown:this.onKeyDown.bind(this),keyup:this.onKeyUp.bind(this),blur:this.onBlur.bind(this),onContextMenu:this.onContextMenu.bind(this)}},isVelocityActive:function(){return this.data.enabled&&!!Object.keys(this.getKeys()).length},getVelocityDelta:function(){const r=this.data,e=this.getKeys();return this.dVelocity.set(0,0,0),r.enabled&&((e.KeyW||e.ArrowUp)&&(this.dVelocity.z-=1),(e.KeyA||e.ArrowLeft)&&(this.dVelocity.x-=1),(e.KeyS||e.ArrowDown)&&(this.dVelocity.z+=1),(e.KeyD||e.ArrowRight)&&(this.dVelocity.x+=1),e.ShiftLeft&&(this.dVelocity=this.dVelocity.multiplyScalar(2))),this.dVelocity.clone()},play:function(){this.attachEventListeners()},pause:function(){this.removeEventListeners()},attachEventListeners:function(){window.addEventListener("contextmenu",this.listeners.onContextMenu,!1),window.addEventListener("keydown",this.listeners.keydown,!1),window.addEventListener("keyup",this.listeners.keyup,!1),window.addEventListener("blur",this.listeners.blur,!1)},onContextMenu:function(){for(const r in this.localKeys)this.localKeys.hasOwnProperty(r)&&delete this.localKeys[r]},removeEventListeners:function(){window.removeEventListener("keydown",this.listeners.keydown),window.removeEventListener("keyup",this.listeners.keyup),window.removeEventListener("blur",this.listeners.blur)},onKeyDown:function(r){AFRAME.utils.shouldCaptureKeyEvent(r)&&(this.localKeys[r.code]=!0,this.emit(r))},onKeyUp:function(r){AFRAME.utils.shouldCaptureKeyEvent(r)&&(delete this.localKeys[r.code],this.emit(r))},onBlur:function(){for(const r in this.localKeys)this.localKeys.hasOwnProperty(r)&&delete this.localKeys[r]},emit:function(r){uQ in r&&this.el.emit(r.type,r),this.el.emit(r.type+":"+r.code,new hQ(r.type,r)),this.data.debug&&console.log(r.type+":"+r.code)},isPressed:function(r){return r in this.getKeys()},getKeys:function(){return this.isProxied()?this.el.sceneEl.components["proxy-controls"].getKeyboard():this.localKeys},isProxied:function(){const r=this.el.sceneEl.components["proxy-controls"];return r&&r.isConnected()}}),AFRAME.registerComponent("touch-controls",{schema:{enabled:{default:!0},reverseEnabled:{default:!0}},init:function(){this.dVelocity=new THREE.Vector3,this.bindMethods(),this.direction=0},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.dVelocity.set(0,0,0)},remove:function(){this.pause()},addEventListeners:function(){const r=this.el.sceneEl,e=r.canvas;if(!e){r.addEventListener("render-target-loaded",this.addEventListeners.bind(this));return}e.addEventListener("touchstart",this.onTouchStart,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd,{passive:!0});const i=r.getAttribute("vr-mode-ui");i&&i.cardboardModeEnabled&&r.addEventListener("enter-vr",this.onEnterVR)},removeEventListeners:function(){const r=this.el.sceneEl&&this.el.sceneEl.canvas;r&&(r.removeEventListener("touchstart",this.onTouchStart),r.removeEventListener("touchend",this.onTouchEnd),this.el.sceneEl.removeEventListener("enter-vr",this.onEnterVR))},isVelocityActive:function(){return this.data.enabled&&!!this.direction},getVelocityDelta:function(){return this.dVelocity.z=this.direction,this.dVelocity.clone()},bindMethods:function(){this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onEnterVR=this.onEnterVR.bind(this)},onTouchStart:function(r){this.direction=-1,this.data.reverseEnabled&&r.touches&&r.touches.length===2&&(this.direction=1),r.preventDefault()},onTouchEnd:function(r){this.direction=0,r.preventDefault()},onEnterVR:function(){const r=this.el.sceneEl.xrSession;r&&(r.addEventListener("selectstart",this.onTouchStart),r.addEventListener("selectend",this.onTouchEnd))}});const d2="-controls",dQ=.2,pQ=1e-5,fQ="moved";AFRAME.registerComponent("movement-controls",{dependencies:["rotation"],schema:{enabled:{default:!0},controls:{default:["gamepad","trackpad","keyboard","touch"]},speed:{default:.3,min:0},fly:{default:!1},constrainToNavMesh:{default:!1},camera:{default:"[movement-controls] [camera]",type:"selector"}},init:function(){const r=this.el;this.data.camera||(this.data.camera=r.querySelector("[camera]")),this.velocityCtrl=null,this.velocity=new THREE.Vector3,this.heading=new THREE.Quaternion,this.eventDetail={},this.navGroup=null,this.navNode=null,r.sceneEl.hasLoaded?this.injectControls():r.sceneEl.addEventListener("loaded",this.injectControls.bind(this))},update:function(r){const e=this.el,i=this.data,n=e.sceneEl.systems.nav;if(e.sceneEl.hasLoaded&&this.injectControls(),n&&i.constrainToNavMesh!==r.constrainToNavMesh&&(i.constrainToNavMesh?n.addAgent(this):n.removeAgent(this)),i.enabled!==r.enabled)for(let s=0;s<i.controls.length;s++){const o=i.controls[s]+d2;this.el.setAttribute(o,{enabled:this.data.enabled})}},injectControls:function(){const r=this.data;for(let e=0;e<r.controls.length;e++){const i=r.controls[e]+d2;this.el.setAttribute(i,{enabled:this.data.enabled})}},updateNavLocation:function(){this.navGroup=null,this.navNode=null},tick:function(){const r=new THREE.Vector3,e=new THREE.Vector3,i=new THREE.Vector3;return function(n,s){if(!s)return;const o=this.el,l=this.data;if(!l.enabled)return;this.updateVelocityCtrl();const u=this.velocityCtrl,c=this.velocity;if(u)if(s/1e3>dQ?c.set(0,0,0):this.updateVelocity(s),l.constrainToNavMesh&&u.isNavMeshConstrained!==!1){if(c.lengthSq()<pQ)return;r.copy(o.object3D.position),e.copy(c).multiplyScalar(s/1e3).add(r);const h=o.sceneEl.systems.nav;this.navGroup=this.navGroup===null?h.getGroup(r):this.navGroup,this.navNode=this.navNode||h.getNode(r,this.navGroup),this.navNode=h.clampStep(r,e,this.navGroup,this.navNode,i),o.object3D.position.copy(i)}else o.hasAttribute("velocity")?o.setAttribute("velocity",c):(o.object3D.position.x+=c.x*s/1e3,o.object3D.position.y+=c.y*s/1e3,o.object3D.position.z+=c.z*s/1e3)}}(),updateVelocityCtrl:function(){const r=this.data;if(r.enabled){for(let e=0,i=r.controls.length;e<i;e++){const n=this.el.components[r.controls[e]+d2];if(n&&n.isVelocityActive()){this.velocityCtrl=n;return}}this.velocityCtrl=null}},updateVelocity:function(){const r=new THREE.Vector2,e=new THREE.Quaternion;return function(i){let n;const s=this.el,o=this.velocityCtrl,l=this.velocity,u=this.data;if(o)if(o.getVelocityDelta)n=o.getVelocityDelta(i);else if(o.getVelocity){l.copy(o.getVelocity());return}else if(o.getPositionDelta){l.copy(o.getPositionDelta(i).multiplyScalar(1e3/i));return}else throw new Error("Incompatible movement controls: ",o);if(s.hasAttribute("velocity")&&!u.constrainToNavMesh&&l.copy(this.el.getAttribute("velocity")),n&&u.enabled){const c=u.camera;e.copy(c.object3D.quaternion),e.premultiply(s.object3D.quaternion),n.applyQuaternion(e);const h=n.length();u.fly?(l.copy(n),l.multiplyScalar(this.data.speed*16.66667)):(r.set(n.x,n.z),r.setLength(h*this.data.speed*16.66667),l.x=r.x,l.y=0,l.z=r.y),(l.x!==0||l.y!==0||l.z!==0)&&(this.eventDetail.velocity=l,this.el.emit(fQ,this.eventDetail))}}}()}),AFRAME.registerComponent("trackpad-controls",{schema:{enabled:{default:!0},enableNegX:{default:!0},enablePosX:{default:!0},enableNegZ:{default:!0},enablePosZ:{default:!0},mode:{default:"touch",oneOf:["swipe","touch","press"]}},init:function(){this.dVelocity=new THREE.Vector3,this.zVel=0,this.xVel=0,this.bindMethods()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.dVelocity.set(0,0,0)},remove:function(){this.pause()},addEventListeners:function(){const r=this.data,e=this.el.sceneEl;switch(e.addEventListener("axismove",this.onAxisMove),r.mode){case"swipe":case"touch":e.addEventListener("trackpadtouchstart",this.onTouchStart),e.addEventListener("trackpadtouchend",this.onTouchEnd);break;case"press":e.addEventListener("trackpaddown",this.onTouchStart),e.addEventListener("trackpadup",this.onTouchEnd);break}},removeEventListeners:function(){const r=this.el.sceneEl;r.removeEventListener("axismove",this.onAxisMove),r.removeEventListener("trackpadtouchstart",this.onTouchStart),r.removeEventListener("trackpadtouchend",this.onTouchEnd),r.removeEventListener("trackpaddown",this.onTouchStart),r.removeEventListener("trackpadup",this.onTouchEnd)},isVelocityActive:function(){return this.data.enabled&&this.isMoving},getVelocityDelta:function(){return this.dVelocity.z=this.isMoving?-this.zVel:1,this.dVelocity.x=this.isMoving?this.xVel:1,this.dVelocity.clone()},bindMethods:function(){this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onAxisMove=this.onAxisMove.bind(this)},onTouchStart:function(r){switch(this.data.mode){case"swipe":this.canRecordAxis=!0,this.startingAxisData=[];break;case"touch":this.isMoving=!0;break;case"press":this.isMoving=!0;break}r.preventDefault()},onTouchEnd:function(r){this.data.mode=="swipe"&&(this.startingAxisData=[]),this.isMoving=!1,r.preventDefault()},onAxisMove:function(r){switch(this.data.mode){case"swipe":return this.handleSwipeAxis(r);case"touch":case"press":return this.handleTouchAxis(r)}},handleSwipeAxis:function(r){const e=this.data,i=r.detail.axis;if(this.startingAxisData.length===0&&this.canRecordAxis&&(this.canRecordAxis=!1,this.startingAxisData[0]=i[0],this.startingAxisData[1]=i[1]),this.startingAxisData.length>0){let n=0,s=0;e.enableNegX&&i[0]<this.startingAxisData[0]&&(n=-1),e.enablePosX&&i[0]>this.startingAxisData[0]&&(n=1),e.enablePosZ&&i[1]>this.startingAxisData[1]&&(s=-1),e.enableNegZ&&i[1]<this.startingAxisData[1]&&(s=1);const o=Math.abs(this.startingAxisData[1]-i[1]);Math.abs(this.startingAxisData[0]-i[0])>o?(this.zVel=0,this.xVel=n,this.isMoving=!0):(this.xVel=0,this.zVel=s,this.isMoving=!0)}},handleTouchAxis:function(r){const e=this.data,i=r.detail.axis;let n=0,s=0;e.enableNegX&&i[0]<0&&(n=-1),e.enablePosX&&i[0]>0&&(n=1),e.enablePosZ&&i[1]>0&&(s=-1),e.enableNegZ&&i[1]<0&&(s=1),Math.abs(i[0])>Math.abs(i[1])?(this.zVel=0,this.xVel=n):(this.xVel=0,this.zVel=s)}});const ib=(r,e)=>{const i=e.x-r.x,n=e.y-r.y;return Math.sqrt(i*i+n*n)},mQ=(r,e)=>{const i=e.x-r.x,n=e.y-r.y;return AQ(Math.atan2(n,i))},gQ=(r,e,i)=>{const n={x:0,y:0};return i=p2(i),n.x=r.x-e*Math.cos(i),n.y=r.y-e*Math.sin(i),n},p2=r=>r*(Math.PI/180),AQ=r=>r*(180/Math.PI),yQ=r=>isNaN(r.buttons)?r.pressure!==0:r.buttons!==0,f2=new Map,iN=r=>{f2.has(r)&&clearTimeout(f2.get(r)),f2.set(r,setTimeout(r,100))},rb=(r,e,i)=>{const n=e.split(/[ ,]+/g);let s;for(let o=0;o<n.length;o+=1)s=n[o],r.addEventListener?r.addEventListener(s,i,!1):r.attachEvent&&r.attachEvent(s,i)},rN=(r,e,i)=>{const n=e.split(/[ ,]+/g);let s;for(let o=0;o<n.length;o+=1)s=n[o],r.removeEventListener?r.removeEventListener(s,i):r.detachEvent&&r.detachEvent(s,i)},nN=r=>(r.preventDefault(),r.type.match(/^touch/)?r.changedTouches:r),sN=()=>{const r=window.pageXOffset!==void 0?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,e=window.pageYOffset!==void 0?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return{x:r,y:e}},aN=(r,e)=>{e.top||e.right||e.bottom||e.left?(r.style.top=e.top,r.style.right=e.right,r.style.bottom=e.bottom,r.style.left=e.left):(r.style.left=e.x+"px",r.style.top=e.y+"px")},m2=(r,e,i)=>{const n=oN(r);for(let s in n)if(n.hasOwnProperty(s))if(typeof e=="string")n[s]=e+" "+i;else{let o="";for(let l=0,u=e.length;l<u;l+=1)o+=e[l]+" "+i+", ";n[s]=o.slice(0,-2)}return n},vQ=(r,e)=>{const i=oN(r);for(let n in i)i.hasOwnProperty(n)&&(i[n]=e);return i},oN=r=>{const e={};return e[r]="",["webkit","Moz","o"].forEach(function(i){e[i+r.charAt(0).toUpperCase()+r.slice(1)]=""}),e},g2=(r,e)=>{for(let i in e)e.hasOwnProperty(i)&&(r[i]=e[i]);return r},bQ=(r,e)=>{const i={};for(let n in r)r.hasOwnProperty(n)&&e.hasOwnProperty(n)?i[n]=e[n]:r.hasOwnProperty(n)&&(i[n]=r[n]);return i},A2=(r,e)=>{if(r.length)for(let i=0,n=r.length;i<n;i+=1)e(r[i]);else e(r)},xQ=(r,e,i)=>({x:Math.min(Math.max(r.x,e.x-i),e.x+i),y:Math.min(Math.max(r.y,e.y-i),e.y+i)});var _Q="ontouchstart"in window,EQ=!!window.PointerEvent,wQ=!!window.MSPointerEvent,V0={touch:{start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},pointer:{start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"},MSPointer:{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}},Ff,G0={};EQ?Ff=V0.pointer:wQ?Ff=V0.MSPointer:_Q?(Ff=V0.touch,G0=V0.mouse):Ff=V0.mouse;function du(){}du.prototype.on=function(r,e){var i=this,n=r.split(/[ ,]+/g),s;i._handlers_=i._handlers_||{};for(var o=0;o<n.length;o+=1)s=n[o],i._handlers_[s]=i._handlers_[s]||[],i._handlers_[s].push(e);return i},du.prototype.off=function(r,e){var i=this;return i._handlers_=i._handlers_||{},r===void 0?i._handlers_={}:e===void 0?i._handlers_[r]=null:i._handlers_[r]&&i._handlers_[r].indexOf(e)>=0&&i._handlers_[r].splice(i._handlers_[r].indexOf(e),1),i},du.prototype.trigger=function(r,e){var i=this,n=r.split(/[ ,]+/g),s;i._handlers_=i._handlers_||{};for(var o=0;o<n.length;o+=1)s=n[o],i._handlers_[s]&&i._handlers_[s].length&&i._handlers_[s].forEach(function(l){l.call(i,{type:s,target:i},e)})},du.prototype.config=function(r){var e=this;e.options=e.defaults||{},r&&(e.options=bQ(e.options,r))},du.prototype.bindEvt=function(r,e){var i=this;return i._domHandlers_=i._domHandlers_||{},i._domHandlers_[e]=function(){typeof i["on"+e]=="function"?i["on"+e].apply(i,arguments):console.warn('[WARNING] : Missing "on'+e+'" handler.')},rb(r,Ff[e],i._domHandlers_[e]),G0[e]&&rb(r,G0[e],i._domHandlers_[e]),i},du.prototype.unbindEvt=function(r,e){var i=this;return i._domHandlers_=i._domHandlers_||{},rN(r,Ff[e],i._domHandlers_[e]),G0[e]&&rN(r,G0[e],i._domHandlers_[e]),delete i._domHandlers_[e],this};function da(r,e){return this.identifier=e.identifier,this.position=e.position,this.frontPosition=e.frontPosition,this.collection=r,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(e),this.options.mode==="dynamic"&&(this.options.restOpacity=0),this.id=da.id,da.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}da.prototype=new du,da.constructor=da,da.id=0,da.prototype.buildEl=function(r){return this.ui={},this.options.dataOnly?this:(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front),this)},da.prototype.stylize=function(){if(this.options.dataOnly)return this;var r=this.options.fadeTime+"ms",e=vQ("borderRadius","50%"),i=m2("transition","opacity",r),n={};return n.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},n.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",left:0,marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},n.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",left:0,marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},g2(n.el,i),this.options.shape==="circle"&&g2(n.back,e),g2(n.front,e),this.applyStyles(n),this},da.prototype.applyStyles=function(r){for(var e in this.ui)if(this.ui.hasOwnProperty(e))for(var i in r[e])this.ui[e].style[i]=r[e][i];return this},da.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)?this:(this.options.zone.appendChild(this.ui.el),this)},da.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)?this:(this.options.zone.removeChild(this.ui.el),this)},da.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},da.prototype.show=function(r){var e=this;return e.options.dataOnly||(clearTimeout(e.removeTimeout),clearTimeout(e.showTimeout),clearTimeout(e.restTimeout),e.addToDom(),e.restCallback(),setTimeout(function(){e.ui.el.style.opacity=1},0),e.showTimeout=setTimeout(function(){e.trigger("shown",e.instance),typeof r=="function"&&r.call(this)},e.options.fadeTime)),e},da.prototype.hide=function(r){var e=this;if(e.options.dataOnly)return e;if(e.ui.el.style.opacity=e.options.restOpacity,clearTimeout(e.removeTimeout),clearTimeout(e.showTimeout),clearTimeout(e.restTimeout),e.removeTimeout=setTimeout(function(){var i=e.options.mode==="dynamic"?"none":"block";e.ui.el.style.display=i,typeof r=="function"&&r.call(e),e.trigger("hidden",e.instance)},e.options.fadeTime),e.options.restJoystick){const i=e.options.restJoystick,n={};n.x=i===!0||i.x!==!1?0:e.instance.frontPosition.x,n.y=i===!0||i.y!==!1?0:e.instance.frontPosition.y,e.setPosition(r,n)}return e},da.prototype.setPosition=function(r,e){var i=this;i.frontPosition={x:e.x,y:e.y};var n=i.options.fadeTime+"ms",s={};s.front=m2("transition",["transform"],n);var o={front:{}};o.front={transform:"translate("+i.frontPosition.x+"px,"+i.frontPosition.y+"px)"},i.applyStyles(s),i.applyStyles(o),i.restTimeout=setTimeout(function(){typeof r=="function"&&r.call(i),i.restCallback()},i.options.fadeTime)},da.prototype.restCallback=function(){var r=this,e={};e.front=m2("transition","none",""),r.applyStyles(e),r.trigger("rested",r.instance)},da.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},da.prototype.computeDirection=function(r){var e=r.angle.radian,i=Math.PI/4,n=Math.PI/2,s,o,l;if(e>i&&e<i*3&&!r.lockX?s="up":e>-i&&e<=i&&!r.lockY?s="left":e>-i*3&&e<=-i&&!r.lockX?s="down":r.lockY||(s="right"),r.lockY||(e>-n&&e<n?o="left":o="right"),r.lockX||(e>0?l="up":l="down"),r.force>this.options.threshold){var u={},c;for(c in this.direction)this.direction.hasOwnProperty(c)&&(u[c]=this.direction[c]);var h={};this.direction={x:o,y:l,angle:s},r.direction=this.direction;for(c in u)u[c]===this.direction[c]&&(h[c]=!0);if(h.x&&h.y&&h.angle)return r;(!h.x||!h.y)&&this.trigger("plain",r),h.x||this.trigger("plain:"+o,r),h.y||this.trigger("plain:"+l,r),h.angle||this.trigger("dir dir:"+s,r)}else this.resetDirection();return r};function Hs(r,e){var i=this;i.nipples=[],i.idles=[],i.actives=[],i.ids=[],i.pressureIntervals={},i.manager=r,i.id=Hs.id,Hs.id+=1,i.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},i.config(e),(i.options.mode==="static"||i.options.mode==="semi")&&(i.options.multitouch=!1),i.options.multitouch||(i.options.maxNumberOfNipples=1);const n=getComputedStyle(i.options.zone.parentElement);return n&&n.display==="flex"&&(i.parentIsFlex=!0),i.updateBox(),i.prepareNipples(),i.bindings(),i.begin(),i.nipples}Hs.prototype=new du,Hs.constructor=Hs,Hs.id=0,Hs.prototype.prepareNipples=function(){var r=this,e=r.nipples;e.on=r.on.bind(r),e.off=r.off.bind(r),e.options=r.options,e.destroy=r.destroy.bind(r),e.ids=r.ids,e.id=r.id,e.processOnMove=r.processOnMove.bind(r),e.processOnEnd=r.processOnEnd.bind(r),e.get=function(i){if(i===void 0)return e[0];for(var n=0,s=e.length;n<s;n+=1)if(e[n].identifier===i)return e[n];return!1}},Hs.prototype.bindings=function(){var r=this;r.bindEvt(r.options.zone,"start"),r.options.zone.style.touchAction="none",r.options.zone.style.msTouchAction="none"},Hs.prototype.begin=function(){var r=this,e=r.options;if(e.mode==="static"){var i=r.createNipple(e.position,r.manager.getIdentifier());i.add(),r.idles.push(i)}},Hs.prototype.createNipple=function(r,e){var i=this,n=i.manager.scroll,s={},o=i.options,l={x:i.parentIsFlex?n.x:n.x+i.box.left,y:i.parentIsFlex?n.y:n.y+i.box.top};if(r.x&&r.y)s={x:r.x-l.x,y:r.y-l.y};else if(r.top||r.right||r.bottom||r.left){var u=document.createElement("DIV");u.style.display="hidden",u.style.top=r.top,u.style.right=r.right,u.style.bottom=r.bottom,u.style.left=r.left,u.style.position="absolute",o.zone.appendChild(u);var c=u.getBoundingClientRect();o.zone.removeChild(u),s=r,r={x:c.left+n.x,y:c.top+n.y}}var h=new da(i,{color:o.color,size:o.size,threshold:o.threshold,fadeTime:o.fadeTime,dataOnly:o.dataOnly,restJoystick:o.restJoystick,restOpacity:o.restOpacity,mode:o.mode,identifier:e,position:r,zone:o.zone,frontPosition:{x:0,y:0},shape:o.shape});return o.dataOnly||(aN(h.ui.el,s),aN(h.ui.front,h.frontPosition)),i.nipples.push(h),i.trigger("added "+h.identifier+":added",h),i.manager.trigger("added "+h.identifier+":added",h),i.bindNipple(h),h},Hs.prototype.updateBox=function(){var r=this;r.box=r.options.zone.getBoundingClientRect()},Hs.prototype.bindNipple=function(r){var e=this,i,n=function(s,o){i=s.type+" "+o.id+":"+s.type,e.trigger(i,o)};r.on("destroyed",e.onDestroyed.bind(e)),r.on("shown hidden rested dir plain",n),r.on("dir:up dir:right dir:down dir:left",n),r.on("plain:up plain:right plain:down plain:left",n)},Hs.prototype.pressureFn=function(r,e,i){var n=this,s=0;clearInterval(n.pressureIntervals[i]),n.pressureIntervals[i]=setInterval((function(){var o=r.force||r.pressure||r.webkitForce||0;o!==s&&(e.trigger("pressure",o),n.trigger("pressure "+e.identifier+":pressure",o),s=o)}).bind(n),100)},Hs.prototype.onstart=function(r){var e=this,i=e.options,n=r;r=nN(r),e.updateBox();var s=function(o){e.actives.length<i.maxNumberOfNipples?e.processOnStart(o):n.type.match(/^touch/)&&(Object.keys(e.manager.ids).forEach(function(l){if(Object.values(n.touches).findIndex(function(c){return c.identifier===l})<0){var u=[r[0]];u.identifier=l,e.processOnEnd(u)}}),e.actives.length<i.maxNumberOfNipples&&e.processOnStart(o))};return A2(r,s),e.manager.bindDocument(),!1},Hs.prototype.processOnStart=function(r){var e=this,i=e.options,n,s=e.manager.getIdentifier(r),o=r.force||r.pressure||r.webkitForce||0,l={x:r.pageX,y:r.pageY},u=e.getOrCreate(s,l);u.identifier!==s&&e.manager.removeIdentifier(u.identifier),u.identifier=s;var c=function(p){p.trigger("start",p),e.trigger("start "+p.id+":start",p),p.show(),o>0&&e.pressureFn(r,p,p.identifier),e.processOnMove(r)};if((n=e.idles.indexOf(u))>=0&&e.idles.splice(n,1),e.actives.push(u),e.ids.push(u.identifier),i.mode!=="semi")c(u);else{var h=ib(l,u.position);if(h<=i.catchDistance)c(u);else{u.destroy(),e.processOnStart(r);return}}return u},Hs.prototype.getOrCreate=function(r,e){var i=this,n=i.options,s;return/(semi|static)/.test(n.mode)?(s=i.idles[0],s?(i.idles.splice(0,1),s):n.mode==="semi"?i.createNipple(e,r):(console.warn("Coudln't find the needed nipple."),!1)):(s=i.createNipple(e,r),s)},Hs.prototype.processOnMove=function(r){var e=this,i=e.options,n=e.manager.getIdentifier(r),s=e.nipples.get(n),o=e.manager.scroll;if(!yQ(r)){this.processOnEnd(r);return}if(!s){console.error("Found zombie joystick with ID "+n),e.manager.removeIdentifier(n);return}if(i.dynamicPage){var l=s.el.getBoundingClientRect();s.position={x:o.x+l.left,y:o.y+l.top}}s.identifier=n;var u=s.options.size/2,c={x:r.pageX,y:r.pageY};i.lockX&&(c.y=s.position.y),i.lockY&&(c.x=s.position.x);var h=ib(c,s.position),p=mQ(c,s.position),f=p2(p),g=h/u,m={distance:h,position:c},y,b;if(s.options.shape==="circle"?(y=Math.min(h,u),b=gQ(s.position,y,p)):(b=xQ(c,s.position,u),y=ib(b,s.position)),i.follow){if(h>u){let E=c.x-b.x,C=c.y-b.y;s.position.x+=E,s.position.y+=C,s.el.style.top=s.position.y-(e.box.top+o.y)+"px",s.el.style.left=s.position.x-(e.box.left+o.x)+"px",h=ib(c,s.position)}}else c=b,h=y;var v=c.x-s.position.x,_=c.y-s.position.y;s.frontPosition={x:v,y:_},i.dataOnly||(s.ui.front.style.transform="translate("+v+"px,"+_+"px)");var T={identifier:s.identifier,position:c,force:g,pressure:r.force||r.pressure||r.webkitForce||0,distance:h,angle:{radian:f,degree:p},vector:{x:v/u,y:-_/u},raw:m,instance:s,lockX:i.lockX,lockY:i.lockY};T=s.computeDirection(T),T.angle={radian:p2(180-p),degree:180-p},s.trigger("move",T),e.trigger("move "+s.id+":move",T)},Hs.prototype.processOnEnd=function(r){var e=this,i=e.options,n=e.manager.getIdentifier(r),s=e.nipples.get(n),o=e.manager.removeIdentifier(s.identifier);s&&(i.dataOnly||s.hide(function(){i.mode==="dynamic"&&(s.trigger("removed",s),e.trigger("removed "+s.id+":removed",s),e.manager.trigger("removed "+s.id+":removed",s),s.destroy())}),clearInterval(e.pressureIntervals[s.identifier]),s.resetDirection(),s.trigger("end",s),e.trigger("end "+s.id+":end",s),e.ids.indexOf(s.identifier)>=0&&e.ids.splice(e.ids.indexOf(s.identifier),1),e.actives.indexOf(s)>=0&&e.actives.splice(e.actives.indexOf(s),1),/(semi|static)/.test(i.mode)?e.idles.push(s):e.nipples.indexOf(s)>=0&&e.nipples.splice(e.nipples.indexOf(s),1),e.manager.unbindDocument(),/(semi|static)/.test(i.mode)&&(e.manager.ids[o.id]=o.identifier))},Hs.prototype.onDestroyed=function(r,e){var i=this;i.nipples.indexOf(e)>=0&&i.nipples.splice(i.nipples.indexOf(e),1),i.actives.indexOf(e)>=0&&i.actives.splice(i.actives.indexOf(e),1),i.idles.indexOf(e)>=0&&i.idles.splice(i.idles.indexOf(e),1),i.ids.indexOf(e.identifier)>=0&&i.ids.splice(i.ids.indexOf(e.identifier),1),i.manager.removeIdentifier(e.identifier),i.manager.unbindDocument()},Hs.prototype.destroy=function(){var r=this;r.unbindEvt(r.options.zone,"start"),r.nipples.forEach(function(i){i.destroy()});for(var e in r.pressureIntervals)r.pressureIntervals.hasOwnProperty(e)&&clearInterval(r.pressureIntervals[e]);r.trigger("destroyed",r.nipples),r.manager.unbindDocument(),r.off()};function wa(r){var e=this;e.ids={},e.index=0,e.collections=[],e.scroll=sN(),e.config(r),e.prepareCollections();var i=function(){var s;e.collections.forEach(function(o){o.forEach(function(l){s=l.el.getBoundingClientRect(),l.position={x:e.scroll.x+s.left,y:e.scroll.y+s.top}})})};rb(window,"resize",function(){iN(i)});var n=function(){e.scroll=sN()};return rb(window,"scroll",function(){iN(n)}),e.collections}wa.prototype=new du,wa.constructor=wa,wa.prototype.prepareCollections=function(){var r=this;r.collections.create=r.create.bind(r),r.collections.on=r.on.bind(r),r.collections.off=r.off.bind(r),r.collections.destroy=r.destroy.bind(r),r.collections.get=function(e){var i;return r.collections.every(function(n){return i=n.get(e),!i}),i}},wa.prototype.create=function(r){return this.createCollection(r)},wa.prototype.createCollection=function(r){var e=this,i=new Hs(e,r);return e.bindCollection(i),e.collections.push(i),i},wa.prototype.bindCollection=function(r){var e=this,i,n=function(s,o){i=s.type+" "+o.id+":"+s.type,e.trigger(i,o)};r.on("destroyed",e.onDestroyed.bind(e)),r.on("shown hidden rested dir plain",n),r.on("dir:up dir:right dir:down dir:left",n),r.on("plain:up plain:right plain:down plain:left",n)},wa.prototype.bindDocument=function(){var r=this;r.binded||(r.bindEvt(document,"move").bindEvt(document,"end"),r.binded=!0)},wa.prototype.unbindDocument=function(r){var e=this;(!Object.keys(e.ids).length||r===!0)&&(e.unbindEvt(document,"move").unbindEvt(document,"end"),e.binded=!1)},wa.prototype.getIdentifier=function(r){var e;return r?(e=r.identifier===void 0?r.pointerId:r.identifier,e===void 0&&(e=this.latest||0)):e=this.index,this.ids[e]===void 0&&(this.ids[e]=this.index,this.index+=1),this.latest=e,this.ids[e]},wa.prototype.removeIdentifier=function(r){var e={};for(var i in this.ids)if(this.ids[i]===r){e.id=i,e.identifier=this.ids[i],delete this.ids[i];break}return e},wa.prototype.onmove=function(r){var e=this;return e.onAny("move",r),!1},wa.prototype.onend=function(r){var e=this;return e.onAny("end",r),!1},wa.prototype.oncancel=function(r){var e=this;return e.onAny("end",r),!1},wa.prototype.onAny=function(r,e){var i=this,n,s="processOn"+r.charAt(0).toUpperCase()+r.slice(1);e=nN(e);var o=function(u,c,h){h.ids.indexOf(c)>=0&&(h[s](u),u._found_=!0)},l=function(u){n=i.getIdentifier(u),A2(i.collections,o.bind(null,u,n)),u._found_||i.removeIdentifier(n)};return A2(e,l),!1},wa.prototype.destroy=function(){var r=this;r.unbindDocument(!0),r.ids={},r.index=0,r.collections.forEach(function(e){e.destroy()}),r.off()},wa.prototype.onDestroyed=function(r,e){var i=this;if(i.collections.indexOf(e)<0)return!1;i.collections.splice(i.collections.indexOf(e),1)};const lN=new wa,cN={create:function(r){return lN.create(r)},factory:lN};AFRAME.registerComponent("nipple-controls",{schema:{enabled:{default:!0},mode:{default:"dynamic",oneOf:["static","semi","dynamic"]},rotationSensitivity:{default:1},moveJoystickEnabled:{default:!0},lookJoystickEnabled:{default:!0},sideMargin:{default:"30px"},bottomMargin:{default:"70px"},moveJoystickPosition:{default:"left",oneOf:["left","right"]},lookJoystickPosition:{default:"right",oneOf:["left","right"]}},init(){this.dVelocity=new THREE.Vector3,this.lookVector=new THREE.Vector2;const r=this.el.querySelector("[look-controls]").components["look-controls"];this.pitchObject=r.pitchObject,this.yawObject=r.yawObject,this.rigRotation=this.el.object3D.rotation,this.moveData=void 0,this.lookData=void 0,this.moving=!1,this.rotating=!1},update(r){(this.data.moveJoystickPosition!==r.moveJoystickPosition||this.data.sideMargin!==r.sideMargin||this.data.bottomMargin!==r.bottomMargin||this.data.mode!==r.mode)&&this.removeMoveJoystick(),(this.data.lookJoystickPosition!==r.lookJoystickPosition||this.data.sideMargin!==r.sideMargin||this.data.bottomMargin!==r.bottomMargin||this.data.mode!==r.mode)&&this.removeLookJoystick(),this.data.enabled&&this.data.moveJoystickEnabled?this.createMoveJoystick():this.removeMoveJoystick(),this.data.enabled&&this.data.lookJoystickEnabled?this.createLookJoystick():this.removeLookJoystick()},pause(){this.moving=!1,this.rotating=!1},remove(){this.removeMoveJoystick(),this.removeLookJoystick()},isVelocityActive(){return this.data.enabled&&this.moving},getVelocityDelta(){if(this.dVelocity.set(0,0,0),this.isVelocityActive()){const r=this.moveData.force<1?this.moveData.force:1,e=this.moveData.angle.radian,i=Math.cos(e)*r,n=-Math.sin(e)*r;this.dVelocity.set(i,0,n)}return this.dVelocity},isRotationActive(){return this.data.enabled&&this.rotating},updateRotation(r){if(!this.isRotationActive())return;const e=this.lookData.force<1?this.lookData.force:1,i=this.lookData.angle.radian,n=this.lookVector;n.x=Math.cos(i)*e,n.y=Math.sin(i)*e,n.multiplyScalar(this.data.rotationSensitivity*r/1e3),this.yawObject.rotation.y-=n.x;let s=this.pitchObject.rotation.x+n.y;s=Math.max(-Math.PI/2,Math.min(Math.PI/2,s)),this.pitchObject.rotation.x=s},tick:function(r,e){this.updateRotation(e)},initLeftZone(){const r=document.createElement("div");r.setAttribute("id","joystickLeftZone"),r.setAttribute("style",`position:absolute;${this.data.moveJoystickPosition}:${this.data.sideMargin};bottom:${this.data.bottomMargin};z-index:1`),document.body.appendChild(r),this.leftZone=r},initRightZone(){const r=document.createElement("div");r.setAttribute("id","joystickRightZone"),r.setAttribute("style",`position:absolute;${this.data.lookJoystickPosition}:${this.data.sideMargin};bottom:${this.data.bottomMargin};z-index:1`),document.body.appendChild(r),this.rightZone=r},createMoveJoystick(){if(this.moveJoystick)return;this.initLeftZone();const r={mode:this.data.mode,zone:this.leftZone,color:"white",fadeTime:0};this.leftZone.style.width="100px",this.data.mode==="static"?(this.leftZone.style.height="100px",r.position={left:"50%",bottom:"50%"}):this.leftZone.style.height="400px",this.moveJoystick=cN.create(r),this.moveJoystick.on("move",(e,i)=>{this.moveData=i,this.moving=!0}),this.moveJoystick.on("end",(e,i)=>{this.moving=!1})},createLookJoystick(){if(this.lookJoystick)return;this.initRightZone();const r={mode:this.data.mode,zone:this.rightZone,color:"white",fadeTime:0};this.rightZone.style.width="100px",this.data.mode==="static"?(this.rightZone.style.height="100px",r.position={left:"50%",bottom:"50%"}):this.rightZone.style.height="400px",this.lookJoystick=cN.create(r),this.lookJoystick.on("move",(e,i)=>{this.lookData=i,this.rotating=!0}),this.lookJoystick.on("end",(e,i)=>{this.rotating=!1})},removeMoveJoystick(){this.moveJoystick&&(this.moveJoystick.destroy(),this.moveJoystick=void 0),this.moveData=void 0,this.leftZone&&this.leftZone.parentNode&&(this.leftZone.remove(),this.leftZone=void 0)},removeLookJoystick(){this.lookJoystick&&(this.lookJoystick.destroy(),this.lookJoystick=void 0),this.lookData=void 0,this.rightZone&&this.rightZone.parentNode&&(this.rightZone.remove(),this.rightZone=void 0)}});const y2={once:THREE.LoopOnce,repeat:THREE.LoopRepeat,pingpong:THREE.LoopPingPong};AFRAME.registerComponent("animation-mixer",{schema:{clip:{default:"*"},useRegExp:{default:!1},duration:{default:0},clampWhenFinished:{default:!1,type:"boolean"},crossFadeDuration:{default:0},loop:{default:"repeat",oneOf:Object.keys(y2)},repetitions:{default:1/0,min:0},timeScale:{default:1},startAt:{default:0}},init:function(){this.model=null,this.mixer=null,this.activeActions=[];const r=this.el.getObject3D("mesh");r?this.load(r):this.el.addEventListener("model-loaded",e=>{this.load(e.detail.model)})},load:function(r){const e=this.el;this.model=r,this.mixer=new THREE.AnimationMixer(r),this.mixer.addEventListener("loop",i=>{e.emit("animation-loop",{action:i.action,loopDelta:i.loopDelta})}),this.mixer.addEventListener("finished",i=>{e.emit("animation-finished",{action:i.action,direction:i.direction})}),this.data.clip&&this.update({})},remove:function(){this.mixer&&this.mixer.stopAllAction()},update:function(r){if(!r)return;const e=this.data,i=AFRAME.utils.diff(e,r);if("clip"in i){this.stopAction(),e.clip&&this.playAction();return}this.activeActions.forEach(n=>{"duration"in i&&e.duration&&n.setDuration(e.duration),"clampWhenFinished"in i&&(n.clampWhenFinished=e.clampWhenFinished),("loop"in i||"repetitions"in i)&&n.setLoop(y2[e.loop],e.repetitions),"timeScale"in i&&n.setEffectiveTimeScale(e.timeScale)})},stopAction:function(){const r=this.data;for(let e=0;e<this.activeActions.length;e++)r.crossFadeDuration?this.activeActions[e].fadeOut(r.crossFadeDuration):this.activeActions[e].stop();this.activeActions.length=0},playAction:function(){if(!this.mixer)return;const r=this.model,e=this.data,i=r.animations||(r.geometry||{}).animations||[];if(!i.length)return;const n=e.useRegExp?e.clip:CQ(e.clip);for(let s,o=0;s=i[o];o++)if(s.name.match(n)){const l=this.mixer.clipAction(s,r);l.enabled=!0,l.clampWhenFinished=e.clampWhenFinished,e.duration&&l.setDuration(e.duration),e.timeScale!==1&&l.setEffectiveTimeScale(e.timeScale),l.startAt(this.mixer.time-e.startAt/1e3),l.setLoop(y2[e.loop],e.repetitions).fadeIn(e.crossFadeDuration).play(),this.activeActions.push(l)}},tick:function(r,e){this.mixer&&!isNaN(e)&&this.mixer.update(e/1e3)}});function CQ(r){return new RegExp("^"+r.split(/\*+/).map(SQ).join(".*")+"$")}function SQ(r){return r.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")}var TQ=THREE.ColladaLoader=function(r){this.manager=r!==void 0?r:THREE.DefaultLoadingManager};THREE.ColladaLoader.prototype={constructor:THREE.ColladaLoader,crossOrigin:"anonymous",load:function(r,e,i,n){var s=this,o=s.path===void 0?THREE.LoaderUtils.extractUrlBase(r):s.path,l=new THREE.FileLoader(s.manager);l.setPath(s.path),l.load(r,function(u){e(s.parse(u,o))},i,n)},setPath:function(r){return this.path=r,this},setResourcePath:function(r){return this.resourcePath=r,this},options:{set convertUpAxis(r){console.warn("THREE.ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.")}},setCrossOrigin:function(r){return this.crossOrigin=r,this},parse:function(r,e){function i(he,le){for(var de=[],xe=he.childNodes,Ee=0,ot=xe.length;Ee<ot;Ee++){var Mt=xe[Ee];Mt.nodeName===le&&de.push(Mt)}return de}function n(he){if(he.length===0)return[];for(var le=he.trim().split(/\s+/),de=new Array(le.length),xe=0,Ee=le.length;xe<Ee;xe++)de[xe]=le[xe];return de}function s(he){if(he.length===0)return[];for(var le=he.trim().split(/\s+/),de=new Array(le.length),xe=0,Ee=le.length;xe<Ee;xe++)de[xe]=parseFloat(le[xe]);return de}function o(he){if(he.length===0)return[];for(var le=he.trim().split(/\s+/),de=new Array(le.length),xe=0,Ee=le.length;xe<Ee;xe++)de[xe]=parseInt(le[xe]);return de}function l(he){return he.substring(1)}function u(){return"three_default_"+Qe++}function c(he){return Object.keys(he).length===0}function h(he){return{unit:p(i(he,"unit")[0]),upAxis:f(i(he,"up_axis")[0])}}function p(he){return he!==void 0&&he.hasAttribute("meter")===!0?parseFloat(he.getAttribute("meter")):1}function f(he){return he!==void 0?he.textContent:"Y_UP"}function g(he,le,de,xe){var Ee=i(he,le)[0];if(Ee!==void 0)for(var ot=i(Ee,de),Mt=0;Mt<ot.length;Mt++)xe(ot[Mt])}function m(he,le){for(var de in he){var xe=he[de];xe.build=le(he[de])}}function y(he,le){return he.build!==void 0||(he.build=le(he)),he.build}function b(he){for(var le={sources:{},samplers:{},channels:{}},de=0,xe=he.childNodes.length;de<xe;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1){var ot;switch(Ee.nodeName){case"source":ot=Ee.getAttribute("id"),le.sources[ot]=ce(Ee);break;case"sampler":ot=Ee.getAttribute("id"),le.samplers[ot]=v(Ee);break;case"channel":ot=Ee.getAttribute("target"),le.channels[ot]=_(Ee);break;default:console.log(Ee)}}}Ye.animations[he.getAttribute("id")]=le}function v(he){for(var le={inputs:{}},de=0,xe=he.childNodes.length;de<xe;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"input":var ot=l(Ee.getAttribute("source")),Mt=Ee.getAttribute("semantic");le.inputs[Mt]=ot;break}}return le}function _(he){var le={},de=he.getAttribute("target"),xe=de.split("/"),Ee=xe.shift(),ot=xe.shift(),Mt=ot.indexOf("(")!==-1,Wt=ot.indexOf(".")!==-1;if(Wt)xe=ot.split("."),ot=xe.shift(),le.member=xe.shift();else if(Mt){var ni=ot.split("(");ot=ni.shift();for(var Ai=0;Ai<ni.length;Ai++)ni[Ai]=parseInt(ni[Ai].replace(/\)/,""));le.indices=ni}return le.id=Ee,le.sid=ot,le.arraySyntax=Mt,le.memberSyntax=Wt,le.sampler=l(he.getAttribute("source")),le}function T(he){var le=[],de=he.channels,xe=he.samplers,Ee=he.sources;for(var ot in de)if(de.hasOwnProperty(ot)){var Mt=de[ot],Wt=xe[Mt.sampler],ni=Wt.inputs.INPUT,Ai=Wt.inputs.OUTPUT,qt=Ee[ni],Li=Ee[Ai],yr=C(Mt,qt,Li);D(yr,le)}return le}function E(he){return y(Ye.animations[he],T)}function C(he,le,de){var xe=Ye.nodes[he.id],Ee=Ui(xe.id),ot=xe.transforms[he.sid],Mt=xe.matrix.clone().transpose(),Wt,ni,Ai,qt,Li,yr,dr={};switch(ot){case"matrix":for(Ai=0,qt=le.array.length;Ai<qt;Ai++)if(Wt=le.array[Ai],ni=Ai*de.stride,dr[Wt]===void 0&&(dr[Wt]={}),he.arraySyntax===!0){var pr=de.array[ni],Wi=he.indices[0]+4*he.indices[1];dr[Wt][Wi]=pr}else for(Li=0,yr=de.stride;Li<yr;Li++)dr[Wt][Li]=de.array[ni+Li];break;case"translate":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',ot);break;case"rotate":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',ot);break;case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',ot);break}var wr=R(dr,Mt),Tr={name:Ee.uuid,keyframes:wr};return Tr}function R(he,le){var de=[];for(var xe in he)de.push({time:parseFloat(xe),value:he[xe]});de.sort(ot);for(var Ee=0;Ee<16;Ee++)P(de,Ee,le.elements[Ee]);return de;function ot(Mt,Wt){return Mt.time-Wt.time}}var B=new THREE.Vector3,I=new THREE.Vector3,N=new THREE.Quaternion;function D(he,le){for(var de=he.keyframes,xe=he.name,Ee=[],ot=[],Mt=[],Wt=[],ni=0,Ai=de.length;ni<Ai;ni++){var qt=de[ni],Li=qt.time,yr=qt.value;fe.fromArray(yr).transpose(),fe.decompose(B,N,I),Ee.push(Li),ot.push(B.x,B.y,B.z),Mt.push(N.x,N.y,N.z,N.w),Wt.push(I.x,I.y,I.z)}return ot.length>0&&le.push(new THREE.VectorKeyframeTrack(xe+".position",Ee,ot)),Mt.length>0&&le.push(new THREE.QuaternionKeyframeTrack(xe+".quaternion",Ee,Mt)),Wt.length>0&&le.push(new THREE.VectorKeyframeTrack(xe+".scale",Ee,Wt)),le}function P(he,le,de){var xe,Ee=!0,ot,Mt;for(ot=0,Mt=he.length;ot<Mt;ot++)xe=he[ot],xe.value[le]===void 0?xe.value[le]=null:Ee=!1;if(Ee===!0)for(ot=0,Mt=he.length;ot<Mt;ot++)xe=he[ot],xe.value[le]=de;else k(he,le)}function k(he,le){for(var de,xe,Ee=0,ot=he.length;Ee<ot;Ee++){var Mt=he[Ee];if(Mt.value[le]===null){if(de=q(he,Ee,le),xe=V(he,Ee,le),de===null){Mt.value[le]=xe.value[le];continue}if(xe===null){Mt.value[le]=de.value[le];continue}j(Mt,de,xe,le)}}}function q(he,le,de){for(;le>=0;){var xe=he[le];if(xe.value[de]!==null)return xe;le--}return null}function V(he,le,de){for(;le<he.length;){var xe=he[le];if(xe.value[de]!==null)return xe;le++}return null}function j(he,le,de,xe){if(de.time-le.time===0){he.value[xe]=le.value[xe];return}he.value[xe]=(he.time-le.time)*(de.value[xe]-le.value[xe])/(de.time-le.time)+le.value[xe]}function Q(he){for(var le={name:he.getAttribute("id")||"default",start:parseFloat(he.getAttribute("start")||0),end:parseFloat(he.getAttribute("end")||0),animations:[]},de=0,xe=he.childNodes.length;de<xe;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"instance_animation":le.animations.push(l(Ee.getAttribute("url")));break}}Ye.clips[he.getAttribute("id")]=le}function W(he){for(var le=[],de=he.name,xe=he.end-he.start||-1,Ee=he.animations,ot=0,Mt=Ee.length;ot<Mt;ot++)for(var Wt=E(Ee[ot]),ni=0,Ai=Wt.length;ni<Ai;ni++)le.push(Wt[ni]);return new THREE.AnimationClip(de,xe,le)}function G(he){return y(Ye.clips[he],W)}function z(he){for(var le={},de=0,xe=he.childNodes.length;de<xe;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"skin":le.id=l(Ee.getAttribute("source")),le.skin=te(Ee);break;case"morph":le.id=l(Ee.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.");break}}Ye.controllers[he.getAttribute("id")]=le}function te(he){for(var le={sources:{}},de=0,xe=he.childNodes.length;de<xe;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"bind_shape_matrix":le.bindShapeMatrix=s(Ee.textContent);break;case"source":var ot=Ee.getAttribute("id");le.sources[ot]=ce(Ee);break;case"joints":le.joints=Y(Ee);break;case"vertex_weights":le.vertexWeights=se(Ee);break}}return le}function Y(he){for(var le={inputs:{}},de=0,xe=he.childNodes.length;de<xe;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"input":var ot=Ee.getAttribute("semantic"),Mt=l(Ee.getAttribute("source"));le.inputs[ot]=Mt;break}}return le}function se(he){for(var le={inputs:{}},de=0,xe=he.childNodes.length;de<xe;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"input":var ot=Ee.getAttribute("semantic"),Mt=l(Ee.getAttribute("source")),Wt=parseInt(Ee.getAttribute("offset"));le.inputs[ot]={id:Mt,offset:Wt};break;case"vcount":le.vcount=o(Ee.textContent);break;case"v":le.v=o(Ee.textContent);break}}return le}function ve(he){var le={id:he.id},de=Ye.geometries[le.id];return he.skin!==void 0&&(le.skin=Ae(he.skin),de.sources.skinIndices=le.skin.indices,de.sources.skinWeights=le.skin.weights),le}function Ae(he){var le=4,de={joints:[],indices:{array:[],stride:le},weights:{array:[],stride:le}},xe=he.sources,Ee=he.vertexWeights,ot=Ee.vcount,Mt=Ee.v,Wt=Ee.inputs.JOINT.offset,ni=Ee.inputs.WEIGHT.offset,Ai=he.sources[he.joints.inputs.JOINT],qt=he.sources[he.joints.inputs.INV_BIND_MATRIX],Li=xe[Ee.inputs.WEIGHT.id].array,yr=0,dr,pr,Wi;for(dr=0,Wi=ot.length;dr<Wi;dr++){var wr=ot[dr],Tr=[];for(pr=0;pr<wr;pr++){var Fr=Mt[yr+Wt],Vr=Mt[yr+ni],bn=Li[Vr];Tr.push({index:Fr,weight:bn}),yr+=2}for(Tr.sort(El),pr=0;pr<le;pr++){var jr=Tr[pr];jr!==void 0?(de.indices.array.push(jr.index),de.weights.array.push(jr.weight)):(de.indices.array.push(0),de.weights.array.push(0))}}for(he.bindShapeMatrix?de.bindMatrix=new THREE.Matrix4().fromArray(he.bindShapeMatrix).transpose():de.bindMatrix=new THREE.Matrix4().identity(),dr=0,Wi=Ai.array.length;dr<Wi;dr++){var us=Ai.array[dr],Nr=new THREE.Matrix4().fromArray(qt.array,dr*qt.stride).transpose();de.joints.push({name:us,boneInverse:Nr})}return de;function El(Ko,Mc){return Mc.weight-Ko.weight}}function me(he){return y(Ye.controllers[he],ve)}function Oe(he){var le={init_from:i(he,"init_from")[0].textContent};Ye.images[he.getAttribute("id")]=le}function Xe(he){return he.build!==void 0?he.build:he.init_from}function Je(he){var le=Ye.images[he];return le!==void 0?y(le,Xe):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",he),null)}function it(he){for(var le={},de=0,xe=he.childNodes.length;de<xe;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"profile_COMMON":le.profile=dt(Ee);break}}Ye.effects[he.getAttribute("id")]=le}function dt(he){for(var le={surfaces:{},samplers:{}},de=0,xe=he.childNodes.length;de<xe;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"newparam":St(Ee,le);break;case"technique":le.technique=bi(Ee);break;case"extra":le.extra=Zi(Ee);break}}return le}function St(he,le){for(var de=he.getAttribute("sid"),xe=0,Ee=he.childNodes.length;xe<Ee;xe++){var ot=he.childNodes[xe];if(ot.nodeType===1)switch(ot.nodeName){case"surface":le.surfaces[de]=Qt(ot);break;case"sampler2D":le.samplers[de]=yt(ot);break}}}function Qt(he){for(var le={},de=0,xe=he.childNodes.length;de<xe;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"init_from":le.init_from=Ee.textContent;break}}return le}function yt(he){for(var le={},de=0,xe=he.childNodes.length;de<xe;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"source":le.source=Ee.textContent;break}}return le}function bi(he){for(var le={},de=0,xe=he.childNodes.length;de<xe;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"constant":case"lambert":case"blinn":case"phong":le.type=Ee.nodeName,le.parameters=$e(Ee);break}}return le}function $e(he){for(var le={},de=0,xe=he.childNodes.length;de<xe;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":le[Ee.nodeName]=Fi(Ee);break;case"transparent":le[Ee.nodeName]={opaque:Ee.getAttribute("opaque"),data:Fi(Ee)};break}}return le}function Fi(he){for(var le={},de=0,xe=he.childNodes.length;de<xe;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"color":le[Ee.nodeName]=s(Ee.textContent);break;case"float":le[Ee.nodeName]=parseFloat(Ee.textContent);break;case"texture":le[Ee.nodeName]={id:Ee.getAttribute("texture"),extra:ui(Ee)};break}}return le}function ui(he){for(var le={technique:{}},de=0,xe=he.childNodes.length;de<xe;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"extra":Si(Ee,le);break}}return le}function Si(he,le){for(var de=0,xe=he.childNodes.length;de<xe;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"technique":Ei(Ee,le);break}}}function Ei(he,le){for(var de=0,xe=he.childNodes.length;de<xe;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":le.technique[Ee.nodeName]=parseFloat(Ee.textContent);break;case"wrapU":case"wrapV":Ee.textContent.toUpperCase()==="TRUE"?le.technique[Ee.nodeName]=1:Ee.textContent.toUpperCase()==="FALSE"?le.technique[Ee.nodeName]=0:le.technique[Ee.nodeName]=parseInt(Ee.textContent);break}}}function Zi(he){for(var le={},de=0,xe=he.childNodes.length;de<xe;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"technique":le.technique=Vi(Ee);break}}return le}function Vi(he){for(var le={},de=0,xe=he.childNodes.length;de<xe;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"double_sided":le[Ee.nodeName]=parseInt(Ee.textContent);break}}return le}function We(he){return he}function Ce(he){return y(Ye.effects[he],We)}function At(he){for(var le={name:he.getAttribute("name")},de=0,xe=he.childNodes.length;de<xe;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"instance_effect":le.url=l(Ee.getAttribute("url"));break}}Ye.materials[he.getAttribute("id")]=le}function Ot(he){var le,de=he.slice((he.lastIndexOf(".")-1>>>0)+2);switch(de=de.toLowerCase(),de){case"tga":le=ue;break;default:le=X}return le}function Zt(he){var le=Ce(he.url),de=le.profile.technique,xe=le.profile.extra,Ee;switch(de.type){case"phong":case"blinn":Ee=new THREE.MeshPhongMaterial;break;case"lambert":Ee=new THREE.MeshLambertMaterial;break;default:Ee=new THREE.MeshBasicMaterial;break}Ee.name=he.name;function ot(yr){var dr=le.profile.samplers[yr.id],pr=null;if(dr!==void 0){var Wi=le.profile.surfaces[dr.source];pr=Je(Wi.init_from)}else console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),pr=Je(yr.id);if(pr!==null){var wr=Ot(pr);if(wr!==void 0){var Tr=wr.load(pr),Fr=yr.extra;if(Fr!==void 0&&Fr.technique!==void 0&&c(Fr.technique)===!1){var Vr=Fr.technique;Tr.wrapS=Vr.wrapU?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,Tr.wrapT=Vr.wrapV?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,Tr.offset.set(Vr.offsetU||0,Vr.offsetV||0),Tr.repeat.set(Vr.repeatU||1,Vr.repeatV||1)}else Tr.wrapS=THREE.RepeatWrapping,Tr.wrapT=THREE.RepeatWrapping;return Tr}else return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",pr),null}else return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",yr.id),null}var Mt=de.parameters;for(var Wt in Mt){var ni=Mt[Wt];switch(Wt){case"diffuse":ni.color&&Ee.color.fromArray(ni.color),ni.texture&&(Ee.map=ot(ni.texture));break;case"specular":ni.color&&Ee.specular&&Ee.specular.fromArray(ni.color),ni.texture&&(Ee.specularMap=ot(ni.texture));break;case"bump":ni.texture&&(Ee.normalMap=ot(ni.texture));break;case"ambient":ni.texture&&(Ee.lightMap=ot(ni.texture));break;case"shininess":ni.float&&Ee.shininess&&(Ee.shininess=ni.float);break;case"emission":ni.color&&Ee.emissive&&Ee.emissive.fromArray(ni.color),ni.texture&&(Ee.emissiveMap=ot(ni.texture));break}}var Ai=Mt.transparent,qt=Mt.transparency;if(qt===void 0&&Ai&&(qt={float:1}),Ai===void 0&&qt&&(Ai={opaque:"A_ONE",data:{color:[1,1,1,1]}}),Ai&&qt)if(Ai.data.texture)Ee.transparent=!0;else{var Li=Ai.data.color;switch(Ai.opaque){case"A_ONE":Ee.opacity=Li[3]*qt.float;break;case"RGB_ZERO":Ee.opacity=1-Li[0]*qt.float;break;case"A_ZERO":Ee.opacity=1-Li[3]*qt.float;break;case"RGB_ONE":Ee.opacity=Li[0]*qt.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',Ai.opaque)}Ee.opacity<1&&(Ee.transparent=!0)}return xe!==void 0&&xe.technique!==void 0&&xe.technique.double_sided===1&&(Ee.side=THREE.DoubleSide),Ee}function jt(he){return y(Ye.materials[he],Zt)}function xi(he){for(var le={name:he.getAttribute("name")},de=0,xe=he.childNodes.length;de<xe;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"optics":le.optics=vt(Ee);break}}Ye.cameras[he.getAttribute("id")]=le}function vt(he){for(var le=0;le<he.childNodes.length;le++){var de=he.childNodes[le];switch(de.nodeName){case"technique_common":return ge(de)}}return{}}function ge(he){for(var le={},de=0;de<he.childNodes.length;de++){var xe=he.childNodes[de];switch(xe.nodeName){case"perspective":case"orthographic":le.technique=xe.nodeName,le.parameters=be(xe);break}}return le}function be(he){for(var le={},de=0;de<he.childNodes.length;de++){var xe=he.childNodes[de];switch(xe.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":le[xe.nodeName]=parseFloat(xe.textContent);break}}return le}function Ne(he){var le;switch(he.optics.technique){case"perspective":le=new THREE.PerspectiveCamera(he.optics.parameters.yfov,he.optics.parameters.aspect_ratio,he.optics.parameters.znear,he.optics.parameters.zfar);break;case"orthographic":var de=he.optics.parameters.ymag,xe=he.optics.parameters.xmag,Ee=he.optics.parameters.aspect_ratio;xe=xe===void 0?de*Ee:xe,de=de===void 0?xe/Ee:de,xe*=.5,de*=.5,le=new THREE.OrthographicCamera(-xe,xe,de,-de,he.optics.parameters.znear,he.optics.parameters.zfar);break;default:le=new THREE.PerspectiveCamera;break}return le.name=he.name,le}function Se(he){var le=Ye.cameras[he];return le!==void 0?y(le,Ne):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",he),null)}function Fe(he){for(var le={},de=0,xe=he.childNodes.length;de<xe;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"technique_common":le=Ie(Ee);break}}Ye.lights[he.getAttribute("id")]=le}function Ie(he){for(var le={},de=0,xe=he.childNodes.length;de<xe;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"directional":case"point":case"spot":case"ambient":le.technique=Ee.nodeName,le.parameters=U(Ee)}}return le}function U(he){for(var le={},de=0,xe=he.childNodes.length;de<xe;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"color":var ot=s(Ee.textContent);le.color=new THREE.Color().fromArray(ot);break;case"falloff_angle":le.falloffAngle=parseFloat(Ee.textContent);break;case"quadratic_attenuation":var Mt=parseFloat(Ee.textContent);le.distance=Mt?Math.sqrt(1/Mt):0;break}}return le}function $(he){var le;switch(he.technique){case"directional":le=new THREE.DirectionalLight;break;case"point":le=new THREE.PointLight;break;case"spot":le=new THREE.SpotLight;break;case"ambient":le=new THREE.AmbientLight;break}return he.parameters.color&&le.color.copy(he.parameters.color),he.parameters.distance&&(le.distance=he.parameters.distance),le}function re(he){var le=Ye.lights[he];return le!==void 0?y(le,$):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",he),null)}function Me(he){var le={name:he.getAttribute("name"),sources:{},vertices:{},primitives:[]},de=i(he,"mesh")[0];if(de!==void 0){for(var xe=0;xe<de.childNodes.length;xe++){var Ee=de.childNodes[xe];if(Ee.nodeType===1){var ot=Ee.getAttribute("id");switch(Ee.nodeName){case"source":le.sources[ot]=ce(Ee);break;case"vertices":le.vertices=ze(Ee);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",Ee.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":le.primitives.push(Ve(Ee));break;default:console.log(Ee)}}}Ye.geometries[he.getAttribute("id")]=le}}function ce(he){for(var le={array:[],stride:3},de=0;de<he.childNodes.length;de++){var xe=he.childNodes[de];if(xe.nodeType===1)switch(xe.nodeName){case"float_array":le.array=s(xe.textContent);break;case"Name_array":le.array=n(xe.textContent);break;case"technique_common":var Ee=i(xe,"accessor")[0];Ee!==void 0&&(le.stride=parseInt(Ee.getAttribute("stride")));break}}return le}function ze(he){for(var le={},de=0;de<he.childNodes.length;de++){var xe=he.childNodes[de];xe.nodeType===1&&(le[xe.getAttribute("semantic")]=l(xe.getAttribute("source")))}return le}function Ve(he){for(var le={type:he.nodeName,material:he.getAttribute("material"),count:parseInt(he.getAttribute("count")),inputs:{},stride:0,hasUV:!1},de=0,xe=he.childNodes.length;de<xe;de++){var Ee=he.childNodes[de];if(Ee.nodeType===1)switch(Ee.nodeName){case"input":var ot=l(Ee.getAttribute("source")),Mt=Ee.getAttribute("semantic"),Wt=parseInt(Ee.getAttribute("offset")),ni=parseInt(Ee.getAttribute("set")),Ai=ni>0?Mt+ni:Mt;le.inputs[Ai]={id:ot,offset:Wt},le.stride=Math.max(le.stride,Wt+1),Mt==="TEXCOORD"&&(le.hasUV=!0);break;case"vcount":le.vcount=o(Ee.textContent);break;case"p":le.p=o(Ee.textContent);break}}return le}function pt(he){for(var le={},de=0;de<he.length;de++){var xe=he[de];le[xe.type]===void 0&&(le[xe.type]=[]),le[xe.type].push(xe)}return le}function Dt(he){for(var le=0,de=0,xe=he.length;de<xe;de++){var Ee=he[de];Ee.hasUV===!0&&le++}le>0&&le<he.length&&(he.uvsNeedsFix=!0)}function xt(he){var le={},de=he.sources,xe=he.vertices,Ee=he.primitives;if(Ee.length===0)return{};var ot=pt(Ee);for(var Mt in ot){var Wt=ot[Mt];Dt(Wt),le[Mt]=Vt(Wt,de,xe)}return le}function Vt(he,le,de){for(var xe={},Ee={array:[],stride:0},ot={array:[],stride:0},Mt={array:[],stride:0},Wt={array:[],stride:0},ni={array:[],stride:0},Ai={array:[],stride:4},qt={array:[],stride:4},Li=new THREE.BufferGeometry,yr=[],dr=0,pr=0;pr<he.length;pr++){var Wi=he[pr],wr=Wi.inputs,Tr=0;switch(Wi.type){case"lines":case"linestrips":Tr=Wi.count*2;break;case"triangles":Tr=Wi.count*3;break;case"polylist":for(var Fr=0;Fr<Wi.count;Fr++){var Vr=Wi.vcount[Fr];switch(Vr){case 3:Tr+=3;break;case 4:Tr+=6;break;default:Tr+=(Vr-2)*3;break}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",Wi.type)}Li.addGroup(dr,Tr,pr),dr+=Tr,Wi.material&&yr.push(Wi.material);for(var bn in wr){var jr=wr[bn];switch(bn){case"VERTEX":for(var us in de){var Nr=de[us];switch(us){case"POSITION":var El=Ee.array.length;if(fi(Wi,le[Nr],jr.offset,Ee.array),Ee.stride=le[Nr].stride,le.skinWeights&&le.skinIndices&&(fi(Wi,le.skinIndices,jr.offset,Ai.array),fi(Wi,le.skinWeights,jr.offset,qt.array)),Wi.hasUV===!1&&he.uvsNeedsFix===!0)for(var Tr=(Ee.array.length-El)/Ee.stride,Ko=0;Ko<Tr;Ko++)Mt.array.push(0,0);break;case"NORMAL":fi(Wi,le[Nr],jr.offset,ot.array),ot.stride=le[Nr].stride;break;case"COLOR":fi(Wi,le[Nr],jr.offset,ni.array),ni.stride=le[Nr].stride;break;case"TEXCOORD":fi(Wi,le[Nr],jr.offset,Mt.array),Mt.stride=le[Nr].stride;break;case"TEXCOORD1":fi(Wi,le[Nr],jr.offset,Wt.array),Mt.stride=le[Nr].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',us)}}break;case"NORMAL":fi(Wi,le[jr.id],jr.offset,ot.array),ot.stride=le[jr.id].stride;break;case"COLOR":fi(Wi,le[jr.id],jr.offset,ni.array),ni.stride=le[jr.id].stride;break;case"TEXCOORD":fi(Wi,le[jr.id],jr.offset,Mt.array),Mt.stride=le[jr.id].stride;break;case"TEXCOORD1":fi(Wi,le[jr.id],jr.offset,Wt.array),Wt.stride=le[jr.id].stride;break}}}return Ee.array.length>0&&Li.addAttribute("position",new THREE.Float32BufferAttribute(Ee.array,Ee.stride)),ot.array.length>0&&Li.addAttribute("normal",new THREE.Float32BufferAttribute(ot.array,ot.stride)),ni.array.length>0&&Li.addAttribute("color",new THREE.Float32BufferAttribute(ni.array,ni.stride)),Mt.array.length>0&&Li.addAttribute("uv",new THREE.Float32BufferAttribute(Mt.array,Mt.stride)),Wt.array.length>0&&Li.addAttribute("uv2",new THREE.Float32BufferAttribute(Wt.array,Wt.stride)),Ai.array.length>0&&Li.addAttribute("skinIndex",new THREE.Float32BufferAttribute(Ai.array,Ai.stride)),qt.array.length>0&&Li.addAttribute("skinWeight",new THREE.Float32BufferAttribute(qt.array,qt.stride)),xe.data=Li,xe.type=he[0].type,xe.materialKeys=yr,xe}function fi(he,le,de,xe){var Ee=he.p,ot=he.stride,Mt=he.vcount;function Wt(bn){for(var jr=Ee[bn+de]*Ai,us=jr+Ai;jr<us;jr++)xe.push(ni[jr])}var ni=le.array,Ai=le.stride;if(he.vcount!==void 0)for(var qt=0,Li=0,yr=Mt.length;Li<yr;Li++){var dr=Mt[Li];if(dr===4){var pr=qt+ot*0,Wi=qt+ot*1,wr=qt+ot*2,Tr=qt+ot*3;Wt(pr),Wt(Wi),Wt(Tr),Wt(Wi),Wt(wr),Wt(Tr)}else if(dr===3){var pr=qt+ot*0,Wi=qt+ot*1,wr=qt+ot*2;Wt(pr),Wt(Wi),Wt(wr)}else if(dr>4)for(var Fr=1,Vr=dr-2;Fr<=Vr;Fr++){var pr=qt+ot*0,Wi=qt+ot*Fr,wr=qt+ot*(Fr+1);Wt(pr),Wt(Wi),Wt(wr)}qt+=ot*dr}else for(var Li=0,yr=Ee.length;Li<yr;Li+=ot)Wt(Li)}function xr(he){return y(Ye.geometries[he],xt)}function ki(he){for(var le={name:he.getAttribute("name")||"",joints:{},links:[]},de=0;de<he.childNodes.length;de++){var xe=he.childNodes[de];if(xe.nodeType===1)switch(xe.nodeName){case"technique_common":rn(xe,le);break}}Ye.kinematicsModels[he.getAttribute("id")]=le}function mn(he){return he.build!==void 0?he.build:he}function kr(he){return y(Ye.kinematicsModels[he],mn)}function rn(he,le){for(var de=0;de<he.childNodes.length;de++){var xe=he.childNodes[de];if(xe.nodeType===1)switch(xe.nodeName){case"joint":le.joints[xe.getAttribute("sid")]=vs(xe);break;case"link":le.links.push(Ls(xe));break}}}function vs(he){for(var le,de=0;de<he.childNodes.length;de++){var xe=he.childNodes[de];if(xe.nodeType===1)switch(xe.nodeName){case"prismatic":case"revolute":le=gn(xe);break}}return le}function gn(he,le){for(var le={sid:he.getAttribute("sid"),name:he.getAttribute("name")||"",axis:new THREE.Vector3,limits:{min:0,max:0},type:he.nodeName,static:!1,zeroPosition:0,middlePosition:0},de=0;de<he.childNodes.length;de++){var xe=he.childNodes[de];if(xe.nodeType===1)switch(xe.nodeName){case"axis":var Ee=s(xe.textContent);le.axis.fromArray(Ee);break;case"limits":var ot=xe.getElementsByTagName("max")[0],Mt=xe.getElementsByTagName("min")[0];le.limits.max=parseFloat(ot.textContent),le.limits.min=parseFloat(Mt.textContent);break}}return le.limits.min>=le.limits.max&&(le.static=!0),le.middlePosition=(le.limits.min+le.limits.max)/2,le}function Ls(he){for(var le={sid:he.getAttribute("sid"),name:he.getAttribute("name")||"",attachments:[],transforms:[]},de=0;de<he.childNodes.length;de++){var xe=he.childNodes[de];if(xe.nodeType===1)switch(xe.nodeName){case"attachment_full":le.attachments.push(es(xe));break;case"matrix":case"translate":case"rotate":le.transforms.push(bs(xe));break}}return le}function es(he){for(var le={joint:he.getAttribute("joint").split("/").pop(),transforms:[],links:[]},de=0;de<he.childNodes.length;de++){var xe=he.childNodes[de];if(xe.nodeType===1)switch(xe.nodeName){case"link":le.links.push(Ls(xe));break;case"matrix":case"translate":case"rotate":le.transforms.push(bs(xe));break}}return le}function bs(he){var le={type:he.nodeName},de=s(he.textContent);switch(le.type){case"matrix":le.obj=new THREE.Matrix4,le.obj.fromArray(de).transpose();break;case"translate":le.obj=new THREE.Vector3,le.obj.fromArray(de);break;case"rotate":le.obj=new THREE.Vector3,le.obj.fromArray(de),le.angle=THREE.MathUtils.degToRad(de[3]);break}return le}function pe(he){for(var le={name:he.getAttribute("name")||"",rigidBodies:{}},de=0;de<he.childNodes.length;de++){var xe=he.childNodes[de];if(xe.nodeType===1)switch(xe.nodeName){case"rigid_body":le.rigidBodies[xe.getAttribute("name")]={},ct(xe,le.rigidBodies[xe.getAttribute("name")]);break}}Ye.physicsModels[he.getAttribute("id")]=le}function ct(he,le){for(var de=0;de<he.childNodes.length;de++){var xe=he.childNodes[de];if(xe.nodeType===1)switch(xe.nodeName){case"technique_common":Rt(xe,le);break}}}function Rt(he,le){for(var de=0;de<he.childNodes.length;de++){var xe=he.childNodes[de];if(xe.nodeType===1)switch(xe.nodeName){case"inertia":le.inertia=s(xe.textContent);break;case"mass":le.mass=s(xe.textContent)[0];break}}}function Kt(he){for(var le={bindJointAxis:[]},de=0;de<he.childNodes.length;de++){var xe=he.childNodes[de];if(xe.nodeType===1)switch(xe.nodeName){case"bind_joint_axis":le.bindJointAxis.push(Bi(xe));break}}Ye.kinematicsScenes[l(he.getAttribute("url"))]=le}function Bi(he){for(var le={target:he.getAttribute("target").split("/").pop()},de=0;de<he.childNodes.length;de++){var xe=he.childNodes[de];if(xe.nodeType===1)switch(xe.nodeName){case"axis":var Ee=xe.getElementsByTagName("param")[0];le.axis=Ee.textContent;var ot=le.axis.split("inst_").pop().split("axis")[0];le.jointIndex=ot.substr(0,ot.length-1);break}}return le}function sr(he){return he.build!==void 0?he.build:he}function Di(he){return y(Ye.kinematicsScenes[he],sr)}function Oi(){var he=Object.keys(Ye.kinematicsModels)[0],le=Object.keys(Ye.kinematicsScenes)[0],de=Object.keys(Ye.visualScenes)[0];if(he===void 0||le===void 0)return;for(var xe=kr(he),Ee=Di(le),ot=_i(de),Mt=Ee.bindJointAxis,Wt={},ni=0,Ai=Mt.length;ni<Ai;ni++){var qt=Mt[ni],Li=ar.querySelector('[sid="'+qt.target+'"]');if(Li){var yr=Li.parentElement;dr(qt.jointIndex,yr)}}function dr(Wi,wr){var Tr=wr.getAttribute("name"),Fr=xe.joints[Wi];ot.traverse(function(Vr){Vr.name===Tr&&(Wt[Wi]={object:Vr,transforms:Be(wr),joint:Fr,position:Fr.zeroPosition})})}var pr=new THREE.Matrix4;Te={joints:xe&&xe.joints,getJointValue:function(Wi){var wr=Wt[Wi];if(wr)return wr.position;console.warn("THREE.ColladaLoader: Joint "+Wi+" doesn't exist.")},setJointValue:function(Wi,wr){var Tr=Wt[Wi];if(Tr){var Fr=Tr.joint;if(wr>Fr.limits.max||wr<Fr.limits.min)console.warn("THREE.ColladaLoader: Joint "+Wi+" value "+wr+" outside of limits (min: "+Fr.limits.min+", max: "+Fr.limits.max+").");else if(Fr.static)console.warn("THREE.ColladaLoader: Joint "+Wi+" is static.");else{var Vr=Tr.object,bn=Fr.axis,jr=Tr.transforms;fe.identity();for(var us=0;us<jr.length;us++){var Nr=jr[us];if(Nr.sid&&Nr.sid.indexOf(Wi)!==-1)switch(Fr.type){case"revolute":fe.multiply(pr.makeRotationAxis(bn,THREE.MathUtils.degToRad(wr)));break;case"prismatic":fe.multiply(pr.makeTranslation(bn.x*wr,bn.y*wr,bn.z*wr));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+Fr.type);break}else switch(Nr.type){case"matrix":fe.multiply(Nr.obj);break;case"translate":fe.multiply(pr.makeTranslation(Nr.obj.x,Nr.obj.y,Nr.obj.z));break;case"scale":fe.scale(Nr.obj);break;case"rotate":fe.multiply(pr.makeRotationAxis(Nr.obj,Nr.angle));break}}Vr.matrix.copy(fe),Vr.matrix.decompose(Vr.position,Vr.quaternion,Vr.scale),Wt[Wi].position=wr}}else console.log("THREE.ColladaLoader: "+Wi+" does not exist.")}}}function Be(he){for(var le=[],de=ar.querySelector('[id="'+he.id+'"]'),xe=0;xe<de.childNodes.length;xe++){var Ee=de.childNodes[xe];if(Ee.nodeType===1)switch(Ee.nodeName){case"matrix":var Mt=s(Ee.textContent),ot=new THREE.Matrix4().fromArray(Mt).transpose();le.push({sid:Ee.getAttribute("sid"),type:Ee.nodeName,obj:ot});break;case"translate":case"scale":var Mt=s(Ee.textContent),Wt=new THREE.Vector3().fromArray(Mt);le.push({sid:Ee.getAttribute("sid"),type:Ee.nodeName,obj:Wt});break;case"rotate":var Mt=s(Ee.textContent),Wt=new THREE.Vector3().fromArray(Mt),ni=THREE.MathUtils.degToRad(Mt[3]);le.push({sid:Ee.getAttribute("sid"),type:Ee.nodeName,obj:Wt,angle:ni});break}}return le}function ae(he){for(var le=he.getElementsByTagName("node"),de=0;de<le.length;de++){var xe=le[de];xe.hasAttribute("id")===!1&&xe.setAttribute("id",u())}}var fe=new THREE.Matrix4,Le=new THREE.Vector3;function Ue(he){for(var le={name:he.getAttribute("name")||"",type:he.getAttribute("type"),id:he.getAttribute("id"),sid:he.getAttribute("sid"),matrix:new THREE.Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}},de=0;de<he.childNodes.length;de++){var xe=he.childNodes[de];if(xe.nodeType===1)switch(xe.nodeName){case"node":le.nodes.push(xe.getAttribute("id")),Ue(xe);break;case"instance_camera":le.instanceCameras.push(l(xe.getAttribute("url")));break;case"instance_controller":le.instanceControllers.push(Ke(xe));break;case"instance_light":le.instanceLights.push(l(xe.getAttribute("url")));break;case"instance_geometry":le.instanceGeometries.push(Ke(xe));break;case"instance_node":le.instanceNodes.push(l(xe.getAttribute("url")));break;case"matrix":var ot=s(xe.textContent);le.matrix.multiply(fe.fromArray(ot).transpose()),le.transforms[xe.getAttribute("sid")]=xe.nodeName;break;case"translate":var ot=s(xe.textContent);Le.fromArray(ot),le.matrix.multiply(fe.makeTranslation(Le.x,Le.y,Le.z)),le.transforms[xe.getAttribute("sid")]=xe.nodeName;break;case"rotate":var ot=s(xe.textContent),Ee=THREE.MathUtils.degToRad(ot[3]);le.matrix.multiply(fe.makeRotationAxis(Le.fromArray(ot),Ee)),le.transforms[xe.getAttribute("sid")]=xe.nodeName;break;case"scale":var ot=s(xe.textContent);le.matrix.scale(Le.fromArray(ot)),le.transforms[xe.getAttribute("sid")]=xe.nodeName;break;case"extra":break;default:console.log(xe)}}return wi(le.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",le.id):Ye.nodes[le.id]=le,le}function Ke(he){for(var le={id:l(he.getAttribute("url")),materials:{},skeletons:[]},de=0;de<he.childNodes.length;de++){var xe=he.childNodes[de];switch(xe.nodeName){case"bind_material":for(var Ee=xe.getElementsByTagName("instance_material"),ot=0;ot<Ee.length;ot++){var Mt=Ee[ot],Wt=Mt.getAttribute("symbol"),ni=Mt.getAttribute("target");le.materials[Wt]=l(ni)}break;case"skeleton":le.skeletons.push(l(xe.textContent));break}}return le}function lt(he,le){var de=[],xe=[],Ee,ot,Mt;for(Ee=0;Ee<he.length;Ee++){var Wt=he[Ee],ni;if(wi(Wt))ni=Ui(Wt),Tt(ni,le,de);else if($i(Wt))for(var Ai=Ye.visualScenes[Wt],qt=Ai.children,ot=0;ot<qt.length;ot++){var Li=qt[ot];if(Li.type==="JOINT"){var ni=Ui(Li.id);Tt(ni,le,de)}}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",Wt)}for(Ee=0;Ee<le.length;Ee++)for(ot=0;ot<de.length;ot++)if(Mt=de[ot],Mt.bone.name===le[Ee].name){xe[Ee]=Mt,Mt.processed=!0;break}for(Ee=0;Ee<de.length;Ee++)Mt=de[Ee],Mt.processed===!1&&(xe.push(Mt),Mt.processed=!0);var yr=[],dr=[];for(Ee=0;Ee<xe.length;Ee++)Mt=xe[Ee],yr.push(Mt.bone),dr.push(Mt.boneInverse);return new THREE.Skeleton(yr,dr)}function Tt(he,le,de){he.traverse(function(xe){if(xe.isBone===!0){for(var Ee,ot=0;ot<le.length;ot++){var Mt=le[ot];if(Mt.name===xe.name){Ee=Mt.boneInverse;break}}Ee===void 0&&(Ee=new THREE.Matrix4),de.push({bone:xe,boneInverse:Ee,processed:!1})}})}function Yt(he){for(var le=[],de=he.matrix,xe=he.nodes,Ee=he.type,ot=he.instanceCameras,Mt=he.instanceControllers,Wt=he.instanceLights,ni=he.instanceGeometries,Ai=he.instanceNodes,qt=0,Li=xe.length;qt<Li;qt++)le.push(Ui(xe[qt]));for(var qt=0,Li=ot.length;qt<Li;qt++){var yr=Se(ot[qt]);yr!==null&&le.push(yr.clone())}for(var qt=0,Li=Mt.length;qt<Li;qt++)for(var dr=Mt[qt],pr=me(dr.id),Wi=xr(pr.id),wr=ri(Wi,dr.materials),Tr=dr.skeletons,Fr=pr.skin.joints,Vr=lt(Tr,Fr),bn=0,jr=wr.length;bn<jr;bn++){var Nr=wr[bn];Nr.isSkinnedMesh&&(Nr.bind(Vr,pr.skin.bindMatrix),Nr.normalizeSkinWeights()),le.push(Nr)}for(var qt=0,Li=Wt.length;qt<Li;qt++){var us=re(Wt[qt]);us!==null&&le.push(us.clone())}for(var qt=0,Li=ni.length;qt<Li;qt++)for(var dr=ni[qt],Wi=xr(dr.id),wr=ri(Wi,dr.materials),bn=0,jr=wr.length;bn<jr;bn++)le.push(wr[bn]);for(var qt=0,Li=Ai.length;qt<Li;qt++)le.push(Ui(Ai[qt]).clone());var Nr;if(xe.length===0&&le.length===1)Nr=le[0];else{Nr=Ee==="JOINT"?new THREE.Bone:new THREE.Group;for(var qt=0;qt<le.length;qt++)Nr.add(le[qt])}return Nr.name===""&&(Nr.name=Ee==="JOINT"?he.sid:he.name),Nr.matrix.copy(de),Nr.matrix.decompose(Nr.position,Nr.quaternion,Nr.scale),Nr}var $t=new THREE.MeshBasicMaterial({color:16711935});function Bt(he,le){for(var de=[],xe=0,Ee=he.length;xe<Ee;xe++){var ot=le[he[xe]];ot===void 0?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",he[xe]),de.push($t)):de.push(jt(ot))}return de}function ri(he,le){var de=[];for(var xe in he){var Ee=he[xe],ot=Bt(Ee.materialKeys,le);ot.length===0&&(xe==="lines"||xe==="linestrips"?ot.push(new THREE.LineBasicMaterial):ot.push(new THREE.MeshPhongMaterial));var Mt=Ee.data.attributes.skinIndex!==void 0;if(Mt)for(var Wt=0,ni=ot.length;Wt<ni;Wt++)ot[Wt].skinning=!0;var Ai=ot.length===1?ot[0]:ot,qt;switch(xe){case"lines":qt=new THREE.LineSegments(Ee.data,Ai);break;case"linestrips":qt=new THREE.Line(Ee.data,Ai);break;case"triangles":case"polylist":Mt?qt=new THREE.SkinnedMesh(Ee.data,Ai):qt=new THREE.Mesh(Ee.data,Ai);break}de.push(qt)}return de}function wi(he){return Ye.nodes[he]!==void 0}function Ui(he){return y(Ye.nodes[he],Yt)}function Sr(he){var le={name:he.getAttribute("name"),children:[]};ae(he);for(var de=i(he,"node"),xe=0;xe<de.length;xe++)le.children.push(Ue(de[xe]));Ye.visualScenes[he.getAttribute("id")]=le}function ur(he){var le=new THREE.Group;le.name=he.name;for(var de=he.children,xe=0;xe<de.length;xe++){var Ee=de[xe];le.add(Ui(Ee.id))}return le}function $i(he){return Ye.visualScenes[he]!==void 0}function _i(he){return y(Ye.visualScenes[he],ur)}function Mn(he){var le=i(he,"instance_visual_scene")[0];return _i(l(le.getAttribute("url")))}function Xn(){var he=Ye.clips;if(c(he)===!0){if(c(Ye.animations)===!1){var le=[];for(var de in Ye.animations)for(var xe=E(de),Ee=0,ot=xe.length;Ee<ot;Ee++)le.push(xe[Ee]);ye.push(new THREE.AnimationClip("default",-1,le))}}else for(var de in he)ye.push(G(de))}if(r.length===0)return{scene:new THREE.Scene};var Ii=new DOMParser().parseFromString(r,"application/xml"),ar=i(Ii,"COLLADA")[0],hn=ar.getAttribute("version");console.log("THREE.ColladaLoader: File version",hn);var qr=h(i(ar,"asset")[0]),X=new THREE.TextureLoader(this.manager);X.setPath(this.resourcePath||e).setCrossOrigin(this.crossOrigin);var ue;THREE.TGALoader&&(ue=new THREE.TGALoader(this.manager),ue.setPath(this.resourcePath||e));var ye=[],Te={},Qe=0,Ye={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};g(ar,"library_animations","animation",b),g(ar,"library_animation_clips","animation_clip",Q),g(ar,"library_controllers","controller",z),g(ar,"library_images","image",Oe),g(ar,"library_effects","effect",it),g(ar,"library_materials","material",At),g(ar,"library_cameras","camera",xi),g(ar,"library_lights","light",Fe),g(ar,"library_geometries","geometry",Me),g(ar,"library_nodes","node",Ue),g(ar,"library_visual_scenes","visual_scene",Sr),g(ar,"library_kinematics_models","kinematics_model",ki),g(ar,"library_physics_models","physics_model",pe),g(ar,"scene","instance_kinematics_scene",Kt),m(Ye.animations,T),m(Ye.clips,W),m(Ye.controllers,ve),m(Ye.images,Xe),m(Ye.effects,We),m(Ye.materials,Zt),m(Ye.cameras,Ne),m(Ye.lights,$),m(Ye.geometries,xt),m(Ye.visualScenes,ur),Xn(),Oi();var mt=Mn(i(ar,"scene")[0]);return qr.upAxis==="Z_UP"&&mt.quaternion.setFromEuler(new THREE.Euler(-Math.PI/2,0,0)),mt.scale.multiplyScalar(qr.unit),{animations:ye,kinematics:Te,library:Ye,scene:mt}}},THREE.ColladaLoader=TQ,AFRAME.registerComponent("collada-model-legacy",{schema:{type:"asset"},init:function(){this.model=null,this.loader=new THREE.ColladaLoader},update:function(){var r=this,e=this.el,i=this.data,n=this.el.sceneEl.systems.renderer;i&&(this.remove(),this.loader.load(i,function(s){r.model=s.scene,r.model.traverse(function(o){if(o.isMesh){var l=o.material;l.color&&n.applyColorCorrection(l.color),l.map&&n.applyColorCorrection(l.map),l.emissive&&n.applyColorCorrection(l.emissive),l.emissiveMap&&n.applyColorCorrection(l.emissiveMap)}}),e.setObject3D("mesh",r.model),e.emit("model-loaded",{format:"collada",model:r.model})}))},remove:function(){this.model&&this.el.removeObject3D("mesh")}});/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const uN="164",v2=0,MQ=1,hN=1,dN=100,pN=204,fN=205,mN=3,b2=0,gN="attached",RQ="detached",AN=300,IQ=303,nb=1e3,Uf=1001,yN=1002,sb=1003,BQ=1006,LQ=1008,DQ=1009,NQ=1014,vN=1015,PQ=1020,bN=1023,x2=1026,xN=1027,ab=2300,ob=2301,_2=2302,_N=2400,EN=2401,wN=2402,OQ=2500,CN=0,SN="",Il="srgb",E2="srgb-linear",kQ="display-p3",TN="display-p3-linear",w2="linear",MN="srgb",RN="rec709",IN="p3",zf=7680,BN=519,FQ=515,LN=35044,Zd=2e3,C2=2001;let lb=class{addEventListener(r,e){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[r]===void 0&&(i[r]=[]),i[r].indexOf(e)===-1&&i[r].push(e)}hasEventListener(r,e){if(this._listeners===void 0)return!1;const i=this._listeners;return i[r]!==void 0&&i[r].indexOf(e)!==-1}removeEventListener(r,e){if(this._listeners===void 0)return;const i=this._listeners[r];if(i!==void 0){const n=i.indexOf(e);n!==-1&&i.splice(n,1)}}dispatchEvent(r){if(this._listeners===void 0)return;const e=this._listeners[r.type];if(e!==void 0){r.target=this;const i=e.slice(0);for(let n=0,s=i.length;n<s;n++)i[n].call(this,r);r.target=null}}};const Ya=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let DN=1234567;const H0=Math.PI/180,W0=180/Math.PI;function Dh(){const r=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(Ya[r&255]+Ya[r>>8&255]+Ya[r>>16&255]+Ya[r>>24&255]+"-"+Ya[e&255]+Ya[e>>8&255]+"-"+Ya[e>>16&15|64]+Ya[e>>24&255]+"-"+Ya[i&63|128]+Ya[i>>8&255]+"-"+Ya[i>>16&255]+Ya[i>>24&255]+Ya[n&255]+Ya[n>>8&255]+Ya[n>>16&255]+Ya[n>>24&255]).toLowerCase()}function Pa(r,e,i){return Math.max(e,Math.min(i,r))}function S2(r,e){return(r%e+e)%e}function UQ(r,e,i,n,s){return n+(r-e)*(s-n)/(i-e)}function zQ(r,e,i){return r!==e?(i-r)/(e-r):0}function Q0(r,e,i){return(1-i)*r+i*e}function jQ(r,e,i,n){return Q0(r,e,1-Math.exp(-i*n))}function VQ(r,e=1){return e-Math.abs(S2(r,e*2)-e)}function GQ(r,e,i){return r<=e?0:r>=i?1:(r=(r-e)/(i-e),r*r*(3-2*r))}function HQ(r,e,i){return r<=e?0:r>=i?1:(r=(r-e)/(i-e),r*r*r*(r*(r*6-15)+10))}function WQ(r,e){return r+Math.floor(Math.random()*(e-r+1))}function QQ(r,e){return r+Math.random()*(e-r)}function qQ(r){return r*(.5-Math.random())}function XQ(r){r!==void 0&&(DN=r);let e=DN+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function YQ(r){return r*H0}function KQ(r){return r*W0}function JQ(r){return(r&r-1)===0&&r!==0}function ZQ(r){return Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function $Q(r){return Math.pow(2,Math.floor(Math.log(r)/Math.LN2))}function eq(r,e,i,n,s){const o=Math.cos,l=Math.sin,u=o(i/2),c=l(i/2),h=o((e+n)/2),p=l((e+n)/2),f=o((e-n)/2),g=l((e-n)/2),m=o((n-e)/2),y=l((n-e)/2);switch(s){case"XYX":r.set(u*p,c*f,c*g,u*h);break;case"YZY":r.set(c*g,u*p,c*f,u*h);break;case"ZXZ":r.set(c*f,c*g,u*p,u*h);break;case"XZX":r.set(u*p,c*y,c*m,u*h);break;case"YXY":r.set(c*m,u*p,c*y,u*h);break;case"ZYZ":r.set(c*y,c*m,u*p,u*h);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function jf(r,e){switch(e.constructor){case Float32Array:return r;case Uint32Array:return r/4294967295;case Uint16Array:return r/65535;case Uint8Array:return r/255;case Int32Array:return Math.max(r/2147483647,-1);case Int16Array:return Math.max(r/32767,-1);case Int8Array:return Math.max(r/127,-1);default:throw new Error("Invalid component type.")}}function ho(r,e){switch(e.constructor){case Float32Array:return r;case Uint32Array:return Math.round(r*4294967295);case Uint16Array:return Math.round(r*65535);case Uint8Array:return Math.round(r*255);case Int32Array:return Math.round(r*2147483647);case Int16Array:return Math.round(r*32767);case Int8Array:return Math.round(r*127);default:throw new Error("Invalid component type.")}}const po={DEG2RAD:H0,RAD2DEG:W0,generateUUID:Dh,clamp:Pa,euclideanModulo:S2,mapLinear:UQ,inverseLerp:zQ,lerp:Q0,damp:jQ,pingpong:VQ,smoothstep:GQ,smootherstep:HQ,randInt:WQ,randFloat:QQ,randFloatSpread:qQ,seededRandom:XQ,degToRad:YQ,radToDeg:KQ,isPowerOfTwo:JQ,ceilPowerOfTwo:ZQ,floorPowerOfTwo:$Q,setQuaternionFromProperEuler:eq,normalize:ho,denormalize:jf};let Ws=class bG{constructor(e=0,i=0){bG.prototype.isVector2=!0,this.x=e,this.y=i}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,i){return this.x=e,this.y=i,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const i=this.x,n=this.y,s=e.elements;return this.x=s[0]*i+s[3]*n+s[6],this.y=s[1]*i+s[4]*n+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this}clampLength(e,i){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(i,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const n=this.dot(e)/i;return Math.acos(Pa(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,n=this.y-e.y;return i*i+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this}lerpVectors(e,i,n){return this.x=e.x+(i.x-e.x)*n,this.y=e.y+(i.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this}rotateAround(e,i){const n=Math.cos(i),s=Math.sin(i),o=this.x-e.x,l=this.y-e.y;return this.x=o*n-l*s+e.x,this.y=o*s+l*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},Nh=class xG{constructor(e,i,n,s,o,l,u,c,h){xG.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,i,n,s,o,l,u,c,h)}set(e,i,n,s,o,l,u,c,h){const p=this.elements;return p[0]=e,p[1]=s,p[2]=u,p[3]=i,p[4]=o,p[5]=c,p[6]=n,p[7]=l,p[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const i=this.elements,n=e.elements;return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],this}extractBasis(e,i,n){return e.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const i=e.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const n=e.elements,s=i.elements,o=this.elements,l=n[0],u=n[3],c=n[6],h=n[1],p=n[4],f=n[7],g=n[2],m=n[5],y=n[8],b=s[0],v=s[3],_=s[6],T=s[1],E=s[4],C=s[7],R=s[2],B=s[5],I=s[8];return o[0]=l*b+u*T+c*R,o[3]=l*v+u*E+c*B,o[6]=l*_+u*C+c*I,o[1]=h*b+p*T+f*R,o[4]=h*v+p*E+f*B,o[7]=h*_+p*C+f*I,o[2]=g*b+m*T+y*R,o[5]=g*v+m*E+y*B,o[8]=g*_+m*C+y*I,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=e,i[4]*=e,i[7]*=e,i[2]*=e,i[5]*=e,i[8]*=e,this}determinant(){const e=this.elements,i=e[0],n=e[1],s=e[2],o=e[3],l=e[4],u=e[5],c=e[6],h=e[7],p=e[8];return i*l*p-i*u*h-n*o*p+n*u*c+s*o*h-s*l*c}invert(){const e=this.elements,i=e[0],n=e[1],s=e[2],o=e[3],l=e[4],u=e[5],c=e[6],h=e[7],p=e[8],f=p*l-u*h,g=u*c-p*o,m=h*o-l*c,y=i*f+n*g+s*m;if(y===0)return this.set(0,0,0,0,0,0,0,0,0);const b=1/y;return e[0]=f*b,e[1]=(s*h-p*n)*b,e[2]=(u*n-s*l)*b,e[3]=g*b,e[4]=(p*i-s*c)*b,e[5]=(s*o-u*i)*b,e[6]=m*b,e[7]=(n*c-h*i)*b,e[8]=(l*i-n*o)*b,this}transpose(){let e;const i=this.elements;return e=i[1],i[1]=i[3],i[3]=e,e=i[2],i[2]=i[6],i[6]=e,e=i[5],i[5]=i[7],i[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const i=this.elements;return e[0]=i[0],e[1]=i[3],e[2]=i[6],e[3]=i[1],e[4]=i[4],e[5]=i[7],e[6]=i[2],e[7]=i[5],e[8]=i[8],this}setUvTransform(e,i,n,s,o,l,u){const c=Math.cos(o),h=Math.sin(o);return this.set(n*c,n*h,-n*(c*l+h*u)+l+e,-s*h,s*c,-s*(-h*l+c*u)+u+i,0,0,1),this}scale(e,i){return this.premultiply(T2.makeScale(e,i)),this}rotate(e){return this.premultiply(T2.makeRotation(-e)),this}translate(e,i){return this.premultiply(T2.makeTranslation(e,i)),this}makeTranslation(e,i){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,i,0,0,1),this}makeRotation(e){const i=Math.cos(e),n=Math.sin(e);return this.set(i,-n,0,n,i,0,0,0,1),this}makeScale(e,i){return this.set(e,0,0,0,i,0,0,0,1),this}equals(e){const i=this.elements,n=e.elements;for(let s=0;s<9;s++)if(i[s]!==n[s])return!1;return!0}fromArray(e,i=0){for(let n=0;n<9;n++)this.elements[n]=e[n+i];return this}toArray(e=[],i=0){const n=this.elements;return e[i]=n[0],e[i+1]=n[1],e[i+2]=n[2],e[i+3]=n[3],e[i+4]=n[4],e[i+5]=n[5],e[i+6]=n[6],e[i+7]=n[7],e[i+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}};const T2=new Nh;function tq(r){for(let e=r.length-1;e>=0;--e)if(r[e]>=65535)return!0;return!1}function M2(r){return document.createElementNS("http://www.w3.org/1999/xhtml",r)}const NN={};function iq(r){r in NN||(NN[r]=!0,console.warn(r))}const PN=new Nh().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),ON=new Nh().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),cb={[E2]:{transfer:w2,primaries:RN,toReference:r=>r,fromReference:r=>r},[Il]:{transfer:MN,primaries:RN,toReference:r=>r.convertSRGBToLinear(),fromReference:r=>r.convertLinearToSRGB()},[TN]:{transfer:w2,primaries:IN,toReference:r=>r.applyMatrix3(ON),fromReference:r=>r.applyMatrix3(PN)},[kQ]:{transfer:MN,primaries:IN,toReference:r=>r.convertSRGBToLinear().applyMatrix3(ON),fromReference:r=>r.applyMatrix3(PN).convertLinearToSRGB()}},rq=new Set([E2,TN]),Kl={enabled:!0,_workingColorSpace:E2,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(r){if(!rq.has(r))throw new Error(`Unsupported working color space, "${r}".`);this._workingColorSpace=r},convert:function(r,e,i){if(this.enabled===!1||e===i||!e||!i)return r;const n=cb[e].toReference,s=cb[i].fromReference;return s(n(r))},fromWorkingColorSpace:function(r,e){return this.convert(r,this._workingColorSpace,e)},toWorkingColorSpace:function(r,e){return this.convert(r,e,this._workingColorSpace)},getPrimaries:function(r){return cb[r].primaries},getTransfer:function(r){return r===SN?w2:cb[r].transfer}};function Vf(r){return r<.04045?r*.0773993808:Math.pow(r*.9478672986+.0521327014,2.4)}function R2(r){return r<.0031308?r*12.92:1.055*Math.pow(r,.41666)-.055}let Gf,nq=class{static getDataURL(r){if(/^data:/i.test(r.src)||typeof HTMLCanvasElement>"u")return r.src;let e;if(r instanceof HTMLCanvasElement)e=r;else{Gf===void 0&&(Gf=M2("canvas")),Gf.width=r.width,Gf.height=r.height;const i=Gf.getContext("2d");r instanceof ImageData?i.putImageData(r,0,0):i.drawImage(r,0,0,r.width,r.height),e=Gf}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",r),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(r){if(typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap){const e=M2("canvas");e.width=r.width,e.height=r.height;const i=e.getContext("2d");i.drawImage(r,0,0,r.width,r.height);const n=i.getImageData(0,0,r.width,r.height),s=n.data;for(let o=0;o<s.length;o++)s[o]=Vf(s[o]/255)*255;return i.putImageData(n,0,0),e}else if(r.data){const e=r.data.slice(0);for(let i=0;i<e.length;i++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[i]=Math.floor(Vf(e[i]/255)*255):e[i]=Vf(e[i]);return{data:e,width:r.width,height:r.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),r}},sq=0,aq=class{constructor(r=null){this.isSource=!0,Object.defineProperty(this,"id",{value:sq++}),this.uuid=Dh(),this.data=r,this.dataReady=!0,this.version=0}set needsUpdate(r){r===!0&&this.version++}toJSON(r){const e=r===void 0||typeof r=="string";if(!e&&r.images[this.uuid]!==void 0)return r.images[this.uuid];const i={uuid:this.uuid,url:""},n=this.data;if(n!==null){let s;if(Array.isArray(n)){s=[];for(let o=0,l=n.length;o<l;o++)n[o].isDataTexture?s.push(I2(n[o].image)):s.push(I2(n[o]))}else s=I2(n);i.url=s}return e||(r.images[this.uuid]=i),i}};function I2(r){return typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap?nq.getDataURL(r):r.data?{data:Array.from(r.data),width:r.width,height:r.height,type:r.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let oq=0,pu=class kw extends lb{constructor(e=kw.DEFAULT_IMAGE,i=kw.DEFAULT_MAPPING,n=Uf,s=Uf,o=BQ,l=LQ,u=bN,c=DQ,h=kw.DEFAULT_ANISOTROPY,p=SN){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:oq++}),this.uuid=Dh(),this.name="",this.source=new aq(e),this.mipmaps=[],this.mapping=i,this.channel=0,this.wrapS=n,this.wrapT=s,this.magFilter=o,this.minFilter=l,this.anisotropy=h,this.format=u,this.internalFormat=null,this.type=c,this.offset=new Ws(0,0),this.repeat=new Ws(1,1),this.center=new Ws(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Nh,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=p,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),i||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==AN)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case nb:e.x=e.x-Math.floor(e.x);break;case Uf:e.x=e.x<0?0:1;break;case yN:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case nb:e.y=e.y-Math.floor(e.y);break;case Uf:e.y=e.y<0?0:1;break;case yN:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}};pu.DEFAULT_IMAGE=null,pu.DEFAULT_MAPPING=AN,pu.DEFAULT_ANISOTROPY=1;let Oo=class _G{constructor(e=0,i=0,n=0,s=1){_G.prototype.isVector4=!0,this.x=e,this.y=i,this.z=n,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,i,n,s){return this.x=e,this.y=i,this.z=n,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this.w=e.w+i.w,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this.w+=e.w*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this.w=e.w-i.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const i=this.x,n=this.y,s=this.z,o=this.w,l=e.elements;return this.x=l[0]*i+l[4]*n+l[8]*s+l[12]*o,this.y=l[1]*i+l[5]*n+l[9]*s+l[13]*o,this.z=l[2]*i+l[6]*n+l[10]*s+l[14]*o,this.w=l[3]*i+l[7]*n+l[11]*s+l[15]*o,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const i=Math.sqrt(1-e.w*e.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/i,this.y=e.y/i,this.z=e.z/i),this}setAxisAngleFromRotationMatrix(e){let i,n,s,o;const l=e.elements,u=l[0],c=l[4],h=l[8],p=l[1],f=l[5],g=l[9],m=l[2],y=l[6],b=l[10];if(Math.abs(c-p)<.01&&Math.abs(h-m)<.01&&Math.abs(g-y)<.01){if(Math.abs(c+p)<.1&&Math.abs(h+m)<.1&&Math.abs(g+y)<.1&&Math.abs(u+f+b-3)<.1)return this.set(1,0,0,0),this;i=Math.PI;const _=(u+1)/2,T=(f+1)/2,E=(b+1)/2,C=(c+p)/4,R=(h+m)/4,B=(g+y)/4;return _>T&&_>E?_<.01?(n=0,s=.707106781,o=.707106781):(n=Math.sqrt(_),s=C/n,o=R/n):T>E?T<.01?(n=.707106781,s=0,o=.707106781):(s=Math.sqrt(T),n=C/s,o=B/s):E<.01?(n=.707106781,s=.707106781,o=0):(o=Math.sqrt(E),n=R/o,s=B/o),this.set(n,s,o,i),this}let v=Math.sqrt((y-g)*(y-g)+(h-m)*(h-m)+(p-c)*(p-c));return Math.abs(v)<.001&&(v=1),this.x=(y-g)/v,this.y=(h-m)/v,this.z=(p-c)/v,this.w=Math.acos((u+f+b-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this.w=Math.max(e.w,Math.min(i.w,this.w)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this.w=Math.max(e,Math.min(i,this.w)),this}clampLength(e,i){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(i,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this.w+=(e.w-this.w)*i,this}lerpVectors(e,i,n){return this.x=e.x+(i.x-e.x)*n,this.y=e.y+(i.y-e.y)*n,this.z=e.z+(i.z-e.z)*n,this.w=e.w+(i.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this.w=e[i+3],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e[i+3]=this.w,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this.w=e.getW(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},ko=class{constructor(r=0,e=0,i=0,n=1){this.isQuaternion=!0,this._x=r,this._y=e,this._z=i,this._w=n}static slerpFlat(r,e,i,n,s,o,l){let u=i[n+0],c=i[n+1],h=i[n+2],p=i[n+3];const f=s[o+0],g=s[o+1],m=s[o+2],y=s[o+3];if(l===0){r[e+0]=u,r[e+1]=c,r[e+2]=h,r[e+3]=p;return}if(l===1){r[e+0]=f,r[e+1]=g,r[e+2]=m,r[e+3]=y;return}if(p!==y||u!==f||c!==g||h!==m){let b=1-l;const v=u*f+c*g+h*m+p*y,_=v>=0?1:-1,T=1-v*v;if(T>Number.EPSILON){const C=Math.sqrt(T),R=Math.atan2(C,v*_);b=Math.sin(b*R)/C,l=Math.sin(l*R)/C}const E=l*_;if(u=u*b+f*E,c=c*b+g*E,h=h*b+m*E,p=p*b+y*E,b===1-l){const C=1/Math.sqrt(u*u+c*c+h*h+p*p);u*=C,c*=C,h*=C,p*=C}}r[e]=u,r[e+1]=c,r[e+2]=h,r[e+3]=p}static multiplyQuaternionsFlat(r,e,i,n,s,o){const l=i[n],u=i[n+1],c=i[n+2],h=i[n+3],p=s[o],f=s[o+1],g=s[o+2],m=s[o+3];return r[e]=l*m+h*p+u*g-c*f,r[e+1]=u*m+h*f+c*p-l*g,r[e+2]=c*m+h*g+l*f-u*p,r[e+3]=h*m-l*p-u*f-c*g,r}get x(){return this._x}set x(r){this._x=r,this._onChangeCallback()}get y(){return this._y}set y(r){this._y=r,this._onChangeCallback()}get z(){return this._z}set z(r){this._z=r,this._onChangeCallback()}get w(){return this._w}set w(r){this._w=r,this._onChangeCallback()}set(r,e,i,n){return this._x=r,this._y=e,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(r){return this._x=r.x,this._y=r.y,this._z=r.z,this._w=r.w,this._onChangeCallback(),this}setFromEuler(r,e=!0){const i=r._x,n=r._y,s=r._z,o=r._order,l=Math.cos,u=Math.sin,c=l(i/2),h=l(n/2),p=l(s/2),f=u(i/2),g=u(n/2),m=u(s/2);switch(o){case"XYZ":this._x=f*h*p+c*g*m,this._y=c*g*p-f*h*m,this._z=c*h*m+f*g*p,this._w=c*h*p-f*g*m;break;case"YXZ":this._x=f*h*p+c*g*m,this._y=c*g*p-f*h*m,this._z=c*h*m-f*g*p,this._w=c*h*p+f*g*m;break;case"ZXY":this._x=f*h*p-c*g*m,this._y=c*g*p+f*h*m,this._z=c*h*m+f*g*p,this._w=c*h*p-f*g*m;break;case"ZYX":this._x=f*h*p-c*g*m,this._y=c*g*p+f*h*m,this._z=c*h*m-f*g*p,this._w=c*h*p+f*g*m;break;case"YZX":this._x=f*h*p+c*g*m,this._y=c*g*p+f*h*m,this._z=c*h*m-f*g*p,this._w=c*h*p-f*g*m;break;case"XZY":this._x=f*h*p-c*g*m,this._y=c*g*p-f*h*m,this._z=c*h*m+f*g*p,this._w=c*h*p+f*g*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return e===!0&&this._onChangeCallback(),this}setFromAxisAngle(r,e){const i=e/2,n=Math.sin(i);return this._x=r.x*n,this._y=r.y*n,this._z=r.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(r){const e=r.elements,i=e[0],n=e[4],s=e[8],o=e[1],l=e[5],u=e[9],c=e[2],h=e[6],p=e[10],f=i+l+p;if(f>0){const g=.5/Math.sqrt(f+1);this._w=.25/g,this._x=(h-u)*g,this._y=(s-c)*g,this._z=(o-n)*g}else if(i>l&&i>p){const g=2*Math.sqrt(1+i-l-p);this._w=(h-u)/g,this._x=.25*g,this._y=(n+o)/g,this._z=(s+c)/g}else if(l>p){const g=2*Math.sqrt(1+l-i-p);this._w=(s-c)/g,this._x=(n+o)/g,this._y=.25*g,this._z=(u+h)/g}else{const g=2*Math.sqrt(1+p-i-l);this._w=(o-n)/g,this._x=(s+c)/g,this._y=(u+h)/g,this._z=.25*g}return this._onChangeCallback(),this}setFromUnitVectors(r,e){let i=r.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(r.x)>Math.abs(r.z)?(this._x=-r.y,this._y=r.x,this._z=0,this._w=i):(this._x=0,this._y=-r.z,this._z=r.y,this._w=i)):(this._x=r.y*e.z-r.z*e.y,this._y=r.z*e.x-r.x*e.z,this._z=r.x*e.y-r.y*e.x,this._w=i),this.normalize()}angleTo(r){return 2*Math.acos(Math.abs(Pa(this.dot(r),-1,1)))}rotateTowards(r,e){const i=this.angleTo(r);if(i===0)return this;const n=Math.min(1,e/i);return this.slerp(r,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(r){return this._x*r._x+this._y*r._y+this._z*r._z+this._w*r._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let r=this.length();return r===0?(this._x=0,this._y=0,this._z=0,this._w=1):(r=1/r,this._x=this._x*r,this._y=this._y*r,this._z=this._z*r,this._w=this._w*r),this._onChangeCallback(),this}multiply(r){return this.multiplyQuaternions(this,r)}premultiply(r){return this.multiplyQuaternions(r,this)}multiplyQuaternions(r,e){const i=r._x,n=r._y,s=r._z,o=r._w,l=e._x,u=e._y,c=e._z,h=e._w;return this._x=i*h+o*l+n*c-s*u,this._y=n*h+o*u+s*l-i*c,this._z=s*h+o*c+i*u-n*l,this._w=o*h-i*l-n*u-s*c,this._onChangeCallback(),this}slerp(r,e){if(e===0)return this;if(e===1)return this.copy(r);const i=this._x,n=this._y,s=this._z,o=this._w;let l=o*r._w+i*r._x+n*r._y+s*r._z;if(l<0?(this._w=-r._w,this._x=-r._x,this._y=-r._y,this._z=-r._z,l=-l):this.copy(r),l>=1)return this._w=o,this._x=i,this._y=n,this._z=s,this;const u=1-l*l;if(u<=Number.EPSILON){const g=1-e;return this._w=g*o+e*this._w,this._x=g*i+e*this._x,this._y=g*n+e*this._y,this._z=g*s+e*this._z,this.normalize(),this}const c=Math.sqrt(u),h=Math.atan2(c,l),p=Math.sin((1-e)*h)/c,f=Math.sin(e*h)/c;return this._w=o*p+this._w*f,this._x=i*p+this._x*f,this._y=n*p+this._y*f,this._z=s*p+this._z*f,this._onChangeCallback(),this}slerpQuaternions(r,e,i){return this.copy(r).slerp(e,i)}random(){const r=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),i=Math.random(),n=Math.sqrt(1-i),s=Math.sqrt(i);return this.set(n*Math.sin(r),n*Math.cos(r),s*Math.sin(e),s*Math.cos(e))}equals(r){return r._x===this._x&&r._y===this._y&&r._z===this._z&&r._w===this._w}fromArray(r,e=0){return this._x=r[e],this._y=r[e+1],this._z=r[e+2],this._w=r[e+3],this._onChangeCallback(),this}toArray(r=[],e=0){return r[e]=this._x,r[e+1]=this._y,r[e+2]=this._z,r[e+3]=this._w,r}fromBufferAttribute(r,e){return this._x=r.getX(e),this._y=r.getY(e),this._z=r.getZ(e),this._w=r.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(r){return this._onChangeCallback=r,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},Pt=class EG{constructor(e=0,i=0,n=0){EG.prototype.isVector3=!0,this.x=e,this.y=i,this.z=n}set(e,i,n){return n===void 0&&(n=this.z),this.x=e,this.y=i,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,i){return this.x=e.x*i.x,this.y=e.y*i.y,this.z=e.z*i.z,this}applyEuler(e){return this.applyQuaternion(kN.setFromEuler(e))}applyAxisAngle(e,i){return this.applyQuaternion(kN.setFromAxisAngle(e,i))}applyMatrix3(e){const i=this.x,n=this.y,s=this.z,o=e.elements;return this.x=o[0]*i+o[3]*n+o[6]*s,this.y=o[1]*i+o[4]*n+o[7]*s,this.z=o[2]*i+o[5]*n+o[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const i=this.x,n=this.y,s=this.z,o=e.elements,l=1/(o[3]*i+o[7]*n+o[11]*s+o[15]);return this.x=(o[0]*i+o[4]*n+o[8]*s+o[12])*l,this.y=(o[1]*i+o[5]*n+o[9]*s+o[13])*l,this.z=(o[2]*i+o[6]*n+o[10]*s+o[14])*l,this}applyQuaternion(e){const i=this.x,n=this.y,s=this.z,o=e.x,l=e.y,u=e.z,c=e.w,h=2*(l*s-u*n),p=2*(u*i-o*s),f=2*(o*n-l*i);return this.x=i+c*h+l*f-u*p,this.y=n+c*p+u*h-o*f,this.z=s+c*f+o*p-l*h,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const i=this.x,n=this.y,s=this.z,o=e.elements;return this.x=o[0]*i+o[4]*n+o[8]*s,this.y=o[1]*i+o[5]*n+o[9]*s,this.z=o[2]*i+o[6]*n+o[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this}clampLength(e,i){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(i,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this}lerpVectors(e,i,n){return this.x=e.x+(i.x-e.x)*n,this.y=e.y+(i.y-e.y)*n,this.z=e.z+(i.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,i){const n=e.x,s=e.y,o=e.z,l=i.x,u=i.y,c=i.z;return this.x=s*c-o*u,this.y=o*l-n*c,this.z=n*u-s*l,this}projectOnVector(e){const i=e.lengthSq();if(i===0)return this.set(0,0,0);const n=e.dot(this)/i;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return B2.copy(this).projectOnVector(e),this.sub(B2)}reflect(e){return this.sub(B2.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const n=this.dot(e)/i;return Math.acos(Pa(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,n=this.y-e.y,s=this.z-e.z;return i*i+n*n+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,i,n){const s=Math.sin(i)*e;return this.x=s*Math.sin(n),this.y=Math.cos(i)*e,this.z=s*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,i,n){return this.x=e*Math.sin(i),this.y=n,this.z=e*Math.cos(i),this}setFromMatrixPosition(e){const i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(e){const i=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=i,this.y=n,this.z=s,this}setFromMatrixColumn(e,i){return this.fromArray(e.elements,i*4)}setFromMatrix3Column(e,i){return this.fromArray(e.elements,i*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,i=Math.random()*2-1,n=Math.sqrt(1-i*i);return this.x=n*Math.cos(e),this.y=i,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};const B2=new Pt,kN=new ko;let Hf=class{constructor(r=new Pt(1/0,1/0,1/0),e=new Pt(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=r,this.max=e}set(r,e){return this.min.copy(r),this.max.copy(e),this}setFromArray(r){this.makeEmpty();for(let e=0,i=r.length;e<i;e+=3)this.expandByPoint(Jl.fromArray(r,e));return this}setFromBufferAttribute(r){this.makeEmpty();for(let e=0,i=r.count;e<i;e++)this.expandByPoint(Jl.fromBufferAttribute(r,e));return this}setFromPoints(r){this.makeEmpty();for(let e=0,i=r.length;e<i;e++)this.expandByPoint(r[e]);return this}setFromCenterAndSize(r,e){const i=Jl.copy(e).multiplyScalar(.5);return this.min.copy(r).sub(i),this.max.copy(r).add(i),this}setFromObject(r,e=!1){return this.makeEmpty(),this.expandByObject(r,e)}clone(){return new this.constructor().copy(this)}copy(r){return this.min.copy(r.min),this.max.copy(r.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(r){return this.isEmpty()?r.set(0,0,0):r.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(r){return this.isEmpty()?r.set(0,0,0):r.subVectors(this.max,this.min)}expandByPoint(r){return this.min.min(r),this.max.max(r),this}expandByVector(r){return this.min.sub(r),this.max.add(r),this}expandByScalar(r){return this.min.addScalar(-r),this.max.addScalar(r),this}expandByObject(r,e=!1){r.updateWorldMatrix(!1,!1);const i=r.geometry;if(i!==void 0){const s=i.getAttribute("position");if(e===!0&&s!==void 0&&r.isInstancedMesh!==!0)for(let o=0,l=s.count;o<l;o++)r.isMesh===!0?r.getVertexPosition(o,Jl):Jl.fromBufferAttribute(s,o),Jl.applyMatrix4(r.matrixWorld),this.expandByPoint(Jl);else r.boundingBox!==void 0?(r.boundingBox===null&&r.computeBoundingBox(),ub.copy(r.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),ub.copy(i.boundingBox)),ub.applyMatrix4(r.matrixWorld),this.union(ub)}const n=r.children;for(let s=0,o=n.length;s<o;s++)this.expandByObject(n[s],e);return this}containsPoint(r){return!(r.x<this.min.x||r.x>this.max.x||r.y<this.min.y||r.y>this.max.y||r.z<this.min.z||r.z>this.max.z)}containsBox(r){return this.min.x<=r.min.x&&r.max.x<=this.max.x&&this.min.y<=r.min.y&&r.max.y<=this.max.y&&this.min.z<=r.min.z&&r.max.z<=this.max.z}getParameter(r,e){return e.set((r.x-this.min.x)/(this.max.x-this.min.x),(r.y-this.min.y)/(this.max.y-this.min.y),(r.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(r){return!(r.max.x<this.min.x||r.min.x>this.max.x||r.max.y<this.min.y||r.min.y>this.max.y||r.max.z<this.min.z||r.min.z>this.max.z)}intersectsSphere(r){return this.clampPoint(r.center,Jl),Jl.distanceToSquared(r.center)<=r.radius*r.radius}intersectsPlane(r){let e,i;return r.normal.x>0?(e=r.normal.x*this.min.x,i=r.normal.x*this.max.x):(e=r.normal.x*this.max.x,i=r.normal.x*this.min.x),r.normal.y>0?(e+=r.normal.y*this.min.y,i+=r.normal.y*this.max.y):(e+=r.normal.y*this.max.y,i+=r.normal.y*this.min.y),r.normal.z>0?(e+=r.normal.z*this.min.z,i+=r.normal.z*this.max.z):(e+=r.normal.z*this.max.z,i+=r.normal.z*this.min.z),e<=-r.constant&&i>=-r.constant}intersectsTriangle(r){if(this.isEmpty())return!1;this.getCenter(q0),hb.subVectors(this.max,q0),Wf.subVectors(r.a,q0),Qf.subVectors(r.b,q0),qf.subVectors(r.c,q0),Ph.subVectors(Qf,Wf),Oh.subVectors(qf,Qf),$d.subVectors(Wf,qf);let e=[0,-Ph.z,Ph.y,0,-Oh.z,Oh.y,0,-$d.z,$d.y,Ph.z,0,-Ph.x,Oh.z,0,-Oh.x,$d.z,0,-$d.x,-Ph.y,Ph.x,0,-Oh.y,Oh.x,0,-$d.y,$d.x,0];return!L2(e,Wf,Qf,qf,hb)||(e=[1,0,0,0,1,0,0,0,1],!L2(e,Wf,Qf,qf,hb))?!1:(db.crossVectors(Ph,Oh),e=[db.x,db.y,db.z],L2(e,Wf,Qf,qf,hb))}clampPoint(r,e){return e.copy(r).clamp(this.min,this.max)}distanceToPoint(r){return this.clampPoint(r,Jl).distanceTo(r)}getBoundingSphere(r){return this.isEmpty()?r.makeEmpty():(this.getCenter(r.center),r.radius=this.getSize(Jl).length()*.5),r}intersect(r){return this.min.max(r.min),this.max.min(r.max),this.isEmpty()&&this.makeEmpty(),this}union(r){return this.min.min(r.min),this.max.max(r.max),this}applyMatrix4(r){return this.isEmpty()?this:(fu[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(r),fu[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(r),fu[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(r),fu[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(r),fu[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(r),fu[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(r),fu[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(r),fu[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(r),this.setFromPoints(fu),this)}translate(r){return this.min.add(r),this.max.add(r),this}equals(r){return r.min.equals(this.min)&&r.max.equals(this.max)}};const fu=[new Pt,new Pt,new Pt,new Pt,new Pt,new Pt,new Pt,new Pt],Jl=new Pt,ub=new Hf,Wf=new Pt,Qf=new Pt,qf=new Pt,Ph=new Pt,Oh=new Pt,$d=new Pt,q0=new Pt,hb=new Pt,db=new Pt,ep=new Pt;function L2(r,e,i,n,s){for(let o=0,l=r.length-3;o<=l;o+=3){ep.fromArray(r,o);const u=s.x*Math.abs(ep.x)+s.y*Math.abs(ep.y)+s.z*Math.abs(ep.z),c=e.dot(ep),h=i.dot(ep),p=n.dot(ep);if(Math.max(-Math.max(c,h,p),Math.min(c,h,p))>u)return!1}return!0}const lq=new Hf,X0=new Pt,D2=new Pt;let Xf=class{constructor(r=new Pt,e=-1){this.isSphere=!0,this.center=r,this.radius=e}set(r,e){return this.center.copy(r),this.radius=e,this}setFromPoints(r,e){const i=this.center;e!==void 0?i.copy(e):lq.setFromPoints(r).getCenter(i);let n=0;for(let s=0,o=r.length;s<o;s++)n=Math.max(n,i.distanceToSquared(r[s]));return this.radius=Math.sqrt(n),this}copy(r){return this.center.copy(r.center),this.radius=r.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(r){return r.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(r){return r.distanceTo(this.center)-this.radius}intersectsSphere(r){const e=this.radius+r.radius;return r.center.distanceToSquared(this.center)<=e*e}intersectsBox(r){return r.intersectsSphere(this)}intersectsPlane(r){return Math.abs(r.distanceToPoint(this.center))<=this.radius}clampPoint(r,e){const i=this.center.distanceToSquared(r);return e.copy(r),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(r){return this.isEmpty()?(r.makeEmpty(),r):(r.set(this.center,this.center),r.expandByScalar(this.radius),r)}applyMatrix4(r){return this.center.applyMatrix4(r),this.radius=this.radius*r.getMaxScaleOnAxis(),this}translate(r){return this.center.add(r),this}expandByPoint(r){if(this.isEmpty())return this.center.copy(r),this.radius=0,this;X0.subVectors(r,this.center);const e=X0.lengthSq();if(e>this.radius*this.radius){const i=Math.sqrt(e),n=(i-this.radius)*.5;this.center.addScaledVector(X0,n/i),this.radius+=n}return this}union(r){return r.isEmpty()?this:this.isEmpty()?(this.copy(r),this):(this.center.equals(r.center)===!0?this.radius=Math.max(this.radius,r.radius):(D2.subVectors(r.center,this.center).setLength(r.radius),this.expandByPoint(X0.copy(r.center).add(D2)),this.expandByPoint(X0.copy(r.center).sub(D2))),this)}equals(r){return r.center.equals(this.center)&&r.radius===this.radius}clone(){return new this.constructor().copy(this)}};const mu=new Pt,N2=new Pt,pb=new Pt,kh=new Pt,P2=new Pt,fb=new Pt,O2=new Pt;let k2=class{constructor(r=new Pt,e=new Pt(0,0,-1)){this.origin=r,this.direction=e}set(r,e){return this.origin.copy(r),this.direction.copy(e),this}copy(r){return this.origin.copy(r.origin),this.direction.copy(r.direction),this}at(r,e){return e.copy(this.origin).addScaledVector(this.direction,r)}lookAt(r){return this.direction.copy(r).sub(this.origin).normalize(),this}recast(r){return this.origin.copy(this.at(r,mu)),this}closestPointToPoint(r,e){e.subVectors(r,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(r){return Math.sqrt(this.distanceSqToPoint(r))}distanceSqToPoint(r){const e=mu.subVectors(r,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(r):(mu.copy(this.origin).addScaledVector(this.direction,e),mu.distanceToSquared(r))}distanceSqToSegment(r,e,i,n){N2.copy(r).add(e).multiplyScalar(.5),pb.copy(e).sub(r).normalize(),kh.copy(this.origin).sub(N2);const s=r.distanceTo(e)*.5,o=-this.direction.dot(pb),l=kh.dot(this.direction),u=-kh.dot(pb),c=kh.lengthSq(),h=Math.abs(1-o*o);let p,f,g,m;if(h>0)if(p=o*u-l,f=o*l-u,m=s*h,p>=0)if(f>=-m)if(f<=m){const y=1/h;p*=y,f*=y,g=p*(p+o*f+2*l)+f*(o*p+f+2*u)+c}else f=s,p=Math.max(0,-(o*f+l)),g=-p*p+f*(f+2*u)+c;else f=-s,p=Math.max(0,-(o*f+l)),g=-p*p+f*(f+2*u)+c;else f<=-m?(p=Math.max(0,-(-o*s+l)),f=p>0?-s:Math.min(Math.max(-s,-u),s),g=-p*p+f*(f+2*u)+c):f<=m?(p=0,f=Math.min(Math.max(-s,-u),s),g=f*(f+2*u)+c):(p=Math.max(0,-(o*s+l)),f=p>0?s:Math.min(Math.max(-s,-u),s),g=-p*p+f*(f+2*u)+c);else f=o>0?-s:s,p=Math.max(0,-(o*f+l)),g=-p*p+f*(f+2*u)+c;return i&&i.copy(this.origin).addScaledVector(this.direction,p),n&&n.copy(N2).addScaledVector(pb,f),g}intersectSphere(r,e){mu.subVectors(r.center,this.origin);const i=mu.dot(this.direction),n=mu.dot(mu)-i*i,s=r.radius*r.radius;if(n>s)return null;const o=Math.sqrt(s-n),l=i-o,u=i+o;return u<0?null:l<0?this.at(u,e):this.at(l,e)}intersectsSphere(r){return this.distanceSqToPoint(r.center)<=r.radius*r.radius}distanceToPlane(r){const e=r.normal.dot(this.direction);if(e===0)return r.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(r.normal)+r.constant)/e;return i>=0?i:null}intersectPlane(r,e){const i=this.distanceToPlane(r);return i===null?null:this.at(i,e)}intersectsPlane(r){const e=r.distanceToPoint(this.origin);return e===0||r.normal.dot(this.direction)*e<0}intersectBox(r,e){let i,n,s,o,l,u;const c=1/this.direction.x,h=1/this.direction.y,p=1/this.direction.z,f=this.origin;return c>=0?(i=(r.min.x-f.x)*c,n=(r.max.x-f.x)*c):(i=(r.max.x-f.x)*c,n=(r.min.x-f.x)*c),h>=0?(s=(r.min.y-f.y)*h,o=(r.max.y-f.y)*h):(s=(r.max.y-f.y)*h,o=(r.min.y-f.y)*h),i>o||s>n||((s>i||isNaN(i))&&(i=s),(o<n||isNaN(n))&&(n=o),p>=0?(l=(r.min.z-f.z)*p,u=(r.max.z-f.z)*p):(l=(r.max.z-f.z)*p,u=(r.min.z-f.z)*p),i>u||l>n)||((l>i||i!==i)&&(i=l),(u<n||n!==n)&&(n=u),n<0)?null:this.at(i>=0?i:n,e)}intersectsBox(r){return this.intersectBox(r,mu)!==null}intersectTriangle(r,e,i,n,s){P2.subVectors(e,r),fb.subVectors(i,r),O2.crossVectors(P2,fb);let o=this.direction.dot(O2),l;if(o>0){if(n)return null;l=1}else if(o<0)l=-1,o=-o;else return null;kh.subVectors(this.origin,r);const u=l*this.direction.dot(fb.crossVectors(kh,fb));if(u<0)return null;const c=l*this.direction.dot(P2.cross(kh));if(c<0||u+c>o)return null;const h=-l*kh.dot(O2);return h<0?null:this.at(h/o,s)}applyMatrix4(r){return this.origin.applyMatrix4(r),this.direction.transformDirection(r),this}equals(r){return r.origin.equals(this.origin)&&r.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},Hr=class VL{constructor(e,i,n,s,o,l,u,c,h,p,f,g,m,y,b,v){VL.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,i,n,s,o,l,u,c,h,p,f,g,m,y,b,v)}set(e,i,n,s,o,l,u,c,h,p,f,g,m,y,b,v){const _=this.elements;return _[0]=e,_[4]=i,_[8]=n,_[12]=s,_[1]=o,_[5]=l,_[9]=u,_[13]=c,_[2]=h,_[6]=p,_[10]=f,_[14]=g,_[3]=m,_[7]=y,_[11]=b,_[15]=v,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new VL().fromArray(this.elements)}copy(e){const i=this.elements,n=e.elements;return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],this}copyPosition(e){const i=this.elements,n=e.elements;return i[12]=n[12],i[13]=n[13],i[14]=n[14],this}setFromMatrix3(e){const i=e.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(e,i,n){return e.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,i,n){return this.set(e.x,i.x,n.x,0,e.y,i.y,n.y,0,e.z,i.z,n.z,0,0,0,0,1),this}extractRotation(e){const i=this.elements,n=e.elements,s=1/Yf.setFromMatrixColumn(e,0).length(),o=1/Yf.setFromMatrixColumn(e,1).length(),l=1/Yf.setFromMatrixColumn(e,2).length();return i[0]=n[0]*s,i[1]=n[1]*s,i[2]=n[2]*s,i[3]=0,i[4]=n[4]*o,i[5]=n[5]*o,i[6]=n[6]*o,i[7]=0,i[8]=n[8]*l,i[9]=n[9]*l,i[10]=n[10]*l,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(e){const i=this.elements,n=e.x,s=e.y,o=e.z,l=Math.cos(n),u=Math.sin(n),c=Math.cos(s),h=Math.sin(s),p=Math.cos(o),f=Math.sin(o);if(e.order==="XYZ"){const g=l*p,m=l*f,y=u*p,b=u*f;i[0]=c*p,i[4]=-c*f,i[8]=h,i[1]=m+y*h,i[5]=g-b*h,i[9]=-u*c,i[2]=b-g*h,i[6]=y+m*h,i[10]=l*c}else if(e.order==="YXZ"){const g=c*p,m=c*f,y=h*p,b=h*f;i[0]=g+b*u,i[4]=y*u-m,i[8]=l*h,i[1]=l*f,i[5]=l*p,i[9]=-u,i[2]=m*u-y,i[6]=b+g*u,i[10]=l*c}else if(e.order==="ZXY"){const g=c*p,m=c*f,y=h*p,b=h*f;i[0]=g-b*u,i[4]=-l*f,i[8]=y+m*u,i[1]=m+y*u,i[5]=l*p,i[9]=b-g*u,i[2]=-l*h,i[6]=u,i[10]=l*c}else if(e.order==="ZYX"){const g=l*p,m=l*f,y=u*p,b=u*f;i[0]=c*p,i[4]=y*h-m,i[8]=g*h+b,i[1]=c*f,i[5]=b*h+g,i[9]=m*h-y,i[2]=-h,i[6]=u*c,i[10]=l*c}else if(e.order==="YZX"){const g=l*c,m=l*h,y=u*c,b=u*h;i[0]=c*p,i[4]=b-g*f,i[8]=y*f+m,i[1]=f,i[5]=l*p,i[9]=-u*p,i[2]=-h*p,i[6]=m*f+y,i[10]=g-b*f}else if(e.order==="XZY"){const g=l*c,m=l*h,y=u*c,b=u*h;i[0]=c*p,i[4]=-f,i[8]=h*p,i[1]=g*f+b,i[5]=l*p,i[9]=m*f-y,i[2]=y*f-m,i[6]=u*p,i[10]=b*f+g}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(e){return this.compose(cq,e,uq)}lookAt(e,i,n){const s=this.elements;return nl.subVectors(e,i),nl.lengthSq()===0&&(nl.z=1),nl.normalize(),Fh.crossVectors(n,nl),Fh.lengthSq()===0&&(Math.abs(n.z)===1?nl.x+=1e-4:nl.z+=1e-4,nl.normalize(),Fh.crossVectors(n,nl)),Fh.normalize(),mb.crossVectors(nl,Fh),s[0]=Fh.x,s[4]=mb.x,s[8]=nl.x,s[1]=Fh.y,s[5]=mb.y,s[9]=nl.y,s[2]=Fh.z,s[6]=mb.z,s[10]=nl.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const n=e.elements,s=i.elements,o=this.elements,l=n[0],u=n[4],c=n[8],h=n[12],p=n[1],f=n[5],g=n[9],m=n[13],y=n[2],b=n[6],v=n[10],_=n[14],T=n[3],E=n[7],C=n[11],R=n[15],B=s[0],I=s[4],N=s[8],D=s[12],P=s[1],k=s[5],q=s[9],V=s[13],j=s[2],Q=s[6],W=s[10],G=s[14],z=s[3],te=s[7],Y=s[11],se=s[15];return o[0]=l*B+u*P+c*j+h*z,o[4]=l*I+u*k+c*Q+h*te,o[8]=l*N+u*q+c*W+h*Y,o[12]=l*D+u*V+c*G+h*se,o[1]=p*B+f*P+g*j+m*z,o[5]=p*I+f*k+g*Q+m*te,o[9]=p*N+f*q+g*W+m*Y,o[13]=p*D+f*V+g*G+m*se,o[2]=y*B+b*P+v*j+_*z,o[6]=y*I+b*k+v*Q+_*te,o[10]=y*N+b*q+v*W+_*Y,o[14]=y*D+b*V+v*G+_*se,o[3]=T*B+E*P+C*j+R*z,o[7]=T*I+E*k+C*Q+R*te,o[11]=T*N+E*q+C*W+R*Y,o[15]=T*D+E*V+C*G+R*se,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[4]*=e,i[8]*=e,i[12]*=e,i[1]*=e,i[5]*=e,i[9]*=e,i[13]*=e,i[2]*=e,i[6]*=e,i[10]*=e,i[14]*=e,i[3]*=e,i[7]*=e,i[11]*=e,i[15]*=e,this}determinant(){const e=this.elements,i=e[0],n=e[4],s=e[8],o=e[12],l=e[1],u=e[5],c=e[9],h=e[13],p=e[2],f=e[6],g=e[10],m=e[14],y=e[3],b=e[7],v=e[11],_=e[15];return y*(+o*c*f-s*h*f-o*u*g+n*h*g+s*u*m-n*c*m)+b*(+i*c*m-i*h*g+o*l*g-s*l*m+s*h*p-o*c*p)+v*(+i*h*f-i*u*m-o*l*f+n*l*m+o*u*p-n*h*p)+_*(-s*u*p-i*c*f+i*u*g+s*l*f-n*l*g+n*c*p)}transpose(){const e=this.elements;let i;return i=e[1],e[1]=e[4],e[4]=i,i=e[2],e[2]=e[8],e[8]=i,i=e[6],e[6]=e[9],e[9]=i,i=e[3],e[3]=e[12],e[12]=i,i=e[7],e[7]=e[13],e[13]=i,i=e[11],e[11]=e[14],e[14]=i,this}setPosition(e,i,n){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=i,s[14]=n),this}invert(){const e=this.elements,i=e[0],n=e[1],s=e[2],o=e[3],l=e[4],u=e[5],c=e[6],h=e[7],p=e[8],f=e[9],g=e[10],m=e[11],y=e[12],b=e[13],v=e[14],_=e[15],T=f*v*h-b*g*h+b*c*m-u*v*m-f*c*_+u*g*_,E=y*g*h-p*v*h-y*c*m+l*v*m+p*c*_-l*g*_,C=p*b*h-y*f*h+y*u*m-l*b*m-p*u*_+l*f*_,R=y*f*c-p*b*c-y*u*g+l*b*g+p*u*v-l*f*v,B=i*T+n*E+s*C+o*R;if(B===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const I=1/B;return e[0]=T*I,e[1]=(b*g*o-f*v*o-b*s*m+n*v*m+f*s*_-n*g*_)*I,e[2]=(u*v*o-b*c*o+b*s*h-n*v*h-u*s*_+n*c*_)*I,e[3]=(f*c*o-u*g*o-f*s*h+n*g*h+u*s*m-n*c*m)*I,e[4]=E*I,e[5]=(p*v*o-y*g*o+y*s*m-i*v*m-p*s*_+i*g*_)*I,e[6]=(y*c*o-l*v*o-y*s*h+i*v*h+l*s*_-i*c*_)*I,e[7]=(l*g*o-p*c*o+p*s*h-i*g*h-l*s*m+i*c*m)*I,e[8]=C*I,e[9]=(y*f*o-p*b*o-y*n*m+i*b*m+p*n*_-i*f*_)*I,e[10]=(l*b*o-y*u*o+y*n*h-i*b*h-l*n*_+i*u*_)*I,e[11]=(p*u*o-l*f*o-p*n*h+i*f*h+l*n*m-i*u*m)*I,e[12]=R*I,e[13]=(p*b*s-y*f*s+y*n*g-i*b*g-p*n*v+i*f*v)*I,e[14]=(y*u*s-l*b*s-y*n*c+i*b*c+l*n*v-i*u*v)*I,e[15]=(l*f*s-p*u*s+p*n*c-i*f*c-l*n*g+i*u*g)*I,this}scale(e){const i=this.elements,n=e.x,s=e.y,o=e.z;return i[0]*=n,i[4]*=s,i[8]*=o,i[1]*=n,i[5]*=s,i[9]*=o,i[2]*=n,i[6]*=s,i[10]*=o,i[3]*=n,i[7]*=s,i[11]*=o,this}getMaxScaleOnAxis(){const e=this.elements,i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(i,n,s))}makeTranslation(e,i,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,i,0,0,1,n,0,0,0,1),this}makeRotationX(e){const i=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,i,-n,0,0,n,i,0,0,0,0,1),this}makeRotationY(e){const i=Math.cos(e),n=Math.sin(e);return this.set(i,0,n,0,0,1,0,0,-n,0,i,0,0,0,0,1),this}makeRotationZ(e){const i=Math.cos(e),n=Math.sin(e);return this.set(i,-n,0,0,n,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,i){const n=Math.cos(i),s=Math.sin(i),o=1-n,l=e.x,u=e.y,c=e.z,h=o*l,p=o*u;return this.set(h*l+n,h*u-s*c,h*c+s*u,0,h*u+s*c,p*u+n,p*c-s*l,0,h*c-s*u,p*c+s*l,o*c*c+n,0,0,0,0,1),this}makeScale(e,i,n){return this.set(e,0,0,0,0,i,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,i,n,s,o,l){return this.set(1,n,o,0,e,1,l,0,i,s,1,0,0,0,0,1),this}compose(e,i,n){const s=this.elements,o=i._x,l=i._y,u=i._z,c=i._w,h=o+o,p=l+l,f=u+u,g=o*h,m=o*p,y=o*f,b=l*p,v=l*f,_=u*f,T=c*h,E=c*p,C=c*f,R=n.x,B=n.y,I=n.z;return s[0]=(1-(b+_))*R,s[1]=(m+C)*R,s[2]=(y-E)*R,s[3]=0,s[4]=(m-C)*B,s[5]=(1-(g+_))*B,s[6]=(v+T)*B,s[7]=0,s[8]=(y+E)*I,s[9]=(v-T)*I,s[10]=(1-(g+b))*I,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,i,n){const s=this.elements;let o=Yf.set(s[0],s[1],s[2]).length();const l=Yf.set(s[4],s[5],s[6]).length(),u=Yf.set(s[8],s[9],s[10]).length();this.determinant()<0&&(o=-o),e.x=s[12],e.y=s[13],e.z=s[14],Zl.copy(this);const c=1/o,h=1/l,p=1/u;return Zl.elements[0]*=c,Zl.elements[1]*=c,Zl.elements[2]*=c,Zl.elements[4]*=h,Zl.elements[5]*=h,Zl.elements[6]*=h,Zl.elements[8]*=p,Zl.elements[9]*=p,Zl.elements[10]*=p,i.setFromRotationMatrix(Zl),n.x=o,n.y=l,n.z=u,this}makePerspective(e,i,n,s,o,l,u=Zd){const c=this.elements,h=2*o/(i-e),p=2*o/(n-s),f=(i+e)/(i-e),g=(n+s)/(n-s);let m,y;if(u===Zd)m=-(l+o)/(l-o),y=-2*l*o/(l-o);else if(u===C2)m=-l/(l-o),y=-l*o/(l-o);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+u);return c[0]=h,c[4]=0,c[8]=f,c[12]=0,c[1]=0,c[5]=p,c[9]=g,c[13]=0,c[2]=0,c[6]=0,c[10]=m,c[14]=y,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,i,n,s,o,l,u=Zd){const c=this.elements,h=1/(i-e),p=1/(n-s),f=1/(l-o),g=(i+e)*h,m=(n+s)*p;let y,b;if(u===Zd)y=(l+o)*f,b=-2*f;else if(u===C2)y=o*f,b=-1*f;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+u);return c[0]=2*h,c[4]=0,c[8]=0,c[12]=-g,c[1]=0,c[5]=2*p,c[9]=0,c[13]=-m,c[2]=0,c[6]=0,c[10]=b,c[14]=-y,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const i=this.elements,n=e.elements;for(let s=0;s<16;s++)if(i[s]!==n[s])return!1;return!0}fromArray(e,i=0){for(let n=0;n<16;n++)this.elements[n]=e[n+i];return this}toArray(e=[],i=0){const n=this.elements;return e[i]=n[0],e[i+1]=n[1],e[i+2]=n[2],e[i+3]=n[3],e[i+4]=n[4],e[i+5]=n[5],e[i+6]=n[6],e[i+7]=n[7],e[i+8]=n[8],e[i+9]=n[9],e[i+10]=n[10],e[i+11]=n[11],e[i+12]=n[12],e[i+13]=n[13],e[i+14]=n[14],e[i+15]=n[15],e}};const Yf=new Pt,Zl=new Hr,cq=new Pt(0,0,0),uq=new Pt(1,1,1),Fh=new Pt,mb=new Pt,nl=new Pt,FN=new Hr,UN=new ko;let fo=class wG{constructor(e=0,i=0,n=0,s=wG.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=i,this._z=n,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,i,n,s=this._order){return this._x=e,this._y=i,this._z=n,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,i=this._order,n=!0){const s=e.elements,o=s[0],l=s[4],u=s[8],c=s[1],h=s[5],p=s[9],f=s[2],g=s[6],m=s[10];switch(i){case"XYZ":this._y=Math.asin(Pa(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-p,m),this._z=Math.atan2(-l,o)):(this._x=Math.atan2(g,h),this._z=0);break;case"YXZ":this._x=Math.asin(-Pa(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(u,m),this._z=Math.atan2(c,h)):(this._y=Math.atan2(-f,o),this._z=0);break;case"ZXY":this._x=Math.asin(Pa(g,-1,1)),Math.abs(g)<.9999999?(this._y=Math.atan2(-f,m),this._z=Math.atan2(-l,h)):(this._y=0,this._z=Math.atan2(c,o));break;case"ZYX":this._y=Math.asin(-Pa(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(g,m),this._z=Math.atan2(c,o)):(this._x=0,this._z=Math.atan2(-l,h));break;case"YZX":this._z=Math.asin(Pa(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-p,h),this._y=Math.atan2(-f,o)):(this._x=0,this._y=Math.atan2(u,m));break;case"XZY":this._z=Math.asin(-Pa(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(g,h),this._y=Math.atan2(u,o)):(this._x=Math.atan2(-p,m),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,i,n){return FN.makeRotationFromQuaternion(e),this.setFromRotationMatrix(FN,i,n)}setFromVector3(e,i=this._order){return this.set(e.x,e.y,e.z,i)}reorder(e){return UN.setFromEuler(this),this.setFromQuaternion(UN,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};fo.DEFAULT_ORDER="XYZ";let hq=class{constructor(){this.mask=1}set(r){this.mask=(1<<r|0)>>>0}enable(r){this.mask|=1<<r|0}enableAll(){this.mask=-1}toggle(r){this.mask^=1<<r|0}disable(r){this.mask&=~(1<<r|0)}disableAll(){this.mask=0}test(r){return(this.mask&r.mask)!==0}isEnabled(r){return(this.mask&(1<<r|0))!==0}},dq=0;const zN=new Pt,Kf=new ko,gu=new Hr,gb=new Pt,Y0=new Pt,pq=new Pt,fq=new ko,jN=new Pt(1,0,0),VN=new Pt(0,1,0),GN=new Pt(0,0,1),HN={type:"added"},mq={type:"removed"},Jf={type:"childadded",child:null},F2={type:"childremoved",child:null};let Oa=class Fw extends lb{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:dq++}),this.uuid=Dh(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Fw.DEFAULT_UP.clone();const e=new Pt,i=new fo,n=new ko,s=new Pt(1,1,1);function o(){n.setFromEuler(i,!1)}function l(){i.setFromQuaternion(n,void 0,!1)}i._onChange(o),n._onChange(l),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new Hr},normalMatrix:{value:new Nh}}),this.matrix=new Hr,this.matrixWorld=new Hr,this.matrixAutoUpdate=Fw.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Fw.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new hq,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,i){this.quaternion.setFromAxisAngle(e,i)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,i){return Kf.setFromAxisAngle(e,i),this.quaternion.multiply(Kf),this}rotateOnWorldAxis(e,i){return Kf.setFromAxisAngle(e,i),this.quaternion.premultiply(Kf),this}rotateX(e){return this.rotateOnAxis(jN,e)}rotateY(e){return this.rotateOnAxis(VN,e)}rotateZ(e){return this.rotateOnAxis(GN,e)}translateOnAxis(e,i){return zN.copy(e).applyQuaternion(this.quaternion),this.position.add(zN.multiplyScalar(i)),this}translateX(e){return this.translateOnAxis(jN,e)}translateY(e){return this.translateOnAxis(VN,e)}translateZ(e){return this.translateOnAxis(GN,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(gu.copy(this.matrixWorld).invert())}lookAt(e,i,n){e.isVector3?gb.copy(e):gb.set(e,i,n);const s=this.parent;this.updateWorldMatrix(!0,!1),Y0.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?gu.lookAt(Y0,gb,this.up):gu.lookAt(gb,Y0,this.up),this.quaternion.setFromRotationMatrix(gu),s&&(gu.extractRotation(s.matrixWorld),Kf.setFromRotationMatrix(gu),this.quaternion.premultiply(Kf.invert()))}add(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(HN),Jf.child=e,this.dispatchEvent(Jf),Jf.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const i=this.children.indexOf(e);return i!==-1&&(e.parent=null,this.children.splice(i,1),e.dispatchEvent(mq),F2.child=e,this.dispatchEvent(F2),F2.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),gu.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),gu.multiply(e.parent.matrixWorld)),e.applyMatrix4(gu),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(HN),Jf.child=e,this.dispatchEvent(Jf),Jf.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,i){if(this[e]===i)return this;for(let n=0,s=this.children.length;n<s;n++){const o=this.children[n].getObjectByProperty(e,i);if(o!==void 0)return o}}getObjectsByProperty(e,i,n=[]){this[e]===i&&n.push(this);const s=this.children;for(let o=0,l=s.length;o<l;o++)s[o].getObjectsByProperty(e,i,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Y0,e,pq),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Y0,fq,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return e.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(e){e(this);const i=this.children;for(let n=0,s=i.length;n<s;n++)i[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const i=this.children;for(let n=0,s=i.length;n<s;n++)i[n].traverseVisible(e)}traverseAncestors(e){const i=this.parent;i!==null&&(e(i),i.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const i=this.children;for(let n=0,s=i.length;n<s;n++){const o=i[n];(o.matrixWorldAutoUpdate===!0||e===!0)&&o.updateMatrixWorld(e)}}updateWorldMatrix(e,i){const n=this.parent;if(e===!0&&n!==null&&n.matrixWorldAutoUpdate===!0&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),i===!0){const s=this.children;for(let o=0,l=s.length;o<l;o++){const u=s[o];u.matrixWorldAutoUpdate===!0&&u.updateWorldMatrix(!1,!0)}}}toJSON(e){const i=e===void 0||typeof e=="string",n={};i&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.visibility=this._visibility,s.active=this._active,s.bounds=this._bounds.map(u=>({boxInitialized:u.boxInitialized,boxMin:u.box.min.toArray(),boxMax:u.box.max.toArray(),sphereInitialized:u.sphereInitialized,sphereRadius:u.sphere.radius,sphereCenter:u.sphere.center.toArray()})),s.maxGeometryCount=this._maxGeometryCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.geometryCount=this._geometryCount,s.matricesTexture=this._matricesTexture.toJSON(e),this.boundingSphere!==null&&(s.boundingSphere={center:s.boundingSphere.center.toArray(),radius:s.boundingSphere.radius}),this.boundingBox!==null&&(s.boundingBox={min:s.boundingBox.min.toArray(),max:s.boundingBox.max.toArray()}));function o(u,c){return u[c.uuid]===void 0&&(u[c.uuid]=c.toJSON(e)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=o(e.geometries,this.geometry);const u=this.geometry.parameters;if(u!==void 0&&u.shapes!==void 0){const c=u.shapes;if(Array.isArray(c))for(let h=0,p=c.length;h<p;h++){const f=c[h];o(e.shapes,f)}else o(e.shapes,c)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(o(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const u=[];for(let c=0,h=this.material.length;c<h;c++)u.push(o(e.materials,this.material[c]));s.material=u}else s.material=o(e.materials,this.material);if(this.children.length>0){s.children=[];for(let u=0;u<this.children.length;u++)s.children.push(this.children[u].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let u=0;u<this.animations.length;u++){const c=this.animations[u];s.animations.push(o(e.animations,c))}}if(i){const u=l(e.geometries),c=l(e.materials),h=l(e.textures),p=l(e.images),f=l(e.shapes),g=l(e.skeletons),m=l(e.animations),y=l(e.nodes);u.length>0&&(n.geometries=u),c.length>0&&(n.materials=c),h.length>0&&(n.textures=h),p.length>0&&(n.images=p),f.length>0&&(n.shapes=f),g.length>0&&(n.skeletons=g),m.length>0&&(n.animations=m),y.length>0&&(n.nodes=y)}return n.object=s,n;function l(u){const c=[];for(const h in u){const p=u[h];delete p.metadata,c.push(p)}return c}}clone(e){return new this.constructor().copy(this,e)}copy(e,i=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),i===!0)for(let n=0;n<e.children.length;n++){const s=e.children[n];this.add(s.clone())}return this}};Oa.DEFAULT_UP=new Pt(0,1,0),Oa.DEFAULT_MATRIX_AUTO_UPDATE=!0,Oa.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const $l=new Pt,Au=new Pt,U2=new Pt,yu=new Pt,Zf=new Pt,$f=new Pt,WN=new Pt,z2=new Pt,j2=new Pt,V2=new Pt;let Ab=class M0{constructor(e=new Pt,i=new Pt,n=new Pt){this.a=e,this.b=i,this.c=n}static getNormal(e,i,n,s){s.subVectors(n,i),$l.subVectors(e,i),s.cross($l);const o=s.lengthSq();return o>0?s.multiplyScalar(1/Math.sqrt(o)):s.set(0,0,0)}static getBarycoord(e,i,n,s,o){$l.subVectors(s,i),Au.subVectors(n,i),U2.subVectors(e,i);const l=$l.dot($l),u=$l.dot(Au),c=$l.dot(U2),h=Au.dot(Au),p=Au.dot(U2),f=l*h-u*u;if(f===0)return o.set(0,0,0),null;const g=1/f,m=(h*c-u*p)*g,y=(l*p-u*c)*g;return o.set(1-m-y,y,m)}static containsPoint(e,i,n,s){return this.getBarycoord(e,i,n,s,yu)===null?!1:yu.x>=0&&yu.y>=0&&yu.x+yu.y<=1}static getInterpolation(e,i,n,s,o,l,u,c){return this.getBarycoord(e,i,n,s,yu)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(o,yu.x),c.addScaledVector(l,yu.y),c.addScaledVector(u,yu.z),c)}static isFrontFacing(e,i,n,s){return $l.subVectors(n,i),Au.subVectors(e,i),$l.cross(Au).dot(s)<0}set(e,i,n){return this.a.copy(e),this.b.copy(i),this.c.copy(n),this}setFromPointsAndIndices(e,i,n,s){return this.a.copy(e[i]),this.b.copy(e[n]),this.c.copy(e[s]),this}setFromAttributeAndIndices(e,i,n,s){return this.a.fromBufferAttribute(e,i),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return $l.subVectors(this.c,this.b),Au.subVectors(this.a,this.b),$l.cross(Au).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return M0.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,i){return M0.getBarycoord(e,this.a,this.b,this.c,i)}getInterpolation(e,i,n,s,o){return M0.getInterpolation(e,this.a,this.b,this.c,i,n,s,o)}containsPoint(e){return M0.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return M0.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,i){const n=this.a,s=this.b,o=this.c;let l,u;Zf.subVectors(s,n),$f.subVectors(o,n),z2.subVectors(e,n);const c=Zf.dot(z2),h=$f.dot(z2);if(c<=0&&h<=0)return i.copy(n);j2.subVectors(e,s);const p=Zf.dot(j2),f=$f.dot(j2);if(p>=0&&f<=p)return i.copy(s);const g=c*f-p*h;if(g<=0&&c>=0&&p<=0)return l=c/(c-p),i.copy(n).addScaledVector(Zf,l);V2.subVectors(e,o);const m=Zf.dot(V2),y=$f.dot(V2);if(y>=0&&m<=y)return i.copy(o);const b=m*h-c*y;if(b<=0&&h>=0&&y<=0)return u=h/(h-y),i.copy(n).addScaledVector($f,u);const v=p*y-m*f;if(v<=0&&f-p>=0&&m-y>=0)return WN.subVectors(o,s),u=(f-p)/(f-p+(m-y)),i.copy(s).addScaledVector(WN,u);const _=1/(v+b+g);return l=b*_,u=g*_,i.copy(n).addScaledVector(Zf,l).addScaledVector($f,u)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}};const QN={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Uh={h:0,s:0,l:0},yb={h:0,s:0,l:0};function G2(r,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?r+(e-r)*6*i:i<1/2?e:i<2/3?r+(e-r)*6*(2/3-i):r}let Ks=class{constructor(r,e,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(r,e,i)}set(r,e,i){if(e===void 0&&i===void 0){const n=r;n&&n.isColor?this.copy(n):typeof n=="number"?this.setHex(n):typeof n=="string"&&this.setStyle(n)}else this.setRGB(r,e,i);return this}setScalar(r){return this.r=r,this.g=r,this.b=r,this}setHex(r,e=Il){return r=Math.floor(r),this.r=(r>>16&255)/255,this.g=(r>>8&255)/255,this.b=(r&255)/255,Kl.toWorkingColorSpace(this,e),this}setRGB(r,e,i,n=Kl.workingColorSpace){return this.r=r,this.g=e,this.b=i,Kl.toWorkingColorSpace(this,n),this}setHSL(r,e,i,n=Kl.workingColorSpace){if(r=S2(r,1),e=Pa(e,0,1),i=Pa(i,0,1),e===0)this.r=this.g=this.b=i;else{const s=i<=.5?i*(1+e):i+e-i*e,o=2*i-s;this.r=G2(o,s,r+1/3),this.g=G2(o,s,r),this.b=G2(o,s,r-1/3)}return Kl.toWorkingColorSpace(this,n),this}setStyle(r,e=Il){function i(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+r+" will be ignored.")}let n;if(n=/^(\w+)\(([^\)]*)\)/.exec(r)){let s;const o=n[1],l=n[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return i(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,e);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return i(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,e);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return i(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+r)}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(r)){const s=n[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,e);if(o===6)return this.setHex(parseInt(s,16),e);console.warn("THREE.Color: Invalid hex color "+r)}else if(r&&r.length>0)return this.setColorName(r,e);return this}setColorName(r,e=Il){const i=QN[r.toLowerCase()];return i!==void 0?this.setHex(i,e):console.warn("THREE.Color: Unknown color "+r),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(r){return this.r=r.r,this.g=r.g,this.b=r.b,this}copySRGBToLinear(r){return this.r=Vf(r.r),this.g=Vf(r.g),this.b=Vf(r.b),this}copyLinearToSRGB(r){return this.r=R2(r.r),this.g=R2(r.g),this.b=R2(r.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(r=Il){return Kl.fromWorkingColorSpace(Ka.copy(this),r),Math.round(Pa(Ka.r*255,0,255))*65536+Math.round(Pa(Ka.g*255,0,255))*256+Math.round(Pa(Ka.b*255,0,255))}getHexString(r=Il){return("000000"+this.getHex(r).toString(16)).slice(-6)}getHSL(r,e=Kl.workingColorSpace){Kl.fromWorkingColorSpace(Ka.copy(this),e);const i=Ka.r,n=Ka.g,s=Ka.b,o=Math.max(i,n,s),l=Math.min(i,n,s);let u,c;const h=(l+o)/2;if(l===o)u=0,c=0;else{const p=o-l;switch(c=h<=.5?p/(o+l):p/(2-o-l),o){case i:u=(n-s)/p+(n<s?6:0);break;case n:u=(s-i)/p+2;break;case s:u=(i-n)/p+4;break}u/=6}return r.h=u,r.s=c,r.l=h,r}getRGB(r,e=Kl.workingColorSpace){return Kl.fromWorkingColorSpace(Ka.copy(this),e),r.r=Ka.r,r.g=Ka.g,r.b=Ka.b,r}getStyle(r=Il){Kl.fromWorkingColorSpace(Ka.copy(this),r);const e=Ka.r,i=Ka.g,n=Ka.b;return r!==Il?`color(${r} ${e.toFixed(3)} ${i.toFixed(3)} ${n.toFixed(3)})`:`rgb(${Math.round(e*255)},${Math.round(i*255)},${Math.round(n*255)})`}offsetHSL(r,e,i){return this.getHSL(Uh),this.setHSL(Uh.h+r,Uh.s+e,Uh.l+i)}add(r){return this.r+=r.r,this.g+=r.g,this.b+=r.b,this}addColors(r,e){return this.r=r.r+e.r,this.g=r.g+e.g,this.b=r.b+e.b,this}addScalar(r){return this.r+=r,this.g+=r,this.b+=r,this}sub(r){return this.r=Math.max(0,this.r-r.r),this.g=Math.max(0,this.g-r.g),this.b=Math.max(0,this.b-r.b),this}multiply(r){return this.r*=r.r,this.g*=r.g,this.b*=r.b,this}multiplyScalar(r){return this.r*=r,this.g*=r,this.b*=r,this}lerp(r,e){return this.r+=(r.r-this.r)*e,this.g+=(r.g-this.g)*e,this.b+=(r.b-this.b)*e,this}lerpColors(r,e,i){return this.r=r.r+(e.r-r.r)*i,this.g=r.g+(e.g-r.g)*i,this.b=r.b+(e.b-r.b)*i,this}lerpHSL(r,e){this.getHSL(Uh),r.getHSL(yb);const i=Q0(Uh.h,yb.h,e),n=Q0(Uh.s,yb.s,e),s=Q0(Uh.l,yb.l,e);return this.setHSL(i,n,s),this}setFromVector3(r){return this.r=r.x,this.g=r.y,this.b=r.z,this}applyMatrix3(r){const e=this.r,i=this.g,n=this.b,s=r.elements;return this.r=s[0]*e+s[3]*i+s[6]*n,this.g=s[1]*e+s[4]*i+s[7]*n,this.b=s[2]*e+s[5]*i+s[8]*n,this}equals(r){return r.r===this.r&&r.g===this.g&&r.b===this.b}fromArray(r,e=0){return this.r=r[e],this.g=r[e+1],this.b=r[e+2],this}toArray(r=[],e=0){return r[e]=this.r,r[e+1]=this.g,r[e+2]=this.b,r}fromBufferAttribute(r,e){return this.r=r.getX(e),this.g=r.getY(e),this.b=r.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const Ka=new Ks;Ks.NAMES=QN;let gq=0,vb=class extends lb{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:gq++}),this.uuid=Dh(),this.name="",this.type="Material",this.blending=hN,this.side=v2,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=pN,this.blendDst=fN,this.blendEquation=dN,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Ks(0,0,0),this.blendAlpha=0,this.depthFunc=mN,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=BN,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=zf,this.stencilZFail=zf,this.stencilZPass=zf,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(r){this._alphaTest>0!=r>0&&this.version++,this._alphaTest=r}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(r){if(r!==void 0)for(const e in r){const i=r[e];if(i===void 0){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}const n=this[e];if(n===void 0){console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`);continue}n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[e]=i}}toJSON(r){const e=r===void 0||typeof r=="string";e&&(r={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(r).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(r).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(r).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(i.dispersion=this.dispersion),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(r).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(r).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(r).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(r).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(r).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(r).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(r).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(r).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(r).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(r).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(r).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(r).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(r).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(r).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(r).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(r).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(r).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(r).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(r).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(r).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(r).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==hN&&(i.blending=this.blending),this.side!==v2&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==pN&&(i.blendSrc=this.blendSrc),this.blendDst!==fN&&(i.blendDst=this.blendDst),this.blendEquation!==dN&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==mN&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==BN&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==zf&&(i.stencilFail=this.stencilFail),this.stencilZFail!==zf&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==zf&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function n(s){const o=[];for(const l in s){const u=s[l];delete u.metadata,o.push(u)}return o}if(e){const s=n(r.textures),o=n(r.images);s.length>0&&(i.textures=s),o.length>0&&(i.images=o)}return i}clone(){return new this.constructor().copy(this)}copy(r){this.name=r.name,this.blending=r.blending,this.side=r.side,this.vertexColors=r.vertexColors,this.opacity=r.opacity,this.transparent=r.transparent,this.blendSrc=r.blendSrc,this.blendDst=r.blendDst,this.blendEquation=r.blendEquation,this.blendSrcAlpha=r.blendSrcAlpha,this.blendDstAlpha=r.blendDstAlpha,this.blendEquationAlpha=r.blendEquationAlpha,this.blendColor.copy(r.blendColor),this.blendAlpha=r.blendAlpha,this.depthFunc=r.depthFunc,this.depthTest=r.depthTest,this.depthWrite=r.depthWrite,this.stencilWriteMask=r.stencilWriteMask,this.stencilFunc=r.stencilFunc,this.stencilRef=r.stencilRef,this.stencilFuncMask=r.stencilFuncMask,this.stencilFail=r.stencilFail,this.stencilZFail=r.stencilZFail,this.stencilZPass=r.stencilZPass,this.stencilWrite=r.stencilWrite;const e=r.clippingPlanes;let i=null;if(e!==null){const n=e.length;i=new Array(n);for(let s=0;s!==n;++s)i[s]=e[s].clone()}return this.clippingPlanes=i,this.clipIntersection=r.clipIntersection,this.clipShadows=r.clipShadows,this.shadowSide=r.shadowSide,this.colorWrite=r.colorWrite,this.precision=r.precision,this.polygonOffset=r.polygonOffset,this.polygonOffsetFactor=r.polygonOffsetFactor,this.polygonOffsetUnits=r.polygonOffsetUnits,this.dithering=r.dithering,this.alphaTest=r.alphaTest,this.alphaHash=r.alphaHash,this.alphaToCoverage=r.alphaToCoverage,this.premultipliedAlpha=r.premultipliedAlpha,this.forceSinglePass=r.forceSinglePass,this.visible=r.visible,this.toneMapped=r.toneMapped,this.userData=JSON.parse(JSON.stringify(r.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(r){r===!0&&this.version++}},Aq=class extends vb{constructor(r){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Ks(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new fo,this.combine=b2,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.lightMap=r.lightMap,this.lightMapIntensity=r.lightMapIntensity,this.aoMap=r.aoMap,this.aoMapIntensity=r.aoMapIntensity,this.specularMap=r.specularMap,this.alphaMap=r.alphaMap,this.envMap=r.envMap,this.envMapRotation.copy(r.envMapRotation),this.combine=r.combine,this.reflectivity=r.reflectivity,this.refractionRatio=r.refractionRatio,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.wireframeLinecap=r.wireframeLinecap,this.wireframeLinejoin=r.wireframeLinejoin,this.fog=r.fog,this}};const Js=new Pt,bb=new Ws;let em=class{constructor(r,e,i=!1){if(Array.isArray(r))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=r,this.itemSize=e,this.count=r!==void 0?r.length/e:0,this.normalized=i,this.usage=LN,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=vN,this.version=0}onUploadCallback(){}set needsUpdate(r){r===!0&&this.version++}get updateRange(){return iq("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(r){return this.usage=r,this}addUpdateRange(r,e){this.updateRanges.push({start:r,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(r){return this.name=r.name,this.array=new r.array.constructor(r.array),this.itemSize=r.itemSize,this.count=r.count,this.normalized=r.normalized,this.usage=r.usage,this.gpuType=r.gpuType,this}copyAt(r,e,i){r*=this.itemSize,i*=e.itemSize;for(let n=0,s=this.itemSize;n<s;n++)this.array[r+n]=e.array[i+n];return this}copyArray(r){return this.array.set(r),this}applyMatrix3(r){if(this.itemSize===2)for(let e=0,i=this.count;e<i;e++)bb.fromBufferAttribute(this,e),bb.applyMatrix3(r),this.setXY(e,bb.x,bb.y);else if(this.itemSize===3)for(let e=0,i=this.count;e<i;e++)Js.fromBufferAttribute(this,e),Js.applyMatrix3(r),this.setXYZ(e,Js.x,Js.y,Js.z);return this}applyMatrix4(r){for(let e=0,i=this.count;e<i;e++)Js.fromBufferAttribute(this,e),Js.applyMatrix4(r),this.setXYZ(e,Js.x,Js.y,Js.z);return this}applyNormalMatrix(r){for(let e=0,i=this.count;e<i;e++)Js.fromBufferAttribute(this,e),Js.applyNormalMatrix(r),this.setXYZ(e,Js.x,Js.y,Js.z);return this}transformDirection(r){for(let e=0,i=this.count;e<i;e++)Js.fromBufferAttribute(this,e),Js.transformDirection(r),this.setXYZ(e,Js.x,Js.y,Js.z);return this}set(r,e=0){return this.array.set(r,e),this}getComponent(r,e){let i=this.array[r*this.itemSize+e];return this.normalized&&(i=jf(i,this.array)),i}setComponent(r,e,i){return this.normalized&&(i=ho(i,this.array)),this.array[r*this.itemSize+e]=i,this}getX(r){let e=this.array[r*this.itemSize];return this.normalized&&(e=jf(e,this.array)),e}setX(r,e){return this.normalized&&(e=ho(e,this.array)),this.array[r*this.itemSize]=e,this}getY(r){let e=this.array[r*this.itemSize+1];return this.normalized&&(e=jf(e,this.array)),e}setY(r,e){return this.normalized&&(e=ho(e,this.array)),this.array[r*this.itemSize+1]=e,this}getZ(r){let e=this.array[r*this.itemSize+2];return this.normalized&&(e=jf(e,this.array)),e}setZ(r,e){return this.normalized&&(e=ho(e,this.array)),this.array[r*this.itemSize+2]=e,this}getW(r){let e=this.array[r*this.itemSize+3];return this.normalized&&(e=jf(e,this.array)),e}setW(r,e){return this.normalized&&(e=ho(e,this.array)),this.array[r*this.itemSize+3]=e,this}setXY(r,e,i){return r*=this.itemSize,this.normalized&&(e=ho(e,this.array),i=ho(i,this.array)),this.array[r+0]=e,this.array[r+1]=i,this}setXYZ(r,e,i,n){return r*=this.itemSize,this.normalized&&(e=ho(e,this.array),i=ho(i,this.array),n=ho(n,this.array)),this.array[r+0]=e,this.array[r+1]=i,this.array[r+2]=n,this}setXYZW(r,e,i,n,s){return r*=this.itemSize,this.normalized&&(e=ho(e,this.array),i=ho(i,this.array),n=ho(n,this.array),s=ho(s,this.array)),this.array[r+0]=e,this.array[r+1]=i,this.array[r+2]=n,this.array[r+3]=s,this}onUpload(r){return this.onUploadCallback=r,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const r={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(r.name=this.name),this.usage!==LN&&(r.usage=this.usage),r}},qN=class extends em{constructor(r,e,i){super(new Uint16Array(r),e,i)}},yq=class extends em{constructor(r,e,i){super(new Uint32Array(r),e,i)}},zh=class extends em{constructor(r,e,i){super(new Float32Array(r),e,i)}},vq=0;const Bl=new Hr,H2=new Oa,tm=new Pt,sl=new Hf,K0=new Hf,Ca=new Pt;let J0=class CG extends lb{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:vq++}),this.uuid=Dh(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(tq(e)?yq:qN)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,i){return this.attributes[e]=i,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,i,n=0){this.groups.push({start:e,count:i,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,i){this.drawRange.start=e,this.drawRange.count=i}applyMatrix4(e){const i=this.attributes.position;i!==void 0&&(i.applyMatrix4(e),i.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const o=new Nh().getNormalMatrix(e);n.applyNormalMatrix(o),n.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(e),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Bl.makeRotationFromQuaternion(e),this.applyMatrix4(Bl),this}rotateX(e){return Bl.makeRotationX(e),this.applyMatrix4(Bl),this}rotateY(e){return Bl.makeRotationY(e),this.applyMatrix4(Bl),this}rotateZ(e){return Bl.makeRotationZ(e),this.applyMatrix4(Bl),this}translate(e,i,n){return Bl.makeTranslation(e,i,n),this.applyMatrix4(Bl),this}scale(e,i,n){return Bl.makeScale(e,i,n),this.applyMatrix4(Bl),this}lookAt(e){return H2.lookAt(e),H2.updateMatrix(),this.applyMatrix4(H2.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(tm).negate(),this.translate(tm.x,tm.y,tm.z),this}setFromPoints(e){const i=[];for(let n=0,s=e.length;n<s;n++){const o=e[n];i.push(o.x,o.y,o.z||0)}return this.setAttribute("position",new zh(i,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Hf);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new Pt(-1/0,-1/0,-1/0),new Pt(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),i)for(let n=0,s=i.length;n<s;n++){const o=i[n];sl.setFromBufferAttribute(o),this.morphTargetsRelative?(Ca.addVectors(this.boundingBox.min,sl.min),this.boundingBox.expandByPoint(Ca),Ca.addVectors(this.boundingBox.max,sl.max),this.boundingBox.expandByPoint(Ca)):(this.boundingBox.expandByPoint(sl.min),this.boundingBox.expandByPoint(sl.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Xf);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new Pt,1/0);return}if(e){const n=this.boundingSphere.center;if(sl.setFromBufferAttribute(e),i)for(let o=0,l=i.length;o<l;o++){const u=i[o];K0.setFromBufferAttribute(u),this.morphTargetsRelative?(Ca.addVectors(sl.min,K0.min),sl.expandByPoint(Ca),Ca.addVectors(sl.max,K0.max),sl.expandByPoint(Ca)):(sl.expandByPoint(K0.min),sl.expandByPoint(K0.max))}sl.getCenter(n);let s=0;for(let o=0,l=e.count;o<l;o++)Ca.fromBufferAttribute(e,o),s=Math.max(s,n.distanceToSquared(Ca));if(i)for(let o=0,l=i.length;o<l;o++){const u=i[o],c=this.morphTargetsRelative;for(let h=0,p=u.count;h<p;h++)Ca.fromBufferAttribute(u,h),c&&(tm.fromBufferAttribute(e,h),Ca.add(tm)),s=Math.max(s,n.distanceToSquared(Ca))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,i=this.attributes;if(e===null||i.position===void 0||i.normal===void 0||i.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=i.position,s=i.normal,o=i.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new em(new Float32Array(4*n.count),4));const l=this.getAttribute("tangent"),u=[],c=[];for(let N=0;N<n.count;N++)u[N]=new Pt,c[N]=new Pt;const h=new Pt,p=new Pt,f=new Pt,g=new Ws,m=new Ws,y=new Ws,b=new Pt,v=new Pt;function _(N,D,P){h.fromBufferAttribute(n,N),p.fromBufferAttribute(n,D),f.fromBufferAttribute(n,P),g.fromBufferAttribute(o,N),m.fromBufferAttribute(o,D),y.fromBufferAttribute(o,P),p.sub(h),f.sub(h),m.sub(g),y.sub(g);const k=1/(m.x*y.y-y.x*m.y);isFinite(k)&&(b.copy(p).multiplyScalar(y.y).addScaledVector(f,-m.y).multiplyScalar(k),v.copy(f).multiplyScalar(m.x).addScaledVector(p,-y.x).multiplyScalar(k),u[N].add(b),u[D].add(b),u[P].add(b),c[N].add(v),c[D].add(v),c[P].add(v))}let T=this.groups;T.length===0&&(T=[{start:0,count:e.count}]);for(let N=0,D=T.length;N<D;++N){const P=T[N],k=P.start,q=P.count;for(let V=k,j=k+q;V<j;V+=3)_(e.getX(V+0),e.getX(V+1),e.getX(V+2))}const E=new Pt,C=new Pt,R=new Pt,B=new Pt;function I(N){R.fromBufferAttribute(s,N),B.copy(R);const D=u[N];E.copy(D),E.sub(R.multiplyScalar(R.dot(D))).normalize(),C.crossVectors(B,D);const P=C.dot(c[N])<0?-1:1;l.setXYZW(N,E.x,E.y,E.z,P)}for(let N=0,D=T.length;N<D;++N){const P=T[N],k=P.start,q=P.count;for(let V=k,j=k+q;V<j;V+=3)I(e.getX(V+0)),I(e.getX(V+1)),I(e.getX(V+2))}}computeVertexNormals(){const e=this.index,i=this.getAttribute("position");if(i!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new em(new Float32Array(i.count*3),3),this.setAttribute("normal",n);else for(let g=0,m=n.count;g<m;g++)n.setXYZ(g,0,0,0);const s=new Pt,o=new Pt,l=new Pt,u=new Pt,c=new Pt,h=new Pt,p=new Pt,f=new Pt;if(e)for(let g=0,m=e.count;g<m;g+=3){const y=e.getX(g+0),b=e.getX(g+1),v=e.getX(g+2);s.fromBufferAttribute(i,y),o.fromBufferAttribute(i,b),l.fromBufferAttribute(i,v),p.subVectors(l,o),f.subVectors(s,o),p.cross(f),u.fromBufferAttribute(n,y),c.fromBufferAttribute(n,b),h.fromBufferAttribute(n,v),u.add(p),c.add(p),h.add(p),n.setXYZ(y,u.x,u.y,u.z),n.setXYZ(b,c.x,c.y,c.z),n.setXYZ(v,h.x,h.y,h.z)}else for(let g=0,m=i.count;g<m;g+=3)s.fromBufferAttribute(i,g+0),o.fromBufferAttribute(i,g+1),l.fromBufferAttribute(i,g+2),p.subVectors(l,o),f.subVectors(s,o),p.cross(f),n.setXYZ(g+0,p.x,p.y,p.z),n.setXYZ(g+1,p.x,p.y,p.z),n.setXYZ(g+2,p.x,p.y,p.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let i=0,n=e.count;i<n;i++)Ca.fromBufferAttribute(e,i),Ca.normalize(),e.setXYZ(i,Ca.x,Ca.y,Ca.z)}toNonIndexed(){function e(u,c){const h=u.array,p=u.itemSize,f=u.normalized,g=new h.constructor(c.length*p);let m=0,y=0;for(let b=0,v=c.length;b<v;b++){u.isInterleavedBufferAttribute?m=c[b]*u.data.stride+u.offset:m=c[b]*p;for(let _=0;_<p;_++)g[y++]=h[m++]}return new em(g,p,f)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const i=new CG,n=this.index.array,s=this.attributes;for(const u in s){const c=s[u],h=e(c,n);i.setAttribute(u,h)}const o=this.morphAttributes;for(const u in o){const c=[],h=o[u];for(let p=0,f=h.length;p<f;p++){const g=h[p],m=e(g,n);c.push(m)}i.morphAttributes[u]=c}i.morphTargetsRelative=this.morphTargetsRelative;const l=this.groups;for(let u=0,c=l.length;u<c;u++){const h=l[u];i.addGroup(h.start,h.count,h.materialIndex)}return i}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const h in c)c[h]!==void 0&&(e[h]=c[h]);return e}e.data={attributes:{}};const i=this.index;i!==null&&(e.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});const n=this.attributes;for(const c in n){const h=n[c];e.data.attributes[c]=h.toJSON(e.data)}const s={};let o=!1;for(const c in this.morphAttributes){const h=this.morphAttributes[c],p=[];for(let f=0,g=h.length;f<g;f++){const m=h[f];p.push(m.toJSON(e.data))}p.length>0&&(s[c]=p,o=!0)}o&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);const l=this.groups;l.length>0&&(e.data.groups=JSON.parse(JSON.stringify(l)));const u=this.boundingSphere;return u!==null&&(e.data.boundingSphere={center:u.center.toArray(),radius:u.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const i={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone(i));const s=e.attributes;for(const h in s){const p=s[h];this.setAttribute(h,p.clone(i))}const o=e.morphAttributes;for(const h in o){const p=[],f=o[h];for(let g=0,m=f.length;g<m;g++)p.push(f[g].clone(i));this.morphAttributes[h]=p}this.morphTargetsRelative=e.morphTargetsRelative;const l=e.groups;for(let h=0,p=l.length;h<p;h++){const f=l[h];this.addGroup(f.start,f.count,f.materialIndex)}const u=e.boundingBox;u!==null&&(this.boundingBox=u.clone());const c=e.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}};const XN=new Hr,tp=new k2,xb=new Xf,YN=new Pt,im=new Pt,rm=new Pt,nm=new Pt,W2=new Pt,_b=new Pt,Eb=new Ws,wb=new Ws,Cb=new Ws,KN=new Pt,JN=new Pt,ZN=new Pt,Sb=new Pt,Tb=new Pt;let $N=class extends Oa{constructor(r=new J0,e=new Aq){super(),this.isMesh=!0,this.type="Mesh",this.geometry=r,this.material=e,this.updateMorphTargets()}copy(r,e){return super.copy(r,e),r.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=r.morphTargetInfluences.slice()),r.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},r.morphTargetDictionary)),this.material=Array.isArray(r.material)?r.material.slice():r.material,this.geometry=r.geometry,this}updateMorphTargets(){const r=this.geometry.morphAttributes,e=Object.keys(r);if(e.length>0){const i=r[e[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let n=0,s=i.length;n<s;n++){const o=i[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=n}}}}getVertexPosition(r,e){const i=this.geometry,n=i.attributes.position,s=i.morphAttributes.position,o=i.morphTargetsRelative;e.fromBufferAttribute(n,r);const l=this.morphTargetInfluences;if(s&&l){_b.set(0,0,0);for(let u=0,c=s.length;u<c;u++){const h=l[u],p=s[u];h!==0&&(W2.fromBufferAttribute(p,r),o?_b.addScaledVector(W2,h):_b.addScaledVector(W2.sub(e),h))}e.add(_b)}return e}raycast(r,e){const i=this.geometry,n=this.material,s=this.matrixWorld;n!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),xb.copy(i.boundingSphere),xb.applyMatrix4(s),tp.copy(r.ray).recast(r.near),!(xb.containsPoint(tp.origin)===!1&&(tp.intersectSphere(xb,YN)===null||tp.origin.distanceToSquared(YN)>(r.far-r.near)**2))&&(XN.copy(s).invert(),tp.copy(r.ray).applyMatrix4(XN),!(i.boundingBox!==null&&tp.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(r,e,tp)))}_computeIntersections(r,e,i){let n;const s=this.geometry,o=this.material,l=s.index,u=s.attributes.position,c=s.attributes.uv,h=s.attributes.uv1,p=s.attributes.normal,f=s.groups,g=s.drawRange;if(l!==null)if(Array.isArray(o))for(let m=0,y=f.length;m<y;m++){const b=f[m],v=o[b.materialIndex],_=Math.max(b.start,g.start),T=Math.min(l.count,Math.min(b.start+b.count,g.start+g.count));for(let E=_,C=T;E<C;E+=3){const R=l.getX(E),B=l.getX(E+1),I=l.getX(E+2);n=Mb(this,v,r,i,c,h,p,R,B,I),n&&(n.faceIndex=Math.floor(E/3),n.face.materialIndex=b.materialIndex,e.push(n))}}else{const m=Math.max(0,g.start),y=Math.min(l.count,g.start+g.count);for(let b=m,v=y;b<v;b+=3){const _=l.getX(b),T=l.getX(b+1),E=l.getX(b+2);n=Mb(this,o,r,i,c,h,p,_,T,E),n&&(n.faceIndex=Math.floor(b/3),e.push(n))}}else if(u!==void 0)if(Array.isArray(o))for(let m=0,y=f.length;m<y;m++){const b=f[m],v=o[b.materialIndex],_=Math.max(b.start,g.start),T=Math.min(u.count,Math.min(b.start+b.count,g.start+g.count));for(let E=_,C=T;E<C;E+=3){const R=E,B=E+1,I=E+2;n=Mb(this,v,r,i,c,h,p,R,B,I),n&&(n.faceIndex=Math.floor(E/3),n.face.materialIndex=b.materialIndex,e.push(n))}}else{const m=Math.max(0,g.start),y=Math.min(u.count,g.start+g.count);for(let b=m,v=y;b<v;b+=3){const _=b,T=b+1,E=b+2;n=Mb(this,o,r,i,c,h,p,_,T,E),n&&(n.faceIndex=Math.floor(b/3),e.push(n))}}}};function bq(r,e,i,n,s,o,l,u){let c;if(e.side===MQ?c=n.intersectTriangle(l,o,s,!0,u):c=n.intersectTriangle(s,o,l,e.side===v2,u),c===null)return null;Tb.copy(u),Tb.applyMatrix4(r.matrixWorld);const h=i.ray.origin.distanceTo(Tb);return h<i.near||h>i.far?null:{distance:h,point:Tb.clone(),object:r}}function Mb(r,e,i,n,s,o,l,u,c,h){r.getVertexPosition(u,im),r.getVertexPosition(c,rm),r.getVertexPosition(h,nm);const p=bq(r,e,i,n,im,rm,nm,Sb);if(p){s&&(Eb.fromBufferAttribute(s,u),wb.fromBufferAttribute(s,c),Cb.fromBufferAttribute(s,h),p.uv=Ab.getInterpolation(Sb,im,rm,nm,Eb,wb,Cb,new Ws)),o&&(Eb.fromBufferAttribute(o,u),wb.fromBufferAttribute(o,c),Cb.fromBufferAttribute(o,h),p.uv1=Ab.getInterpolation(Sb,im,rm,nm,Eb,wb,Cb,new Ws)),l&&(KN.fromBufferAttribute(l,u),JN.fromBufferAttribute(l,c),ZN.fromBufferAttribute(l,h),p.normal=Ab.getInterpolation(Sb,im,rm,nm,KN,JN,ZN,new Pt),p.normal.dot(n.direction)>0&&p.normal.multiplyScalar(-1));const f={a:u,b:c,c:h,normal:new Pt,materialIndex:0};Ab.getNormal(im,rm,nm,f.normal),p.face=f}return p}let eP=class extends Oa{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Hr,this.projectionMatrix=new Hr,this.projectionMatrixInverse=new Hr,this.coordinateSystem=Zd}copy(r,e){return super.copy(r,e),this.matrixWorldInverse.copy(r.matrixWorldInverse),this.projectionMatrix.copy(r.projectionMatrix),this.projectionMatrixInverse.copy(r.projectionMatrixInverse),this.coordinateSystem=r.coordinateSystem,this}getWorldDirection(r){return super.getWorldDirection(r).negate()}updateMatrixWorld(r){super.updateMatrixWorld(r),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(r,e){super.updateWorldMatrix(r,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}};const jh=new Pt,tP=new Ws,iP=new Ws;let Q2=class extends eP{constructor(r=50,e=1,i=.1,n=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=r,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(r,e){return super.copy(r,e),this.fov=r.fov,this.zoom=r.zoom,this.near=r.near,this.far=r.far,this.focus=r.focus,this.aspect=r.aspect,this.view=r.view===null?null:Object.assign({},r.view),this.filmGauge=r.filmGauge,this.filmOffset=r.filmOffset,this}setFocalLength(r){const e=.5*this.getFilmHeight()/r;this.fov=W0*2*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const r=Math.tan(H0*.5*this.fov);return .5*this.getFilmHeight()/r}getEffectiveFOV(){return W0*2*Math.atan(Math.tan(H0*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(r,e,i){jh.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),e.set(jh.x,jh.y).multiplyScalar(-r/jh.z),jh.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(jh.x,jh.y).multiplyScalar(-r/jh.z)}getViewSize(r,e){return this.getViewBounds(r,tP,iP),e.subVectors(iP,tP)}setViewOffset(r,e,i,n,s,o){this.aspect=r/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=r,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const r=this.near;let e=r*Math.tan(H0*.5*this.fov)/this.zoom,i=2*e,n=this.aspect*i,s=-.5*n;const o=this.view;if(this.view!==null&&this.view.enabled){const u=o.fullWidth,c=o.fullHeight;s+=o.offsetX*n/u,e-=o.offsetY*i/c,n*=o.width/u,i*=o.height/c}const l=this.filmOffset;l!==0&&(s+=r*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+n,e,e-i,r,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(r){const e=super.toJSON(r);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}};const q2=new Pt,xq=new Pt,_q=new Nh;let sm=class{constructor(r=new Pt(1,0,0),e=0){this.isPlane=!0,this.normal=r,this.constant=e}set(r,e){return this.normal.copy(r),this.constant=e,this}setComponents(r,e,i,n){return this.normal.set(r,e,i),this.constant=n,this}setFromNormalAndCoplanarPoint(r,e){return this.normal.copy(r),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(r,e,i){const n=q2.subVectors(i,e).cross(xq.subVectors(r,e)).normalize();return this.setFromNormalAndCoplanarPoint(n,r),this}copy(r){return this.normal.copy(r.normal),this.constant=r.constant,this}normalize(){const r=1/this.normal.length();return this.normal.multiplyScalar(r),this.constant*=r,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(r){return this.normal.dot(r)+this.constant}distanceToSphere(r){return this.distanceToPoint(r.center)-r.radius}projectPoint(r,e){return e.copy(r).addScaledVector(this.normal,-this.distanceToPoint(r))}intersectLine(r,e){const i=r.delta(q2),n=this.normal.dot(i);if(n===0)return this.distanceToPoint(r.start)===0?e.copy(r.start):null;const s=-(r.start.dot(this.normal)+this.constant)/n;return s<0||s>1?null:e.copy(r.start).addScaledVector(i,s)}intersectsLine(r){const e=this.distanceToPoint(r.start),i=this.distanceToPoint(r.end);return e<0&&i>0||i<0&&e>0}intersectsBox(r){return r.intersectsPlane(this)}intersectsSphere(r){return r.intersectsPlane(this)}coplanarPoint(r){return r.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(r,e){const i=e||_q.getNormalMatrix(r),n=this.coplanarPoint(q2).applyMatrix4(r),s=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(s),this}translate(r){return this.constant-=r.dot(this.normal),this}equals(r){return r.normal.equals(this.normal)&&r.constant===this.constant}clone(){return new this.constructor().copy(this)}};const ip=new Xf,Rb=new Pt;let Eq=class{constructor(r=new sm,e=new sm,i=new sm,n=new sm,s=new sm,o=new sm){this.planes=[r,e,i,n,s,o]}set(r,e,i,n,s,o){const l=this.planes;return l[0].copy(r),l[1].copy(e),l[2].copy(i),l[3].copy(n),l[4].copy(s),l[5].copy(o),this}copy(r){const e=this.planes;for(let i=0;i<6;i++)e[i].copy(r.planes[i]);return this}setFromProjectionMatrix(r,e=Zd){const i=this.planes,n=r.elements,s=n[0],o=n[1],l=n[2],u=n[3],c=n[4],h=n[5],p=n[6],f=n[7],g=n[8],m=n[9],y=n[10],b=n[11],v=n[12],_=n[13],T=n[14],E=n[15];if(i[0].setComponents(u-s,f-c,b-g,E-v).normalize(),i[1].setComponents(u+s,f+c,b+g,E+v).normalize(),i[2].setComponents(u+o,f+h,b+m,E+_).normalize(),i[3].setComponents(u-o,f-h,b-m,E-_).normalize(),i[4].setComponents(u-l,f-p,b-y,E-T).normalize(),e===Zd)i[5].setComponents(u+l,f+p,b+y,E+T).normalize();else if(e===C2)i[5].setComponents(l,p,y,T).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);return this}intersectsObject(r){if(r.boundingSphere!==void 0)r.boundingSphere===null&&r.computeBoundingSphere(),ip.copy(r.boundingSphere).applyMatrix4(r.matrixWorld);else{const e=r.geometry;e.boundingSphere===null&&e.computeBoundingSphere(),ip.copy(e.boundingSphere).applyMatrix4(r.matrixWorld)}return this.intersectsSphere(ip)}intersectsSprite(r){return ip.center.set(0,0,0),ip.radius=.7071067811865476,ip.applyMatrix4(r.matrixWorld),this.intersectsSphere(ip)}intersectsSphere(r){const e=this.planes,i=r.center,n=-r.radius;for(let s=0;s<6;s++)if(e[s].distanceToPoint(i)<n)return!1;return!0}intersectsBox(r){const e=this.planes;for(let i=0;i<6;i++){const n=e[i];if(Rb.x=n.normal.x>0?r.max.x:r.min.x,Rb.y=n.normal.y>0?r.max.y:r.min.y,Rb.z=n.normal.z>0?r.max.z:r.min.z,n.distanceToPoint(Rb)<0)return!1}return!0}containsPoint(r){const e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(r)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}},rP=class extends eP{constructor(r=-1,e=1,i=1,n=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=r,this.right=e,this.top=i,this.bottom=n,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(r,e){return super.copy(r,e),this.left=r.left,this.right=r.right,this.top=r.top,this.bottom=r.bottom,this.near=r.near,this.far=r.far,this.zoom=r.zoom,this.view=r.view===null?null:Object.assign({},r.view),this}setViewOffset(r,e,i,n,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=r,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const r=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let s=i-r,o=i+r,l=n+e,u=n-e;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=c*this.view.offsetX,o=s+c*this.view.width,l-=h*this.view.offsetY,u=l-h*this.view.height}this.projectionMatrix.makeOrthographic(s,o,l,u,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(r){const e=super.toJSON(r);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}},wq=class extends pu{constructor(r,e,i,n,s,o,l,u,c,h){if(h=h!==void 0?h:x2,h!==x2&&h!==xN)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&h===x2&&(i=NQ),i===void 0&&h===xN&&(i=PQ),super(null,n,s,o,l,u,h,i,c),this.isDepthTexture=!0,this.image={width:r,height:e},this.magFilter=l!==void 0?l:sb,this.minFilter=u!==void 0?u:sb,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(r){return super.copy(r),this.compareFunction=r.compareFunction,this}toJSON(r){const e=super.toJSON(r);return this.compareFunction!==null&&(e.compareFunction=this.compareFunction),e}};const Cq=new wq(1,1);Cq.compareFunction=FQ;let nP=class extends Oa{constructor(){super(),this.isGroup=!0,this.type="Group"}};const sP=new Pt,aP=new Oo,oP=new Oo,Sq=new Pt,lP=new Hr,Ib=new Pt,X2=new Xf,cP=new Hr,Y2=new k2;class Tq extends $N{constructor(e,i){super(e,i),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=gN,this.bindMatrix=new Hr,this.bindMatrixInverse=new Hr,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new Hf),this.boundingBox.makeEmpty();const i=e.getAttribute("position");for(let n=0;n<i.count;n++)this.getVertexPosition(n,Ib),this.boundingBox.expandByPoint(Ib)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Xf),this.boundingSphere.makeEmpty();const i=e.getAttribute("position");for(let n=0;n<i.count;n++)this.getVertexPosition(n,Ib),this.boundingSphere.expandByPoint(Ib)}copy(e,i){return super.copy(e,i),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,i){const n=this.material,s=this.matrixWorld;n!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),X2.copy(this.boundingSphere),X2.applyMatrix4(s),e.ray.intersectsSphere(X2)!==!1&&(cP.copy(s).invert(),Y2.copy(e.ray).applyMatrix4(cP),!(this.boundingBox!==null&&Y2.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,i,Y2)))}getVertexPosition(e,i){return super.getVertexPosition(e,i),this.applyBoneTransform(e,i),i}bind(e,i){this.skeleton=e,i===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),i=this.matrixWorld),this.bindMatrix.copy(i),this.bindMatrixInverse.copy(i).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Oo,i=this.geometry.attributes.skinWeight;for(let n=0,s=i.count;n<s;n++){e.fromBufferAttribute(i,n);const o=1/e.manhattanLength();o!==1/0?e.multiplyScalar(o):e.set(1,0,0,0),i.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===gN?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===RQ?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,i){const n=this.skeleton,s=this.geometry;aP.fromBufferAttribute(s.attributes.skinIndex,e),oP.fromBufferAttribute(s.attributes.skinWeight,e),sP.copy(i).applyMatrix4(this.bindMatrix),i.set(0,0,0);for(let o=0;o<4;o++){const l=oP.getComponent(o);if(l!==0){const u=aP.getComponent(o);lP.multiplyMatrices(n.bones[u].matrixWorld,n.boneInverses[u]),i.addScaledVector(Sq.copy(sP).applyMatrix4(lP),l)}}return i.applyMatrix4(this.bindMatrixInverse)}}class K2 extends Oa{constructor(){super(),this.isBone=!0,this.type="Bone"}}let Mq=class extends pu{constructor(r=null,e=1,i=1,n,s,o,l,u,c=sb,h=sb,p,f){super(null,o,l,u,c,h,n,s,p,f),this.isDataTexture=!0,this.image={data:r,width:e,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};const uP=new Hr,Rq=new Hr;class J2{constructor(e=[],i=[]){this.uuid=Dh(),this.bones=e.slice(0),this.boneInverses=i,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,i=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),i.length===0)this.calculateInverses();else if(e.length!==i.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let n=0,s=this.bones.length;n<s;n++)this.boneInverses.push(new Hr)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,i=this.bones.length;e<i;e++){const n=new Hr;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}pose(){for(let e=0,i=this.bones.length;e<i;e++){const n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,i=this.bones.length;e<i;e++){const n=this.bones[e];n&&(n.parent&&n.parent.isBone?(n.matrix.copy(n.parent.matrixWorld).invert(),n.matrix.multiply(n.matrixWorld)):n.matrix.copy(n.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale))}}update(){const e=this.bones,i=this.boneInverses,n=this.boneMatrices,s=this.boneTexture;for(let o=0,l=e.length;o<l;o++){const u=e[o]?e[o].matrixWorld:Rq;uP.multiplyMatrices(u,i[o]),uP.toArray(n,o*16)}s!==null&&(s.needsUpdate=!0)}clone(){return new J2(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const i=new Float32Array(e*e*4);i.set(this.boneMatrices);const n=new Mq(i,e,e,bN,vN);return n.needsUpdate=!0,this.boneMatrices=i,this.boneTexture=n,this}getBoneByName(e){for(let i=0,n=this.bones.length;i<n;i++){const s=this.bones[i];if(s.name===e)return s}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,i){this.uuid=e.uuid;for(let n=0,s=e.bones.length;n<s;n++){const o=e.bones[n];let l=i[o];l===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",o),l=new K2),this.bones.push(l),this.boneInverses.push(new Hr().fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const i=this.bones,n=this.boneInverses;for(let s=0,o=i.length;s<o;s++){const l=i[s];e.bones.push(l.uuid);const u=n[s];e.boneInverses.push(u.toArray())}return e}}let hP=class extends vb{constructor(r){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Ks(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.linewidth=r.linewidth,this.linecap=r.linecap,this.linejoin=r.linejoin,this.fog=r.fog,this}};const Bb=new Pt,Lb=new Pt,dP=new Hr,Z0=new k2,Db=new Xf,Z2=new Pt,pP=new Pt;let Iq=class extends Oa{constructor(r=new J0,e=new hP){super(),this.isLine=!0,this.type="Line",this.geometry=r,this.material=e,this.updateMorphTargets()}copy(r,e){return super.copy(r,e),this.material=Array.isArray(r.material)?r.material.slice():r.material,this.geometry=r.geometry,this}computeLineDistances(){const r=this.geometry;if(r.index===null){const e=r.attributes.position,i=[0];for(let n=1,s=e.count;n<s;n++)Bb.fromBufferAttribute(e,n-1),Lb.fromBufferAttribute(e,n),i[n]=i[n-1],i[n]+=Bb.distanceTo(Lb);r.setAttribute("lineDistance",new zh(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(r,e){const i=this.geometry,n=this.matrixWorld,s=r.params.Line.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),Db.copy(i.boundingSphere),Db.applyMatrix4(n),Db.radius+=s,r.ray.intersectsSphere(Db)===!1)return;dP.copy(n).invert(),Z0.copy(r.ray).applyMatrix4(dP);const l=s/((this.scale.x+this.scale.y+this.scale.z)/3),u=l*l,c=this.isLineSegments?2:1,h=i.index,p=i.attributes.position;if(h!==null){const f=Math.max(0,o.start),g=Math.min(h.count,o.start+o.count);for(let m=f,y=g-1;m<y;m+=c){const b=h.getX(m),v=h.getX(m+1),_=Nb(this,r,Z0,u,b,v);_&&e.push(_)}if(this.isLineLoop){const m=h.getX(g-1),y=h.getX(f),b=Nb(this,r,Z0,u,m,y);b&&e.push(b)}}else{const f=Math.max(0,o.start),g=Math.min(p.count,o.start+o.count);for(let m=f,y=g-1;m<y;m+=c){const b=Nb(this,r,Z0,u,m,m+1);b&&e.push(b)}if(this.isLineLoop){const m=Nb(this,r,Z0,u,g-1,f);m&&e.push(m)}}}updateMorphTargets(){const r=this.geometry.morphAttributes,e=Object.keys(r);if(e.length>0){const i=r[e[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let n=0,s=i.length;n<s;n++){const o=i[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=n}}}}};function Nb(r,e,i,n,s,o){const l=r.geometry.attributes.position;if(Bb.fromBufferAttribute(l,s),Lb.fromBufferAttribute(l,o),i.distanceSqToSegment(Bb,Lb,Z2,pP)>n)return;Z2.applyMatrix4(r.matrixWorld);const u=e.ray.origin.distanceTo(Z2);if(!(u<e.near||u>e.far))return{distance:u,point:pP.clone().applyMatrix4(r.matrixWorld),index:s,face:null,faceIndex:null,object:r}}let Bq=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(r,e){const i=this.getUtoTmapping(r);return this.getPoint(i,e)}getPoints(r=5){const e=[];for(let i=0;i<=r;i++)e.push(this.getPoint(i/r));return e}getSpacedPoints(r=5){const e=[];for(let i=0;i<=r;i++)e.push(this.getPointAt(i/r));return e}getLength(){const r=this.getLengths();return r[r.length-1]}getLengths(r=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===r+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let i,n=this.getPoint(0),s=0;e.push(0);for(let o=1;o<=r;o++)i=this.getPoint(o/r),s+=i.distanceTo(n),e.push(s),n=i;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(r,e){const i=this.getLengths();let n=0;const s=i.length;let o;e?o=e:o=r*i[s-1];let l=0,u=s-1,c;for(;l<=u;)if(n=Math.floor(l+(u-l)/2),c=i[n]-o,c<0)l=n+1;else if(c>0)u=n-1;else{u=n;break}if(n=u,i[n]===o)return n/(s-1);const h=i[n],p=i[n+1]-h,f=(o-h)/p;return(n+f)/(s-1)}getTangent(r,e){let i=r-1e-4,n=r+1e-4;i<0&&(i=0),n>1&&(n=1);const s=this.getPoint(i),o=this.getPoint(n),l=e||(s.isVector2?new Ws:new Pt);return l.copy(o).sub(s).normalize(),l}getTangentAt(r,e){const i=this.getUtoTmapping(r);return this.getTangent(i,e)}computeFrenetFrames(r,e){const i=new Pt,n=[],s=[],o=[],l=new Pt,u=new Hr;for(let g=0;g<=r;g++){const m=g/r;n[g]=this.getTangentAt(m,new Pt)}s[0]=new Pt,o[0]=new Pt;let c=Number.MAX_VALUE;const h=Math.abs(n[0].x),p=Math.abs(n[0].y),f=Math.abs(n[0].z);h<=c&&(c=h,i.set(1,0,0)),p<=c&&(c=p,i.set(0,1,0)),f<=c&&i.set(0,0,1),l.crossVectors(n[0],i).normalize(),s[0].crossVectors(n[0],l),o[0].crossVectors(n[0],s[0]);for(let g=1;g<=r;g++){if(s[g]=s[g-1].clone(),o[g]=o[g-1].clone(),l.crossVectors(n[g-1],n[g]),l.length()>Number.EPSILON){l.normalize();const m=Math.acos(Pa(n[g-1].dot(n[g]),-1,1));s[g].applyMatrix4(u.makeRotationAxis(l,m))}o[g].crossVectors(n[g],s[g])}if(e===!0){let g=Math.acos(Pa(s[0].dot(s[r]),-1,1));g/=r,n[0].dot(l.crossVectors(s[0],s[r]))>0&&(g=-g);for(let m=1;m<=r;m++)s[m].applyMatrix4(u.makeRotationAxis(n[m],g*m)),o[m].crossVectors(n[m],s[m])}return{tangents:n,normals:s,binormals:o}}clone(){return new this.constructor().copy(this)}copy(r){return this.arcLengthDivisions=r.arcLengthDivisions,this}toJSON(){const r={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return r.arcLengthDivisions=this.arcLengthDivisions,r.type=this.type,r}fromJSON(r){return this.arcLengthDivisions=r.arcLengthDivisions,this}};const Lq={triangulate:function(r,e,i=2){const n=e&&e.length,s=n?e[0]*i:r.length;let o=fP(r,0,s,i,!0);const l=[];if(!o||o.next===o.prev)return l;let u,c,h,p,f,g,m;if(n&&(o=kq(r,e,o,i)),r.length>80*i){u=h=r[0],c=p=r[1];for(let y=i;y<s;y+=i)f=r[y],g=r[y+1],f<u&&(u=f),g<c&&(c=g),f>h&&(h=f),g>p&&(p=g);m=Math.max(h-u,p-c),m=m!==0?32767/m:0}return $0(o,l,i,u,c,m,0),l}};function fP(r,e,i,n,s){let o,l;if(s===Xq(r,e,i,n)>0)for(o=e;o<i;o+=n)l=AP(o,r[o],r[o+1],l);else for(o=i-n;o>=e;o-=n)l=AP(o,r[o],r[o+1],l);return l&&Pb(l,l.next)&&(tA(l),l=l.next),l}function rp(r,e){if(!r)return r;e||(e=r);let i=r,n;do if(n=!1,!i.steiner&&(Pb(i,i.next)||Rs(i.prev,i,i.next)===0)){if(tA(i),i=e=i.prev,i===i.next)break;n=!0}else i=i.next;while(n||i!==e);return e}function $0(r,e,i,n,s,o,l){if(!r)return;!l&&o&&Vq(r,n,s,o);let u=r,c,h;for(;r.prev!==r.next;){if(c=r.prev,h=r.next,o?Nq(r,n,s,o):Dq(r)){e.push(c.i/i|0),e.push(r.i/i|0),e.push(h.i/i|0),tA(r),r=h.next,u=h.next;continue}if(r=h,r===u){l?l===1?(r=Pq(rp(r),e,i),$0(r,e,i,n,s,o,2)):l===2&&Oq(r,e,i,n,s,o):$0(rp(r),e,i,n,s,o,1);break}}}function Dq(r){const e=r.prev,i=r,n=r.next;if(Rs(e,i,n)>=0)return!1;const s=e.x,o=i.x,l=n.x,u=e.y,c=i.y,h=n.y,p=s<o?s<l?s:l:o<l?o:l,f=u<c?u<h?u:h:c<h?c:h,g=s>o?s>l?s:l:o>l?o:l,m=u>c?u>h?u:h:c>h?c:h;let y=n.next;for(;y!==e;){if(y.x>=p&&y.x<=g&&y.y>=f&&y.y<=m&&am(s,u,o,c,l,h,y.x,y.y)&&Rs(y.prev,y,y.next)>=0)return!1;y=y.next}return!0}function Nq(r,e,i,n){const s=r.prev,o=r,l=r.next;if(Rs(s,o,l)>=0)return!1;const u=s.x,c=o.x,h=l.x,p=s.y,f=o.y,g=l.y,m=u<c?u<h?u:h:c<h?c:h,y=p<f?p<g?p:g:f<g?f:g,b=u>c?u>h?u:h:c>h?c:h,v=p>f?p>g?p:g:f>g?f:g,_=$2(m,y,e,i,n),T=$2(b,v,e,i,n);let E=r.prevZ,C=r.nextZ;for(;E&&E.z>=_&&C&&C.z<=T;){if(E.x>=m&&E.x<=b&&E.y>=y&&E.y<=v&&E!==s&&E!==l&&am(u,p,c,f,h,g,E.x,E.y)&&Rs(E.prev,E,E.next)>=0||(E=E.prevZ,C.x>=m&&C.x<=b&&C.y>=y&&C.y<=v&&C!==s&&C!==l&&am(u,p,c,f,h,g,C.x,C.y)&&Rs(C.prev,C,C.next)>=0))return!1;C=C.nextZ}for(;E&&E.z>=_;){if(E.x>=m&&E.x<=b&&E.y>=y&&E.y<=v&&E!==s&&E!==l&&am(u,p,c,f,h,g,E.x,E.y)&&Rs(E.prev,E,E.next)>=0)return!1;E=E.prevZ}for(;C&&C.z<=T;){if(C.x>=m&&C.x<=b&&C.y>=y&&C.y<=v&&C!==s&&C!==l&&am(u,p,c,f,h,g,C.x,C.y)&&Rs(C.prev,C,C.next)>=0)return!1;C=C.nextZ}return!0}function Pq(r,e,i){let n=r;do{const s=n.prev,o=n.next.next;!Pb(s,o)&&mP(s,n,n.next,o)&&eA(s,o)&&eA(o,s)&&(e.push(s.i/i|0),e.push(n.i/i|0),e.push(o.i/i|0),tA(n),tA(n.next),n=r=o),n=n.next}while(n!==r);return rp(n)}function Oq(r,e,i,n,s,o){let l=r;do{let u=l.next.next;for(;u!==l.prev;){if(l.i!==u.i&&Wq(l,u)){let c=gP(l,u);l=rp(l,l.next),c=rp(c,c.next),$0(l,e,i,n,s,o,0),$0(c,e,i,n,s,o,0);return}u=u.next}l=l.next}while(l!==r)}function kq(r,e,i,n){const s=[];let o,l,u,c,h;for(o=0,l=e.length;o<l;o++)u=e[o]*n,c=o<l-1?e[o+1]*n:r.length,h=fP(r,u,c,n,!1),h===h.next&&(h.steiner=!0),s.push(Hq(h));for(s.sort(Fq),o=0;o<s.length;o++)i=Uq(s[o],i);return i}function Fq(r,e){return r.x-e.x}function Uq(r,e){const i=zq(r,e);if(!i)return e;const n=gP(i,r);return rp(n,n.next),rp(i,i.next)}function zq(r,e){let i=e,n=-1/0,s;const o=r.x,l=r.y;do{if(l<=i.y&&l>=i.next.y&&i.next.y!==i.y){const g=i.x+(l-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(g<=o&&g>n&&(n=g,s=i.x<i.next.x?i:i.next,g===o))return s}i=i.next}while(i!==e);if(!s)return null;const u=s,c=s.x,h=s.y;let p=1/0,f;i=s;do o>=i.x&&i.x>=c&&o!==i.x&&am(l<h?o:n,l,c,h,l<h?n:o,l,i.x,i.y)&&(f=Math.abs(l-i.y)/(o-i.x),eA(i,r)&&(f<p||f===p&&(i.x>s.x||i.x===s.x&&jq(s,i)))&&(s=i,p=f)),i=i.next;while(i!==u);return s}function jq(r,e){return Rs(r.prev,r,e.prev)<0&&Rs(e.next,r,r.next)<0}function Vq(r,e,i,n){let s=r;do s.z===0&&(s.z=$2(s.x,s.y,e,i,n)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==r);s.prevZ.nextZ=null,s.prevZ=null,Gq(s)}function Gq(r){let e,i,n,s,o,l,u,c,h=1;do{for(i=r,r=null,o=null,l=0;i;){for(l++,n=i,u=0,e=0;e<h&&(u++,n=n.nextZ,!!n);e++);for(c=h;u>0||c>0&&n;)u!==0&&(c===0||!n||i.z<=n.z)?(s=i,i=i.nextZ,u--):(s=n,n=n.nextZ,c--),o?o.nextZ=s:r=s,s.prevZ=o,o=s;i=n}o.nextZ=null,h*=2}while(l>1);return r}function $2(r,e,i,n,s){return r=(r-i)*s|0,e=(e-n)*s|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,r|e<<1}function Hq(r){let e=r,i=r;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==r);return i}function am(r,e,i,n,s,o,l,u){return(s-l)*(e-u)>=(r-l)*(o-u)&&(r-l)*(n-u)>=(i-l)*(e-u)&&(i-l)*(o-u)>=(s-l)*(n-u)}function Wq(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!Qq(r,e)&&(eA(r,e)&&eA(e,r)&&qq(r,e)&&(Rs(r.prev,r,e.prev)||Rs(r,e.prev,e))||Pb(r,e)&&Rs(r.prev,r,r.next)>0&&Rs(e.prev,e,e.next)>0)}function Rs(r,e,i){return(e.y-r.y)*(i.x-e.x)-(e.x-r.x)*(i.y-e.y)}function Pb(r,e){return r.x===e.x&&r.y===e.y}function mP(r,e,i,n){const s=kb(Rs(r,e,i)),o=kb(Rs(r,e,n)),l=kb(Rs(i,n,r)),u=kb(Rs(i,n,e));return!!(s!==o&&l!==u||s===0&&Ob(r,i,e)||o===0&&Ob(r,n,e)||l===0&&Ob(i,r,n)||u===0&&Ob(i,e,n))}function Ob(r,e,i){return e.x<=Math.max(r.x,i.x)&&e.x>=Math.min(r.x,i.x)&&e.y<=Math.max(r.y,i.y)&&e.y>=Math.min(r.y,i.y)}function kb(r){return r>0?1:r<0?-1:0}function Qq(r,e){let i=r;do{if(i.i!==r.i&&i.next.i!==r.i&&i.i!==e.i&&i.next.i!==e.i&&mP(i,i.next,r,e))return!0;i=i.next}while(i!==r);return!1}function eA(r,e){return Rs(r.prev,r,r.next)<0?Rs(r,e,r.next)>=0&&Rs(r,r.prev,e)>=0:Rs(r,e,r.prev)<0||Rs(r,r.next,e)<0}function qq(r,e){let i=r,n=!1;const s=(r.x+e.x)/2,o=(r.y+e.y)/2;do i.y>o!=i.next.y>o&&i.next.y!==i.y&&s<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next;while(i!==r);return n}function gP(r,e){const i=new eC(r.i,r.x,r.y),n=new eC(e.i,e.x,e.y),s=r.next,o=e.prev;return r.next=e,e.prev=r,i.next=s,s.prev=i,n.next=i,i.prev=n,o.next=n,n.prev=o,n}function AP(r,e,i,n){const s=new eC(r,e,i);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s}function tA(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function eC(r,e,i){this.i=r,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Xq(r,e,i,n){let s=0;for(let o=e,l=i-n;o<i;o+=n)s+=(r[l]-r[o])*(r[o+1]+r[l+1]),l=o;return s}class tC{static area(e){const i=e.length;let n=0;for(let s=i-1,o=0;o<i;s=o++)n+=e[s].x*e[o].y-e[o].x*e[s].y;return n*.5}static isClockWise(e){return tC.area(e)<0}static triangulateShape(e,i){const n=[],s=[],o=[];yP(e),vP(n,e);let l=e.length;i.forEach(yP);for(let c=0;c<i.length;c++)s.push(l),l+=i[c].length,vP(n,i[c]);const u=Lq.triangulate(n,s);for(let c=0;c<u.length;c+=3)o.push(u.slice(c,c+3));return o}}function yP(r){const e=r.length;e>2&&r[e-1].equals(r[0])&&r.pop()}function vP(r,e){for(let i=0;i<e.length;i++)r.push(e[i].x),r.push(e[i].y)}let iC=class extends vb{constructor(r){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Ks(16777215),this.specular=new Ks(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ks(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=CN,this.normalScale=new Ws(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new fo,this.combine=b2,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.specular.copy(r.specular),this.shininess=r.shininess,this.map=r.map,this.lightMap=r.lightMap,this.lightMapIntensity=r.lightMapIntensity,this.aoMap=r.aoMap,this.aoMapIntensity=r.aoMapIntensity,this.emissive.copy(r.emissive),this.emissiveMap=r.emissiveMap,this.emissiveIntensity=r.emissiveIntensity,this.bumpMap=r.bumpMap,this.bumpScale=r.bumpScale,this.normalMap=r.normalMap,this.normalMapType=r.normalMapType,this.normalScale.copy(r.normalScale),this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.specularMap=r.specularMap,this.alphaMap=r.alphaMap,this.envMap=r.envMap,this.envMapRotation.copy(r.envMapRotation),this.combine=r.combine,this.reflectivity=r.reflectivity,this.refractionRatio=r.refractionRatio,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.wireframeLinecap=r.wireframeLinecap,this.wireframeLinejoin=r.wireframeLinejoin,this.flatShading=r.flatShading,this.fog=r.fog,this}},Yq=class extends vb{constructor(r){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Ks(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ks(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=CN,this.normalScale=new Ws(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new fo,this.combine=b2,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.lightMap=r.lightMap,this.lightMapIntensity=r.lightMapIntensity,this.aoMap=r.aoMap,this.aoMapIntensity=r.aoMapIntensity,this.emissive.copy(r.emissive),this.emissiveMap=r.emissiveMap,this.emissiveIntensity=r.emissiveIntensity,this.bumpMap=r.bumpMap,this.bumpScale=r.bumpScale,this.normalMap=r.normalMap,this.normalMapType=r.normalMapType,this.normalScale.copy(r.normalScale),this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.specularMap=r.specularMap,this.alphaMap=r.alphaMap,this.envMap=r.envMap,this.envMapRotation.copy(r.envMapRotation),this.combine=r.combine,this.reflectivity=r.reflectivity,this.refractionRatio=r.refractionRatio,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.wireframeLinecap=r.wireframeLinecap,this.wireframeLinejoin=r.wireframeLinejoin,this.flatShading=r.flatShading,this.fog=r.fog,this}};function Fb(r,e,i){return!r||r.constructor===e?r:typeof e.BYTES_PER_ELEMENT=="number"?new e(r):Array.prototype.slice.call(r)}function Kq(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function Jq(r){function e(s,o){return r[s]-r[o]}const i=r.length,n=new Array(i);for(let s=0;s!==i;++s)n[s]=s;return n.sort(e),n}function bP(r,e,i){const n=r.length,s=new r.constructor(n);for(let o=0,l=0;l!==n;++o){const u=i[o]*e;for(let c=0;c!==e;++c)s[l++]=r[u+c]}return s}function xP(r,e,i,n){let s=1,o=r[0];for(;o!==void 0&&o[n]===void 0;)o=r[s++];if(o===void 0)return;let l=o[n];if(l!==void 0)if(Array.isArray(l))do l=o[n],l!==void 0&&(e.push(o.time),i.push.apply(i,l)),o=r[s++];while(o!==void 0);else if(l.toArray!==void 0)do l=o[n],l!==void 0&&(e.push(o.time),l.toArray(i,i.length)),o=r[s++];while(o!==void 0);else do l=o[n],l!==void 0&&(e.push(o.time),i.push(l)),o=r[s++];while(o!==void 0)}class Ub{constructor(e,i,n,s){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=s!==void 0?s:new i.constructor(n),this.sampleValues=i,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const i=this.parameterPositions;let n=this._cachedIndex,s=i[n],o=i[n-1];i:{e:{let l;t:{r:if(!(e<s)){for(let u=n+2;;){if(s===void 0){if(e<o)break r;return n=i.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===u)break;if(o=s,s=i[++n],e<s)break e}l=i.length;break t}if(!(e>=o)){const u=i[1];e<u&&(n=2,o=u);for(let c=n-2;;){if(o===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===c)break;if(s=o,o=i[--n-1],e>=o)break e}l=n,n=0;break t}break i}for(;n<l;){const u=n+l>>>1;e<i[u]?l=u:n=u+1}if(s=i[n],o=i[n-1],o===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(s===void 0)return n=i.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,o,s)}return this.interpolate_(n,o,e,s)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const i=this.resultBuffer,n=this.sampleValues,s=this.valueSize,o=e*s;for(let l=0;l!==s;++l)i[l]=n[o+l];return i}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Zq extends Ub{constructor(e,i,n,s){super(e,i,n,s),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:_N,endingEnd:_N}}intervalChanged_(e,i,n){const s=this.parameterPositions;let o=e-2,l=e+1,u=s[o],c=s[l];if(u===void 0)switch(this.getSettings_().endingStart){case EN:o=e,u=2*i-n;break;case wN:o=s.length-2,u=i+s[o]-s[o+1];break;default:o=e,u=n}if(c===void 0)switch(this.getSettings_().endingEnd){case EN:l=e,c=2*n-i;break;case wN:l=1,c=n+s[1]-s[0];break;default:l=e-1,c=i}const h=(n-i)*.5,p=this.valueSize;this._weightPrev=h/(i-u),this._weightNext=h/(c-n),this._offsetPrev=o*p,this._offsetNext=l*p}interpolate_(e,i,n,s){const o=this.resultBuffer,l=this.sampleValues,u=this.valueSize,c=e*u,h=c-u,p=this._offsetPrev,f=this._offsetNext,g=this._weightPrev,m=this._weightNext,y=(n-i)/(s-i),b=y*y,v=b*y,_=-g*v+2*g*b-g*y,T=(1+g)*v+(-1.5-2*g)*b+(-.5+g)*y+1,E=(-1-m)*v+(1.5+m)*b+.5*y,C=m*v-m*b;for(let R=0;R!==u;++R)o[R]=_*l[p+R]+T*l[h+R]+E*l[c+R]+C*l[f+R];return o}}class $q extends Ub{constructor(e,i,n,s){super(e,i,n,s)}interpolate_(e,i,n,s){const o=this.resultBuffer,l=this.sampleValues,u=this.valueSize,c=e*u,h=c-u,p=(n-i)/(s-i),f=1-p;for(let g=0;g!==u;++g)o[g]=l[h+g]*f+l[c+g]*p;return o}}class eX extends Ub{constructor(e,i,n,s){super(e,i,n,s)}interpolate_(e){return this.copySampleValue_(e-1)}}class Fc{constructor(e,i,n,s){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(i===void 0||i.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Fb(i,this.TimeBufferType),this.values=Fb(n,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}static toJSON(e){const i=e.constructor;let n;if(i.toJSON!==this.toJSON)n=i.toJSON(e);else{n={name:e.name,times:Fb(e.times,Array),values:Fb(e.values,Array)};const s=e.getInterpolation();s!==e.DefaultInterpolation&&(n.interpolation=s)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new eX(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new $q(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Zq(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let i;switch(e){case ab:i=this.InterpolantFactoryMethodDiscrete;break;case ob:i=this.InterpolantFactoryMethodLinear;break;case _2:i=this.InterpolantFactoryMethodSmooth;break}if(i===void 0){const n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=i,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return ab;case this.InterpolantFactoryMethodLinear:return ob;case this.InterpolantFactoryMethodSmooth:return _2}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const i=this.times;for(let n=0,s=i.length;n!==s;++n)i[n]+=e}return this}scale(e){if(e!==1){const i=this.times;for(let n=0,s=i.length;n!==s;++n)i[n]*=e}return this}trim(e,i){const n=this.times,s=n.length;let o=0,l=s-1;for(;o!==s&&n[o]<e;)++o;for(;l!==-1&&n[l]>i;)--l;if(++l,o!==0||l!==s){o>=l&&(l=Math.max(l,1),o=l-1);const u=this.getValueSize();this.times=n.slice(o,l),this.values=this.values.slice(o*u,l*u)}return this}validate(){let e=!0;const i=this.getValueSize();i-Math.floor(i)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,s=this.values,o=n.length;o===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let l=null;for(let u=0;u!==o;u++){const c=n[u];if(typeof c=="number"&&isNaN(c)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,u,c),e=!1;break}if(l!==null&&l>c){console.error("THREE.KeyframeTrack: Out of order keys.",this,u,c,l),e=!1;break}l=c}if(s!==void 0&&Kq(s))for(let u=0,c=s.length;u!==c;++u){const h=s[u];if(isNaN(h)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,u,h),e=!1;break}}return e}optimize(){const e=this.times.slice(),i=this.values.slice(),n=this.getValueSize(),s=this.getInterpolation()===_2,o=e.length-1;let l=1;for(let u=1;u<o;++u){let c=!1;const h=e[u],p=e[u+1];if(h!==p&&(u!==1||h!==e[0]))if(s)c=!0;else{const f=u*n,g=f-n,m=f+n;for(let y=0;y!==n;++y){const b=i[f+y];if(b!==i[g+y]||b!==i[m+y]){c=!0;break}}}if(c){if(u!==l){e[l]=e[u];const f=u*n,g=l*n;for(let m=0;m!==n;++m)i[g+m]=i[f+m]}++l}}if(o>0){e[l]=e[o];for(let u=o*n,c=l*n,h=0;h!==n;++h)i[c+h]=i[u+h];++l}return l!==e.length?(this.times=e.slice(0,l),this.values=i.slice(0,l*n)):(this.times=e,this.values=i),this}clone(){const e=this.times.slice(),i=this.values.slice(),n=this.constructor,s=new n(this.name,e,i);return s.createInterpolant=this.createInterpolant,s}}Fc.prototype.TimeBufferType=Float32Array,Fc.prototype.ValueBufferType=Float32Array,Fc.prototype.DefaultInterpolation=ob;class om extends Fc{}om.prototype.ValueTypeName="bool",om.prototype.ValueBufferType=Array,om.prototype.DefaultInterpolation=ab,om.prototype.InterpolantFactoryMethodLinear=void 0,om.prototype.InterpolantFactoryMethodSmooth=void 0;class _P extends Fc{}_P.prototype.ValueTypeName="color";class iA extends Fc{}iA.prototype.ValueTypeName="number";class tX extends Ub{constructor(e,i,n,s){super(e,i,n,s)}interpolate_(e,i,n,s){const o=this.resultBuffer,l=this.sampleValues,u=this.valueSize,c=(n-i)/(s-i);let h=e*u;for(let p=h+u;h!==p;h+=4)ko.slerpFlat(o,0,l,h-u,l,h,c);return o}}class np extends Fc{InterpolantFactoryMethodLinear(e){return new tX(this.times,this.values,this.getValueSize(),e)}}np.prototype.ValueTypeName="quaternion",np.prototype.DefaultInterpolation=ob,np.prototype.InterpolantFactoryMethodSmooth=void 0;class lm extends Fc{}lm.prototype.ValueTypeName="string",lm.prototype.ValueBufferType=Array,lm.prototype.DefaultInterpolation=ab,lm.prototype.InterpolantFactoryMethodLinear=void 0,lm.prototype.InterpolantFactoryMethodSmooth=void 0;class rA extends Fc{}rA.prototype.ValueTypeName="vector";class iX{constructor(e="",i=-1,n=[],s=OQ){this.name=e,this.tracks=n,this.duration=i,this.blendMode=s,this.uuid=Dh(),this.duration<0&&this.resetDuration()}static parse(e){const i=[],n=e.tracks,s=1/(e.fps||1);for(let l=0,u=n.length;l!==u;++l)i.push(nX(n[l]).scale(s));const o=new this(e.name,e.duration,i,e.blendMode);return o.uuid=e.uuid,o}static toJSON(e){const i=[],n=e.tracks,s={name:e.name,duration:e.duration,tracks:i,uuid:e.uuid,blendMode:e.blendMode};for(let o=0,l=n.length;o!==l;++o)i.push(Fc.toJSON(n[o]));return s}static CreateFromMorphTargetSequence(e,i,n,s){const o=i.length,l=[];for(let u=0;u<o;u++){let c=[],h=[];c.push((u+o-1)%o,u,(u+1)%o),h.push(0,1,0);const p=Jq(c);c=bP(c,1,p),h=bP(h,1,p),!s&&c[0]===0&&(c.push(o),h.push(h[0])),l.push(new iA(".morphTargetInfluences["+i[u].name+"]",c,h).scale(1/n))}return new this(e,-1,l)}static findByName(e,i){let n=e;if(!Array.isArray(e)){const s=e;n=s.geometry&&s.geometry.animations||s.animations}for(let s=0;s<n.length;s++)if(n[s].name===i)return n[s];return null}static CreateClipsFromMorphTargetSequences(e,i,n){const s={},o=/^([\w-]*?)([\d]+)$/;for(let u=0,c=e.length;u<c;u++){const h=e[u],p=h.name.match(o);if(p&&p.length>1){const f=p[1];let g=s[f];g||(s[f]=g=[]),g.push(h)}}const l=[];for(const u in s)l.push(this.CreateFromMorphTargetSequence(u,s[u],i,n));return l}static parseAnimation(e,i){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(p,f,g,m,y){if(g.length!==0){const b=[],v=[];xP(g,b,v,m),b.length!==0&&y.push(new p(f,b,v))}},s=[],o=e.name||"default",l=e.fps||30,u=e.blendMode;let c=e.length||-1;const h=e.hierarchy||[];for(let p=0;p<h.length;p++){const f=h[p].keys;if(!(!f||f.length===0))if(f[0].morphTargets){const g={};let m;for(m=0;m<f.length;m++)if(f[m].morphTargets)for(let y=0;y<f[m].morphTargets.length;y++)g[f[m].morphTargets[y]]=-1;for(const y in g){const b=[],v=[];for(let _=0;_!==f[m].morphTargets.length;++_){const T=f[m];b.push(T.time),v.push(T.morphTarget===y?1:0)}s.push(new iA(".morphTargetInfluence["+y+"]",b,v))}c=g.length*l}else{const g=".bones["+i[p].name+"]";n(rA,g+".position",f,"pos",s),n(np,g+".quaternion",f,"rot",s),n(rA,g+".scale",f,"scl",s)}}return s.length===0?null:new this(o,c,s,u)}resetDuration(){const e=this.tracks;let i=0;for(let n=0,s=e.length;n!==s;++n){const o=this.tracks[n];i=Math.max(i,o.times[o.times.length-1])}return this.duration=i,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let i=0;i<this.tracks.length;i++)e=e&&this.tracks[i].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let i=0;i<this.tracks.length;i++)e.push(this.tracks[i].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function rX(r){switch(r.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return iA;case"vector":case"vector2":case"vector3":case"vector4":return rA;case"color":return _P;case"quaternion":return np;case"bool":case"boolean":return om;case"string":return lm}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+r)}function nX(r){if(r.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=rX(r.type);if(r.times===void 0){const i=[],n=[];xP(r.keys,i,n,"value"),r.times=i,r.values=n}return e.parse!==void 0?e.parse(r):new e(r.name,r.times,r.values,r.interpolation)}const zb={enabled:!1,files:{},add:function(r,e){this.enabled!==!1&&(this.files[r]=e)},get:function(r){if(this.enabled!==!1)return this.files[r]},remove:function(r){delete this.files[r]},clear:function(){this.files={}}};let sX=class{constructor(r,e,i){const n=this;let s=!1,o=0,l=0,u;const c=[];this.onStart=void 0,this.onLoad=r,this.onProgress=e,this.onError=i,this.itemStart=function(h){l++,s===!1&&n.onStart!==void 0&&n.onStart(h,o,l),s=!0},this.itemEnd=function(h){o++,n.onProgress!==void 0&&n.onProgress(h,o,l),o===l&&(s=!1,n.onLoad!==void 0&&n.onLoad())},this.itemError=function(h){n.onError!==void 0&&n.onError(h)},this.resolveURL=function(h){return u?u(h):h},this.setURLModifier=function(h){return u=h,this},this.addHandler=function(h,p){return c.push(h,p),this},this.removeHandler=function(h){const p=c.indexOf(h);return p!==-1&&c.splice(p,2),this},this.getHandler=function(h){for(let p=0,f=c.length;p<f;p+=2){const g=c[p],m=c[p+1];if(g.global&&(g.lastIndex=0),g.test(h))return m}return null}}};const aX=new sX;let sp=class{constructor(r){this.manager=r!==void 0?r:aX,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(r,e){const i=this;return new Promise(function(n,s){i.load(r,n,e,s)})}parse(){}setCrossOrigin(r){return this.crossOrigin=r,this}setWithCredentials(r){return this.withCredentials=r,this}setPath(r){return this.path=r,this}setResourcePath(r){return this.resourcePath=r,this}setRequestHeader(r){return this.requestHeader=r,this}};sp.DEFAULT_MATERIAL_NAME="__DEFAULT";const vu={};class oX extends Error{constructor(e,i){super(e),this.response=i}}class lX extends sp{constructor(e){super(e)}load(e,i,n,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=zb.get(e);if(o!==void 0)return this.manager.itemStart(e),setTimeout(()=>{i&&i(o),this.manager.itemEnd(e)},0),o;if(vu[e]!==void 0){vu[e].push({onLoad:i,onProgress:n,onError:s});return}vu[e]=[],vu[e].push({onLoad:i,onProgress:n,onError:s});const l=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),u=this.mimeType,c=this.responseType;fetch(l).then(h=>{if(h.status===200||h.status===0){if(h.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||h.body===void 0||h.body.getReader===void 0)return h;const p=vu[e],f=h.body.getReader(),g=h.headers.get("X-File-Size")||h.headers.get("Content-Length"),m=g?parseInt(g):0,y=m!==0;let b=0;const v=new ReadableStream({start(_){T();function T(){f.read().then(({done:E,value:C})=>{if(E)_.close();else{b+=C.byteLength;const R=new ProgressEvent("progress",{lengthComputable:y,loaded:b,total:m});for(let B=0,I=p.length;B<I;B++){const N=p[B];N.onProgress&&N.onProgress(R)}_.enqueue(C),T()}})}}});return new Response(v)}else throw new oX(`fetch for "${h.url}" responded with ${h.status}: ${h.statusText}`,h)}).then(h=>{switch(c){case"arraybuffer":return h.arrayBuffer();case"blob":return h.blob();case"document":return h.text().then(p=>new DOMParser().parseFromString(p,u));case"json":return h.json();default:if(u===void 0)return h.text();{const p=/charset="?([^;"\s]*)"?/i.exec(u),f=p&&p[1]?p[1].toLowerCase():void 0,g=new TextDecoder(f);return h.arrayBuffer().then(m=>g.decode(m))}}}).then(h=>{zb.add(e,h);const p=vu[e];delete vu[e];for(let f=0,g=p.length;f<g;f++){const m=p[f];m.onLoad&&m.onLoad(h)}}).catch(h=>{const p=vu[e];if(p===void 0)throw this.manager.itemError(e),h;delete vu[e];for(let f=0,g=p.length;f<g;f++){const m=p[f];m.onError&&m.onError(h)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}let cX=class extends sp{constructor(r){super(r)}load(r,e,i,n){this.path!==void 0&&(r=this.path+r),r=this.manager.resolveURL(r);const s=this,o=zb.get(r);if(o!==void 0)return s.manager.itemStart(r),setTimeout(function(){e&&e(o),s.manager.itemEnd(r)},0),o;const l=M2("img");function u(){h(),zb.add(r,this),e&&e(this),s.manager.itemEnd(r)}function c(p){h(),n&&n(p),s.manager.itemError(r),s.manager.itemEnd(r)}function h(){l.removeEventListener("load",u,!1),l.removeEventListener("error",c,!1)}return l.addEventListener("load",u,!1),l.addEventListener("error",c,!1),r.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(l.crossOrigin=this.crossOrigin),s.manager.itemStart(r),l.src=r,l}},uX=class extends sp{constructor(r){super(r)}load(r,e,i,n){const s=new pu,o=new cX(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(r,function(l){s.image=l,s.needsUpdate=!0,e!==void 0&&e(s)},i,n),s}},jb=class extends Oa{constructor(r,e=1){super(),this.isLight=!0,this.type="Light",this.color=new Ks(r),this.intensity=e}dispose(){}copy(r,e){return super.copy(r,e),this.color.copy(r.color),this.intensity=r.intensity,this}toJSON(r){const e=super.toJSON(r);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,this.groundColor!==void 0&&(e.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(e.object.distance=this.distance),this.angle!==void 0&&(e.object.angle=this.angle),this.decay!==void 0&&(e.object.decay=this.decay),this.penumbra!==void 0&&(e.object.penumbra=this.penumbra),this.shadow!==void 0&&(e.object.shadow=this.shadow.toJSON()),e}};const rC=new Hr,EP=new Pt,wP=new Pt;let nC=class{constructor(r){this.camera=r,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Ws(512,512),this.map=null,this.mapPass=null,this.matrix=new Hr,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Eq,this._frameExtents=new Ws(1,1),this._viewportCount=1,this._viewports=[new Oo(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(r){const e=this.camera,i=this.matrix;EP.setFromMatrixPosition(r.matrixWorld),e.position.copy(EP),wP.setFromMatrixPosition(r.target.matrixWorld),e.lookAt(wP),e.updateMatrixWorld(),rC.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(rC),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(rC)}getViewport(r){return this._viewports[r]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(r){return this.camera=r.camera.clone(),this.bias=r.bias,this.radius=r.radius,this.mapSize.copy(r.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const r={};return this.bias!==0&&(r.bias=this.bias),this.normalBias!==0&&(r.normalBias=this.normalBias),this.radius!==1&&(r.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(r.mapSize=this.mapSize.toArray()),r.camera=this.camera.toJSON(!1).object,delete r.camera.matrix,r}},hX=class extends nC{constructor(){super(new Q2(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(r){const e=this.camera,i=W0*2*r.angle*this.focus,n=this.mapSize.width/this.mapSize.height,s=r.distance||e.far;(i!==e.fov||n!==e.aspect||s!==e.far)&&(e.fov=i,e.aspect=n,e.far=s,e.updateProjectionMatrix()),super.updateMatrices(r)}copy(r){return super.copy(r),this.focus=r.focus,this}},dX=class extends jb{constructor(r,e,i=0,n=Math.PI/3,s=0,o=2){super(r,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Oa.DEFAULT_UP),this.updateMatrix(),this.target=new Oa,this.distance=i,this.angle=n,this.penumbra=s,this.decay=o,this.map=null,this.shadow=new hX}get power(){return this.intensity*Math.PI}set power(r){this.intensity=r/Math.PI}dispose(){this.shadow.dispose()}copy(r,e){return super.copy(r,e),this.distance=r.distance,this.angle=r.angle,this.penumbra=r.penumbra,this.decay=r.decay,this.target=r.target.clone(),this.shadow=r.shadow.clone(),this}};const CP=new Hr,nA=new Pt,sC=new Pt;let pX=class extends nC{constructor(){super(new Q2(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Ws(4,2),this._viewportCount=6,this._viewports=[new Oo(2,1,1,1),new Oo(0,1,1,1),new Oo(3,1,1,1),new Oo(1,1,1,1),new Oo(3,0,1,1),new Oo(1,0,1,1)],this._cubeDirections=[new Pt(1,0,0),new Pt(-1,0,0),new Pt(0,0,1),new Pt(0,0,-1),new Pt(0,1,0),new Pt(0,-1,0)],this._cubeUps=[new Pt(0,1,0),new Pt(0,1,0),new Pt(0,1,0),new Pt(0,1,0),new Pt(0,0,1),new Pt(0,0,-1)]}updateMatrices(r,e=0){const i=this.camera,n=this.matrix,s=r.distance||i.far;s!==i.far&&(i.far=s,i.updateProjectionMatrix()),nA.setFromMatrixPosition(r.matrixWorld),i.position.copy(nA),sC.copy(i.position),sC.add(this._cubeDirections[e]),i.up.copy(this._cubeUps[e]),i.lookAt(sC),i.updateMatrixWorld(),n.makeTranslation(-nA.x,-nA.y,-nA.z),CP.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(CP)}},SP=class extends jb{constructor(r,e,i=0,n=2){super(r,e),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=n,this.shadow=new pX}get power(){return this.intensity*4*Math.PI}set power(r){this.intensity=r/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(r,e){return super.copy(r,e),this.distance=r.distance,this.decay=r.decay,this.shadow=r.shadow.clone(),this}},fX=class extends nC{constructor(){super(new rP(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},mX=class extends jb{constructor(r,e){super(r,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Oa.DEFAULT_UP),this.updateMatrix(),this.target=new Oa,this.shadow=new fX}dispose(){this.shadow.dispose()}copy(r){return super.copy(r),this.target=r.target.clone(),this.shadow=r.shadow.clone(),this}},gX=class extends jb{constructor(r,e){super(r,e),this.isAmbientLight=!0,this.type="AmbientLight"}};class AX{static decodeText(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let i="";for(let n=0,s=e.length;n<s;n++)i+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(i))}catch{return i}}static extractUrlBase(e){const i=e.lastIndexOf("/");return i===-1?"./":e.slice(0,i+1)}static resolveURL(e,i){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(i)&&/^\//.test(e)&&(i=i.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:i+e)}}const aC="\\[\\]\\.:\\/",yX=new RegExp("["+aC+"]","g"),oC="[^"+aC+"]",vX="[^"+aC.replace("\\.","")+"]",bX=/((?:WC+[\/:])*)/.source.replace("WC",oC),xX=/(WCOD+)?/.source.replace("WCOD",vX),_X=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",oC),EX=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",oC),wX=new RegExp("^"+bX+xX+_X+EX+"$"),CX=["material","materials","bones","map"];class SX{constructor(e,i,n){const s=n||jn.parseTrackName(i);this._targetGroup=e,this._bindings=e.subscribe_(i,s)}getValue(e,i){this.bind();const n=this._targetGroup.nCachedObjects_,s=this._bindings[n];s!==void 0&&s.getValue(e,i)}setValue(e,i){const n=this._bindings;for(let s=this._targetGroup.nCachedObjects_,o=n.length;s!==o;++s)n[s].setValue(e,i)}bind(){const e=this._bindings;for(let i=this._targetGroup.nCachedObjects_,n=e.length;i!==n;++i)e[i].bind()}unbind(){const e=this._bindings;for(let i=this._targetGroup.nCachedObjects_,n=e.length;i!==n;++i)e[i].unbind()}}class jn{constructor(e,i,n){this.path=i,this.parsedPath=n||jn.parseTrackName(i),this.node=jn.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,i,n){return e&&e.isAnimationObjectGroup?new jn.Composite(e,i,n):new jn(e,i,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(yX,"")}static parseTrackName(e){const i=wX.exec(e);if(i===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},s=n.nodeName&&n.nodeName.lastIndexOf(".");if(s!==void 0&&s!==-1){const o=n.nodeName.substring(s+1);CX.indexOf(o)!==-1&&(n.nodeName=n.nodeName.substring(0,s),n.objectName=o)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,i){if(i===void 0||i===""||i==="."||i===-1||i===e.name||i===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(i);if(n!==void 0)return n}if(e.children){const n=function(o){for(let l=0;l<o.length;l++){const u=o[l];if(u.name===i||u.uuid===i)return u;const c=n(u.children);if(c)return c}return null},s=n(e.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,i){e[i]=this.targetObject[this.propertyName]}_getValue_array(e,i){const n=this.resolvedProperty;for(let s=0,o=n.length;s!==o;++s)e[i++]=n[s]}_getValue_arrayElement(e,i){e[i]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,i){this.resolvedProperty.toArray(e,i)}_setValue_direct(e,i){this.targetObject[this.propertyName]=e[i]}_setValue_direct_setNeedsUpdate(e,i){this.targetObject[this.propertyName]=e[i],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,i){this.targetObject[this.propertyName]=e[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,i){const n=this.resolvedProperty;for(let s=0,o=n.length;s!==o;++s)n[s]=e[i++]}_setValue_array_setNeedsUpdate(e,i){const n=this.resolvedProperty;for(let s=0,o=n.length;s!==o;++s)n[s]=e[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,i){const n=this.resolvedProperty;for(let s=0,o=n.length;s!==o;++s)n[s]=e[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,i){this.resolvedProperty[this.propertyIndex]=e[i]}_setValue_arrayElement_setNeedsUpdate(e,i){this.resolvedProperty[this.propertyIndex]=e[i],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,i){this.resolvedProperty[this.propertyIndex]=e[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,i){this.resolvedProperty.fromArray(e,i)}_setValue_fromArray_setNeedsUpdate(e,i){this.resolvedProperty.fromArray(e,i),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,i){this.resolvedProperty.fromArray(e,i),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,i){this.bind(),this.getValue(e,i)}_setValue_unbound(e,i){this.bind(),this.setValue(e,i)}bind(){let e=this.node;const i=this.parsedPath,n=i.objectName,s=i.propertyName;let o=i.propertyIndex;if(e||(e=jn.findNode(this.rootNode,i.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(n){let h=i.objectIndex;switch(n){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let p=0;p<e.length;p++)if(e[p].name===h){h=p;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[n]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[n]}if(h!==void 0){if(e[h]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[h]}}const l=e[s];if(l===void 0){const h=i.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+h+"."+s+" but it wasn't found.",e);return}let u=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?u=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(u=this.Versioning.MatrixWorldNeedsUpdate);let c=this.BindingType.Direct;if(o!==void 0){if(s==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[o]!==void 0&&(o=e.morphTargetDictionary[o])}c=this.BindingType.ArrayElement,this.resolvedProperty=l,this.propertyIndex=o}else l.fromArray!==void 0&&l.toArray!==void 0?(c=this.BindingType.HasFromToArray,this.resolvedProperty=l):Array.isArray(l)?(c=this.BindingType.EntireArray,this.resolvedProperty=l):this.propertyName=s;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][u]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}jn.Composite=SX,jn.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},jn.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},jn.prototype.GetterByBindingType=[jn.prototype._getValue_direct,jn.prototype._getValue_array,jn.prototype._getValue_arrayElement,jn.prototype._getValue_toArray],jn.prototype.SetterByBindingTypeAndVersioning=[[jn.prototype._setValue_direct,jn.prototype._setValue_direct_setNeedsUpdate,jn.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[jn.prototype._setValue_array,jn.prototype._setValue_array_setNeedsUpdate,jn.prototype._setValue_array_setMatrixWorldNeedsUpdate],[jn.prototype._setValue_arrayElement,jn.prototype._setValue_arrayElement_setNeedsUpdate,jn.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[jn.prototype._setValue_fromArray,jn.prototype._setValue_fromArray_setNeedsUpdate,jn.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]],typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:uN}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=uN);/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.8.2
*/var Ll=Uint8Array,sA=Uint16Array,TX=Int32Array,TP=new Ll([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),MP=new Ll([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),MX=new Ll([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),RP=function(r,e){for(var i=new sA(31),n=0;n<31;++n)i[n]=e+=1<<r[n-1];for(var s=new TX(i[30]),n=1;n<30;++n)for(var o=i[n];o<i[n+1];++o)s[o]=o-i[n]<<5|n;return{b:i,r:s}},IP=RP(TP,2),BP=IP.b,RX=IP.r;BP[28]=258,RX[258]=28;for(var IX=RP(MP,0),BX=IX.b,LP=new sA(32768),ms=0;ms<32768;++ms){var Vh=(ms&43690)>>1|(ms&21845)<<1;Vh=(Vh&52428)>>2|(Vh&13107)<<2,Vh=(Vh&61680)>>4|(Vh&3855)<<4,LP[ms]=((Vh&65280)>>8|(Vh&255)<<8)>>1}for(var aA=function(r,e,i){for(var n=r.length,s=0,o=new sA(e);s<n;++s)r[s]&&++o[r[s]-1];var l=new sA(e);for(s=1;s<e;++s)l[s]=l[s-1]+o[s-1]<<1;var u;{u=new sA(1<<e);var c=15-e;for(s=0;s<n;++s)if(r[s])for(var h=s<<4|r[s],p=e-r[s],f=l[r[s]-1]++<<p,g=f|(1<<p)-1;f<=g;++f)u[LP[f]>>c]=h}return u},oA=new Ll(288),ms=0;ms<144;++ms)oA[ms]=8;for(var ms=144;ms<256;++ms)oA[ms]=9;for(var ms=256;ms<280;++ms)oA[ms]=7;for(var ms=280;ms<288;++ms)oA[ms]=8;for(var DP=new Ll(32),ms=0;ms<32;++ms)DP[ms]=5;var LX=aA(oA,9),DX=aA(DP,5),lC=function(r){for(var e=r[0],i=1;i<r.length;++i)r[i]>e&&(e=r[i]);return e},ec=function(r,e,i){var n=e/8|0;return(r[n]|r[n+1]<<8)>>(e&7)&i},cC=function(r,e){var i=e/8|0;return(r[i]|r[i+1]<<8|r[i+2]<<16)>>(e&7)},NX=function(r){return(r+7)/8|0},PX=function(r,e,i){return(i==null||i>r.length)&&(i=r.length),new Ll(r.subarray(e,i))},OX=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],tc=function(r,e,i){var n=new Error(e||OX[r]);if(n.code=r,Error.captureStackTrace&&Error.captureStackTrace(n,tc),!i)throw n;return n},kX=function(r,e,i,n){var s=r.length,o=0;if(!s||e.f&&!e.l)return i||new Ll(0);var l=!i,u=l||e.i!=2,c=e.i;l&&(i=new Ll(s*3));var h=function(Qt){var yt=i.length;if(Qt>yt){var bi=new Ll(Math.max(yt*2,Qt));bi.set(i),i=bi}},p=e.f||0,f=e.p||0,g=e.b||0,m=e.l,y=e.d,b=e.m,v=e.n,_=s*8;do{if(!m){p=ec(r,f,1);var T=ec(r,f+1,3);if(f+=3,T)if(T==1)m=LX,y=DX,b=9,v=5;else if(T==2){var E=ec(r,f,31)+257,C=ec(r,f+10,15)+4,R=E+ec(r,f+5,31)+1;f+=14;for(var B=new Ll(R),I=new Ll(19),N=0;N<C;++N)I[MX[N]]=ec(r,f+N*3,7);f+=C*3;for(var D=lC(I),P=(1<<D)-1,k=aA(I,D),N=0;N<R;){var q=k[ec(r,f,P)];f+=q&15;var V=q>>4;if(V<16)B[N++]=V;else{var j=0,Q=0;for(V==16?(Q=3+ec(r,f,3),f+=2,j=B[N-1]):V==17?(Q=3+ec(r,f,7),f+=3):V==18&&(Q=11+ec(r,f,127),f+=7);Q--;)B[N++]=j}}var W=B.subarray(0,E),G=B.subarray(E);b=lC(W),v=lC(G),m=aA(W,b),y=aA(G,v)}else tc(1);else{var V=NX(f)+4,z=r[V-4]|r[V-3]<<8,te=V+z;if(te>s){c&&tc(0);break}u&&h(g+z),i.set(r.subarray(V,te),g),e.b=g+=z,e.p=f=te*8,e.f=p;continue}if(f>_){c&&tc(0);break}}u&&h(g+131072);for(var Y=(1<<b)-1,se=(1<<v)-1,ve=f;;ve=f){var j=m[cC(r,f)&Y],Ae=j>>4;if(f+=j&15,f>_){c&&tc(0);break}if(j||tc(2),Ae<256)i[g++]=Ae;else if(Ae==256){ve=f,m=null;break}else{var me=Ae-254;if(Ae>264){var N=Ae-257,Oe=TP[N];me=ec(r,f,(1<<Oe)-1)+BP[N],f+=Oe}var Xe=y[cC(r,f)&se],Je=Xe>>4;Xe||tc(3),f+=Xe&15;var G=BX[Je];if(Je>3){var Oe=MP[Je];G+=cC(r,f)&(1<<Oe)-1,f+=Oe}if(f>_){c&&tc(0);break}u&&h(g+131072);var it=g+me;if(g<G){var dt=o-G,St=Math.min(G,it);for(dt+g<0&&tc(3);g<St;++g)i[g]=n[dt+g]}for(;g<it;++g)i[g]=i[g-G]}}e.l=m,e.p=ve,e.b=g,e.f=p,m&&(p=1,e.m=b,e.d=y,e.n=v)}while(!p);return g!=i.length&&l?PX(i,0,g):i.subarray(0,g)},FX=new Ll(0),UX=function(r,e){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&tc(6,"invalid zlib data"),(r[1]>>5&1)==1&&tc(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2};function zX(r,e){return kX(r.subarray(UX(r),-4),{i:2},e,e)}var jX=typeof TextDecoder<"u"&&new TextDecoder,VX=0;try{jX.decode(FX,{stream:!0}),VX=1}catch{}function NP(r,e,i){const n=i.length-r-1;if(e>=i[n])return n-1;if(e<=i[r])return r;let s=r,o=n,l=Math.floor((s+o)/2);for(;e<i[l]||e>=i[l+1];)e<i[l]?o=l:s=l,l=Math.floor((s+o)/2);return l}function GX(r,e,i,n){const s=[],o=[],l=[];s[0]=1;for(let u=1;u<=i;++u){o[u]=e-n[r+1-u],l[u]=n[r+u]-e;let c=0;for(let h=0;h<u;++h){const p=l[h+1],f=o[u-h],g=s[h]/(p+f);s[h]=c+p*g,c=f*g}s[u]=c}return s}function HX(r,e,i,n){const s=NP(r,n,e),o=GX(s,n,r,e),l=new Oo(0,0,0,0);for(let u=0;u<=r;++u){const c=i[s-r+u],h=o[u],p=c.w*h;l.x+=c.x*p,l.y+=c.y*p,l.z+=c.z*p,l.w+=c.w*h}return l}function WX(r,e,i,n,s){const o=[];for(let f=0;f<=i;++f)o[f]=0;const l=[];for(let f=0;f<=n;++f)l[f]=o.slice(0);const u=[];for(let f=0;f<=i;++f)u[f]=o.slice(0);u[0][0]=1;const c=o.slice(0),h=o.slice(0);for(let f=1;f<=i;++f){c[f]=e-s[r+1-f],h[f]=s[r+f]-e;let g=0;for(let m=0;m<f;++m){const y=h[m+1],b=c[f-m];u[f][m]=y+b;const v=u[m][f-1]/u[f][m];u[m][f]=g+y*v,g=b*v}u[f][f]=g}for(let f=0;f<=i;++f)l[0][f]=u[f][i];for(let f=0;f<=i;++f){let g=0,m=1;const y=[];for(let b=0;b<=i;++b)y[b]=o.slice(0);y[0][0]=1;for(let b=1;b<=n;++b){let v=0;const _=f-b,T=i-b;f>=b&&(y[m][0]=y[g][0]/u[T+1][_],v=y[m][0]*u[_][T]);const E=_>=-1?1:-_,C=f-1<=T?b-1:i-f;for(let B=E;B<=C;++B)y[m][B]=(y[g][B]-y[g][B-1])/u[T+1][_+B],v+=y[m][B]*u[_+B][T];f<=T&&(y[m][b]=-y[g][b-1]/u[T+1][f],v+=y[m][b]*u[f][T]),l[b][f]=v;const R=g;g=m,m=R}}let p=i;for(let f=1;f<=n;++f){for(let g=0;g<=i;++g)l[f][g]*=p;p*=i-f}return l}function QX(r,e,i,n,s){const o=s<r?s:r,l=[],u=NP(r,n,e),c=WX(u,n,r,o,e),h=[];for(let p=0;p<i.length;++p){const f=i[p].clone(),g=f.w;f.x*=g,f.y*=g,f.z*=g,h[p]=f}for(let p=0;p<=o;++p){const f=h[u-r].clone().multiplyScalar(c[p][0]);for(let g=1;g<=r;++g)f.add(h[u-r+g].clone().multiplyScalar(c[p][g]));l[p]=f}for(let p=o+1;p<=s+1;++p)l[p]=new Oo(0,0,0);return l}function qX(r,e){let i=1;for(let s=2;s<=r;++s)i*=s;let n=1;for(let s=2;s<=e;++s)n*=s;for(let s=2;s<=r-e;++s)n*=s;return i/n}function XX(r){const e=r.length,i=[],n=[];for(let o=0;o<e;++o){const l=r[o];i[o]=new Pt(l.x,l.y,l.z),n[o]=l.w}const s=[];for(let o=0;o<e;++o){const l=i[o].clone();for(let u=1;u<=o;++u)l.sub(s[o-u].clone().multiplyScalar(qX(o,u)*n[u]));s[o]=l.divideScalar(n[0])}return s}function YX(r,e,i,n,s){const o=QX(r,e,i,n,s);return XX(o)}class KX extends Bq{constructor(e,i,n,s,o){super(),this.degree=e,this.knots=i,this.controlPoints=[],this.startKnot=s||0,this.endKnot=o||this.knots.length-1;for(let l=0;l<n.length;++l){const u=n[l];this.controlPoints[l]=new Oo(u.x,u.y,u.z,u.w)}}getPoint(e,i=new Pt){const n=i,s=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),o=HX(this.degree,this.knots,this.controlPoints,s);return o.w!==1&&o.divideScalar(o.w),n.set(o.x,o.y,o.z)}getTangent(e,i=new Pt){const n=i,s=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),o=YX(this.degree,this.knots,this.controlPoints,s,1);return n.copy(o[1]).normalize(),n}}let pn,Qs,mo;class JX extends sp{constructor(e){super(e)}load(e,i,n,s){const o=this,l=o.path===""?AX.extractUrlBase(e):o.path,u=new lX(this.manager);u.setPath(o.path),u.setResponseType("arraybuffer"),u.setRequestHeader(o.requestHeader),u.setWithCredentials(o.withCredentials),u.load(e,function(c){try{i(o.parse(c,l))}catch(h){s?s(h):console.error(h),o.manager.itemError(e)}},n,s)}parse(e,i){if(rY(e))pn=new iY().parse(e);else{const s=zP(e);if(!nY(s))throw new Error("THREE.FBXLoader: Unknown format.");if(kP(s)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+kP(s));pn=new tY().parse(s)}const n=new uX(this.manager).setPath(this.resourcePath||i).setCrossOrigin(this.crossOrigin);return new ZX(n,this.manager).parse(pn)}}class ZX{constructor(e,i){this.textureLoader=e,this.manager=i}parse(){Qs=this.parseConnections();const e=this.parseImages(),i=this.parseTextures(e),n=this.parseMaterials(i),s=this.parseDeformers(),o=new $X().parse(s);return this.parseScene(s,o,n),mo}parseConnections(){const e=new Map;return"Connections"in pn&&pn.Connections.connections.forEach(function(i){const n=i[0],s=i[1],o=i[2];e.has(n)||e.set(n,{parents:[],children:[]});const l={ID:s,relationship:o};e.get(n).parents.push(l),e.has(s)||e.set(s,{parents:[],children:[]});const u={ID:n,relationship:o};e.get(s).children.push(u)}),e}parseImages(){const e={},i={};if("Video"in pn.Objects){const n=pn.Objects.Video;for(const s in n){const o=n[s],l=parseInt(s);if(e[l]=o.RelativeFilename||o.Filename,"Content"in o){const u=o.Content instanceof ArrayBuffer&&o.Content.byteLength>0,c=typeof o.Content=="string"&&o.Content!=="";if(u||c){const h=this.parseImage(n[s]);i[o.RelativeFilename||o.Filename]=h}}}}for(const n in e){const s=e[n];i[s]!==void 0?e[n]=i[s]:e[n]=e[n].split("\\").pop()}return e}parseImage(e){const i=e.Content,n=e.RelativeFilename||e.Filename,s=n.slice(n.lastIndexOf(".")+1).toLowerCase();let o;switch(s){case"bmp":o="image/bmp";break;case"jpg":case"jpeg":o="image/jpeg";break;case"png":o="image/png";break;case"tif":o="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",n),o="image/tga";break;default:console.warn('FBXLoader: Image type "'+s+'" is not supported.');return}if(typeof i=="string")return"data:"+o+";base64,"+i;{const l=new Uint8Array(i);return window.URL.createObjectURL(new Blob([l],{type:o}))}}parseTextures(e){const i=new Map;if("Texture"in pn.Objects){const n=pn.Objects.Texture;for(const s in n){const o=this.parseTexture(n[s],e);i.set(parseInt(s),o)}}return i}parseTexture(e,i){const n=this.loadTexture(e,i);n.ID=e.id,n.name=e.attrName;const s=e.WrapModeU,o=e.WrapModeV,l=s!==void 0?s.value:0,u=o!==void 0?o.value:0;if(n.wrapS=l===0?nb:Uf,n.wrapT=u===0?nb:Uf,"Scaling"in e){const c=e.Scaling.value;n.repeat.x=c[0],n.repeat.y=c[1]}if("Translation"in e){const c=e.Translation.value;n.offset.x=c[0],n.offset.y=c[1]}return n}loadTexture(e,i){let n;const s=this.textureLoader.path,o=Qs.get(e.id).children;o!==void 0&&o.length>0&&i[o[0].ID]!==void 0&&(n=i[o[0].ID],(n.indexOf("blob:")===0||n.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let l;const u=e.FileName.slice(-3).toLowerCase();if(u==="tga"){const c=this.manager.getHandler(".tga");c===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),l=new pu):(c.setPath(this.textureLoader.path),l=c.load(n))}else if(u==="dds"){const c=this.manager.getHandler(".dds");c===null?(console.warn("FBXLoader: DDS loader not found, creating placeholder texture for",e.RelativeFilename),l=new pu):(c.setPath(this.textureLoader.path),l=c.load(n))}else u==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),l=new pu):l=this.textureLoader.load(n);return this.textureLoader.setPath(s),l}parseMaterials(e){const i=new Map;if("Material"in pn.Objects){const n=pn.Objects.Material;for(const s in n){const o=this.parseMaterial(n[s],e);o!==null&&i.set(parseInt(s),o)}}return i}parseMaterial(e,i){const n=e.id,s=e.attrName;let o=e.ShadingModel;if(typeof o=="object"&&(o=o.value),!Qs.has(n))return null;const l=this.parseParameters(e,i,n);let u;switch(o.toLowerCase()){case"phong":u=new iC;break;case"lambert":u=new Yq;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',o),u=new iC;break}return u.setValues(l),u.name=s,u}parseParameters(e,i,n){const s={};e.BumpFactor&&(s.bumpScale=e.BumpFactor.value),e.Diffuse?s.color=new Ks().fromArray(e.Diffuse.value).convertSRGBToLinear():e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(s.color=new Ks().fromArray(e.DiffuseColor.value).convertSRGBToLinear()),e.DisplacementFactor&&(s.displacementScale=e.DisplacementFactor.value),e.Emissive?s.emissive=new Ks().fromArray(e.Emissive.value).convertSRGBToLinear():e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(s.emissive=new Ks().fromArray(e.EmissiveColor.value).convertSRGBToLinear()),e.EmissiveFactor&&(s.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(s.opacity=parseFloat(e.Opacity.value)),s.opacity<1&&(s.transparent=!0),e.ReflectionFactor&&(s.reflectivity=e.ReflectionFactor.value),e.Shininess&&(s.shininess=e.Shininess.value),e.Specular?s.specular=new Ks().fromArray(e.Specular.value).convertSRGBToLinear():e.SpecularColor&&e.SpecularColor.type==="Color"&&(s.specular=new Ks().fromArray(e.SpecularColor.value).convertSRGBToLinear());const o=this;return Qs.get(n).children.forEach(function(l){const u=l.relationship;switch(u){case"Bump":s.bumpMap=o.getTexture(i,l.ID);break;case"Maya|TEX_ao_map":s.aoMap=o.getTexture(i,l.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":s.map=o.getTexture(i,l.ID),s.map!==void 0&&(s.map.colorSpace=Il);break;case"DisplacementColor":s.displacementMap=o.getTexture(i,l.ID);break;case"EmissiveColor":s.emissiveMap=o.getTexture(i,l.ID),s.emissiveMap!==void 0&&(s.emissiveMap.colorSpace=Il);break;case"NormalMap":case"Maya|TEX_normal_map":s.normalMap=o.getTexture(i,l.ID);break;case"ReflectionColor":s.envMap=o.getTexture(i,l.ID),s.envMap!==void 0&&(s.envMap.mapping=IQ,s.envMap.colorSpace=Il);break;case"SpecularColor":s.specularMap=o.getTexture(i,l.ID),s.specularMap!==void 0&&(s.specularMap.colorSpace=Il);break;case"TransparentColor":case"TransparencyFactor":s.alphaMap=o.getTexture(i,l.ID),s.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",u);break}}),s}getTexture(e,i){return"LayeredTexture"in pn.Objects&&i in pn.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),i=Qs.get(i).children[0].ID),e.get(i)}parseDeformers(){const e={},i={};if("Deformer"in pn.Objects){const n=pn.Objects.Deformer;for(const s in n){const o=n[s],l=Qs.get(parseInt(s));if(o.attrType==="Skin"){const u=this.parseSkeleton(l,n);u.ID=s,l.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),u.geometryID=l.parents[0].ID,e[s]=u}else if(o.attrType==="BlendShape"){const u={id:s};u.rawTargets=this.parseMorphTargets(l,n),u.id=s,l.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),i[s]=u}}}return{skeletons:e,morphTargets:i}}parseSkeleton(e,i){const n=[];return e.children.forEach(function(s){const o=i[s.ID];if(o.attrType!=="Cluster")return;const l={ID:s.ID,indices:[],weights:[],transformLink:new Hr().fromArray(o.TransformLink.a)};"Indexes"in o&&(l.indices=o.Indexes.a,l.weights=o.Weights.a),n.push(l)}),{rawBones:n,bones:[]}}parseMorphTargets(e,i){const n=[];for(let s=0;s<e.children.length;s++){const o=e.children[s],l=i[o.ID],u={name:l.attrName,initialWeight:l.DeformPercent,id:l.id,fullWeights:l.FullWeights.a};if(l.attrType!=="BlendShapeChannel")return;u.geoID=Qs.get(parseInt(o.ID)).children.filter(function(c){return c.relationship===void 0})[0].ID,n.push(u)}return n}parseScene(e,i,n){mo=new nP;const s=this.parseModels(e.skeletons,i,n),o=pn.Objects.Model,l=this;s.forEach(function(c){const h=o[c.ID];l.setLookAtProperties(c,h),Qs.get(c.ID).parents.forEach(function(p){const f=s.get(p.ID);f!==void 0&&f.add(c)}),c.parent===null&&mo.add(c)}),this.bindSkeleton(e.skeletons,i,s),this.addGlobalSceneSettings(),mo.traverse(function(c){if(c.userData.transformData){c.parent&&(c.userData.transformData.parentMatrix=c.parent.matrix,c.userData.transformData.parentMatrixWorld=c.parent.matrixWorld);const h=FP(c.userData.transformData);c.applyMatrix4(h),c.updateWorldMatrix()}});const u=new eY().parse();mo.children.length===1&&mo.children[0].isGroup&&(mo.children[0].animations=u,mo=mo.children[0]),mo.animations=u}parseModels(e,i,n){const s=new Map,o=pn.Objects.Model;for(const l in o){const u=parseInt(l),c=o[l],h=Qs.get(u);let p=this.buildSkeleton(h,e,u,c.attrName);if(!p){switch(c.attrType){case"Camera":p=this.createCamera(h);break;case"Light":p=this.createLight(h);break;case"Mesh":p=this.createMesh(h,i,n);break;case"NurbsCurve":p=this.createCurve(h,i);break;case"LimbNode":case"Root":p=new K2;break;case"Null":default:p=new nP;break}p.name=c.attrName?jn.sanitizeNodeName(c.attrName):"",p.userData.originalName=c.attrName,p.ID=u}this.getTransformData(p,c),s.set(u,p)}return s}buildSkeleton(e,i,n,s){let o=null;return e.parents.forEach(function(l){for(const u in i){const c=i[u];c.rawBones.forEach(function(h,p){if(h.ID===l.ID){const f=o;o=new K2,o.matrixWorld.copy(h.transformLink),o.name=s?jn.sanitizeNodeName(s):"",o.userData.originalName=s,o.ID=n,c.bones[p]=o,f!==null&&o.add(f)}})}}),o}createCamera(e){let i,n;if(e.children.forEach(function(s){const o=pn.Objects.NodeAttribute[s.ID];o!==void 0&&(n=o)}),n===void 0)i=new Oa;else{let s=0;n.CameraProjectionType!==void 0&&n.CameraProjectionType.value===1&&(s=1);let o=1;n.NearPlane!==void 0&&(o=n.NearPlane.value/1e3);let l=1e3;n.FarPlane!==void 0&&(l=n.FarPlane.value/1e3);let u=window.innerWidth,c=window.innerHeight;n.AspectWidth!==void 0&&n.AspectHeight!==void 0&&(u=n.AspectWidth.value,c=n.AspectHeight.value);const h=u/c;let p=45;n.FieldOfView!==void 0&&(p=n.FieldOfView.value);const f=n.FocalLength?n.FocalLength.value:null;switch(s){case 0:i=new Q2(p,h,o,l),f!==null&&i.setFocalLength(f);break;case 1:i=new rP(-u/2,u/2,c/2,-c/2,o,l);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+s+"."),i=new Oa;break}}return i}createLight(e){let i,n;if(e.children.forEach(function(s){const o=pn.Objects.NodeAttribute[s.ID];o!==void 0&&(n=o)}),n===void 0)i=new Oa;else{let s;n.LightType===void 0?s=0:s=n.LightType.value;let o=16777215;n.Color!==void 0&&(o=new Ks().fromArray(n.Color.value).convertSRGBToLinear());let l=n.Intensity===void 0?1:n.Intensity.value/100;n.CastLightOnObject!==void 0&&n.CastLightOnObject.value===0&&(l=0);let u=0;n.FarAttenuationEnd!==void 0&&(n.EnableFarAttenuation!==void 0&&n.EnableFarAttenuation.value===0?u=0:u=n.FarAttenuationEnd.value);const c=1;switch(s){case 0:i=new SP(o,l,u,c);break;case 1:i=new mX(o,l);break;case 2:let h=Math.PI/3;n.InnerAngle!==void 0&&(h=po.degToRad(n.InnerAngle.value));let p=0;n.OuterAngle!==void 0&&(p=po.degToRad(n.OuterAngle.value),p=Math.max(p,1)),i=new dX(o,l,u,h,p,c);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),i=new SP(o,l);break}n.CastShadows!==void 0&&n.CastShadows.value===1&&(i.castShadow=!0)}return i}createMesh(e,i,n){let s,o=null,l=null;const u=[];return e.children.forEach(function(c){i.has(c.ID)&&(o=i.get(c.ID)),n.has(c.ID)&&u.push(n.get(c.ID))}),u.length>1?l=u:u.length>0?l=u[0]:(l=new iC({name:sp.DEFAULT_MATERIAL_NAME,color:13421772}),u.push(l)),"color"in o.attributes&&u.forEach(function(c){c.vertexColors=!0}),o.FBX_Deformer?(s=new Tq(o,l),s.normalizeSkinWeights()):s=new $N(o,l),s}createCurve(e,i){const n=e.children.reduce(function(o,l){return i.has(l.ID)&&(o=i.get(l.ID)),o},null),s=new hP({name:sp.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new Iq(n,s)}getTransformData(e,i){const n={};"InheritType"in i&&(n.inheritType=parseInt(i.InheritType.value)),"RotationOrder"in i?n.eulerOrder=UP(i.RotationOrder.value):n.eulerOrder="ZYX","Lcl_Translation"in i&&(n.translation=i.Lcl_Translation.value),"PreRotation"in i&&(n.preRotation=i.PreRotation.value),"Lcl_Rotation"in i&&(n.rotation=i.Lcl_Rotation.value),"PostRotation"in i&&(n.postRotation=i.PostRotation.value),"Lcl_Scaling"in i&&(n.scale=i.Lcl_Scaling.value),"ScalingOffset"in i&&(n.scalingOffset=i.ScalingOffset.value),"ScalingPivot"in i&&(n.scalingPivot=i.ScalingPivot.value),"RotationOffset"in i&&(n.rotationOffset=i.RotationOffset.value),"RotationPivot"in i&&(n.rotationPivot=i.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(e,i){"LookAtProperty"in i&&Qs.get(e.ID).children.forEach(function(n){if(n.relationship==="LookAtProperty"){const s=pn.Objects.Model[n.ID];if("Lcl_Translation"in s){const o=s.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(o),mo.add(e.target)):e.lookAt(new Pt().fromArray(o))}}})}bindSkeleton(e,i,n){const s=this.parsePoseNodes();for(const o in e){const l=e[o];Qs.get(parseInt(l.ID)).parents.forEach(function(u){if(i.has(u.ID)){const c=u.ID;Qs.get(c).parents.forEach(function(h){n.has(h.ID)&&n.get(h.ID).bind(new J2(l.bones),s[h.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in pn.Objects){const i=pn.Objects.Pose;for(const n in i)if(i[n].attrType==="BindPose"&&i[n].NbPoseNodes>0){const s=i[n].PoseNode;Array.isArray(s)?s.forEach(function(o){e[o.Node]=new Hr().fromArray(o.Matrix.a)}):e[s.Node]=new Hr().fromArray(s.Matrix.a)}}return e}addGlobalSceneSettings(){if("GlobalSettings"in pn){if("AmbientColor"in pn.GlobalSettings){const e=pn.GlobalSettings.AmbientColor.value,i=e[0],n=e[1],s=e[2];if(i!==0||n!==0||s!==0){const o=new Ks(i,n,s).convertSRGBToLinear();mo.add(new gX(o,1))}}"UnitScaleFactor"in pn.GlobalSettings&&(mo.userData.unitScaleFactor=pn.GlobalSettings.UnitScaleFactor.value)}}}class $X{constructor(){this.negativeMaterialIndices=!1}parse(e){const i=new Map;if("Geometry"in pn.Objects){const n=pn.Objects.Geometry;for(const s in n){const o=Qs.get(parseInt(s)),l=this.parseGeometry(o,n[s],e);i.set(parseInt(s),l)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),i}parseGeometry(e,i,n){switch(i.attrType){case"Mesh":return this.parseMeshGeometry(e,i,n);case"NurbsCurve":return this.parseNurbsGeometry(i)}}parseMeshGeometry(e,i,n){const s=n.skeletons,o=[],l=e.parents.map(function(f){return pn.Objects.Model[f.ID]});if(l.length===0)return;const u=e.children.reduce(function(f,g){return s[g.ID]!==void 0&&(f=s[g.ID]),f},null);e.children.forEach(function(f){n.morphTargets[f.ID]!==void 0&&o.push(n.morphTargets[f.ID])});const c=l[0],h={};"RotationOrder"in c&&(h.eulerOrder=UP(c.RotationOrder.value)),"InheritType"in c&&(h.inheritType=parseInt(c.InheritType.value)),"GeometricTranslation"in c&&(h.translation=c.GeometricTranslation.value),"GeometricRotation"in c&&(h.rotation=c.GeometricRotation.value),"GeometricScaling"in c&&(h.scale=c.GeometricScaling.value);const p=FP(h);return this.genGeometry(i,u,o,p)}genGeometry(e,i,n,s){const o=new J0;e.attrName&&(o.name=e.attrName);const l=this.parseGeoNode(e,i),u=this.genBuffers(l),c=new zh(u.vertex,3);if(c.applyMatrix4(s),o.setAttribute("position",c),u.colors.length>0&&o.setAttribute("color",new zh(u.colors,3)),i&&(o.setAttribute("skinIndex",new qN(u.weightsIndices,4)),o.setAttribute("skinWeight",new zh(u.vertexWeights,4)),o.FBX_Deformer=i),u.normal.length>0){const h=new Nh().getNormalMatrix(s),p=new zh(u.normal,3);p.applyNormalMatrix(h),o.setAttribute("normal",p)}if(u.uvs.forEach(function(h,p){const f=p===0?"uv":`uv${p}`;o.setAttribute(f,new zh(u.uvs[p],2))}),l.material&&l.material.mappingType!=="AllSame"){let h=u.materialIndex[0],p=0;if(u.materialIndex.forEach(function(f,g){f!==h&&(o.addGroup(p,g-p,h),h=f,p=g)}),o.groups.length>0){const f=o.groups[o.groups.length-1],g=f.start+f.count;g!==u.materialIndex.length&&o.addGroup(g,u.materialIndex.length-g,h)}o.groups.length===0&&o.addGroup(0,u.materialIndex.length,u.materialIndex[0])}return this.addMorphTargets(o,e,n,s),o}parseGeoNode(e,i){const n={};if(n.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],n.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let s=0;for(;e.LayerElementUV[s];)e.LayerElementUV[s].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[s])),s++}return n.weightTable={},i!==null&&(n.skeleton=i,i.rawBones.forEach(function(s,o){s.indices.forEach(function(l,u){n.weightTable[l]===void 0&&(n.weightTable[l]=[]),n.weightTable[l].push({id:o,weight:s.weights[u]})})})),n}genBuffers(e){const i={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,s=0,o=!1,l=[],u=[],c=[],h=[],p=[],f=[];const g=this;return e.vertexIndices.forEach(function(m,y){let b,v=!1;m<0&&(m=m^-1,v=!0);let _=[],T=[];if(l.push(m*3,m*3+1,m*3+2),e.color){const E=Vb(y,n,m,e.color);c.push(E[0],E[1],E[2])}if(e.skeleton){if(e.weightTable[m]!==void 0&&e.weightTable[m].forEach(function(E){T.push(E.weight),_.push(E.id)}),T.length>4){o||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),o=!0);const E=[0,0,0,0],C=[0,0,0,0];T.forEach(function(R,B){let I=R,N=_[B];C.forEach(function(D,P,k){if(I>D){k[P]=I,I=D;const q=E[P];E[P]=N,N=q}})}),_=E,T=C}for(;T.length<4;)T.push(0),_.push(0);for(let E=0;E<4;++E)p.push(T[E]),f.push(_[E])}if(e.normal){const E=Vb(y,n,m,e.normal);u.push(E[0],E[1],E[2])}e.material&&e.material.mappingType!=="AllSame"&&(b=Vb(y,n,m,e.material)[0],b<0&&(g.negativeMaterialIndices=!0,b=0)),e.uv&&e.uv.forEach(function(E,C){const R=Vb(y,n,m,E);h[C]===void 0&&(h[C]=[]),h[C].push(R[0]),h[C].push(R[1])}),s++,v&&(g.genFace(i,e,l,b,u,c,h,p,f,s),n++,s=0,l=[],u=[],c=[],h=[],p=[],f=[])}),i}getNormalNewell(e){const i=new Pt(0,0,0);for(let n=0;n<e.length;n++){const s=e[n],o=e[(n+1)%e.length];i.x+=(s.y-o.y)*(s.z+o.z),i.y+=(s.z-o.z)*(s.x+o.x),i.z+=(s.x-o.x)*(s.y+o.y)}return i.normalize(),i}getNormalTangentAndBitangent(e){const i=this.getNormalNewell(e),n=(Math.abs(i.z)>.5?new Pt(0,1,0):new Pt(0,0,1)).cross(i).normalize(),s=i.clone().cross(n).normalize();return{normal:i,tangent:n,bitangent:s}}flattenVertex(e,i,n){return new Ws(e.dot(i),e.dot(n))}genFace(e,i,n,s,o,l,u,c,h,p){let f;if(p>3){const g=[];for(let v=0;v<n.length;v+=3)g.push(new Pt(i.vertexPositions[n[v]],i.vertexPositions[n[v+1]],i.vertexPositions[n[v+2]]));const{tangent:m,bitangent:y}=this.getNormalTangentAndBitangent(g),b=[];for(const v of g)b.push(this.flattenVertex(v,m,y));f=tC.triangulateShape(b,[])}else f=[[0,1,2]];for(const[g,m,y]of f)e.vertex.push(i.vertexPositions[n[g*3]]),e.vertex.push(i.vertexPositions[n[g*3+1]]),e.vertex.push(i.vertexPositions[n[g*3+2]]),e.vertex.push(i.vertexPositions[n[m*3]]),e.vertex.push(i.vertexPositions[n[m*3+1]]),e.vertex.push(i.vertexPositions[n[m*3+2]]),e.vertex.push(i.vertexPositions[n[y*3]]),e.vertex.push(i.vertexPositions[n[y*3+1]]),e.vertex.push(i.vertexPositions[n[y*3+2]]),i.skeleton&&(e.vertexWeights.push(c[g*4]),e.vertexWeights.push(c[g*4+1]),e.vertexWeights.push(c[g*4+2]),e.vertexWeights.push(c[g*4+3]),e.vertexWeights.push(c[m*4]),e.vertexWeights.push(c[m*4+1]),e.vertexWeights.push(c[m*4+2]),e.vertexWeights.push(c[m*4+3]),e.vertexWeights.push(c[y*4]),e.vertexWeights.push(c[y*4+1]),e.vertexWeights.push(c[y*4+2]),e.vertexWeights.push(c[y*4+3]),e.weightsIndices.push(h[g*4]),e.weightsIndices.push(h[g*4+1]),e.weightsIndices.push(h[g*4+2]),e.weightsIndices.push(h[g*4+3]),e.weightsIndices.push(h[m*4]),e.weightsIndices.push(h[m*4+1]),e.weightsIndices.push(h[m*4+2]),e.weightsIndices.push(h[m*4+3]),e.weightsIndices.push(h[y*4]),e.weightsIndices.push(h[y*4+1]),e.weightsIndices.push(h[y*4+2]),e.weightsIndices.push(h[y*4+3])),i.color&&(e.colors.push(l[g*3]),e.colors.push(l[g*3+1]),e.colors.push(l[g*3+2]),e.colors.push(l[m*3]),e.colors.push(l[m*3+1]),e.colors.push(l[m*3+2]),e.colors.push(l[y*3]),e.colors.push(l[y*3+1]),e.colors.push(l[y*3+2])),i.material&&i.material.mappingType!=="AllSame"&&(e.materialIndex.push(s),e.materialIndex.push(s),e.materialIndex.push(s)),i.normal&&(e.normal.push(o[g*3]),e.normal.push(o[g*3+1]),e.normal.push(o[g*3+2]),e.normal.push(o[m*3]),e.normal.push(o[m*3+1]),e.normal.push(o[m*3+2]),e.normal.push(o[y*3]),e.normal.push(o[y*3+1]),e.normal.push(o[y*3+2])),i.uv&&i.uv.forEach(function(b,v){e.uvs[v]===void 0&&(e.uvs[v]=[]),e.uvs[v].push(u[v][g*2]),e.uvs[v].push(u[v][g*2+1]),e.uvs[v].push(u[v][m*2]),e.uvs[v].push(u[v][m*2+1]),e.uvs[v].push(u[v][y*2]),e.uvs[v].push(u[v][y*2+1])})}addMorphTargets(e,i,n,s){if(n.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const o=this;n.forEach(function(l){l.rawTargets.forEach(function(u){const c=pn.Objects.Geometry[u.geoID];c!==void 0&&o.genMorphGeometry(e,i,c,s,u.name)})})}genMorphGeometry(e,i,n,s,o){const l=i.PolygonVertexIndex!==void 0?i.PolygonVertexIndex.a:[],u=n.Vertices!==void 0?n.Vertices.a:[],c=n.Indexes!==void 0?n.Indexes.a:[],h=e.attributes.position.count*3,p=new Float32Array(h);for(let y=0;y<c.length;y++){const b=c[y]*3;p[b]=u[y*3],p[b+1]=u[y*3+1],p[b+2]=u[y*3+2]}const f={vertexIndices:l,vertexPositions:p},g=this.genBuffers(f),m=new zh(g.vertex,3);m.name=o||n.attrName,m.applyMatrix4(s),e.morphAttributes.position.push(m)}parseNormals(e){const i=e.MappingInformationType,n=e.ReferenceInformationType,s=e.Normals.a;let o=[];return n==="IndexToDirect"&&("NormalIndex"in e?o=e.NormalIndex.a:"NormalsIndex"in e&&(o=e.NormalsIndex.a)),{dataSize:3,buffer:s,indices:o,mappingType:i,referenceType:n}}parseUVs(e){const i=e.MappingInformationType,n=e.ReferenceInformationType,s=e.UV.a;let o=[];return n==="IndexToDirect"&&(o=e.UVIndex.a),{dataSize:2,buffer:s,indices:o,mappingType:i,referenceType:n}}parseVertexColors(e){const i=e.MappingInformationType,n=e.ReferenceInformationType,s=e.Colors.a;let o=[];n==="IndexToDirect"&&(o=e.ColorIndex.a);for(let l=0,u=new Ks;l<s.length;l+=4)u.fromArray(s,l).convertSRGBToLinear().toArray(s,l);return{dataSize:4,buffer:s,indices:o,mappingType:i,referenceType:n}}parseMaterialIndices(e){const i=e.MappingInformationType,n=e.ReferenceInformationType;if(i==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const s=e.Materials.a,o=[];for(let l=0;l<s.length;++l)o.push(l);return{dataSize:1,buffer:s,indices:o,mappingType:i,referenceType:n}}parseNurbsGeometry(e){const i=parseInt(e.Order);if(isNaN(i))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new J0;const n=i-1,s=e.KnotVector.a,o=[],l=e.Points.a;for(let p=0,f=l.length;p<f;p+=4)o.push(new Oo().fromArray(l,p));let u,c;if(e.Form==="Closed")o.push(o[0]);else if(e.Form==="Periodic"){u=n,c=s.length-1-u;for(let p=0;p<n;++p)o.push(o[p])}const h=new KX(n,s,o,u,c).getPoints(o.length*12);return new J0().setFromPoints(h)}}class eY{parse(){const e=[],i=this.parseClips();if(i!==void 0)for(const n in i){const s=i[n],o=this.addClip(s);e.push(o)}return e}parseClips(){if(pn.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const i=this.parseAnimationLayers(e);return this.parseAnimStacks(i)}parseAnimationCurveNodes(){const e=pn.Objects.AnimationCurveNode,i=new Map;for(const n in e){const s=e[n];if(s.attrName.match(/S|R|T|DeformPercent/)!==null){const o={id:s.id,attr:s.attrName,curves:{}};i.set(o.id,o)}}return i}parseAnimationCurves(e){const i=pn.Objects.AnimationCurve;for(const n in i){const s={id:i[n].id,times:i[n].KeyTime.a.map(sY),values:i[n].KeyValueFloat.a},o=Qs.get(s.id);if(o!==void 0){const l=o.parents[0].ID,u=o.parents[0].relationship;u.match(/X/)?e.get(l).curves.x=s:u.match(/Y/)?e.get(l).curves.y=s:u.match(/Z/)?e.get(l).curves.z=s:u.match(/DeformPercent/)&&e.has(l)&&(e.get(l).curves.morph=s)}}}parseAnimationLayers(e){const i=pn.Objects.AnimationLayer,n=new Map;for(const s in i){const o=[],l=Qs.get(parseInt(s));l!==void 0&&(l.children.forEach(function(u,c){if(e.has(u.ID)){const h=e.get(u.ID);if(h.curves.x!==void 0||h.curves.y!==void 0||h.curves.z!==void 0){if(o[c]===void 0){const p=Qs.get(u.ID).parents.filter(function(f){return f.relationship!==void 0})[0].ID;if(p!==void 0){const f=pn.Objects.Model[p.toString()];if(f===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",u);return}const g={modelName:f.attrName?jn.sanitizeNodeName(f.attrName):"",ID:f.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};mo.traverse(function(m){m.ID===f.id&&(g.transform=m.matrix,m.userData.transformData&&(g.eulerOrder=m.userData.transformData.eulerOrder))}),g.transform||(g.transform=new Hr),"PreRotation"in f&&(g.preRotation=f.PreRotation.value),"PostRotation"in f&&(g.postRotation=f.PostRotation.value),o[c]=g}}o[c]&&(o[c][h.attr]=h)}else if(h.curves.morph!==void 0){if(o[c]===void 0){const p=Qs.get(u.ID).parents.filter(function(v){return v.relationship!==void 0})[0].ID,f=Qs.get(p).parents[0].ID,g=Qs.get(f).parents[0].ID,m=Qs.get(g).parents[0].ID,y=pn.Objects.Model[m],b={modelName:y.attrName?jn.sanitizeNodeName(y.attrName):"",morphName:pn.Objects.Deformer[p].attrName};o[c]=b}o[c][h.attr]=h}}}),n.set(parseInt(s),o))}return n}parseAnimStacks(e){const i=pn.Objects.AnimationStack,n={};for(const s in i){const o=Qs.get(parseInt(s)).children;o.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const l=e.get(o[0].ID);n[s]={name:i[s].attrName,layer:l}}return n}addClip(e){let i=[];const n=this;return e.layer.forEach(function(s){i=i.concat(n.generateTracks(s))}),new iX(e.name,-1,i)}generateTracks(e){const i=[];let n=new Pt,s=new Pt;if(e.transform&&e.transform.decompose(n,new ko,s),n=n.toArray(),s=s.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const o=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");o!==void 0&&i.push(o)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const o=this.generateRotationTrack(e.modelName,e.R.curves,e.preRotation,e.postRotation,e.eulerOrder);o!==void 0&&i.push(o)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const o=this.generateVectorTrack(e.modelName,e.S.curves,s,"scale");o!==void 0&&i.push(o)}if(e.DeformPercent!==void 0){const o=this.generateMorphTrack(e);o!==void 0&&i.push(o)}return i}generateVectorTrack(e,i,n,s){const o=this.getTimesForAllAxes(i),l=this.getKeyframeTrackValues(o,i,n);return new rA(e+"."+s,o,l)}generateRotationTrack(e,i,n,s,o){let l,u;if(i.x!==void 0&&i.y!==void 0&&i.z!==void 0){const f=this.interpolateRotations(i.x,i.y,i.z,o);l=f[0],u=f[1]}n!==void 0&&(n=n.map(po.degToRad),n.push(o),n=new fo().fromArray(n),n=new ko().setFromEuler(n)),s!==void 0&&(s=s.map(po.degToRad),s.push(o),s=new fo().fromArray(s),s=new ko().setFromEuler(s).invert());const c=new ko,h=new fo,p=[];if(!u||!l)return new np(e+".quaternion",[0],[0]);for(let f=0;f<u.length;f+=3)h.set(u[f],u[f+1],u[f+2],o),c.setFromEuler(h),n!==void 0&&c.premultiply(n),s!==void 0&&c.multiply(s),f>2&&new ko().fromArray(p,(f-3)/3*4).dot(c)<0&&c.set(-c.x,-c.y,-c.z,-c.w),c.toArray(p,f/3*4);return new np(e+".quaternion",l,p)}generateMorphTrack(e){const i=e.DeformPercent.curves.morph,n=i.values.map(function(o){return o/100}),s=mo.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new iA(e.modelName+".morphTargetInfluences["+s+"]",i.times,n)}getTimesForAllAxes(e){let i=[];if(e.x!==void 0&&(i=i.concat(e.x.times)),e.y!==void 0&&(i=i.concat(e.y.times)),e.z!==void 0&&(i=i.concat(e.z.times)),i=i.sort(function(n,s){return n-s}),i.length>1){let n=1,s=i[0];for(let o=1;o<i.length;o++){const l=i[o];l!==s&&(i[n]=l,s=l,n++)}i=i.slice(0,n)}return i}getKeyframeTrackValues(e,i,n){const s=n,o=[];let l=-1,u=-1,c=-1;return e.forEach(function(h){if(i.x&&(l=i.x.times.indexOf(h)),i.y&&(u=i.y.times.indexOf(h)),i.z&&(c=i.z.times.indexOf(h)),l!==-1){const p=i.x.values[l];o.push(p),s[0]=p}else o.push(s[0]);if(u!==-1){const p=i.y.values[u];o.push(p),s[1]=p}else o.push(s[1]);if(c!==-1){const p=i.z.values[c];o.push(p),s[2]=p}else o.push(s[2])}),o}interpolateRotations(e,i,n,s){const o=[],l=[];o.push(e.times[0]),l.push(po.degToRad(e.values[0])),l.push(po.degToRad(i.values[0])),l.push(po.degToRad(n.values[0]));for(let u=1;u<e.values.length;u++){const c=[e.values[u-1],i.values[u-1],n.values[u-1]];if(isNaN(c[0])||isNaN(c[1])||isNaN(c[2]))continue;const h=c.map(po.degToRad),p=[e.values[u],i.values[u],n.values[u]];if(isNaN(p[0])||isNaN(p[1])||isNaN(p[2]))continue;const f=p.map(po.degToRad),g=[p[0]-c[0],p[1]-c[1],p[2]-c[2]],m=[Math.abs(g[0]),Math.abs(g[1]),Math.abs(g[2])];if(m[0]>=180||m[1]>=180||m[2]>=180){const y=Math.max(...m)/180,b=new fo(...h,s),v=new fo(...f,s),_=new ko().setFromEuler(b),T=new ko().setFromEuler(v);_.dot(T)&&T.set(-T.x,-T.y,-T.z,-T.w);const E=e.times[u-1],C=e.times[u]-E,R=new ko,B=new fo;for(let I=0;I<1;I+=1/y)R.copy(_.clone().slerp(T.clone(),I)),o.push(E+I*C),B.setFromQuaternion(R,s),l.push(B.x),l.push(B.y),l.push(B.z)}else o.push(e.times[u]),l.push(po.degToRad(e.values[u])),l.push(po.degToRad(i.values[u])),l.push(po.degToRad(n.values[u]))}return[o,l]}}class tY{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,i){this.currentProp=e,this.currentPropName=i}parse(e){this.currentIndent=0,this.allNodes=new OP,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const i=this,n=e.split(/[\r\n]+/);return n.forEach(function(s,o){const l=s.match(/^[\s\t]*;/),u=s.match(/^[\s\t]*$/);if(l||u)return;const c=s.match("^\\t{"+i.currentIndent+"}(\\w+):(.*){",""),h=s.match("^\\t{"+i.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),p=s.match("^\\t{"+(i.currentIndent-1)+"}}");c?i.parseNodeBegin(s,c):h?i.parseNodeProperty(s,h,n[++o]):p?i.popStack():s.match(/^[^\s\t}]/)&&i.parseNodePropertyContinued(s)}),this.allNodes}parseNodeBegin(e,i){const n=i[1].trim().replace(/^"/,"").replace(/"$/,""),s=i[2].split(",").map(function(c){return c.trim().replace(/^"/,"").replace(/"$/,"")}),o={name:n},l=this.parseNodeAttr(s),u=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(n,o):n in u?(n==="PoseNode"?u.PoseNode.push(o):u[n].id!==void 0&&(u[n]={},u[n][u[n].id]=u[n]),l.id!==""&&(u[n][l.id]=o)):typeof l.id=="number"?(u[n]={},u[n][l.id]=o):n!=="Properties70"&&(n==="PoseNode"?u[n]=[o]:u[n]=o),typeof l.id=="number"&&(o.id=l.id),l.name!==""&&(o.attrName=l.name),l.type!==""&&(o.attrType=l.type),this.pushStack(o)}parseNodeAttr(e){let i=e[0];e[0]!==""&&(i=parseInt(e[0]),isNaN(i)&&(i=e[0]));let n="",s="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),s=e[2]),{id:i,name:n,type:s}}parseNodeProperty(e,i,n){let s=i[1].replace(/^"/,"").replace(/"$/,"").trim(),o=i[2].replace(/^"/,"").replace(/"$/,"").trim();s==="Content"&&o===","&&(o=n.replace(/"/g,"").replace(/,$/,"").trim());const l=this.getCurrentNode();if(l.name==="Properties70"){this.parseNodeSpecialProperty(e,s,o);return}if(s==="C"){const u=o.split(",").slice(1),c=parseInt(u[0]),h=parseInt(u[1]);let p=o.split(",").slice(3);p=p.map(function(f){return f.trim().replace(/^"/,"")}),s="connections",o=[c,h],oY(o,p),l[s]===void 0&&(l[s]=[])}s==="Node"&&(l.id=o),s in l&&Array.isArray(l[s])?l[s].push(o):s!=="a"?l[s]=o:l.a=o,this.setCurrentProp(l,s),s==="a"&&o.slice(-1)!==","&&(l.a=hC(o))}parseNodePropertyContinued(e){const i=this.getCurrentNode();i.a+=e,e.slice(-1)!==","&&(i.a=hC(i.a))}parseNodeSpecialProperty(e,i,n){const s=n.split('",').map(function(p){return p.trim().replace(/^\"/,"").replace(/\s/,"_")}),o=s[0],l=s[1],u=s[2],c=s[3];let h=s[4];switch(l){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":h=parseFloat(h);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":h=hC(h);break}this.getPrevNode()[o]={type:l,type2:u,flag:c,value:h},this.setCurrentProp(this.getPrevNode(),o)}}class iY{parse(e){const i=new PP(e);i.skip(23);const n=i.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const s=new OP;for(;!this.endOfContent(i);){const o=this.parseNode(i,n);o!==null&&s.add(o.name,o)}return s}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,i){const n={},s=i>=7500?e.getUint64():e.getUint32(),o=i>=7500?e.getUint64():e.getUint32();i>=7500?e.getUint64():e.getUint32();const l=e.getUint8(),u=e.getString(l);if(s===0)return null;const c=[];for(let g=0;g<o;g++)c.push(this.parseProperty(e));const h=c.length>0?c[0]:"",p=c.length>1?c[1]:"",f=c.length>2?c[2]:"";for(n.singleProperty=o===1&&e.getOffset()===s;s>e.getOffset();){const g=this.parseNode(e,i);g!==null&&this.parseSubNode(u,n,g)}return n.propertyList=c,typeof h=="number"&&(n.id=h),p!==""&&(n.attrName=p),f!==""&&(n.attrType=f),u!==""&&(n.name=u),n}parseSubNode(e,i,n){if(n.singleProperty===!0){const s=n.propertyList[0];Array.isArray(s)?(i[n.name]=n,n.a=s):i[n.name]=s}else if(e==="Connections"&&n.name==="C"){const s=[];n.propertyList.forEach(function(o,l){l!==0&&s.push(o)}),i.connections===void 0&&(i.connections=[]),i.connections.push(s)}else if(n.name==="Properties70")Object.keys(n).forEach(function(s){i[s]=n[s]});else if(e==="Properties70"&&n.name==="P"){let s=n.propertyList[0],o=n.propertyList[1];const l=n.propertyList[2],u=n.propertyList[3];let c;s.indexOf("Lcl ")===0&&(s=s.replace("Lcl ","Lcl_")),o.indexOf("Lcl ")===0&&(o=o.replace("Lcl ","Lcl_")),o==="Color"||o==="ColorRGB"||o==="Vector"||o==="Vector3D"||o.indexOf("Lcl_")===0?c=[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:c=n.propertyList[4],i[s]={type:o,type2:l,flag:u,value:c}}else i[n.name]===void 0?typeof n.id=="number"?(i[n.name]={},i[n.name][n.id]=n):i[n.name]=n:n.name==="PoseNode"?(Array.isArray(i[n.name])||(i[n.name]=[i[n.name]]),i[n.name].push(n)):i[n.name][n.id]===void 0&&(i[n.name][n.id]=n)}parseProperty(e){const i=e.getString(1);let n;switch(i){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const s=e.getUint32(),o=e.getUint32(),l=e.getUint32();if(o===0)switch(i){case"b":case"c":return e.getBooleanArray(s);case"d":return e.getFloat64Array(s);case"f":return e.getFloat32Array(s);case"i":return e.getInt32Array(s);case"l":return e.getInt64Array(s)}const u=zX(new Uint8Array(e.getArrayBuffer(l))),c=new PP(u.buffer);switch(i){case"b":case"c":return c.getBooleanArray(s);case"d":return c.getFloat64Array(s);case"f":return c.getFloat32Array(s);case"i":return c.getInt32Array(s);case"l":return c.getInt64Array(s)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+i)}}}class PP{constructor(e,i){this.dv=new DataView(e),this.offset=0,this.littleEndian=i!==void 0?i:!0,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const i=[];for(let n=0;n<e;n++)i.push(this.getBoolean());return i}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const i=[];for(let n=0;n<e;n++)i.push(this.getInt32());return i}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,i;return this.littleEndian?(e=this.getUint32(),i=this.getUint32()):(i=this.getUint32(),e=this.getUint32()),i&2147483648?(i=~i&4294967295,e=~e&4294967295,e===4294967295&&(i=i+1&4294967295),e=e+1&4294967295,-(i*4294967296+e)):i*4294967296+e}getInt64Array(e){const i=[];for(let n=0;n<e;n++)i.push(this.getInt64());return i}getUint64(){let e,i;return this.littleEndian?(e=this.getUint32(),i=this.getUint32()):(i=this.getUint32(),e=this.getUint32()),i*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const i=[];for(let n=0;n<e;n++)i.push(this.getFloat32());return i}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const i=[];for(let n=0;n<e;n++)i.push(this.getFloat64());return i}getArrayBuffer(e){const i=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,i}getString(e){const i=this.offset;let n=new Uint8Array(this.dv.buffer,i,e);this.skip(e);const s=n.indexOf(0);return s>=0&&(n=new Uint8Array(this.dv.buffer,i,s)),this._textDecoder.decode(n)}}class OP{add(e,i){this[e]=i}}function rY(r){const e="Kaydara FBX Binary  \0";return r.byteLength>=e.length&&e===zP(r,0,e.length)}function nY(r){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let i=0;function n(s){const o=r[s-1];return r=r.slice(i+s),i++,o}for(let s=0;s<e.length;++s)if(n(1)===e[s])return!1;return!0}function kP(r){const e=/FBXVersion: (\d+)/,i=r.match(e);if(i)return parseInt(i[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function sY(r){return r/46186158e3}const aY=[];function Vb(r,e,i,n){let s;switch(n.mappingType){case"ByPolygonVertex":s=r;break;case"ByPolygon":s=e;break;case"ByVertice":s=i;break;case"AllSame":s=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}n.referenceType==="IndexToDirect"&&(s=n.indices[s]);const o=s*n.dataSize,l=o+n.dataSize;return lY(aY,n.buffer,o,l)}const uC=new fo,cm=new Pt;function FP(r){const e=new Hr,i=new Hr,n=new Hr,s=new Hr,o=new Hr,l=new Hr,u=new Hr,c=new Hr,h=new Hr,p=new Hr,f=new Hr,g=new Hr,m=r.inheritType?r.inheritType:0;if(r.translation&&e.setPosition(cm.fromArray(r.translation)),r.preRotation){const P=r.preRotation.map(po.degToRad);P.push(r.eulerOrder||fo.DEFAULT_ORDER),i.makeRotationFromEuler(uC.fromArray(P))}if(r.rotation){const P=r.rotation.map(po.degToRad);P.push(r.eulerOrder||fo.DEFAULT_ORDER),n.makeRotationFromEuler(uC.fromArray(P))}if(r.postRotation){const P=r.postRotation.map(po.degToRad);P.push(r.eulerOrder||fo.DEFAULT_ORDER),s.makeRotationFromEuler(uC.fromArray(P)),s.invert()}r.scale&&o.scale(cm.fromArray(r.scale)),r.scalingOffset&&u.setPosition(cm.fromArray(r.scalingOffset)),r.scalingPivot&&l.setPosition(cm.fromArray(r.scalingPivot)),r.rotationOffset&&c.setPosition(cm.fromArray(r.rotationOffset)),r.rotationPivot&&h.setPosition(cm.fromArray(r.rotationPivot)),r.parentMatrixWorld&&(f.copy(r.parentMatrix),p.copy(r.parentMatrixWorld));const y=i.clone().multiply(n).multiply(s),b=new Hr;b.extractRotation(p);const v=new Hr;v.copyPosition(p);const _=v.clone().invert().multiply(p),T=b.clone().invert().multiply(_),E=o,C=new Hr;if(m===0)C.copy(b).multiply(y).multiply(T).multiply(E);else if(m===1)C.copy(b).multiply(T).multiply(y).multiply(E);else{const P=new Hr().scale(new Pt().setFromMatrixScale(f)).clone().invert(),k=T.clone().multiply(P);C.copy(b).multiply(y).multiply(k).multiply(E)}const R=h.clone().invert(),B=l.clone().invert();let I=e.clone().multiply(c).multiply(h).multiply(i).multiply(n).multiply(s).multiply(R).multiply(u).multiply(l).multiply(o).multiply(B);const N=new Hr().copyPosition(I),D=p.clone().multiply(N);return g.copyPosition(D),I=g.clone().multiply(C),I.premultiply(p.invert()),I}function UP(r){r=r||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return r===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[r]}function hC(r){return r.split(",").map(function(e){return parseFloat(e)})}function zP(r,e,i){return e===void 0&&(e=0),i===void 0&&(i=r.byteLength),new TextDecoder().decode(new Uint8Array(r,e,i))}function oY(r,e){for(let i=0,n=r.length,s=e.length;i<s;i++,n++)r[n]=e[i]}function lY(r,e,i,n){for(let s=i,o=0;s<n;s++,o++)r[o]=e[s];return r}THREE.FBXLoader=JX,AFRAME.registerComponent("fbx-model",{schema:{src:{type:"asset"},crossorigin:{default:""}},init:function(){this.model=null},update:function(){const r=this.data;if(!r.src)return;this.remove();const e=new THREE.FBXLoader;r.crossorigin&&e.setCrossOrigin(r.crossorigin),e.load(r.src,this.load.bind(this))},load:function(r){this.model=r,this.el.setObject3D("mesh",r),this.el.emit("model-loaded",{format:"fbx",model:r})},remove:function(){this.model&&this.el.removeObject3D("mesh")}});function cY(){return"script_"+Date.now()+"_"+Math.ceil(Math.random()*1e5)}function uY(r,e){var i=document.createElement("script");return i.type="text/javascript",i.async=!0,i.id=e,i.src=r,i}function dC(r){const e=document.getElementById(r),i=e.parentNode;try{i&&i.removeChild(e)}catch{}}function hY(r){const e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(r,e)}function dY(r,e,i){return new i(function(n,s){const o=e.timeout||5e3,l=cY(),u=uY(r,l),c=setTimeout(function(){s(new Error("Script request to "+r+" timed out")),dC(l)},o),h=function(p){clearTimeout(p)};u.addEventListener("load",function(p){n({ok:!0}),h(c),dC(l)}),u.addEventListener("error",function(p){s(new Error("Script request to "+r+" failed "+p)),h(c),dC(l)}),hY(u)})}function pY(r){return r=r||{},function(e,i){return i=i||{},dY(e,i,r.Promise||Promise)}}var fY=pY;const mY=fY(),gY="https://cdn.jsdelivr.net/gh/mrdoob/three.js@r86/examples/js/loaders/GLTFLoader.js",AY=function(){let r;return function(){return r=r||mY(gY),r}}();AFRAME.registerComponent("gltf-model-legacy",{schema:{type:"model"},init:function(){this.model=null,this.loader=null,this.loaderPromise=AY().then(()=>{this.loader=new THREE.GLTFLoader,this.loader.setCrossOrigin("Anonymous")})},update:function(){const r=this,e=this.el,i=this.data;i&&(this.remove(),this.loaderPromise.then(()=>{this.loader.load(i,function(n){r.model=n.scene,r.model.animations=n.animations,e.setObject3D("mesh",r.model),e.emit("model-loaded",{format:"gltf",model:r.model})})}))},remove:function(){this.model&&this.el.removeObject3D("mesh")}}),AFRAME.registerComponent("object-model",{schema:{src:{type:"asset"},crossorigin:{default:""}},init:function(){this.model=null},update:function(){let r;const e=this.data;e.src&&(this.remove(),r=new THREE.ObjectLoader,e.crossorigin&&r.setCrossOrigin(e.crossorigin),r.load(e.src,i=>{i.traverse(n=>{n instanceof THREE.SkinnedMesh&&n.material&&(n.material.skinning=!!(n.geometry&&n.geometry.bones||[]).length)}),this.load(i)}))},load:function(r){this.model=r,this.el.setObject3D("mesh",r),this.el.emit("model-loaded",{format:"json",model:r})},remove:function(){this.model&&this.el.removeObject3D("mesh")}}),AFRAME.registerComponent("checkpoint",{schema:{offset:{default:{x:0,y:0,z:0},type:"vec3"}},init:function(){this.active=!1,this.targetEl=null,this.fire=this.fire.bind(this),this.offset=new THREE.Vector3},update:function(){this.offset.copy(this.data.offset)},play:function(){this.el.addEventListener("click",this.fire)},pause:function(){this.el.removeEventListener("click",this.fire)},remove:function(){this.pause()},fire:function(){const r=this.el.sceneEl.querySelector("[checkpoint-controls]");if(!r)throw new Error("No `checkpoint-controls` component found.");r.components["checkpoint-controls"].setCheckpoint(this.el)},getOffset:function(){return this.offset.copy(this.data.offset)}});function yY(r){return r?Array.isArray(r)?r:r.materials?r.materials:[r]:[]}function lA(r,e,i,n){r&&(e=e||[],r.traverse(s=>{s.isMesh&&yY(s.material).forEach(o=>{o&&!("envMap"in o)||e.length&&e.indexOf(o.name)===-1||(o.envMap=i,o.reflectivity=n,o.needsUpdate=!0)})}))}AFRAME.registerComponent("cube-env-map",{multiple:!0,schema:{path:{default:""},extension:{default:"jpg",oneOf:["jpg","png"]},enableBackground:{default:!1},reflectivity:{default:1,min:0,max:1},materials:{default:[]}},init:function(){const r=this.data;this.texture=new THREE.CubeTextureLoader().load([r.path+"posx."+r.extension,r.path+"negx."+r.extension,r.path+"posy."+r.extension,r.path+"negy."+r.extension,r.path+"posz."+r.extension,r.path+"negz."+r.extension]),this.texture.format=THREE.RGBAFormat,this.object3dsetHandler=()=>{const e=this.el.getObject3D("mesh"),i=this.data;lA(e,i.materials,this.texture,i.reflectivity)},this.object3dsetHandler(),this.el.addEventListener("object3dset",this.object3dsetHandler)},update:function(r){const e=this.data,i=this.el.getObject3D("mesh");let n=[],s=[];if(e.materials.length&&(r.materials?(n=e.materials.filter(o=>!r.materials.includes(o)),s=r.materials.filter(o=>!e.materials.includes(o))):n=e.materials),n.length&&lA(i,n,this.texture,e.reflectivity),s.length&&lA(i,s,null,1),r.materials&&e.reflectivity!==r.reflectivity){const o=e.materials.filter(l=>r.materials.includes(l));o.length&&lA(i,o,this.texture,e.reflectivity)}this.data.enableBackground&&!r.enableBackground?this.setBackground(this.texture):!this.data.enableBackground&&r.enableBackground&&this.setBackground(null)},remove:function(){this.el.removeEventListener("object3dset",this.object3dsetHandler);const r=this.el.getObject3D("mesh"),e=this.data;lA(r,e.materials,null,1),e.enableBackground&&this.setBackground(null)},setBackground:function(r){this.el.sceneEl.object3D.background=r}}),AFRAME.registerComponent("grab",{init:function(){this.system=this.el.sceneEl.systems.physics,this.GRABBED_STATE="grabbed",this.grabbing=!1,this.hitEl=null,this.physics=this.el.sceneEl.systems.physics,this.constraint=null,this.onHit=this.onHit.bind(this),this.onGripOpen=this.onGripOpen.bind(this),this.onGripClose=this.onGripClose.bind(this)},play:function(){const r=this.el;r.addEventListener("hit",this.onHit),r.addEventListener("gripdown",this.onGripClose),r.addEventListener("gripup",this.onGripOpen),r.addEventListener("trackpaddown",this.onGripClose),r.addEventListener("trackpadup",this.onGripOpen),r.addEventListener("triggerdown",this.onGripClose),r.addEventListener("triggerup",this.onGripOpen)},pause:function(){const r=this.el;r.removeEventListener("hit",this.onHit),r.removeEventListener("gripdown",this.onGripClose),r.removeEventListener("gripup",this.onGripOpen),r.removeEventListener("trackpaddown",this.onGripClose),r.removeEventListener("trackpadup",this.onGripOpen),r.removeEventListener("triggerdown",this.onGripClose),r.removeEventListener("triggerup",this.onGripOpen)},onGripClose:function(){this.grabbing=!0},onGripOpen:function(){const r=this.hitEl;this.grabbing=!1,r&&(r.removeState(this.GRABBED_STATE),this.hitEl=void 0,this.system.removeConstraint(this.constraint),this.constraint=null)},onHit:function(r){const e=r.detail.el;e.is(this.GRABBED_STATE)||!this.grabbing||this.hitEl||(e.addState(this.GRABBED_STATE),this.hitEl=e,this.constraint=new CANNON.LockConstraint(this.el.body,e.body),this.system.addConstraint(this.constraint))}}),AFRAME.registerComponent("normal-material",{init:function(){this.material=new THREE.MeshNormalMaterial({flatShading:!0}),this.applyMaterial=this.applyMaterial.bind(this),this.el.addEventListener("object3dset",this.applyMaterial),this.applyMaterial()},remove:function(){this.el.removeEventListener("object3dset",this.applyMaterial)},applyMaterial:function(){this.el.object3D.traverse(r=>{r.isMesh&&(r.material=this.material)})}}),AFRAME.registerComponent("sphere-collider",{schema:{enabled:{default:!0},interval:{default:80},objects:{default:""},state:{default:"collided"},radius:{default:.05},watch:{default:!0}},init:function(){this.observer=null,this.els=[],this.collisions=[],this.prevCheckTime=void 0,this.eventDetail={},this.handleHit=this.handleHit.bind(this),this.handleHitEnd=this.handleHitEnd.bind(this)},play:function(){const r=this.el.sceneEl;this.data.watch&&(this.observer=new MutationObserver(this.update.bind(this,null)),this.observer.observe(r,{childList:!0,subtree:!0}))},pause:function(){this.observer&&(this.observer.disconnect(),this.observer=null)},update:function(){const r=this.data;let e;r.objects?e=this.el.sceneEl.querySelectorAll(r.objects):e=this.el.sceneEl.children,this.els=Array.prototype.slice.call(e)},tick:function(){const r=new THREE.Vector3,e=new THREE.Vector3,i=new THREE.Vector3,n=new THREE.Vector3,s=new THREE.Box3,o=[],l=new Map;return function(u){if(!this.data.enabled)return;const c=this.prevCheckTime;if(c&&u-c<this.data.interval)return;this.prevCheckTime=u;const h=this.el,p=this.data,f=h.getObject3D("mesh");let g;if(!f)return;o.length=0,l.clear(),h.object3D.getWorldPosition(r),h.object3D.getWorldScale(i),g=p.radius*y(i),this.els.forEach(m),o.sort((b,v)=>l.get(b)>l.get(v)?1:-1).forEach(this.handleHit),this.collisions.filter(b=>!l.has(b)).forEach(this.handleHitEnd),vY(this.collisions,o);function m(b){let v,_,T,E;b.isEntity&&(_=b.getObject3D("mesh"),_&&(s.setFromObject(_).getSize(n),E=Math.max(n.x,n.y,n.z)/2,v=Math.sqrt(2*E*E),s.getCenter(e),v&&(T=r.distanceTo(e),T<v+g&&(o.push(b),l.set(b,T)))))}function y(b){return Math.max(b.x,b.y,b.z)}}}(),handleHit:function(r){r.emit("hit"),r.addState(this.data.state),this.eventDetail.el=r,this.el.emit("hit",this.eventDetail)},handleHitEnd:function(r){r.emit("hitend"),r.removeState(this.data.state),this.eventDetail.el=r,this.el.emit("hitend",this.eventDetail)}});function vY(r,e){r.length=0;for(let i=0;i<e.length;i++)r[i]=e[i]}AFRAME.registerComponent("nav-mesh",{schema:{nodeName:{type:"string"}},init:function(){this.system=this.el.sceneEl.systems.nav,this.hasLoadedNavMesh=!1,this.nodeName=this.data.nodeName,this.el.addEventListener("object3dset",this.loadNavMesh.bind(this))},play:function(){this.hasLoadedNavMesh||this.loadNavMesh()},loadNavMesh:function(){var r=this;const e=this.el.getObject3D("mesh");if(this.el.sceneEl.object3D,!e)return;let i;if(e.traverse(s=>{s.isMesh&&(!r.nodeName||s.name===r.nodeName)&&(i=s)}),!i)return;const n=i.geometry.clone();i.updateWorldMatrix(!0,!1),n.applyMatrix4(i.matrixWorld),this.system.setNavMeshGeometry(n),this.hasLoadedNavMesh=!0}}),AFRAME.registerComponent("nav-agent",{schema:{destination:{type:"vec3"},active:{default:!1},speed:{default:2}},init:function(){this.system=this.el.sceneEl.systems.nav,this.system.addAgent(this),this.group=null,this.path=[],this.raycaster=new THREE.Raycaster},remove:function(){this.system.removeAgent(this)},update:function(){this.path.length=0},updateNavLocation:function(){this.group=null,this.path=[]},tick:function(){const r=new THREE.Vector3,e=new THREE.Vector3,i=new THREE.Vector3;return function(n,s){const o=this.el,l=this.data,u=this.raycaster,c=l.speed*s/1e3;if(!l.active)return;if(!this.path.length){const y=this.el.object3D.position;this.group=this.group||this.system.getGroup(y),this.path=this.system.getPath(y,r.copy(l.destination),this.group)||[],o.emit("navigation-start")}if(!this.path.length){console.warn("[nav] Unable to find path to %o.",l.destination),this.el.setAttribute("nav-agent",{active:!1}),o.emit("navigation-end");return}const h=o.object3D.position,p=this.path[0];e.subVectors(p,h);const f=e.length();let g;if(f<c){if(this.path.shift(),!this.path.length){this.el.setAttribute("nav-agent",{active:!1}),o.emit("navigation-end");return}i.copy(h),g=this.path[0]}else i.copy(e.setLength(c)).add(h),g=p;g.y=h.y,o.object3D.lookAt(g),u.ray.origin.copy(i),u.ray.origin.y+=1.5,u.ray.direction={x:0,y:-1,z:0};const m=u.intersectObject(this.system.getNavMesh());m.length?(e.subVectors(m[0].point,h),h.add(e.setLength(c))):h.copy(i)}}()});/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Gb="170",ka={ROTATE:0,DOLLY:1,PAN:2},bu={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},bY=0,jP=1,xY=2,VP=1,_Y=2,xu=3,Gh=0,go=1,_u=2,Eu=0,um=1,GP=2,HP=3,WP=4,EY=5,ap=100,wY=101,CY=102,SY=103,TY=104,MY=200,RY=201,IY=202,BY=203,pC=204,fC=205,LY=206,DY=207,NY=208,PY=209,OY=210,kY=211,FY=212,UY=213,zY=214,mC=0,gC=1,AC=2,hm=3,yC=4,vC=5,bC=6,xC=7,_C=0,jY=1,VY=2,Hh=0,GY=1,HY=2,WY=3,QY=4,qY=5,XY=6,YY=7,QP=300,dm=301,pm=302,EC=303,wC=304,Hb=306,CC=1e3,op=1001,SC=1002,ic=1003,KY=1004,Wb=1005,Uc=1006,TC=1007,lp=1008,wu=1009,qP=1010,XP=1011,cA=1012,MC=1013,cp=1014,Cu=1015,fm=1016,RC=1017,IC=1018,mm=1020,YP=35902,KP=1021,JP=1022,rc=1023,ZP=1024,$P=1025,gm=1026,Am=1027,eO=1028,BC=1029,tO=1030,LC=1031,DC=1033,Qb=33776,qb=33777,Xb=33778,Yb=33779,NC=35840,PC=35841,OC=35842,kC=35843,FC=36196,UC=37492,zC=37496,jC=37808,VC=37809,GC=37810,HC=37811,WC=37812,QC=37813,qC=37814,XC=37815,YC=37816,KC=37817,JC=37818,ZC=37819,$C=37820,eS=37821,Kb=36492,tS=36494,iS=36495,iO=36283,rS=36284,nS=36285,sS=36286,JY=3200,ZY=3201,rO=0,$Y=1,Wh="",al="srgb",ym="srgb-linear",Jb="linear",as="srgb",vm=7680,nO=519,eK=512,tK=513,iK=514,sO=515,rK=516,nK=517,sK=518,aK=519,aS=35044,aO="300 es",Su=2e3,Zb=2001;let up=class{addEventListener(r,e){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[r]===void 0&&(i[r]=[]),i[r].indexOf(e)===-1&&i[r].push(e)}hasEventListener(r,e){if(this._listeners===void 0)return!1;const i=this._listeners;return i[r]!==void 0&&i[r].indexOf(e)!==-1}removeEventListener(r,e){if(this._listeners===void 0)return;const i=this._listeners[r];if(i!==void 0){const n=i.indexOf(e);n!==-1&&i.splice(n,1)}}dispatchEvent(r){if(this._listeners===void 0)return;const e=this._listeners[r.type];if(e!==void 0){r.target=this;const i=e.slice(0);for(let n=0,s=i.length;n<s;n++)i[n].call(this,r);r.target=null}}};const Ja=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let oO=1234567;const uA=Math.PI/180,hA=180/Math.PI;function Tu(){const r=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(Ja[r&255]+Ja[r>>8&255]+Ja[r>>16&255]+Ja[r>>24&255]+"-"+Ja[e&255]+Ja[e>>8&255]+"-"+Ja[e>>16&15|64]+Ja[e>>24&255]+"-"+Ja[i&63|128]+Ja[i>>8&255]+"-"+Ja[i>>16&255]+Ja[i>>24&255]+Ja[n&255]+Ja[n>>8&255]+Ja[n>>16&255]+Ja[n>>24&255]).toLowerCase()}function Sa(r,e,i){return Math.max(e,Math.min(i,r))}function oS(r,e){return(r%e+e)%e}function oK(r,e,i,n,s){return n+(r-e)*(s-n)/(i-e)}function lK(r,e,i){return r!==e?(i-r)/(e-r):0}function dA(r,e,i){return(1-i)*r+i*e}function cK(r,e,i,n){return dA(r,e,1-Math.exp(-i*n))}function uK(r,e=1){return e-Math.abs(oS(r,e*2)-e)}function hK(r,e,i){return r<=e?0:r>=i?1:(r=(r-e)/(i-e),r*r*(3-2*r))}function dK(r,e,i){return r<=e?0:r>=i?1:(r=(r-e)/(i-e),r*r*r*(r*(r*6-15)+10))}function pK(r,e){return r+Math.floor(Math.random()*(e-r+1))}function fK(r,e){return r+Math.random()*(e-r)}function mK(r){return r*(.5-Math.random())}function gK(r){r!==void 0&&(oO=r);let e=oO+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function AK(r){return r*uA}function yK(r){return r*hA}function vK(r){return(r&r-1)===0&&r!==0}function bK(r){return Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function xK(r){return Math.pow(2,Math.floor(Math.log(r)/Math.LN2))}function _K(r,e,i,n,s){const o=Math.cos,l=Math.sin,u=o(i/2),c=l(i/2),h=o((e+n)/2),p=l((e+n)/2),f=o((e-n)/2),g=l((e-n)/2),m=o((n-e)/2),y=l((n-e)/2);switch(s){case"XYX":r.set(u*p,c*f,c*g,u*h);break;case"YZY":r.set(c*g,u*p,c*f,u*h);break;case"ZXZ":r.set(c*f,c*g,u*p,u*h);break;case"XZX":r.set(u*p,c*y,c*m,u*h);break;case"YXY":r.set(c*m,u*p,c*y,u*h);break;case"ZYZ":r.set(c*y,c*m,u*p,u*h);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function nc(r,e){switch(e.constructor){case Float32Array:return r;case Uint32Array:return r/4294967295;case Uint16Array:return r/65535;case Uint8Array:return r/255;case Int32Array:return Math.max(r/2147483647,-1);case Int16Array:return Math.max(r/32767,-1);case Int8Array:return Math.max(r/127,-1);default:throw new Error("Invalid component type.")}}function is(r,e){switch(e.constructor){case Float32Array:return r;case Uint32Array:return Math.round(r*4294967295);case Uint16Array:return Math.round(r*65535);case Uint8Array:return Math.round(r*255);case Int32Array:return Math.round(r*2147483647);case Int16Array:return Math.round(r*32767);case Int8Array:return Math.round(r*127);default:throw new Error("Invalid component type.")}}const lS={DEG2RAD:uA,RAD2DEG:hA,generateUUID:Tu,clamp:Sa,euclideanModulo:oS,mapLinear:oK,inverseLerp:lK,lerp:dA,damp:cK,pingpong:uK,smoothstep:hK,smootherstep:dK,randInt:pK,randFloat:fK,randFloatSpread:mK,seededRandom:gK,degToRad:AK,radToDeg:yK,isPowerOfTwo:vK,ceilPowerOfTwo:bK,floorPowerOfTwo:xK,setQuaternionFromProperEuler:_K,normalize:is,denormalize:nc};let ji=class SG{constructor(e=0,i=0){SG.prototype.isVector2=!0,this.x=e,this.y=i}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,i){return this.x=e,this.y=i,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const i=this.x,n=this.y,s=e.elements;return this.x=s[0]*i+s[3]*n+s[6],this.y=s[1]*i+s[4]*n+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this}clampLength(e,i){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(i,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const n=this.dot(e)/i;return Math.acos(Sa(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,n=this.y-e.y;return i*i+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this}lerpVectors(e,i,n){return this.x=e.x+(i.x-e.x)*n,this.y=e.y+(i.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this}rotateAround(e,i){const n=Math.cos(i),s=Math.sin(i),o=this.x-e.x,l=this.y-e.y;return this.x=o*n-l*s+e.x,this.y=o*s+l*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},fn=class TG{constructor(e,i,n,s,o,l,u,c,h){TG.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,i,n,s,o,l,u,c,h)}set(e,i,n,s,o,l,u,c,h){const p=this.elements;return p[0]=e,p[1]=s,p[2]=u,p[3]=i,p[4]=o,p[5]=c,p[6]=n,p[7]=l,p[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const i=this.elements,n=e.elements;return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],this}extractBasis(e,i,n){return e.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const i=e.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const n=e.elements,s=i.elements,o=this.elements,l=n[0],u=n[3],c=n[6],h=n[1],p=n[4],f=n[7],g=n[2],m=n[5],y=n[8],b=s[0],v=s[3],_=s[6],T=s[1],E=s[4],C=s[7],R=s[2],B=s[5],I=s[8];return o[0]=l*b+u*T+c*R,o[3]=l*v+u*E+c*B,o[6]=l*_+u*C+c*I,o[1]=h*b+p*T+f*R,o[4]=h*v+p*E+f*B,o[7]=h*_+p*C+f*I,o[2]=g*b+m*T+y*R,o[5]=g*v+m*E+y*B,o[8]=g*_+m*C+y*I,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=e,i[4]*=e,i[7]*=e,i[2]*=e,i[5]*=e,i[8]*=e,this}determinant(){const e=this.elements,i=e[0],n=e[1],s=e[2],o=e[3],l=e[4],u=e[5],c=e[6],h=e[7],p=e[8];return i*l*p-i*u*h-n*o*p+n*u*c+s*o*h-s*l*c}invert(){const e=this.elements,i=e[0],n=e[1],s=e[2],o=e[3],l=e[4],u=e[5],c=e[6],h=e[7],p=e[8],f=p*l-u*h,g=u*c-p*o,m=h*o-l*c,y=i*f+n*g+s*m;if(y===0)return this.set(0,0,0,0,0,0,0,0,0);const b=1/y;return e[0]=f*b,e[1]=(s*h-p*n)*b,e[2]=(u*n-s*l)*b,e[3]=g*b,e[4]=(p*i-s*c)*b,e[5]=(s*o-u*i)*b,e[6]=m*b,e[7]=(n*c-h*i)*b,e[8]=(l*i-n*o)*b,this}transpose(){let e;const i=this.elements;return e=i[1],i[1]=i[3],i[3]=e,e=i[2],i[2]=i[6],i[6]=e,e=i[5],i[5]=i[7],i[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const i=this.elements;return e[0]=i[0],e[1]=i[3],e[2]=i[6],e[3]=i[1],e[4]=i[4],e[5]=i[7],e[6]=i[2],e[7]=i[5],e[8]=i[8],this}setUvTransform(e,i,n,s,o,l,u){const c=Math.cos(o),h=Math.sin(o);return this.set(n*c,n*h,-n*(c*l+h*u)+l+e,-s*h,s*c,-s*(-h*l+c*u)+u+i,0,0,1),this}scale(e,i){return this.premultiply(cS.makeScale(e,i)),this}rotate(e){return this.premultiply(cS.makeRotation(-e)),this}translate(e,i){return this.premultiply(cS.makeTranslation(e,i)),this}makeTranslation(e,i){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,i,0,0,1),this}makeRotation(e){const i=Math.cos(e),n=Math.sin(e);return this.set(i,-n,0,n,i,0,0,0,1),this}makeScale(e,i){return this.set(e,0,0,0,i,0,0,0,1),this}equals(e){const i=this.elements,n=e.elements;for(let s=0;s<9;s++)if(i[s]!==n[s])return!1;return!0}fromArray(e,i=0){for(let n=0;n<9;n++)this.elements[n]=e[n+i];return this}toArray(e=[],i=0){const n=this.elements;return e[i]=n[0],e[i+1]=n[1],e[i+2]=n[2],e[i+3]=n[3],e[i+4]=n[4],e[i+5]=n[5],e[i+6]=n[6],e[i+7]=n[7],e[i+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}};const cS=new fn;function lO(r){for(let e=r.length-1;e>=0;--e)if(r[e]>=65535)return!0;return!1}function pA(r){return document.createElementNS("http://www.w3.org/1999/xhtml",r)}function EK(){const r=pA("canvas");return r.style.display="block",r}const cO={};function fA(r){r in cO||(cO[r]=!0,console.warn(r))}function wK(r,e,i){return new Promise(function(n,s){function o(){switch(r.clientWaitSync(e,r.SYNC_FLUSH_COMMANDS_BIT,0)){case r.WAIT_FAILED:s();break;case r.TIMEOUT_EXPIRED:setTimeout(o,i);break;default:n()}}setTimeout(o,i)})}function CK(r){const e=r.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}function SK(r){const e=r.elements;e[11]===-1?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=-e[14]+1)}const kn={enabled:!0,workingColorSpace:ym,spaces:{},convert:function(r,e,i){return this.enabled===!1||e===i||!e||!i||(this.spaces[e].transfer===as&&(r.r=Mu(r.r),r.g=Mu(r.g),r.b=Mu(r.b)),this.spaces[e].primaries!==this.spaces[i].primaries&&(r.applyMatrix3(this.spaces[e].toXYZ),r.applyMatrix3(this.spaces[i].fromXYZ)),this.spaces[i].transfer===as&&(r.r=bm(r.r),r.g=bm(r.g),r.b=bm(r.b))),r},fromWorkingColorSpace:function(r,e){return this.convert(r,this.workingColorSpace,e)},toWorkingColorSpace:function(r,e){return this.convert(r,e,this.workingColorSpace)},getPrimaries:function(r){return this.spaces[r].primaries},getTransfer:function(r){return r===Wh?Jb:this.spaces[r].transfer},getLuminanceCoefficients:function(r,e=this.workingColorSpace){return r.fromArray(this.spaces[e].luminanceCoefficients)},define:function(r){Object.assign(this.spaces,r)},_getMatrix:function(r,e,i){return r.copy(this.spaces[e].toXYZ).multiply(this.spaces[i].fromXYZ)},_getDrawingBufferColorSpace:function(r){return this.spaces[r].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(r=this.workingColorSpace){return this.spaces[r].workingColorSpaceConfig.unpackColorSpace}};function Mu(r){return r<.04045?r*.0773993808:Math.pow(r*.9478672986+.0521327014,2.4)}function bm(r){return r<.0031308?r*12.92:1.055*Math.pow(r,.41666)-.055}const uO=[.64,.33,.3,.6,.15,.06],hO=[.2126,.7152,.0722],dO=[.3127,.329],pO=new fn().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),fO=new fn().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);kn.define({[ym]:{primaries:uO,whitePoint:dO,transfer:Jb,toXYZ:pO,fromXYZ:fO,luminanceCoefficients:hO,workingColorSpaceConfig:{unpackColorSpace:al},outputColorSpaceConfig:{drawingBufferColorSpace:al}},[al]:{primaries:uO,whitePoint:dO,transfer:as,toXYZ:pO,fromXYZ:fO,luminanceCoefficients:hO,outputColorSpaceConfig:{drawingBufferColorSpace:al}}});let xm,TK=class{static getDataURL(r){if(/^data:/i.test(r.src)||typeof HTMLCanvasElement>"u")return r.src;let e;if(r instanceof HTMLCanvasElement)e=r;else{xm===void 0&&(xm=pA("canvas")),xm.width=r.width,xm.height=r.height;const i=xm.getContext("2d");r instanceof ImageData?i.putImageData(r,0,0):i.drawImage(r,0,0,r.width,r.height),e=xm}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",r),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(r){if(typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap){const e=pA("canvas");e.width=r.width,e.height=r.height;const i=e.getContext("2d");i.drawImage(r,0,0,r.width,r.height);const n=i.getImageData(0,0,r.width,r.height),s=n.data;for(let o=0;o<s.length;o++)s[o]=Mu(s[o]/255)*255;return i.putImageData(n,0,0),e}else if(r.data){const e=r.data.slice(0);for(let i=0;i<e.length;i++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[i]=Math.floor(Mu(e[i]/255)*255):e[i]=Mu(e[i]);return{data:e,width:r.width,height:r.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),r}},MK=0,mO=class{constructor(r=null){this.isSource=!0,Object.defineProperty(this,"id",{value:MK++}),this.uuid=Tu(),this.data=r,this.dataReady=!0,this.version=0}set needsUpdate(r){r===!0&&this.version++}toJSON(r){const e=r===void 0||typeof r=="string";if(!e&&r.images[this.uuid]!==void 0)return r.images[this.uuid];const i={uuid:this.uuid,url:""},n=this.data;if(n!==null){let s;if(Array.isArray(n)){s=[];for(let o=0,l=n.length;o<l;o++)n[o].isDataTexture?s.push(uS(n[o].image)):s.push(uS(n[o]))}else s=uS(n);i.url=s}return e||(r.images[this.uuid]=i),i}};function uS(r){return typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap?TK.getDataURL(r):r.data?{data:Array.from(r.data),width:r.width,height:r.height,type:r.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let RK=0,Dl=class Uw extends up{constructor(e=Uw.DEFAULT_IMAGE,i=Uw.DEFAULT_MAPPING,n=op,s=op,o=Uc,l=lp,u=rc,c=wu,h=Uw.DEFAULT_ANISOTROPY,p=Wh){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:RK++}),this.uuid=Tu(),this.name="",this.source=new mO(e),this.mipmaps=[],this.mapping=i,this.channel=0,this.wrapS=n,this.wrapT=s,this.magFilter=o,this.minFilter=l,this.anisotropy=h,this.format=u,this.internalFormat=null,this.type=c,this.offset=new ji(0,0),this.repeat=new ji(1,1),this.center=new ji(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new fn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=p,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),i||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==QP)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case CC:e.x=e.x-Math.floor(e.x);break;case op:e.x=e.x<0?0:1;break;case SC:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case CC:e.y=e.y-Math.floor(e.y);break;case op:e.y=e.y<0?0:1;break;case SC:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}};Dl.DEFAULT_IMAGE=null,Dl.DEFAULT_MAPPING=QP,Dl.DEFAULT_ANISOTROPY=1;let Zs=class MG{constructor(e=0,i=0,n=0,s=1){MG.prototype.isVector4=!0,this.x=e,this.y=i,this.z=n,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,i,n,s){return this.x=e,this.y=i,this.z=n,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this.w=e.w+i.w,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this.w+=e.w*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this.w=e.w-i.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const i=this.x,n=this.y,s=this.z,o=this.w,l=e.elements;return this.x=l[0]*i+l[4]*n+l[8]*s+l[12]*o,this.y=l[1]*i+l[5]*n+l[9]*s+l[13]*o,this.z=l[2]*i+l[6]*n+l[10]*s+l[14]*o,this.w=l[3]*i+l[7]*n+l[11]*s+l[15]*o,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const i=Math.sqrt(1-e.w*e.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/i,this.y=e.y/i,this.z=e.z/i),this}setAxisAngleFromRotationMatrix(e){let i,n,s,o;const l=e.elements,u=l[0],c=l[4],h=l[8],p=l[1],f=l[5],g=l[9],m=l[2],y=l[6],b=l[10];if(Math.abs(c-p)<.01&&Math.abs(h-m)<.01&&Math.abs(g-y)<.01){if(Math.abs(c+p)<.1&&Math.abs(h+m)<.1&&Math.abs(g+y)<.1&&Math.abs(u+f+b-3)<.1)return this.set(1,0,0,0),this;i=Math.PI;const _=(u+1)/2,T=(f+1)/2,E=(b+1)/2,C=(c+p)/4,R=(h+m)/4,B=(g+y)/4;return _>T&&_>E?_<.01?(n=0,s=.707106781,o=.707106781):(n=Math.sqrt(_),s=C/n,o=R/n):T>E?T<.01?(n=.707106781,s=0,o=.707106781):(s=Math.sqrt(T),n=C/s,o=B/s):E<.01?(n=.707106781,s=.707106781,o=0):(o=Math.sqrt(E),n=R/o,s=B/o),this.set(n,s,o,i),this}let v=Math.sqrt((y-g)*(y-g)+(h-m)*(h-m)+(p-c)*(p-c));return Math.abs(v)<.001&&(v=1),this.x=(y-g)/v,this.y=(h-m)/v,this.z=(p-c)/v,this.w=Math.acos((u+f+b-1)/2),this}setFromMatrixPosition(e){const i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this.w=i[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this.w=Math.max(e.w,Math.min(i.w,this.w)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this.w=Math.max(e,Math.min(i,this.w)),this}clampLength(e,i){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(i,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this.w+=(e.w-this.w)*i,this}lerpVectors(e,i,n){return this.x=e.x+(i.x-e.x)*n,this.y=e.y+(i.y-e.y)*n,this.z=e.z+(i.z-e.z)*n,this.w=e.w+(i.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this.w=e[i+3],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e[i+3]=this.w,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this.w=e.getW(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},IK=class extends up{constructor(r=1,e=1,i={}){super(),this.isRenderTarget=!0,this.width=r,this.height=e,this.depth=1,this.scissor=new Zs(0,0,r,e),this.scissorTest=!1,this.viewport=new Zs(0,0,r,e);const n={width:r,height:e,depth:1};i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Uc,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},i);const s=new Dl(n,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace);s.flipY=!1,s.generateMipmaps=i.generateMipmaps,s.internalFormat=i.internalFormat,this.textures=[];const o=i.count;for(let l=0;l<o;l++)this.textures[l]=s.clone(),this.textures[l].isRenderTargetTexture=!0;this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.resolveDepthBuffer=i.resolveDepthBuffer,this.resolveStencilBuffer=i.resolveStencilBuffer,this.depthTexture=i.depthTexture,this.samples=i.samples}get texture(){return this.textures[0]}set texture(r){this.textures[0]=r}setSize(r,e,i=1){if(this.width!==r||this.height!==e||this.depth!==i){this.width=r,this.height=e,this.depth=i;for(let n=0,s=this.textures.length;n<s;n++)this.textures[n].image.width=r,this.textures[n].image.height=e,this.textures[n].image.depth=i;this.dispose()}this.viewport.set(0,0,r,e),this.scissor.set(0,0,r,e)}clone(){return new this.constructor().copy(this)}copy(r){this.width=r.width,this.height=r.height,this.depth=r.depth,this.scissor.copy(r.scissor),this.scissorTest=r.scissorTest,this.viewport.copy(r.viewport),this.textures.length=0;for(let i=0,n=r.textures.length;i<n;i++)this.textures[i]=r.textures[i].clone(),this.textures[i].isRenderTargetTexture=!0;const e=Object.assign({},r.texture.image);return this.texture.source=new mO(e),this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.resolveDepthBuffer=r.resolveDepthBuffer,this.resolveStencilBuffer=r.resolveStencilBuffer,r.depthTexture!==null&&(this.depthTexture=r.depthTexture.clone()),this.samples=r.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}},Qh=class extends IK{constructor(r=1,e=1,i={}){super(r,e,i),this.isWebGLRenderTarget=!0}},gO=class extends Dl{constructor(r=null,e=1,i=1,n=1){super(null),this.isDataArrayTexture=!0,this.image={data:r,width:e,height:i,depth:n},this.magFilter=ic,this.minFilter=ic,this.wrapR=op,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(r){this.layerUpdates.add(r)}clearLayerUpdates(){this.layerUpdates.clear()}};class BK extends Dl{constructor(e=null,i=1,n=1,s=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:i,height:n,depth:s},this.magFilter=ic,this.minFilter=ic,this.wrapR=op,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}let zc=class{constructor(r=0,e=0,i=0,n=1){this.isQuaternion=!0,this._x=r,this._y=e,this._z=i,this._w=n}static slerpFlat(r,e,i,n,s,o,l){let u=i[n+0],c=i[n+1],h=i[n+2],p=i[n+3];const f=s[o+0],g=s[o+1],m=s[o+2],y=s[o+3];if(l===0){r[e+0]=u,r[e+1]=c,r[e+2]=h,r[e+3]=p;return}if(l===1){r[e+0]=f,r[e+1]=g,r[e+2]=m,r[e+3]=y;return}if(p!==y||u!==f||c!==g||h!==m){let b=1-l;const v=u*f+c*g+h*m+p*y,_=v>=0?1:-1,T=1-v*v;if(T>Number.EPSILON){const C=Math.sqrt(T),R=Math.atan2(C,v*_);b=Math.sin(b*R)/C,l=Math.sin(l*R)/C}const E=l*_;if(u=u*b+f*E,c=c*b+g*E,h=h*b+m*E,p=p*b+y*E,b===1-l){const C=1/Math.sqrt(u*u+c*c+h*h+p*p);u*=C,c*=C,h*=C,p*=C}}r[e]=u,r[e+1]=c,r[e+2]=h,r[e+3]=p}static multiplyQuaternionsFlat(r,e,i,n,s,o){const l=i[n],u=i[n+1],c=i[n+2],h=i[n+3],p=s[o],f=s[o+1],g=s[o+2],m=s[o+3];return r[e]=l*m+h*p+u*g-c*f,r[e+1]=u*m+h*f+c*p-l*g,r[e+2]=c*m+h*g+l*f-u*p,r[e+3]=h*m-l*p-u*f-c*g,r}get x(){return this._x}set x(r){this._x=r,this._onChangeCallback()}get y(){return this._y}set y(r){this._y=r,this._onChangeCallback()}get z(){return this._z}set z(r){this._z=r,this._onChangeCallback()}get w(){return this._w}set w(r){this._w=r,this._onChangeCallback()}set(r,e,i,n){return this._x=r,this._y=e,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(r){return this._x=r.x,this._y=r.y,this._z=r.z,this._w=r.w,this._onChangeCallback(),this}setFromEuler(r,e=!0){const i=r._x,n=r._y,s=r._z,o=r._order,l=Math.cos,u=Math.sin,c=l(i/2),h=l(n/2),p=l(s/2),f=u(i/2),g=u(n/2),m=u(s/2);switch(o){case"XYZ":this._x=f*h*p+c*g*m,this._y=c*g*p-f*h*m,this._z=c*h*m+f*g*p,this._w=c*h*p-f*g*m;break;case"YXZ":this._x=f*h*p+c*g*m,this._y=c*g*p-f*h*m,this._z=c*h*m-f*g*p,this._w=c*h*p+f*g*m;break;case"ZXY":this._x=f*h*p-c*g*m,this._y=c*g*p+f*h*m,this._z=c*h*m+f*g*p,this._w=c*h*p-f*g*m;break;case"ZYX":this._x=f*h*p-c*g*m,this._y=c*g*p+f*h*m,this._z=c*h*m-f*g*p,this._w=c*h*p+f*g*m;break;case"YZX":this._x=f*h*p+c*g*m,this._y=c*g*p+f*h*m,this._z=c*h*m-f*g*p,this._w=c*h*p-f*g*m;break;case"XZY":this._x=f*h*p-c*g*m,this._y=c*g*p-f*h*m,this._z=c*h*m+f*g*p,this._w=c*h*p+f*g*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return e===!0&&this._onChangeCallback(),this}setFromAxisAngle(r,e){const i=e/2,n=Math.sin(i);return this._x=r.x*n,this._y=r.y*n,this._z=r.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(r){const e=r.elements,i=e[0],n=e[4],s=e[8],o=e[1],l=e[5],u=e[9],c=e[2],h=e[6],p=e[10],f=i+l+p;if(f>0){const g=.5/Math.sqrt(f+1);this._w=.25/g,this._x=(h-u)*g,this._y=(s-c)*g,this._z=(o-n)*g}else if(i>l&&i>p){const g=2*Math.sqrt(1+i-l-p);this._w=(h-u)/g,this._x=.25*g,this._y=(n+o)/g,this._z=(s+c)/g}else if(l>p){const g=2*Math.sqrt(1+l-i-p);this._w=(s-c)/g,this._x=(n+o)/g,this._y=.25*g,this._z=(u+h)/g}else{const g=2*Math.sqrt(1+p-i-l);this._w=(o-n)/g,this._x=(s+c)/g,this._y=(u+h)/g,this._z=.25*g}return this._onChangeCallback(),this}setFromUnitVectors(r,e){let i=r.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(r.x)>Math.abs(r.z)?(this._x=-r.y,this._y=r.x,this._z=0,this._w=i):(this._x=0,this._y=-r.z,this._z=r.y,this._w=i)):(this._x=r.y*e.z-r.z*e.y,this._y=r.z*e.x-r.x*e.z,this._z=r.x*e.y-r.y*e.x,this._w=i),this.normalize()}angleTo(r){return 2*Math.acos(Math.abs(Sa(this.dot(r),-1,1)))}rotateTowards(r,e){const i=this.angleTo(r);if(i===0)return this;const n=Math.min(1,e/i);return this.slerp(r,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(r){return this._x*r._x+this._y*r._y+this._z*r._z+this._w*r._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let r=this.length();return r===0?(this._x=0,this._y=0,this._z=0,this._w=1):(r=1/r,this._x=this._x*r,this._y=this._y*r,this._z=this._z*r,this._w=this._w*r),this._onChangeCallback(),this}multiply(r){return this.multiplyQuaternions(this,r)}premultiply(r){return this.multiplyQuaternions(r,this)}multiplyQuaternions(r,e){const i=r._x,n=r._y,s=r._z,o=r._w,l=e._x,u=e._y,c=e._z,h=e._w;return this._x=i*h+o*l+n*c-s*u,this._y=n*h+o*u+s*l-i*c,this._z=s*h+o*c+i*u-n*l,this._w=o*h-i*l-n*u-s*c,this._onChangeCallback(),this}slerp(r,e){if(e===0)return this;if(e===1)return this.copy(r);const i=this._x,n=this._y,s=this._z,o=this._w;let l=o*r._w+i*r._x+n*r._y+s*r._z;if(l<0?(this._w=-r._w,this._x=-r._x,this._y=-r._y,this._z=-r._z,l=-l):this.copy(r),l>=1)return this._w=o,this._x=i,this._y=n,this._z=s,this;const u=1-l*l;if(u<=Number.EPSILON){const g=1-e;return this._w=g*o+e*this._w,this._x=g*i+e*this._x,this._y=g*n+e*this._y,this._z=g*s+e*this._z,this.normalize(),this}const c=Math.sqrt(u),h=Math.atan2(c,l),p=Math.sin((1-e)*h)/c,f=Math.sin(e*h)/c;return this._w=o*p+this._w*f,this._x=i*p+this._x*f,this._y=n*p+this._y*f,this._z=s*p+this._z*f,this._onChangeCallback(),this}slerpQuaternions(r,e,i){return this.copy(r).slerp(e,i)}random(){const r=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),i=Math.random(),n=Math.sqrt(1-i),s=Math.sqrt(i);return this.set(n*Math.sin(r),n*Math.cos(r),s*Math.sin(e),s*Math.cos(e))}equals(r){return r._x===this._x&&r._y===this._y&&r._z===this._z&&r._w===this._w}fromArray(r,e=0){return this._x=r[e],this._y=r[e+1],this._z=r[e+2],this._w=r[e+3],this._onChangeCallback(),this}toArray(r=[],e=0){return r[e]=this._x,r[e+1]=this._y,r[e+2]=this._z,r[e+3]=this._w,r}fromBufferAttribute(r,e){return this._x=r.getX(e),this._y=r.getY(e),this._z=r.getZ(e),this._w=r.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(r){return this._onChangeCallback=r,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},at=class RG{constructor(e=0,i=0,n=0){RG.prototype.isVector3=!0,this.x=e,this.y=i,this.z=n}set(e,i,n){return n===void 0&&(n=this.z),this.x=e,this.y=i,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,i){return this.x=e.x*i.x,this.y=e.y*i.y,this.z=e.z*i.z,this}applyEuler(e){return this.applyQuaternion(AO.setFromEuler(e))}applyAxisAngle(e,i){return this.applyQuaternion(AO.setFromAxisAngle(e,i))}applyMatrix3(e){const i=this.x,n=this.y,s=this.z,o=e.elements;return this.x=o[0]*i+o[3]*n+o[6]*s,this.y=o[1]*i+o[4]*n+o[7]*s,this.z=o[2]*i+o[5]*n+o[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const i=this.x,n=this.y,s=this.z,o=e.elements,l=1/(o[3]*i+o[7]*n+o[11]*s+o[15]);return this.x=(o[0]*i+o[4]*n+o[8]*s+o[12])*l,this.y=(o[1]*i+o[5]*n+o[9]*s+o[13])*l,this.z=(o[2]*i+o[6]*n+o[10]*s+o[14])*l,this}applyQuaternion(e){const i=this.x,n=this.y,s=this.z,o=e.x,l=e.y,u=e.z,c=e.w,h=2*(l*s-u*n),p=2*(u*i-o*s),f=2*(o*n-l*i);return this.x=i+c*h+l*f-u*p,this.y=n+c*p+u*h-o*f,this.z=s+c*f+o*p-l*h,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const i=this.x,n=this.y,s=this.z,o=e.elements;return this.x=o[0]*i+o[4]*n+o[8]*s,this.y=o[1]*i+o[5]*n+o[9]*s,this.z=o[2]*i+o[6]*n+o[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this}clampLength(e,i){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(i,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this}lerpVectors(e,i,n){return this.x=e.x+(i.x-e.x)*n,this.y=e.y+(i.y-e.y)*n,this.z=e.z+(i.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,i){const n=e.x,s=e.y,o=e.z,l=i.x,u=i.y,c=i.z;return this.x=s*c-o*u,this.y=o*l-n*c,this.z=n*u-s*l,this}projectOnVector(e){const i=e.lengthSq();if(i===0)return this.set(0,0,0);const n=e.dot(this)/i;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return hS.copy(this).projectOnVector(e),this.sub(hS)}reflect(e){return this.sub(hS.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const n=this.dot(e)/i;return Math.acos(Sa(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,n=this.y-e.y,s=this.z-e.z;return i*i+n*n+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,i,n){const s=Math.sin(i)*e;return this.x=s*Math.sin(n),this.y=Math.cos(i)*e,this.z=s*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,i,n){return this.x=e*Math.sin(i),this.y=n,this.z=e*Math.cos(i),this}setFromMatrixPosition(e){const i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(e){const i=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=i,this.y=n,this.z=s,this}setFromMatrixColumn(e,i){return this.fromArray(e.elements,i*4)}setFromMatrix3Column(e,i){return this.fromArray(e.elements,i*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,i=Math.random()*2-1,n=Math.sqrt(1-i*i);return this.x=n*Math.cos(e),this.y=i,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};const hS=new at,AO=new zc;let hp=class{constructor(r=new at(1/0,1/0,1/0),e=new at(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=r,this.max=e}set(r,e){return this.min.copy(r),this.max.copy(e),this}setFromArray(r){this.makeEmpty();for(let e=0,i=r.length;e<i;e+=3)this.expandByPoint(sc.fromArray(r,e));return this}setFromBufferAttribute(r){this.makeEmpty();for(let e=0,i=r.count;e<i;e++)this.expandByPoint(sc.fromBufferAttribute(r,e));return this}setFromPoints(r){this.makeEmpty();for(let e=0,i=r.length;e<i;e++)this.expandByPoint(r[e]);return this}setFromCenterAndSize(r,e){const i=sc.copy(e).multiplyScalar(.5);return this.min.copy(r).sub(i),this.max.copy(r).add(i),this}setFromObject(r,e=!1){return this.makeEmpty(),this.expandByObject(r,e)}clone(){return new this.constructor().copy(this)}copy(r){return this.min.copy(r.min),this.max.copy(r.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(r){return this.isEmpty()?r.set(0,0,0):r.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(r){return this.isEmpty()?r.set(0,0,0):r.subVectors(this.max,this.min)}expandByPoint(r){return this.min.min(r),this.max.max(r),this}expandByVector(r){return this.min.sub(r),this.max.add(r),this}expandByScalar(r){return this.min.addScalar(-r),this.max.addScalar(r),this}expandByObject(r,e=!1){r.updateWorldMatrix(!1,!1);const i=r.geometry;if(i!==void 0){const s=i.getAttribute("position");if(e===!0&&s!==void 0&&r.isInstancedMesh!==!0)for(let o=0,l=s.count;o<l;o++)r.isMesh===!0?r.getVertexPosition(o,sc):sc.fromBufferAttribute(s,o),sc.applyMatrix4(r.matrixWorld),this.expandByPoint(sc);else r.boundingBox!==void 0?(r.boundingBox===null&&r.computeBoundingBox(),$b.copy(r.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),$b.copy(i.boundingBox)),$b.applyMatrix4(r.matrixWorld),this.union($b)}const n=r.children;for(let s=0,o=n.length;s<o;s++)this.expandByObject(n[s],e);return this}containsPoint(r){return r.x>=this.min.x&&r.x<=this.max.x&&r.y>=this.min.y&&r.y<=this.max.y&&r.z>=this.min.z&&r.z<=this.max.z}containsBox(r){return this.min.x<=r.min.x&&r.max.x<=this.max.x&&this.min.y<=r.min.y&&r.max.y<=this.max.y&&this.min.z<=r.min.z&&r.max.z<=this.max.z}getParameter(r,e){return e.set((r.x-this.min.x)/(this.max.x-this.min.x),(r.y-this.min.y)/(this.max.y-this.min.y),(r.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(r){return r.max.x>=this.min.x&&r.min.x<=this.max.x&&r.max.y>=this.min.y&&r.min.y<=this.max.y&&r.max.z>=this.min.z&&r.min.z<=this.max.z}intersectsSphere(r){return this.clampPoint(r.center,sc),sc.distanceToSquared(r.center)<=r.radius*r.radius}intersectsPlane(r){let e,i;return r.normal.x>0?(e=r.normal.x*this.min.x,i=r.normal.x*this.max.x):(e=r.normal.x*this.max.x,i=r.normal.x*this.min.x),r.normal.y>0?(e+=r.normal.y*this.min.y,i+=r.normal.y*this.max.y):(e+=r.normal.y*this.max.y,i+=r.normal.y*this.min.y),r.normal.z>0?(e+=r.normal.z*this.min.z,i+=r.normal.z*this.max.z):(e+=r.normal.z*this.max.z,i+=r.normal.z*this.min.z),e<=-r.constant&&i>=-r.constant}intersectsTriangle(r){if(this.isEmpty())return!1;this.getCenter(mA),ex.subVectors(this.max,mA),_m.subVectors(r.a,mA),Em.subVectors(r.b,mA),wm.subVectors(r.c,mA),qh.subVectors(Em,_m),Xh.subVectors(wm,Em),dp.subVectors(_m,wm);let e=[0,-qh.z,qh.y,0,-Xh.z,Xh.y,0,-dp.z,dp.y,qh.z,0,-qh.x,Xh.z,0,-Xh.x,dp.z,0,-dp.x,-qh.y,qh.x,0,-Xh.y,Xh.x,0,-dp.y,dp.x,0];return!dS(e,_m,Em,wm,ex)||(e=[1,0,0,0,1,0,0,0,1],!dS(e,_m,Em,wm,ex))?!1:(tx.crossVectors(qh,Xh),e=[tx.x,tx.y,tx.z],dS(e,_m,Em,wm,ex))}clampPoint(r,e){return e.copy(r).clamp(this.min,this.max)}distanceToPoint(r){return this.clampPoint(r,sc).distanceTo(r)}getBoundingSphere(r){return this.isEmpty()?r.makeEmpty():(this.getCenter(r.center),r.radius=this.getSize(sc).length()*.5),r}intersect(r){return this.min.max(r.min),this.max.min(r.max),this.isEmpty()&&this.makeEmpty(),this}union(r){return this.min.min(r.min),this.max.max(r.max),this}applyMatrix4(r){return this.isEmpty()?this:(Ru[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(r),Ru[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(r),Ru[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(r),Ru[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(r),Ru[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(r),Ru[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(r),Ru[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(r),Ru[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(r),this.setFromPoints(Ru),this)}translate(r){return this.min.add(r),this.max.add(r),this}equals(r){return r.min.equals(this.min)&&r.max.equals(this.max)}};const Ru=[new at,new at,new at,new at,new at,new at,new at,new at],sc=new at,$b=new hp,_m=new at,Em=new at,wm=new at,qh=new at,Xh=new at,dp=new at,mA=new at,ex=new at,tx=new at,pp=new at;function dS(r,e,i,n,s){for(let o=0,l=r.length-3;o<=l;o+=3){pp.fromArray(r,o);const u=s.x*Math.abs(pp.x)+s.y*Math.abs(pp.y)+s.z*Math.abs(pp.z),c=e.dot(pp),h=i.dot(pp),p=n.dot(pp);if(Math.max(-Math.max(c,h,p),Math.min(c,h,p))>u)return!1}return!0}const LK=new hp,gA=new at,pS=new at;let ix=class{constructor(r=new at,e=-1){this.isSphere=!0,this.center=r,this.radius=e}set(r,e){return this.center.copy(r),this.radius=e,this}setFromPoints(r,e){const i=this.center;e!==void 0?i.copy(e):LK.setFromPoints(r).getCenter(i);let n=0;for(let s=0,o=r.length;s<o;s++)n=Math.max(n,i.distanceToSquared(r[s]));return this.radius=Math.sqrt(n),this}copy(r){return this.center.copy(r.center),this.radius=r.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(r){return r.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(r){return r.distanceTo(this.center)-this.radius}intersectsSphere(r){const e=this.radius+r.radius;return r.center.distanceToSquared(this.center)<=e*e}intersectsBox(r){return r.intersectsSphere(this)}intersectsPlane(r){return Math.abs(r.distanceToPoint(this.center))<=this.radius}clampPoint(r,e){const i=this.center.distanceToSquared(r);return e.copy(r),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(r){return this.isEmpty()?(r.makeEmpty(),r):(r.set(this.center,this.center),r.expandByScalar(this.radius),r)}applyMatrix4(r){return this.center.applyMatrix4(r),this.radius=this.radius*r.getMaxScaleOnAxis(),this}translate(r){return this.center.add(r),this}expandByPoint(r){if(this.isEmpty())return this.center.copy(r),this.radius=0,this;gA.subVectors(r,this.center);const e=gA.lengthSq();if(e>this.radius*this.radius){const i=Math.sqrt(e),n=(i-this.radius)*.5;this.center.addScaledVector(gA,n/i),this.radius+=n}return this}union(r){return r.isEmpty()?this:this.isEmpty()?(this.copy(r),this):(this.center.equals(r.center)===!0?this.radius=Math.max(this.radius,r.radius):(pS.subVectors(r.center,this.center).setLength(r.radius),this.expandByPoint(gA.copy(r.center).add(pS)),this.expandByPoint(gA.copy(r.center).sub(pS))),this)}equals(r){return r.center.equals(this.center)&&r.radius===this.radius}clone(){return new this.constructor().copy(this)}};const Iu=new at,fS=new at,rx=new at,Yh=new at,mS=new at,nx=new at,gS=new at;let sx=class{constructor(r=new at,e=new at(0,0,-1)){this.origin=r,this.direction=e}set(r,e){return this.origin.copy(r),this.direction.copy(e),this}copy(r){return this.origin.copy(r.origin),this.direction.copy(r.direction),this}at(r,e){return e.copy(this.origin).addScaledVector(this.direction,r)}lookAt(r){return this.direction.copy(r).sub(this.origin).normalize(),this}recast(r){return this.origin.copy(this.at(r,Iu)),this}closestPointToPoint(r,e){e.subVectors(r,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(r){return Math.sqrt(this.distanceSqToPoint(r))}distanceSqToPoint(r){const e=Iu.subVectors(r,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(r):(Iu.copy(this.origin).addScaledVector(this.direction,e),Iu.distanceToSquared(r))}distanceSqToSegment(r,e,i,n){fS.copy(r).add(e).multiplyScalar(.5),rx.copy(e).sub(r).normalize(),Yh.copy(this.origin).sub(fS);const s=r.distanceTo(e)*.5,o=-this.direction.dot(rx),l=Yh.dot(this.direction),u=-Yh.dot(rx),c=Yh.lengthSq(),h=Math.abs(1-o*o);let p,f,g,m;if(h>0)if(p=o*u-l,f=o*l-u,m=s*h,p>=0)if(f>=-m)if(f<=m){const y=1/h;p*=y,f*=y,g=p*(p+o*f+2*l)+f*(o*p+f+2*u)+c}else f=s,p=Math.max(0,-(o*f+l)),g=-p*p+f*(f+2*u)+c;else f=-s,p=Math.max(0,-(o*f+l)),g=-p*p+f*(f+2*u)+c;else f<=-m?(p=Math.max(0,-(-o*s+l)),f=p>0?-s:Math.min(Math.max(-s,-u),s),g=-p*p+f*(f+2*u)+c):f<=m?(p=0,f=Math.min(Math.max(-s,-u),s),g=f*(f+2*u)+c):(p=Math.max(0,-(o*s+l)),f=p>0?s:Math.min(Math.max(-s,-u),s),g=-p*p+f*(f+2*u)+c);else f=o>0?-s:s,p=Math.max(0,-(o*f+l)),g=-p*p+f*(f+2*u)+c;return i&&i.copy(this.origin).addScaledVector(this.direction,p),n&&n.copy(fS).addScaledVector(rx,f),g}intersectSphere(r,e){Iu.subVectors(r.center,this.origin);const i=Iu.dot(this.direction),n=Iu.dot(Iu)-i*i,s=r.radius*r.radius;if(n>s)return null;const o=Math.sqrt(s-n),l=i-o,u=i+o;return u<0?null:l<0?this.at(u,e):this.at(l,e)}intersectsSphere(r){return this.distanceSqToPoint(r.center)<=r.radius*r.radius}distanceToPlane(r){const e=r.normal.dot(this.direction);if(e===0)return r.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(r.normal)+r.constant)/e;return i>=0?i:null}intersectPlane(r,e){const i=this.distanceToPlane(r);return i===null?null:this.at(i,e)}intersectsPlane(r){const e=r.distanceToPoint(this.origin);return e===0||r.normal.dot(this.direction)*e<0}intersectBox(r,e){let i,n,s,o,l,u;const c=1/this.direction.x,h=1/this.direction.y,p=1/this.direction.z,f=this.origin;return c>=0?(i=(r.min.x-f.x)*c,n=(r.max.x-f.x)*c):(i=(r.max.x-f.x)*c,n=(r.min.x-f.x)*c),h>=0?(s=(r.min.y-f.y)*h,o=(r.max.y-f.y)*h):(s=(r.max.y-f.y)*h,o=(r.min.y-f.y)*h),i>o||s>n||((s>i||isNaN(i))&&(i=s),(o<n||isNaN(n))&&(n=o),p>=0?(l=(r.min.z-f.z)*p,u=(r.max.z-f.z)*p):(l=(r.max.z-f.z)*p,u=(r.min.z-f.z)*p),i>u||l>n)||((l>i||i!==i)&&(i=l),(u<n||n!==n)&&(n=u),n<0)?null:this.at(i>=0?i:n,e)}intersectsBox(r){return this.intersectBox(r,Iu)!==null}intersectTriangle(r,e,i,n,s){mS.subVectors(e,r),nx.subVectors(i,r),gS.crossVectors(mS,nx);let o=this.direction.dot(gS),l;if(o>0){if(n)return null;l=1}else if(o<0)l=-1,o=-o;else return null;Yh.subVectors(this.origin,r);const u=l*this.direction.dot(nx.crossVectors(Yh,nx));if(u<0)return null;const c=l*this.direction.dot(mS.cross(Yh));if(c<0||u+c>o)return null;const h=-l*Yh.dot(gS);return h<0?null:this.at(h/o,s)}applyMatrix4(r){return this.origin.applyMatrix4(r),this.direction.transformDirection(r),this}equals(r){return r.origin.equals(this.origin)&&r.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},gs=class GL{constructor(e,i,n,s,o,l,u,c,h,p,f,g,m,y,b,v){GL.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,i,n,s,o,l,u,c,h,p,f,g,m,y,b,v)}set(e,i,n,s,o,l,u,c,h,p,f,g,m,y,b,v){const _=this.elements;return _[0]=e,_[4]=i,_[8]=n,_[12]=s,_[1]=o,_[5]=l,_[9]=u,_[13]=c,_[2]=h,_[6]=p,_[10]=f,_[14]=g,_[3]=m,_[7]=y,_[11]=b,_[15]=v,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new GL().fromArray(this.elements)}copy(e){const i=this.elements,n=e.elements;return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],this}copyPosition(e){const i=this.elements,n=e.elements;return i[12]=n[12],i[13]=n[13],i[14]=n[14],this}setFromMatrix3(e){const i=e.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(e,i,n){return e.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,i,n){return this.set(e.x,i.x,n.x,0,e.y,i.y,n.y,0,e.z,i.z,n.z,0,0,0,0,1),this}extractRotation(e){const i=this.elements,n=e.elements,s=1/Cm.setFromMatrixColumn(e,0).length(),o=1/Cm.setFromMatrixColumn(e,1).length(),l=1/Cm.setFromMatrixColumn(e,2).length();return i[0]=n[0]*s,i[1]=n[1]*s,i[2]=n[2]*s,i[3]=0,i[4]=n[4]*o,i[5]=n[5]*o,i[6]=n[6]*o,i[7]=0,i[8]=n[8]*l,i[9]=n[9]*l,i[10]=n[10]*l,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(e){const i=this.elements,n=e.x,s=e.y,o=e.z,l=Math.cos(n),u=Math.sin(n),c=Math.cos(s),h=Math.sin(s),p=Math.cos(o),f=Math.sin(o);if(e.order==="XYZ"){const g=l*p,m=l*f,y=u*p,b=u*f;i[0]=c*p,i[4]=-c*f,i[8]=h,i[1]=m+y*h,i[5]=g-b*h,i[9]=-u*c,i[2]=b-g*h,i[6]=y+m*h,i[10]=l*c}else if(e.order==="YXZ"){const g=c*p,m=c*f,y=h*p,b=h*f;i[0]=g+b*u,i[4]=y*u-m,i[8]=l*h,i[1]=l*f,i[5]=l*p,i[9]=-u,i[2]=m*u-y,i[6]=b+g*u,i[10]=l*c}else if(e.order==="ZXY"){const g=c*p,m=c*f,y=h*p,b=h*f;i[0]=g-b*u,i[4]=-l*f,i[8]=y+m*u,i[1]=m+y*u,i[5]=l*p,i[9]=b-g*u,i[2]=-l*h,i[6]=u,i[10]=l*c}else if(e.order==="ZYX"){const g=l*p,m=l*f,y=u*p,b=u*f;i[0]=c*p,i[4]=y*h-m,i[8]=g*h+b,i[1]=c*f,i[5]=b*h+g,i[9]=m*h-y,i[2]=-h,i[6]=u*c,i[10]=l*c}else if(e.order==="YZX"){const g=l*c,m=l*h,y=u*c,b=u*h;i[0]=c*p,i[4]=b-g*f,i[8]=y*f+m,i[1]=f,i[5]=l*p,i[9]=-u*p,i[2]=-h*p,i[6]=m*f+y,i[10]=g-b*f}else if(e.order==="XZY"){const g=l*c,m=l*h,y=u*c,b=u*h;i[0]=c*p,i[4]=-f,i[8]=h*p,i[1]=g*f+b,i[5]=l*p,i[9]=m*f-y,i[2]=y*f-m,i[6]=u*p,i[10]=b*f+g}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(e){return this.compose(DK,e,NK)}lookAt(e,i,n){const s=this.elements;return ol.subVectors(e,i),ol.lengthSq()===0&&(ol.z=1),ol.normalize(),Kh.crossVectors(n,ol),Kh.lengthSq()===0&&(Math.abs(n.z)===1?ol.x+=1e-4:ol.z+=1e-4,ol.normalize(),Kh.crossVectors(n,ol)),Kh.normalize(),ax.crossVectors(ol,Kh),s[0]=Kh.x,s[4]=ax.x,s[8]=ol.x,s[1]=Kh.y,s[5]=ax.y,s[9]=ol.y,s[2]=Kh.z,s[6]=ax.z,s[10]=ol.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const n=e.elements,s=i.elements,o=this.elements,l=n[0],u=n[4],c=n[8],h=n[12],p=n[1],f=n[5],g=n[9],m=n[13],y=n[2],b=n[6],v=n[10],_=n[14],T=n[3],E=n[7],C=n[11],R=n[15],B=s[0],I=s[4],N=s[8],D=s[12],P=s[1],k=s[5],q=s[9],V=s[13],j=s[2],Q=s[6],W=s[10],G=s[14],z=s[3],te=s[7],Y=s[11],se=s[15];return o[0]=l*B+u*P+c*j+h*z,o[4]=l*I+u*k+c*Q+h*te,o[8]=l*N+u*q+c*W+h*Y,o[12]=l*D+u*V+c*G+h*se,o[1]=p*B+f*P+g*j+m*z,o[5]=p*I+f*k+g*Q+m*te,o[9]=p*N+f*q+g*W+m*Y,o[13]=p*D+f*V+g*G+m*se,o[2]=y*B+b*P+v*j+_*z,o[6]=y*I+b*k+v*Q+_*te,o[10]=y*N+b*q+v*W+_*Y,o[14]=y*D+b*V+v*G+_*se,o[3]=T*B+E*P+C*j+R*z,o[7]=T*I+E*k+C*Q+R*te,o[11]=T*N+E*q+C*W+R*Y,o[15]=T*D+E*V+C*G+R*se,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[4]*=e,i[8]*=e,i[12]*=e,i[1]*=e,i[5]*=e,i[9]*=e,i[13]*=e,i[2]*=e,i[6]*=e,i[10]*=e,i[14]*=e,i[3]*=e,i[7]*=e,i[11]*=e,i[15]*=e,this}determinant(){const e=this.elements,i=e[0],n=e[4],s=e[8],o=e[12],l=e[1],u=e[5],c=e[9],h=e[13],p=e[2],f=e[6],g=e[10],m=e[14],y=e[3],b=e[7],v=e[11],_=e[15];return y*(+o*c*f-s*h*f-o*u*g+n*h*g+s*u*m-n*c*m)+b*(+i*c*m-i*h*g+o*l*g-s*l*m+s*h*p-o*c*p)+v*(+i*h*f-i*u*m-o*l*f+n*l*m+o*u*p-n*h*p)+_*(-s*u*p-i*c*f+i*u*g+s*l*f-n*l*g+n*c*p)}transpose(){const e=this.elements;let i;return i=e[1],e[1]=e[4],e[4]=i,i=e[2],e[2]=e[8],e[8]=i,i=e[6],e[6]=e[9],e[9]=i,i=e[3],e[3]=e[12],e[12]=i,i=e[7],e[7]=e[13],e[13]=i,i=e[11],e[11]=e[14],e[14]=i,this}setPosition(e,i,n){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=i,s[14]=n),this}invert(){const e=this.elements,i=e[0],n=e[1],s=e[2],o=e[3],l=e[4],u=e[5],c=e[6],h=e[7],p=e[8],f=e[9],g=e[10],m=e[11],y=e[12],b=e[13],v=e[14],_=e[15],T=f*v*h-b*g*h+b*c*m-u*v*m-f*c*_+u*g*_,E=y*g*h-p*v*h-y*c*m+l*v*m+p*c*_-l*g*_,C=p*b*h-y*f*h+y*u*m-l*b*m-p*u*_+l*f*_,R=y*f*c-p*b*c-y*u*g+l*b*g+p*u*v-l*f*v,B=i*T+n*E+s*C+o*R;if(B===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const I=1/B;return e[0]=T*I,e[1]=(b*g*o-f*v*o-b*s*m+n*v*m+f*s*_-n*g*_)*I,e[2]=(u*v*o-b*c*o+b*s*h-n*v*h-u*s*_+n*c*_)*I,e[3]=(f*c*o-u*g*o-f*s*h+n*g*h+u*s*m-n*c*m)*I,e[4]=E*I,e[5]=(p*v*o-y*g*o+y*s*m-i*v*m-p*s*_+i*g*_)*I,e[6]=(y*c*o-l*v*o-y*s*h+i*v*h+l*s*_-i*c*_)*I,e[7]=(l*g*o-p*c*o+p*s*h-i*g*h-l*s*m+i*c*m)*I,e[8]=C*I,e[9]=(y*f*o-p*b*o-y*n*m+i*b*m+p*n*_-i*f*_)*I,e[10]=(l*b*o-y*u*o+y*n*h-i*b*h-l*n*_+i*u*_)*I,e[11]=(p*u*o-l*f*o-p*n*h+i*f*h+l*n*m-i*u*m)*I,e[12]=R*I,e[13]=(p*b*s-y*f*s+y*n*g-i*b*g-p*n*v+i*f*v)*I,e[14]=(y*u*s-l*b*s-y*n*c+i*b*c+l*n*v-i*u*v)*I,e[15]=(l*f*s-p*u*s+p*n*c-i*f*c-l*n*g+i*u*g)*I,this}scale(e){const i=this.elements,n=e.x,s=e.y,o=e.z;return i[0]*=n,i[4]*=s,i[8]*=o,i[1]*=n,i[5]*=s,i[9]*=o,i[2]*=n,i[6]*=s,i[10]*=o,i[3]*=n,i[7]*=s,i[11]*=o,this}getMaxScaleOnAxis(){const e=this.elements,i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(i,n,s))}makeTranslation(e,i,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,i,0,0,1,n,0,0,0,1),this}makeRotationX(e){const i=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,i,-n,0,0,n,i,0,0,0,0,1),this}makeRotationY(e){const i=Math.cos(e),n=Math.sin(e);return this.set(i,0,n,0,0,1,0,0,-n,0,i,0,0,0,0,1),this}makeRotationZ(e){const i=Math.cos(e),n=Math.sin(e);return this.set(i,-n,0,0,n,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,i){const n=Math.cos(i),s=Math.sin(i),o=1-n,l=e.x,u=e.y,c=e.z,h=o*l,p=o*u;return this.set(h*l+n,h*u-s*c,h*c+s*u,0,h*u+s*c,p*u+n,p*c-s*l,0,h*c-s*u,p*c+s*l,o*c*c+n,0,0,0,0,1),this}makeScale(e,i,n){return this.set(e,0,0,0,0,i,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,i,n,s,o,l){return this.set(1,n,o,0,e,1,l,0,i,s,1,0,0,0,0,1),this}compose(e,i,n){const s=this.elements,o=i._x,l=i._y,u=i._z,c=i._w,h=o+o,p=l+l,f=u+u,g=o*h,m=o*p,y=o*f,b=l*p,v=l*f,_=u*f,T=c*h,E=c*p,C=c*f,R=n.x,B=n.y,I=n.z;return s[0]=(1-(b+_))*R,s[1]=(m+C)*R,s[2]=(y-E)*R,s[3]=0,s[4]=(m-C)*B,s[5]=(1-(g+_))*B,s[6]=(v+T)*B,s[7]=0,s[8]=(y+E)*I,s[9]=(v-T)*I,s[10]=(1-(g+b))*I,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,i,n){const s=this.elements;let o=Cm.set(s[0],s[1],s[2]).length();const l=Cm.set(s[4],s[5],s[6]).length(),u=Cm.set(s[8],s[9],s[10]).length();this.determinant()<0&&(o=-o),e.x=s[12],e.y=s[13],e.z=s[14],ac.copy(this);const c=1/o,h=1/l,p=1/u;return ac.elements[0]*=c,ac.elements[1]*=c,ac.elements[2]*=c,ac.elements[4]*=h,ac.elements[5]*=h,ac.elements[6]*=h,ac.elements[8]*=p,ac.elements[9]*=p,ac.elements[10]*=p,i.setFromRotationMatrix(ac),n.x=o,n.y=l,n.z=u,this}makePerspective(e,i,n,s,o,l,u=Su){const c=this.elements,h=2*o/(i-e),p=2*o/(n-s),f=(i+e)/(i-e),g=(n+s)/(n-s);let m,y;if(u===Su)m=-(l+o)/(l-o),y=-2*l*o/(l-o);else if(u===Zb)m=-l/(l-o),y=-l*o/(l-o);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+u);return c[0]=h,c[4]=0,c[8]=f,c[12]=0,c[1]=0,c[5]=p,c[9]=g,c[13]=0,c[2]=0,c[6]=0,c[10]=m,c[14]=y,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,i,n,s,o,l,u=Su){const c=this.elements,h=1/(i-e),p=1/(n-s),f=1/(l-o),g=(i+e)*h,m=(n+s)*p;let y,b;if(u===Su)y=(l+o)*f,b=-2*f;else if(u===Zb)y=o*f,b=-1*f;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+u);return c[0]=2*h,c[4]=0,c[8]=0,c[12]=-g,c[1]=0,c[5]=2*p,c[9]=0,c[13]=-m,c[2]=0,c[6]=0,c[10]=b,c[14]=-y,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const i=this.elements,n=e.elements;for(let s=0;s<16;s++)if(i[s]!==n[s])return!1;return!0}fromArray(e,i=0){for(let n=0;n<16;n++)this.elements[n]=e[n+i];return this}toArray(e=[],i=0){const n=this.elements;return e[i]=n[0],e[i+1]=n[1],e[i+2]=n[2],e[i+3]=n[3],e[i+4]=n[4],e[i+5]=n[5],e[i+6]=n[6],e[i+7]=n[7],e[i+8]=n[8],e[i+9]=n[9],e[i+10]=n[10],e[i+11]=n[11],e[i+12]=n[12],e[i+13]=n[13],e[i+14]=n[14],e[i+15]=n[15],e}};const Cm=new at,ac=new gs,DK=new at(0,0,0),NK=new at(1,1,1),Kh=new at,ax=new at,ol=new at,yO=new gs,vO=new zc;let Jh=class IG{constructor(e=0,i=0,n=0,s=IG.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=i,this._z=n,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,i,n,s=this._order){return this._x=e,this._y=i,this._z=n,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,i=this._order,n=!0){const s=e.elements,o=s[0],l=s[4],u=s[8],c=s[1],h=s[5],p=s[9],f=s[2],g=s[6],m=s[10];switch(i){case"XYZ":this._y=Math.asin(Sa(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-p,m),this._z=Math.atan2(-l,o)):(this._x=Math.atan2(g,h),this._z=0);break;case"YXZ":this._x=Math.asin(-Sa(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(u,m),this._z=Math.atan2(c,h)):(this._y=Math.atan2(-f,o),this._z=0);break;case"ZXY":this._x=Math.asin(Sa(g,-1,1)),Math.abs(g)<.9999999?(this._y=Math.atan2(-f,m),this._z=Math.atan2(-l,h)):(this._y=0,this._z=Math.atan2(c,o));break;case"ZYX":this._y=Math.asin(-Sa(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(g,m),this._z=Math.atan2(c,o)):(this._x=0,this._z=Math.atan2(-l,h));break;case"YZX":this._z=Math.asin(Sa(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-p,h),this._y=Math.atan2(-f,o)):(this._x=0,this._y=Math.atan2(u,m));break;case"XZY":this._z=Math.asin(-Sa(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(g,h),this._y=Math.atan2(u,o)):(this._x=Math.atan2(-p,m),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,i,n){return yO.makeRotationFromQuaternion(e),this.setFromRotationMatrix(yO,i,n)}setFromVector3(e,i=this._order){return this.set(e.x,e.y,e.z,i)}reorder(e){return vO.setFromEuler(this),this.setFromQuaternion(vO,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};Jh.DEFAULT_ORDER="XYZ";let AS=class{constructor(){this.mask=1}set(r){this.mask=(1<<r|0)>>>0}enable(r){this.mask|=1<<r|0}enableAll(){this.mask=-1}toggle(r){this.mask^=1<<r|0}disable(r){this.mask&=~(1<<r|0)}disableAll(){this.mask=0}test(r){return(this.mask&r.mask)!==0}isEnabled(r){return(this.mask&(1<<r|0))!==0}},PK=0;const bO=new at,Sm=new zc,Bu=new gs,ox=new at,AA=new at,OK=new at,kK=new zc,xO=new at(1,0,0),_O=new at(0,1,0),EO=new at(0,0,1),wO={type:"added"},FK={type:"removed"},Tm={type:"childadded",child:null},yS={type:"childremoved",child:null};let Za=class zw extends up{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:PK++}),this.uuid=Tu(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=zw.DEFAULT_UP.clone();const e=new at,i=new Jh,n=new zc,s=new at(1,1,1);function o(){n.setFromEuler(i,!1)}function l(){i.setFromQuaternion(n,void 0,!1)}i._onChange(o),n._onChange(l),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new gs},normalMatrix:{value:new fn}}),this.matrix=new gs,this.matrixWorld=new gs,this.matrixAutoUpdate=zw.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=zw.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new AS,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,i){this.quaternion.setFromAxisAngle(e,i)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,i){return Sm.setFromAxisAngle(e,i),this.quaternion.multiply(Sm),this}rotateOnWorldAxis(e,i){return Sm.setFromAxisAngle(e,i),this.quaternion.premultiply(Sm),this}rotateX(e){return this.rotateOnAxis(xO,e)}rotateY(e){return this.rotateOnAxis(_O,e)}rotateZ(e){return this.rotateOnAxis(EO,e)}translateOnAxis(e,i){return bO.copy(e).applyQuaternion(this.quaternion),this.position.add(bO.multiplyScalar(i)),this}translateX(e){return this.translateOnAxis(xO,e)}translateY(e){return this.translateOnAxis(_O,e)}translateZ(e){return this.translateOnAxis(EO,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Bu.copy(this.matrixWorld).invert())}lookAt(e,i,n){e.isVector3?ox.copy(e):ox.set(e,i,n);const s=this.parent;this.updateWorldMatrix(!0,!1),AA.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Bu.lookAt(AA,ox,this.up):Bu.lookAt(ox,AA,this.up),this.quaternion.setFromRotationMatrix(Bu),s&&(Bu.extractRotation(s.matrixWorld),Sm.setFromRotationMatrix(Bu),this.quaternion.premultiply(Sm.invert()))}add(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(wO),Tm.child=e,this.dispatchEvent(Tm),Tm.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const i=this.children.indexOf(e);return i!==-1&&(e.parent=null,this.children.splice(i,1),e.dispatchEvent(FK),yS.child=e,this.dispatchEvent(yS),yS.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Bu.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Bu.multiply(e.parent.matrixWorld)),e.applyMatrix4(Bu),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(wO),Tm.child=e,this.dispatchEvent(Tm),Tm.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,i){if(this[e]===i)return this;for(let n=0,s=this.children.length;n<s;n++){const o=this.children[n].getObjectByProperty(e,i);if(o!==void 0)return o}}getObjectsByProperty(e,i,n=[]){this[e]===i&&n.push(this);const s=this.children;for(let o=0,l=s.length;o<l;o++)s[o].getObjectsByProperty(e,i,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(AA,e,OK),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(AA,kK,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return e.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(e){e(this);const i=this.children;for(let n=0,s=i.length;n<s;n++)i[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const i=this.children;for(let n=0,s=i.length;n<s;n++)i[n].traverseVisible(e)}traverseAncestors(e){const i=this.parent;i!==null&&(e(i),i.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const i=this.children;for(let n=0,s=i.length;n<s;n++)i[n].updateMatrixWorld(e)}updateWorldMatrix(e,i){const n=this.parent;if(e===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),i===!0){const s=this.children;for(let o=0,l=s.length;o<l;o++)s[o].updateWorldMatrix(!1,!0)}}toJSON(e){const i=e===void 0||typeof e=="string",n={};i&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.visibility=this._visibility,s.active=this._active,s.bounds=this._bounds.map(u=>({boxInitialized:u.boxInitialized,boxMin:u.box.min.toArray(),boxMax:u.box.max.toArray(),sphereInitialized:u.sphereInitialized,sphereRadius:u.sphere.radius,sphereCenter:u.sphere.center.toArray()})),s.maxInstanceCount=this._maxInstanceCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.geometryCount=this._geometryCount,s.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(s.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(s.boundingSphere={center:s.boundingSphere.center.toArray(),radius:s.boundingSphere.radius}),this.boundingBox!==null&&(s.boundingBox={min:s.boundingBox.min.toArray(),max:s.boundingBox.max.toArray()}));function o(u,c){return u[c.uuid]===void 0&&(u[c.uuid]=c.toJSON(e)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=o(e.geometries,this.geometry);const u=this.geometry.parameters;if(u!==void 0&&u.shapes!==void 0){const c=u.shapes;if(Array.isArray(c))for(let h=0,p=c.length;h<p;h++){const f=c[h];o(e.shapes,f)}else o(e.shapes,c)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(o(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const u=[];for(let c=0,h=this.material.length;c<h;c++)u.push(o(e.materials,this.material[c]));s.material=u}else s.material=o(e.materials,this.material);if(this.children.length>0){s.children=[];for(let u=0;u<this.children.length;u++)s.children.push(this.children[u].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let u=0;u<this.animations.length;u++){const c=this.animations[u];s.animations.push(o(e.animations,c))}}if(i){const u=l(e.geometries),c=l(e.materials),h=l(e.textures),p=l(e.images),f=l(e.shapes),g=l(e.skeletons),m=l(e.animations),y=l(e.nodes);u.length>0&&(n.geometries=u),c.length>0&&(n.materials=c),h.length>0&&(n.textures=h),p.length>0&&(n.images=p),f.length>0&&(n.shapes=f),g.length>0&&(n.skeletons=g),m.length>0&&(n.animations=m),y.length>0&&(n.nodes=y)}return n.object=s,n;function l(u){const c=[];for(const h in u){const p=u[h];delete p.metadata,c.push(p)}return c}}clone(e){return new this.constructor().copy(this,e)}copy(e,i=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),i===!0)for(let n=0;n<e.children.length;n++){const s=e.children[n];this.add(s.clone())}return this}};Za.DEFAULT_UP=new at(0,1,0),Za.DEFAULT_MATRIX_AUTO_UPDATE=!0,Za.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const oc=new at,Lu=new at,vS=new at,Du=new at,Mm=new at,Rm=new at,CO=new at,bS=new at,xS=new at,_S=new at,ES=new Zs,wS=new Zs,CS=new Zs;let fp=class R0{constructor(e=new at,i=new at,n=new at){this.a=e,this.b=i,this.c=n}static getNormal(e,i,n,s){s.subVectors(n,i),oc.subVectors(e,i),s.cross(oc);const o=s.lengthSq();return o>0?s.multiplyScalar(1/Math.sqrt(o)):s.set(0,0,0)}static getBarycoord(e,i,n,s,o){oc.subVectors(s,i),Lu.subVectors(n,i),vS.subVectors(e,i);const l=oc.dot(oc),u=oc.dot(Lu),c=oc.dot(vS),h=Lu.dot(Lu),p=Lu.dot(vS),f=l*h-u*u;if(f===0)return o.set(0,0,0),null;const g=1/f,m=(h*c-u*p)*g,y=(l*p-u*c)*g;return o.set(1-m-y,y,m)}static containsPoint(e,i,n,s){return this.getBarycoord(e,i,n,s,Du)===null?!1:Du.x>=0&&Du.y>=0&&Du.x+Du.y<=1}static getInterpolation(e,i,n,s,o,l,u,c){return this.getBarycoord(e,i,n,s,Du)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(o,Du.x),c.addScaledVector(l,Du.y),c.addScaledVector(u,Du.z),c)}static getInterpolatedAttribute(e,i,n,s,o,l){return ES.setScalar(0),wS.setScalar(0),CS.setScalar(0),ES.fromBufferAttribute(e,i),wS.fromBufferAttribute(e,n),CS.fromBufferAttribute(e,s),l.setScalar(0),l.addScaledVector(ES,o.x),l.addScaledVector(wS,o.y),l.addScaledVector(CS,o.z),l}static isFrontFacing(e,i,n,s){return oc.subVectors(n,i),Lu.subVectors(e,i),oc.cross(Lu).dot(s)<0}set(e,i,n){return this.a.copy(e),this.b.copy(i),this.c.copy(n),this}setFromPointsAndIndices(e,i,n,s){return this.a.copy(e[i]),this.b.copy(e[n]),this.c.copy(e[s]),this}setFromAttributeAndIndices(e,i,n,s){return this.a.fromBufferAttribute(e,i),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return oc.subVectors(this.c,this.b),Lu.subVectors(this.a,this.b),oc.cross(Lu).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return R0.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,i){return R0.getBarycoord(e,this.a,this.b,this.c,i)}getInterpolation(e,i,n,s,o){return R0.getInterpolation(e,this.a,this.b,this.c,i,n,s,o)}containsPoint(e){return R0.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return R0.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,i){const n=this.a,s=this.b,o=this.c;let l,u;Mm.subVectors(s,n),Rm.subVectors(o,n),bS.subVectors(e,n);const c=Mm.dot(bS),h=Rm.dot(bS);if(c<=0&&h<=0)return i.copy(n);xS.subVectors(e,s);const p=Mm.dot(xS),f=Rm.dot(xS);if(p>=0&&f<=p)return i.copy(s);const g=c*f-p*h;if(g<=0&&c>=0&&p<=0)return l=c/(c-p),i.copy(n).addScaledVector(Mm,l);_S.subVectors(e,o);const m=Mm.dot(_S),y=Rm.dot(_S);if(y>=0&&m<=y)return i.copy(o);const b=m*h-c*y;if(b<=0&&h>=0&&y<=0)return u=h/(h-y),i.copy(n).addScaledVector(Rm,u);const v=p*y-m*f;if(v<=0&&f-p>=0&&m-y>=0)return CO.subVectors(o,s),u=(f-p)/(f-p+(m-y)),i.copy(s).addScaledVector(CO,u);const _=1/(v+b+g);return l=b*_,u=g*_,i.copy(n).addScaledVector(Mm,l).addScaledVector(Rm,u)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}};const SO={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Zh={h:0,s:0,l:0},lx={h:0,s:0,l:0};function SS(r,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?r+(e-r)*6*i:i<1/2?e:i<2/3?r+(e-r)*6*(2/3-i):r}let Cn=class{constructor(r,e,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(r,e,i)}set(r,e,i){if(e===void 0&&i===void 0){const n=r;n&&n.isColor?this.copy(n):typeof n=="number"?this.setHex(n):typeof n=="string"&&this.setStyle(n)}else this.setRGB(r,e,i);return this}setScalar(r){return this.r=r,this.g=r,this.b=r,this}setHex(r,e=al){return r=Math.floor(r),this.r=(r>>16&255)/255,this.g=(r>>8&255)/255,this.b=(r&255)/255,kn.toWorkingColorSpace(this,e),this}setRGB(r,e,i,n=kn.workingColorSpace){return this.r=r,this.g=e,this.b=i,kn.toWorkingColorSpace(this,n),this}setHSL(r,e,i,n=kn.workingColorSpace){if(r=oS(r,1),e=Sa(e,0,1),i=Sa(i,0,1),e===0)this.r=this.g=this.b=i;else{const s=i<=.5?i*(1+e):i+e-i*e,o=2*i-s;this.r=SS(o,s,r+1/3),this.g=SS(o,s,r),this.b=SS(o,s,r-1/3)}return kn.toWorkingColorSpace(this,n),this}setStyle(r,e=al){function i(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+r+" will be ignored.")}let n;if(n=/^(\w+)\(([^\)]*)\)/.exec(r)){let s;const o=n[1],l=n[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return i(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,e);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return i(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,e);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return i(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+r)}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(r)){const s=n[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,e);if(o===6)return this.setHex(parseInt(s,16),e);console.warn("THREE.Color: Invalid hex color "+r)}else if(r&&r.length>0)return this.setColorName(r,e);return this}setColorName(r,e=al){const i=SO[r.toLowerCase()];return i!==void 0?this.setHex(i,e):console.warn("THREE.Color: Unknown color "+r),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(r){return this.r=r.r,this.g=r.g,this.b=r.b,this}copySRGBToLinear(r){return this.r=Mu(r.r),this.g=Mu(r.g),this.b=Mu(r.b),this}copyLinearToSRGB(r){return this.r=bm(r.r),this.g=bm(r.g),this.b=bm(r.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(r=al){return kn.fromWorkingColorSpace($a.copy(this),r),Math.round(Sa($a.r*255,0,255))*65536+Math.round(Sa($a.g*255,0,255))*256+Math.round(Sa($a.b*255,0,255))}getHexString(r=al){return("000000"+this.getHex(r).toString(16)).slice(-6)}getHSL(r,e=kn.workingColorSpace){kn.fromWorkingColorSpace($a.copy(this),e);const i=$a.r,n=$a.g,s=$a.b,o=Math.max(i,n,s),l=Math.min(i,n,s);let u,c;const h=(l+o)/2;if(l===o)u=0,c=0;else{const p=o-l;switch(c=h<=.5?p/(o+l):p/(2-o-l),o){case i:u=(n-s)/p+(n<s?6:0);break;case n:u=(s-i)/p+2;break;case s:u=(i-n)/p+4;break}u/=6}return r.h=u,r.s=c,r.l=h,r}getRGB(r,e=kn.workingColorSpace){return kn.fromWorkingColorSpace($a.copy(this),e),r.r=$a.r,r.g=$a.g,r.b=$a.b,r}getStyle(r=al){kn.fromWorkingColorSpace($a.copy(this),r);const e=$a.r,i=$a.g,n=$a.b;return r!==al?`color(${r} ${e.toFixed(3)} ${i.toFixed(3)} ${n.toFixed(3)})`:`rgb(${Math.round(e*255)},${Math.round(i*255)},${Math.round(n*255)})`}offsetHSL(r,e,i){return this.getHSL(Zh),this.setHSL(Zh.h+r,Zh.s+e,Zh.l+i)}add(r){return this.r+=r.r,this.g+=r.g,this.b+=r.b,this}addColors(r,e){return this.r=r.r+e.r,this.g=r.g+e.g,this.b=r.b+e.b,this}addScalar(r){return this.r+=r,this.g+=r,this.b+=r,this}sub(r){return this.r=Math.max(0,this.r-r.r),this.g=Math.max(0,this.g-r.g),this.b=Math.max(0,this.b-r.b),this}multiply(r){return this.r*=r.r,this.g*=r.g,this.b*=r.b,this}multiplyScalar(r){return this.r*=r,this.g*=r,this.b*=r,this}lerp(r,e){return this.r+=(r.r-this.r)*e,this.g+=(r.g-this.g)*e,this.b+=(r.b-this.b)*e,this}lerpColors(r,e,i){return this.r=r.r+(e.r-r.r)*i,this.g=r.g+(e.g-r.g)*i,this.b=r.b+(e.b-r.b)*i,this}lerpHSL(r,e){this.getHSL(Zh),r.getHSL(lx);const i=dA(Zh.h,lx.h,e),n=dA(Zh.s,lx.s,e),s=dA(Zh.l,lx.l,e);return this.setHSL(i,n,s),this}setFromVector3(r){return this.r=r.x,this.g=r.y,this.b=r.z,this}applyMatrix3(r){const e=this.r,i=this.g,n=this.b,s=r.elements;return this.r=s[0]*e+s[3]*i+s[6]*n,this.g=s[1]*e+s[4]*i+s[7]*n,this.b=s[2]*e+s[5]*i+s[8]*n,this}equals(r){return r.r===this.r&&r.g===this.g&&r.b===this.b}fromArray(r,e=0){return this.r=r[e],this.g=r[e+1],this.b=r[e+2],this}toArray(r=[],e=0){return r[e]=this.r,r[e+1]=this.g,r[e+2]=this.b,r}fromBufferAttribute(r,e){return this.r=r.getX(e),this.g=r.getY(e),this.b=r.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const $a=new Cn;Cn.NAMES=SO;let UK=0,mp=class extends up{static get type(){return"Material"}get type(){return this.constructor.type}set type(r){}constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:UK++}),this.uuid=Tu(),this.name="",this.blending=um,this.side=Gh,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=pC,this.blendDst=fC,this.blendEquation=ap,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Cn(0,0,0),this.blendAlpha=0,this.depthFunc=hm,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=nO,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=vm,this.stencilZFail=vm,this.stencilZPass=vm,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(r){this._alphaTest>0!=r>0&&this.version++,this._alphaTest=r}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(r){if(r!==void 0)for(const e in r){const i=r[e];if(i===void 0){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}const n=this[e];if(n===void 0){console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`);continue}n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[e]=i}}toJSON(r){const e=r===void 0||typeof r=="string";e&&(r={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(r).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(r).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(r).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(i.dispersion=this.dispersion),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(r).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(r).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(r).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(r).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(r).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(r).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(r).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(r).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(r).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(r).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(r).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(r).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(r).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(r).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(r).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(r).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(r).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(r).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(r).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(r).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(r).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==um&&(i.blending=this.blending),this.side!==Gh&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==pC&&(i.blendSrc=this.blendSrc),this.blendDst!==fC&&(i.blendDst=this.blendDst),this.blendEquation!==ap&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==hm&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==nO&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==vm&&(i.stencilFail=this.stencilFail),this.stencilZFail!==vm&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==vm&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function n(s){const o=[];for(const l in s){const u=s[l];delete u.metadata,o.push(u)}return o}if(e){const s=n(r.textures),o=n(r.images);s.length>0&&(i.textures=s),o.length>0&&(i.images=o)}return i}clone(){return new this.constructor().copy(this)}copy(r){this.name=r.name,this.blending=r.blending,this.side=r.side,this.vertexColors=r.vertexColors,this.opacity=r.opacity,this.transparent=r.transparent,this.blendSrc=r.blendSrc,this.blendDst=r.blendDst,this.blendEquation=r.blendEquation,this.blendSrcAlpha=r.blendSrcAlpha,this.blendDstAlpha=r.blendDstAlpha,this.blendEquationAlpha=r.blendEquationAlpha,this.blendColor.copy(r.blendColor),this.blendAlpha=r.blendAlpha,this.depthFunc=r.depthFunc,this.depthTest=r.depthTest,this.depthWrite=r.depthWrite,this.stencilWriteMask=r.stencilWriteMask,this.stencilFunc=r.stencilFunc,this.stencilRef=r.stencilRef,this.stencilFuncMask=r.stencilFuncMask,this.stencilFail=r.stencilFail,this.stencilZFail=r.stencilZFail,this.stencilZPass=r.stencilZPass,this.stencilWrite=r.stencilWrite;const e=r.clippingPlanes;let i=null;if(e!==null){const n=e.length;i=new Array(n);for(let s=0;s!==n;++s)i[s]=e[s].clone()}return this.clippingPlanes=i,this.clipIntersection=r.clipIntersection,this.clipShadows=r.clipShadows,this.shadowSide=r.shadowSide,this.colorWrite=r.colorWrite,this.precision=r.precision,this.polygonOffset=r.polygonOffset,this.polygonOffsetFactor=r.polygonOffsetFactor,this.polygonOffsetUnits=r.polygonOffsetUnits,this.dithering=r.dithering,this.alphaTest=r.alphaTest,this.alphaHash=r.alphaHash,this.alphaToCoverage=r.alphaToCoverage,this.premultipliedAlpha=r.premultipliedAlpha,this.forceSinglePass=r.forceSinglePass,this.visible=r.visible,this.toneMapped=r.toneMapped,this.userData=JSON.parse(JSON.stringify(r.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(r){r===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}},Nu=class extends mp{static get type(){return"MeshBasicMaterial"}constructor(r){super(),this.isMeshBasicMaterial=!0,this.color=new Cn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Jh,this.combine=_C,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.lightMap=r.lightMap,this.lightMapIntensity=r.lightMapIntensity,this.aoMap=r.aoMap,this.aoMapIntensity=r.aoMapIntensity,this.specularMap=r.specularMap,this.alphaMap=r.alphaMap,this.envMap=r.envMap,this.envMapRotation.copy(r.envMapRotation),this.combine=r.combine,this.reflectivity=r.reflectivity,this.refractionRatio=r.refractionRatio,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.wireframeLinecap=r.wireframeLinecap,this.wireframeLinejoin=r.wireframeLinejoin,this.fog=r.fog,this}};const $s=new at,cx=new ji;let Fo=class{constructor(r,e,i=!1){if(Array.isArray(r))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=r,this.itemSize=e,this.count=r!==void 0?r.length/e:0,this.normalized=i,this.usage=aS,this.updateRanges=[],this.gpuType=Cu,this.version=0}onUploadCallback(){}set needsUpdate(r){r===!0&&this.version++}setUsage(r){return this.usage=r,this}addUpdateRange(r,e){this.updateRanges.push({start:r,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(r){return this.name=r.name,this.array=new r.array.constructor(r.array),this.itemSize=r.itemSize,this.count=r.count,this.normalized=r.normalized,this.usage=r.usage,this.gpuType=r.gpuType,this}copyAt(r,e,i){r*=this.itemSize,i*=e.itemSize;for(let n=0,s=this.itemSize;n<s;n++)this.array[r+n]=e.array[i+n];return this}copyArray(r){return this.array.set(r),this}applyMatrix3(r){if(this.itemSize===2)for(let e=0,i=this.count;e<i;e++)cx.fromBufferAttribute(this,e),cx.applyMatrix3(r),this.setXY(e,cx.x,cx.y);else if(this.itemSize===3)for(let e=0,i=this.count;e<i;e++)$s.fromBufferAttribute(this,e),$s.applyMatrix3(r),this.setXYZ(e,$s.x,$s.y,$s.z);return this}applyMatrix4(r){for(let e=0,i=this.count;e<i;e++)$s.fromBufferAttribute(this,e),$s.applyMatrix4(r),this.setXYZ(e,$s.x,$s.y,$s.z);return this}applyNormalMatrix(r){for(let e=0,i=this.count;e<i;e++)$s.fromBufferAttribute(this,e),$s.applyNormalMatrix(r),this.setXYZ(e,$s.x,$s.y,$s.z);return this}transformDirection(r){for(let e=0,i=this.count;e<i;e++)$s.fromBufferAttribute(this,e),$s.transformDirection(r),this.setXYZ(e,$s.x,$s.y,$s.z);return this}set(r,e=0){return this.array.set(r,e),this}getComponent(r,e){let i=this.array[r*this.itemSize+e];return this.normalized&&(i=nc(i,this.array)),i}setComponent(r,e,i){return this.normalized&&(i=is(i,this.array)),this.array[r*this.itemSize+e]=i,this}getX(r){let e=this.array[r*this.itemSize];return this.normalized&&(e=nc(e,this.array)),e}setX(r,e){return this.normalized&&(e=is(e,this.array)),this.array[r*this.itemSize]=e,this}getY(r){let e=this.array[r*this.itemSize+1];return this.normalized&&(e=nc(e,this.array)),e}setY(r,e){return this.normalized&&(e=is(e,this.array)),this.array[r*this.itemSize+1]=e,this}getZ(r){let e=this.array[r*this.itemSize+2];return this.normalized&&(e=nc(e,this.array)),e}setZ(r,e){return this.normalized&&(e=is(e,this.array)),this.array[r*this.itemSize+2]=e,this}getW(r){let e=this.array[r*this.itemSize+3];return this.normalized&&(e=nc(e,this.array)),e}setW(r,e){return this.normalized&&(e=is(e,this.array)),this.array[r*this.itemSize+3]=e,this}setXY(r,e,i){return r*=this.itemSize,this.normalized&&(e=is(e,this.array),i=is(i,this.array)),this.array[r+0]=e,this.array[r+1]=i,this}setXYZ(r,e,i,n){return r*=this.itemSize,this.normalized&&(e=is(e,this.array),i=is(i,this.array),n=is(n,this.array)),this.array[r+0]=e,this.array[r+1]=i,this.array[r+2]=n,this}setXYZW(r,e,i,n,s){return r*=this.itemSize,this.normalized&&(e=is(e,this.array),i=is(i,this.array),n=is(n,this.array),s=is(s,this.array)),this.array[r+0]=e,this.array[r+1]=i,this.array[r+2]=n,this.array[r+3]=s,this}onUpload(r){return this.onUploadCallback=r,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const r={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(r.name=this.name),this.usage!==aS&&(r.usage=this.usage),r}},TO=class extends Fo{constructor(r,e,i){super(new Uint16Array(r),e,i)}},MO=class extends Fo{constructor(r,e,i){super(new Uint32Array(r),e,i)}},Os=class extends Fo{constructor(r,e,i){super(new Float32Array(r),e,i)}},zK=0;const Nl=new gs,TS=new Za,Im=new at,ll=new hp,yA=new hp,Ta=new at;let Ao=class BG extends up{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:zK++}),this.uuid=Tu(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(lO(e)?MO:TO)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,i){return this.attributes[e]=i,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,i,n=0){this.groups.push({start:e,count:i,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,i){this.drawRange.start=e,this.drawRange.count=i}applyMatrix4(e){const i=this.attributes.position;i!==void 0&&(i.applyMatrix4(e),i.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const o=new fn().getNormalMatrix(e);n.applyNormalMatrix(o),n.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(e),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Nl.makeRotationFromQuaternion(e),this.applyMatrix4(Nl),this}rotateX(e){return Nl.makeRotationX(e),this.applyMatrix4(Nl),this}rotateY(e){return Nl.makeRotationY(e),this.applyMatrix4(Nl),this}rotateZ(e){return Nl.makeRotationZ(e),this.applyMatrix4(Nl),this}translate(e,i,n){return Nl.makeTranslation(e,i,n),this.applyMatrix4(Nl),this}scale(e,i,n){return Nl.makeScale(e,i,n),this.applyMatrix4(Nl),this}lookAt(e){return TS.lookAt(e),TS.updateMatrix(),this.applyMatrix4(TS.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Im).negate(),this.translate(Im.x,Im.y,Im.z),this}setFromPoints(e){const i=this.getAttribute("position");if(i===void 0){const n=[];for(let s=0,o=e.length;s<o;s++){const l=e[s];n.push(l.x,l.y,l.z||0)}this.setAttribute("position",new Os(n,3))}else{for(let n=0,s=i.count;n<s;n++){const o=e[n];i.setXYZ(n,o.x,o.y,o.z||0)}e.length>i.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),i.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new hp);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new at(-1/0,-1/0,-1/0),new at(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),i)for(let n=0,s=i.length;n<s;n++){const o=i[n];ll.setFromBufferAttribute(o),this.morphTargetsRelative?(Ta.addVectors(this.boundingBox.min,ll.min),this.boundingBox.expandByPoint(Ta),Ta.addVectors(this.boundingBox.max,ll.max),this.boundingBox.expandByPoint(Ta)):(this.boundingBox.expandByPoint(ll.min),this.boundingBox.expandByPoint(ll.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new ix);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new at,1/0);return}if(e){const n=this.boundingSphere.center;if(ll.setFromBufferAttribute(e),i)for(let o=0,l=i.length;o<l;o++){const u=i[o];yA.setFromBufferAttribute(u),this.morphTargetsRelative?(Ta.addVectors(ll.min,yA.min),ll.expandByPoint(Ta),Ta.addVectors(ll.max,yA.max),ll.expandByPoint(Ta)):(ll.expandByPoint(yA.min),ll.expandByPoint(yA.max))}ll.getCenter(n);let s=0;for(let o=0,l=e.count;o<l;o++)Ta.fromBufferAttribute(e,o),s=Math.max(s,n.distanceToSquared(Ta));if(i)for(let o=0,l=i.length;o<l;o++){const u=i[o],c=this.morphTargetsRelative;for(let h=0,p=u.count;h<p;h++)Ta.fromBufferAttribute(u,h),c&&(Im.fromBufferAttribute(e,h),Ta.add(Im)),s=Math.max(s,n.distanceToSquared(Ta))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,i=this.attributes;if(e===null||i.position===void 0||i.normal===void 0||i.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=i.position,s=i.normal,o=i.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Fo(new Float32Array(4*n.count),4));const l=this.getAttribute("tangent"),u=[],c=[];for(let N=0;N<n.count;N++)u[N]=new at,c[N]=new at;const h=new at,p=new at,f=new at,g=new ji,m=new ji,y=new ji,b=new at,v=new at;function _(N,D,P){h.fromBufferAttribute(n,N),p.fromBufferAttribute(n,D),f.fromBufferAttribute(n,P),g.fromBufferAttribute(o,N),m.fromBufferAttribute(o,D),y.fromBufferAttribute(o,P),p.sub(h),f.sub(h),m.sub(g),y.sub(g);const k=1/(m.x*y.y-y.x*m.y);isFinite(k)&&(b.copy(p).multiplyScalar(y.y).addScaledVector(f,-m.y).multiplyScalar(k),v.copy(f).multiplyScalar(m.x).addScaledVector(p,-y.x).multiplyScalar(k),u[N].add(b),u[D].add(b),u[P].add(b),c[N].add(v),c[D].add(v),c[P].add(v))}let T=this.groups;T.length===0&&(T=[{start:0,count:e.count}]);for(let N=0,D=T.length;N<D;++N){const P=T[N],k=P.start,q=P.count;for(let V=k,j=k+q;V<j;V+=3)_(e.getX(V+0),e.getX(V+1),e.getX(V+2))}const E=new at,C=new at,R=new at,B=new at;function I(N){R.fromBufferAttribute(s,N),B.copy(R);const D=u[N];E.copy(D),E.sub(R.multiplyScalar(R.dot(D))).normalize(),C.crossVectors(B,D);const P=C.dot(c[N])<0?-1:1;l.setXYZW(N,E.x,E.y,E.z,P)}for(let N=0,D=T.length;N<D;++N){const P=T[N],k=P.start,q=P.count;for(let V=k,j=k+q;V<j;V+=3)I(e.getX(V+0)),I(e.getX(V+1)),I(e.getX(V+2))}}computeVertexNormals(){const e=this.index,i=this.getAttribute("position");if(i!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new Fo(new Float32Array(i.count*3),3),this.setAttribute("normal",n);else for(let g=0,m=n.count;g<m;g++)n.setXYZ(g,0,0,0);const s=new at,o=new at,l=new at,u=new at,c=new at,h=new at,p=new at,f=new at;if(e)for(let g=0,m=e.count;g<m;g+=3){const y=e.getX(g+0),b=e.getX(g+1),v=e.getX(g+2);s.fromBufferAttribute(i,y),o.fromBufferAttribute(i,b),l.fromBufferAttribute(i,v),p.subVectors(l,o),f.subVectors(s,o),p.cross(f),u.fromBufferAttribute(n,y),c.fromBufferAttribute(n,b),h.fromBufferAttribute(n,v),u.add(p),c.add(p),h.add(p),n.setXYZ(y,u.x,u.y,u.z),n.setXYZ(b,c.x,c.y,c.z),n.setXYZ(v,h.x,h.y,h.z)}else for(let g=0,m=i.count;g<m;g+=3)s.fromBufferAttribute(i,g+0),o.fromBufferAttribute(i,g+1),l.fromBufferAttribute(i,g+2),p.subVectors(l,o),f.subVectors(s,o),p.cross(f),n.setXYZ(g+0,p.x,p.y,p.z),n.setXYZ(g+1,p.x,p.y,p.z),n.setXYZ(g+2,p.x,p.y,p.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let i=0,n=e.count;i<n;i++)Ta.fromBufferAttribute(e,i),Ta.normalize(),e.setXYZ(i,Ta.x,Ta.y,Ta.z)}toNonIndexed(){function e(u,c){const h=u.array,p=u.itemSize,f=u.normalized,g=new h.constructor(c.length*p);let m=0,y=0;for(let b=0,v=c.length;b<v;b++){u.isInterleavedBufferAttribute?m=c[b]*u.data.stride+u.offset:m=c[b]*p;for(let _=0;_<p;_++)g[y++]=h[m++]}return new Fo(g,p,f)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const i=new BG,n=this.index.array,s=this.attributes;for(const u in s){const c=s[u],h=e(c,n);i.setAttribute(u,h)}const o=this.morphAttributes;for(const u in o){const c=[],h=o[u];for(let p=0,f=h.length;p<f;p++){const g=h[p],m=e(g,n);c.push(m)}i.morphAttributes[u]=c}i.morphTargetsRelative=this.morphTargetsRelative;const l=this.groups;for(let u=0,c=l.length;u<c;u++){const h=l[u];i.addGroup(h.start,h.count,h.materialIndex)}return i}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const h in c)c[h]!==void 0&&(e[h]=c[h]);return e}e.data={attributes:{}};const i=this.index;i!==null&&(e.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});const n=this.attributes;for(const c in n){const h=n[c];e.data.attributes[c]=h.toJSON(e.data)}const s={};let o=!1;for(const c in this.morphAttributes){const h=this.morphAttributes[c],p=[];for(let f=0,g=h.length;f<g;f++){const m=h[f];p.push(m.toJSON(e.data))}p.length>0&&(s[c]=p,o=!0)}o&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);const l=this.groups;l.length>0&&(e.data.groups=JSON.parse(JSON.stringify(l)));const u=this.boundingSphere;return u!==null&&(e.data.boundingSphere={center:u.center.toArray(),radius:u.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const i={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone(i));const s=e.attributes;for(const h in s){const p=s[h];this.setAttribute(h,p.clone(i))}const o=e.morphAttributes;for(const h in o){const p=[],f=o[h];for(let g=0,m=f.length;g<m;g++)p.push(f[g].clone(i));this.morphAttributes[h]=p}this.morphTargetsRelative=e.morphTargetsRelative;const l=e.groups;for(let h=0,p=l.length;h<p;h++){const f=l[h];this.addGroup(f.start,f.count,f.materialIndex)}const u=e.boundingBox;u!==null&&(this.boundingBox=u.clone());const c=e.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}};const RO=new gs,gp=new sx,ux=new ix,IO=new at,hx=new at,dx=new at,px=new at,MS=new at,fx=new at,BO=new at,mx=new at;let pa=class extends Za{constructor(r=new Ao,e=new Nu){super(),this.isMesh=!0,this.type="Mesh",this.geometry=r,this.material=e,this.updateMorphTargets()}copy(r,e){return super.copy(r,e),r.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=r.morphTargetInfluences.slice()),r.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},r.morphTargetDictionary)),this.material=Array.isArray(r.material)?r.material.slice():r.material,this.geometry=r.geometry,this}updateMorphTargets(){const r=this.geometry.morphAttributes,e=Object.keys(r);if(e.length>0){const i=r[e[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let n=0,s=i.length;n<s;n++){const o=i[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=n}}}}getVertexPosition(r,e){const i=this.geometry,n=i.attributes.position,s=i.morphAttributes.position,o=i.morphTargetsRelative;e.fromBufferAttribute(n,r);const l=this.morphTargetInfluences;if(s&&l){fx.set(0,0,0);for(let u=0,c=s.length;u<c;u++){const h=l[u],p=s[u];h!==0&&(MS.fromBufferAttribute(p,r),o?fx.addScaledVector(MS,h):fx.addScaledVector(MS.sub(e),h))}e.add(fx)}return e}raycast(r,e){const i=this.geometry,n=this.material,s=this.matrixWorld;n!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),ux.copy(i.boundingSphere),ux.applyMatrix4(s),gp.copy(r.ray).recast(r.near),!(ux.containsPoint(gp.origin)===!1&&(gp.intersectSphere(ux,IO)===null||gp.origin.distanceToSquared(IO)>(r.far-r.near)**2))&&(RO.copy(s).invert(),gp.copy(r.ray).applyMatrix4(RO),!(i.boundingBox!==null&&gp.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(r,e,gp)))}_computeIntersections(r,e,i){let n;const s=this.geometry,o=this.material,l=s.index,u=s.attributes.position,c=s.attributes.uv,h=s.attributes.uv1,p=s.attributes.normal,f=s.groups,g=s.drawRange;if(l!==null)if(Array.isArray(o))for(let m=0,y=f.length;m<y;m++){const b=f[m],v=o[b.materialIndex],_=Math.max(b.start,g.start),T=Math.min(l.count,Math.min(b.start+b.count,g.start+g.count));for(let E=_,C=T;E<C;E+=3){const R=l.getX(E),B=l.getX(E+1),I=l.getX(E+2);n=gx(this,v,r,i,c,h,p,R,B,I),n&&(n.faceIndex=Math.floor(E/3),n.face.materialIndex=b.materialIndex,e.push(n))}}else{const m=Math.max(0,g.start),y=Math.min(l.count,g.start+g.count);for(let b=m,v=y;b<v;b+=3){const _=l.getX(b),T=l.getX(b+1),E=l.getX(b+2);n=gx(this,o,r,i,c,h,p,_,T,E),n&&(n.faceIndex=Math.floor(b/3),e.push(n))}}else if(u!==void 0)if(Array.isArray(o))for(let m=0,y=f.length;m<y;m++){const b=f[m],v=o[b.materialIndex],_=Math.max(b.start,g.start),T=Math.min(u.count,Math.min(b.start+b.count,g.start+g.count));for(let E=_,C=T;E<C;E+=3){const R=E,B=E+1,I=E+2;n=gx(this,v,r,i,c,h,p,R,B,I),n&&(n.faceIndex=Math.floor(E/3),n.face.materialIndex=b.materialIndex,e.push(n))}}else{const m=Math.max(0,g.start),y=Math.min(u.count,g.start+g.count);for(let b=m,v=y;b<v;b+=3){const _=b,T=b+1,E=b+2;n=gx(this,o,r,i,c,h,p,_,T,E),n&&(n.faceIndex=Math.floor(b/3),e.push(n))}}}};function jK(r,e,i,n,s,o,l,u){let c;if(e.side===go?c=n.intersectTriangle(l,o,s,!0,u):c=n.intersectTriangle(s,o,l,e.side===Gh,u),c===null)return null;mx.copy(u),mx.applyMatrix4(r.matrixWorld);const h=i.ray.origin.distanceTo(mx);return h<i.near||h>i.far?null:{distance:h,point:mx.clone(),object:r}}function gx(r,e,i,n,s,o,l,u,c,h){r.getVertexPosition(u,hx),r.getVertexPosition(c,dx),r.getVertexPosition(h,px);const p=jK(r,e,i,n,hx,dx,px,BO);if(p){const f=new at;fp.getBarycoord(BO,hx,dx,px,f),s&&(p.uv=fp.getInterpolatedAttribute(s,u,c,h,f,new ji)),o&&(p.uv1=fp.getInterpolatedAttribute(o,u,c,h,f,new ji)),l&&(p.normal=fp.getInterpolatedAttribute(l,u,c,h,f,new at),p.normal.dot(n.direction)>0&&p.normal.multiplyScalar(-1));const g={a:u,b:c,c:h,normal:new at,materialIndex:0};fp.getNormal(hx,dx,px,g.normal),p.face=g,p.barycoord=f}return p}let Bm=class LG extends Ao{constructor(e=1,i=1,n=1,s=1,o=1,l=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:i,depth:n,widthSegments:s,heightSegments:o,depthSegments:l};const u=this;s=Math.floor(s),o=Math.floor(o),l=Math.floor(l);const c=[],h=[],p=[],f=[];let g=0,m=0;y("z","y","x",-1,-1,n,i,e,l,o,0),y("z","y","x",1,-1,n,i,-e,l,o,1),y("x","z","y",1,1,e,n,i,s,l,2),y("x","z","y",1,-1,e,n,-i,s,l,3),y("x","y","z",1,-1,e,i,n,s,o,4),y("x","y","z",-1,-1,e,i,-n,s,o,5),this.setIndex(c),this.setAttribute("position",new Os(h,3)),this.setAttribute("normal",new Os(p,3)),this.setAttribute("uv",new Os(f,2));function y(b,v,_,T,E,C,R,B,I,N,D){const P=C/I,k=R/N,q=C/2,V=R/2,j=B/2,Q=I+1,W=N+1;let G=0,z=0;const te=new at;for(let Y=0;Y<W;Y++){const se=Y*k-V;for(let ve=0;ve<Q;ve++){const Ae=ve*P-q;te[b]=Ae*T,te[v]=se*E,te[_]=j,h.push(te.x,te.y,te.z),te[b]=0,te[v]=0,te[_]=B>0?1:-1,p.push(te.x,te.y,te.z),f.push(ve/I),f.push(1-Y/N),G+=1}}for(let Y=0;Y<N;Y++)for(let se=0;se<I;se++){const ve=g+se+Q*Y,Ae=g+se+Q*(Y+1),me=g+(se+1)+Q*(Y+1),Oe=g+(se+1)+Q*Y;c.push(ve,Ae,Oe),c.push(Ae,me,Oe),z+=6}u.addGroup(m,z,D),m+=z,g+=G}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new LG(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}};function Lm(r){const e={};for(const i in r){e[i]={};for(const n in r[i]){const s=r[i][n];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[i][n]=null):e[i][n]=s.clone():Array.isArray(s)?e[i][n]=s.slice():e[i][n]=s}}return e}function yo(r){const e={};for(let i=0;i<r.length;i++){const n=Lm(r[i]);for(const s in n)e[s]=n[s]}return e}function VK(r){const e=[];for(let i=0;i<r.length;i++)e.push(r[i].clone());return e}function LO(r){const e=r.getRenderTarget();return e===null?r.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:kn.workingColorSpace}const DO={clone:Lm,merge:yo};var GK=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,HK=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;let jc=class extends mp{static get type(){return"ShaderMaterial"}constructor(r){super(),this.isShaderMaterial=!0,this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=GK,this.fragmentShader=HK,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,r!==void 0&&this.setValues(r)}copy(r){return super.copy(r),this.fragmentShader=r.fragmentShader,this.vertexShader=r.vertexShader,this.uniforms=Lm(r.uniforms),this.uniformsGroups=VK(r.uniformsGroups),this.defines=Object.assign({},r.defines),this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.fog=r.fog,this.lights=r.lights,this.clipping=r.clipping,this.extensions=Object.assign({},r.extensions),this.glslVersion=r.glslVersion,this}toJSON(r){const e=super.toJSON(r);e.glslVersion=this.glslVersion,e.uniforms={};for(const n in this.uniforms){const s=this.uniforms[n].value;s&&s.isTexture?e.uniforms[n]={type:"t",value:s.toJSON(r).uuid}:s&&s.isColor?e.uniforms[n]={type:"c",value:s.getHex()}:s&&s.isVector2?e.uniforms[n]={type:"v2",value:s.toArray()}:s&&s.isVector3?e.uniforms[n]={type:"v3",value:s.toArray()}:s&&s.isVector4?e.uniforms[n]={type:"v4",value:s.toArray()}:s&&s.isMatrix3?e.uniforms[n]={type:"m3",value:s.toArray()}:s&&s.isMatrix4?e.uniforms[n]={type:"m4",value:s.toArray()}:e.uniforms[n]={value:s}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.lights=this.lights,e.clipping=this.clipping;const i={};for(const n in this.extensions)this.extensions[n]===!0&&(i[n]=!0);return Object.keys(i).length>0&&(e.extensions=i),e}},NO=class extends Za{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new gs,this.projectionMatrix=new gs,this.projectionMatrixInverse=new gs,this.coordinateSystem=Su}copy(r,e){return super.copy(r,e),this.matrixWorldInverse.copy(r.matrixWorldInverse),this.projectionMatrix.copy(r.projectionMatrix),this.projectionMatrixInverse.copy(r.projectionMatrixInverse),this.coordinateSystem=r.coordinateSystem,this}getWorldDirection(r){return super.getWorldDirection(r).negate()}updateMatrixWorld(r){super.updateMatrixWorld(r),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(r,e){super.updateWorldMatrix(r,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}};const $h=new at,PO=new ji,OO=new ji;let Pl=class extends NO{constructor(r=50,e=1,i=.1,n=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=r,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(r,e){return super.copy(r,e),this.fov=r.fov,this.zoom=r.zoom,this.near=r.near,this.far=r.far,this.focus=r.focus,this.aspect=r.aspect,this.view=r.view===null?null:Object.assign({},r.view),this.filmGauge=r.filmGauge,this.filmOffset=r.filmOffset,this}setFocalLength(r){const e=.5*this.getFilmHeight()/r;this.fov=hA*2*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const r=Math.tan(uA*.5*this.fov);return .5*this.getFilmHeight()/r}getEffectiveFOV(){return hA*2*Math.atan(Math.tan(uA*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(r,e,i){$h.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),e.set($h.x,$h.y).multiplyScalar(-r/$h.z),$h.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set($h.x,$h.y).multiplyScalar(-r/$h.z)}getViewSize(r,e){return this.getViewBounds(r,PO,OO),e.subVectors(OO,PO)}setViewOffset(r,e,i,n,s,o){this.aspect=r/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=r,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const r=this.near;let e=r*Math.tan(uA*.5*this.fov)/this.zoom,i=2*e,n=this.aspect*i,s=-.5*n;const o=this.view;if(this.view!==null&&this.view.enabled){const u=o.fullWidth,c=o.fullHeight;s+=o.offsetX*n/u,e-=o.offsetY*i/c,n*=o.width/u,i*=o.height/c}const l=this.filmOffset;l!==0&&(s+=r*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+n,e,e-i,r,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(r){const e=super.toJSON(r);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}};const Dm=-90,Nm=1;let WK=class extends Za{constructor(r,e,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const n=new Pl(Dm,Nm,r,e);n.layers=this.layers,this.add(n);const s=new Pl(Dm,Nm,r,e);s.layers=this.layers,this.add(s);const o=new Pl(Dm,Nm,r,e);o.layers=this.layers,this.add(o);const l=new Pl(Dm,Nm,r,e);l.layers=this.layers,this.add(l);const u=new Pl(Dm,Nm,r,e);u.layers=this.layers,this.add(u);const c=new Pl(Dm,Nm,r,e);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const r=this.coordinateSystem,e=this.children.concat(),[i,n,s,o,l,u]=e;for(const c of e)this.remove(c);if(r===Su)i.up.set(0,1,0),i.lookAt(1,0,0),n.up.set(0,1,0),n.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),l.up.set(0,1,0),l.lookAt(0,0,1),u.up.set(0,1,0),u.lookAt(0,0,-1);else if(r===Zb)i.up.set(0,-1,0),i.lookAt(-1,0,0),n.up.set(0,-1,0),n.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),l.up.set(0,-1,0),l.lookAt(0,0,1),u.up.set(0,-1,0),u.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+r);for(const c of e)this.add(c),c.updateMatrixWorld()}update(r,e){this.parent===null&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:n}=this;this.coordinateSystem!==r.coordinateSystem&&(this.coordinateSystem=r.coordinateSystem,this.updateCoordinateSystem());const[s,o,l,u,c,h]=this.children,p=r.getRenderTarget(),f=r.getActiveCubeFace(),g=r.getActiveMipmapLevel(),m=r.xr.enabled;r.xr.enabled=!1;const y=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,r.setRenderTarget(i,0,n),r.render(e,s),r.setRenderTarget(i,1,n),r.render(e,o),r.setRenderTarget(i,2,n),r.render(e,l),r.setRenderTarget(i,3,n),r.render(e,u),r.setRenderTarget(i,4,n),r.render(e,c),i.texture.generateMipmaps=y,r.setRenderTarget(i,5,n),r.render(e,h),r.setRenderTarget(p,f,g),r.xr.enabled=m,i.texture.needsPMREMUpdate=!0}},kO=class extends Dl{constructor(r,e,i,n,s,o,l,u,c,h){r=r!==void 0?r:[],e=e!==void 0?e:dm,super(r,e,i,n,s,o,l,u,c,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(r){this.image=r}},QK=class extends Qh{constructor(r=1,e={}){super(r,r,e),this.isWebGLCubeRenderTarget=!0;const i={width:r,height:r,depth:1},n=[i,i,i,i,i,i];this.texture=new kO(n,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=e.generateMipmaps!==void 0?e.generateMipmaps:!1,this.texture.minFilter=e.minFilter!==void 0?e.minFilter:Uc}fromEquirectangularTexture(r,e){this.texture.type=e.type,this.texture.colorSpace=e.colorSpace,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},n=new Bm(5,5,5),s=new jc({name:"CubemapFromEquirect",uniforms:Lm(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:go,blending:Eu});s.uniforms.tEquirect.value=e;const o=new pa(n,s),l=e.minFilter;return e.minFilter===lp&&(e.minFilter=Uc),new WK(1,10,this).update(r,o),e.minFilter=l,o.geometry.dispose(),o.material.dispose(),this}clear(r,e,i,n){const s=r.getRenderTarget();for(let o=0;o<6;o++)r.setRenderTarget(this,o),r.clear(e,i,n);r.setRenderTarget(s)}};const RS=new at,qK=new at,XK=new fn;let lc=class{constructor(r=new at(1,0,0),e=0){this.isPlane=!0,this.normal=r,this.constant=e}set(r,e){return this.normal.copy(r),this.constant=e,this}setComponents(r,e,i,n){return this.normal.set(r,e,i),this.constant=n,this}setFromNormalAndCoplanarPoint(r,e){return this.normal.copy(r),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(r,e,i){const n=RS.subVectors(i,e).cross(qK.subVectors(r,e)).normalize();return this.setFromNormalAndCoplanarPoint(n,r),this}copy(r){return this.normal.copy(r.normal),this.constant=r.constant,this}normalize(){const r=1/this.normal.length();return this.normal.multiplyScalar(r),this.constant*=r,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(r){return this.normal.dot(r)+this.constant}distanceToSphere(r){return this.distanceToPoint(r.center)-r.radius}projectPoint(r,e){return e.copy(r).addScaledVector(this.normal,-this.distanceToPoint(r))}intersectLine(r,e){const i=r.delta(RS),n=this.normal.dot(i);if(n===0)return this.distanceToPoint(r.start)===0?e.copy(r.start):null;const s=-(r.start.dot(this.normal)+this.constant)/n;return s<0||s>1?null:e.copy(r.start).addScaledVector(i,s)}intersectsLine(r){const e=this.distanceToPoint(r.start),i=this.distanceToPoint(r.end);return e<0&&i>0||i<0&&e>0}intersectsBox(r){return r.intersectsPlane(this)}intersectsSphere(r){return r.intersectsPlane(this)}coplanarPoint(r){return r.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(r,e){const i=e||XK.getNormalMatrix(r),n=this.coplanarPoint(RS).applyMatrix4(r),s=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(s),this}translate(r){return this.constant-=r.dot(this.normal),this}equals(r){return r.normal.equals(this.normal)&&r.constant===this.constant}clone(){return new this.constructor().copy(this)}};const Ap=new ix,Ax=new at;let IS=class{constructor(r=new lc,e=new lc,i=new lc,n=new lc,s=new lc,o=new lc){this.planes=[r,e,i,n,s,o]}set(r,e,i,n,s,o){const l=this.planes;return l[0].copy(r),l[1].copy(e),l[2].copy(i),l[3].copy(n),l[4].copy(s),l[5].copy(o),this}copy(r){const e=this.planes;for(let i=0;i<6;i++)e[i].copy(r.planes[i]);return this}setFromProjectionMatrix(r,e=Su){const i=this.planes,n=r.elements,s=n[0],o=n[1],l=n[2],u=n[3],c=n[4],h=n[5],p=n[6],f=n[7],g=n[8],m=n[9],y=n[10],b=n[11],v=n[12],_=n[13],T=n[14],E=n[15];if(i[0].setComponents(u-s,f-c,b-g,E-v).normalize(),i[1].setComponents(u+s,f+c,b+g,E+v).normalize(),i[2].setComponents(u+o,f+h,b+m,E+_).normalize(),i[3].setComponents(u-o,f-h,b-m,E-_).normalize(),i[4].setComponents(u-l,f-p,b-y,E-T).normalize(),e===Su)i[5].setComponents(u+l,f+p,b+y,E+T).normalize();else if(e===Zb)i[5].setComponents(l,p,y,T).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);return this}intersectsObject(r){if(r.boundingSphere!==void 0)r.boundingSphere===null&&r.computeBoundingSphere(),Ap.copy(r.boundingSphere).applyMatrix4(r.matrixWorld);else{const e=r.geometry;e.boundingSphere===null&&e.computeBoundingSphere(),Ap.copy(e.boundingSphere).applyMatrix4(r.matrixWorld)}return this.intersectsSphere(Ap)}intersectsSprite(r){return Ap.center.set(0,0,0),Ap.radius=.7071067811865476,Ap.applyMatrix4(r.matrixWorld),this.intersectsSphere(Ap)}intersectsSphere(r){const e=this.planes,i=r.center,n=-r.radius;for(let s=0;s<6;s++)if(e[s].distanceToPoint(i)<n)return!1;return!0}intersectsBox(r){const e=this.planes;for(let i=0;i<6;i++){const n=e[i];if(Ax.x=n.normal.x>0?r.max.x:r.min.x,Ax.y=n.normal.y>0?r.max.y:r.min.y,Ax.z=n.normal.z>0?r.max.z:r.min.z,n.distanceToPoint(Ax)<0)return!1}return!0}containsPoint(r){const e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(r)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};function FO(){let r=null,e=!1,i=null,n=null;function s(o,l){i(o,l),n=r.requestAnimationFrame(s)}return{start:function(){e!==!0&&i!==null&&(n=r.requestAnimationFrame(s),e=!0)},stop:function(){r.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(o){i=o},setContext:function(o){r=o}}}function YK(r){const e=new WeakMap;function i(u,c){const h=u.array,p=u.usage,f=h.byteLength,g=r.createBuffer();r.bindBuffer(c,g),r.bufferData(c,h,p),u.onUploadCallback();let m;if(h instanceof Float32Array)m=r.FLOAT;else if(h instanceof Uint16Array)u.isFloat16BufferAttribute?m=r.HALF_FLOAT:m=r.UNSIGNED_SHORT;else if(h instanceof Int16Array)m=r.SHORT;else if(h instanceof Uint32Array)m=r.UNSIGNED_INT;else if(h instanceof Int32Array)m=r.INT;else if(h instanceof Int8Array)m=r.BYTE;else if(h instanceof Uint8Array)m=r.UNSIGNED_BYTE;else if(h instanceof Uint8ClampedArray)m=r.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+h);return{buffer:g,type:m,bytesPerElement:h.BYTES_PER_ELEMENT,version:u.version,size:f}}function n(u,c,h){const p=c.array,f=c.updateRanges;if(r.bindBuffer(h,u),f.length===0)r.bufferSubData(h,0,p);else{f.sort((m,y)=>m.start-y.start);let g=0;for(let m=1;m<f.length;m++){const y=f[g],b=f[m];b.start<=y.start+y.count+1?y.count=Math.max(y.count,b.start+b.count-y.start):(++g,f[g]=b)}f.length=g+1;for(let m=0,y=f.length;m<y;m++){const b=f[m];r.bufferSubData(h,b.start*p.BYTES_PER_ELEMENT,p,b.start,b.count)}c.clearUpdateRanges()}c.onUploadCallback()}function s(u){return u.isInterleavedBufferAttribute&&(u=u.data),e.get(u)}function o(u){u.isInterleavedBufferAttribute&&(u=u.data);const c=e.get(u);c&&(r.deleteBuffer(c.buffer),e.delete(u))}function l(u,c){if(u.isInterleavedBufferAttribute&&(u=u.data),u.isGLBufferAttribute){const p=e.get(u);(!p||p.version<u.version)&&e.set(u,{buffer:u.buffer,type:u.type,bytesPerElement:u.elementSize,version:u.version});return}const h=e.get(u);if(h===void 0)e.set(u,i(u,c));else if(h.version<u.version){if(h.size!==u.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");n(h.buffer,u,c),h.version=u.version}}return{get:s,remove:o,update:l}}class vA extends Ao{constructor(e=1,i=1,n=1,s=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:i,widthSegments:n,heightSegments:s};const o=e/2,l=i/2,u=Math.floor(n),c=Math.floor(s),h=u+1,p=c+1,f=e/u,g=i/c,m=[],y=[],b=[],v=[];for(let _=0;_<p;_++){const T=_*g-l;for(let E=0;E<h;E++){const C=E*f-o;y.push(C,-T,0),b.push(0,0,1),v.push(E/u),v.push(1-_/c)}}for(let _=0;_<c;_++)for(let T=0;T<u;T++){const E=T+h*_,C=T+h*(_+1),R=T+1+h*(_+1),B=T+1+h*_;m.push(E,C,B),m.push(C,R,B)}this.setIndex(m),this.setAttribute("position",new Os(y,3)),this.setAttribute("normal",new Os(b,3)),this.setAttribute("uv",new Os(v,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new vA(e.width,e.height,e.widthSegments,e.heightSegments)}}var KK=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,JK=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,ZK=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,$K=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,eJ=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,tJ=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,iJ=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,rJ=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,nJ=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,sJ=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,aJ=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,oJ=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,lJ=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,cJ=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,uJ=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,hJ=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,dJ=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,pJ=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,fJ=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,mJ=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,gJ=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,AJ=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,yJ=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,vJ=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,bJ=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,xJ=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,_J=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,EJ=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,wJ=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,CJ=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,SJ="gl_FragColor = linearToOutputTexel( gl_FragColor );",TJ=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,MJ=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,RJ=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,IJ=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,BJ=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,LJ=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,DJ=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,NJ=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,PJ=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,OJ=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,kJ=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,FJ=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,UJ=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,zJ=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,jJ=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,VJ=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,GJ=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,HJ=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,WJ=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,QJ=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,qJ=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,XJ=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,YJ=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,KJ=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,JJ=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,ZJ=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,$J=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,eZ=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,tZ=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,iZ=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,rZ=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,nZ=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,sZ=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,aZ=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,oZ=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,lZ=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,cZ=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,uZ=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,hZ=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,dZ=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,pZ=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,fZ=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,mZ=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,gZ=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,AZ=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,yZ=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,vZ=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,bZ=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,xZ=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,_Z=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,EZ=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,wZ=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,CZ=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,SZ=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,TZ=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,MZ=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,RZ=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,IZ=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,BZ=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,LZ=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,DZ=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,NZ=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,PZ=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,OZ=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,kZ=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,FZ=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,UZ=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,zZ=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,jZ=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,VZ=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,GZ=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,HZ=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
		
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
		
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		
		#else
		
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,WZ=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,QZ=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,qZ=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,XZ=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const YZ=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,KZ=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,JZ=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,ZZ=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,$Z=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,e$=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,t$=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,i$=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,r$=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,n$=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,s$=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,a$=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,o$=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,l$=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,c$=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,u$=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,h$=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,d$=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,p$=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,f$=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,m$=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,g$=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,A$=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,y$=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,v$=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,b$=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,x$=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,_$=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,E$=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,w$=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,C$=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,S$=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,T$=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,M$=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,cn={alphahash_fragment:KK,alphahash_pars_fragment:JK,alphamap_fragment:ZK,alphamap_pars_fragment:$K,alphatest_fragment:eJ,alphatest_pars_fragment:tJ,aomap_fragment:iJ,aomap_pars_fragment:rJ,batching_pars_vertex:nJ,batching_vertex:sJ,begin_vertex:aJ,beginnormal_vertex:oJ,bsdfs:lJ,iridescence_fragment:cJ,bumpmap_pars_fragment:uJ,clipping_planes_fragment:hJ,clipping_planes_pars_fragment:dJ,clipping_planes_pars_vertex:pJ,clipping_planes_vertex:fJ,color_fragment:mJ,color_pars_fragment:gJ,color_pars_vertex:AJ,color_vertex:yJ,common:vJ,cube_uv_reflection_fragment:bJ,defaultnormal_vertex:xJ,displacementmap_pars_vertex:_J,displacementmap_vertex:EJ,emissivemap_fragment:wJ,emissivemap_pars_fragment:CJ,colorspace_fragment:SJ,colorspace_pars_fragment:TJ,envmap_fragment:MJ,envmap_common_pars_fragment:RJ,envmap_pars_fragment:IJ,envmap_pars_vertex:BJ,envmap_physical_pars_fragment:VJ,envmap_vertex:LJ,fog_vertex:DJ,fog_pars_vertex:NJ,fog_fragment:PJ,fog_pars_fragment:OJ,gradientmap_pars_fragment:kJ,lightmap_pars_fragment:FJ,lights_lambert_fragment:UJ,lights_lambert_pars_fragment:zJ,lights_pars_begin:jJ,lights_toon_fragment:GJ,lights_toon_pars_fragment:HJ,lights_phong_fragment:WJ,lights_phong_pars_fragment:QJ,lights_physical_fragment:qJ,lights_physical_pars_fragment:XJ,lights_fragment_begin:YJ,lights_fragment_maps:KJ,lights_fragment_end:JJ,logdepthbuf_fragment:ZJ,logdepthbuf_pars_fragment:$J,logdepthbuf_pars_vertex:eZ,logdepthbuf_vertex:tZ,map_fragment:iZ,map_pars_fragment:rZ,map_particle_fragment:nZ,map_particle_pars_fragment:sZ,metalnessmap_fragment:aZ,metalnessmap_pars_fragment:oZ,morphinstance_vertex:lZ,morphcolor_vertex:cZ,morphnormal_vertex:uZ,morphtarget_pars_vertex:hZ,morphtarget_vertex:dZ,normal_fragment_begin:pZ,normal_fragment_maps:fZ,normal_pars_fragment:mZ,normal_pars_vertex:gZ,normal_vertex:AZ,normalmap_pars_fragment:yZ,clearcoat_normal_fragment_begin:vZ,clearcoat_normal_fragment_maps:bZ,clearcoat_pars_fragment:xZ,iridescence_pars_fragment:_Z,opaque_fragment:EZ,packing:wZ,premultiplied_alpha_fragment:CZ,project_vertex:SZ,dithering_fragment:TZ,dithering_pars_fragment:MZ,roughnessmap_fragment:RZ,roughnessmap_pars_fragment:IZ,shadowmap_pars_fragment:BZ,shadowmap_pars_vertex:LZ,shadowmap_vertex:DZ,shadowmask_pars_fragment:NZ,skinbase_vertex:PZ,skinning_pars_vertex:OZ,skinning_vertex:kZ,skinnormal_vertex:FZ,specularmap_fragment:UZ,specularmap_pars_fragment:zZ,tonemapping_fragment:jZ,tonemapping_pars_fragment:VZ,transmission_fragment:GZ,transmission_pars_fragment:HZ,uv_pars_fragment:WZ,uv_pars_vertex:QZ,uv_vertex:qZ,worldpos_vertex:XZ,background_vert:YZ,background_frag:KZ,backgroundCube_vert:JZ,backgroundCube_frag:ZZ,cube_vert:$Z,cube_frag:e$,depth_vert:t$,depth_frag:i$,distanceRGBA_vert:r$,distanceRGBA_frag:n$,equirect_vert:s$,equirect_frag:a$,linedashed_vert:o$,linedashed_frag:l$,meshbasic_vert:c$,meshbasic_frag:u$,meshlambert_vert:h$,meshlambert_frag:d$,meshmatcap_vert:p$,meshmatcap_frag:f$,meshnormal_vert:m$,meshnormal_frag:g$,meshphong_vert:A$,meshphong_frag:y$,meshphysical_vert:v$,meshphysical_frag:b$,meshtoon_vert:x$,meshtoon_frag:_$,points_vert:E$,points_frag:w$,shadow_vert:C$,shadow_frag:S$,sprite_vert:T$,sprite_frag:M$},Xi={common:{diffuse:{value:new Cn(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new fn},alphaMap:{value:null},alphaMapTransform:{value:new fn},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new fn}},envmap:{envMap:{value:null},envMapRotation:{value:new fn},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new fn}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new fn}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new fn},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new fn},normalScale:{value:new ji(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new fn},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new fn}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new fn}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new fn}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Cn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Cn(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new fn},alphaTest:{value:0},uvTransform:{value:new fn}},sprite:{diffuse:{value:new Cn(16777215)},opacity:{value:1},center:{value:new ji(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new fn},alphaMap:{value:null},alphaMapTransform:{value:new fn},alphaTest:{value:0}}},Vc={basic:{uniforms:yo([Xi.common,Xi.specularmap,Xi.envmap,Xi.aomap,Xi.lightmap,Xi.fog]),vertexShader:cn.meshbasic_vert,fragmentShader:cn.meshbasic_frag},lambert:{uniforms:yo([Xi.common,Xi.specularmap,Xi.envmap,Xi.aomap,Xi.lightmap,Xi.emissivemap,Xi.bumpmap,Xi.normalmap,Xi.displacementmap,Xi.fog,Xi.lights,{emissive:{value:new Cn(0)}}]),vertexShader:cn.meshlambert_vert,fragmentShader:cn.meshlambert_frag},phong:{uniforms:yo([Xi.common,Xi.specularmap,Xi.envmap,Xi.aomap,Xi.lightmap,Xi.emissivemap,Xi.bumpmap,Xi.normalmap,Xi.displacementmap,Xi.fog,Xi.lights,{emissive:{value:new Cn(0)},specular:{value:new Cn(1118481)},shininess:{value:30}}]),vertexShader:cn.meshphong_vert,fragmentShader:cn.meshphong_frag},standard:{uniforms:yo([Xi.common,Xi.envmap,Xi.aomap,Xi.lightmap,Xi.emissivemap,Xi.bumpmap,Xi.normalmap,Xi.displacementmap,Xi.roughnessmap,Xi.metalnessmap,Xi.fog,Xi.lights,{emissive:{value:new Cn(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:cn.meshphysical_vert,fragmentShader:cn.meshphysical_frag},toon:{uniforms:yo([Xi.common,Xi.aomap,Xi.lightmap,Xi.emissivemap,Xi.bumpmap,Xi.normalmap,Xi.displacementmap,Xi.gradientmap,Xi.fog,Xi.lights,{emissive:{value:new Cn(0)}}]),vertexShader:cn.meshtoon_vert,fragmentShader:cn.meshtoon_frag},matcap:{uniforms:yo([Xi.common,Xi.bumpmap,Xi.normalmap,Xi.displacementmap,Xi.fog,{matcap:{value:null}}]),vertexShader:cn.meshmatcap_vert,fragmentShader:cn.meshmatcap_frag},points:{uniforms:yo([Xi.points,Xi.fog]),vertexShader:cn.points_vert,fragmentShader:cn.points_frag},dashed:{uniforms:yo([Xi.common,Xi.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:cn.linedashed_vert,fragmentShader:cn.linedashed_frag},depth:{uniforms:yo([Xi.common,Xi.displacementmap]),vertexShader:cn.depth_vert,fragmentShader:cn.depth_frag},normal:{uniforms:yo([Xi.common,Xi.bumpmap,Xi.normalmap,Xi.displacementmap,{opacity:{value:1}}]),vertexShader:cn.meshnormal_vert,fragmentShader:cn.meshnormal_frag},sprite:{uniforms:yo([Xi.sprite,Xi.fog]),vertexShader:cn.sprite_vert,fragmentShader:cn.sprite_frag},background:{uniforms:{uvTransform:{value:new fn},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:cn.background_vert,fragmentShader:cn.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new fn}},vertexShader:cn.backgroundCube_vert,fragmentShader:cn.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:cn.cube_vert,fragmentShader:cn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:cn.equirect_vert,fragmentShader:cn.equirect_frag},distanceRGBA:{uniforms:yo([Xi.common,Xi.displacementmap,{referencePosition:{value:new at},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:cn.distanceRGBA_vert,fragmentShader:cn.distanceRGBA_frag},shadow:{uniforms:yo([Xi.lights,Xi.fog,{color:{value:new Cn(0)},opacity:{value:1}}]),vertexShader:cn.shadow_vert,fragmentShader:cn.shadow_frag}};Vc.physical={uniforms:yo([Vc.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new fn},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new fn},clearcoatNormalScale:{value:new ji(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new fn},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new fn},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new fn},sheen:{value:0},sheenColor:{value:new Cn(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new fn},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new fn},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new fn},transmissionSamplerSize:{value:new ji},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new fn},attenuationDistance:{value:0},attenuationColor:{value:new Cn(0)},specularColor:{value:new Cn(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new fn},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new fn},anisotropyVector:{value:new ji},anisotropyMap:{value:null},anisotropyMapTransform:{value:new fn}}]),vertexShader:cn.meshphysical_vert,fragmentShader:cn.meshphysical_frag};const yx={r:0,b:0,g:0},yp=new Jh,R$=new gs;function I$(r,e,i,n,s,o,l){const u=new Cn(0);let c=o===!0?0:1,h,p,f=null,g=0,m=null;function y(T){let E=T.isScene===!0?T.background:null;return E&&E.isTexture&&(E=(T.backgroundBlurriness>0?i:e).get(E)),E}function b(T){let E=!1;const C=y(T);C===null?_(u,c):C&&C.isColor&&(_(C,1),E=!0);const R=r.xr.getEnvironmentBlendMode();R==="additive"?n.buffers.color.setClear(0,0,0,1,l):R==="alpha-blend"&&n.buffers.color.setClear(0,0,0,0,l),(r.autoClear||E)&&(n.buffers.depth.setTest(!0),n.buffers.depth.setMask(!0),n.buffers.color.setMask(!0),r.clear(r.autoClearColor,r.autoClearDepth,r.autoClearStencil))}function v(T,E){const C=y(E);C&&(C.isCubeTexture||C.mapping===Hb)?(p===void 0&&(p=new pa(new Bm(1,1,1),new jc({name:"BackgroundCubeMaterial",uniforms:Lm(Vc.backgroundCube.uniforms),vertexShader:Vc.backgroundCube.vertexShader,fragmentShader:Vc.backgroundCube.fragmentShader,side:go,depthTest:!1,depthWrite:!1,fog:!1})),p.geometry.deleteAttribute("normal"),p.geometry.deleteAttribute("uv"),p.onBeforeRender=function(R,B,I){this.matrixWorld.copyPosition(I.matrixWorld)},Object.defineProperty(p.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(p)),yp.copy(E.backgroundRotation),yp.x*=-1,yp.y*=-1,yp.z*=-1,C.isCubeTexture&&C.isRenderTargetTexture===!1&&(yp.y*=-1,yp.z*=-1),p.material.uniforms.envMap.value=C,p.material.uniforms.flipEnvMap.value=C.isCubeTexture&&C.isRenderTargetTexture===!1?-1:1,p.material.uniforms.backgroundBlurriness.value=E.backgroundBlurriness,p.material.uniforms.backgroundIntensity.value=E.backgroundIntensity,p.material.uniforms.backgroundRotation.value.setFromMatrix4(R$.makeRotationFromEuler(yp)),p.material.toneMapped=kn.getTransfer(C.colorSpace)!==as,(f!==C||g!==C.version||m!==r.toneMapping)&&(p.material.needsUpdate=!0,f=C,g=C.version,m=r.toneMapping),p.layers.enableAll(),T.unshift(p,p.geometry,p.material,0,0,null)):C&&C.isTexture&&(h===void 0&&(h=new pa(new vA(2,2),new jc({name:"BackgroundMaterial",uniforms:Lm(Vc.background.uniforms),vertexShader:Vc.background.vertexShader,fragmentShader:Vc.background.fragmentShader,side:Gh,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),Object.defineProperty(h.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(h)),h.material.uniforms.t2D.value=C,h.material.uniforms.backgroundIntensity.value=E.backgroundIntensity,h.material.toneMapped=kn.getTransfer(C.colorSpace)!==as,C.matrixAutoUpdate===!0&&C.updateMatrix(),h.material.uniforms.uvTransform.value.copy(C.matrix),(f!==C||g!==C.version||m!==r.toneMapping)&&(h.material.needsUpdate=!0,f=C,g=C.version,m=r.toneMapping),h.layers.enableAll(),T.unshift(h,h.geometry,h.material,0,0,null))}function _(T,E){T.getRGB(yx,LO(r)),n.buffers.color.setClear(yx.r,yx.g,yx.b,E,l)}return{getClearColor:function(){return u},setClearColor:function(T,E=1){u.set(T),c=E,_(u,c)},getClearAlpha:function(){return c},setClearAlpha:function(T){c=T,_(u,c)},render:b,addToRenderList:v}}function B$(r,e){const i=r.getParameter(r.MAX_VERTEX_ATTRIBS),n={},s=g(null);let o=s,l=!1;function u(P,k,q,V,j){let Q=!1;const W=f(V,q,k);o!==W&&(o=W,h(o.object)),Q=m(P,V,q,j),Q&&y(P,V,q,j),j!==null&&e.update(j,r.ELEMENT_ARRAY_BUFFER),(Q||l)&&(l=!1,C(P,k,q,V),j!==null&&r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e.get(j).buffer))}function c(){return r.createVertexArray()}function h(P){return r.bindVertexArray(P)}function p(P){return r.deleteVertexArray(P)}function f(P,k,q){const V=q.wireframe===!0;let j=n[P.id];j===void 0&&(j={},n[P.id]=j);let Q=j[k.id];Q===void 0&&(Q={},j[k.id]=Q);let W=Q[V];return W===void 0&&(W=g(c()),Q[V]=W),W}function g(P){const k=[],q=[],V=[];for(let j=0;j<i;j++)k[j]=0,q[j]=0,V[j]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:k,enabledAttributes:q,attributeDivisors:V,object:P,attributes:{},index:null}}function m(P,k,q,V){const j=o.attributes,Q=k.attributes;let W=0;const G=q.getAttributes();for(const z in G)if(G[z].location>=0){const te=j[z];let Y=Q[z];if(Y===void 0&&(z==="instanceMatrix"&&P.instanceMatrix&&(Y=P.instanceMatrix),z==="instanceColor"&&P.instanceColor&&(Y=P.instanceColor)),te===void 0||te.attribute!==Y||Y&&te.data!==Y.data)return!0;W++}return o.attributesNum!==W||o.index!==V}function y(P,k,q,V){const j={},Q=k.attributes;let W=0;const G=q.getAttributes();for(const z in G)if(G[z].location>=0){let te=Q[z];te===void 0&&(z==="instanceMatrix"&&P.instanceMatrix&&(te=P.instanceMatrix),z==="instanceColor"&&P.instanceColor&&(te=P.instanceColor));const Y={};Y.attribute=te,te&&te.data&&(Y.data=te.data),j[z]=Y,W++}o.attributes=j,o.attributesNum=W,o.index=V}function b(){const P=o.newAttributes;for(let k=0,q=P.length;k<q;k++)P[k]=0}function v(P){_(P,0)}function _(P,k){const q=o.newAttributes,V=o.enabledAttributes,j=o.attributeDivisors;q[P]=1,V[P]===0&&(r.enableVertexAttribArray(P),V[P]=1),j[P]!==k&&(r.vertexAttribDivisor(P,k),j[P]=k)}function T(){const P=o.newAttributes,k=o.enabledAttributes;for(let q=0,V=k.length;q<V;q++)k[q]!==P[q]&&(r.disableVertexAttribArray(q),k[q]=0)}function E(P,k,q,V,j,Q,W){W===!0?r.vertexAttribIPointer(P,k,q,j,Q):r.vertexAttribPointer(P,k,q,V,j,Q)}function C(P,k,q,V){b();const j=V.attributes,Q=q.getAttributes(),W=k.defaultAttributeValues;for(const G in Q){const z=Q[G];if(z.location>=0){let te=j[G];if(te===void 0&&(G==="instanceMatrix"&&P.instanceMatrix&&(te=P.instanceMatrix),G==="instanceColor"&&P.instanceColor&&(te=P.instanceColor)),te!==void 0){const Y=te.normalized,se=te.itemSize,ve=e.get(te);if(ve===void 0)continue;const Ae=ve.buffer,me=ve.type,Oe=ve.bytesPerElement,Xe=me===r.INT||me===r.UNSIGNED_INT||te.gpuType===MC;if(te.isInterleavedBufferAttribute){const Je=te.data,it=Je.stride,dt=te.offset;if(Je.isInstancedInterleavedBuffer){for(let St=0;St<z.locationSize;St++)_(z.location+St,Je.meshPerAttribute);P.isInstancedMesh!==!0&&V._maxInstanceCount===void 0&&(V._maxInstanceCount=Je.meshPerAttribute*Je.count)}else for(let St=0;St<z.locationSize;St++)v(z.location+St);r.bindBuffer(r.ARRAY_BUFFER,Ae);for(let St=0;St<z.locationSize;St++)E(z.location+St,se/z.locationSize,me,Y,it*Oe,(dt+se/z.locationSize*St)*Oe,Xe)}else{if(te.isInstancedBufferAttribute){for(let Je=0;Je<z.locationSize;Je++)_(z.location+Je,te.meshPerAttribute);P.isInstancedMesh!==!0&&V._maxInstanceCount===void 0&&(V._maxInstanceCount=te.meshPerAttribute*te.count)}else for(let Je=0;Je<z.locationSize;Je++)v(z.location+Je);r.bindBuffer(r.ARRAY_BUFFER,Ae);for(let Je=0;Je<z.locationSize;Je++)E(z.location+Je,se/z.locationSize,me,Y,se*Oe,se/z.locationSize*Je*Oe,Xe)}}else if(W!==void 0){const Y=W[G];if(Y!==void 0)switch(Y.length){case 2:r.vertexAttrib2fv(z.location,Y);break;case 3:r.vertexAttrib3fv(z.location,Y);break;case 4:r.vertexAttrib4fv(z.location,Y);break;default:r.vertexAttrib1fv(z.location,Y)}}}}T()}function R(){N();for(const P in n){const k=n[P];for(const q in k){const V=k[q];for(const j in V)p(V[j].object),delete V[j];delete k[q]}delete n[P]}}function B(P){if(n[P.id]===void 0)return;const k=n[P.id];for(const q in k){const V=k[q];for(const j in V)p(V[j].object),delete V[j];delete k[q]}delete n[P.id]}function I(P){for(const k in n){const q=n[k];if(q[P.id]===void 0)continue;const V=q[P.id];for(const j in V)p(V[j].object),delete V[j];delete q[P.id]}}function N(){D(),l=!0,o!==s&&(o=s,h(o.object))}function D(){s.geometry=null,s.program=null,s.wireframe=!1}return{setup:u,reset:N,resetDefaultState:D,dispose:R,releaseStatesOfGeometry:B,releaseStatesOfProgram:I,initAttributes:b,enableAttribute:v,disableUnusedAttributes:T}}function L$(r,e,i){let n;function s(h){n=h}function o(h,p){r.drawArrays(n,h,p),i.update(p,n,1)}function l(h,p,f){f!==0&&(r.drawArraysInstanced(n,h,p,f),i.update(p,n,f))}function u(h,p,f){if(f===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(n,h,0,p,0,f);let g=0;for(let m=0;m<f;m++)g+=p[m];i.update(g,n,1)}function c(h,p,f,g){if(f===0)return;const m=e.get("WEBGL_multi_draw");if(m===null)for(let y=0;y<h.length;y++)l(h[y],p[y],g[y]);else{m.multiDrawArraysInstancedWEBGL(n,h,0,p,0,g,0,f);let y=0;for(let b=0;b<f;b++)y+=p[b]*g[b];i.update(y,n,1)}}this.setMode=s,this.render=o,this.renderInstances=l,this.renderMultiDraw=u,this.renderMultiDrawInstances=c}function D$(r,e,i,n){let s;function o(){if(s!==void 0)return s;if(e.has("EXT_texture_filter_anisotropic")===!0){const I=e.get("EXT_texture_filter_anisotropic");s=r.getParameter(I.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else s=0;return s}function l(I){return!(I!==rc&&n.convert(I)!==r.getParameter(r.IMPLEMENTATION_COLOR_READ_FORMAT))}function u(I){const N=I===fm&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(I!==wu&&n.convert(I)!==r.getParameter(r.IMPLEMENTATION_COLOR_READ_TYPE)&&I!==Cu&&!N)}function c(I){if(I==="highp"){if(r.getShaderPrecisionFormat(r.VERTEX_SHADER,r.HIGH_FLOAT).precision>0&&r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT).precision>0)return"highp";I="mediump"}return I==="mediump"&&r.getShaderPrecisionFormat(r.VERTEX_SHADER,r.MEDIUM_FLOAT).precision>0&&r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let h=i.precision!==void 0?i.precision:"highp";const p=c(h);p!==h&&(console.warn("THREE.WebGLRenderer:",h,"not supported, using",p,"instead."),h=p);const f=i.logarithmicDepthBuffer===!0,g=i.reverseDepthBuffer===!0&&e.has("EXT_clip_control"),m=r.getParameter(r.MAX_TEXTURE_IMAGE_UNITS),y=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS),b=r.getParameter(r.MAX_TEXTURE_SIZE),v=r.getParameter(r.MAX_CUBE_MAP_TEXTURE_SIZE),_=r.getParameter(r.MAX_VERTEX_ATTRIBS),T=r.getParameter(r.MAX_VERTEX_UNIFORM_VECTORS),E=r.getParameter(r.MAX_VARYING_VECTORS),C=r.getParameter(r.MAX_FRAGMENT_UNIFORM_VECTORS),R=y>0,B=r.getParameter(r.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:o,getMaxPrecision:c,textureFormatReadable:l,textureTypeReadable:u,precision:h,logarithmicDepthBuffer:f,reverseDepthBuffer:g,maxTextures:m,maxVertexTextures:y,maxTextureSize:b,maxCubemapSize:v,maxAttributes:_,maxVertexUniforms:T,maxVaryings:E,maxFragmentUniforms:C,vertexTextures:R,maxSamples:B}}function N$(r){const e=this;let i=null,n=0,s=!1,o=!1;const l=new lc,u=new fn,c={value:null,needsUpdate:!1};this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(f,g){const m=f.length!==0||g||n!==0||s;return s=g,n=f.length,m},this.beginShadows=function(){o=!0,p(null)},this.endShadows=function(){o=!1},this.setGlobalState=function(f,g){i=p(f,g,0)},this.setState=function(f,g,m){const y=f.clippingPlanes,b=f.clipIntersection,v=f.clipShadows,_=r.get(f);if(!s||y===null||y.length===0||o&&!v)o?p(null):h();else{const T=o?0:n,E=T*4;let C=_.clippingState||null;c.value=C,C=p(y,g,E,m);for(let R=0;R!==E;++R)C[R]=i[R];_.clippingState=C,this.numIntersection=b?this.numPlanes:0,this.numPlanes+=T}};function h(){c.value!==i&&(c.value=i,c.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function p(f,g,m,y){const b=f!==null?f.length:0;let v=null;if(b!==0){if(v=c.value,y!==!0||v===null){const _=m+b*4,T=g.matrixWorldInverse;u.getNormalMatrix(T),(v===null||v.length<_)&&(v=new Float32Array(_));for(let E=0,C=m;E!==b;++E,C+=4)l.copy(f[E]).applyMatrix4(T,u),l.normal.toArray(v,C),v[C+3]=l.constant}c.value=v,c.needsUpdate=!0}return e.numPlanes=b,e.numIntersection=0,v}}function P$(r){let e=new WeakMap;function i(l,u){return u===EC?l.mapping=dm:u===wC&&(l.mapping=pm),l}function n(l){if(l&&l.isTexture){const u=l.mapping;if(u===EC||u===wC)if(e.has(l)){const c=e.get(l).texture;return i(c,l.mapping)}else{const c=l.image;if(c&&c.height>0){const h=new QK(c.height);return h.fromEquirectangularTexture(r,l),e.set(l,h),l.addEventListener("dispose",s),i(h.texture,l.mapping)}else return null}}return l}function s(l){const u=l.target;u.removeEventListener("dispose",s);const c=e.get(u);c!==void 0&&(e.delete(u),c.dispose())}function o(){e=new WeakMap}return{get:n,dispose:o}}let BS=class extends NO{constructor(r=-1,e=1,i=1,n=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=r,this.right=e,this.top=i,this.bottom=n,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(r,e){return super.copy(r,e),this.left=r.left,this.right=r.right,this.top=r.top,this.bottom=r.bottom,this.near=r.near,this.far=r.far,this.zoom=r.zoom,this.view=r.view===null?null:Object.assign({},r.view),this}setViewOffset(r,e,i,n,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=r,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const r=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let s=i-r,o=i+r,l=n+e,u=n-e;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=c*this.view.offsetX,o=s+c*this.view.width,l-=h*this.view.offsetY,u=l-h*this.view.height}this.projectionMatrix.makeOrthographic(s,o,l,u,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(r){const e=super.toJSON(r);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}};const Pm=4,UO=[.125,.215,.35,.446,.526,.582],vp=20,LS=new BS,zO=new Cn;let DS=null,NS=0,PS=0,OS=!1;const bp=(1+Math.sqrt(5))/2,Om=1/bp,jO=[new at(-bp,Om,0),new at(bp,Om,0),new at(-Om,0,bp),new at(Om,0,bp),new at(0,bp,-Om),new at(0,bp,Om),new at(-1,1,-1),new at(1,1,-1),new at(-1,1,1),new at(1,1,1)];let VO=class{constructor(r){this._renderer=r,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(r,e=0,i=.1,n=100){DS=this._renderer.getRenderTarget(),NS=this._renderer.getActiveCubeFace(),PS=this._renderer.getActiveMipmapLevel(),OS=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(r,i,n,s),e>0&&this._blur(s,0,0,e),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(r,e=null){return this._fromTexture(r,e)}fromCubemap(r,e=null){return this._fromTexture(r,e)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=WO(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=HO(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(r){this._lodMax=Math.floor(Math.log2(r)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let r=0;r<this._lodPlanes.length;r++)this._lodPlanes[r].dispose()}_cleanup(r){this._renderer.setRenderTarget(DS,NS,PS),this._renderer.xr.enabled=OS,r.scissorTest=!1,vx(r,0,0,r.width,r.height)}_fromTexture(r,e){r.mapping===dm||r.mapping===pm?this._setSize(r.image.length===0?16:r.image[0].width||r.image[0].image.width):this._setSize(r.image.width/4),DS=this._renderer.getRenderTarget(),NS=this._renderer.getActiveCubeFace(),PS=this._renderer.getActiveMipmapLevel(),OS=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const i=e||this._allocateTargets();return this._textureToCubeUV(r,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const r=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,i={magFilter:Uc,minFilter:Uc,generateMipmaps:!1,type:fm,format:rc,colorSpace:ym,depthBuffer:!1},n=GO(r,e,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==r||this._pingPongRenderTarget.height!==e){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=GO(r,e,i);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=O$(s)),this._blurMaterial=k$(s,r,e)}return n}_compileMaterial(r){const e=new pa(this._lodPlanes[0],r);this._renderer.compile(e,LS)}_sceneToCubeUV(r,e,i,n){const s=new Pl(90,1,e,i),o=[1,-1,1,1,1,1],l=[1,1,1,-1,-1,-1],u=this._renderer,c=u.autoClear,h=u.toneMapping;u.getClearColor(zO),u.toneMapping=Hh,u.autoClear=!1;const p=new Nu({name:"PMREM.Background",side:go,depthWrite:!1,depthTest:!1}),f=new pa(new Bm,p);let g=!1;const m=r.background;m?m.isColor&&(p.color.copy(m),r.background=null,g=!0):(p.color.copy(zO),g=!0);for(let y=0;y<6;y++){const b=y%3;b===0?(s.up.set(0,o[y],0),s.lookAt(l[y],0,0)):b===1?(s.up.set(0,0,o[y]),s.lookAt(0,l[y],0)):(s.up.set(0,o[y],0),s.lookAt(0,0,l[y]));const v=this._cubeSize;vx(n,b*v,y>2?v:0,v,v),u.setRenderTarget(n),g&&u.render(f,s),u.render(r,s)}f.geometry.dispose(),f.material.dispose(),u.toneMapping=h,u.autoClear=c,r.background=m}_textureToCubeUV(r,e){const i=this._renderer,n=r.mapping===dm||r.mapping===pm;n?(this._cubemapMaterial===null&&(this._cubemapMaterial=WO()),this._cubemapMaterial.uniforms.flipEnvMap.value=r.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=HO());const s=n?this._cubemapMaterial:this._equirectMaterial,o=new pa(this._lodPlanes[0],s),l=s.uniforms;l.envMap.value=r;const u=this._cubeSize;vx(e,0,0,3*u,2*u),i.setRenderTarget(e),i.render(o,LS)}_applyPMREM(r){const e=this._renderer,i=e.autoClear;e.autoClear=!1;const n=this._lodPlanes.length;for(let s=1;s<n;s++){const o=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),l=jO[(n-s-1)%jO.length];this._blur(r,s-1,s,o,l)}e.autoClear=i}_blur(r,e,i,n,s){const o=this._pingPongRenderTarget;this._halfBlur(r,o,e,i,n,"latitudinal",s),this._halfBlur(o,r,i,i,n,"longitudinal",s)}_halfBlur(r,e,i,n,s,o,l){const u=this._renderer,c=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const h=3,p=new pa(this._lodPlanes[n],c),f=c.uniforms,g=this._sizeLods[i]-1,m=isFinite(s)?Math.PI/(2*g):2*Math.PI/(2*vp-1),y=s/m,b=isFinite(s)?1+Math.floor(h*y):vp;b>vp&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${b} samples when the maximum is set to ${vp}`);const v=[];let _=0;for(let B=0;B<vp;++B){const I=B/y,N=Math.exp(-I*I/2);v.push(N),B===0?_+=N:B<b&&(_+=2*N)}for(let B=0;B<v.length;B++)v[B]=v[B]/_;f.envMap.value=r.texture,f.samples.value=b,f.weights.value=v,f.latitudinal.value=o==="latitudinal",l&&(f.poleAxis.value=l);const{_lodMax:T}=this;f.dTheta.value=m,f.mipInt.value=T-i;const E=this._sizeLods[n],C=3*E*(n>T-Pm?n-T+Pm:0),R=4*(this._cubeSize-E);vx(e,C,R,3*E,2*E),u.setRenderTarget(e),u.render(p,LS)}};function O$(r){const e=[],i=[],n=[];let s=r;const o=r-Pm+1+UO.length;for(let l=0;l<o;l++){const u=Math.pow(2,s);i.push(u);let c=1/u;l>r-Pm?c=UO[l-r+Pm-1]:l===0&&(c=0),n.push(c);const h=1/(u-2),p=-h,f=1+h,g=[p,p,f,p,f,f,p,p,f,f,p,f],m=6,y=6,b=3,v=2,_=1,T=new Float32Array(b*y*m),E=new Float32Array(v*y*m),C=new Float32Array(_*y*m);for(let B=0;B<m;B++){const I=B%3*2/3-1,N=B>2?0:-1,D=[I,N,0,I+2/3,N,0,I+2/3,N+1,0,I,N,0,I+2/3,N+1,0,I,N+1,0];T.set(D,b*y*B),E.set(g,v*y*B);const P=[B,B,B,B,B,B];C.set(P,_*y*B)}const R=new Ao;R.setAttribute("position",new Fo(T,b)),R.setAttribute("uv",new Fo(E,v)),R.setAttribute("faceIndex",new Fo(C,_)),e.push(R),s>Pm&&s--}return{lodPlanes:e,sizeLods:i,sigmas:n}}function GO(r,e,i){const n=new Qh(r,e,i);return n.texture.mapping=Hb,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function vx(r,e,i,n,s){r.viewport.set(e,i,n,s),r.scissor.set(e,i,n,s)}function k$(r,e,i){const n=new Float32Array(vp),s=new at(0,1,0);return new jc({name:"SphericalGaussianBlur",defines:{n:vp,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${r}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:s}},vertexShader:kS(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Eu,depthTest:!1,depthWrite:!1})}function HO(){return new jc({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:kS(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Eu,depthTest:!1,depthWrite:!1})}function WO(){return new jc({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:kS(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Eu,depthTest:!1,depthWrite:!1})}function kS(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function F$(r){let e=new WeakMap,i=null;function n(u){if(u&&u.isTexture){const c=u.mapping,h=c===EC||c===wC,p=c===dm||c===pm;if(h||p){let f=e.get(u);const g=f!==void 0?f.texture.pmremVersion:0;if(u.isRenderTargetTexture&&u.pmremVersion!==g)return i===null&&(i=new VO(r)),f=h?i.fromEquirectangular(u,f):i.fromCubemap(u,f),f.texture.pmremVersion=u.pmremVersion,e.set(u,f),f.texture;if(f!==void 0)return f.texture;{const m=u.image;return h&&m&&m.height>0||p&&m&&s(m)?(i===null&&(i=new VO(r)),f=h?i.fromEquirectangular(u):i.fromCubemap(u),f.texture.pmremVersion=u.pmremVersion,e.set(u,f),u.addEventListener("dispose",o),f.texture):null}}}return u}function s(u){let c=0;const h=6;for(let p=0;p<h;p++)u[p]!==void 0&&c++;return c===h}function o(u){const c=u.target;c.removeEventListener("dispose",o);const h=e.get(c);h!==void 0&&(e.delete(c),h.dispose())}function l(){e=new WeakMap,i!==null&&(i.dispose(),i=null)}return{get:n,dispose:l}}function U$(r){const e={};function i(n){if(e[n]!==void 0)return e[n];let s;switch(n){case"WEBGL_depth_texture":s=r.getExtension("WEBGL_depth_texture")||r.getExtension("MOZ_WEBGL_depth_texture")||r.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=r.getExtension("WEBGL_compressed_texture_s3tc")||r.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=r.getExtension("WEBGL_compressed_texture_pvrtc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=r.getExtension(n)}return e[n]=s,s}return{has:function(n){return i(n)!==null},init:function(){i("EXT_color_buffer_float"),i("WEBGL_clip_cull_distance"),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture"),i("WEBGL_render_shared_exponent")},get:function(n){const s=i(n);return s===null&&fA("THREE.WebGLRenderer: "+n+" extension not supported."),s}}}function z$(r,e,i,n){const s={},o=new WeakMap;function l(f){const g=f.target;g.index!==null&&e.remove(g.index);for(const y in g.attributes)e.remove(g.attributes[y]);for(const y in g.morphAttributes){const b=g.morphAttributes[y];for(let v=0,_=b.length;v<_;v++)e.remove(b[v])}g.removeEventListener("dispose",l),delete s[g.id];const m=o.get(g);m&&(e.remove(m),o.delete(g)),n.releaseStatesOfGeometry(g),g.isInstancedBufferGeometry===!0&&delete g._maxInstanceCount,i.memory.geometries--}function u(f,g){return s[g.id]===!0||(g.addEventListener("dispose",l),s[g.id]=!0,i.memory.geometries++),g}function c(f){const g=f.attributes;for(const y in g)e.update(g[y],r.ARRAY_BUFFER);const m=f.morphAttributes;for(const y in m){const b=m[y];for(let v=0,_=b.length;v<_;v++)e.update(b[v],r.ARRAY_BUFFER)}}function h(f){const g=[],m=f.index,y=f.attributes.position;let b=0;if(m!==null){const T=m.array;b=m.version;for(let E=0,C=T.length;E<C;E+=3){const R=T[E+0],B=T[E+1],I=T[E+2];g.push(R,B,B,I,I,R)}}else if(y!==void 0){const T=y.array;b=y.version;for(let E=0,C=T.length/3-1;E<C;E+=3){const R=E+0,B=E+1,I=E+2;g.push(R,B,B,I,I,R)}}else return;const v=new(lO(g)?MO:TO)(g,1);v.version=b;const _=o.get(f);_&&e.remove(_),o.set(f,v)}function p(f){const g=o.get(f);if(g){const m=f.index;m!==null&&g.version<m.version&&h(f)}else h(f);return o.get(f)}return{get:u,update:c,getWireframeAttribute:p}}function j$(r,e,i){let n;function s(g){n=g}let o,l;function u(g){o=g.type,l=g.bytesPerElement}function c(g,m){r.drawElements(n,m,o,g*l),i.update(m,n,1)}function h(g,m,y){y!==0&&(r.drawElementsInstanced(n,m,o,g*l,y),i.update(m,n,y))}function p(g,m,y){if(y===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(n,m,0,o,g,0,y);let b=0;for(let v=0;v<y;v++)b+=m[v];i.update(b,n,1)}function f(g,m,y,b){if(y===0)return;const v=e.get("WEBGL_multi_draw");if(v===null)for(let _=0;_<g.length;_++)h(g[_]/l,m[_],b[_]);else{v.multiDrawElementsInstancedWEBGL(n,m,0,o,g,0,b,0,y);let _=0;for(let T=0;T<y;T++)_+=m[T]*b[T];i.update(_,n,1)}}this.setMode=s,this.setIndex=u,this.render=c,this.renderInstances=h,this.renderMultiDraw=p,this.renderMultiDrawInstances=f}function V$(r){const e={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function n(o,l,u){switch(i.calls++,l){case r.TRIANGLES:i.triangles+=u*(o/3);break;case r.LINES:i.lines+=u*(o/2);break;case r.LINE_STRIP:i.lines+=u*(o-1);break;case r.LINE_LOOP:i.lines+=u*o;break;case r.POINTS:i.points+=u*o;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",l);break}}function s(){i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:e,render:i,programs:null,autoReset:!0,reset:s,update:n}}function G$(r,e,i){const n=new WeakMap,s=new Zs;function o(l,u,c){const h=l.morphTargetInfluences,p=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,f=p!==void 0?p.length:0;let g=n.get(u);if(g===void 0||g.count!==f){let m=function(){N.dispose(),n.delete(u),u.removeEventListener("dispose",m)};g!==void 0&&g.texture.dispose();const y=u.morphAttributes.position!==void 0,b=u.morphAttributes.normal!==void 0,v=u.morphAttributes.color!==void 0,_=u.morphAttributes.position||[],T=u.morphAttributes.normal||[],E=u.morphAttributes.color||[];let C=0;y===!0&&(C=1),b===!0&&(C=2),v===!0&&(C=3);let R=u.attributes.position.count*C,B=1;R>e.maxTextureSize&&(B=Math.ceil(R/e.maxTextureSize),R=e.maxTextureSize);const I=new Float32Array(R*B*4*f),N=new gO(I,R,B,f);N.type=Cu,N.needsUpdate=!0;const D=C*4;for(let P=0;P<f;P++){const k=_[P],q=T[P],V=E[P],j=R*B*4*P;for(let Q=0;Q<k.count;Q++){const W=Q*D;y===!0&&(s.fromBufferAttribute(k,Q),I[j+W+0]=s.x,I[j+W+1]=s.y,I[j+W+2]=s.z,I[j+W+3]=0),b===!0&&(s.fromBufferAttribute(q,Q),I[j+W+4]=s.x,I[j+W+5]=s.y,I[j+W+6]=s.z,I[j+W+7]=0),v===!0&&(s.fromBufferAttribute(V,Q),I[j+W+8]=s.x,I[j+W+9]=s.y,I[j+W+10]=s.z,I[j+W+11]=V.itemSize===4?s.w:1)}}g={count:f,texture:N,size:new ji(R,B)},n.set(u,g),u.addEventListener("dispose",m)}if(l.isInstancedMesh===!0&&l.morphTexture!==null)c.getUniforms().setValue(r,"morphTexture",l.morphTexture,i);else{let m=0;for(let b=0;b<h.length;b++)m+=h[b];const y=u.morphTargetsRelative?1:1-m;c.getUniforms().setValue(r,"morphTargetBaseInfluence",y),c.getUniforms().setValue(r,"morphTargetInfluences",h)}c.getUniforms().setValue(r,"morphTargetsTexture",g.texture,i),c.getUniforms().setValue(r,"morphTargetsTextureSize",g.size)}return{update:o}}function H$(r,e,i,n){let s=new WeakMap;function o(c){const h=n.render.frame,p=c.geometry,f=e.get(c,p);if(s.get(f)!==h&&(e.update(f),s.set(f,h)),c.isInstancedMesh&&(c.hasEventListener("dispose",u)===!1&&c.addEventListener("dispose",u),s.get(c)!==h&&(i.update(c.instanceMatrix,r.ARRAY_BUFFER),c.instanceColor!==null&&i.update(c.instanceColor,r.ARRAY_BUFFER),s.set(c,h))),c.isSkinnedMesh){const g=c.skeleton;s.get(g)!==h&&(g.update(),s.set(g,h))}return f}function l(){s=new WeakMap}function u(c){const h=c.target;h.removeEventListener("dispose",u),i.remove(h.instanceMatrix),h.instanceColor!==null&&i.remove(h.instanceColor)}return{update:o,dispose:l}}let QO=class extends Dl{constructor(r,e,i,n,s,o,l,u,c,h=gm){if(h!==gm&&h!==Am)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&h===gm&&(i=cp),i===void 0&&h===Am&&(i=mm),super(null,n,s,o,l,u,h,i,c),this.isDepthTexture=!0,this.image={width:r,height:e},this.magFilter=l!==void 0?l:ic,this.minFilter=u!==void 0?u:ic,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(r){return super.copy(r),this.compareFunction=r.compareFunction,this}toJSON(r){const e=super.toJSON(r);return this.compareFunction!==null&&(e.compareFunction=this.compareFunction),e}};const qO=new Dl,XO=new QO(1,1),YO=new gO,KO=new BK,JO=new kO,ZO=[],$O=[],e4=new Float32Array(16),t4=new Float32Array(9),i4=new Float32Array(4);function km(r,e,i){const n=r[0];if(n<=0||n>0)return r;const s=e*i;let o=ZO[s];if(o===void 0&&(o=new Float32Array(s),ZO[s]=o),e!==0){n.toArray(o,0);for(let l=1,u=0;l!==e;++l)u+=i,r[l].toArray(o,u)}return o}function fa(r,e){if(r.length!==e.length)return!1;for(let i=0,n=r.length;i<n;i++)if(r[i]!==e[i])return!1;return!0}function ma(r,e){for(let i=0,n=e.length;i<n;i++)r[i]=e[i]}function bx(r,e){let i=$O[e];i===void 0&&(i=new Int32Array(e),$O[e]=i);for(let n=0;n!==e;++n)i[n]=r.allocateTextureUnit();return i}function W$(r,e){const i=this.cache;i[0]!==e&&(r.uniform1f(this.addr,e),i[0]=e)}function Q$(r,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(r.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(fa(i,e))return;r.uniform2fv(this.addr,e),ma(i,e)}}function q$(r,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(r.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else if(e.r!==void 0)(i[0]!==e.r||i[1]!==e.g||i[2]!==e.b)&&(r.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b);else{if(fa(i,e))return;r.uniform3fv(this.addr,e),ma(i,e)}}function X$(r,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(r.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(fa(i,e))return;r.uniform4fv(this.addr,e),ma(i,e)}}function Y$(r,e){const i=this.cache,n=e.elements;if(n===void 0){if(fa(i,e))return;r.uniformMatrix2fv(this.addr,!1,e),ma(i,e)}else{if(fa(i,n))return;i4.set(n),r.uniformMatrix2fv(this.addr,!1,i4),ma(i,n)}}function K$(r,e){const i=this.cache,n=e.elements;if(n===void 0){if(fa(i,e))return;r.uniformMatrix3fv(this.addr,!1,e),ma(i,e)}else{if(fa(i,n))return;t4.set(n),r.uniformMatrix3fv(this.addr,!1,t4),ma(i,n)}}function J$(r,e){const i=this.cache,n=e.elements;if(n===void 0){if(fa(i,e))return;r.uniformMatrix4fv(this.addr,!1,e),ma(i,e)}else{if(fa(i,n))return;e4.set(n),r.uniformMatrix4fv(this.addr,!1,e4),ma(i,n)}}function Z$(r,e){const i=this.cache;i[0]!==e&&(r.uniform1i(this.addr,e),i[0]=e)}function $$(r,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(r.uniform2i(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(fa(i,e))return;r.uniform2iv(this.addr,e),ma(i,e)}}function eee(r,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(r.uniform3i(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(fa(i,e))return;r.uniform3iv(this.addr,e),ma(i,e)}}function tee(r,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(r.uniform4i(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(fa(i,e))return;r.uniform4iv(this.addr,e),ma(i,e)}}function iee(r,e){const i=this.cache;i[0]!==e&&(r.uniform1ui(this.addr,e),i[0]=e)}function ree(r,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(r.uniform2ui(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(fa(i,e))return;r.uniform2uiv(this.addr,e),ma(i,e)}}function nee(r,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(r.uniform3ui(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(fa(i,e))return;r.uniform3uiv(this.addr,e),ma(i,e)}}function see(r,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(r.uniform4ui(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(fa(i,e))return;r.uniform4uiv(this.addr,e),ma(i,e)}}function aee(r,e,i){const n=this.cache,s=i.allocateTextureUnit();n[0]!==s&&(r.uniform1i(this.addr,s),n[0]=s);let o;this.type===r.SAMPLER_2D_SHADOW?(XO.compareFunction=sO,o=XO):o=qO,i.setTexture2D(e||o,s)}function oee(r,e,i){const n=this.cache,s=i.allocateTextureUnit();n[0]!==s&&(r.uniform1i(this.addr,s),n[0]=s),i.setTexture3D(e||KO,s)}function lee(r,e,i){const n=this.cache,s=i.allocateTextureUnit();n[0]!==s&&(r.uniform1i(this.addr,s),n[0]=s),i.setTextureCube(e||JO,s)}function cee(r,e,i){const n=this.cache,s=i.allocateTextureUnit();n[0]!==s&&(r.uniform1i(this.addr,s),n[0]=s),i.setTexture2DArray(e||YO,s)}function uee(r){switch(r){case 5126:return W$;case 35664:return Q$;case 35665:return q$;case 35666:return X$;case 35674:return Y$;case 35675:return K$;case 35676:return J$;case 5124:case 35670:return Z$;case 35667:case 35671:return $$;case 35668:case 35672:return eee;case 35669:case 35673:return tee;case 5125:return iee;case 36294:return ree;case 36295:return nee;case 36296:return see;case 35678:case 36198:case 36298:case 36306:case 35682:return aee;case 35679:case 36299:case 36307:return oee;case 35680:case 36300:case 36308:case 36293:return lee;case 36289:case 36303:case 36311:case 36292:return cee}}function hee(r,e){r.uniform1fv(this.addr,e)}function dee(r,e){const i=km(e,this.size,2);r.uniform2fv(this.addr,i)}function pee(r,e){const i=km(e,this.size,3);r.uniform3fv(this.addr,i)}function fee(r,e){const i=km(e,this.size,4);r.uniform4fv(this.addr,i)}function mee(r,e){const i=km(e,this.size,4);r.uniformMatrix2fv(this.addr,!1,i)}function gee(r,e){const i=km(e,this.size,9);r.uniformMatrix3fv(this.addr,!1,i)}function Aee(r,e){const i=km(e,this.size,16);r.uniformMatrix4fv(this.addr,!1,i)}function yee(r,e){r.uniform1iv(this.addr,e)}function vee(r,e){r.uniform2iv(this.addr,e)}function bee(r,e){r.uniform3iv(this.addr,e)}function xee(r,e){r.uniform4iv(this.addr,e)}function _ee(r,e){r.uniform1uiv(this.addr,e)}function Eee(r,e){r.uniform2uiv(this.addr,e)}function wee(r,e){r.uniform3uiv(this.addr,e)}function Cee(r,e){r.uniform4uiv(this.addr,e)}function See(r,e,i){const n=this.cache,s=e.length,o=bx(i,s);fa(n,o)||(r.uniform1iv(this.addr,o),ma(n,o));for(let l=0;l!==s;++l)i.setTexture2D(e[l]||qO,o[l])}function Tee(r,e,i){const n=this.cache,s=e.length,o=bx(i,s);fa(n,o)||(r.uniform1iv(this.addr,o),ma(n,o));for(let l=0;l!==s;++l)i.setTexture3D(e[l]||KO,o[l])}function Mee(r,e,i){const n=this.cache,s=e.length,o=bx(i,s);fa(n,o)||(r.uniform1iv(this.addr,o),ma(n,o));for(let l=0;l!==s;++l)i.setTextureCube(e[l]||JO,o[l])}function Ree(r,e,i){const n=this.cache,s=e.length,o=bx(i,s);fa(n,o)||(r.uniform1iv(this.addr,o),ma(n,o));for(let l=0;l!==s;++l)i.setTexture2DArray(e[l]||YO,o[l])}function Iee(r){switch(r){case 5126:return hee;case 35664:return dee;case 35665:return pee;case 35666:return fee;case 35674:return mee;case 35675:return gee;case 35676:return Aee;case 5124:case 35670:return yee;case 35667:case 35671:return vee;case 35668:case 35672:return bee;case 35669:case 35673:return xee;case 5125:return _ee;case 36294:return Eee;case 36295:return wee;case 36296:return Cee;case 35678:case 36198:case 36298:case 36306:case 35682:return See;case 35679:case 36299:case 36307:return Tee;case 35680:case 36300:case 36308:case 36293:return Mee;case 36289:case 36303:case 36311:case 36292:return Ree}}class Bee{constructor(e,i,n){this.id=e,this.addr=n,this.cache=[],this.type=i.type,this.setValue=uee(i.type)}}class Lee{constructor(e,i,n){this.id=e,this.addr=n,this.cache=[],this.type=i.type,this.size=i.size,this.setValue=Iee(i.type)}}class Dee{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,i,n){const s=this.seq;for(let o=0,l=s.length;o!==l;++o){const u=s[o];u.setValue(e,i[u.id],n)}}}const FS=/(\w+)(\])?(\[|\.)?/g;function r4(r,e){r.seq.push(e),r.map[e.id]=e}function Nee(r,e,i){const n=r.name,s=n.length;for(FS.lastIndex=0;;){const o=FS.exec(n),l=FS.lastIndex;let u=o[1];const c=o[2]==="]",h=o[3];if(c&&(u=u|0),h===void 0||h==="["&&l+2===s){r4(i,h===void 0?new Bee(u,r,e):new Lee(u,r,e));break}else{let p=i.map[u];p===void 0&&(p=new Dee(u),r4(i,p)),i=p}}}class xx{constructor(e,i){this.seq=[],this.map={};const n=e.getProgramParameter(i,e.ACTIVE_UNIFORMS);for(let s=0;s<n;++s){const o=e.getActiveUniform(i,s),l=e.getUniformLocation(i,o.name);Nee(o,l,this)}}setValue(e,i,n,s){const o=this.map[i];o!==void 0&&o.setValue(e,n,s)}setOptional(e,i,n){const s=i[n];s!==void 0&&this.setValue(e,n,s)}static upload(e,i,n,s){for(let o=0,l=i.length;o!==l;++o){const u=i[o],c=n[u.id];c.needsUpdate!==!1&&u.setValue(e,c.value,s)}}static seqWithValue(e,i){const n=[];for(let s=0,o=e.length;s!==o;++s){const l=e[s];l.id in i&&n.push(l)}return n}}function n4(r,e,i){const n=r.createShader(e);return r.shaderSource(n,i),r.compileShader(n),n}const Pee=37297;let Oee=0;function kee(r,e){const i=r.split(`
`),n=[],s=Math.max(e-6,0),o=Math.min(e+6,i.length);for(let l=s;l<o;l++){const u=l+1;n.push(`${u===e?">":" "} ${u}: ${i[l]}`)}return n.join(`
`)}const s4=new fn;function Fee(r){kn._getMatrix(s4,kn.workingColorSpace,r);const e=`mat3( ${s4.elements.map(i=>i.toFixed(4))} )`;switch(kn.getTransfer(r)){case Jb:return[e,"LinearTransferOETF"];case as:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",r),[e,"LinearTransferOETF"]}}function a4(r,e,i){const n=r.getShaderParameter(e,r.COMPILE_STATUS),s=r.getShaderInfoLog(e).trim();if(n&&s==="")return"";const o=/ERROR: 0:(\d+)/.exec(s);if(o){const l=parseInt(o[1]);return i.toUpperCase()+`

`+s+`

`+kee(r.getShaderSource(e),l)}else return s}function Uee(r,e){const i=Fee(e);return[`vec4 ${r}( vec4 value ) {`,`	return ${i[1]}( vec4( value.rgb * ${i[0]}, value.a ) );`,"}"].join(`
`)}function zee(r,e){let i;switch(e){case GY:i="Linear";break;case HY:i="Reinhard";break;case WY:i="Cineon";break;case QY:i="ACESFilmic";break;case XY:i="AgX";break;case YY:i="Neutral";break;case qY:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),i="Linear"}return"vec3 "+r+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}const _x=new at;function jee(){kn.getLuminanceCoefficients(_x);const r=_x.x.toFixed(4),e=_x.y.toFixed(4),i=_x.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${r}, ${e}, ${i} );`,"	return dot( weights, rgb );","}"].join(`
`)}function Vee(r){return[r.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",r.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(bA).join(`
`)}function Gee(r){const e=[];for(const i in r){const n=r[i];n!==!1&&e.push("#define "+i+" "+n)}return e.join(`
`)}function Hee(r,e){const i={},n=r.getProgramParameter(e,r.ACTIVE_ATTRIBUTES);for(let s=0;s<n;s++){const o=r.getActiveAttrib(e,s),l=o.name;let u=1;o.type===r.FLOAT_MAT2&&(u=2),o.type===r.FLOAT_MAT3&&(u=3),o.type===r.FLOAT_MAT4&&(u=4),i[l]={type:o.type,location:r.getAttribLocation(e,l),locationSize:u}}return i}function bA(r){return r!==""}function o4(r,e){const i=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return r.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function l4(r,e){return r.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Wee=/^[ \t]*#include +<([\w\d./]+)>/gm;function US(r){return r.replace(Wee,qee)}const Qee=new Map;function qee(r,e){let i=cn[e];if(i===void 0){const n=Qee.get(e);if(n!==void 0)i=cn[n],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,n);else throw new Error("Can not resolve #include <"+e+">")}return US(i)}const Xee=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function c4(r){return r.replace(Xee,Yee)}function Yee(r,e,i,n){let s="";for(let o=parseInt(e);o<parseInt(i);o++)s+=n.replace(/\[\s*i\s*\]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return s}function u4(r){let e=`precision ${r.precision} float;
	precision ${r.precision} int;
	precision ${r.precision} sampler2D;
	precision ${r.precision} samplerCube;
	precision ${r.precision} sampler3D;
	precision ${r.precision} sampler2DArray;
	precision ${r.precision} sampler2DShadow;
	precision ${r.precision} samplerCubeShadow;
	precision ${r.precision} sampler2DArrayShadow;
	precision ${r.precision} isampler2D;
	precision ${r.precision} isampler3D;
	precision ${r.precision} isamplerCube;
	precision ${r.precision} isampler2DArray;
	precision ${r.precision} usampler2D;
	precision ${r.precision} usampler3D;
	precision ${r.precision} usamplerCube;
	precision ${r.precision} usampler2DArray;
	`;return r.precision==="highp"?e+=`
#define HIGH_PRECISION`:r.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:r.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function Kee(r){let e="SHADOWMAP_TYPE_BASIC";return r.shadowMapType===VP?e="SHADOWMAP_TYPE_PCF":r.shadowMapType===_Y?e="SHADOWMAP_TYPE_PCF_SOFT":r.shadowMapType===xu&&(e="SHADOWMAP_TYPE_VSM"),e}function Jee(r){let e="ENVMAP_TYPE_CUBE";if(r.envMap)switch(r.envMapMode){case dm:case pm:e="ENVMAP_TYPE_CUBE";break;case Hb:e="ENVMAP_TYPE_CUBE_UV";break}return e}function Zee(r){let e="ENVMAP_MODE_REFLECTION";if(r.envMap)switch(r.envMapMode){case pm:e="ENVMAP_MODE_REFRACTION";break}return e}function $ee(r){let e="ENVMAP_BLENDING_NONE";if(r.envMap)switch(r.combine){case _C:e="ENVMAP_BLENDING_MULTIPLY";break;case jY:e="ENVMAP_BLENDING_MIX";break;case VY:e="ENVMAP_BLENDING_ADD";break}return e}function ete(r){const e=r.envMapCubeUVHeight;if(e===null)return null;const i=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,i),7*16)),texelHeight:n,maxMip:i}}function tte(r,e,i,n){const s=r.getContext(),o=i.defines;let l=i.vertexShader,u=i.fragmentShader;const c=Kee(i),h=Jee(i),p=Zee(i),f=$ee(i),g=ete(i),m=Vee(i),y=Gee(o),b=s.createProgram();let v,_,T=i.glslVersion?"#version "+i.glslVersion+`
`:"";i.isRawShaderMaterial?(v=["#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,y].filter(bA).join(`
`),v.length>0&&(v+=`
`),_=["#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,y].filter(bA).join(`
`),_.length>0&&(_+=`
`)):(v=[u4(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,y,i.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",i.batching?"#define USE_BATCHING":"",i.batchingColor?"#define USE_BATCHING_COLOR":"",i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.instancingMorph?"#define USE_INSTANCING_MORPH":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+p:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.displacementMap?"#define USE_DISPLACEMENTMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.mapUv?"#define MAP_UV "+i.mapUv:"",i.alphaMapUv?"#define ALPHAMAP_UV "+i.alphaMapUv:"",i.lightMapUv?"#define LIGHTMAP_UV "+i.lightMapUv:"",i.aoMapUv?"#define AOMAP_UV "+i.aoMapUv:"",i.emissiveMapUv?"#define EMISSIVEMAP_UV "+i.emissiveMapUv:"",i.bumpMapUv?"#define BUMPMAP_UV "+i.bumpMapUv:"",i.normalMapUv?"#define NORMALMAP_UV "+i.normalMapUv:"",i.displacementMapUv?"#define DISPLACEMENTMAP_UV "+i.displacementMapUv:"",i.metalnessMapUv?"#define METALNESSMAP_UV "+i.metalnessMapUv:"",i.roughnessMapUv?"#define ROUGHNESSMAP_UV "+i.roughnessMapUv:"",i.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+i.anisotropyMapUv:"",i.clearcoatMapUv?"#define CLEARCOATMAP_UV "+i.clearcoatMapUv:"",i.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+i.clearcoatNormalMapUv:"",i.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+i.clearcoatRoughnessMapUv:"",i.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+i.iridescenceMapUv:"",i.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+i.iridescenceThicknessMapUv:"",i.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+i.sheenColorMapUv:"",i.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+i.sheenRoughnessMapUv:"",i.specularMapUv?"#define SPECULARMAP_UV "+i.specularMapUv:"",i.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+i.specularColorMapUv:"",i.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+i.specularIntensityMapUv:"",i.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+i.transmissionMapUv:"",i.thicknessMapUv?"#define THICKNESSMAP_UV "+i.thicknessMapUv:"",i.vertexTangents&&i.flatShading===!1?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.morphColors?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+c:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(bA).join(`
`),_=[u4(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,y,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+h:"",i.envMap?"#define "+p:"",i.envMap?"#define "+f:"",g?"#define CUBEUV_TEXEL_WIDTH "+g.texelWidth:"",g?"#define CUBEUV_TEXEL_HEIGHT "+g.texelHeight:"",g?"#define CUBEUV_MAX_MIP "+g.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.dispersion?"#define USE_DISPERSION":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.vertexTangents&&i.flatShading===!1?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor||i.batchingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+c:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==Hh?"#define TONE_MAPPING":"",i.toneMapping!==Hh?cn.tonemapping_pars_fragment:"",i.toneMapping!==Hh?zee("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",cn.colorspace_pars_fragment,Uee("linearToOutputTexel",i.outputColorSpace),jee(),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(bA).join(`
`)),l=US(l),l=o4(l,i),l=l4(l,i),u=US(u),u=o4(u,i),u=l4(u,i),l=c4(l),u=c4(u),i.isRawShaderMaterial!==!0&&(T=`#version 300 es
`,v=[m,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+v,_=["#define varying in",i.glslVersion===aO?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===aO?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+_);const E=T+v+l,C=T+_+u,R=n4(s,s.VERTEX_SHADER,E),B=n4(s,s.FRAGMENT_SHADER,C);s.attachShader(b,R),s.attachShader(b,B),i.index0AttributeName!==void 0?s.bindAttribLocation(b,0,i.index0AttributeName):i.morphTargets===!0&&s.bindAttribLocation(b,0,"position"),s.linkProgram(b);function I(k){if(r.debug.checkShaderErrors){const q=s.getProgramInfoLog(b).trim(),V=s.getShaderInfoLog(R).trim(),j=s.getShaderInfoLog(B).trim();let Q=!0,W=!0;if(s.getProgramParameter(b,s.LINK_STATUS)===!1)if(Q=!1,typeof r.debug.onShaderError=="function")r.debug.onShaderError(s,b,R,B);else{const G=a4(s,R,"vertex"),z=a4(s,B,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(b,s.VALIDATE_STATUS)+`

Material Name: `+k.name+`
Material Type: `+k.type+`

Program Info Log: `+q+`
`+G+`
`+z)}else q!==""?console.warn("THREE.WebGLProgram: Program Info Log:",q):(V===""||j==="")&&(W=!1);W&&(k.diagnostics={runnable:Q,programLog:q,vertexShader:{log:V,prefix:v},fragmentShader:{log:j,prefix:_}})}s.deleteShader(R),s.deleteShader(B),N=new xx(s,b),D=Hee(s,b)}let N;this.getUniforms=function(){return N===void 0&&I(this),N};let D;this.getAttributes=function(){return D===void 0&&I(this),D};let P=i.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return P===!1&&(P=s.getProgramParameter(b,Pee)),P},this.destroy=function(){n.releaseStatesOfProgram(this),s.deleteProgram(b),this.program=void 0},this.type=i.shaderType,this.name=i.shaderName,this.id=Oee++,this.cacheKey=e,this.usedTimes=1,this.program=b,this.vertexShader=R,this.fragmentShader=B,this}let ite=0;class rte{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const i=e.vertexShader,n=e.fragmentShader,s=this._getShaderStage(i),o=this._getShaderStage(n),l=this._getShaderCacheForMaterial(e);return l.has(s)===!1&&(l.add(s),s.usedTimes++),l.has(o)===!1&&(l.add(o),o.usedTimes++),this}remove(e){const i=this.materialCache.get(e);for(const n of i)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const i=this.materialCache;let n=i.get(e);return n===void 0&&(n=new Set,i.set(e,n)),n}_getShaderStage(e){const i=this.shaderCache;let n=i.get(e);return n===void 0&&(n=new nte(e),i.set(e,n)),n}}class nte{constructor(e){this.id=ite++,this.code=e,this.usedTimes=0}}function ste(r,e,i,n,s,o,l){const u=new AS,c=new rte,h=new Set,p=[],f=s.logarithmicDepthBuffer,g=s.vertexTextures;let m=s.precision;const y={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function b(D){return h.add(D),D===0?"uv":`uv${D}`}function v(D,P,k,q,V){const j=q.fog,Q=V.geometry,W=D.isMeshStandardMaterial?q.environment:null,G=(D.isMeshStandardMaterial?i:e).get(D.envMap||W),z=G&&G.mapping===Hb?G.image.height:null,te=y[D.type];D.precision!==null&&(m=s.getMaxPrecision(D.precision),m!==D.precision&&console.warn("THREE.WebGLProgram.getParameters:",D.precision,"not supported, using",m,"instead."));const Y=Q.morphAttributes.position||Q.morphAttributes.normal||Q.morphAttributes.color,se=Y!==void 0?Y.length:0;let ve=0;Q.morphAttributes.position!==void 0&&(ve=1),Q.morphAttributes.normal!==void 0&&(ve=2),Q.morphAttributes.color!==void 0&&(ve=3);let Ae,me,Oe,Xe;if(te){const ki=Vc[te];Ae=ki.vertexShader,me=ki.fragmentShader}else Ae=D.vertexShader,me=D.fragmentShader,c.update(D),Oe=c.getVertexShaderID(D),Xe=c.getFragmentShaderID(D);const Je=r.getRenderTarget(),it=r.state.buffers.depth.getReversed(),dt=V.isInstancedMesh===!0,St=V.isBatchedMesh===!0,Qt=!!D.map,yt=!!D.matcap,bi=!!G,$e=!!D.aoMap,Fi=!!D.lightMap,ui=!!D.bumpMap,Si=!!D.normalMap,Ei=!!D.displacementMap,Zi=!!D.emissiveMap,Vi=!!D.metalnessMap,We=!!D.roughnessMap,Ce=D.anisotropy>0,At=D.clearcoat>0,Ot=D.dispersion>0,Zt=D.iridescence>0,jt=D.sheen>0,xi=D.transmission>0,vt=Ce&&!!D.anisotropyMap,ge=At&&!!D.clearcoatMap,be=At&&!!D.clearcoatNormalMap,Ne=At&&!!D.clearcoatRoughnessMap,Se=Zt&&!!D.iridescenceMap,Fe=Zt&&!!D.iridescenceThicknessMap,Ie=jt&&!!D.sheenColorMap,U=jt&&!!D.sheenRoughnessMap,$=!!D.specularMap,re=!!D.specularColorMap,Me=!!D.specularIntensityMap,ce=xi&&!!D.transmissionMap,ze=xi&&!!D.thicknessMap,Ve=!!D.gradientMap,pt=!!D.alphaMap,Dt=D.alphaTest>0,xt=!!D.alphaHash,Vt=!!D.extensions;let fi=Hh;D.toneMapped&&(Je===null||Je.isXRRenderTarget===!0)&&(fi=r.toneMapping);const xr={shaderID:te,shaderType:D.type,shaderName:D.name,vertexShader:Ae,fragmentShader:me,defines:D.defines,customVertexShaderID:Oe,customFragmentShaderID:Xe,isRawShaderMaterial:D.isRawShaderMaterial===!0,glslVersion:D.glslVersion,precision:m,batching:St,batchingColor:St&&V._colorsTexture!==null,instancing:dt,instancingColor:dt&&V.instanceColor!==null,instancingMorph:dt&&V.morphTexture!==null,supportsVertexTextures:g,outputColorSpace:Je===null?r.outputColorSpace:Je.isXRRenderTarget===!0?Je.texture.colorSpace:ym,alphaToCoverage:!!D.alphaToCoverage,map:Qt,matcap:yt,envMap:bi,envMapMode:bi&&G.mapping,envMapCubeUVHeight:z,aoMap:$e,lightMap:Fi,bumpMap:ui,normalMap:Si,displacementMap:g&&Ei,emissiveMap:Zi,normalMapObjectSpace:Si&&D.normalMapType===$Y,normalMapTangentSpace:Si&&D.normalMapType===rO,metalnessMap:Vi,roughnessMap:We,anisotropy:Ce,anisotropyMap:vt,clearcoat:At,clearcoatMap:ge,clearcoatNormalMap:be,clearcoatRoughnessMap:Ne,dispersion:Ot,iridescence:Zt,iridescenceMap:Se,iridescenceThicknessMap:Fe,sheen:jt,sheenColorMap:Ie,sheenRoughnessMap:U,specularMap:$,specularColorMap:re,specularIntensityMap:Me,transmission:xi,transmissionMap:ce,thicknessMap:ze,gradientMap:Ve,opaque:D.transparent===!1&&D.blending===um&&D.alphaToCoverage===!1,alphaMap:pt,alphaTest:Dt,alphaHash:xt,combine:D.combine,mapUv:Qt&&b(D.map.channel),aoMapUv:$e&&b(D.aoMap.channel),lightMapUv:Fi&&b(D.lightMap.channel),bumpMapUv:ui&&b(D.bumpMap.channel),normalMapUv:Si&&b(D.normalMap.channel),displacementMapUv:Ei&&b(D.displacementMap.channel),emissiveMapUv:Zi&&b(D.emissiveMap.channel),metalnessMapUv:Vi&&b(D.metalnessMap.channel),roughnessMapUv:We&&b(D.roughnessMap.channel),anisotropyMapUv:vt&&b(D.anisotropyMap.channel),clearcoatMapUv:ge&&b(D.clearcoatMap.channel),clearcoatNormalMapUv:be&&b(D.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Ne&&b(D.clearcoatRoughnessMap.channel),iridescenceMapUv:Se&&b(D.iridescenceMap.channel),iridescenceThicknessMapUv:Fe&&b(D.iridescenceThicknessMap.channel),sheenColorMapUv:Ie&&b(D.sheenColorMap.channel),sheenRoughnessMapUv:U&&b(D.sheenRoughnessMap.channel),specularMapUv:$&&b(D.specularMap.channel),specularColorMapUv:re&&b(D.specularColorMap.channel),specularIntensityMapUv:Me&&b(D.specularIntensityMap.channel),transmissionMapUv:ce&&b(D.transmissionMap.channel),thicknessMapUv:ze&&b(D.thicknessMap.channel),alphaMapUv:pt&&b(D.alphaMap.channel),vertexTangents:!!Q.attributes.tangent&&(Si||Ce),vertexColors:D.vertexColors,vertexAlphas:D.vertexColors===!0&&!!Q.attributes.color&&Q.attributes.color.itemSize===4,pointsUvs:V.isPoints===!0&&!!Q.attributes.uv&&(Qt||pt),fog:!!j,useFog:D.fog===!0,fogExp2:!!j&&j.isFogExp2,flatShading:D.flatShading===!0,sizeAttenuation:D.sizeAttenuation===!0,logarithmicDepthBuffer:f,reverseDepthBuffer:it,skinning:V.isSkinnedMesh===!0,morphTargets:Q.morphAttributes.position!==void 0,morphNormals:Q.morphAttributes.normal!==void 0,morphColors:Q.morphAttributes.color!==void 0,morphTargetsCount:se,morphTextureStride:ve,numDirLights:P.directional.length,numPointLights:P.point.length,numSpotLights:P.spot.length,numSpotLightMaps:P.spotLightMap.length,numRectAreaLights:P.rectArea.length,numHemiLights:P.hemi.length,numDirLightShadows:P.directionalShadowMap.length,numPointLightShadows:P.pointShadowMap.length,numSpotLightShadows:P.spotShadowMap.length,numSpotLightShadowsWithMaps:P.numSpotLightShadowsWithMaps,numLightProbes:P.numLightProbes,numClippingPlanes:l.numPlanes,numClipIntersection:l.numIntersection,dithering:D.dithering,shadowMapEnabled:r.shadowMap.enabled&&k.length>0,shadowMapType:r.shadowMap.type,toneMapping:fi,decodeVideoTexture:Qt&&D.map.isVideoTexture===!0&&kn.getTransfer(D.map.colorSpace)===as,decodeVideoTextureEmissive:Zi&&D.emissiveMap.isVideoTexture===!0&&kn.getTransfer(D.emissiveMap.colorSpace)===as,premultipliedAlpha:D.premultipliedAlpha,doubleSided:D.side===_u,flipSided:D.side===go,useDepthPacking:D.depthPacking>=0,depthPacking:D.depthPacking||0,index0AttributeName:D.index0AttributeName,extensionClipCullDistance:Vt&&D.extensions.clipCullDistance===!0&&n.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(Vt&&D.extensions.multiDraw===!0||St)&&n.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:D.customProgramCacheKey()};return xr.vertexUv1s=h.has(1),xr.vertexUv2s=h.has(2),xr.vertexUv3s=h.has(3),h.clear(),xr}function _(D){const P=[];if(D.shaderID?P.push(D.shaderID):(P.push(D.customVertexShaderID),P.push(D.customFragmentShaderID)),D.defines!==void 0)for(const k in D.defines)P.push(k),P.push(D.defines[k]);return D.isRawShaderMaterial===!1&&(T(P,D),E(P,D),P.push(r.outputColorSpace)),P.push(D.customProgramCacheKey),P.join()}function T(D,P){D.push(P.precision),D.push(P.outputColorSpace),D.push(P.envMapMode),D.push(P.envMapCubeUVHeight),D.push(P.mapUv),D.push(P.alphaMapUv),D.push(P.lightMapUv),D.push(P.aoMapUv),D.push(P.bumpMapUv),D.push(P.normalMapUv),D.push(P.displacementMapUv),D.push(P.emissiveMapUv),D.push(P.metalnessMapUv),D.push(P.roughnessMapUv),D.push(P.anisotropyMapUv),D.push(P.clearcoatMapUv),D.push(P.clearcoatNormalMapUv),D.push(P.clearcoatRoughnessMapUv),D.push(P.iridescenceMapUv),D.push(P.iridescenceThicknessMapUv),D.push(P.sheenColorMapUv),D.push(P.sheenRoughnessMapUv),D.push(P.specularMapUv),D.push(P.specularColorMapUv),D.push(P.specularIntensityMapUv),D.push(P.transmissionMapUv),D.push(P.thicknessMapUv),D.push(P.combine),D.push(P.fogExp2),D.push(P.sizeAttenuation),D.push(P.morphTargetsCount),D.push(P.morphAttributeCount),D.push(P.numDirLights),D.push(P.numPointLights),D.push(P.numSpotLights),D.push(P.numSpotLightMaps),D.push(P.numHemiLights),D.push(P.numRectAreaLights),D.push(P.numDirLightShadows),D.push(P.numPointLightShadows),D.push(P.numSpotLightShadows),D.push(P.numSpotLightShadowsWithMaps),D.push(P.numLightProbes),D.push(P.shadowMapType),D.push(P.toneMapping),D.push(P.numClippingPlanes),D.push(P.numClipIntersection),D.push(P.depthPacking)}function E(D,P){u.disableAll(),P.supportsVertexTextures&&u.enable(0),P.instancing&&u.enable(1),P.instancingColor&&u.enable(2),P.instancingMorph&&u.enable(3),P.matcap&&u.enable(4),P.envMap&&u.enable(5),P.normalMapObjectSpace&&u.enable(6),P.normalMapTangentSpace&&u.enable(7),P.clearcoat&&u.enable(8),P.iridescence&&u.enable(9),P.alphaTest&&u.enable(10),P.vertexColors&&u.enable(11),P.vertexAlphas&&u.enable(12),P.vertexUv1s&&u.enable(13),P.vertexUv2s&&u.enable(14),P.vertexUv3s&&u.enable(15),P.vertexTangents&&u.enable(16),P.anisotropy&&u.enable(17),P.alphaHash&&u.enable(18),P.batching&&u.enable(19),P.dispersion&&u.enable(20),P.batchingColor&&u.enable(21),D.push(u.mask),u.disableAll(),P.fog&&u.enable(0),P.useFog&&u.enable(1),P.flatShading&&u.enable(2),P.logarithmicDepthBuffer&&u.enable(3),P.reverseDepthBuffer&&u.enable(4),P.skinning&&u.enable(5),P.morphTargets&&u.enable(6),P.morphNormals&&u.enable(7),P.morphColors&&u.enable(8),P.premultipliedAlpha&&u.enable(9),P.shadowMapEnabled&&u.enable(10),P.doubleSided&&u.enable(11),P.flipSided&&u.enable(12),P.useDepthPacking&&u.enable(13),P.dithering&&u.enable(14),P.transmission&&u.enable(15),P.sheen&&u.enable(16),P.opaque&&u.enable(17),P.pointsUvs&&u.enable(18),P.decodeVideoTexture&&u.enable(19),P.decodeVideoTextureEmissive&&u.enable(20),P.alphaToCoverage&&u.enable(21),D.push(u.mask)}function C(D){const P=y[D.type];let k;if(P){const q=Vc[P];k=DO.clone(q.uniforms)}else k=D.uniforms;return k}function R(D,P){let k;for(let q=0,V=p.length;q<V;q++){const j=p[q];if(j.cacheKey===P){k=j,++k.usedTimes;break}}return k===void 0&&(k=new tte(r,P,D,o),p.push(k)),k}function B(D){if(--D.usedTimes===0){const P=p.indexOf(D);p[P]=p[p.length-1],p.pop(),D.destroy()}}function I(D){c.remove(D)}function N(){c.dispose()}return{getParameters:v,getProgramCacheKey:_,getUniforms:C,acquireProgram:R,releaseProgram:B,releaseShaderCache:I,programs:p,dispose:N}}function ate(){let r=new WeakMap;function e(l){return r.has(l)}function i(l){let u=r.get(l);return u===void 0&&(u={},r.set(l,u)),u}function n(l){r.delete(l)}function s(l,u,c){r.get(l)[u]=c}function o(){r=new WeakMap}return{has:e,get:i,remove:n,update:s,dispose:o}}function ote(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.material.id!==e.material.id?r.material.id-e.material.id:r.z!==e.z?r.z-e.z:r.id-e.id}function h4(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.z!==e.z?e.z-r.z:r.id-e.id}function d4(){const r=[];let e=0;const i=[],n=[],s=[];function o(){e=0,i.length=0,n.length=0,s.length=0}function l(f,g,m,y,b,v){let _=r[e];return _===void 0?(_={id:f.id,object:f,geometry:g,material:m,groupOrder:y,renderOrder:f.renderOrder,z:b,group:v},r[e]=_):(_.id=f.id,_.object=f,_.geometry=g,_.material=m,_.groupOrder=y,_.renderOrder=f.renderOrder,_.z=b,_.group=v),e++,_}function u(f,g,m,y,b,v){const _=l(f,g,m,y,b,v);m.transmission>0?n.push(_):m.transparent===!0?s.push(_):i.push(_)}function c(f,g,m,y,b,v){const _=l(f,g,m,y,b,v);m.transmission>0?n.unshift(_):m.transparent===!0?s.unshift(_):i.unshift(_)}function h(f,g){i.length>1&&i.sort(f||ote),n.length>1&&n.sort(g||h4),s.length>1&&s.sort(g||h4)}function p(){for(let f=e,g=r.length;f<g;f++){const m=r[f];if(m.id===null)break;m.id=null,m.object=null,m.geometry=null,m.material=null,m.group=null}}return{opaque:i,transmissive:n,transparent:s,init:o,push:u,unshift:c,finish:p,sort:h}}function lte(){let r=new WeakMap;function e(n,s){const o=r.get(n);let l;return o===void 0?(l=new d4,r.set(n,[l])):s>=o.length?(l=new d4,o.push(l)):l=o[s],l}function i(){r=new WeakMap}return{get:e,dispose:i}}function cte(){const r={};return{get:function(e){if(r[e.id]!==void 0)return r[e.id];let i;switch(e.type){case"DirectionalLight":i={direction:new at,color:new Cn};break;case"SpotLight":i={position:new at,direction:new at,color:new Cn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new at,color:new Cn,distance:0,decay:0};break;case"HemisphereLight":i={direction:new at,skyColor:new Cn,groundColor:new Cn};break;case"RectAreaLight":i={color:new Cn,position:new at,halfWidth:new at,halfHeight:new at};break}return r[e.id]=i,i}}}function ute(){const r={};return{get:function(e){if(r[e.id]!==void 0)return r[e.id];let i;switch(e.type){case"DirectionalLight":i={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ji};break;case"SpotLight":i={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ji};break;case"PointLight":i={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ji,shadowCameraNear:1,shadowCameraFar:1e3};break}return r[e.id]=i,i}}}let hte=0;function dte(r,e){return(e.castShadow?2:0)-(r.castShadow?2:0)+(e.map?1:0)-(r.map?1:0)}function pte(r){const e=new cte,i=ute(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let h=0;h<9;h++)n.probe.push(new at);const s=new at,o=new gs,l=new gs;function u(h){let p=0,f=0,g=0;for(let D=0;D<9;D++)n.probe[D].set(0,0,0);let m=0,y=0,b=0,v=0,_=0,T=0,E=0,C=0,R=0,B=0,I=0;h.sort(dte);for(let D=0,P=h.length;D<P;D++){const k=h[D],q=k.color,V=k.intensity,j=k.distance,Q=k.shadow&&k.shadow.map?k.shadow.map.texture:null;if(k.isAmbientLight)p+=q.r*V,f+=q.g*V,g+=q.b*V;else if(k.isLightProbe){for(let W=0;W<9;W++)n.probe[W].addScaledVector(k.sh.coefficients[W],V);I++}else if(k.isDirectionalLight){const W=e.get(k);if(W.color.copy(k.color).multiplyScalar(k.intensity),k.castShadow){const G=k.shadow,z=i.get(k);z.shadowIntensity=G.intensity,z.shadowBias=G.bias,z.shadowNormalBias=G.normalBias,z.shadowRadius=G.radius,z.shadowMapSize=G.mapSize,n.directionalShadow[m]=z,n.directionalShadowMap[m]=Q,n.directionalShadowMatrix[m]=k.shadow.matrix,T++}n.directional[m]=W,m++}else if(k.isSpotLight){const W=e.get(k);W.position.setFromMatrixPosition(k.matrixWorld),W.color.copy(q).multiplyScalar(V),W.distance=j,W.coneCos=Math.cos(k.angle),W.penumbraCos=Math.cos(k.angle*(1-k.penumbra)),W.decay=k.decay,n.spot[b]=W;const G=k.shadow;if(k.map&&(n.spotLightMap[R]=k.map,R++,G.updateMatrices(k),k.castShadow&&B++),n.spotLightMatrix[b]=G.matrix,k.castShadow){const z=i.get(k);z.shadowIntensity=G.intensity,z.shadowBias=G.bias,z.shadowNormalBias=G.normalBias,z.shadowRadius=G.radius,z.shadowMapSize=G.mapSize,n.spotShadow[b]=z,n.spotShadowMap[b]=Q,C++}b++}else if(k.isRectAreaLight){const W=e.get(k);W.color.copy(q).multiplyScalar(V),W.halfWidth.set(k.width*.5,0,0),W.halfHeight.set(0,k.height*.5,0),n.rectArea[v]=W,v++}else if(k.isPointLight){const W=e.get(k);if(W.color.copy(k.color).multiplyScalar(k.intensity),W.distance=k.distance,W.decay=k.decay,k.castShadow){const G=k.shadow,z=i.get(k);z.shadowIntensity=G.intensity,z.shadowBias=G.bias,z.shadowNormalBias=G.normalBias,z.shadowRadius=G.radius,z.shadowMapSize=G.mapSize,z.shadowCameraNear=G.camera.near,z.shadowCameraFar=G.camera.far,n.pointShadow[y]=z,n.pointShadowMap[y]=Q,n.pointShadowMatrix[y]=k.shadow.matrix,E++}n.point[y]=W,y++}else if(k.isHemisphereLight){const W=e.get(k);W.skyColor.copy(k.color).multiplyScalar(V),W.groundColor.copy(k.groundColor).multiplyScalar(V),n.hemi[_]=W,_++}}v>0&&(r.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=Xi.LTC_FLOAT_1,n.rectAreaLTC2=Xi.LTC_FLOAT_2):(n.rectAreaLTC1=Xi.LTC_HALF_1,n.rectAreaLTC2=Xi.LTC_HALF_2)),n.ambient[0]=p,n.ambient[1]=f,n.ambient[2]=g;const N=n.hash;(N.directionalLength!==m||N.pointLength!==y||N.spotLength!==b||N.rectAreaLength!==v||N.hemiLength!==_||N.numDirectionalShadows!==T||N.numPointShadows!==E||N.numSpotShadows!==C||N.numSpotMaps!==R||N.numLightProbes!==I)&&(n.directional.length=m,n.spot.length=b,n.rectArea.length=v,n.point.length=y,n.hemi.length=_,n.directionalShadow.length=T,n.directionalShadowMap.length=T,n.pointShadow.length=E,n.pointShadowMap.length=E,n.spotShadow.length=C,n.spotShadowMap.length=C,n.directionalShadowMatrix.length=T,n.pointShadowMatrix.length=E,n.spotLightMatrix.length=C+R-B,n.spotLightMap.length=R,n.numSpotLightShadowsWithMaps=B,n.numLightProbes=I,N.directionalLength=m,N.pointLength=y,N.spotLength=b,N.rectAreaLength=v,N.hemiLength=_,N.numDirectionalShadows=T,N.numPointShadows=E,N.numSpotShadows=C,N.numSpotMaps=R,N.numLightProbes=I,n.version=hte++)}function c(h,p){let f=0,g=0,m=0,y=0,b=0;const v=p.matrixWorldInverse;for(let _=0,T=h.length;_<T;_++){const E=h[_];if(E.isDirectionalLight){const C=n.directional[f];C.direction.setFromMatrixPosition(E.matrixWorld),s.setFromMatrixPosition(E.target.matrixWorld),C.direction.sub(s),C.direction.transformDirection(v),f++}else if(E.isSpotLight){const C=n.spot[m];C.position.setFromMatrixPosition(E.matrixWorld),C.position.applyMatrix4(v),C.direction.setFromMatrixPosition(E.matrixWorld),s.setFromMatrixPosition(E.target.matrixWorld),C.direction.sub(s),C.direction.transformDirection(v),m++}else if(E.isRectAreaLight){const C=n.rectArea[y];C.position.setFromMatrixPosition(E.matrixWorld),C.position.applyMatrix4(v),l.identity(),o.copy(E.matrixWorld),o.premultiply(v),l.extractRotation(o),C.halfWidth.set(E.width*.5,0,0),C.halfHeight.set(0,E.height*.5,0),C.halfWidth.applyMatrix4(l),C.halfHeight.applyMatrix4(l),y++}else if(E.isPointLight){const C=n.point[g];C.position.setFromMatrixPosition(E.matrixWorld),C.position.applyMatrix4(v),g++}else if(E.isHemisphereLight){const C=n.hemi[b];C.direction.setFromMatrixPosition(E.matrixWorld),C.direction.transformDirection(v),b++}}}return{setup:u,setupView:c,state:n}}function p4(r){const e=new pte(r),i=[],n=[];function s(p){h.camera=p,i.length=0,n.length=0}function o(p){i.push(p)}function l(p){n.push(p)}function u(){e.setup(i)}function c(p){e.setupView(i,p)}const h={lightsArray:i,shadowsArray:n,camera:null,lights:e,transmissionRenderTarget:{}};return{init:s,state:h,setupLights:u,setupLightsView:c,pushLight:o,pushShadow:l}}function fte(r){let e=new WeakMap;function i(s,o=0){const l=e.get(s);let u;return l===void 0?(u=new p4(r),e.set(s,[u])):o>=l.length?(u=new p4(r),l.push(u)):u=l[o],u}function n(){e=new WeakMap}return{get:i,dispose:n}}class mte extends mp{static get type(){return"MeshDepthMaterial"}constructor(e){super(),this.isMeshDepthMaterial=!0,this.depthPacking=JY,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class gte extends mp{static get type(){return"MeshDistanceMaterial"}constructor(e){super(),this.isMeshDistanceMaterial=!0,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const Ate=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,yte=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function vte(r,e,i){let n=new IS;const s=new ji,o=new ji,l=new Zs,u=new mte({depthPacking:ZY}),c=new gte,h={},p=i.maxTextureSize,f={[Gh]:go,[go]:Gh,[_u]:_u},g=new jc({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ji},radius:{value:4}},vertexShader:Ate,fragmentShader:yte}),m=g.clone();m.defines.HORIZONTAL_PASS=1;const y=new Ao;y.setAttribute("position",new Fo(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const b=new pa(y,g),v=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=VP;let _=this.type;this.render=function(B,I,N){if(v.enabled===!1||v.autoUpdate===!1&&v.needsUpdate===!1||B.length===0)return;const D=r.getRenderTarget(),P=r.getActiveCubeFace(),k=r.getActiveMipmapLevel(),q=r.state;q.setBlending(Eu),q.buffers.color.setClear(1,1,1,1),q.buffers.depth.setTest(!0),q.setScissorTest(!1);const V=_!==xu&&this.type===xu,j=_===xu&&this.type!==xu;for(let Q=0,W=B.length;Q<W;Q++){const G=B[Q],z=G.shadow;if(z===void 0){console.warn("THREE.WebGLShadowMap:",G,"has no shadow.");continue}if(z.autoUpdate===!1&&z.needsUpdate===!1)continue;s.copy(z.mapSize);const te=z.getFrameExtents();if(s.multiply(te),o.copy(z.mapSize),(s.x>p||s.y>p)&&(s.x>p&&(o.x=Math.floor(p/te.x),s.x=o.x*te.x,z.mapSize.x=o.x),s.y>p&&(o.y=Math.floor(p/te.y),s.y=o.y*te.y,z.mapSize.y=o.y)),z.map===null||V===!0||j===!0){const se=this.type!==xu?{minFilter:ic,magFilter:ic}:{};z.map!==null&&z.map.dispose(),z.map=new Qh(s.x,s.y,se),z.map.texture.name=G.name+".shadowMap",z.camera.updateProjectionMatrix()}r.setRenderTarget(z.map),r.clear();const Y=z.getViewportCount();for(let se=0;se<Y;se++){const ve=z.getViewport(se);l.set(o.x*ve.x,o.y*ve.y,o.x*ve.z,o.y*ve.w),q.viewport(l),z.updateMatrices(G,se),n=z.getFrustum(),C(I,N,z.camera,G,this.type)}z.isPointLightShadow!==!0&&this.type===xu&&T(z,N),z.needsUpdate=!1}_=this.type,v.needsUpdate=!1,r.setRenderTarget(D,P,k)};function T(B,I){const N=e.update(b);g.defines.VSM_SAMPLES!==B.blurSamples&&(g.defines.VSM_SAMPLES=B.blurSamples,m.defines.VSM_SAMPLES=B.blurSamples,g.needsUpdate=!0,m.needsUpdate=!0),B.mapPass===null&&(B.mapPass=new Qh(s.x,s.y)),g.uniforms.shadow_pass.value=B.map.texture,g.uniforms.resolution.value=B.mapSize,g.uniforms.radius.value=B.radius,r.setRenderTarget(B.mapPass),r.clear(),r.renderBufferDirect(I,null,N,g,b,null),m.uniforms.shadow_pass.value=B.mapPass.texture,m.uniforms.resolution.value=B.mapSize,m.uniforms.radius.value=B.radius,r.setRenderTarget(B.map),r.clear(),r.renderBufferDirect(I,null,N,m,b,null)}function E(B,I,N,D){let P=null;const k=N.isPointLight===!0?B.customDistanceMaterial:B.customDepthMaterial;if(k!==void 0)P=k;else if(P=N.isPointLight===!0?c:u,r.localClippingEnabled&&I.clipShadows===!0&&Array.isArray(I.clippingPlanes)&&I.clippingPlanes.length!==0||I.displacementMap&&I.displacementScale!==0||I.alphaMap&&I.alphaTest>0||I.map&&I.alphaTest>0){const q=P.uuid,V=I.uuid;let j=h[q];j===void 0&&(j={},h[q]=j);let Q=j[V];Q===void 0&&(Q=P.clone(),j[V]=Q,I.addEventListener("dispose",R)),P=Q}if(P.visible=I.visible,P.wireframe=I.wireframe,D===xu?P.side=I.shadowSide!==null?I.shadowSide:I.side:P.side=I.shadowSide!==null?I.shadowSide:f[I.side],P.alphaMap=I.alphaMap,P.alphaTest=I.alphaTest,P.map=I.map,P.clipShadows=I.clipShadows,P.clippingPlanes=I.clippingPlanes,P.clipIntersection=I.clipIntersection,P.displacementMap=I.displacementMap,P.displacementScale=I.displacementScale,P.displacementBias=I.displacementBias,P.wireframeLinewidth=I.wireframeLinewidth,P.linewidth=I.linewidth,N.isPointLight===!0&&P.isMeshDistanceMaterial===!0){const q=r.properties.get(P);q.light=N}return P}function C(B,I,N,D,P){if(B.visible===!1)return;if(B.layers.test(I.layers)&&(B.isMesh||B.isLine||B.isPoints)&&(B.castShadow||B.receiveShadow&&P===xu)&&(!B.frustumCulled||n.intersectsObject(B))){B.modelViewMatrix.multiplyMatrices(N.matrixWorldInverse,B.matrixWorld);const q=e.update(B),V=B.material;if(Array.isArray(V)){const j=q.groups;for(let Q=0,W=j.length;Q<W;Q++){const G=j[Q],z=V[G.materialIndex];if(z&&z.visible){const te=E(B,z,D,P);B.onBeforeShadow(r,B,I,N,q,te,G),r.renderBufferDirect(N,null,q,te,B,G),B.onAfterShadow(r,B,I,N,q,te,G)}}}else if(V.visible){const j=E(B,V,D,P);B.onBeforeShadow(r,B,I,N,q,j,null),r.renderBufferDirect(N,null,q,j,B,null),B.onAfterShadow(r,B,I,N,q,j,null)}}const k=B.children;for(let q=0,V=k.length;q<V;q++)C(k[q],I,N,D,P)}function R(B){B.target.removeEventListener("dispose",R);for(const I in h){const N=h[I],D=B.target.uuid;D in N&&(N[D].dispose(),delete N[D])}}}const bte={[mC]:gC,[AC]:bC,[yC]:xC,[hm]:vC,[gC]:mC,[bC]:AC,[xC]:yC,[vC]:hm};function xte(r,e){function i(){let ce=!1;const ze=new Zs;let Ve=null;const pt=new Zs(0,0,0,0);return{setMask:function(Dt){Ve!==Dt&&!ce&&(r.colorMask(Dt,Dt,Dt,Dt),Ve=Dt)},setLocked:function(Dt){ce=Dt},setClear:function(Dt,xt,Vt,fi,xr){xr===!0&&(Dt*=fi,xt*=fi,Vt*=fi),ze.set(Dt,xt,Vt,fi),pt.equals(ze)===!1&&(r.clearColor(Dt,xt,Vt,fi),pt.copy(ze))},reset:function(){ce=!1,Ve=null,pt.set(-1,0,0,0)}}}function n(){let ce=!1,ze=!1,Ve=null,pt=null,Dt=null;return{setReversed:function(xt){if(ze!==xt){const Vt=e.get("EXT_clip_control");ze?Vt.clipControlEXT(Vt.LOWER_LEFT_EXT,Vt.ZERO_TO_ONE_EXT):Vt.clipControlEXT(Vt.LOWER_LEFT_EXT,Vt.NEGATIVE_ONE_TO_ONE_EXT);const fi=Dt;Dt=null,this.setClear(fi)}ze=xt},getReversed:function(){return ze},setTest:function(xt){xt?Je(r.DEPTH_TEST):it(r.DEPTH_TEST)},setMask:function(xt){Ve!==xt&&!ce&&(r.depthMask(xt),Ve=xt)},setFunc:function(xt){if(ze&&(xt=bte[xt]),pt!==xt){switch(xt){case mC:r.depthFunc(r.NEVER);break;case gC:r.depthFunc(r.ALWAYS);break;case AC:r.depthFunc(r.LESS);break;case hm:r.depthFunc(r.LEQUAL);break;case yC:r.depthFunc(r.EQUAL);break;case vC:r.depthFunc(r.GEQUAL);break;case bC:r.depthFunc(r.GREATER);break;case xC:r.depthFunc(r.NOTEQUAL);break;default:r.depthFunc(r.LEQUAL)}pt=xt}},setLocked:function(xt){ce=xt},setClear:function(xt){Dt!==xt&&(ze&&(xt=1-xt),r.clearDepth(xt),Dt=xt)},reset:function(){ce=!1,Ve=null,pt=null,Dt=null,ze=!1}}}function s(){let ce=!1,ze=null,Ve=null,pt=null,Dt=null,xt=null,Vt=null,fi=null,xr=null;return{setTest:function(ki){ce||(ki?Je(r.STENCIL_TEST):it(r.STENCIL_TEST))},setMask:function(ki){ze!==ki&&!ce&&(r.stencilMask(ki),ze=ki)},setFunc:function(ki,mn,kr){(Ve!==ki||pt!==mn||Dt!==kr)&&(r.stencilFunc(ki,mn,kr),Ve=ki,pt=mn,Dt=kr)},setOp:function(ki,mn,kr){(xt!==ki||Vt!==mn||fi!==kr)&&(r.stencilOp(ki,mn,kr),xt=ki,Vt=mn,fi=kr)},setLocked:function(ki){ce=ki},setClear:function(ki){xr!==ki&&(r.clearStencil(ki),xr=ki)},reset:function(){ce=!1,ze=null,Ve=null,pt=null,Dt=null,xt=null,Vt=null,fi=null,xr=null}}}const o=new i,l=new n,u=new s,c=new WeakMap,h=new WeakMap;let p={},f={},g=new WeakMap,m=[],y=null,b=!1,v=null,_=null,T=null,E=null,C=null,R=null,B=null,I=new Cn(0,0,0),N=0,D=!1,P=null,k=null,q=null,V=null,j=null;const Q=r.getParameter(r.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let W=!1,G=0;const z=r.getParameter(r.VERSION);z.indexOf("WebGL")!==-1?(G=parseFloat(/^WebGL (\d)/.exec(z)[1]),W=G>=1):z.indexOf("OpenGL ES")!==-1&&(G=parseFloat(/^OpenGL ES (\d)/.exec(z)[1]),W=G>=2);let te=null,Y={};const se=r.getParameter(r.SCISSOR_BOX),ve=r.getParameter(r.VIEWPORT),Ae=new Zs().fromArray(se),me=new Zs().fromArray(ve);function Oe(ce,ze,Ve,pt){const Dt=new Uint8Array(4),xt=r.createTexture();r.bindTexture(ce,xt),r.texParameteri(ce,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(ce,r.TEXTURE_MAG_FILTER,r.NEAREST);for(let Vt=0;Vt<Ve;Vt++)ce===r.TEXTURE_3D||ce===r.TEXTURE_2D_ARRAY?r.texImage3D(ze,0,r.RGBA,1,1,pt,0,r.RGBA,r.UNSIGNED_BYTE,Dt):r.texImage2D(ze+Vt,0,r.RGBA,1,1,0,r.RGBA,r.UNSIGNED_BYTE,Dt);return xt}const Xe={};Xe[r.TEXTURE_2D]=Oe(r.TEXTURE_2D,r.TEXTURE_2D,1),Xe[r.TEXTURE_CUBE_MAP]=Oe(r.TEXTURE_CUBE_MAP,r.TEXTURE_CUBE_MAP_POSITIVE_X,6),Xe[r.TEXTURE_2D_ARRAY]=Oe(r.TEXTURE_2D_ARRAY,r.TEXTURE_2D_ARRAY,1,1),Xe[r.TEXTURE_3D]=Oe(r.TEXTURE_3D,r.TEXTURE_3D,1,1),o.setClear(0,0,0,1),l.setClear(1),u.setClear(0),Je(r.DEPTH_TEST),l.setFunc(hm),ui(!1),Si(jP),Je(r.CULL_FACE),$e(Eu);function Je(ce){p[ce]!==!0&&(r.enable(ce),p[ce]=!0)}function it(ce){p[ce]!==!1&&(r.disable(ce),p[ce]=!1)}function dt(ce,ze){return f[ce]!==ze?(r.bindFramebuffer(ce,ze),f[ce]=ze,ce===r.DRAW_FRAMEBUFFER&&(f[r.FRAMEBUFFER]=ze),ce===r.FRAMEBUFFER&&(f[r.DRAW_FRAMEBUFFER]=ze),!0):!1}function St(ce,ze){let Ve=m,pt=!1;if(ce){Ve=g.get(ze),Ve===void 0&&(Ve=[],g.set(ze,Ve));const Dt=ce.textures;if(Ve.length!==Dt.length||Ve[0]!==r.COLOR_ATTACHMENT0){for(let xt=0,Vt=Dt.length;xt<Vt;xt++)Ve[xt]=r.COLOR_ATTACHMENT0+xt;Ve.length=Dt.length,pt=!0}}else Ve[0]!==r.BACK&&(Ve[0]=r.BACK,pt=!0);pt&&r.drawBuffers(Ve)}function Qt(ce){return y!==ce?(r.useProgram(ce),y=ce,!0):!1}const yt={[ap]:r.FUNC_ADD,[wY]:r.FUNC_SUBTRACT,[CY]:r.FUNC_REVERSE_SUBTRACT};yt[SY]=r.MIN,yt[TY]=r.MAX;const bi={[MY]:r.ZERO,[RY]:r.ONE,[IY]:r.SRC_COLOR,[pC]:r.SRC_ALPHA,[OY]:r.SRC_ALPHA_SATURATE,[NY]:r.DST_COLOR,[LY]:r.DST_ALPHA,[BY]:r.ONE_MINUS_SRC_COLOR,[fC]:r.ONE_MINUS_SRC_ALPHA,[PY]:r.ONE_MINUS_DST_COLOR,[DY]:r.ONE_MINUS_DST_ALPHA,[kY]:r.CONSTANT_COLOR,[FY]:r.ONE_MINUS_CONSTANT_COLOR,[UY]:r.CONSTANT_ALPHA,[zY]:r.ONE_MINUS_CONSTANT_ALPHA};function $e(ce,ze,Ve,pt,Dt,xt,Vt,fi,xr,ki){if(ce===Eu){b===!0&&(it(r.BLEND),b=!1);return}if(b===!1&&(Je(r.BLEND),b=!0),ce!==EY){if(ce!==v||ki!==D){if((_!==ap||C!==ap)&&(r.blendEquation(r.FUNC_ADD),_=ap,C=ap),ki)switch(ce){case um:r.blendFuncSeparate(r.ONE,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA);break;case GP:r.blendFunc(r.ONE,r.ONE);break;case HP:r.blendFuncSeparate(r.ZERO,r.ONE_MINUS_SRC_COLOR,r.ZERO,r.ONE);break;case WP:r.blendFuncSeparate(r.ZERO,r.SRC_COLOR,r.ZERO,r.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",ce);break}else switch(ce){case um:r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA);break;case GP:r.blendFunc(r.SRC_ALPHA,r.ONE);break;case HP:r.blendFuncSeparate(r.ZERO,r.ONE_MINUS_SRC_COLOR,r.ZERO,r.ONE);break;case WP:r.blendFunc(r.ZERO,r.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",ce);break}T=null,E=null,R=null,B=null,I.set(0,0,0),N=0,v=ce,D=ki}return}Dt=Dt||ze,xt=xt||Ve,Vt=Vt||pt,(ze!==_||Dt!==C)&&(r.blendEquationSeparate(yt[ze],yt[Dt]),_=ze,C=Dt),(Ve!==T||pt!==E||xt!==R||Vt!==B)&&(r.blendFuncSeparate(bi[Ve],bi[pt],bi[xt],bi[Vt]),T=Ve,E=pt,R=xt,B=Vt),(fi.equals(I)===!1||xr!==N)&&(r.blendColor(fi.r,fi.g,fi.b,xr),I.copy(fi),N=xr),v=ce,D=!1}function Fi(ce,ze){ce.side===_u?it(r.CULL_FACE):Je(r.CULL_FACE);let Ve=ce.side===go;ze&&(Ve=!Ve),ui(Ve),ce.blending===um&&ce.transparent===!1?$e(Eu):$e(ce.blending,ce.blendEquation,ce.blendSrc,ce.blendDst,ce.blendEquationAlpha,ce.blendSrcAlpha,ce.blendDstAlpha,ce.blendColor,ce.blendAlpha,ce.premultipliedAlpha),l.setFunc(ce.depthFunc),l.setTest(ce.depthTest),l.setMask(ce.depthWrite),o.setMask(ce.colorWrite);const pt=ce.stencilWrite;u.setTest(pt),pt&&(u.setMask(ce.stencilWriteMask),u.setFunc(ce.stencilFunc,ce.stencilRef,ce.stencilFuncMask),u.setOp(ce.stencilFail,ce.stencilZFail,ce.stencilZPass)),Zi(ce.polygonOffset,ce.polygonOffsetFactor,ce.polygonOffsetUnits),ce.alphaToCoverage===!0?Je(r.SAMPLE_ALPHA_TO_COVERAGE):it(r.SAMPLE_ALPHA_TO_COVERAGE)}function ui(ce){P!==ce&&(ce?r.frontFace(r.CW):r.frontFace(r.CCW),P=ce)}function Si(ce){ce!==bY?(Je(r.CULL_FACE),ce!==k&&(ce===jP?r.cullFace(r.BACK):ce===xY?r.cullFace(r.FRONT):r.cullFace(r.FRONT_AND_BACK))):it(r.CULL_FACE),k=ce}function Ei(ce){ce!==q&&(W&&r.lineWidth(ce),q=ce)}function Zi(ce,ze,Ve){ce?(Je(r.POLYGON_OFFSET_FILL),(V!==ze||j!==Ve)&&(r.polygonOffset(ze,Ve),V=ze,j=Ve)):it(r.POLYGON_OFFSET_FILL)}function Vi(ce){ce?Je(r.SCISSOR_TEST):it(r.SCISSOR_TEST)}function We(ce){ce===void 0&&(ce=r.TEXTURE0+Q-1),te!==ce&&(r.activeTexture(ce),te=ce)}function Ce(ce,ze,Ve){Ve===void 0&&(te===null?Ve=r.TEXTURE0+Q-1:Ve=te);let pt=Y[Ve];pt===void 0&&(pt={type:void 0,texture:void 0},Y[Ve]=pt),(pt.type!==ce||pt.texture!==ze)&&(te!==Ve&&(r.activeTexture(Ve),te=Ve),r.bindTexture(ce,ze||Xe[ce]),pt.type=ce,pt.texture=ze)}function At(){const ce=Y[te];ce!==void 0&&ce.type!==void 0&&(r.bindTexture(ce.type,null),ce.type=void 0,ce.texture=void 0)}function Ot(){try{r.compressedTexImage2D.apply(r,arguments)}catch(ce){console.error("THREE.WebGLState:",ce)}}function Zt(){try{r.compressedTexImage3D.apply(r,arguments)}catch(ce){console.error("THREE.WebGLState:",ce)}}function jt(){try{r.texSubImage2D.apply(r,arguments)}catch(ce){console.error("THREE.WebGLState:",ce)}}function xi(){try{r.texSubImage3D.apply(r,arguments)}catch(ce){console.error("THREE.WebGLState:",ce)}}function vt(){try{r.compressedTexSubImage2D.apply(r,arguments)}catch(ce){console.error("THREE.WebGLState:",ce)}}function ge(){try{r.compressedTexSubImage3D.apply(r,arguments)}catch(ce){console.error("THREE.WebGLState:",ce)}}function be(){try{r.texStorage2D.apply(r,arguments)}catch(ce){console.error("THREE.WebGLState:",ce)}}function Ne(){try{r.texStorage3D.apply(r,arguments)}catch(ce){console.error("THREE.WebGLState:",ce)}}function Se(){try{r.texImage2D.apply(r,arguments)}catch(ce){console.error("THREE.WebGLState:",ce)}}function Fe(){try{r.texImage3D.apply(r,arguments)}catch(ce){console.error("THREE.WebGLState:",ce)}}function Ie(ce){Ae.equals(ce)===!1&&(r.scissor(ce.x,ce.y,ce.z,ce.w),Ae.copy(ce))}function U(ce){me.equals(ce)===!1&&(r.viewport(ce.x,ce.y,ce.z,ce.w),me.copy(ce))}function $(ce,ze){let Ve=h.get(ze);Ve===void 0&&(Ve=new WeakMap,h.set(ze,Ve));let pt=Ve.get(ce);pt===void 0&&(pt=r.getUniformBlockIndex(ze,ce.name),Ve.set(ce,pt))}function re(ce,ze){const Ve=h.get(ze).get(ce);c.get(ze)!==Ve&&(r.uniformBlockBinding(ze,Ve,ce.__bindingPointIndex),c.set(ze,Ve))}function Me(){r.disable(r.BLEND),r.disable(r.CULL_FACE),r.disable(r.DEPTH_TEST),r.disable(r.POLYGON_OFFSET_FILL),r.disable(r.SCISSOR_TEST),r.disable(r.STENCIL_TEST),r.disable(r.SAMPLE_ALPHA_TO_COVERAGE),r.blendEquation(r.FUNC_ADD),r.blendFunc(r.ONE,r.ZERO),r.blendFuncSeparate(r.ONE,r.ZERO,r.ONE,r.ZERO),r.blendColor(0,0,0,0),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0),r.depthMask(!0),r.depthFunc(r.LESS),l.setReversed(!1),r.clearDepth(1),r.stencilMask(4294967295),r.stencilFunc(r.ALWAYS,0,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.KEEP),r.clearStencil(0),r.cullFace(r.BACK),r.frontFace(r.CCW),r.polygonOffset(0,0),r.activeTexture(r.TEXTURE0),r.bindFramebuffer(r.FRAMEBUFFER,null),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,null),r.bindFramebuffer(r.READ_FRAMEBUFFER,null),r.useProgram(null),r.lineWidth(1),r.scissor(0,0,r.canvas.width,r.canvas.height),r.viewport(0,0,r.canvas.width,r.canvas.height),p={},te=null,Y={},f={},g=new WeakMap,m=[],y=null,b=!1,v=null,_=null,T=null,E=null,C=null,R=null,B=null,I=new Cn(0,0,0),N=0,D=!1,P=null,k=null,q=null,V=null,j=null,Ae.set(0,0,r.canvas.width,r.canvas.height),me.set(0,0,r.canvas.width,r.canvas.height),o.reset(),l.reset(),u.reset()}return{buffers:{color:o,depth:l,stencil:u},enable:Je,disable:it,bindFramebuffer:dt,drawBuffers:St,useProgram:Qt,setBlending:$e,setMaterial:Fi,setFlipSided:ui,setCullFace:Si,setLineWidth:Ei,setPolygonOffset:Zi,setScissorTest:Vi,activeTexture:We,bindTexture:Ce,unbindTexture:At,compressedTexImage2D:Ot,compressedTexImage3D:Zt,texImage2D:Se,texImage3D:Fe,updateUBOMapping:$,uniformBlockBinding:re,texStorage2D:be,texStorage3D:Ne,texSubImage2D:jt,texSubImage3D:xi,compressedTexSubImage2D:vt,compressedTexSubImage3D:ge,scissor:Ie,viewport:U,reset:Me}}function f4(r,e,i,n){const s=_te(n);switch(i){case KP:return r*e;case ZP:return r*e;case $P:return r*e*2;case eO:return r*e/s.components*s.byteLength;case BC:return r*e/s.components*s.byteLength;case tO:return r*e*2/s.components*s.byteLength;case LC:return r*e*2/s.components*s.byteLength;case JP:return r*e*3/s.components*s.byteLength;case rc:return r*e*4/s.components*s.byteLength;case DC:return r*e*4/s.components*s.byteLength;case Qb:case qb:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*8;case Xb:case Yb:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*16;case PC:case kC:return Math.max(r,16)*Math.max(e,8)/4;case NC:case OC:return Math.max(r,8)*Math.max(e,8)/2;case FC:case UC:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*8;case zC:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*16;case jC:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*16;case VC:return Math.floor((r+4)/5)*Math.floor((e+3)/4)*16;case GC:return Math.floor((r+4)/5)*Math.floor((e+4)/5)*16;case HC:return Math.floor((r+5)/6)*Math.floor((e+4)/5)*16;case WC:return Math.floor((r+5)/6)*Math.floor((e+5)/6)*16;case QC:return Math.floor((r+7)/8)*Math.floor((e+4)/5)*16;case qC:return Math.floor((r+7)/8)*Math.floor((e+5)/6)*16;case XC:return Math.floor((r+7)/8)*Math.floor((e+7)/8)*16;case YC:return Math.floor((r+9)/10)*Math.floor((e+4)/5)*16;case KC:return Math.floor((r+9)/10)*Math.floor((e+5)/6)*16;case JC:return Math.floor((r+9)/10)*Math.floor((e+7)/8)*16;case ZC:return Math.floor((r+9)/10)*Math.floor((e+9)/10)*16;case $C:return Math.floor((r+11)/12)*Math.floor((e+9)/10)*16;case eS:return Math.floor((r+11)/12)*Math.floor((e+11)/12)*16;case Kb:case tS:case iS:return Math.ceil(r/4)*Math.ceil(e/4)*16;case iO:case rS:return Math.ceil(r/4)*Math.ceil(e/4)*8;case nS:case sS:return Math.ceil(r/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${i} format.`)}function _te(r){switch(r){case wu:case qP:return{byteLength:1,components:1};case cA:case XP:case fm:return{byteLength:2,components:1};case RC:case IC:return{byteLength:2,components:4};case cp:case MC:case Cu:return{byteLength:4,components:1};case YP:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${r}.`)}function Ete(r,e,i,n,s,o,l){const u=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,c=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),h=new ji,p=new WeakMap;let f;const g=new WeakMap;let m=!1;try{m=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function y(We,Ce){return m?new OffscreenCanvas(We,Ce):pA("canvas")}function b(We,Ce,At){let Ot=1;const Zt=Vi(We);if((Zt.width>At||Zt.height>At)&&(Ot=At/Math.max(Zt.width,Zt.height)),Ot<1)if(typeof HTMLImageElement<"u"&&We instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&We instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&We instanceof ImageBitmap||typeof VideoFrame<"u"&&We instanceof VideoFrame){const jt=Math.floor(Ot*Zt.width),xi=Math.floor(Ot*Zt.height);f===void 0&&(f=y(jt,xi));const vt=Ce?y(jt,xi):f;return vt.width=jt,vt.height=xi,vt.getContext("2d").drawImage(We,0,0,jt,xi),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Zt.width+"x"+Zt.height+") to ("+jt+"x"+xi+")."),vt}else return"data"in We&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Zt.width+"x"+Zt.height+")."),We;return We}function v(We){return We.generateMipmaps}function _(We){r.generateMipmap(We)}function T(We){return We.isWebGLCubeRenderTarget?r.TEXTURE_CUBE_MAP:We.isWebGL3DRenderTarget?r.TEXTURE_3D:We.isWebGLArrayRenderTarget||We.isCompressedArrayTexture?r.TEXTURE_2D_ARRAY:r.TEXTURE_2D}function E(We,Ce,At,Ot,Zt=!1){if(We!==null){if(r[We]!==void 0)return r[We];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+We+"'")}let jt=Ce;if(Ce===r.RED&&(At===r.FLOAT&&(jt=r.R32F),At===r.HALF_FLOAT&&(jt=r.R16F),At===r.UNSIGNED_BYTE&&(jt=r.R8)),Ce===r.RED_INTEGER&&(At===r.UNSIGNED_BYTE&&(jt=r.R8UI),At===r.UNSIGNED_SHORT&&(jt=r.R16UI),At===r.UNSIGNED_INT&&(jt=r.R32UI),At===r.BYTE&&(jt=r.R8I),At===r.SHORT&&(jt=r.R16I),At===r.INT&&(jt=r.R32I)),Ce===r.RG&&(At===r.FLOAT&&(jt=r.RG32F),At===r.HALF_FLOAT&&(jt=r.RG16F),At===r.UNSIGNED_BYTE&&(jt=r.RG8)),Ce===r.RG_INTEGER&&(At===r.UNSIGNED_BYTE&&(jt=r.RG8UI),At===r.UNSIGNED_SHORT&&(jt=r.RG16UI),At===r.UNSIGNED_INT&&(jt=r.RG32UI),At===r.BYTE&&(jt=r.RG8I),At===r.SHORT&&(jt=r.RG16I),At===r.INT&&(jt=r.RG32I)),Ce===r.RGB_INTEGER&&(At===r.UNSIGNED_BYTE&&(jt=r.RGB8UI),At===r.UNSIGNED_SHORT&&(jt=r.RGB16UI),At===r.UNSIGNED_INT&&(jt=r.RGB32UI),At===r.BYTE&&(jt=r.RGB8I),At===r.SHORT&&(jt=r.RGB16I),At===r.INT&&(jt=r.RGB32I)),Ce===r.RGBA_INTEGER&&(At===r.UNSIGNED_BYTE&&(jt=r.RGBA8UI),At===r.UNSIGNED_SHORT&&(jt=r.RGBA16UI),At===r.UNSIGNED_INT&&(jt=r.RGBA32UI),At===r.BYTE&&(jt=r.RGBA8I),At===r.SHORT&&(jt=r.RGBA16I),At===r.INT&&(jt=r.RGBA32I)),Ce===r.RGB&&At===r.UNSIGNED_INT_5_9_9_9_REV&&(jt=r.RGB9_E5),Ce===r.RGBA){const xi=Zt?Jb:kn.getTransfer(Ot);At===r.FLOAT&&(jt=r.RGBA32F),At===r.HALF_FLOAT&&(jt=r.RGBA16F),At===r.UNSIGNED_BYTE&&(jt=xi===as?r.SRGB8_ALPHA8:r.RGBA8),At===r.UNSIGNED_SHORT_4_4_4_4&&(jt=r.RGBA4),At===r.UNSIGNED_SHORT_5_5_5_1&&(jt=r.RGB5_A1)}return(jt===r.R16F||jt===r.R32F||jt===r.RG16F||jt===r.RG32F||jt===r.RGBA16F||jt===r.RGBA32F)&&e.get("EXT_color_buffer_float"),jt}function C(We,Ce){let At;return We?Ce===null||Ce===cp||Ce===mm?At=r.DEPTH24_STENCIL8:Ce===Cu?At=r.DEPTH32F_STENCIL8:Ce===cA&&(At=r.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):Ce===null||Ce===cp||Ce===mm?At=r.DEPTH_COMPONENT24:Ce===Cu?At=r.DEPTH_COMPONENT32F:Ce===cA&&(At=r.DEPTH_COMPONENT16),At}function R(We,Ce){return v(We)===!0||We.isFramebufferTexture&&We.minFilter!==ic&&We.minFilter!==Uc?Math.log2(Math.max(Ce.width,Ce.height))+1:We.mipmaps!==void 0&&We.mipmaps.length>0?We.mipmaps.length:We.isCompressedTexture&&Array.isArray(We.image)?Ce.mipmaps.length:1}function B(We){const Ce=We.target;Ce.removeEventListener("dispose",B),N(Ce),Ce.isVideoTexture&&p.delete(Ce)}function I(We){const Ce=We.target;Ce.removeEventListener("dispose",I),P(Ce)}function N(We){const Ce=n.get(We);if(Ce.__webglInit===void 0)return;const At=We.source,Ot=g.get(At);if(Ot){const Zt=Ot[Ce.__cacheKey];Zt.usedTimes--,Zt.usedTimes===0&&D(We),Object.keys(Ot).length===0&&g.delete(At)}n.remove(We)}function D(We){const Ce=n.get(We);r.deleteTexture(Ce.__webglTexture);const At=We.source,Ot=g.get(At);delete Ot[Ce.__cacheKey],l.memory.textures--}function P(We){const Ce=n.get(We);if(We.depthTexture&&(We.depthTexture.dispose(),n.remove(We.depthTexture)),We.isWebGLCubeRenderTarget)for(let Ot=0;Ot<6;Ot++){if(Array.isArray(Ce.__webglFramebuffer[Ot]))for(let Zt=0;Zt<Ce.__webglFramebuffer[Ot].length;Zt++)r.deleteFramebuffer(Ce.__webglFramebuffer[Ot][Zt]);else r.deleteFramebuffer(Ce.__webglFramebuffer[Ot]);Ce.__webglDepthbuffer&&r.deleteRenderbuffer(Ce.__webglDepthbuffer[Ot])}else{if(Array.isArray(Ce.__webglFramebuffer))for(let Ot=0;Ot<Ce.__webglFramebuffer.length;Ot++)r.deleteFramebuffer(Ce.__webglFramebuffer[Ot]);else r.deleteFramebuffer(Ce.__webglFramebuffer);if(Ce.__webglDepthbuffer&&r.deleteRenderbuffer(Ce.__webglDepthbuffer),Ce.__webglMultisampledFramebuffer&&r.deleteFramebuffer(Ce.__webglMultisampledFramebuffer),Ce.__webglColorRenderbuffer)for(let Ot=0;Ot<Ce.__webglColorRenderbuffer.length;Ot++)Ce.__webglColorRenderbuffer[Ot]&&r.deleteRenderbuffer(Ce.__webglColorRenderbuffer[Ot]);Ce.__webglDepthRenderbuffer&&r.deleteRenderbuffer(Ce.__webglDepthRenderbuffer)}const At=We.textures;for(let Ot=0,Zt=At.length;Ot<Zt;Ot++){const jt=n.get(At[Ot]);jt.__webglTexture&&(r.deleteTexture(jt.__webglTexture),l.memory.textures--),n.remove(At[Ot])}n.remove(We)}let k=0;function q(){k=0}function V(){const We=k;return We>=s.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+We+" texture units while this GPU supports only "+s.maxTextures),k+=1,We}function j(We){const Ce=[];return Ce.push(We.wrapS),Ce.push(We.wrapT),Ce.push(We.wrapR||0),Ce.push(We.magFilter),Ce.push(We.minFilter),Ce.push(We.anisotropy),Ce.push(We.internalFormat),Ce.push(We.format),Ce.push(We.type),Ce.push(We.generateMipmaps),Ce.push(We.premultiplyAlpha),Ce.push(We.flipY),Ce.push(We.unpackAlignment),Ce.push(We.colorSpace),Ce.join()}function Q(We,Ce){const At=n.get(We);if(We.isVideoTexture&&Ei(We),We.isRenderTargetTexture===!1&&We.version>0&&At.__version!==We.version){const Ot=We.image;if(Ot===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Ot.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{me(At,We,Ce);return}}i.bindTexture(r.TEXTURE_2D,At.__webglTexture,r.TEXTURE0+Ce)}function W(We,Ce){const At=n.get(We);if(We.version>0&&At.__version!==We.version){me(At,We,Ce);return}i.bindTexture(r.TEXTURE_2D_ARRAY,At.__webglTexture,r.TEXTURE0+Ce)}function G(We,Ce){const At=n.get(We);if(We.version>0&&At.__version!==We.version){me(At,We,Ce);return}i.bindTexture(r.TEXTURE_3D,At.__webglTexture,r.TEXTURE0+Ce)}function z(We,Ce){const At=n.get(We);if(We.version>0&&At.__version!==We.version){Oe(At,We,Ce);return}i.bindTexture(r.TEXTURE_CUBE_MAP,At.__webglTexture,r.TEXTURE0+Ce)}const te={[CC]:r.REPEAT,[op]:r.CLAMP_TO_EDGE,[SC]:r.MIRRORED_REPEAT},Y={[ic]:r.NEAREST,[KY]:r.NEAREST_MIPMAP_NEAREST,[Wb]:r.NEAREST_MIPMAP_LINEAR,[Uc]:r.LINEAR,[TC]:r.LINEAR_MIPMAP_NEAREST,[lp]:r.LINEAR_MIPMAP_LINEAR},se={[eK]:r.NEVER,[aK]:r.ALWAYS,[tK]:r.LESS,[sO]:r.LEQUAL,[iK]:r.EQUAL,[sK]:r.GEQUAL,[rK]:r.GREATER,[nK]:r.NOTEQUAL};function ve(We,Ce){if(Ce.type===Cu&&e.has("OES_texture_float_linear")===!1&&(Ce.magFilter===Uc||Ce.magFilter===TC||Ce.magFilter===Wb||Ce.magFilter===lp||Ce.minFilter===Uc||Ce.minFilter===TC||Ce.minFilter===Wb||Ce.minFilter===lp)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),r.texParameteri(We,r.TEXTURE_WRAP_S,te[Ce.wrapS]),r.texParameteri(We,r.TEXTURE_WRAP_T,te[Ce.wrapT]),(We===r.TEXTURE_3D||We===r.TEXTURE_2D_ARRAY)&&r.texParameteri(We,r.TEXTURE_WRAP_R,te[Ce.wrapR]),r.texParameteri(We,r.TEXTURE_MAG_FILTER,Y[Ce.magFilter]),r.texParameteri(We,r.TEXTURE_MIN_FILTER,Y[Ce.minFilter]),Ce.compareFunction&&(r.texParameteri(We,r.TEXTURE_COMPARE_MODE,r.COMPARE_REF_TO_TEXTURE),r.texParameteri(We,r.TEXTURE_COMPARE_FUNC,se[Ce.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(Ce.magFilter===ic||Ce.minFilter!==Wb&&Ce.minFilter!==lp||Ce.type===Cu&&e.has("OES_texture_float_linear")===!1)return;if(Ce.anisotropy>1||n.get(Ce).__currentAnisotropy){const At=e.get("EXT_texture_filter_anisotropic");r.texParameterf(We,At.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Ce.anisotropy,s.getMaxAnisotropy())),n.get(Ce).__currentAnisotropy=Ce.anisotropy}}}function Ae(We,Ce){let At=!1;We.__webglInit===void 0&&(We.__webglInit=!0,Ce.addEventListener("dispose",B));const Ot=Ce.source;let Zt=g.get(Ot);Zt===void 0&&(Zt={},g.set(Ot,Zt));const jt=j(Ce);if(jt!==We.__cacheKey){Zt[jt]===void 0&&(Zt[jt]={texture:r.createTexture(),usedTimes:0},l.memory.textures++,At=!0),Zt[jt].usedTimes++;const xi=Zt[We.__cacheKey];xi!==void 0&&(Zt[We.__cacheKey].usedTimes--,xi.usedTimes===0&&D(Ce)),We.__cacheKey=jt,We.__webglTexture=Zt[jt].texture}return At}function me(We,Ce,At){let Ot=r.TEXTURE_2D;(Ce.isDataArrayTexture||Ce.isCompressedArrayTexture)&&(Ot=r.TEXTURE_2D_ARRAY),Ce.isData3DTexture&&(Ot=r.TEXTURE_3D);const Zt=Ae(We,Ce),jt=Ce.source;i.bindTexture(Ot,We.__webglTexture,r.TEXTURE0+At);const xi=n.get(jt);if(jt.version!==xi.__version||Zt===!0){i.activeTexture(r.TEXTURE0+At);const vt=kn.getPrimaries(kn.workingColorSpace),ge=Ce.colorSpace===Wh?null:kn.getPrimaries(Ce.colorSpace),be=Ce.colorSpace===Wh||vt===ge?r.NONE:r.BROWSER_DEFAULT_WEBGL;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,Ce.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ce.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,Ce.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,be);let Ne=b(Ce.image,!1,s.maxTextureSize);Ne=Zi(Ce,Ne);const Se=o.convert(Ce.format,Ce.colorSpace),Fe=o.convert(Ce.type);let Ie=E(Ce.internalFormat,Se,Fe,Ce.colorSpace,Ce.isVideoTexture);ve(Ot,Ce);let U;const $=Ce.mipmaps,re=Ce.isVideoTexture!==!0,Me=xi.__version===void 0||Zt===!0,ce=jt.dataReady,ze=R(Ce,Ne);if(Ce.isDepthTexture)Ie=C(Ce.format===Am,Ce.type),Me&&(re?i.texStorage2D(r.TEXTURE_2D,1,Ie,Ne.width,Ne.height):i.texImage2D(r.TEXTURE_2D,0,Ie,Ne.width,Ne.height,0,Se,Fe,null));else if(Ce.isDataTexture)if($.length>0){re&&Me&&i.texStorage2D(r.TEXTURE_2D,ze,Ie,$[0].width,$[0].height);for(let Ve=0,pt=$.length;Ve<pt;Ve++)U=$[Ve],re?ce&&i.texSubImage2D(r.TEXTURE_2D,Ve,0,0,U.width,U.height,Se,Fe,U.data):i.texImage2D(r.TEXTURE_2D,Ve,Ie,U.width,U.height,0,Se,Fe,U.data);Ce.generateMipmaps=!1}else re?(Me&&i.texStorage2D(r.TEXTURE_2D,ze,Ie,Ne.width,Ne.height),ce&&i.texSubImage2D(r.TEXTURE_2D,0,0,0,Ne.width,Ne.height,Se,Fe,Ne.data)):i.texImage2D(r.TEXTURE_2D,0,Ie,Ne.width,Ne.height,0,Se,Fe,Ne.data);else if(Ce.isCompressedTexture)if(Ce.isCompressedArrayTexture){re&&Me&&i.texStorage3D(r.TEXTURE_2D_ARRAY,ze,Ie,$[0].width,$[0].height,Ne.depth);for(let Ve=0,pt=$.length;Ve<pt;Ve++)if(U=$[Ve],Ce.format!==rc)if(Se!==null)if(re){if(ce)if(Ce.layerUpdates.size>0){const Dt=f4(U.width,U.height,Ce.format,Ce.type);for(const xt of Ce.layerUpdates){const Vt=U.data.subarray(xt*Dt/U.data.BYTES_PER_ELEMENT,(xt+1)*Dt/U.data.BYTES_PER_ELEMENT);i.compressedTexSubImage3D(r.TEXTURE_2D_ARRAY,Ve,0,0,xt,U.width,U.height,1,Se,Vt)}Ce.clearLayerUpdates()}else i.compressedTexSubImage3D(r.TEXTURE_2D_ARRAY,Ve,0,0,0,U.width,U.height,Ne.depth,Se,U.data)}else i.compressedTexImage3D(r.TEXTURE_2D_ARRAY,Ve,Ie,U.width,U.height,Ne.depth,0,U.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else re?ce&&i.texSubImage3D(r.TEXTURE_2D_ARRAY,Ve,0,0,0,U.width,U.height,Ne.depth,Se,Fe,U.data):i.texImage3D(r.TEXTURE_2D_ARRAY,Ve,Ie,U.width,U.height,Ne.depth,0,Se,Fe,U.data)}else{re&&Me&&i.texStorage2D(r.TEXTURE_2D,ze,Ie,$[0].width,$[0].height);for(let Ve=0,pt=$.length;Ve<pt;Ve++)U=$[Ve],Ce.format!==rc?Se!==null?re?ce&&i.compressedTexSubImage2D(r.TEXTURE_2D,Ve,0,0,U.width,U.height,Se,U.data):i.compressedTexImage2D(r.TEXTURE_2D,Ve,Ie,U.width,U.height,0,U.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):re?ce&&i.texSubImage2D(r.TEXTURE_2D,Ve,0,0,U.width,U.height,Se,Fe,U.data):i.texImage2D(r.TEXTURE_2D,Ve,Ie,U.width,U.height,0,Se,Fe,U.data)}else if(Ce.isDataArrayTexture)if(re){if(Me&&i.texStorage3D(r.TEXTURE_2D_ARRAY,ze,Ie,Ne.width,Ne.height,Ne.depth),ce)if(Ce.layerUpdates.size>0){const Ve=f4(Ne.width,Ne.height,Ce.format,Ce.type);for(const pt of Ce.layerUpdates){const Dt=Ne.data.subarray(pt*Ve/Ne.data.BYTES_PER_ELEMENT,(pt+1)*Ve/Ne.data.BYTES_PER_ELEMENT);i.texSubImage3D(r.TEXTURE_2D_ARRAY,0,0,0,pt,Ne.width,Ne.height,1,Se,Fe,Dt)}Ce.clearLayerUpdates()}else i.texSubImage3D(r.TEXTURE_2D_ARRAY,0,0,0,0,Ne.width,Ne.height,Ne.depth,Se,Fe,Ne.data)}else i.texImage3D(r.TEXTURE_2D_ARRAY,0,Ie,Ne.width,Ne.height,Ne.depth,0,Se,Fe,Ne.data);else if(Ce.isData3DTexture)re?(Me&&i.texStorage3D(r.TEXTURE_3D,ze,Ie,Ne.width,Ne.height,Ne.depth),ce&&i.texSubImage3D(r.TEXTURE_3D,0,0,0,0,Ne.width,Ne.height,Ne.depth,Se,Fe,Ne.data)):i.texImage3D(r.TEXTURE_3D,0,Ie,Ne.width,Ne.height,Ne.depth,0,Se,Fe,Ne.data);else if(Ce.isFramebufferTexture){if(Me)if(re)i.texStorage2D(r.TEXTURE_2D,ze,Ie,Ne.width,Ne.height);else{let Ve=Ne.width,pt=Ne.height;for(let Dt=0;Dt<ze;Dt++)i.texImage2D(r.TEXTURE_2D,Dt,Ie,Ve,pt,0,Se,Fe,null),Ve>>=1,pt>>=1}}else if($.length>0){if(re&&Me){const Ve=Vi($[0]);i.texStorage2D(r.TEXTURE_2D,ze,Ie,Ve.width,Ve.height)}for(let Ve=0,pt=$.length;Ve<pt;Ve++)U=$[Ve],re?ce&&i.texSubImage2D(r.TEXTURE_2D,Ve,0,0,Se,Fe,U):i.texImage2D(r.TEXTURE_2D,Ve,Ie,Se,Fe,U);Ce.generateMipmaps=!1}else if(re){if(Me){const Ve=Vi(Ne);i.texStorage2D(r.TEXTURE_2D,ze,Ie,Ve.width,Ve.height)}ce&&i.texSubImage2D(r.TEXTURE_2D,0,0,0,Se,Fe,Ne)}else i.texImage2D(r.TEXTURE_2D,0,Ie,Se,Fe,Ne);v(Ce)&&_(Ot),xi.__version=jt.version,Ce.onUpdate&&Ce.onUpdate(Ce)}We.__version=Ce.version}function Oe(We,Ce,At){if(Ce.image.length!==6)return;const Ot=Ae(We,Ce),Zt=Ce.source;i.bindTexture(r.TEXTURE_CUBE_MAP,We.__webglTexture,r.TEXTURE0+At);const jt=n.get(Zt);if(Zt.version!==jt.__version||Ot===!0){i.activeTexture(r.TEXTURE0+At);const xi=kn.getPrimaries(kn.workingColorSpace),vt=Ce.colorSpace===Wh?null:kn.getPrimaries(Ce.colorSpace),ge=Ce.colorSpace===Wh||xi===vt?r.NONE:r.BROWSER_DEFAULT_WEBGL;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,Ce.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ce.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,Ce.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,ge);const be=Ce.isCompressedTexture||Ce.image[0].isCompressedTexture,Ne=Ce.image[0]&&Ce.image[0].isDataTexture,Se=[];for(let pt=0;pt<6;pt++)!be&&!Ne?Se[pt]=b(Ce.image[pt],!0,s.maxCubemapSize):Se[pt]=Ne?Ce.image[pt].image:Ce.image[pt],Se[pt]=Zi(Ce,Se[pt]);const Fe=Se[0],Ie=o.convert(Ce.format,Ce.colorSpace),U=o.convert(Ce.type),$=E(Ce.internalFormat,Ie,U,Ce.colorSpace),re=Ce.isVideoTexture!==!0,Me=jt.__version===void 0||Ot===!0,ce=Zt.dataReady;let ze=R(Ce,Fe);ve(r.TEXTURE_CUBE_MAP,Ce);let Ve;if(be){re&&Me&&i.texStorage2D(r.TEXTURE_CUBE_MAP,ze,$,Fe.width,Fe.height);for(let pt=0;pt<6;pt++){Ve=Se[pt].mipmaps;for(let Dt=0;Dt<Ve.length;Dt++){const xt=Ve[Dt];Ce.format!==rc?Ie!==null?re?ce&&i.compressedTexSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+pt,Dt,0,0,xt.width,xt.height,Ie,xt.data):i.compressedTexImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+pt,Dt,$,xt.width,xt.height,0,xt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):re?ce&&i.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+pt,Dt,0,0,xt.width,xt.height,Ie,U,xt.data):i.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+pt,Dt,$,xt.width,xt.height,0,Ie,U,xt.data)}}}else{if(Ve=Ce.mipmaps,re&&Me){Ve.length>0&&ze++;const pt=Vi(Se[0]);i.texStorage2D(r.TEXTURE_CUBE_MAP,ze,$,pt.width,pt.height)}for(let pt=0;pt<6;pt++)if(Ne){re?ce&&i.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+pt,0,0,0,Se[pt].width,Se[pt].height,Ie,U,Se[pt].data):i.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+pt,0,$,Se[pt].width,Se[pt].height,0,Ie,U,Se[pt].data);for(let Dt=0;Dt<Ve.length;Dt++){const xt=Ve[Dt].image[pt].image;re?ce&&i.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+pt,Dt+1,0,0,xt.width,xt.height,Ie,U,xt.data):i.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+pt,Dt+1,$,xt.width,xt.height,0,Ie,U,xt.data)}}else{re?ce&&i.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+pt,0,0,0,Ie,U,Se[pt]):i.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+pt,0,$,Ie,U,Se[pt]);for(let Dt=0;Dt<Ve.length;Dt++){const xt=Ve[Dt];re?ce&&i.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+pt,Dt+1,0,0,Ie,U,xt.image[pt]):i.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+pt,Dt+1,$,Ie,U,xt.image[pt])}}}v(Ce)&&_(r.TEXTURE_CUBE_MAP),jt.__version=Zt.version,Ce.onUpdate&&Ce.onUpdate(Ce)}We.__version=Ce.version}function Xe(We,Ce,At,Ot,Zt,jt){const xi=o.convert(At.format,At.colorSpace),vt=o.convert(At.type),ge=E(At.internalFormat,xi,vt,At.colorSpace),be=n.get(Ce),Ne=n.get(At);if(Ne.__renderTarget=Ce,!be.__hasExternalTextures){const Se=Math.max(1,Ce.width>>jt),Fe=Math.max(1,Ce.height>>jt);Zt===r.TEXTURE_3D||Zt===r.TEXTURE_2D_ARRAY?i.texImage3D(Zt,jt,ge,Se,Fe,Ce.depth,0,xi,vt,null):i.texImage2D(Zt,jt,ge,Se,Fe,0,xi,vt,null)}i.bindFramebuffer(r.FRAMEBUFFER,We),Si(Ce)?u.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,Ot,Zt,Ne.__webglTexture,0,ui(Ce)):(Zt===r.TEXTURE_2D||Zt>=r.TEXTURE_CUBE_MAP_POSITIVE_X&&Zt<=r.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&r.framebufferTexture2D(r.FRAMEBUFFER,Ot,Zt,Ne.__webglTexture,jt),i.bindFramebuffer(r.FRAMEBUFFER,null)}function Je(We,Ce,At){if(r.bindRenderbuffer(r.RENDERBUFFER,We),Ce.depthBuffer){const Ot=Ce.depthTexture,Zt=Ot&&Ot.isDepthTexture?Ot.type:null,jt=C(Ce.stencilBuffer,Zt),xi=Ce.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,vt=ui(Ce);Si(Ce)?u.renderbufferStorageMultisampleEXT(r.RENDERBUFFER,vt,jt,Ce.width,Ce.height):At?r.renderbufferStorageMultisample(r.RENDERBUFFER,vt,jt,Ce.width,Ce.height):r.renderbufferStorage(r.RENDERBUFFER,jt,Ce.width,Ce.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,xi,r.RENDERBUFFER,We)}else{const Ot=Ce.textures;for(let Zt=0;Zt<Ot.length;Zt++){const jt=Ot[Zt],xi=o.convert(jt.format,jt.colorSpace),vt=o.convert(jt.type),ge=E(jt.internalFormat,xi,vt,jt.colorSpace),be=ui(Ce);At&&Si(Ce)===!1?r.renderbufferStorageMultisample(r.RENDERBUFFER,be,ge,Ce.width,Ce.height):Si(Ce)?u.renderbufferStorageMultisampleEXT(r.RENDERBUFFER,be,ge,Ce.width,Ce.height):r.renderbufferStorage(r.RENDERBUFFER,ge,Ce.width,Ce.height)}}r.bindRenderbuffer(r.RENDERBUFFER,null)}function it(We,Ce){if(Ce&&Ce.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(r.FRAMEBUFFER,We),!(Ce.depthTexture&&Ce.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const At=n.get(Ce.depthTexture);At.__renderTarget=Ce,(!At.__webglTexture||Ce.depthTexture.image.width!==Ce.width||Ce.depthTexture.image.height!==Ce.height)&&(Ce.depthTexture.image.width=Ce.width,Ce.depthTexture.image.height=Ce.height,Ce.depthTexture.needsUpdate=!0),Q(Ce.depthTexture,0);const Ot=At.__webglTexture,Zt=ui(Ce);if(Ce.depthTexture.format===gm)Si(Ce)?u.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,Ot,0,Zt):r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,Ot,0);else if(Ce.depthTexture.format===Am)Si(Ce)?u.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.TEXTURE_2D,Ot,0,Zt):r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.TEXTURE_2D,Ot,0);else throw new Error("Unknown depthTexture format")}function dt(We){const Ce=n.get(We),At=We.isWebGLCubeRenderTarget===!0;if(Ce.__boundDepthTexture!==We.depthTexture){const Ot=We.depthTexture;if(Ce.__depthDisposeCallback&&Ce.__depthDisposeCallback(),Ot){const Zt=()=>{delete Ce.__boundDepthTexture,delete Ce.__depthDisposeCallback,Ot.removeEventListener("dispose",Zt)};Ot.addEventListener("dispose",Zt),Ce.__depthDisposeCallback=Zt}Ce.__boundDepthTexture=Ot}if(We.depthTexture&&!Ce.__autoAllocateDepthBuffer){if(At)throw new Error("target.depthTexture not supported in Cube render targets");it(Ce.__webglFramebuffer,We)}else if(At){Ce.__webglDepthbuffer=[];for(let Ot=0;Ot<6;Ot++)if(i.bindFramebuffer(r.FRAMEBUFFER,Ce.__webglFramebuffer[Ot]),Ce.__webglDepthbuffer[Ot]===void 0)Ce.__webglDepthbuffer[Ot]=r.createRenderbuffer(),Je(Ce.__webglDepthbuffer[Ot],We,!1);else{const Zt=We.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,jt=Ce.__webglDepthbuffer[Ot];r.bindRenderbuffer(r.RENDERBUFFER,jt),r.framebufferRenderbuffer(r.FRAMEBUFFER,Zt,r.RENDERBUFFER,jt)}}else if(i.bindFramebuffer(r.FRAMEBUFFER,Ce.__webglFramebuffer),Ce.__webglDepthbuffer===void 0)Ce.__webglDepthbuffer=r.createRenderbuffer(),Je(Ce.__webglDepthbuffer,We,!1);else{const Ot=We.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,Zt=Ce.__webglDepthbuffer;r.bindRenderbuffer(r.RENDERBUFFER,Zt),r.framebufferRenderbuffer(r.FRAMEBUFFER,Ot,r.RENDERBUFFER,Zt)}i.bindFramebuffer(r.FRAMEBUFFER,null)}function St(We,Ce,At){const Ot=n.get(We);Ce!==void 0&&Xe(Ot.__webglFramebuffer,We,We.texture,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,0),At!==void 0&&dt(We)}function Qt(We){const Ce=We.texture,At=n.get(We),Ot=n.get(Ce);We.addEventListener("dispose",I);const Zt=We.textures,jt=We.isWebGLCubeRenderTarget===!0,xi=Zt.length>1;if(xi||(Ot.__webglTexture===void 0&&(Ot.__webglTexture=r.createTexture()),Ot.__version=Ce.version,l.memory.textures++),jt){At.__webglFramebuffer=[];for(let vt=0;vt<6;vt++)if(Ce.mipmaps&&Ce.mipmaps.length>0){At.__webglFramebuffer[vt]=[];for(let ge=0;ge<Ce.mipmaps.length;ge++)At.__webglFramebuffer[vt][ge]=r.createFramebuffer()}else At.__webglFramebuffer[vt]=r.createFramebuffer()}else{if(Ce.mipmaps&&Ce.mipmaps.length>0){At.__webglFramebuffer=[];for(let vt=0;vt<Ce.mipmaps.length;vt++)At.__webglFramebuffer[vt]=r.createFramebuffer()}else At.__webglFramebuffer=r.createFramebuffer();if(xi)for(let vt=0,ge=Zt.length;vt<ge;vt++){const be=n.get(Zt[vt]);be.__webglTexture===void 0&&(be.__webglTexture=r.createTexture(),l.memory.textures++)}if(We.samples>0&&Si(We)===!1){At.__webglMultisampledFramebuffer=r.createFramebuffer(),At.__webglColorRenderbuffer=[],i.bindFramebuffer(r.FRAMEBUFFER,At.__webglMultisampledFramebuffer);for(let vt=0;vt<Zt.length;vt++){const ge=Zt[vt];At.__webglColorRenderbuffer[vt]=r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,At.__webglColorRenderbuffer[vt]);const be=o.convert(ge.format,ge.colorSpace),Ne=o.convert(ge.type),Se=E(ge.internalFormat,be,Ne,ge.colorSpace,We.isXRRenderTarget===!0),Fe=ui(We);r.renderbufferStorageMultisample(r.RENDERBUFFER,Fe,Se,We.width,We.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+vt,r.RENDERBUFFER,At.__webglColorRenderbuffer[vt])}r.bindRenderbuffer(r.RENDERBUFFER,null),We.depthBuffer&&(At.__webglDepthRenderbuffer=r.createRenderbuffer(),Je(At.__webglDepthRenderbuffer,We,!0)),i.bindFramebuffer(r.FRAMEBUFFER,null)}}if(jt){i.bindTexture(r.TEXTURE_CUBE_MAP,Ot.__webglTexture),ve(r.TEXTURE_CUBE_MAP,Ce);for(let vt=0;vt<6;vt++)if(Ce.mipmaps&&Ce.mipmaps.length>0)for(let ge=0;ge<Ce.mipmaps.length;ge++)Xe(At.__webglFramebuffer[vt][ge],We,Ce,r.COLOR_ATTACHMENT0,r.TEXTURE_CUBE_MAP_POSITIVE_X+vt,ge);else Xe(At.__webglFramebuffer[vt],We,Ce,r.COLOR_ATTACHMENT0,r.TEXTURE_CUBE_MAP_POSITIVE_X+vt,0);v(Ce)&&_(r.TEXTURE_CUBE_MAP),i.unbindTexture()}else if(xi){for(let vt=0,ge=Zt.length;vt<ge;vt++){const be=Zt[vt],Ne=n.get(be);i.bindTexture(r.TEXTURE_2D,Ne.__webglTexture),ve(r.TEXTURE_2D,be),Xe(At.__webglFramebuffer,We,be,r.COLOR_ATTACHMENT0+vt,r.TEXTURE_2D,0),v(be)&&_(r.TEXTURE_2D)}i.unbindTexture()}else{let vt=r.TEXTURE_2D;if((We.isWebGL3DRenderTarget||We.isWebGLArrayRenderTarget)&&(vt=We.isWebGL3DRenderTarget?r.TEXTURE_3D:r.TEXTURE_2D_ARRAY),i.bindTexture(vt,Ot.__webglTexture),ve(vt,Ce),Ce.mipmaps&&Ce.mipmaps.length>0)for(let ge=0;ge<Ce.mipmaps.length;ge++)Xe(At.__webglFramebuffer[ge],We,Ce,r.COLOR_ATTACHMENT0,vt,ge);else Xe(At.__webglFramebuffer,We,Ce,r.COLOR_ATTACHMENT0,vt,0);v(Ce)&&_(vt),i.unbindTexture()}We.depthBuffer&&dt(We)}function yt(We){const Ce=We.textures;for(let At=0,Ot=Ce.length;At<Ot;At++){const Zt=Ce[At];if(v(Zt)){const jt=T(We),xi=n.get(Zt).__webglTexture;i.bindTexture(jt,xi),_(jt),i.unbindTexture()}}}const bi=[],$e=[];function Fi(We){if(We.samples>0){if(Si(We)===!1){const Ce=We.textures,At=We.width,Ot=We.height;let Zt=r.COLOR_BUFFER_BIT;const jt=We.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,xi=n.get(We),vt=Ce.length>1;if(vt)for(let ge=0;ge<Ce.length;ge++)i.bindFramebuffer(r.FRAMEBUFFER,xi.__webglMultisampledFramebuffer),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+ge,r.RENDERBUFFER,null),i.bindFramebuffer(r.FRAMEBUFFER,xi.__webglFramebuffer),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0+ge,r.TEXTURE_2D,null,0);i.bindFramebuffer(r.READ_FRAMEBUFFER,xi.__webglMultisampledFramebuffer),i.bindFramebuffer(r.DRAW_FRAMEBUFFER,xi.__webglFramebuffer);for(let ge=0;ge<Ce.length;ge++){if(We.resolveDepthBuffer&&(We.depthBuffer&&(Zt|=r.DEPTH_BUFFER_BIT),We.stencilBuffer&&We.resolveStencilBuffer&&(Zt|=r.STENCIL_BUFFER_BIT)),vt){r.framebufferRenderbuffer(r.READ_FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,xi.__webglColorRenderbuffer[ge]);const be=n.get(Ce[ge]).__webglTexture;r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,be,0)}r.blitFramebuffer(0,0,At,Ot,0,0,At,Ot,Zt,r.NEAREST),c===!0&&(bi.length=0,$e.length=0,bi.push(r.COLOR_ATTACHMENT0+ge),We.depthBuffer&&We.resolveDepthBuffer===!1&&(bi.push(jt),$e.push(jt),r.invalidateFramebuffer(r.DRAW_FRAMEBUFFER,$e)),r.invalidateFramebuffer(r.READ_FRAMEBUFFER,bi))}if(i.bindFramebuffer(r.READ_FRAMEBUFFER,null),i.bindFramebuffer(r.DRAW_FRAMEBUFFER,null),vt)for(let ge=0;ge<Ce.length;ge++){i.bindFramebuffer(r.FRAMEBUFFER,xi.__webglMultisampledFramebuffer),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+ge,r.RENDERBUFFER,xi.__webglColorRenderbuffer[ge]);const be=n.get(Ce[ge]).__webglTexture;i.bindFramebuffer(r.FRAMEBUFFER,xi.__webglFramebuffer),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0+ge,r.TEXTURE_2D,be,0)}i.bindFramebuffer(r.DRAW_FRAMEBUFFER,xi.__webglMultisampledFramebuffer)}else if(We.depthBuffer&&We.resolveDepthBuffer===!1&&c){const Ce=We.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT;r.invalidateFramebuffer(r.DRAW_FRAMEBUFFER,[Ce])}}}function ui(We){return Math.min(s.maxSamples,We.samples)}function Si(We){const Ce=n.get(We);return We.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&Ce.__useRenderToTexture!==!1}function Ei(We){const Ce=l.render.frame;p.get(We)!==Ce&&(p.set(We,Ce),We.update())}function Zi(We,Ce){const At=We.colorSpace,Ot=We.format,Zt=We.type;return We.isCompressedTexture===!0||We.isVideoTexture===!0||At!==ym&&At!==Wh&&(kn.getTransfer(At)===as?(Ot!==rc||Zt!==wu)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",At)),Ce}function Vi(We){return typeof HTMLImageElement<"u"&&We instanceof HTMLImageElement?(h.width=We.naturalWidth||We.width,h.height=We.naturalHeight||We.height):typeof VideoFrame<"u"&&We instanceof VideoFrame?(h.width=We.displayWidth,h.height=We.displayHeight):(h.width=We.width,h.height=We.height),h}this.allocateTextureUnit=V,this.resetTextureUnits=q,this.setTexture2D=Q,this.setTexture2DArray=W,this.setTexture3D=G,this.setTextureCube=z,this.rebindTextures=St,this.setupRenderTarget=Qt,this.updateRenderTargetMipmap=yt,this.updateMultisampleRenderTarget=Fi,this.setupDepthRenderbuffer=dt,this.setupFrameBufferTexture=Xe,this.useMultisampledRTT=Si}function wte(r,e){function i(n,s=Wh){let o;const l=kn.getTransfer(s);if(n===wu)return r.UNSIGNED_BYTE;if(n===RC)return r.UNSIGNED_SHORT_4_4_4_4;if(n===IC)return r.UNSIGNED_SHORT_5_5_5_1;if(n===YP)return r.UNSIGNED_INT_5_9_9_9_REV;if(n===qP)return r.BYTE;if(n===XP)return r.SHORT;if(n===cA)return r.UNSIGNED_SHORT;if(n===MC)return r.INT;if(n===cp)return r.UNSIGNED_INT;if(n===Cu)return r.FLOAT;if(n===fm)return r.HALF_FLOAT;if(n===KP)return r.ALPHA;if(n===JP)return r.RGB;if(n===rc)return r.RGBA;if(n===ZP)return r.LUMINANCE;if(n===$P)return r.LUMINANCE_ALPHA;if(n===gm)return r.DEPTH_COMPONENT;if(n===Am)return r.DEPTH_STENCIL;if(n===eO)return r.RED;if(n===BC)return r.RED_INTEGER;if(n===tO)return r.RG;if(n===LC)return r.RG_INTEGER;if(n===DC)return r.RGBA_INTEGER;if(n===Qb||n===qb||n===Xb||n===Yb)if(l===as)if(o=e.get("WEBGL_compressed_texture_s3tc_srgb"),o!==null){if(n===Qb)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===qb)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===Xb)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===Yb)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(o=e.get("WEBGL_compressed_texture_s3tc"),o!==null){if(n===Qb)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===qb)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===Xb)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===Yb)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(n===NC||n===PC||n===OC||n===kC)if(o=e.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(n===NC)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===PC)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===OC)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===kC)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(n===FC||n===UC||n===zC)if(o=e.get("WEBGL_compressed_texture_etc"),o!==null){if(n===FC||n===UC)return l===as?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(n===zC)return l===as?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(n===jC||n===VC||n===GC||n===HC||n===WC||n===QC||n===qC||n===XC||n===YC||n===KC||n===JC||n===ZC||n===$C||n===eS)if(o=e.get("WEBGL_compressed_texture_astc"),o!==null){if(n===jC)return l===as?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===VC)return l===as?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===GC)return l===as?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===HC)return l===as?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===WC)return l===as?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===QC)return l===as?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===qC)return l===as?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===XC)return l===as?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===YC)return l===as?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===KC)return l===as?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===JC)return l===as?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===ZC)return l===as?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===$C)return l===as?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===eS)return l===as?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(n===Kb||n===tS||n===iS)if(o=e.get("EXT_texture_compression_bptc"),o!==null){if(n===Kb)return l===as?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===tS)return o.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===iS)return o.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(n===iO||n===rS||n===nS||n===sS)if(o=e.get("EXT_texture_compression_rgtc"),o!==null){if(n===Kb)return o.COMPRESSED_RED_RGTC1_EXT;if(n===rS)return o.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===nS)return o.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===sS)return o.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return n===mm?r.UNSIGNED_INT_24_8:r[n]!==void 0?r[n]:null}return{convert:i}}class Cte extends Pl{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}let xp=class extends Za{constructor(){super(),this.isGroup=!0,this.type="Group"}};const Ste={type:"move"};class zS{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new xp,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new xp,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new at,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new at),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new xp,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new at,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new at),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const i=this._hand;if(i)for(const n of e.hand.values())this._getHandJoint(i,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,i,n){let s=null,o=null,l=null;const u=this._targetRay,c=this._grip,h=this._hand;if(e&&i.session.visibilityState!=="visible-blurred"){if(h&&e.hand){l=!0;for(const b of e.hand.values()){const v=i.getJointPose(b,n),_=this._getHandJoint(h,b);v!==null&&(_.matrix.fromArray(v.transform.matrix),_.matrix.decompose(_.position,_.rotation,_.scale),_.matrixWorldNeedsUpdate=!0,_.jointRadius=v.radius),_.visible=v!==null}const p=h.joints["index-finger-tip"],f=h.joints["thumb-tip"],g=p.position.distanceTo(f.position),m=.02,y=.005;h.inputState.pinching&&g>m+y?(h.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!h.inputState.pinching&&g<=m-y&&(h.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else c!==null&&e.gripSpace&&(o=i.getPose(e.gripSpace,n),o!==null&&(c.matrix.fromArray(o.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),c.matrixWorldNeedsUpdate=!0,o.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(o.linearVelocity)):c.hasLinearVelocity=!1,o.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(o.angularVelocity)):c.hasAngularVelocity=!1));u!==null&&(s=i.getPose(e.targetRaySpace,n),s===null&&o!==null&&(s=o),s!==null&&(u.matrix.fromArray(s.transform.matrix),u.matrix.decompose(u.position,u.rotation,u.scale),u.matrixWorldNeedsUpdate=!0,s.linearVelocity?(u.hasLinearVelocity=!0,u.linearVelocity.copy(s.linearVelocity)):u.hasLinearVelocity=!1,s.angularVelocity?(u.hasAngularVelocity=!0,u.angularVelocity.copy(s.angularVelocity)):u.hasAngularVelocity=!1,this.dispatchEvent(Ste)))}return u!==null&&(u.visible=s!==null),c!==null&&(c.visible=o!==null),h!==null&&(h.visible=l!==null),this}_getHandJoint(e,i){if(e.joints[i.jointName]===void 0){const n=new xp;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[i.jointName]=n,e.add(n)}return e.joints[i.jointName]}}const Tte=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,Mte=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class Rte{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,i,n){if(this.texture===null){const s=new Dl,o=e.properties.get(s);o.__webglTexture=i.texture,(i.depthNear!=n.depthNear||i.depthFar!=n.depthFar)&&(this.depthNear=i.depthNear,this.depthFar=i.depthFar),this.texture=s}}getMesh(e){if(this.texture!==null&&this.mesh===null){const i=e.cameras[0].viewport,n=new jc({vertexShader:Tte,fragmentShader:Mte,uniforms:{depthColor:{value:this.texture},depthWidth:{value:i.z},depthHeight:{value:i.w}}});this.mesh=new pa(new vA(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class Ite extends up{constructor(e,i){super();const n=this;let s=null,o=1,l=null,u="local-floor",c=1,h=null,p=null,f=null,g=null,m=null,y=null;const b=new Rte,v=i.getContextAttributes();let _=null,T=null;const E=[],C=[],R=new ji;let B=null;const I=new Pl;I.viewport=new Zs;const N=new Pl;N.viewport=new Zs;const D=[I,N],P=new Cte;let k=null,q=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(me){let Oe=E[me];return Oe===void 0&&(Oe=new zS,E[me]=Oe),Oe.getTargetRaySpace()},this.getControllerGrip=function(me){let Oe=E[me];return Oe===void 0&&(Oe=new zS,E[me]=Oe),Oe.getGripSpace()},this.getHand=function(me){let Oe=E[me];return Oe===void 0&&(Oe=new zS,E[me]=Oe),Oe.getHandSpace()};function V(me){const Oe=C.indexOf(me.inputSource);if(Oe===-1)return;const Xe=E[Oe];Xe!==void 0&&(Xe.update(me.inputSource,me.frame,h||l),Xe.dispatchEvent({type:me.type,data:me.inputSource}))}function j(){s.removeEventListener("select",V),s.removeEventListener("selectstart",V),s.removeEventListener("selectend",V),s.removeEventListener("squeeze",V),s.removeEventListener("squeezestart",V),s.removeEventListener("squeezeend",V),s.removeEventListener("end",j),s.removeEventListener("inputsourceschange",Q);for(let me=0;me<E.length;me++){const Oe=C[me];Oe!==null&&(C[me]=null,E[me].disconnect(Oe))}k=null,q=null,b.reset(),e.setRenderTarget(_),m=null,g=null,f=null,s=null,T=null,Ae.stop(),n.isPresenting=!1,e.setPixelRatio(B),e.setSize(R.width,R.height,!1),n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(me){o=me,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(me){u=me,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return h||l},this.setReferenceSpace=function(me){h=me},this.getBaseLayer=function(){return g!==null?g:m},this.getBinding=function(){return f},this.getFrame=function(){return y},this.getSession=function(){return s},this.setSession=async function(me){if(s=me,s!==null){if(_=e.getRenderTarget(),s.addEventListener("select",V),s.addEventListener("selectstart",V),s.addEventListener("selectend",V),s.addEventListener("squeeze",V),s.addEventListener("squeezestart",V),s.addEventListener("squeezeend",V),s.addEventListener("end",j),s.addEventListener("inputsourceschange",Q),v.xrCompatible!==!0&&await i.makeXRCompatible(),B=e.getPixelRatio(),e.getSize(R),s.renderState.layers===void 0){const Oe={antialias:v.antialias,alpha:!0,depth:v.depth,stencil:v.stencil,framebufferScaleFactor:o};m=new XRWebGLLayer(s,i,Oe),s.updateRenderState({baseLayer:m}),e.setPixelRatio(1),e.setSize(m.framebufferWidth,m.framebufferHeight,!1),T=new Qh(m.framebufferWidth,m.framebufferHeight,{format:rc,type:wu,colorSpace:e.outputColorSpace,stencilBuffer:v.stencil})}else{let Oe=null,Xe=null,Je=null;v.depth&&(Je=v.stencil?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24,Oe=v.stencil?Am:gm,Xe=v.stencil?mm:cp);const it={colorFormat:i.RGBA8,depthFormat:Je,scaleFactor:o};f=new XRWebGLBinding(s,i),g=f.createProjectionLayer(it),s.updateRenderState({layers:[g]}),e.setPixelRatio(1),e.setSize(g.textureWidth,g.textureHeight,!1),T=new Qh(g.textureWidth,g.textureHeight,{format:rc,type:wu,depthTexture:new QO(g.textureWidth,g.textureHeight,Xe,void 0,void 0,void 0,void 0,void 0,void 0,Oe),stencilBuffer:v.stencil,colorSpace:e.outputColorSpace,samples:v.antialias?4:0,resolveDepthBuffer:g.ignoreDepthValues===!1})}T.isXRRenderTarget=!0,this.setFoveation(c),h=null,l=await s.requestReferenceSpace(u),Ae.setContext(s),Ae.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(s!==null)return s.environmentBlendMode},this.getDepthTexture=function(){return b.getDepthTexture()};function Q(me){for(let Oe=0;Oe<me.removed.length;Oe++){const Xe=me.removed[Oe],Je=C.indexOf(Xe);Je>=0&&(C[Je]=null,E[Je].disconnect(Xe))}for(let Oe=0;Oe<me.added.length;Oe++){const Xe=me.added[Oe];let Je=C.indexOf(Xe);if(Je===-1){for(let dt=0;dt<E.length;dt++)if(dt>=C.length){C.push(Xe),Je=dt;break}else if(C[dt]===null){C[dt]=Xe,Je=dt;break}if(Je===-1)break}const it=E[Je];it&&it.connect(Xe)}}const W=new at,G=new at;function z(me,Oe,Xe){W.setFromMatrixPosition(Oe.matrixWorld),G.setFromMatrixPosition(Xe.matrixWorld);const Je=W.distanceTo(G),it=Oe.projectionMatrix.elements,dt=Xe.projectionMatrix.elements,St=it[14]/(it[10]-1),Qt=it[14]/(it[10]+1),yt=(it[9]+1)/it[5],bi=(it[9]-1)/it[5],$e=(it[8]-1)/it[0],Fi=(dt[8]+1)/dt[0],ui=St*$e,Si=St*Fi,Ei=Je/(-$e+Fi),Zi=Ei*-$e;if(Oe.matrixWorld.decompose(me.position,me.quaternion,me.scale),me.translateX(Zi),me.translateZ(Ei),me.matrixWorld.compose(me.position,me.quaternion,me.scale),me.matrixWorldInverse.copy(me.matrixWorld).invert(),it[10]===-1)me.projectionMatrix.copy(Oe.projectionMatrix),me.projectionMatrixInverse.copy(Oe.projectionMatrixInverse);else{const Vi=St+Ei,We=Qt+Ei,Ce=ui-Zi,At=Si+(Je-Zi),Ot=yt*Qt/We*Vi,Zt=bi*Qt/We*Vi;me.projectionMatrix.makePerspective(Ce,At,Ot,Zt,Vi,We),me.projectionMatrixInverse.copy(me.projectionMatrix).invert()}}function te(me,Oe){Oe===null?me.matrixWorld.copy(me.matrix):me.matrixWorld.multiplyMatrices(Oe.matrixWorld,me.matrix),me.matrixWorldInverse.copy(me.matrixWorld).invert()}this.updateCamera=function(me){if(s===null)return;let Oe=me.near,Xe=me.far;b.texture!==null&&(b.depthNear>0&&(Oe=b.depthNear),b.depthFar>0&&(Xe=b.depthFar)),P.near=N.near=I.near=Oe,P.far=N.far=I.far=Xe,(k!==P.near||q!==P.far)&&(s.updateRenderState({depthNear:P.near,depthFar:P.far}),k=P.near,q=P.far),I.layers.mask=me.layers.mask|2,N.layers.mask=me.layers.mask|4,P.layers.mask=I.layers.mask|N.layers.mask;const Je=me.parent,it=P.cameras;te(P,Je);for(let dt=0;dt<it.length;dt++)te(it[dt],Je);it.length===2?z(P,I,N):P.projectionMatrix.copy(I.projectionMatrix),Y(me,P,Je)};function Y(me,Oe,Xe){Xe===null?me.matrix.copy(Oe.matrixWorld):(me.matrix.copy(Xe.matrixWorld),me.matrix.invert(),me.matrix.multiply(Oe.matrixWorld)),me.matrix.decompose(me.position,me.quaternion,me.scale),me.updateMatrixWorld(!0),me.projectionMatrix.copy(Oe.projectionMatrix),me.projectionMatrixInverse.copy(Oe.projectionMatrixInverse),me.isPerspectiveCamera&&(me.fov=hA*2*Math.atan(1/me.projectionMatrix.elements[5]),me.zoom=1)}this.getCamera=function(){return P},this.getFoveation=function(){if(!(g===null&&m===null))return c},this.setFoveation=function(me){c=me,g!==null&&(g.fixedFoveation=me),m!==null&&m.fixedFoveation!==void 0&&(m.fixedFoveation=me)},this.hasDepthSensing=function(){return b.texture!==null},this.getDepthSensingMesh=function(){return b.getMesh(P)};let se=null;function ve(me,Oe){if(p=Oe.getViewerPose(h||l),y=Oe,p!==null){const Xe=p.views;m!==null&&(e.setRenderTargetFramebuffer(T,m.framebuffer),e.setRenderTarget(T));let Je=!1;Xe.length!==P.cameras.length&&(P.cameras.length=0,Je=!0);for(let dt=0;dt<Xe.length;dt++){const St=Xe[dt];let Qt=null;if(m!==null)Qt=m.getViewport(St);else{const bi=f.getViewSubImage(g,St);Qt=bi.viewport,dt===0&&(e.setRenderTargetTextures(T,bi.colorTexture,g.ignoreDepthValues?void 0:bi.depthStencilTexture),e.setRenderTarget(T))}let yt=D[dt];yt===void 0&&(yt=new Pl,yt.layers.enable(dt),yt.viewport=new Zs,D[dt]=yt),yt.matrix.fromArray(St.transform.matrix),yt.matrix.decompose(yt.position,yt.quaternion,yt.scale),yt.projectionMatrix.fromArray(St.projectionMatrix),yt.projectionMatrixInverse.copy(yt.projectionMatrix).invert(),yt.viewport.set(Qt.x,Qt.y,Qt.width,Qt.height),dt===0&&(P.matrix.copy(yt.matrix),P.matrix.decompose(P.position,P.quaternion,P.scale)),Je===!0&&P.cameras.push(yt)}const it=s.enabledFeatures;if(it&&it.includes("depth-sensing")){const dt=f.getDepthInformation(Xe[0]);dt&&dt.isValid&&dt.texture&&b.init(e,dt,s.renderState)}}for(let Xe=0;Xe<E.length;Xe++){const Je=C[Xe],it=E[Xe];Je!==null&&it!==void 0&&it.update(Je,Oe,h||l)}se&&se(me,Oe),Oe.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:Oe}),y=null}const Ae=new FO;Ae.setAnimationLoop(ve),this.setAnimationLoop=function(me){se=me},this.dispose=function(){}}}const _p=new Jh,Bte=new gs;function Lte(r,e){function i(v,_){v.matrixAutoUpdate===!0&&v.updateMatrix(),_.value.copy(v.matrix)}function n(v,_){_.color.getRGB(v.fogColor.value,LO(r)),_.isFog?(v.fogNear.value=_.near,v.fogFar.value=_.far):_.isFogExp2&&(v.fogDensity.value=_.density)}function s(v,_,T,E,C){_.isMeshBasicMaterial||_.isMeshLambertMaterial?o(v,_):_.isMeshToonMaterial?(o(v,_),f(v,_)):_.isMeshPhongMaterial?(o(v,_),p(v,_)):_.isMeshStandardMaterial?(o(v,_),g(v,_),_.isMeshPhysicalMaterial&&m(v,_,C)):_.isMeshMatcapMaterial?(o(v,_),y(v,_)):_.isMeshDepthMaterial?o(v,_):_.isMeshDistanceMaterial?(o(v,_),b(v,_)):_.isMeshNormalMaterial?o(v,_):_.isLineBasicMaterial?(l(v,_),_.isLineDashedMaterial&&u(v,_)):_.isPointsMaterial?c(v,_,T,E):_.isSpriteMaterial?h(v,_):_.isShadowMaterial?(v.color.value.copy(_.color),v.opacity.value=_.opacity):_.isShaderMaterial&&(_.uniformsNeedUpdate=!1)}function o(v,_){v.opacity.value=_.opacity,_.color&&v.diffuse.value.copy(_.color),_.emissive&&v.emissive.value.copy(_.emissive).multiplyScalar(_.emissiveIntensity),_.map&&(v.map.value=_.map,i(_.map,v.mapTransform)),_.alphaMap&&(v.alphaMap.value=_.alphaMap,i(_.alphaMap,v.alphaMapTransform)),_.bumpMap&&(v.bumpMap.value=_.bumpMap,i(_.bumpMap,v.bumpMapTransform),v.bumpScale.value=_.bumpScale,_.side===go&&(v.bumpScale.value*=-1)),_.normalMap&&(v.normalMap.value=_.normalMap,i(_.normalMap,v.normalMapTransform),v.normalScale.value.copy(_.normalScale),_.side===go&&v.normalScale.value.negate()),_.displacementMap&&(v.displacementMap.value=_.displacementMap,i(_.displacementMap,v.displacementMapTransform),v.displacementScale.value=_.displacementScale,v.displacementBias.value=_.displacementBias),_.emissiveMap&&(v.emissiveMap.value=_.emissiveMap,i(_.emissiveMap,v.emissiveMapTransform)),_.specularMap&&(v.specularMap.value=_.specularMap,i(_.specularMap,v.specularMapTransform)),_.alphaTest>0&&(v.alphaTest.value=_.alphaTest);const T=e.get(_),E=T.envMap,C=T.envMapRotation;E&&(v.envMap.value=E,_p.copy(C),_p.x*=-1,_p.y*=-1,_p.z*=-1,E.isCubeTexture&&E.isRenderTargetTexture===!1&&(_p.y*=-1,_p.z*=-1),v.envMapRotation.value.setFromMatrix4(Bte.makeRotationFromEuler(_p)),v.flipEnvMap.value=E.isCubeTexture&&E.isRenderTargetTexture===!1?-1:1,v.reflectivity.value=_.reflectivity,v.ior.value=_.ior,v.refractionRatio.value=_.refractionRatio),_.lightMap&&(v.lightMap.value=_.lightMap,v.lightMapIntensity.value=_.lightMapIntensity,i(_.lightMap,v.lightMapTransform)),_.aoMap&&(v.aoMap.value=_.aoMap,v.aoMapIntensity.value=_.aoMapIntensity,i(_.aoMap,v.aoMapTransform))}function l(v,_){v.diffuse.value.copy(_.color),v.opacity.value=_.opacity,_.map&&(v.map.value=_.map,i(_.map,v.mapTransform))}function u(v,_){v.dashSize.value=_.dashSize,v.totalSize.value=_.dashSize+_.gapSize,v.scale.value=_.scale}function c(v,_,T,E){v.diffuse.value.copy(_.color),v.opacity.value=_.opacity,v.size.value=_.size*T,v.scale.value=E*.5,_.map&&(v.map.value=_.map,i(_.map,v.uvTransform)),_.alphaMap&&(v.alphaMap.value=_.alphaMap,i(_.alphaMap,v.alphaMapTransform)),_.alphaTest>0&&(v.alphaTest.value=_.alphaTest)}function h(v,_){v.diffuse.value.copy(_.color),v.opacity.value=_.opacity,v.rotation.value=_.rotation,_.map&&(v.map.value=_.map,i(_.map,v.mapTransform)),_.alphaMap&&(v.alphaMap.value=_.alphaMap,i(_.alphaMap,v.alphaMapTransform)),_.alphaTest>0&&(v.alphaTest.value=_.alphaTest)}function p(v,_){v.specular.value.copy(_.specular),v.shininess.value=Math.max(_.shininess,1e-4)}function f(v,_){_.gradientMap&&(v.gradientMap.value=_.gradientMap)}function g(v,_){v.metalness.value=_.metalness,_.metalnessMap&&(v.metalnessMap.value=_.metalnessMap,i(_.metalnessMap,v.metalnessMapTransform)),v.roughness.value=_.roughness,_.roughnessMap&&(v.roughnessMap.value=_.roughnessMap,i(_.roughnessMap,v.roughnessMapTransform)),_.envMap&&(v.envMapIntensity.value=_.envMapIntensity)}function m(v,_,T){v.ior.value=_.ior,_.sheen>0&&(v.sheenColor.value.copy(_.sheenColor).multiplyScalar(_.sheen),v.sheenRoughness.value=_.sheenRoughness,_.sheenColorMap&&(v.sheenColorMap.value=_.sheenColorMap,i(_.sheenColorMap,v.sheenColorMapTransform)),_.sheenRoughnessMap&&(v.sheenRoughnessMap.value=_.sheenRoughnessMap,i(_.sheenRoughnessMap,v.sheenRoughnessMapTransform))),_.clearcoat>0&&(v.clearcoat.value=_.clearcoat,v.clearcoatRoughness.value=_.clearcoatRoughness,_.clearcoatMap&&(v.clearcoatMap.value=_.clearcoatMap,i(_.clearcoatMap,v.clearcoatMapTransform)),_.clearcoatRoughnessMap&&(v.clearcoatRoughnessMap.value=_.clearcoatRoughnessMap,i(_.clearcoatRoughnessMap,v.clearcoatRoughnessMapTransform)),_.clearcoatNormalMap&&(v.clearcoatNormalMap.value=_.clearcoatNormalMap,i(_.clearcoatNormalMap,v.clearcoatNormalMapTransform),v.clearcoatNormalScale.value.copy(_.clearcoatNormalScale),_.side===go&&v.clearcoatNormalScale.value.negate())),_.dispersion>0&&(v.dispersion.value=_.dispersion),_.iridescence>0&&(v.iridescence.value=_.iridescence,v.iridescenceIOR.value=_.iridescenceIOR,v.iridescenceThicknessMinimum.value=_.iridescenceThicknessRange[0],v.iridescenceThicknessMaximum.value=_.iridescenceThicknessRange[1],_.iridescenceMap&&(v.iridescenceMap.value=_.iridescenceMap,i(_.iridescenceMap,v.iridescenceMapTransform)),_.iridescenceThicknessMap&&(v.iridescenceThicknessMap.value=_.iridescenceThicknessMap,i(_.iridescenceThicknessMap,v.iridescenceThicknessMapTransform))),_.transmission>0&&(v.transmission.value=_.transmission,v.transmissionSamplerMap.value=T.texture,v.transmissionSamplerSize.value.set(T.width,T.height),_.transmissionMap&&(v.transmissionMap.value=_.transmissionMap,i(_.transmissionMap,v.transmissionMapTransform)),v.thickness.value=_.thickness,_.thicknessMap&&(v.thicknessMap.value=_.thicknessMap,i(_.thicknessMap,v.thicknessMapTransform)),v.attenuationDistance.value=_.attenuationDistance,v.attenuationColor.value.copy(_.attenuationColor)),_.anisotropy>0&&(v.anisotropyVector.value.set(_.anisotropy*Math.cos(_.anisotropyRotation),_.anisotropy*Math.sin(_.anisotropyRotation)),_.anisotropyMap&&(v.anisotropyMap.value=_.anisotropyMap,i(_.anisotropyMap,v.anisotropyMapTransform))),v.specularIntensity.value=_.specularIntensity,v.specularColor.value.copy(_.specularColor),_.specularColorMap&&(v.specularColorMap.value=_.specularColorMap,i(_.specularColorMap,v.specularColorMapTransform)),_.specularIntensityMap&&(v.specularIntensityMap.value=_.specularIntensityMap,i(_.specularIntensityMap,v.specularIntensityMapTransform))}function y(v,_){_.matcap&&(v.matcap.value=_.matcap)}function b(v,_){const T=e.get(_).light;v.referencePosition.value.setFromMatrixPosition(T.matrixWorld),v.nearDistance.value=T.shadow.camera.near,v.farDistance.value=T.shadow.camera.far}return{refreshFogUniforms:n,refreshMaterialUniforms:s}}function Dte(r,e,i,n){let s={},o={},l=[];const u=r.getParameter(r.MAX_UNIFORM_BUFFER_BINDINGS);function c(T,E){const C=E.program;n.uniformBlockBinding(T,C)}function h(T,E){let C=s[T.id];C===void 0&&(y(T),C=p(T),s[T.id]=C,T.addEventListener("dispose",v));const R=E.program;n.updateUBOMapping(T,R);const B=e.render.frame;o[T.id]!==B&&(g(T),o[T.id]=B)}function p(T){const E=f();T.__bindingPointIndex=E;const C=r.createBuffer(),R=T.__size,B=T.usage;return r.bindBuffer(r.UNIFORM_BUFFER,C),r.bufferData(r.UNIFORM_BUFFER,R,B),r.bindBuffer(r.UNIFORM_BUFFER,null),r.bindBufferBase(r.UNIFORM_BUFFER,E,C),C}function f(){for(let T=0;T<u;T++)if(l.indexOf(T)===-1)return l.push(T),T;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function g(T){const E=s[T.id],C=T.uniforms,R=T.__cache;r.bindBuffer(r.UNIFORM_BUFFER,E);for(let B=0,I=C.length;B<I;B++){const N=Array.isArray(C[B])?C[B]:[C[B]];for(let D=0,P=N.length;D<P;D++){const k=N[D];if(m(k,B,D,R)===!0){const q=k.__offset,V=Array.isArray(k.value)?k.value:[k.value];let j=0;for(let Q=0;Q<V.length;Q++){const W=V[Q],G=b(W);typeof W=="number"||typeof W=="boolean"?(k.__data[0]=W,r.bufferSubData(r.UNIFORM_BUFFER,q+j,k.__data)):W.isMatrix3?(k.__data[0]=W.elements[0],k.__data[1]=W.elements[1],k.__data[2]=W.elements[2],k.__data[3]=0,k.__data[4]=W.elements[3],k.__data[5]=W.elements[4],k.__data[6]=W.elements[5],k.__data[7]=0,k.__data[8]=W.elements[6],k.__data[9]=W.elements[7],k.__data[10]=W.elements[8],k.__data[11]=0):(W.toArray(k.__data,j),j+=G.storage/Float32Array.BYTES_PER_ELEMENT)}r.bufferSubData(r.UNIFORM_BUFFER,q,k.__data)}}}r.bindBuffer(r.UNIFORM_BUFFER,null)}function m(T,E,C,R){const B=T.value,I=E+"_"+C;if(R[I]===void 0)return typeof B=="number"||typeof B=="boolean"?R[I]=B:R[I]=B.clone(),!0;{const N=R[I];if(typeof B=="number"||typeof B=="boolean"){if(N!==B)return R[I]=B,!0}else if(N.equals(B)===!1)return N.copy(B),!0}return!1}function y(T){const E=T.uniforms;let C=0;const R=16;for(let I=0,N=E.length;I<N;I++){const D=Array.isArray(E[I])?E[I]:[E[I]];for(let P=0,k=D.length;P<k;P++){const q=D[P],V=Array.isArray(q.value)?q.value:[q.value];for(let j=0,Q=V.length;j<Q;j++){const W=V[j],G=b(W),z=C%R,te=z%G.boundary,Y=z+te;C+=te,Y!==0&&R-Y<G.storage&&(C+=R-Y),q.__data=new Float32Array(G.storage/Float32Array.BYTES_PER_ELEMENT),q.__offset=C,C+=G.storage}}}const B=C%R;return B>0&&(C+=R-B),T.__size=C,T.__cache={},this}function b(T){const E={boundary:0,storage:0};return typeof T=="number"||typeof T=="boolean"?(E.boundary=4,E.storage=4):T.isVector2?(E.boundary=8,E.storage=8):T.isVector3||T.isColor?(E.boundary=16,E.storage=12):T.isVector4?(E.boundary=16,E.storage=16):T.isMatrix3?(E.boundary=48,E.storage=48):T.isMatrix4?(E.boundary=64,E.storage=64):T.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",T),E}function v(T){const E=T.target;E.removeEventListener("dispose",v);const C=l.indexOf(E.__bindingPointIndex);l.splice(C,1),r.deleteBuffer(s[E.id]),delete s[E.id],delete o[E.id]}function _(){for(const T in s)r.deleteBuffer(s[T]);l=[],s={},o={}}return{bind:c,update:h,dispose:_}}class Nte{constructor(e={}){const{canvas:i=EK(),context:n=null,depth:s=!0,stencil:o=!1,alpha:l=!1,antialias:u=!1,premultipliedAlpha:c=!0,preserveDrawingBuffer:h=!1,powerPreference:p="default",failIfMajorPerformanceCaveat:f=!1,reverseDepthBuffer:g=!1}=e;this.isWebGLRenderer=!0;let m;if(n!==null){if(typeof WebGLRenderingContext<"u"&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");m=n.getContextAttributes().alpha}else m=l;const y=new Uint32Array(4),b=new Int32Array(4);let v=null,_=null;const T=[],E=[];this.domElement=i,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=al,this.toneMapping=Hh,this.toneMappingExposure=1;const C=this;let R=!1,B=0,I=0,N=null,D=-1,P=null;const k=new Zs,q=new Zs;let V=null;const j=new Cn(0);let Q=0,W=i.width,G=i.height,z=1,te=null,Y=null;const se=new Zs(0,0,W,G),ve=new Zs(0,0,W,G);let Ae=!1;const me=new IS;let Oe=!1,Xe=!1;const Je=new gs,it=new gs,dt=new at,St=new Zs,Qt={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let yt=!1;function bi(){return N===null?z:1}let $e=n;function Fi(Be,ae){return i.getContext(Be,ae)}try{const Be={alpha:!0,depth:s,stencil:o,antialias:u,premultipliedAlpha:c,preserveDrawingBuffer:h,powerPreference:p,failIfMajorPerformanceCaveat:f};if("setAttribute"in i&&i.setAttribute("data-engine",`three.js r${Gb}`),i.addEventListener("webglcontextlost",pt,!1),i.addEventListener("webglcontextrestored",Dt,!1),i.addEventListener("webglcontextcreationerror",xt,!1),$e===null){const ae="webgl2";if($e=Fi(ae,Be),$e===null)throw Fi(ae)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(Be){throw console.error("THREE.WebGLRenderer: "+Be.message),Be}let ui,Si,Ei,Zi,Vi,We,Ce,At,Ot,Zt,jt,xi,vt,ge,be,Ne,Se,Fe,Ie,U,$,re,Me,ce;function ze(){ui=new U$($e),ui.init(),re=new wte($e,ui),Si=new D$($e,ui,e,re),Ei=new xte($e,ui),Si.reverseDepthBuffer&&g&&Ei.buffers.depth.setReversed(!0),Zi=new V$($e),Vi=new ate,We=new Ete($e,ui,Ei,Vi,Si,re,Zi),Ce=new P$(C),At=new F$(C),Ot=new YK($e),Me=new B$($e,Ot),Zt=new z$($e,Ot,Zi,Me),jt=new H$($e,Zt,Ot,Zi),Ie=new G$($e,Si,We),Ne=new N$(Vi),xi=new ste(C,Ce,At,ui,Si,Me,Ne),vt=new Lte(C,Vi),ge=new lte,be=new fte(ui),Fe=new I$(C,Ce,At,Ei,jt,m,c),Se=new vte(C,jt,Si),ce=new Dte($e,Zi,Si,Ei),U=new L$($e,ui,Zi),$=new j$($e,ui,Zi),Zi.programs=xi.programs,C.capabilities=Si,C.extensions=ui,C.properties=Vi,C.renderLists=ge,C.shadowMap=Se,C.state=Ei,C.info=Zi}ze();const Ve=new Ite(C,$e);this.xr=Ve,this.getContext=function(){return $e},this.getContextAttributes=function(){return $e.getContextAttributes()},this.forceContextLoss=function(){const Be=ui.get("WEBGL_lose_context");Be&&Be.loseContext()},this.forceContextRestore=function(){const Be=ui.get("WEBGL_lose_context");Be&&Be.restoreContext()},this.getPixelRatio=function(){return z},this.setPixelRatio=function(Be){Be!==void 0&&(z=Be,this.setSize(W,G,!1))},this.getSize=function(Be){return Be.set(W,G)},this.setSize=function(Be,ae,fe=!0){if(Ve.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}W=Be,G=ae,i.width=Math.floor(Be*z),i.height=Math.floor(ae*z),fe===!0&&(i.style.width=Be+"px",i.style.height=ae+"px"),this.setViewport(0,0,Be,ae)},this.getDrawingBufferSize=function(Be){return Be.set(W*z,G*z).floor()},this.setDrawingBufferSize=function(Be,ae,fe){W=Be,G=ae,z=fe,i.width=Math.floor(Be*fe),i.height=Math.floor(ae*fe),this.setViewport(0,0,Be,ae)},this.getCurrentViewport=function(Be){return Be.copy(k)},this.getViewport=function(Be){return Be.copy(se)},this.setViewport=function(Be,ae,fe,Le){Be.isVector4?se.set(Be.x,Be.y,Be.z,Be.w):se.set(Be,ae,fe,Le),Ei.viewport(k.copy(se).multiplyScalar(z).round())},this.getScissor=function(Be){return Be.copy(ve)},this.setScissor=function(Be,ae,fe,Le){Be.isVector4?ve.set(Be.x,Be.y,Be.z,Be.w):ve.set(Be,ae,fe,Le),Ei.scissor(q.copy(ve).multiplyScalar(z).round())},this.getScissorTest=function(){return Ae},this.setScissorTest=function(Be){Ei.setScissorTest(Ae=Be)},this.setOpaqueSort=function(Be){te=Be},this.setTransparentSort=function(Be){Y=Be},this.getClearColor=function(Be){return Be.copy(Fe.getClearColor())},this.setClearColor=function(){Fe.setClearColor.apply(Fe,arguments)},this.getClearAlpha=function(){return Fe.getClearAlpha()},this.setClearAlpha=function(){Fe.setClearAlpha.apply(Fe,arguments)},this.clear=function(Be=!0,ae=!0,fe=!0){let Le=0;if(Be){let Ue=!1;if(N!==null){const Ke=N.texture.format;Ue=Ke===DC||Ke===LC||Ke===BC}if(Ue){const Ke=N.texture.type,lt=Ke===wu||Ke===cp||Ke===cA||Ke===mm||Ke===RC||Ke===IC,Tt=Fe.getClearColor(),Yt=Fe.getClearAlpha(),$t=Tt.r,Bt=Tt.g,ri=Tt.b;lt?(y[0]=$t,y[1]=Bt,y[2]=ri,y[3]=Yt,$e.clearBufferuiv($e.COLOR,0,y)):(b[0]=$t,b[1]=Bt,b[2]=ri,b[3]=Yt,$e.clearBufferiv($e.COLOR,0,b))}else Le|=$e.COLOR_BUFFER_BIT}ae&&(Le|=$e.DEPTH_BUFFER_BIT),fe&&(Le|=$e.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),$e.clear(Le)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){i.removeEventListener("webglcontextlost",pt,!1),i.removeEventListener("webglcontextrestored",Dt,!1),i.removeEventListener("webglcontextcreationerror",xt,!1),ge.dispose(),be.dispose(),Vi.dispose(),Ce.dispose(),At.dispose(),jt.dispose(),Me.dispose(),ce.dispose(),xi.dispose(),Ve.dispose(),Ve.removeEventListener("sessionstart",rn),Ve.removeEventListener("sessionend",vs),gn.stop()};function pt(Be){Be.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),R=!0}function Dt(){console.log("THREE.WebGLRenderer: Context Restored."),R=!1;const Be=Zi.autoReset,ae=Se.enabled,fe=Se.autoUpdate,Le=Se.needsUpdate,Ue=Se.type;ze(),Zi.autoReset=Be,Se.enabled=ae,Se.autoUpdate=fe,Se.needsUpdate=Le,Se.type=Ue}function xt(Be){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",Be.statusMessage)}function Vt(Be){const ae=Be.target;ae.removeEventListener("dispose",Vt),fi(ae)}function fi(Be){xr(Be),Vi.remove(Be)}function xr(Be){const ae=Vi.get(Be).programs;ae!==void 0&&(ae.forEach(function(fe){xi.releaseProgram(fe)}),Be.isShaderMaterial&&xi.releaseShaderCache(Be))}this.renderBufferDirect=function(Be,ae,fe,Le,Ue,Ke){ae===null&&(ae=Qt);const lt=Ue.isMesh&&Ue.matrixWorld.determinant()<0,Tt=sr(Be,ae,fe,Le,Ue);Ei.setMaterial(Le,lt);let Yt=fe.index,$t=1;if(Le.wireframe===!0){if(Yt=Zt.getWireframeAttribute(fe),Yt===void 0)return;$t=2}const Bt=fe.drawRange,ri=fe.attributes.position;let wi=Bt.start*$t,Ui=(Bt.start+Bt.count)*$t;Ke!==null&&(wi=Math.max(wi,Ke.start*$t),Ui=Math.min(Ui,(Ke.start+Ke.count)*$t)),Yt!==null?(wi=Math.max(wi,0),Ui=Math.min(Ui,Yt.count)):ri!=null&&(wi=Math.max(wi,0),Ui=Math.min(Ui,ri.count));const Sr=Ui-wi;if(Sr<0||Sr===1/0)return;Me.setup(Ue,Le,Tt,fe,Yt);let ur,$i=U;if(Yt!==null&&(ur=Ot.get(Yt),$i=$,$i.setIndex(ur)),Ue.isMesh)Le.wireframe===!0?(Ei.setLineWidth(Le.wireframeLinewidth*bi()),$i.setMode($e.LINES)):$i.setMode($e.TRIANGLES);else if(Ue.isLine){let _i=Le.linewidth;_i===void 0&&(_i=1),Ei.setLineWidth(_i*bi()),Ue.isLineSegments?$i.setMode($e.LINES):Ue.isLineLoop?$i.setMode($e.LINE_LOOP):$i.setMode($e.LINE_STRIP)}else Ue.isPoints?$i.setMode($e.POINTS):Ue.isSprite&&$i.setMode($e.TRIANGLES);if(Ue.isBatchedMesh)if(Ue._multiDrawInstances!==null)$i.renderMultiDrawInstances(Ue._multiDrawStarts,Ue._multiDrawCounts,Ue._multiDrawCount,Ue._multiDrawInstances);else if(ui.get("WEBGL_multi_draw"))$i.renderMultiDraw(Ue._multiDrawStarts,Ue._multiDrawCounts,Ue._multiDrawCount);else{const _i=Ue._multiDrawStarts,Mn=Ue._multiDrawCounts,Xn=Ue._multiDrawCount,Ii=Yt?Ot.get(Yt).bytesPerElement:1,ar=Vi.get(Le).currentProgram.getUniforms();for(let hn=0;hn<Xn;hn++)ar.setValue($e,"_gl_DrawID",hn),$i.render(_i[hn]/Ii,Mn[hn])}else if(Ue.isInstancedMesh)$i.renderInstances(wi,Sr,Ue.count);else if(fe.isInstancedBufferGeometry){const _i=fe._maxInstanceCount!==void 0?fe._maxInstanceCount:1/0,Mn=Math.min(fe.instanceCount,_i);$i.renderInstances(wi,Sr,Mn)}else $i.render(wi,Sr)};function ki(Be,ae,fe){Be.transparent===!0&&Be.side===_u&&Be.forceSinglePass===!1?(Be.side=go,Be.needsUpdate=!0,Rt(Be,ae,fe),Be.side=Gh,Be.needsUpdate=!0,Rt(Be,ae,fe),Be.side=_u):Rt(Be,ae,fe)}this.compile=function(Be,ae,fe=null){fe===null&&(fe=Be),_=be.get(fe),_.init(ae),E.push(_),fe.traverseVisible(function(Ue){Ue.isLight&&Ue.layers.test(ae.layers)&&(_.pushLight(Ue),Ue.castShadow&&_.pushShadow(Ue))}),Be!==fe&&Be.traverseVisible(function(Ue){Ue.isLight&&Ue.layers.test(ae.layers)&&(_.pushLight(Ue),Ue.castShadow&&_.pushShadow(Ue))}),_.setupLights();const Le=new Set;return Be.traverse(function(Ue){if(!(Ue.isMesh||Ue.isPoints||Ue.isLine||Ue.isSprite))return;const Ke=Ue.material;if(Ke)if(Array.isArray(Ke))for(let lt=0;lt<Ke.length;lt++){const Tt=Ke[lt];ki(Tt,fe,Ue),Le.add(Tt)}else ki(Ke,fe,Ue),Le.add(Ke)}),E.pop(),_=null,Le},this.compileAsync=function(Be,ae,fe=null){const Le=this.compile(Be,ae,fe);return new Promise(Ue=>{function Ke(){if(Le.forEach(function(lt){Vi.get(lt).currentProgram.isReady()&&Le.delete(lt)}),Le.size===0){Ue(Be);return}setTimeout(Ke,10)}ui.get("KHR_parallel_shader_compile")!==null?Ke():setTimeout(Ke,10)})};let mn=null;function kr(Be){mn&&mn(Be)}function rn(){gn.stop()}function vs(){gn.start()}const gn=new FO;gn.setAnimationLoop(kr),typeof self<"u"&&gn.setContext(self),this.setAnimationLoop=function(Be){mn=Be,Ve.setAnimationLoop(Be),Be===null?gn.stop():gn.start()},Ve.addEventListener("sessionstart",rn),Ve.addEventListener("sessionend",vs),this.render=function(Be,ae){if(ae!==void 0&&ae.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(R===!0)return;if(Be.matrixWorldAutoUpdate===!0&&Be.updateMatrixWorld(),ae.parent===null&&ae.matrixWorldAutoUpdate===!0&&ae.updateMatrixWorld(),Ve.enabled===!0&&Ve.isPresenting===!0&&(Ve.cameraAutoUpdate===!0&&Ve.updateCamera(ae),ae=Ve.getCamera()),Be.isScene===!0&&Be.onBeforeRender(C,Be,ae,N),_=be.get(Be,E.length),_.init(ae),E.push(_),it.multiplyMatrices(ae.projectionMatrix,ae.matrixWorldInverse),me.setFromProjectionMatrix(it),Xe=this.localClippingEnabled,Oe=Ne.init(this.clippingPlanes,Xe),v=ge.get(Be,T.length),v.init(),T.push(v),Ve.enabled===!0&&Ve.isPresenting===!0){const Ke=C.xr.getDepthSensingMesh();Ke!==null&&Ls(Ke,ae,-1/0,C.sortObjects)}Ls(Be,ae,0,C.sortObjects),v.finish(),C.sortObjects===!0&&v.sort(te,Y),yt=Ve.enabled===!1||Ve.isPresenting===!1||Ve.hasDepthSensing()===!1,yt&&Fe.addToRenderList(v,Be),this.info.render.frame++,Oe===!0&&Ne.beginShadows();const fe=_.state.shadowsArray;Se.render(fe,Be,ae),Oe===!0&&Ne.endShadows(),this.info.autoReset===!0&&this.info.reset();const Le=v.opaque,Ue=v.transmissive;if(_.setupLights(),ae.isArrayCamera){const Ke=ae.cameras;if(Ue.length>0)for(let lt=0,Tt=Ke.length;lt<Tt;lt++){const Yt=Ke[lt];bs(Le,Ue,Be,Yt)}yt&&Fe.render(Be);for(let lt=0,Tt=Ke.length;lt<Tt;lt++){const Yt=Ke[lt];es(v,Be,Yt,Yt.viewport)}}else Ue.length>0&&bs(Le,Ue,Be,ae),yt&&Fe.render(Be),es(v,Be,ae);N!==null&&(We.updateMultisampleRenderTarget(N),We.updateRenderTargetMipmap(N)),Be.isScene===!0&&Be.onAfterRender(C,Be,ae),Me.resetDefaultState(),D=-1,P=null,E.pop(),E.length>0?(_=E[E.length-1],Oe===!0&&Ne.setGlobalState(C.clippingPlanes,_.state.camera)):_=null,T.pop(),T.length>0?v=T[T.length-1]:v=null};function Ls(Be,ae,fe,Le){if(Be.visible===!1)return;if(Be.layers.test(ae.layers)){if(Be.isGroup)fe=Be.renderOrder;else if(Be.isLOD)Be.autoUpdate===!0&&Be.update(ae);else if(Be.isLight)_.pushLight(Be),Be.castShadow&&_.pushShadow(Be);else if(Be.isSprite){if(!Be.frustumCulled||me.intersectsSprite(Be)){Le&&St.setFromMatrixPosition(Be.matrixWorld).applyMatrix4(it);const Ke=jt.update(Be),lt=Be.material;lt.visible&&v.push(Be,Ke,lt,fe,St.z,null)}}else if((Be.isMesh||Be.isLine||Be.isPoints)&&(!Be.frustumCulled||me.intersectsObject(Be))){const Ke=jt.update(Be),lt=Be.material;if(Le&&(Be.boundingSphere!==void 0?(Be.boundingSphere===null&&Be.computeBoundingSphere(),St.copy(Be.boundingSphere.center)):(Ke.boundingSphere===null&&Ke.computeBoundingSphere(),St.copy(Ke.boundingSphere.center)),St.applyMatrix4(Be.matrixWorld).applyMatrix4(it)),Array.isArray(lt)){const Tt=Ke.groups;for(let Yt=0,$t=Tt.length;Yt<$t;Yt++){const Bt=Tt[Yt],ri=lt[Bt.materialIndex];ri&&ri.visible&&v.push(Be,Ke,ri,fe,St.z,Bt)}}else lt.visible&&v.push(Be,Ke,lt,fe,St.z,null)}}const Ue=Be.children;for(let Ke=0,lt=Ue.length;Ke<lt;Ke++)Ls(Ue[Ke],ae,fe,Le)}function es(Be,ae,fe,Le){const Ue=Be.opaque,Ke=Be.transmissive,lt=Be.transparent;_.setupLightsView(fe),Oe===!0&&Ne.setGlobalState(C.clippingPlanes,fe),Le&&Ei.viewport(k.copy(Le)),Ue.length>0&&pe(Ue,ae,fe),Ke.length>0&&pe(Ke,ae,fe),lt.length>0&&pe(lt,ae,fe),Ei.buffers.depth.setTest(!0),Ei.buffers.depth.setMask(!0),Ei.buffers.color.setMask(!0),Ei.setPolygonOffset(!1)}function bs(Be,ae,fe,Le){if((fe.isScene===!0?fe.overrideMaterial:null)!==null)return;_.state.transmissionRenderTarget[Le.id]===void 0&&(_.state.transmissionRenderTarget[Le.id]=new Qh(1,1,{generateMipmaps:!0,type:ui.has("EXT_color_buffer_half_float")||ui.has("EXT_color_buffer_float")?fm:wu,minFilter:lp,samples:4,stencilBuffer:o,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:kn.workingColorSpace}));const Ue=_.state.transmissionRenderTarget[Le.id],Ke=Le.viewport||k;Ue.setSize(Ke.z,Ke.w);const lt=C.getRenderTarget();C.setRenderTarget(Ue),C.getClearColor(j),Q=C.getClearAlpha(),Q<1&&C.setClearColor(16777215,.5),C.clear(),yt&&Fe.render(fe);const Tt=C.toneMapping;C.toneMapping=Hh;const Yt=Le.viewport;if(Le.viewport!==void 0&&(Le.viewport=void 0),_.setupLightsView(Le),Oe===!0&&Ne.setGlobalState(C.clippingPlanes,Le),pe(Be,fe,Le),We.updateMultisampleRenderTarget(Ue),We.updateRenderTargetMipmap(Ue),ui.has("WEBGL_multisampled_render_to_texture")===!1){let $t=!1;for(let Bt=0,ri=ae.length;Bt<ri;Bt++){const wi=ae[Bt],Ui=wi.object,Sr=wi.geometry,ur=wi.material,$i=wi.group;if(ur.side===_u&&Ui.layers.test(Le.layers)){const _i=ur.side;ur.side=go,ur.needsUpdate=!0,ct(Ui,fe,Le,Sr,ur,$i),ur.side=_i,ur.needsUpdate=!0,$t=!0}}$t===!0&&(We.updateMultisampleRenderTarget(Ue),We.updateRenderTargetMipmap(Ue))}C.setRenderTarget(lt),C.setClearColor(j,Q),Yt!==void 0&&(Le.viewport=Yt),C.toneMapping=Tt}function pe(Be,ae,fe){const Le=ae.isScene===!0?ae.overrideMaterial:null;for(let Ue=0,Ke=Be.length;Ue<Ke;Ue++){const lt=Be[Ue],Tt=lt.object,Yt=lt.geometry,$t=Le===null?lt.material:Le,Bt=lt.group;Tt.layers.test(fe.layers)&&ct(Tt,ae,fe,Yt,$t,Bt)}}function ct(Be,ae,fe,Le,Ue,Ke){Be.onBeforeRender(C,ae,fe,Le,Ue,Ke),Be.modelViewMatrix.multiplyMatrices(fe.matrixWorldInverse,Be.matrixWorld),Be.normalMatrix.getNormalMatrix(Be.modelViewMatrix),Ue.onBeforeRender(C,ae,fe,Le,Be,Ke),Ue.transparent===!0&&Ue.side===_u&&Ue.forceSinglePass===!1?(Ue.side=go,Ue.needsUpdate=!0,C.renderBufferDirect(fe,ae,Le,Ue,Be,Ke),Ue.side=Gh,Ue.needsUpdate=!0,C.renderBufferDirect(fe,ae,Le,Ue,Be,Ke),Ue.side=_u):C.renderBufferDirect(fe,ae,Le,Ue,Be,Ke),Be.onAfterRender(C,ae,fe,Le,Ue,Ke)}function Rt(Be,ae,fe){ae.isScene!==!0&&(ae=Qt);const Le=Vi.get(Be),Ue=_.state.lights,Ke=_.state.shadowsArray,lt=Ue.state.version,Tt=xi.getParameters(Be,Ue.state,Ke,ae,fe),Yt=xi.getProgramCacheKey(Tt);let $t=Le.programs;Le.environment=Be.isMeshStandardMaterial?ae.environment:null,Le.fog=ae.fog,Le.envMap=(Be.isMeshStandardMaterial?At:Ce).get(Be.envMap||Le.environment),Le.envMapRotation=Le.environment!==null&&Be.envMap===null?ae.environmentRotation:Be.envMapRotation,$t===void 0&&(Be.addEventListener("dispose",Vt),$t=new Map,Le.programs=$t);let Bt=$t.get(Yt);if(Bt!==void 0){if(Le.currentProgram===Bt&&Le.lightsStateVersion===lt)return Bi(Be,Tt),Bt}else Tt.uniforms=xi.getUniforms(Be),Be.onBeforeCompile(Tt,C),Bt=xi.acquireProgram(Tt,Yt),$t.set(Yt,Bt),Le.uniforms=Tt.uniforms;const ri=Le.uniforms;return(!Be.isShaderMaterial&&!Be.isRawShaderMaterial||Be.clipping===!0)&&(ri.clippingPlanes=Ne.uniform),Bi(Be,Tt),Le.needsLights=Oi(Be),Le.lightsStateVersion=lt,Le.needsLights&&(ri.ambientLightColor.value=Ue.state.ambient,ri.lightProbe.value=Ue.state.probe,ri.directionalLights.value=Ue.state.directional,ri.directionalLightShadows.value=Ue.state.directionalShadow,ri.spotLights.value=Ue.state.spot,ri.spotLightShadows.value=Ue.state.spotShadow,ri.rectAreaLights.value=Ue.state.rectArea,ri.ltc_1.value=Ue.state.rectAreaLTC1,ri.ltc_2.value=Ue.state.rectAreaLTC2,ri.pointLights.value=Ue.state.point,ri.pointLightShadows.value=Ue.state.pointShadow,ri.hemisphereLights.value=Ue.state.hemi,ri.directionalShadowMap.value=Ue.state.directionalShadowMap,ri.directionalShadowMatrix.value=Ue.state.directionalShadowMatrix,ri.spotShadowMap.value=Ue.state.spotShadowMap,ri.spotLightMatrix.value=Ue.state.spotLightMatrix,ri.spotLightMap.value=Ue.state.spotLightMap,ri.pointShadowMap.value=Ue.state.pointShadowMap,ri.pointShadowMatrix.value=Ue.state.pointShadowMatrix),Le.currentProgram=Bt,Le.uniformsList=null,Bt}function Kt(Be){if(Be.uniformsList===null){const ae=Be.currentProgram.getUniforms();Be.uniformsList=xx.seqWithValue(ae.seq,Be.uniforms)}return Be.uniformsList}function Bi(Be,ae){const fe=Vi.get(Be);fe.outputColorSpace=ae.outputColorSpace,fe.batching=ae.batching,fe.batchingColor=ae.batchingColor,fe.instancing=ae.instancing,fe.instancingColor=ae.instancingColor,fe.instancingMorph=ae.instancingMorph,fe.skinning=ae.skinning,fe.morphTargets=ae.morphTargets,fe.morphNormals=ae.morphNormals,fe.morphColors=ae.morphColors,fe.morphTargetsCount=ae.morphTargetsCount,fe.numClippingPlanes=ae.numClippingPlanes,fe.numIntersection=ae.numClipIntersection,fe.vertexAlphas=ae.vertexAlphas,fe.vertexTangents=ae.vertexTangents,fe.toneMapping=ae.toneMapping}function sr(Be,ae,fe,Le,Ue){ae.isScene!==!0&&(ae=Qt),We.resetTextureUnits();const Ke=ae.fog,lt=Le.isMeshStandardMaterial?ae.environment:null,Tt=N===null?C.outputColorSpace:N.isXRRenderTarget===!0?N.texture.colorSpace:ym,Yt=(Le.isMeshStandardMaterial?At:Ce).get(Le.envMap||lt),$t=Le.vertexColors===!0&&!!fe.attributes.color&&fe.attributes.color.itemSize===4,Bt=!!fe.attributes.tangent&&(!!Le.normalMap||Le.anisotropy>0),ri=!!fe.morphAttributes.position,wi=!!fe.morphAttributes.normal,Ui=!!fe.morphAttributes.color;let Sr=Hh;Le.toneMapped&&(N===null||N.isXRRenderTarget===!0)&&(Sr=C.toneMapping);const ur=fe.morphAttributes.position||fe.morphAttributes.normal||fe.morphAttributes.color,$i=ur!==void 0?ur.length:0,_i=Vi.get(Le),Mn=_.state.lights;if(Oe===!0&&(Xe===!0||Be!==P)){const Te=Be===P&&Le.id===D;Ne.setState(Le,Be,Te)}let Xn=!1;Le.version===_i.__version?(_i.needsLights&&_i.lightsStateVersion!==Mn.state.version||_i.outputColorSpace!==Tt||Ue.isBatchedMesh&&_i.batching===!1||!Ue.isBatchedMesh&&_i.batching===!0||Ue.isBatchedMesh&&_i.batchingColor===!0&&Ue.colorTexture===null||Ue.isBatchedMesh&&_i.batchingColor===!1&&Ue.colorTexture!==null||Ue.isInstancedMesh&&_i.instancing===!1||!Ue.isInstancedMesh&&_i.instancing===!0||Ue.isSkinnedMesh&&_i.skinning===!1||!Ue.isSkinnedMesh&&_i.skinning===!0||Ue.isInstancedMesh&&_i.instancingColor===!0&&Ue.instanceColor===null||Ue.isInstancedMesh&&_i.instancingColor===!1&&Ue.instanceColor!==null||Ue.isInstancedMesh&&_i.instancingMorph===!0&&Ue.morphTexture===null||Ue.isInstancedMesh&&_i.instancingMorph===!1&&Ue.morphTexture!==null||_i.envMap!==Yt||Le.fog===!0&&_i.fog!==Ke||_i.numClippingPlanes!==void 0&&(_i.numClippingPlanes!==Ne.numPlanes||_i.numIntersection!==Ne.numIntersection)||_i.vertexAlphas!==$t||_i.vertexTangents!==Bt||_i.morphTargets!==ri||_i.morphNormals!==wi||_i.morphColors!==Ui||_i.toneMapping!==Sr||_i.morphTargetsCount!==$i)&&(Xn=!0):(Xn=!0,_i.__version=Le.version);let Ii=_i.currentProgram;Xn===!0&&(Ii=Rt(Le,ae,Ue));let ar=!1,hn=!1,qr=!1;const X=Ii.getUniforms(),ue=_i.uniforms;if(Ei.useProgram(Ii.program)&&(ar=!0,hn=!0,qr=!0),Le.id!==D&&(D=Le.id,hn=!0),ar||P!==Be){Ei.buffers.depth.getReversed()?(Je.copy(Be.projectionMatrix),CK(Je),SK(Je),X.setValue($e,"projectionMatrix",Je)):X.setValue($e,"projectionMatrix",Be.projectionMatrix),X.setValue($e,"viewMatrix",Be.matrixWorldInverse);const Te=X.map.cameraPosition;Te!==void 0&&Te.setValue($e,dt.setFromMatrixPosition(Be.matrixWorld)),Si.logarithmicDepthBuffer&&X.setValue($e,"logDepthBufFC",2/(Math.log(Be.far+1)/Math.LN2)),(Le.isMeshPhongMaterial||Le.isMeshToonMaterial||Le.isMeshLambertMaterial||Le.isMeshBasicMaterial||Le.isMeshStandardMaterial||Le.isShaderMaterial)&&X.setValue($e,"isOrthographic",Be.isOrthographicCamera===!0),P!==Be&&(P=Be,hn=!0,qr=!0)}if(Ue.isSkinnedMesh){X.setOptional($e,Ue,"bindMatrix"),X.setOptional($e,Ue,"bindMatrixInverse");const Te=Ue.skeleton;Te&&(Te.boneTexture===null&&Te.computeBoneTexture(),X.setValue($e,"boneTexture",Te.boneTexture,We))}Ue.isBatchedMesh&&(X.setOptional($e,Ue,"batchingTexture"),X.setValue($e,"batchingTexture",Ue._matricesTexture,We),X.setOptional($e,Ue,"batchingIdTexture"),X.setValue($e,"batchingIdTexture",Ue._indirectTexture,We),X.setOptional($e,Ue,"batchingColorTexture"),Ue._colorsTexture!==null&&X.setValue($e,"batchingColorTexture",Ue._colorsTexture,We));const ye=fe.morphAttributes;if((ye.position!==void 0||ye.normal!==void 0||ye.color!==void 0)&&Ie.update(Ue,fe,Ii),(hn||_i.receiveShadow!==Ue.receiveShadow)&&(_i.receiveShadow=Ue.receiveShadow,X.setValue($e,"receiveShadow",Ue.receiveShadow)),Le.isMeshGouraudMaterial&&Le.envMap!==null&&(ue.envMap.value=Yt,ue.flipEnvMap.value=Yt.isCubeTexture&&Yt.isRenderTargetTexture===!1?-1:1),Le.isMeshStandardMaterial&&Le.envMap===null&&ae.environment!==null&&(ue.envMapIntensity.value=ae.environmentIntensity),hn&&(X.setValue($e,"toneMappingExposure",C.toneMappingExposure),_i.needsLights&&Di(ue,qr),Ke&&Le.fog===!0&&vt.refreshFogUniforms(ue,Ke),vt.refreshMaterialUniforms(ue,Le,z,G,_.state.transmissionRenderTarget[Be.id]),xx.upload($e,Kt(_i),ue,We)),Le.isShaderMaterial&&Le.uniformsNeedUpdate===!0&&(xx.upload($e,Kt(_i),ue,We),Le.uniformsNeedUpdate=!1),Le.isSpriteMaterial&&X.setValue($e,"center",Ue.center),X.setValue($e,"modelViewMatrix",Ue.modelViewMatrix),X.setValue($e,"normalMatrix",Ue.normalMatrix),X.setValue($e,"modelMatrix",Ue.matrixWorld),Le.isShaderMaterial||Le.isRawShaderMaterial){const Te=Le.uniformsGroups;for(let Qe=0,Ye=Te.length;Qe<Ye;Qe++){const mt=Te[Qe];ce.update(mt,Ii),ce.bind(mt,Ii)}}return Ii}function Di(Be,ae){Be.ambientLightColor.needsUpdate=ae,Be.lightProbe.needsUpdate=ae,Be.directionalLights.needsUpdate=ae,Be.directionalLightShadows.needsUpdate=ae,Be.pointLights.needsUpdate=ae,Be.pointLightShadows.needsUpdate=ae,Be.spotLights.needsUpdate=ae,Be.spotLightShadows.needsUpdate=ae,Be.rectAreaLights.needsUpdate=ae,Be.hemisphereLights.needsUpdate=ae}function Oi(Be){return Be.isMeshLambertMaterial||Be.isMeshToonMaterial||Be.isMeshPhongMaterial||Be.isMeshStandardMaterial||Be.isShadowMaterial||Be.isShaderMaterial&&Be.lights===!0}this.getActiveCubeFace=function(){return B},this.getActiveMipmapLevel=function(){return I},this.getRenderTarget=function(){return N},this.setRenderTargetTextures=function(Be,ae,fe){Vi.get(Be.texture).__webglTexture=ae,Vi.get(Be.depthTexture).__webglTexture=fe;const Le=Vi.get(Be);Le.__hasExternalTextures=!0,Le.__autoAllocateDepthBuffer=fe===void 0,Le.__autoAllocateDepthBuffer||ui.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Le.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(Be,ae){const fe=Vi.get(Be);fe.__webglFramebuffer=ae,fe.__useDefaultFramebuffer=ae===void 0},this.setRenderTarget=function(Be,ae=0,fe=0){N=Be,B=ae,I=fe;let Le=!0,Ue=null,Ke=!1,lt=!1;if(Be){const Tt=Vi.get(Be);if(Tt.__useDefaultFramebuffer!==void 0)Ei.bindFramebuffer($e.FRAMEBUFFER,null),Le=!1;else if(Tt.__webglFramebuffer===void 0)We.setupRenderTarget(Be);else if(Tt.__hasExternalTextures)We.rebindTextures(Be,Vi.get(Be.texture).__webglTexture,Vi.get(Be.depthTexture).__webglTexture);else if(Be.depthBuffer){const Bt=Be.depthTexture;if(Tt.__boundDepthTexture!==Bt){if(Bt!==null&&Vi.has(Bt)&&(Be.width!==Bt.image.width||Be.height!==Bt.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");We.setupDepthRenderbuffer(Be)}}const Yt=Be.texture;(Yt.isData3DTexture||Yt.isDataArrayTexture||Yt.isCompressedArrayTexture)&&(lt=!0);const $t=Vi.get(Be).__webglFramebuffer;Be.isWebGLCubeRenderTarget?(Array.isArray($t[ae])?Ue=$t[ae][fe]:Ue=$t[ae],Ke=!0):Be.samples>0&&We.useMultisampledRTT(Be)===!1?Ue=Vi.get(Be).__webglMultisampledFramebuffer:Array.isArray($t)?Ue=$t[fe]:Ue=$t,k.copy(Be.viewport),q.copy(Be.scissor),V=Be.scissorTest}else k.copy(se).multiplyScalar(z).floor(),q.copy(ve).multiplyScalar(z).floor(),V=Ae;if(Ei.bindFramebuffer($e.FRAMEBUFFER,Ue)&&Le&&Ei.drawBuffers(Be,Ue),Ei.viewport(k),Ei.scissor(q),Ei.setScissorTest(V),Ke){const Tt=Vi.get(Be.texture);$e.framebufferTexture2D($e.FRAMEBUFFER,$e.COLOR_ATTACHMENT0,$e.TEXTURE_CUBE_MAP_POSITIVE_X+ae,Tt.__webglTexture,fe)}else if(lt){const Tt=Vi.get(Be.texture),Yt=ae||0;$e.framebufferTextureLayer($e.FRAMEBUFFER,$e.COLOR_ATTACHMENT0,Tt.__webglTexture,fe||0,Yt)}D=-1},this.readRenderTargetPixels=function(Be,ae,fe,Le,Ue,Ke,lt){if(!(Be&&Be.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Tt=Vi.get(Be).__webglFramebuffer;if(Be.isWebGLCubeRenderTarget&&lt!==void 0&&(Tt=Tt[lt]),Tt){Ei.bindFramebuffer($e.FRAMEBUFFER,Tt);try{const Yt=Be.texture,$t=Yt.format,Bt=Yt.type;if(!Si.textureFormatReadable($t)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Si.textureTypeReadable(Bt)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}ae>=0&&ae<=Be.width-Le&&fe>=0&&fe<=Be.height-Ue&&$e.readPixels(ae,fe,Le,Ue,re.convert($t),re.convert(Bt),Ke)}finally{const Yt=N!==null?Vi.get(N).__webglFramebuffer:null;Ei.bindFramebuffer($e.FRAMEBUFFER,Yt)}}},this.readRenderTargetPixelsAsync=async function(Be,ae,fe,Le,Ue,Ke,lt){if(!(Be&&Be.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Tt=Vi.get(Be).__webglFramebuffer;if(Be.isWebGLCubeRenderTarget&&lt!==void 0&&(Tt=Tt[lt]),Tt){const Yt=Be.texture,$t=Yt.format,Bt=Yt.type;if(!Si.textureFormatReadable($t))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Si.textureTypeReadable(Bt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(ae>=0&&ae<=Be.width-Le&&fe>=0&&fe<=Be.height-Ue){Ei.bindFramebuffer($e.FRAMEBUFFER,Tt);const ri=$e.createBuffer();$e.bindBuffer($e.PIXEL_PACK_BUFFER,ri),$e.bufferData($e.PIXEL_PACK_BUFFER,Ke.byteLength,$e.STREAM_READ),$e.readPixels(ae,fe,Le,Ue,re.convert($t),re.convert(Bt),0);const wi=N!==null?Vi.get(N).__webglFramebuffer:null;Ei.bindFramebuffer($e.FRAMEBUFFER,wi);const Ui=$e.fenceSync($e.SYNC_GPU_COMMANDS_COMPLETE,0);return $e.flush(),await wK($e,Ui,4),$e.bindBuffer($e.PIXEL_PACK_BUFFER,ri),$e.getBufferSubData($e.PIXEL_PACK_BUFFER,0,Ke),$e.deleteBuffer(ri),$e.deleteSync(Ui),Ke}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(Be,ae=null,fe=0){Be.isTexture!==!0&&(fA("WebGLRenderer: copyFramebufferToTexture function signature has changed."),ae=arguments[0]||null,Be=arguments[1]);const Le=Math.pow(2,-fe),Ue=Math.floor(Be.image.width*Le),Ke=Math.floor(Be.image.height*Le),lt=ae!==null?ae.x:0,Tt=ae!==null?ae.y:0;We.setTexture2D(Be,0),$e.copyTexSubImage2D($e.TEXTURE_2D,fe,0,0,lt,Tt,Ue,Ke),Ei.unbindTexture()},this.copyTextureToTexture=function(Be,ae,fe=null,Le=null,Ue=0){Be.isTexture!==!0&&(fA("WebGLRenderer: copyTextureToTexture function signature has changed."),Le=arguments[0]||null,Be=arguments[1],ae=arguments[2],Ue=arguments[3]||0,fe=null);let Ke,lt,Tt,Yt,$t,Bt,ri,wi,Ui;const Sr=Be.isCompressedTexture?Be.mipmaps[Ue]:Be.image;fe!==null?(Ke=fe.max.x-fe.min.x,lt=fe.max.y-fe.min.y,Tt=fe.isBox3?fe.max.z-fe.min.z:1,Yt=fe.min.x,$t=fe.min.y,Bt=fe.isBox3?fe.min.z:0):(Ke=Sr.width,lt=Sr.height,Tt=Sr.depth||1,Yt=0,$t=0,Bt=0),Le!==null?(ri=Le.x,wi=Le.y,Ui=Le.z):(ri=0,wi=0,Ui=0);const ur=re.convert(ae.format),$i=re.convert(ae.type);let _i;ae.isData3DTexture?(We.setTexture3D(ae,0),_i=$e.TEXTURE_3D):ae.isDataArrayTexture||ae.isCompressedArrayTexture?(We.setTexture2DArray(ae,0),_i=$e.TEXTURE_2D_ARRAY):(We.setTexture2D(ae,0),_i=$e.TEXTURE_2D),$e.pixelStorei($e.UNPACK_FLIP_Y_WEBGL,ae.flipY),$e.pixelStorei($e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ae.premultiplyAlpha),$e.pixelStorei($e.UNPACK_ALIGNMENT,ae.unpackAlignment);const Mn=$e.getParameter($e.UNPACK_ROW_LENGTH),Xn=$e.getParameter($e.UNPACK_IMAGE_HEIGHT),Ii=$e.getParameter($e.UNPACK_SKIP_PIXELS),ar=$e.getParameter($e.UNPACK_SKIP_ROWS),hn=$e.getParameter($e.UNPACK_SKIP_IMAGES);$e.pixelStorei($e.UNPACK_ROW_LENGTH,Sr.width),$e.pixelStorei($e.UNPACK_IMAGE_HEIGHT,Sr.height),$e.pixelStorei($e.UNPACK_SKIP_PIXELS,Yt),$e.pixelStorei($e.UNPACK_SKIP_ROWS,$t),$e.pixelStorei($e.UNPACK_SKIP_IMAGES,Bt);const qr=Be.isDataArrayTexture||Be.isData3DTexture,X=ae.isDataArrayTexture||ae.isData3DTexture;if(Be.isRenderTargetTexture||Be.isDepthTexture){const ue=Vi.get(Be),ye=Vi.get(ae),Te=Vi.get(ue.__renderTarget),Qe=Vi.get(ye.__renderTarget);Ei.bindFramebuffer($e.READ_FRAMEBUFFER,Te.__webglFramebuffer),Ei.bindFramebuffer($e.DRAW_FRAMEBUFFER,Qe.__webglFramebuffer);for(let Ye=0;Ye<Tt;Ye++)qr&&$e.framebufferTextureLayer($e.READ_FRAMEBUFFER,$e.COLOR_ATTACHMENT0,Vi.get(Be).__webglTexture,Ue,Bt+Ye),Be.isDepthTexture?(X&&$e.framebufferTextureLayer($e.DRAW_FRAMEBUFFER,$e.COLOR_ATTACHMENT0,Vi.get(ae).__webglTexture,Ue,Ui+Ye),$e.blitFramebuffer(Yt,$t,Ke,lt,ri,wi,Ke,lt,$e.DEPTH_BUFFER_BIT,$e.NEAREST)):X?$e.copyTexSubImage3D(_i,Ue,ri,wi,Ui+Ye,Yt,$t,Ke,lt):$e.copyTexSubImage2D(_i,Ue,ri,wi,Ui+Ye,Yt,$t,Ke,lt);Ei.bindFramebuffer($e.READ_FRAMEBUFFER,null),Ei.bindFramebuffer($e.DRAW_FRAMEBUFFER,null)}else X?Be.isDataTexture||Be.isData3DTexture?$e.texSubImage3D(_i,Ue,ri,wi,Ui,Ke,lt,Tt,ur,$i,Sr.data):ae.isCompressedArrayTexture?$e.compressedTexSubImage3D(_i,Ue,ri,wi,Ui,Ke,lt,Tt,ur,Sr.data):$e.texSubImage3D(_i,Ue,ri,wi,Ui,Ke,lt,Tt,ur,$i,Sr):Be.isDataTexture?$e.texSubImage2D($e.TEXTURE_2D,Ue,ri,wi,Ke,lt,ur,$i,Sr.data):Be.isCompressedTexture?$e.compressedTexSubImage2D($e.TEXTURE_2D,Ue,ri,wi,Sr.width,Sr.height,ur,Sr.data):$e.texSubImage2D($e.TEXTURE_2D,Ue,ri,wi,Ke,lt,ur,$i,Sr);$e.pixelStorei($e.UNPACK_ROW_LENGTH,Mn),$e.pixelStorei($e.UNPACK_IMAGE_HEIGHT,Xn),$e.pixelStorei($e.UNPACK_SKIP_PIXELS,Ii),$e.pixelStorei($e.UNPACK_SKIP_ROWS,ar),$e.pixelStorei($e.UNPACK_SKIP_IMAGES,hn),Ue===0&&ae.generateMipmaps&&$e.generateMipmap(_i),Ei.unbindTexture()},this.copyTextureToTexture3D=function(Be,ae,fe=null,Le=null,Ue=0){return Be.isTexture!==!0&&(fA("WebGLRenderer: copyTextureToTexture3D function signature has changed."),fe=arguments[0]||null,Le=arguments[1]||null,Be=arguments[2],ae=arguments[3],Ue=arguments[4]||0),fA('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(Be,ae,fe,Le,Ue)},this.initRenderTarget=function(Be){Vi.get(Be).__webglFramebuffer===void 0&&We.setupRenderTarget(Be)},this.initTexture=function(Be){Be.isCubeTexture?We.setTextureCube(Be,0):Be.isData3DTexture?We.setTexture3D(Be,0):Be.isDataArrayTexture||Be.isCompressedArrayTexture?We.setTexture2DArray(Be,0):We.setTexture2D(Be,0),Ei.unbindTexture()},this.resetState=function(){B=0,I=0,N=null,Ei.reset(),Me.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Su}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const i=this.getContext();i.drawingBufferColorspace=kn._getDrawingBufferColorSpace(e),i.unpackColorSpace=kn._getUnpackColorSpace()}}let Pte=class extends Za{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Jh,this.environmentIntensity=1,this.environmentRotation=new Jh,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(r,e){return super.copy(r,e),r.background!==null&&(this.background=r.background.clone()),r.environment!==null&&(this.environment=r.environment.clone()),r.fog!==null&&(this.fog=r.fog.clone()),this.backgroundBlurriness=r.backgroundBlurriness,this.backgroundIntensity=r.backgroundIntensity,this.backgroundRotation.copy(r.backgroundRotation),this.environmentIntensity=r.environmentIntensity,this.environmentRotation.copy(r.environmentRotation),r.overrideMaterial!==null&&(this.overrideMaterial=r.overrideMaterial.clone()),this.matrixAutoUpdate=r.matrixAutoUpdate,this}toJSON(r){const e=super.toJSON(r);return this.fog!==null&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(e.object.backgroundIntensity=this.backgroundIntensity),e.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(e.object.environmentIntensity=this.environmentIntensity),e.object.environmentRotation=this.environmentRotation.toArray(),e}},Ote=class{constructor(r,e){this.isInterleavedBuffer=!0,this.array=r,this.stride=e,this.count=r!==void 0?r.length/e:0,this.usage=aS,this.updateRanges=[],this.version=0,this.uuid=Tu()}onUploadCallback(){}set needsUpdate(r){r===!0&&this.version++}setUsage(r){return this.usage=r,this}addUpdateRange(r,e){this.updateRanges.push({start:r,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(r){return this.array=new r.array.constructor(r.array),this.count=r.count,this.stride=r.stride,this.usage=r.usage,this}copyAt(r,e,i){r*=this.stride,i*=e.stride;for(let n=0,s=this.stride;n<s;n++)this.array[r+n]=e.array[i+n];return this}set(r,e=0){return this.array.set(r,e),this}clone(r){r.arrayBuffers===void 0&&(r.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Tu()),r.arrayBuffers[this.array.buffer._uuid]===void 0&&(r.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(r.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(e,this.stride);return i.setUsage(this.usage),i}onUpload(r){return this.onUploadCallback=r,this}toJSON(r){return r.arrayBuffers===void 0&&(r.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Tu()),r.arrayBuffers[this.array.buffer._uuid]===void 0&&(r.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}};const vo=new at;let m4=class DG{constructor(e,i,n,s=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=i,this.offset=n,this.normalized=s}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let i=0,n=this.data.count;i<n;i++)vo.fromBufferAttribute(this,i),vo.applyMatrix4(e),this.setXYZ(i,vo.x,vo.y,vo.z);return this}applyNormalMatrix(e){for(let i=0,n=this.count;i<n;i++)vo.fromBufferAttribute(this,i),vo.applyNormalMatrix(e),this.setXYZ(i,vo.x,vo.y,vo.z);return this}transformDirection(e){for(let i=0,n=this.count;i<n;i++)vo.fromBufferAttribute(this,i),vo.transformDirection(e),this.setXYZ(i,vo.x,vo.y,vo.z);return this}getComponent(e,i){let n=this.array[e*this.data.stride+this.offset+i];return this.normalized&&(n=nc(n,this.array)),n}setComponent(e,i,n){return this.normalized&&(n=is(n,this.array)),this.data.array[e*this.data.stride+this.offset+i]=n,this}setX(e,i){return this.normalized&&(i=is(i,this.array)),this.data.array[e*this.data.stride+this.offset]=i,this}setY(e,i){return this.normalized&&(i=is(i,this.array)),this.data.array[e*this.data.stride+this.offset+1]=i,this}setZ(e,i){return this.normalized&&(i=is(i,this.array)),this.data.array[e*this.data.stride+this.offset+2]=i,this}setW(e,i){return this.normalized&&(i=is(i,this.array)),this.data.array[e*this.data.stride+this.offset+3]=i,this}getX(e){let i=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(i=nc(i,this.array)),i}getY(e){let i=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(i=nc(i,this.array)),i}getZ(e){let i=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(i=nc(i,this.array)),i}getW(e){let i=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(i=nc(i,this.array)),i}setXY(e,i,n){return e=e*this.data.stride+this.offset,this.normalized&&(i=is(i,this.array),n=is(n,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=n,this}setXYZ(e,i,n,s){return e=e*this.data.stride+this.offset,this.normalized&&(i=is(i,this.array),n=is(n,this.array),s=is(s,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=n,this.data.array[e+2]=s,this}setXYZW(e,i,n,s,o){return e=e*this.data.stride+this.offset,this.normalized&&(i=is(i,this.array),n=is(n,this.array),s=is(s,this.array),o=is(o,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=n,this.data.array[e+2]=s,this.data.array[e+3]=o,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let n=0;n<this.count;n++){const s=n*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)i.push(this.data.array[s+o])}return new Fo(new this.array.constructor(i),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new DG(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let n=0;n<this.count;n++){const s=n*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)i.push(this.data.array[s+o])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:i,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}},kte=class extends mp{static get type(){return"SpriteMaterial"}constructor(r){super(),this.isSpriteMaterial=!0,this.color=new Cn(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.alphaMap=r.alphaMap,this.rotation=r.rotation,this.sizeAttenuation=r.sizeAttenuation,this.fog=r.fog,this}},Fm;const xA=new at,Um=new at,zm=new at,jm=new ji,_A=new ji,g4=new gs,Ex=new at,EA=new at,wx=new at,A4=new ji,jS=new ji,y4=new ji;class Fte extends Za{constructor(e=new kte){if(super(),this.isSprite=!0,this.type="Sprite",Fm===void 0){Fm=new Ao;const i=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new Ote(i,5);Fm.setIndex([0,1,2,0,2,3]),Fm.setAttribute("position",new m4(n,3,0,!1)),Fm.setAttribute("uv",new m4(n,2,3,!1))}this.geometry=Fm,this.material=e,this.center=new ji(.5,.5)}raycast(e,i){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Um.setFromMatrixScale(this.matrixWorld),g4.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),zm.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Um.multiplyScalar(-zm.z);const n=this.material.rotation;let s,o;n!==0&&(o=Math.cos(n),s=Math.sin(n));const l=this.center;Cx(Ex.set(-.5,-.5,0),zm,l,Um,s,o),Cx(EA.set(.5,-.5,0),zm,l,Um,s,o),Cx(wx.set(.5,.5,0),zm,l,Um,s,o),A4.set(0,0),jS.set(1,0),y4.set(1,1);let u=e.ray.intersectTriangle(Ex,EA,wx,!1,xA);if(u===null&&(Cx(EA.set(-.5,.5,0),zm,l,Um,s,o),jS.set(0,1),u=e.ray.intersectTriangle(Ex,wx,EA,!1,xA),u===null))return;const c=e.ray.origin.distanceTo(xA);c<e.near||c>e.far||i.push({distance:c,point:xA.clone(),uv:fp.getInterpolation(xA,Ex,EA,wx,A4,jS,y4,new ji),face:null,object:this})}copy(e,i){return super.copy(e,i),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function Cx(r,e,i,n,s,o){jm.subVectors(r,i).addScalar(.5).multiply(n),s!==void 0?(_A.x=o*jm.x-s*jm.y,_A.y=s*jm.x+o*jm.y):_A.copy(jm),r.copy(e),r.x+=_A.x,r.y+=_A.y,r.applyMatrix4(g4)}let VS=class extends mp{static get type(){return"LineBasicMaterial"}constructor(r){super(),this.isLineBasicMaterial=!0,this.color=new Cn(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.linewidth=r.linewidth,this.linecap=r.linecap,this.linejoin=r.linejoin,this.fog=r.fog,this}};const Sx=new at,Tx=new at,v4=new gs,wA=new sx,Mx=new ix,GS=new at,b4=new at;class x4 extends Za{constructor(e=new Ao,i=new VS){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=i,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const i=e.attributes.position,n=[0];for(let s=1,o=i.count;s<o;s++)Sx.fromBufferAttribute(i,s-1),Tx.fromBufferAttribute(i,s),n[s]=n[s-1],n[s]+=Sx.distanceTo(Tx);e.setAttribute("lineDistance",new Os(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,i){const n=this.geometry,s=this.matrixWorld,o=e.params.Line.threshold,l=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),Mx.copy(n.boundingSphere),Mx.applyMatrix4(s),Mx.radius+=o,e.ray.intersectsSphere(Mx)===!1)return;v4.copy(s).invert(),wA.copy(e.ray).applyMatrix4(v4);const u=o/((this.scale.x+this.scale.y+this.scale.z)/3),c=u*u,h=this.isLineSegments?2:1,p=n.index,f=n.attributes.position;if(p!==null){const g=Math.max(0,l.start),m=Math.min(p.count,l.start+l.count);for(let y=g,b=m-1;y<b;y+=h){const v=p.getX(y),_=p.getX(y+1),T=Rx(this,e,wA,c,v,_);T&&i.push(T)}if(this.isLineLoop){const y=p.getX(m-1),b=p.getX(g),v=Rx(this,e,wA,c,y,b);v&&i.push(v)}}else{const g=Math.max(0,l.start),m=Math.min(f.count,l.start+l.count);for(let y=g,b=m-1;y<b;y+=h){const v=Rx(this,e,wA,c,y,y+1);v&&i.push(v)}if(this.isLineLoop){const y=Rx(this,e,wA,c,m-1,g);y&&i.push(y)}}}updateMorphTargets(){const e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){const n=e[i[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=n.length;s<o;s++){const l=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=s}}}}}function Rx(r,e,i,n,s,o){const l=r.geometry.attributes.position;if(Sx.fromBufferAttribute(l,s),Tx.fromBufferAttribute(l,o),i.distanceSqToSegment(Sx,Tx,GS,b4)>n)return;GS.applyMatrix4(r.matrixWorld);const u=e.ray.origin.distanceTo(GS);if(!(u<e.near||u>e.far))return{distance:u,point:b4.clone().applyMatrix4(r.matrixWorld),index:s,face:null,faceIndex:null,barycoord:null,object:r}}class Pu{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,i){const n=this.getUtoTmapping(e);return this.getPoint(n,i)}getPoints(e=5){const i=[];for(let n=0;n<=e;n++)i.push(this.getPoint(n/e));return i}getSpacedPoints(e=5){const i=[];for(let n=0;n<=e;n++)i.push(this.getPointAt(n/e));return i}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const i=[];let n,s=this.getPoint(0),o=0;i.push(0);for(let l=1;l<=e;l++)n=this.getPoint(l/e),o+=n.distanceTo(s),i.push(o),s=n;return this.cacheArcLengths=i,i}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,i){const n=this.getLengths();let s=0;const o=n.length;let l;i?l=i:l=e*n[o-1];let u=0,c=o-1,h;for(;u<=c;)if(s=Math.floor(u+(c-u)/2),h=n[s]-l,h<0)u=s+1;else if(h>0)c=s-1;else{c=s;break}if(s=c,n[s]===l)return s/(o-1);const p=n[s],f=n[s+1]-p,g=(l-p)/f;return(s+g)/(o-1)}getTangent(e,i){let n=e-1e-4,s=e+1e-4;n<0&&(n=0),s>1&&(s=1);const o=this.getPoint(n),l=this.getPoint(s),u=i||(o.isVector2?new ji:new at);return u.copy(l).sub(o).normalize(),u}getTangentAt(e,i){const n=this.getUtoTmapping(e);return this.getTangent(n,i)}computeFrenetFrames(e,i){const n=new at,s=[],o=[],l=[],u=new at,c=new gs;for(let m=0;m<=e;m++){const y=m/e;s[m]=this.getTangentAt(y,new at)}o[0]=new at,l[0]=new at;let h=Number.MAX_VALUE;const p=Math.abs(s[0].x),f=Math.abs(s[0].y),g=Math.abs(s[0].z);p<=h&&(h=p,n.set(1,0,0)),f<=h&&(h=f,n.set(0,1,0)),g<=h&&n.set(0,0,1),u.crossVectors(s[0],n).normalize(),o[0].crossVectors(s[0],u),l[0].crossVectors(s[0],o[0]);for(let m=1;m<=e;m++){if(o[m]=o[m-1].clone(),l[m]=l[m-1].clone(),u.crossVectors(s[m-1],s[m]),u.length()>Number.EPSILON){u.normalize();const y=Math.acos(Sa(s[m-1].dot(s[m]),-1,1));o[m].applyMatrix4(c.makeRotationAxis(u,y))}l[m].crossVectors(s[m],o[m])}if(i===!0){let m=Math.acos(Sa(o[0].dot(o[e]),-1,1));m/=e,s[0].dot(u.crossVectors(o[0],o[e]))>0&&(m=-m);for(let y=1;y<=e;y++)o[y].applyMatrix4(c.makeRotationAxis(s[y],m*y)),l[y].crossVectors(s[y],o[y])}return{tangents:s,normals:o,binormals:l}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class _4 extends Pu{constructor(e=0,i=0,n=1,s=1,o=0,l=Math.PI*2,u=!1,c=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=i,this.xRadius=n,this.yRadius=s,this.aStartAngle=o,this.aEndAngle=l,this.aClockwise=u,this.aRotation=c}getPoint(e,i=new ji){const n=i,s=Math.PI*2;let o=this.aEndAngle-this.aStartAngle;const l=Math.abs(o)<Number.EPSILON;for(;o<0;)o+=s;for(;o>s;)o-=s;o<Number.EPSILON&&(l?o=0:o=s),this.aClockwise===!0&&!l&&(o===s?o=-s:o=o-s);const u=this.aStartAngle+e*o;let c=this.aX+this.xRadius*Math.cos(u),h=this.aY+this.yRadius*Math.sin(u);if(this.aRotation!==0){const p=Math.cos(this.aRotation),f=Math.sin(this.aRotation),g=c-this.aX,m=h-this.aY;c=g*p-m*f+this.aX,h=g*f+m*p+this.aY}return n.set(c,h)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class Ute extends _4{constructor(e,i,n,s,o,l){super(e,i,n,n,s,o,l),this.isArcCurve=!0,this.type="ArcCurve"}}function HS(){let r=0,e=0,i=0,n=0;function s(o,l,u,c){r=o,e=u,i=-3*o+3*l-2*u-c,n=2*o-2*l+u+c}return{initCatmullRom:function(o,l,u,c,h){s(l,u,h*(u-o),h*(c-l))},initNonuniformCatmullRom:function(o,l,u,c,h,p,f){let g=(l-o)/h-(u-o)/(h+p)+(u-l)/p,m=(u-l)/p-(c-l)/(p+f)+(c-u)/f;g*=p,m*=p,s(l,u,g,m)},calc:function(o){const l=o*o,u=l*o;return r+e*o+i*l+n*u}}}const Ix=new at,WS=new HS,QS=new HS,qS=new HS;class zte extends Pu{constructor(e=[],i=!1,n="centripetal",s=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=i,this.curveType=n,this.tension=s}getPoint(e,i=new at){const n=i,s=this.points,o=s.length,l=(o-(this.closed?0:1))*e;let u=Math.floor(l),c=l-u;this.closed?u+=u>0?0:(Math.floor(Math.abs(u)/o)+1)*o:c===0&&u===o-1&&(u=o-2,c=1);let h,p;this.closed||u>0?h=s[(u-1)%o]:(Ix.subVectors(s[0],s[1]).add(s[0]),h=Ix);const f=s[u%o],g=s[(u+1)%o];if(this.closed||u+2<o?p=s[(u+2)%o]:(Ix.subVectors(s[o-1],s[o-2]).add(s[o-1]),p=Ix),this.curveType==="centripetal"||this.curveType==="chordal"){const m=this.curveType==="chordal"?.5:.25;let y=Math.pow(h.distanceToSquared(f),m),b=Math.pow(f.distanceToSquared(g),m),v=Math.pow(g.distanceToSquared(p),m);b<1e-4&&(b=1),y<1e-4&&(y=b),v<1e-4&&(v=b),WS.initNonuniformCatmullRom(h.x,f.x,g.x,p.x,y,b,v),QS.initNonuniformCatmullRom(h.y,f.y,g.y,p.y,y,b,v),qS.initNonuniformCatmullRom(h.z,f.z,g.z,p.z,y,b,v)}else this.curveType==="catmullrom"&&(WS.initCatmullRom(h.x,f.x,g.x,p.x,this.tension),QS.initCatmullRom(h.y,f.y,g.y,p.y,this.tension),qS.initCatmullRom(h.z,f.z,g.z,p.z,this.tension));return n.set(WS.calc(c),QS.calc(c),qS.calc(c)),n}copy(e){super.copy(e),this.points=[];for(let i=0,n=e.points.length;i<n;i++){const s=e.points[i];this.points.push(s.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let i=0,n=this.points.length;i<n;i++){const s=this.points[i];e.points.push(s.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let i=0,n=e.points.length;i<n;i++){const s=e.points[i];this.points.push(new at().fromArray(s))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function E4(r,e,i,n,s){const o=(n-e)*.5,l=(s-i)*.5,u=r*r,c=r*u;return(2*i-2*n+o+l)*c+(-3*i+3*n-2*o-l)*u+o*r+i}function jte(r,e){const i=1-r;return i*i*e}function Vte(r,e){return 2*(1-r)*r*e}function Gte(r,e){return r*r*e}function CA(r,e,i,n){return jte(r,e)+Vte(r,i)+Gte(r,n)}function Hte(r,e){const i=1-r;return i*i*i*e}function Wte(r,e){const i=1-r;return 3*i*i*r*e}function Qte(r,e){return 3*(1-r)*r*r*e}function qte(r,e){return r*r*r*e}function SA(r,e,i,n,s){return Hte(r,e)+Wte(r,i)+Qte(r,n)+qte(r,s)}class Xte extends Pu{constructor(e=new ji,i=new ji,n=new ji,s=new ji){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=i,this.v2=n,this.v3=s}getPoint(e,i=new ji){const n=i,s=this.v0,o=this.v1,l=this.v2,u=this.v3;return n.set(SA(e,s.x,o.x,l.x,u.x),SA(e,s.y,o.y,l.y,u.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class w4 extends Pu{constructor(e=new at,i=new at,n=new at,s=new at){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=i,this.v2=n,this.v3=s}getPoint(e,i=new at){const n=i,s=this.v0,o=this.v1,l=this.v2,u=this.v3;return n.set(SA(e,s.x,o.x,l.x,u.x),SA(e,s.y,o.y,l.y,u.y),SA(e,s.z,o.z,l.z,u.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Yte extends Pu{constructor(e=new ji,i=new ji){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=i}getPoint(e,i=new ji){const n=i;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,i){return this.getPoint(e,i)}getTangent(e,i=new ji){return i.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,i){return this.getTangent(e,i)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Kte extends Pu{constructor(e=new at,i=new at){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=i}getPoint(e,i=new at){const n=i;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,i){return this.getPoint(e,i)}getTangent(e,i=new at){return i.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,i){return this.getTangent(e,i)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Jte extends Pu{constructor(e=new ji,i=new ji,n=new ji){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=i,this.v2=n}getPoint(e,i=new ji){const n=i,s=this.v0,o=this.v1,l=this.v2;return n.set(CA(e,s.x,o.x,l.x),CA(e,s.y,o.y,l.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class XS extends Pu{constructor(e=new at,i=new at,n=new at){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=i,this.v2=n}getPoint(e,i=new at){const n=i,s=this.v0,o=this.v1,l=this.v2;return n.set(CA(e,s.x,o.x,l.x),CA(e,s.y,o.y,l.y),CA(e,s.z,o.z,l.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Zte extends Pu{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,i=new ji){const n=i,s=this.points,o=(s.length-1)*e,l=Math.floor(o),u=o-l,c=s[l===0?l:l-1],h=s[l],p=s[l>s.length-2?s.length-1:l+1],f=s[l>s.length-3?s.length-1:l+2];return n.set(E4(u,c.x,h.x,p.x,f.x),E4(u,c.y,h.y,p.y,f.y)),n}copy(e){super.copy(e),this.points=[];for(let i=0,n=e.points.length;i<n;i++){const s=e.points[i];this.points.push(s.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let i=0,n=this.points.length;i<n;i++){const s=this.points[i];e.points.push(s.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let i=0,n=e.points.length;i<n;i++){const s=e.points[i];this.points.push(new ji().fromArray(s))}return this}}var $te=Object.freeze({__proto__:null,ArcCurve:Ute,CatmullRomCurve3:zte,CubicBezierCurve:Xte,CubicBezierCurve3:w4,EllipseCurve:_4,LineCurve:Yte,LineCurve3:Kte,QuadraticBezierCurve:Jte,QuadraticBezierCurve3:XS,SplineCurve:Zte});class YS extends Ao{constructor(e=1,i=32,n=0,s=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:i,thetaStart:n,thetaLength:s},i=Math.max(3,i);const o=[],l=[],u=[],c=[],h=new at,p=new ji;l.push(0,0,0),u.push(0,0,1),c.push(.5,.5);for(let f=0,g=3;f<=i;f++,g+=3){const m=n+f/i*s;h.x=e*Math.cos(m),h.y=e*Math.sin(m),l.push(h.x,h.y,h.z),u.push(0,0,1),p.x=(l[g]/e+1)/2,p.y=(l[g+1]/e+1)/2,c.push(p.x,p.y)}for(let f=1;f<=i;f++)o.push(f,f+1,0);this.setIndex(o),this.setAttribute("position",new Os(l,3)),this.setAttribute("normal",new Os(u,3)),this.setAttribute("uv",new Os(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new YS(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class Bx extends Ao{constructor(e=1,i=1,n=1,s=32,o=1,l=!1,u=0,c=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:i,height:n,radialSegments:s,heightSegments:o,openEnded:l,thetaStart:u,thetaLength:c};const h=this;s=Math.floor(s),o=Math.floor(o);const p=[],f=[],g=[],m=[];let y=0;const b=[],v=n/2;let _=0;T(),l===!1&&(e>0&&E(!0),i>0&&E(!1)),this.setIndex(p),this.setAttribute("position",new Os(f,3)),this.setAttribute("normal",new Os(g,3)),this.setAttribute("uv",new Os(m,2));function T(){const C=new at,R=new at;let B=0;const I=(i-e)/n;for(let N=0;N<=o;N++){const D=[],P=N/o,k=P*(i-e)+e;for(let q=0;q<=s;q++){const V=q/s,j=V*c+u,Q=Math.sin(j),W=Math.cos(j);R.x=k*Q,R.y=-P*n+v,R.z=k*W,f.push(R.x,R.y,R.z),C.set(Q,I,W).normalize(),g.push(C.x,C.y,C.z),m.push(V,1-P),D.push(y++)}b.push(D)}for(let N=0;N<s;N++)for(let D=0;D<o;D++){const P=b[D][N],k=b[D+1][N],q=b[D+1][N+1],V=b[D][N+1];(e>0||D!==0)&&(p.push(P,k,V),B+=3),(i>0||D!==o-1)&&(p.push(k,q,V),B+=3)}h.addGroup(_,B,0),_+=B}function E(C){const R=y,B=new ji,I=new at;let N=0;const D=C===!0?e:i,P=C===!0?1:-1;for(let q=1;q<=s;q++)f.push(0,v*P,0),g.push(0,P,0),m.push(.5,.5),y++;const k=y;for(let q=0;q<=s;q++){const V=q/s*c+u,j=Math.cos(V),Q=Math.sin(V);I.x=D*Q,I.y=v*P,I.z=D*j,f.push(I.x,I.y,I.z),g.push(0,P,0),B.x=j*.5+.5,B.y=Q*.5*P+.5,m.push(B.x,B.y),y++}for(let q=0;q<s;q++){const V=R+q,j=k+q;C===!0?p.push(j,j+1,V):p.push(j+1,j,V),N+=3}h.addGroup(_,N,C===!0?1:2),_+=N}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Bx(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class KS extends Bx{constructor(e=1,i=1,n=32,s=1,o=!1,l=0,u=Math.PI*2){super(0,e,i,n,s,o,l,u),this.type="ConeGeometry",this.parameters={radius:e,height:i,radialSegments:n,heightSegments:s,openEnded:o,thetaStart:l,thetaLength:u}}static fromJSON(e){return new KS(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}let Lx=class NG extends Ao{constructor(e=1,i=32,n=16,s=0,o=Math.PI*2,l=0,u=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:i,heightSegments:n,phiStart:s,phiLength:o,thetaStart:l,thetaLength:u},i=Math.max(3,Math.floor(i)),n=Math.max(2,Math.floor(n));const c=Math.min(l+u,Math.PI);let h=0;const p=[],f=new at,g=new at,m=[],y=[],b=[],v=[];for(let _=0;_<=n;_++){const T=[],E=_/n;let C=0;_===0&&l===0?C=.5/i:_===n&&c===Math.PI&&(C=-.5/i);for(let R=0;R<=i;R++){const B=R/i;f.x=-e*Math.cos(s+B*o)*Math.sin(l+E*u),f.y=e*Math.cos(l+E*u),f.z=e*Math.sin(s+B*o)*Math.sin(l+E*u),y.push(f.x,f.y,f.z),g.copy(f).normalize(),b.push(g.x,g.y,g.z),v.push(B+C,1-E),T.push(h++)}p.push(T)}for(let _=0;_<n;_++)for(let T=0;T<i;T++){const E=p[_][T+1],C=p[_][T],R=p[_+1][T],B=p[_+1][T+1];(_!==0||l>0)&&m.push(E,C,B),(_!==n-1||c<Math.PI)&&m.push(C,R,B)}this.setIndex(m),this.setAttribute("position",new Os(y,3)),this.setAttribute("normal",new Os(b,3)),this.setAttribute("uv",new Os(v,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new NG(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}};class JS extends Ao{constructor(e=new XS(new at(-1,-1,0),new at(-1,1,0),new at(1,1,0)),i=64,n=1,s=8,o=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:i,radius:n,radialSegments:s,closed:o};const l=e.computeFrenetFrames(i,o);this.tangents=l.tangents,this.normals=l.normals,this.binormals=l.binormals;const u=new at,c=new at,h=new ji;let p=new at;const f=[],g=[],m=[],y=[];b(),this.setIndex(y),this.setAttribute("position",new Os(f,3)),this.setAttribute("normal",new Os(g,3)),this.setAttribute("uv",new Os(m,2));function b(){for(let E=0;E<i;E++)v(E);v(o===!1?i:0),T(),_()}function v(E){p=e.getPointAt(E/i,p);const C=l.normals[E],R=l.binormals[E];for(let B=0;B<=s;B++){const I=B/s*Math.PI*2,N=Math.sin(I),D=-Math.cos(I);c.x=D*C.x+N*R.x,c.y=D*C.y+N*R.y,c.z=D*C.z+N*R.z,c.normalize(),g.push(c.x,c.y,c.z),u.x=p.x+n*c.x,u.y=p.y+n*c.y,u.z=p.z+n*c.z,f.push(u.x,u.y,u.z)}}function _(){for(let E=1;E<=i;E++)for(let C=1;C<=s;C++){const R=(s+1)*(E-1)+(C-1),B=(s+1)*E+(C-1),I=(s+1)*E+C,N=(s+1)*(E-1)+C;y.push(R,B,N),y.push(B,I,N)}}function T(){for(let E=0;E<=i;E++)for(let C=0;C<=s;C++)h.x=E/i,h.y=C/s,m.push(h.x,h.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new JS(new $te[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}let eie=class extends mp{static get type(){return"MeshLambertMaterial"}constructor(r){super(),this.isMeshLambertMaterial=!0,this.color=new Cn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Cn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=rO,this.normalScale=new ji(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Jh,this.combine=_C,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.lightMap=r.lightMap,this.lightMapIntensity=r.lightMapIntensity,this.aoMap=r.aoMap,this.aoMapIntensity=r.aoMapIntensity,this.emissive.copy(r.emissive),this.emissiveMap=r.emissiveMap,this.emissiveIntensity=r.emissiveIntensity,this.bumpMap=r.bumpMap,this.bumpScale=r.bumpScale,this.normalMap=r.normalMap,this.normalMapType=r.normalMapType,this.normalScale.copy(r.normalScale),this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.specularMap=r.specularMap,this.alphaMap=r.alphaMap,this.envMap=r.envMap,this.envMapRotation.copy(r.envMapRotation),this.combine=r.combine,this.reflectivity=r.reflectivity,this.refractionRatio=r.refractionRatio,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.wireframeLinecap=r.wireframeLinecap,this.wireframeLinejoin=r.wireframeLinejoin,this.flatShading=r.flatShading,this.fog=r.fog,this}};const C4={enabled:!1,files:{},add:function(r,e){this.enabled!==!1&&(this.files[r]=e)},get:function(r){if(this.enabled!==!1)return this.files[r]},remove:function(r){delete this.files[r]},clear:function(){this.files={}}};class tie{constructor(e,i,n){const s=this;let o=!1,l=0,u=0,c;const h=[];this.onStart=void 0,this.onLoad=e,this.onProgress=i,this.onError=n,this.itemStart=function(p){u++,o===!1&&s.onStart!==void 0&&s.onStart(p,l,u),o=!0},this.itemEnd=function(p){l++,s.onProgress!==void 0&&s.onProgress(p,l,u),l===u&&(o=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(p){s.onError!==void 0&&s.onError(p)},this.resolveURL=function(p){return c?c(p):p},this.setURLModifier=function(p){return c=p,this},this.addHandler=function(p,f){return h.push(p,f),this},this.removeHandler=function(p){const f=h.indexOf(p);return f!==-1&&h.splice(f,2),this},this.getHandler=function(p){for(let f=0,g=h.length;f<g;f+=2){const m=h[f],y=h[f+1];if(m.global&&(m.lastIndex=0),m.test(p))return y}return null}}}const iie=new tie;class ZS{constructor(e){this.manager=e!==void 0?e:iie,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,i){const n=this;return new Promise(function(s,o){n.load(e,s,i,o)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}ZS.DEFAULT_MATERIAL_NAME="__DEFAULT";class rie extends ZS{constructor(e){super(e)}load(e,i,n,s){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,l=C4.get(e);if(l!==void 0)return o.manager.itemStart(e),setTimeout(function(){i&&i(l),o.manager.itemEnd(e)},0),l;const u=pA("img");function c(){p(),C4.add(e,this),i&&i(this),o.manager.itemEnd(e)}function h(f){p(),s&&s(f),o.manager.itemError(e),o.manager.itemEnd(e)}function p(){u.removeEventListener("load",c,!1),u.removeEventListener("error",h,!1)}return u.addEventListener("load",c,!1),u.addEventListener("error",h,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(u.crossOrigin=this.crossOrigin),o.manager.itemStart(e),u.src=e,u}}class nie extends ZS{constructor(e){super(e)}load(e,i,n,s){const o=new Dl,l=new rie(this.manager);return l.setCrossOrigin(this.crossOrigin),l.setPath(this.path),l.load(e,function(u){o.image=u,o.needsUpdate=!0,i!==void 0&&i(o)},n,s),o}}let S4=class extends Za{constructor(r,e=1){super(),this.isLight=!0,this.type="Light",this.color=new Cn(r),this.intensity=e}dispose(){}copy(r,e){return super.copy(r,e),this.color.copy(r.color),this.intensity=r.intensity,this}toJSON(r){const e=super.toJSON(r);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,this.groundColor!==void 0&&(e.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(e.object.distance=this.distance),this.angle!==void 0&&(e.object.angle=this.angle),this.decay!==void 0&&(e.object.decay=this.decay),this.penumbra!==void 0&&(e.object.penumbra=this.penumbra),this.shadow!==void 0&&(e.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(e.object.target=this.target.uuid),e}};const $S=new gs,T4=new at,M4=new at;let sie=class{constructor(r){this.camera=r,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ji(512,512),this.map=null,this.mapPass=null,this.matrix=new gs,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new IS,this._frameExtents=new ji(1,1),this._viewportCount=1,this._viewports=[new Zs(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(r){const e=this.camera,i=this.matrix;T4.setFromMatrixPosition(r.matrixWorld),e.position.copy(T4),M4.setFromMatrixPosition(r.target.matrixWorld),e.lookAt(M4),e.updateMatrixWorld(),$S.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix($S),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply($S)}getViewport(r){return this._viewports[r]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(r){return this.camera=r.camera.clone(),this.intensity=r.intensity,this.bias=r.bias,this.radius=r.radius,this.mapSize.copy(r.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const r={};return this.intensity!==1&&(r.intensity=this.intensity),this.bias!==0&&(r.bias=this.bias),this.normalBias!==0&&(r.normalBias=this.normalBias),this.radius!==1&&(r.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(r.mapSize=this.mapSize.toArray()),r.camera=this.camera.toJSON(!1).object,delete r.camera.matrix,r}},aie=class extends sie{constructor(){super(new BS(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},oie=class extends S4{constructor(r,e){super(r,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Za.DEFAULT_UP),this.updateMatrix(),this.target=new Za,this.shadow=new aie}dispose(){this.shadow.dispose()}copy(r){return super.copy(r),this.target=r.target.clone(),this.shadow=r.shadow.clone(),this}},lie=class extends S4{constructor(r,e){super(r,e),this.isAmbientLight=!0,this.type="AmbientLight"}};class R4{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=I4(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const i=I4();e=(i-this.oldTime)/1e3,this.oldTime=i,this.elapsedTime+=e}return e}}function I4(){return performance.now()}const B4=new gs;class L4{constructor(e,i,n=0,s=1/0){this.ray=new sx(e,i),this.near=n,this.far=s,this.camera=null,this.layers=new AS,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,i){this.ray.set(e,i)}setFromCamera(e,i){i.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(i.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(i).sub(this.ray.origin).normalize(),this.camera=i):i.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(i.near+i.far)/(i.near-i.far)).unproject(i),this.ray.direction.set(0,0,-1).transformDirection(i.matrixWorld),this.camera=i):console.error("THREE.Raycaster: Unsupported camera type: "+i.type)}setFromXRController(e){return B4.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(B4),this}intersectObject(e,i=!0,n=[]){return eT(e,this,n,i),n.sort(D4),n}intersectObjects(e,i=!0,n=[]){for(let s=0,o=e.length;s<o;s++)eT(e[s],this,n,i);return n.sort(D4),n}}function D4(r,e){return r.distance-e.distance}function eT(r,e,i,n){let s=!0;if(r.layers.test(e.layers)&&r.raycast(e,i)===!1&&(s=!1),s===!0&&n===!0){const o=r.children;for(let l=0,u=o.length;l<u;l++)eT(o[l],e,i,!0)}}class N4{constructor(e=1,i=0,n=0){return this.radius=e,this.phi=i,this.theta=n,this}set(e,i,n){return this.radius=e,this.phi=i,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,i,n){return this.radius=Math.sqrt(e*e+i*i+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Sa(i/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class Dx extends up{constructor(e,i=null){super(),this.object=e,this.domElement=i,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(){}disconnect(){}dispose(){}update(){}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Gb}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Gb);class qs{static roundNumber(e,i){const n=Math.pow(10,i);return Math.round(e*n)/n}static sample(e){return e[Math.floor(Math.random()*e.length)]}static distanceToSquared(e,i){var n=e.x-i.x,s=e.y-i.y,o=e.z-i.z;return n*n+s*s+o*o}static isPointInPoly(e,i){for(var n=!1,s=-1,o=e.length,l=o-1;++s<o;l=s)(e[s].z<=i.z&&i.z<e[l].z||e[l].z<=i.z&&i.z<e[s].z)&&i.x<(e[l].x-e[s].x)*(i.z-e[s].z)/(e[l].z-e[s].z)+e[s].x&&(n=!n);return n}static isVectorInPolygon(e,i,n){var s=1e5,o=-1e5,l=[];return i.vertexIds.forEach(u=>{s=Math.min(n[u].y,s),o=Math.max(n[u].y,o),l.push(n[u])}),!!(e.y<o+.5&&e.y>s-.5&&this.isPointInPoly(l,e))}static triarea2(e,i,n){return(n.x-e.x)*(i.z-e.z)-(i.x-e.x)*(n.z-e.z)}static vequal(e,i){return this.distanceToSquared(e,i)<1e-5}static mergeVertices(e,i=1e-4){i=Math.max(i,Number.EPSILON);for(var n={},s=e.getIndex(),o=e.getAttribute("position"),l=s?s.count:o.count,u=0,c=[],h=[],p=Math.log10(1/i),f=Math.pow(10,p),g=0;g<l;g++){var m=s?s.getX(g):g,y="";y+=~~(o.getX(m)*f)+",",y+=~~(o.getY(m)*f)+",",(y+=~~(o.getZ(m)*f)+",")in n?c.push(n[y]):(h.push(o.getX(m)),h.push(o.getY(m)),h.push(o.getZ(m)),n[y]=u,c.push(u),u++)}const b=new Fo(new Float32Array(h),o.itemSize,o.normalized),v=new Ao;return v.setAttribute("position",b),v.setIndex(c),v}}class cie{constructor(e){this.content=[],this.scoreFunction=e}push(e){this.content.push(e),this.sinkDown(this.content.length-1)}pop(){const e=this.content[0],i=this.content.pop();return this.content.length>0&&(this.content[0]=i,this.bubbleUp(0)),e}remove(e){const i=this.content.indexOf(e),n=this.content.pop();i!==this.content.length-1&&(this.content[i]=n,this.scoreFunction(n)<this.scoreFunction(e)?this.sinkDown(i):this.bubbleUp(i))}size(){return this.content.length}rescoreElement(e){this.sinkDown(this.content.indexOf(e))}sinkDown(e){const i=this.content[e];for(;e>0;){const n=(e+1>>1)-1,s=this.content[n];if(!(this.scoreFunction(i)<this.scoreFunction(s)))break;this.content[n]=i,this.content[e]=s,e=n}}bubbleUp(e){const i=this.content.length,n=this.content[e],s=this.scoreFunction(n);for(;;){const o=e+1<<1,l=o-1;let u,c=null;if(l<i&&(u=this.scoreFunction(this.content[l]),u<s&&(c=l)),o<i&&this.scoreFunction(this.content[o])<(c===null?s:u)&&(c=o),c===null)break;this.content[e]=this.content[c],this.content[c]=n,e=c}}}class uie{constructor(){this.portals=[]}push(e,i){i===void 0&&(i=e),this.portals.push({left:e,right:i})}stringPull(){const e=this.portals,i=[];let n,s,o,l=0,u=0,c=0;n=e[0].left,s=e[0].left,o=e[0].right,i.push(n);for(let h=1;h<e.length;h++){const p=e[h].left,f=e[h].right;if(qs.triarea2(n,o,f)<=0){if(!(qs.vequal(n,o)||qs.triarea2(n,s,f)>0)){i.push(s),n=s,l=u,s=n,o=n,u=l,c=l,h=l;continue}o=f,c=h}if(qs.triarea2(n,s,p)>=0){if(!(qs.vequal(n,s)||qs.triarea2(n,o,p)<0)){i.push(o),n=o,l=c,s=n,o=n,u=l,c=l,h=l;continue}s=p,u=h}}return i.length!==0&&qs.vequal(i[i.length-1],e[e.length-1].left)||i.push(e[e.length-1].left),this.path=i,i}}class tT{constructor(){this.zones={}}static createZone(e,i=1e-4){return(class{static buildZone(n,s){const o=this._buildNavigationMesh(n,s),l={};o.vertices.forEach(c=>{c.x=qs.roundNumber(c.x,2),c.y=qs.roundNumber(c.y,2),c.z=qs.roundNumber(c.z,2)}),l.vertices=o.vertices;const u=this._buildPolygonGroups(o);return l.groups=new Array(u.length),u.forEach((c,h)=>{const p=new Map;c.forEach((g,m)=>{p.set(g,m)});const f=new Array(c.length);c.forEach((g,m)=>{const y=[];g.neighbours.forEach(_=>y.push(p.get(_)));const b=[];g.neighbours.forEach(_=>b.push(this._getSharedVerticesInOrder(g,_)));const v=new at(0,0,0);v.add(l.vertices[g.vertexIds[0]]),v.add(l.vertices[g.vertexIds[1]]),v.add(l.vertices[g.vertexIds[2]]),v.divideScalar(3),v.x=qs.roundNumber(v.x,2),v.y=qs.roundNumber(v.y,2),v.z=qs.roundNumber(v.z,2),f[m]={id:m,neighbours:y,vertexIds:g.vertexIds,centroid:v,portals:b}}),l.groups[h]=f}),l}static _buildNavigationMesh(n,s){return n=qs.mergeVertices(n,s),this._buildPolygonsFromGeometry(n)}static _spreadGroupId(n){let s=new Set([n]);for(;s.size>0;){const o=s;s=new Set,o.forEach(l=>{l.group=n.group,l.neighbours.forEach(u=>{u.group===void 0&&s.add(u)})})}}static _buildPolygonGroups(n){const s=[];return n.polygons.forEach(o=>{o.group!==void 0?s[o.group].push(o):(o.group=s.length,this._spreadGroupId(o),s.push([o]))}),s}static _buildPolygonNeighbours(n,s){const o=new Set,l=s[n.vertexIds[1]],u=s[n.vertexIds[2]];return s[n.vertexIds[0]].forEach(c=>{c!==n&&(l.includes(c)||u.includes(c))&&o.add(c)}),l.forEach(c=>{c!==n&&u.includes(c)&&o.add(c)}),o}static _buildPolygonsFromGeometry(n){const s=[],o=[],l=n.attributes.position,u=n.index,c=[];for(let h=0;h<l.count;h++)o.push(new at().fromBufferAttribute(l,h)),c[h]=[];for(let h=0;h<n.index.count;h+=3){const p=u.getX(h),f=u.getX(h+1),g=u.getX(h+2),m={vertexIds:[p,f,g],neighbours:null};s.push(m),c[p].push(m),c[f].push(m),c[g].push(m)}return s.forEach(h=>{h.neighbours=this._buildPolygonNeighbours(h,c)}),{polygons:s,vertices:o}}static _getSharedVerticesInOrder(n,s){const o=n.vertexIds,l=o[0],u=o[1],c=o[2],h=s.vertexIds,p=h.includes(l),f=h.includes(u),g=h.includes(c);return p&&f&&g?Array.from(o):p&&f?[l,u]:f&&g?[u,c]:p&&g?[c,l]:(console.warn("Error processing navigation mesh neighbors; neighbors with <2 shared vertices found."),[])}}).buildZone(e,i)}setZoneData(e,i){this.zones[e]=i}getRandomNode(e,i,n,s){if(!this.zones[e])return new at;n=n||null,s=s||0;const o=[];return this.zones[e].groups[i].forEach(l=>{n&&s?qs.distanceToSquared(n,l.centroid)<s*s&&o.push(l.centroid):o.push(l.centroid)}),qs.sample(o)||new at}getClosestNode(e,i,n,s=!1){const o=this.zones[i].vertices;let l=null,u=1/0;return this.zones[i].groups[n].forEach(c=>{const h=qs.distanceToSquared(c.centroid,e);h<u&&(!s||qs.isVectorInPolygon(e,c,o))&&(l=c,u=h)}),l}findPath(e,i,n,s){const o=this.zones[n].groups[s],l=this.zones[n].vertices,u=this.getClosestNode(e,n,s,!0),c=this.getClosestNode(i,n,s,!0);if(!u||!c)return null;const h=(class{static init(m){for(let y=0;y<m.length;y++){const b=m[y];b.f=0,b.g=0,b.h=0,b.cost=1,b.visited=!1,b.closed=!1,b.parent=null}}static cleanUp(m){for(let y=0;y<m.length;y++){const b=m[y];delete b.f,delete b.g,delete b.h,delete b.cost,delete b.visited,delete b.closed,delete b.parent}}static heap(){return new cie(function(m){return m.f})}static search(m,y,b){this.init(m);const v=this.heap();for(v.push(y);v.size()>0;){const _=v.pop();if(_===b){let E=_;const C=[];for(;E.parent;)C.push(E),E=E.parent;return this.cleanUp(C),C.reverse()}_.closed=!0;const T=this.neighbours(m,_);for(let E=0,C=T.length;E<C;E++){const R=T[E];if(R.closed)continue;const B=_.g+R.cost,I=R.visited;if(!I||B<R.g){if(R.visited=!0,R.parent=_,!R.centroid||!b.centroid)throw new Error("Unexpected state");R.h=R.h||this.heuristic(R.centroid,b.centroid),R.g=B,R.f=R.g+R.h,I?v.rescoreElement(R):v.push(R)}}}return[]}static heuristic(m,y){return qs.distanceToSquared(m,y)}static neighbours(m,y){const b=[];for(let v=0;v<y.neighbours.length;v++)b.push(m[y.neighbours[v]]);return b}}).search(o,u,c),p=function(m,y){for(var b=0;b<m.neighbours.length;b++)if(m.neighbours[b]===y.id)return m.portals[b]},f=new uie;f.push(e);for(let m=0;m<h.length;m++){const y=h[m],b=h[m+1];if(b){const v=p(y,b);f.push(l[v[0]],l[v[1]])}}f.push(i),f.stringPull();const g=f.path.map(m=>new at(m.x,m.y,m.z));return g.shift(),g}}tT.prototype.getGroup=function(){const r=new lc;return function(e,i,n=!1){if(!this.zones[e])return null;let s=null,o=Math.pow(50,2);const l=this.zones[e];for(let u=0;u<l.groups.length;u++){const c=l.groups[u];for(const h of c){if(n&&(r.setFromCoplanarPoints(l.vertices[h.vertexIds[0]],l.vertices[h.vertexIds[1]],l.vertices[h.vertexIds[2]]),Math.abs(r.distanceToPoint(i))<.01)&&qs.isPointInPoly([l.vertices[h.vertexIds[0]],l.vertices[h.vertexIds[1]],l.vertices[h.vertexIds[2]]],i))return u;const p=qs.distanceToSquared(h.centroid,i);p<o&&(s=u,o=p)}}return s}}(),tT.prototype.clampStep=function(){const r=new at,e=new lc,i=new fp,n=new at;let s,o,l=new at;return function(u,c,h,p,f,g){const m=this.zones[p].vertices,y=this.zones[p].groups[f],b=[h],v={};v[h.id]=0,s=void 0,l.set(0,0,0),o=1/0,e.setFromCoplanarPoints(m[h.vertexIds[0]],m[h.vertexIds[1]],m[h.vertexIds[2]]),e.projectPoint(c,r),n.copy(r);for(let _=b.pop();_;_=b.pop()){i.set(m[_.vertexIds[0]],m[_.vertexIds[1]],m[_.vertexIds[2]]),i.closestPointToPoint(n,r),r.distanceToSquared(n)<o&&(s=_,l.copy(r),o=r.distanceToSquared(n));const T=v[_.id];if(!(T>2))for(let E=0;E<_.neighbours.length;E++){const C=y[_.neighbours[E]];C.id in v||(b.push(C),v[C.id]=T+1)}}return g.copy(l),s}}();class hie extends Za{constructor(){super(),this._playerMarker=new pa(new Lx(.25,32,32),new Nu({color:15631215})),this._targetMarker=new pa(new Bm(.3,.3,.3),new Nu({color:14469912})),this._nodeMarker=new pa(new Bm(.1,.8,.1),new Nu({color:4417387})),this._stepMarker=new pa(new Bm(.1,1,.1),new Nu({color:14472114})),this._pathMarker=new Za,this._pathLineMaterial=new VS({color:41903,linewidth:2}),this._pathPointMaterial=new Nu({color:41903}),this._pathPointGeometry=new Lx(.08),this._markers=[this._playerMarker,this._targetMarker,this._nodeMarker,this._stepMarker,this._pathMarker],this._markers.forEach(e=>{e.visible=!1,this.add(e)})}setPath(e){for(;this._pathMarker.children.length;)this._pathMarker.children[0].visible=!1,this._pathMarker.remove(this._pathMarker.children[0]);e=[this._playerMarker.position].concat(e);const i=new Ao;i.setAttribute("position",new Fo(new Float32Array(3*e.length),3));for(let n=0;n<e.length;n++)i.attributes.position.setXYZ(n,e[n].x,e[n].y+.2,e[n].z);this._pathMarker.add(new x4(i,this._pathLineMaterial));for(let n=0;n<e.length-1;n++){const s=new pa(this._pathPointGeometry,this._pathPointMaterial);s.position.copy(e[n]),s.position.y+=.2,this._pathMarker.add(s)}return this._pathMarker.visible=!0,this}setPlayerPosition(e){return this._playerMarker.position.copy(e),this._playerMarker.visible=!0,this}setTargetPosition(e){return this._targetMarker.position.copy(e),this._targetMarker.visible=!0,this}setNodePosition(e){return this._nodeMarker.position.copy(e),this._nodeMarker.visible=!0,this}setStepPosition(e){return this._stepMarker.position.copy(e),this._stepMarker.visible=!0,this}reset(){for(;this._pathMarker.children.length;)this._pathMarker.children[0].visible=!1,this._pathMarker.remove(this._pathMarker.children[0]);return this._markers.forEach(e=>{e.visible=!1}),this}}const die=Object.freeze(Object.defineProperty({__proto__:null,Pathfinding:tT,PathfindingHelper:hie},Symbol.toStringTag,{value:"Module"})),pie=c2(die),{Pathfinding:P4}=pie,TA=new P4,MA="level";AFRAME.registerSystem("nav",{init:function(){this.navMesh=null,this.agents=new Set},setNavMeshGeometry:function(r){this.navMesh=new THREE.Mesh(r),TA.setZoneData(MA,P4.createZone(r)),Array.from(this.agents).forEach(e=>e.updateNavLocation())},getNavMesh:function(){return this.navMesh},addAgent:function(r){this.agents.add(r)},removeAgent:function(r){this.agents.delete(r)},getPath:function(r,e,i){return this.navMesh?TA.findPath(r,e,MA,i):null},getGroup:function(r){return this.navMesh?TA.getGroup(MA,r):null},getNode:function(r,e){return this.navMesh?TA.getClosestNode(r,MA,e,!0):null},clampStep:function(r,e,i,n,s){if(this.navMesh){if(!n)return s.copy(e),this.getNode(e,i)}else return s.copy(e),null;return TA.clampStep(r,e,n,MA,i,s)}}),AFRAME.registerPrimitive("a-grid",{defaultComponents:{geometry:{primitive:"plane",width:75,height:75},rotation:{x:-90,y:0,z:0},material:{src:"url(https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v1.16.3/assets/grid.png)",repeat:"75 75"}},mappings:{width:"geometry.width",height:"geometry.height",src:"material.src"}}),AFRAME.registerPrimitive("a-ocean",{defaultComponents:{ocean:{},rotation:{x:-90,y:0,z:0}},mappings:{width:"ocean.width",depth:"ocean.depth",density:"ocean.density",amplitude:"ocean.amplitude",amplitudeVariance:"ocean.amplitudeVariance",speed:"ocean.speed",speedVariance:"ocean.speedVariance",color:"ocean.color",opacity:"ocean.opacity"}}),AFRAME.registerComponent("ocean",{schema:{width:{default:10,min:0},depth:{default:10,min:0},density:{default:10},amplitude:{default:.1},amplitudeVariance:{default:.3},speed:{default:1},speedVariance:{default:2},color:{default:"#7AD2F7",type:"color"},opacity:{default:.8}},play:function(){const r=this.el,e=this.data;let i=r.components.material;const n=new THREE.PlaneGeometry(e.width,e.depth,e.density,e.density);this.waves=[];const s=n.getAttribute("position");for(let o=0;o<s.count;o++)this.waves.push({z:s.getZ(o),ang:Math.random()*Math.PI*2,amp:e.amplitude+Math.random()*e.amplitudeVariance,speed:(e.speed+Math.random()*e.speedVariance)/1e3});i||(i={},i.material=new THREE.MeshPhongMaterial({color:e.color,transparent:e.opacity<1,opacity:e.opacity,flatShading:!0})),this.mesh=new THREE.Mesh(n,i.material),r.setObject3D("mesh",this.mesh)},remove:function(){this.el.removeObject3D("mesh")},tick:function(r,e){if(!e)return;const i=this.mesh.geometry.getAttribute("position");for(let n=0;n<i.count;n++){const s=this.waves[n],o=s.z+Math.sin(s.ang)*s.amp;i.setZ(n,o),s.ang+=s.speed*e}i.needsUpdate=!0}}),AFRAME.registerPrimitive("a-tube",{defaultComponents:{tube:{}},mappings:{path:"tube.path",segments:"tube.segments",radius:"tube.radius","radial-segments":"tube.radialSegments",closed:"tube.closed"}}),AFRAME.registerComponent("tube",{schema:{path:{default:[]},segments:{default:64},radius:{default:1},radialSegments:{default:8},closed:{default:!1}},init:function(){const r=this.el,e=this.data;let i=r.components.material;if(!e.path.length){console.error("[a-tube] `path` property expected but not found.");return}const n=new THREE.CatmullRomCurve3(e.path.map(function(o){return o=o.split(" "),new THREE.Vector3(Number(o[0]),Number(o[1]),Number(o[2]))})),s=new THREE.TubeGeometry(n,e.segments,e.radius,e.radialSegments,e.closed);i||(i={},i.material=new THREE.MeshPhongMaterial),this.mesh=new THREE.Mesh(s,i.material),this.el.setObject3D("mesh",this.mesh)},update:function(r){Object.keys(r).length&&(this.remove(),this.init())},remove:function(){this.mesh&&this.el.removeObject3D("mesh")}});var mr=function(r){return typeof r=="function"?r:typeof r=="string"?function(e){return e[r]}:function(e){return r}};const fie=Object.freeze(Object.defineProperty({__proto__:null,default:mr},Symbol.toStringTag,{value:"Module"})),mie=c2(fie);function O4(r,e,i){var n,s=1;r==null&&(r=0),e==null&&(e=0),i==null&&(i=0);function o(){var l,u=n.length,c,h=0,p=0,f=0;for(l=0;l<u;++l)c=n[l],h+=c.x||0,p+=c.y||0,f+=c.z||0;for(h=(h/u-r)*s,p=(p/u-e)*s,f=(f/u-i)*s,l=0;l<u;++l)c=n[l],h&&(c.x-=h),p&&(c.y-=p),f&&(c.z-=f)}return o.initialize=function(l){n=l},o.x=function(l){return arguments.length?(r=+l,o):r},o.y=function(l){return arguments.length?(e=+l,o):e},o.z=function(l){return arguments.length?(i=+l,o):i},o.strength=function(l){return arguments.length?(s=+l,o):s},o}function gie(r){const e=+this._x.call(null,r);return k4(this.cover(e),e,r)}function k4(r,e,i){if(isNaN(e))return r;var n,s=r._root,o={data:i},l=r._x0,u=r._x1,c,h,p,f,g;if(!s)return r._root=o,r;for(;s.length;)if((p=e>=(c=(l+u)/2))?l=c:u=c,n=s,!(s=s[f=+p]))return n[f]=o,r;if(h=+r._x.call(null,s.data),e===h)return o.next=s,n?n[f]=o:r._root=o,r;do n=n?n[f]=new Array(2):r._root=new Array(2),(p=e>=(c=(l+u)/2))?l=c:u=c;while((f=+p)==(g=+(h>=c)));return n[g]=s,n[f]=o,r}function Aie(r){Array.isArray(r)||(r=Array.from(r));const e=r.length,i=new Float64Array(e);let n=1/0,s=-1/0;for(let o=0,l;o<e;++o)isNaN(l=+this._x.call(null,r[o]))||(i[o]=l,l<n&&(n=l),l>s&&(s=l));if(n>s)return this;this.cover(n).cover(s);for(let o=0;o<e;++o)k4(this,i[o],r[o]);return this}function yie(r){if(isNaN(r=+r))return this;var e=this._x0,i=this._x1;if(isNaN(e))i=(e=Math.floor(r))+1;else{for(var n=i-e||1,s=this._root,o,l;e>r||r>=i;)switch(l=+(r<e),o=new Array(2),o[l]=s,s=o,n*=2,l){case 0:i=e+n;break;case 1:e=i-n;break}this._root&&this._root.length&&(this._root=s)}return this._x0=e,this._x1=i,this}function vie(){var r=[];return this.visit(function(e){if(!e.length)do r.push(e.data);while(e=e.next)}),r}function bie(r){return arguments.length?this.cover(+r[0][0]).cover(+r[1][0]):isNaN(this._x0)?void 0:[[this._x0],[this._x1]]}function Ou(r,e,i){this.node=r,this.x0=e,this.x1=i}function xie(r,e){var i,n=this._x0,s,o,l=this._x1,u=[],c=this._root,h,p;for(c&&u.push(new Ou(c,n,l)),e==null?e=1/0:(n=r-e,l=r+e);h=u.pop();)if(!(!(c=h.node)||(s=h.x0)>l||(o=h.x1)<n))if(c.length){var f=(s+o)/2;u.push(new Ou(c[1],f,o),new Ou(c[0],s,f)),(p=+(r>=f))&&(h=u[u.length-1],u[u.length-1]=u[u.length-1-p],u[u.length-1-p]=h)}else{var g=Math.abs(r-+this._x.call(null,c.data));g<e&&(e=g,n=r-g,l=r+g,i=c.data)}return i}function _ie(r){if(isNaN(c=+this._x.call(null,r)))return this;var e,i=this._root,n,s,o,l=this._x0,u=this._x1,c,h,p,f,g;if(!i)return this;if(i.length)for(;;){if((p=c>=(h=(l+u)/2))?l=h:u=h,e=i,!(i=i[f=+p]))return this;if(!i.length)break;e[f+1&1]&&(n=e,g=f)}for(;i.data!==r;)if(s=i,!(i=i.next))return this;return(o=i.next)&&delete i.next,s?(o?s.next=o:delete s.next,this):e?(o?e[f]=o:delete e[f],(i=e[0]||e[1])&&i===(e[1]||e[0])&&!i.length&&(n?n[g]=i:this._root=i),this):(this._root=o,this)}function Eie(r){for(var e=0,i=r.length;e<i;++e)this.remove(r[e]);return this}function wie(){return this._root}function Cie(){var r=0;return this.visit(function(e){if(!e.length)do++r;while(e=e.next)}),r}function Sie(r){var e=[],i,n=this._root,s,o,l;for(n&&e.push(new Ou(n,this._x0,this._x1));i=e.pop();)if(!r(n=i.node,o=i.x0,l=i.x1)&&n.length){var u=(o+l)/2;(s=n[1])&&e.push(new Ou(s,u,l)),(s=n[0])&&e.push(new Ou(s,o,u))}return this}function Tie(r){var e=[],i=[],n;for(this._root&&e.push(new Ou(this._root,this._x0,this._x1));n=e.pop();){var s=n.node;if(s.length){var o,l=n.x0,u=n.x1,c=(l+u)/2;(o=s[0])&&e.push(new Ou(o,l,c)),(o=s[1])&&e.push(new Ou(o,c,u))}i.push(n)}for(;n=i.pop();)r(n.node,n.x0,n.x1);return this}function Mie(r){return r[0]}function Rie(r){return arguments.length?(this._x=r,this):this._x}function F4(r,e){var i=new iT(e??Mie,NaN,NaN);return r==null?i:i.addAll(r)}function iT(r,e,i){this._x=r,this._x0=e,this._x1=i,this._root=void 0}function U4(r){for(var e={data:r.data},i=e;r=r.next;)i=i.next={data:r.data};return e}var Uo=F4.prototype=iT.prototype;Uo.copy=function(){var r=new iT(this._x,this._x0,this._x1),e=this._root,i,n;if(!e)return r;if(!e.length)return r._root=U4(e),r;for(i=[{source:e,target:r._root=new Array(2)}];e=i.pop();)for(var s=0;s<2;++s)(n=e.source[s])&&(n.length?i.push({source:n,target:e.target[s]=new Array(2)}):e.target[s]=U4(n));return r},Uo.add=gie,Uo.addAll=Aie,Uo.cover=yie,Uo.data=vie,Uo.extent=bie,Uo.find=xie,Uo.remove=_ie,Uo.removeAll=Eie,Uo.root=wie,Uo.size=Cie,Uo.visit=Sie,Uo.visitAfter=Tie,Uo.x=Rie;function Iie(r){const e=+this._x.call(null,r),i=+this._y.call(null,r);return z4(this.cover(e,i),e,i,r)}function z4(r,e,i,n){if(isNaN(e)||isNaN(i))return r;var s,o=r._root,l={data:n},u=r._x0,c=r._y0,h=r._x1,p=r._y1,f,g,m,y,b,v,_,T;if(!o)return r._root=l,r;for(;o.length;)if((b=e>=(f=(u+h)/2))?u=f:h=f,(v=i>=(g=(c+p)/2))?c=g:p=g,s=o,!(o=o[_=v<<1|b]))return s[_]=l,r;if(m=+r._x.call(null,o.data),y=+r._y.call(null,o.data),e===m&&i===y)return l.next=o,s?s[_]=l:r._root=l,r;do s=s?s[_]=new Array(4):r._root=new Array(4),(b=e>=(f=(u+h)/2))?u=f:h=f,(v=i>=(g=(c+p)/2))?c=g:p=g;while((_=v<<1|b)===(T=(y>=g)<<1|m>=f));return s[T]=o,s[_]=l,r}function Bie(r){var e,i,n=r.length,s,o,l=new Array(n),u=new Array(n),c=1/0,h=1/0,p=-1/0,f=-1/0;for(i=0;i<n;++i)isNaN(s=+this._x.call(null,e=r[i]))||isNaN(o=+this._y.call(null,e))||(l[i]=s,u[i]=o,s<c&&(c=s),s>p&&(p=s),o<h&&(h=o),o>f&&(f=o));if(c>p||h>f)return this;for(this.cover(c,h).cover(p,f),i=0;i<n;++i)z4(this,l[i],u[i],r[i]);return this}function Lie(r,e){if(isNaN(r=+r)||isNaN(e=+e))return this;var i=this._x0,n=this._y0,s=this._x1,o=this._y1;if(isNaN(i))s=(i=Math.floor(r))+1,o=(n=Math.floor(e))+1;else{for(var l=s-i||1,u=this._root,c,h;i>r||r>=s||n>e||e>=o;)switch(h=(e<n)<<1|r<i,c=new Array(4),c[h]=u,u=c,l*=2,h){case 0:s=i+l,o=n+l;break;case 1:i=s-l,o=n+l;break;case 2:s=i+l,n=o-l;break;case 3:i=s-l,n=o-l;break}this._root&&this._root.length&&(this._root=u)}return this._x0=i,this._y0=n,this._x1=s,this._y1=o,this}function Die(){var r=[];return this.visit(function(e){if(!e.length)do r.push(e.data);while(e=e.next)}),r}function Nie(r){return arguments.length?this.cover(+r[0][0],+r[0][1]).cover(+r[1][0],+r[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function bo(r,e,i,n,s){this.node=r,this.x0=e,this.y0=i,this.x1=n,this.y1=s}function Pie(r,e,i){var n,s=this._x0,o=this._y0,l,u,c,h,p=this._x1,f=this._y1,g=[],m=this._root,y,b;for(m&&g.push(new bo(m,s,o,p,f)),i==null?i=1/0:(s=r-i,o=e-i,p=r+i,f=e+i,i*=i);y=g.pop();)if(!(!(m=y.node)||(l=y.x0)>p||(u=y.y0)>f||(c=y.x1)<s||(h=y.y1)<o))if(m.length){var v=(l+c)/2,_=(u+h)/2;g.push(new bo(m[3],v,_,c,h),new bo(m[2],l,_,v,h),new bo(m[1],v,u,c,_),new bo(m[0],l,u,v,_)),(b=(e>=_)<<1|r>=v)&&(y=g[g.length-1],g[g.length-1]=g[g.length-1-b],g[g.length-1-b]=y)}else{var T=r-+this._x.call(null,m.data),E=e-+this._y.call(null,m.data),C=T*T+E*E;if(C<i){var R=Math.sqrt(i=C);s=r-R,o=e-R,p=r+R,f=e+R,n=m.data}}return n}function Oie(r){if(isNaN(p=+this._x.call(null,r))||isNaN(f=+this._y.call(null,r)))return this;var e,i=this._root,n,s,o,l=this._x0,u=this._y0,c=this._x1,h=this._y1,p,f,g,m,y,b,v,_;if(!i)return this;if(i.length)for(;;){if((y=p>=(g=(l+c)/2))?l=g:c=g,(b=f>=(m=(u+h)/2))?u=m:h=m,e=i,!(i=i[v=b<<1|y]))return this;if(!i.length)break;(e[v+1&3]||e[v+2&3]||e[v+3&3])&&(n=e,_=v)}for(;i.data!==r;)if(s=i,!(i=i.next))return this;return(o=i.next)&&delete i.next,s?(o?s.next=o:delete s.next,this):e?(o?e[v]=o:delete e[v],(i=e[0]||e[1]||e[2]||e[3])&&i===(e[3]||e[2]||e[1]||e[0])&&!i.length&&(n?n[_]=i:this._root=i),this):(this._root=o,this)}function kie(r){for(var e=0,i=r.length;e<i;++e)this.remove(r[e]);return this}function Fie(){return this._root}function Uie(){var r=0;return this.visit(function(e){if(!e.length)do++r;while(e=e.next)}),r}function zie(r){var e=[],i,n=this._root,s,o,l,u,c;for(n&&e.push(new bo(n,this._x0,this._y0,this._x1,this._y1));i=e.pop();)if(!r(n=i.node,o=i.x0,l=i.y0,u=i.x1,c=i.y1)&&n.length){var h=(o+u)/2,p=(l+c)/2;(s=n[3])&&e.push(new bo(s,h,p,u,c)),(s=n[2])&&e.push(new bo(s,o,p,h,c)),(s=n[1])&&e.push(new bo(s,h,l,u,p)),(s=n[0])&&e.push(new bo(s,o,l,h,p))}return this}function jie(r){var e=[],i=[],n;for(this._root&&e.push(new bo(this._root,this._x0,this._y0,this._x1,this._y1));n=e.pop();){var s=n.node;if(s.length){var o,l=n.x0,u=n.y0,c=n.x1,h=n.y1,p=(l+c)/2,f=(u+h)/2;(o=s[0])&&e.push(new bo(o,l,u,p,f)),(o=s[1])&&e.push(new bo(o,p,u,c,f)),(o=s[2])&&e.push(new bo(o,l,f,p,h)),(o=s[3])&&e.push(new bo(o,p,f,c,h))}i.push(n)}for(;n=i.pop();)r(n.node,n.x0,n.y0,n.x1,n.y1);return this}function Vie(r){return r[0]}function Gie(r){return arguments.length?(this._x=r,this):this._x}function Hie(r){return r[1]}function Wie(r){return arguments.length?(this._y=r,this):this._y}function j4(r,e,i){var n=new rT(e??Vie,i??Hie,NaN,NaN,NaN,NaN);return r==null?n:n.addAll(r)}function rT(r,e,i,n,s,o){this._x=r,this._y=e,this._x0=i,this._y0=n,this._x1=s,this._y1=o,this._root=void 0}function V4(r){for(var e={data:r.data},i=e;r=r.next;)i=i.next={data:r.data};return e}var xo=j4.prototype=rT.prototype;xo.copy=function(){var r=new rT(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,i,n;if(!e)return r;if(!e.length)return r._root=V4(e),r;for(i=[{source:e,target:r._root=new Array(4)}];e=i.pop();)for(var s=0;s<4;++s)(n=e.source[s])&&(n.length?i.push({source:n,target:e.target[s]=new Array(4)}):e.target[s]=V4(n));return r},xo.add=Iie,xo.addAll=Bie,xo.cover=Lie,xo.data=Die,xo.extent=Nie,xo.find=Pie,xo.remove=Oie,xo.removeAll=kie,xo.root=Fie,xo.size=Uie,xo.visit=zie,xo.visitAfter=jie,xo.x=Gie,xo.y=Wie;function Qie(r){const e=+this._x.call(null,r),i=+this._y.call(null,r),n=+this._z.call(null,r);return G4(this.cover(e,i,n),e,i,n,r)}function G4(r,e,i,n,s){if(isNaN(e)||isNaN(i)||isNaN(n))return r;var o,l=r._root,u={data:s},c=r._x0,h=r._y0,p=r._z0,f=r._x1,g=r._y1,m=r._z1,y,b,v,_,T,E,C,R,B,I,N;if(!l)return r._root=u,r;for(;l.length;)if((C=e>=(y=(c+f)/2))?c=y:f=y,(R=i>=(b=(h+g)/2))?h=b:g=b,(B=n>=(v=(p+m)/2))?p=v:m=v,o=l,!(l=l[I=B<<2|R<<1|C]))return o[I]=u,r;if(_=+r._x.call(null,l.data),T=+r._y.call(null,l.data),E=+r._z.call(null,l.data),e===_&&i===T&&n===E)return u.next=l,o?o[I]=u:r._root=u,r;do o=o?o[I]=new Array(8):r._root=new Array(8),(C=e>=(y=(c+f)/2))?c=y:f=y,(R=i>=(b=(h+g)/2))?h=b:g=b,(B=n>=(v=(p+m)/2))?p=v:m=v;while((I=B<<2|R<<1|C)===(N=(E>=v)<<2|(T>=b)<<1|_>=y));return o[N]=l,o[I]=u,r}function qie(r){Array.isArray(r)||(r=Array.from(r));const e=r.length,i=new Float64Array(e),n=new Float64Array(e),s=new Float64Array(e);let o=1/0,l=1/0,u=1/0,c=-1/0,h=-1/0,p=-1/0;for(let f=0,g,m,y,b;f<e;++f)isNaN(m=+this._x.call(null,g=r[f]))||isNaN(y=+this._y.call(null,g))||isNaN(b=+this._z.call(null,g))||(i[f]=m,n[f]=y,s[f]=b,m<o&&(o=m),m>c&&(c=m),y<l&&(l=y),y>h&&(h=y),b<u&&(u=b),b>p&&(p=b));if(o>c||l>h||u>p)return this;this.cover(o,l,u).cover(c,h,p);for(let f=0;f<e;++f)G4(this,i[f],n[f],s[f],r[f]);return this}function Xie(r,e,i){if(isNaN(r=+r)||isNaN(e=+e)||isNaN(i=+i))return this;var n=this._x0,s=this._y0,o=this._z0,l=this._x1,u=this._y1,c=this._z1;if(isNaN(n))l=(n=Math.floor(r))+1,u=(s=Math.floor(e))+1,c=(o=Math.floor(i))+1;else{for(var h=l-n||1,p=this._root,f,g;n>r||r>=l||s>e||e>=u||o>i||i>=c;)switch(g=(i<o)<<2|(e<s)<<1|r<n,f=new Array(8),f[g]=p,p=f,h*=2,g){case 0:l=n+h,u=s+h,c=o+h;break;case 1:n=l-h,u=s+h,c=o+h;break;case 2:l=n+h,s=u-h,c=o+h;break;case 3:n=l-h,s=u-h,c=o+h;break;case 4:l=n+h,u=s+h,o=c-h;break;case 5:n=l-h,u=s+h,o=c-h;break;case 6:l=n+h,s=u-h,o=c-h;break;case 7:n=l-h,s=u-h,o=c-h;break}this._root&&this._root.length&&(this._root=p)}return this._x0=n,this._y0=s,this._z0=o,this._x1=l,this._y1=u,this._z1=c,this}function Yie(){var r=[];return this.visit(function(e){if(!e.length)do r.push(e.data);while(e=e.next)}),r}function Kie(r){return arguments.length?this.cover(+r[0][0],+r[0][1],+r[0][2]).cover(+r[1][0],+r[1][1],+r[1][2]):isNaN(this._x0)?void 0:[[this._x0,this._y0,this._z0],[this._x1,this._y1,this._z1]]}function cs(r,e,i,n,s,o,l){this.node=r,this.x0=e,this.y0=i,this.z0=n,this.x1=s,this.y1=o,this.z1=l}function Jie(r,e,i,n){var s,o=this._x0,l=this._y0,u=this._z0,c,h,p,f,g,m,y=this._x1,b=this._y1,v=this._z1,_=[],T=this._root,E,C;for(T&&_.push(new cs(T,o,l,u,y,b,v)),n==null?n=1/0:(o=r-n,l=e-n,u=i-n,y=r+n,b=e+n,v=i+n,n*=n);E=_.pop();)if(!(!(T=E.node)||(c=E.x0)>y||(h=E.y0)>b||(p=E.z0)>v||(f=E.x1)<o||(g=E.y1)<l||(m=E.z1)<u))if(T.length){var R=(c+f)/2,B=(h+g)/2,I=(p+m)/2;_.push(new cs(T[7],R,B,I,f,g,m),new cs(T[6],c,B,I,R,g,m),new cs(T[5],R,h,I,f,B,m),new cs(T[4],c,h,I,R,B,m),new cs(T[3],R,B,p,f,g,I),new cs(T[2],c,B,p,R,g,I),new cs(T[1],R,h,p,f,B,I),new cs(T[0],c,h,p,R,B,I)),(C=(i>=I)<<2|(e>=B)<<1|r>=R)&&(E=_[_.length-1],_[_.length-1]=_[_.length-1-C],_[_.length-1-C]=E)}else{var N=r-+this._x.call(null,T.data),D=e-+this._y.call(null,T.data),P=i-+this._z.call(null,T.data),k=N*N+D*D+P*P;if(k<n){var q=Math.sqrt(n=k);o=r-q,l=e-q,u=i-q,y=r+q,b=e+q,v=i+q,s=T.data}}return s}function Zie(r){if(isNaN(g=+this._x.call(null,r))||isNaN(m=+this._y.call(null,r))||isNaN(y=+this._z.call(null,r)))return this;var e,i=this._root,n,s,o,l=this._x0,u=this._y0,c=this._z0,h=this._x1,p=this._y1,f=this._z1,g,m,y,b,v,_,T,E,C,R,B;if(!i)return this;if(i.length)for(;;){if((T=g>=(b=(l+h)/2))?l=b:h=b,(E=m>=(v=(u+p)/2))?u=v:p=v,(C=y>=(_=(c+f)/2))?c=_:f=_,e=i,!(i=i[R=C<<2|E<<1|T]))return this;if(!i.length)break;(e[R+1&7]||e[R+2&7]||e[R+3&7]||e[R+4&7]||e[R+5&7]||e[R+6&7]||e[R+7&7])&&(n=e,B=R)}for(;i.data!==r;)if(s=i,!(i=i.next))return this;return(o=i.next)&&delete i.next,s?(o?s.next=o:delete s.next,this):e?(o?e[R]=o:delete e[R],(i=e[0]||e[1]||e[2]||e[3]||e[4]||e[5]||e[6]||e[7])&&i===(e[7]||e[6]||e[5]||e[4]||e[3]||e[2]||e[1]||e[0])&&!i.length&&(n?n[B]=i:this._root=i),this):(this._root=o,this)}function $ie(r){for(var e=0,i=r.length;e<i;++e)this.remove(r[e]);return this}function ere(){return this._root}function tre(){var r=0;return this.visit(function(e){if(!e.length)do++r;while(e=e.next)}),r}function ire(r){var e=[],i,n=this._root,s,o,l,u,c,h,p;for(n&&e.push(new cs(n,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));i=e.pop();)if(!r(n=i.node,o=i.x0,l=i.y0,u=i.z0,c=i.x1,h=i.y1,p=i.z1)&&n.length){var f=(o+c)/2,g=(l+h)/2,m=(u+p)/2;(s=n[7])&&e.push(new cs(s,f,g,m,c,h,p)),(s=n[6])&&e.push(new cs(s,o,g,m,f,h,p)),(s=n[5])&&e.push(new cs(s,f,l,m,c,g,p)),(s=n[4])&&e.push(new cs(s,o,l,m,f,g,p)),(s=n[3])&&e.push(new cs(s,f,g,u,c,h,m)),(s=n[2])&&e.push(new cs(s,o,g,u,f,h,m)),(s=n[1])&&e.push(new cs(s,f,l,u,c,g,m)),(s=n[0])&&e.push(new cs(s,o,l,u,f,g,m))}return this}function rre(r){var e=[],i=[],n;for(this._root&&e.push(new cs(this._root,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));n=e.pop();){var s=n.node;if(s.length){var o,l=n.x0,u=n.y0,c=n.z0,h=n.x1,p=n.y1,f=n.z1,g=(l+h)/2,m=(u+p)/2,y=(c+f)/2;(o=s[0])&&e.push(new cs(o,l,u,c,g,m,y)),(o=s[1])&&e.push(new cs(o,g,u,c,h,m,y)),(o=s[2])&&e.push(new cs(o,l,m,c,g,p,y)),(o=s[3])&&e.push(new cs(o,g,m,c,h,p,y)),(o=s[4])&&e.push(new cs(o,l,u,y,g,m,f)),(o=s[5])&&e.push(new cs(o,g,u,y,h,m,f)),(o=s[6])&&e.push(new cs(o,l,m,y,g,p,f)),(o=s[7])&&e.push(new cs(o,g,m,y,h,p,f))}i.push(n)}for(;n=i.pop();)r(n.node,n.x0,n.y0,n.z0,n.x1,n.y1,n.z1);return this}function nre(r){return r[0]}function sre(r){return arguments.length?(this._x=r,this):this._x}function are(r){return r[1]}function ore(r){return arguments.length?(this._y=r,this):this._y}function lre(r){return r[2]}function cre(r){return arguments.length?(this._z=r,this):this._z}function H4(r,e,i,n){var s=new nT(e??nre,i??are,n??lre,NaN,NaN,NaN,NaN,NaN,NaN);return r==null?s:s.addAll(r)}function nT(r,e,i,n,s,o,l,u,c){this._x=r,this._y=e,this._z=i,this._x0=n,this._y0=s,this._z0=o,this._x1=l,this._y1=u,this._z1=c,this._root=void 0}function W4(r){for(var e={data:r.data},i=e;r=r.next;)i=i.next={data:r.data};return e}var eo=H4.prototype=nT.prototype;eo.copy=function(){var r=new nT(this._x,this._y,this._z,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1),e=this._root,i,n;if(!e)return r;if(!e.length)return r._root=W4(e),r;for(i=[{source:e,target:r._root=new Array(8)}];e=i.pop();)for(var s=0;s<8;++s)(n=e.source[s])&&(n.length?i.push({source:n,target:e.target[s]=new Array(8)}):e.target[s]=W4(n));return r},eo.add=Qie,eo.addAll=qie,eo.cover=Xie,eo.data=Yie,eo.extent=Kie,eo.find=Jie,eo.remove=Zie,eo.removeAll=$ie,eo.root=ere,eo.size=tre,eo.visit=ire,eo.visitAfter=rre,eo.x=sre,eo.y=ore,eo.z=cre;function ku(r){return function(){return r}}function Fu(r){return(r()-.5)*1e-6}function ure(r){return r.index}function Q4(r,e){var i=r.get(e);if(!i)throw new Error("node not found: "+e);return i}function q4(r){var e=ure,i=g,n,s=ku(30),o,l,u,c,h,p,f=1;r==null&&(r=[]);function g(_){return 1/Math.min(c[_.source.index],c[_.target.index])}function m(_){for(var T=0,E=r.length;T<f;++T)for(var C=0,R,B,I,N=0,D=0,P=0,k,q;C<E;++C)R=r[C],B=R.source,I=R.target,N=I.x+I.vx-B.x-B.vx||Fu(p),u>1&&(D=I.y+I.vy-B.y-B.vy||Fu(p)),u>2&&(P=I.z+I.vz-B.z-B.vz||Fu(p)),k=Math.sqrt(N*N+D*D+P*P),k=(k-o[C])/k*_*n[C],N*=k,D*=k,P*=k,I.vx-=N*(q=h[C]),u>1&&(I.vy-=D*q),u>2&&(I.vz-=P*q),B.vx+=N*(q=1-q),u>1&&(B.vy+=D*q),u>2&&(B.vz+=P*q)}function y(){if(l){var _,T=l.length,E=r.length,C=new Map(l.map((B,I)=>[e(B,I,l),B])),R;for(_=0,c=new Array(T);_<E;++_)R=r[_],R.index=_,typeof R.source!="object"&&(R.source=Q4(C,R.source)),typeof R.target!="object"&&(R.target=Q4(C,R.target)),c[R.source.index]=(c[R.source.index]||0)+1,c[R.target.index]=(c[R.target.index]||0)+1;for(_=0,h=new Array(E);_<E;++_)R=r[_],h[_]=c[R.source.index]/(c[R.source.index]+c[R.target.index]);n=new Array(E),b(),o=new Array(E),v()}}function b(){if(l)for(var _=0,T=r.length;_<T;++_)n[_]=+i(r[_],_,r)}function v(){if(l)for(var _=0,T=r.length;_<T;++_)o[_]=+s(r[_],_,r)}return m.initialize=function(_,...T){l=_,p=T.find(E=>typeof E=="function")||Math.random,u=T.find(E=>[1,2,3].includes(E))||2,y()},m.links=function(_){return arguments.length?(r=_,y(),m):r},m.id=function(_){return arguments.length?(e=_,m):e},m.iterations=function(_){return arguments.length?(f=+_,m):f},m.strength=function(_){return arguments.length?(i=typeof _=="function"?_:ku(+_),b(),m):i},m.distance=function(_){return arguments.length?(s=typeof _=="function"?_:ku(+_),v(),m):s},m}var hre={value:()=>{}};function RA(){for(var r=0,e=arguments.length,i={},n;r<e;++r){if(!(n=arguments[r]+"")||n in i||/[\s.]/.test(n))throw new Error("illegal type: "+n);i[n]=[]}return new Nx(i)}function Nx(r){this._=r}function dre(r,e){return r.trim().split(/^|\s+/).map(function(i){var n="",s=i.indexOf(".");if(s>=0&&(n=i.slice(s+1),i=i.slice(0,s)),i&&!e.hasOwnProperty(i))throw new Error("unknown type: "+i);return{type:i,name:n}})}Nx.prototype=RA.prototype={constructor:Nx,on:function(r,e){var i=this._,n=dre(r+"",i),s,o=-1,l=n.length;if(arguments.length<2){for(;++o<l;)if((s=(r=n[o]).type)&&(s=pre(i[s],r.name)))return s;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++o<l;)if(s=(r=n[o]).type)i[s]=X4(i[s],r.name,e);else if(e==null)for(s in i)i[s]=X4(i[s],r.name,null);return this},copy:function(){var r={},e=this._;for(var i in e)r[i]=e[i].slice();return new Nx(r)},call:function(r,e){if((s=arguments.length-2)>0)for(var i=new Array(s),n=0,s,o;n<s;++n)i[n]=arguments[n+2];if(!this._.hasOwnProperty(r))throw new Error("unknown type: "+r);for(o=this._[r],n=0,s=o.length;n<s;++n)o[n].value.apply(e,i)},apply:function(r,e,i){if(!this._.hasOwnProperty(r))throw new Error("unknown type: "+r);for(var n=this._[r],s=0,o=n.length;s<o;++s)n[s].value.apply(e,i)}};function pre(r,e){for(var i=0,n=r.length,s;i<n;++i)if((s=r[i]).name===e)return s.value}function X4(r,e,i){for(var n=0,s=r.length;n<s;++n)if(r[n].name===e){r[n]=hre,r=r.slice(0,n).concat(r.slice(n+1));break}return i!=null&&r.push({name:e,value:i}),r}var Vm=0,IA=0,BA=0,Y4=1e3,Px,LA,Ox=0,Ep=0,kx=0,DA=typeof performance=="object"&&performance.now?performance:Date,K4=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(r){setTimeout(r,17)};function sT(){return Ep||(K4(fre),Ep=DA.now()+kx)}function fre(){Ep=0}function Fx(){this._call=this._time=this._next=null}Fx.prototype=aT.prototype={constructor:Fx,restart:function(r,e,i){if(typeof r!="function")throw new TypeError("callback is not a function");i=(i==null?sT():+i)+(e==null?0:+e),!this._next&&LA!==this&&(LA?LA._next=this:Px=this,LA=this),this._call=r,this._time=i,oT()},stop:function(){this._call&&(this._call=null,this._time=1/0,oT())}};function aT(r,e,i){var n=new Fx;return n.restart(r,e,i),n}function mre(){sT(),++Vm;for(var r=Px,e;r;)(e=Ep-r._time)>=0&&r._call.call(void 0,e),r=r._next;--Vm}function J4(){Ep=(Ox=DA.now())+kx,Vm=IA=0;try{mre()}finally{Vm=0,Are(),Ep=0}}function gre(){var r=DA.now(),e=r-Ox;e>Y4&&(kx-=e,Ox=r)}function Are(){for(var r,e=Px,i,n=1/0;e;)e._call?(n>e._time&&(n=e._time),r=e,e=e._next):(i=e._next,e._next=null,e=r?r._next=i:Px=i);LA=r,oT(n)}function oT(r){if(!Vm){IA&&(IA=clearTimeout(IA));var e=r-Ep;e>24?(r<1/0&&(IA=setTimeout(J4,r-DA.now()-kx)),BA&&(BA=clearInterval(BA))):(BA||(Ox=DA.now(),BA=setInterval(gre,Y4)),Vm=1,K4(J4))}}function Z4(r,e,i){var n=new Fx;return e=e==null?0:+e,n.restart(s=>{n.stop(),r(s+e)},e,i),n}const yre=1664525,vre=1013904223,$4=4294967296;function bre(){let r=1;return()=>(r=(yre*r+vre)%$4)/$4}var ek=3;function lT(r){return r.x}function tk(r){return r.y}function xre(r){return r.z}var _re=10,Ere=Math.PI*(3-Math.sqrt(5)),wre=Math.PI*20/(9+Math.sqrt(221));function ik(r,e){e=e||2;var i=Math.min(ek,Math.max(1,Math.round(e))),n,s=1,o=.001,l=1-Math.pow(o,1/300),u=0,c=.6,h=new Map,p=aT(m),f=RA("tick","end"),g=bre();r==null&&(r=[]);function m(){y(),f.call("tick",n),s<o&&(p.stop(),f.call("end",n))}function y(_){var T,E=r.length,C;_===void 0&&(_=1);for(var R=0;R<_;++R)for(s+=(u-s)*l,h.forEach(function(B){B(s)}),T=0;T<E;++T)C=r[T],C.fx==null?C.x+=C.vx*=c:(C.x=C.fx,C.vx=0),i>1&&(C.fy==null?C.y+=C.vy*=c:(C.y=C.fy,C.vy=0)),i>2&&(C.fz==null?C.z+=C.vz*=c:(C.z=C.fz,C.vz=0));return n}function b(){for(var _=0,T=r.length,E;_<T;++_){if(E=r[_],E.index=_,E.fx!=null&&(E.x=E.fx),E.fy!=null&&(E.y=E.fy),E.fz!=null&&(E.z=E.fz),isNaN(E.x)||i>1&&isNaN(E.y)||i>2&&isNaN(E.z)){var C=_re*(i>2?Math.cbrt(.5+_):i>1?Math.sqrt(.5+_):_),R=_*Ere,B=_*wre;i===1?E.x=C:i===2?(E.x=C*Math.cos(R),E.y=C*Math.sin(R)):(E.x=C*Math.sin(R)*Math.cos(B),E.y=C*Math.cos(R),E.z=C*Math.sin(R)*Math.sin(B))}(isNaN(E.vx)||i>1&&isNaN(E.vy)||i>2&&isNaN(E.vz))&&(E.vx=0,i>1&&(E.vy=0),i>2&&(E.vz=0))}}function v(_){return _.initialize&&_.initialize(r,g,i),_}return b(),n={tick:y,restart:function(){return p.restart(m),n},stop:function(){return p.stop(),n},numDimensions:function(_){return arguments.length?(i=Math.min(ek,Math.max(1,Math.round(_))),h.forEach(v),n):i},nodes:function(_){return arguments.length?(r=_,b(),h.forEach(v),n):r},alpha:function(_){return arguments.length?(s=+_,n):s},alphaMin:function(_){return arguments.length?(o=+_,n):o},alphaDecay:function(_){return arguments.length?(l=+_,n):+l},alphaTarget:function(_){return arguments.length?(u=+_,n):u},velocityDecay:function(_){return arguments.length?(c=1-_,n):1-c},randomSource:function(_){return arguments.length?(g=_,h.forEach(v),n):g},force:function(_,T){return arguments.length>1?(T==null?h.delete(_):h.set(_,v(T)),n):h.get(_)},find:function(){var _=Array.prototype.slice.call(arguments),T=_.shift()||0,E=(i>1?_.shift():null)||0,C=(i>2?_.shift():null)||0,R=_.shift()||1/0,B=0,I=r.length,N,D,P,k,q,V;for(R*=R,B=0;B<I;++B)q=r[B],N=T-q.x,D=E-(q.y||0),P=C-(q.z||0),k=N*N+D*D+P*P,k<R&&(V=q,R=k);return V},on:function(_,T){return arguments.length>1?(f.on(_,T),n):f.on(_)}}}function rk(){var r,e,i,n,s,o=ku(-30),l,u=1,c=1/0,h=.81;function p(y){var b,v=r.length,_=(e===1?F4(r,lT):e===2?j4(r,lT,tk):e===3?H4(r,lT,tk,xre):null).visitAfter(g);for(s=y,b=0;b<v;++b)i=r[b],_.visit(m)}function f(){if(r){var y,b=r.length,v;for(l=new Array(b),y=0;y<b;++y)v=r[y],l[v.index]=+o(v,y,r)}}function g(y){var b=0,v,_,T=0,E,C,R,B,I=y.length;if(I){for(E=C=R=B=0;B<I;++B)(v=y[B])&&(_=Math.abs(v.value))&&(b+=v.value,T+=_,E+=_*(v.x||0),C+=_*(v.y||0),R+=_*(v.z||0));b*=Math.sqrt(4/I),y.x=E/T,e>1&&(y.y=C/T),e>2&&(y.z=R/T)}else{v=y,v.x=v.data.x,e>1&&(v.y=v.data.y),e>2&&(v.z=v.data.z);do b+=l[v.data.index];while(v=v.next)}y.value=b}function m(y,b,v,_,T){if(!y.value)return!0;var E=[v,_,T][e-1],C=y.x-i.x,R=e>1?y.y-i.y:0,B=e>2?y.z-i.z:0,I=E-b,N=C*C+R*R+B*B;if(I*I/h<N)return N<c&&(C===0&&(C=Fu(n),N+=C*C),e>1&&R===0&&(R=Fu(n),N+=R*R),e>2&&B===0&&(B=Fu(n),N+=B*B),N<u&&(N=Math.sqrt(u*N)),i.vx+=C*y.value*s/N,e>1&&(i.vy+=R*y.value*s/N),e>2&&(i.vz+=B*y.value*s/N)),!0;if(!(y.length||N>=c)){(y.data!==i||y.next)&&(C===0&&(C=Fu(n),N+=C*C),e>1&&R===0&&(R=Fu(n),N+=R*R),e>2&&B===0&&(B=Fu(n),N+=B*B),N<u&&(N=Math.sqrt(u*N)));do y.data!==i&&(I=l[y.data.index]*s/N,i.vx+=C*I,e>1&&(i.vy+=R*I),e>2&&(i.vz+=B*I));while(y=y.next)}}return p.initialize=function(y,...b){r=y,n=b.find(v=>typeof v=="function")||Math.random,e=b.find(v=>[1,2,3].includes(v))||2,f()},p.strength=function(y){return arguments.length?(o=typeof y=="function"?y:ku(+y),f(),p):o},p.distanceMin=function(y){return arguments.length?(u=y*y,p):Math.sqrt(u)},p.distanceMax=function(y){return arguments.length?(c=y*y,p):Math.sqrt(c)},p.theta=function(y){return arguments.length?(h=y*y,p):Math.sqrt(h)},p}function nk(r,e,i,n){var s,o,l=ku(.1),u,c;typeof r!="function"&&(r=ku(+r)),e==null&&(e=0),i==null&&(i=0),n==null&&(n=0);function h(f){for(var g=0,m=s.length;g<m;++g){var y=s[g],b=y.x-e||1e-6,v=(y.y||0)-i||1e-6,_=(y.z||0)-n||1e-6,T=Math.sqrt(b*b+v*v+_*_),E=(c[g]-T)*u[g]*f/T;y.vx+=b*E,o>1&&(y.vy+=v*E),o>2&&(y.vz+=_*E)}}function p(){if(s){var f,g=s.length;for(u=new Array(g),c=new Array(g),f=0;f<g;++f)c[f]=+r(s[f],f,s),u[f]=isNaN(c[f])?0:+l(s[f],f,s)}}return h.initialize=function(f,...g){s=f,o=g.find(m=>[1,2,3].includes(m))||2,p()},h.strength=function(f){return arguments.length?(l=typeof f=="function"?f:ku(+f),p(),h):l},h.radius=function(f){return arguments.length?(r=typeof f=="function"?f:ku(+f),p(),h):r},h.x=function(f){return arguments.length?(e=+f,h):e},h.y=function(f){return arguments.length?(i=+f,h):i},h.z=function(f){return arguments.length?(n=+f,h):n},h}var cT=function(r){Sre(r);var e=Cre(r);return r.on=e.on,r.off=e.off,r.fire=e.fire,r};function Cre(r){var e=Object.create(null);return{on:function(i,n,s){if(typeof n!="function")throw new Error("callback is expected to be a function");var o=e[i];return o||(o=e[i]=[]),o.push({callback:n,ctx:s}),r},off:function(i,n){var s=typeof i>"u";if(s)return e=Object.create(null),r;if(e[i]){var o=typeof n!="function";if(o)delete e[i];else for(var l=e[i],u=0;u<l.length;++u)l[u].callback===n&&l.splice(u,1)}return r},fire:function(i){var n=e[i];if(!n)return r;var s;arguments.length>1&&(s=Array.prototype.splice.call(arguments,1));for(var o=0;o<n.length;++o){var l=n[o];l.callback.apply(l.ctx,s)}return r}}}function Sre(r){if(!r)throw new Error("Eventify cannot use falsy object as events subject");for(var e=["on","fire","off"],i=0;i<e.length;++i)if(r.hasOwnProperty(e[i]))throw new Error("Subject cannot be eventified, since it already has property '"+e[i]+"'")}var Tre=Rre,Mre=cT;function Rre(r){if(r=r||{},"uniqueLinkId"in r&&(console.warn("ngraph.graph: Starting from version 0.14 `uniqueLinkId` is deprecated.\nUse `multigraph` option instead\n",`
`,`Note: there is also change in default behavior: From now on each graph
is considered to be not a multigraph by default (each edge is unique).`),r.multigraph=r.uniqueLinkId),r.multigraph===void 0&&(r.multigraph=!1),typeof Map!="function")throw new Error("ngraph.graph requires `Map` to be defined. Please polyfill it before using ngraph");var e=new Map,i=new Map,n={},s=0,o=r.multigraph?C:E,l=[],u=W,c=W,h=W,p=W,f={version:20,addNode:b,addLink:T,removeLink:N,removeNode:_,getNode:v,getNodeCount:R,getLinkCount:B,getEdgeCount:B,getLinksCount:B,getNodesCount:R,getLinks:I,forEachNode:te,forEachLinkedNode:V,forEachLink:q,beginUpdate:h,endUpdate:p,clear:k,hasLink:P,hasNode:v,getLink:P};return Mre(f),g(),f;function g(){var Y=f.on;f.on=se;function se(){return f.beginUpdate=h=G,f.endUpdate=p=z,u=m,c=y,f.on=Y,Y.apply(f,arguments)}}function m(Y,se){l.push({link:Y,changeType:se})}function y(Y,se){l.push({node:Y,changeType:se})}function b(Y,se){if(Y===void 0)throw new Error("Invalid node identifier");h();var ve=v(Y);return ve?(ve.data=se,c(ve,"update")):(ve=new Ire(Y,se),c(ve,"add")),e.set(Y,ve),p(),ve}function v(Y){return e.get(Y)}function _(Y){var se=v(Y);if(!se)return!1;h();var ve=se.links;return ve&&(ve.forEach(D),se.links=null),e.delete(Y),c(se,"remove"),p(),!0}function T(Y,se,ve){h();var Ae=v(Y)||b(Y),me=v(se)||b(se),Oe=o(Y,se,ve),Xe=i.has(Oe.id);return i.set(Oe.id,Oe),sk(Ae,Oe),Y!==se&&sk(me,Oe),u(Oe,Xe?"update":"add"),p(),Oe}function E(Y,se,ve){var Ae=Ux(Y,se),me=i.get(Ae);return me?(me.data=ve,me):new ak(Y,se,ve,Ae)}function C(Y,se,ve){var Ae=Ux(Y,se),me=n.hasOwnProperty(Ae);if(me||P(Y,se)){me||(n[Ae]=0);var Oe="@"+ ++n[Ae];Ae=Ux(Y+Oe,se+Oe)}return new ak(Y,se,ve,Ae)}function R(){return e.size}function B(){return i.size}function I(Y){var se=v(Y);return se?se.links:null}function N(Y,se){return se!==void 0&&(Y=P(Y,se)),D(Y)}function D(Y){if(!Y||!i.get(Y.id))return!1;h(),i.delete(Y.id);var se=v(Y.fromId),ve=v(Y.toId);return se&&se.links.delete(Y),ve&&ve.links.delete(Y),u(Y,"remove"),p(),!0}function P(Y,se){if(!(Y===void 0||se===void 0))return i.get(Ux(Y,se))}function k(){h(),te(function(Y){_(Y.id)}),p()}function q(Y){if(typeof Y=="function")for(var se=i.values(),ve=se.next();!ve.done;){if(Y(ve.value))return!0;ve=se.next()}}function V(Y,se,ve){var Ae=v(Y);if(Ae&&Ae.links&&typeof se=="function")return ve?Q(Ae.links,Y,se):j(Ae.links,Y,se)}function j(Y,se,ve){for(var Ae,me=Y.values(),Oe=me.next();!Oe.done;){var Xe=Oe.value,Je=Xe.fromId===se?Xe.toId:Xe.fromId;if(Ae=ve(e.get(Je),Xe),Ae)return!0;Oe=me.next()}}function Q(Y,se,ve){for(var Ae,me=Y.values(),Oe=me.next();!Oe.done;){var Xe=Oe.value;if(Xe.fromId===se&&(Ae=ve(e.get(Xe.toId),Xe),Ae))return!0;Oe=me.next()}}function W(){}function G(){s+=1}function z(){s-=1,s===0&&l.length>0&&(f.fire("changed",l),l.length=0)}function te(Y){if(typeof Y!="function")throw new Error("Function is expected to iterate over graph nodes. You passed "+Y);for(var se=e.values(),ve=se.next();!ve.done;){if(Y(ve.value))return!0;ve=se.next()}}}function Ire(r,e){this.id=r,this.links=null,this.data=e}function sk(r,e){r.links?r.links.add(e):r.links=new Set([e])}function ak(r,e,i,n){this.fromId=r,this.toId=e,this.data=i,this.id=n}function Ux(r,e){return r.toString()+"👉 "+e.toString()}const Bre=l2(Tre);var uT={exports:{}},NA={exports:{}},ok=function(r){return r===0?"x":r===1?"y":r===2?"z":"c"+(r+1)};const Lre=ok;var Gm=function(r){return e;function e(i,n){let s=n&&n.indent||0,o=n&&n.join!==void 0?n.join:`
`,l=Array(s+1).join(" "),u=[];for(let c=0;c<r;++c){let h=Lre(c),p=c===0?"":l;u.push(p+i.replace(/{var}/g,h))}return u.join(o)}};const lk=Gm;NA.exports=Dre,NA.exports.generateCreateBodyFunctionBody=ck,NA.exports.getVectorCode=hk,NA.exports.getBodyCode=uk;function Dre(r,e){let i=ck(r,e),{Body:n}=new Function(i)();return n}function ck(r,e){return`
${hk(r,e)}
${uk(r)}
return {Body: Body, Vector: Vector};
`}function uk(r){let e=lk(r),i=e("{var}",{join:", "});return`
function Body(${i}) {
  this.isPinned = false;
  this.pos = new Vector(${i});
  this.force = new Vector();
  this.velocity = new Vector();
  this.mass = 1;

  this.springCount = 0;
  this.springLength = 0;
}

Body.prototype.reset = function() {
  this.force.reset();
  this.springCount = 0;
  this.springLength = 0;
}

Body.prototype.setPosition = function (${i}) {
  ${e("this.pos.{var} = {var} || 0;",{indent:2})}
};`}function hk(r,e){let i=lk(r),n="";return e&&(n=`${i(`
   var v{var};
Object.defineProperty(this, '{var}', {
  set: function(v) { 
    if (!Number.isFinite(v)) throw new Error('Cannot set non-numbers to {var}');
    v{var} = v; 
  },
  get: function() { return v{var}; }
});`)}`),`function Vector(${i("{var}",{join:", "})}) {
  ${n}
    if (typeof arguments[0] === 'object') {
      // could be another vector
      let v = arguments[0];
      ${i('if (!Number.isFinite(v.{var})) throw new Error("Expected value is not a finite number at Vector constructor ({var})");',{indent:4})}
      ${i("this.{var} = v.{var};",{indent:4})}
    } else {
      ${i('this.{var} = typeof {var} === "number" ? {var} : 0;',{indent:4})}
    }
  }
  
  Vector.prototype.reset = function () {
    ${i("this.{var} = ",{join:""})}0;
  };`}var Nre=NA.exports,ed={exports:{}};const hT=Gm,td=ok;ed.exports=Pre,ed.exports.generateQuadTreeFunctionBody=dk,ed.exports.getInsertStackCode=Ak,ed.exports.getQuadNodeCode=gk,ed.exports.isSamePosition=pk,ed.exports.getChildBodyCode=mk,ed.exports.setChildBodyCode=fk;function Pre(r){let e=dk(r);return new Function(e)()}function dk(r){let e=hT(r),i=Math.pow(2,r);return`
${Ak()}
${gk(r)}
${pk(r)}
${mk(r)}
${fk(r)}

function createQuadTree(options, random) {
  options = options || {};
  options.gravity = typeof options.gravity === 'number' ? options.gravity : -1;
  options.theta = typeof options.theta === 'number' ? options.theta : 0.8;

  var gravity = options.gravity;
  var updateQueue = [];
  var insertStack = new InsertStack();
  var theta = options.theta;

  var nodesCache = [];
  var currentInCache = 0;
  var root = newNode();

  return {
    insertBodies: insertBodies,

    /**
     * Gets root node if it is present
     */
    getRoot: function() {
      return root;
    },

    updateBodyForce: update,

    options: function(newOptions) {
      if (newOptions) {
        if (typeof newOptions.gravity === 'number') {
          gravity = newOptions.gravity;
        }
        if (typeof newOptions.theta === 'number') {
          theta = newOptions.theta;
        }

        return this;
      }

      return {
        gravity: gravity,
        theta: theta
      };
    }
  };

  function newNode() {
    // To avoid pressure on GC we reuse nodes.
    var node = nodesCache[currentInCache];
    if (node) {
${o("      node.")}
      node.body = null;
      node.mass = ${e("node.mass_{var} = ",{join:""})}0;
      ${e("node.min_{var} = node.max_{var} = ",{join:""})}0;
    } else {
      node = new QuadNode();
      nodesCache[currentInCache] = node;
    }

    ++currentInCache;
    return node;
  }

  function update(sourceBody) {
    var queue = updateQueue;
    var v;
    ${e("var d{var};",{indent:4})}
    var r; 
    ${e("var f{var} = 0;",{indent:4})}
    var queueLength = 1;
    var shiftIdx = 0;
    var pushIdx = 1;

    queue[0] = root;

    while (queueLength) {
      var node = queue[shiftIdx];
      var body = node.body;

      queueLength -= 1;
      shiftIdx += 1;
      var differentBody = (body !== sourceBody);
      if (body && differentBody) {
        // If the current node is a leaf node (and it is not source body),
        // calculate the force exerted by the current node on body, and add this
        // amount to body's net force.
        ${e("d{var} = body.pos.{var} - sourceBody.pos.{var};",{indent:8})}
        r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});

        if (r === 0) {
          // Poor man's protection against zero distance.
          ${e("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10})}
          r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});
        }

        // This is standard gravitation force calculation but we divide
        // by r^3 to save two operations when normalizing force vector.
        v = gravity * body.mass * sourceBody.mass / (r * r * r);
        ${e("f{var} += v * d{var};",{indent:8})}
      } else if (differentBody) {
        // Otherwise, calculate the ratio s / r,  where s is the width of the region
        // represented by the internal node, and r is the distance between the body
        // and the node's center-of-mass
        ${e("d{var} = node.mass_{var} / node.mass - sourceBody.pos.{var};",{indent:8})}
        r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});

        if (r === 0) {
          // Sorry about code duplication. I don't want to create many functions
          // right away. Just want to see performance first.
          ${e("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10})}
          r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});
        }
        // If s / r < θ, treat this internal node as a single body, and calculate the
        // force it exerts on sourceBody, and add this amount to sourceBody's net force.
        if ((node.max_${td(0)} - node.min_${td(0)}) / r < theta) {
          // in the if statement above we consider node's width only
          // because the region was made into square during tree creation.
          // Thus there is no difference between using width or height.
          v = gravity * node.mass * sourceBody.mass / (r * r * r);
          ${e("f{var} += v * d{var};",{indent:10})}
        } else {
          // Otherwise, run the procedure recursively on each of the current node's children.

          // I intentionally unfolded this loop, to save several CPU cycles.
${s()}
        }
      }
    }

    ${e("sourceBody.force.{var} += f{var};",{indent:4})}
  }

  function insertBodies(bodies) {
    ${e("var {var}min = Number.MAX_VALUE;",{indent:4})}
    ${e("var {var}max = Number.MIN_VALUE;",{indent:4})}
    var i = bodies.length;

    // To reduce quad tree depth we are looking for exact bounding box of all particles.
    while (i--) {
      var pos = bodies[i].pos;
      ${e("if (pos.{var} < {var}min) {var}min = pos.{var};",{indent:6})}
      ${e("if (pos.{var} > {var}max) {var}max = pos.{var};",{indent:6})}
    }

    // Makes the bounds square.
    var maxSideLength = -Infinity;
    ${e("if ({var}max - {var}min > maxSideLength) maxSideLength = {var}max - {var}min ;",{indent:4})}

    currentInCache = 0;
    root = newNode();
    ${e("root.min_{var} = {var}min;",{indent:4})}
    ${e("root.max_{var} = {var}min + maxSideLength;",{indent:4})}

    i = bodies.length - 1;
    if (i >= 0) {
      root.body = bodies[i];
    }
    while (i--) {
      insert(bodies[i], root);
    }
  }

  function insert(newBody) {
    insertStack.reset();
    insertStack.push(root, newBody);

    while (!insertStack.isEmpty()) {
      var stackItem = insertStack.pop();
      var node = stackItem.node;
      var body = stackItem.body;

      if (!node.body) {
        // This is internal node. Update the total mass of the node and center-of-mass.
        ${e("var {var} = body.pos.{var};",{indent:8})}
        node.mass += body.mass;
        ${e("node.mass_{var} += body.mass * {var};",{indent:8})}

        // Recursively insert the body in the appropriate quadrant.
        // But first find the appropriate quadrant.
        var quadIdx = 0; // Assume we are in the 0's quad.
        ${e("var min_{var} = node.min_{var};",{indent:8})}
        ${e("var max_{var} = (min_{var} + node.max_{var}) / 2;",{indent:8})}

${n(8)}

        var child = getChild(node, quadIdx);

        if (!child) {
          // The node is internal but this quadrant is not taken. Add
          // subnode to it.
          child = newNode();
          ${e("child.min_{var} = min_{var};",{indent:10})}
          ${e("child.max_{var} = max_{var};",{indent:10})}
          child.body = body;

          setChild(node, quadIdx, child);
        } else {
          // continue searching in this quadrant.
          insertStack.push(child, body);
        }
      } else {
        // We are trying to add to the leaf node.
        // We have to convert current leaf into internal node
        // and continue adding two nodes.
        var oldBody = node.body;
        node.body = null; // internal nodes do not cary bodies

        if (isSamePosition(oldBody.pos, body.pos)) {
          // Prevent infinite subdivision by bumping one node
          // anywhere in this quadrant
          var retriesCount = 3;
          do {
            var offset = random.nextDouble();
            ${e("var d{var} = (node.max_{var} - node.min_{var}) * offset;",{indent:12})}

            ${e("oldBody.pos.{var} = node.min_{var} + d{var};",{indent:12})}
            retriesCount -= 1;
            // Make sure we don't bump it out of the box. If we do, next iteration should fix it
          } while (retriesCount > 0 && isSamePosition(oldBody.pos, body.pos));

          if (retriesCount === 0 && isSamePosition(oldBody.pos, body.pos)) {
            // This is very bad, we ran out of precision.
            // if we do not return from the method we'll get into
            // infinite loop here. So we sacrifice correctness of layout, and keep the app running
            // Next layout iteration should get larger bounding box in the first step and fix this
            return;
          }
        }
        // Next iteration should subdivide node further.
        insertStack.push(node, oldBody);
        insertStack.push(node, body);
      }
    }
  }
}
return createQuadTree;

`;function n(l){let u=[],c=Array(l+1).join(" ");for(let h=0;h<r;++h)u.push(c+`if (${td(h)} > max_${td(h)}) {`),u.push(c+`  quadIdx = quadIdx + ${Math.pow(2,h)};`),u.push(c+`  min_${td(h)} = max_${td(h)};`),u.push(c+`  max_${td(h)} = node.max_${td(h)};`),u.push(c+"}");return u.join(`
`)}function s(){let l=Array(11).join(" "),u=[];for(let c=0;c<i;++c)u.push(l+`if (node.quad${c}) {`),u.push(l+`  queue[pushIdx] = node.quad${c};`),u.push(l+"  queueLength += 1;"),u.push(l+"  pushIdx += 1;"),u.push(l+"}");return u.join(`
`)}function o(l){let u=[];for(let c=0;c<i;++c)u.push(`${l}quad${c} = null;`);return u.join(`
`)}}function pk(r){let e=hT(r);return`
  function isSamePosition(point1, point2) {
    ${e("var d{var} = Math.abs(point1.{var} - point2.{var});",{indent:2})}
  
    return ${e("d{var} < 1e-8",{join:" && "})};
  }  
`}function fk(r){var e=Math.pow(2,r);return`
function setChild(node, idx, child) {
  ${i()}
}`;function i(){let n=[];for(let s=0;s<e;++s){let o=s===0?"  ":"  else ";n.push(`${o}if (idx === ${s}) node.quad${s} = child;`)}return n.join(`
`)}}function mk(r){return`function getChild(node, idx) {
${e()}
  return null;
}`;function e(){let i=[],n=Math.pow(2,r);for(let s=0;s<n;++s)i.push(`  if (idx === ${s}) return node.quad${s};`);return i.join(`
`)}}function gk(r){let e=hT(r),i=Math.pow(2,r);var n=`
function QuadNode() {
  // body stored inside this node. In quad tree only leaf nodes (by construction)
  // contain bodies:
  this.body = null;

  // Child nodes are stored in quads. Each quad is presented by number:
  // 0 | 1
  // -----
  // 2 | 3
${s("  this.")}

  // Total mass of current node
  this.mass = 0;

  // Center of mass coordinates
  ${e("this.mass_{var} = 0;",{indent:2})}

  // bounding box coordinates
  ${e("this.min_{var} = 0;",{indent:2})}
  ${e("this.max_{var} = 0;",{indent:2})}
}
`;return n;function s(o){let l=[];for(let u=0;u<i;++u)l.push(`${o}quad${u} = null;`);return l.join(`
`)}}function Ak(){return`
/**
 * Our implementation of QuadTree is non-recursive to avoid GC hit
 * This data structure represent stack of elements
 * which we are trying to insert into quad tree.
 */
function InsertStack () {
    this.stack = [];
    this.popIdx = 0;
}

InsertStack.prototype = {
    isEmpty: function() {
        return this.popIdx === 0;
    },
    push: function (node, body) {
        var item = this.stack[this.popIdx];
        if (!item) {
            // we are trying to avoid memory pressure: create new element
            // only when absolutely necessary
            this.stack[this.popIdx] = new InsertStackElement(node, body);
        } else {
            item.node = node;
            item.body = body;
        }
        ++this.popIdx;
    },
    pop: function () {
        if (this.popIdx > 0) {
            return this.stack[--this.popIdx];
        }
    },
    reset: function () {
        this.popIdx = 0;
    }
};

function InsertStackElement(node, body) {
    this.node = node; // QuadTree node
    this.body = body; // physical body which needs to be inserted to node
}
`}var Ore=ed.exports,dT={exports:{}};dT.exports=Fre,dT.exports.generateFunctionBody=yk;const kre=Gm;function Fre(r){let e=yk(r);return new Function("bodies","settings","random",e)}function yk(r){let e=kre(r);return`
  var boundingBox = {
    ${e("min_{var}: 0, max_{var}: 0,",{indent:4})}
  };

  return {
    box: boundingBox,

    update: updateBoundingBox,

    reset: resetBoundingBox,

    getBestNewPosition: function (neighbors) {
      var ${e("base_{var} = 0",{join:", "})};

      if (neighbors.length) {
        for (var i = 0; i < neighbors.length; ++i) {
          let neighborPos = neighbors[i].pos;
          ${e("base_{var} += neighborPos.{var};",{indent:10})}
        }

        ${e("base_{var} /= neighbors.length;",{indent:8})}
      } else {
        ${e("base_{var} = (boundingBox.min_{var} + boundingBox.max_{var}) / 2;",{indent:8})}
      }

      var springLength = settings.springLength;
      return {
        ${e("{var}: base_{var} + (random.nextDouble() - 0.5) * springLength,",{indent:8})}
      };
    }
  };

  function updateBoundingBox() {
    var i = bodies.length;
    if (i === 0) return; // No bodies - no borders.

    ${e("var max_{var} = -Infinity;",{indent:4})}
    ${e("var min_{var} = Infinity;",{indent:4})}

    while(i--) {
      // this is O(n), it could be done faster with quadtree, if we check the root node bounds
      var bodyPos = bodies[i].pos;
      ${e("if (bodyPos.{var} < min_{var}) min_{var} = bodyPos.{var};",{indent:6})}
      ${e("if (bodyPos.{var} > max_{var}) max_{var} = bodyPos.{var};",{indent:6})}
    }

    ${e("boundingBox.min_{var} = min_{var};",{indent:4})}
    ${e("boundingBox.max_{var} = max_{var};",{indent:4})}
  }

  function resetBoundingBox() {
    ${e("boundingBox.min_{var} = boundingBox.max_{var} = 0;",{indent:4})}
  }
`}var Ure=dT.exports,pT={exports:{}};const zre=Gm;pT.exports=jre,pT.exports.generateCreateDragForceFunctionBody=vk;function jre(r){let e=vk(r);return new Function("options",e)}function vk(r){return`
  if (!Number.isFinite(options.dragCoefficient)) throw new Error('dragCoefficient is not a finite number');

  return {
    update: function(body) {
      ${zre(r)("body.force.{var} -= options.dragCoefficient * body.velocity.{var};",{indent:6})}
    }
  };
`}var Vre=pT.exports,fT={exports:{}};const Gre=Gm;fT.exports=Hre,fT.exports.generateCreateSpringForceFunctionBody=bk;function Hre(r){let e=bk(r);return new Function("options","random",e)}function bk(r){let e=Gre(r);return`
  if (!Number.isFinite(options.springCoefficient)) throw new Error('Spring coefficient is not a number');
  if (!Number.isFinite(options.springLength)) throw new Error('Spring length is not a number');

  return {
    /**
     * Updates forces acting on a spring
     */
    update: function (spring) {
      var body1 = spring.from;
      var body2 = spring.to;
      var length = spring.length < 0 ? options.springLength : spring.length;
      ${e("var d{var} = body2.pos.{var} - body1.pos.{var};",{indent:6})}
      var r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});

      if (r === 0) {
        ${e("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:8})}
        r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});
      }

      var d = r - length;
      var coefficient = ((spring.coefficient > 0) ? spring.coefficient : options.springCoefficient) * d / r;

      ${e("body1.force.{var} += coefficient * d{var}",{indent:6})};
      body1.springCount += 1;
      body1.springLength += r;

      ${e("body2.force.{var} -= coefficient * d{var}",{indent:6})};
      body2.springCount += 1;
      body2.springLength += r;
    }
  };
`}var Wre=fT.exports,mT={exports:{}};const Qre=Gm;mT.exports=qre,mT.exports.generateIntegratorFunctionBody=xk;function qre(r){let e=xk(r);return new Function("bodies","timeStep","adaptiveTimeStepWeight",e)}function xk(r){let e=Qre(r);return`
  var length = bodies.length;
  if (length === 0) return 0;

  ${e("var d{var} = 0, t{var} = 0;",{indent:2})}

  for (var i = 0; i < length; ++i) {
    var body = bodies[i];
    if (body.isPinned) continue;

    if (adaptiveTimeStepWeight && body.springCount) {
      timeStep = (adaptiveTimeStepWeight * body.springLength/body.springCount);
    }

    var coeff = timeStep / body.mass;

    ${e("body.velocity.{var} += coeff * body.force.{var};",{indent:4})}
    ${e("var v{var} = body.velocity.{var};",{indent:4})}
    var v = Math.sqrt(${e("v{var} * v{var}",{join:" + "})});

    if (v > 1) {
      // We normalize it so that we move within timeStep range. 
      // for the case when v <= 1 - we let velocity to fade out.
      ${e("body.velocity.{var} = v{var} / v;",{indent:6})}
    }

    ${e("d{var} = timeStep * body.velocity.{var};",{indent:4})}

    ${e("body.pos.{var} += d{var};",{indent:4})}

    ${e("t{var} += Math.abs(d{var});",{indent:4})}
  }

  return (${e("t{var} * t{var}",{join:" + "})})/length;
`}var Xre=mT.exports,gT,_k;function Yre(){if(_k)return gT;_k=1,gT=r;function r(e,i,n,s){this.from=e,this.to=i,this.length=n,this.coefficient=s}return gT}var AT,Ek;function Kre(){if(Ek)return AT;Ek=1,AT=r;function r(e,i){var n;if(e||(e={}),i){for(n in i)if(i.hasOwnProperty(n)){var s=e.hasOwnProperty(n),o=typeof i[n],l=!s||typeof e[n]!==o;l?e[n]=i[n]:o==="object"&&(e[n]=r(e[n],i[n]))}}return e}return AT}var PA={exports:{}},wk;function Jre(){if(wk)return PA.exports;wk=1,PA.exports=r,PA.exports.random=r,PA.exports.randomIterator=u;function r(c){var h=typeof c=="number"?c:+new Date;return new e(h)}function e(c){this.seed=c}e.prototype.next=l,e.prototype.nextDouble=o,e.prototype.uniform=o,e.prototype.gaussian=i;function i(){var c,h,p;do h=this.nextDouble()*2-1,p=this.nextDouble()*2-1,c=h*h+p*p;while(c>=1||c===0);return h*Math.sqrt(-2*Math.log(c)/c)}e.prototype.levy=n;function n(){var c=1.5,h=Math.pow(s(1+c)*Math.sin(Math.PI*c/2)/(s((1+c)/2)*c*Math.pow(2,(c-1)/2)),1/c);return this.gaussian()*h/Math.pow(Math.abs(this.gaussian()),1/c)}function s(c){return Math.sqrt(2*Math.PI/c)*Math.pow(1/Math.E*(c+1/(12*c-1/(10*c))),c)}function o(){var c=this.seed;return c=c+2127912214+(c<<12)&4294967295,c=(c^3345072700^c>>>19)&4294967295,c=c+374761393+(c<<5)&4294967295,c=(c+3550635116^c<<9)&4294967295,c=c+4251993797+(c<<3)&4294967295,c=(c^3042594569^c>>>16)&4294967295,this.seed=c,(c&268435455)/268435456}function l(c){return Math.floor(this.nextDouble()*c)}function u(c,h){var p=h||r();if(typeof p.next!="function")throw new Error("customRandom does not match expected API: next() function is missing");return{forEach:g,shuffle:f};function f(){var m,y,b;for(m=c.length-1;m>0;--m)y=p.next(m+1),b=c[y],c[y]=c[m],c[m]=b;return c}function g(m){var y,b,v;for(y=c.length-1;y>0;--y)b=p.next(y+1),v=c[b],c[b]=c[y],c[y]=v,m(v);c.length&&m(c[0])}}return PA.exports}var Ck=nne,Zre=Nre,$re=Ore,ene=Ure,tne=Vre,ine=Wre,rne=Xre,Sk={};function nne(r){var e=Yre(),i=Kre(),n=cT;if(r){if(r.springCoeff!==void 0)throw new Error("springCoeff was renamed to springCoefficient");if(r.dragCoeff!==void 0)throw new Error("dragCoeff was renamed to dragCoefficient")}r=i(r,{springLength:10,springCoefficient:.8,gravity:-12,theta:.8,dragCoefficient:.9,timeStep:.5,adaptiveTimeStepWeight:0,dimensions:2,debug:!1});var s=Sk[r.dimensions];if(!s){var o=r.dimensions;s={Body:Zre(o,r.debug),createQuadTree:$re(o),createBounds:ene(o),createDragForce:tne(o),createSpringForce:ine(o),integrate:rne(o)},Sk[o]=s}var l=s.Body,u=s.createQuadTree,c=s.createBounds,h=s.createDragForce,p=s.createSpringForce,f=s.integrate,g=Q=>new l(Q),m=Jre().random(42),y=[],b=[],v=u(r,m),_=c(y,r,m),T=p(r,m),E=h(r),C=0,R=[],B=new Map,I=0;P("nbody",V),P("spring",j);var N={bodies:y,quadTree:v,springs:b,settings:r,addForce:P,removeForce:k,getForces:q,step:function(){for(var Q=0;Q<R.length;++Q)R[Q](I);var W=f(y,r.timeStep,r.adaptiveTimeStepWeight);return I+=1,W},addBody:function(Q){if(!Q)throw new Error("Body is required");return y.push(Q),Q},addBodyAt:function(Q){if(!Q)throw new Error("Body position is required");var W=g(Q);return y.push(W),W},removeBody:function(Q){if(Q){var W=y.indexOf(Q);if(!(W<0))return y.splice(W,1),y.length===0&&_.reset(),!0}},addSpring:function(Q,W,G,z){if(!Q||!W)throw new Error("Cannot add null spring to force simulator");typeof G!="number"&&(G=-1);var te=new e(Q,W,G,z>=0?z:-1);return b.push(te),te},getTotalMovement:function(){return C},removeSpring:function(Q){if(Q){var W=b.indexOf(Q);if(W>-1)return b.splice(W,1),!0}},getBestNewBodyPosition:function(Q){return _.getBestNewPosition(Q)},getBBox:D,getBoundingBox:D,invalidateBBox:function(){console.warn("invalidateBBox() is deprecated, bounds always recomputed on `getBBox()` call")},gravity:function(Q){return Q!==void 0?(r.gravity=Q,v.options({gravity:Q}),this):r.gravity},theta:function(Q){return Q!==void 0?(r.theta=Q,v.options({theta:Q}),this):r.theta},random:m};return sne(r,N),n(N),N;function D(){return _.update(),_.box}function P(Q,W){if(B.has(Q))throw new Error("Force "+Q+" is already added");B.set(Q,W),R.push(W)}function k(Q){var W=R.indexOf(B.get(Q));W<0||(R.splice(W,1),B.delete(Q))}function q(){return B}function V(){if(y.length!==0){v.insertBodies(y);for(var Q=y.length;Q--;){var W=y[Q];W.isPinned||(W.reset(),v.updateBodyForce(W),E.update(W))}}}function j(){for(var Q=b.length;Q--;)T.update(b[Q])}}function sne(r,e){for(var i in r)ane(r,e,i)}function ane(r,e,i){if(r.hasOwnProperty(i)&&typeof e[i]!="function"){var n=Number.isFinite(r[i]);n?e[i]=function(s){if(s!==void 0){if(!Number.isFinite(s))throw new Error("Value of "+i+" should be a valid number.");return r[i]=s,e}return r[i]}:e[i]=function(s){return s!==void 0?(r[i]=s,e):r[i]}}}uT.exports=lne,uT.exports.simulator=Ck;var one=cT;function lne(r,e){if(!r)throw new Error("Graph structure cannot be undefined");var i=e&&e.createSimulator||Ck,n=i(e);if(Array.isArray(e))throw new Error("Physics settings is expected to be an object");var s=r.version>19?V:q;e&&typeof e.nodeMass=="function"&&(s=e.nodeMass);var o=new Map,l={},u=0,c=n.settings.springTransform||cne;E(),v();var h=!1,p={step:function(){if(u===0)return f(!0),!0;var j=n.step();p.lastMove=j,p.fire("step");var Q=j/u,W=Q<=.01;return f(W),W},getNodePosition:function(j){return k(j).pos},setNodePosition:function(j){var Q=k(j);Q.setPosition.apply(Q,Array.prototype.slice.call(arguments,1))},getLinkPosition:function(j){var Q=l[j];if(Q)return{from:Q.from.pos,to:Q.to.pos}},getGraphRect:function(){return n.getBBox()},forEachBody:g,pinNode:function(j,Q){var W=k(j.id);W.isPinned=!!Q},isNodePinned:function(j){return k(j.id).isPinned},dispose:function(){r.off("changed",T),p.fire("disposed")},getBody:b,getSpring:y,getForceVectorLength:m,simulator:n,graph:r,lastMove:0};return one(p),p;function f(j){h!==j&&(h=j,_(j))}function g(j){o.forEach(j)}function m(){var j=0,Q=0;return g(function(W){j+=Math.abs(W.force.x),Q+=Math.abs(W.force.y)}),Math.sqrt(j*j+Q*Q)}function y(j,Q){var W;if(Q===void 0)typeof j!="object"?W=j:W=j.id;else{var G=r.hasLink(j,Q);if(!G)return;W=G.id}return l[W]}function b(j){return o.get(j)}function v(){r.on("changed",T)}function _(j){p.fire("stable",j)}function T(j){for(var Q=0;Q<j.length;++Q){var W=j[Q];W.changeType==="add"?(W.node&&C(W.node.id),W.link&&B(W.link)):W.changeType==="remove"&&(W.node&&R(W.node),W.link&&I(W.link))}u=r.getNodesCount()}function E(){u=0,r.forEachNode(function(j){C(j.id),u+=1}),r.forEachLink(B)}function C(j){var Q=o.get(j);if(!Q){var W=r.getNode(j);if(!W)throw new Error("initBody() was called with unknown node id");var G=W.position;if(!G){var z=N(W);G=n.getBestNewBodyPosition(z)}Q=n.addBodyAt(G),Q.id=j,o.set(j,Q),D(j),P(W)&&(Q.isPinned=!0)}}function R(j){var Q=j.id,W=o.get(Q);W&&(o.delete(Q),n.removeBody(W))}function B(j){D(j.fromId),D(j.toId);var Q=o.get(j.fromId),W=o.get(j.toId),G=n.addSpring(Q,W,j.length);c(j,G),l[j.id]=G}function I(j){var Q=l[j.id];if(Q){var W=r.getNode(j.fromId),G=r.getNode(j.toId);W&&D(W.id),G&&D(G.id),delete l[j.id],n.removeSpring(Q)}}function N(j){var Q=[];if(!j.links)return Q;for(var W=Math.min(j.links.length,2),G=0;G<W;++G){var z=j.links[G],te=z.fromId!==j.id?o.get(z.fromId):o.get(z.toId);te&&te.pos&&Q.push(te)}return Q}function D(j){var Q=o.get(j);if(Q.mass=s(j),Number.isNaN(Q.mass))throw new Error("Node mass should be a number")}function P(j){return j&&(j.isPinned||j.data&&j.data.isPinned)}function k(j){var Q=o.get(j);return Q||(C(j),Q=o.get(j)),Q}function q(j){var Q=r.getLinks(j);return Q?1+Q.length/3:1}function V(j){var Q=r.getLinks(j);return Q?1+Q.size/3:1}}function cne(){}var une=uT.exports;const hne=l2(une);function zx(r){var e=typeof r;return r!=null&&(e=="object"||e=="function")}var dne=typeof global=="object"&&global&&global.Object===Object&&global,pne=typeof self=="object"&&self&&self.Object===Object&&self,Tk=dne||pne||Function("return this")(),yT=function(){return Tk.Date.now()},fne=/\s/;function mne(r){for(var e=r.length;e--&&fne.test(r.charAt(e)););return e}var gne=/^\s+/;function Ane(r){return r&&r.slice(0,mne(r)+1).replace(gne,"")}var jx=Tk.Symbol,Mk=Object.prototype,yne=Mk.hasOwnProperty,vne=Mk.toString,OA=jx?jx.toStringTag:void 0;function bne(r){var e=yne.call(r,OA),i=r[OA];try{r[OA]=void 0;var n=!0}catch{}var s=vne.call(r);return n&&(e?r[OA]=i:delete r[OA]),s}var xne=Object.prototype,_ne=xne.toString;function Ene(r){return _ne.call(r)}var wne="[object Null]",Cne="[object Undefined]",Rk=jx?jx.toStringTag:void 0;function Sne(r){return r==null?r===void 0?Cne:wne:Rk&&Rk in Object(r)?bne(r):Ene(r)}function Tne(r){return r!=null&&typeof r=="object"}var Mne="[object Symbol]";function Rne(r){return typeof r=="symbol"||Tne(r)&&Sne(r)==Mne}var Ik=NaN,Ine=/^[-+]0x[0-9a-f]+$/i,Bne=/^0b[01]+$/i,Lne=/^0o[0-7]+$/i,Dne=parseInt;function Bk(r){if(typeof r=="number")return r;if(Rne(r))return Ik;if(zx(r)){var e=typeof r.valueOf=="function"?r.valueOf():r;r=zx(e)?e+"":e}if(typeof r!="string")return r===0?r:+r;r=Ane(r);var i=Bne.test(r);return i||Lne.test(r)?Dne(r.slice(2),i?2:8):Ine.test(r)?Ik:+r}var Nne="Expected a function",Pne=Math.max,One=Math.min;function Lk(r,e,i){var n,s,o,l,u,c,h=0,p=!1,f=!1,g=!0;if(typeof r!="function")throw new TypeError(Nne);e=Bk(e)||0,zx(i)&&(p=!!i.leading,f="maxWait"in i,o=f?Pne(Bk(i.maxWait)||0,e):o,g="trailing"in i?!!i.trailing:g);function m(B){var I=n,N=s;return n=s=void 0,h=B,l=r.apply(N,I),l}function y(B){return h=B,u=setTimeout(_,e),p?m(B):l}function b(B){var I=B-c,N=B-h,D=e-I;return f?One(D,o-N):D}function v(B){var I=B-c,N=B-h;return c===void 0||I>=e||I<0||f&&N>=o}function _(){var B=yT();if(v(B))return T(B);u=setTimeout(_,b(B))}function T(B){return u=void 0,g&&n?m(B):(n=s=void 0,l)}function E(){u!==void 0&&clearTimeout(u),h=0,n=c=s=u=void 0}function C(){return u===void 0?l:T(yT())}function R(){var B=yT(),I=v(B);if(n=arguments,s=this,c=B,I){if(u===void 0)return y(c);if(f)return clearTimeout(u),u=setTimeout(_,e),m(c)}return u===void 0&&(u=setTimeout(_,e)),l}return R.cancel=E,R.flush=C,R}function Dk(r,e){(e==null||e>r.length)&&(e=r.length);for(var i=0,n=Array(e);i<e;i++)n[i]=r[i];return n}function kne(r){if(Array.isArray(r))return r}function Fne(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function Une(r,e,i){return Object.defineProperty(r,"prototype",{writable:!1}),r}function zne(r,e){var i=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(i!=null){var n,s,o,l,u=[],c=!0,h=!1;try{if(o=(i=i.call(r)).next,e!==0)for(;!(c=(n=o.call(i)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(p){h=!0,s=p}finally{try{if(!c&&i.return!=null&&(l=i.return(),Object(l)!==l))return}finally{if(h)throw s}}return u}}function jne(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Vne(r,e){return kne(r)||zne(r,e)||Gne(r,e)||jne()}function Gne(r,e){if(r){if(typeof r=="string")return Dk(r,e);var i={}.toString.call(r).slice(8,-1);return i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set"?Array.from(r):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Dk(r,e):void 0}}var Hne=Une(function r(e,i){var n=i.default,s=n===void 0?null:n,o=i.triggerUpdate,l=o===void 0?!0:o,u=i.onChange,c=u===void 0?function(h,p){}:u;Fne(this,r),this.name=e,this.defaultVal=s,this.triggerUpdate=l,this.onChange=c});function wp(r){var e=r.stateInit,i=e===void 0?function(){return{}}:e,n=r.props,s=n===void 0?{}:n,o=r.methods,l=o===void 0?{}:o,u=r.aliases,c=u===void 0?{}:u,h=r.init,p=h===void 0?function(){}:h,f=r.update,g=f===void 0?function(){}:f,m=Object.keys(s).map(function(y){return new Hne(y,s[y])});return function y(){for(var b=arguments.length,v=new Array(b),_=0;_<b;_++)v[_]=arguments[_];var T=!!(this instanceof y&&this.constructor),E=T?v.shift():void 0,C=v[0],R=C===void 0?{}:C,B=Object.assign({},i instanceof Function?i(R):i,{initialised:!1}),I={};function N(k){return D(k,R),P(),N}var D=function(k,q){p.call(N,k,B,q),B.initialised=!0},P=Lk(function(){B.initialised&&(g.call(N,B,I),I={})},1);return m.forEach(function(k){N[k.name]=q(k);function q(V){var j=V.name,Q=V.triggerUpdate,W=Q===void 0?!1:Q,G=V.onChange,z=G===void 0?function(se,ve){}:G,te=V.defaultVal,Y=te===void 0?null:te;return function(se){var ve=B[j];if(!arguments.length)return ve;var Ae=se===void 0?Y:se;return B[j]=Ae,z.call(N,Ae,B,ve),!I.hasOwnProperty(j)&&(I[j]=ve),W&&P(),N}}}),Object.keys(l).forEach(function(k){N[k]=function(){for(var q,V=arguments.length,j=new Array(V),Q=0;Q<V;Q++)j[Q]=arguments[Q];return(q=l[k]).call.apply(q,[N,B].concat(j))}}),Object.entries(c).forEach(function(k){var q=Vne(k,2),V=q[0],j=q[1];return N[V]=N[j]}),N.resetProps=function(){return m.forEach(function(k){N[k.name](k.defaultVal)}),N},N.resetProps(),B._rerender=P,T&&E&&N(E),N}}class Nk extends Map{constructor(e,i=qne){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:i}}),e!=null)for(const[n,s]of e)this.set(n,s)}get(e){return super.get(Pk(this,e))}has(e){return super.has(Pk(this,e))}set(e,i){return super.set(Wne(this,e),i)}delete(e){return super.delete(Qne(this,e))}}function Pk({_intern:r,_key:e},i){const n=e(i);return r.has(n)?r.get(n):i}function Wne({_intern:r,_key:e},i){const n=e(i);return r.has(n)?r.get(n):(r.set(n,i),i)}function Qne({_intern:r,_key:e},i){const n=e(i);return r.has(n)&&(i=r.get(n),r.delete(n)),i}function qne(r){return r!==null&&typeof r=="object"?r.valueOf():r}function vT(r,e){let i;if(e===void 0)for(const n of r)n!=null&&(i<n||i===void 0&&n>=n)&&(i=n);else{let n=-1;for(let s of r)(s=e(s,++n,r))!=null&&(i<s||i===void 0&&s>=s)&&(i=s)}return i}function bT(r,e){let i;if(e===void 0)for(const n of r)n!=null&&(i>n||i===void 0&&n>=n)&&(i=n);else{let n=-1;for(let s of r)(s=e(s,++n,r))!=null&&(i>s||i===void 0&&s>=s)&&(i=s)}return i}function xT(r,e){(e==null||e>r.length)&&(e=r.length);for(var i=0,n=Array(e);i<e;i++)n[i]=r[i];return n}function Xne(r){if(Array.isArray(r))return r}function Yne(r){if(Array.isArray(r))return xT(r)}function Kne(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function Jne(r,e){var i=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(i!=null){var n,s,o,l,u=[],c=!0,h=!1;try{if(o=(i=i.call(r)).next,e!==0)for(;!(c=(n=o.call(i)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(p){h=!0,s=p}finally{try{if(!c&&i.return!=null&&(l=i.return(),Object(l)!==l))return}finally{if(h)throw s}}return u}}function Zne(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $ne(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ese(r,e){if(r==null)return{};var i,n,s=tse(r,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(r);for(n=0;n<o.length;n++)i=o[n],e.includes(i)||{}.propertyIsEnumerable.call(r,i)&&(s[i]=r[i])}return s}function tse(r,e){if(r==null)return{};var i={};for(var n in r)if({}.hasOwnProperty.call(r,n)){if(e.includes(n))continue;i[n]=r[n]}return i}function ise(r,e){return Xne(r)||Jne(r,e)||Ok(r,e)||Zne()}function rse(r){return Yne(r)||Kne(r)||Ok(r)||$ne()}function nse(r,e){if(typeof r!="object"||!r)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var n=i.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}function sse(r){var e=nse(r,"string");return typeof e=="symbol"?e:e+""}function Ok(r,e){if(r){if(typeof r=="string")return xT(r,e);var i={}.toString.call(r).slice(8,-1);return i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set"?Array.from(r):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?xT(r,e):void 0}}var _T=function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=(e instanceof Array?e.length?e:[void 0]:[e]).map(function(u){return{keyAccessor:u,isProp:!(u instanceof Function)}}),o=r.reduce(function(u,c){var h=u,p=c;return s.forEach(function(f,g){var m=f.keyAccessor,y=f.isProp,b;if(y){var v=p,_=v[m],T=ese(v,[m].map(sse));b=_,p=T}else b=m(p,g);g+1<s.length?(h.hasOwnProperty(b)||(h[b]={}),h=h[b]):i?(h.hasOwnProperty(b)||(h[b]=[]),h[b].push(p)):h[b]=p}),u},{});i instanceof Function&&function u(c){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;h===s.length?Object.keys(c).forEach(function(p){return c[p]=i(c[p])}):Object.values(c).forEach(function(p){return u(p,h+1)})}(o);var l=o;return n&&(l=[],function u(c){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];h.length===s.length?l.push({keys:h,vals:c}):Object.entries(c).forEach(function(p){var f=ise(p,2),g=f[0],m=f[1];return u(m,[].concat(rse(h),[g]))})}(o),e instanceof Array&&e.length===0&&l.length===1&&(l[0].keys=[])),l};function ase(r,e){var i=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(i!=null){var n,s,o,l,u=[],c=!0,h=!1;try{if(o=(i=i.call(r)).next,e!==0)for(;!(c=(n=o.call(i)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(p){h=!0,s=p}finally{try{if(!c&&i.return!=null&&(l=i.return(),Object(l)!==l))return}finally{if(h)throw s}}return u}}function kk(r,e){var i=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),i.push.apply(i,n)}return i}function ose(r){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?kk(Object(i),!0).forEach(function(n){Fk(r,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):kk(Object(i)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(i,n))})}return r}function Fk(r,e,i){return e=gse(e),e in r?Object.defineProperty(r,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[e]=i,r}function lse(r,e){if(r==null)return{};var i={},n=Object.keys(r),s,o;for(o=0;o<n.length;o++)s=n[o],!(e.indexOf(s)>=0)&&(i[s]=r[s]);return i}function cse(r,e){if(r==null)return{};var i=lse(r,e),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(r);for(s=0;s<o.length;s++)n=o[s],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(r,n)&&(i[n]=r[n])}return i}function Uk(r,e){return hse(r)||ase(r,e)||zk(r,e)||fse()}function Vx(r){return use(r)||dse(r)||zk(r)||pse()}function use(r){if(Array.isArray(r))return ET(r)}function hse(r){if(Array.isArray(r))return r}function dse(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function zk(r,e){if(r){if(typeof r=="string")return ET(r,e);var i=Object.prototype.toString.call(r).slice(8,-1);if(i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set")return Array.from(r);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return ET(r,e)}}function ET(r,e){(e==null||e>r.length)&&(e=r.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=r[i];return n}function pse(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function fse(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function mse(r,e){if(typeof r!="object"||r===null)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var n=i.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function gse(r){var e=mse(r,"string");return typeof e=="symbol"?e:String(e)}var Ase=["createObj","updateObj","exitObj","objBindAttr","dataBindAttr"];function yse(r,e,i){var n={enter:[],update:[],exit:[]};if(i){var s=_T(r,i,!1),o=_T(e,i,!1),l=Object.assign({},s,o);Object.entries(l).forEach(function(h){var p=Uk(h,2),f=p[0],g=p[1],m=s.hasOwnProperty(f)?o.hasOwnProperty(f)?"update":"exit":"enter";n[m].push(m==="update"?[s[f],o[f]]:g)})}else{var u=new Set(r),c=new Set(e);new Set([].concat(Vx(u),Vx(c))).forEach(function(h){var p=u.has(h)?c.has(h)?"update":"exit":"enter";n[p].push(p==="update"?[h,h]:h)})}return n}function vse(r,e,i){var n=i.objBindAttr,s=n===void 0?"__obj":n,o=i.dataBindAttr,l=o===void 0?"__data":o,u=i.idAccessor,c=i.purge,h=c===void 0?!1:c,p=function(b){return b.hasOwnProperty(l)},f=e.filter(function(b){return!p(b)}),g=e.filter(p).map(function(b){return b[l]}),m=r,y=h?{enter:m,exit:g,update:[]}:yse(g,m,u);return y.update=y.update.map(function(b){var v=Uk(b,2),_=v[0],T=v[1];return _!==T&&(T[s]=_[s],T[s][l]=T),T}),y.exit=y.exit.concat(f.map(function(b){return Fk({},s,b)})),y}function bse(r,e,i,n,s){var o=s.createObj,l=o===void 0?function(N){return{}}:o,u=s.updateObj,c=u===void 0?function(N,D){}:u,h=s.exitObj,p=h===void 0?function(N){}:h,f=s.objBindAttr,g=f===void 0?"__obj":f,m=s.dataBindAttr,y=m===void 0?"__data":m,b=cse(s,Ase),v=vse(r,e,ose({objBindAttr:g,dataBindAttr:y},b)),_=v.enter,T=v.update,E=v.exit;E.forEach(function(N){var D=N[g];delete N[g],p(D),n(D)});var C=B(_),R=[].concat(Vx(_),Vx(T));I(R),C.forEach(i);function B(N){var D=[];return N.forEach(function(P){var k=l(P);k&&(k[y]=P,P[g]=k,D.push(k))}),D}function I(N){N.forEach(function(D){var P=D[g];P&&(P[y]=D,c(P,D))})}}function xse(r,e){switch(arguments.length){case 0:break;case 1:this.range(r);break;default:this.range(e).domain(r);break}return this}const jk=Symbol("implicit");function wT(){var r=new Nk,e=[],i=[],n=jk;function s(o){let l=r.get(o);if(l===void 0){if(n!==jk)return n;r.set(o,l=e.push(o)-1)}return i[l%i.length]}return s.domain=function(o){if(!arguments.length)return e.slice();e=[],r=new Nk;for(const l of o)r.has(l)||r.set(l,e.push(l)-1);return s},s.range=function(o){return arguments.length?(i=Array.from(o),s):i.slice()},s.unknown=function(o){return arguments.length?(n=o,s):n},s.copy=function(){return wT(e,i).unknown(n)},xse.apply(s,arguments),s}function CT(r,e,i){r.prototype=e.prototype=i,i.constructor=r}function Vk(r,e){var i=Object.create(r.prototype);for(var n in e)i[n]=e[n];return i}function kA(){}var FA=.7,Gx=1/FA,Hm="\\s*([+-]?\\d+)\\s*",UA="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Gc="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",_se=/^#([0-9a-f]{3,8})$/,Ese=new RegExp(`^rgb\\(${Hm},${Hm},${Hm}\\)$`),wse=new RegExp(`^rgb\\(${Gc},${Gc},${Gc}\\)$`),Cse=new RegExp(`^rgba\\(${Hm},${Hm},${Hm},${UA}\\)$`),Sse=new RegExp(`^rgba\\(${Gc},${Gc},${Gc},${UA}\\)$`),Tse=new RegExp(`^hsl\\(${UA},${Gc},${Gc}\\)$`),Mse=new RegExp(`^hsla\\(${UA},${Gc},${Gc},${UA}\\)$`),Gk={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};CT(kA,zA,{copy(r){return Object.assign(new this.constructor,this,r)},displayable(){return this.rgb().displayable()},hex:Hk,formatHex:Hk,formatHex8:Rse,formatHsl:Ise,formatRgb:Wk,toString:Wk});function Hk(){return this.rgb().formatHex()}function Rse(){return this.rgb().formatHex8()}function Ise(){return Kk(this).formatHsl()}function Wk(){return this.rgb().formatRgb()}function zA(r){var e,i;return r=(r+"").trim().toLowerCase(),(e=_se.exec(r))?(i=e[1].length,e=parseInt(e[1],16),i===6?Qk(e):i===3?new zo(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):i===8?Hx(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):i===4?Hx(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=Ese.exec(r))?new zo(e[1],e[2],e[3],1):(e=wse.exec(r))?new zo(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=Cse.exec(r))?Hx(e[1],e[2],e[3],e[4]):(e=Sse.exec(r))?Hx(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Tse.exec(r))?Yk(e[1],e[2]/100,e[3]/100,1):(e=Mse.exec(r))?Yk(e[1],e[2]/100,e[3]/100,e[4]):Gk.hasOwnProperty(r)?Qk(Gk[r]):r==="transparent"?new zo(NaN,NaN,NaN,0):null}function Qk(r){return new zo(r>>16&255,r>>8&255,r&255,1)}function Hx(r,e,i,n){return n<=0&&(r=e=i=NaN),new zo(r,e,i,n)}function Bse(r){return r instanceof kA||(r=zA(r)),r?(r=r.rgb(),new zo(r.r,r.g,r.b,r.opacity)):new zo}function ST(r,e,i,n){return arguments.length===1?Bse(r):new zo(r,e,i,n??1)}function zo(r,e,i,n){this.r=+r,this.g=+e,this.b=+i,this.opacity=+n}CT(zo,ST,Vk(kA,{brighter(r){return r=r==null?Gx:Math.pow(Gx,r),new zo(this.r*r,this.g*r,this.b*r,this.opacity)},darker(r){return r=r==null?FA:Math.pow(FA,r),new zo(this.r*r,this.g*r,this.b*r,this.opacity)},rgb(){return this},clamp(){return new zo(Cp(this.r),Cp(this.g),Cp(this.b),Wx(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:qk,formatHex:qk,formatHex8:Lse,formatRgb:Xk,toString:Xk}));function qk(){return`#${Sp(this.r)}${Sp(this.g)}${Sp(this.b)}`}function Lse(){return`#${Sp(this.r)}${Sp(this.g)}${Sp(this.b)}${Sp((isNaN(this.opacity)?1:this.opacity)*255)}`}function Xk(){const r=Wx(this.opacity);return`${r===1?"rgb(":"rgba("}${Cp(this.r)}, ${Cp(this.g)}, ${Cp(this.b)}${r===1?")":`, ${r})`}`}function Wx(r){return isNaN(r)?1:Math.max(0,Math.min(1,r))}function Cp(r){return Math.max(0,Math.min(255,Math.round(r)||0))}function Sp(r){return r=Cp(r),(r<16?"0":"")+r.toString(16)}function Yk(r,e,i,n){return n<=0?r=e=i=NaN:i<=0||i>=1?r=e=NaN:e<=0&&(r=NaN),new cc(r,e,i,n)}function Kk(r){if(r instanceof cc)return new cc(r.h,r.s,r.l,r.opacity);if(r instanceof kA||(r=zA(r)),!r)return new cc;if(r instanceof cc)return r;r=r.rgb();var e=r.r/255,i=r.g/255,n=r.b/255,s=Math.min(e,i,n),o=Math.max(e,i,n),l=NaN,u=o-s,c=(o+s)/2;return u?(e===o?l=(i-n)/u+(i<n)*6:i===o?l=(n-e)/u+2:l=(e-i)/u+4,u/=c<.5?o+s:2-o-s,l*=60):u=c>0&&c<1?0:l,new cc(l,u,c,r.opacity)}function Dse(r,e,i,n){return arguments.length===1?Kk(r):new cc(r,e,i,n??1)}function cc(r,e,i,n){this.h=+r,this.s=+e,this.l=+i,this.opacity=+n}CT(cc,Dse,Vk(kA,{brighter(r){return r=r==null?Gx:Math.pow(Gx,r),new cc(this.h,this.s,this.l*r,this.opacity)},darker(r){return r=r==null?FA:Math.pow(FA,r),new cc(this.h,this.s,this.l*r,this.opacity)},rgb(){var r=this.h%360+(this.h<0)*360,e=isNaN(r)||isNaN(this.s)?0:this.s,i=this.l,n=i+(i<.5?i:1-i)*e,s=2*i-n;return new zo(TT(r>=240?r-240:r+120,s,n),TT(r,s,n),TT(r<120?r+240:r-120,s,n),this.opacity)},clamp(){return new cc(Jk(this.h),Qx(this.s),Qx(this.l),Wx(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const r=Wx(this.opacity);return`${r===1?"hsl(":"hsla("}${Jk(this.h)}, ${Qx(this.s)*100}%, ${Qx(this.l)*100}%${r===1?")":`, ${r})`}`}}));function Jk(r){return r=(r||0)%360,r<0?r+360:r}function Qx(r){return Math.max(0,Math.min(1,r||0))}function TT(r,e,i){return(r<60?e+(i-e)*r/60:r<180?i:r<240?e+(i-e)*(240-r)/60:e)*255}const Zk=r=>()=>r;function Nse(r,e){return function(i){return r+i*e}}function Pse(r,e,i){return r=Math.pow(r,i),e=Math.pow(e,i)-r,i=1/i,function(n){return Math.pow(r+n*e,i)}}function Ose(r){return(r=+r)==1?$k:function(e,i){return i-e?Pse(e,i,r):Zk(isNaN(e)?i:e)}}function $k(r,e){var i=e-r;return i?Nse(r,i):Zk(isNaN(r)?e:r)}const e5=function r(e){var i=Ose(e);function n(s,o){var l=i((s=ST(s)).r,(o=ST(o)).r),u=i(s.g,o.g),c=i(s.b,o.b),h=$k(s.opacity,o.opacity);return function(p){return s.r=l(p),s.g=u(p),s.b=c(p),s.opacity=h(p),s+""}}return n.gamma=r,n}(1);function id(r,e){return r=+r,e=+e,function(i){return r*(1-i)+e*i}}var MT=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,RT=new RegExp(MT.source,"g");function kse(r){return function(){return r}}function Fse(r){return function(e){return r(e)+""}}function Use(r,e){var i=MT.lastIndex=RT.lastIndex=0,n,s,o,l=-1,u=[],c=[];for(r=r+"",e=e+"";(n=MT.exec(r))&&(s=RT.exec(e));)(o=s.index)>i&&(o=e.slice(i,o),u[l]?u[l]+=o:u[++l]=o),(n=n[0])===(s=s[0])?u[l]?u[l]+=s:u[++l]=s:(u[++l]=null,c.push({i:l,x:id(n,s)})),i=RT.lastIndex;return i<e.length&&(o=e.slice(i),u[l]?u[l]+=o:u[++l]=o),u.length<2?c[0]?Fse(c[0].x):kse(e):(e=c.length,function(h){for(var p=0,f;p<e;++p)u[(f=c[p]).i]=f.x(h);return u.join("")})}var t5=180/Math.PI,i5={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function r5(r,e,i,n,s,o){var l,u,c;return(l=Math.sqrt(r*r+e*e))&&(r/=l,e/=l),(c=r*i+e*n)&&(i-=r*c,n-=e*c),(u=Math.sqrt(i*i+n*n))&&(i/=u,n/=u,c/=u),r*n<e*i&&(r=-r,e=-e,c=-c,l=-l),{translateX:s,translateY:o,rotate:Math.atan2(e,r)*t5,skewX:Math.atan(c)*t5,scaleX:l,scaleY:u}}var qx;function zse(r){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(r+"");return e.isIdentity?i5:r5(e.a,e.b,e.c,e.d,e.e,e.f)}function jse(r){return r==null||(qx||(qx=document.createElementNS("http://www.w3.org/2000/svg","g")),qx.setAttribute("transform",r),!(r=qx.transform.baseVal.consolidate()))?i5:(r=r.matrix,r5(r.a,r.b,r.c,r.d,r.e,r.f))}function n5(r,e,i,n){function s(h){return h.length?h.pop()+" ":""}function o(h,p,f,g,m,y){if(h!==f||p!==g){var b=m.push("translate(",null,e,null,i);y.push({i:b-4,x:id(h,f)},{i:b-2,x:id(p,g)})}else(f||g)&&m.push("translate("+f+e+g+i)}function l(h,p,f,g){h!==p?(h-p>180?p+=360:p-h>180&&(h+=360),g.push({i:f.push(s(f)+"rotate(",null,n)-2,x:id(h,p)})):p&&f.push(s(f)+"rotate("+p+n)}function u(h,p,f,g){h!==p?g.push({i:f.push(s(f)+"skewX(",null,n)-2,x:id(h,p)}):p&&f.push(s(f)+"skewX("+p+n)}function c(h,p,f,g,m,y){if(h!==f||p!==g){var b=m.push(s(m)+"scale(",null,",",null,")");y.push({i:b-4,x:id(h,f)},{i:b-2,x:id(p,g)})}else(f!==1||g!==1)&&m.push(s(m)+"scale("+f+","+g+")")}return function(h,p){var f=[],g=[];return h=r(h),p=r(p),o(h.translateX,h.translateY,p.translateX,p.translateY,f,g),l(h.rotate,p.rotate,f,g),u(h.skewX,p.skewX,f,g),c(h.scaleX,h.scaleY,p.scaleX,p.scaleY,f,g),h=p=null,function(m){for(var y=-1,b=g.length,v;++y<b;)f[(v=g[y]).i]=v.x(m);return f.join("")}}}var Vse=n5(zse,"px, ","px)","deg)"),Gse=n5(jse,", ",")",")"),Hse=1e-12;function s5(r){return((r=Math.exp(r))+1/r)/2}function Wse(r){return((r=Math.exp(r))-1/r)/2}function Qse(r){return((r=Math.exp(2*r))-1)/(r+1)}const qse=function r(e,i,n){function s(o,l){var u=o[0],c=o[1],h=o[2],p=l[0],f=l[1],g=l[2],m=p-u,y=f-c,b=m*m+y*y,v,_;if(b<Hse)_=Math.log(g/h)/e,v=function(I){return[u+I*m,c+I*y,h*Math.exp(e*I*_)]};else{var T=Math.sqrt(b),E=(g*g-h*h+n*b)/(2*h*i*T),C=(g*g-h*h-n*b)/(2*g*i*T),R=Math.log(Math.sqrt(E*E+1)-E),B=Math.log(Math.sqrt(C*C+1)-C);_=(B-R)/e,v=function(I){var N=I*_,D=s5(R),P=h/(i*T)*(D*Qse(e*N+R)-Wse(R));return[u+P*m,c+P*y,h*D/s5(e*N+R)]}}return v.duration=_*1e3*e/Math.SQRT2,v}return s.rho=function(o){var l=Math.max(.001,+o),u=l*l,c=u*u;return r(l,u,c)},s}(Math.SQRT2,2,4);function Xse(r){for(var e=r.length/6|0,i=new Array(e),n=0;n<e;)i[n]="#"+r.slice(n*6,++n*6);return i}const a5=Xse("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928");function Xx(r){"@babel/helpers - typeof";return Xx=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Xx(r)}var Yse=/^\s+/,Kse=/\s+$/;function br(r,e){if(r=r||"",e=e||{},r instanceof br)return r;if(!(this instanceof br))return new br(r,e);var i=Jse(r);this._originalInput=r,this._r=i.r,this._g=i.g,this._b=i.b,this._a=i.a,this._roundA=Math.round(100*this._a)/100,this._format=e.format||i.format,this._gradientType=e.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=i.ok}br.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var r=this.toRgb();return(r.r*299+r.g*587+r.b*114)/1e3},getLuminance:function(){var r=this.toRgb(),e,i,n,s,o,l;return e=r.r/255,i=r.g/255,n=r.b/255,e<=.03928?s=e/12.92:s=Math.pow((e+.055)/1.055,2.4),i<=.03928?o=i/12.92:o=Math.pow((i+.055)/1.055,2.4),n<=.03928?l=n/12.92:l=Math.pow((n+.055)/1.055,2.4),.2126*s+.7152*o+.0722*l},setAlpha:function(r){return this._a=d5(r),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var r=l5(this._r,this._g,this._b);return{h:r.h*360,s:r.s,v:r.v,a:this._a}},toHsvString:function(){var r=l5(this._r,this._g,this._b),e=Math.round(r.h*360),i=Math.round(r.s*100),n=Math.round(r.v*100);return this._a==1?"hsv("+e+", "+i+"%, "+n+"%)":"hsva("+e+", "+i+"%, "+n+"%, "+this._roundA+")"},toHsl:function(){var r=o5(this._r,this._g,this._b);return{h:r.h*360,s:r.s,l:r.l,a:this._a}},toHslString:function(){var r=o5(this._r,this._g,this._b),e=Math.round(r.h*360),i=Math.round(r.s*100),n=Math.round(r.l*100);return this._a==1?"hsl("+e+", "+i+"%, "+n+"%)":"hsla("+e+", "+i+"%, "+n+"%, "+this._roundA+")"},toHex:function(r){return c5(this._r,this._g,this._b,r)},toHexString:function(r){return"#"+this.toHex(r)},toHex8:function(r){return tae(this._r,this._g,this._b,this._a,r)},toHex8String:function(r){return"#"+this.toHex8(r)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(Es(this._r,255)*100)+"%",g:Math.round(Es(this._g,255)*100)+"%",b:Math.round(Es(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+Math.round(Es(this._r,255)*100)+"%, "+Math.round(Es(this._g,255)*100)+"%, "+Math.round(Es(this._b,255)*100)+"%)":"rgba("+Math.round(Es(this._r,255)*100)+"%, "+Math.round(Es(this._g,255)*100)+"%, "+Math.round(Es(this._b,255)*100)+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":this._a<1?!1:pae[c5(this._r,this._g,this._b,!0)]||!1},toFilter:function(r){var e="#"+u5(this._r,this._g,this._b,this._a),i=e,n=this._gradientType?"GradientType = 1, ":"";if(r){var s=br(r);i="#"+u5(s._r,s._g,s._b,s._a)}return"progid:DXImageTransform.Microsoft.gradient("+n+"startColorstr="+e+",endColorstr="+i+")"},toString:function(r){var e=!!r;r=r||this._format;var i=!1,n=this._a<1&&this._a>=0,s=!e&&n&&(r==="hex"||r==="hex6"||r==="hex3"||r==="hex4"||r==="hex8"||r==="name");return s?r==="name"&&this._a===0?this.toName():this.toRgbString():(r==="rgb"&&(i=this.toRgbString()),r==="prgb"&&(i=this.toPercentageRgbString()),(r==="hex"||r==="hex6")&&(i=this.toHexString()),r==="hex3"&&(i=this.toHexString(!0)),r==="hex4"&&(i=this.toHex8String(!0)),r==="hex8"&&(i=this.toHex8String()),r==="name"&&(i=this.toName()),r==="hsl"&&(i=this.toHslString()),r==="hsv"&&(i=this.toHsvString()),i||this.toHexString())},clone:function(){return br(this.toString())},_applyModification:function(r,e){var i=r.apply(null,[this].concat([].slice.call(e)));return this._r=i._r,this._g=i._g,this._b=i._b,this.setAlpha(i._a),this},lighten:function(){return this._applyModification(sae,arguments)},brighten:function(){return this._applyModification(aae,arguments)},darken:function(){return this._applyModification(oae,arguments)},desaturate:function(){return this._applyModification(iae,arguments)},saturate:function(){return this._applyModification(rae,arguments)},greyscale:function(){return this._applyModification(nae,arguments)},spin:function(){return this._applyModification(lae,arguments)},_applyCombination:function(r,e){return r.apply(null,[this].concat([].slice.call(e)))},analogous:function(){return this._applyCombination(hae,arguments)},complement:function(){return this._applyCombination(cae,arguments)},monochromatic:function(){return this._applyCombination(dae,arguments)},splitcomplement:function(){return this._applyCombination(uae,arguments)},triad:function(){return this._applyCombination(h5,[3])},tetrad:function(){return this._applyCombination(h5,[4])}},br.fromRatio=function(r,e){if(Xx(r)=="object"){var i={};for(var n in r)r.hasOwnProperty(n)&&(n==="a"?i[n]=r[n]:i[n]=jA(r[n]));r=i}return br(r,e)};function Jse(r){var e={r:0,g:0,b:0},i=1,n=null,s=null,o=null,l=!1,u=!1;return typeof r=="string"&&(r=Aae(r)),Xx(r)=="object"&&(Uu(r.r)&&Uu(r.g)&&Uu(r.b)?(e=Zse(r.r,r.g,r.b),l=!0,u=String(r.r).substr(-1)==="%"?"prgb":"rgb"):Uu(r.h)&&Uu(r.s)&&Uu(r.v)?(n=jA(r.s),s=jA(r.v),e=eae(r.h,n,s),l=!0,u="hsv"):Uu(r.h)&&Uu(r.s)&&Uu(r.l)&&(n=jA(r.s),o=jA(r.l),e=$se(r.h,n,o),l=!0,u="hsl"),r.hasOwnProperty("a")&&(i=r.a)),i=d5(i),{ok:l,format:r.format||u,r:Math.min(255,Math.max(e.r,0)),g:Math.min(255,Math.max(e.g,0)),b:Math.min(255,Math.max(e.b,0)),a:i}}function Zse(r,e,i){return{r:Es(r,255)*255,g:Es(e,255)*255,b:Es(i,255)*255}}function o5(r,e,i){r=Es(r,255),e=Es(e,255),i=Es(i,255);var n=Math.max(r,e,i),s=Math.min(r,e,i),o,l,u=(n+s)/2;if(n==s)o=l=0;else{var c=n-s;switch(l=u>.5?c/(2-n-s):c/(n+s),n){case r:o=(e-i)/c+(e<i?6:0);break;case e:o=(i-r)/c+2;break;case i:o=(r-e)/c+4;break}o/=6}return{h:o,s:l,l:u}}function $se(r,e,i){var n,s,o;r=Es(r,360),e=Es(e,100),i=Es(i,100);function l(h,p,f){return f<0&&(f+=1),f>1&&(f-=1),f<1/6?h+(p-h)*6*f:f<1/2?p:f<2/3?h+(p-h)*(2/3-f)*6:h}if(e===0)n=s=o=i;else{var u=i<.5?i*(1+e):i+e-i*e,c=2*i-u;n=l(c,u,r+1/3),s=l(c,u,r),o=l(c,u,r-1/3)}return{r:n*255,g:s*255,b:o*255}}function l5(r,e,i){r=Es(r,255),e=Es(e,255),i=Es(i,255);var n=Math.max(r,e,i),s=Math.min(r,e,i),o,l,u=n,c=n-s;if(l=n===0?0:c/n,n==s)o=0;else{switch(n){case r:o=(e-i)/c+(e<i?6:0);break;case e:o=(i-r)/c+2;break;case i:o=(r-e)/c+4;break}o/=6}return{h:o,s:l,v:u}}function eae(r,e,i){r=Es(r,360)*6,e=Es(e,100),i=Es(i,100);var n=Math.floor(r),s=r-n,o=i*(1-e),l=i*(1-s*e),u=i*(1-(1-s)*e),c=n%6,h=[i,l,o,o,u,i][c],p=[u,i,i,l,o,o][c],f=[o,o,u,i,i,l][c];return{r:h*255,g:p*255,b:f*255}}function c5(r,e,i,n){var s=[uc(Math.round(r).toString(16)),uc(Math.round(e).toString(16)),uc(Math.round(i).toString(16))];return n&&s[0].charAt(0)==s[0].charAt(1)&&s[1].charAt(0)==s[1].charAt(1)&&s[2].charAt(0)==s[2].charAt(1)?s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0):s.join("")}function tae(r,e,i,n,s){var o=[uc(Math.round(r).toString(16)),uc(Math.round(e).toString(16)),uc(Math.round(i).toString(16)),uc(p5(n))];return s&&o[0].charAt(0)==o[0].charAt(1)&&o[1].charAt(0)==o[1].charAt(1)&&o[2].charAt(0)==o[2].charAt(1)&&o[3].charAt(0)==o[3].charAt(1)?o[0].charAt(0)+o[1].charAt(0)+o[2].charAt(0)+o[3].charAt(0):o.join("")}function u5(r,e,i,n){var s=[uc(p5(n)),uc(Math.round(r).toString(16)),uc(Math.round(e).toString(16)),uc(Math.round(i).toString(16))];return s.join("")}br.equals=function(r,e){return!r||!e?!1:br(r).toRgbString()==br(e).toRgbString()},br.random=function(){return br.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})};function iae(r,e){e=e===0?0:e||10;var i=br(r).toHsl();return i.s-=e/100,i.s=Yx(i.s),br(i)}function rae(r,e){e=e===0?0:e||10;var i=br(r).toHsl();return i.s+=e/100,i.s=Yx(i.s),br(i)}function nae(r){return br(r).desaturate(100)}function sae(r,e){e=e===0?0:e||10;var i=br(r).toHsl();return i.l+=e/100,i.l=Yx(i.l),br(i)}function aae(r,e){e=e===0?0:e||10;var i=br(r).toRgb();return i.r=Math.max(0,Math.min(255,i.r-Math.round(255*-(e/100)))),i.g=Math.max(0,Math.min(255,i.g-Math.round(255*-(e/100)))),i.b=Math.max(0,Math.min(255,i.b-Math.round(255*-(e/100)))),br(i)}function oae(r,e){e=e===0?0:e||10;var i=br(r).toHsl();return i.l-=e/100,i.l=Yx(i.l),br(i)}function lae(r,e){var i=br(r).toHsl(),n=(i.h+e)%360;return i.h=n<0?360+n:n,br(i)}function cae(r){var e=br(r).toHsl();return e.h=(e.h+180)%360,br(e)}function h5(r,e){if(isNaN(e)||e<=0)throw new Error("Argument to polyad must be a positive number");for(var i=br(r).toHsl(),n=[br(r)],s=360/e,o=1;o<e;o++)n.push(br({h:(i.h+o*s)%360,s:i.s,l:i.l}));return n}function uae(r){var e=br(r).toHsl(),i=e.h;return[br(r),br({h:(i+72)%360,s:e.s,l:e.l}),br({h:(i+216)%360,s:e.s,l:e.l})]}function hae(r,e,i){e=e||6,i=i||30;var n=br(r).toHsl(),s=360/i,o=[br(r)];for(n.h=(n.h-(s*e>>1)+720)%360;--e;)n.h=(n.h+s)%360,o.push(br(n));return o}function dae(r,e){e=e||6;for(var i=br(r).toHsv(),n=i.h,s=i.s,o=i.v,l=[],u=1/e;e--;)l.push(br({h:n,s,v:o})),o=(o+u)%1;return l}br.mix=function(r,e,i){i=i===0?0:i||50;var n=br(r).toRgb(),s=br(e).toRgb(),o=i/100,l={r:(s.r-n.r)*o+n.r,g:(s.g-n.g)*o+n.g,b:(s.b-n.b)*o+n.b,a:(s.a-n.a)*o+n.a};return br(l)},br.readability=function(r,e){var i=br(r),n=br(e);return(Math.max(i.getLuminance(),n.getLuminance())+.05)/(Math.min(i.getLuminance(),n.getLuminance())+.05)},br.isReadable=function(r,e,i){var n=br.readability(r,e),s,o;switch(o=!1,s=yae(i),s.level+s.size){case"AAsmall":case"AAAlarge":o=n>=4.5;break;case"AAlarge":o=n>=3;break;case"AAAsmall":o=n>=7;break}return o},br.mostReadable=function(r,e,i){var n=null,s=0,o,l,u,c;i=i||{},l=i.includeFallbackColors,u=i.level,c=i.size;for(var h=0;h<e.length;h++)o=br.readability(r,e[h]),o>s&&(s=o,n=br(e[h]));return br.isReadable(r,n,{level:u,size:c})||!l?n:(i.includeFallbackColors=!1,br.mostReadable(r,["#fff","#000"],i))};var IT=br.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},pae=br.hexNames=fae(IT);function fae(r){var e={};for(var i in r)r.hasOwnProperty(i)&&(e[r[i]]=i);return e}function d5(r){return r=parseFloat(r),(isNaN(r)||r<0||r>1)&&(r=1),r}function Es(r,e){mae(r)&&(r="100%");var i=gae(r);return r=Math.min(e,Math.max(0,parseFloat(r))),i&&(r=parseInt(r*e,10)/100),Math.abs(r-e)<1e-6?1:r%e/parseFloat(e)}function Yx(r){return Math.min(1,Math.max(0,r))}function cl(r){return parseInt(r,16)}function mae(r){return typeof r=="string"&&r.indexOf(".")!=-1&&parseFloat(r)===1}function gae(r){return typeof r=="string"&&r.indexOf("%")!=-1}function uc(r){return r.length==1?"0"+r:""+r}function jA(r){return r<=1&&(r=r*100+"%"),r}function p5(r){return Math.round(parseFloat(r)*255).toString(16)}function f5(r){return cl(r)/255}var hc=function(){var r="[-\\+]?\\d+%?",e="[-\\+]?\\d*\\.\\d+%?",i="(?:"+e+")|(?:"+r+")",n="[\\s|\\(]+("+i+")[,|\\s]+("+i+")[,|\\s]+("+i+")\\s*\\)?",s="[\\s|\\(]+("+i+")[,|\\s]+("+i+")[,|\\s]+("+i+")[,|\\s]+("+i+")\\s*\\)?";return{CSS_UNIT:new RegExp(i),rgb:new RegExp("rgb"+n),rgba:new RegExp("rgba"+s),hsl:new RegExp("hsl"+n),hsla:new RegExp("hsla"+s),hsv:new RegExp("hsv"+n),hsva:new RegExp("hsva"+s),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function Uu(r){return!!hc.CSS_UNIT.exec(r)}function Aae(r){r=r.replace(Yse,"").replace(Kse,"").toLowerCase();var e=!1;if(IT[r])r=IT[r],e=!0;else if(r=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var i;return(i=hc.rgb.exec(r))?{r:i[1],g:i[2],b:i[3]}:(i=hc.rgba.exec(r))?{r:i[1],g:i[2],b:i[3],a:i[4]}:(i=hc.hsl.exec(r))?{h:i[1],s:i[2],l:i[3]}:(i=hc.hsla.exec(r))?{h:i[1],s:i[2],l:i[3],a:i[4]}:(i=hc.hsv.exec(r))?{h:i[1],s:i[2],v:i[3]}:(i=hc.hsva.exec(r))?{h:i[1],s:i[2],v:i[3],a:i[4]}:(i=hc.hex8.exec(r))?{r:cl(i[1]),g:cl(i[2]),b:cl(i[3]),a:f5(i[4]),format:e?"name":"hex8"}:(i=hc.hex6.exec(r))?{r:cl(i[1]),g:cl(i[2]),b:cl(i[3]),format:e?"name":"hex"}:(i=hc.hex4.exec(r))?{r:cl(i[1]+""+i[1]),g:cl(i[2]+""+i[2]),b:cl(i[3]+""+i[3]),a:f5(i[4]+""+i[4]),format:e?"name":"hex8"}:(i=hc.hex3.exec(r))?{r:cl(i[1]+""+i[1]),g:cl(i[2]+""+i[2]),b:cl(i[3]+""+i[3]),format:e?"name":"hex"}:!1}function yae(r){var e,i;return r=r||{level:"AA",size:"small"},e=(r.level||"AA").toUpperCase(),i=(r.size||"small").toLowerCase(),e!=="AA"&&e!=="AAA"&&(e="AA"),i!=="small"&&i!=="large"&&(i="small"),{level:e,size:i}}function BT(r,e){(e==null||e>r.length)&&(e=r.length);for(var i=0,n=Array(e);i<e;i++)n[i]=r[i];return n}function vae(r){if(Array.isArray(r))return r}function bae(r){if(Array.isArray(r))return BT(r)}function xae(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function _ae(r,e,i){return e=Kx(e),Lae(r,DT()?Reflect.construct(e,i||[],Kx(r).constructor):e.apply(r,i))}function Eae(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function m5(r,e,i){if(DT())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,e);var s=new(r.bind.apply(r,n));return s}function wae(r,e,i){return Object.defineProperty(r,"prototype",{writable:!1}),r}function LT(r,e,i){return(e=Nae(e))in r?Object.defineProperty(r,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[e]=i,r}function Kx(r){return Kx=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Kx(r)}function Cae(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),e&&NT(r,e)}function DT(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(DT=function(){return!!r})()}function Sae(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function Tae(r,e){var i=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(i!=null){var n,s,o,l,u=[],c=!0,h=!1;try{if(o=(i=i.call(r)).next,e!==0)for(;!(c=(n=o.call(i)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(p){h=!0,s=p}finally{try{if(!c&&i.return!=null&&(l=i.return(),Object(l)!==l))return}finally{if(h)throw s}}return u}}function Mae(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Rae(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function g5(r,e){var i=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),i.push.apply(i,n)}return i}function A5(r){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?g5(Object(i),!0).forEach(function(n){LT(r,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):g5(Object(i)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(i,n))})}return r}function Iae(r,e){if(r==null)return{};var i,n,s=Bae(r,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(r);for(n=0;n<o.length;n++)i=o[n],e.includes(i)||{}.propertyIsEnumerable.call(r,i)&&(s[i]=r[i])}return s}function Bae(r,e){if(r==null)return{};var i={};for(var n in r)if({}.hasOwnProperty.call(r,n)){if(e.includes(n))continue;i[n]=r[n]}return i}function Lae(r,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return xae(r)}function NT(r,e){return NT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,n){return i.__proto__=n,i},NT(r,e)}function y5(r,e){return vae(r)||Tae(r,e)||v5(r,e)||Mae()}function dc(r){return bae(r)||Sae(r)||v5(r)||Rae()}function Dae(r,e){if(typeof r!="object"||!r)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var n=i.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function Nae(r){var e=Dae(r,"string");return typeof e=="symbol"?e:e+""}function PT(r){"@babel/helpers - typeof";return PT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},PT(r)}function v5(r,e){if(r){if(typeof r=="string")return BT(r,e);var i={}.toString.call(r).slice(8,-1);return i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set"?Array.from(r):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?BT(r,e):void 0}}var b5=function(r){r instanceof Array?r.forEach(b5):(r.map&&r.map.dispose(),r.dispose())},x5=function(r){r.geometry&&r.geometry.dispose(),r.material&&b5(r.material),r.texture&&r.texture.dispose(),r.children&&r.children.forEach(x5)},OT=function(r){for(;r.children.length;){var e=r.children[0];r.remove(e),x5(e)}},Pae=["objFilter"];function VA(r,e){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=i.objFilter,s=n===void 0?function(){return!0}:n,o=Iae(i,Pae);return bse(r,e.children.filter(s),function(l){return e.add(l)},function(l){e.remove(l),OT(l)},A5({objBindAttr:"__threeObj"},o))}var GA=function(r){return isNaN(r)?parseInt(br(r).toHex(),16):r},kT=function(r){return isNaN(r)?br(r).getAlpha():1},Oae=wT(a5);function _5(r,e,i){!e||typeof i!="string"||r.filter(function(n){return!n[i]}).forEach(function(n){n[i]=Oae(e(n))})}function kae(r,e){var i=r.nodes,n=r.links,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=s.nodeFilter,l=o===void 0?function(){return!0}:o,u=s.onLoopError,c=u===void 0?function(m){throw"Invalid DAG structure! Found cycle in node path: ".concat(m.join(" -> "),".")}:u,h={};i.forEach(function(m){return h[e(m)]={data:m,out:[],depth:-1,skip:!l(m)}}),n.forEach(function(m){var y=m.source,b=m.target,v=C(y),_=C(b);if(!h.hasOwnProperty(v))throw"Missing source node with id: ".concat(v);if(!h.hasOwnProperty(_))throw"Missing target node with id: ".concat(_);var T=h[v],E=h[_];T.out.push(E);function C(R){return PT(R)==="object"?e(R):R}});var p=[];g(Object.values(h));var f=Object.assign.apply(Object,[{}].concat(dc(Object.entries(h).filter(function(m){var y=y5(m,2),b=y[1];return!b.skip}).map(function(m){var y=y5(m,2),b=y[0],v=y[1];return LT({},b,v.depth)}))));return f;function g(m){for(var y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,v=function(){var E=m[_];if(y.indexOf(E)!==-1){var C=[].concat(dc(y.slice(y.indexOf(E))),[E]).map(function(R){return e(R.data)});return p.some(function(R){return R.length===C.length&&R.every(function(B,I){return B===C[I]})})||(p.push(C),c(C)),1}b>E.depth&&(E.depth=b,g(E.out,[].concat(dc(y),[E]),b+(E.skip?0:1)))},_=0,T=m.length;_<T;_++)v()}}var Pr=window.THREE?window.THREE:{Group:xp,Mesh:pa,MeshLambertMaterial:eie,Color:Cn,BufferGeometry:Ao,BufferAttribute:Fo,Matrix4:gs,Vector3:at,SphereGeometry:Lx,CylinderGeometry:Bx,TubeGeometry:JS,ConeGeometry:KS,Line:x4,LineBasicMaterial:VS,QuadraticBezierCurve3:XS,CubicBezierCurve3:w4,Box3:hp},E5={graph:Bre,forcelayout:hne},Fae=2,FT=new Pr.BufferGeometry().setAttribute?"setAttribute":"addAttribute",Jx=new Pr.BufferGeometry().applyMatrix4?"applyMatrix4":"applyMatrix",Uae=wp({props:{jsonUrl:{onChange:function(r,e){var i=this;r&&!e.fetchingJson&&(e.fetchingJson=!0,e.onLoading(),fetch(r).then(function(n){return n.json()}).then(function(n){e.fetchingJson=!1,e.onFinishLoading(n),i.graphData(n)}))},triggerUpdate:!1},graphData:{default:{nodes:[],links:[]},onChange:function(r,e){e.engineRunning=!1}},numDimensions:{default:3,onChange:function(r,e){var i=e.d3ForceLayout.force("charge");i&&i.strength(r>2?-60:-30),r<3&&n(e.graphData.nodes,"z"),r<2&&n(e.graphData.nodes,"y");function n(s,o){s.forEach(function(l){delete l[o],delete l["v".concat(o)]})}}},dagMode:{onChange:function(r,e){!r&&e.forceEngine==="d3"&&(e.graphData.nodes||[]).forEach(function(i){return i.fx=i.fy=i.fz=void 0})}},dagLevelDistance:{},dagNodeFilter:{default:function(r){return!0}},onDagError:{triggerUpdate:!1},nodeRelSize:{default:4},nodeId:{default:"id"},nodeVal:{default:"val"},nodeResolution:{default:8},nodeColor:{default:"color"},nodeAutoColorBy:{},nodeOpacity:{default:.75},nodeVisibility:{default:!0},nodeThreeObject:{},nodeThreeObjectExtend:{default:!1},nodePositionUpdate:{triggerUpdate:!1},linkSource:{default:"source"},linkTarget:{default:"target"},linkVisibility:{default:!0},linkColor:{default:"color"},linkAutoColorBy:{},linkOpacity:{default:.2},linkWidth:{},linkResolution:{default:6},linkCurvature:{default:0,triggerUpdate:!1},linkCurveRotation:{default:0,triggerUpdate:!1},linkMaterial:{},linkThreeObject:{},linkThreeObjectExtend:{default:!1},linkPositionUpdate:{triggerUpdate:!1},linkDirectionalArrowLength:{default:0},linkDirectionalArrowColor:{},linkDirectionalArrowRelPos:{default:.5,triggerUpdate:!1},linkDirectionalArrowResolution:{default:8},linkDirectionalParticles:{default:0},linkDirectionalParticleSpeed:{default:.01,triggerUpdate:!1},linkDirectionalParticleWidth:{default:.5},linkDirectionalParticleColor:{},linkDirectionalParticleResolution:{default:4},forceEngine:{default:"d3"},d3AlphaMin:{default:0},d3AlphaDecay:{default:.0228,triggerUpdate:!1,onChange:function(r,e){e.d3ForceLayout.alphaDecay(r)}},d3AlphaTarget:{default:0,triggerUpdate:!1,onChange:function(r,e){e.d3ForceLayout.alphaTarget(r)}},d3VelocityDecay:{default:.4,triggerUpdate:!1,onChange:function(r,e){e.d3ForceLayout.velocityDecay(r)}},ngraphPhysics:{default:{timeStep:20,gravity:-1.2,theta:.8,springLength:30,springCoefficient:8e-4,dragCoefficient:.02}},warmupTicks:{default:0,triggerUpdate:!1},cooldownTicks:{default:1/0,triggerUpdate:!1},cooldownTime:{default:15e3,triggerUpdate:!1},onLoading:{default:function(){},triggerUpdate:!1},onFinishLoading:{default:function(){},triggerUpdate:!1},onUpdate:{default:function(){},triggerUpdate:!1},onFinishUpdate:{default:function(){},triggerUpdate:!1},onEngineTick:{default:function(){},triggerUpdate:!1},onEngineStop:{default:function(){},triggerUpdate:!1}},methods:{refresh:function(r){return r._flushObjects=!0,r._rerender(),this},d3Force:function(r,e,i){return i===void 0?r.d3ForceLayout.force(e):(r.d3ForceLayout.force(e,i),this)},d3ReheatSimulation:function(r){return r.d3ForceLayout.alpha(1),this.resetCountdown(),this},resetCountdown:function(r){return r.cntTicks=0,r.startTickTime=new Date,r.engineRunning=!0,this},tickFrame:function(r){var e=r.forceEngine!=="ngraph";return r.engineRunning&&i(),n(),s(),this;function i(){++r.cntTicks>r.cooldownTicks||new Date-r.startTickTime>r.cooldownTime||e&&r.d3AlphaMin>0&&r.d3ForceLayout.alpha()<r.d3AlphaMin?(r.engineRunning=!1,r.onEngineStop()):(r.layout[e?"tick":"step"](),r.onEngineTick());var o=mr(r.nodeThreeObjectExtend);r.graphData.nodes.forEach(function(f){var g=f.__threeObj;if(g){var m=e?f:r.layout.getNodePosition(f[r.nodeId]),y=o(f);(!r.nodePositionUpdate||!r.nodePositionUpdate(y?g.children[0]:g,{x:m.x,y:m.y,z:m.z},f)||y)&&(g.position.x=m.x,g.position.y=m.y||0,g.position.z=m.z||0)}});var l=mr(r.linkWidth),u=mr(r.linkCurvature),c=mr(r.linkCurveRotation),h=mr(r.linkThreeObjectExtend);r.graphData.links.forEach(function(f){var g=f.__lineObj;if(g){var m=e?f:r.layout.getLinkPosition(r.layout.graph.getLink(f.source,f.target).id),y=m[e?"source":"from"],b=m[e?"target":"to"];if(!(!y||!b||!y.hasOwnProperty("x")||!b.hasOwnProperty("x"))){p(f);var v=h(f);if(!(r.linkPositionUpdate&&r.linkPositionUpdate(v?g.children[1]:g,{start:{x:y.x,y:y.y,z:y.z},end:{x:b.x,y:b.y,z:b.z}},f)&&!v)){var _=30,T=f.__curve,E=g.children.length?g.children[0]:g;if(E.type==="Line"){if(T){var C=T.getPoints(_);E.geometry.getAttribute("position").array.length!==C.length*3&&E.geometry[FT]("position",new Pr.BufferAttribute(new Float32Array(C.length*3),3)),E.geometry.setFromPoints(C)}else{var R=E.geometry.getAttribute("position");(!R||!R.array||R.array.length!==6)&&E.geometry[FT]("position",R=new Pr.BufferAttribute(new Float32Array(2*3),3)),R.array[0]=y.x,R.array[1]=y.y||0,R.array[2]=y.z||0,R.array[3]=b.x,R.array[4]=b.y||0,R.array[5]=b.z||0,R.needsUpdate=!0}E.geometry.computeBoundingSphere()}else if(E.type==="Mesh")if(T){E.geometry.type.match(/^Tube(Buffer)?Geometry$/)||(E.position.set(0,0,0),E.rotation.set(0,0,0),E.scale.set(1,1,1));var B=Math.ceil(l(f)*10)/10,I=B/2,N=new Pr.TubeGeometry(T,_,I,r.linkResolution,!1);E.geometry.dispose(),E.geometry=N}else{if(!E.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)){var D=Math.ceil(l(f)*10)/10,P=D/2,k=new Pr.CylinderGeometry(P,P,1,r.linkResolution,1,!1);k[Jx](new Pr.Matrix4().makeTranslation(0,1/2,0)),k[Jx](new Pr.Matrix4().makeRotationX(Math.PI/2)),E.geometry.dispose(),E.geometry=k}var q=new Pr.Vector3(y.x,y.y||0,y.z||0),V=new Pr.Vector3(b.x,b.y||0,b.z||0),j=q.distanceTo(V);E.position.x=q.x,E.position.y=q.y,E.position.z=q.z,E.scale.z=j,E.parent.localToWorld(V),E.lookAt(V)}}}}});function p(f){var g=e?f:r.layout.getLinkPosition(r.layout.graph.getLink(f.source,f.target).id),m=g[e?"source":"from"],y=g[e?"target":"to"];if(!(!m||!y||!m.hasOwnProperty("x")||!y.hasOwnProperty("x"))){var b=u(f);if(!b)f.__curve=null;else{var v=new Pr.Vector3(m.x,m.y||0,m.z||0),_=new Pr.Vector3(y.x,y.y||0,y.z||0),T=v.distanceTo(_),E,C=c(f);if(T>0){var R=y.x-m.x,B=y.y-m.y||0,I=new Pr.Vector3().subVectors(_,v),N=I.clone().multiplyScalar(b).cross(R!==0||B!==0?new Pr.Vector3(0,0,1):new Pr.Vector3(0,1,0)).applyAxisAngle(I.normalize(),C).add(new Pr.Vector3().addVectors(v,_).divideScalar(2));E=new Pr.QuadraticBezierCurve3(v,N,_)}else{var D=b*70,P=-C,k=P+Math.PI/2;E=new Pr.CubicBezierCurve3(v,new Pr.Vector3(D*Math.cos(k),D*Math.sin(k),0).add(v),new Pr.Vector3(D*Math.cos(P),D*Math.sin(P),0).add(v),_)}f.__curve=E}}}}function n(){var o=mr(r.linkDirectionalArrowRelPos),l=mr(r.linkDirectionalArrowLength),u=mr(r.nodeVal);r.graphData.links.forEach(function(c){var h=c.__arrowObj;if(h){var p=e?c:r.layout.getLinkPosition(r.layout.graph.getLink(c.source,c.target).id),f=p[e?"source":"from"],g=p[e?"target":"to"];if(!(!f||!g||!f.hasOwnProperty("x")||!g.hasOwnProperty("x"))){var m=Math.cbrt(Math.max(0,u(f)||1))*r.nodeRelSize,y=Math.cbrt(Math.max(0,u(g)||1))*r.nodeRelSize,b=l(c),v=o(c),_=c.__curve?function(I){return c.__curve.getPoint(I)}:function(I){var N=function(D,P,k,q){return P[D]+(k[D]-P[D])*q||0};return{x:N("x",f,g,I),y:N("y",f,g,I),z:N("z",f,g,I)}},T=c.__curve?c.__curve.getLength():Math.sqrt(["x","y","z"].map(function(I){return Math.pow((g[I]||0)-(f[I]||0),2)}).reduce(function(I,N){return I+N},0)),E=m+b+(T-m-y-b)*v,C=_(E/T),R=_((E-b)/T);["x","y","z"].forEach(function(I){return h.position[I]=R[I]});var B=m5(Pr.Vector3,dc(["x","y","z"].map(function(I){return C[I]})));h.parent.localToWorld(B),h.lookAt(B)}}})}function s(){var o=mr(r.linkDirectionalParticleSpeed);r.graphData.links.forEach(function(l){var u=l.__photonsObj&&l.__photonsObj.children,c=l.__singleHopPhotonsObj&&l.__singleHopPhotonsObj.children;if(!((!c||!c.length)&&(!u||!u.length))){var h=e?l:r.layout.getLinkPosition(r.layout.graph.getLink(l.source,l.target).id),p=h[e?"source":"from"],f=h[e?"target":"to"];if(!(!p||!f||!p.hasOwnProperty("x")||!f.hasOwnProperty("x"))){var g=o(l),m=l.__curve?function(b){return l.__curve.getPoint(b)}:function(b){var v=function(_,T,E,C){return T[_]+(E[_]-T[_])*C||0};return{x:v("x",p,f,b),y:v("y",p,f,b),z:v("z",p,f,b)}},y=[].concat(dc(u||[]),dc(c||[]));y.forEach(function(b,v){var _=b.parent.__linkThreeObjType==="singleHopPhotons";if(b.hasOwnProperty("__progressRatio")||(b.__progressRatio=_?0:v/u.length),b.__progressRatio+=g,b.__progressRatio>=1)if(!_)b.__progressRatio=b.__progressRatio%1;else{b.parent.remove(b),OT(b);return}var T=b.__progressRatio,E=m(T);["x","y","z"].forEach(function(C){return b.position[C]=E[C]})})}}})}},emitParticle:function(r,e){if(e&&r.graphData.links.includes(e)){if(!e.__singleHopPhotonsObj){var i=new Pr.Group;i.__linkThreeObjType="singleHopPhotons",e.__singleHopPhotonsObj=i,r.graphScene.add(i)}var n=mr(r.linkDirectionalParticleWidth),s=Math.ceil(n(e)*10)/10/2,o=r.linkDirectionalParticleResolution,l=new Pr.SphereGeometry(s,o,o),u=mr(r.linkColor),c=mr(r.linkDirectionalParticleColor),h=c(e)||u(e)||"#f0f0f0",p=new Pr.Color(GA(h)),f=r.linkOpacity*3,g=new Pr.MeshLambertMaterial({color:p,transparent:!0,opacity:f});e.__singleHopPhotonsObj.add(new Pr.Mesh(l,g))}return this},getGraphBbox:function(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return!0};if(!r.initialised)return null;var i=function n(s){var o=[];if(s.geometry){s.geometry.computeBoundingBox();var l=new Pr.Box3;l.copy(s.geometry.boundingBox).applyMatrix4(s.matrixWorld),o.push(l)}return o.concat.apply(o,dc((s.children||[]).filter(function(u){return!u.hasOwnProperty("__graphObjType")||u.__graphObjType==="node"&&e(u.__data)}).map(n)))}(r.graphScene);return i.length?Object.assign.apply(Object,dc(["x","y","z"].map(function(n){return LT({},n,[bT(i,function(s){return s.min[n]}),vT(i,function(s){return s.max[n]})])}))):null}},stateInit:function(){return{d3ForceLayout:ik().force("link",q4()).force("charge",rk()).force("center",O4()).force("dagRadial",null).stop(),engineRunning:!1}},init:function(r,e){e.graphScene=r},update:function(r,e){var i=function(Ae){return Ae.some(function(me){return e.hasOwnProperty(me)})};if(r.engineRunning=!1,r.onUpdate(),r.nodeAutoColorBy!==null&&i(["nodeAutoColorBy","graphData","nodeColor"])&&_5(r.graphData.nodes,mr(r.nodeAutoColorBy),r.nodeColor),r.linkAutoColorBy!==null&&i(["linkAutoColorBy","graphData","linkColor"])&&_5(r.graphData.links,mr(r.linkAutoColorBy),r.linkColor),r._flushObjects||i(["graphData","nodeThreeObject","nodeThreeObjectExtend","nodeVal","nodeColor","nodeVisibility","nodeRelSize","nodeResolution","nodeOpacity"])){var n=mr(r.nodeThreeObject),s=mr(r.nodeThreeObjectExtend),o=mr(r.nodeVal),l=mr(r.nodeColor),u=mr(r.nodeVisibility),c={},h={};VA(r.graphData.nodes.filter(u),r.graphScene,{purge:r._flushObjects||i(["nodeThreeObject","nodeThreeObjectExtend"]),objFilter:function(Ae){return Ae.__graphObjType==="node"},createObj:function(Ae){var me=n(Ae),Oe=s(Ae);me&&r.nodeThreeObject===me&&(me=me.clone());var Xe;return me&&!Oe?Xe=me:(Xe=new Pr.Mesh,Xe.__graphDefaultObj=!0,me&&Oe&&Xe.add(me)),Xe.__graphObjType="node",Xe},updateObj:function(Ae,me){if(Ae.__graphDefaultObj){var Oe=o(me)||1,Xe=Math.cbrt(Oe)*r.nodeRelSize,Je=r.nodeResolution;(!Ae.geometry.type.match(/^Sphere(Buffer)?Geometry$/)||Ae.geometry.parameters.radius!==Xe||Ae.geometry.parameters.widthSegments!==Je)&&(c.hasOwnProperty(Oe)||(c[Oe]=new Pr.SphereGeometry(Xe,Je,Je)),Ae.geometry.dispose(),Ae.geometry=c[Oe]);var it=l(me),dt=new Pr.Color(GA(it||"#ffffaa")),St=r.nodeOpacity*kT(it);(Ae.material.type!=="MeshLambertMaterial"||!Ae.material.color.equals(dt)||Ae.material.opacity!==St)&&(h.hasOwnProperty(it)||(h[it]=new Pr.MeshLambertMaterial({color:dt,transparent:!0,opacity:St})),Ae.material.dispose(),Ae.material=h[it])}}})}if(r._flushObjects||i(["graphData","linkThreeObject","linkThreeObjectExtend","linkMaterial","linkColor","linkWidth","linkVisibility","linkResolution","linkOpacity","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution"])){var p=mr(r.linkThreeObject),f=mr(r.linkThreeObjectExtend),g=mr(r.linkMaterial),m=mr(r.linkVisibility),y=mr(r.linkColor),b=mr(r.linkWidth),v={},_={},T={},E=r.graphData.links.filter(m);if(VA(E,r.graphScene,{objBindAttr:"__lineObj",purge:r._flushObjects||i(["linkThreeObject","linkThreeObjectExtend","linkWidth"]),objFilter:function(Ae){return Ae.__graphObjType==="link"},exitObj:function(Ae){var me=Ae.__data&&Ae.__data.__singleHopPhotonsObj;me&&(me.parent.remove(me),OT(me),delete Ae.__data.__singleHopPhotonsObj)},createObj:function(Ae){var me=p(Ae),Oe=f(Ae);me&&r.linkThreeObject===me&&(me=me.clone());var Xe;if(!me||Oe){var Je=!!b(Ae);if(Je)Xe=new Pr.Mesh;else{var it=new Pr.BufferGeometry;it[FT]("position",new Pr.BufferAttribute(new Float32Array(2*3),3)),Xe=new Pr.Line(it)}}var dt;return me?Oe?(dt=new Pr.Group,dt.__graphDefaultObj=!0,dt.add(Xe),dt.add(me)):dt=me:(dt=Xe,dt.__graphDefaultObj=!0),dt.renderOrder=10,dt.__graphObjType="link",dt},updateObj:function(Ae,me){if(Ae.__graphDefaultObj){var Oe=Ae.children.length?Ae.children[0]:Ae,Xe=Math.ceil(b(me)*10)/10,Je=!!Xe;if(Je){var it=Xe/2,dt=r.linkResolution;if(!Oe.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)||Oe.geometry.parameters.radiusTop!==it||Oe.geometry.parameters.radialSegments!==dt){if(!v.hasOwnProperty(Xe)){var St=new Pr.CylinderGeometry(it,it,1,dt,1,!1);St[Jx](new Pr.Matrix4().makeTranslation(0,1/2,0)),St[Jx](new Pr.Matrix4().makeRotationX(Math.PI/2)),v[Xe]=St}Oe.geometry.dispose(),Oe.geometry=v[Xe]}}var Qt=g(me);if(Qt)Oe.material=Qt;else{var yt=y(me),bi=new Pr.Color(GA(yt||"#f0f0f0")),$e=r.linkOpacity*kT(yt),Fi=Je?"MeshLambertMaterial":"LineBasicMaterial";if(Oe.material.type!==Fi||!Oe.material.color.equals(bi)||Oe.material.opacity!==$e){var ui=Je?_:T;ui.hasOwnProperty(yt)||(ui[yt]=new Pr[Fi]({color:bi,transparent:$e<1,opacity:$e,depthWrite:$e>=1})),Oe.material.dispose(),Oe.material=ui[yt]}}}}}),r.linkDirectionalArrowLength||e.hasOwnProperty("linkDirectionalArrowLength")){var C=mr(r.linkDirectionalArrowLength),R=mr(r.linkDirectionalArrowColor);VA(E.filter(C),r.graphScene,{objBindAttr:"__arrowObj",objFilter:function(Ae){return Ae.__linkThreeObjType==="arrow"},createObj:function(){var Ae=new Pr.Mesh(void 0,new Pr.MeshLambertMaterial({transparent:!0}));return Ae.__linkThreeObjType="arrow",Ae},updateObj:function(Ae,me){var Oe=C(me),Xe=r.linkDirectionalArrowResolution;if(!Ae.geometry.type.match(/^Cone(Buffer)?Geometry$/)||Ae.geometry.parameters.height!==Oe||Ae.geometry.parameters.radialSegments!==Xe){var Je=new Pr.ConeGeometry(Oe*.25,Oe,Xe);Je.translate(0,Oe/2,0),Je.rotateX(Math.PI/2),Ae.geometry.dispose(),Ae.geometry=Je}var it=R(me)||y(me)||"#f0f0f0";Ae.material.color=new Pr.Color(GA(it)),Ae.material.opacity=r.linkOpacity*3*kT(it)}})}if(r.linkDirectionalParticles||e.hasOwnProperty("linkDirectionalParticles")){var B=mr(r.linkDirectionalParticles),I=mr(r.linkDirectionalParticleWidth),N=mr(r.linkDirectionalParticleColor),D={},P={};VA(E.filter(B),r.graphScene,{objBindAttr:"__photonsObj",objFilter:function(Ae){return Ae.__linkThreeObjType==="photons"},createObj:function(){var Ae=new Pr.Group;return Ae.__linkThreeObjType="photons",Ae},updateObj:function(Ae,me){var Oe=Math.round(Math.abs(B(me))),Xe=!!Ae.children.length&&Ae.children[0],Je=Math.ceil(I(me)*10)/10/2,it=r.linkDirectionalParticleResolution,dt;Xe&&Xe.geometry.parameters.radius===Je&&Xe.geometry.parameters.widthSegments===it?dt=Xe.geometry:(P.hasOwnProperty(Je)||(P[Je]=new Pr.SphereGeometry(Je,it,it)),dt=P[Je],Xe&&Xe.geometry.dispose());var St=N(me)||y(me)||"#f0f0f0",Qt=new Pr.Color(GA(St)),yt=r.linkOpacity*3,bi;Xe&&Xe.material.color.equals(Qt)&&Xe.material.opacity===yt?bi=Xe.material:(D.hasOwnProperty(St)||(D[St]=new Pr.MeshLambertMaterial({color:Qt,transparent:!0,opacity:yt})),bi=D[St],Xe&&Xe.material.dispose()),VA(dc(new Array(Oe)).map(function($e,Fi){return{idx:Fi}}),Ae,{idAccessor:function($e){return $e.idx},createObj:function(){return new Pr.Mesh(dt,bi)},updateObj:function($e){$e.geometry=dt,$e.material=bi}})}})}}if(r._flushObjects=!1,i(["graphData","nodeId","linkSource","linkTarget","numDimensions","forceEngine","dagMode","dagNodeFilter","dagLevelDistance"])){r.engineRunning=!1,r.graphData.links.forEach(function(Ae){Ae.source=Ae[r.linkSource],Ae.target=Ae[r.linkTarget]});var k=r.forceEngine!=="ngraph",q;if(k){(q=r.d3ForceLayout).stop().alpha(1).numDimensions(r.numDimensions).nodes(r.graphData.nodes);var V=r.d3ForceLayout.force("link");V&&V.id(function(Ae){return Ae[r.nodeId]}).links(r.graphData.links);var j=r.dagMode&&kae(r.graphData,function(Ae){return Ae[r.nodeId]},{nodeFilter:r.dagNodeFilter,onLoopError:r.onDagError||void 0}),Q=Math.max.apply(Math,dc(Object.values(j||[]))),W=r.dagLevelDistance||r.graphData.nodes.length/(Q||1)*Fae*(["radialin","radialout"].indexOf(r.dagMode)!==-1?.7:1);if(["lr","rl","td","bu","zin","zout"].includes(e.dagMode)){var G=["lr","rl"].includes(e.dagMode)?"fx":["td","bu"].includes(e.dagMode)?"fy":"fz";r.graphData.nodes.filter(r.dagNodeFilter).forEach(function(Ae){return delete Ae[G]})}if(["lr","rl","td","bu","zin","zout"].includes(r.dagMode)){var z=["rl","td","zout"].includes(r.dagMode),te=function(Ae){return(j[Ae[r.nodeId]]-Q/2)*W*(z?-1:1)},Y=["lr","rl"].includes(r.dagMode)?"fx":["td","bu"].includes(r.dagMode)?"fy":"fz";r.graphData.nodes.filter(r.dagNodeFilter).forEach(function(Ae){return Ae[Y]=te(Ae)})}r.d3ForceLayout.force("dagRadial",["radialin","radialout"].indexOf(r.dagMode)!==-1?nk(function(Ae){var me=j[Ae[r.nodeId]]||-1;return(r.dagMode==="radialin"?Q-me:me)*W}).strength(function(Ae){return r.dagNodeFilter(Ae)?1:0}):null)}else{var se=E5.graph();r.graphData.nodes.forEach(function(Ae){se.addNode(Ae[r.nodeId])}),r.graphData.links.forEach(function(Ae){se.addLink(Ae.source,Ae.target)}),q=E5.forcelayout(se,A5({dimensions:r.numDimensions},r.ngraphPhysics)),q.graph=se}for(var ve=0;ve<r.warmupTicks&&!(k&&r.d3AlphaMin>0&&r.d3ForceLayout.alpha()<r.d3AlphaMin);ve++)q[k?"tick":"step"]();r.layout=q,this.resetCountdown()}r.engineRunning=!0,r.onFinishUpdate()}});function zae(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Object,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=function(s){function o(){var l;Eae(this,o);for(var u=arguments.length,c=new Array(u),h=0;h<u;h++)c[h]=arguments[h];return l=_ae(this,o,[].concat(c)),l.__kapsuleInstance=m5(r,[].concat(dc(i?[l]:[]),c)),l}return Cae(o,s),wae(o)}(e);return Object.keys(r()).forEach(function(s){return n.prototype[s]=function(){var o,l=(o=this.__kapsuleInstance)[s].apply(o,arguments);return l===this.__kapsuleInstance?this:l}}),n}var jae=window.THREE?window.THREE:{Group:xp},UT=zae(Uae,jae.Group,!0);const Vae=Object.freeze(Object.defineProperty({__proto__:null,default:UT},Symbol.toStringTag,{value:"Module"})),Gae=c2(Vae);if(typeof AFRAME>"u")throw new Error("Component attempted to register before AFRAME was available.");let zT=mie;"default"in zT&&(zT=zT.default);let Tp=Gae;"default"in Tp&&(Tp=Tp.default);const jT=function(r){return typeof r=="string"?JSON.parse(r):r},pc=function(r){if(typeof r=="function")return r;const e=eval;try{return e("("+r+")")}catch{}return null},ks=function(r){return isNaN(parseFloat(r))?pc(r)?pc(r):r:parseFloat(r)};AFRAME.registerComponent("forcegraph",{schema:{jsonUrl:{type:"string",default:""},nodes:{parse:jT,default:[]},links:{parse:jT,default:[]},numDimensions:{type:"number",default:3},dagMode:{type:"string",default:""},dagLevelDistance:{type:"number",default:0},dagNodeFilter:{parse:pc,default:function(){return!0}},onDagError:{parse:pc,default:void 0},nodeRelSize:{type:"number",default:4},nodeId:{type:"string",default:"id"},nodeVal:{parse:ks,default:"val"},nodeResolution:{type:"number",default:8},nodeVisibility:{parse:ks,default:!0},nodeColor:{parse:ks,default:"color"},nodeAutoColorBy:{parse:ks,default:""},nodeOpacity:{type:"number",default:.75},nodeThreeObject:{parse:ks,default:null},nodeThreeObjectExtend:{parse:ks,default:!1},linkSource:{type:"string",default:"source"},linkTarget:{type:"string",default:"target"},linkVisibility:{parse:ks,default:!0},linkColor:{parse:ks,default:"color"},linkAutoColorBy:{parse:ks,default:""},linkOpacity:{type:"number",default:.2},linkWidth:{parse:ks,default:0},linkResolution:{type:"number",default:6},linkCurvature:{parse:ks,default:0},linkCurveRotation:{parse:ks,default:0},linkMaterial:{parse:ks,default:null},linkThreeObject:{parse:ks,default:null},linkThreeObjectExtend:{parse:ks,default:!1},linkPositionUpdate:{parse:pc,default:null},linkDirectionalArrowLength:{parse:ks,default:0},linkDirectionalArrowColor:{parse:ks,default:null},linkDirectionalArrowRelPos:{parse:ks,default:.5},linkDirectionalArrowResolution:{type:"number",default:8},linkDirectionalParticles:{parse:ks,default:0},linkDirectionalParticleSpeed:{parse:ks,default:.01},linkDirectionalParticleWidth:{parse:ks,default:.5},linkDirectionalParticleColor:{parse:ks,default:null},linkDirectionalParticleResolution:{type:"number",default:4},onNodeHover:{parse:pc,default:()=>{}},onLinkHover:{parse:pc,default:()=>{}},onNodeClick:{parse:pc,default:()=>{}},onLinkClick:{parse:pc,default:()=>{}},forceEngine:{type:"string",default:"d3"},d3AlphaMin:{type:"number",default:0},d3AlphaDecay:{type:"number",default:.0228},d3VelocityDecay:{type:"number",default:.4},ngraphPhysics:{parse:jT,default:null},warmupTicks:{type:"int",default:0},cooldownTicks:{type:"int",default:1e18},cooldownTime:{type:"int",default:15e3},onEngineTick:{parse:pc,default:function(){}},onEngineStop:{parse:pc,default:function(){}}},getGraphBbox:function(r){return this.forceGraph||(this.forceGraph=new Tp),this.forceGraph.getGraphBbox(r)},emitParticle:function(){this.forceGraph||(this.forceGraph=new Tp);const r=this.forceGraph,e=r.emitParticle.apply(r,arguments);return e===r?this:e},d3Force:function(){this.forceGraph||(this.forceGraph=new Tp);const r=this.forceGraph,e=r.d3Force.apply(r,arguments);return e===r?this:e},d3ReheatSimulation:function(){return this.forceGraph&&this.forceGraph.d3ReheatSimulation(),this},refresh:function(){return this.forceGraph&&this.forceGraph.refresh(),this},init:function(){const r=this.state={};r.infoEl=document.createElement("a-text"),r.infoEl.setAttribute("position","0 -0.1 -1"),r.infoEl.setAttribute("width",1),r.infoEl.setAttribute("align","center"),r.infoEl.setAttribute("color","lavender");const e=document.querySelector("a-entity[camera], a-camera");e.appendChild(r.infoEl),r.cameraObj=e.object3D.children.filter(function(i){return i.type==="PerspectiveCamera"})[0],this.el.sceneEl.addEventListener("camera-set-active",function(i){r.cameraObj=i.detail.cameraEl.components.camera.camera}),this.forceGraph||(this.forceGraph=new Tp),this.forceGraph.onFinishUpdate(()=>this.el.setObject3D("forcegraphGroup",this.forceGraph)).onLoading(()=>r.infoEl.setAttribute("value","Loading...")).onFinishLoading(()=>r.infoEl.setAttribute("value","")),this.el.addEventListener("raycaster-intersected",i=>r.hoverDetail=i.detail),this.el.addEventListener("raycaster-intersected-cleared",i=>r.hoverDetail=i.detail),this.el.addEventListener("click",()=>r.hoverObj&&this.data["on"+(r.hoverObj.__graphObjType==="node"?"Node":"Link")+"Click"](r.hoverObj.__data))},remove:function(){this.state.infoEl.remove(),this.el.removeObject3D("forcegraphGroup")},update:function(r){const e=this,i=this.data,n=AFRAME.utils.diff(i,r);["jsonUrl","numDimensions","dagMode","dagLevelDistance","dagNodeFilter","onDagError","nodeRelSize","nodeId","nodeVal","nodeResolution","nodeVisibility","nodeColor","nodeAutoColorBy","nodeOpacity","nodeThreeObject","nodeThreeObjectExtend","linkSource","linkTarget","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","forceEngine","d3AlphaMin","d3AphaDecay","d3VelocityDecay","ngraphPhysics","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"].filter(function(s){return s in n}).forEach(function(s){e.forceGraph[s](i[s]!==""?i[s]:null)}),("nodes"in n||"links"in n)&&e.forceGraph.graphData({nodes:i.nodes,links:i.links})},tick:function(r,e){const i=this.state,n=this.data,s=i.hoverDetail?i.hoverDetail.getIntersection?i.hoverDetail.getIntersection(this.el):i.hoverDetail.intersection||void 0:void 0;let o=s?s.object:void 0;for(;o&&!o.hasOwnProperty("__graphObjType");)o=o.parent;if(o!==i.hoverObj){const l=i.hoverObj?i.hoverObj.__graphObjType:null,u=i.hoverObj?i.hoverObj.__data:null,c=o?o.__graphObjType:null,h=o?o.__data:null;l&&l!==c&&n["on"+(l==="node"?"Node":"Link")+"Hover"](null,u),c&&n["on"+(c==="node"?"Node":"Link")+"Hover"](h,l===c?u:null),i.hoverObj=o}this.forceGraph.tickFrame()}});function jo(){return jo=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(r[n]=i[n])}return r},jo.apply(null,arguments)}function Hae(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function HA(r,e){return HA=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,n){return i.__proto__=n,i},HA(r,e)}function Wae(r,e){r.prototype=Object.create(e.prototype),r.prototype.constructor=r,HA(r,e)}function VT(r){return VT=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},VT(r)}function Qae(r){try{return Function.toString.call(r).indexOf("[native code]")!==-1}catch{return typeof r=="function"}}function w5(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(w5=function(){return!!r})()}function qae(r,e,i){if(w5())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,e);var s=new(r.bind.apply(r,n));return i&&HA(s,i.prototype),s}function GT(r){var e=typeof Map=="function"?new Map:void 0;return GT=function(i){if(i===null||!Qae(i))return i;if(typeof i!="function")throw new TypeError("Super expression must either be null or a function");if(e!==void 0){if(e.has(i))return e.get(i);e.set(i,n)}function n(){return qae(i,arguments,VT(this).constructor)}return n.prototype=Object.create(i.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),HA(n,i)},GT(r)}var Xae={1:`Passed invalid arguments to hsl, please pass multiple numbers e.g. hsl(360, 0.75, 0.4) or an object e.g. rgb({ hue: 255, saturation: 0.4, lightness: 0.75 }).

`,2:`Passed invalid arguments to hsla, please pass multiple numbers e.g. hsla(360, 0.75, 0.4, 0.7) or an object e.g. rgb({ hue: 255, saturation: 0.4, lightness: 0.75, alpha: 0.7 }).

`,3:`Passed an incorrect argument to a color function, please pass a string representation of a color.

`,4:`Couldn't generate valid rgb string from %s, it returned %s.

`,5:`Couldn't parse the color string. Please provide the color as a string in hex, rgb, rgba, hsl or hsla notation.

`,6:`Passed invalid arguments to rgb, please pass multiple numbers e.g. rgb(255, 205, 100) or an object e.g. rgb({ red: 255, green: 205, blue: 100 }).

`,7:`Passed invalid arguments to rgba, please pass multiple numbers e.g. rgb(255, 205, 100, 0.75) or an object e.g. rgb({ red: 255, green: 205, blue: 100, alpha: 0.75 }).

`,8:`Passed invalid argument to toColorString, please pass a RgbColor, RgbaColor, HslColor or HslaColor object.

`,9:`Please provide a number of steps to the modularScale helper.

`,10:`Please pass a number or one of the predefined scales to the modularScale helper as the ratio.

`,11:`Invalid value passed as base to modularScale, expected number or em string but got "%s"

`,12:`Expected a string ending in "px" or a number passed as the first argument to %s(), got "%s" instead.

`,13:`Expected a string ending in "px" or a number passed as the second argument to %s(), got "%s" instead.

`,14:`Passed invalid pixel value ("%s") to %s(), please pass a value like "12px" or 12.

`,15:`Passed invalid base value ("%s") to %s(), please pass a value like "12px" or 12.

`,16:`You must provide a template to this method.

`,17:`You passed an unsupported selector state to this method.

`,18:`minScreen and maxScreen must be provided as stringified numbers with the same units.

`,19:`fromSize and toSize must be provided as stringified numbers with the same units.

`,20:`expects either an array of objects or a single object with the properties prop, fromSize, and toSize.

`,21:"expects the objects in the first argument array to have the properties `prop`, `fromSize`, and `toSize`.\n\n",22:"expects the first argument object to have the properties `prop`, `fromSize`, and `toSize`.\n\n",23:`fontFace expects a name of a font-family.

`,24:`fontFace expects either the path to the font file(s) or a name of a local copy.

`,25:`fontFace expects localFonts to be an array.

`,26:`fontFace expects fileFormats to be an array.

`,27:`radialGradient requries at least 2 color-stops to properly render.

`,28:`Please supply a filename to retinaImage() as the first argument.

`,29:`Passed invalid argument to triangle, please pass correct pointingDirection e.g. 'right'.

`,30:"Passed an invalid value to `height` or `width`. Please provide a pixel based unit.\n\n",31:`The animation shorthand only takes 8 arguments. See the specification for more information: http://mdn.io/animation

`,32:`To pass multiple animations please supply them in arrays, e.g. animation(['rotate', '2s'], ['move', '1s'])
To pass a single animation please supply them in simple values, e.g. animation('rotate', '2s')

`,33:`The animation shorthand arrays can only have 8 elements. See the specification for more information: http://mdn.io/animation

`,34:`borderRadius expects a radius value as a string or number as the second argument.

`,35:`borderRadius expects one of "top", "bottom", "left" or "right" as the first argument.

`,36:`Property must be a string value.

`,37:`Syntax Error at %s.

`,38:`Formula contains a function that needs parentheses at %s.

`,39:`Formula is missing closing parenthesis at %s.

`,40:`Formula has too many closing parentheses at %s.

`,41:`All values in a formula must have the same unit or be unitless.

`,42:`Please provide a number of steps to the modularScale helper.

`,43:`Please pass a number or one of the predefined scales to the modularScale helper as the ratio.

`,44:`Invalid value passed as base to modularScale, expected number or em/rem string but got %s.

`,45:`Passed invalid argument to hslToColorString, please pass a HslColor or HslaColor object.

`,46:`Passed invalid argument to rgbToColorString, please pass a RgbColor or RgbaColor object.

`,47:`minScreen and maxScreen must be provided as stringified numbers with the same units.

`,48:`fromSize and toSize must be provided as stringified numbers with the same units.

`,49:`Expects either an array of objects or a single object with the properties prop, fromSize, and toSize.

`,50:`Expects the objects in the first argument array to have the properties prop, fromSize, and toSize.

`,51:`Expects the first argument object to have the properties prop, fromSize, and toSize.

`,52:`fontFace expects either the path to the font file(s) or a name of a local copy.

`,53:`fontFace expects localFonts to be an array.

`,54:`fontFace expects fileFormats to be an array.

`,55:`fontFace expects a name of a font-family.

`,56:`linearGradient requries at least 2 color-stops to properly render.

`,57:`radialGradient requries at least 2 color-stops to properly render.

`,58:`Please supply a filename to retinaImage() as the first argument.

`,59:`Passed invalid argument to triangle, please pass correct pointingDirection e.g. 'right'.

`,60:"Passed an invalid value to `height` or `width`. Please provide a pixel based unit.\n\n",61:`Property must be a string value.

`,62:`borderRadius expects a radius value as a string or number as the second argument.

`,63:`borderRadius expects one of "top", "bottom", "left" or "right" as the first argument.

`,64:`The animation shorthand only takes 8 arguments. See the specification for more information: http://mdn.io/animation.

`,65:`To pass multiple animations please supply them in arrays, e.g. animation(['rotate', '2s'], ['move', '1s'])\\nTo pass a single animation please supply them in simple values, e.g. animation('rotate', '2s').

`,66:`The animation shorthand arrays can only have 8 elements. See the specification for more information: http://mdn.io/animation.

`,67:`You must provide a template to this method.

`,68:`You passed an unsupported selector state to this method.

`,69:`Expected a string ending in "px" or a number passed as the first argument to %s(), got %s instead.

`,70:`Expected a string ending in "px" or a number passed as the second argument to %s(), got %s instead.

`,71:`Passed invalid pixel value %s to %s(), please pass a value like "12px" or 12.

`,72:`Passed invalid base value %s to %s(), please pass a value like "12px" or 12.

`,73:`Please provide a valid CSS variable.

`,74:`CSS variable not found and no default was provided.

`,75:`important requires a valid style object, got a %s instead.

`,76:`fromSize and toSize must be provided as stringified numbers with the same units as minScreen and maxScreen.

`,77:`remToPx expects a value in "rem" but you provided it in "%s".

`,78:`base must be set in "px" or "%" but you set it in "%s".
`};function Yae(){for(var r=arguments.length,e=new Array(r),i=0;i<r;i++)e[i]=arguments[i];var n=e[0],s=[],o;for(o=1;o<e.length;o+=1)s.push(e[o]);return s.forEach(function(l){n=n.replace(/%[a-z]/,l)}),n}var Hc=function(r){Wae(e,r);function e(i){var n;if(process.env.NODE_ENV==="production")n=r.call(this,"An error occurred. See https://github.com/styled-components/polished/blob/main/src/internalHelpers/errors.md#"+i+" for more information.")||this;else{for(var s=arguments.length,o=new Array(s>1?s-1:0),l=1;l<s;l++)o[l-1]=arguments[l];n=r.call(this,Yae.apply(void 0,[Xae[i]].concat(o)))||this}return Hae(n)}return e}(GT(Error));function HT(r){return Math.round(r*255)}function Kae(r,e,i){return HT(r)+","+HT(e)+","+HT(i)}function Zx(r,e,i,n){if(n===void 0&&(n=Kae),e===0)return n(i,i,i);var s=(r%360+360)%360/60,o=(1-Math.abs(2*i-1))*e,l=o*(1-Math.abs(s%2-1)),u=0,c=0,h=0;s>=0&&s<1?(u=o,c=l):s>=1&&s<2?(u=l,c=o):s>=2&&s<3?(c=o,h=l):s>=3&&s<4?(c=l,h=o):s>=4&&s<5?(u=l,h=o):s>=5&&s<6&&(u=o,h=l);var p=i-o/2,f=u+p,g=c+p,m=h+p;return n(f,g,m)}var C5={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"639",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};function Jae(r){if(typeof r!="string")return r;var e=r.toLowerCase();return C5[e]?"#"+C5[e]:r}var Zae=/^#[a-fA-F0-9]{6}$/,$ae=/^#[a-fA-F0-9]{8}$/,eoe=/^#[a-fA-F0-9]{3}$/,toe=/^#[a-fA-F0-9]{4}$/,WT=/^rgb\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*\)$/i,ioe=/^rgb(?:a)?\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i,roe=/^hsl\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*\)$/i,noe=/^hsl(?:a)?\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i;function Mp(r){if(typeof r!="string")throw new Hc(3);var e=Jae(r);if(e.match(Zae))return{red:parseInt(""+e[1]+e[2],16),green:parseInt(""+e[3]+e[4],16),blue:parseInt(""+e[5]+e[6],16)};if(e.match($ae)){var i=parseFloat((parseInt(""+e[7]+e[8],16)/255).toFixed(2));return{red:parseInt(""+e[1]+e[2],16),green:parseInt(""+e[3]+e[4],16),blue:parseInt(""+e[5]+e[6],16),alpha:i}}if(e.match(eoe))return{red:parseInt(""+e[1]+e[1],16),green:parseInt(""+e[2]+e[2],16),blue:parseInt(""+e[3]+e[3],16)};if(e.match(toe)){var n=parseFloat((parseInt(""+e[4]+e[4],16)/255).toFixed(2));return{red:parseInt(""+e[1]+e[1],16),green:parseInt(""+e[2]+e[2],16),blue:parseInt(""+e[3]+e[3],16),alpha:n}}var s=WT.exec(e);if(s)return{red:parseInt(""+s[1],10),green:parseInt(""+s[2],10),blue:parseInt(""+s[3],10)};var o=ioe.exec(e.substring(0,50));if(o)return{red:parseInt(""+o[1],10),green:parseInt(""+o[2],10),blue:parseInt(""+o[3],10),alpha:parseFloat(""+o[4])>1?parseFloat(""+o[4])/100:parseFloat(""+o[4])};var l=roe.exec(e);if(l){var u=parseInt(""+l[1],10),c=parseInt(""+l[2],10)/100,h=parseInt(""+l[3],10)/100,p="rgb("+Zx(u,c,h)+")",f=WT.exec(p);if(!f)throw new Hc(4,e,p);return{red:parseInt(""+f[1],10),green:parseInt(""+f[2],10),blue:parseInt(""+f[3],10)}}var g=noe.exec(e.substring(0,50));if(g){var m=parseInt(""+g[1],10),y=parseInt(""+g[2],10)/100,b=parseInt(""+g[3],10)/100,v="rgb("+Zx(m,y,b)+")",_=WT.exec(v);if(!_)throw new Hc(4,e,v);return{red:parseInt(""+_[1],10),green:parseInt(""+_[2],10),blue:parseInt(""+_[3],10),alpha:parseFloat(""+g[4])>1?parseFloat(""+g[4])/100:parseFloat(""+g[4])}}throw new Hc(5)}function soe(r){var e=r.red/255,i=r.green/255,n=r.blue/255,s=Math.max(e,i,n),o=Math.min(e,i,n),l=(s+o)/2;if(s===o)return r.alpha!==void 0?{hue:0,saturation:0,lightness:l,alpha:r.alpha}:{hue:0,saturation:0,lightness:l};var u,c=s-o,h=l>.5?c/(2-s-o):c/(s+o);switch(s){case e:u=(i-n)/c+(i<n?6:0);break;case i:u=(n-e)/c+2;break;default:u=(e-i)/c+4;break}return u*=60,r.alpha!==void 0?{hue:u,saturation:h,lightness:l,alpha:r.alpha}:{hue:u,saturation:h,lightness:l}}function rd(r){return soe(Mp(r))}var aoe=function(r){return r.length===7&&r[1]===r[2]&&r[3]===r[4]&&r[5]===r[6]?"#"+r[1]+r[3]+r[5]:r},QT=aoe;function Rp(r){var e=r.toString(16);return e.length===1?"0"+e:e}function qT(r){return Rp(Math.round(r*255))}function ooe(r,e,i){return QT("#"+qT(r)+qT(e)+qT(i))}function S5(r,e,i){return Zx(r,e,i,ooe)}function loe(r,e,i){if(typeof r=="object"&&e===void 0&&i===void 0)return S5(r.hue,r.saturation,r.lightness);throw new Hc(1)}function coe(r,e,i,n){if(typeof r=="object"&&e===void 0&&i===void 0&&n===void 0)return r.alpha>=1?S5(r.hue,r.saturation,r.lightness):"rgba("+Zx(r.hue,r.saturation,r.lightness)+","+r.alpha+")";throw new Hc(2)}function T5(r,e,i){if(typeof r=="number"&&typeof e=="number"&&typeof i=="number")return QT("#"+Rp(r)+Rp(e)+Rp(i));if(typeof r=="object"&&e===void 0&&i===void 0)return QT("#"+Rp(r.red)+Rp(r.green)+Rp(r.blue));throw new Hc(6)}function $x(r,e,i,n){if(typeof r=="object"&&e===void 0&&i===void 0&&n===void 0)return r.alpha>=1?T5(r.red,r.green,r.blue):"rgba("+r.red+","+r.green+","+r.blue+","+r.alpha+")";throw new Hc(7)}var uoe=function(r){return typeof r.red=="number"&&typeof r.green=="number"&&typeof r.blue=="number"&&(typeof r.alpha!="number"||typeof r.alpha>"u")},hoe=function(r){return typeof r.red=="number"&&typeof r.green=="number"&&typeof r.blue=="number"&&typeof r.alpha=="number"},doe=function(r){return typeof r.hue=="number"&&typeof r.saturation=="number"&&typeof r.lightness=="number"&&(typeof r.alpha!="number"||typeof r.alpha>"u")},poe=function(r){return typeof r.hue=="number"&&typeof r.saturation=="number"&&typeof r.lightness=="number"&&typeof r.alpha=="number"};function nd(r){if(typeof r!="object")throw new Hc(8);if(hoe(r))return $x(r);if(uoe(r))return T5(r);if(poe(r))return coe(r);if(doe(r))return loe(r);throw new Hc(8)}function M5(r,e,i){return function(){var n=i.concat(Array.prototype.slice.call(arguments));return n.length>=e?r.apply(this,n):M5(r,e,n)}}function ul(r){return M5(r,r.length,[])}function foe(r,e){if(e==="transparent")return e;var i=rd(e);return nd(jo({},i,{hue:i.hue+parseFloat(r)}))}ul(foe);function Wm(r,e,i){return Math.max(r,Math.min(e,i))}function moe(r,e){if(e==="transparent")return e;var i=rd(e);return nd(jo({},i,{lightness:Wm(0,1,i.lightness-parseFloat(r))}))}ul(moe);function goe(r,e){if(e==="transparent")return e;var i=rd(e);return nd(jo({},i,{saturation:Wm(0,1,i.saturation-parseFloat(r))}))}ul(goe);function Aoe(r,e){if(e==="transparent")return e;var i=rd(e);return nd(jo({},i,{lightness:Wm(0,1,i.lightness+parseFloat(r))}))}ul(Aoe);function yoe(r,e,i){if(e==="transparent")return i;if(i==="transparent")return e;if(r===0)return i;var n=Mp(e),s=jo({},n,{alpha:typeof n.alpha=="number"?n.alpha:1}),o=Mp(i),l=jo({},o,{alpha:typeof o.alpha=="number"?o.alpha:1}),u=s.alpha-l.alpha,c=parseFloat(r)*2-1,h=c*u===-1?c:c+u,p=1+c*u,f=(h/p+1)/2,g=1-f,m={red:Math.floor(s.red*f+l.red*g),green:Math.floor(s.green*f+l.green*g),blue:Math.floor(s.blue*f+l.blue*g),alpha:s.alpha*parseFloat(r)+l.alpha*(1-parseFloat(r))};return $x(m)}var voe=ul(yoe),R5=voe;function boe(r,e){if(e==="transparent")return e;var i=Mp(e),n=typeof i.alpha=="number"?i.alpha:1,s=jo({},i,{alpha:Wm(0,1,(n*100+parseFloat(r)*100)/100)});return $x(s)}var xoe=ul(boe),I5=xoe;function _oe(r,e){if(e==="transparent")return e;var i=rd(e);return nd(jo({},i,{saturation:Wm(0,1,i.saturation+parseFloat(r))}))}ul(_oe);function Eoe(r,e){return e==="transparent"?e:nd(jo({},rd(e),{hue:parseFloat(r)}))}ul(Eoe);function woe(r,e){return e==="transparent"?e:nd(jo({},rd(e),{lightness:parseFloat(r)}))}ul(woe);function Coe(r,e){return e==="transparent"?e:nd(jo({},rd(e),{saturation:parseFloat(r)}))}ul(Coe);function Soe(r,e){return e==="transparent"?e:R5(parseFloat(r),"rgb(0, 0, 0)",e)}ul(Soe);function Toe(r,e){return e==="transparent"?e:R5(parseFloat(r),"rgb(255, 255, 255)",e)}ul(Toe);function Moe(r,e){if(e==="transparent")return e;var i=Mp(e),n=typeof i.alpha=="number"?i.alpha:1,s=jo({},i,{alpha:Wm(0,1,+(n*100-parseFloat(r)*100).toFixed(2)/100)});return $x(s)}ul(Moe);function Roe(r,e){e===void 0&&(e={});var i=e.insertAt;if(!(typeof document>"u")){var n=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css",i==="top"&&n.firstChild?n.insertBefore(s,n.firstChild):n.appendChild(s),s.styleSheet?s.styleSheet.cssText=r:s.appendChild(document.createTextNode(r))}}var Ioe=`.graph-nav-info {
  position: absolute;
  bottom: 5px;
  width: 100%;
  text-align: center;
  color: slategrey;
  opacity: 0.7;
  font-size: 10px;
  font-family: Sans-serif;
  z-index: 1000;
}`;Roe(Ioe);function XT(r,e){(e==null||e>r.length)&&(e=r.length);for(var i=0,n=Array(e);i<e;i++)n[i]=r[i];return n}function Boe(r){if(Array.isArray(r))return r}function Loe(r){if(Array.isArray(r))return XT(r)}function WA(r,e,i){return(e=Foe(e))in r?Object.defineProperty(r,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[e]=i,r}function Doe(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function Noe(r,e){var i=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(i!=null){var n,s,o,l,u=[],c=!0,h=!1;try{if(o=(i=i.call(r)).next,e!==0)for(;!(c=(n=o.call(i)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(p){h=!0,s=p}finally{try{if(!c&&i.return!=null&&(l=i.return(),Object(l)!==l))return}finally{if(h)throw s}}return u}}function Poe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ooe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function B5(r,e){var i=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),i.push.apply(i,n)}return i}function L5(r){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?B5(Object(i),!0).forEach(function(n){WA(r,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):B5(Object(i)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(i,n))})}return r}function YT(r,e){return Boe(r)||Noe(r,e)||D5(r,e)||Poe()}function e1(r){return Loe(r)||Doe(r)||D5(r)||Ooe()}function koe(r,e){if(typeof r!="object"||!r)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var n=i.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function Foe(r){var e=koe(r,"string");return typeof e=="symbol"?e:e+""}function D5(r,e){if(r){if(typeof r=="string")return XT(r,e);var i={}.toString.call(r).slice(8,-1);return i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set"?Array.from(r):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?XT(r,e):void 0}}var N5=wp({props:{width:{default:window.innerWidth,triggerUpdate:!1,onChange:function(r,e){e.container&&(e.container.style.width="".concat(r,"px"))}},height:{default:window.innerHeight,triggerUpdate:!1,onChange:function(r,e){e.container&&(e.container.style.height="".concat(r,"px"))}},jsonUrl:{},graphData:{default:{nodes:[],links:[]}},numDimensions:{default:3},dagMode:{},dagLevelDistance:{},dagNodeFilter:{default:function(){return!0}},onDagError:{default:void 0},backgroundColor:{default:"#002"},showNavInfo:{default:!0},nodeRelSize:{default:4},nodeId:{default:"id"},nodeLabel:{default:"name"},nodeDesc:{default:"desc"},onNodeHover:{},onNodeClick:{},nodeVal:{default:"val"},nodeResolution:{default:8},nodeVisibility:{default:!0},nodeColor:{default:"color"},nodeAutoColorBy:{},nodeOpacity:{default:.75},nodeThreeObject:{},nodeThreeObjectExtend:{default:!1},linkSource:{default:"source"},linkTarget:{default:"target"},linkLabel:{default:"name"},linkDesc:{default:"desc"},onLinkHover:{},onLinkClick:{},linkVisibility:{default:!0},linkColor:{default:"color"},linkAutoColorBy:{},linkOpacity:{default:.2},linkWidth:{default:0},linkResolution:{default:6},linkCurvature:{default:0},linkCurveRotation:{default:0},linkMaterial:{},linkThreeObject:{},linkThreeObjectExtend:{default:!1},linkPositionUpdate:{},linkDirectionalArrowLength:{default:0},linkDirectionalArrowColor:{},linkDirectionalArrowRelPos:{default:.5},linkDirectionalArrowResolution:{default:8},linkDirectionalParticles:{default:0},linkDirectionalParticleSpeed:{default:.01},linkDirectionalParticleWidth:{default:.5},linkDirectionalParticleColor:{},linkDirectionalParticleResolution:{default:4},forceEngine:{default:"d3"},d3AlphaMin:{default:0},d3AlphaDecay:{default:.0228},d3VelocityDecay:{default:.4},ngraphPhysics:{},warmupTicks:{default:0},cooldownTicks:{},cooldownTime:{default:15e3},onEngineTick:{},onEngineStop:{}},methods:L5(L5({},Object.assign.apply(Object,[{}].concat(e1(["getGraphBbox","emitParticle","d3Force","d3ReheatSimulation","refresh"].map(function(r){return WA({},r,function(e){for(var i=e.forcegraph.components.forcegraph,n=arguments.length,s=new Array(n>1?n-1:0),o=1;o<n;o++)s[o-1]=arguments[o];var l=i[r].apply(i,s);return l===i?this:l})}))))),{},{_destructor:function(){this.graphData({nodes:[],links:[]})}}),init:function(r,e){r.innerHTML="",e.container=document.createElement("div"),r.appendChild(e.container),e.container.style.position="relative",e.container.style.width="".concat(e.width,"px"),e.container.style.height="".concat(e.height,"px"),e.container.appendChild(e.navInfo=document.createElement("div")),e.navInfo.className="graph-nav-info",e.navInfo.textContent="Mouse drag: look, gamepad/arrow/wasd keys: move";var i=document.createElement("a-scene");i.setAttribute("embedded",""),i.appendChild(e.sky=document.createElement("a-sky")),e.sky.setAttribute("radius",3e3);var n;i.appendChild(n=document.createElement("a-entity")),n.setAttribute("position","0 0 300"),n.setAttribute("movement-controls","controls: gamepad, touch; fly: true; speed: 7");var s;n.appendChild(s=document.createElement("a-entity")),s.setAttribute("camera",""),s.setAttribute("position","0 0 0"),s.setAttribute("look-controls","pointerLockEnabled: false"),s.setAttribute("wasd-controls","fly: true; acceleration: 700");var o;s.appendChild(o=document.createElement("a-text")),o.setAttribute("position","0 -0.3 -1"),o.setAttribute("width",2),o.setAttribute("align","center"),o.setAttribute("color","lavender"),o.setAttribute("value","");var l;s.appendChild(l=document.createElement("a-text")),l.setAttribute("position","0 -0.4 -1"),l.setAttribute("width",1.3),l.setAttribute("align","center"),l.setAttribute("color","lavender"),l.setAttribute("value",""),e.raycasterEls=[];var u;i.appendChild(u=document.createElement("a-entity")),u.setAttribute("cursor","rayOrigin: mouse; mouseCursorStylesEnabled: true"),u.setAttribute("raycaster","objects: [forcegraph]; interval: 100"),e.raycasterEls.push(u),["left","right"].forEach(function(c){var h;n.appendChild(h=document.createElement("a-entity")),h.setAttribute("laser-controls","hand: ".concat(c,"; model: false;")),h.setAttribute("raycaster","objects: [forcegraph]; interval: 100; lineColor: steelblue; lineOpacity: 0.85"),e.raycasterEls.push(h)}),i.appendChild(e.forcegraph=document.createElement("a-entity")),e.forcegraph.setAttribute("forcegraph",null),e.container.appendChild(i),e.forcegraph.setAttribute("forcegraph",Object.assign.apply(Object,e1(["node","link"].map(function(c){var h={node:"Node",link:"Link"}[c];return WA({},"on".concat(h,"Hover"),function(p,f){var g=p&&mr(e["".concat(c,"Label")])(p)||"",m=p&&mr(e["".concat(c,"Desc")])(p)||"";o.setAttribute("value",g),l.setAttribute("value",m),e["on".concat(h,"Hover")]&&e["on".concat(h,"Hover")](p,f)})}))))},update:function(r,e){if(e.hasOwnProperty("backgroundColor")){var i=Mp(r.backgroundColor).alpha;i===void 0&&(i=1),r.sky.setAttribute("color",I5(1,r.backgroundColor)),r.sky.setAttribute("opacity",i)}e.hasOwnProperty("showNavInfo")&&(r.navInfo.style.display=r.showNavInfo?null:"none");var n=["onNodeHover","onLinkHover","onNodeClick","onLinkClick"].some(function(l){return r[l]})||["nodeLabel","linkLabel"].some(function(l){return r[l]!=="name"})||["nodeDesc","linkDesc"].some(function(l){return r[l]!=="desc"});r.raycasterEls.forEach(function(l){return l.setAttribute("raycaster",n?"objects: [forcegraph]; interval: 100":"objects: __none__")});var s=["jsonUrl","numDimensions","dagMode","dagLevelDistance","dagNodeFilter","onDagError","nodeRelSize","nodeId","onNodeClick","nodeVal","nodeResolution","nodeVisibility","nodeColor","nodeAutoColorBy","nodeOpacity","nodeThreeObject","nodeThreeObjectExtend","linkSource","linkTarget","onLinkClick","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","forceEngine","d3AlphaMin","d3AlphaDecay","d3VelocityDecay","ngraphPhysics","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"],o=Object.assign.apply(Object,[{}].concat(e1(Object.entries(r).filter(function(l){var u=YT(l,2),c=u[0],h=u[1];return e.hasOwnProperty(c)&&s.indexOf(c)!==-1&&h!==void 0&&h!==null}).map(function(l){var u=YT(l,2),c=u[0],h=u[1];return WA({},c,h)})),e1(Object.entries(r.graphData).map(function(l){var u=YT(l,2),c=u[0],h=u[1];return WA({},c,h)}))));r.forcegraph.setAttribute("forcegraph",o)}});class Qm extends Error{constructor(e,i){const n=`${Qm.extractMessage(e)}: ${JSON.stringify({response:e,request:i})}`;super(n),z0(this,"response"),z0(this,"request"),Object.setPrototypeOf(this,Qm.prototype),this.response=e,this.request=i,typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Qm)}static extractMessage(e){var i,n;return((n=(i=e.errors)==null?void 0:i[0])==null?void 0:n.message)??`GraphQL Error (Code: ${String(e.status)})`}}const P5=r=>r.toUpperCase(),KT=r=>typeof r=="function"?r():r,O5=(r,e)=>r.map((i,n)=>[i,e[n]]),qm=r=>{let e={};return r instanceof Headers?e=Uoe(r):Array.isArray(r)?r.forEach(([i,n])=>{i&&n!==void 0&&(e[i]=n)}):r&&(e=r),e},Uoe=r=>{const e={};return r.forEach((i,n)=>{e[n]=i}),e},zoe=r=>{try{const e=r();return joe(e)?e.catch(i=>k5(i)):e}catch(e){return k5(e)}},k5=r=>r instanceof Error?r:new Error(String(r)),joe=r=>typeof r=="object"&&r!==null&&"then"in r&&typeof r.then=="function"&&"catch"in r&&typeof r.catch=="function"&&"finally"in r&&typeof r.finally=="function",JT=r=>{throw new Error(`Unhandled case: ${String(r)}`)},t1=r=>typeof r=="object"&&r!==null&&!Array.isArray(r),Voe=(r,e)=>r.documents?r:{documents:r,requestHeaders:e,signal:void 0},Goe=(r,e,i)=>r.query?r:{query:r,variables:e,requestHeaders:i,signal:void 0};function i1(r,e){throw new Error(e)}function Hoe(r){return typeof r=="object"&&r!==null}function Woe(r,e){throw new Error("Unexpected invariant triggered.")}const Qoe=/\r\n|[\n\r]/g;function ZT(r,e){let i=0,n=1;for(const s of r.body.matchAll(Qoe)){if(typeof s.index=="number"||Woe(),s.index>=e)break;i=s.index+s[0].length,n+=1}return{line:n,column:e+1-i}}function qoe(r){return F5(r.source,ZT(r.source,r.start))}function F5(r,e){const i=r.locationOffset.column-1,n="".padStart(i)+r.body,s=e.line-1,o=r.locationOffset.line-1,l=e.line+o,u=e.line===1?i:0,c=e.column+u,h=`${r.name}:${l}:${c}
`,p=n.split(/\r\n|[\n\r]/g),f=p[s];if(f.length>120){const g=Math.floor(c/80),m=c%80,y=[];for(let b=0;b<f.length;b+=80)y.push(f.slice(b,b+80));return h+U5([[`${l} |`,y[0]],...y.slice(1,g+1).map(b=>["|",b]),["|","^".padStart(m)],["|",y[g+1]]])}return h+U5([[`${l-1} |`,p[s-1]],[`${l} |`,f],["|","^".padStart(c)],[`${l+1} |`,p[s+1]]])}function U5(r){const e=r.filter(([n,s])=>s!==void 0),i=Math.max(...e.map(([n])=>n.length));return e.map(([n,s])=>n.padStart(i)+(s?" "+s:"")).join(`
`)}function Xoe(r){const e=r[0];return e==null||"kind"in e||"length"in e?{nodes:e,source:r[1],positions:r[2],path:r[3],originalError:r[4],extensions:r[5]}:e}class $T extends Error{constructor(e,...i){var n,s,o;const{nodes:l,source:u,positions:c,path:h,originalError:p,extensions:f}=Xoe(i);super(e),this.name="GraphQLError",this.path=h??void 0,this.originalError=p??void 0,this.nodes=z5(Array.isArray(l)?l:l?[l]:void 0);const g=z5((n=this.nodes)===null||n===void 0?void 0:n.map(y=>y.loc).filter(y=>y!=null));this.source=u??(g==null||(s=g[0])===null||s===void 0?void 0:s.source),this.positions=c??(g==null?void 0:g.map(y=>y.start)),this.locations=c&&u?c.map(y=>ZT(u,y)):g==null?void 0:g.map(y=>ZT(y.source,y.start));const m=Hoe(p==null?void 0:p.extensions)?p==null?void 0:p.extensions:void 0;this.extensions=(o=f??m)!==null&&o!==void 0?o:Object.create(null),Object.defineProperties(this,{message:{writable:!0,enumerable:!0},name:{enumerable:!1},nodes:{enumerable:!1},source:{enumerable:!1},positions:{enumerable:!1},originalError:{enumerable:!1}}),p!=null&&p.stack?Object.defineProperty(this,"stack",{value:p.stack,writable:!0,configurable:!0}):Error.captureStackTrace?Error.captureStackTrace(this,$T):Object.defineProperty(this,"stack",{value:Error().stack,writable:!0,configurable:!0})}get[Symbol.toStringTag](){return"GraphQLError"}toString(){let e=this.message;if(this.nodes)for(const i of this.nodes)i.loc&&(e+=`

`+qoe(i.loc));else if(this.source&&this.locations)for(const i of this.locations)e+=`

`+F5(this.source,i);return e}toJSON(){const e={message:this.message};return this.locations!=null&&(e.locations=this.locations),this.path!=null&&(e.path=this.path),this.extensions!=null&&Object.keys(this.extensions).length>0&&(e.extensions=this.extensions),e}}function z5(r){return r===void 0||r.length===0?void 0:r}function Ma(r,e,i){return new $T(`Syntax Error: ${i}`,{source:r,positions:[e]})}class Yoe{constructor(e,i,n){this.start=e.start,this.end=i.end,this.startToken=e,this.endToken=i,this.source=n}get[Symbol.toStringTag](){return"Location"}toJSON(){return{start:this.start,end:this.end}}}class j5{constructor(e,i,n,s,o,l){this.kind=e,this.start=i,this.end=n,this.line=s,this.column=o,this.value=l,this.prev=null,this.next=null}get[Symbol.toStringTag](){return"Token"}toJSON(){return{kind:this.kind,value:this.value,line:this.line,column:this.column}}}const V5={Name:[],Document:["definitions"],OperationDefinition:["name","variableDefinitions","directives","selectionSet"],VariableDefinition:["variable","type","defaultValue","directives"],Variable:["name"],SelectionSet:["selections"],Field:["alias","name","arguments","directives","selectionSet"],Argument:["name","value"],FragmentSpread:["name","directives"],InlineFragment:["typeCondition","directives","selectionSet"],FragmentDefinition:["name","variableDefinitions","typeCondition","directives","selectionSet"],IntValue:[],FloatValue:[],StringValue:[],BooleanValue:[],NullValue:[],EnumValue:[],ListValue:["values"],ObjectValue:["fields"],ObjectField:["name","value"],Directive:["name","arguments"],NamedType:["name"],ListType:["type"],NonNullType:["type"],SchemaDefinition:["description","directives","operationTypes"],OperationTypeDefinition:["type"],ScalarTypeDefinition:["description","name","directives"],ObjectTypeDefinition:["description","name","interfaces","directives","fields"],FieldDefinition:["description","name","arguments","type","directives"],InputValueDefinition:["description","name","type","defaultValue","directives"],InterfaceTypeDefinition:["description","name","interfaces","directives","fields"],UnionTypeDefinition:["description","name","directives","types"],EnumTypeDefinition:["description","name","directives","values"],EnumValueDefinition:["description","name","directives"],InputObjectTypeDefinition:["description","name","directives","fields"],DirectiveDefinition:["description","name","arguments","locations"],SchemaExtension:["directives","operationTypes"],ScalarTypeExtension:["name","directives"],ObjectTypeExtension:["name","interfaces","directives","fields"],InterfaceTypeExtension:["name","interfaces","directives","fields"],UnionTypeExtension:["name","directives","types"],EnumTypeExtension:["name","directives","values"],InputObjectTypeExtension:["name","directives","fields"]},Koe=new Set(Object.keys(V5));function G5(r){const e=r==null?void 0:r.kind;return typeof e=="string"&&Koe.has(e)}var Ip;(function(r){r.QUERY="query",r.MUTATION="mutation",r.SUBSCRIPTION="subscription"})(Ip||(Ip={}));var eM;(function(r){r.QUERY="QUERY",r.MUTATION="MUTATION",r.SUBSCRIPTION="SUBSCRIPTION",r.FIELD="FIELD",r.FRAGMENT_DEFINITION="FRAGMENT_DEFINITION",r.FRAGMENT_SPREAD="FRAGMENT_SPREAD",r.INLINE_FRAGMENT="INLINE_FRAGMENT",r.VARIABLE_DEFINITION="VARIABLE_DEFINITION",r.SCHEMA="SCHEMA",r.SCALAR="SCALAR",r.OBJECT="OBJECT",r.FIELD_DEFINITION="FIELD_DEFINITION",r.ARGUMENT_DEFINITION="ARGUMENT_DEFINITION",r.INTERFACE="INTERFACE",r.UNION="UNION",r.ENUM="ENUM",r.ENUM_VALUE="ENUM_VALUE",r.INPUT_OBJECT="INPUT_OBJECT",r.INPUT_FIELD_DEFINITION="INPUT_FIELD_DEFINITION"})(eM||(eM={}));var Or;(function(r){r.NAME="Name",r.DOCUMENT="Document",r.OPERATION_DEFINITION="OperationDefinition",r.VARIABLE_DEFINITION="VariableDefinition",r.SELECTION_SET="SelectionSet",r.FIELD="Field",r.ARGUMENT="Argument",r.FRAGMENT_SPREAD="FragmentSpread",r.INLINE_FRAGMENT="InlineFragment",r.FRAGMENT_DEFINITION="FragmentDefinition",r.VARIABLE="Variable",r.INT="IntValue",r.FLOAT="FloatValue",r.STRING="StringValue",r.BOOLEAN="BooleanValue",r.NULL="NullValue",r.ENUM="EnumValue",r.LIST="ListValue",r.OBJECT="ObjectValue",r.OBJECT_FIELD="ObjectField",r.DIRECTIVE="Directive",r.NAMED_TYPE="NamedType",r.LIST_TYPE="ListType",r.NON_NULL_TYPE="NonNullType",r.SCHEMA_DEFINITION="SchemaDefinition",r.OPERATION_TYPE_DEFINITION="OperationTypeDefinition",r.SCALAR_TYPE_DEFINITION="ScalarTypeDefinition",r.OBJECT_TYPE_DEFINITION="ObjectTypeDefinition",r.FIELD_DEFINITION="FieldDefinition",r.INPUT_VALUE_DEFINITION="InputValueDefinition",r.INTERFACE_TYPE_DEFINITION="InterfaceTypeDefinition",r.UNION_TYPE_DEFINITION="UnionTypeDefinition",r.ENUM_TYPE_DEFINITION="EnumTypeDefinition",r.ENUM_VALUE_DEFINITION="EnumValueDefinition",r.INPUT_OBJECT_TYPE_DEFINITION="InputObjectTypeDefinition",r.DIRECTIVE_DEFINITION="DirectiveDefinition",r.SCHEMA_EXTENSION="SchemaExtension",r.SCALAR_TYPE_EXTENSION="ScalarTypeExtension",r.OBJECT_TYPE_EXTENSION="ObjectTypeExtension",r.INTERFACE_TYPE_EXTENSION="InterfaceTypeExtension",r.UNION_TYPE_EXTENSION="UnionTypeExtension",r.ENUM_TYPE_EXTENSION="EnumTypeExtension",r.INPUT_OBJECT_TYPE_EXTENSION="InputObjectTypeExtension"})(Or||(Or={}));function tM(r){return r===9||r===32}function QA(r){return r>=48&&r<=57}function H5(r){return r>=97&&r<=122||r>=65&&r<=90}function W5(r){return H5(r)||r===95}function Joe(r){return H5(r)||QA(r)||r===95}function Zoe(r){var e;let i=Number.MAX_SAFE_INTEGER,n=null,s=-1;for(let l=0;l<r.length;++l){var o;const u=r[l],c=$oe(u);c!==u.length&&(n=(o=n)!==null&&o!==void 0?o:l,s=l,l!==0&&c<i&&(i=c))}return r.map((l,u)=>u===0?l:l.slice(i)).slice((e=n)!==null&&e!==void 0?e:0,s+1)}function $oe(r){let e=0;for(;e<r.length&&tM(r.charCodeAt(e));)++e;return e}function ele(r,e){const i=r.replace(/"""/g,'\\"""'),n=i.split(/\r\n|[\n\r]/g),s=n.length===1,o=n.length>1&&n.slice(1).every(m=>m.length===0||tM(m.charCodeAt(0))),l=i.endsWith('\\"""'),u=r.endsWith('"')&&!l,c=r.endsWith("\\"),h=u||c,p=!s||r.length>70||h||o||l;let f="";const g=s&&tM(r.charCodeAt(0));return(p&&!g||o)&&(f+=`
`),f+=i,(p||h)&&(f+=`
`),'"""'+f+'"""'}var si;(function(r){r.SOF="<SOF>",r.EOF="<EOF>",r.BANG="!",r.DOLLAR="$",r.AMP="&",r.PAREN_L="(",r.PAREN_R=")",r.SPREAD="...",r.COLON=":",r.EQUALS="=",r.AT="@",r.BRACKET_L="[",r.BRACKET_R="]",r.BRACE_L="{",r.PIPE="|",r.BRACE_R="}",r.NAME="Name",r.INT="Int",r.FLOAT="Float",r.STRING="String",r.BLOCK_STRING="BlockString",r.COMMENT="Comment"})(si||(si={}));class tle{constructor(e){const i=new j5(si.SOF,0,0,0,0);this.source=e,this.lastToken=i,this.token=i,this.line=1,this.lineStart=0}get[Symbol.toStringTag](){return"Lexer"}advance(){return this.lastToken=this.token,this.token=this.lookahead()}lookahead(){let e=this.token;if(e.kind!==si.EOF)do if(e.next)e=e.next;else{const i=rle(this,e.end);e.next=i,i.prev=e,e=i}while(e.kind===si.COMMENT);return e}}function ile(r){return r===si.BANG||r===si.DOLLAR||r===si.AMP||r===si.PAREN_L||r===si.PAREN_R||r===si.SPREAD||r===si.COLON||r===si.EQUALS||r===si.AT||r===si.BRACKET_L||r===si.BRACKET_R||r===si.BRACE_L||r===si.PIPE||r===si.BRACE_R}function Xm(r){return r>=0&&r<=55295||r>=57344&&r<=1114111}function r1(r,e){return Q5(r.charCodeAt(e))&&q5(r.charCodeAt(e+1))}function Q5(r){return r>=55296&&r<=56319}function q5(r){return r>=56320&&r<=57343}function Bp(r,e){const i=r.source.body.codePointAt(e);if(i===void 0)return si.EOF;if(i>=32&&i<=126){const n=String.fromCodePoint(i);return n==='"'?`'"'`:`"${n}"`}return"U+"+i.toString(16).toUpperCase().padStart(4,"0")}function ea(r,e,i,n,s){const o=r.line,l=1+i-r.lineStart;return new j5(e,i,n,o,l,s)}function rle(r,e){const i=r.source.body,n=i.length;let s=e;for(;s<n;){const o=i.charCodeAt(s);switch(o){case 65279:case 9:case 32:case 44:++s;continue;case 10:++s,++r.line,r.lineStart=s;continue;case 13:i.charCodeAt(s+1)===10?s+=2:++s,++r.line,r.lineStart=s;continue;case 35:return nle(r,s);case 33:return ea(r,si.BANG,s,s+1);case 36:return ea(r,si.DOLLAR,s,s+1);case 38:return ea(r,si.AMP,s,s+1);case 40:return ea(r,si.PAREN_L,s,s+1);case 41:return ea(r,si.PAREN_R,s,s+1);case 46:if(i.charCodeAt(s+1)===46&&i.charCodeAt(s+2)===46)return ea(r,si.SPREAD,s,s+3);break;case 58:return ea(r,si.COLON,s,s+1);case 61:return ea(r,si.EQUALS,s,s+1);case 64:return ea(r,si.AT,s,s+1);case 91:return ea(r,si.BRACKET_L,s,s+1);case 93:return ea(r,si.BRACKET_R,s,s+1);case 123:return ea(r,si.BRACE_L,s,s+1);case 124:return ea(r,si.PIPE,s,s+1);case 125:return ea(r,si.BRACE_R,s,s+1);case 34:return i.charCodeAt(s+1)===34&&i.charCodeAt(s+2)===34?ule(r,s):ale(r,s)}if(QA(o)||o===45)return sle(r,s,o);if(W5(o))return hle(r,s);throw Ma(r.source,s,o===39?`Unexpected single quote character ('), did you mean to use a double quote (")?`:Xm(o)||r1(i,s)?`Unexpected character: ${Bp(r,s)}.`:`Invalid character: ${Bp(r,s)}.`)}return ea(r,si.EOF,n,n)}function nle(r,e){const i=r.source.body,n=i.length;let s=e+1;for(;s<n;){const o=i.charCodeAt(s);if(o===10||o===13)break;if(Xm(o))++s;else if(r1(i,s))s+=2;else break}return ea(r,si.COMMENT,e,s,i.slice(e+1,s))}function sle(r,e,i){const n=r.source.body;let s=e,o=i,l=!1;if(o===45&&(o=n.charCodeAt(++s)),o===48){if(o=n.charCodeAt(++s),QA(o))throw Ma(r.source,s,`Invalid number, unexpected digit after 0: ${Bp(r,s)}.`)}else s=iM(r,s,o),o=n.charCodeAt(s);if(o===46&&(l=!0,o=n.charCodeAt(++s),s=iM(r,s,o),o=n.charCodeAt(s)),(o===69||o===101)&&(l=!0,o=n.charCodeAt(++s),(o===43||o===45)&&(o=n.charCodeAt(++s)),s=iM(r,s,o),o=n.charCodeAt(s)),o===46||W5(o))throw Ma(r.source,s,`Invalid number, expected digit but got: ${Bp(r,s)}.`);return ea(r,l?si.FLOAT:si.INT,e,s,n.slice(e,s))}function iM(r,e,i){if(!QA(i))throw Ma(r.source,e,`Invalid number, expected digit but got: ${Bp(r,e)}.`);const n=r.source.body;let s=e+1;for(;QA(n.charCodeAt(s));)++s;return s}function ale(r,e){const i=r.source.body,n=i.length;let s=e+1,o=s,l="";for(;s<n;){const u=i.charCodeAt(s);if(u===34)return l+=i.slice(o,s),ea(r,si.STRING,e,s+1,l);if(u===92){l+=i.slice(o,s);const c=i.charCodeAt(s+1)===117?i.charCodeAt(s+2)===123?ole(r,s):lle(r,s):cle(r,s);l+=c.value,s+=c.size,o=s;continue}if(u===10||u===13)break;if(Xm(u))++s;else if(r1(i,s))s+=2;else throw Ma(r.source,s,`Invalid character within String: ${Bp(r,s)}.`)}throw Ma(r.source,s,"Unterminated string.")}function ole(r,e){const i=r.source.body;let n=0,s=3;for(;s<12;){const o=i.charCodeAt(e+s++);if(o===125){if(s<5||!Xm(n))break;return{value:String.fromCodePoint(n),size:s}}if(n=n<<4|qA(o),n<0)break}throw Ma(r.source,e,`Invalid Unicode escape sequence: "${i.slice(e,e+s)}".`)}function lle(r,e){const i=r.source.body,n=X5(i,e+2);if(Xm(n))return{value:String.fromCodePoint(n),size:6};if(Q5(n)&&i.charCodeAt(e+6)===92&&i.charCodeAt(e+7)===117){const s=X5(i,e+8);if(q5(s))return{value:String.fromCodePoint(n,s),size:12}}throw Ma(r.source,e,`Invalid Unicode escape sequence: "${i.slice(e,e+6)}".`)}function X5(r,e){return qA(r.charCodeAt(e))<<12|qA(r.charCodeAt(e+1))<<8|qA(r.charCodeAt(e+2))<<4|qA(r.charCodeAt(e+3))}function qA(r){return r>=48&&r<=57?r-48:r>=65&&r<=70?r-55:r>=97&&r<=102?r-87:-1}function cle(r,e){const i=r.source.body;switch(i.charCodeAt(e+1)){case 34:return{value:'"',size:2};case 92:return{value:"\\",size:2};case 47:return{value:"/",size:2};case 98:return{value:"\b",size:2};case 102:return{value:"\f",size:2};case 110:return{value:`
`,size:2};case 114:return{value:"\r",size:2};case 116:return{value:"	",size:2}}throw Ma(r.source,e,`Invalid character escape sequence: "${i.slice(e,e+2)}".`)}function ule(r,e){const i=r.source.body,n=i.length;let s=r.lineStart,o=e+3,l=o,u="";const c=[];for(;o<n;){const h=i.charCodeAt(o);if(h===34&&i.charCodeAt(o+1)===34&&i.charCodeAt(o+2)===34){u+=i.slice(l,o),c.push(u);const p=ea(r,si.BLOCK_STRING,e,o+3,Zoe(c).join(`
`));return r.line+=c.length-1,r.lineStart=s,p}if(h===92&&i.charCodeAt(o+1)===34&&i.charCodeAt(o+2)===34&&i.charCodeAt(o+3)===34){u+=i.slice(l,o),l=o+1,o+=4;continue}if(h===10||h===13){u+=i.slice(l,o),c.push(u),h===13&&i.charCodeAt(o+1)===10?o+=2:++o,u="",l=o,s=o;continue}if(Xm(h))++o;else if(r1(i,o))o+=2;else throw Ma(r.source,o,`Invalid character within String: ${Bp(r,o)}.`)}throw Ma(r.source,o,"Unterminated string.")}function hle(r,e){const i=r.source.body,n=i.length;let s=e+1;for(;s<n;){const o=i.charCodeAt(s);if(Joe(o))++s;else break}return ea(r,si.NAME,e,s,i.slice(e,s))}const dle=10,Y5=2;function rM(r){return n1(r,[])}function n1(r,e){switch(typeof r){case"string":return JSON.stringify(r);case"function":return r.name?`[function ${r.name}]`:"[function]";case"object":return ple(r,e);default:return String(r)}}function ple(r,e){if(r===null)return"null";if(e.includes(r))return"[Circular]";const i=[...e,r];if(fle(r)){const n=r.toJSON();if(n!==r)return typeof n=="string"?n:n1(n,i)}else if(Array.isArray(r))return gle(r,i);return mle(r,i)}function fle(r){return typeof r.toJSON=="function"}function mle(r,e){const i=Object.entries(r);return i.length===0?"{}":e.length>Y5?"["+Ale(r)+"]":"{ "+i.map(([n,s])=>n+": "+n1(s,e)).join(", ")+" }"}function gle(r,e){if(r.length===0)return"[]";if(e.length>Y5)return"[Array]";const i=Math.min(dle,r.length),n=r.length-i,s=[];for(let o=0;o<i;++o)s.push(n1(r[o],e));return n===1?s.push("... 1 more item"):n>1&&s.push(`... ${n} more items`),"["+s.join(", ")+"]"}function Ale(r){const e=Object.prototype.toString.call(r).replace(/^\[object /,"").replace(/]$/,"");if(e==="Object"&&typeof r.constructor=="function"){const i=r.constructor.name;if(typeof i=="string"&&i!=="")return i}return e}const yle=globalThis.process&&process.env.NODE_ENV==="production",vle=yle?function(r,e){return r instanceof e}:function(r,e){if(r instanceof e)return!0;if(typeof r=="object"&&r!==null){var i;const n=e.prototype[Symbol.toStringTag],s=Symbol.toStringTag in r?r[Symbol.toStringTag]:(i=r.constructor)===null||i===void 0?void 0:i.name;if(n===s){const o=rM(r);throw new Error(`Cannot use ${n} "${o}" from another module or realm.

Ensure that there is only one instance of "graphql" in the node_modules
directory. If different versions of "graphql" are the dependencies of other
relied on modules, use "resolutions" to ensure only one version is installed.

https://yarnpkg.com/en/docs/selective-version-resolutions

Duplicate "graphql" modules cannot be used at the same time since different
versions may have different capabilities and behavior. The data from one
version used in the function from another could produce confusing and
spurious results.`)}}return!1};let K5=class{constructor(r,e="GraphQL request",i={line:1,column:1}){typeof r=="string"||i1(!1,`Body must be a string. Received: ${rM(r)}.`),this.body=r,this.name=e,this.locationOffset=i,this.locationOffset.line>0||i1(!1,"line in locationOffset is 1-indexed and must be positive."),this.locationOffset.column>0||i1(!1,"column in locationOffset is 1-indexed and must be positive.")}get[Symbol.toStringTag](){return"Source"}};function ble(r){return vle(r,K5)}function xle(r,e){return new _le(r,e).parseDocument()}class _le{constructor(e,i={}){const n=ble(e)?e:new K5(e);this._lexer=new tle(n),this._options=i,this._tokenCounter=0}parseName(){const e=this.expectToken(si.NAME);return this.node(e,{kind:Or.NAME,value:e.value})}parseDocument(){return this.node(this._lexer.token,{kind:Or.DOCUMENT,definitions:this.many(si.SOF,this.parseDefinition,si.EOF)})}parseDefinition(){if(this.peek(si.BRACE_L))return this.parseOperationDefinition();const e=this.peekDescription(),i=e?this._lexer.lookahead():this._lexer.token;if(i.kind===si.NAME){switch(i.value){case"schema":return this.parseSchemaDefinition();case"scalar":return this.parseScalarTypeDefinition();case"type":return this.parseObjectTypeDefinition();case"interface":return this.parseInterfaceTypeDefinition();case"union":return this.parseUnionTypeDefinition();case"enum":return this.parseEnumTypeDefinition();case"input":return this.parseInputObjectTypeDefinition();case"directive":return this.parseDirectiveDefinition()}if(e)throw Ma(this._lexer.source,this._lexer.token.start,"Unexpected description, descriptions are supported only on type definitions.");switch(i.value){case"query":case"mutation":case"subscription":return this.parseOperationDefinition();case"fragment":return this.parseFragmentDefinition();case"extend":return this.parseTypeSystemExtension()}}throw this.unexpected(i)}parseOperationDefinition(){const e=this._lexer.token;if(this.peek(si.BRACE_L))return this.node(e,{kind:Or.OPERATION_DEFINITION,operation:Ip.QUERY,name:void 0,variableDefinitions:[],directives:[],selectionSet:this.parseSelectionSet()});const i=this.parseOperationType();let n;return this.peek(si.NAME)&&(n=this.parseName()),this.node(e,{kind:Or.OPERATION_DEFINITION,operation:i,name:n,variableDefinitions:this.parseVariableDefinitions(),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()})}parseOperationType(){const e=this.expectToken(si.NAME);switch(e.value){case"query":return Ip.QUERY;case"mutation":return Ip.MUTATION;case"subscription":return Ip.SUBSCRIPTION}throw this.unexpected(e)}parseVariableDefinitions(){return this.optionalMany(si.PAREN_L,this.parseVariableDefinition,si.PAREN_R)}parseVariableDefinition(){return this.node(this._lexer.token,{kind:Or.VARIABLE_DEFINITION,variable:this.parseVariable(),type:(this.expectToken(si.COLON),this.parseTypeReference()),defaultValue:this.expectOptionalToken(si.EQUALS)?this.parseConstValueLiteral():void 0,directives:this.parseConstDirectives()})}parseVariable(){const e=this._lexer.token;return this.expectToken(si.DOLLAR),this.node(e,{kind:Or.VARIABLE,name:this.parseName()})}parseSelectionSet(){return this.node(this._lexer.token,{kind:Or.SELECTION_SET,selections:this.many(si.BRACE_L,this.parseSelection,si.BRACE_R)})}parseSelection(){return this.peek(si.SPREAD)?this.parseFragment():this.parseField()}parseField(){const e=this._lexer.token,i=this.parseName();let n,s;return this.expectOptionalToken(si.COLON)?(n=i,s=this.parseName()):s=i,this.node(e,{kind:Or.FIELD,alias:n,name:s,arguments:this.parseArguments(!1),directives:this.parseDirectives(!1),selectionSet:this.peek(si.BRACE_L)?this.parseSelectionSet():void 0})}parseArguments(e){const i=e?this.parseConstArgument:this.parseArgument;return this.optionalMany(si.PAREN_L,i,si.PAREN_R)}parseArgument(e=!1){const i=this._lexer.token,n=this.parseName();return this.expectToken(si.COLON),this.node(i,{kind:Or.ARGUMENT,name:n,value:this.parseValueLiteral(e)})}parseConstArgument(){return this.parseArgument(!0)}parseFragment(){const e=this._lexer.token;this.expectToken(si.SPREAD);const i=this.expectOptionalKeyword("on");return!i&&this.peek(si.NAME)?this.node(e,{kind:Or.FRAGMENT_SPREAD,name:this.parseFragmentName(),directives:this.parseDirectives(!1)}):this.node(e,{kind:Or.INLINE_FRAGMENT,typeCondition:i?this.parseNamedType():void 0,directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()})}parseFragmentDefinition(){const e=this._lexer.token;return this.expectKeyword("fragment"),this._options.allowLegacyFragmentVariables===!0?this.node(e,{kind:Or.FRAGMENT_DEFINITION,name:this.parseFragmentName(),variableDefinitions:this.parseVariableDefinitions(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()}):this.node(e,{kind:Or.FRAGMENT_DEFINITION,name:this.parseFragmentName(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()})}parseFragmentName(){if(this._lexer.token.value==="on")throw this.unexpected();return this.parseName()}parseValueLiteral(e){const i=this._lexer.token;switch(i.kind){case si.BRACKET_L:return this.parseList(e);case si.BRACE_L:return this.parseObject(e);case si.INT:return this.advanceLexer(),this.node(i,{kind:Or.INT,value:i.value});case si.FLOAT:return this.advanceLexer(),this.node(i,{kind:Or.FLOAT,value:i.value});case si.STRING:case si.BLOCK_STRING:return this.parseStringLiteral();case si.NAME:switch(this.advanceLexer(),i.value){case"true":return this.node(i,{kind:Or.BOOLEAN,value:!0});case"false":return this.node(i,{kind:Or.BOOLEAN,value:!1});case"null":return this.node(i,{kind:Or.NULL});default:return this.node(i,{kind:Or.ENUM,value:i.value})}case si.DOLLAR:if(e)if(this.expectToken(si.DOLLAR),this._lexer.token.kind===si.NAME){const n=this._lexer.token.value;throw Ma(this._lexer.source,i.start,`Unexpected variable "$${n}" in constant value.`)}else throw this.unexpected(i);return this.parseVariable();default:throw this.unexpected()}}parseConstValueLiteral(){return this.parseValueLiteral(!0)}parseStringLiteral(){const e=this._lexer.token;return this.advanceLexer(),this.node(e,{kind:Or.STRING,value:e.value,block:e.kind===si.BLOCK_STRING})}parseList(e){const i=()=>this.parseValueLiteral(e);return this.node(this._lexer.token,{kind:Or.LIST,values:this.any(si.BRACKET_L,i,si.BRACKET_R)})}parseObject(e){const i=()=>this.parseObjectField(e);return this.node(this._lexer.token,{kind:Or.OBJECT,fields:this.any(si.BRACE_L,i,si.BRACE_R)})}parseObjectField(e){const i=this._lexer.token,n=this.parseName();return this.expectToken(si.COLON),this.node(i,{kind:Or.OBJECT_FIELD,name:n,value:this.parseValueLiteral(e)})}parseDirectives(e){const i=[];for(;this.peek(si.AT);)i.push(this.parseDirective(e));return i}parseConstDirectives(){return this.parseDirectives(!0)}parseDirective(e){const i=this._lexer.token;return this.expectToken(si.AT),this.node(i,{kind:Or.DIRECTIVE,name:this.parseName(),arguments:this.parseArguments(e)})}parseTypeReference(){const e=this._lexer.token;let i;if(this.expectOptionalToken(si.BRACKET_L)){const n=this.parseTypeReference();this.expectToken(si.BRACKET_R),i=this.node(e,{kind:Or.LIST_TYPE,type:n})}else i=this.parseNamedType();return this.expectOptionalToken(si.BANG)?this.node(e,{kind:Or.NON_NULL_TYPE,type:i}):i}parseNamedType(){return this.node(this._lexer.token,{kind:Or.NAMED_TYPE,name:this.parseName()})}peekDescription(){return this.peek(si.STRING)||this.peek(si.BLOCK_STRING)}parseDescription(){if(this.peekDescription())return this.parseStringLiteral()}parseSchemaDefinition(){const e=this._lexer.token,i=this.parseDescription();this.expectKeyword("schema");const n=this.parseConstDirectives(),s=this.many(si.BRACE_L,this.parseOperationTypeDefinition,si.BRACE_R);return this.node(e,{kind:Or.SCHEMA_DEFINITION,description:i,directives:n,operationTypes:s})}parseOperationTypeDefinition(){const e=this._lexer.token,i=this.parseOperationType();this.expectToken(si.COLON);const n=this.parseNamedType();return this.node(e,{kind:Or.OPERATION_TYPE_DEFINITION,operation:i,type:n})}parseScalarTypeDefinition(){const e=this._lexer.token,i=this.parseDescription();this.expectKeyword("scalar");const n=this.parseName(),s=this.parseConstDirectives();return this.node(e,{kind:Or.SCALAR_TYPE_DEFINITION,description:i,name:n,directives:s})}parseObjectTypeDefinition(){const e=this._lexer.token,i=this.parseDescription();this.expectKeyword("type");const n=this.parseName(),s=this.parseImplementsInterfaces(),o=this.parseConstDirectives(),l=this.parseFieldsDefinition();return this.node(e,{kind:Or.OBJECT_TYPE_DEFINITION,description:i,name:n,interfaces:s,directives:o,fields:l})}parseImplementsInterfaces(){return this.expectOptionalKeyword("implements")?this.delimitedMany(si.AMP,this.parseNamedType):[]}parseFieldsDefinition(){return this.optionalMany(si.BRACE_L,this.parseFieldDefinition,si.BRACE_R)}parseFieldDefinition(){const e=this._lexer.token,i=this.parseDescription(),n=this.parseName(),s=this.parseArgumentDefs();this.expectToken(si.COLON);const o=this.parseTypeReference(),l=this.parseConstDirectives();return this.node(e,{kind:Or.FIELD_DEFINITION,description:i,name:n,arguments:s,type:o,directives:l})}parseArgumentDefs(){return this.optionalMany(si.PAREN_L,this.parseInputValueDef,si.PAREN_R)}parseInputValueDef(){const e=this._lexer.token,i=this.parseDescription(),n=this.parseName();this.expectToken(si.COLON);const s=this.parseTypeReference();let o;this.expectOptionalToken(si.EQUALS)&&(o=this.parseConstValueLiteral());const l=this.parseConstDirectives();return this.node(e,{kind:Or.INPUT_VALUE_DEFINITION,description:i,name:n,type:s,defaultValue:o,directives:l})}parseInterfaceTypeDefinition(){const e=this._lexer.token,i=this.parseDescription();this.expectKeyword("interface");const n=this.parseName(),s=this.parseImplementsInterfaces(),o=this.parseConstDirectives(),l=this.parseFieldsDefinition();return this.node(e,{kind:Or.INTERFACE_TYPE_DEFINITION,description:i,name:n,interfaces:s,directives:o,fields:l})}parseUnionTypeDefinition(){const e=this._lexer.token,i=this.parseDescription();this.expectKeyword("union");const n=this.parseName(),s=this.parseConstDirectives(),o=this.parseUnionMemberTypes();return this.node(e,{kind:Or.UNION_TYPE_DEFINITION,description:i,name:n,directives:s,types:o})}parseUnionMemberTypes(){return this.expectOptionalToken(si.EQUALS)?this.delimitedMany(si.PIPE,this.parseNamedType):[]}parseEnumTypeDefinition(){const e=this._lexer.token,i=this.parseDescription();this.expectKeyword("enum");const n=this.parseName(),s=this.parseConstDirectives(),o=this.parseEnumValuesDefinition();return this.node(e,{kind:Or.ENUM_TYPE_DEFINITION,description:i,name:n,directives:s,values:o})}parseEnumValuesDefinition(){return this.optionalMany(si.BRACE_L,this.parseEnumValueDefinition,si.BRACE_R)}parseEnumValueDefinition(){const e=this._lexer.token,i=this.parseDescription(),n=this.parseEnumValueName(),s=this.parseConstDirectives();return this.node(e,{kind:Or.ENUM_VALUE_DEFINITION,description:i,name:n,directives:s})}parseEnumValueName(){if(this._lexer.token.value==="true"||this._lexer.token.value==="false"||this._lexer.token.value==="null")throw Ma(this._lexer.source,this._lexer.token.start,`${s1(this._lexer.token)} is reserved and cannot be used for an enum value.`);return this.parseName()}parseInputObjectTypeDefinition(){const e=this._lexer.token,i=this.parseDescription();this.expectKeyword("input");const n=this.parseName(),s=this.parseConstDirectives(),o=this.parseInputFieldsDefinition();return this.node(e,{kind:Or.INPUT_OBJECT_TYPE_DEFINITION,description:i,name:n,directives:s,fields:o})}parseInputFieldsDefinition(){return this.optionalMany(si.BRACE_L,this.parseInputValueDef,si.BRACE_R)}parseTypeSystemExtension(){const e=this._lexer.lookahead();if(e.kind===si.NAME)switch(e.value){case"schema":return this.parseSchemaExtension();case"scalar":return this.parseScalarTypeExtension();case"type":return this.parseObjectTypeExtension();case"interface":return this.parseInterfaceTypeExtension();case"union":return this.parseUnionTypeExtension();case"enum":return this.parseEnumTypeExtension();case"input":return this.parseInputObjectTypeExtension()}throw this.unexpected(e)}parseSchemaExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("schema");const i=this.parseConstDirectives(),n=this.optionalMany(si.BRACE_L,this.parseOperationTypeDefinition,si.BRACE_R);if(i.length===0&&n.length===0)throw this.unexpected();return this.node(e,{kind:Or.SCHEMA_EXTENSION,directives:i,operationTypes:n})}parseScalarTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("scalar");const i=this.parseName(),n=this.parseConstDirectives();if(n.length===0)throw this.unexpected();return this.node(e,{kind:Or.SCALAR_TYPE_EXTENSION,name:i,directives:n})}parseObjectTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("type");const i=this.parseName(),n=this.parseImplementsInterfaces(),s=this.parseConstDirectives(),o=this.parseFieldsDefinition();if(n.length===0&&s.length===0&&o.length===0)throw this.unexpected();return this.node(e,{kind:Or.OBJECT_TYPE_EXTENSION,name:i,interfaces:n,directives:s,fields:o})}parseInterfaceTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("interface");const i=this.parseName(),n=this.parseImplementsInterfaces(),s=this.parseConstDirectives(),o=this.parseFieldsDefinition();if(n.length===0&&s.length===0&&o.length===0)throw this.unexpected();return this.node(e,{kind:Or.INTERFACE_TYPE_EXTENSION,name:i,interfaces:n,directives:s,fields:o})}parseUnionTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("union");const i=this.parseName(),n=this.parseConstDirectives(),s=this.parseUnionMemberTypes();if(n.length===0&&s.length===0)throw this.unexpected();return this.node(e,{kind:Or.UNION_TYPE_EXTENSION,name:i,directives:n,types:s})}parseEnumTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("enum");const i=this.parseName(),n=this.parseConstDirectives(),s=this.parseEnumValuesDefinition();if(n.length===0&&s.length===0)throw this.unexpected();return this.node(e,{kind:Or.ENUM_TYPE_EXTENSION,name:i,directives:n,values:s})}parseInputObjectTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("input");const i=this.parseName(),n=this.parseConstDirectives(),s=this.parseInputFieldsDefinition();if(n.length===0&&s.length===0)throw this.unexpected();return this.node(e,{kind:Or.INPUT_OBJECT_TYPE_EXTENSION,name:i,directives:n,fields:s})}parseDirectiveDefinition(){const e=this._lexer.token,i=this.parseDescription();this.expectKeyword("directive"),this.expectToken(si.AT);const n=this.parseName(),s=this.parseArgumentDefs(),o=this.expectOptionalKeyword("repeatable");this.expectKeyword("on");const l=this.parseDirectiveLocations();return this.node(e,{kind:Or.DIRECTIVE_DEFINITION,description:i,name:n,arguments:s,repeatable:o,locations:l})}parseDirectiveLocations(){return this.delimitedMany(si.PIPE,this.parseDirectiveLocation)}parseDirectiveLocation(){const e=this._lexer.token,i=this.parseName();if(Object.prototype.hasOwnProperty.call(eM,i.value))return i;throw this.unexpected(e)}node(e,i){return this._options.noLocation!==!0&&(i.loc=new Yoe(e,this._lexer.lastToken,this._lexer.source)),i}peek(e){return this._lexer.token.kind===e}expectToken(e){const i=this._lexer.token;if(i.kind===e)return this.advanceLexer(),i;throw Ma(this._lexer.source,i.start,`Expected ${J5(e)}, found ${s1(i)}.`)}expectOptionalToken(e){return this._lexer.token.kind===e?(this.advanceLexer(),!0):!1}expectKeyword(e){const i=this._lexer.token;if(i.kind===si.NAME&&i.value===e)this.advanceLexer();else throw Ma(this._lexer.source,i.start,`Expected "${e}", found ${s1(i)}.`)}expectOptionalKeyword(e){const i=this._lexer.token;return i.kind===si.NAME&&i.value===e?(this.advanceLexer(),!0):!1}unexpected(e){const i=e??this._lexer.token;return Ma(this._lexer.source,i.start,`Unexpected ${s1(i)}.`)}any(e,i,n){this.expectToken(e);const s=[];for(;!this.expectOptionalToken(n);)s.push(i.call(this));return s}optionalMany(e,i,n){if(this.expectOptionalToken(e)){const s=[];do s.push(i.call(this));while(!this.expectOptionalToken(n));return s}return[]}many(e,i,n){this.expectToken(e);const s=[];do s.push(i.call(this));while(!this.expectOptionalToken(n));return s}delimitedMany(e,i){this.expectOptionalToken(e);const n=[];do n.push(i.call(this));while(this.expectOptionalToken(e));return n}advanceLexer(){const{maxTokens:e}=this._options,i=this._lexer.advance();if(e!==void 0&&i.kind!==si.EOF&&(++this._tokenCounter,this._tokenCounter>e))throw Ma(this._lexer.source,i.start,`Document contains more that ${e} tokens. Parsing aborted.`)}}function s1(r){const e=r.value;return J5(r.kind)+(e!=null?` "${e}"`:"")}function J5(r){return ile(r)?`"${r}"`:r}function Ele(r){return`"${r.replace(wle,Cle)}"`}const wle=/[\x00-\x1f\x22\x5c\x7f-\x9f]/g;function Cle(r){return Sle[r.charCodeAt(0)]}const Sle=["\\u0000","\\u0001","\\u0002","\\u0003","\\u0004","\\u0005","\\u0006","\\u0007","\\b","\\t","\\n","\\u000B","\\f","\\r","\\u000E","\\u000F","\\u0010","\\u0011","\\u0012","\\u0013","\\u0014","\\u0015","\\u0016","\\u0017","\\u0018","\\u0019","\\u001A","\\u001B","\\u001C","\\u001D","\\u001E","\\u001F","","",'\\"',"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","\\\\","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","\\u007F","\\u0080","\\u0081","\\u0082","\\u0083","\\u0084","\\u0085","\\u0086","\\u0087","\\u0088","\\u0089","\\u008A","\\u008B","\\u008C","\\u008D","\\u008E","\\u008F","\\u0090","\\u0091","\\u0092","\\u0093","\\u0094","\\u0095","\\u0096","\\u0097","\\u0098","\\u0099","\\u009A","\\u009B","\\u009C","\\u009D","\\u009E","\\u009F"],Tle=Object.freeze({});function Mle(r,e,i=V5){const n=new Map;for(const _ of Object.values(Or))n.set(_,Rle(e,_));let s,o=Array.isArray(r),l=[r],u=-1,c=[],h=r,p,f;const g=[],m=[];do{u++;const _=u===l.length,T=_&&c.length!==0;if(_){if(p=m.length===0?void 0:g[g.length-1],h=f,f=m.pop(),T)if(o){h=h.slice();let C=0;for(const[R,B]of c){const I=R-C;B===null?(h.splice(I,1),C++):h[I]=B}}else{h=Object.defineProperties({},Object.getOwnPropertyDescriptors(h));for(const[C,R]of c)h[C]=R}u=s.index,l=s.keys,c=s.edits,o=s.inArray,s=s.prev}else if(f){if(p=o?u:l[u],h=f[p],h==null)continue;g.push(p)}let E;if(!Array.isArray(h)){var y,b;G5(h)||i1(!1,`Invalid AST Node: ${rM(h)}.`);const C=_?(y=n.get(h.kind))===null||y===void 0?void 0:y.leave:(b=n.get(h.kind))===null||b===void 0?void 0:b.enter;if(E=C==null?void 0:C.call(e,h,p,f,g,m),E===Tle)break;if(E===!1){if(!_){g.pop();continue}}else if(E!==void 0&&(c.push([p,E]),!_))if(G5(E))h=E;else{g.pop();continue}}if(E===void 0&&T&&c.push([p,h]),_)g.pop();else{var v;s={inArray:o,index:u,keys:l,edits:c,prev:s},o=Array.isArray(h),l=o?h:(v=i[h.kind])!==null&&v!==void 0?v:[],u=-1,c=[],f&&m.push(f),f=h}}while(s!==void 0);return c.length!==0?c[c.length-1][1]:r}function Rle(r,e){const i=r[e];return typeof i=="object"?i:typeof i=="function"?{enter:i,leave:void 0}:{enter:r.enter,leave:r.leave}}function Ile(r){return Mle(r,Lle)}const Ble=80,Lle={Name:{leave:r=>r.value},Variable:{leave:r=>"$"+r.name},Document:{leave:r=>gr(r.definitions,`

`)},OperationDefinition:{leave(r){const e=Sn("(",gr(r.variableDefinitions,", "),")"),i=gr([r.operation,gr([r.name,e]),gr(r.directives," ")]," ");return(i==="query"?"":i+" ")+r.selectionSet}},VariableDefinition:{leave:({variable:r,type:e,defaultValue:i,directives:n})=>r+": "+e+Sn(" = ",i)+Sn(" ",gr(n," "))},SelectionSet:{leave:({selections:r})=>fc(r)},Field:{leave({alias:r,name:e,arguments:i,directives:n,selectionSet:s}){const o=Sn("",r,": ")+e;let l=o+Sn("(",gr(i,", "),")");return l.length>Ble&&(l=o+Sn(`(
`,a1(gr(i,`
`)),`
)`)),gr([l,gr(n," "),s]," ")}},Argument:{leave:({name:r,value:e})=>r+": "+e},FragmentSpread:{leave:({name:r,directives:e})=>"..."+r+Sn(" ",gr(e," "))},InlineFragment:{leave:({typeCondition:r,directives:e,selectionSet:i})=>gr(["...",Sn("on ",r),gr(e," "),i]," ")},FragmentDefinition:{leave:({name:r,typeCondition:e,variableDefinitions:i,directives:n,selectionSet:s})=>`fragment ${r}${Sn("(",gr(i,", "),")")} on ${e} ${Sn("",gr(n," ")," ")}`+s},IntValue:{leave:({value:r})=>r},FloatValue:{leave:({value:r})=>r},StringValue:{leave:({value:r,block:e})=>e?ele(r):Ele(r)},BooleanValue:{leave:({value:r})=>r?"true":"false"},NullValue:{leave:()=>"null"},EnumValue:{leave:({value:r})=>r},ListValue:{leave:({values:r})=>"["+gr(r,", ")+"]"},ObjectValue:{leave:({fields:r})=>"{"+gr(r,", ")+"}"},ObjectField:{leave:({name:r,value:e})=>r+": "+e},Directive:{leave:({name:r,arguments:e})=>"@"+r+Sn("(",gr(e,", "),")")},NamedType:{leave:({name:r})=>r},ListType:{leave:({type:r})=>"["+r+"]"},NonNullType:{leave:({type:r})=>r+"!"},SchemaDefinition:{leave:({description:r,directives:e,operationTypes:i})=>Sn("",r,`
`)+gr(["schema",gr(e," "),fc(i)]," ")},OperationTypeDefinition:{leave:({operation:r,type:e})=>r+": "+e},ScalarTypeDefinition:{leave:({description:r,name:e,directives:i})=>Sn("",r,`
`)+gr(["scalar",e,gr(i," ")]," ")},ObjectTypeDefinition:{leave:({description:r,name:e,interfaces:i,directives:n,fields:s})=>Sn("",r,`
`)+gr(["type",e,Sn("implements ",gr(i," & ")),gr(n," "),fc(s)]," ")},FieldDefinition:{leave:({description:r,name:e,arguments:i,type:n,directives:s})=>Sn("",r,`
`)+e+(Z5(i)?Sn(`(
`,a1(gr(i,`
`)),`
)`):Sn("(",gr(i,", "),")"))+": "+n+Sn(" ",gr(s," "))},InputValueDefinition:{leave:({description:r,name:e,type:i,defaultValue:n,directives:s})=>Sn("",r,`
`)+gr([e+": "+i,Sn("= ",n),gr(s," ")]," ")},InterfaceTypeDefinition:{leave:({description:r,name:e,interfaces:i,directives:n,fields:s})=>Sn("",r,`
`)+gr(["interface",e,Sn("implements ",gr(i," & ")),gr(n," "),fc(s)]," ")},UnionTypeDefinition:{leave:({description:r,name:e,directives:i,types:n})=>Sn("",r,`
`)+gr(["union",e,gr(i," "),Sn("= ",gr(n," | "))]," ")},EnumTypeDefinition:{leave:({description:r,name:e,directives:i,values:n})=>Sn("",r,`
`)+gr(["enum",e,gr(i," "),fc(n)]," ")},EnumValueDefinition:{leave:({description:r,name:e,directives:i})=>Sn("",r,`
`)+gr([e,gr(i," ")]," ")},InputObjectTypeDefinition:{leave:({description:r,name:e,directives:i,fields:n})=>Sn("",r,`
`)+gr(["input",e,gr(i," "),fc(n)]," ")},DirectiveDefinition:{leave:({description:r,name:e,arguments:i,repeatable:n,locations:s})=>Sn("",r,`
`)+"directive @"+e+(Z5(i)?Sn(`(
`,a1(gr(i,`
`)),`
)`):Sn("(",gr(i,", "),")"))+(n?" repeatable":"")+" on "+gr(s," | ")},SchemaExtension:{leave:({directives:r,operationTypes:e})=>gr(["extend schema",gr(r," "),fc(e)]," ")},ScalarTypeExtension:{leave:({name:r,directives:e})=>gr(["extend scalar",r,gr(e," ")]," ")},ObjectTypeExtension:{leave:({name:r,interfaces:e,directives:i,fields:n})=>gr(["extend type",r,Sn("implements ",gr(e," & ")),gr(i," "),fc(n)]," ")},InterfaceTypeExtension:{leave:({name:r,interfaces:e,directives:i,fields:n})=>gr(["extend interface",r,Sn("implements ",gr(e," & ")),gr(i," "),fc(n)]," ")},UnionTypeExtension:{leave:({name:r,directives:e,types:i})=>gr(["extend union",r,gr(e," "),Sn("= ",gr(i," | "))]," ")},EnumTypeExtension:{leave:({name:r,directives:e,values:i})=>gr(["extend enum",r,gr(e," "),fc(i)]," ")},InputObjectTypeExtension:{leave:({name:r,directives:e,fields:i})=>gr(["extend input",r,gr(e," "),fc(i)]," ")}};function gr(r,e=""){var i;return(i=r==null?void 0:r.filter(n=>n).join(e))!==null&&i!==void 0?i:""}function fc(r){return Sn(`{
`,a1(gr(r,`
`)),`
}`)}function Sn(r,e,i=""){return e!=null&&e!==""?r+e+i:""}function a1(r){return Sn("  ",r.replace(/\n/g,`
  `))}function Z5(r){var e;return(e=r==null?void 0:r.some(i=>i.includes(`
`)))!==null&&e!==void 0?e:!1}const $5="Accept",nM="Content-Type",sM="application/json",eF="application/graphql-response+json",tF=r=>r.replace(/([\s,]|#[^\n\r]+)+/g," ").trim(),Dle=r=>{const e=r.toLowerCase();return e.includes(eF)||e.includes(sM)},iF=r=>{try{if(Array.isArray(r))return{_tag:"Batch",executionResults:r.map(rF)};if(t1(r))return{_tag:"Single",executionResult:rF(r)};throw new Error(`Invalid execution result: result is not object or array. 
Got:
${String(r)}`)}catch(e){return e}},rF=r=>{if(typeof r!="object"||r===null)throw new Error("Invalid execution result: result is not object");let e,i,n;if("errors"in r){if(!t1(r.errors)&&!Array.isArray(r.errors))throw new Error("Invalid execution result: errors is not plain object OR array");e=r.errors}if("data"in r){if(!t1(r.data)&&r.data!==null)throw new Error("Invalid execution result: data is not plain object");i=r.data}if("extensions"in r){if(!t1(r.extensions))throw new Error("Invalid execution result: extensions is not plain object");n=r.extensions}return{data:i,errors:e,extensions:n}},Nle=r=>r._tag==="Batch"?r.executionResults.some(nF):nF(r.executionResult),nF=r=>Array.isArray(r.errors)?r.errors.length>0:!!r.errors,sF=r=>typeof r=="object"&&r!==null&&"kind"in r&&r.kind===Or.OPERATION_DEFINITION,Ple=r=>{var e;let i;const n=r.definitions.filter(sF);return n.length===1&&(i=(e=n[0].name)==null?void 0:e.value),i},Ole=r=>{let e=!1;const i=r.definitions.filter(sF);return i.length===1&&(e=i[0].operation===Ip.MUTATION),e},aM=(r,e)=>{const i=typeof r=="string"?r:Ile(r);let n=!1,s;if(e)return{expression:i,isMutation:n,operationName:s};const o=zoe(()=>typeof r=="string"?xle(r):r);return o instanceof Error?{expression:i,isMutation:n,operationName:s}:(s=Ple(o),n=Ole(o),{expression:i,operationName:s,isMutation:n})},oM=JSON,lM=async r=>{const e={...r,method:r.request._tag==="Single"?r.request.document.isMutation?"POST":P5(r.method??"post"):r.request.hasMutations?"POST":P5(r.method??"post"),fetchOptions:{...r.fetchOptions,errorPolicy:r.fetchOptions.errorPolicy??"none"}},i=await Fle(e.method)(e);if(!i.ok)return new Qm({status:i.status,headers:i.headers},{query:r.request._tag==="Single"?r.request.document.expression:r.request.query,variables:r.request.variables});const n=await kle(i,r.fetchOptions.jsonSerializer??oM);if(n instanceof Error)throw n;const s={status:i.status,headers:i.headers};if(Nle(n)&&e.fetchOptions.errorPolicy==="none"){const o=n._tag==="Batch"?{...n.executionResults,...s}:{...n.executionResult,...s};return new Qm(o,{query:r.request._tag==="Single"?r.request.document.expression:r.request.query,variables:r.request.variables})}switch(n._tag){case"Single":return{...s,...aF(e)(n.executionResult)};case"Batch":return{...s,data:n.executionResults.map(aF(e))};default:JT(n)}},aF=r=>e=>({extensions:e.extensions,data:e.data,errors:r.fetchOptions.errorPolicy==="all"?e.errors:void 0}),kle=async(r,e)=>{const i=r.headers.get(nM),n=await r.text();return i&&Dle(i)?iF(e.parse(n)):iF(n)},Fle=r=>async e=>{const i=new Headers(e.headers);let n=null,s;i.has($5)||i.set($5,[eF,sM].join(", ")),r==="POST"?(s=(e.fetchOptions.jsonSerializer??oM).stringify(Ule(e)),typeof s=="string"&&!i.has(nM)&&i.set(nM,sM)):n=zle(e);const o={method:r,headers:i,body:s,...e.fetchOptions};let l=new URL(e.url),u=o;if(e.middleware){const c=await Promise.resolve(e.middleware({...o,url:e.url,operationName:e.request._tag==="Single"?e.request.document.operationName:void 0,variables:e.request.variables})),{url:h,...p}=c;l=new URL(h),u=p}return n&&n.forEach((c,h)=>{l.searchParams.append(h,c)}),await(e.fetch??fetch)(l,u)},Ule=r=>{switch(r.request._tag){case"Single":return{query:r.request.document.expression,variables:r.request.variables,operationName:r.request.document.operationName};case"Batch":return O5(r.request.query,r.request.variables??[]).map(([e,i])=>({query:e,variables:i}));default:throw JT(r.request)}},zle=r=>{var e;const i=r.fetchOptions.jsonSerializer??oM,n=new URLSearchParams;switch(r.request._tag){case"Single":return n.append("query",tF(r.request.document.expression)),r.request.variables&&n.append("variables",i.stringify(r.request.variables)),r.request.document.operationName&&n.append("operationName",r.request.document.operationName),n;case"Batch":{const s=((e=r.request.variables)==null?void 0:e.map(u=>i.stringify(u)))??[],o=r.request.query.map(tF),l=O5(o,s).map(([u,c])=>({query:u,variables:c}));return n.append("query",i.stringify(l)),n}default:throw JT(r.request)}};class oF{constructor(e,i={}){z0(this,"url"),z0(this,"requestConfig"),z0(this,"rawRequest",async(...n)=>{const[s,o,l]=n,u=Goe(s,o,l),{headers:c,fetch:h=globalThis.fetch,method:p="POST",requestMiddleware:f,responseMiddleware:g,excludeOperationName:m,...y}=this.requestConfig,{url:b}=this;u.signal!==void 0&&(y.signal=u.signal);const v=aM(u.query,m),_=await lM({url:b,request:{_tag:"Single",document:v,variables:u.variables},headers:{...qm(KT(c)),...qm(u.requestHeaders)},fetch:h,method:p,fetchOptions:y,middleware:f});if(g&&await g(_,{operationName:v.operationName,variables:o,url:this.url}),_ instanceof Error)throw _;return _}),this.url=e,this.requestConfig=i}async request(e,...i){const[n,s]=i,o=jle(e,n,s),{headers:l,fetch:u=globalThis.fetch,method:c="POST",requestMiddleware:h,responseMiddleware:p,excludeOperationName:f,...g}=this.requestConfig,{url:m}=this;o.signal!==void 0&&(g.signal=o.signal);const y=aM(o.document,f),b=await lM({url:m,request:{_tag:"Single",document:y,variables:o.variables},headers:{...qm(KT(l)),...qm(o.requestHeaders)},fetch:u,method:c,fetchOptions:g,middleware:h});if(p&&await p(b,{operationName:y.operationName,variables:o.variables,url:this.url}),b instanceof Error)throw b;return b.data}async batchRequests(e,i){const n=Voe(e,i),{headers:s,excludeOperationName:o,...l}=this.requestConfig;n.signal!==void 0&&(l.signal=n.signal);const u=n.documents.map(({document:g})=>aM(g,o)),c=u.map(({expression:g})=>g),h=u.some(({isMutation:g})=>g),p=n.documents.map(({variables:g})=>g),f=await lM({url:this.url,request:{_tag:"Batch",operationName:void 0,query:c,hasMutations:h,variables:p},headers:{...qm(KT(s)),...qm(n.requestHeaders)},fetch:this.requestConfig.fetch??globalThis.fetch,method:this.requestConfig.method||"POST",fetchOptions:l,middleware:this.requestConfig.requestMiddleware});if(this.requestConfig.responseMiddleware&&await this.requestConfig.responseMiddleware(f,{operationName:void 0,variables:p,url:this.url}),f instanceof Error)throw f;return f.data}setHeaders(e){return this.requestConfig.headers=e,this}setHeader(e,i){const{headers:n}=this.requestConfig;return n?n[e]=i:this.requestConfig.headers={[e]:i},this}setEndpoint(e){return this.url=e,this}}const jle=(r,e,i)=>r.document?r:{document:r,variables:e,requestHeaders:i,signal:void 0},hl=(r,...e)=>r.reduce((i,n,s)=>`${i}${n}${s in e?String(e[s]):""}`,""),lF={base:{url:" https://prod.base.intuition-api.com/v1/graphql",displayName:"Base Mainnet"}},XA=r=>new oF(lF[r].url),Vle=async(r,e="baseSepolia")=>{const i=XA(e);let n;n=hl`
    query GetAtom($atomId: numeric!) {
      atom(id: $atomId) {
        id
        image
        label
        emoji
        type
        creator_id
        vault {
          total_shares
        }
      }
    }
  `;const s={atomId:r};try{return(await i.request(n,s)).atom}catch(o){throw console.error("Error fetching atom details:",o),o}},Gle=async(r="baseSepolia")=>{const e=XA(r);let i,n;return i=hl`
    query {
      triples(limit: 1000) {
        id
        subject {
          label
          id
          creator_id
          type
          image
        }
        predicate {
          label
          id
          creator_id
          type
        }
        object {
          label
          id
          creator_id
          type
          image
        }
      }
    }
  `,n=await e.request(i),{items:n.triples}.items},Hle=async(r,e="baseSepolia")=>{const i=XA(e);let n,s,o;return n=hl`
    query Triples($where: triples_bool_exp) {
      triples(where: $where) {
        id
        subject {
          label
          id
          creator_id
          type
          image
        }
        predicate {
          label
          id
          creator_id
          type
        }
        object {
          label
          id
          creator_id
          type
          image
        }
      }
    }
  `,o={where:{_or:[{predicate_id:{_eq:r}},{subject_id:{_eq:r}},{object_id:{_eq:r}}]}},s=await i.request(n,o),s.triples},Wle=async(r,e="baseSepolia")=>{const i=XA(e),n=hl`
    query SearchTriples($where: triples_bool_exp) {
      triples(where: $where) {
        id
        subject {
          label
          id
          creator_id
          type
          image
        }
        predicate {
          label
          id
          creator_id
          type
        }
        object {
          label
          id
          creator_id
          type
          image
        }
      }
    }
  `,s={_and:[]};r.subject&&s._and.push({subject:{label:{_ilike:`%${r.subject}%`}}}),r.predicate&&s._and.push({predicate:{label:{_ilike:`%${r.predicate}%`}}}),r.object&&s._and.push({object:{label:{_ilike:`%${r.object}%`}}});const o={where:s._and.length>0?s:{}};console.log("Executing search query with variables:",o);try{const l=await i.request(n,o);return console.log("Search query response:",l),l.triples}catch(l){throw console.error("Error executing search query:",l),l}},cF=Object.freeze(Object.defineProperty({__proto__:null,ENDPOINTS:lF,createClient:XA,fetchAtomDetails:Vle,fetchTriples:Gle,fetchTriplesForNode:Hle,searchTriples:Wle},Symbol.toStringTag,{value:"Module"})),uF={baseSepolia:{url:"https://dev.base-sepolia.intuition-api.com/v1/graphql",displayName:"Base Testnet"},base:{url:"https://prod.base.intuition-api.com/v1/graphql",displayName:"Base Mainnet"}},Wc=r=>new oF(uF[r].url),Qle=async(r,e="base")=>{const i=Wc(e);let n;n=hl`
    query GetAtom($atomId: numeric!) {
      atom(id: $atomId) {
        id
        image
        label
        emoji
        type
        creator_id
        vault {
          total_shares
        }
      }
    }
  `;const s={atomId:r};try{return(await i.request(n,s)).atom}catch(o){throw console.error("Error fetching atom details:",o),o}},hF=async(r="base")=>{const e=Wc(r);let i,n;return i=hl`
    query {
      triples(limit: 1000) {
        id
        subject {
          label
          id
          creator_id
          type
          image
        }
        predicate {
          label
          id
          creator_id
          type
        }
        object {
          label
          id
          creator_id
          type
          image
        }
      }
    }
  `,n=await e.request(i),{items:n.triples}.items},qle=async(r,e="base")=>{const i=Wc(e);let n,s,o;return n=hl`
    query Triples($where: triples_bool_exp) {
      triples(where: $where) {
        id
        subject {
          label
          id
          creator_id
          type
          image
        }
        predicate {
          label
          id
          creator_id
          type
        }
        object {
          label
          id
          creator_id
          type
          image
        }
      }
    }
  `,o={where:{_or:[{predicate_id:{_eq:r}},{subject_id:{_eq:r}},{object_id:{_eq:r}}]}},s=await i.request(n,o),s.triples},Xle=async(r,e="base")=>{const i=Wc(e),n=hl`
    query SearchTriples($where: triples_bool_exp) {
      triples(where: $where) {
        id
        subject {
          label
          id
          creator_id
          type
          image
        }
        predicate {
          label
          id
          creator_id
          type
        }
        object {
          label
          id
          creator_id
          type
          image
        }
      }
    }
  `,s={_and:[]};r.subject&&s._and.push({subject:{label:{_ilike:`%${r.subject}%`}}}),r.predicate&&s._and.push({predicate:{label:{_ilike:`%${r.predicate}%`}}}),r.object&&s._and.push({object:{label:{_ilike:`%${r.object}%`}}});const o={where:s._and.length>0?s:{}};try{return(await i.request(n,o)).triples}catch(l){throw console.error("Error executing search query:",l),l}},dF=async(r,e="base")=>{const i=Wc(e),n=hl`
    query ClaimsByAccount($where: signals_bool_exp, $orderBy: [signals_order_by!]) {
      signals(where: $where, order_by: $orderBy) {
        account_id
        claim {
        id
        deposit {
          counter_shares
          counter_vault_id
          shares
          vault_id
        }
        triple {
        triple_id
        subject {
          id
          label
          type
          image
        }
        predicate {
          id
          label
          type
        }
        object {
          id
          label
          type
          image
        }
        }
      }
    }
  `,s={where:{_and:[{triple_id:{_is_null:!1}},{account_id:{_eq:r}}]},orderBy:[{block_number:"desc"}]};return(await i.request(n,s)).claims},Yle=async(r,e="base")=>{const i=Wc(e),n=hl`
    query TriplesByCreator($creatorId: String!) {
      triples(where: { creator_id: { _eq: $creatorId } }) {
        id
        subject {
          label
          id
        }
        predicate {
          label
          id
        }
        object {
          label
          id
        }
      }
    }
  `,s={creatorId:r};return(await i.request(n,s)).triples},pF=async(r,e="base",i=1e3)=>{const n=Wc(e),s=hl`
    query Claims_for_Agent($objectId: numeric!, $batchSize: Int!) {
      claims(limit: $batchSize, where: { object_id: { _eq: $objectId } }) {
        subject {
          id
          label
          type
          image
          as_subject_claims {
            predicate {
              label
              id
              type
              image
            }
            object {
              label
              id
              type
              image
            }
          }
        }
      }
    }
  `,o={batchSize:i,objectId:r};try{return(await n.request(s,o)).claims.flatMap(l=>!l.subject.as_subject_claims||l.subject.as_subject_claims.length===0?[{id:`${l.subject.id}-connected-to-${r}`,subject:{id:l.subject.id,label:l.subject.label,type:"agent",image:l.subject.image},predicate:{id:null,label:"connected to",type:"relation",image:null},object:{id:r,label:"Agent",type:"agent",image:l.object.image}}]:l.subject.as_subject_claims.map(u=>({id:`${l.subject.id}-${u.predicate.label}-${u.object.label}`,subject:{id:l.subject.id,label:l.subject.label,type:"agent",image:l.subject.image},predicate:{id:u.predicate.id||null,label:u.predicate.label,type:"relation",image:u.predicate.image},object:{id:u.object.id||null,label:u.object.label,type:"concept",image:u.object.image}})))}catch(l){return console.error("Error fetching agent-specific triples:",l),hF(e).then(u=>u.filter(c=>c.subject.id===r||c.object.id===r||c.predicate.id===r)).catch(u=>{throw console.error("Fallback fetch also failed:",u),l})}},cM=async(r,e="base")=>{const i=Wc(e),n=hl`
    query GetAccountActivity($accountId: String!) {
      positions(where: { account_id: { _eq: $accountId } }) {
        id
        shares
        vault_id
        account {
          id
          label
          image
          atom_id
          type
        }
        vault {
          id
          total_shares
          current_share_price
          atom {
            id
            label
            image
          }
          triple {
            id
            block_number
            block_timestamp
            transaction_hash
            creator_id
            subject {
              id
              label
              image
              emoji
              type
              value {
                person {
                  name
                  image
                  description
                  url
                }
                thing {
                  name
                  image
                  description
                  url
                }
                organization {
                  name
                  image
                  description
                  url
                }
              }
              creator {
                label
                image
                id
                atom_id
                type
              }
            }
            predicate {
              id
              label
              image
              emoji
              type
              value {
                person {
                  name
                  image
                  description
                  url
                }
                thing {
                  name
                  image
                  description
                  url
                }
                organization {
                  name
                  image
                  description
                  url
                }
              }
              creator {
                label
                image
                id
                atom_id
                type
              }
            }
            object {
              id
              label
              image
              emoji
              type
              value {
                person {
                  name
                  image
                  description
                  url
                }
                thing {
                  name
                  image
                  description
                  url
                }
                organization {
                  name
                  image
                  description
                  url
                }
              }
              creator {
                label
                image
                id
                atom_id
                type
              }
            }
          }
        }
      }
    }
  `,s={accountId:r};return(await i.request(n,s)).positions},fF=async(r,e,i="base")=>{const n=Wc(i),s=hl`
    query GetFollowsAndFollowers($predicateId: numeric!, $accountId: String!) {
      follows: triples(
        where: {
          _and: [
            { predicate_id: { _eq: $predicateId } }
            { subject_id: { _eq: $accountId } }
          ]
        }
      ) {
        id
        object {
          id
          label
          image
        }
      }
      followers: triples(
        where: {
          _and: [
            { predicate_id: { _eq: $predicateId } }
            { object_id: { _eq: $accountId } }
          ]
        }
      ) {
        id
        subject {
          id
          label
          image
        }
      }
    }
  `,o={predicateId:r,accountId:e};return await n.request(s,o)},Kle=Object.freeze(Object.defineProperty({__proto__:null,ENDPOINTS:uF,createClient:Wc,fetchAtomDetails:Qle,fetchClaimsByAccount:dF,fetchFollowsAndFollowers:fF,fetchPositionsByAccount:cM,fetchTriples:hF,fetchTriplesByCreator:Yle,fetchTriplesForAgent:pF,fetchTriplesForNode:qle,searchTriples:Xle},Symbol.toStringTag,{value:"Module"})),uM={railsMockApi:{url:"https://api-i7n.thp-lab.org/api/v1/graph",displayName:"[OffChain] Playground API",module:cF},baseSepolia:{url:"https://api.i7n.dev/v1/graphql",displayName:"Base Testnet",module:Kle},base:{url:"https://prod.base.intuition-api.com/v1/graphql",displayName:"Base Mainnet",module:cF}},o1=r=>{if(!uM[r]||!uM[r].module)throw new Error(`No module defined for endpoint '${r}'.`);return uM[r].module},hM=async(r="base")=>{const e=o1(r);try{return e.fetchTriples(r)}catch(i){throw console.error(`Error fetching triples for endpoint ${r}:`,i),i}},Jle=async(r,e="base")=>{const i=o1(e);try{return i.fetchTriplesForNode(r,e)}catch(n){throw console.error(`Error fetching triples for node ${r} with endpoint ${e}:`,n),n}},Zle=async(r,e="base")=>{const i=o1(e);try{return i.fetchAtomDetails(r,e)}catch(n){throw console.error(`Error fetching atom details for ${r} with endpoint ${e}:`,n),n}},Ym=async(r,e="base")=>{const i=o1(e);try{return i.searchTriples(r,e)}catch(n){throw console.error(`Error searching triples with endpoint ${e}:`,n),n}},$le=async(r,e="baseSepolia")=>dF(r,e),ece=async(r,e="baseSepolia",i=1e3)=>pF(r,e,i),dM=({triple:r,endpoint:e,onClose:i})=>{var n,s;const[o,l]=Ct.useState(null),[u,c]=Ct.useState(null),[h,p]=Ct.useState(!1),[f,g]=Ct.useState(null);Ct.useEffect(()=>{r&&(p(!0),g(null),c(null),(async()=>{try{const y=(await hM(e)).filter(b=>{var v,_,T;return b.id===r.id||((v=b.subject)==null?void 0:v.id)===r.id||((_=b.predicate)==null?void 0:_.id)===r.id||((T=b.object)==null?void 0:T.id)===r.id});if(l(y),r.id){const b=await Zle(parseInt(r.id),e);c(b)}}catch(y){console.error("Error fetching sidebar data:",y),g("Failed to fetch data")}finally{p(!1)}})())},[r,e]);const m=y=>`${(y/1e18).toFixed(4)} ETH`;return r?De.jsxs("div",{style:{background:"#18181b",borderRadius:"10px",border:"2px solid #ffd32a",padding:"24px",boxShadow:"0 8px 30px rgba(0, 0, 0, 0.5)",color:"#fff",maxWidth:"400px",width:"100%"},children:[De.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"24px"},children:[De.jsx("h2",{style:{margin:0,fontSize:"24px",color:"#ffd32a",fontWeight:"bold",letterSpacing:"0.5px"},children:r.label||"No Label"}),De.jsx("button",{onClick:i,style:{background:"none",border:"none",color:"#ffd32a",fontSize:"24px",cursor:"pointer",padding:"4px",lineHeight:1},children:"×"})]}),u&&u.image&&De.jsx("div",{style:{display:"flex",justifyContent:"center",margin:"24px 0"},children:De.jsx("img",{src:u.image,alt:u.label||"Node image",style:{width:"120px",height:"120px",borderRadius:"50%",objectFit:"cover",border:"3px solid #ffd32a",boxShadow:"0 4px 12px rgba(0,0,0,0.2)"}})}),h&&De.jsx("div",{style:{textAlign:"center",padding:"20px",color:"#ffd32a"},children:"Loading..."}),f&&De.jsx("div",{style:{color:"#ff4444",padding:"12px",background:"rgba(255,68,68,0.1)",borderRadius:"8px",marginBottom:"16px"},children:f}),u&&De.jsxs("div",{style:{background:"#232326",borderRadius:"8px",padding:"16px",marginBottom:"24px"},children:[De.jsx("h4",{style:{color:"#ffd32a",margin:"0 0 16px 0",fontSize:"18px",fontWeight:"bold"},children:"Atom Info"}),De.jsxs("div",{style:{display:"grid",gap:"12px"},children:[De.jsxs("div",{children:[De.jsx("span",{style:{color:"#ffd32a",fontWeight:"bold"},children:"ID:"})," ",u.id]}),De.jsxs("div",{children:[De.jsx("span",{style:{color:"#ffd32a",fontWeight:"bold"},children:"Label:"})," ",u.label]}),De.jsxs("div",{children:[De.jsx("span",{style:{color:"#ffd32a",fontWeight:"bold"},children:"Type:"})," ",u.type]}),De.jsxs("div",{children:[De.jsx("span",{style:{color:"#ffd32a",fontWeight:"bold"},children:"Creator:"})," ",((n=u.creator)==null?void 0:n.label)||"Unknown"]}),De.jsxs("div",{children:[De.jsx("span",{style:{color:"#ffd32a",fontWeight:"bold"},children:"Vault Shares:"})," ",m(((s=u.vault)==null?void 0:s.total_shares)||0)]})]})]}),o&&o.length>0&&De.jsxs("div",{style:{background:"#232326",borderRadius:"8px",padding:"16px"},children:[De.jsx("h4",{style:{color:"#ffd32a",margin:"0 0 16px 0",fontSize:"18px",fontWeight:"bold"},children:"Related Data"}),De.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:o.map(y=>{var b,v,_;return De.jsxs("div",{style:{padding:"12px",background:"#18181b",borderRadius:"6px",border:"1px solid #ffd32a33"},children:[De.jsxs("div",{children:[De.jsx("span",{style:{color:"#ffd32a",fontWeight:"bold"},children:"Subject:"})," ",(b=y.subject)==null?void 0:b.label]}),De.jsxs("div",{children:[De.jsx("span",{style:{color:"#ffd32a",fontWeight:"bold"},children:"Predicate:"})," ",(v=y.predicate)==null?void 0:v.label]}),De.jsxs("div",{children:[De.jsx("span",{style:{color:"#ffd32a",fontWeight:"bold"},children:"Object:"})," ",(_=y.object)==null?void 0:_.label]})]},y.id)})})]}),!h&&!(o!=null&&o.length)&&De.jsx("div",{style:{textAlign:"center",padding:"20px",color:"#888",background:"#232326",borderRadius:"8px"},children:"No additional related data found."})]}):null},tce=({graphData:r,onNodeClick:e,onBack:i,onForward:n,selectedTriple:s,endpoint:o})=>{const l=Ct.useRef(),u=Ct.useRef(),[c,h]=Ct.useState({width:100,height:100});return Ct.useEffect(()=>{const p=()=>{l.current&&h({width:l.current.clientWidth,height:l.current.clientHeight})};return p(),window.addEventListener("resize",p),()=>window.removeEventListener("resize",p)},[]),Ct.useEffect(()=>{if(u.current&&c.width>0&&c.height>0){const p=N5()(u.current);p.width(c.width).height(c.height).graphData(r).nodeLabel(f=>f.label||f.id).nodeAutoColorBy("group"),e&&p.onNodeClick(f=>{console.log("VR Node clicked inside Graph:",f),e(f)})}},[r,e,c]),De.jsxs("div",{ref:l,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden"},children:[De.jsx("div",{ref:u,style:{width:"100%",height:"100%"}}),De.jsxs("div",{style:{position:"absolute",bottom:20,left:20,zIndex:100},children:[De.jsx("button",{onClick:i,style:{background:"#ffd32a",color:"#18181b",border:"none",borderRadius:8,padding:"10px 20px",marginRight:10,cursor:"pointer",fontWeight:"bold"},children:"Back"}),De.jsx("button",{onClick:n,style:{background:"#ffd32a",color:"#18181b",border:"none",borderRadius:8,padding:"10px 20px",cursor:"pointer",fontWeight:"bold"},children:"Forward"})]}),s&&De.jsx("div",{style:{position:"absolute",top:80,right:30,width:350,zIndex:9999,maxHeight:"80vh",background:"#18181b",borderRadius:"10px",border:"3px solid #ffd32a",boxShadow:"0 8px 30px rgba(0, 0, 0, 0.5)",overflowY:"auto"},children:De.jsx(dM,{triple:s,endpoint:o,onClose:()=>e(null)})})]})},mF=()=>{const[r,e]=Ct.useState([]),i=200;Ct.useEffect(()=>{let s;const o=()=>{const l=Date.now()/1e3,u=[];for(let c=0;c<3;c++){const h=l*.8+c*2*Math.PI/3;u.push({x:Math.cos(h)*150+200,y:Math.sin(h)*150+200,color:"#00fff2"})}for(let c=0;c<3;c++){const h=-l*1.2+c*2*Math.PI/3;u.push({x:Math.cos(h)*100+200,y:Math.sin(h)*100+200,color:"#ff00ff"})}for(let c=0;c<3;c++){const h=l*1.5+c*2*Math.PI/3;u.push({x:Math.cos(h)*50+200,y:Math.sin(h)*50+200,color:"#ffff00"})}e(u),s=requestAnimationFrame(o)};return o(),()=>cancelAnimationFrame(s)},[]);const n=r.flatMap((s,o)=>r.slice(o+1).map((l,u)=>{const c=l.x-s.x,h=l.y-s.y,p=Math.sqrt(c*c+h*h);if(p<i){const f=1-p/i;return{x1:s.x,y1:s.y,x2:l.x,y2:l.y,opacity:f*.8,gradient:`link-gradient-${o}-${u}`,color1:s.color,color2:l.color}}return null}).filter(Boolean));return De.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",background:"rgba(0, 0, 0, 0.9)",zIndex:1e3,overflow:"hidden"},children:[De.jsxs("div",{style:{position:"relative",width:"400px",height:"400px",display:"flex",flexDirection:"column",alignItems:"center"},children:[De.jsxs("svg",{width:"400",height:"400",children:[De.jsx("defs",{children:n.map(s=>De.jsxs("linearGradient",{id:s.gradient,x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[De.jsx("stop",{offset:"0%",stopColor:s.color1,stopOpacity:s.opacity}),De.jsx("stop",{offset:"100%",stopColor:s.color2,stopOpacity:s.opacity})]},s.gradient))}),n.map((s,o)=>De.jsx("line",{x1:s.x1,y1:s.y1,x2:s.x2,y2:s.y2,stroke:`url(#${s.gradient})`,strokeWidth:"3",style:{filter:"brightness(1.5) blur(1px)"}},o))]}),De.jsx("div",{style:{color:"#00fff2",fontSize:"40px",fontFamily:"sans-serif",letterSpacing:"-2px",textShadow:`
            0 0 5px #00fff2,
            0 0 10px #00fff2,
            0 0 20px #00fff2,
            0 0 40px #00fff2
          `,animation:"textPulse 1.5s ease-in-out infinite",whiteSpace:"nowrap",marginTop:"20px"},children:"Connecting I7n Dots..."})]}),De.jsx("style",{children:`
          @keyframes textPulse {
            0% { 
              opacity: 0.5;
              transform: scale(0.98) translateY(0);
            }
            50% { 
              opacity: 1;
              transform: scale(1.02) translateY(-5px);
            }
            100% { 
              opacity: 0.5;
              transform: scale(0.98) translateY(0);
            }
          }
        `})]})},ice=({subjectFilter:r,predicateFilter:e,objectFilter:i,onFilterChange:n,onReset:s,onClose:o})=>De.jsxs("div",{style:{display:"flex",flexDirection:"column",background:"#18181b",padding:"16px 24px",borderRadius:"10px",border:"2px solid #ffd32a",boxShadow:"0 8px 30px rgba(0, 0, 0, 0.5)",position:"relative"},children:[De.jsx("button",{onClick:o,style:{position:"absolute",top:4,right:6,background:"none",border:"none",color:"#ffd32a",fontSize:20,cursor:"pointer",padding:0,lineHeight:1,width:24,height:24,display:"flex",alignItems:"center",justifyContent:"center",zIndex:2},"aria-label":"Close filters",children:"×"}),De.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[De.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[De.jsx("label",{style:{color:"#ffd32a",fontSize:"14px",fontWeight:"bold"},children:"Subject"}),De.jsx("input",{type:"text",value:r,onChange:l=>n("subject",l.target.value),placeholder:"Filter by subject...",style:{padding:"8px 12px",borderRadius:"8px",border:"1px solid #ffd32a",fontSize:"14px",width:"200px",background:"#232326",color:"#fff",transition:"border-color 0.2s"}})]}),De.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[De.jsx("label",{style:{color:"#ffd32a",fontSize:"14px",fontWeight:"bold"},children:"Predicate"}),De.jsx("input",{type:"text",value:e,onChange:l=>n("predicate",l.target.value),placeholder:"Filter by predicate...",style:{padding:"8px 12px",borderRadius:"8px",border:"1px solid #ffd32a",fontSize:"14px",width:"200px",background:"#232326",color:"#fff",transition:"border-color 0.2s"}})]}),De.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[De.jsx("label",{style:{color:"#ffd32a",fontSize:"14px",fontWeight:"bold"},children:"Object"}),De.jsx("input",{type:"text",value:i,onChange:l=>n("object",l.target.value),placeholder:"Filter by object...",style:{padding:"8px 12px",borderRadius:"8px",border:"1px solid #ffd32a",fontSize:"14px",width:"200px",background:"#232326",color:"#fff",transition:"border-color 0.2s"}})]}),De.jsx("button",{style:{background:"#ffd32a",color:"#18181b",border:"none",borderRadius:"8px",padding:"8px 24px",fontSize:"14px",fontWeight:"bold",cursor:"pointer",textTransform:"uppercase",transition:"background 0.2s, transform 0.1s",alignSelf:"flex-start",marginTop:"8px",boxShadow:"0 2px 8px rgba(0,0,0,0.18)"},onMouseEnter:l=>{l.currentTarget.style.background="#ffe066",l.currentTarget.style.transform="translateY(-1px)"},onMouseLeave:l=>{l.currentTarget.style.background="#ffd32a",l.currentTarget.style.transform="translateY(0)"},onClick:s,children:"Reset"})]})]});function rce(r,e){var i=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(i!=null){var n,s,o,l,u=[],c=!0,h=!1;try{if(o=(i=i.call(r)).next,e===0){if(Object(i)!==i)return;c=!1}else for(;!(c=(n=o.call(i)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(p){h=!0,s=p}finally{try{if(!c&&i.return!=null&&(l=i.return(),Object(l)!==l))return}finally{if(h)throw s}}return u}}function nce(r,e,i){return e=dce(e),e in r?Object.defineProperty(r,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[e]=i,r}function gF(r,e){return oce(r)||rce(r,e)||AF(r,e)||uce()}function sce(r){return ace(r)||lce(r)||AF(r)||cce()}function ace(r){if(Array.isArray(r))return pM(r)}function oce(r){if(Array.isArray(r))return r}function lce(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function AF(r,e){if(r){if(typeof r=="string")return pM(r,e);var i=Object.prototype.toString.call(r).slice(8,-1);if(i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set")return Array.from(r);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return pM(r,e)}}function pM(r,e){(e==null||e>r.length)&&(e=r.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=r[i];return n}function cce(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function uce(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function hce(r,e){if(typeof r!="object"||r===null)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var n=i.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function dce(r){var e=hce(r,"string");return typeof e=="symbol"?e:String(e)}var pce=function(r,e){var i=new Set(e);return Object.assign.apply(Object,[{}].concat(sce(Object.entries(r).filter(function(n){var s=gF(n,1),o=s[0];return!i.has(o)}).map(function(n){var s=gF(n,2),o=s[0],l=s[1];return nce({},o,l)}))))};function fM(r,e){(e==null||e>r.length)&&(e=r.length);for(var i=0,n=Array(e);i<e;i++)n[i]=r[i];return n}function fce(r){if(Array.isArray(r))return r}function mce(r){if(Array.isArray(r))return fM(r)}function gce(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function Ace(r,e){var i=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(i!=null){var n,s,o,l,u=[],c=!0,h=!1;try{if(o=(i=i.call(r)).next,e!==0)for(;!(c=(n=o.call(i)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(p){h=!0,s=p}finally{try{if(!c&&i.return!=null&&(l=i.return(),Object(l)!==l))return}finally{if(h)throw s}}return u}}function yce(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function vce(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function bce(r,e){return fce(r)||Ace(r,e)||vF(r,e)||yce()}function yF(r){return mce(r)||gce(r)||vF(r)||vce()}function vF(r,e){if(r){if(typeof r=="string")return fM(r,e);var i={}.toString.call(r).slice(8,-1);return i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set"?Array.from(r):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?fM(r,e):void 0}}function l1(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=e.wrapperElementType,n=i===void 0?"div":i,s=e.nodeMapper,o=s===void 0?function(p){return p}:s,l=e.methodNames,u=l===void 0?[]:l,c=e.initPropNames,h=c===void 0?[]:c;return Ct.forwardRef(function(p,f){var g=Ct.useRef(),m=Ct.useMemo(function(){var v=Object.fromEntries(h.filter(function(_){return p.hasOwnProperty(_)}).map(function(_){return[_,p[_]]}));return r(v)},[]);bF(function(){m(o(g.current))},Ct.useLayoutEffect),bF(function(){return m._destructor instanceof Function?m._destructor:void 0});var y=Ct.useCallback(function(v){for(var _=arguments.length,T=new Array(_>1?_-1:0),E=1;E<_;E++)T[E-1]=arguments[E];return m[v]instanceof Function?m[v].apply(m,T):void 0},[m]),b=Ct.useRef({});return Object.keys(pce(p,[].concat(yF(u),yF(h)))).filter(function(v){return b.current[v]!==p[v]}).forEach(function(v){return y(v,p[v])}),b.current=p,Ct.useImperativeHandle(f,function(){return Object.fromEntries(u.map(function(v){return[v,function(){for(var _=arguments.length,T=new Array(_),E=0;E<_;E++)T[E]=arguments[E];return y.apply(void 0,[v].concat(T))}]}))},[y]),Ct.createElement(n,{ref:g})})}function bF(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ct.useEffect,i=Ct.useRef(),n=Ct.useRef(!1),s=Ct.useRef(!1),o=Ct.useState(0),l=bce(o,2);l[0];var u=l[1];n.current&&(s.current=!0),e(function(){return n.current||(i.current=r(),n.current=!0),u(function(c){return c+1}),function(){s.current&&i.current&&i.current()}},[])}var mM={exports:{}},gM={exports:{}},Kn={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xF;function xce(){if(xF)return Kn;xF=1;var r=typeof Symbol=="function"&&Symbol.for,e=r?Symbol.for("react.element"):60103,i=r?Symbol.for("react.portal"):60106,n=r?Symbol.for("react.fragment"):60107,s=r?Symbol.for("react.strict_mode"):60108,o=r?Symbol.for("react.profiler"):60114,l=r?Symbol.for("react.provider"):60109,u=r?Symbol.for("react.context"):60110,c=r?Symbol.for("react.async_mode"):60111,h=r?Symbol.for("react.concurrent_mode"):60111,p=r?Symbol.for("react.forward_ref"):60112,f=r?Symbol.for("react.suspense"):60113,g=r?Symbol.for("react.suspense_list"):60120,m=r?Symbol.for("react.memo"):60115,y=r?Symbol.for("react.lazy"):60116,b=r?Symbol.for("react.block"):60121,v=r?Symbol.for("react.fundamental"):60117,_=r?Symbol.for("react.responder"):60118,T=r?Symbol.for("react.scope"):60119;function E(R){if(typeof R=="object"&&R!==null){var B=R.$$typeof;switch(B){case e:switch(R=R.type,R){case c:case h:case n:case o:case s:case f:return R;default:switch(R=R&&R.$$typeof,R){case u:case p:case y:case m:case l:return R;default:return B}}case i:return B}}}function C(R){return E(R)===h}return Kn.AsyncMode=c,Kn.ConcurrentMode=h,Kn.ContextConsumer=u,Kn.ContextProvider=l,Kn.Element=e,Kn.ForwardRef=p,Kn.Fragment=n,Kn.Lazy=y,Kn.Memo=m,Kn.Portal=i,Kn.Profiler=o,Kn.StrictMode=s,Kn.Suspense=f,Kn.isAsyncMode=function(R){return C(R)||E(R)===c},Kn.isConcurrentMode=C,Kn.isContextConsumer=function(R){return E(R)===u},Kn.isContextProvider=function(R){return E(R)===l},Kn.isElement=function(R){return typeof R=="object"&&R!==null&&R.$$typeof===e},Kn.isForwardRef=function(R){return E(R)===p},Kn.isFragment=function(R){return E(R)===n},Kn.isLazy=function(R){return E(R)===y},Kn.isMemo=function(R){return E(R)===m},Kn.isPortal=function(R){return E(R)===i},Kn.isProfiler=function(R){return E(R)===o},Kn.isStrictMode=function(R){return E(R)===s},Kn.isSuspense=function(R){return E(R)===f},Kn.isValidElementType=function(R){return typeof R=="string"||typeof R=="function"||R===n||R===h||R===o||R===s||R===f||R===g||typeof R=="object"&&R!==null&&(R.$$typeof===y||R.$$typeof===m||R.$$typeof===l||R.$$typeof===u||R.$$typeof===p||R.$$typeof===v||R.$$typeof===_||R.$$typeof===T||R.$$typeof===b)},Kn.typeOf=E,Kn}var rs={};/** @license React v16.13.1
 * react-is.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _F;function _ce(){return _F||(_F=1,process.env.NODE_ENV!=="production"&&function(){var r=typeof Symbol=="function"&&Symbol.for,e=r?Symbol.for("react.element"):60103,i=r?Symbol.for("react.portal"):60106,n=r?Symbol.for("react.fragment"):60107,s=r?Symbol.for("react.strict_mode"):60108,o=r?Symbol.for("react.profiler"):60114,l=r?Symbol.for("react.provider"):60109,u=r?Symbol.for("react.context"):60110,c=r?Symbol.for("react.async_mode"):60111,h=r?Symbol.for("react.concurrent_mode"):60111,p=r?Symbol.for("react.forward_ref"):60112,f=r?Symbol.for("react.suspense"):60113,g=r?Symbol.for("react.suspense_list"):60120,m=r?Symbol.for("react.memo"):60115,y=r?Symbol.for("react.lazy"):60116,b=r?Symbol.for("react.block"):60121,v=r?Symbol.for("react.fundamental"):60117,_=r?Symbol.for("react.responder"):60118,T=r?Symbol.for("react.scope"):60119;function E(yt){return typeof yt=="string"||typeof yt=="function"||yt===n||yt===h||yt===o||yt===s||yt===f||yt===g||typeof yt=="object"&&yt!==null&&(yt.$$typeof===y||yt.$$typeof===m||yt.$$typeof===l||yt.$$typeof===u||yt.$$typeof===p||yt.$$typeof===v||yt.$$typeof===_||yt.$$typeof===T||yt.$$typeof===b)}function C(yt){if(typeof yt=="object"&&yt!==null){var bi=yt.$$typeof;switch(bi){case e:var $e=yt.type;switch($e){case c:case h:case n:case o:case s:case f:return $e;default:var Fi=$e&&$e.$$typeof;switch(Fi){case u:case p:case y:case m:case l:return Fi;default:return bi}}case i:return bi}}}var R=c,B=h,I=u,N=l,D=e,P=p,k=n,q=y,V=m,j=i,Q=o,W=s,G=f,z=!1;function te(yt){return z||(z=!0,console.warn("The ReactIs.isAsyncMode() alias has been deprecated, and will be removed in React 17+. Update your code to use ReactIs.isConcurrentMode() instead. It has the exact same API.")),Y(yt)||C(yt)===c}function Y(yt){return C(yt)===h}function se(yt){return C(yt)===u}function ve(yt){return C(yt)===l}function Ae(yt){return typeof yt=="object"&&yt!==null&&yt.$$typeof===e}function me(yt){return C(yt)===p}function Oe(yt){return C(yt)===n}function Xe(yt){return C(yt)===y}function Je(yt){return C(yt)===m}function it(yt){return C(yt)===i}function dt(yt){return C(yt)===o}function St(yt){return C(yt)===s}function Qt(yt){return C(yt)===f}rs.AsyncMode=R,rs.ConcurrentMode=B,rs.ContextConsumer=I,rs.ContextProvider=N,rs.Element=D,rs.ForwardRef=P,rs.Fragment=k,rs.Lazy=q,rs.Memo=V,rs.Portal=j,rs.Profiler=Q,rs.StrictMode=W,rs.Suspense=G,rs.isAsyncMode=te,rs.isConcurrentMode=Y,rs.isContextConsumer=se,rs.isContextProvider=ve,rs.isElement=Ae,rs.isForwardRef=me,rs.isFragment=Oe,rs.isLazy=Xe,rs.isMemo=Je,rs.isPortal=it,rs.isProfiler=dt,rs.isStrictMode=St,rs.isSuspense=Qt,rs.isValidElementType=E,rs.typeOf=C}()),rs}var EF;function wF(){return EF||(EF=1,process.env.NODE_ENV==="production"?gM.exports=xce():gM.exports=_ce()),gM.exports}/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var AM,CF;function Ece(){if(CF)return AM;CF=1;var r=Object.getOwnPropertySymbols,e=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable;function n(o){if(o==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(o)}function s(){try{if(!Object.assign)return!1;var o=new String("abc");if(o[5]="de",Object.getOwnPropertyNames(o)[0]==="5")return!1;for(var l={},u=0;u<10;u++)l["_"+String.fromCharCode(u)]=u;var c=Object.getOwnPropertyNames(l).map(function(p){return l[p]});if(c.join("")!=="0123456789")return!1;var h={};return"abcdefghijklmnopqrst".split("").forEach(function(p){h[p]=p}),Object.keys(Object.assign({},h)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}return AM=s()?Object.assign:function(o,l){for(var u,c=n(o),h,p=1;p<arguments.length;p++){u=Object(arguments[p]);for(var f in u)e.call(u,f)&&(c[f]=u[f]);if(r){h=r(u);for(var g=0;g<h.length;g++)i.call(u,h[g])&&(c[h[g]]=u[h[g]])}}return c},AM}var yM,SF;function vM(){if(SF)return yM;SF=1;var r="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return yM=r,yM}var TF,MF;function RF(){return MF||(MF=1,TF=Function.call.bind(Object.prototype.hasOwnProperty)),TF}var bM,IF;function wce(){if(IF)return bM;IF=1;var r=function(){};if(process.env.NODE_ENV!=="production"){var e=vM(),i={},n=RF();r=function(o){var l="Warning: "+o;typeof console<"u"&&console.error(l);try{throw new Error(l)}catch{}}}function s(o,l,u,c,h){if(process.env.NODE_ENV!=="production"){for(var p in o)if(n(o,p)){var f;try{if(typeof o[p]!="function"){var g=Error((c||"React class")+": "+u+" type `"+p+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof o[p]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw g.name="Invariant Violation",g}f=o[p](l,p,c,u,null,e)}catch(y){f=y}if(f&&!(f instanceof Error)&&r((c||"React class")+": type specification of "+u+" `"+p+"` is invalid; the type checker function must return `null` or an `Error` but returned a "+typeof f+". You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument)."),f instanceof Error&&!(f.message in i)){i[f.message]=!0;var m=h?h():"";r("Failed "+u+" type: "+f.message+(m??""))}}}}return s.resetWarningCache=function(){process.env.NODE_ENV!=="production"&&(i={})},bM=s,bM}var xM,BF;function Cce(){if(BF)return xM;BF=1;var r=wF(),e=Ece(),i=vM(),n=RF(),s=wce(),o=function(){};process.env.NODE_ENV!=="production"&&(o=function(u){var c="Warning: "+u;typeof console<"u"&&console.error(c);try{throw new Error(c)}catch{}});function l(){return null}return xM=function(u,c){var h=typeof Symbol=="function"&&Symbol.iterator,p="@@iterator";function f(Y){var se=Y&&(h&&Y[h]||Y[p]);if(typeof se=="function")return se}var g="<<anonymous>>",m={array:_("array"),bigint:_("bigint"),bool:_("boolean"),func:_("function"),number:_("number"),object:_("object"),string:_("string"),symbol:_("symbol"),any:T(),arrayOf:E,element:C(),elementType:R(),instanceOf:B,node:P(),objectOf:N,oneOf:I,oneOfType:D,shape:q,exact:V};function y(Y,se){return Y===se?Y!==0||1/Y===1/se:Y!==Y&&se!==se}function b(Y,se){this.message=Y,this.data=se&&typeof se=="object"?se:{},this.stack=""}b.prototype=Error.prototype;function v(Y){if(process.env.NODE_ENV!=="production")var se={},ve=0;function Ae(Oe,Xe,Je,it,dt,St,Qt){if(it=it||g,St=St||Je,Qt!==i){if(c){var yt=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use `PropTypes.checkPropTypes()` to call them. Read more at http://fb.me/use-check-prop-types");throw yt.name="Invariant Violation",yt}else if(process.env.NODE_ENV!=="production"&&typeof console<"u"){var bi=it+":"+Je;!se[bi]&&ve<3&&(o("You are manually calling a React.PropTypes validation function for the `"+St+"` prop on `"+it+"`. This is deprecated and will throw in the standalone `prop-types` package. You may be seeing this warning due to a third-party PropTypes library. See https://fb.me/react-warning-dont-call-proptypes for details."),se[bi]=!0,ve++)}}return Xe[Je]==null?Oe?Xe[Je]===null?new b("The "+dt+" `"+St+"` is marked as required "+("in `"+it+"`, but its value is `null`.")):new b("The "+dt+" `"+St+"` is marked as required in "+("`"+it+"`, but its value is `undefined`.")):null:Y(Xe,Je,it,dt,St)}var me=Ae.bind(null,!1);return me.isRequired=Ae.bind(null,!0),me}function _(Y){function se(ve,Ae,me,Oe,Xe,Je){var it=ve[Ae],dt=W(it);if(dt!==Y){var St=G(it);return new b("Invalid "+Oe+" `"+Xe+"` of type "+("`"+St+"` supplied to `"+me+"`, expected ")+("`"+Y+"`."),{expectedType:Y})}return null}return v(se)}function T(){return v(l)}function E(Y){function se(ve,Ae,me,Oe,Xe){if(typeof Y!="function")return new b("Property `"+Xe+"` of component `"+me+"` has invalid PropType notation inside arrayOf.");var Je=ve[Ae];if(!Array.isArray(Je)){var it=W(Je);return new b("Invalid "+Oe+" `"+Xe+"` of type "+("`"+it+"` supplied to `"+me+"`, expected an array."))}for(var dt=0;dt<Je.length;dt++){var St=Y(Je,dt,me,Oe,Xe+"["+dt+"]",i);if(St instanceof Error)return St}return null}return v(se)}function C(){function Y(se,ve,Ae,me,Oe){var Xe=se[ve];if(!u(Xe)){var Je=W(Xe);return new b("Invalid "+me+" `"+Oe+"` of type "+("`"+Je+"` supplied to `"+Ae+"`, expected a single ReactElement."))}return null}return v(Y)}function R(){function Y(se,ve,Ae,me,Oe){var Xe=se[ve];if(!r.isValidElementType(Xe)){var Je=W(Xe);return new b("Invalid "+me+" `"+Oe+"` of type "+("`"+Je+"` supplied to `"+Ae+"`, expected a single ReactElement type."))}return null}return v(Y)}function B(Y){function se(ve,Ae,me,Oe,Xe){if(!(ve[Ae]instanceof Y)){var Je=Y.name||g,it=te(ve[Ae]);return new b("Invalid "+Oe+" `"+Xe+"` of type "+("`"+it+"` supplied to `"+me+"`, expected ")+("instance of `"+Je+"`."))}return null}return v(se)}function I(Y){if(!Array.isArray(Y))return process.env.NODE_ENV!=="production"&&(arguments.length>1?o("Invalid arguments supplied to oneOf, expected an array, got "+arguments.length+" arguments. A common mistake is to write oneOf(x, y, z) instead of oneOf([x, y, z])."):o("Invalid argument supplied to oneOf, expected an array.")),l;function se(ve,Ae,me,Oe,Xe){for(var Je=ve[Ae],it=0;it<Y.length;it++)if(y(Je,Y[it]))return null;var dt=JSON.stringify(Y,function(St,Qt){var yt=G(Qt);return yt==="symbol"?String(Qt):Qt});return new b("Invalid "+Oe+" `"+Xe+"` of value `"+String(Je)+"` "+("supplied to `"+me+"`, expected one of "+dt+"."))}return v(se)}function N(Y){function se(ve,Ae,me,Oe,Xe){if(typeof Y!="function")return new b("Property `"+Xe+"` of component `"+me+"` has invalid PropType notation inside objectOf.");var Je=ve[Ae],it=W(Je);if(it!=="object")return new b("Invalid "+Oe+" `"+Xe+"` of type "+("`"+it+"` supplied to `"+me+"`, expected an object."));for(var dt in Je)if(n(Je,dt)){var St=Y(Je,dt,me,Oe,Xe+"."+dt,i);if(St instanceof Error)return St}return null}return v(se)}function D(Y){if(!Array.isArray(Y))return process.env.NODE_ENV!=="production"&&o("Invalid argument supplied to oneOfType, expected an instance of array."),l;for(var se=0;se<Y.length;se++){var ve=Y[se];if(typeof ve!="function")return o("Invalid argument supplied to oneOfType. Expected an array of check functions, but received "+z(ve)+" at index "+se+"."),l}function Ae(me,Oe,Xe,Je,it){for(var dt=[],St=0;St<Y.length;St++){var Qt=Y[St],yt=Qt(me,Oe,Xe,Je,it,i);if(yt==null)return null;yt.data&&n(yt.data,"expectedType")&&dt.push(yt.data.expectedType)}var bi=dt.length>0?", expected one of type ["+dt.join(", ")+"]":"";return new b("Invalid "+Je+" `"+it+"` supplied to "+("`"+Xe+"`"+bi+"."))}return v(Ae)}function P(){function Y(se,ve,Ae,me,Oe){return j(se[ve])?null:new b("Invalid "+me+" `"+Oe+"` supplied to "+("`"+Ae+"`, expected a ReactNode."))}return v(Y)}function k(Y,se,ve,Ae,me){return new b((Y||"React class")+": "+se+" type `"+ve+"."+Ae+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+me+"`.")}function q(Y){function se(ve,Ae,me,Oe,Xe){var Je=ve[Ae],it=W(Je);if(it!=="object")return new b("Invalid "+Oe+" `"+Xe+"` of type `"+it+"` "+("supplied to `"+me+"`, expected `object`."));for(var dt in Y){var St=Y[dt];if(typeof St!="function")return k(me,Oe,Xe,dt,G(St));var Qt=St(Je,dt,me,Oe,Xe+"."+dt,i);if(Qt)return Qt}return null}return v(se)}function V(Y){function se(ve,Ae,me,Oe,Xe){var Je=ve[Ae],it=W(Je);if(it!=="object")return new b("Invalid "+Oe+" `"+Xe+"` of type `"+it+"` "+("supplied to `"+me+"`, expected `object`."));var dt=e({},ve[Ae],Y);for(var St in dt){var Qt=Y[St];if(n(Y,St)&&typeof Qt!="function")return k(me,Oe,Xe,St,G(Qt));if(!Qt)return new b("Invalid "+Oe+" `"+Xe+"` key `"+St+"` supplied to `"+me+"`.\nBad object: "+JSON.stringify(ve[Ae],null,"  ")+`
Valid keys: `+JSON.stringify(Object.keys(Y),null,"  "));var yt=Qt(Je,St,me,Oe,Xe+"."+St,i);if(yt)return yt}return null}return v(se)}function j(Y){switch(typeof Y){case"number":case"string":case"undefined":return!0;case"boolean":return!Y;case"object":if(Array.isArray(Y))return Y.every(j);if(Y===null||u(Y))return!0;var se=f(Y);if(se){var ve=se.call(Y),Ae;if(se!==Y.entries){for(;!(Ae=ve.next()).done;)if(!j(Ae.value))return!1}else for(;!(Ae=ve.next()).done;){var me=Ae.value;if(me&&!j(me[1]))return!1}}else return!1;return!0;default:return!1}}function Q(Y,se){return Y==="symbol"?!0:se?se["@@toStringTag"]==="Symbol"||typeof Symbol=="function"&&se instanceof Symbol:!1}function W(Y){var se=typeof Y;return Array.isArray(Y)?"array":Y instanceof RegExp?"object":Q(se,Y)?"symbol":se}function G(Y){if(typeof Y>"u"||Y===null)return""+Y;var se=W(Y);if(se==="object"){if(Y instanceof Date)return"date";if(Y instanceof RegExp)return"regexp"}return se}function z(Y){var se=G(Y);switch(se){case"array":case"object":return"an "+se;case"boolean":case"date":case"regexp":return"a "+se;default:return se}}function te(Y){return!Y.constructor||!Y.constructor.name?g:Y.constructor.name}return m.checkPropTypes=s,m.resetWarningCache=s.resetWarningCache,m.PropTypes=m,m},xM}var _M,LF;function Sce(){if(LF)return _M;LF=1;var r=vM();function e(){}function i(){}return i.resetWarningCache=e,_M=function(){function n(l,u,c,h,p,f){if(f!==r){var g=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw g.name="Invariant Violation",g}}n.isRequired=n;function s(){return n}var o={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:s,element:n,elementType:n,instanceOf:s,node:n,objectOf:s,oneOf:s,oneOfType:s,shape:s,exact:s,checkPropTypes:i,resetWarningCache:e};return o.PropTypes=o,o},_M}if(process.env.NODE_ENV!=="production"){var Tce=wF(),Mce=!0;mM.exports=Cce()(Tce.isElement,Mce)}else mM.exports=Sce()();var Rce=mM.exports;const bt=l2(Rce);function EM(r,e){(e==null||e>r.length)&&(e=r.length);for(var i=0,n=Array(e);i<e;i++)n[i]=r[i];return n}function Ice(r){if(Array.isArray(r))return r}function Bce(r){if(Array.isArray(r))return EM(r)}function c1(r,e,i){return(e=kce(e))in r?Object.defineProperty(r,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[e]=i,r}function Lce(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function Dce(r,e){var i=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(i!=null){var n,s,o,l,u=[],c=!0,h=!1;try{if(o=(i=i.call(r)).next,e!==0)for(;!(c=(n=o.call(i)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(p){h=!0,s=p}finally{try{if(!c&&i.return!=null&&(l=i.return(),Object(l)!==l))return}finally{if(h)throw s}}return u}}function Nce(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Pce(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function DF(r,e){var i=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),i.push.apply(i,n)}return i}function NF(r){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?DF(Object(i),!0).forEach(function(n){c1(r,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):DF(Object(i)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(i,n))})}return r}function u1(r,e){return Ice(r)||Dce(r,e)||PF(r,e)||Nce()}function h1(r){return Bce(r)||Lce(r)||PF(r)||Pce()}function Oce(r,e){if(typeof r!="object"||!r)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var n=i.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function kce(r){var e=Oce(r,"string");return typeof e=="symbol"?e:e+""}function PF(r,e){if(r){if(typeof r=="string")return EM(r,e);var i={}.toString.call(r).slice(8,-1);return i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set"?Array.from(r):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?EM(r,e):void 0}}var Fce=wp({props:{width:{},height:{},yOffset:{default:1.5},glScale:{default:200},jsonUrl:{},graphData:{default:{nodes:[],links:[]}},numDimensions:{default:3},dagMode:{},dagLevelDistance:{},dagNodeFilter:{default:function(){return!0}},onDagError:{default:void 0},nodeRelSize:{default:4},nodeId:{default:"id"},nodeVal:{default:"val"},nodeResolution:{default:8},nodeVisibility:{default:!0},nodeColor:{default:"color"},nodeAutoColorBy:{},nodeOpacity:{default:.75},nodeThreeObject:{},nodeThreeObjectExtend:{default:!1},linkSource:{default:"source"},linkTarget:{default:"target"},linkVisibility:{default:!0},linkColor:{default:"color"},linkAutoColorBy:{},linkOpacity:{default:.2},linkWidth:{default:0},linkResolution:{default:6},linkCurvature:{default:0},linkCurveRotation:{default:0},linkMaterial:{},linkThreeObject:{},linkThreeObjectExtend:{default:!1},linkPositionUpdate:{},linkDirectionalArrowLength:{default:0},linkDirectionalArrowColor:{},linkDirectionalArrowRelPos:{default:.5},linkDirectionalArrowResolution:{default:8},linkDirectionalParticles:{default:0},linkDirectionalParticleSpeed:{default:.01},linkDirectionalParticleWidth:{default:.5},linkDirectionalParticleColor:{},linkDirectionalParticleResolution:{default:4},onNodeHover:{},onNodeClick:{},onLinkHover:{},onLinkClick:{},forceEngine:{default:"d3"},d3AlphaMin:{default:0},d3AlphaDecay:{default:.0228},d3VelocityDecay:{default:.4},ngraphPhysics:{},warmupTicks:{default:0},cooldownTicks:{},cooldownTime:{default:15e3},onEngineTick:{},onEngineStop:{}},methods:NF(NF({},Object.assign.apply(Object,[{}].concat(h1(["getGraphBbox","emitParticle","d3Force","d3ReheatSimulation","refresh"].map(function(r){return c1({},r,function(e){for(var i=e.forcegraph.components.forcegraph,n=arguments.length,s=new Array(n>1?n-1:0),o=1;o<n;o++)s[o-1]=arguments[o];var l=i[r].apply(i,s);return l===i?this:l})}))))),{},{_destructor:function(){this.graphData({nodes:[],links:[]})}}),init:function(r,e){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=i.markerAttrs,s=n===void 0?{preset:"hiro"}:n;r.innerHTML="",e.container=document.createElement("div"),r.appendChild(e.container);var o=document.createElement("a-scene");o.setAttribute("embedded",""),o.setAttribute("vr-mode-ui","enabled: false"),o.setAttribute("arjs","debugUIEnabled: false;");var l=document.createElement("a-marker");Object.entries(s).forEach(function(h){var p=u1(h,2),f=p[0],g=p[1];return l.setAttribute(f,g)}),o.appendChild(l);var u;o.appendChild(u=document.createElement("a-entity")),u.setAttribute("cursor"),u.setAttribute("raycaster","objects: [forcegraph]"),e.forcegraph=document.createElement("a-entity"),e.forcegraph.setAttribute("forcegraph",null),l.appendChild(e.forcegraph);var c=document.createElement("a-entity");c.setAttribute("camera",""),o.appendChild(c),e.container.appendChild(o)},update:function(r,e){e.hasOwnProperty("width")&&r.width&&(r.container.style.width="".concat(r.width,"px")),e.hasOwnProperty("height")&&r.height&&(r.container.style.height="".concat(r.height,"px")),e.hasOwnProperty("glScale")&&r.forcegraph.setAttribute("scale",h1(new Array(3)).map(function(){return 1/r.glScale}).join(" ")),e.hasOwnProperty("yOffset")&&r.forcegraph.setAttribute("position","0 ".concat(r.yOffset," 0"));var i=["jsonUrl","numDimensions","dagMode","dagLevelDistance","dagNodeFilter","onDagError","nodeRelSize","nodeId","nodeVal","nodeResolution","nodeVisibility","nodeColor","nodeAutoColorBy","nodeOpacity","nodeThreeObject","nodeThreeObjectExtend","linkSource","linkTarget","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","onNodeHover","onNodeClick","onLinkHover","onLinkClick","forceEngine","d3AlphaMin","d3AlphaDecay","d3VelocityDecay","ngraphPhysics","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"],n=Object.assign.apply(Object,[{}].concat(h1(Object.entries(r).filter(function(s){var o=u1(s,2),l=o[0],u=o[1];return e.hasOwnProperty(l)&&i.indexOf(l)!==-1&&u!==void 0&&u!==null}).map(function(s){var o=u1(s,2),l=o[0],u=o[1];return c1({},l,u)})),h1(Object.entries(r.graphData).map(function(s){var o=u1(s,2),l=o[0],u=o[1];return c1({},l,u)}))));r.forcegraph.setAttribute("forcegraph",n)}});const Km=new lc,zu=new ji,OF=new at,wM=new ji,d1=new ji,p1=new at,CM=new at,kF=new gs,FF=new at,UF=new at;let Vo=null,Qc=null;const ju=[],sd={NONE:-1,PAN:0,ROTATE:1};class Uce extends Dx{constructor(e,i,n=null){super(i,n),this.objects=e,this.recursive=!0,this.transformGroup=!1,this.rotateSpeed=1,this.raycaster=new L4,this.mouseButtons={LEFT:ka.PAN,MIDDLE:ka.PAN,RIGHT:ka.ROTATE},this.touches={ONE:bu.PAN},this._onPointerMove=zce.bind(this),this._onPointerDown=jce.bind(this),this._onPointerCancel=Vce.bind(this),this._onContextMenu=Gce.bind(this),n!==null&&this.connect()}connect(){this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerCancel),this.domElement.addEventListener("pointerleave",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerCancel),this.domElement.removeEventListener("pointerleave",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto",this.domElement.style.cursor=""}dispose(){this.disconnect()}_updatePointer(e){const i=this.domElement.getBoundingClientRect();zu.x=(e.clientX-i.left)/i.width*2-1,zu.y=-(e.clientY-i.top)/i.height*2+1}_updateState(e){let i;if(e.pointerType==="touch")i=this.touches.ONE;else switch(e.button){case 0:i=this.mouseButtons.LEFT;break;case 1:i=this.mouseButtons.MIDDLE;break;case 2:i=this.mouseButtons.RIGHT;break;default:i=null}switch(i){case ka.PAN:case bu.PAN:this.state=sd.PAN;break;case ka.ROTATE:case bu.ROTATE:this.state=sd.ROTATE;break;default:this.state=sd.NONE}}getRaycaster(){return console.warn("THREE.DragControls: getRaycaster() has been deprecated. Use controls.raycaster instead."),this.raycaster}setObjects(e){console.warn("THREE.DragControls: setObjects() has been deprecated. Use controls.objects instead."),this.objects=e}getObjects(){return console.warn("THREE.DragControls: getObjects() has been deprecated. Use controls.objects instead."),this.objects}activate(){console.warn("THREE.DragControls: activate() has been renamed to connect()."),this.connect()}deactivate(){console.warn("THREE.DragControls: deactivate() has been renamed to disconnect()."),this.disconnect()}set mode(e){console.warn("THREE.DragControls: The .mode property has been removed. Define the type of transformation via the .mouseButtons or .touches properties.")}get mode(){console.warn("THREE.DragControls: The .mode property has been removed. Define the type of transformation via the .mouseButtons or .touches properties.")}}function zce(r){const e=this.object,i=this.domElement,n=this.raycaster;if(this.enabled!==!1){if(this._updatePointer(r),n.setFromCamera(zu,e),Vo)this.state===sd.PAN?n.ray.intersectPlane(Km,p1)&&Vo.position.copy(p1.sub(OF).applyMatrix4(kF)):this.state===sd.ROTATE&&(wM.subVectors(zu,d1).multiplyScalar(this.rotateSpeed),Vo.rotateOnWorldAxis(FF,wM.x),Vo.rotateOnWorldAxis(UF.normalize(),-wM.y)),this.dispatchEvent({type:"drag",object:Vo}),d1.copy(zu);else if(r.pointerType==="mouse"||r.pointerType==="pen")if(ju.length=0,n.setFromCamera(zu,e),n.intersectObjects(this.objects,this.recursive,ju),ju.length>0){const s=ju[0].object;Km.setFromNormalAndCoplanarPoint(e.getWorldDirection(Km.normal),CM.setFromMatrixPosition(s.matrixWorld)),Qc!==s&&Qc!==null&&(this.dispatchEvent({type:"hoveroff",object:Qc}),i.style.cursor="auto",Qc=null),Qc!==s&&(this.dispatchEvent({type:"hoveron",object:s}),i.style.cursor="pointer",Qc=s)}else Qc!==null&&(this.dispatchEvent({type:"hoveroff",object:Qc}),i.style.cursor="auto",Qc=null);d1.copy(zu)}}function jce(r){const e=this.object,i=this.domElement,n=this.raycaster;this.enabled!==!1&&(this._updatePointer(r),this._updateState(r),ju.length=0,n.setFromCamera(zu,e),n.intersectObjects(this.objects,this.recursive,ju),ju.length>0&&(this.transformGroup===!0?Vo=zF(ju[0].object):Vo=ju[0].object,Km.setFromNormalAndCoplanarPoint(e.getWorldDirection(Km.normal),CM.setFromMatrixPosition(Vo.matrixWorld)),n.ray.intersectPlane(Km,p1)&&(this.state===sd.PAN?(kF.copy(Vo.parent.matrixWorld).invert(),OF.copy(p1).sub(CM.setFromMatrixPosition(Vo.matrixWorld))):this.state===sd.ROTATE&&(FF.set(0,1,0).applyQuaternion(e.quaternion).normalize(),UF.set(1,0,0).applyQuaternion(e.quaternion).normalize())),i.style.cursor="move",this.dispatchEvent({type:"dragstart",object:Vo})),d1.copy(zu))}function Vce(){this.enabled!==!1&&(Vo&&(this.dispatchEvent({type:"dragend",object:Vo}),Vo=null),this.domElement.style.cursor=Qc?"pointer":"auto",this.state=sd.NONE)}function Gce(r){this.enabled!==!1&&r.preventDefault()}function zF(r,e=null){return r.isGroup&&(e=r),r.parent===null?e:zF(r.parent,e)}/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const f1="170",Hce=0,Wce=1,Qce=2,qce=1,m1=3,Jm=0,mc=1,Zm=2,$m=0,ad=1,g1=2,A1=3,y1=4,jF=5,od=100,VF=101,GF=102,Xce=103,Yce=104,HF=200,WF=201,QF=202,qF=203,v1=204,b1=205,XF=206,YF=207,KF=208,JF=209,ZF=210,$F=0,eU=1,tU=2,x1=3,iU=4,rU=5,nU=6,sU=7,_1=0,Kce=1,Jce=2,eg=0,Zce=1,$ce=2,eue=3,tue=4,iue=6,rue=7,SM=300,Lp=301,tg=302,YA=303,KA=304,TM=306,E1=1e3,ig=1001,w1=1002,to=1003,MM=1004,rg=1005,dl=1006,RM=1007,Vu=1008,ld=1009,JA=1010,ZA=1011,ng=1012,_o=1013,Fa=1014,pl=1015,Gu=1016,nue=1017,sue=1018,$A=1020,aU=35902,aue=1021,IM=1022,sg=1023,oue=1024,lue=1025,Dp=1026,ag=1027,BM=1028,LM=1029,ey=1030,DM=1031,cue=1032,NM=1033,PM=33776,C1=33777,S1=33778,T1=33779,oU=35840,lU=35841,cU=35842,uU=35843,hU=36196,OM=37492,kM=37496,FM=37808,UM=37809,zM=37810,jM=37811,VM=37812,GM=37813,HM=37814,WM=37815,QM=37816,qM=37817,XM=37818,YM=37819,KM=37820,JM=37821,ZM=36492,uue=36283,dU=36284,pU=36285,fU=36286,cd=0,hue=1,Np="",Dr="srgb",ud="srgb-linear",mU="linear",ty="srgb",due=0,Pp=7680,pue=7681,fue=7682,mue=7683,gue=34055,Aue=34056,yue=5386,vue=512,bue=513,xue=514,_ue=515,Eue=516,wue=517,Cue=518,$M=519,gU=512,e3=513,AU=514,yU=515,vU=516,bU=517,xU=518,_U=519,M1=35044,og=35048,gc=2e3,Op=2001;class lg{addEventListener(e,i){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(i)===-1&&n[e].push(i)}hasEventListener(e,i){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(i)!==-1}removeEventListener(e,i){if(this._listeners===void 0)return;const n=this._listeners[e];if(n!==void 0){const s=n.indexOf(i);s!==-1&&n.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const n=i.slice(0);for(let s=0,o=n.length;s<o;s++)n[s].call(this,e);e.target=null}}}const io=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let EU=1234567;const iy=Math.PI/180,ry=180/Math.PI;function Hu(){const r=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(io[r&255]+io[r>>8&255]+io[r>>16&255]+io[r>>24&255]+"-"+io[e&255]+io[e>>8&255]+"-"+io[e>>16&15|64]+io[e>>24&255]+"-"+io[i&63|128]+io[i>>8&255]+"-"+io[i>>16&255]+io[i>>24&255]+io[n&255]+io[n>>8&255]+io[n>>16&255]+io[n>>24&255]).toLowerCase()}function Ua(r,e,i){return Math.max(e,Math.min(i,r))}function t3(r,e){return(r%e+e)%e}function Sue(r,e,i,n,s){return n+(r-e)*(s-n)/(i-e)}function Tue(r,e,i){return r!==e?(i-r)/(e-r):0}function ny(r,e,i){return(1-i)*r+i*e}function Mue(r,e,i,n){return ny(r,e,1-Math.exp(-i*n))}function Rue(r,e=1){return e-Math.abs(t3(r,e*2)-e)}function Iue(r,e,i){return r<=e?0:r>=i?1:(r=(r-e)/(i-e),r*r*(3-2*r))}function Bue(r,e,i){return r<=e?0:r>=i?1:(r=(r-e)/(i-e),r*r*r*(r*(r*6-15)+10))}function Lue(r,e){return r+Math.floor(Math.random()*(e-r+1))}function Due(r,e){return r+Math.random()*(e-r)}function Nue(r){return r*(.5-Math.random())}function Pue(r){r!==void 0&&(EU=r);let e=EU+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function Oue(r){return r*iy}function kue(r){return r*ry}function Fue(r){return(r&r-1)===0&&r!==0}function Uue(r){return Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function zue(r){return Math.pow(2,Math.floor(Math.log(r)/Math.LN2))}function jue(r,e,i,n,s){const o=Math.cos,l=Math.sin,u=o(i/2),c=l(i/2),h=o((e+n)/2),p=l((e+n)/2),f=o((e-n)/2),g=l((e-n)/2),m=o((n-e)/2),y=l((n-e)/2);switch(s){case"XYX":r.set(u*p,c*f,c*g,u*h);break;case"YZY":r.set(c*g,u*p,c*f,u*h);break;case"ZXZ":r.set(c*f,c*g,u*p,u*h);break;case"XZX":r.set(u*p,c*y,c*m,u*h);break;case"YXY":r.set(c*m,u*p,c*y,u*h);break;case"ZYZ":r.set(c*y,c*m,u*p,u*h);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function Eo(r,e){switch(e.constructor){case Float32Array:return r;case Uint32Array:return r/4294967295;case Uint16Array:return r/65535;case Uint8Array:return r/255;case Int32Array:return Math.max(r/2147483647,-1);case Int16Array:return Math.max(r/32767,-1);case Int8Array:return Math.max(r/127,-1);default:throw new Error("Invalid component type.")}}function en(r,e){switch(e.constructor){case Float32Array:return r;case Uint32Array:return Math.round(r*4294967295);case Uint16Array:return Math.round(r*65535);case Uint8Array:return Math.round(r*255);case Int32Array:return Math.round(r*2147483647);case Int16Array:return Math.round(r*32767);case Int8Array:return Math.round(r*127);default:throw new Error("Invalid component type.")}}const Vue={DEG2RAD:iy,RAD2DEG:ry,generateUUID:Hu,clamp:Ua,euclideanModulo:t3,mapLinear:Sue,inverseLerp:Tue,lerp:ny,damp:Mue,pingpong:Rue,smoothstep:Iue,smootherstep:Bue,randInt:Lue,randFloat:Due,randFloatSpread:Nue,seededRandom:Pue,degToRad:Oue,radToDeg:kue,isPowerOfTwo:Fue,ceilPowerOfTwo:Uue,floorPowerOfTwo:zue,setQuaternionFromProperEuler:jue,normalize:en,denormalize:Eo};class Dn{constructor(e=0,i=0){Dn.prototype.isVector2=!0,this.x=e,this.y=i}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,i){return this.x=e,this.y=i,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const i=this.x,n=this.y,s=e.elements;return this.x=s[0]*i+s[3]*n+s[6],this.y=s[1]*i+s[4]*n+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this}clampLength(e,i){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(i,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const n=this.dot(e)/i;return Math.acos(Ua(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,n=this.y-e.y;return i*i+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this}lerpVectors(e,i,n){return this.x=e.x+(i.x-e.x)*n,this.y=e.y+(i.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this}rotateAround(e,i){const n=Math.cos(i),s=Math.sin(i),o=this.x-e.x,l=this.y-e.y;return this.x=o*n-l*s+e.x,this.y=o*s+l*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Go{constructor(e,i,n,s,o,l,u,c,h){Go.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,i,n,s,o,l,u,c,h)}set(e,i,n,s,o,l,u,c,h){const p=this.elements;return p[0]=e,p[1]=s,p[2]=u,p[3]=i,p[4]=o,p[5]=c,p[6]=n,p[7]=l,p[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const i=this.elements,n=e.elements;return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],this}extractBasis(e,i,n){return e.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const i=e.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const n=e.elements,s=i.elements,o=this.elements,l=n[0],u=n[3],c=n[6],h=n[1],p=n[4],f=n[7],g=n[2],m=n[5],y=n[8],b=s[0],v=s[3],_=s[6],T=s[1],E=s[4],C=s[7],R=s[2],B=s[5],I=s[8];return o[0]=l*b+u*T+c*R,o[3]=l*v+u*E+c*B,o[6]=l*_+u*C+c*I,o[1]=h*b+p*T+f*R,o[4]=h*v+p*E+f*B,o[7]=h*_+p*C+f*I,o[2]=g*b+m*T+y*R,o[5]=g*v+m*E+y*B,o[8]=g*_+m*C+y*I,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=e,i[4]*=e,i[7]*=e,i[2]*=e,i[5]*=e,i[8]*=e,this}determinant(){const e=this.elements,i=e[0],n=e[1],s=e[2],o=e[3],l=e[4],u=e[5],c=e[6],h=e[7],p=e[8];return i*l*p-i*u*h-n*o*p+n*u*c+s*o*h-s*l*c}invert(){const e=this.elements,i=e[0],n=e[1],s=e[2],o=e[3],l=e[4],u=e[5],c=e[6],h=e[7],p=e[8],f=p*l-u*h,g=u*c-p*o,m=h*o-l*c,y=i*f+n*g+s*m;if(y===0)return this.set(0,0,0,0,0,0,0,0,0);const b=1/y;return e[0]=f*b,e[1]=(s*h-p*n)*b,e[2]=(u*n-s*l)*b,e[3]=g*b,e[4]=(p*i-s*c)*b,e[5]=(s*o-u*i)*b,e[6]=m*b,e[7]=(n*c-h*i)*b,e[8]=(l*i-n*o)*b,this}transpose(){let e;const i=this.elements;return e=i[1],i[1]=i[3],i[3]=e,e=i[2],i[2]=i[6],i[6]=e,e=i[5],i[5]=i[7],i[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const i=this.elements;return e[0]=i[0],e[1]=i[3],e[2]=i[6],e[3]=i[1],e[4]=i[4],e[5]=i[7],e[6]=i[2],e[7]=i[5],e[8]=i[8],this}setUvTransform(e,i,n,s,o,l,u){const c=Math.cos(o),h=Math.sin(o);return this.set(n*c,n*h,-n*(c*l+h*u)+l+e,-s*h,s*c,-s*(-h*l+c*u)+u+i,0,0,1),this}scale(e,i){return this.premultiply(i3.makeScale(e,i)),this}rotate(e){return this.premultiply(i3.makeRotation(-e)),this}translate(e,i){return this.premultiply(i3.makeTranslation(e,i)),this}makeTranslation(e,i){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,i,0,0,1),this}makeRotation(e){const i=Math.cos(e),n=Math.sin(e);return this.set(i,-n,0,n,i,0,0,0,1),this}makeScale(e,i){return this.set(e,0,0,0,i,0,0,0,1),this}equals(e){const i=this.elements,n=e.elements;for(let s=0;s<9;s++)if(i[s]!==n[s])return!1;return!0}fromArray(e,i=0){for(let n=0;n<9;n++)this.elements[n]=e[n+i];return this}toArray(e=[],i=0){const n=this.elements;return e[i]=n[0],e[i+1]=n[1],e[i+2]=n[2],e[i+3]=n[3],e[i+4]=n[4],e[i+5]=n[5],e[i+6]=n[6],e[i+7]=n[7],e[i+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const i3=new Go;function Gue(r){for(let e=r.length-1;e>=0;--e)if(r[e]>=65535)return!0;return!1}function r3(r){return document.createElementNS("http://www.w3.org/1999/xhtml",r)}function Hue(){const r=r3("canvas");return r.style.display="block",r}const wU={};function Wue(r){r in wU||(wU[r]=!0,console.warn(r))}const ta={enabled:!0,workingColorSpace:ud,spaces:{},convert:function(r,e,i){return this.enabled===!1||e===i||!e||!i||(this.spaces[e].transfer===ty&&(r.r=Wu(r.r),r.g=Wu(r.g),r.b=Wu(r.b)),this.spaces[e].primaries!==this.spaces[i].primaries&&(r.applyMatrix3(this.spaces[e].toXYZ),r.applyMatrix3(this.spaces[i].fromXYZ)),this.spaces[i].transfer===ty&&(r.r=cg(r.r),r.g=cg(r.g),r.b=cg(r.b))),r},fromWorkingColorSpace:function(r,e){return this.convert(r,this.workingColorSpace,e)},toWorkingColorSpace:function(r,e){return this.convert(r,e,this.workingColorSpace)},getPrimaries:function(r){return this.spaces[r].primaries},getTransfer:function(r){return r===Np?mU:this.spaces[r].transfer},getLuminanceCoefficients:function(r,e=this.workingColorSpace){return r.fromArray(this.spaces[e].luminanceCoefficients)},define:function(r){Object.assign(this.spaces,r)},_getMatrix:function(r,e,i){return r.copy(this.spaces[e].toXYZ).multiply(this.spaces[i].fromXYZ)},_getDrawingBufferColorSpace:function(r){return this.spaces[r].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(r=this.workingColorSpace){return this.spaces[r].workingColorSpaceConfig.unpackColorSpace}};function Wu(r){return r<.04045?r*.0773993808:Math.pow(r*.9478672986+.0521327014,2.4)}function cg(r){return r<.0031308?r*12.92:1.055*Math.pow(r,.41666)-.055}const CU=[.64,.33,.3,.6,.15,.06],SU=[.2126,.7152,.0722],TU=[.3127,.329],MU=new Go().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),RU=new Go().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);ta.define({[ud]:{primaries:CU,whitePoint:TU,transfer:mU,toXYZ:MU,fromXYZ:RU,luminanceCoefficients:SU,workingColorSpaceConfig:{unpackColorSpace:Dr},outputColorSpaceConfig:{drawingBufferColorSpace:Dr}},[Dr]:{primaries:CU,whitePoint:TU,transfer:ty,toXYZ:MU,fromXYZ:RU,luminanceCoefficients:SU,outputColorSpaceConfig:{drawingBufferColorSpace:Dr}}});let ug;class Que{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let i;if(e instanceof HTMLCanvasElement)i=e;else{ug===void 0&&(ug=r3("canvas")),ug.width=e.width,ug.height=e.height;const n=ug.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),i=ug}return i.width>2048||i.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),i.toDataURL("image/jpeg",.6)):i.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const i=r3("canvas");i.width=e.width,i.height=e.height;const n=i.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const s=n.getImageData(0,0,e.width,e.height),o=s.data;for(let l=0;l<o.length;l++)o[l]=Wu(o[l]/255)*255;return n.putImageData(s,0,0),i}else if(e.data){const i=e.data.slice(0);for(let n=0;n<i.length;n++)i instanceof Uint8Array||i instanceof Uint8ClampedArray?i[n]=Math.floor(Wu(i[n]/255)*255):i[n]=Wu(i[n]);return{data:i,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let que=0;class IU{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:que++}),this.uuid=Hu(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},s=this.data;if(s!==null){let o;if(Array.isArray(s)){o=[];for(let l=0,u=s.length;l<u;l++)s[l].isDataTexture?o.push(n3(s[l].image)):o.push(n3(s[l]))}else o=n3(s);n.url=o}return i||(e.images[this.uuid]=n),n}}function n3(r){return typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap?Que.getDataURL(r):r.data?{data:Array.from(r.data),width:r.width,height:r.height,type:r.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Xue=0;class wo extends lg{constructor(e=wo.DEFAULT_IMAGE,i=wo.DEFAULT_MAPPING,n=ig,s=ig,o=dl,l=Vu,u=sg,c=ld,h=wo.DEFAULT_ANISOTROPY,p=Np){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Xue++}),this.uuid=Hu(),this.name="",this.source=new IU(e),this.mipmaps=[],this.mapping=i,this.channel=0,this.wrapS=n,this.wrapT=s,this.magFilter=o,this.minFilter=l,this.anisotropy=h,this.format=u,this.internalFormat=null,this.type=c,this.offset=new Dn(0,0),this.repeat=new Dn(1,1),this.center=new Dn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Go,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=p,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),i||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==SM)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case E1:e.x=e.x-Math.floor(e.x);break;case ig:e.x=e.x<0?0:1;break;case w1:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case E1:e.y=e.y-Math.floor(e.y);break;case ig:e.y=e.y<0?0:1;break;case w1:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}wo.DEFAULT_IMAGE=null,wo.DEFAULT_MAPPING=SM,wo.DEFAULT_ANISOTROPY=1;class Jn{constructor(e=0,i=0,n=0,s=1){Jn.prototype.isVector4=!0,this.x=e,this.y=i,this.z=n,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,i,n,s){return this.x=e,this.y=i,this.z=n,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this.w=e.w+i.w,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this.w+=e.w*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this.w=e.w-i.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const i=this.x,n=this.y,s=this.z,o=this.w,l=e.elements;return this.x=l[0]*i+l[4]*n+l[8]*s+l[12]*o,this.y=l[1]*i+l[5]*n+l[9]*s+l[13]*o,this.z=l[2]*i+l[6]*n+l[10]*s+l[14]*o,this.w=l[3]*i+l[7]*n+l[11]*s+l[15]*o,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const i=Math.sqrt(1-e.w*e.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/i,this.y=e.y/i,this.z=e.z/i),this}setAxisAngleFromRotationMatrix(e){let i,n,s,o;const l=e.elements,u=l[0],c=l[4],h=l[8],p=l[1],f=l[5],g=l[9],m=l[2],y=l[6],b=l[10];if(Math.abs(c-p)<.01&&Math.abs(h-m)<.01&&Math.abs(g-y)<.01){if(Math.abs(c+p)<.1&&Math.abs(h+m)<.1&&Math.abs(g+y)<.1&&Math.abs(u+f+b-3)<.1)return this.set(1,0,0,0),this;i=Math.PI;const _=(u+1)/2,T=(f+1)/2,E=(b+1)/2,C=(c+p)/4,R=(h+m)/4,B=(g+y)/4;return _>T&&_>E?_<.01?(n=0,s=.707106781,o=.707106781):(n=Math.sqrt(_),s=C/n,o=R/n):T>E?T<.01?(n=.707106781,s=0,o=.707106781):(s=Math.sqrt(T),n=C/s,o=B/s):E<.01?(n=.707106781,s=.707106781,o=0):(o=Math.sqrt(E),n=R/o,s=B/o),this.set(n,s,o,i),this}let v=Math.sqrt((y-g)*(y-g)+(h-m)*(h-m)+(p-c)*(p-c));return Math.abs(v)<.001&&(v=1),this.x=(y-g)/v,this.y=(h-m)/v,this.z=(p-c)/v,this.w=Math.acos((u+f+b-1)/2),this}setFromMatrixPosition(e){const i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this.w=i[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this.w=Math.max(e.w,Math.min(i.w,this.w)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this.w=Math.max(e,Math.min(i,this.w)),this}clampLength(e,i){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(i,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this.w+=(e.w-this.w)*i,this}lerpVectors(e,i,n){return this.x=e.x+(i.x-e.x)*n,this.y=e.y+(i.y-e.y)*n,this.z=e.z+(i.z-e.z)*n,this.w=e.w+(i.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this.w=e[i+3],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e[i+3]=this.w,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this.w=e.getW(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class hg extends lg{constructor(e=1,i=1,n={}){super(),this.isRenderTarget=!0,this.width=e,this.height=i,this.depth=1,this.scissor=new Jn(0,0,e,i),this.scissorTest=!1,this.viewport=new Jn(0,0,e,i);const s={width:e,height:i,depth:1};n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:dl,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},n);const o=new wo(s,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace);o.flipY=!1,o.generateMipmaps=n.generateMipmaps,o.internalFormat=n.internalFormat,this.textures=[];const l=n.count;for(let u=0;u<l;u++)this.textures[u]=o.clone(),this.textures[u].isRenderTargetTexture=!0;this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this.depthTexture=n.depthTexture,this.samples=n.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,i,n=1){if(this.width!==e||this.height!==i||this.depth!==n){this.width=e,this.height=i,this.depth=n;for(let s=0,o=this.textures.length;s<o;s++)this.textures[s].image.width=e,this.textures[s].image.height=i,this.textures[s].image.depth=n;this.dispose()}this.viewport.set(0,0,e,i),this.scissor.set(0,0,e,i)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let n=0,s=e.textures.length;n<s;n++)this.textures[n]=e.textures[n].clone(),this.textures[n].isRenderTargetTexture=!0;const i=Object.assign({},e.texture.image);return this.texture.source=new IU(i),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Yue extends hg{constructor(e=1,i=1,n={}){super(e,i,n),this.isWebGLRenderTarget=!0}}class Kue extends wo{constructor(e=null,i=1,n=1,s=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:i,height:n,depth:s},this.magFilter=to,this.minFilter=to,this.wrapR=ig,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class sy{constructor(e=0,i=0,n=0,s=1){this.isQuaternion=!0,this._x=e,this._y=i,this._z=n,this._w=s}static slerpFlat(e,i,n,s,o,l,u){let c=n[s+0],h=n[s+1],p=n[s+2],f=n[s+3];const g=o[l+0],m=o[l+1],y=o[l+2],b=o[l+3];if(u===0){e[i+0]=c,e[i+1]=h,e[i+2]=p,e[i+3]=f;return}if(u===1){e[i+0]=g,e[i+1]=m,e[i+2]=y,e[i+3]=b;return}if(f!==b||c!==g||h!==m||p!==y){let v=1-u;const _=c*g+h*m+p*y+f*b,T=_>=0?1:-1,E=1-_*_;if(E>Number.EPSILON){const R=Math.sqrt(E),B=Math.atan2(R,_*T);v=Math.sin(v*B)/R,u=Math.sin(u*B)/R}const C=u*T;if(c=c*v+g*C,h=h*v+m*C,p=p*v+y*C,f=f*v+b*C,v===1-u){const R=1/Math.sqrt(c*c+h*h+p*p+f*f);c*=R,h*=R,p*=R,f*=R}}e[i]=c,e[i+1]=h,e[i+2]=p,e[i+3]=f}static multiplyQuaternionsFlat(e,i,n,s,o,l){const u=n[s],c=n[s+1],h=n[s+2],p=n[s+3],f=o[l],g=o[l+1],m=o[l+2],y=o[l+3];return e[i]=u*y+p*f+c*m-h*g,e[i+1]=c*y+p*g+h*f-u*m,e[i+2]=h*y+p*m+u*g-c*f,e[i+3]=p*y-u*f-c*g-h*m,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,i,n,s){return this._x=e,this._y=i,this._z=n,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,i=!0){const n=e._x,s=e._y,o=e._z,l=e._order,u=Math.cos,c=Math.sin,h=u(n/2),p=u(s/2),f=u(o/2),g=c(n/2),m=c(s/2),y=c(o/2);switch(l){case"XYZ":this._x=g*p*f+h*m*y,this._y=h*m*f-g*p*y,this._z=h*p*y+g*m*f,this._w=h*p*f-g*m*y;break;case"YXZ":this._x=g*p*f+h*m*y,this._y=h*m*f-g*p*y,this._z=h*p*y-g*m*f,this._w=h*p*f+g*m*y;break;case"ZXY":this._x=g*p*f-h*m*y,this._y=h*m*f+g*p*y,this._z=h*p*y+g*m*f,this._w=h*p*f-g*m*y;break;case"ZYX":this._x=g*p*f-h*m*y,this._y=h*m*f+g*p*y,this._z=h*p*y-g*m*f,this._w=h*p*f+g*m*y;break;case"YZX":this._x=g*p*f+h*m*y,this._y=h*m*f+g*p*y,this._z=h*p*y-g*m*f,this._w=h*p*f-g*m*y;break;case"XZY":this._x=g*p*f-h*m*y,this._y=h*m*f-g*p*y,this._z=h*p*y+g*m*f,this._w=h*p*f+g*m*y;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+l)}return i===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,i){const n=i/2,s=Math.sin(n);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const i=e.elements,n=i[0],s=i[4],o=i[8],l=i[1],u=i[5],c=i[9],h=i[2],p=i[6],f=i[10],g=n+u+f;if(g>0){const m=.5/Math.sqrt(g+1);this._w=.25/m,this._x=(p-c)*m,this._y=(o-h)*m,this._z=(l-s)*m}else if(n>u&&n>f){const m=2*Math.sqrt(1+n-u-f);this._w=(p-c)/m,this._x=.25*m,this._y=(s+l)/m,this._z=(o+h)/m}else if(u>f){const m=2*Math.sqrt(1+u-n-f);this._w=(o-h)/m,this._x=(s+l)/m,this._y=.25*m,this._z=(c+p)/m}else{const m=2*Math.sqrt(1+f-n-u);this._w=(l-s)/m,this._x=(o+h)/m,this._y=(c+p)/m,this._z=.25*m}return this._onChangeCallback(),this}setFromUnitVectors(e,i){let n=e.dot(i)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*i.z-e.z*i.y,this._y=e.z*i.x-e.x*i.z,this._z=e.x*i.y-e.y*i.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Ua(this.dot(e),-1,1)))}rotateTowards(e,i){const n=this.angleTo(e);if(n===0)return this;const s=Math.min(1,i/n);return this.slerp(e,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,i){const n=e._x,s=e._y,o=e._z,l=e._w,u=i._x,c=i._y,h=i._z,p=i._w;return this._x=n*p+l*u+s*h-o*c,this._y=s*p+l*c+o*u-n*h,this._z=o*p+l*h+n*c-s*u,this._w=l*p-n*u-s*c-o*h,this._onChangeCallback(),this}slerp(e,i){if(i===0)return this;if(i===1)return this.copy(e);const n=this._x,s=this._y,o=this._z,l=this._w;let u=l*e._w+n*e._x+s*e._y+o*e._z;if(u<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,u=-u):this.copy(e),u>=1)return this._w=l,this._x=n,this._y=s,this._z=o,this;const c=1-u*u;if(c<=Number.EPSILON){const m=1-i;return this._w=m*l+i*this._w,this._x=m*n+i*this._x,this._y=m*s+i*this._y,this._z=m*o+i*this._z,this.normalize(),this}const h=Math.sqrt(c),p=Math.atan2(h,u),f=Math.sin((1-i)*p)/h,g=Math.sin(i*p)/h;return this._w=l*f+this._w*g,this._x=n*f+this._x*g,this._y=s*f+this._y*g,this._z=o*f+this._z*g,this._onChangeCallback(),this}slerpQuaternions(e,i,n){return this.copy(e).slerp(i,n)}random(){const e=2*Math.PI*Math.random(),i=2*Math.PI*Math.random(),n=Math.random(),s=Math.sqrt(1-n),o=Math.sqrt(n);return this.set(s*Math.sin(e),s*Math.cos(e),o*Math.sin(i),o*Math.cos(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,i=0){return this._x=e[i],this._y=e[i+1],this._z=e[i+2],this._w=e[i+3],this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._w,e}fromBufferAttribute(e,i){return this._x=e.getX(i),this._y=e.getY(i),this._z=e.getZ(i),this._w=e.getW(i),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Lt{constructor(e=0,i=0,n=0){Lt.prototype.isVector3=!0,this.x=e,this.y=i,this.z=n}set(e,i,n){return n===void 0&&(n=this.z),this.x=e,this.y=i,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,i){return this.x=e.x*i.x,this.y=e.y*i.y,this.z=e.z*i.z,this}applyEuler(e){return this.applyQuaternion(BU.setFromEuler(e))}applyAxisAngle(e,i){return this.applyQuaternion(BU.setFromAxisAngle(e,i))}applyMatrix3(e){const i=this.x,n=this.y,s=this.z,o=e.elements;return this.x=o[0]*i+o[3]*n+o[6]*s,this.y=o[1]*i+o[4]*n+o[7]*s,this.z=o[2]*i+o[5]*n+o[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const i=this.x,n=this.y,s=this.z,o=e.elements,l=1/(o[3]*i+o[7]*n+o[11]*s+o[15]);return this.x=(o[0]*i+o[4]*n+o[8]*s+o[12])*l,this.y=(o[1]*i+o[5]*n+o[9]*s+o[13])*l,this.z=(o[2]*i+o[6]*n+o[10]*s+o[14])*l,this}applyQuaternion(e){const i=this.x,n=this.y,s=this.z,o=e.x,l=e.y,u=e.z,c=e.w,h=2*(l*s-u*n),p=2*(u*i-o*s),f=2*(o*n-l*i);return this.x=i+c*h+l*f-u*p,this.y=n+c*p+u*h-o*f,this.z=s+c*f+o*p-l*h,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const i=this.x,n=this.y,s=this.z,o=e.elements;return this.x=o[0]*i+o[4]*n+o[8]*s,this.y=o[1]*i+o[5]*n+o[9]*s,this.z=o[2]*i+o[6]*n+o[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this}clampLength(e,i){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(i,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this}lerpVectors(e,i,n){return this.x=e.x+(i.x-e.x)*n,this.y=e.y+(i.y-e.y)*n,this.z=e.z+(i.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,i){const n=e.x,s=e.y,o=e.z,l=i.x,u=i.y,c=i.z;return this.x=s*c-o*u,this.y=o*l-n*c,this.z=n*u-s*l,this}projectOnVector(e){const i=e.lengthSq();if(i===0)return this.set(0,0,0);const n=e.dot(this)/i;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return s3.copy(this).projectOnVector(e),this.sub(s3)}reflect(e){return this.sub(s3.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const n=this.dot(e)/i;return Math.acos(Ua(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,n=this.y-e.y,s=this.z-e.z;return i*i+n*n+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,i,n){const s=Math.sin(i)*e;return this.x=s*Math.sin(n),this.y=Math.cos(i)*e,this.z=s*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,i,n){return this.x=e*Math.sin(i),this.y=n,this.z=e*Math.cos(i),this}setFromMatrixPosition(e){const i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(e){const i=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=i,this.y=n,this.z=s,this}setFromMatrixColumn(e,i){return this.fromArray(e.elements,i*4)}setFromMatrix3Column(e,i){return this.fromArray(e.elements,i*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,i=Math.random()*2-1,n=Math.sqrt(1-i*i);return this.x=n*Math.cos(e),this.y=i,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const s3=new Lt,BU=new sy;class ay{constructor(e=new Lt(1/0,1/0,1/0),i=new Lt(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=i}set(e,i){return this.min.copy(e),this.max.copy(i),this}setFromArray(e){this.makeEmpty();for(let i=0,n=e.length;i<n;i+=3)this.expandByPoint(Ac.fromArray(e,i));return this}setFromBufferAttribute(e){this.makeEmpty();for(let i=0,n=e.count;i<n;i++)this.expandByPoint(Ac.fromBufferAttribute(e,i));return this}setFromPoints(e){this.makeEmpty();for(let i=0,n=e.length;i<n;i++)this.expandByPoint(e[i]);return this}setFromCenterAndSize(e,i){const n=Ac.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,i=!1){return this.makeEmpty(),this.expandByObject(e,i)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,i=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0){const o=n.getAttribute("position");if(i===!0&&o!==void 0&&e.isInstancedMesh!==!0)for(let l=0,u=o.count;l<u;l++)e.isMesh===!0?e.getVertexPosition(l,Ac):Ac.fromBufferAttribute(o,l),Ac.applyMatrix4(e.matrixWorld),this.expandByPoint(Ac);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),R1.copy(e.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),R1.copy(n.boundingBox)),R1.applyMatrix4(e.matrixWorld),this.union(R1)}const s=e.children;for(let o=0,l=s.length;o<l;o++)this.expandByObject(s[o],i);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,i){return i.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Ac),Ac.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let i,n;return e.normal.x>0?(i=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(i=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(i+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(i+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(i+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(i+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),i<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(oy),I1.subVectors(this.max,oy),dg.subVectors(e.a,oy),pg.subVectors(e.b,oy),fg.subVectors(e.c,oy),hd.subVectors(pg,dg),dd.subVectors(fg,pg),kp.subVectors(dg,fg);let i=[0,-hd.z,hd.y,0,-dd.z,dd.y,0,-kp.z,kp.y,hd.z,0,-hd.x,dd.z,0,-dd.x,kp.z,0,-kp.x,-hd.y,hd.x,0,-dd.y,dd.x,0,-kp.y,kp.x,0];return!a3(i,dg,pg,fg,I1)||(i=[1,0,0,0,1,0,0,0,1],!a3(i,dg,pg,fg,I1))?!1:(B1.crossVectors(hd,dd),i=[B1.x,B1.y,B1.z],a3(i,dg,pg,fg,I1))}clampPoint(e,i){return i.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Ac).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Ac).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Qu[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Qu[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Qu[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Qu[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Qu[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Qu[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Qu[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Qu[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Qu),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Qu=[new Lt,new Lt,new Lt,new Lt,new Lt,new Lt,new Lt,new Lt],Ac=new Lt,R1=new ay,dg=new Lt,pg=new Lt,fg=new Lt,hd=new Lt,dd=new Lt,kp=new Lt,oy=new Lt,I1=new Lt,B1=new Lt,Fp=new Lt;function a3(r,e,i,n,s){for(let o=0,l=r.length-3;o<=l;o+=3){Fp.fromArray(r,o);const u=s.x*Math.abs(Fp.x)+s.y*Math.abs(Fp.y)+s.z*Math.abs(Fp.z),c=e.dot(Fp),h=i.dot(Fp),p=n.dot(Fp);if(Math.max(-Math.max(c,h,p),Math.min(c,h,p))>u)return!1}return!0}const Jue=new ay,ly=new Lt,o3=new Lt;class l3{constructor(e=new Lt,i=-1){this.isSphere=!0,this.center=e,this.radius=i}set(e,i){return this.center.copy(e),this.radius=i,this}setFromPoints(e,i){const n=this.center;i!==void 0?n.copy(i):Jue.setFromPoints(e).getCenter(n);let s=0;for(let o=0,l=e.length;o<l;o++)s=Math.max(s,n.distanceToSquared(e[o]));return this.radius=Math.sqrt(s),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const i=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=i*i}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,i){const n=this.center.distanceToSquared(e);return i.copy(e),n>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;ly.subVectors(e,this.center);const i=ly.lengthSq();if(i>this.radius*this.radius){const n=Math.sqrt(i),s=(n-this.radius)*.5;this.center.addScaledVector(ly,s/n),this.radius+=s}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(o3.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(ly.copy(e.center).add(o3)),this.expandByPoint(ly.copy(e.center).sub(o3))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const qu=new Lt,c3=new Lt,L1=new Lt,pd=new Lt,u3=new Lt,D1=new Lt,h3=new Lt;class Zue{constructor(e=new Lt,i=new Lt(0,0,-1)){this.origin=e,this.direction=i}set(e,i){return this.origin.copy(e),this.direction.copy(i),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,i){return i.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,qu)),this}closestPointToPoint(e,i){i.subVectors(e,this.origin);const n=i.dot(this.direction);return n<0?i.copy(this.origin):i.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const i=qu.subVectors(e,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(e):(qu.copy(this.origin).addScaledVector(this.direction,i),qu.distanceToSquared(e))}distanceSqToSegment(e,i,n,s){c3.copy(e).add(i).multiplyScalar(.5),L1.copy(i).sub(e).normalize(),pd.copy(this.origin).sub(c3);const o=e.distanceTo(i)*.5,l=-this.direction.dot(L1),u=pd.dot(this.direction),c=-pd.dot(L1),h=pd.lengthSq(),p=Math.abs(1-l*l);let f,g,m,y;if(p>0)if(f=l*c-u,g=l*u-c,y=o*p,f>=0)if(g>=-y)if(g<=y){const b=1/p;f*=b,g*=b,m=f*(f+l*g+2*u)+g*(l*f+g+2*c)+h}else g=o,f=Math.max(0,-(l*g+u)),m=-f*f+g*(g+2*c)+h;else g=-o,f=Math.max(0,-(l*g+u)),m=-f*f+g*(g+2*c)+h;else g<=-y?(f=Math.max(0,-(-l*o+u)),g=f>0?-o:Math.min(Math.max(-o,-c),o),m=-f*f+g*(g+2*c)+h):g<=y?(f=0,g=Math.min(Math.max(-o,-c),o),m=g*(g+2*c)+h):(f=Math.max(0,-(l*o+u)),g=f>0?o:Math.min(Math.max(-o,-c),o),m=-f*f+g*(g+2*c)+h);else g=l>0?-o:o,f=Math.max(0,-(l*g+u)),m=-f*f+g*(g+2*c)+h;return n&&n.copy(this.origin).addScaledVector(this.direction,f),s&&s.copy(c3).addScaledVector(L1,g),m}intersectSphere(e,i){qu.subVectors(e.center,this.origin);const n=qu.dot(this.direction),s=qu.dot(qu)-n*n,o=e.radius*e.radius;if(s>o)return null;const l=Math.sqrt(o-s),u=n-l,c=n+l;return c<0?null:u<0?this.at(c,i):this.at(u,i)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const i=e.normal.dot(this.direction);if(i===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/i;return n>=0?n:null}intersectPlane(e,i){const n=this.distanceToPlane(e);return n===null?null:this.at(n,i)}intersectsPlane(e){const i=e.distanceToPoint(this.origin);return i===0||e.normal.dot(this.direction)*i<0}intersectBox(e,i){let n,s,o,l,u,c;const h=1/this.direction.x,p=1/this.direction.y,f=1/this.direction.z,g=this.origin;return h>=0?(n=(e.min.x-g.x)*h,s=(e.max.x-g.x)*h):(n=(e.max.x-g.x)*h,s=(e.min.x-g.x)*h),p>=0?(o=(e.min.y-g.y)*p,l=(e.max.y-g.y)*p):(o=(e.max.y-g.y)*p,l=(e.min.y-g.y)*p),n>l||o>s||((o>n||isNaN(n))&&(n=o),(l<s||isNaN(s))&&(s=l),f>=0?(u=(e.min.z-g.z)*f,c=(e.max.z-g.z)*f):(u=(e.max.z-g.z)*f,c=(e.min.z-g.z)*f),n>c||u>s)||((u>n||n!==n)&&(n=u),(c<s||s!==s)&&(s=c),s<0)?null:this.at(n>=0?n:s,i)}intersectsBox(e){return this.intersectBox(e,qu)!==null}intersectTriangle(e,i,n,s,o){u3.subVectors(i,e),D1.subVectors(n,e),h3.crossVectors(u3,D1);let l=this.direction.dot(h3),u;if(l>0){if(s)return null;u=1}else if(l<0)u=-1,l=-l;else return null;pd.subVectors(this.origin,e);const c=u*this.direction.dot(D1.crossVectors(pd,D1));if(c<0)return null;const h=u*this.direction.dot(u3.cross(pd));if(h<0||c+h>l)return null;const p=-u*pd.dot(h3);return p<0?null:this.at(p/l,o)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class ws{constructor(e,i,n,s,o,l,u,c,h,p,f,g,m,y,b,v){ws.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,i,n,s,o,l,u,c,h,p,f,g,m,y,b,v)}set(e,i,n,s,o,l,u,c,h,p,f,g,m,y,b,v){const _=this.elements;return _[0]=e,_[4]=i,_[8]=n,_[12]=s,_[1]=o,_[5]=l,_[9]=u,_[13]=c,_[2]=h,_[6]=p,_[10]=f,_[14]=g,_[3]=m,_[7]=y,_[11]=b,_[15]=v,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new ws().fromArray(this.elements)}copy(e){const i=this.elements,n=e.elements;return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],this}copyPosition(e){const i=this.elements,n=e.elements;return i[12]=n[12],i[13]=n[13],i[14]=n[14],this}setFromMatrix3(e){const i=e.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(e,i,n){return e.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,i,n){return this.set(e.x,i.x,n.x,0,e.y,i.y,n.y,0,e.z,i.z,n.z,0,0,0,0,1),this}extractRotation(e){const i=this.elements,n=e.elements,s=1/mg.setFromMatrixColumn(e,0).length(),o=1/mg.setFromMatrixColumn(e,1).length(),l=1/mg.setFromMatrixColumn(e,2).length();return i[0]=n[0]*s,i[1]=n[1]*s,i[2]=n[2]*s,i[3]=0,i[4]=n[4]*o,i[5]=n[5]*o,i[6]=n[6]*o,i[7]=0,i[8]=n[8]*l,i[9]=n[9]*l,i[10]=n[10]*l,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(e){const i=this.elements,n=e.x,s=e.y,o=e.z,l=Math.cos(n),u=Math.sin(n),c=Math.cos(s),h=Math.sin(s),p=Math.cos(o),f=Math.sin(o);if(e.order==="XYZ"){const g=l*p,m=l*f,y=u*p,b=u*f;i[0]=c*p,i[4]=-c*f,i[8]=h,i[1]=m+y*h,i[5]=g-b*h,i[9]=-u*c,i[2]=b-g*h,i[6]=y+m*h,i[10]=l*c}else if(e.order==="YXZ"){const g=c*p,m=c*f,y=h*p,b=h*f;i[0]=g+b*u,i[4]=y*u-m,i[8]=l*h,i[1]=l*f,i[5]=l*p,i[9]=-u,i[2]=m*u-y,i[6]=b+g*u,i[10]=l*c}else if(e.order==="ZXY"){const g=c*p,m=c*f,y=h*p,b=h*f;i[0]=g-b*u,i[4]=-l*f,i[8]=y+m*u,i[1]=m+y*u,i[5]=l*p,i[9]=b-g*u,i[2]=-l*h,i[6]=u,i[10]=l*c}else if(e.order==="ZYX"){const g=l*p,m=l*f,y=u*p,b=u*f;i[0]=c*p,i[4]=y*h-m,i[8]=g*h+b,i[1]=c*f,i[5]=b*h+g,i[9]=m*h-y,i[2]=-h,i[6]=u*c,i[10]=l*c}else if(e.order==="YZX"){const g=l*c,m=l*h,y=u*c,b=u*h;i[0]=c*p,i[4]=b-g*f,i[8]=y*f+m,i[1]=f,i[5]=l*p,i[9]=-u*p,i[2]=-h*p,i[6]=m*f+y,i[10]=g-b*f}else if(e.order==="XZY"){const g=l*c,m=l*h,y=u*c,b=u*h;i[0]=c*p,i[4]=-f,i[8]=h*p,i[1]=g*f+b,i[5]=l*p,i[9]=m*f-y,i[2]=y*f-m,i[6]=u*p,i[10]=b*f+g}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(e){return this.compose($ue,e,ehe)}lookAt(e,i,n){const s=this.elements;return fl.subVectors(e,i),fl.lengthSq()===0&&(fl.z=1),fl.normalize(),fd.crossVectors(n,fl),fd.lengthSq()===0&&(Math.abs(n.z)===1?fl.x+=1e-4:fl.z+=1e-4,fl.normalize(),fd.crossVectors(n,fl)),fd.normalize(),N1.crossVectors(fl,fd),s[0]=fd.x,s[4]=N1.x,s[8]=fl.x,s[1]=fd.y,s[5]=N1.y,s[9]=fl.y,s[2]=fd.z,s[6]=N1.z,s[10]=fl.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const n=e.elements,s=i.elements,o=this.elements,l=n[0],u=n[4],c=n[8],h=n[12],p=n[1],f=n[5],g=n[9],m=n[13],y=n[2],b=n[6],v=n[10],_=n[14],T=n[3],E=n[7],C=n[11],R=n[15],B=s[0],I=s[4],N=s[8],D=s[12],P=s[1],k=s[5],q=s[9],V=s[13],j=s[2],Q=s[6],W=s[10],G=s[14],z=s[3],te=s[7],Y=s[11],se=s[15];return o[0]=l*B+u*P+c*j+h*z,o[4]=l*I+u*k+c*Q+h*te,o[8]=l*N+u*q+c*W+h*Y,o[12]=l*D+u*V+c*G+h*se,o[1]=p*B+f*P+g*j+m*z,o[5]=p*I+f*k+g*Q+m*te,o[9]=p*N+f*q+g*W+m*Y,o[13]=p*D+f*V+g*G+m*se,o[2]=y*B+b*P+v*j+_*z,o[6]=y*I+b*k+v*Q+_*te,o[10]=y*N+b*q+v*W+_*Y,o[14]=y*D+b*V+v*G+_*se,o[3]=T*B+E*P+C*j+R*z,o[7]=T*I+E*k+C*Q+R*te,o[11]=T*N+E*q+C*W+R*Y,o[15]=T*D+E*V+C*G+R*se,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[4]*=e,i[8]*=e,i[12]*=e,i[1]*=e,i[5]*=e,i[9]*=e,i[13]*=e,i[2]*=e,i[6]*=e,i[10]*=e,i[14]*=e,i[3]*=e,i[7]*=e,i[11]*=e,i[15]*=e,this}determinant(){const e=this.elements,i=e[0],n=e[4],s=e[8],o=e[12],l=e[1],u=e[5],c=e[9],h=e[13],p=e[2],f=e[6],g=e[10],m=e[14],y=e[3],b=e[7],v=e[11],_=e[15];return y*(+o*c*f-s*h*f-o*u*g+n*h*g+s*u*m-n*c*m)+b*(+i*c*m-i*h*g+o*l*g-s*l*m+s*h*p-o*c*p)+v*(+i*h*f-i*u*m-o*l*f+n*l*m+o*u*p-n*h*p)+_*(-s*u*p-i*c*f+i*u*g+s*l*f-n*l*g+n*c*p)}transpose(){const e=this.elements;let i;return i=e[1],e[1]=e[4],e[4]=i,i=e[2],e[2]=e[8],e[8]=i,i=e[6],e[6]=e[9],e[9]=i,i=e[3],e[3]=e[12],e[12]=i,i=e[7],e[7]=e[13],e[13]=i,i=e[11],e[11]=e[14],e[14]=i,this}setPosition(e,i,n){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=i,s[14]=n),this}invert(){const e=this.elements,i=e[0],n=e[1],s=e[2],o=e[3],l=e[4],u=e[5],c=e[6],h=e[7],p=e[8],f=e[9],g=e[10],m=e[11],y=e[12],b=e[13],v=e[14],_=e[15],T=f*v*h-b*g*h+b*c*m-u*v*m-f*c*_+u*g*_,E=y*g*h-p*v*h-y*c*m+l*v*m+p*c*_-l*g*_,C=p*b*h-y*f*h+y*u*m-l*b*m-p*u*_+l*f*_,R=y*f*c-p*b*c-y*u*g+l*b*g+p*u*v-l*f*v,B=i*T+n*E+s*C+o*R;if(B===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const I=1/B;return e[0]=T*I,e[1]=(b*g*o-f*v*o-b*s*m+n*v*m+f*s*_-n*g*_)*I,e[2]=(u*v*o-b*c*o+b*s*h-n*v*h-u*s*_+n*c*_)*I,e[3]=(f*c*o-u*g*o-f*s*h+n*g*h+u*s*m-n*c*m)*I,e[4]=E*I,e[5]=(p*v*o-y*g*o+y*s*m-i*v*m-p*s*_+i*g*_)*I,e[6]=(y*c*o-l*v*o-y*s*h+i*v*h+l*s*_-i*c*_)*I,e[7]=(l*g*o-p*c*o+p*s*h-i*g*h-l*s*m+i*c*m)*I,e[8]=C*I,e[9]=(y*f*o-p*b*o-y*n*m+i*b*m+p*n*_-i*f*_)*I,e[10]=(l*b*o-y*u*o+y*n*h-i*b*h-l*n*_+i*u*_)*I,e[11]=(p*u*o-l*f*o-p*n*h+i*f*h+l*n*m-i*u*m)*I,e[12]=R*I,e[13]=(p*b*s-y*f*s+y*n*g-i*b*g-p*n*v+i*f*v)*I,e[14]=(y*u*s-l*b*s-y*n*c+i*b*c+l*n*v-i*u*v)*I,e[15]=(l*f*s-p*u*s+p*n*c-i*f*c-l*n*g+i*u*g)*I,this}scale(e){const i=this.elements,n=e.x,s=e.y,o=e.z;return i[0]*=n,i[4]*=s,i[8]*=o,i[1]*=n,i[5]*=s,i[9]*=o,i[2]*=n,i[6]*=s,i[10]*=o,i[3]*=n,i[7]*=s,i[11]*=o,this}getMaxScaleOnAxis(){const e=this.elements,i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(i,n,s))}makeTranslation(e,i,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,i,0,0,1,n,0,0,0,1),this}makeRotationX(e){const i=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,i,-n,0,0,n,i,0,0,0,0,1),this}makeRotationY(e){const i=Math.cos(e),n=Math.sin(e);return this.set(i,0,n,0,0,1,0,0,-n,0,i,0,0,0,0,1),this}makeRotationZ(e){const i=Math.cos(e),n=Math.sin(e);return this.set(i,-n,0,0,n,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,i){const n=Math.cos(i),s=Math.sin(i),o=1-n,l=e.x,u=e.y,c=e.z,h=o*l,p=o*u;return this.set(h*l+n,h*u-s*c,h*c+s*u,0,h*u+s*c,p*u+n,p*c-s*l,0,h*c-s*u,p*c+s*l,o*c*c+n,0,0,0,0,1),this}makeScale(e,i,n){return this.set(e,0,0,0,0,i,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,i,n,s,o,l){return this.set(1,n,o,0,e,1,l,0,i,s,1,0,0,0,0,1),this}compose(e,i,n){const s=this.elements,o=i._x,l=i._y,u=i._z,c=i._w,h=o+o,p=l+l,f=u+u,g=o*h,m=o*p,y=o*f,b=l*p,v=l*f,_=u*f,T=c*h,E=c*p,C=c*f,R=n.x,B=n.y,I=n.z;return s[0]=(1-(b+_))*R,s[1]=(m+C)*R,s[2]=(y-E)*R,s[3]=0,s[4]=(m-C)*B,s[5]=(1-(g+_))*B,s[6]=(v+T)*B,s[7]=0,s[8]=(y+E)*I,s[9]=(v-T)*I,s[10]=(1-(g+b))*I,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,i,n){const s=this.elements;let o=mg.set(s[0],s[1],s[2]).length();const l=mg.set(s[4],s[5],s[6]).length(),u=mg.set(s[8],s[9],s[10]).length();this.determinant()<0&&(o=-o),e.x=s[12],e.y=s[13],e.z=s[14],yc.copy(this);const c=1/o,h=1/l,p=1/u;return yc.elements[0]*=c,yc.elements[1]*=c,yc.elements[2]*=c,yc.elements[4]*=h,yc.elements[5]*=h,yc.elements[6]*=h,yc.elements[8]*=p,yc.elements[9]*=p,yc.elements[10]*=p,i.setFromRotationMatrix(yc),n.x=o,n.y=l,n.z=u,this}makePerspective(e,i,n,s,o,l,u=gc){const c=this.elements,h=2*o/(i-e),p=2*o/(n-s),f=(i+e)/(i-e),g=(n+s)/(n-s);let m,y;if(u===gc)m=-(l+o)/(l-o),y=-2*l*o/(l-o);else if(u===Op)m=-l/(l-o),y=-l*o/(l-o);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+u);return c[0]=h,c[4]=0,c[8]=f,c[12]=0,c[1]=0,c[5]=p,c[9]=g,c[13]=0,c[2]=0,c[6]=0,c[10]=m,c[14]=y,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,i,n,s,o,l,u=gc){const c=this.elements,h=1/(i-e),p=1/(n-s),f=1/(l-o),g=(i+e)*h,m=(n+s)*p;let y,b;if(u===gc)y=(l+o)*f,b=-2*f;else if(u===Op)y=o*f,b=-1*f;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+u);return c[0]=2*h,c[4]=0,c[8]=0,c[12]=-g,c[1]=0,c[5]=2*p,c[9]=0,c[13]=-m,c[2]=0,c[6]=0,c[10]=b,c[14]=-y,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const i=this.elements,n=e.elements;for(let s=0;s<16;s++)if(i[s]!==n[s])return!1;return!0}fromArray(e,i=0){for(let n=0;n<16;n++)this.elements[n]=e[n+i];return this}toArray(e=[],i=0){const n=this.elements;return e[i]=n[0],e[i+1]=n[1],e[i+2]=n[2],e[i+3]=n[3],e[i+4]=n[4],e[i+5]=n[5],e[i+6]=n[6],e[i+7]=n[7],e[i+8]=n[8],e[i+9]=n[9],e[i+10]=n[10],e[i+11]=n[11],e[i+12]=n[12],e[i+13]=n[13],e[i+14]=n[14],e[i+15]=n[15],e}}const mg=new Lt,yc=new ws,$ue=new Lt(0,0,0),ehe=new Lt(1,1,1),fd=new Lt,N1=new Lt,fl=new Lt,LU=new ws,DU=new sy;class vc{constructor(e=0,i=0,n=0,s=vc.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=i,this._z=n,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,i,n,s=this._order){return this._x=e,this._y=i,this._z=n,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,i=this._order,n=!0){const s=e.elements,o=s[0],l=s[4],u=s[8],c=s[1],h=s[5],p=s[9],f=s[2],g=s[6],m=s[10];switch(i){case"XYZ":this._y=Math.asin(Ua(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-p,m),this._z=Math.atan2(-l,o)):(this._x=Math.atan2(g,h),this._z=0);break;case"YXZ":this._x=Math.asin(-Ua(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(u,m),this._z=Math.atan2(c,h)):(this._y=Math.atan2(-f,o),this._z=0);break;case"ZXY":this._x=Math.asin(Ua(g,-1,1)),Math.abs(g)<.9999999?(this._y=Math.atan2(-f,m),this._z=Math.atan2(-l,h)):(this._y=0,this._z=Math.atan2(c,o));break;case"ZYX":this._y=Math.asin(-Ua(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(g,m),this._z=Math.atan2(c,o)):(this._x=0,this._z=Math.atan2(-l,h));break;case"YZX":this._z=Math.asin(Ua(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-p,h),this._y=Math.atan2(-f,o)):(this._x=0,this._y=Math.atan2(u,m));break;case"XZY":this._z=Math.asin(-Ua(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(g,h),this._y=Math.atan2(u,o)):(this._x=Math.atan2(-p,m),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,i,n){return LU.makeRotationFromQuaternion(e),this.setFromRotationMatrix(LU,i,n)}setFromVector3(e,i=this._order){return this.set(e.x,e.y,e.z,i)}reorder(e){return DU.setFromEuler(this),this.setFromQuaternion(DU,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}vc.DEFAULT_ORDER="XYZ";class the{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let ihe=0;const NU=new Lt,gg=new sy,Xu=new ws,P1=new Lt,cy=new Lt,rhe=new Lt,nhe=new sy,PU=new Lt(1,0,0),OU=new Lt(0,1,0),kU=new Lt(0,0,1),FU={type:"added"},she={type:"removed"},Ag={type:"childadded",child:null},d3={type:"childremoved",child:null};class Ra extends lg{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:ihe++}),this.uuid=Hu(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ra.DEFAULT_UP.clone();const e=new Lt,i=new vc,n=new sy,s=new Lt(1,1,1);function o(){n.setFromEuler(i,!1)}function l(){i.setFromQuaternion(n,void 0,!1)}i._onChange(o),n._onChange(l),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new ws},normalMatrix:{value:new Go}}),this.matrix=new ws,this.matrixWorld=new ws,this.matrixAutoUpdate=Ra.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Ra.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new the,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,i){this.quaternion.setFromAxisAngle(e,i)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,i){return gg.setFromAxisAngle(e,i),this.quaternion.multiply(gg),this}rotateOnWorldAxis(e,i){return gg.setFromAxisAngle(e,i),this.quaternion.premultiply(gg),this}rotateX(e){return this.rotateOnAxis(PU,e)}rotateY(e){return this.rotateOnAxis(OU,e)}rotateZ(e){return this.rotateOnAxis(kU,e)}translateOnAxis(e,i){return NU.copy(e).applyQuaternion(this.quaternion),this.position.add(NU.multiplyScalar(i)),this}translateX(e){return this.translateOnAxis(PU,e)}translateY(e){return this.translateOnAxis(OU,e)}translateZ(e){return this.translateOnAxis(kU,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Xu.copy(this.matrixWorld).invert())}lookAt(e,i,n){e.isVector3?P1.copy(e):P1.set(e,i,n);const s=this.parent;this.updateWorldMatrix(!0,!1),cy.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Xu.lookAt(cy,P1,this.up):Xu.lookAt(P1,cy,this.up),this.quaternion.setFromRotationMatrix(Xu),s&&(Xu.extractRotation(s.matrixWorld),gg.setFromRotationMatrix(Xu),this.quaternion.premultiply(gg.invert()))}add(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(FU),Ag.child=e,this.dispatchEvent(Ag),Ag.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const i=this.children.indexOf(e);return i!==-1&&(e.parent=null,this.children.splice(i,1),e.dispatchEvent(she),d3.child=e,this.dispatchEvent(d3),d3.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Xu.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Xu.multiply(e.parent.matrixWorld)),e.applyMatrix4(Xu),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(FU),Ag.child=e,this.dispatchEvent(Ag),Ag.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,i){if(this[e]===i)return this;for(let n=0,s=this.children.length;n<s;n++){const o=this.children[n].getObjectByProperty(e,i);if(o!==void 0)return o}}getObjectsByProperty(e,i,n=[]){this[e]===i&&n.push(this);const s=this.children;for(let o=0,l=s.length;o<l;o++)s[o].getObjectsByProperty(e,i,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(cy,e,rhe),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(cy,nhe,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return e.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(e){e(this);const i=this.children;for(let n=0,s=i.length;n<s;n++)i[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const i=this.children;for(let n=0,s=i.length;n<s;n++)i[n].traverseVisible(e)}traverseAncestors(e){const i=this.parent;i!==null&&(e(i),i.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const i=this.children;for(let n=0,s=i.length;n<s;n++)i[n].updateMatrixWorld(e)}updateWorldMatrix(e,i){const n=this.parent;if(e===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),i===!0){const s=this.children;for(let o=0,l=s.length;o<l;o++)s[o].updateWorldMatrix(!1,!0)}}toJSON(e){const i=e===void 0||typeof e=="string",n={};i&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.visibility=this._visibility,s.active=this._active,s.bounds=this._bounds.map(u=>({boxInitialized:u.boxInitialized,boxMin:u.box.min.toArray(),boxMax:u.box.max.toArray(),sphereInitialized:u.sphereInitialized,sphereRadius:u.sphere.radius,sphereCenter:u.sphere.center.toArray()})),s.maxInstanceCount=this._maxInstanceCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.geometryCount=this._geometryCount,s.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(s.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(s.boundingSphere={center:s.boundingSphere.center.toArray(),radius:s.boundingSphere.radius}),this.boundingBox!==null&&(s.boundingBox={min:s.boundingBox.min.toArray(),max:s.boundingBox.max.toArray()}));function o(u,c){return u[c.uuid]===void 0&&(u[c.uuid]=c.toJSON(e)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=o(e.geometries,this.geometry);const u=this.geometry.parameters;if(u!==void 0&&u.shapes!==void 0){const c=u.shapes;if(Array.isArray(c))for(let h=0,p=c.length;h<p;h++){const f=c[h];o(e.shapes,f)}else o(e.shapes,c)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(o(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const u=[];for(let c=0,h=this.material.length;c<h;c++)u.push(o(e.materials,this.material[c]));s.material=u}else s.material=o(e.materials,this.material);if(this.children.length>0){s.children=[];for(let u=0;u<this.children.length;u++)s.children.push(this.children[u].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let u=0;u<this.animations.length;u++){const c=this.animations[u];s.animations.push(o(e.animations,c))}}if(i){const u=l(e.geometries),c=l(e.materials),h=l(e.textures),p=l(e.images),f=l(e.shapes),g=l(e.skeletons),m=l(e.animations),y=l(e.nodes);u.length>0&&(n.geometries=u),c.length>0&&(n.materials=c),h.length>0&&(n.textures=h),p.length>0&&(n.images=p),f.length>0&&(n.shapes=f),g.length>0&&(n.skeletons=g),m.length>0&&(n.animations=m),y.length>0&&(n.nodes=y)}return n.object=s,n;function l(u){const c=[];for(const h in u){const p=u[h];delete p.metadata,c.push(p)}return c}}clone(e){return new this.constructor().copy(this,e)}copy(e,i=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),i===!0)for(let n=0;n<e.children.length;n++){const s=e.children[n];this.add(s.clone())}return this}}Ra.DEFAULT_UP=new Lt(0,1,0),Ra.DEFAULT_MATRIX_AUTO_UPDATE=!0,Ra.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const bc=new Lt,Yu=new Lt,p3=new Lt,Ku=new Lt,yg=new Lt,vg=new Lt,UU=new Lt,f3=new Lt,m3=new Lt,g3=new Lt,A3=new Jn,y3=new Jn,v3=new Jn;class xc{constructor(e=new Lt,i=new Lt,n=new Lt){this.a=e,this.b=i,this.c=n}static getNormal(e,i,n,s){s.subVectors(n,i),bc.subVectors(e,i),s.cross(bc);const o=s.lengthSq();return o>0?s.multiplyScalar(1/Math.sqrt(o)):s.set(0,0,0)}static getBarycoord(e,i,n,s,o){bc.subVectors(s,i),Yu.subVectors(n,i),p3.subVectors(e,i);const l=bc.dot(bc),u=bc.dot(Yu),c=bc.dot(p3),h=Yu.dot(Yu),p=Yu.dot(p3),f=l*h-u*u;if(f===0)return o.set(0,0,0),null;const g=1/f,m=(h*c-u*p)*g,y=(l*p-u*c)*g;return o.set(1-m-y,y,m)}static containsPoint(e,i,n,s){return this.getBarycoord(e,i,n,s,Ku)===null?!1:Ku.x>=0&&Ku.y>=0&&Ku.x+Ku.y<=1}static getInterpolation(e,i,n,s,o,l,u,c){return this.getBarycoord(e,i,n,s,Ku)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(o,Ku.x),c.addScaledVector(l,Ku.y),c.addScaledVector(u,Ku.z),c)}static getInterpolatedAttribute(e,i,n,s,o,l){return A3.setScalar(0),y3.setScalar(0),v3.setScalar(0),A3.fromBufferAttribute(e,i),y3.fromBufferAttribute(e,n),v3.fromBufferAttribute(e,s),l.setScalar(0),l.addScaledVector(A3,o.x),l.addScaledVector(y3,o.y),l.addScaledVector(v3,o.z),l}static isFrontFacing(e,i,n,s){return bc.subVectors(n,i),Yu.subVectors(e,i),bc.cross(Yu).dot(s)<0}set(e,i,n){return this.a.copy(e),this.b.copy(i),this.c.copy(n),this}setFromPointsAndIndices(e,i,n,s){return this.a.copy(e[i]),this.b.copy(e[n]),this.c.copy(e[s]),this}setFromAttributeAndIndices(e,i,n,s){return this.a.fromBufferAttribute(e,i),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return bc.subVectors(this.c,this.b),Yu.subVectors(this.a,this.b),bc.cross(Yu).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return xc.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,i){return xc.getBarycoord(e,this.a,this.b,this.c,i)}getInterpolation(e,i,n,s,o){return xc.getInterpolation(e,this.a,this.b,this.c,i,n,s,o)}containsPoint(e){return xc.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return xc.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,i){const n=this.a,s=this.b,o=this.c;let l,u;yg.subVectors(s,n),vg.subVectors(o,n),f3.subVectors(e,n);const c=yg.dot(f3),h=vg.dot(f3);if(c<=0&&h<=0)return i.copy(n);m3.subVectors(e,s);const p=yg.dot(m3),f=vg.dot(m3);if(p>=0&&f<=p)return i.copy(s);const g=c*f-p*h;if(g<=0&&c>=0&&p<=0)return l=c/(c-p),i.copy(n).addScaledVector(yg,l);g3.subVectors(e,o);const m=yg.dot(g3),y=vg.dot(g3);if(y>=0&&m<=y)return i.copy(o);const b=m*h-c*y;if(b<=0&&h>=0&&y<=0)return u=h/(h-y),i.copy(n).addScaledVector(vg,u);const v=p*y-m*f;if(v<=0&&f-p>=0&&m-y>=0)return UU.subVectors(o,s),u=(f-p)/(f-p+(m-y)),i.copy(s).addScaledVector(UU,u);const _=1/(v+b+g);return l=b*_,u=g*_,i.copy(n).addScaledVector(yg,l).addScaledVector(vg,u)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const zU={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},md={h:0,s:0,l:0},O1={h:0,s:0,l:0};function b3(r,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?r+(e-r)*6*i:i<1/2?e:i<2/3?r+(e-r)*6*(2/3-i):r}class Zn{constructor(e,i,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,i,n)}set(e,i,n){if(i===void 0&&n===void 0){const s=e;s&&s.isColor?this.copy(s):typeof s=="number"?this.setHex(s):typeof s=="string"&&this.setStyle(s)}else this.setRGB(e,i,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,i=Dr){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,ta.toWorkingColorSpace(this,i),this}setRGB(e,i,n,s=ta.workingColorSpace){return this.r=e,this.g=i,this.b=n,ta.toWorkingColorSpace(this,s),this}setHSL(e,i,n,s=ta.workingColorSpace){if(e=t3(e,1),i=Ua(i,0,1),n=Ua(n,0,1),i===0)this.r=this.g=this.b=n;else{const o=n<=.5?n*(1+i):n+i-n*i,l=2*n-o;this.r=b3(l,o,e+1/3),this.g=b3(l,o,e),this.b=b3(l,o,e-1/3)}return ta.toWorkingColorSpace(this,s),this}setStyle(e,i=Dr){function n(o){o!==void 0&&parseFloat(o)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let s;if(s=/^(\w+)\(([^\)]*)\)/.exec(e)){let o;const l=s[1],u=s[2];switch(l){case"rgb":case"rgba":if(o=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(u))return n(o[4]),this.setRGB(Math.min(255,parseInt(o[1],10))/255,Math.min(255,parseInt(o[2],10))/255,Math.min(255,parseInt(o[3],10))/255,i);if(o=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(u))return n(o[4]),this.setRGB(Math.min(100,parseInt(o[1],10))/100,Math.min(100,parseInt(o[2],10))/100,Math.min(100,parseInt(o[3],10))/100,i);break;case"hsl":case"hsla":if(o=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(u))return n(o[4]),this.setHSL(parseFloat(o[1])/360,parseFloat(o[2])/100,parseFloat(o[3])/100,i);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(e)){const o=s[1],l=o.length;if(l===3)return this.setRGB(parseInt(o.charAt(0),16)/15,parseInt(o.charAt(1),16)/15,parseInt(o.charAt(2),16)/15,i);if(l===6)return this.setHex(parseInt(o,16),i);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,i);return this}setColorName(e,i=Dr){const n=zU[e.toLowerCase()];return n!==void 0?this.setHex(n,i):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Wu(e.r),this.g=Wu(e.g),this.b=Wu(e.b),this}copyLinearToSRGB(e){return this.r=cg(e.r),this.g=cg(e.g),this.b=cg(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Dr){return ta.fromWorkingColorSpace(ro.copy(this),e),Math.round(Ua(ro.r*255,0,255))*65536+Math.round(Ua(ro.g*255,0,255))*256+Math.round(Ua(ro.b*255,0,255))}getHexString(e=Dr){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,i=ta.workingColorSpace){ta.fromWorkingColorSpace(ro.copy(this),i);const n=ro.r,s=ro.g,o=ro.b,l=Math.max(n,s,o),u=Math.min(n,s,o);let c,h;const p=(u+l)/2;if(u===l)c=0,h=0;else{const f=l-u;switch(h=p<=.5?f/(l+u):f/(2-l-u),l){case n:c=(s-o)/f+(s<o?6:0);break;case s:c=(o-n)/f+2;break;case o:c=(n-s)/f+4;break}c/=6}return e.h=c,e.s=h,e.l=p,e}getRGB(e,i=ta.workingColorSpace){return ta.fromWorkingColorSpace(ro.copy(this),i),e.r=ro.r,e.g=ro.g,e.b=ro.b,e}getStyle(e=Dr){ta.fromWorkingColorSpace(ro.copy(this),e);const i=ro.r,n=ro.g,s=ro.b;return e!==Dr?`color(${e} ${i.toFixed(3)} ${n.toFixed(3)} ${s.toFixed(3)})`:`rgb(${Math.round(i*255)},${Math.round(n*255)},${Math.round(s*255)})`}offsetHSL(e,i,n){return this.getHSL(md),this.setHSL(md.h+e,md.s+i,md.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,i){return this.r=e.r+i.r,this.g=e.g+i.g,this.b=e.b+i.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,i){return this.r+=(e.r-this.r)*i,this.g+=(e.g-this.g)*i,this.b+=(e.b-this.b)*i,this}lerpColors(e,i,n){return this.r=e.r+(i.r-e.r)*n,this.g=e.g+(i.g-e.g)*n,this.b=e.b+(i.b-e.b)*n,this}lerpHSL(e,i){this.getHSL(md),e.getHSL(O1);const n=ny(md.h,O1.h,i),s=ny(md.s,O1.s,i),o=ny(md.l,O1.l,i);return this.setHSL(n,s,o),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const i=this.r,n=this.g,s=this.b,o=e.elements;return this.r=o[0]*i+o[3]*n+o[6]*s,this.g=o[1]*i+o[4]*n+o[7]*s,this.b=o[2]*i+o[5]*n+o[8]*s,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,i=0){return this.r=e[i],this.g=e[i+1],this.b=e[i+2],this}toArray(e=[],i=0){return e[i]=this.r,e[i+1]=this.g,e[i+2]=this.b,e}fromBufferAttribute(e,i){return this.r=e.getX(i),this.g=e.getY(i),this.b=e.getZ(i),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const ro=new Zn;Zn.NAMES=zU;let ahe=0;class Ho extends lg{static get type(){return"Material"}get type(){return this.constructor.type}set type(e){}constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:ahe++}),this.uuid=Hu(),this.name="",this.blending=ad,this.side=Jm,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=v1,this.blendDst=b1,this.blendEquation=od,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Zn(0,0,0),this.blendAlpha=0,this.depthFunc=x1,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=$M,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Pp,this.stencilZFail=Pp,this.stencilZPass=Pp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const i in e){const n=e[i];if(n===void 0){console.warn(`THREE.Material: parameter '${i}' has value of undefined.`);continue}const s=this[i];if(s===void 0){console.warn(`THREE.Material: '${i}' is not a property of THREE.${this.type}.`);continue}s&&s.isColor?s.set(n):s&&s.isVector3&&n&&n.isVector3?s.copy(n):this[i]=n}}toJSON(e){const i=e===void 0||typeof e=="string";i&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(n.dispersion=this.dispersion),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapRotation!==void 0&&(n.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==ad&&(n.blending=this.blending),this.side!==Jm&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),this.blendSrc!==v1&&(n.blendSrc=this.blendSrc),this.blendDst!==b1&&(n.blendDst=this.blendDst),this.blendEquation!==od&&(n.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(n.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(n.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==x1&&(n.depthFunc=this.depthFunc),this.depthTest===!1&&(n.depthTest=this.depthTest),this.depthWrite===!1&&(n.depthWrite=this.depthWrite),this.colorWrite===!1&&(n.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==$M&&(n.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(n.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Pp&&(n.stencilFail=this.stencilFail),this.stencilZFail!==Pp&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==Pp&&(n.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(n.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function s(o){const l=[];for(const u in o){const c=o[u];delete c.metadata,l.push(c)}return l}if(i){const o=s(e.textures),l=s(e.images);o.length>0&&(n.textures=o),l.length>0&&(n.images=l)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const i=e.clippingPlanes;let n=null;if(i!==null){const s=i.length;n=new Array(s);for(let o=0;o!==s;++o)n[o]=i[o].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class k1 extends Ho{static get type(){return"MeshBasicMaterial"}constructor(e){super(),this.isMeshBasicMaterial=!0,this.color=new Zn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new vc,this.combine=_1,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Ju=ohe();function ohe(){const r=new ArrayBuffer(4),e=new Float32Array(r),i=new Uint32Array(r),n=new Uint32Array(512),s=new Uint32Array(512);for(let c=0;c<256;++c){const h=c-127;h<-27?(n[c]=0,n[c|256]=32768,s[c]=24,s[c|256]=24):h<-14?(n[c]=1024>>-h-14,n[c|256]=1024>>-h-14|32768,s[c]=-h-1,s[c|256]=-h-1):h<=15?(n[c]=h+15<<10,n[c|256]=h+15<<10|32768,s[c]=13,s[c|256]=13):h<128?(n[c]=31744,n[c|256]=64512,s[c]=24,s[c|256]=24):(n[c]=31744,n[c|256]=64512,s[c]=13,s[c|256]=13)}const o=new Uint32Array(2048),l=new Uint32Array(64),u=new Uint32Array(64);for(let c=1;c<1024;++c){let h=c<<13,p=0;for(;!(h&8388608);)h<<=1,p-=8388608;h&=-8388609,p+=947912704,o[c]=h|p}for(let c=1024;c<2048;++c)o[c]=939524096+(c-1024<<13);for(let c=1;c<31;++c)l[c]=c<<23;l[31]=1199570944,l[32]=2147483648;for(let c=33;c<63;++c)l[c]=2147483648+(c-32<<23);l[63]=3347054592;for(let c=1;c<64;++c)c!==32&&(u[c]=1024);return{floatView:e,uint32View:i,baseTable:n,shiftTable:s,mantissaTable:o,exponentTable:l,offsetTable:u}}function ml(r){Math.abs(r)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),r=Ua(r,-65504,65504),Ju.floatView[0]=r;const e=Ju.uint32View[0],i=e>>23&511;return Ju.baseTable[i]+((e&8388607)>>Ju.shiftTable[i])}function F1(r){const e=r>>10;return Ju.uint32View[0]=Ju.mantissaTable[Ju.offsetTable[e]+(r&1023)]+Ju.exponentTable[e],Ju.floatView[0]}const ia=new Lt,U1=new Dn;class Ol{constructor(e,i,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=i,this.count=e!==void 0?e.length/i:0,this.normalized=n,this.usage=M1,this.updateRanges=[],this.gpuType=pl,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,i){this.updateRanges.push({start:e,count:i})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,i,n){e*=this.itemSize,n*=i.itemSize;for(let s=0,o=this.itemSize;s<o;s++)this.array[e+s]=i.array[n+s];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let i=0,n=this.count;i<n;i++)U1.fromBufferAttribute(this,i),U1.applyMatrix3(e),this.setXY(i,U1.x,U1.y);else if(this.itemSize===3)for(let i=0,n=this.count;i<n;i++)ia.fromBufferAttribute(this,i),ia.applyMatrix3(e),this.setXYZ(i,ia.x,ia.y,ia.z);return this}applyMatrix4(e){for(let i=0,n=this.count;i<n;i++)ia.fromBufferAttribute(this,i),ia.applyMatrix4(e),this.setXYZ(i,ia.x,ia.y,ia.z);return this}applyNormalMatrix(e){for(let i=0,n=this.count;i<n;i++)ia.fromBufferAttribute(this,i),ia.applyNormalMatrix(e),this.setXYZ(i,ia.x,ia.y,ia.z);return this}transformDirection(e){for(let i=0,n=this.count;i<n;i++)ia.fromBufferAttribute(this,i),ia.transformDirection(e),this.setXYZ(i,ia.x,ia.y,ia.z);return this}set(e,i=0){return this.array.set(e,i),this}getComponent(e,i){let n=this.array[e*this.itemSize+i];return this.normalized&&(n=Eo(n,this.array)),n}setComponent(e,i,n){return this.normalized&&(n=en(n,this.array)),this.array[e*this.itemSize+i]=n,this}getX(e){let i=this.array[e*this.itemSize];return this.normalized&&(i=Eo(i,this.array)),i}setX(e,i){return this.normalized&&(i=en(i,this.array)),this.array[e*this.itemSize]=i,this}getY(e){let i=this.array[e*this.itemSize+1];return this.normalized&&(i=Eo(i,this.array)),i}setY(e,i){return this.normalized&&(i=en(i,this.array)),this.array[e*this.itemSize+1]=i,this}getZ(e){let i=this.array[e*this.itemSize+2];return this.normalized&&(i=Eo(i,this.array)),i}setZ(e,i){return this.normalized&&(i=en(i,this.array)),this.array[e*this.itemSize+2]=i,this}getW(e){let i=this.array[e*this.itemSize+3];return this.normalized&&(i=Eo(i,this.array)),i}setW(e,i){return this.normalized&&(i=en(i,this.array)),this.array[e*this.itemSize+3]=i,this}setXY(e,i,n){return e*=this.itemSize,this.normalized&&(i=en(i,this.array),n=en(n,this.array)),this.array[e+0]=i,this.array[e+1]=n,this}setXYZ(e,i,n,s){return e*=this.itemSize,this.normalized&&(i=en(i,this.array),n=en(n,this.array),s=en(s,this.array)),this.array[e+0]=i,this.array[e+1]=n,this.array[e+2]=s,this}setXYZW(e,i,n,s,o){return e*=this.itemSize,this.normalized&&(i=en(i,this.array),n=en(n,this.array),s=en(s,this.array),o=en(o,this.array)),this.array[e+0]=i,this.array[e+1]=n,this.array[e+2]=s,this.array[e+3]=o,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==M1&&(e.usage=this.usage),e}}class jU extends Ol{constructor(e,i,n){super(new Uint16Array(e),i,n)}}class VU extends Ol{constructor(e,i,n){super(new Uint32Array(e),i,n)}}class GU extends Ol{constructor(e,i,n){super(new Uint16Array(e),i,n),this.isFloat16BufferAttribute=!0}getX(e){let i=F1(this.array[e*this.itemSize]);return this.normalized&&(i=Eo(i,this.array)),i}setX(e,i){return this.normalized&&(i=en(i,this.array)),this.array[e*this.itemSize]=ml(i),this}getY(e){let i=F1(this.array[e*this.itemSize+1]);return this.normalized&&(i=Eo(i,this.array)),i}setY(e,i){return this.normalized&&(i=en(i,this.array)),this.array[e*this.itemSize+1]=ml(i),this}getZ(e){let i=F1(this.array[e*this.itemSize+2]);return this.normalized&&(i=Eo(i,this.array)),i}setZ(e,i){return this.normalized&&(i=en(i,this.array)),this.array[e*this.itemSize+2]=ml(i),this}getW(e){let i=F1(this.array[e*this.itemSize+3]);return this.normalized&&(i=Eo(i,this.array)),i}setW(e,i){return this.normalized&&(i=en(i,this.array)),this.array[e*this.itemSize+3]=ml(i),this}setXY(e,i,n){return e*=this.itemSize,this.normalized&&(i=en(i,this.array),n=en(n,this.array)),this.array[e+0]=ml(i),this.array[e+1]=ml(n),this}setXYZ(e,i,n,s){return e*=this.itemSize,this.normalized&&(i=en(i,this.array),n=en(n,this.array),s=en(s,this.array)),this.array[e+0]=ml(i),this.array[e+1]=ml(n),this.array[e+2]=ml(s),this}setXYZW(e,i,n,s,o){return e*=this.itemSize,this.normalized&&(i=en(i,this.array),n=en(n,this.array),s=en(s,this.array),o=en(o,this.array)),this.array[e+0]=ml(i),this.array[e+1]=ml(n),this.array[e+2]=ml(s),this.array[e+3]=ml(o),this}}class Zu extends Ol{constructor(e,i,n){super(new Float32Array(e),i,n)}}let lhe=0;const kl=new ws,x3=new Ra,bg=new Lt,gl=new ay,uy=new ay,Ia=new Lt;class Up extends lg{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:lhe++}),this.uuid=Hu(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Gue(e)?VU:jU)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,i){return this.attributes[e]=i,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,i,n=0){this.groups.push({start:e,count:i,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,i){this.drawRange.start=e,this.drawRange.count=i}applyMatrix4(e){const i=this.attributes.position;i!==void 0&&(i.applyMatrix4(e),i.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const o=new Go().getNormalMatrix(e);n.applyNormalMatrix(o),n.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(e),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return kl.makeRotationFromQuaternion(e),this.applyMatrix4(kl),this}rotateX(e){return kl.makeRotationX(e),this.applyMatrix4(kl),this}rotateY(e){return kl.makeRotationY(e),this.applyMatrix4(kl),this}rotateZ(e){return kl.makeRotationZ(e),this.applyMatrix4(kl),this}translate(e,i,n){return kl.makeTranslation(e,i,n),this.applyMatrix4(kl),this}scale(e,i,n){return kl.makeScale(e,i,n),this.applyMatrix4(kl),this}lookAt(e){return x3.lookAt(e),x3.updateMatrix(),this.applyMatrix4(x3.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(bg).negate(),this.translate(bg.x,bg.y,bg.z),this}setFromPoints(e){const i=this.getAttribute("position");if(i===void 0){const n=[];for(let s=0,o=e.length;s<o;s++){const l=e[s];n.push(l.x,l.y,l.z||0)}this.setAttribute("position",new Zu(n,3))}else{for(let n=0,s=i.count;n<s;n++){const o=e[n];i.setXYZ(n,o.x,o.y,o.z||0)}e.length>i.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),i.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ay);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new Lt(-1/0,-1/0,-1/0),new Lt(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),i)for(let n=0,s=i.length;n<s;n++){const o=i[n];gl.setFromBufferAttribute(o),this.morphTargetsRelative?(Ia.addVectors(this.boundingBox.min,gl.min),this.boundingBox.expandByPoint(Ia),Ia.addVectors(this.boundingBox.max,gl.max),this.boundingBox.expandByPoint(Ia)):(this.boundingBox.expandByPoint(gl.min),this.boundingBox.expandByPoint(gl.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new l3);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new Lt,1/0);return}if(e){const n=this.boundingSphere.center;if(gl.setFromBufferAttribute(e),i)for(let o=0,l=i.length;o<l;o++){const u=i[o];uy.setFromBufferAttribute(u),this.morphTargetsRelative?(Ia.addVectors(gl.min,uy.min),gl.expandByPoint(Ia),Ia.addVectors(gl.max,uy.max),gl.expandByPoint(Ia)):(gl.expandByPoint(uy.min),gl.expandByPoint(uy.max))}gl.getCenter(n);let s=0;for(let o=0,l=e.count;o<l;o++)Ia.fromBufferAttribute(e,o),s=Math.max(s,n.distanceToSquared(Ia));if(i)for(let o=0,l=i.length;o<l;o++){const u=i[o],c=this.morphTargetsRelative;for(let h=0,p=u.count;h<p;h++)Ia.fromBufferAttribute(u,h),c&&(bg.fromBufferAttribute(e,h),Ia.add(bg)),s=Math.max(s,n.distanceToSquared(Ia))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,i=this.attributes;if(e===null||i.position===void 0||i.normal===void 0||i.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=i.position,s=i.normal,o=i.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Ol(new Float32Array(4*n.count),4));const l=this.getAttribute("tangent"),u=[],c=[];for(let N=0;N<n.count;N++)u[N]=new Lt,c[N]=new Lt;const h=new Lt,p=new Lt,f=new Lt,g=new Dn,m=new Dn,y=new Dn,b=new Lt,v=new Lt;function _(N,D,P){h.fromBufferAttribute(n,N),p.fromBufferAttribute(n,D),f.fromBufferAttribute(n,P),g.fromBufferAttribute(o,N),m.fromBufferAttribute(o,D),y.fromBufferAttribute(o,P),p.sub(h),f.sub(h),m.sub(g),y.sub(g);const k=1/(m.x*y.y-y.x*m.y);isFinite(k)&&(b.copy(p).multiplyScalar(y.y).addScaledVector(f,-m.y).multiplyScalar(k),v.copy(f).multiplyScalar(m.x).addScaledVector(p,-y.x).multiplyScalar(k),u[N].add(b),u[D].add(b),u[P].add(b),c[N].add(v),c[D].add(v),c[P].add(v))}let T=this.groups;T.length===0&&(T=[{start:0,count:e.count}]);for(let N=0,D=T.length;N<D;++N){const P=T[N],k=P.start,q=P.count;for(let V=k,j=k+q;V<j;V+=3)_(e.getX(V+0),e.getX(V+1),e.getX(V+2))}const E=new Lt,C=new Lt,R=new Lt,B=new Lt;function I(N){R.fromBufferAttribute(s,N),B.copy(R);const D=u[N];E.copy(D),E.sub(R.multiplyScalar(R.dot(D))).normalize(),C.crossVectors(B,D);const P=C.dot(c[N])<0?-1:1;l.setXYZW(N,E.x,E.y,E.z,P)}for(let N=0,D=T.length;N<D;++N){const P=T[N],k=P.start,q=P.count;for(let V=k,j=k+q;V<j;V+=3)I(e.getX(V+0)),I(e.getX(V+1)),I(e.getX(V+2))}}computeVertexNormals(){const e=this.index,i=this.getAttribute("position");if(i!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new Ol(new Float32Array(i.count*3),3),this.setAttribute("normal",n);else for(let g=0,m=n.count;g<m;g++)n.setXYZ(g,0,0,0);const s=new Lt,o=new Lt,l=new Lt,u=new Lt,c=new Lt,h=new Lt,p=new Lt,f=new Lt;if(e)for(let g=0,m=e.count;g<m;g+=3){const y=e.getX(g+0),b=e.getX(g+1),v=e.getX(g+2);s.fromBufferAttribute(i,y),o.fromBufferAttribute(i,b),l.fromBufferAttribute(i,v),p.subVectors(l,o),f.subVectors(s,o),p.cross(f),u.fromBufferAttribute(n,y),c.fromBufferAttribute(n,b),h.fromBufferAttribute(n,v),u.add(p),c.add(p),h.add(p),n.setXYZ(y,u.x,u.y,u.z),n.setXYZ(b,c.x,c.y,c.z),n.setXYZ(v,h.x,h.y,h.z)}else for(let g=0,m=i.count;g<m;g+=3)s.fromBufferAttribute(i,g+0),o.fromBufferAttribute(i,g+1),l.fromBufferAttribute(i,g+2),p.subVectors(l,o),f.subVectors(s,o),p.cross(f),n.setXYZ(g+0,p.x,p.y,p.z),n.setXYZ(g+1,p.x,p.y,p.z),n.setXYZ(g+2,p.x,p.y,p.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let i=0,n=e.count;i<n;i++)Ia.fromBufferAttribute(e,i),Ia.normalize(),e.setXYZ(i,Ia.x,Ia.y,Ia.z)}toNonIndexed(){function e(u,c){const h=u.array,p=u.itemSize,f=u.normalized,g=new h.constructor(c.length*p);let m=0,y=0;for(let b=0,v=c.length;b<v;b++){u.isInterleavedBufferAttribute?m=c[b]*u.data.stride+u.offset:m=c[b]*p;for(let _=0;_<p;_++)g[y++]=h[m++]}return new Ol(g,p,f)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const i=new Up,n=this.index.array,s=this.attributes;for(const u in s){const c=s[u],h=e(c,n);i.setAttribute(u,h)}const o=this.morphAttributes;for(const u in o){const c=[],h=o[u];for(let p=0,f=h.length;p<f;p++){const g=h[p],m=e(g,n);c.push(m)}i.morphAttributes[u]=c}i.morphTargetsRelative=this.morphTargetsRelative;const l=this.groups;for(let u=0,c=l.length;u<c;u++){const h=l[u];i.addGroup(h.start,h.count,h.materialIndex)}return i}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const h in c)c[h]!==void 0&&(e[h]=c[h]);return e}e.data={attributes:{}};const i=this.index;i!==null&&(e.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});const n=this.attributes;for(const c in n){const h=n[c];e.data.attributes[c]=h.toJSON(e.data)}const s={};let o=!1;for(const c in this.morphAttributes){const h=this.morphAttributes[c],p=[];for(let f=0,g=h.length;f<g;f++){const m=h[f];p.push(m.toJSON(e.data))}p.length>0&&(s[c]=p,o=!0)}o&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);const l=this.groups;l.length>0&&(e.data.groups=JSON.parse(JSON.stringify(l)));const u=this.boundingSphere;return u!==null&&(e.data.boundingSphere={center:u.center.toArray(),radius:u.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const i={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone(i));const s=e.attributes;for(const h in s){const p=s[h];this.setAttribute(h,p.clone(i))}const o=e.morphAttributes;for(const h in o){const p=[],f=o[h];for(let g=0,m=f.length;g<m;g++)p.push(f[g].clone(i));this.morphAttributes[h]=p}this.morphTargetsRelative=e.morphTargetsRelative;const l=e.groups;for(let h=0,p=l.length;h<p;h++){const f=l[h];this.addGroup(f.start,f.count,f.materialIndex)}const u=e.boundingBox;u!==null&&(this.boundingBox=u.clone());const c=e.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const HU=new ws,zp=new Zue,z1=new l3,WU=new Lt,j1=new Lt,V1=new Lt,G1=new Lt,_3=new Lt,H1=new Lt,QU=new Lt,W1=new Lt;class jp extends Ra{constructor(e=new Up,i=new k1){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=i,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){const n=e[i[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=n.length;s<o;s++){const l=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=s}}}}getVertexPosition(e,i){const n=this.geometry,s=n.attributes.position,o=n.morphAttributes.position,l=n.morphTargetsRelative;i.fromBufferAttribute(s,e);const u=this.morphTargetInfluences;if(o&&u){H1.set(0,0,0);for(let c=0,h=o.length;c<h;c++){const p=u[c],f=o[c];p!==0&&(_3.fromBufferAttribute(f,e),l?H1.addScaledVector(_3,p):H1.addScaledVector(_3.sub(i),p))}i.add(H1)}return i}raycast(e,i){const n=this.geometry,s=this.material,o=this.matrixWorld;s!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),z1.copy(n.boundingSphere),z1.applyMatrix4(o),zp.copy(e.ray).recast(e.near),!(z1.containsPoint(zp.origin)===!1&&(zp.intersectSphere(z1,WU)===null||zp.origin.distanceToSquared(WU)>(e.far-e.near)**2))&&(HU.copy(o).invert(),zp.copy(e.ray).applyMatrix4(HU),!(n.boundingBox!==null&&zp.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(e,i,zp)))}_computeIntersections(e,i,n){let s;const o=this.geometry,l=this.material,u=o.index,c=o.attributes.position,h=o.attributes.uv,p=o.attributes.uv1,f=o.attributes.normal,g=o.groups,m=o.drawRange;if(u!==null)if(Array.isArray(l))for(let y=0,b=g.length;y<b;y++){const v=g[y],_=l[v.materialIndex],T=Math.max(v.start,m.start),E=Math.min(u.count,Math.min(v.start+v.count,m.start+m.count));for(let C=T,R=E;C<R;C+=3){const B=u.getX(C),I=u.getX(C+1),N=u.getX(C+2);s=Q1(this,_,e,n,h,p,f,B,I,N),s&&(s.faceIndex=Math.floor(C/3),s.face.materialIndex=v.materialIndex,i.push(s))}}else{const y=Math.max(0,m.start),b=Math.min(u.count,m.start+m.count);for(let v=y,_=b;v<_;v+=3){const T=u.getX(v),E=u.getX(v+1),C=u.getX(v+2);s=Q1(this,l,e,n,h,p,f,T,E,C),s&&(s.faceIndex=Math.floor(v/3),i.push(s))}}else if(c!==void 0)if(Array.isArray(l))for(let y=0,b=g.length;y<b;y++){const v=g[y],_=l[v.materialIndex],T=Math.max(v.start,m.start),E=Math.min(c.count,Math.min(v.start+v.count,m.start+m.count));for(let C=T,R=E;C<R;C+=3){const B=C,I=C+1,N=C+2;s=Q1(this,_,e,n,h,p,f,B,I,N),s&&(s.faceIndex=Math.floor(C/3),s.face.materialIndex=v.materialIndex,i.push(s))}}else{const y=Math.max(0,m.start),b=Math.min(c.count,m.start+m.count);for(let v=y,_=b;v<_;v+=3){const T=v,E=v+1,C=v+2;s=Q1(this,l,e,n,h,p,f,T,E,C),s&&(s.faceIndex=Math.floor(v/3),i.push(s))}}}}function che(r,e,i,n,s,o,l,u){let c;if(e.side===mc?c=n.intersectTriangle(l,o,s,!0,u):c=n.intersectTriangle(s,o,l,e.side===Jm,u),c===null)return null;W1.copy(u),W1.applyMatrix4(r.matrixWorld);const h=i.ray.origin.distanceTo(W1);return h<i.near||h>i.far?null:{distance:h,point:W1.clone(),object:r}}function Q1(r,e,i,n,s,o,l,u,c,h){r.getVertexPosition(u,j1),r.getVertexPosition(c,V1),r.getVertexPosition(h,G1);const p=che(r,e,i,n,j1,V1,G1,QU);if(p){const f=new Lt;xc.getBarycoord(QU,j1,V1,G1,f),s&&(p.uv=xc.getInterpolatedAttribute(s,u,c,h,f,new Dn)),o&&(p.uv1=xc.getInterpolatedAttribute(o,u,c,h,f,new Dn)),l&&(p.normal=xc.getInterpolatedAttribute(l,u,c,h,f,new Lt),p.normal.dot(n.direction)>0&&p.normal.multiplyScalar(-1));const g={a:u,b:c,c:h,normal:new Lt,materialIndex:0};xc.getNormal(j1,V1,G1,g.normal),p.face=g,p.barycoord=f}return p}class hy extends Up{constructor(e=1,i=1,n=1,s=1,o=1,l=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:i,depth:n,widthSegments:s,heightSegments:o,depthSegments:l};const u=this;s=Math.floor(s),o=Math.floor(o),l=Math.floor(l);const c=[],h=[],p=[],f=[];let g=0,m=0;y("z","y","x",-1,-1,n,i,e,l,o,0),y("z","y","x",1,-1,n,i,-e,l,o,1),y("x","z","y",1,1,e,n,i,s,l,2),y("x","z","y",1,-1,e,n,-i,s,l,3),y("x","y","z",1,-1,e,i,n,s,o,4),y("x","y","z",-1,-1,e,i,-n,s,o,5),this.setIndex(c),this.setAttribute("position",new Zu(h,3)),this.setAttribute("normal",new Zu(p,3)),this.setAttribute("uv",new Zu(f,2));function y(b,v,_,T,E,C,R,B,I,N,D){const P=C/I,k=R/N,q=C/2,V=R/2,j=B/2,Q=I+1,W=N+1;let G=0,z=0;const te=new Lt;for(let Y=0;Y<W;Y++){const se=Y*k-V;for(let ve=0;ve<Q;ve++){const Ae=ve*P-q;te[b]=Ae*T,te[v]=se*E,te[_]=j,h.push(te.x,te.y,te.z),te[b]=0,te[v]=0,te[_]=B>0?1:-1,p.push(te.x,te.y,te.z),f.push(ve/I),f.push(1-Y/N),G+=1}}for(let Y=0;Y<N;Y++)for(let se=0;se<I;se++){const ve=g+se+Q*Y,Ae=g+se+Q*(Y+1),me=g+(se+1)+Q*(Y+1),Oe=g+(se+1)+Q*Y;c.push(ve,Ae,Oe),c.push(Ae,me,Oe),z+=6}u.addGroup(m,z,D),m+=z,g+=G}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new hy(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function qU(r){const e={};for(const i in r){e[i]={};for(const n in r[i]){const s=r[i][n];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[i][n]=null):e[i][n]=s.clone():Array.isArray(s)?e[i][n]=s.slice():e[i][n]=s}}return e}function uhe(r){const e=[];for(let i=0;i<r.length;i++)e.push(r[i].clone());return e}var hhe=`
void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}
`,dhe=`
void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}
`;class phe extends Ho{static get type(){return"ShaderMaterial"}constructor(e){super(),this.isShaderMaterial=!0,this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=hhe,this.fragmentShader=dhe,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=qU(e.uniforms),this.uniformsGroups=uhe(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const i=super.toJSON(e);i.glslVersion=this.glslVersion,i.uniforms={};for(const s in this.uniforms){const o=this.uniforms[s].value;o&&o.isTexture?i.uniforms[s]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?i.uniforms[s]={type:"c",value:o.getHex()}:o&&o.isVector2?i.uniforms[s]={type:"v2",value:o.toArray()}:o&&o.isVector3?i.uniforms[s]={type:"v3",value:o.toArray()}:o&&o.isVector4?i.uniforms[s]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?i.uniforms[s]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?i.uniforms[s]={type:"m4",value:o.toArray()}:i.uniforms[s]={value:o}}Object.keys(this.defines).length>0&&(i.defines=this.defines),i.vertexShader=this.vertexShader,i.fragmentShader=this.fragmentShader,i.lights=this.lights,i.clipping=this.clipping;const n={};for(const s in this.extensions)this.extensions[s]===!0&&(n[s]=!0);return Object.keys(n).length>0&&(i.extensions=n),i}}class XU extends Ra{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new ws,this.projectionMatrix=new ws,this.projectionMatrixInverse=new ws,this.coordinateSystem=gc}copy(e,i){return super.copy(e,i),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,i){super.updateWorldMatrix(e,i),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const gd=new Lt,YU=new Dn,KU=new Dn;class $u extends XU{constructor(e=50,i=1,n=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=s,this.focus=10,this.aspect=i,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,i){return super.copy(e,i),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const i=.5*this.getFilmHeight()/e;this.fov=ry*2*Math.atan(i),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(iy*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return ry*2*Math.atan(Math.tan(iy*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,i,n){gd.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(gd.x,gd.y).multiplyScalar(-e/gd.z),gd.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(gd.x,gd.y).multiplyScalar(-e/gd.z)}getViewSize(e,i){return this.getViewBounds(e,YU,KU),i.subVectors(KU,YU)}setViewOffset(e,i,n,s,o,l){this.aspect=e/i,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=i,this.view.offsetX=n,this.view.offsetY=s,this.view.width=o,this.view.height=l,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let i=e*Math.tan(iy*.5*this.fov)/this.zoom,n=2*i,s=this.aspect*n,o=-.5*s;const l=this.view;if(this.view!==null&&this.view.enabled){const c=l.fullWidth,h=l.fullHeight;o+=l.offsetX*s/c,i-=l.offsetY*n/h,s*=l.width/c,n*=l.height/h}const u=this.filmOffset;u!==0&&(o+=e*u/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+s,i,i-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const i=super.toJSON(e);return i.object.fov=this.fov,i.object.zoom=this.zoom,i.object.near=this.near,i.object.far=this.far,i.object.focus=this.focus,i.object.aspect=this.aspect,this.view!==null&&(i.object.view=Object.assign({},this.view)),i.object.filmGauge=this.filmGauge,i.object.filmOffset=this.filmOffset,i}}const xg=-90,_g=1;class JU extends Ra{constructor(e,i,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const s=new $u(xg,_g,e,i);s.layers=this.layers,this.add(s);const o=new $u(xg,_g,e,i);o.layers=this.layers,this.add(o);const l=new $u(xg,_g,e,i);l.layers=this.layers,this.add(l);const u=new $u(xg,_g,e,i);u.layers=this.layers,this.add(u);const c=new $u(xg,_g,e,i);c.layers=this.layers,this.add(c);const h=new $u(xg,_g,e,i);h.layers=this.layers,this.add(h)}updateCoordinateSystem(){const e=this.coordinateSystem,i=this.children.concat(),[n,s,o,l,u,c]=i;for(const h of i)this.remove(h);if(e===gc)n.up.set(0,1,0),n.lookAt(1,0,0),s.up.set(0,1,0),s.lookAt(-1,0,0),o.up.set(0,0,-1),o.lookAt(0,1,0),l.up.set(0,0,1),l.lookAt(0,-1,0),u.up.set(0,1,0),u.lookAt(0,0,1),c.up.set(0,1,0),c.lookAt(0,0,-1);else if(e===Op)n.up.set(0,-1,0),n.lookAt(-1,0,0),s.up.set(0,-1,0),s.lookAt(1,0,0),o.up.set(0,0,1),o.lookAt(0,1,0),l.up.set(0,0,-1),l.lookAt(0,-1,0),u.up.set(0,-1,0),u.lookAt(0,0,1),c.up.set(0,-1,0),c.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const h of i)this.add(h),h.updateMatrixWorld()}update(e,i){this.parent===null&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:s}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[o,l,u,c,h,p]=this.children,f=e.getRenderTarget(),g=e.getActiveCubeFace(),m=e.getActiveMipmapLevel(),y=e.xr.enabled;e.xr.enabled=!1;const b=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,s),e.render(i,o),e.setRenderTarget(n,1,s),e.render(i,l),e.setRenderTarget(n,2,s),e.render(i,u),e.setRenderTarget(n,3,s),e.render(i,c),e.setRenderTarget(n,4,s),e.render(i,h),n.texture.generateMipmaps=b,e.setRenderTarget(n,5,s),e.render(i,p),e.setRenderTarget(f,g,m),e.xr.enabled=y,n.texture.needsPMREMUpdate=!0}}class E3 extends wo{constructor(e,i,n,s,o,l,u,c,h,p){e=e!==void 0?e:[],i=i!==void 0?i:Lp,super(e,i,n,s,o,l,u,c,h,p),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class fhe extends Yue{constructor(e=1,i={}){super(e,e,i),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},s=[n,n,n,n,n,n];this.texture=new E3(s,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:dl}fromEquirectangularTexture(e,i){this.texture.type=i.type,this.texture.colorSpace=i.colorSpace,this.texture.generateMipmaps=i.generateMipmaps,this.texture.minFilter=i.minFilter,this.texture.magFilter=i.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},s=new hy(5,5,5),o=new phe({name:"CubemapFromEquirect",uniforms:qU(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:mc,blending:$m});o.uniforms.tEquirect.value=i;const l=new jp(s,o),u=i.minFilter;return i.minFilter===Vu&&(i.minFilter=dl),new JU(1,10,this).update(e,l),i.minFilter=u,l.geometry.dispose(),l.material.dispose(),this}clear(e,i,n,s){const o=e.getRenderTarget();for(let l=0;l<6;l++)e.setRenderTarget(this,l),e.clear(i,n,s);e.setRenderTarget(o)}}class ZU extends Ra{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new vc,this.environmentIntensity=1,this.environmentRotation=new vc,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,i){return super.copy(e,i),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const i=super.toJSON(e);return this.fog!==null&&(i.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(i.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(i.object.backgroundIntensity=this.backgroundIntensity),i.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(i.object.environmentIntensity=this.environmentIntensity),i.object.environmentRotation=this.environmentRotation.toArray(),i}}class $U{constructor(e,i){this.isInterleavedBuffer=!0,this.array=e,this.stride=i,this.count=e!==void 0?e.length/i:0,this.usage=M1,this.updateRanges=[],this.version=0,this.uuid=Hu()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,i){this.updateRanges.push({start:e,count:i})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,i,n){e*=this.stride,n*=i.stride;for(let s=0,o=this.stride;s<o;s++)this.array[e+s]=i.array[n+s];return this}set(e,i=0){return this.array.set(e,i),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Hu()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const i=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(i,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Hu()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Co=new Lt;class w3{constructor(e,i,n,s=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=i,this.offset=n,this.normalized=s}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let i=0,n=this.data.count;i<n;i++)Co.fromBufferAttribute(this,i),Co.applyMatrix4(e),this.setXYZ(i,Co.x,Co.y,Co.z);return this}applyNormalMatrix(e){for(let i=0,n=this.count;i<n;i++)Co.fromBufferAttribute(this,i),Co.applyNormalMatrix(e),this.setXYZ(i,Co.x,Co.y,Co.z);return this}transformDirection(e){for(let i=0,n=this.count;i<n;i++)Co.fromBufferAttribute(this,i),Co.transformDirection(e),this.setXYZ(i,Co.x,Co.y,Co.z);return this}getComponent(e,i){let n=this.array[e*this.data.stride+this.offset+i];return this.normalized&&(n=Eo(n,this.array)),n}setComponent(e,i,n){return this.normalized&&(n=en(n,this.array)),this.data.array[e*this.data.stride+this.offset+i]=n,this}setX(e,i){return this.normalized&&(i=en(i,this.array)),this.data.array[e*this.data.stride+this.offset]=i,this}setY(e,i){return this.normalized&&(i=en(i,this.array)),this.data.array[e*this.data.stride+this.offset+1]=i,this}setZ(e,i){return this.normalized&&(i=en(i,this.array)),this.data.array[e*this.data.stride+this.offset+2]=i,this}setW(e,i){return this.normalized&&(i=en(i,this.array)),this.data.array[e*this.data.stride+this.offset+3]=i,this}getX(e){let i=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(i=Eo(i,this.array)),i}getY(e){let i=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(i=Eo(i,this.array)),i}getZ(e){let i=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(i=Eo(i,this.array)),i}getW(e){let i=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(i=Eo(i,this.array)),i}setXY(e,i,n){return e=e*this.data.stride+this.offset,this.normalized&&(i=en(i,this.array),n=en(n,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=n,this}setXYZ(e,i,n,s){return e=e*this.data.stride+this.offset,this.normalized&&(i=en(i,this.array),n=en(n,this.array),s=en(s,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=n,this.data.array[e+2]=s,this}setXYZW(e,i,n,s,o){return e=e*this.data.stride+this.offset,this.normalized&&(i=en(i,this.array),n=en(n,this.array),s=en(s,this.array),o=en(o,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=n,this.data.array[e+2]=s,this.data.array[e+3]=o,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let n=0;n<this.count;n++){const s=n*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)i.push(this.data.array[s+o])}return new Ol(new this.array.constructor(i),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new w3(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let n=0;n<this.count;n++){const s=n*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)i.push(this.data.array[s+o])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:i,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class e6 extends Ho{static get type(){return"SpriteMaterial"}constructor(e){super(),this.isSpriteMaterial=!0,this.color=new Zn(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}class mhe extends wo{constructor(e=null,i=1,n=1,s,o,l,u,c,h=to,p=to,f,g){super(null,l,u,c,h,p,s,o,f,g),this.isDataTexture=!0,this.image={data:e,width:i,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class ghe extends Ol{constructor(e,i,n,s=1){super(e,i,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=s}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const C3=new Lt,Ahe=new Lt,yhe=new Go;class Ad{constructor(e=new Lt(1,0,0),i=0){this.isPlane=!0,this.normal=e,this.constant=i}set(e,i){return this.normal.copy(e),this.constant=i,this}setComponents(e,i,n,s){return this.normal.set(e,i,n),this.constant=s,this}setFromNormalAndCoplanarPoint(e,i){return this.normal.copy(e),this.constant=-i.dot(this.normal),this}setFromCoplanarPoints(e,i,n){const s=C3.subVectors(n,i).cross(Ahe.subVectors(e,i)).normalize();return this.setFromNormalAndCoplanarPoint(s,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,i){return i.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,i){const n=e.delta(C3),s=this.normal.dot(n);if(s===0)return this.distanceToPoint(e.start)===0?i.copy(e.start):null;const o=-(e.start.dot(this.normal)+this.constant)/s;return o<0||o>1?null:i.copy(e.start).addScaledVector(n,o)}intersectsLine(e){const i=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return i<0&&n>0||n<0&&i>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,i){const n=i||yhe.getNormalMatrix(e),s=this.coplanarPoint(C3).applyMatrix4(e),o=this.normal.applyMatrix3(n).normalize();return this.constant=-s.dot(o),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Vp=new l3,q1=new Lt;class t6{constructor(e=new Ad,i=new Ad,n=new Ad,s=new Ad,o=new Ad,l=new Ad){this.planes=[e,i,n,s,o,l]}set(e,i,n,s,o,l){const u=this.planes;return u[0].copy(e),u[1].copy(i),u[2].copy(n),u[3].copy(s),u[4].copy(o),u[5].copy(l),this}copy(e){const i=this.planes;for(let n=0;n<6;n++)i[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,i=gc){const n=this.planes,s=e.elements,o=s[0],l=s[1],u=s[2],c=s[3],h=s[4],p=s[5],f=s[6],g=s[7],m=s[8],y=s[9],b=s[10],v=s[11],_=s[12],T=s[13],E=s[14],C=s[15];if(n[0].setComponents(c-o,g-h,v-m,C-_).normalize(),n[1].setComponents(c+o,g+h,v+m,C+_).normalize(),n[2].setComponents(c+l,g+p,v+y,C+T).normalize(),n[3].setComponents(c-l,g-p,v-y,C-T).normalize(),n[4].setComponents(c-u,g-f,v-b,C-E).normalize(),i===gc)n[5].setComponents(c+u,g+f,v+b,C+E).normalize();else if(i===Op)n[5].setComponents(u,f,b,E).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+i);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Vp.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const i=e.geometry;i.boundingSphere===null&&i.computeBoundingSphere(),Vp.copy(i.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Vp)}intersectsSprite(e){return Vp.center.set(0,0,0),Vp.radius=.7071067811865476,Vp.applyMatrix4(e.matrixWorld),this.intersectsSphere(Vp)}intersectsSphere(e){const i=this.planes,n=e.center,s=-e.radius;for(let o=0;o<6;o++)if(i[o].distanceToPoint(n)<s)return!1;return!0}intersectsBox(e){const i=this.planes;for(let n=0;n<6;n++){const s=i[n];if(q1.x=s.normal.x>0?e.max.x:e.min.x,q1.y=s.normal.y>0?e.max.y:e.min.y,q1.z=s.normal.z>0?e.max.z:e.min.z,s.distanceToPoint(q1)<0)return!1}return!0}containsPoint(e){const i=this.planes;for(let n=0;n<6;n++)if(i[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}class S3 extends Ho{static get type(){return"LineBasicMaterial"}constructor(e){super(),this.isLineBasicMaterial=!0,this.color=new Zn(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}class i6 extends Ho{static get type(){return"PointsMaterial"}constructor(e){super(),this.isPointsMaterial=!0,this.color=new Zn(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}class vhe extends wo{constructor(e,i){super({width:e,height:i}),this.isFramebufferTexture=!0,this.magFilter=to,this.minFilter=to,this.generateMipmaps=!1,this.needsUpdate=!0}}class Eg extends wo{constructor(e,i,n,s,o,l,u,c,h,p=Dp){if(p!==Dp&&p!==ag)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&p===Dp&&(n=Fa),n===void 0&&p===ag&&(n=$A),super(null,s,o,l,u,c,p,n,h),this.isDepthTexture=!0,this.image={width:e,height:i},this.magFilter=u!==void 0?u:to,this.minFilter=c!==void 0?c:to,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const i=super.toJSON(e);return this.compareFunction!==null&&(i.compareFunction=this.compareFunction),i}}class T3 extends Up{constructor(e=1,i=32,n=16,s=0,o=Math.PI*2,l=0,u=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:i,heightSegments:n,phiStart:s,phiLength:o,thetaStart:l,thetaLength:u},i=Math.max(3,Math.floor(i)),n=Math.max(2,Math.floor(n));const c=Math.min(l+u,Math.PI);let h=0;const p=[],f=new Lt,g=new Lt,m=[],y=[],b=[],v=[];for(let _=0;_<=n;_++){const T=[],E=_/n;let C=0;_===0&&l===0?C=.5/i:_===n&&c===Math.PI&&(C=-.5/i);for(let R=0;R<=i;R++){const B=R/i;f.x=-e*Math.cos(s+B*o)*Math.sin(l+E*u),f.y=e*Math.cos(l+E*u),f.z=e*Math.sin(s+B*o)*Math.sin(l+E*u),y.push(f.x,f.y,f.z),g.copy(f).normalize(),b.push(g.x,g.y,g.z),v.push(B+C,1-E),T.push(h++)}p.push(T)}for(let _=0;_<n;_++)for(let T=0;T<i;T++){const E=p[_][T+1],C=p[_][T],R=p[_+1][T],B=p[_+1][T+1];(_!==0||l>0)&&m.push(E,C,B),(_!==n-1||c<Math.PI)&&m.push(C,R,B)}this.setIndex(m),this.setAttribute("position",new Zu(y,3)),this.setAttribute("normal",new Zu(b,3)),this.setAttribute("uv",new Zu(v,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new T3(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class r6 extends Ho{static get type(){return"ShadowMaterial"}constructor(e){super(),this.isShadowMaterial=!0,this.color=new Zn(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class M3 extends Ho{static get type(){return"MeshStandardMaterial"}constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.color=new Zn(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Zn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=cd,this.normalScale=new Dn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new vc,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class n6 extends M3{static get type(){return"MeshPhysicalMaterial"}constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Dn(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Ua(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(i){this.ior=(1+.4*i)/(1-.4*i)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Zn(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Zn(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Zn(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class s6 extends Ho{static get type(){return"MeshPhongMaterial"}constructor(e){super(),this.isMeshPhongMaterial=!0,this.color=new Zn(16777215),this.specular=new Zn(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Zn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=cd,this.normalScale=new Dn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new vc,this.combine=_1,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class a6 extends Ho{static get type(){return"MeshToonMaterial"}constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.color=new Zn(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Zn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=cd,this.normalScale=new Dn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class o6 extends Ho{static get type(){return"MeshNormalMaterial"}constructor(e){super(),this.isMeshNormalMaterial=!0,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=cd,this.normalScale=new Dn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class l6 extends Ho{static get type(){return"MeshLambertMaterial"}constructor(e){super(),this.isMeshLambertMaterial=!0,this.color=new Zn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Zn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=cd,this.normalScale=new Dn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new vc,this.combine=_1,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class c6 extends Ho{static get type(){return"MeshMatcapMaterial"}constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.color=new Zn(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=cd,this.normalScale=new Dn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class u6 extends S3{static get type(){return"LineDashedMaterial"}constructor(e){super(),this.isLineDashedMaterial=!0,this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}class Gp extends Ra{constructor(e,i=1){super(),this.isLight=!0,this.type="Light",this.color=new Zn(e),this.intensity=i}dispose(){}copy(e,i){return super.copy(e,i),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const i=super.toJSON(e);return i.object.color=this.color.getHex(),i.object.intensity=this.intensity,this.groundColor!==void 0&&(i.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(i.object.distance=this.distance),this.angle!==void 0&&(i.object.angle=this.angle),this.decay!==void 0&&(i.object.decay=this.decay),this.penumbra!==void 0&&(i.object.penumbra=this.penumbra),this.shadow!==void 0&&(i.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(i.object.target=this.target.uuid),i}}class bhe extends Gp{constructor(e,i,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Ra.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Zn(i)}copy(e,i){return super.copy(e,i),this.groundColor.copy(e.groundColor),this}}const R3=new ws,h6=new Lt,d6=new Lt;class I3{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Dn(512,512),this.map=null,this.mapPass=null,this.matrix=new ws,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new t6,this._frameExtents=new Dn(1,1),this._viewportCount=1,this._viewports=[new Jn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const i=this.camera,n=this.matrix;h6.setFromMatrixPosition(e.matrixWorld),i.position.copy(h6),d6.setFromMatrixPosition(e.target.matrixWorld),i.lookAt(d6),i.updateMatrixWorld(),R3.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(R3),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(R3)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class xhe extends I3{constructor(){super(new $u(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const i=this.camera,n=ry*2*e.angle*this.focus,s=this.mapSize.width/this.mapSize.height,o=e.distance||i.far;(n!==i.fov||s!==i.aspect||o!==i.far)&&(i.fov=n,i.aspect=s,i.far=o,i.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class p6 extends Gp{constructor(e,i,n=0,s=Math.PI/3,o=0,l=2){super(e,i),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Ra.DEFAULT_UP),this.updateMatrix(),this.target=new Ra,this.distance=n,this.angle=s,this.penumbra=o,this.decay=l,this.map=null,this.shadow=new xhe}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,i){return super.copy(e,i),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const f6=new ws,dy=new Lt,B3=new Lt;class _he extends I3{constructor(){super(new $u(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Dn(4,2),this._viewportCount=6,this._viewports=[new Jn(2,1,1,1),new Jn(0,1,1,1),new Jn(3,1,1,1),new Jn(1,1,1,1),new Jn(3,0,1,1),new Jn(1,0,1,1)],this._cubeDirections=[new Lt(1,0,0),new Lt(-1,0,0),new Lt(0,0,1),new Lt(0,0,-1),new Lt(0,1,0),new Lt(0,-1,0)],this._cubeUps=[new Lt(0,1,0),new Lt(0,1,0),new Lt(0,1,0),new Lt(0,1,0),new Lt(0,0,1),new Lt(0,0,-1)]}updateMatrices(e,i=0){const n=this.camera,s=this.matrix,o=e.distance||n.far;o!==n.far&&(n.far=o,n.updateProjectionMatrix()),dy.setFromMatrixPosition(e.matrixWorld),n.position.copy(dy),B3.copy(n.position),B3.add(this._cubeDirections[i]),n.up.copy(this._cubeUps[i]),n.lookAt(B3),n.updateMatrixWorld(),s.makeTranslation(-dy.x,-dy.y,-dy.z),f6.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(f6)}}class Ehe extends Gp{constructor(e,i,n=0,s=2){super(e,i),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=s,this.shadow=new _he}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,i){return super.copy(e,i),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class L3 extends XU{constructor(e=-1,i=1,n=1,s=-1,o=.1,l=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=i,this.top=n,this.bottom=s,this.near=o,this.far=l,this.updateProjectionMatrix()}copy(e,i){return super.copy(e,i),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,i,n,s,o,l){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=i,this.view.offsetX=n,this.view.offsetY=s,this.view.width=o,this.view.height=l,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),i=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let o=n-e,l=n+e,u=s+i,c=s-i;if(this.view!==null&&this.view.enabled){const h=(this.right-this.left)/this.view.fullWidth/this.zoom,p=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o+=h*this.view.offsetX,l=o+h*this.view.width,u-=p*this.view.offsetY,c=u-p*this.view.height}this.projectionMatrix.makeOrthographic(o,l,u,c,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const i=super.toJSON(e);return i.object.zoom=this.zoom,i.object.left=this.left,i.object.right=this.right,i.object.top=this.top,i.object.bottom=this.bottom,i.object.near=this.near,i.object.far=this.far,this.view!==null&&(i.object.view=Object.assign({},this.view)),i}}class whe extends I3{constructor(){super(new L3(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Che extends Gp{constructor(e,i){super(e,i),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Ra.DEFAULT_UP),this.updateMatrix(),this.target=new Ra,this.shadow=new whe}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class She extends Gp{constructor(e,i){super(e,i),this.isAmbientLight=!0,this.type="AmbientLight"}}class The extends Gp{constructor(e,i,n=10,s=10){super(e,i),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=s}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const i=super.toJSON(e);return i.object.width=this.width,i.object.height=this.height,i}}class Mhe{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new Lt)}set(e){for(let i=0;i<9;i++)this.coefficients[i].copy(e[i]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,i){const n=e.x,s=e.y,o=e.z,l=this.coefficients;return i.copy(l[0]).multiplyScalar(.282095),i.addScaledVector(l[1],.488603*s),i.addScaledVector(l[2],.488603*o),i.addScaledVector(l[3],.488603*n),i.addScaledVector(l[4],1.092548*(n*s)),i.addScaledVector(l[5],1.092548*(s*o)),i.addScaledVector(l[6],.315392*(3*o*o-1)),i.addScaledVector(l[7],1.092548*(n*o)),i.addScaledVector(l[8],.546274*(n*n-s*s)),i}getIrradianceAt(e,i){const n=e.x,s=e.y,o=e.z,l=this.coefficients;return i.copy(l[0]).multiplyScalar(.886227),i.addScaledVector(l[1],2*.511664*s),i.addScaledVector(l[2],2*.511664*o),i.addScaledVector(l[3],2*.511664*n),i.addScaledVector(l[4],2*.429043*n*s),i.addScaledVector(l[5],2*.429043*s*o),i.addScaledVector(l[6],.743125*o*o-.247708),i.addScaledVector(l[7],2*.429043*n*o),i.addScaledVector(l[8],.429043*(n*n-s*s)),i}add(e){for(let i=0;i<9;i++)this.coefficients[i].add(e.coefficients[i]);return this}addScaledSH(e,i){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],i);return this}scale(e){for(let i=0;i<9;i++)this.coefficients[i].multiplyScalar(e);return this}lerp(e,i){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],i);return this}equals(e){for(let i=0;i<9;i++)if(!this.coefficients[i].equals(e.coefficients[i]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,i=0){const n=this.coefficients;for(let s=0;s<9;s++)n[s].fromArray(e,i+s*3);return this}toArray(e=[],i=0){const n=this.coefficients;for(let s=0;s<9;s++)n[s].toArray(e,i+s*3);return e}static getBasisAt(e,i){const n=e.x,s=e.y,o=e.z;i[0]=.282095,i[1]=.488603*s,i[2]=.488603*o,i[3]=.488603*n,i[4]=1.092548*n*s,i[5]=1.092548*s*o,i[6]=.315392*(3*o*o-1),i[7]=1.092548*n*o,i[8]=.546274*(n*n-s*s)}}class Rhe extends Gp{constructor(e=new Mhe,i=1){super(void 0,i),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const i=super.toJSON(e);return i.object.sh=this.sh.toArray(),i}}class Ihe extends $U{constructor(e,i,n=1){super(e,i),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const i=super.clone(e);return i.meshPerAttribute=this.meshPerAttribute,i}toJSON(e){const i=super.toJSON(e);return i.isInstancedInterleavedBuffer=!0,i.meshPerAttribute=this.meshPerAttribute,i}}const Bhe=["alphaMap","alphaTest","anisotropy","anisotropyMap","anisotropyRotation","aoMap","attenuationColor","attenuationDistance","bumpMap","clearcoat","clearcoatMap","clearcoatNormalMap","clearcoatNormalScale","clearcoatRoughness","color","dispersion","displacementMap","emissive","emissiveMap","envMap","gradientMap","ior","iridescence","iridescenceIOR","iridescenceMap","iridescenceThicknessMap","lightMap","map","matcap","metalness","metalnessMap","normalMap","normalScale","opacity","roughness","roughnessMap","sheen","sheenColor","sheenColorMap","sheenRoughnessMap","shininess","specular","specularColor","specularColorMap","specularIntensity","specularIntensityMap","specularMap","thickness","transmission","transmissionMap"];class Lhe{constructor(e){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(e),this.hasAnimation=e.object.isSkinnedMesh===!0,this.refreshUniforms=Bhe,this.renderId=0}firstInitialization(e){return this.renderObjects.has(e)===!1?(this.getRenderObjectData(e),!0):!1}getRenderObjectData(e){let i=this.renderObjects.get(e);if(i===void 0){const{geometry:n,material:s}=e;if(i={material:this.getMaterialData(s),geometry:{attributes:this.getAttributesData(n.attributes),indexVersion:n.index?n.index.version:null,drawRange:{start:n.drawRange.start,count:n.drawRange.count}},worldMatrix:e.object.matrixWorld.clone()},e.object.center&&(i.center=e.object.center.clone()),e.object.morphTargetInfluences&&(i.morphTargetInfluences=e.object.morphTargetInfluences.slice()),e.bundle!==null&&(i.version=e.bundle.version),i.material.transmission>0){const{width:o,height:l}=e.context;i.bufferWidth=o,i.bufferHeight=l}this.renderObjects.set(e,i)}return i}getAttributesData(e){const i={};for(const n in e){const s=e[n];i[n]={version:s.version}}return i}containsNode(e){const i=e.material;for(const n in i)if(i[n]&&i[n].isNode)return!0;return e.renderer.nodes.modelViewMatrix!==null||e.renderer.nodes.modelNormalViewMatrix!==null}getMaterialData(e){const i={};for(const n of this.refreshUniforms){const s=e[n];s!=null&&(typeof s=="object"&&s.clone!==void 0?s.isTexture===!0?i[n]={id:s.id,version:s.version}:i[n]=s.clone():i[n]=s)}return i}equals(e){const{object:i,material:n,geometry:s}=e,o=this.getRenderObjectData(e);if(o.worldMatrix.equals(i.matrixWorld)!==!0)return o.worldMatrix.copy(i.matrixWorld),!1;const l=o.material;for(const b in l){const v=l[b],_=n[b];if(v.equals!==void 0){if(v.equals(_)===!1)return v.copy(_),!1}else if(_.isTexture===!0){if(v.id!==_.id||v.version!==_.version)return v.id=_.id,v.version=_.version,!1}else if(v!==_)return l[b]=_,!1}if(l.transmission>0){const{width:b,height:v}=e.context;if(o.bufferWidth!==b||o.bufferHeight!==v)return o.bufferWidth=b,o.bufferHeight=v,!1}const u=o.geometry,c=s.attributes,h=u.attributes,p=Object.keys(h),f=Object.keys(c);if(p.length!==f.length)return o.geometry.attributes=this.getAttributesData(c),!1;for(const b of p){const v=h[b],_=c[b];if(_===void 0)return delete h[b],!1;if(v.version!==_.version)return v.version=_.version,!1}const g=s.index,m=u.indexVersion,y=g?g.version:null;if(m!==y)return u.indexVersion=y,!1;if(u.drawRange.start!==s.drawRange.start||u.drawRange.count!==s.drawRange.count)return u.drawRange.start=s.drawRange.start,u.drawRange.count=s.drawRange.count,!1;if(o.morphTargetInfluences){let b=!1;for(let v=0;v<o.morphTargetInfluences.length;v++)o.morphTargetInfluences[v]!==i.morphTargetInfluences[v]&&(b=!0);if(b)return!0}return o.center&&o.center.equals(i.center)===!1?(o.center.copy(i.center),!0):(e.bundle!==null&&(o.version=e.bundle.version),!0)}needsRefresh(e,i){if(this.hasNode||this.hasAnimation||this.firstInitialization(e))return!0;const{renderId:n}=i;if(this.renderId!==n)return this.renderId=n,!0;const s=e.object.static===!0,o=e.bundle!==null&&e.bundle.static===!0&&this.getRenderObjectData(e).version===e.bundle.version;return s||o?!1:this.equals(e)!==!0}}function py(r,e=0){let i=3735928559^e,n=1103547991^e;if(r instanceof Array)for(let s=0,o;s<r.length;s++)o=r[s],i=Math.imul(i^o,2654435761),n=Math.imul(n^o,1597334677);else for(let s=0,o;s<r.length;s++)o=r.charCodeAt(s),i=Math.imul(i^o,2654435761),n=Math.imul(n^o,1597334677);return i=Math.imul(i^i>>>16,2246822507),i^=Math.imul(n^n>>>13,3266489909),n=Math.imul(n^n>>>16,2246822507),n^=Math.imul(i^i>>>13,3266489909),4294967296*(2097151&n)+(i>>>0)}const Dhe=r=>py(r),m6=r=>py(r),X1=(...r)=>py(r);function g6(r,e=!1){const i=[];r.isNode===!0&&(i.push(r.id),r=r.getSelf());for(const{property:n,childNode:s}of Y1(r))i.push(i,py(n.slice(0,-4)),s.getCacheKey(e));return py(i)}function*Y1(r,e=!1){for(const i in r){if(i.startsWith("_")===!0)continue;const n=r[i];if(Array.isArray(n)===!0)for(let s=0;s<n.length;s++){const o=n[s];o&&(o.isNode===!0||e&&typeof o.toJSON=="function")&&(yield{property:i,index:s,childNode:o})}else if(n&&n.isNode===!0)yield{property:i,childNode:n};else if(typeof n=="object")for(const s in n){const o=n[s];o&&(o.isNode===!0||e&&typeof o.toJSON=="function")&&(yield{property:i,index:s,childNode:o})}}}function K1(r){if(r==null)return null;const e=typeof r;return r.isNode===!0?"node":e==="number"?"float":e==="boolean"?"bool":e==="string"?"string":e==="function"?"shader":r.isVector2===!0?"vec2":r.isVector3===!0?"vec3":r.isVector4===!0?"vec4":r.isMatrix3===!0?"mat3":r.isMatrix4===!0?"mat4":r.isColor===!0?"color":r instanceof ArrayBuffer?"ArrayBuffer":null}function A6(r,...e){const i=r?r.slice(-4):void 0;return e.length===1&&(i==="vec2"?e=[e[0],e[0]]:i==="vec3"?e=[e[0],e[0],e[0]]:i==="vec4"&&(e=[e[0],e[0],e[0],e[0]])),r==="color"?new Zn(...e):i==="vec2"?new Dn(...e):i==="vec3"?new Lt(...e):i==="vec4"?new Jn(...e):i==="mat3"?new Go(...e):i==="mat4"?new ws(...e):r==="bool"?e[0]||!1:r==="float"||r==="int"||r==="uint"?e[0]||0:r==="string"?e[0]||"":r==="ArrayBuffer"?Phe(e[0]):null}function Nhe(r){let e="";const i=new Uint8Array(r);for(let n=0;n<i.length;n++)e+=String.fromCharCode(i[n]);return btoa(e)}function Phe(r){return Uint8Array.from(atob(r),e=>e.charCodeAt(0)).buffer}const y6={VERTEX:"vertex"},un={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},Ohe=["fragment","vertex"],v6=["setup","analyze","generate"],b6=[...Ohe,"compute"],wg=["x","y","z","w"];let khe=0,tn=class extends lg{static get type(){return"Node"}constructor(r=null){super(),this.nodeType=r,this.updateType=un.NONE,this.updateBeforeType=un.NONE,this.updateAfterType=un.NONE,this.uuid=Vue.generateUUID(),this.version=0,this._cacheKey=null,this._cacheKeyVersion=0,this.global=!1,this.isNode=!0,Object.defineProperty(this,"id",{value:khe++})}set needsUpdate(r){r===!0&&this.version++}get type(){return this.constructor.type}onUpdate(r,e){return this.updateType=e,this.update=r.bind(this.getSelf()),this}onFrameUpdate(r){return this.onUpdate(r,un.FRAME)}onRenderUpdate(r){return this.onUpdate(r,un.RENDER)}onObjectUpdate(r){return this.onUpdate(r,un.OBJECT)}onReference(r){return this.updateReference=r.bind(this.getSelf()),this}getSelf(){return this.self||this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:r}of Y1(this))yield r}dispose(){this.dispatchEvent({type:"dispose"})}traverse(r){r(this);for(const e of this.getChildren())e.traverse(r)}getCacheKey(r=!1){return r=r||this.version!==this._cacheKeyVersion,(r===!0||this._cacheKey===null)&&(this._cacheKey=g6(this,r),this._cacheKeyVersion=this.version),this._cacheKey}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(r){const e=this.getNodeType(r);return r.getElementType(e)}getNodeType(r){const e=r.getNodeProperties(this);return e.outputNode?e.outputNode.getNodeType(r):this.nodeType}getShared(r){const e=this.getHash(r);return r.getNodeFromHash(e)||this}setup(r){const e=r.getNodeProperties(this);let i=0;for(const n of this.getChildren())e["node"+i++]=n;return null}analyze(r){if(r.increaseUsage(this)===1){const e=r.getNodeProperties(this);for(const i of Object.values(e))i&&i.isNode===!0&&i.build(r)}}generate(r,e){const{outputNode:i}=r.getNodeProperties(this);if(i&&i.isNode===!0)return i.build(r,e)}updateBefore(){console.warn("Abstract function.")}updateAfter(){console.warn("Abstract function.")}update(){console.warn("Abstract function.")}build(r,e=null){const i=this.getShared(r);if(this!==i)return i.build(r,e);r.addNode(this),r.addChain(this);let n=null;const s=r.getBuildStage();if(s==="setup"){this.updateReference(r);const o=r.getNodeProperties(this);if(o.initialized!==!0){r.stack.nodes.length,o.initialized=!0,o.outputNode=this.setup(r),o.outputNode!==null&&r.stack.nodes.length;for(const l of Object.values(o))l&&l.isNode===!0&&l.build(r)}}else if(s==="analyze")this.analyze(r);else if(s==="generate")if(this.generate.length===1){const o=this.getNodeType(r),l=r.getDataFromNode(this);n=l.snippet,n===void 0?(n=this.generate(r)||"",l.snippet=n):l.flowCodes!==void 0&&r.context.nodeBlock!==void 0&&r.addFlowCodeHierarchy(this,r.context.nodeBlock),n=r.format(n,o,e)}else n=this.generate(r,e)||"";return r.removeChain(this),r.addSequentialNode(this),n}getSerializeChildren(){return Y1(this)}serialize(r){const e=this.getSerializeChildren(),i={};for(const{property:n,index:s,childNode:o}of e)s!==void 0?(i[n]===void 0&&(i[n]=Number.isInteger(s)?[]:{}),i[n][s]=o.toJSON(r.meta).uuid):i[n]=o.toJSON(r.meta).uuid;Object.keys(i).length>0&&(r.inputNodes=i)}deserialize(r){if(r.inputNodes!==void 0){const e=r.meta.nodes;for(const i in r.inputNodes)if(Array.isArray(r.inputNodes[i])){const n=[];for(const s of r.inputNodes[i])n.push(e[s]);this[i]=n}else if(typeof r.inputNodes[i]=="object"){const n={};for(const s in r.inputNodes[i]){const o=r.inputNodes[i][s];n[s]=e[o]}this[i]=n}else{const n=r.inputNodes[i];this[i]=e[n]}}}toJSON(r){const{uuid:e,type:i}=this,n=r===void 0||typeof r=="string";n&&(r={textures:{},images:{},nodes:{}});let s=r.nodes[e];s===void 0&&(s={uuid:e,type:i,meta:r,metadata:{version:4.6,type:"Node",generator:"Node.toJSON"}},n!==!0&&(r.nodes[s.uuid]=s),this.serialize(s),delete s.meta);function o(l){const u=[];for(const c in l){const h=l[c];delete h.metadata,u.push(h)}return u}if(n){const l=o(r.textures),u=o(r.images),c=o(r.nodes);l.length>0&&(s.textures=l),u.length>0&&(s.images=u),c.length>0&&(s.nodes=c)}return s}};class fy extends tn{static get type(){return"ArrayElementNode"}constructor(e,i){super(),this.node=e,this.indexNode=i,this.isArrayElementNode=!0}getNodeType(e){return this.node.getElementType(e)}generate(e){const i=this.node.build(e),n=this.indexNode.build(e,"uint");return`${i}[ ${n} ]`}}class x6 extends tn{static get type(){return"ConvertNode"}constructor(e,i){super(),this.node=e,this.convertTo=i}getNodeType(e){const i=this.node.getNodeType(e);let n=null;for(const s of this.convertTo.split("|"))(n===null||e.getTypeLength(i)===e.getTypeLength(s))&&(n=s);return n}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,i){const n=this.node,s=this.getNodeType(e),o=n.build(e,s);return e.format(o,s,i)}}class ra extends tn{static get type(){return"TempNode"}constructor(e){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,i){if(e.getBuildStage()==="generate"){const n=e.getVectorType(this.getNodeType(e,i)),s=e.getDataFromNode(this);if(s.propertyName!==void 0)return e.format(s.propertyName,n,i);if(n!=="void"&&i!=="void"&&this.hasDependencies(e)){const o=super.build(e,n),l=e.getVarFromNode(this,null,n),u=e.getPropertyName(l);return e.addLineFlowCode(`${u} = ${o}`,this),s.snippet=o,s.propertyName=u,e.format(s.propertyName,n,i)}}return super.build(e,i)}}class Fhe extends ra{static get type(){return"JoinNode"}constructor(e=[],i=null){super(i),this.nodes=e}getNodeType(e){return this.nodeType!==null?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((i,n)=>i+e.getTypeLength(n.getNodeType(e)),0))}generate(e,i){const n=this.getNodeType(e),s=this.nodes,o=e.getComponentType(n),l=[];for(const c of s){let h=c.build(e);const p=e.getComponentType(c.getNodeType(e));p!==o&&(h=e.format(h,p,o)),l.push(h)}const u=`${e.getType(n)}( ${l.join(", ")} )`;return e.format(u,n,i)}}const Uhe=wg.join("");class _6 extends tn{static get type(){return"SplitNode"}constructor(e,i="x"){super(),this.node=e,this.components=i,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(const i of this.components)e=Math.max(wg.indexOf(i)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}generate(e,i){const n=this.node,s=e.getTypeLength(n.getNodeType(e));let o=null;if(s>1){let l=null;this.getVectorLength()>=s&&(l=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));const u=n.build(e,l);this.components.length===s&&this.components===Uhe.slice(0,this.components.length)?o=e.format(u,l,i):o=e.format(`${u}.${this.components}`,this.getNodeType(e),i)}else o=n.build(e,i);return o}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}class zhe extends ra{static get type(){return"SetNode"}constructor(e,i,n){super(),this.sourceNode=e,this.components=i,this.targetNode=n}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{sourceNode:i,components:n,targetNode:s}=this,o=this.getNodeType(e),l=e.getTypeFromLength(n.length,s.getNodeType(e)),u=s.build(e,l),c=i.build(e,o),h=e.getTypeLength(o),p=[];for(let f=0;f<h;f++){const g=wg[f];g===n[0]?(p.push(u),f+=n.length-1):p.push(c+"."+g)}return`${e.getType(o)}( ${p.join(", ")} )`}}class jhe extends ra{static get type(){return"FlipNode"}constructor(e,i){super(),this.sourceNode=e,this.components=i}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{components:i,sourceNode:n}=this,s=this.getNodeType(e),o=n.build(e),l=e.getVarFromNode(this),u=e.getPropertyName(l);e.addLineFlowCode(u+" = "+o,this);const c=e.getTypeLength(s),h=[];let p=0;for(let f=0;f<c;f++){const g=wg[f];g===i[p]?(h.push("1.0 - "+(u+"."+g)),p++):h.push(u+"."+g)}return`${e.getType(s)}( ${h.join(", ")} )`}}class D3 extends tn{static get type(){return"InputNode"}constructor(e,i=null){super(i),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return this.nodeType===null?K1(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=K1(this.value),e.nodeType=this.nodeType,e.valueType==="ArrayBuffer"&&(e.value=Nhe(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?A6(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){console.warn("Abstract function.")}}class eh extends D3{static get type(){return"ConstNode"}constructor(e,i=null){super(e,i),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,i){const n=this.getNodeType(e);return e.format(this.generateConst(e),n,i)}}let Cg=null;const Sg=new Map;function Jt(r,e){if(Sg.has(r)){console.warn(`Redefinition of method chaining ${r}`);return}if(typeof e!="function")throw new Error(`Node element ${r} is not a function`);Sg.set(r,e)}const E6=r=>r.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),w6=r=>E6(r).split("").sort().join(""),C6={setup(r,e){const i=e.shift();return r(e_(i),...e)},get(r,e,i){if(typeof e=="string"&&r[e]===void 0){if(r.isStackNode!==!0&&e==="assign")return(...n)=>(Cg.assign(i,...n),i);if(Sg.has(e)){const n=Sg.get(e);return r.isStackNode?(...s)=>i.add(n(...s)):(...s)=>n(i,...s)}else{if(e==="self")return r;if(e.endsWith("Assign")&&Sg.has(e.slice(0,e.length-6))){const n=Sg.get(e.slice(0,e.length-6));return r.isStackNode?(...s)=>i.assign(s[0],n(...s)):(...s)=>i.assign(n(i,...s))}else{if(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0)return e=E6(e),Ti(new _6(i,e));if(/^set[XYZWRGBASTPQ]{1,4}$/.test(e)===!0)return e=w6(e.slice(3).toLowerCase()),n=>Ti(new zhe(r,e,n));if(/^flip[XYZWRGBASTPQ]{1,4}$/.test(e)===!0)return e=w6(e.slice(4).toLowerCase()),()=>Ti(new jhe(Ti(r),e));if(e==="width"||e==="height"||e==="depth")return e==="width"?e="x":e==="height"?e="y":e==="depth"&&(e="z"),Ti(new _6(r,e));if(/^\d+$/.test(e)===!0)return Ti(new fy(i,new eh(Number(e),"uint")))}}}return Reflect.get(r,e,i)},set(r,e,i,n){return typeof e=="string"&&r[e]===void 0&&(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0||e==="width"||e==="height"||e==="depth"||/^\d+$/.test(e)===!0)?(n[e].assign(i),!0):Reflect.set(r,e,i,n)}},N3=new WeakMap,S6=new WeakMap,Vhe=function(r,e=null){const i=K1(r);if(i==="node"){let n=N3.get(r);return n===void 0&&(n=new Proxy(r,C6),N3.set(r,n),N3.set(n,n)),n}else{if(e===null&&(i==="float"||i==="boolean")||i&&i!=="shader"&&i!=="string")return Ti(F3(r,e));if(i==="shader")return Gi(r)}return r},Ghe=function(r,e=null){for(const i in r)r[i]=Ti(r[i],e);return r},Hhe=function(r,e=null){const i=r.length;for(let n=0;n<i;n++)r[n]=Ti(r[n],e);return r},Whe=function(r,e=null,i=null,n=null){const s=o=>Ti(n!==null?Object.assign(o,n):o);return e===null?(...o)=>s(new r(...Tg(o))):i!==null?(i=Ti(i),(...o)=>s(new r(e,...Tg(o),i))):(...o)=>s(new r(e,...Tg(o)))},Qhe=function(r,...e){return Ti(new r(...Tg(e)))};class qhe extends tn{constructor(e,i){super(),this.shaderNode=e,this.inputNodes=i}getNodeType(e){return this.shaderNode.nodeType||this.getOutputNode(e).getNodeType(e)}call(e){const{shaderNode:i,inputNodes:n}=this,s=e.getNodeProperties(i);if(s.onceOutput)return s.onceOutput;let o=null;if(i.layout){let l=S6.get(e.constructor);l===void 0&&(l=new WeakMap,S6.set(e.constructor,l));let u=l.get(i);u===void 0&&(u=Ti(e.buildFunctionNode(i)),l.set(i,u)),e.currentFunctionNode!==null&&e.currentFunctionNode.includes.push(u),o=Ti(u.call(n))}else{const l=i.jsFunc,u=n!==null?l(n,e):l(e);o=Ti(u)}return i.once&&(s.onceOutput=o),o}getOutputNode(e){const i=e.getNodeProperties(this);return i.outputNode===null&&(i.outputNode=this.setupOutput(e)),i.outputNode}setup(e){return this.getOutputNode(e)}setupOutput(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}generate(e,i){return this.getOutputNode(e).build(e,i)}}class Xhe extends tn{constructor(e,i){super(i),this.jsFunc=e,this.layout=null,this.global=!0,this.once=!1}setLayout(e){return this.layout=e,this}call(e=null){return e_(e),Ti(new qhe(this,e))}setup(){return this.call()}}const Yhe=[!1,!0],Khe=[0,1,2,3],Jhe=[-1,-2],T6=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],P3=new Map;for(const r of Yhe)P3.set(r,new eh(r));const O3=new Map;for(const r of Khe)O3.set(r,new eh(r,"uint"));const k3=new Map([...O3].map(r=>new eh(r.value,"int")));for(const r of Jhe)k3.set(r,new eh(r,"int"));const J1=new Map([...k3].map(r=>new eh(r.value)));for(const r of T6)J1.set(r,new eh(r));for(const r of T6)J1.set(-r,new eh(-r));const Z1={bool:P3,uint:O3,ints:k3,float:J1},M6=new Map([...P3,...J1]),F3=(r,e)=>M6.has(r)?M6.get(r):r.isNode===!0?r:new eh(r,e),Zhe=r=>{try{return r.getNodeType()}catch{return}},na=function(r,e=null){return(...i)=>{if((i.length===0||!["bool","float","int","uint"].includes(r)&&i.every(s=>typeof s!="object"))&&(i=[A6(r,...i)]),i.length===1&&e!==null&&e.has(i[0]))return Ti(e.get(i[0]));if(i.length===1){const s=F3(i[0],r);return Zhe(s)===r?Ti(s):Ti(new x6(s,r))}const n=i.map(s=>F3(s));return Ti(new Fhe(n,r))}},R6=r=>typeof r=="object"&&r!==null?r.value:r,$he=r=>r!=null?r.nodeType||r.convertTo||(typeof r=="string"?r:null):null;function $1(r,e){return new Proxy(new Xhe(r,e),C6)}const Ti=(r,e=null)=>Vhe(r,e),e_=(r,e=null)=>new Ghe(r,e),Tg=(r,e=null)=>new Hhe(r,e),ci=(...r)=>new Whe(...r),Yi=(...r)=>new Qhe(...r),Gi=(r,e)=>{const i=new $1(r,e),n=(...s)=>{let o;return e_(s),s[0]&&s[0].isNode?o=[...s]:o=s[0],i.call(o)};return n.shaderNode=i,n.setLayout=s=>(i.setLayout(s),n),n.once=()=>(i.once=!0,n),n};Jt("toGlobal",r=>(r.global=!0,r));const t_=r=>{Cg=r},I6=()=>Cg,za=(...r)=>Cg.If(...r);function ede(r){return Cg&&Cg.add(r),r}Jt("append",ede);const tde=new na("color"),ii=new na("float",Z1.float),Fs=new na("int",Z1.ints),ide=new na("uint",Z1.uint),rde=new na("bool",Z1.bool),Ki=new na("vec2"),th=new na("ivec2"),nde=new na("uvec2"),sde=new na("bvec2"),ei=new na("vec3"),ade=new na("ivec3"),ode=new na("uvec3"),lde=new na("bvec3"),Jr=new na("vec4"),cde=new na("ivec4"),ude=new na("uvec4"),hde=new na("bvec4"),U3=new na("mat2"),So=new na("mat3"),Mg=new na("mat4");Jt("toColor",tde),Jt("toFloat",ii),Jt("toInt",Fs),Jt("toUint",ide),Jt("toBool",rde),Jt("toVec2",Ki),Jt("toIVec2",th),Jt("toUVec2",nde),Jt("toBVec2",sde),Jt("toVec3",ei),Jt("toIVec3",ade),Jt("toUVec3",ode),Jt("toBVec3",lde),Jt("toVec4",Jr),Jt("toIVec4",cde),Jt("toUVec4",ude),Jt("toBVec4",hde),Jt("toMat2",U3),Jt("toMat3",So),Jt("toMat4",Mg);const dde=ci(fy),pde=(r,e)=>Ti(new x6(Ti(r),e));Jt("element",dde),Jt("convert",pde);class B6 extends tn{static get type(){return"UniformGroupNode"}constructor(e,i=!1,n=1){super("string"),this.name=e,this.version=0,this.shared=i,this.order=n,this.isUniformGroup=!0}set needsUpdate(e){e===!0&&this.version++}serialize(e){super.serialize(e),e.name=this.name,e.version=this.version,e.shared=this.shared}deserialize(e){super.deserialize(e),this.name=e.name,this.version=e.version,this.shared=e.shared}}const fde=r=>new B6(r),L6=(r,e=0)=>new B6(r,!0,e),mde=L6("frame"),Tn=L6("render"),D6=fde("object");class my extends D3{static get type(){return"UniformNode"}constructor(e,i=null){super(e,i),this.isUniformNode=!0,this.name="",this.groupNode=D6}label(e){return this.name=e,this}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}onUpdate(e,i){const n=this.getSelf();return e=e.bind(n),super.onUpdate(s=>{const o=e(s,n);o!==void 0&&(this.value=o)},i)}generate(e,i){const n=this.getNodeType(e),s=this.getUniformHash(e);let o=e.getNodeFromHash(s);o===void 0&&(e.setHashNode(this,s),o=this);const l=o.getInputType(e),u=e.getUniformFromNode(o,l,e.shaderStage,this.name||e.context.label),c=e.getPropertyName(u);return e.context.label!==void 0&&delete e.context.label,e.format(c,n,i)}}const Zr=(r,e)=>{const i=$he(e||r),n=r&&r.isNode===!0?r.node&&r.node.value||r.value:r;return Ti(new my(n,i))};class $n extends tn{static get type(){return"PropertyNode"}constructor(e,i=null,n=!1){super(e),this.name=i,this.varying=n,this.isPropertyNode=!0}getHash(e){return this.name||super.getHash(e)}isGlobal(){return!0}generate(e){let i;return this.varying===!0?(i=e.getVaryingFromNode(this,this.name),i.needsInterpolation=!0):i=e.getVarFromNode(this,this.name),e.getPropertyName(i)}}const Rg=(r,e)=>Ti(new $n(r,e)),i_=(r,e)=>Ti(new $n(r,e,!0)),Qn=Yi($n,"vec4","DiffuseColor"),N6=Yi($n,"vec3","EmissiveColor"),ih=Yi($n,"float","Roughness"),r_=Yi($n,"float","Metalness"),z3=Yi($n,"float","Clearcoat"),n_=Yi($n,"float","ClearcoatRoughness"),Ig=Yi($n,"vec3","Sheen"),j3=Yi($n,"float","SheenRoughness"),V3=Yi($n,"float","Iridescence"),P6=Yi($n,"float","IridescenceIOR"),O6=Yi($n,"float","IridescenceThickness"),G3=Yi($n,"float","AlphaT"),Hp=Yi($n,"float","Anisotropy"),s_=Yi($n,"vec3","AnisotropyT"),Bg=Yi($n,"vec3","AnisotropyB"),Al=Yi($n,"color","SpecularColor"),a_=Yi($n,"float","SpecularF90"),H3=Yi($n,"float","Shininess"),gde=Yi($n,"vec4","Output"),W3=Yi($n,"float","dashSize"),k6=Yi($n,"float","gapSize"),o_=Yi($n,"float","IOR"),Q3=Yi($n,"float","Transmission"),F6=Yi($n,"float","Thickness"),U6=Yi($n,"float","AttenuationDistance"),z6=Yi($n,"color","AttenuationColor"),j6=Yi($n,"float","Dispersion");class Ade extends ra{static get type(){return"AssignNode"}constructor(e,i){super(),this.targetNode=e,this.sourceNode=i}hasDependencies(){return!1}getNodeType(e,i){return i!=="void"?this.targetNode.getNodeType(e):"void"}needsSplitAssign(e){const{targetNode:i}=this;if(e.isAvailable("swizzleAssign")===!1&&i.isSplitNode&&i.components.length>1){const n=e.getTypeLength(i.node.getNodeType(e));return wg.join("").slice(0,n)!==i.components}return!1}generate(e,i){const{targetNode:n,sourceNode:s}=this,o=this.needsSplitAssign(e),l=n.getNodeType(e),u=n.context({assign:!0}).build(e),c=s.build(e,l),h=s.getNodeType(e),p=e.getDataFromNode(this);let f;if(p.initialized===!0)i!=="void"&&(f=u);else if(o){const g=e.getVarFromNode(this,null,l),m=e.getPropertyName(g);e.addLineFlowCode(`${m} = ${c}`,this);const y=n.node.context({assign:!0}).build(e);for(let b=0;b<n.components.length;b++){const v=n.components[b];e.addLineFlowCode(`${y}.${v} = ${m}[ ${b} ]`,this)}i!=="void"&&(f=u)}else f=`${u} = ${c}`,(i==="void"||h==="void")&&(e.addLineFlowCode(f,this),i!=="void"&&(f=u));return p.initialized=!0,e.format(f,l,i)}}Jt("assign",ci(Ade));class yde extends ra{static get type(){return"FunctionCallNode"}constructor(e=null,i={}){super(),this.functionNode=e,this.parameters=i}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}generate(e){const i=[],n=this.functionNode,s=n.getInputs(e),o=this.parameters,l=(u,c)=>{const h=c.type,p=h==="pointer";let f;return p?f="&"+u.build(e):f=u.build(e,h),f};if(Array.isArray(o))for(let u=0;u<o.length;u++)i.push(l(o[u],s[u]));else for(const u of s){const c=o[u.name];if(c!==void 0)i.push(l(c,u));else throw new Error(`FunctionCallNode: Input '${u.name}' not found in FunctionNode.`)}return`${n.build(e,"property")}( ${i.join(", ")} )`}}Jt("call",(r,...e)=>(e=e.length>1||e[0]&&e[0].isNode===!0?Tg(e):e_(e[0]),Ti(new yde(Ti(r),e))));class Cs extends ra{static get type(){return"OperatorNode"}constructor(e,i,n,...s){if(super(),s.length>0){let o=new Cs(e,i,n);for(let l=0;l<s.length-1;l++)o=new Cs(e,o,s[l]);i=o,n=s[s.length-1]}this.op=e,this.aNode=i,this.bNode=n}getNodeType(e,i){const n=this.op,s=this.aNode,o=this.bNode,l=s.getNodeType(e),u=typeof o<"u"?o.getNodeType(e):null;if(l==="void"||u==="void")return"void";if(n==="%")return l;if(n==="~"||n==="&"||n==="|"||n==="^"||n===">>"||n==="<<")return e.getIntegerType(l);if(n==="!"||n==="=="||n==="&&"||n==="||"||n==="^^")return"bool";if(n==="<"||n===">"||n==="<="||n===">="){const c=i?e.getTypeLength(i):Math.max(e.getTypeLength(l),e.getTypeLength(u));return c>1?`bvec${c}`:"bool"}else return l==="float"&&e.isMatrix(u)?u:e.isMatrix(l)&&e.isVector(u)?e.getVectorFromMatrix(l):e.isVector(l)&&e.isMatrix(u)?e.getVectorFromMatrix(u):e.getTypeLength(u)>e.getTypeLength(l)?u:l}generate(e,i){const n=this.op,s=this.aNode,o=this.bNode,l=this.getNodeType(e,i);let u=null,c=null;l!=="void"?(u=s.getNodeType(e),c=typeof o<"u"?o.getNodeType(e):null,n==="<"||n===">"||n==="<="||n===">="||n==="=="?e.isVector(u)?c=u:u!==c&&(u=c="float"):n===">>"||n==="<<"?(u=l,c=e.changeComponentType(c,"uint")):e.isMatrix(u)&&e.isVector(c)?c=e.getVectorFromMatrix(u):e.isVector(u)&&e.isMatrix(c)?u=e.getVectorFromMatrix(c):u=c=l):u=c=l;const h=s.build(e,u),p=typeof o<"u"?o.build(e,c):null,f=e.getTypeLength(i),g=e.getFunctionOperator(n);if(i!=="void")return n==="<"&&f>1?e.useComparisonMethod?e.format(`${e.getMethod("lessThan",i)}( ${h}, ${p} )`,l,i):e.format(`( ${h} < ${p} )`,l,i):n==="<="&&f>1?e.useComparisonMethod?e.format(`${e.getMethod("lessThanEqual",i)}( ${h}, ${p} )`,l,i):e.format(`( ${h} <= ${p} )`,l,i):n===">"&&f>1?e.useComparisonMethod?e.format(`${e.getMethod("greaterThan",i)}( ${h}, ${p} )`,l,i):e.format(`( ${h} > ${p} )`,l,i):n===">="&&f>1?e.useComparisonMethod?e.format(`${e.getMethod("greaterThanEqual",i)}( ${h}, ${p} )`,l,i):e.format(`( ${h} >= ${p} )`,l,i):n==="!"||n==="~"?e.format(`(${n}${h})`,u,i):g?e.format(`${g}( ${h}, ${p} )`,l,i):e.format(`( ${h} ${n} ${p} )`,l,i);if(u!=="void")return g?e.format(`${g}( ${h}, ${p} )`,l,i):e.format(`${h} ${n} ${p}`,l,i)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}const To=ci(Cs,"+"),yl=ci(Cs,"-"),vn=ci(Cs,"*"),yd=ci(Cs,"/"),V6=ci(Cs,"%"),vde=ci(Cs,"=="),bde=ci(Cs,"!="),xde=ci(Cs,"<"),_de=ci(Cs,">"),Ede=ci(Cs,"<="),wde=ci(Cs,">="),Cde=ci(Cs,"&&"),Sde=ci(Cs,"||"),Tde=ci(Cs,"!"),Mde=ci(Cs,"^^"),Rde=ci(Cs,"&"),Ide=ci(Cs,"~"),Bde=ci(Cs,"|"),Lde=ci(Cs,"^"),Dde=ci(Cs,"<<"),Nde=ci(Cs,">>");Jt("add",To),Jt("sub",yl),Jt("mul",vn),Jt("div",yd),Jt("modInt",V6),Jt("equal",vde),Jt("notEqual",bde),Jt("lessThan",xde),Jt("greaterThan",_de),Jt("lessThanEqual",Ede),Jt("greaterThanEqual",wde),Jt("and",Cde),Jt("or",Sde),Jt("not",Tde),Jt("xor",Mde),Jt("bitAnd",Rde),Jt("bitNot",Ide),Jt("bitOr",Bde),Jt("bitXor",Lde),Jt("shiftLeft",Dde),Jt("shiftRight",Nde),Jt("remainder",(...r)=>(console.warn("TSL.OperatorNode: .remainder() has been renamed to .modInt()."),V6(...r)));class _t extends ra{static get type(){return"MathNode"}constructor(e,i,n=null,s=null){super(),this.method=e,this.aNode=i,this.bNode=n,this.cNode=s}getInputType(e){const i=this.aNode.getNodeType(e),n=this.bNode?this.bNode.getNodeType(e):null,s=this.cNode?this.cNode.getNodeType(e):null,o=e.isMatrix(i)?0:e.getTypeLength(i),l=e.isMatrix(n)?0:e.getTypeLength(n),u=e.isMatrix(s)?0:e.getTypeLength(s);return o>l&&o>u?i:l>u?n:u>o?s:i}getNodeType(e){const i=this.method;return i===_t.LENGTH||i===_t.DISTANCE||i===_t.DOT?"float":i===_t.CROSS?"vec3":i===_t.ALL?"bool":i===_t.EQUALS?e.changeComponentType(this.aNode.getNodeType(e),"bool"):i===_t.MOD?this.aNode.getNodeType(e):this.getInputType(e)}generate(e,i){const n=this.method,s=this.getNodeType(e),o=this.getInputType(e),l=this.aNode,u=this.bNode,c=this.cNode,h=e.renderer.isWebGLRenderer===!0;if(n===_t.TRANSFORM_DIRECTION){let p=l,f=u;e.isMatrix(p.getNodeType(e))?f=Jr(ei(f),0):p=Jr(ei(p),0);const g=vn(p,f).xyz;return Ay(g).build(e,i)}else{if(n===_t.NEGATE)return e.format("( - "+l.build(e,o)+" )",s,i);if(n===_t.ONE_MINUS)return yl(1,l).build(e,i);if(n===_t.RECIPROCAL)return yd(1,l).build(e,i);if(n===_t.DIFFERENCE)return Ec(yl(l,u)).build(e,i);{const p=[];return n===_t.CROSS||n===_t.MOD?p.push(l.build(e,s),u.build(e,s)):h&&n===_t.STEP?p.push(l.build(e,e.getTypeLength(l.getNodeType(e))===1?"float":o),u.build(e,o)):h&&(n===_t.MIN||n===_t.MAX)||n===_t.MOD?p.push(l.build(e,o),u.build(e,e.getTypeLength(u.getNodeType(e))===1?"float":o)):n===_t.REFRACT?p.push(l.build(e,o),u.build(e,o),c.build(e,"float")):n===_t.MIX?p.push(l.build(e,o),u.build(e,o),c.build(e,e.getTypeLength(c.getNodeType(e))===1?"float":o)):(p.push(l.build(e,o)),u!==null&&p.push(u.build(e,o)),c!==null&&p.push(c.build(e,o))),e.format(`${e.getMethod(n,s)}( ${p.join(", ")} )`,s,i)}}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}_t.ALL="all",_t.ANY="any",_t.EQUALS="equals",_t.RADIANS="radians",_t.DEGREES="degrees",_t.EXP="exp",_t.EXP2="exp2",_t.LOG="log",_t.LOG2="log2",_t.SQRT="sqrt",_t.INVERSE_SQRT="inversesqrt",_t.FLOOR="floor",_t.CEIL="ceil",_t.NORMALIZE="normalize",_t.FRACT="fract",_t.SIN="sin",_t.COS="cos",_t.TAN="tan",_t.ASIN="asin",_t.ACOS="acos",_t.ATAN="atan",_t.ABS="abs",_t.SIGN="sign",_t.LENGTH="length",_t.NEGATE="negate",_t.ONE_MINUS="oneMinus",_t.DFDX="dFdx",_t.DFDY="dFdy",_t.ROUND="round",_t.RECIPROCAL="reciprocal",_t.TRUNC="trunc",_t.FWIDTH="fwidth",_t.BITCAST="bitcast",_t.TRANSPOSE="transpose",_t.ATAN2="atan2",_t.MIN="min",_t.MAX="max",_t.MOD="mod",_t.STEP="step",_t.REFLECT="reflect",_t.DISTANCE="distance",_t.DIFFERENCE="difference",_t.DOT="dot",_t.CROSS="cross",_t.POW="pow",_t.TRANSFORM_DIRECTION="transformDirection",_t.MIX="mix",_t.CLAMP="clamp",_t.REFRACT="refract",_t.SMOOTHSTEP="smoothstep",_t.FACEFORWARD="faceforward";const Pde=ii(1e-6),Ode=ii(Math.PI),G6=ci(_t,_t.ALL),kde=ci(_t,_t.ANY),Fde=ci(_t,_t.EQUALS),Ude=ci(_t,_t.RADIANS),zde=ci(_t,_t.DEGREES),H6=ci(_t,_t.EXP),gy=ci(_t,_t.EXP2),W6=ci(_t,_t.LOG),rh=ci(_t,_t.LOG2),q3=ci(_t,_t.SQRT),jde=ci(_t,_t.INVERSE_SQRT),Wp=ci(_t,_t.FLOOR),X3=ci(_t,_t.CEIL),Ay=ci(_t,_t.NORMALIZE),vd=ci(_t,_t.FRACT),_c=ci(_t,_t.SIN),bd=ci(_t,_t.COS),Vde=ci(_t,_t.TAN),Gde=ci(_t,_t.ASIN),Hde=ci(_t,_t.ACOS),Wde=ci(_t,_t.ATAN),Ec=ci(_t,_t.ABS),Q6=ci(_t,_t.SIGN),xd=ci(_t,_t.LENGTH),Qde=ci(_t,_t.NEGATE),qde=ci(_t,_t.ONE_MINUS),q6=ci(_t,_t.DFDX),X6=ci(_t,_t.DFDY),Xde=ci(_t,_t.ROUND),Yde=ci(_t,_t.RECIPROCAL),Kde=ci(_t,_t.TRUNC),Jde=ci(_t,_t.FWIDTH);_t.BITCAST;const Zde=ci(_t,_t.TRANSPOSE),$de=ci(_t,_t.ATAN2),yy=ci(_t,_t.MIN),Fl=ci(_t,_t.MAX),Y6=ci(_t,_t.MOD),K6=ci(_t,_t.STEP),epe=ci(_t,_t.REFLECT),tpe=ci(_t,_t.DISTANCE),ipe=ci(_t,_t.DIFFERENCE),Y3=ci(_t,_t.DOT),J6=ci(_t,_t.CROSS),l_=ci(_t,_t.POW),Z6=ci(_t,_t.POW,2),rpe=ci(_t,_t.POW,3),npe=ci(_t,_t.POW,4),spe=ci(_t,_t.TRANSFORM_DIRECTION),ape=r=>vn(Q6(r),l_(Ec(r),1/3)),ope=r=>Y3(r,r),As=ci(_t,_t.MIX),nh=(r,e=0,i=1)=>Ti(new _t(_t.CLAMP,Ti(r),Ti(e),Ti(i))),lpe=r=>nh(r),$6=ci(_t,_t.REFRACT),Qp=ci(_t,_t.SMOOTHSTEP),cpe=ci(_t,_t.FACEFORWARD),upe=Gi(([r])=>{const e=43758.5453,i=Y3(r.xy,Ki(12.9898,78.233)),n=Y6(i,Ode);return vd(_c(n).mul(e))}),hpe=(r,e,i)=>As(e,i,r),dpe=(r,e,i)=>Qp(e,i,r);Jt("all",G6),Jt("any",kde),Jt("equals",Fde),Jt("radians",Ude),Jt("degrees",zde),Jt("exp",H6),Jt("exp2",gy),Jt("log",W6),Jt("log2",rh),Jt("sqrt",q3),Jt("inverseSqrt",jde),Jt("floor",Wp),Jt("ceil",X3),Jt("normalize",Ay),Jt("fract",vd),Jt("sin",_c),Jt("cos",bd),Jt("tan",Vde),Jt("asin",Gde),Jt("acos",Hde),Jt("atan",Wde),Jt("abs",Ec),Jt("sign",Q6),Jt("length",xd),Jt("lengthSq",ope),Jt("negate",Qde),Jt("oneMinus",qde),Jt("dFdx",q6),Jt("dFdy",X6),Jt("round",Xde),Jt("reciprocal",Yde),Jt("trunc",Kde),Jt("fwidth",Jde),Jt("atan2",$de),Jt("min",yy),Jt("max",Fl),Jt("mod",Y6),Jt("step",K6),Jt("reflect",epe),Jt("distance",tpe),Jt("dot",Y3),Jt("cross",J6),Jt("pow",l_),Jt("pow2",Z6),Jt("pow3",rpe),Jt("pow4",npe),Jt("transformDirection",spe),Jt("mix",hpe),Jt("clamp",nh),Jt("refract",$6),Jt("smoothstep",dpe),Jt("faceForward",cpe),Jt("difference",ipe),Jt("saturate",lpe),Jt("cbrt",ape),Jt("transpose",Zde),Jt("rand",upe);class ppe extends tn{static get type(){return"ConditionalNode"}constructor(e,i,n=null){super(),this.condNode=e,this.ifNode=i,this.elseNode=n}getNodeType(e){const i=this.ifNode.getNodeType(e);if(this.elseNode!==null){const n=this.elseNode.getNodeType(e);if(e.getTypeLength(n)>e.getTypeLength(i))return n}return i}setup(e){const i=this.condNode.cache(),n=this.ifNode.cache(),s=this.elseNode?this.elseNode.cache():null,o=e.context.nodeBlock;e.getDataFromNode(n).parentNodeBlock=o,s!==null&&(e.getDataFromNode(s).parentNodeBlock=o);const l=e.getNodeProperties(this);l.condNode=i,l.ifNode=n.context({nodeBlock:n}),l.elseNode=s?s.context({nodeBlock:s}):null}generate(e,i){const n=this.getNodeType(e),s=e.getDataFromNode(this);if(s.nodeProperty!==void 0)return s.nodeProperty;const{condNode:o,ifNode:l,elseNode:u}=e.getNodeProperties(this),c=i!=="void",h=c?Rg(n).build(e):"";s.nodeProperty=h;const p=o.build(e,"bool");e.addFlowCode(`
${e.tab}if ( ${p} ) {

`).addFlowTab();let f=l.build(e,n);if(f&&(c?f=h+" = "+f+";":f="return "+f+";"),e.removeFlowTab().addFlowCode(e.tab+"	"+f+`

`+e.tab+"}"),u!==null){e.addFlowCode(` else {

`).addFlowTab();let g=u.build(e,n);g&&(c?g=h+" = "+g+";":g="return "+g+";"),e.removeFlowTab().addFlowCode(e.tab+"	"+g+`

`+e.tab+`}

`)}else e.addFlowCode(`

`);return e.format(h,n,i)}}const Wo=ci(ppe);Jt("select",Wo),Jt("cond",(...r)=>(console.warn("TSL.ConditionalNode: cond() has been renamed to select()."),Wo(...r)));class e8 extends tn{static get type(){return"ContextNode"}constructor(e,i={}){super(),this.isContextNode=!0,this.node=e,this.value=i}getScope(){return this.node.getScope()}getNodeType(e){return this.node.getNodeType(e)}analyze(e){this.node.build(e)}setup(e){const i=e.getContext();e.setContext({...e.context,...this.value});const n=this.node.build(e);return e.setContext(i),n}generate(e,i){const n=e.getContext();e.setContext({...e.context,...this.value});const s=this.node.build(e,i);return e.setContext(n),s}}const K3=ci(e8),fpe=(r,e)=>K3(r,{label:e});Jt("context",K3),Jt("label",fpe);class mpe extends tn{static get type(){return"VarNode"}constructor(e,i=null){super(),this.node=e,this.name=i,this.global=!0,this.isVarNode=!0}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}generate(e){const{node:i,name:n}=this,s=e.getVarFromNode(this,n,e.getVectorType(this.getNodeType(e))),o=e.getPropertyName(s),l=i.build(e,s.type);return e.addLineFlowCode(`${o} = ${l}`,this),o}}const t8=ci(mpe);Jt("toVar",(...r)=>t8(...r).append()),Jt("temp",r=>(console.warn('TSL: "temp" is deprecated. Use ".toVar()" instead.'),t8(r)));class gpe extends tn{static get type(){return"VaryingNode"}constructor(e,i=null){super(),this.node=e,this.name=i,this.isVaryingNode=!0}isGlobal(){return!0}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}setupVarying(e){const i=e.getNodeProperties(this);let n=i.varying;if(n===void 0){const s=this.name,o=this.getNodeType(e);i.varying=n=e.getVaryingFromNode(this,s,o),i.node=this.node}return n.needsInterpolation||(n.needsInterpolation=e.shaderStage==="fragment"),n}setup(e){this.setupVarying(e)}analyze(e){return this.setupVarying(e),this.node.analyze(e)}generate(e){const i=e.getNodeProperties(this),n=this.setupVarying(e);if(i.propertyName===void 0){const s=this.getNodeType(e),o=e.getPropertyName(n,y6.VERTEX);e.flowNodeFromShaderStage(y6.VERTEX,this.node,s,o),i.propertyName=o}return e.getPropertyName(n)}}const sh=ci(gpe);Jt("varying",sh);const Ape=Gi(([r])=>{const e=r.mul(.9478672986).add(.0521327014).pow(2.4),i=r.mul(.0773993808),n=r.lessThanEqual(.04045);return As(e,i,n)}).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),ype=Gi(([r])=>{const e=r.pow(.41666).mul(1.055).sub(.055),i=r.mul(12.92),n=r.lessThanEqual(.0031308);return As(e,i,n)}).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),vy="WorkingColorSpace",J3="OutputColorSpace";class c_ extends ra{static get type(){return"ColorSpaceNode"}constructor(e,i,n){super("vec4"),this.colorNode=e,this.source=i,this.target=n}resolveColorSpace(e,i){return i===vy?ta.workingColorSpace:i===J3?e.context.outputColorSpace||e.renderer.outputColorSpace:i}setup(e){const{colorNode:i}=this,n=this.resolveColorSpace(e,this.source),s=this.resolveColorSpace(e,this.target);let o=i;return ta.enabled===!1||n===s||!n||!s||(ta.getTransfer(n)===ty&&(o=Jr(Ape(o.rgb),o.a)),ta.getPrimaries(n)!==ta.getPrimaries(s)&&(o=Jr(So(ta._getMatrix(new Go,n,s)).mul(o.rgb),o.a)),ta.getTransfer(s)===ty&&(o=Jr(ype(o.rgb),o.a))),o}}const vpe=r=>Ti(new c_(Ti(r),vy,J3)),bpe=r=>Ti(new c_(Ti(r),J3,vy)),xpe=(r,e)=>Ti(new c_(Ti(r),vy,e)),i8=(r,e)=>Ti(new c_(Ti(r),e,vy));Jt("toOutputColorSpace",vpe),Jt("toWorkingColorSpace",bpe),Jt("workingToColorSpace",xpe),Jt("colorSpaceToWorking",i8);let _pe=class extends fy{static get type(){return"ReferenceElementNode"}constructor(r,e){super(r,e),this.referenceNode=r,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(r){const e=super.generate(r),i=this.referenceNode.getNodeType(),n=this.getNodeType();return r.format(e,i,n)}};class r8 extends tn{static get type(){return"ReferenceBaseNode"}constructor(e,i,n=null,s=null){super(),this.property=e,this.uniformType=i,this.object=n,this.count=s,this.properties=e.split("."),this.reference=n,this.node=null,this.group=null,this.updateType=un.OBJECT}setGroup(e){return this.group=e,this}element(e){return Ti(new _pe(this,Ti(e)))}setNodeType(e){const i=Zr(null,e).getSelf();this.group!==null&&i.setGroup(this.group),this.node=i}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:i}=this;let n=e[i[0]];for(let s=1;s<i.length;s++)n=n[i[s]];return n}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const Epe=(r,e,i)=>Ti(new r8(r,e,i));class wpe extends r8{static get type(){return"RendererReferenceNode"}constructor(e,i,n=null){super(e,i,n),this.renderer=n,this.setGroup(Tn)}updateReference(e){return this.reference=this.renderer!==null?this.renderer:e.renderer,this.reference}}const Cpe=(r,e,i)=>Ti(new wpe(r,e,i));class Spe extends ra{static get type(){return"ToneMappingNode"}constructor(e,i=Mpe,n=null){super("vec3"),this.toneMapping=e,this.exposureNode=i,this.colorNode=n}getCacheKey(){return X1(super.getCacheKey(),this.toneMapping)}setup(e){const i=this.colorNode||e.context.color,n=this.toneMapping;if(n===eg)return i;let s=null;const o=e.renderer.library.getToneMappingFunction(n);return o!==null?s=Jr(o(i.rgb,this.exposureNode),i.a):(console.error("ToneMappingNode: Unsupported Tone Mapping configuration.",n),s=i),s}}const Tpe=(r,e,i)=>Ti(new Spe(r,Ti(e),Ti(i))),Mpe=Cpe("toneMappingExposure","float");Jt("toneMapping",(r,e,i)=>Tpe(e,i,r));class Rpe extends D3{static get type(){return"BufferAttributeNode"}constructor(e,i=null,n=0,s=0){super(e,i),this.isBufferNode=!0,this.bufferType=i,this.bufferStride=n,this.bufferOffset=s,this.usage=M1,this.instanced=!1,this.attribute=null,this.global=!0,e&&e.isBufferAttribute===!0&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getHash(e){if(this.bufferStride===0&&this.bufferOffset===0){let i=e.globalCache.getData(this.value);return i===void 0&&(i={node:this},e.globalCache.setData(this.value,i)),i.node.uuid}return this.uuid}getNodeType(e){return this.bufferType===null&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(this.attribute!==null)return;const i=this.getNodeType(e),n=this.value,s=e.getTypeLength(i),o=this.bufferStride||s,l=this.bufferOffset,u=n.isInterleavedBuffer===!0?n:new $U(n,o),c=new w3(u,s,l);u.setUsage(this.usage),this.attribute=c,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){const i=this.getNodeType(e),n=e.getBufferAttributeFromNode(this,i),s=e.getPropertyName(n);let o=null;return e.shaderStage==="vertex"||e.shaderStage==="compute"?(this.name=s,o=s):o=sh(this).build(e,i),o}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this.attribute&&this.attribute.isBufferAttribute===!0&&(this.attribute.usage=e),this}setInstanced(e){return this.instanced=e,this}}const Z3=(r,e,i,n)=>Ti(new Rpe(r,e,i,n)),Ipe=(r,e,i,n)=>Z3(r,e,i,n).setUsage(og),n8=(r,e,i,n)=>Z3(r,e,i,n).setInstanced(!0),s8=(r,e,i,n)=>Ipe(r,e,i,n).setInstanced(!0);Jt("toAttribute",r=>Z3(r.value));class Bpe extends tn{static get type(){return"ComputeNode"}constructor(e,i,n=[64]){super("void"),this.isComputeNode=!0,this.computeNode=e,this.count=i,this.workgroupSize=n,this.dispatchCount=0,this.version=1,this.updateBeforeType=un.OBJECT,this.onInitFunction=null,this.updateDispatchCount()}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}updateDispatchCount(){const{count:e,workgroupSize:i}=this;let n=i[0];for(let s=1;s<i.length;s++)n*=i[s];this.dispatchCount=Math.ceil(e/n)}onInit(e){return this.onInitFunction=e,this}updateBefore({renderer:e}){e.compute(this)}generate(e){const{shaderStage:i}=e;if(i==="compute"){const n=this.computeNode.build(e,"void");n!==""&&e.addLineFlowCode(n,this)}}}Jt("compute",(r,e,i)=>Ti(new Bpe(Ti(r),e,i)));class Lpe extends tn{static get type(){return"CacheNode"}constructor(e,i=!0){super(),this.node=e,this.parent=i,this.isCacheNode=!0}getNodeType(e){return this.node.getNodeType(e)}build(e,...i){const n=e.getCache(),s=e.getCacheFromNode(this,this.parent);e.setCache(s);const o=this.node.build(e,...i);return e.setCache(n),o}}const u_=(r,...e)=>Ti(new Lpe(Ti(r),...e));Jt("cache",u_);class Dpe extends tn{static get type(){return"BypassNode"}constructor(e,i){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=i}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){const i=this.callNode.build(e,"void");return i!==""&&e.addLineFlowCode(i,this),this.outputNode.build(e)}}Jt("bypass",ci(Dpe));class a8 extends tn{static get type(){return"RemapNode"}constructor(e,i,n,s=ii(0),o=ii(1)){super(),this.node=e,this.inLowNode=i,this.inHighNode=n,this.outLowNode=s,this.outHighNode=o,this.doClamp=!0}setup(){const{node:e,inLowNode:i,inHighNode:n,outLowNode:s,outHighNode:o,doClamp:l}=this;let u=e.sub(i).div(n.sub(i));return l===!0&&(u=u.clamp()),u.mul(o.sub(s)).add(s)}}const Npe=ci(a8,null,null,{doClamp:!1}),Ppe=ci(a8);Jt("remap",Npe),Jt("remapClamp",Ppe);class Ope extends tn{static get type(){return"ExpressionNode"}constructor(e="",i="void"){super(i),this.snippet=e}generate(e,i){const n=this.getNodeType(e),s=this.snippet;if(n==="void")e.addLineFlowCode(s,this);else return e.format(`( ${s} )`,n,i)}}const by=ci(Ope);Jt("discard",r=>(r?Wo(r,by("discard")):by("discard")).append());class kpe extends ra{static get type(){return"RenderOutputNode"}constructor(e,i,n){super("vec4"),this.colorNode=e,this.toneMapping=i,this.outputColorSpace=n,this.isRenderOutput=!0}setup({context:e}){let i=this.colorNode||e.color;const n=(this.toneMapping!==null?this.toneMapping:e.toneMapping)||eg,s=(this.outputColorSpace!==null?this.outputColorSpace:e.outputColorSpace)||Np;return n!==eg&&(i=i.toneMapping(n)),s!==Np&&s!==ta.workingColorSpace&&(i=i.workingToColorSpace(s)),i}}Jt("renderOutput",(r,e=null,i=null)=>Ti(new kpe(Ti(r),e,i)));class Fpe extends tn{static get type(){return"AttributeNode"}constructor(e,i=null){super(i),this.global=!0,this._attributeName=e}getHash(e){return this.getAttributeName(e)}getNodeType(e){let i=this.nodeType;if(i===null){const n=this.getAttributeName(e);if(e.hasGeometryAttribute(n)){const s=e.geometry.getAttribute(n);i=e.getTypeFromAttribute(s)}else i="float"}return i}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){const i=this.getAttributeName(e),n=this.getNodeType(e);if(e.hasGeometryAttribute(i)===!0){const s=e.geometry.getAttribute(i),o=e.getTypeFromAttribute(s),l=e.getAttribute(i,o);return e.shaderStage==="vertex"?e.format(l.name,o,n):sh(this).build(e,n)}else return console.warn(`AttributeNode: Vertex attribute "${i}" not found on geometry.`),e.generateConst(n)}serialize(e){super.serialize(e),e.global=this.global,e._attributeName=this._attributeName}deserialize(e){super.deserialize(e),this.global=e.global,this._attributeName=e._attributeName}}const ah=(r,e)=>Ti(new Fpe(r,e)),h_=r=>ah("uv"+(r>0?r:""),"vec2");class Upe extends tn{static get type(){return"TextureSizeNode"}constructor(e,i=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=i}generate(e,i){const n=this.textureNode.build(e,"property"),s=this.levelNode===null?"0":this.levelNode.build(e,"int");return e.format(`${e.getMethod("textureDimensions")}( ${n}, ${s} )`,this.getNodeType(e),i)}}const xy=ci(Upe);class zpe extends my{static get type(){return"MaxMipLevelNode"}constructor(e){super(0),this._textureNode=e,this.updateType=un.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){const e=this.texture,i=e.images,n=i&&i.length>0?i[0]&&i[0].image||i[0]:e.image;if(n&&n.width!==void 0){const{width:s,height:o}=n;this.value=Math.log2(Math.max(s,o))}}}const jpe=ci(zpe);class _y extends my{static get type(){return"TextureNode"}constructor(e,i=null,n=null,s=null){super(e),this.isTextureNode=!0,this.uvNode=i,this.levelNode=n,this.biasNode=s,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=un.NONE,this.referenceNode=null,this._value=e,this._matrixUniform=null,this.setUpdateMatrix(i===null)}set value(e){this.referenceNode?this.referenceNode.value=e:this._value=e}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":this.value.type===Fa?"uvec4":this.value.type===_o?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return h_(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){return this._matrixUniform===null&&(this._matrixUniform=Zr(this.value.matrix)),this._matrixUniform.mul(ei(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this.updateType=e?un.FRAME:un.NONE,this}setupUV(e,i){const n=this.value;return e.isFlipY()&&(n.isRenderTargetTexture===!0||n.isFramebufferTexture===!0||n.isDepthTexture===!0)&&(this.sampler?i=i.flipY():i=i.setY(Fs(xy(this,this.levelNode).y).sub(i.y).sub(1))),i}setup(e){const i=e.getNodeProperties(this);i.referenceNode=this.referenceNode;let n=this.uvNode;(n===null||e.context.forceUVContext===!0)&&e.context.getUV&&(n=e.context.getUV(this)),n||(n=this.getDefaultUV()),this.updateMatrix===!0&&(n=this.getTransformedUV(n)),n=this.setupUV(e,n);let s=this.levelNode;s===null&&e.context.getTextureLevel&&(s=e.context.getTextureLevel(this)),i.uvNode=n,i.levelNode=s,i.biasNode=this.biasNode,i.compareNode=this.compareNode,i.gradNode=this.gradNode,i.depthNode=this.depthNode}generateUV(e,i){return i.build(e,this.sampler===!0?"vec2":"ivec2")}generateSnippet(e,i,n,s,o,l,u,c){const h=this.value;let p;return s?p=e.generateTextureLevel(h,i,n,s,l):o?p=e.generateTextureBias(h,i,n,o,l):c?p=e.generateTextureGrad(h,i,n,c,l):u?p=e.generateTextureCompare(h,i,n,u,l):this.sampler===!1?p=e.generateTextureLoad(h,i,n,l):p=e.generateTexture(h,i,n,l),p}generate(e,i){const n=e.getNodeProperties(this),s=this.value;if(!s||s.isTexture!==!0)throw new Error("TextureNode: Need a three.js texture.");const o=super.generate(e,"property");if(i==="sampler")return o+"_sampler";if(e.isReference(i))return o;{const l=e.getDataFromNode(this);let u=l.propertyName;if(u===void 0){const{uvNode:p,levelNode:f,biasNode:g,compareNode:m,depthNode:y,gradNode:b}=n,v=this.generateUV(e,p),_=f?f.build(e,"float"):null,T=g?g.build(e,"float"):null,E=y?y.build(e,"int"):null,C=m?m.build(e,"float"):null,R=b?[b[0].build(e,"vec2"),b[1].build(e,"vec2")]:null,B=e.getVarFromNode(this);u=e.getPropertyName(B);const I=this.generateSnippet(e,o,v,_,T,E,C,R);e.addLineFlowCode(`${u} = ${I}`,this),l.snippet=I,l.propertyName=u}let c=u;const h=this.getNodeType(e);return e.needsToWorkingColorSpace(s)&&(c=i8(by(c,h),s.colorSpace).setup(e).build(e,h)),e.format(c,h,i)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}uv(e){const i=this.clone();return i.uvNode=Ti(e),i.referenceNode=this.getSelf(),Ti(i)}blur(e){const i=this.clone();return i.biasNode=Ti(e).mul(jpe(i)),i.referenceNode=this.getSelf(),Ti(i)}level(e){const i=this.clone();return i.levelNode=Ti(e),i.referenceNode=this.getSelf(),Ti(i)}size(e){return xy(this,e)}bias(e){const i=this.clone();return i.biasNode=Ti(e),i.referenceNode=this.getSelf(),Ti(i)}compare(e){const i=this.clone();return i.compareNode=Ti(e),i.referenceNode=this.getSelf(),Ti(i)}grad(e,i){const n=this.clone();return n.gradNode=[Ti(e),Ti(i)],n.referenceNode=this.getSelf(),Ti(n)}depth(e){const i=this.clone();return i.depthNode=Ti(e),i.referenceNode=this.getSelf(),Ti(i)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid,e.sampler=this.sampler,e.updateMatrix=this.updateMatrix,e.updateType=this.updateType}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value],this.sampler=e.sampler,this.updateMatrix=e.updateMatrix,this.updateType=e.updateType}update(){const e=this.value,i=this._matrixUniform;i!==null&&(i.value=e.matrix),e.matrixAutoUpdate===!0&&e.updateMatrix()}clone(){const e=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return e.sampler=this.sampler,e}}const Us=ci(_y),wc=(...r)=>Us(...r).setSampler(!1),qp=Zr("float").label("cameraNear").setGroup(Tn).onRenderUpdate(({camera:r})=>r.near),Xp=Zr("float").label("cameraFar").setGroup(Tn).onRenderUpdate(({camera:r})=>r.far),d_=Zr("mat4").label("cameraProjectionMatrix").setGroup(Tn).onRenderUpdate(({camera:r})=>r.projectionMatrix),oh=Zr("mat4").label("cameraViewMatrix").setGroup(Tn).onRenderUpdate(({camera:r})=>r.matrixWorldInverse),Vpe=Zr(new Lt).label("cameraPosition").setGroup(Tn).onRenderUpdate(({camera:r},e)=>e.value.setFromMatrixPosition(r.matrixWorld));class zs extends tn{static get type(){return"Object3DNode"}constructor(e,i=null){super(),this.scope=e,this.object3d=i,this.updateType=un.OBJECT,this._uniformNode=new my(null)}getNodeType(){const e=this.scope;if(e===zs.WORLD_MATRIX)return"mat4";if(e===zs.POSITION||e===zs.VIEW_POSITION||e===zs.DIRECTION||e===zs.SCALE)return"vec3"}update(e){const i=this.object3d,n=this._uniformNode,s=this.scope;if(s===zs.WORLD_MATRIX)n.value=i.matrixWorld;else if(s===zs.POSITION)n.value=n.value||new Lt,n.value.setFromMatrixPosition(i.matrixWorld);else if(s===zs.SCALE)n.value=n.value||new Lt,n.value.setFromMatrixScale(i.matrixWorld);else if(s===zs.DIRECTION)n.value=n.value||new Lt,i.getWorldDirection(n.value);else if(s===zs.VIEW_POSITION){const o=e.camera;n.value=n.value||new Lt,n.value.setFromMatrixPosition(i.matrixWorld),n.value.applyMatrix4(o.matrixWorldInverse)}}generate(e){const i=this.scope;return i===zs.WORLD_MATRIX?this._uniformNode.nodeType="mat4":(i===zs.POSITION||i===zs.VIEW_POSITION||i===zs.DIRECTION||i===zs.SCALE)&&(this._uniformNode.nodeType="vec3"),this._uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}zs.WORLD_MATRIX="worldMatrix",zs.POSITION="position",zs.SCALE="scale",zs.VIEW_POSITION="viewPosition",zs.DIRECTION="direction";class Lg extends zs{static get type(){return"ModelNode"}constructor(e){super(e)}update(e){this.object3d=e.object,super.update(e)}}Lg.DIRECTION;const Yp=Yi(Lg,Lg.WORLD_MATRIX);Lg.POSITION,Lg.SCALE,Lg.VIEW_POSITION;const Gpe=Zr(new Go).onObjectUpdate(({object:r},e)=>e.value.getNormalMatrix(r.matrixWorld)),p_=oh.mul(Yp).toVar("modelViewMatrix"),o8=ah("position","vec3"),ja=o8.varying("positionLocal"),l8=o8.varying("positionPrevious"),$3=Yp.mul(ja).xyz.varying("v_positionWorld"),c8=ja.transformDirection(Yp).varying("v_positionWorldDirection").normalize().toVar("positionWorldDirection"),Va=p_.mul(ja).xyz.varying("v_positionView"),Is=Va.negate().varying("v_positionViewDirection").normalize().toVar("positionViewDirection");class Hpe extends tn{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){const{renderer:i,material:n}=e;return i.coordinateSystem===gc&&n.side===mc?"false":e.getFrontFacing()}}const Wpe=Yi(Hpe),f_=ii(Wpe).mul(2).sub(1),u8=ah("normal","vec3"),qc=Gi(r=>r.geometry.hasAttribute("normal")===!1?(console.warn('TSL.NormalNode: Vertex attribute "normal" not found on geometry.'),ei(0,1,0)):u8,"vec3").once()().toVar("normalLocal"),Qpe=Va.dFdx().cross(Va.dFdy()).normalize().toVar("normalFlat"),Cc=Gi(r=>{let e;return r.material.flatShading===!0?e=Qpe:e=sh(d8(qc),"v_normalView").normalize(),e},"vec3").once()().toVar("normalView"),h8=sh(Cc.transformDirection(oh),"v_normalWorld").normalize().toVar("normalWorld"),sa=Gi(r=>r.context.setupNormal(),"vec3").once()().mul(f_).toVar("transformedNormalView"),eR=sa.transformDirection(oh).toVar("transformedNormalWorld"),Ey=Gi(r=>r.context.setupClearcoatNormal(),"vec3").once()().mul(f_).toVar("transformedClearcoatNormalView"),qpe=Gi(([r,e=Yp])=>{const i=So(e),n=r.div(ei(i[0].dot(i[0]),i[1].dot(i[1]),i[2].dot(i[2])));return i.mul(n).xyz}),d8=Gi(([r],e)=>{const i=e.renderer.nodes.modelNormalViewMatrix;if(i!==null)return i.transformDirection(r);const n=Gpe.mul(r);return oh.transformDirection(n)}),Xpe=Zr(0).onReference(({material:r})=>r).onRenderUpdate(({material:r})=>r.refractionRatio),Ype=Is.negate().reflect(sa),Kpe=Is.negate().refract(sa,Xpe),Jpe=Ype.transformDirection(oh).toVar("reflectVector"),Zpe=Kpe.transformDirection(oh).toVar("reflectVector");class $pe extends _y{static get type(){return"CubeTextureNode"}constructor(e,i=null,n=null,s=null){super(e,i,n,s),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){const e=this.value;return e.mapping===Lp?Jpe:e.mapping===tg?Zpe:(console.error('THREE.CubeTextureNode: Mapping "%s" not supported.',e.mapping),ei(0,0,0))}setUpdateMatrix(){}setupUV(e,i){const n=this.value;return e.renderer.coordinateSystem===Op||!n.isRenderTargetTexture?ei(i.x.negate(),i.yz):i}generateUV(e,i){return i.build(e,"vec3")}}const wy=ci($pe);class p8 extends my{static get type(){return"BufferNode"}constructor(e,i,n=0){super(e,i),this.isBufferNode=!0,this.bufferType=i,this.bufferCount=n}getElementType(e){return this.getNodeType(e)}getInputType(){return"buffer"}}const tR=(r,e,i)=>Ti(new p8(r,e,i));class efe extends fy{static get type(){return"UniformArrayElementNode"}constructor(e,i){super(e,i),this.isArrayBufferElementNode=!0}generate(e){const i=super.generate(e),n=this.getNodeType();return e.format(i,"vec4",n)}}class tfe extends p8{static get type(){return"UniformArrayNode"}constructor(e,i=null){super(null,"vec4"),this.array=e,this.elementType=i,this._elementType=null,this._elementLength=0,this.updateType=un.RENDER,this.isArrayBufferNode=!0}getElementType(){return this.elementType||this._elementType}getElementLength(){return this._elementLength}update(){const{array:e,value:i}=this,n=this.getElementLength(),s=this.getElementType();if(n===1)for(let o=0;o<e.length;o++){const l=o*4;i[l]=e[o]}else if(s==="color")for(let o=0;o<e.length;o++){const l=o*4,u=e[o];i[l]=u.r,i[l+1]=u.g,i[l+2]=u.b||0}else for(let o=0;o<e.length;o++){const l=o*4,u=e[o];i[l]=u.x,i[l+1]=u.y,i[l+2]=u.z||0,i[l+3]=u.w||0}}setup(e){const i=this.array.length;this._elementType=this.elementType===null?K1(this.array[0]):this.elementType,this._elementLength=e.getTypeLength(this._elementType);let n=Float32Array;return this._elementType.charAt(0)==="i"?n=Int32Array:this._elementType.charAt(0)==="u"&&(n=Uint32Array),this.value=new n(i*4),this.bufferCount=i,this.bufferType=e.changeComponentType("vec4",e.getComponentType(this._elementType)),super.setup(e)}element(e){return Ti(new efe(this,Ti(e)))}}const Cy=(r,e)=>Ti(new tfe(r,e));class ife extends fy{static get type(){return"ReferenceElementNode"}constructor(e,i){super(e,i),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const i=super.generate(e),n=this.referenceNode.getNodeType(),s=this.getNodeType();return e.format(i,n,s)}}class iR extends tn{static get type(){return"ReferenceNode"}constructor(e,i,n=null,s=null){super(),this.property=e,this.uniformType=i,this.object=n,this.count=s,this.properties=e.split("."),this.reference=n,this.node=null,this.group=null,this.name=null,this.updateType=un.OBJECT}element(e){return Ti(new ife(this,Ti(e)))}setGroup(e){return this.group=e,this}label(e){return this.name=e,this}setNodeType(e){let i=null;this.count!==null?i=tR(null,e,this.count):Array.isArray(this.getValueFromReference())?i=Cy(null,e):e==="texture"?i=Us(null):e==="cubeTexture"?i=wy(null):i=Zr(null,e),this.group!==null&&i.setGroup(this.group),this.name!==null&&i.label(this.name),this.node=i.getSelf()}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:i}=this;let n=e[i[0]];for(let s=1;s<i.length;s++)n=n[i[s]];return n}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const Bs=(r,e,i)=>Ti(new iR(r,e,i)),f8=(r,e,i,n)=>Ti(new iR(r,e,n,i));class rfe extends iR{static get type(){return"MaterialReferenceNode"}constructor(e,i,n=null){super(e,i,n),this.material=n,this.isMaterialReferenceNode=!0}updateReference(e){return this.reference=this.material!==null?this.material:e.material,this.reference}}const _d=(r,e,i)=>Ti(new rfe(r,e,i)),m8=Gi(r=>(r.geometry.hasAttribute("tangent")===!1&&r.geometry.computeTangents(),ah("tangent","vec4")))(),rR=m8.xyz.toVar("tangentLocal"),g8=p_.mul(Jr(rR,0)).xyz.varying("v_tangentView").normalize().toVar("tangentView"),nfe=r=>r.mul(m8.w).xyz,sfe=sh(nfe(Cc.cross(g8)),"v_bitangentView").normalize().toVar("bitangentView"),Sy=So(g8,sfe,Cc),afe=(()=>{let r=Bg.cross(Is);return r=r.cross(Bg).normalize(),r=As(r,sa,Hp.mul(ih.oneMinus()).oneMinus().pow2().pow2()).normalize(),r})(),ofe=Gi(r=>{const{eye_pos:e,surf_norm:i,mapN:n,uv:s}=r,o=e.dFdx(),l=e.dFdy(),u=s.dFdx(),c=s.dFdy(),h=i,p=l.cross(h),f=h.cross(o),g=p.mul(u.x).add(f.mul(c.x)),m=p.mul(u.y).add(f.mul(c.y)),y=g.dot(g).max(m.dot(m)),b=f_.mul(y.inverseSqrt());return To(g.mul(n.x,b),m.mul(n.y,b),h.mul(n.z)).normalize()});class lfe extends ra{static get type(){return"NormalMapNode"}constructor(e,i=null){super("vec3"),this.node=e,this.scaleNode=i,this.normalMapType=cd}setup(e){const{normalMapType:i,scaleNode:n}=this;let s=this.node.mul(2).sub(1);n!==null&&(s=ei(s.xy.mul(n),s.z));let o=null;return i===hue?o=d8(s):i===cd&&(e.hasGeometryAttribute("tangent")===!0?o=Sy.mul(s).normalize():o=ofe({eye_pos:Va,surf_norm:Cc,mapN:s,uv:h_()})),o}}const A8=ci(lfe),cfe=Gi(({textureNode:r,bumpScale:e})=>{const i=s=>r.cache().context({getUV:o=>s(o.uvNode||h_()),forceUVContext:!0}),n=ii(i(s=>s));return Ki(ii(i(s=>s.add(s.dFdx()))).sub(n),ii(i(s=>s.add(s.dFdy()))).sub(n)).mul(e)}),ufe=Gi(r=>{const{surf_pos:e,surf_norm:i,dHdxy:n}=r,s=e.dFdx().normalize(),o=e.dFdy().normalize(),l=i,u=o.cross(l),c=l.cross(s),h=s.dot(u).mul(f_),p=h.sign().mul(n.x.mul(u).add(n.y.mul(c)));return h.abs().mul(i).sub(p).normalize()});class hfe extends ra{static get type(){return"BumpMapNode"}constructor(e,i=null){super("vec3"),this.textureNode=e,this.scaleNode=i}setup(){const e=this.scaleNode!==null?this.scaleNode:1,i=cfe({textureNode:this.textureNode,bumpScale:e});return ufe({surf_pos:Va,surf_norm:Cc,dHdxy:i})}}const dfe=ci(hfe),y8=new Map;class Xt extends tn{static get type(){return"MaterialNode"}constructor(e){super(),this.scope=e}getCache(e,i){let n=y8.get(e);return n===void 0&&(n=_d(e,i),y8.set(e,n)),n}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache(e==="map"?"map":e+"Map","texture")}setup(e){const i=e.context.material,n=this.scope;let s=null;if(n===Xt.COLOR){const o=i.color!==void 0?this.getColor(n):ei();i.map&&i.map.isTexture===!0?s=o.mul(this.getTexture("map")):s=o}else if(n===Xt.OPACITY){const o=this.getFloat(n);i.alphaMap&&i.alphaMap.isTexture===!0?s=o.mul(this.getTexture("alpha")):s=o}else if(n===Xt.SPECULAR_STRENGTH)i.specularMap&&i.specularMap.isTexture===!0?s=this.getTexture("specular").r:s=ii(1);else if(n===Xt.SPECULAR_INTENSITY){const o=this.getFloat(n);i.specularMap?s=o.mul(this.getTexture(n).a):s=o}else if(n===Xt.SPECULAR_COLOR){const o=this.getColor(n);i.specularColorMap&&i.specularColorMap.isTexture===!0?s=o.mul(this.getTexture(n).rgb):s=o}else if(n===Xt.ROUGHNESS){const o=this.getFloat(n);i.roughnessMap&&i.roughnessMap.isTexture===!0?s=o.mul(this.getTexture(n).g):s=o}else if(n===Xt.METALNESS){const o=this.getFloat(n);i.metalnessMap&&i.metalnessMap.isTexture===!0?s=o.mul(this.getTexture(n).b):s=o}else if(n===Xt.EMISSIVE){const o=this.getFloat("emissiveIntensity"),l=this.getColor(n).mul(o);i.emissiveMap&&i.emissiveMap.isTexture===!0?s=l.mul(this.getTexture(n)):s=l}else if(n===Xt.NORMAL)i.normalMap?(s=A8(this.getTexture("normal"),this.getCache("normalScale","vec2")),s.normalMapType=i.normalMapType):i.bumpMap?s=dfe(this.getTexture("bump").r,this.getFloat("bumpScale")):s=Cc;else if(n===Xt.CLEARCOAT){const o=this.getFloat(n);i.clearcoatMap&&i.clearcoatMap.isTexture===!0?s=o.mul(this.getTexture(n).r):s=o}else if(n===Xt.CLEARCOAT_ROUGHNESS){const o=this.getFloat(n);i.clearcoatRoughnessMap&&i.clearcoatRoughnessMap.isTexture===!0?s=o.mul(this.getTexture(n).r):s=o}else if(n===Xt.CLEARCOAT_NORMAL)i.clearcoatNormalMap?s=A8(this.getTexture(n),this.getCache(n+"Scale","vec2")):s=Cc;else if(n===Xt.SHEEN){const o=this.getColor("sheenColor").mul(this.getFloat("sheen"));i.sheenColorMap&&i.sheenColorMap.isTexture===!0?s=o.mul(this.getTexture("sheenColor").rgb):s=o}else if(n===Xt.SHEEN_ROUGHNESS){const o=this.getFloat(n);i.sheenRoughnessMap&&i.sheenRoughnessMap.isTexture===!0?s=o.mul(this.getTexture(n).a):s=o,s=s.clamp(.07,1)}else if(n===Xt.ANISOTROPY)if(i.anisotropyMap&&i.anisotropyMap.isTexture===!0){const o=this.getTexture(n);s=U3(Ty.x,Ty.y,Ty.y.negate(),Ty.x).mul(o.rg.mul(2).sub(Ki(1)).normalize().mul(o.b))}else s=Ty;else if(n===Xt.IRIDESCENCE_THICKNESS){const o=Bs("1","float",i.iridescenceThicknessRange);if(i.iridescenceThicknessMap){const l=Bs("0","float",i.iridescenceThicknessRange);s=o.sub(l).mul(this.getTexture(n).g).add(l)}else s=o}else if(n===Xt.TRANSMISSION){const o=this.getFloat(n);i.transmissionMap?s=o.mul(this.getTexture(n).r):s=o}else if(n===Xt.THICKNESS){const o=this.getFloat(n);i.thicknessMap?s=o.mul(this.getTexture(n).g):s=o}else if(n===Xt.IOR)s=this.getFloat(n);else if(n===Xt.LIGHT_MAP)s=this.getTexture(n).rgb.mul(this.getFloat("lightMapIntensity"));else if(n===Xt.AO_MAP)s=this.getTexture(n).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else{const o=this.getNodeType(e);s=this.getCache(n,o)}return s}}Xt.ALPHA_TEST="alphaTest",Xt.COLOR="color",Xt.OPACITY="opacity",Xt.SHININESS="shininess",Xt.SPECULAR="specular",Xt.SPECULAR_STRENGTH="specularStrength",Xt.SPECULAR_INTENSITY="specularIntensity",Xt.SPECULAR_COLOR="specularColor",Xt.REFLECTIVITY="reflectivity",Xt.ROUGHNESS="roughness",Xt.METALNESS="metalness",Xt.NORMAL="normal",Xt.CLEARCOAT="clearcoat",Xt.CLEARCOAT_ROUGHNESS="clearcoatRoughness",Xt.CLEARCOAT_NORMAL="clearcoatNormal",Xt.EMISSIVE="emissive",Xt.ROTATION="rotation",Xt.SHEEN="sheen",Xt.SHEEN_ROUGHNESS="sheenRoughness",Xt.ANISOTROPY="anisotropy",Xt.IRIDESCENCE="iridescence",Xt.IRIDESCENCE_IOR="iridescenceIOR",Xt.IRIDESCENCE_THICKNESS="iridescenceThickness",Xt.IOR="ior",Xt.TRANSMISSION="transmission",Xt.THICKNESS="thickness",Xt.ATTENUATION_DISTANCE="attenuationDistance",Xt.ATTENUATION_COLOR="attenuationColor",Xt.LINE_SCALE="scale",Xt.LINE_DASH_SIZE="dashSize",Xt.LINE_GAP_SIZE="gapSize",Xt.LINE_WIDTH="linewidth",Xt.LINE_DASH_OFFSET="dashOffset",Xt.POINT_WIDTH="pointWidth",Xt.DISPERSION="dispersion",Xt.LIGHT_MAP="light",Xt.AO_MAP="ao";const pfe=Yi(Xt,Xt.ALPHA_TEST),ffe=Yi(Xt,Xt.COLOR),mfe=Yi(Xt,Xt.SHININESS),gfe=Yi(Xt,Xt.EMISSIVE),v8=Yi(Xt,Xt.OPACITY),Afe=Yi(Xt,Xt.SPECULAR),b8=Yi(Xt,Xt.SPECULAR_INTENSITY),yfe=Yi(Xt,Xt.SPECULAR_COLOR),m_=Yi(Xt,Xt.SPECULAR_STRENGTH),nR=Yi(Xt,Xt.REFLECTIVITY),vfe=Yi(Xt,Xt.ROUGHNESS),bfe=Yi(Xt,Xt.METALNESS),xfe=Yi(Xt,Xt.NORMAL).context({getUV:null}),_fe=Yi(Xt,Xt.CLEARCOAT),Efe=Yi(Xt,Xt.CLEARCOAT_ROUGHNESS),wfe=Yi(Xt,Xt.CLEARCOAT_NORMAL).context({getUV:null}),Cfe=Yi(Xt,Xt.ROTATION),Sfe=Yi(Xt,Xt.SHEEN),Tfe=Yi(Xt,Xt.SHEEN_ROUGHNESS),Mfe=Yi(Xt,Xt.ANISOTROPY),Rfe=Yi(Xt,Xt.IRIDESCENCE),Ife=Yi(Xt,Xt.IRIDESCENCE_IOR),Bfe=Yi(Xt,Xt.IRIDESCENCE_THICKNESS),Lfe=Yi(Xt,Xt.TRANSMISSION),Dfe=Yi(Xt,Xt.THICKNESS),Nfe=Yi(Xt,Xt.IOR),Pfe=Yi(Xt,Xt.ATTENUATION_DISTANCE),Ofe=Yi(Xt,Xt.ATTENUATION_COLOR),kfe=Yi(Xt,Xt.LINE_SCALE),Ffe=Yi(Xt,Xt.LINE_DASH_SIZE),Ufe=Yi(Xt,Xt.LINE_GAP_SIZE);Xt.LINE_WIDTH,Xt.LINE_DASH_OFFSET,Xt.POINT_WIDTH;const zfe=Yi(Xt,Xt.DISPERSION),x8=Yi(Xt,Xt.LIGHT_MAP),jfe=Yi(Xt,Xt.AO_MAP),Ty=Zr(new Dn).onReference(function(r){return r.material}).onRenderUpdate(function({material:r}){this.value.set(r.anisotropy*Math.cos(r.anisotropyRotation),r.anisotropy*Math.sin(r.anisotropyRotation))});class Vfe extends ra{static get type(){return"ModelViewProjectionNode"}constructor(e=null){super("vec4"),this.positionNode=e}setup(e){if(e.shaderStage==="fragment")return sh(e.context.mvp);const i=this.positionNode||ja,n=e.renderer.nodes.modelViewMatrix||p_;return d_.mul(n).mul(i)}}const sR=ci(Vfe);class js extends tn{static get type(){return"IndexNode"}constructor(e){super("uint"),this.scope=e,this.isInstanceIndexNode=!0}generate(e){const i=this.getNodeType(e),n=this.scope;let s;if(n===js.VERTEX)s=e.getVertexIndex();else if(n===js.INSTANCE)s=e.getInstanceIndex();else if(n===js.DRAW)s=e.getDrawIndex();else if(n===js.INVOCATION_LOCAL)s=e.getInvocationLocalIndex();else if(n===js.INVOCATION_SUBGROUP)s=e.getInvocationSubgroupIndex();else if(n===js.SUBGROUP)s=e.getSubgroupIndex();else throw new Error("THREE.IndexNode: Unknown scope: "+n);let o;return e.shaderStage==="vertex"||e.shaderStage==="compute"?o=s:o=sh(this).build(e,i),o}}js.VERTEX="vertex",js.INSTANCE="instance",js.SUBGROUP="subgroup",js.INVOCATION_LOCAL="invocationLocal",js.INVOCATION_SUBGROUP="invocationSubgroup",js.DRAW="draw";const Gfe=Yi(js,js.VERTEX),aR=Yi(js,js.INSTANCE);js.SUBGROUP,js.INVOCATION_SUBGROUP,js.INVOCATION_LOCAL;const Hfe=Yi(js,js.DRAW);class Wfe extends tn{static get type(){return"InstanceNode"}constructor(e){super("void"),this.instanceMesh=e,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=un.FRAME,this.buffer=null,this.bufferColor=null}setup(e){let i=this.instanceMatrixNode,n=this.instanceColorNode;const s=this.instanceMesh;if(i===null){const u=s.instanceMatrix;if(s.count<=1e3)i=tR(u.array,"mat4",Math.max(s.count,1)).element(aR);else{const c=new Ihe(u.array,16,1);this.buffer=c;const h=u.usage===og?s8:n8,p=[h(c,"vec4",16,0),h(c,"vec4",16,4),h(c,"vec4",16,8),h(c,"vec4",16,12)];i=Mg(...p)}this.instanceMatrixNode=i}const o=s.instanceColor;if(o&&n===null){const u=new ghe(o.array,3),c=o.usage===og?s8:n8;this.bufferColor=u,n=ei(c(u,"vec3",3,0)),this.instanceColorNode=n}const l=i.mul(ja).xyz;if(ja.assign(l),e.hasGeometryAttribute("normal")){const u=qpe(qc,i);qc.assign(u)}this.instanceColorNode!==null&&i_("vec3","vInstanceColor").assign(this.instanceColorNode)}update(){this.instanceMesh.instanceMatrix.usage!==og&&this.buffer!=null&&this.instanceMesh.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMesh.instanceMatrix.version),this.instanceMesh.instanceColor&&this.instanceMesh.instanceColor.usage!==og&&this.bufferColor!=null&&this.instanceMesh.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceMesh.instanceColor.version)}}const Qfe=ci(Wfe);class qfe extends tn{static get type(){return"BatchNode"}constructor(e){super("void"),this.batchMesh=e,this.batchingIdNode=null}setup(e){this.batchingIdNode===null&&(e.getDrawIndex()===null?this.batchingIdNode=aR:this.batchingIdNode=Hfe);const i=Gi(([m])=>{const y=xy(wc(this.batchMesh._indirectTexture),0),b=Fs(m).modInt(Fs(y)),v=Fs(m).div(Fs(y));return wc(this.batchMesh._indirectTexture,th(b,v)).x}).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]})(Fs(this.batchingIdNode)),n=this.batchMesh._matricesTexture,s=xy(wc(n),0),o=ii(i).mul(4).toInt().toVar(),l=o.modInt(s),u=o.div(Fs(s)),c=Mg(wc(n,th(l,u)),wc(n,th(l.add(1),u)),wc(n,th(l.add(2),u)),wc(n,th(l.add(3),u))),h=this.batchMesh._colorsTexture;if(h!==null){const m=Gi(([y])=>{const b=xy(wc(h),0).x,v=y,_=v.modInt(b),T=v.div(b);return wc(h,th(_,T)).rgb}).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]})(i);i_("vec3","vBatchColor").assign(m)}const p=So(c);ja.assign(c.mul(ja));const f=qc.div(ei(p[0].dot(p[0]),p[1].dot(p[1]),p[2].dot(p[2]))),g=p.mul(f).xyz;qc.assign(g),e.hasGeometryAttribute("tangent")&&rR.mulAssign(p)}}const Xfe=ci(qfe),_8=new WeakMap;class Yfe extends tn{static get type(){return"SkinningNode"}constructor(e,i=!1){super("void"),this.skinnedMesh=e,this.useReference=i,this.updateType=un.OBJECT,this.skinIndexNode=ah("skinIndex","uvec4"),this.skinWeightNode=ah("skinWeight","vec4");let n,s,o;i?(n=Bs("bindMatrix","mat4"),s=Bs("bindMatrixInverse","mat4"),o=f8("skeleton.boneMatrices","mat4",e.skeleton.bones.length)):(n=Zr(e.bindMatrix,"mat4"),s=Zr(e.bindMatrixInverse,"mat4"),o=tR(e.skeleton.boneMatrices,"mat4",e.skeleton.bones.length)),this.bindMatrixNode=n,this.bindMatrixInverseNode=s,this.boneMatricesNode=o,this.previousBoneMatricesNode=null}getSkinnedPosition(e=this.boneMatricesNode,i=ja){const{skinIndexNode:n,skinWeightNode:s,bindMatrixNode:o,bindMatrixInverseNode:l}=this,u=e.element(n.x),c=e.element(n.y),h=e.element(n.z),p=e.element(n.w),f=o.mul(i),g=To(u.mul(s.x).mul(f),c.mul(s.y).mul(f),h.mul(s.z).mul(f),p.mul(s.w).mul(f));return l.mul(g).xyz}getSkinnedNormal(e=this.boneMatricesNode,i=qc){const{skinIndexNode:n,skinWeightNode:s,bindMatrixNode:o,bindMatrixInverseNode:l}=this,u=e.element(n.x),c=e.element(n.y),h=e.element(n.z),p=e.element(n.w);let f=To(s.x.mul(u),s.y.mul(c),s.z.mul(h),s.w.mul(p));return f=l.mul(f).mul(o),f.transformDirection(i).xyz}getPreviousSkinnedPosition(e){const i=e.object;return this.previousBoneMatricesNode===null&&(i.skeleton.previousBoneMatrices=new Float32Array(i.skeleton.boneMatrices),this.previousBoneMatricesNode=f8("skeleton.previousBoneMatrices","mat4",i.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,l8)}needsPreviousBoneMatrices(e){const i=e.renderer.getMRT();return i&&i.has("velocity")}setup(e){this.needsPreviousBoneMatrices(e)&&l8.assign(this.getPreviousSkinnedPosition(e));const i=this.getSkinnedPosition();if(ja.assign(i),e.hasGeometryAttribute("normal")){const n=this.getSkinnedNormal();qc.assign(n),e.hasGeometryAttribute("tangent")&&rR.assign(n)}}generate(e,i){if(i!=="void")return ja.build(e,i)}update(e){const i=(this.useReference?e.object:this.skinnedMesh).skeleton;_8.get(i)!==e.frameId&&(_8.set(i,e.frameId),this.previousBoneMatricesNode!==null&&i.previousBoneMatrices.set(i.boneMatrices),i.update())}}const Kfe=r=>Ti(new Yfe(r,!0));class Jfe extends tn{static get type(){return"LoopNode"}constructor(e=[]){super(),this.params=e}getVarName(e){return String.fromCharCode(105+e)}getProperties(e){const i=e.getNodeProperties(this);if(i.stackNode!==void 0)return i;const n={};for(let o=0,l=this.params.length-1;o<l;o++){const u=this.params[o],c=u.isNode!==!0&&u.name||this.getVarName(o),h=u.isNode!==!0&&u.type||"int";n[c]=by(c,h)}const s=e.addStack();return i.returnsNode=this.params[this.params.length-1](n,s,e),i.stackNode=s,e.removeStack(),i}getNodeType(e){const{returnsNode:i}=this.getProperties(e);return i?i.getNodeType(e):"void"}setup(e){this.getProperties(e)}generate(e){const i=this.getProperties(e),n=this.params,s=i.stackNode;for(let u=0,c=n.length-1;u<c;u++){const h=n[u];let p=null,f=null,g=null,m=null,y=null,b=null;h.isNode?(m="int",g=this.getVarName(u),p="0",f=h.build(e,m),y="<"):(m=h.type||"int",g=h.name||this.getVarName(u),p=h.start,f=h.end,y=h.condition,b=h.update,typeof p=="number"?p=e.generateConst(m,p):p&&p.isNode&&(p=p.build(e,m)),typeof f=="number"?f=e.generateConst(m,f):f&&f.isNode&&(f=f.build(e,m)),p!==void 0&&f===void 0?(p=p+" - 1",f="0",y=">="):f!==void 0&&p===void 0&&(p="0",y="<"),y===void 0&&(Number(p)>Number(f)?y=">=":y="<"));const v={start:p,end:f},_=v.start,T=v.end;let E="",C="",R="";b||(m==="int"||m==="uint"?y.includes("<")?b="++":b="--":y.includes("<")?b="+= 1.":b="-= 1."),E+=e.getVar(m,g)+" = "+_,C+=g+" "+y+" "+T,R+=g+" "+b;const B=`for ( ${E}; ${C}; ${R} )`;e.addFlowCode((u===0?`
`:"")+e.tab+B+` {

`).addFlowTab()}const o=s.build(e,"void"),l=i.returnsNode?i.returnsNode.build(e):"";e.removeFlowTab().addFlowCode(`
`+e.tab+o);for(let u=0,c=this.params.length-1;u<c;u++)e.addFlowCode((u===0?"":e.tab)+`}

`).removeFlowTab();return e.addFlowTab(),l}}const Xc=(...r)=>Ti(new Jfe(Tg(r,"int"))).append(),Zfe=()=>by("break").append(),oR=new WeakMap,vl=new Jn,E8=Gi(({bufferMap:r,influence:e,stride:i,width:n,depth:s,offset:o})=>{const l=Fs(Gfe).mul(i).add(o),u=l.div(n),c=l.sub(u.mul(n));return wc(r,th(c,u)).depth(s).mul(e)});function $fe(r){const e=r.morphAttributes.position!==void 0,i=r.morphAttributes.normal!==void 0,n=r.morphAttributes.color!==void 0,s=r.morphAttributes.position||r.morphAttributes.normal||r.morphAttributes.color,o=s!==void 0?s.length:0;let l=oR.get(r);if(l===void 0||l.count!==o){let u=function(){v.dispose(),oR.delete(r),r.removeEventListener("dispose",u)};l!==void 0&&l.texture.dispose();const c=r.morphAttributes.position||[],h=r.morphAttributes.normal||[],p=r.morphAttributes.color||[];let f=0;e===!0&&(f=1),i===!0&&(f=2),n===!0&&(f=3);let g=r.attributes.position.count*f,m=1;const y=4096;g>y&&(m=Math.ceil(g/y),g=y);const b=new Float32Array(g*m*4*o),v=new Kue(b,g,m,o);v.type=pl,v.needsUpdate=!0;const _=f*4;for(let T=0;T<o;T++){const E=c[T],C=h[T],R=p[T],B=g*m*4*T;for(let I=0;I<E.count;I++){const N=I*_;e===!0&&(vl.fromBufferAttribute(E,I),b[B+N+0]=vl.x,b[B+N+1]=vl.y,b[B+N+2]=vl.z,b[B+N+3]=0),i===!0&&(vl.fromBufferAttribute(C,I),b[B+N+4]=vl.x,b[B+N+5]=vl.y,b[B+N+6]=vl.z,b[B+N+7]=0),n===!0&&(vl.fromBufferAttribute(R,I),b[B+N+8]=vl.x,b[B+N+9]=vl.y,b[B+N+10]=vl.z,b[B+N+11]=R.itemSize===4?vl.w:1)}}l={count:o,texture:v,stride:f,size:new Dn(g,m)},oR.set(r,l),r.addEventListener("dispose",u)}return l}class eme extends tn{static get type(){return"MorphNode"}constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=Zr(1),this.updateType=un.OBJECT}setup(e){const{geometry:i}=e,n=i.morphAttributes.position!==void 0,s=i.hasAttribute("normal")&&i.morphAttributes.normal!==void 0,o=i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color,l=o!==void 0?o.length:0,{texture:u,stride:c,size:h}=$fe(i);n===!0&&ja.mulAssign(this.morphBaseInfluence),s===!0&&qc.mulAssign(this.morphBaseInfluence);const p=Fs(h.width);Xc(l,({i:f})=>{const g=ii(0).toVar();this.mesh.count>1&&this.mesh.morphTexture!==null&&this.mesh.morphTexture!==void 0?g.assign(wc(this.mesh.morphTexture,th(Fs(f).add(1),Fs(aR))).r):g.assign(Bs("morphTargetInfluences","float").element(f).toVar()),n===!0&&ja.addAssign(E8({bufferMap:u,influence:g,stride:c,width:p,depth:f,offset:Fs(0)})),s===!0&&qc.addAssign(E8({bufferMap:u,influence:g,stride:c,width:p,depth:f,offset:Fs(1)}))})}update(){const e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((i,n)=>i+n,0)}}const tme=ci(eme);class Dg extends tn{static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}generate(){console.warn("Abstract function.")}}class ime extends Dg{static get type(){return"AONode"}constructor(e=null){super(),this.aoNode=e}setup(e){e.context.ambientOcclusion.mulAssign(this.aoNode)}}class rme extends e8{static get type(){return"LightingContextNode"}constructor(e,i=null,n=null,s=null){super(e),this.lightingModel=i,this.backdropNode=n,this.backdropAlphaNode=s,this._value=null}getContext(){const{backdropNode:e,backdropAlphaNode:i}=this,n=ei().toVar("directDiffuse"),s=ei().toVar("directSpecular"),o=ei().toVar("indirectDiffuse"),l=ei().toVar("indirectSpecular"),u={directDiffuse:n,directSpecular:s,indirectDiffuse:o,indirectSpecular:l};return{radiance:ei().toVar("radiance"),irradiance:ei().toVar("irradiance"),iblIrradiance:ei().toVar("iblIrradiance"),ambientOcclusion:ii(1).toVar("ambientOcclusion"),reflectedLight:u,backdrop:e,backdropAlpha:i}}setup(e){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}}const nme=ci(rme);class sme extends Dg{static get type(){return"IrradianceNode"}constructor(e){super(),this.node=e}setup(e){e.context.irradiance.addAssign(this.node)}}let My,Ry;class aa extends tn{static get type(){return"ScreenNode"}constructor(e){super(),this.scope=e,this.isViewportNode=!0}getNodeType(){return this.scope===aa.VIEWPORT?"vec4":"vec2"}getUpdateType(){let e=un.NONE;return(this.scope===aa.SIZE||this.scope===aa.VIEWPORT)&&(e=un.RENDER),this.updateType=e,e}update({renderer:e}){const i=e.getRenderTarget();this.scope===aa.VIEWPORT?i!==null?Ry.copy(i.viewport):(e.getViewport(Ry),Ry.multiplyScalar(e.getPixelRatio())):i!==null?(My.width=i.width,My.height=i.height):e.getDrawingBufferSize(My)}setup(){const e=this.scope;let i=null;return e===aa.SIZE?i=Zr(My||(My=new Dn)):e===aa.VIEWPORT?i=Zr(Ry||(Ry=new Jn)):i=Ki(cR.div(lR)),i}generate(e){if(this.scope===aa.COORDINATE){let i=e.getFragCoord();if(e.isFlipY()){const n=e.getNodeProperties(lR).outputNode.build(e);i=`${e.getType("vec2")}( ${i}.x, ${n}.y - ${i}.y )`}return i}return super.generate(e)}}aa.COORDINATE="coordinate",aa.VIEWPORT="viewport",aa.SIZE="size",aa.UV="uv";const Iy=Yi(aa,aa.UV),lR=Yi(aa,aa.SIZE),cR=Yi(aa,aa.COORDINATE),w8=Yi(aa,aa.VIEWPORT);w8.zw,w8.xy;const By=new Dn;class C8 extends _y{static get type(){return"ViewportTextureNode"}constructor(e=Iy,i=null,n=null){n===null&&(n=new vhe,n.minFilter=Vu),super(n,e,i),this.generateMipmaps=!1,this.isOutputTextureNode=!0,this.updateBeforeType=un.FRAME}updateBefore(e){const i=e.renderer;i.getDrawingBufferSize(By);const n=this.value;(n.image.width!==By.width||n.image.height!==By.height)&&(n.image.width=By.width,n.image.height=By.height,n.needsUpdate=!0);const s=n.generateMipmaps;n.generateMipmaps=this.generateMipmaps,i.copyFramebufferToTexture(n),n.generateMipmaps=s}clone(){const e=new this.constructor(this.uvNode,this.levelNode,this.value);return e.generateMipmaps=this.generateMipmaps,e}}const S8=ci(C8,null,null,{generateMipmaps:!0});let uR=null;class ame extends C8{static get type(){return"ViewportDepthTextureNode"}constructor(e=Iy,i=null){uR===null&&(uR=new Eg),super(e,i,uR)}}const ome=ci(ame);class Qo extends tn{static get type(){return"ViewportDepthNode"}constructor(e,i=null){super("float"),this.scope=e,this.valueNode=i,this.isViewportDepthNode=!0}generate(e){const{scope:i}=this;return i===Qo.DEPTH_BASE?e.getFragDepth():super.generate(e)}setup({camera:e}){const{scope:i}=this,n=this.valueNode;let s=null;if(i===Qo.DEPTH_BASE)n!==null&&(s=R8().assign(n));else if(i===Qo.DEPTH)e.isPerspectiveCamera?s=lme(Va.z,qp,Xp):s=Ly(Va.z,qp,Xp);else if(i===Qo.LINEAR_DEPTH)if(n!==null)if(e.isPerspectiveCamera){const o=T8(n,qp,Xp);s=Ly(o,qp,Xp)}else s=n;else s=Ly(Va.z,qp,Xp);return s}}Qo.DEPTH_BASE="depthBase",Qo.DEPTH="depth",Qo.LINEAR_DEPTH="linearDepth";const Ly=(r,e,i)=>r.add(e).div(e.sub(i)),lme=(r,e,i)=>e.add(r).mul(i).div(i.sub(e).mul(r)),T8=(r,e,i)=>e.mul(i).div(i.sub(e).mul(r).sub(i)),M8=(r,e,i)=>{e=e.max(1e-6).toVar();const n=rh(r.div(e).add(1)),s=rh(i.div(e).add(1));return n.div(s)},R8=ci(Qo,Qo.DEPTH_BASE),I8=Yi(Qo,Qo.DEPTH);Qo.LINEAR_DEPTH,ome(),I8.assign=r=>R8(r);class Ed extends tn{static get type(){return"ClippingNode"}constructor(e=Ed.DEFAULT){super(),this.scope=e}setup(e){super.setup(e);const i=e.clippingContext,{localClipIntersection:n,localClippingCount:s,globalClippingCount:o}=i,l=o+s,u=n?l-s:l;return this.scope===Ed.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(i.planes,l,u):this.setupDefault(i.planes,l,u)}setupAlphaToCoverage(e,i,n){return Gi(()=>{const s=Cy(e),o=Rg("float","distanceToPlane"),l=Rg("float","distanceToGradient"),u=Rg("float","clipOpacity");u.assign(1);let c;if(Xc(n,({i:h})=>{c=s.element(h),o.assign(Va.dot(c.xyz).negate().add(c.w)),l.assign(o.fwidth().div(2)),u.mulAssign(Qp(l.negate(),l,o)),u.equal(0).discard()}),n<i){const h=Rg("float","unionclipOpacity");h.assign(1),Xc({start:n,end:i},({i:p})=>{c=s.element(p),o.assign(Va.dot(c.xyz).negate().add(c.w)),l.assign(o.fwidth().div(2)),h.mulAssign(Qp(l.negate(),l,o).oneMinus())}),u.mulAssign(h.oneMinus())}Qn.a.mulAssign(u),Qn.a.equal(0).discard()})()}setupDefault(e,i,n){return Gi(()=>{const s=Cy(e);let o;if(Xc(n,({i:l})=>{o=s.element(l),Va.dot(o.xyz).greaterThan(o.w).discard()}),n<i){const l=Rg("bool","clipped");l.assign(!0),Xc({start:n,end:i},({i:u})=>{o=s.element(u),l.assign(Va.dot(o.xyz).greaterThan(o.w).and(l))}),l.discard()}})()}}Ed.ALPHA_TO_COVERAGE="alphaToCoverage",Ed.DEFAULT="default";const cme=()=>Ti(new Ed),ume=()=>Ti(new Ed(Ed.ALPHA_TO_COVERAGE)),hme=.05,B8=Gi(([r])=>vd(vn(1e4,_c(vn(17,r.x).add(vn(.1,r.y)))).mul(To(.1,Ec(_c(vn(13,r.y).add(r.x))))))),L8=Gi(([r])=>B8(Ki(B8(r.xy),r.z))),dme=Gi(([r])=>{const e=Fl(xd(q6(r.xyz)),xd(X6(r.xyz))).toVar("maxDeriv"),i=ii(1).div(ii(hme).mul(e)).toVar("pixScale"),n=Ki(gy(Wp(rh(i))),gy(X3(rh(i)))).toVar("pixScales"),s=Ki(L8(Wp(n.x.mul(r.xyz))),L8(Wp(n.y.mul(r.xyz)))).toVar("alpha"),o=vd(rh(i)).toVar("lerpFactor"),l=To(vn(o.oneMinus(),s.x),vn(o,s.y)).toVar("x"),u=yy(o,o.oneMinus()).toVar("a"),c=ei(l.mul(l).div(vn(2,u).mul(yl(1,u))),l.sub(vn(.5,u)).div(yl(1,u)),yl(1,yl(1,l).mul(yl(1,l)).div(vn(2,u).mul(yl(1,u))))).toVar("cases"),h=l.lessThan(u.oneMinus()).select(l.lessThan(u).select(c.x,c.y),c.z);return nh(h,1e-6,1)});class oa extends Ho{static get type(){return"NodeMaterial"}constructor(){super(),this.isNodeMaterial=!0,this.type=this.constructor.type,this.forceSinglePass=!1,this.fog=!0,this.lights=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.positionNode=null,this.geometryNode=null,this.depthNode=null,this.shadowNode=null,this.shadowPositionNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null}customProgramCacheKey(){return this.type+g6(this)}build(e){this.setup(e)}setupObserver(e){return new Lhe(e)}setup(e){e.context.setupNormal=()=>this.setupNormal(e),e.addStack(),e.stack.outputNode=this.vertexNode||this.setupPosition(e),this.geometryNode!==null&&(e.stack.outputNode=e.stack.outputNode.bypass(this.geometryNode)),e.addFlow("vertex",e.removeStack()),e.addStack();let i;const n=this.setupClipping(e);if(this.depthWrite===!0&&this.setupDepth(e),this.fragmentNode===null){this.setupDiffuseColor(e),this.setupVariants(e);const s=this.setupLighting(e);n!==null&&e.stack.add(n);const o=Jr(s,Qn.a).max(0);if(i=this.setupOutput(e,o),gde.assign(i),this.outputNode!==null&&(i=this.outputNode),e.renderer.getRenderTarget()!==null){const l=e.renderer.getMRT(),u=this.mrtNode;l!==null?(i=l,u!==null&&(i=l.merge(u))):u!==null&&(i=u)}}else{let s=this.fragmentNode;s.isOutputStructNode!==!0&&(s=Jr(s)),i=this.setupOutput(e,s)}e.stack.outputNode=i,e.addFlow("fragment",e.removeStack()),e.monitor=this.setupObserver(e)}setupClipping(e){if(e.clippingContext===null)return null;const{globalClippingCount:i,localClippingCount:n}=e.clippingContext;let s=null;if(i||n){const o=e.renderer.samples;this.alphaToCoverage&&o>1?s=ume():e.stack.add(cme())}return s}setupDepth(e){const{renderer:i,camera:n}=e;let s=this.depthNode;if(s===null){const o=i.getMRT();o&&o.has("depth")?s=o.get("depth"):i.logarithmicDepthBuffer===!0&&(n.isPerspectiveCamera?s=M8(sR().w,qp,Xp):s=Ly(Va.z,qp,Xp))}s!==null&&I8.assign(s).append()}setupPosition(e){const{object:i}=e,n=i.geometry;if(e.addStack(),(n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color)&&tme(i).append(),i.isSkinnedMesh===!0&&Kfe(i).append(),this.displacementMap){const o=_d("displacementMap","texture"),l=_d("displacementScale","float"),u=_d("displacementBias","float");ja.addAssign(qc.normalize().mul(o.x.mul(l).add(u)))}i.isBatchedMesh&&Xfe(i).append(),i.instanceMatrix&&i.instanceMatrix.isInstancedBufferAttribute===!0&&Qfe(i).append(),this.positionNode!==null&&ja.assign(this.positionNode);const s=sR();return e.context.vertex=e.removeStack(),e.context.mvp=s,s}setupDiffuseColor({object:e,geometry:i}){let n=this.colorNode?Jr(this.colorNode):ffe;this.vertexColors===!0&&i.hasAttribute("color")&&(n=Jr(n.xyz.mul(ah("color","vec3")),n.a)),e.instanceColor&&(n=i_("vec3","vInstanceColor").mul(n)),e.isBatchedMesh&&e._colorsTexture&&(n=i_("vec3","vBatchColor").mul(n)),Qn.assign(n);const s=this.opacityNode?ii(this.opacityNode):v8;if(Qn.a.assign(Qn.a.mul(s)),this.alphaTestNode!==null||this.alphaTest>0){const o=this.alphaTestNode!==null?ii(this.alphaTestNode):pfe;Qn.a.lessThanEqual(o).discard()}this.alphaHash===!0&&Qn.a.lessThan(dme(ja)).discard(),this.transparent===!1&&this.blending===ad&&this.alphaToCoverage===!1&&Qn.a.assign(1)}setupVariants(){}setupOutgoingLight(){return this.lights===!0?ei(0):Qn.rgb}setupNormal(){return this.normalNode?ei(this.normalNode):xfe}setupEnvironment(){let e=null;return this.envNode?e=this.envNode:this.envMap&&(e=this.envMap.isCubeTexture?_d("envMap","cubeTexture"):_d("envMap","texture")),e}setupLightMap(e){let i=null;return e.material.lightMap&&(i=new sme(x8)),i}setupLights(e){const i=[],n=this.setupEnvironment(e);n&&n.isLightingNode&&i.push(n);const s=this.setupLightMap(e);if(s&&s.isLightingNode&&i.push(s),this.aoNode!==null||e.material.aoMap){const l=this.aoNode!==null?this.aoNode:jfe;i.push(new ime(l))}let o=this.lightsNode||e.lightsNode;return i.length>0&&(o=e.renderer.lighting.createNode([...o.getLights(),...i])),o}setupLightingModel(){}setupLighting(e){const{material:i}=e,{backdropNode:n,backdropAlphaNode:s,emissiveNode:o}=this,l=this.lights===!0||this.lightsNode!==null?this.setupLights(e):null;let u=this.setupOutgoingLight(e);if(l&&l.getScope().hasLights){const c=this.setupLightingModel(e);u=nme(l,c,n,s)}else n!==null&&(u=ei(s!==null?As(u,n,s):n));return(o&&o.isNode===!0||i.emissive&&i.emissive.isColor===!0)&&(N6.assign(ei(o||gfe)),u=u.add(N6)),u}setupOutput(e,i){if(this.fog===!0){const n=e.fogNode;n&&(i=Jr(n.mix(i.rgb,n.colorNode),i.a))}return i}setDefaultValues(e){for(const n in e){const s=e[n];this[n]===void 0&&(this[n]=s,s&&s.clone&&(this[n]=s.clone()))}const i=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(const n in i)Object.getOwnPropertyDescriptor(this.constructor.prototype,n)===void 0&&i[n].get!==void 0&&Object.defineProperty(this.constructor.prototype,n,i[n])}toJSON(e){const i=e===void 0||typeof e=="string";i&&(e={textures:{},images:{},nodes:{}});const n=Ho.prototype.toJSON.call(this,e),s=Y1(this);n.inputNodes={};for(const{property:l,childNode:u}of s)n.inputNodes[l]=u.toJSON(e).uuid;function o(l){const u=[];for(const c in l){const h=l[c];delete h.metadata,u.push(h)}return u}if(i){const l=o(e.textures),u=o(e.images),c=o(e.nodes);l.length>0&&(n.textures=l),u.length>0&&(n.images=u),c.length>0&&(n.nodes=c)}return n}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.positionNode=e.positionNode,this.geometryNode=e.geometryNode,this.depthNode=e.depthNode,this.shadowNode=e.shadowNode,this.shadowPositionNode=e.shadowPositionNode,this.outputNode=e.outputNode,this.mrtNode=e.mrtNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,super.copy(e)}}const pme=new S3;class fme extends oa{static get type(){return"LineBasicNodeMaterial"}constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.lights=!1,this.setDefaultValues(pme),this.setValues(e)}}const mme=new u6;class gme extends oa{static get type(){return"LineDashedNodeMaterial"}constructor(e){super(),this.isLineDashedNodeMaterial=!0,this.lights=!1,this.setDefaultValues(mme),this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setupVariants(){const e=this.offsetNode,i=this.dashScaleNode?ii(this.dashScaleNode):kfe,n=this.dashSizeNode?ii(this.dashSizeNode):Ffe,s=this.dashSizeNode?ii(this.dashGapNode):Ufe;W3.assign(n),k6.assign(s);const o=sh(ah("lineDistance").mul(i));(e?o.add(e):o).mod(W3.add(k6)).greaterThan(W3).discard()}}const Ame=r=>Ti(r).mul(.5).add(.5),yme=new o6;class vme extends oa{static get type(){return"MeshNormalNodeMaterial"}constructor(e){super(),this.lights=!1,this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(yme),this.setValues(e)}setupDiffuseColor(){const e=this.opacityNode?ii(this.opacityNode):v8;Qn.assign(Jr(Ame(sa),e))}}class bme extends ra{static get type(){return"EquirectUVNode"}constructor(e=c8){super("vec2"),this.dirNode=e}setup(){const e=this.dirNode,i=e.z.atan2(e.x).mul(1/(Math.PI*2)).add(.5),n=e.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return Ki(i,n)}}const D8=ci(bme);class N8 extends fhe{constructor(e=1,i={}){super(e,i),this.isCubeRenderTarget=!0}fromEquirectangularTexture(e,i){const n=i.minFilter,s=i.generateMipmaps;i.generateMipmaps=!0,this.texture.type=i.type,this.texture.colorSpace=i.colorSpace,this.texture.generateMipmaps=i.generateMipmaps,this.texture.minFilter=i.minFilter,this.texture.magFilter=i.magFilter;const o=new hy(5,5,5),l=D8(c8),u=new oa;u.colorNode=Us(i,l,0),u.side=mc,u.blending=$m;const c=new jp(o,u),h=new ZU;h.add(c),i.minFilter===Vu&&(i.minFilter=dl);const p=new JU(1,10,this),f=e.getMRT();return e.setMRT(null),p.update(e,h),e.setMRT(f),i.minFilter=n,i.currentGenerateMipmaps=s,c.geometry.dispose(),c.material.dispose(),this}}const Dy=new WeakMap;class xme extends ra{static get type(){return"CubeMapNode"}constructor(e){super("vec3"),this.envNode=e,this._cubeTexture=null,this._cubeTextureNode=wy();const i=new E3;i.isRenderTargetTexture=!0,this._defaultTexture=i,this.updateBeforeType=un.RENDER}updateBefore(e){const{renderer:i,material:n}=e,s=this.envNode;if(s.isTextureNode||s.isMaterialReferenceNode){const o=s.isTextureNode?s.value:n[s.property];if(o&&o.isTexture){const l=o.mapping;if(l===YA||l===KA){if(Dy.has(o)){const u=Dy.get(o);O8(u,o.mapping),this._cubeTexture=u}else{const u=o.image;if(_me(u)){const c=new N8(u.height);c.fromEquirectangularTexture(i,o),O8(c.texture,o.mapping),this._cubeTexture=c.texture,Dy.set(o,c.texture),o.addEventListener("dispose",P8)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(e){return this.updateBefore(e),this._cubeTextureNode}}function _me(r){return r==null?!1:r.height>0}function P8(r){const e=r.target;e.removeEventListener("dispose",P8);const i=Dy.get(e);i!==void 0&&(Dy.delete(e),i.dispose())}function O8(r,e){e===YA?r.mapping=Lp:e===KA&&(r.mapping=tg)}const k8=ci(xme);class hR extends Dg{static get type(){return"BasicEnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){e.context.environment=k8(this.envNode)}}class Eme extends Dg{static get type(){return"BasicLightMapNode"}constructor(e=null){super(),this.lightMapNode=e}setup(e){const i=ii(1/Math.PI);e.context.irradianceLightMap=this.lightMapNode.mul(i)}}class g_{start(){}finish(){}direct(){}directRectArea(){}indirect(){}ambientOcclusion(){}}class F8 extends g_{constructor(){super()}indirect(e,i,n){const s=e.ambientOcclusion,o=e.reflectedLight,l=n.context.irradianceLightMap;o.indirectDiffuse.assign(Jr(0)),l?o.indirectDiffuse.addAssign(l):o.indirectDiffuse.addAssign(Jr(1,1,1,0)),o.indirectDiffuse.mulAssign(s),o.indirectDiffuse.mulAssign(Qn.rgb)}finish(e,i,n){const s=n.material,o=e.outgoingLight,l=n.context.environment;if(l)switch(s.combine){case _1:o.rgb.assign(As(o.rgb,o.rgb.mul(l.rgb),m_.mul(nR)));break;case Kce:o.rgb.assign(As(o.rgb,l.rgb,m_.mul(nR)));break;case Jce:o.rgb.addAssign(l.rgb.mul(m_.mul(nR)));break;default:console.warn("THREE.BasicLightingModel: Unsupported .combine value:",s.combine);break}}}const wme=new k1;class Cme extends oa{static get type(){return"MeshBasicNodeMaterial"}constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.setDefaultValues(wme),this.setValues(e)}setupNormal(){return Cc}setupEnvironment(e){const i=super.setupEnvironment(e);return i?new hR(i):null}setupLightMap(e){let i=null;return e.material.lightMap&&(i=new Eme(x8)),i}setupOutgoingLight(){return Qn.rgb}setupLightingModel(){return new F8}}const Ny=Gi(({f0:r,f90:e,dotVH:i})=>{const n=i.mul(-5.55473).sub(6.98316).mul(i).exp2();return r.mul(n.oneMinus()).add(e.mul(n))}),Ng=Gi(r=>r.diffuseColor.mul(1/Math.PI)),Sme=()=>ii(.25),Tme=Gi(({dotNH:r})=>H3.mul(ii(.5)).add(1).mul(ii(1/Math.PI)).mul(r.pow(H3))),Mme=Gi(({lightDirection:r})=>{const e=r.add(Is).normalize(),i=sa.dot(e).clamp(),n=Is.dot(e).clamp(),s=Ny({f0:Al,f90:1,dotVH:n}),o=Sme(),l=Tme({dotNH:i});return s.mul(o).mul(l)});class U8 extends F8{constructor(e=!0){super(),this.specular=e}direct({lightDirection:e,lightColor:i,reflectedLight:n}){const s=sa.dot(e).clamp().mul(i);n.directDiffuse.addAssign(s.mul(Ng({diffuseColor:Qn.rgb}))),this.specular===!0&&n.directSpecular.addAssign(s.mul(Mme({lightDirection:e})).mul(m_))}indirect({ambientOcclusion:e,irradiance:i,reflectedLight:n}){n.indirectDiffuse.addAssign(i.mul(Ng({diffuseColor:Qn}))),n.indirectDiffuse.mulAssign(e)}}const Rme=new l6;class Ime extends oa{static get type(){return"MeshLambertNodeMaterial"}constructor(e){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(Rme),this.setValues(e)}setupEnvironment(e){const i=super.setupEnvironment(e);return i?new hR(i):null}setupLightingModel(){return new U8(!1)}}const Bme=new s6;class Lme extends oa{static get type(){return"MeshPhongNodeMaterial"}constructor(e){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(Bme),this.setValues(e)}setupEnvironment(e){const i=super.setupEnvironment(e);return i?new hR(i):null}setupLightingModel(){return new U8}setupVariants(){const e=(this.shininessNode?ii(this.shininessNode):mfe).max(1e-4);H3.assign(e);const i=this.specularNode||Afe;Al.assign(i)}copy(e){return this.shininessNode=e.shininessNode,this.specularNode=e.specularNode,super.copy(e)}}const Dme=Gi(r=>{if(r.geometry.hasAttribute("normal")===!1)return ii(0);const e=Cc.dFdx().abs().max(Cc.dFdy().abs());return e.x.max(e.y).max(e.z)}),z8=Gi(r=>{const{roughness:e}=r,i=Dme();let n=e.max(.0525);return n=n.add(i),n=n.min(1),n}),Nme=Gi(({alpha:r,dotNL:e,dotNV:i})=>{const n=r.pow2(),s=e.mul(n.add(n.oneMinus().mul(i.pow2())).sqrt()),o=i.mul(n.add(n.oneMinus().mul(e.pow2())).sqrt());return yd(.5,s.add(o).max(Pde))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),Pme=Gi(({alphaT:r,alphaB:e,dotTV:i,dotBV:n,dotTL:s,dotBL:o,dotNV:l,dotNL:u})=>{const c=u.mul(ei(r.mul(i),e.mul(n),l).length()),h=l.mul(ei(r.mul(s),e.mul(o),u).length());return yd(.5,c.add(h)).saturate()}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),Ome=Gi(({alpha:r,dotNH:e})=>{const i=r.pow2(),n=e.pow2().mul(i.oneMinus()).oneMinus();return i.div(n.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),kme=ii(1/Math.PI),Fme=Gi(({alphaT:r,alphaB:e,dotNH:i,dotTH:n,dotBH:s})=>{const o=r.mul(e),l=ei(e.mul(n),r.mul(s),o.mul(i)),u=l.dot(l),c=o.div(u);return kme.mul(o.mul(c.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),j8=Gi(r=>{const{lightDirection:e,f0:i,f90:n,roughness:s,f:o,USE_IRIDESCENCE:l,USE_ANISOTROPY:u}=r,c=r.normalView||sa,h=s.pow2(),p=e.add(Is).normalize(),f=c.dot(e).clamp(),g=c.dot(Is).clamp(),m=c.dot(p).clamp(),y=Is.dot(p).clamp();let b=Ny({f0:i,f90:n,dotVH:y}),v,_;if(R6(l)&&(b=V3.mix(b,o)),R6(u)){const T=s_.dot(e),E=s_.dot(Is),C=s_.dot(p),R=Bg.dot(e),B=Bg.dot(Is),I=Bg.dot(p);v=Pme({alphaT:G3,alphaB:h,dotTV:E,dotBV:B,dotTL:T,dotBL:R,dotNV:g,dotNL:f}),_=Fme({alphaT:G3,alphaB:h,dotNH:m,dotTH:C,dotBH:I})}else v=Nme({alpha:h,dotNL:f,dotNV:g}),_=Ome({alpha:h,dotNH:m});return b.mul(v).mul(_)}),V8=Gi(({roughness:r,dotNV:e})=>{const i=Jr(-1,-.0275,-.572,.022),n=Jr(1,.0425,1.04,-.04),s=r.mul(i).add(n),o=s.x.mul(s.x).min(e.mul(-9.28).exp2()).mul(s.x).add(s.y);return Ki(-1.04,1.04).mul(o).add(s.zw)}).setLayout({name:"DFGApprox",type:"vec2",inputs:[{name:"roughness",type:"float"},{name:"dotNV",type:"vec3"}]}),G8=Gi(r=>{const{dotNV:e,specularColor:i,specularF90:n,roughness:s}=r,o=V8({dotNV:e,roughness:s});return i.mul(o.x).add(n.mul(o.y))}),Ume=Gi(({f:r,f90:e,dotVH:i})=>{const n=i.oneMinus().saturate(),s=n.mul(n),o=n.mul(s,s).clamp(0,.9999);return r.sub(ei(e).mul(o)).div(o.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),zme=Gi(({roughness:r,dotNH:e})=>{const i=r.pow2(),n=ii(1).div(i),s=e.pow2().oneMinus().max(.0078125);return ii(2).add(n).mul(s.pow(n.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),jme=Gi(({dotNV:r,dotNL:e})=>ii(1).div(ii(4).mul(e.add(r).sub(e.mul(r))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),Vme=Gi(({lightDirection:r})=>{const e=r.add(Is).normalize(),i=sa.dot(r).clamp(),n=sa.dot(Is).clamp(),s=sa.dot(e).clamp(),o=zme({roughness:j3,dotNH:s}),l=jme({dotNV:n,dotNL:i});return Ig.mul(o).mul(l)}),Gme=Gi(({N:r,V:e,roughness:i})=>{const n=.0078125,s=r.dot(e).saturate(),o=Ki(i,s.oneMinus().sqrt());return o.assign(o.mul(.984375).add(n)),o}).setLayout({name:"LTC_Uv",type:"vec2",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"roughness",type:"float"}]}),Hme=Gi(({f:r})=>{const e=r.length();return Fl(e.mul(e).add(r.z).div(e.add(1)),0)}).setLayout({name:"LTC_ClippedSphereFormFactor",type:"float",inputs:[{name:"f",type:"vec3"}]}),A_=Gi(({v1:r,v2:e})=>{const i=r.dot(e),n=i.abs().toVar(),s=n.mul(.0145206).add(.4965155).mul(n).add(.8543985).toVar(),o=n.add(4.1616724).mul(n).add(3.417594).toVar(),l=s.div(o),u=i.greaterThan(0).select(l,Fl(i.mul(i).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(l));return r.cross(e).mul(u)}).setLayout({name:"LTC_EdgeVectorFormFactor",type:"vec3",inputs:[{name:"v1",type:"vec3"},{name:"v2",type:"vec3"}]}),H8=Gi(({N:r,V:e,P:i,mInv:n,p0:s,p1:o,p2:l,p3:u})=>{const c=o.sub(s).toVar(),h=u.sub(s).toVar(),p=c.cross(h),f=ei().toVar();return za(p.dot(i.sub(s)).greaterThanEqual(0),()=>{const g=e.sub(r.mul(e.dot(r))).normalize(),m=r.cross(g).negate(),y=n.mul(So(g,m,r).transpose()).toVar(),b=y.mul(s.sub(i)).normalize().toVar(),v=y.mul(o.sub(i)).normalize().toVar(),_=y.mul(l.sub(i)).normalize().toVar(),T=y.mul(u.sub(i)).normalize().toVar(),E=ei(0).toVar();E.addAssign(A_({v1:b,v2:v})),E.addAssign(A_({v1:v,v2:_})),E.addAssign(A_({v1:_,v2:T})),E.addAssign(A_({v1:T,v2:b})),f.assign(ei(Hme({f:E})))}),f}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"P",type:"vec3"},{name:"mInv",type:"mat3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),y_=1/6,W8=r=>vn(y_,vn(r,vn(r,r.negate().add(3)).sub(3)).add(1)),dR=r=>vn(y_,vn(r,vn(r,vn(3,r).sub(6))).add(4)),Q8=r=>vn(y_,vn(r,vn(r,vn(-3,r).add(3)).add(3)).add(1)),pR=r=>vn(y_,l_(r,3)),q8=r=>W8(r).add(dR(r)),X8=r=>Q8(r).add(pR(r)),Y8=r=>To(-1,dR(r).div(W8(r).add(dR(r)))),K8=r=>To(1,pR(r).div(Q8(r).add(pR(r)))),J8=(r,e,i)=>{const n=r.uvNode,s=vn(n,e.zw).add(.5),o=Wp(s),l=vd(s),u=q8(l.x),c=X8(l.x),h=Y8(l.x),p=K8(l.x),f=Y8(l.y),g=K8(l.y),m=Ki(o.x.add(h),o.y.add(f)).sub(.5).mul(e.xy),y=Ki(o.x.add(p),o.y.add(f)).sub(.5).mul(e.xy),b=Ki(o.x.add(h),o.y.add(g)).sub(.5).mul(e.xy),v=Ki(o.x.add(p),o.y.add(g)).sub(.5).mul(e.xy),_=q8(l.y).mul(To(u.mul(r.uv(m).level(i)),c.mul(r.uv(y).level(i)))),T=X8(l.y).mul(To(u.mul(r.uv(b).level(i)),c.mul(r.uv(v).level(i))));return _.add(T)},Wme=Gi(([r,e=ii(3)])=>{const i=Ki(r.size(Fs(e))),n=Ki(r.size(Fs(e.add(1)))),s=yd(1,i),o=yd(1,n),l=J8(r,Jr(s,i),Wp(e)),u=J8(r,Jr(o,n),X3(e));return vd(e).mix(l,u)}),Z8=Gi(([r,e,i,n,s])=>{const o=ei($6(e.negate(),Ay(r),yd(1,n))),l=ei(xd(s[0].xyz),xd(s[1].xyz),xd(s[2].xyz));return Ay(o).mul(i.mul(l))}).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),Qme=Gi(([r,e])=>r.mul(nh(e.mul(2).sub(2),0,1))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),qme=S8(),Xme=S8(),$8=Gi(([r,e,i],{material:n})=>{const s=(n.side==mc?qme:Xme).uv(r),o=rh(lR.x).mul(Qme(e,i));return Wme(s,o)}),e7=Gi(([r,e,i])=>(za(i.notEqual(0),()=>{const n=W6(e).negate().div(i);return H6(n.negate().mul(r))}),ei(1))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),Yme=Gi(([r,e,i,n,s,o,l,u,c,h,p,f,g,m,y])=>{let b,v;if(y){b=Jr().toVar(),v=ei().toVar();const R=p.sub(1).mul(y.mul(.025)),B=ei(p.sub(R),p,p.add(R));Xc({start:0,end:3},({i:I})=>{const N=B.element(I),D=Z8(r,e,f,N,u),P=l.add(D),k=h.mul(c.mul(Jr(P,1))),q=Ki(k.xy.div(k.w)).toVar();q.addAssign(1),q.divAssign(2),q.assign(Ki(q.x,q.y.oneMinus()));const V=$8(q,i,N);b.element(I).assign(V.element(I)),b.a.addAssign(V.a),v.element(I).assign(n.element(I).mul(e7(xd(D),g,m).element(I)))}),b.a.divAssign(3)}else{const R=Z8(r,e,f,p,u),B=l.add(R),I=h.mul(c.mul(Jr(B,1))),N=Ki(I.xy.div(I.w)).toVar();N.addAssign(1),N.divAssign(2),N.assign(Ki(N.x,N.y.oneMinus())),b=$8(N,i,p),v=n.mul(e7(xd(R),g,m))}const _=v.rgb.mul(b.rgb),T=r.dot(e).clamp(),E=ei(G8({dotNV:T,specularColor:s,specularF90:o,roughness:i})),C=v.r.add(v.g,v.b).div(3);return Jr(E.oneMinus().mul(_),b.a.oneMinus().mul(C).oneMinus())}),Kme=So(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),Jme=r=>{const e=r.sqrt();return ei(1).add(e).div(ei(1).sub(e))},t7=(r,e)=>r.sub(e).div(r.add(e)).pow2(),Zme=(r,e)=>{const i=r.mul(2*Math.PI*1e-9),n=ei(54856e-17,44201e-17,52481e-17),s=ei(1681e3,1795300,2208400),o=ei(43278e5,93046e5,66121e5),l=ii(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(i.mul(2239900).add(e.x).cos()).mul(i.pow2().mul(-45282e5).exp());let u=n.mul(o.mul(2*Math.PI).sqrt()).mul(s.mul(i).add(e).cos()).mul(i.pow2().negate().mul(o).exp());return u=ei(u.x.add(l),u.y,u.z).div(10685e-11),Kme.mul(u)},$me=Gi(({outsideIOR:r,eta2:e,cosTheta1:i,thinFilmThickness:n,baseF0:s})=>{const o=As(r,e,Qp(0,.03,n)),l=r.div(o).pow2().mul(i.pow2().oneMinus()).oneMinus();za(l.lessThan(0),()=>ei(1));const u=l.sqrt(),c=t7(o,r),h=Ny({f0:c,f90:1,dotVH:i}),p=h.oneMinus(),f=o.lessThan(r).select(Math.PI,0),g=ii(Math.PI).sub(f),m=Jme(s.clamp(0,.9999)),y=t7(m,o.toVec3()),b=Ny({f0:y,f90:1,dotVH:u}),v=ei(m.x.lessThan(o).select(Math.PI,0),m.y.lessThan(o).select(Math.PI,0),m.z.lessThan(o).select(Math.PI,0)),_=o.mul(n,u,2),T=ei(g).add(v),E=h.mul(b).clamp(1e-5,.9999),C=E.sqrt(),R=p.pow2().mul(b).div(ei(1).sub(E)),B=h.add(R).toVar(),I=R.sub(p).toVar();return Xc({start:1,end:2,condition:"<=",name:"m"},({m:N})=>{I.mulAssign(C);const D=Zme(ii(N).mul(_),ii(N).mul(T)).mul(2);B.addAssign(I.mul(D))}),B.max(ei(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),ege=Gi(({normal:r,viewDir:e,roughness:i})=>{const n=r.dot(e).saturate(),s=i.pow2(),o=Wo(i.lessThan(.25),ii(-339.2).mul(s).add(ii(161.4).mul(i)).sub(25.9),ii(-8.48).mul(s).add(ii(14.3).mul(i)).sub(9.95)),l=Wo(i.lessThan(.25),ii(44).mul(s).sub(ii(23.7).mul(i)).add(3.26),ii(1.97).mul(s).sub(ii(3.27).mul(i)).add(.72));return Wo(i.lessThan(.25),0,ii(.1).mul(i).sub(.025)).add(o.mul(n).add(l).exp()).mul(1/Math.PI).saturate()}),fR=ei(.04),mR=ii(1);class i7 extends g_{constructor(e=!1,i=!1,n=!1,s=!1,o=!1,l=!1){super(),this.clearcoat=e,this.sheen=i,this.iridescence=n,this.anisotropy=s,this.transmission=o,this.dispersion=l,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null}start(e){if(this.clearcoat===!0&&(this.clearcoatRadiance=ei().toVar("clearcoatRadiance"),this.clearcoatSpecularDirect=ei().toVar("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=ei().toVar("clearcoatSpecularIndirect")),this.sheen===!0&&(this.sheenSpecularDirect=ei().toVar("sheenSpecularDirect"),this.sheenSpecularIndirect=ei().toVar("sheenSpecularIndirect")),this.iridescence===!0){const i=sa.dot(Is).clamp();this.iridescenceFresnel=$me({outsideIOR:ii(1),eta2:P6,cosTheta1:i,thinFilmThickness:O6,baseF0:Al}),this.iridescenceF0=Ume({f:this.iridescenceFresnel,f90:1,dotVH:i})}if(this.transmission===!0){const i=$3,n=Vpe.sub($3).normalize(),s=eR;e.backdrop=Yme(s,n,ih,Qn,Al,a_,i,Yp,oh,d_,o_,F6,z6,U6,this.dispersion?j6:null),e.backdropAlpha=Q3,Qn.a.mulAssign(As(1,e.backdrop.a,Q3))}}computeMultiscattering(e,i,n){const s=sa.dot(Is).clamp(),o=V8({roughness:ih,dotNV:s}),l=(this.iridescenceF0?V3.mix(Al,this.iridescenceF0):Al).mul(o.x).add(n.mul(o.y)),u=o.x.add(o.y).oneMinus(),c=Al.add(Al.oneMinus().mul(.047619)),h=l.mul(c).div(u.mul(c).oneMinus());e.addAssign(l),i.addAssign(h.mul(u))}direct({lightDirection:e,lightColor:i,reflectedLight:n}){const s=sa.dot(e).clamp().mul(i);if(this.sheen===!0&&this.sheenSpecularDirect.addAssign(s.mul(Vme({lightDirection:e}))),this.clearcoat===!0){const o=Ey.dot(e).clamp().mul(i);this.clearcoatSpecularDirect.addAssign(o.mul(j8({lightDirection:e,f0:fR,f90:mR,roughness:n_,normalView:Ey})))}n.directDiffuse.addAssign(s.mul(Ng({diffuseColor:Qn.rgb}))),n.directSpecular.addAssign(s.mul(j8({lightDirection:e,f0:Al,f90:1,roughness:ih,iridescence:this.iridescence,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}directRectArea({lightColor:e,lightPosition:i,halfWidth:n,halfHeight:s,reflectedLight:o,ltc_1:l,ltc_2:u}){const c=i.add(n).sub(s),h=i.sub(n).sub(s),p=i.sub(n).add(s),f=i.add(n).add(s),g=sa,m=Is,y=Va.toVar(),b=Gme({N:g,V:m,roughness:ih}),v=l.uv(b).toVar(),_=u.uv(b).toVar(),T=So(ei(v.x,0,v.y),ei(0,1,0),ei(v.z,0,v.w)).toVar(),E=Al.mul(_.x).add(Al.oneMinus().mul(_.y)).toVar();o.directSpecular.addAssign(e.mul(E).mul(H8({N:g,V:m,P:y,mInv:T,p0:c,p1:h,p2:p,p3:f}))),o.directDiffuse.addAssign(e.mul(Qn).mul(H8({N:g,V:m,P:y,mInv:So(1,0,0,0,1,0,0,0,1),p0:c,p1:h,p2:p,p3:f})))}indirect(e,i,n){this.indirectDiffuse(e,i,n),this.indirectSpecular(e,i,n),this.ambientOcclusion(e,i,n)}indirectDiffuse({irradiance:e,reflectedLight:i}){i.indirectDiffuse.addAssign(e.mul(Ng({diffuseColor:Qn})))}indirectSpecular({radiance:e,iblIrradiance:i,reflectedLight:n}){if(this.sheen===!0&&this.sheenSpecularIndirect.addAssign(i.mul(Ig,ege({normal:sa,viewDir:Is,roughness:j3}))),this.clearcoat===!0){const h=Ey.dot(Is).clamp(),p=G8({dotNV:h,specularColor:fR,specularF90:mR,roughness:n_});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(p))}const s=ei().toVar("singleScattering"),o=ei().toVar("multiScattering"),l=i.mul(1/Math.PI);this.computeMultiscattering(s,o,a_);const u=s.add(o),c=Qn.mul(u.r.max(u.g).max(u.b).oneMinus());n.indirectSpecular.addAssign(e.mul(s)),n.indirectSpecular.addAssign(o.mul(l)),n.indirectDiffuse.addAssign(c.mul(l))}ambientOcclusion({ambientOcclusion:e,reflectedLight:i}){const n=sa.dot(Is).clamp().add(e),s=ih.mul(-16).oneMinus().negate().exp2(),o=e.sub(n.pow(s).oneMinus()).clamp();this.clearcoat===!0&&this.clearcoatSpecularIndirect.mulAssign(e),this.sheen===!0&&this.sheenSpecularIndirect.mulAssign(e),i.indirectDiffuse.mulAssign(e),i.indirectSpecular.mulAssign(o)}finish(e){const{outgoingLight:i}=e;if(this.clearcoat===!0){const n=Ey.dot(Is).clamp(),s=Ny({dotVH:n,f0:fR,f90:mR}),o=i.mul(z3.mul(s).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(z3));i.assign(o)}if(this.sheen===!0){const n=Ig.r.max(Ig.g).max(Ig.b).mul(.157).oneMinus(),s=i.mul(n).add(this.sheenSpecularDirect,this.sheenSpecularIndirect);i.assign(s)}}}const r7=ii(1),gR=ii(-2),v_=ii(.8),AR=ii(-1),b_=ii(.4),yR=ii(2),x_=ii(.305),vR=ii(3),n7=ii(.21),tge=ii(4),s7=ii(4),ige=ii(16),rge=Gi(([r])=>{const e=ei(Ec(r)).toVar(),i=ii(-1).toVar();return za(e.x.greaterThan(e.z),()=>{za(e.x.greaterThan(e.y),()=>{i.assign(Wo(r.x.greaterThan(0),0,3))}).Else(()=>{i.assign(Wo(r.y.greaterThan(0),1,4))})}).Else(()=>{za(e.z.greaterThan(e.y),()=>{i.assign(Wo(r.z.greaterThan(0),2,5))}).Else(()=>{i.assign(Wo(r.y.greaterThan(0),1,4))})}),i}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),nge=Gi(([r,e])=>{const i=Ki().toVar();return za(e.equal(0),()=>{i.assign(Ki(r.z,r.y).div(Ec(r.x)))}).ElseIf(e.equal(1),()=>{i.assign(Ki(r.x.negate(),r.z.negate()).div(Ec(r.y)))}).ElseIf(e.equal(2),()=>{i.assign(Ki(r.x.negate(),r.y).div(Ec(r.z)))}).ElseIf(e.equal(3),()=>{i.assign(Ki(r.z.negate(),r.y).div(Ec(r.x)))}).ElseIf(e.equal(4),()=>{i.assign(Ki(r.x.negate(),r.z).div(Ec(r.y)))}).Else(()=>{i.assign(Ki(r.x,r.y).div(Ec(r.z)))}),vn(.5,i.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),sge=Gi(([r])=>{const e=ii(0).toVar();return za(r.greaterThanEqual(v_),()=>{e.assign(r7.sub(r).mul(AR.sub(gR)).div(r7.sub(v_)).add(gR))}).ElseIf(r.greaterThanEqual(b_),()=>{e.assign(v_.sub(r).mul(yR.sub(AR)).div(v_.sub(b_)).add(AR))}).ElseIf(r.greaterThanEqual(x_),()=>{e.assign(b_.sub(r).mul(vR.sub(yR)).div(b_.sub(x_)).add(yR))}).ElseIf(r.greaterThanEqual(n7),()=>{e.assign(x_.sub(r).mul(tge.sub(vR)).div(x_.sub(n7)).add(vR))}).Else(()=>{e.assign(ii(-2).mul(rh(vn(1.16,r))))}),e}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),age=Gi(([r,e])=>{const i=r.toVar();i.assign(vn(2,i).sub(1));const n=ei(i,1).toVar();return za(e.equal(0),()=>{n.assign(n.zyx)}).ElseIf(e.equal(1),()=>{n.assign(n.xzy),n.xz.mulAssign(-1)}).ElseIf(e.equal(2),()=>{n.x.mulAssign(-1)}).ElseIf(e.equal(3),()=>{n.assign(n.zyx),n.xz.mulAssign(-1)}).ElseIf(e.equal(4),()=>{n.assign(n.xzy),n.xy.mulAssign(-1)}).ElseIf(e.equal(5),()=>{n.z.mulAssign(-1)}),n}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),oge=Gi(([r,e,i,n,s,o])=>{const l=ii(i),u=ei(e),c=nh(sge(l),gR,o),h=vd(c),p=Wp(c),f=ei(bR(r,u,p,n,s,o)).toVar();return za(h.notEqual(0),()=>{const g=ei(bR(r,u,p.add(1),n,s,o)).toVar();f.assign(As(f,g,h))}),f}),bR=Gi(([r,e,i,n,s,o])=>{const l=ii(i).toVar(),u=ei(e),c=ii(rge(u)).toVar(),h=ii(Fl(s7.sub(l),0)).toVar();l.assign(Fl(l,s7));const p=ii(gy(l)).toVar(),f=Ki(nge(u,c).mul(p.sub(2)).add(1)).toVar();return za(c.greaterThan(2),()=>{f.y.addAssign(p),c.subAssign(3)}),f.x.addAssign(c.mul(p)),f.x.addAssign(h.mul(vn(3,ige))),f.y.addAssign(vn(4,gy(o).sub(p))),f.x.mulAssign(n),f.y.mulAssign(s),r.uv(f).grad(Ki(),Ki())}),xR=Gi(({envMap:r,mipInt:e,outputDirection:i,theta:n,axis:s,CUBEUV_TEXEL_WIDTH:o,CUBEUV_TEXEL_HEIGHT:l,CUBEUV_MAX_MIP:u})=>{const c=bd(n),h=i.mul(c).add(s.cross(i).mul(_c(n))).add(s.mul(s.dot(i).mul(c.oneMinus())));return bR(r,h,e,o,l,u)}),lge=Gi(({n:r,latitudinal:e,poleAxis:i,outputDirection:n,weights:s,samples:o,dTheta:l,mipInt:u,envMap:c,CUBEUV_TEXEL_WIDTH:h,CUBEUV_TEXEL_HEIGHT:p,CUBEUV_MAX_MIP:f})=>{const g=ei(Wo(e,i,J6(i,n))).toVar();za(G6(g.equals(ei(0))),()=>{g.assign(ei(n.z,0,n.x.negate()))}),g.assign(Ay(g));const m=ei().toVar();return m.addAssign(s.element(Fs(0)).mul(xR({theta:0,axis:g,outputDirection:n,mipInt:u,envMap:c,CUBEUV_TEXEL_WIDTH:h,CUBEUV_TEXEL_HEIGHT:p,CUBEUV_MAX_MIP:f}))),Xc({start:Fs(1),end:r},({i:y})=>{za(y.greaterThanEqual(o),()=>{Zfe()});const b=ii(l.mul(ii(y))).toVar();m.addAssign(s.element(y).mul(xR({theta:b.mul(-1),axis:g,outputDirection:n,mipInt:u,envMap:c,CUBEUV_TEXEL_WIDTH:h,CUBEUV_TEXEL_HEIGHT:p,CUBEUV_MAX_MIP:f}))),m.addAssign(s.element(y).mul(xR({theta:b,axis:g,outputDirection:n,mipInt:u,envMap:c,CUBEUV_TEXEL_WIDTH:h,CUBEUV_TEXEL_HEIGHT:p,CUBEUV_MAX_MIP:f})))}),Jr(m,1)});let __=null;const a7=new WeakMap;function cge(r){const e=Math.log2(r)-2,i=1/r;return{texelWidth:1/(3*Math.max(Math.pow(2,e),7*16)),texelHeight:i,maxMip:e}}function uge(r){let e=a7.get(r);if((e!==void 0?e.pmremVersion:-1)!==r.pmremVersion){const i=r.image;if(r.isCubeTexture)if(dge(i))e=__.fromCubemap(r,e);else return null;else if(pge(i))e=__.fromEquirectangular(r,e);else return null;e.pmremVersion=r.pmremVersion,a7.set(r,e)}return e.texture}class hge extends ra{static get type(){return"PMREMNode"}constructor(e,i=null,n=null){super("vec3"),this._value=e,this._pmrem=null,this.uvNode=i,this.levelNode=n,this._generator=null;const s=new wo;s.isRenderTargetTexture=!0,this._texture=Us(s),this._width=Zr(0),this._height=Zr(0),this._maxMip=Zr(0),this.updateBeforeType=un.RENDER}set value(e){this._value=e,this._pmrem=null}get value(){return this._value}updateFromTexture(e){const i=cge(e.image.height);this._texture.value=e,this._width.value=i.texelWidth,this._height.value=i.texelHeight,this._maxMip.value=i.maxMip}updateBefore(){let e=this._pmrem;const i=e?e.pmremVersion:-1,n=this._value;i!==n.pmremVersion&&(n.isPMREMTexture===!0?e=n:e=uge(n),e!==null&&(this._pmrem=e,this.updateFromTexture(e)))}setup(e){__===null&&(__=e.createPMREMGenerator()),this.updateBefore(e);let i=this.uvNode;i===null&&e.context.getUV&&(i=e.context.getUV(this));const n=this.value;e.renderer.coordinateSystem===gc&&n.isPMREMTexture!==!0&&n.isRenderTargetTexture===!0&&(i=ei(i.x.negate(),i.yz));let s=this.levelNode;return s===null&&e.context.getTextureLevel&&(s=e.context.getTextureLevel(this)),oge(this._texture,i,s,this._width,this._height,this._maxMip)}}function dge(r){if(r==null)return!1;let e=0;const i=6;for(let n=0;n<i;n++)r[n]!==void 0&&e++;return e===i}function pge(r){return r==null?!1:r.height>0}const o7=ci(hge),l7=new WeakMap;class fge extends Dg{static get type(){return"EnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){const{material:i}=e;let n=this.envNode;if(n.isTextureNode||n.isMaterialReferenceNode){const f=n.isTextureNode?n.value:i[n.property];let g=l7.get(f);g===void 0&&(g=o7(f),l7.set(f,g)),n=g}const s=i.envMap?Bs("envMapIntensity","float",e.material):Bs("environmentIntensity","float",e.scene),o=i.useAnisotropy===!0||i.anisotropy>0?afe:sa,l=n.context(c7(ih,o)).mul(s),u=n.context(mge(eR)).mul(Math.PI).mul(s),c=u_(l),h=u_(u);e.context.radiance.addAssign(c),e.context.iblIrradiance.addAssign(h);const p=e.context.lightingModel.clearcoatRadiance;if(p){const f=n.context(c7(n_,Ey)).mul(s),g=u_(f);p.addAssign(g)}}}const c7=(r,e)=>{let i=null;return{getUV:()=>(i===null&&(i=Is.negate().reflect(e),i=r.mul(r).mix(i,e).normalize(),i=i.transformDirection(oh)),i),getTextureLevel:()=>r}},mge=r=>({getUV:()=>r,getTextureLevel:()=>ii(1)}),gge=new M3;class u7 extends oa{static get type(){return"MeshStandardNodeMaterial"}constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.lights=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(gge),this.setValues(e)}setupEnvironment(e){let i=super.setupEnvironment(e);return i===null&&e.environmentNode&&(i=e.environmentNode),i?new fge(i):null}setupLightingModel(){return new i7}setupSpecular(){const e=As(ei(.04),Qn.rgb,r_);Al.assign(e),a_.assign(1)}setupVariants(){const e=this.metalnessNode?ii(this.metalnessNode):bfe;r_.assign(e);let i=this.roughnessNode?ii(this.roughnessNode):vfe;i=z8({roughness:i}),ih.assign(i),this.setupSpecular(),Qn.assign(Jr(Qn.rgb.mul(e.oneMinus()),Qn.a))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}}const Age=new n6;class yge extends u7{static get type(){return"MeshPhysicalNodeMaterial"}constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(Age),this.setValues(e)}get useClearcoat(){return this.clearcoat>0||this.clearcoatNode!==null}get useIridescence(){return this.iridescence>0||this.iridescenceNode!==null}get useSheen(){return this.sheen>0||this.sheenNode!==null}get useAnisotropy(){return this.anisotropy>0||this.anisotropyNode!==null}get useTransmission(){return this.transmission>0||this.transmissionNode!==null}get useDispersion(){return this.dispersion>0||this.dispersionNode!==null}setupSpecular(){const e=this.iorNode?ii(this.iorNode):Nfe;o_.assign(e),Al.assign(As(yy(Z6(o_.sub(1).div(o_.add(1))).mul(yfe),ei(1)).mul(b8),Qn.rgb,r_)),a_.assign(As(b8,1,r_))}setupLightingModel(){return new i7(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(e){if(super.setupVariants(e),this.useClearcoat){const i=this.clearcoatNode?ii(this.clearcoatNode):_fe,n=this.clearcoatRoughnessNode?ii(this.clearcoatRoughnessNode):Efe;z3.assign(i),n_.assign(z8({roughness:n}))}if(this.useSheen){const i=this.sheenNode?ei(this.sheenNode):Sfe,n=this.sheenRoughnessNode?ii(this.sheenRoughnessNode):Tfe;Ig.assign(i),j3.assign(n)}if(this.useIridescence){const i=this.iridescenceNode?ii(this.iridescenceNode):Rfe,n=this.iridescenceIORNode?ii(this.iridescenceIORNode):Ife,s=this.iridescenceThicknessNode?ii(this.iridescenceThicknessNode):Bfe;V3.assign(i),P6.assign(n),O6.assign(s)}if(this.useAnisotropy){const i=(this.anisotropyNode?Ki(this.anisotropyNode):Mfe).toVar();Hp.assign(i.length()),za(Hp.equal(0),()=>{i.assign(Ki(1,0))}).Else(()=>{i.divAssign(Ki(Hp)),Hp.assign(Hp.saturate())}),G3.assign(Hp.pow2().mix(ih.pow2(),1)),s_.assign(Sy[0].mul(i.x).add(Sy[1].mul(i.y))),Bg.assign(Sy[1].mul(i.x).sub(Sy[0].mul(i.y)))}if(this.useTransmission){const i=this.transmissionNode?ii(this.transmissionNode):Lfe,n=this.thicknessNode?ii(this.thicknessNode):Dfe,s=this.attenuationDistanceNode?ii(this.attenuationDistanceNode):Pfe,o=this.attenuationColorNode?ei(this.attenuationColorNode):Ofe;if(Q3.assign(i),F6.assign(n),U6.assign(s),z6.assign(o),this.useDispersion){const l=this.dispersionNode?ii(this.dispersionNode):zfe;j6.assign(l)}}}setupClearcoatNormal(){return this.clearcoatNormalNode?ei(this.clearcoatNormalNode):wfe}setup(e){e.context.setupClearcoatNormal=()=>this.setupClearcoatNormal(e),super.setup(e)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,this.dispersionNode=e.dispersionNode,this.anisotropyNode=e.anisotropyNode,super.copy(e)}}const vge=Gi(({normal:r,lightDirection:e,builder:i})=>{const n=r.dot(e),s=Ki(n.mul(.5).add(.5),0);if(i.material.gradientMap){const o=_d("gradientMap","texture").context({getUV:()=>s});return ei(o.r)}else{const o=s.fwidth().mul(.5);return As(ei(.7),ei(1),Qp(ii(.7).sub(o.x),ii(.7).add(o.x),s.x))}});class bge extends g_{direct({lightDirection:e,lightColor:i,reflectedLight:n},s,o){const l=vge({normal:u8,lightDirection:e,builder:o}).mul(i);n.directDiffuse.addAssign(l.mul(Ng({diffuseColor:Qn.rgb})))}indirect({ambientOcclusion:e,irradiance:i,reflectedLight:n}){n.indirectDiffuse.addAssign(i.mul(Ng({diffuseColor:Qn}))),n.indirectDiffuse.mulAssign(e)}}const xge=new a6;class _ge extends oa{static get type(){return"MeshToonNodeMaterial"}constructor(e){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues(xge),this.setValues(e)}setupLightingModel(){return new bge}}class Ege extends ra{static get type(){return"MatcapUVNode"}constructor(){super("vec2")}setup(){const e=ei(Is.z,0,Is.x.negate()).normalize(),i=Is.cross(e);return Ki(e.dot(sa),i.dot(sa)).mul(.495).add(.5)}}const wge=Yi(Ege),Cge=new c6;class Sge extends oa{static get type(){return"MeshMatcapNodeMaterial"}constructor(e){super(),this.lights=!1,this.isMeshMatcapNodeMaterial=!0,this.setDefaultValues(Cge),this.setValues(e)}setupVariants(e){const i=wge;let n;e.material.matcap?n=_d("matcap","texture").context({getUV:()=>i}):n=ei(As(.2,.8,i.y)),Qn.rgb.mulAssign(n.rgb)}}const Tge=new i6;class Mge extends oa{static get type(){return"PointsNodeMaterial"}constructor(e){super(),this.isPointsNodeMaterial=!0,this.lights=!1,this.transparent=!0,this.sizeNode=null,this.setDefaultValues(Tge),this.setValues(e)}copy(e){return this.sizeNode=e.sizeNode,super.copy(e)}}class Rge extends ra{static get type(){return"RotateNode"}constructor(e,i){super(),this.positionNode=e,this.rotationNode=i}getNodeType(e){return this.positionNode.getNodeType(e)}setup(e){const{rotationNode:i,positionNode:n}=this;if(this.getNodeType(e)==="vec2"){const s=i.cos(),o=i.sin();return U3(s,o,o.negate(),s).mul(n)}else{const s=i,o=Mg(Jr(1,0,0,0),Jr(0,bd(s.x),_c(s.x).negate(),0),Jr(0,_c(s.x),bd(s.x),0),Jr(0,0,0,1)),l=Mg(Jr(bd(s.y),0,_c(s.y),0),Jr(0,1,0,0),Jr(_c(s.y).negate(),0,bd(s.y),0),Jr(0,0,0,1)),u=Mg(Jr(bd(s.z),_c(s.z).negate(),0,0),Jr(_c(s.z),bd(s.z),0,0),Jr(0,0,1,0),Jr(0,0,0,1));return o.mul(l).mul(u).mul(Jr(n,1)).xyz}}}const Ige=ci(Rge),Bge=new e6;class Lge extends oa{static get type(){return"SpriteNodeMaterial"}constructor(e){super(),this.isSpriteNodeMaterial=!0,this.lights=!1,this._useSizeAttenuation=!0,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.setDefaultValues(Bge),this.setValues(e)}setupPosition({object:e,camera:i,context:n}){const s=this.sizeAttenuation,{positionNode:o,rotationNode:l,scaleNode:u}=this,c=ja;let h=p_.mul(ei(o||0)),p=Ki(Yp[0].xyz.length(),Yp[1].xyz.length());if(u!==null&&(p=p.mul(u)),!s)if(i.isPerspectiveCamera)p=p.mul(h.z.negate());else{const b=ii(2).div(d_.element(1).element(1));p=p.mul(b.mul(2))}let f=c.xy;if(e.center&&e.center.isVector2===!0){const b=Epe("center","vec2");f=f.sub(b.sub(.5))}f=f.mul(p);const g=ii(l||Cfe),m=Ige(f,g);h=Jr(h.xy.add(m),h.zw);const y=d_.mul(h);return n.vertex=c,y}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}get sizeAttenuation(){return this._useSizeAttenuation}set sizeAttenuation(e){this._useSizeAttenuation!==e&&(this._useSizeAttenuation=e,this.needsUpdate=!0)}}class Dge extends g_{constructor(){super(),this.shadowNode=ii(1).toVar("shadowMask")}direct({shadowMask:e}){this.shadowNode.mulAssign(e)}finish(e){Qn.a.mulAssign(this.shadowNode.oneMinus()),e.outgoingLight.rgb.assign(Qn.rgb)}}const Nge=new r6;class Pge extends oa{static get type(){return"ShadowNodeMaterial"}constructor(e){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.setDefaultValues(Nge),this.setValues(e)}setupLightingModel(){return new Dge}}Gi(({texture:r,uv:e})=>{const i=ei().toVar();return za(e.x.lessThan(1e-4),()=>{i.assign(ei(1,0,0))}).ElseIf(e.y.lessThan(1e-4),()=>{i.assign(ei(0,1,0))}).ElseIf(e.z.lessThan(1e-4),()=>{i.assign(ei(0,0,1))}).ElseIf(e.x.greaterThan(1-1e-4),()=>{i.assign(ei(-1,0,0))}).ElseIf(e.y.greaterThan(1-1e-4),()=>{i.assign(ei(0,-1,0))}).ElseIf(e.z.greaterThan(1-1e-4),()=>{i.assign(ei(0,0,-1))}).Else(()=>{const n=r.uv(e.add(ei(-.01,0,0))).r.sub(r.uv(e.add(ei(.01,0,0))).r),s=r.uv(e.add(ei(0,-.01,0))).r.sub(r.uv(e.add(ei(0,.01,0))).r),o=r.uv(e.add(ei(0,0,-.01))).r.sub(r.uv(e.add(ei(0,0,.01))).r);i.assign(ei(n,s,o))}),i.normalize()});class Oge{constructor(e,i){this.nodes=e,this.info=i,this.animationLoop=null,this.requestId=null,this._init()}_init(){const e=(i,n)=>{this.requestId=self.requestAnimationFrame(e),this.info.autoReset===!0&&this.info.reset(),this.nodes.nodeFrame.update(),this.info.frame=this.nodes.nodeFrame.frameId,this.animationLoop!==null&&this.animationLoop(i,n)};e()}dispose(){self.cancelAnimationFrame(this.requestId),this.requestId=null}setAnimationLoop(e){this.animationLoop=e}}class Yc{constructor(){this.weakMap=new WeakMap}get(e){let i=this.weakMap;for(let n=0;n<e.length;n++)if(i=i.get(e[n]),i===void 0)return;return i.get(e[e.length-1])}set(e,i){let n=this.weakMap;for(let s=0;s<e.length;s++){const o=e[s];n.has(o)===!1&&n.set(o,new WeakMap),n=n.get(o)}return n.set(e[e.length-1],i)}delete(e){let i=this.weakMap;for(let n=0;n<e.length;n++)if(i=i.get(e[n]),i===void 0)return!1;return i.delete(e[e.length-1])}}const _R=new Ad;class ER{constructor(){this.version=0,this.globalClippingCount=0,this.localClippingCount=0,this.localClippingEnabled=!1,this.localClipIntersection=!1,this.planes=[],this.parentVersion=0,this.viewNormalMatrix=new Go,this.cacheKey=0}projectPlanes(e,i){const n=e.length,s=this.planes;for(let o=0;o<n;o++){_R.copy(e[o]).applyMatrix4(this.viewMatrix,this.viewNormalMatrix);const l=s[i+o],u=_R.normal;l.x=-u.x,l.y=-u.y,l.z=-u.z,l.w=_R.constant}}updateGlobal(e,i){const n=e.clippingPlanes;this.viewMatrix=i.matrixWorldInverse,this.viewNormalMatrix.getNormalMatrix(this.viewMatrix);let s=!1;if(Array.isArray(n)&&n.length!==0){const o=n.length;if(o!==this.globalClippingCount){const l=[];for(let u=0;u<o;u++)l.push(new Jn);this.globalClippingCount=o,this.planes=l,s=!0}this.projectPlanes(n,0)}else this.globalClippingCount!==0&&(this.globalClippingCount=0,this.planes=[],s=!0);e.localClippingEnabled!==this.localClippingEnabled&&(this.localClippingEnabled=e.localClippingEnabled,s=!0),s&&(this.version++,this.cacheKey=X1(this.globalClippingCount,this.localClippingEnabled===!0?1:0))}update(e,i){let n=!1;if(this!==e&&e.version!==this.parentVersion&&(this.globalClippingCount=i.isShadowNodeMaterial?0:e.globalClippingCount,this.localClippingEnabled=e.localClippingEnabled,this.planes=Array.from(e.planes),this.parentVersion=e.version,this.viewMatrix=e.viewMatrix,this.viewNormalMatrix=e.viewNormalMatrix,n=!0),this.localClippingEnabled){const s=i.clippingPlanes;if(Array.isArray(s)&&s.length!==0){const o=s.length,l=this.planes,u=this.globalClippingCount;if(n||o!==this.localClippingCount){l.length=u+o;for(let c=0;c<o;c++)l[u+c]=new Jn;this.localClippingCount=o,n=!0}this.projectPlanes(s,u)}else this.localClippingCount!==0&&(this.localClippingCount=0,n=!0);this.localClipIntersection!==i.clipIntersection&&(this.localClipIntersection=i.clipIntersection,n=!0)}n&&(this.version+=e.version,this.cacheKey=X1(e.cacheKey,this.localClippingCount,this.localClipIntersection===!0?1:0))}}let kge=0;function Fge(r){const e=Object.keys(r);let i=Object.getPrototypeOf(r);for(;i;){const n=Object.getOwnPropertyDescriptors(i);for(const s in n)if(n[s]!==void 0){const o=n[s];o&&typeof o.get=="function"&&e.push(s)}i=Object.getPrototypeOf(i)}return e}class Uge{constructor(e,i,n,s,o,l,u,c,h){this._nodes=e,this._geometries=i,this.id=kge++,this.renderer=n,this.object=s,this.material=o,this.scene=l,this.camera=u,this.lightsNode=c,this.context=h,this.geometry=s.geometry,this.version=o.version,this.drawRange=null,this.attributes=null,this.pipeline=null,this.vertexBuffers=null,this.drawParams=null,this.bundle=null,this.updateClipping(h.clippingContext),this.clippingContextVersion=this.clippingContext.version,this.initialNodesCacheKey=this.getDynamicCacheKey(),this.initialCacheKey=this.getCacheKey(),this._nodeBuilderState=null,this._bindings=null,this._monitor=null,this.onDispose=null,this.isRenderObject=!0,this.onMaterialDispose=()=>{this.dispose()},this.material.addEventListener("dispose",this.onMaterialDispose)}updateClipping(e){const i=this.material;let n=this.clippingContext;Array.isArray(i.clippingPlanes)?((n===e||!n)&&(n=new ER,this.clippingContext=n),n.update(e,i)):this.clippingContext!==e&&(this.clippingContext=e)}get clippingNeedsUpdate(){return this.clippingContext.version===this.clippingContextVersion?!1:(this.clippingContextVersion=this.clippingContext.version,!0)}getNodeBuilderState(){return this._nodeBuilderState||(this._nodeBuilderState=this._nodes.getForRender(this))}getMonitor(){return this._monitor||(this._monitor=this.getNodeBuilderState().monitor)}getBindings(){return this._bindings||(this._bindings=this.getNodeBuilderState().createBindings())}getIndex(){return this._geometries.getIndex(this)}getIndirect(){return this._geometries.getIndirect(this)}getChainArray(){return[this.object,this.material,this.context,this.lightsNode]}getAttributes(){if(this.attributes!==null)return this.attributes;const e=this.getNodeBuilderState().nodeAttributes,i=this.geometry,n=[],s=new Set;for(const o of e){const l=o.node&&o.node.attribute?o.node.attribute:i.getAttribute(o.name);if(l===void 0)continue;n.push(l);const u=l.isInterleavedBufferAttribute?l.data:l;s.add(u)}return this.attributes=n,this.vertexBuffers=Array.from(s.values()),n}getVertexBuffers(){return this.vertexBuffers===null&&this.getAttributes(),this.vertexBuffers}getDrawParameters(){const{object:e,material:i,geometry:n,group:s,drawRange:o}=this,l=this.drawParams||(this.drawParams={vertexCount:0,firstVertex:0,instanceCount:0,firstInstance:0}),u=this.getIndex(),c=u!==null,h=n.isInstancedBufferGeometry?n.instanceCount:e.count>1?e.count:1;if(h===0)return null;if(l.instanceCount=h,e.isBatchedMesh===!0)return l;let p=1;i.wireframe===!0&&!e.isPoints&&!e.isLineSegments&&!e.isLine&&!e.isLineLoop&&(p=2);let f=o.start*p,g=(o.start+o.count)*p;s!==null&&(f=Math.max(f,s.start*p),g=Math.min(g,(s.start+s.count)*p));const m=n.attributes.position;let y=1/0;c?y=u.count:m!=null&&(y=m.count),f=Math.max(f,0),g=Math.min(g,y);const b=g-f;return b<0||b===1/0?null:(l.vertexCount=b,l.firstVertex=f,l)}getGeometryCacheKey(){const{geometry:e}=this;let i="";for(const n of Object.keys(e.attributes).sort()){const s=e.attributes[n];i+=n+",",s.data&&(i+=s.data.stride+","),s.offset&&(i+=s.offset+","),s.itemSize&&(i+=s.itemSize+","),s.normalized&&(i+="n,")}return e.index&&(i+="index,"),i}getMaterialCacheKey(){const{object:e,material:i}=this;let n=i.customProgramCacheKey();for(const s of Fge(i)){if(/^(is[A-Z]|_)|^(visible|version|uuid|name|opacity|userData)$/.test(s))continue;const o=i[s];let l;if(o!==null){const u=typeof o;u==="number"?l=o!==0?"1":"0":u==="object"?(l="{",o.isTexture&&(l+=o.mapping),l+="}"):l=String(o)}else l=String(o);n+=l+","}return n+=this.clippingContext.cacheKey+",",e.geometry&&(n+=this.getGeometryCacheKey()),e.skeleton&&(n+=e.skeleton.bones.length+","),e.morphTargetInfluences&&(n+=e.morphTargetInfluences.length+","),e.isBatchedMesh&&(n+=e._matricesTexture.uuid+",",e._colorsTexture!==null&&(n+=e._colorsTexture.uuid+",")),e.count>1&&(n+=e.uuid+","),Dhe(n)}get needsUpdate(){return this.initialNodesCacheKey!==this.getDynamicCacheKey()||this.clippingNeedsUpdate}getDynamicCacheKey(){let e=this._nodes.getCacheKey(this.scene,this.lightsNode);return this.object.receiveShadow&&(e+=1),e}getCacheKey(){return this.getMaterialCacheKey()+this.getDynamicCacheKey()}dispose(){this.material.removeEventListener("dispose",this.onMaterialDispose),this.onDispose()}}const Pg=[];class zge{constructor(e,i,n,s,o,l){this.renderer=e,this.nodes=i,this.geometries=n,this.pipelines=s,this.bindings=o,this.info=l,this.chainMaps={}}get(e,i,n,s,o,l,u){const c=this.getChainMap(u);Pg[0]=e,Pg[1]=i,Pg[2]=l,Pg[3]=o;let h=c.get(Pg);return h===void 0?(h=this.createRenderObject(this.nodes,this.geometries,this.renderer,e,i,n,s,o,l,u),c.set(Pg,h)):(h.updateClipping(l.clippingContext),(h.version!==i.version||h.needsUpdate)&&(h.initialCacheKey!==h.getCacheKey()?(h.dispose(),h=this.get(e,i,n,s,o,l,u)):h.version=i.version)),h}getChainMap(e="default"){return this.chainMaps[e]||(this.chainMaps[e]=new Yc)}dispose(){this.chainMaps={}}createRenderObject(e,i,n,s,o,l,u,c,h,p){const f=this.getChainMap(p),g=new Uge(e,i,n,s,o,l,u,c,h);return g.onDispose=()=>{this.pipelines.delete(g),this.bindings.delete(g),this.nodes.delete(g),f.delete(g.getChainArray())},g}}class wd{constructor(){this.data=new WeakMap}get(e){let i=this.data.get(e);return i===void 0&&(i={},this.data.set(e,i)),i}delete(e){let i;return this.data.has(e)&&(i=this.data.get(e),this.data.delete(e)),i}has(e){return this.data.has(e)}dispose(){this.data=new WeakMap}}const Kc={VERTEX:1,INDEX:2,STORAGE:3,INDIRECT:4},Cd=16,jge=211,Vge=212;class Gge extends wd{constructor(e){super(),this.backend=e}delete(e){const i=super.delete(e);return i!==void 0&&this.backend.destroyAttribute(e),i}update(e,i){const n=this.get(e);if(n.version===void 0)i===Kc.VERTEX?this.backend.createAttribute(e):i===Kc.INDEX?this.backend.createIndexAttribute(e):i===Kc.STORAGE?this.backend.createStorageAttribute(e):i===Kc.INDIRECT&&this.backend.createIndirectStorageAttribute(e),n.version=this._getBufferAttribute(e).version;else{const s=this._getBufferAttribute(e);(n.version<s.version||s.usage===og)&&(this.backend.updateAttribute(e),n.version=s.version)}}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}function Hge(r){for(let e=r.length-1;e>=0;--e)if(r[e]>=65535)return!0;return!1}function h7(r){return r.index!==null?r.index.version:r.attributes.position.version}function d7(r){const e=[],i=r.index,n=r.attributes.position;if(i!==null){const o=i.array;for(let l=0,u=o.length;l<u;l+=3){const c=o[l+0],h=o[l+1],p=o[l+2];e.push(c,h,h,p,p,c)}}else{const o=n.array;for(let l=0,u=o.length/3-1;l<u;l+=3){const c=l+0,h=l+1,p=l+2;e.push(c,h,h,p,p,c)}}const s=new(Hge(e)?VU:jU)(e,1);return s.version=h7(r),s}class Wge extends wd{constructor(e,i){super(),this.attributes=e,this.info=i,this.wireframes=new WeakMap,this.attributeCall=new WeakMap}has(e){const i=e.geometry;return super.has(i)&&this.get(i).initialized===!0}updateForRender(e){this.has(e)===!1&&this.initGeometry(e),this.updateAttributes(e)}initGeometry(e){const i=e.geometry,n=this.get(i);n.initialized=!0,this.info.memory.geometries++;const s=()=>{this.info.memory.geometries--;const o=i.index,l=e.getAttributes();o!==null&&this.attributes.delete(o);for(const c of l)this.attributes.delete(c);const u=this.wireframes.get(i);u!==void 0&&this.attributes.delete(u),i.removeEventListener("dispose",s)};i.addEventListener("dispose",s)}updateAttributes(e){const i=e.getAttributes();for(const o of i)o.isStorageBufferAttribute||o.isStorageInstancedBufferAttribute?this.updateAttribute(o,Kc.STORAGE):this.updateAttribute(o,Kc.VERTEX);const n=this.getIndex(e);n!==null&&this.updateAttribute(n,Kc.INDEX);const s=e.geometry.indirect;s!==null&&this.updateAttribute(s,Kc.INDIRECT)}updateAttribute(e,i){const n=this.info.render.calls;e.isInterleavedBufferAttribute?this.attributeCall.get(e)===void 0?(this.attributes.update(e,i),this.attributeCall.set(e,n)):this.attributeCall.get(e.data)!==n&&(this.attributes.update(e,i),this.attributeCall.set(e.data,n),this.attributeCall.set(e,n)):this.attributeCall.get(e)!==n&&(this.attributes.update(e,i),this.attributeCall.set(e,n))}getIndirect(e){return e.geometry.indirect}getIndex(e){const{geometry:i,material:n}=e;let s=i.index;if(n.wireframe===!0){const o=this.wireframes;let l=o.get(i);l===void 0?(l=d7(i),o.set(i,l)):l.version!==h7(i)&&(this.attributes.delete(l),l=d7(i),o.set(i,l)),s=l}return s}}class Qge{constructor(){this.autoReset=!0,this.frame=0,this.calls=0,this.render={calls:0,frameCalls:0,drawCalls:0,triangles:0,points:0,lines:0,timestamp:0,previousFrameCalls:0,timestampCalls:0},this.compute={calls:0,frameCalls:0,timestamp:0,previousFrameCalls:0,timestampCalls:0},this.memory={geometries:0,textures:0}}update(e,i,n){this.render.drawCalls++,e.isMesh||e.isSprite?this.render.triangles+=n*(i/3):e.isPoints?this.render.points+=n*i:e.isLineSegments?this.render.lines+=n*(i/2):e.isLine?this.render.lines+=n*(i-1):console.error("THREE.WebGPUInfo: Unknown object type.")}updateTimestamp(e,i){this[e].timestampCalls===0&&(this[e].timestamp=0),this[e].timestamp+=i,this[e].timestampCalls++,this[e].timestampCalls>=this[e].previousFrameCalls&&(this[e].timestampCalls=0)}reset(){const e=this.render.frameCalls;this.render.previousFrameCalls=e;const i=this.compute.frameCalls;this.compute.previousFrameCalls=i,this.render.drawCalls=0,this.render.frameCalls=0,this.compute.frameCalls=0,this.render.triangles=0,this.render.points=0,this.render.lines=0}dispose(){this.reset(),this.calls=0,this.render.calls=0,this.compute.calls=0,this.render.timestamp=0,this.compute.timestamp=0,this.memory.geometries=0,this.memory.textures=0}}class p7{constructor(e){this.cacheKey=e,this.usedTimes=0}}class qge extends p7{constructor(e,i,n){super(e),this.vertexProgram=i,this.fragmentProgram=n}}class Xge extends p7{constructor(e,i){super(e),this.computeProgram=i,this.isComputePipeline=!0}}let Yge=0;class wR{constructor(e,i,n=null,s=null){this.id=Yge++,this.code=e,this.stage=i,this.transforms=n,this.attributes=s,this.usedTimes=0}}class Kge extends wd{constructor(e,i){super(),this.backend=e,this.nodes=i,this.bindings=null,this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}getForCompute(e,i){const{backend:n}=this,s=this.get(e);if(this._needsComputeUpdate(e)){const o=s.pipeline;o&&(o.usedTimes--,o.computeProgram.usedTimes--);const l=this.nodes.getForCompute(e);let u=this.programs.compute.get(l.computeShader);u===void 0&&(o&&o.computeProgram.usedTimes===0&&this._releaseProgram(o.computeProgram),u=new wR(l.computeShader,"compute",l.transforms,l.nodeAttributes),this.programs.compute.set(l.computeShader,u),n.createProgram(u));const c=this._getComputeCacheKey(e,u);let h=this.caches.get(c);h===void 0&&(o&&o.usedTimes===0&&this._releasePipeline(o),h=this._getComputePipeline(e,u,c,i)),h.usedTimes++,u.usedTimes++,s.version=e.version,s.pipeline=h}return s.pipeline}getForRender(e,i=null){const{backend:n}=this,s=this.get(e);if(this._needsRenderUpdate(e)){const o=s.pipeline;o&&(o.usedTimes--,o.vertexProgram.usedTimes--,o.fragmentProgram.usedTimes--);const l=e.getNodeBuilderState();let u=this.programs.vertex.get(l.vertexShader);u===void 0&&(o&&o.vertexProgram.usedTimes===0&&this._releaseProgram(o.vertexProgram),u=new wR(l.vertexShader,"vertex"),this.programs.vertex.set(l.vertexShader,u),n.createProgram(u));let c=this.programs.fragment.get(l.fragmentShader);c===void 0&&(o&&o.fragmentProgram.usedTimes===0&&this._releaseProgram(o.fragmentProgram),c=new wR(l.fragmentShader,"fragment"),this.programs.fragment.set(l.fragmentShader,c),n.createProgram(c));const h=this._getRenderCacheKey(e,u,c);let p=this.caches.get(h);p===void 0?(o&&o.usedTimes===0&&this._releasePipeline(o),p=this._getRenderPipeline(e,u,c,h,i)):e.pipeline=p,p.usedTimes++,u.usedTimes++,c.usedTimes++,s.pipeline=p}return s.pipeline}delete(e){const i=this.get(e).pipeline;return i&&(i.usedTimes--,i.usedTimes===0&&this._releasePipeline(i),i.isComputePipeline?(i.computeProgram.usedTimes--,i.computeProgram.usedTimes===0&&this._releaseProgram(i.computeProgram)):(i.fragmentProgram.usedTimes--,i.vertexProgram.usedTimes--,i.vertexProgram.usedTimes===0&&this._releaseProgram(i.vertexProgram),i.fragmentProgram.usedTimes===0&&this._releaseProgram(i.fragmentProgram))),super.delete(e)}dispose(){super.dispose(),this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}updateForRender(e){this.getForRender(e)}_getComputePipeline(e,i,n,s){n=n||this._getComputeCacheKey(e,i);let o=this.caches.get(n);return o===void 0&&(o=new Xge(n,i),this.caches.set(n,o),this.backend.createComputePipeline(o,s)),o}_getRenderPipeline(e,i,n,s,o){s=s||this._getRenderCacheKey(e,i,n);let l=this.caches.get(s);return l===void 0&&(l=new qge(s,i,n),this.caches.set(s,l),e.pipeline=l,this.backend.createRenderPipeline(e,o)),l}_getComputeCacheKey(e,i){return e.id+","+i.id}_getRenderCacheKey(e,i,n){return i.id+","+n.id+","+this.backend.getRenderCacheKey(e)}_releasePipeline(e){this.caches.delete(e.cacheKey)}_releaseProgram(e){const i=e.code,n=e.stage;this.programs[n].delete(i)}_needsComputeUpdate(e){const i=this.get(e);return i.pipeline===void 0||i.version!==e.version}_needsRenderUpdate(e){return this.get(e).pipeline===void 0||this.backend.needsRenderUpdate(e)}}class Jge extends wd{constructor(e,i,n,s,o,l){super(),this.backend=e,this.textures=n,this.pipelines=o,this.attributes=s,this.nodes=i,this.info=l,this.pipelines.bindings=this}getForRender(e){const i=e.getBindings();for(const n of i){const s=this.get(n);s.bindGroup===void 0&&(this._init(n),this.backend.createBindings(n,i),s.bindGroup=n)}return i}getForCompute(e){const i=this.nodes.getForCompute(e).bindings;for(const n of i){const s=this.get(n);s.bindGroup===void 0&&(this._init(n),this.backend.createBindings(n,i),s.bindGroup=n)}return i}updateForCompute(e){this._updateBindings(this.getForCompute(e))}updateForRender(e){this._updateBindings(this.getForRender(e))}_updateBindings(e){for(const i of e)this._update(i,e)}_init(e){for(const i of e.bindings)if(i.isSampledTexture)this.textures.updateTexture(i.texture);else if(i.isStorageBuffer){const n=i.attribute,s=n.isIndirectStorageBufferAttribute?Kc.INDIRECT:Kc.STORAGE;this.attributes.update(n,s)}}_update(e,i){const{backend:n}=this;let s=!1;for(const o of e.bindings)if(!(o.isNodeUniformsGroup&&!this.nodes.updateGroup(o))){if(o.isUniformBuffer)o.update()&&n.updateBinding(o);else if(o.isSampler)o.update();else if(o.isSampledTexture){o.needsBindingsUpdate(this.textures.get(o.texture).generation)&&(s=!0);const l=o.update(),u=o.texture;l&&this.textures.updateTexture(u);const c=n.get(u);if(n.isWebGPUBackend===!0&&c.texture===void 0&&c.externalTexture===void 0&&(console.error("Bindings._update: binding should be available:",o,l,u,o.textureNode.value,s),this.textures.updateTexture(u),s=!0),u.isStorageTexture===!0){const h=this.get(u);o.store===!0?h.needsMipmap=!0:this.textures.needsMipmaps(u)&&h.needsMipmap===!0&&(this.backend.generateMipmaps(u),h.needsMipmap=!1)}}}s===!0&&this.backend.updateBindings(e,i)}}function Zge(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.material.id!==e.material.id?r.material.id-e.material.id:r.z!==e.z?r.z-e.z:r.id-e.id}function f7(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.z!==e.z?e.z-r.z:r.id-e.id}function m7(r){return(r.transmission>0||r.transmissionNode)&&r.side===Zm&&r.forceSinglePass===!1}class $ge{constructor(e,i,n){this.renderItems=[],this.renderItemsIndex=0,this.opaque=[],this.transparentDoublePass=[],this.transparent=[],this.bundles=[],this.lightsNode=e.getNode(i,n),this.lightsArray=[],this.scene=i,this.camera=n,this.occlusionQueryCount=0}begin(){return this.renderItemsIndex=0,this.opaque.length=0,this.transparentDoublePass.length=0,this.transparent.length=0,this.bundles.length=0,this.lightsArray.length=0,this.occlusionQueryCount=0,this}getNextRenderItem(e,i,n,s,o,l){let u=this.renderItems[this.renderItemsIndex];return u===void 0?(u={id:e.id,object:e,geometry:i,material:n,groupOrder:s,renderOrder:e.renderOrder,z:o,group:l},this.renderItems[this.renderItemsIndex]=u):(u.id=e.id,u.object=e,u.geometry=i,u.material=n,u.groupOrder=s,u.renderOrder=e.renderOrder,u.z=o,u.group=l),this.renderItemsIndex++,u}push(e,i,n,s,o,l){const u=this.getNextRenderItem(e,i,n,s,o,l);e.occlusionTest===!0&&this.occlusionQueryCount++,n.transparent===!0||n.transmission>0?(m7(n)&&this.transparentDoublePass.push(u),this.transparent.push(u)):this.opaque.push(u)}unshift(e,i,n,s,o,l){const u=this.getNextRenderItem(e,i,n,s,o,l);n.transparent===!0||n.transmission>0?(m7(n)&&this.transparentDoublePass.unshift(u),this.transparent.unshift(u)):this.opaque.unshift(u)}pushBundle(e){this.bundles.push(e)}pushLight(e){this.lightsArray.push(e)}sort(e,i){this.opaque.length>1&&this.opaque.sort(e||Zge),this.transparentDoublePass.length>1&&this.transparentDoublePass.sort(i||f7),this.transparent.length>1&&this.transparent.sort(i||f7)}finish(){this.lightsNode.setLights(this.lightsArray);for(let e=this.renderItemsIndex,i=this.renderItems.length;e<i;e++){const n=this.renderItems[e];if(n.id===null)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.groupOrder=null,n.renderOrder=null,n.z=null,n.group=null}}}class e0e{constructor(e){this.lighting=e,this.lists=new Yc}get(e,i){const n=this.lists,s=[e,i];let o=n.get(s);return o===void 0&&(o=new $ge(this.lighting,e,i),n.set(s,o)),o}dispose(){this.lists=new Yc}}let t0e=0;class i0e{constructor(){this.id=t0e++,this.color=!0,this.clearColor=!0,this.clearColorValue={r:0,g:0,b:0,a:1},this.depth=!0,this.clearDepth=!0,this.clearDepthValue=1,this.stencil=!1,this.clearStencil=!0,this.clearStencilValue=1,this.viewport=!1,this.viewportValue=new Jn,this.scissor=!1,this.scissorValue=new Jn,this.textures=null,this.depthTexture=null,this.activeCubeFace=0,this.sampleCount=1,this.width=0,this.height=0,this.isRenderContext=!0}getCacheKey(){return g7(this)}}function g7(r){const{textures:e,activeCubeFace:i}=r,n=[i];for(const s of e)n.push(s.id);return m6(n)}class r0e{constructor(){this.chainMaps={}}get(e,i,n=null){const s=[e,i];let o;if(n===null)o="default";else{const c=n.texture.format;o=`${n.textures.length}:${c}:${n.samples}:${n.depthBuffer}:${n.stencilBuffer}`}const l=this.getChainMap(o);let u=l.get(s);return u===void 0&&(u=new i0e,l.set(s,u)),n!==null&&(u.sampleCount=n.samples===0?1:n.samples),u}getChainMap(e){return this.chainMaps[e]||(this.chainMaps[e]=new Yc)}dispose(){this.chainMaps={}}}const n0e=new Lt;class s0e extends wd{constructor(e,i,n){super(),this.renderer=e,this.backend=i,this.info=n}updateRenderTarget(e,i=0){const n=this.get(e),s=e.samples===0?1:e.samples,o=n.depthTextureMips||(n.depthTextureMips={}),l=e.textures,u=this.getSize(l[0]),c=u.width>>i,h=u.height>>i;let p=e.depthTexture||o[i];const f=e.depthBuffer===!0||e.stencilBuffer===!0;let g=!1;p===void 0&&f&&(p=new Eg,p.format=e.stencilBuffer?ag:Dp,p.type=e.stencilBuffer?$A:Fa,p.image.width=c,p.image.height=h,o[i]=p),(n.width!==u.width||u.height!==n.height)&&(g=!0,p&&(p.needsUpdate=!0,p.image.width=c,p.image.height=h)),n.width=u.width,n.height=u.height,n.textures=l,n.depthTexture=p||null,n.depth=e.depthBuffer,n.stencil=e.stencilBuffer,n.renderTarget=e,n.sampleCount!==s&&(g=!0,p&&(p.needsUpdate=!0),n.sampleCount=s);const m={sampleCount:s};for(let y=0;y<l.length;y++){const b=l[y];g&&(b.needsUpdate=!0),this.updateTexture(b,m)}if(p&&this.updateTexture(p,m),n.initialized!==!0){n.initialized=!0;const y=()=>{e.removeEventListener("dispose",y);for(let b=0;b<l.length;b++)this._destroyTexture(l[b]);p&&this._destroyTexture(p),this.delete(e)};e.addEventListener("dispose",y)}}updateTexture(e,i={}){const n=this.get(e);if(n.initialized===!0&&n.version===e.version)return;const s=e.isRenderTargetTexture||e.isDepthTexture||e.isFramebufferTexture,o=this.backend;if(s&&n.initialized===!0&&(o.destroySampler(e),o.destroyTexture(e)),e.isFramebufferTexture){const h=this.renderer.getRenderTarget();h?e.type=h.texture.type:e.type=ld}const{width:l,height:u,depth:c}=this.getSize(e);if(i.width=l,i.height=u,i.depth=c,i.needsMipmaps=this.needsMipmaps(e),i.levels=i.needsMipmaps?this.getMipLevels(e,l,u):1,s||e.isStorageTexture===!0)o.createSampler(e),o.createTexture(e,i),n.generation=e.version;else if(n.initialized!==!0&&o.createSampler(e),e.version>0){const h=e.image;if(h===void 0)console.warn("THREE.Renderer: Texture marked for update but image is undefined.");else if(h.complete===!1)console.warn("THREE.Renderer: Texture marked for update but image is incomplete.");else{if(e.images){const p=[];for(const f of e.images)p.push(f);i.images=p}else i.image=h;(n.isDefaultTexture===void 0||n.isDefaultTexture===!0)&&(o.createTexture(e,i),n.isDefaultTexture=!1,n.generation=e.version),e.source.dataReady===!0&&o.updateTexture(e,i),i.needsMipmaps&&e.mipmaps.length===0&&o.generateMipmaps(e)}}else o.createDefaultTexture(e),n.isDefaultTexture=!0,n.generation=e.version;if(n.initialized!==!0){n.initialized=!0,n.generation=e.version,this.info.memory.textures++;const h=()=>{e.removeEventListener("dispose",h),this._destroyTexture(e),this.info.memory.textures--};e.addEventListener("dispose",h)}n.version=e.version}getSize(e,i=n0e){let n=e.images?e.images[0]:e.image;return n?(n.image!==void 0&&(n=n.image),i.width=n.width,i.height=n.height,i.depth=e.isCubeTexture?6:n.depth||1):i.width=i.height=i.depth=1,i}getMipLevels(e,i,n){let s;return e.isCompressedTexture?s=e.mipmaps.length:s=Math.floor(Math.log2(Math.max(i,n)))+1,s}needsMipmaps(e){return this.isEnvironmentTexture(e)||e.isCompressedTexture===!0||e.generateMipmaps}isEnvironmentTexture(e){const i=e.mapping;return i===YA||i===KA||i===Lp||i===tg}_destroyTexture(e){this.backend.destroySampler(e),this.backend.destroyTexture(e),this.delete(e)}}class CR extends Zn{constructor(e,i,n,s=1){super(e,i,n),this.a=s}set(e,i,n,s=1){return this.a=s,super.set(e,i,n)}copy(e){return e.a!==void 0&&(this.a=e.a),super.copy(e)}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}}class a0e extends $n{static get type(){return"ParameterNode"}constructor(e,i=null){super(e,i),this.isParameterNode=!0}getHash(){return this.uuid}generate(){return this.name}}class o0e extends tn{static get type(){return"StackNode"}constructor(e=null){super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this.isStackNode=!0}getNodeType(e){return this.outputNode?this.outputNode.getNodeType(e):"void"}add(e){return this.nodes.push(e),this}If(e,i){const n=new $1(i);return this._currentCond=Wo(e,n),this.add(this._currentCond)}ElseIf(e,i){const n=new $1(i),s=Wo(e,n);return this._currentCond.elseNode=s,this._currentCond=s,this}Else(e){return this._currentCond.elseNode=new $1(e),this}build(e,...i){const n=I6();t_(this);for(const s of this.nodes)s.build(e,"void");return t_(n),this.outputNode?this.outputNode.build(e,...i):super.build(e,...i)}else(...e){return console.warn("TSL.StackNode: .else() has been renamed to .Else()."),this.Else(...e)}elseif(...e){return console.warn("TSL.StackNode: .elseif() has been renamed to .ElseIf()."),this.ElseIf(...e)}}const SR=ci(o0e);new Ad,new Lt,new Lt,new Lt,new ws,new Lt(0,0,-1),new Jn,new Lt,new Lt,new Jn,new Dn;const l0e=new hg;Iy.flipX(),l0e.depthTexture=new Eg(1,1);const TR=new L3(-1,1,1,-1,0,1);class c0e extends Up{constructor(e=!1){super();const i=e===!1?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new Zu([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Zu(i,2))}}const u0e=new c0e;class A7 extends jp{constructor(e=null){super(u0e,e),this.camera=TR,this.isQuadMesh=!0}renderAsync(e){return e.renderAsync(this,TR)}render(e){e.render(this,TR)}}const Py=new vc,MR=new ws;class qo extends tn{static get type(){return"SceneNode"}constructor(e=qo.BACKGROUND_BLURRINESS,i=null){super(),this.scope=e,this.scene=i}setup(e){const i=this.scope,n=this.scene!==null?this.scene:e.scene;let s;return i===qo.BACKGROUND_BLURRINESS?s=Bs("backgroundBlurriness","float",n):i===qo.BACKGROUND_INTENSITY?s=Bs("backgroundIntensity","float",n):i===qo.BACKGROUND_ROTATION?s=Zr("mat4").label("backgroundRotation").setGroup(Tn).onRenderUpdate(()=>{const o=n.background;return o!==null&&o.isTexture&&o.mapping!==SM?(Py.copy(n.backgroundRotation),Py.x*=-1,Py.y*=-1,Py.z*=-1,MR.makeRotationFromEuler(Py)):MR.identity(),MR}):console.error("THREE.SceneNode: Unknown scope:",i),s}}qo.BACKGROUND_BLURRINESS="backgroundBlurriness",qo.BACKGROUND_INTENSITY="backgroundIntensity",qo.BACKGROUND_ROTATION="backgroundRotation";const h0e=Yi(qo,qo.BACKGROUND_BLURRINESS),y7=Yi(qo,qo.BACKGROUND_INTENSITY),d0e=Yi(qo,qo.BACKGROUND_ROTATION),Og={PointList:"point-list",LineList:"line-list",LineStrip:"line-strip",TriangleList:"triangle-list",TriangleStrip:"triangle-strip"},Ga={Never:"never",Less:"less",Equal:"equal",LessEqual:"less-equal",Greater:"greater",NotEqual:"not-equal",GreaterEqual:"greater-equal",Always:"always"},Ha={Store:"store"},la={Load:"load",Clear:"clear"},RR={CCW:"ccw"},IR={None:"none",Front:"front",Back:"back"},kg={Uint16:"uint16",Uint32:"uint32"},ht={R8Unorm:"r8unorm",R8Snorm:"r8snorm",R8Uint:"r8uint",R8Sint:"r8sint",R16Uint:"r16uint",R16Sint:"r16sint",R16Float:"r16float",RG8Unorm:"rg8unorm",RG8Snorm:"rg8snorm",RG8Uint:"rg8uint",RG8Sint:"rg8sint",R32Uint:"r32uint",R32Sint:"r32sint",R32Float:"r32float",RG16Uint:"rg16uint",RG16Sint:"rg16sint",RG16Float:"rg16float",RGBA8Unorm:"rgba8unorm",RGBA8UnormSRGB:"rgba8unorm-srgb",RGBA8Snorm:"rgba8snorm",RGBA8Uint:"rgba8uint",RGBA8Sint:"rgba8sint",BGRA8Unorm:"bgra8unorm",BGRA8UnormSRGB:"bgra8unorm-srgb",RGB9E5UFloat:"rgb9e5ufloat",RGB10A2Unorm:"rgb10a2unorm",RG32Uint:"rg32uint",RG32Sint:"rg32sint",RG32Float:"rg32float",RGBA16Uint:"rgba16uint",RGBA16Sint:"rgba16sint",RGBA16Float:"rgba16float",RGBA32Uint:"rgba32uint",RGBA32Sint:"rgba32sint",RGBA32Float:"rgba32float",Depth16Unorm:"depth16unorm",Depth24Plus:"depth24plus",Depth24PlusStencil8:"depth24plus-stencil8",Depth32Float:"depth32float",Depth32FloatStencil8:"depth32float-stencil8",BC1RGBAUnorm:"bc1-rgba-unorm",BC1RGBAUnormSRGB:"bc1-rgba-unorm-srgb",BC2RGBAUnorm:"bc2-rgba-unorm",BC2RGBAUnormSRGB:"bc2-rgba-unorm-srgb",BC3RGBAUnorm:"bc3-rgba-unorm",BC3RGBAUnormSRGB:"bc3-rgba-unorm-srgb",BC4RUnorm:"bc4-r-unorm",BC5RGUnorm:"bc5-rg-unorm",BC5RGSnorm:"bc5-rg-snorm",BC6HRGBUFloat:"bc6h-rgb-ufloat",BC6HRGBFloat:"bc6h-rgb-float",BC7RGBAUnorm:"bc7-rgba-unorm",BC7RGBAUnormSRGB:"bc7-rgba-srgb",ETC2RGB8Unorm:"etc2-rgb8unorm",ETC2RGB8UnormSRGB:"etc2-rgb8unorm-srgb",ETC2RGB8A1Unorm:"etc2-rgb8a1unorm",ETC2RGB8A1UnormSRGB:"etc2-rgb8a1unorm-srgb",ETC2RGBA8Unorm:"etc2-rgba8unorm",ETC2RGBA8UnormSRGB:"etc2-rgba8unorm-srgb",EACR11Unorm:"eac-r11unorm",EACR11Snorm:"eac-r11snorm",EACRG11Unorm:"eac-rg11unorm",EACRG11Snorm:"eac-rg11snorm",ASTC4x4Unorm:"astc-4x4-unorm",ASTC4x4UnormSRGB:"astc-4x4-unorm-srgb",ASTC5x4Unorm:"astc-5x4-unorm",ASTC5x4UnormSRGB:"astc-5x4-unorm-srgb",ASTC5x5Unorm:"astc-5x5-unorm",ASTC5x5UnormSRGB:"astc-5x5-unorm-srgb",ASTC6x5Unorm:"astc-6x5-unorm",ASTC6x5UnormSRGB:"astc-6x5-unorm-srgb",ASTC6x6Unorm:"astc-6x6-unorm",ASTC6x6UnormSRGB:"astc-6x6-unorm-srgb",ASTC8x5Unorm:"astc-8x5-unorm",ASTC8x5UnormSRGB:"astc-8x5-unorm-srgb",ASTC8x6Unorm:"astc-8x6-unorm",ASTC8x6UnormSRGB:"astc-8x6-unorm-srgb",ASTC8x8Unorm:"astc-8x8-unorm",ASTC8x8UnormSRGB:"astc-8x8-unorm-srgb",ASTC10x5Unorm:"astc-10x5-unorm",ASTC10x5UnormSRGB:"astc-10x5-unorm-srgb",ASTC10x6Unorm:"astc-10x6-unorm",ASTC10x6UnormSRGB:"astc-10x6-unorm-srgb",ASTC10x8Unorm:"astc-10x8-unorm",ASTC10x8UnormSRGB:"astc-10x8-unorm-srgb",ASTC10x10Unorm:"astc-10x10-unorm",ASTC10x10UnormSRGB:"astc-10x10-unorm-srgb",ASTC12x10Unorm:"astc-12x10-unorm",ASTC12x10UnormSRGB:"astc-12x10-unorm-srgb",ASTC12x12Unorm:"astc-12x12-unorm",ASTC12x12UnormSRGB:"astc-12x12-unorm-srgb"},BR={ClampToEdge:"clamp-to-edge",Repeat:"repeat",MirrorRepeat:"mirror-repeat"},Kp={Linear:"linear",Nearest:"nearest"},Qr={Zero:"zero",One:"one",Src:"src",OneMinusSrc:"one-minus-src",SrcAlpha:"src-alpha",OneMinusSrcAlpha:"one-minus-src-alpha",Dst:"dst",OneMinusDstColor:"one-minus-dst",DstAlpha:"dst-alpha",OneMinusDstAlpha:"one-minus-dst-alpha",SrcAlphaSaturated:"src-alpha-saturated",Constant:"constant",OneMinusConstant:"one-minus-constant"},Jp={Add:"add",Subtract:"subtract",ReverseSubtract:"reverse-subtract",Min:"min",Max:"max"},v7={None:0,All:15},Sd={Keep:"keep",Zero:"zero",Replace:"replace",Invert:"invert",IncrementClamp:"increment-clamp",DecrementClamp:"decrement-clamp",IncrementWrap:"increment-wrap",DecrementWrap:"decrement-wrap"},LR={Storage:"storage",ReadOnlyStorage:"read-only-storage"},b7={WriteOnly:"write-only",ReadOnly:"read-only"},Oy={Float:"float",UnfilterableFloat:"unfilterable-float",Depth:"depth",SInt:"sint",UInt:"uint"},x7={TwoD:"2d",ThreeD:"3d"},Ul={TwoD:"2d",TwoDArray:"2d-array",Cube:"cube",ThreeD:"3d"},p0e={All:"all"},E_={Vertex:"vertex",Instance:"instance"},DR={DepthClipControl:"depth-clip-control",Depth32FloatStencil8:"depth32float-stencil8",TextureCompressionBC:"texture-compression-bc",TextureCompressionETC2:"texture-compression-etc2",TextureCompressionASTC:"texture-compression-astc",TimestampQuery:"timestamp-query",IndirectFirstInstance:"indirect-first-instance",ShaderF16:"shader-f16",RG11B10UFloat:"rg11b10ufloat-renderable",BGRA8UNormStorage:"bgra8unorm-storage",Float32Filterable:"float32-filterable",ClipDistances:"clip-distances",DualSourceBlending:"dual-source-blending",Subgroups:"subgroups"},f0e=new Dn;class m0e extends _y{static get type(){return"PassTextureNode"}constructor(e,i){super(i),this.passNode=e,this.setUpdateMatrix(!1)}setup(e){return e.object.isQuadMesh&&this.passNode.build(e),super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}}class _7 extends m0e{static get type(){return"PassMultipleTextureNode"}constructor(e,i,n=!1){super(e,null),this.textureName=i,this.previousTexture=n}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(e){return this.updateTexture(),super.setup(e)}clone(){return new this.constructor(this.passNode,this.textureName,this.previousTexture)}}class w_ extends ra{static get type(){return"PassNode"}constructor(e,i,n,s={}){super("vec4"),this.scope=e,this.scene=i,this.camera=n,this.options=s,this._pixelRatio=1,this._width=1,this._height=1;const o=new Eg;o.isRenderTargetTexture=!0,o.name="depth";const l=new hg(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Gu,...s});l.texture.name="output",l.depthTexture=o,this.renderTarget=l,this.updateBeforeType=un.FRAME,this._textures={output:l.texture,depth:o},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=Zr(0),this._cameraFar=Zr(0),this._mrt=null,this.isPassNode=!0}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}isGlobal(){return!0}getTexture(e){let i=this._textures[e];return i===void 0&&(i=this.renderTarget.texture.clone(),i.isRenderTargetTexture=!0,i.name=e,this._textures[e]=i,this.renderTarget.textures.push(i)),i}getPreviousTexture(e){let i=this._previousTextures[e];return i===void 0&&(i=this.getTexture(e).clone(),i.isRenderTargetTexture=!0,this._previousTextures[e]=i),i}toggleTexture(e){const i=this._previousTextures[e];if(i!==void 0){const n=this._textures[e],s=this.renderTarget.textures.indexOf(n);this.renderTarget.textures[s]=i,this._textures[e]=i,this._previousTextures[e]=n,this._textureNodes[e].updateTexture(),this._previousTextureNodes[e].updateTexture()}}getTextureNode(e="output"){let i=this._textureNodes[e];return i===void 0&&(i=Ti(new _7(this,e)),i.updateTexture(),this._textureNodes[e]=i),i}getPreviousTextureNode(e="output"){let i=this._previousTextureNodes[e];return i===void 0&&(this._textureNodes[e]===void 0&&this.getTextureNode(e),i=Ti(new _7(this,e,!0)),i.updateTexture(),this._previousTextureNodes[e]=i),i}getViewZNode(e="depth"){let i=this._viewZNodes[e];if(i===void 0){const n=this._cameraNear,s=this._cameraFar;this._viewZNodes[e]=i=T8(this.getTextureNode(e),n,s)}return i}getLinearDepthNode(e="depth"){let i=this._linearDepthNodes[e];if(i===void 0){const n=this._cameraNear,s=this._cameraFar,o=this.getViewZNode(e);this._linearDepthNodes[e]=i=Ly(o,n,s)}return i}setup({renderer:e}){return this.renderTarget.samples=this.options.samples===void 0?e.samples:this.options.samples,e.backend.isWebGLBackend===!0&&(this.renderTarget.samples=0),this.renderTarget.depthTexture.isMultisampleRenderTargetTexture=this.renderTarget.samples>1,this.scope===w_.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(e){const{renderer:i}=e,{scene:n,camera:s}=this;this._pixelRatio=i.getPixelRatio();const o=i.getSize(f0e);this.setSize(o.width,o.height);const l=i.getRenderTarget(),u=i.getMRT();this._cameraNear.value=s.near,this._cameraFar.value=s.far;for(const c in this._previousTextures)this.toggleTexture(c);i.setRenderTarget(this.renderTarget),i.setMRT(this._mrt),i.render(n,s),i.setRenderTarget(l),i.setMRT(u)}setSize(e,i){this._width=e,this._height=i;const n=this._width*this._pixelRatio,s=this._height*this._pixelRatio;this.renderTarget.setSize(n,s)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}w_.COLOR="color",w_.DEPTH="depth";const g0e=Gi(([r,e])=>r.mul(e).clamp()).setLayout({name:"linearToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),A0e=Gi(([r,e])=>(r=r.mul(e),r.div(r.add(1)).clamp())).setLayout({name:"reinhardToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),y0e=Gi(([r,e])=>{r=r.mul(e),r=r.sub(.004).max(0);const i=r.mul(r.mul(6.2).add(.5)),n=r.mul(r.mul(6.2).add(1.7)).add(.06);return i.div(n).pow(2.2)}).setLayout({name:"cineonToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),v0e=Gi(([r])=>{const e=r.mul(r.add(.0245786)).sub(90537e-9),i=r.mul(r.add(.432951).mul(.983729)).add(.238081);return e.div(i)}),b0e=Gi(([r,e])=>{const i=So(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),n=So(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return r=r.mul(e).div(.6),r=i.mul(r),r=v0e(r),r=n.mul(r),r.clamp()}).setLayout({name:"acesFilmicToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),x0e=So(ei(1.6605,-.1246,-.0182),ei(-.5876,1.1329,-.1006),ei(-.0728,-.0083,1.1187)),_0e=So(ei(.6274,.0691,.0164),ei(.3293,.9195,.088),ei(.0433,.0113,.8956)),E0e=Gi(([r])=>{const e=ei(r).toVar(),i=ei(e.mul(e)).toVar(),n=ei(i.mul(i)).toVar();return ii(15.5).mul(n.mul(i)).sub(vn(40.14,n.mul(e))).add(vn(31.96,n).sub(vn(6.868,i.mul(e))).add(vn(.4298,i).add(vn(.1191,e).sub(.00232))))}),w0e=Gi(([r,e])=>{const i=ei(r).toVar(),n=So(ei(.856627153315983,.137318972929847,.11189821299995),ei(.0951212405381588,.761241990602591,.0767994186031903),ei(.0482516061458583,.101439036467562,.811302368396859)),s=So(ei(1.1271005818144368,-.1413297634984383,-.14132976349843826),ei(-.11060664309660323,1.157823702216272,-.11060664309660294),ei(-.016493938717834573,-.016493938717834257,1.2519364065950405)),o=ii(-12.47393),l=ii(4.026069);return i.mulAssign(e),i.assign(_0e.mul(i)),i.assign(n.mul(i)),i.assign(Fl(i,1e-10)),i.assign(rh(i)),i.assign(i.sub(o).div(l.sub(o))),i.assign(nh(i,0,1)),i.assign(E0e(i)),i.assign(s.mul(i)),i.assign(l_(Fl(ei(0),i),ei(2.2))),i.assign(x0e.mul(i)),i.assign(nh(i,0,1)),i}).setLayout({name:"agxToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),C0e=Gi(([r,e])=>{const i=ii(.76),n=ii(.15);r=r.mul(e);const s=yy(r.r,yy(r.g,r.b)),o=Wo(s.lessThan(.08),s.sub(vn(6.25,s.mul(s))),.04);r.subAssign(o);const l=Fl(r.r,Fl(r.g,r.b));za(l.lessThan(i),()=>r);const u=yl(1,i),c=yl(1,u.mul(u).div(l.add(u.sub(i))));r.mulAssign(c.div(l));const h=yl(1,yd(1,n.mul(l.sub(c)).add(1)));return As(r,ei(c),h)}).setLayout({name:"neutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});class no extends tn{static get type(){return"CodeNode"}constructor(e="",i=[],n=""){super("code"),this.isCodeNode=!0,this.code=e,this.language=n,this.includes=i}isGlobal(){return!0}setIncludes(e){return this.includes=e,this}getIncludes(){return this.includes}generate(e){const i=this.getIncludes(e);for(const s of i)s.build(e);const n=e.getCodeFromNode(this,this.getNodeType(e));return n.code=this.code,n.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}}class S0e extends no{static get type(){return"FunctionNode"}constructor(e="",i=[],n=""){super(e,i,n)}getNodeType(e){return this.getNodeFunction(e).type}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){const i=e.getDataFromNode(this);let n=i.nodeFunction;return n===void 0&&(n=e.parser.parseFunction(this.code),i.nodeFunction=n),n}generate(e,i){super.generate(e);const n=this.getNodeFunction(e),s=n.name,o=n.type,l=e.getCodeFromNode(this,o);s!==""&&(l.name=s);const u=e.getPropertyName(l),c=this.getNodeFunction(e).getCode(u);return l.code=c+`
`,i==="property"?u:e.format(`${u}()`,o,i)}}class E7 extends tn{static get type(){return"FogNode"}constructor(e,i){super("float"),this.isFogNode=!0,this.colorNode=e,this.factorNode=i}getViewZNode(e){let i;const n=e.context.getViewZ;return n!==void 0&&(i=n(this)),(i||Va.z).negate()}setup(){return this.factorNode}}class T0e extends E7{static get type(){return"FogRangeNode"}constructor(e,i,n){super(e),this.isFogRangeNode=!0,this.nearNode=i,this.farNode=n}setup(e){const i=this.getViewZNode(e);return Qp(this.nearNode,this.farNode,i)}}const M0e=ci(T0e);class R0e extends E7{static get type(){return"FogExp2Node"}constructor(e,i){super(e),this.isFogExp2Node=!0,this.densityNode=i}setup(e){const i=this.getViewZNode(e),n=this.densityNode;return n.mul(n,i,i).negate().exp().oneMinus()}}const I0e=ci(R0e);class B0e extends tn{constructor(e){super(),this.scope=e}generate(e){const{scope:i}=this,{renderer:n}=e;n.backend.isWebGLBackend===!0?e.addFlowCode(`	// ${i}Barrier 
`):e.addLineFlowCode(`${i}Barrier()`,this)}}ci(B0e);class Jc extends ra{static get type(){return"AtomicFunctionNode"}constructor(e,i,n,s=null){super("uint"),this.method=e,this.pointerNode=i,this.valueNode=n,this.storeNode=s}getInputType(e){return this.pointerNode.getNodeType(e)}getNodeType(e){return this.getInputType(e)}generate(e){const i=this.method,n=this.getNodeType(e),s=this.getInputType(e),o=this.pointerNode,l=this.valueNode,u=[];u.push(`&${o.build(e,s)}`),u.push(l.build(e,s));const c=`${e.getMethod(i,n)}( ${u.join(", ")} )`;if(this.storeNode!==null){const h=this.storeNode.build(e,s);e.addLineFlowCode(`${h} = ${c}`,this)}else e.addLineFlowCode(c,this)}}Jc.ATOMIC_LOAD="atomicLoad",Jc.ATOMIC_STORE="atomicStore",Jc.ATOMIC_ADD="atomicAdd",Jc.ATOMIC_SUB="atomicSub",Jc.ATOMIC_MAX="atomicMax",Jc.ATOMIC_MIN="atomicMin",Jc.ATOMIC_AND="atomicAnd",Jc.ATOMIC_OR="atomicOr",Jc.ATOMIC_XOR="atomicXor",ci(Jc);let C_;function NR(r){C_=C_||new WeakMap;let e=C_.get(r);return e===void 0&&C_.set(r,e={}),e}function w7(r){const e=NR(r);return e.position||(e.position=Zr(new Lt).setGroup(Tn).onRenderUpdate((i,n)=>n.value.setFromMatrixPosition(r.matrixWorld)))}function L0e(r){const e=NR(r);return e.targetPosition||(e.targetPosition=Zr(new Lt).setGroup(Tn).onRenderUpdate((i,n)=>n.value.setFromMatrixPosition(r.target.matrixWorld)))}function PR(r){const e=NR(r);return e.viewPosition||(e.viewPosition=Zr(new Lt).setGroup(Tn).onRenderUpdate(({camera:i},n)=>{n.value=n.value||new Lt,n.value.setFromMatrixPosition(r.matrixWorld),n.value.applyMatrix4(i.matrixWorldInverse)}))}const C7=r=>oh.transformDirection(w7(r).sub(L0e(r))),D0e=r=>r.sort((e,i)=>e.id-i.id),N0e=(r,e)=>{for(const i of e)if(i.isAnalyticLightNode&&i.light.id===r)return i;return null},OR=new WeakMap;class S7 extends tn{static get type(){return"LightsNode"}constructor(){super("vec3"),this.totalDiffuseNode=ei().toVar("totalDiffuse"),this.totalSpecularNode=ei().toVar("totalSpecular"),this.outgoingLightNode=ei().toVar("outgoingLight"),this._lights=[],this._lightNodes=null,this._lightNodesHash=null,this.global=!0}getHash(e){if(this._lightNodesHash===null){this._lightNodes===null&&this.setupLightsNode(e);const i=[];for(const n of this._lightNodes)i.push(n.getSelf().getHash());this._lightNodesHash="lights-"+i.join(",")}return this._lightNodesHash}analyze(e){const i=e.getDataFromNode(this);for(const n of i.nodes)n.build(e)}setupLightsNode(e){const i=[],n=this._lightNodes,s=D0e(this._lights),o=e.renderer.library;for(const l of s)if(l.isNode)i.push(Ti(l));else{let u=null;if(n!==null&&(u=N0e(l.id,n)),u===null){const c=o.getLightNodeClass(l.constructor);if(c===null){console.warn(`LightsNode.setupNodeLights: Light node not found for ${l.constructor.name}`);continue}let h=null;OR.has(l)?h=OR.get(l):(h=Ti(new c(l)),OR.set(l,h)),i.push(h)}}this._lightNodes=i}setupLights(e,i){for(const n of i)n.build(e)}setup(e){this._lightNodes===null&&this.setupLightsNode(e);const i=e.context,n=i.lightingModel;let s=this.outgoingLightNode;if(n){const{_lightNodes:o,totalDiffuseNode:l,totalSpecularNode:u}=this;i.outgoingLight=s;const c=e.addStack(),h=e.getDataFromNode(this);h.nodes=c.nodes,n.start(i,c,e),this.setupLights(e,o),n.indirect(i,c,e);const{backdrop:p,backdropAlpha:f}=i,{directDiffuse:g,directSpecular:m,indirectDiffuse:y,indirectSpecular:b}=i.reflectedLight;let v=g.add(y);p!==null&&(f!==null?v=ei(f.mix(v,p)):v=ei(p),i.material.transparent=!0),l.assign(v),u.assign(m.add(b)),s.assign(l.add(u)),n.finish(i,c,e),s=s.bypass(e.removeStack())}return s}setLights(e){return this._lights=e,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}get hasLights(){return this._lights.length>0}}const P0e=Gi(({depthTexture:r,shadowCoord:e})=>Us(r,e.xy).compare(e.z)),O0e=Gi(({depthTexture:r,shadowCoord:e,shadow:i})=>{const n=(b,v)=>Us(r,b).compare(v),s=Bs("mapSize","vec2",i).setGroup(Tn),o=Bs("radius","float",i).setGroup(Tn),l=Ki(1).div(s),u=l.x.negate().mul(o),c=l.y.negate().mul(o),h=l.x.mul(o),p=l.y.mul(o),f=u.div(2),g=c.div(2),m=h.div(2),y=p.div(2);return To(n(e.xy.add(Ki(u,c)),e.z),n(e.xy.add(Ki(0,c)),e.z),n(e.xy.add(Ki(h,c)),e.z),n(e.xy.add(Ki(f,g)),e.z),n(e.xy.add(Ki(0,g)),e.z),n(e.xy.add(Ki(m,g)),e.z),n(e.xy.add(Ki(u,0)),e.z),n(e.xy.add(Ki(f,0)),e.z),n(e.xy,e.z),n(e.xy.add(Ki(m,0)),e.z),n(e.xy.add(Ki(h,0)),e.z),n(e.xy.add(Ki(f,y)),e.z),n(e.xy.add(Ki(0,y)),e.z),n(e.xy.add(Ki(m,y)),e.z),n(e.xy.add(Ki(u,p)),e.z),n(e.xy.add(Ki(0,p)),e.z),n(e.xy.add(Ki(h,p)),e.z)).mul(1/17)}),k0e=Gi(({depthTexture:r,shadowCoord:e,shadow:i})=>{const n=(p,f)=>Us(r,p).compare(f),s=Bs("mapSize","vec2",i).setGroup(Tn),o=Ki(1).div(s),l=o.x,u=o.y,c=e.xy,h=vd(c.mul(s).add(.5));return c.subAssign(h.mul(o)),To(n(c,e.z),n(c.add(Ki(l,0)),e.z),n(c.add(Ki(0,u)),e.z),n(c.add(o),e.z),As(n(c.add(Ki(l.negate(),0)),e.z),n(c.add(Ki(l.mul(2),0)),e.z),h.x),As(n(c.add(Ki(l.negate(),u)),e.z),n(c.add(Ki(l.mul(2),u)),e.z),h.x),As(n(c.add(Ki(0,u.negate())),e.z),n(c.add(Ki(0,u.mul(2))),e.z),h.y),As(n(c.add(Ki(l,u.negate())),e.z),n(c.add(Ki(l,u.mul(2))),e.z),h.y),As(As(n(c.add(Ki(l.negate(),u.negate())),e.z),n(c.add(Ki(l.mul(2),u.negate())),e.z),h.x),As(n(c.add(Ki(l.negate(),u.mul(2))),e.z),n(c.add(Ki(l.mul(2),u.mul(2))),e.z),h.x),h.y)).mul(1/9)}),F0e=Gi(({depthTexture:r,shadowCoord:e})=>{const i=ii(1).toVar(),n=Us(r).uv(e.xy).rg,s=K6(e.z,n.x);return za(s.notEqual(ii(1)),()=>{const o=e.z.sub(n.x),l=Fl(0,n.y.mul(n.y));let u=l.div(l.add(o.mul(o)));u=nh(yl(u,.3).div(.95-.3)),i.assign(nh(Fl(s,u)))}),i}),U0e=Gi(({samples:r,radius:e,size:i,shadowPass:n})=>{const s=ii(0).toVar(),o=ii(0).toVar(),l=r.lessThanEqual(ii(1)).select(ii(0),ii(2).div(r.sub(1))),u=r.lessThanEqual(ii(1)).select(ii(0),ii(-1));Xc({start:Fs(0),end:Fs(r),type:"int",condition:"<"},({i:h})=>{const p=u.add(ii(h).mul(l)),f=n.uv(To(cR.xy,Ki(0,p).mul(e)).div(i)).x;s.addAssign(f),o.addAssign(f.mul(f))}),s.divAssign(r),o.divAssign(r);const c=q3(o.sub(s.mul(s)));return Ki(s,c)}),z0e=Gi(({samples:r,radius:e,size:i,shadowPass:n})=>{const s=ii(0).toVar(),o=ii(0).toVar(),l=r.lessThanEqual(ii(1)).select(ii(0),ii(2).div(r.sub(1))),u=r.lessThanEqual(ii(1)).select(ii(0),ii(-1));Xc({start:Fs(0),end:Fs(r),type:"int",condition:"<"},({i:h})=>{const p=u.add(ii(h).mul(l)),f=n.uv(To(cR.xy,Ki(p,0).mul(e)).div(i));s.addAssign(f.x),o.addAssign(To(f.y.mul(f.y),f.x.mul(f.x)))}),s.divAssign(r),o.divAssign(r);const c=q3(o.sub(s.mul(s)));return Ki(s,c)}),j0e=[P0e,O0e,k0e,F0e];let Fg=null;const S_=new A7;class V0e extends tn{static get type(){return"ShadowNode"}constructor(e,i=null){super(),this.light=e,this.shadow=i||e.shadow,this.shadowMap=null,this.vsmShadowMapVertical=null,this.vsmShadowMapHorizontal=null,this.vsmMaterialVertical=null,this.vsmMaterialHorizontal=null,this.updateBeforeType=un.RENDER,this._node=null,this.isShadowNode=!0}setupShadow(e){const{object:i,renderer:n}=e;Fg===null&&(Fg=new oa,Fg.fragmentNode=Jr(0,0,0,1),Fg.isShadowNodeMaterial=!0,Fg.name="ShadowMaterial");const s=this.shadow,o=n.shadowMap.type,l=new Eg(s.mapSize.width,s.mapSize.height);l.compareFunction=e3;const u=e.createRenderTarget(s.mapSize.width,s.mapSize.height);if(u.depthTexture=l,s.camera.updateProjectionMatrix(),o===m1){l.compareFunction=null,this.vsmShadowMapVertical=e.createRenderTarget(s.mapSize.width,s.mapSize.height,{format:ey,type:Gu}),this.vsmShadowMapHorizontal=e.createRenderTarget(s.mapSize.width,s.mapSize.height,{format:ey,type:Gu});const T=Us(l),E=Us(this.vsmShadowMapVertical.texture),C=Bs("blurSamples","float",s).setGroup(Tn),R=Bs("radius","float",s).setGroup(Tn),B=Bs("mapSize","vec2",s).setGroup(Tn);let I=this.vsmMaterialVertical||(this.vsmMaterialVertical=new oa);I.fragmentNode=U0e({samples:C,radius:R,size:B,shadowPass:T}).context(e.getSharedContext()),I.name="VSMVertical",I=this.vsmMaterialHorizontal||(this.vsmMaterialHorizontal=new oa),I.fragmentNode=z0e({samples:C,radius:R,size:B,shadowPass:E}).context(e.getSharedContext()),I.name="VSMHorizontal"}const c=Bs("intensity","float",s).setGroup(Tn),h=Bs("bias","float",s).setGroup(Tn),p=Bs("normalBias","float",s).setGroup(Tn),f=i.material.shadowPositionNode||$3;let g=Zr(s.matrix).setGroup(Tn).mul(f.add(eR.mul(p))),m;if(s.camera.isOrthographicCamera||n.logarithmicDepthBuffer!==!0)g=g.xyz.div(g.w),m=g.z,n.coordinateSystem===Op&&(m=m.mul(2).sub(1));else{const T=g.w;g=g.xy.div(T);const E=Zr("float").onRenderUpdate(()=>s.camera.near),C=Zr("float").onRenderUpdate(()=>s.camera.far);m=M8(T,E,C)}g=ei(g.x,g.y.oneMinus(),m.add(h));const y=g.x.greaterThanEqual(0).and(g.x.lessThanEqual(1)).and(g.y.greaterThanEqual(0)).and(g.y.lessThanEqual(1)).and(g.z.lessThanEqual(1)),b=s.filterNode||j0e[n.shadowMap.type]||null;if(b===null)throw new Error("THREE.WebGPURenderer: Shadow map type not supported yet.");const v=Us(u.texture,g),_=y.select(b({depthTexture:o===m1?this.vsmShadowMapHorizontal.texture:l,shadowCoord:g,shadow:s}),ii(1));return this.shadowMap=u,this.shadow.map=u,As(1,_.rgb.mix(v,1),c.mul(v.a))}setup(e){if(e.renderer.shadowMap.enabled!==!1)return this._node!==null?this._node:this._node=this.setupShadow(e)}updateShadow(e){const{shadowMap:i,light:n,shadow:s}=this,{renderer:o,scene:l,camera:u}=e,c=o.shadowMap.type,h=i.depthTexture.version;this._depthVersionCached=h;const p=l.overrideMaterial;l.overrideMaterial=Fg,i.setSize(s.mapSize.width,s.mapSize.height),s.updateMatrices(n),s.camera.layers.mask=u.layers.mask;const f=o.getRenderTarget(),g=o.getRenderObjectFunction();o.setRenderObjectFunction((m,...y)=>{(m.castShadow===!0||m.receiveShadow&&c===m1)&&o.renderObject(m,...y)}),o.setRenderTarget(i),o.render(l,s.camera),o.setRenderObjectFunction(g),n.isPointLight!==!0&&c===m1&&this.vsmPass(o),o.setRenderTarget(f),l.overrideMaterial=p}vsmPass(e){const{shadow:i}=this;this.vsmShadowMapVertical.setSize(i.mapSize.width,i.mapSize.height),this.vsmShadowMapHorizontal.setSize(i.mapSize.width,i.mapSize.height),e.setRenderTarget(this.vsmShadowMapVertical),S_.material=this.vsmMaterialVertical,S_.render(e),e.setRenderTarget(this.vsmShadowMapHorizontal),S_.material=this.vsmMaterialHorizontal,S_.render(e)}dispose(){this.shadowMap.dispose(),this.shadowMap=null,this.vsmShadowMapVertical!==null&&(this.vsmShadowMapVertical.dispose(),this.vsmShadowMapVertical=null,this.vsmMaterialVertical.dispose(),this.vsmMaterialVertical=null),this.vsmShadowMapHorizontal!==null&&(this.vsmShadowMapHorizontal.dispose(),this.vsmShadowMapHorizontal=null,this.vsmMaterialHorizontal.dispose(),this.vsmMaterialHorizontal=null),this.updateBeforeType=un.NONE}updateBefore(e){const{shadow:i}=this;(i.needsUpdate||i.autoUpdate)&&(this.updateShadow(e),this.shadowMap.depthTexture.version===this._depthVersionCached&&(i.needsUpdate=!1))}}const G0e=(r,e)=>Ti(new V0e(r,e));class Zp extends Dg{static get type(){return"AnalyticLightNode"}constructor(e=null){super(),this.updateType=un.FRAME,this.light=e,this.color=new Zn,this.colorNode=Zr(this.color).setGroup(Tn),this.baseColorNode=null,this.shadowNode=null,this.shadowColorNode=null,this.isAnalyticLightNode=!0}getCacheKey(){return X1(super.getCacheKey(),this.light.id,this.light.castShadow?1:0)}getHash(){return this.light.uuid}setupShadow(e){const{renderer:i}=e;if(i.shadowMap.enabled===!1)return;let n=this.shadowColorNode;if(n===null){const s=this.light.shadow.shadowNode;let o;s!==void 0?o=Ti(s):o=G0e(this.light),this.shadowNode=o,this.shadowColorNode=n=this.colorNode.mul(o),this.baseColorNode=this.colorNode}this.colorNode=n}setup(e){this.colorNode=this.baseColorNode||this.colorNode,this.light.castShadow?e.object.receiveShadow&&this.setupShadow(e):this.shadowNode!==null&&this.shadowNode.dispose()}update(){const{light:e}=this;this.color.copy(e.color).multiplyScalar(e.intensity)}}const T7=Gi(r=>{const{lightDistance:e,cutoffDistance:i,decayExponent:n}=r,s=e.pow(n).max(.01).reciprocal();return i.greaterThan(0).select(s.mul(e.div(i).pow4().oneMinus().clamp().pow2()),s)}),H0e=Gi(({color:r,lightViewPosition:e,cutoffDistance:i,decayExponent:n},s)=>{const o=s.context.lightingModel,l=e.sub(Va),u=l.normalize(),c=l.length(),h=T7({lightDistance:c,cutoffDistance:i,decayExponent:n}),p=r.mul(h),f=s.context.reflectedLight;o.direct({lightDirection:u,lightColor:p,reflectedLight:f},s.stack,s)});class W0e extends Zp{static get type(){return"PointLightNode"}constructor(e=null){super(e),this.cutoffDistanceNode=Zr(0).setGroup(Tn),this.decayExponentNode=Zr(0).setGroup(Tn)}update(e){const{light:i}=this;super.update(e),this.cutoffDistanceNode.value=i.distance,this.decayExponentNode.value=i.decay}setup(){H0e({color:this.colorNode,lightViewPosition:PR(this.light),cutoffDistance:this.cutoffDistanceNode,decayExponent:this.decayExponentNode}).append()}}const Q0e=Gi(([r,e])=>{const i=r.x,n=r.y,s=r.z;let o=e.element(0).mul(.886227);return o=o.add(e.element(1).mul(2*.511664).mul(n)),o=o.add(e.element(2).mul(2*.511664).mul(s)),o=o.add(e.element(3).mul(2*.511664).mul(i)),o=o.add(e.element(4).mul(2*.429043).mul(i).mul(n)),o=o.add(e.element(5).mul(2*.429043).mul(n).mul(s)),o=o.add(e.element(6).mul(s.mul(s).mul(.743125).sub(.247708))),o=o.add(e.element(7).mul(2*.429043).mul(i).mul(s)),o=o.add(e.element(8).mul(.429043).mul(vn(i,i).sub(vn(n,n)))),o}),lh=new CR;class q0e extends wd{constructor(e,i){super(),this.renderer=e,this.nodes=i}update(e,i,n){const s=this.renderer,o=this.nodes.getBackgroundNode(e)||e.background;let l=!1;if(o===null)s._clearColor.getRGB(lh,ud),lh.a=s._clearColor.a;else if(o.isColor===!0)o.getRGB(lh,ud),lh.a=1,l=!0;else if(o.isNode===!0){const u=this.get(e),c=o;lh.copy(s._clearColor);let h=u.backgroundMesh;if(h===void 0){const f=K3(Jr(c).mul(y7),{getUV:()=>d0e.mul(h8),getTextureLevel:()=>h0e});let g=sR();g=g.setZ(g.w);const m=new oa;m.name="Background.material",m.side=mc,m.depthTest=!1,m.depthWrite=!1,m.fog=!1,m.lights=!1,m.vertexNode=g,m.colorNode=f,u.backgroundMeshNode=f,u.backgroundMesh=h=new jp(new T3(1,32,32),m),h.frustumCulled=!1,h.name="Background.mesh",h.onBeforeRender=function(y,b,v){this.matrixWorld.copyPosition(v.matrixWorld)}}const p=c.getCacheKey();u.backgroundCacheKey!==p&&(u.backgroundMeshNode.node=Jr(c).mul(y7),u.backgroundMeshNode.needsUpdate=!0,h.material.needsUpdate=!0,u.backgroundCacheKey=p),i.unshift(h,h.geometry,h.material,0,0,null)}else console.error("THREE.Renderer: Unsupported background configuration.",o);if(s.autoClear===!0||l===!0){const u=n.clearColorValue;u.r=lh.r,u.g=lh.g,u.b=lh.b,u.a=lh.a,(s.backend.isWebGLBackend===!0||s.alpha===!0)&&(u.r*=u.a,u.g*=u.a,u.b*=u.a),n.depthClearValue=s._clearDepth,n.stencilClearValue=s._clearStencil,n.clearColor=s.autoClearColor===!0,n.clearDepth=s.autoClearDepth===!0,n.clearStencil=s.autoClearStencil===!0}else n.clearColor=!1,n.clearDepth=!1,n.clearStencil=!1}}let X0e=0;class kR{constructor(e="",i=[],n=0,s=[]){this.name=e,this.bindings=i,this.index=n,this.bindingsReference=s,this.id=X0e++}}class Y0e{constructor(e,i,n,s,o,l,u,c,h,p=[]){this.vertexShader=e,this.fragmentShader=i,this.computeShader=n,this.transforms=p,this.nodeAttributes=s,this.bindings=o,this.updateNodes=l,this.updateBeforeNodes=u,this.updateAfterNodes=c,this.monitor=h,this.usedTimes=0}createBindings(){const e=[];for(const i of this.bindings)if(i.bindings[0].groupNode.shared!==!0){const n=new kR(i.name,[],i.index,i);e.push(n);for(const s of i.bindings)n.bindings.push(s.clone())}else e.push(i);return e}}class M7{constructor(e,i,n=null){this.isNodeAttribute=!0,this.name=e,this.type=i,this.node=n}}class K0e{constructor(e,i,n){this.isNodeUniform=!0,this.name=e,this.type=i,this.node=n.getSelf()}get value(){return this.node.value}set value(e){this.node.value=e}get id(){return this.node.id}get groupNode(){return this.node.groupNode}}class R7{constructor(e,i){this.isNodeVar=!0,this.name=e,this.type=i}}class J0e extends R7{constructor(e,i){super(e,i),this.needsInterpolation=!1,this.isNodeVarying=!0}}class Z0e{constructor(e,i,n=""){this.name=e,this.type=i,this.code=n,Object.defineProperty(this,"isNodeCode",{value:!0})}}let $0e=0;class FR{constructor(e=null){this.id=$0e++,this.nodesData=new WeakMap,this.parent=e}getData(e){let i=this.nodesData.get(e);return i===void 0&&this.parent!==null&&(i=this.parent.getData(e)),i}setData(e,i){this.nodesData.set(e,i)}}class $p{constructor(e,i){this.name=e,this.value=i,this.boundary=0,this.itemSize=0,this.offset=0}setValue(e){this.value=e}getValue(){return this.value}}class eAe extends $p{constructor(e,i=0){super(e,i),this.isNumberUniform=!0,this.boundary=4,this.itemSize=1}}class tAe extends $p{constructor(e,i=new Dn){super(e,i),this.isVector2Uniform=!0,this.boundary=8,this.itemSize=2}}class iAe extends $p{constructor(e,i=new Lt){super(e,i),this.isVector3Uniform=!0,this.boundary=16,this.itemSize=3}}class rAe extends $p{constructor(e,i=new Jn){super(e,i),this.isVector4Uniform=!0,this.boundary=16,this.itemSize=4}}class nAe extends $p{constructor(e,i=new Zn){super(e,i),this.isColorUniform=!0,this.boundary=16,this.itemSize=3}}class sAe extends $p{constructor(e,i=new Go){super(e,i),this.isMatrix3Uniform=!0,this.boundary=48,this.itemSize=12}}class aAe extends $p{constructor(e,i=new ws){super(e,i),this.isMatrix4Uniform=!0,this.boundary=64,this.itemSize=16}}class oAe extends eAe{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class lAe extends tAe{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class cAe extends iAe{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class uAe extends rAe{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class hAe extends nAe{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class dAe extends sAe{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class pAe extends aAe{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}const Ug=4,I7=[.125,.215,.35,.446,.526,.582],ef=20,UR=new L3(-1,1,1,-1,0,1),fAe=new $u(90,1),B7=new Zn;let zR=null,jR=0,VR=0;const tf=(1+Math.sqrt(5))/2,zg=1/tf,L7=[new Lt(-tf,zg,0),new Lt(tf,zg,0),new Lt(-zg,0,tf),new Lt(zg,0,tf),new Lt(0,tf,-zg),new Lt(0,tf,zg),new Lt(-1,1,-1),new Lt(1,1,-1),new Lt(-1,1,1),new Lt(1,1,1)],mAe=[3,1,5,0,4,2],GR=age(h_(),ah("faceIndex")).normalize(),HR=ei(GR.x,GR.y.negate(),GR.z);class gAe{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}fromScene(e,i=0,n=.1,s=100){zR=this._renderer.getRenderTarget(),jR=this._renderer.getActiveCubeFace(),VR=this._renderer.getActiveMipmapLevel(),this._setSize(256);const o=this._allocateTargets();return o.depthBuffer=!0,this._sceneToCubeUV(e,n,s,o),i>0&&this._blur(o,0,0,i),this._applyPMREM(o),this._cleanup(o),o}fromEquirectangular(e,i=null){return this._fromTexture(e,i)}fromCubemap(e,i=null){return this._fromTexture(e,i)}async compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=N7(),await this._compileMaterial(this._cubemapMaterial))}async compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=P7(),await this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(zR,jR,VR),e.scissorTest=!1,T_(e,0,0,e.width,e.height)}_fromTexture(e,i){e.mapping===Lp||e.mapping===tg?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),zR=this._renderer.getRenderTarget(),jR=this._renderer.getActiveCubeFace(),VR=this._renderer.getActiveMipmapLevel();const n=i||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),i=4*this._cubeSize,n={magFilter:dl,minFilter:dl,generateMipmaps:!1,type:Gu,format:sg,colorSpace:ud},s=D7(e,i,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==i){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=D7(e,i,n);const{_lodMax:o}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas,lodMeshes:this._lodMeshes}=AAe(o)),this._blurMaterial=yAe(o,e,i)}return s}async _compileMaterial(e){const i=new jp(this._lodPlanes[0],e);await this._renderer.compile(i,UR)}_sceneToCubeUV(e,i,n,s){const o=fAe;o.near=i,o.far=n;const l=[-1,1,-1,-1,-1,-1],u=[1,1,1,-1,-1,-1],c=this._renderer,h=c.autoClear;c.getClearColor(B7),c.autoClear=!1;let p=this._backgroundBox;if(p===null){const m=new k1({name:"PMREM.Background",side:mc,depthWrite:!1,depthTest:!1});p=new jp(new hy,m)}let f=!1;const g=e.background;g?g.isColor&&(p.material.color.copy(g),e.background=null,f=!0):(p.material.color.copy(B7),f=!0),c.setRenderTarget(s),c.clear(),f&&c.render(p,o);for(let m=0;m<6;m++){const y=m%3;y===0?(o.up.set(0,l[m],0),o.lookAt(u[m],0,0)):y===1?(o.up.set(0,0,l[m]),o.lookAt(0,u[m],0)):(o.up.set(0,l[m],0),o.lookAt(0,0,u[m]));const b=this._cubeSize;T_(s,y*b,m>2?b:0,b,b),c.render(e,o)}c.autoClear=h,e.background=g}_textureToCubeUV(e,i){const n=this._renderer,s=e.mapping===Lp||e.mapping===tg;s?this._cubemapMaterial===null&&(this._cubemapMaterial=N7(e)):this._equirectMaterial===null&&(this._equirectMaterial=P7(e));const o=s?this._cubemapMaterial:this._equirectMaterial;o.fragmentNode.value=e;const l=this._lodMeshes[0];l.material=o;const u=this._cubeSize;T_(i,0,0,3*u,2*u),n.setRenderTarget(i),n.render(l,UR)}_applyPMREM(e){const i=this._renderer,n=i.autoClear;i.autoClear=!1;const s=this._lodPlanes.length;for(let o=1;o<s;o++){const l=Math.sqrt(this._sigmas[o]*this._sigmas[o]-this._sigmas[o-1]*this._sigmas[o-1]),u=L7[(s-o-1)%L7.length];this._blur(e,o-1,o,l,u)}i.autoClear=n}_blur(e,i,n,s,o){const l=this._pingPongRenderTarget;this._halfBlur(e,l,i,n,s,"latitudinal",o),this._halfBlur(l,e,n,n,s,"longitudinal",o)}_halfBlur(e,i,n,s,o,l,u){const c=this._renderer,h=this._blurMaterial;l!=="latitudinal"&&l!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const p=3,f=this._lodMeshes[s];f.material=h;const g=h.uniforms,m=this._sizeLods[n]-1,y=isFinite(o)?Math.PI/(2*m):2*Math.PI/(2*ef-1),b=o/y,v=isFinite(o)?1+Math.floor(p*b):ef;v>ef&&console.warn(`sigmaRadians, ${o}, is too large and will clip, as it requested ${v} samples when the maximum is set to ${ef}`);const _=[];let T=0;for(let I=0;I<ef;++I){const N=I/b,D=Math.exp(-N*N/2);_.push(D),I===0?T+=D:I<v&&(T+=2*D)}for(let I=0;I<_.length;I++)_[I]=_[I]/T;e.texture.frame=(e.texture.frame||0)+1,g.envMap.value=e.texture,g.samples.value=v,g.weights.array=_,g.latitudinal.value=l==="latitudinal"?1:0,u&&(g.poleAxis.value=u);const{_lodMax:E}=this;g.dTheta.value=y,g.mipInt.value=E-n;const C=this._sizeLods[s],R=3*C*(s>E-Ug?s-E+Ug:0),B=4*(this._cubeSize-C);T_(i,R,B,3*C,2*C),c.setRenderTarget(i),c.render(f,UR)}}function AAe(r){const e=[],i=[],n=[],s=[];let o=r;const l=r-Ug+1+I7.length;for(let u=0;u<l;u++){const c=Math.pow(2,o);i.push(c);let h=1/c;u>r-Ug?h=I7[u-r+Ug-1]:u===0&&(h=0),n.push(h);const p=1/(c-2),f=-p,g=1+p,m=[f,f,g,f,g,g,f,f,g,g,f,g],y=6,b=6,v=3,_=2,T=1,E=new Float32Array(v*b*y),C=new Float32Array(_*b*y),R=new Float32Array(T*b*y);for(let I=0;I<y;I++){const N=I%3*2/3-1,D=I>2?0:-1,P=[N,D,0,N+2/3,D,0,N+2/3,D+1,0,N,D,0,N+2/3,D+1,0,N,D+1,0],k=mAe[I];E.set(P,v*b*k),C.set(m,_*b*k);const q=[k,k,k,k,k,k];R.set(q,T*b*k)}const B=new Up;B.setAttribute("position",new Ol(E,v)),B.setAttribute("uv",new Ol(C,_)),B.setAttribute("faceIndex",new Ol(R,T)),e.push(B),s.push(new jp(B,null)),o>Ug&&o--}return{lodPlanes:e,sizeLods:i,sigmas:n,lodMeshes:s}}function D7(r,e,i){const n=new hg(r,e,i);return n.texture.mapping=TM,n.texture.name="PMREM.cubeUv",n.texture.isPMREMTexture=!0,n.scissorTest=!0,n}function T_(r,e,i,n,s){r.viewport.set(e,i,n,s),r.scissor.set(e,i,n,s)}function WR(r){const e=new oa;return e.depthTest=!1,e.depthWrite=!1,e.blending=$m,e.name=`PMREM_${r}`,e}function yAe(r,e,i){const n=Cy(new Array(ef).fill(0)),s=Zr(new Lt(0,1,0)),o=Zr(0),l=ii(ef),u=Zr(0),c=Zr(1),h=Us(null),p=Zr(0),f=ii(1/e),g=ii(1/i),m=ii(r),y={n:l,latitudinal:u,weights:n,poleAxis:s,outputDirection:HR,dTheta:o,samples:c,envMap:h,mipInt:p,CUBEUV_TEXEL_WIDTH:f,CUBEUV_TEXEL_HEIGHT:g,CUBEUV_MAX_MIP:m},b=WR("blur");return b.uniforms=y,b.fragmentNode=lge({...y,latitudinal:u.equal(1)}),b}function N7(r){const e=WR("cubemap");return e.fragmentNode=wy(r,HR),e}function P7(r){const e=WR("equirect");return e.fragmentNode=Us(r,D8(HR),0),e}const O7=new WeakMap,vAe=new Map([[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]),bAe=new Map([[Int8Array,"int"],[Int16Array,"int"],[Int32Array,"int"],[Uint8Array,"uint"],[Uint16Array,"uint"],[Uint32Array,"uint"],[Float32Array,"float"]]),M_=r=>/e/g.test(r)?String(r).replace(/\+/g,""):(r=Number(r),r+(r%1?"":".0"));class k7{constructor(e,i,n){this.object=e,this.material=e&&e.material||null,this.geometry=e&&e.geometry||null,this.renderer=i,this.parser=n,this.scene=null,this.camera=null,this.nodes=[],this.sequentialNodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.updateAfterNodes=[],this.hashNodes={},this.monitor=null,this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.clippingContext=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:""},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.structs={vertex:[],fragment:[],compute:[],index:0},this.bindings={vertex:{},fragment:{},compute:{}},this.bindingsIndexes={},this.bindGroups=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.codes={},this.vars={},this.flow={code:""},this.chaining=[],this.stack=SR(),this.stacks=[],this.tab="	",this.currentFunctionNode=null,this.context={material:this.material},this.cache=new FR,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null,this.useComparisonMethod=!1}getBindGroupsCache(){let e=O7.get(this.renderer);return e===void 0&&(e=new Yc,O7.set(this.renderer,e)),e}createRenderTarget(e,i,n){return new hg(e,i,n)}createCubeRenderTarget(e,i){return new N8(e,i)}createPMREMGenerator(){return new gAe(this.renderer)}includes(e){return this.nodes.includes(e)}_getBindGroup(e,i){const n=this.getBindGroupsCache(),s=[];let o=!0;for(const u of i)s.push(u),o=o&&u.groupNode.shared!==!0;let l;return o?(l=n.get(s),l===void 0&&(l=new kR(e,s,this.bindingsIndexes[e].group,s),n.set(s,l))):l=new kR(e,s,this.bindingsIndexes[e].group,s),l}getBindGroupArray(e,i){const n=this.bindings[i];let s=n[e];return s===void 0&&(this.bindingsIndexes[e]===void 0&&(this.bindingsIndexes[e]={binding:0,group:Object.keys(this.bindingsIndexes).length}),n[e]=s=[]),s}getBindings(){let e=this.bindGroups;if(e===null){const i={},n=this.bindings;for(const s of b6)for(const o in n[s]){const l=n[s][o];(i[o]||(i[o]=[])).push(...l)}e=[];for(const s in i){const o=i[s],l=this._getBindGroup(s,o);e.push(l)}this.bindGroups=e}return e}sortBindingGroups(){const e=this.getBindings();e.sort((i,n)=>i.bindings[0].groupNode.order-n.bindings[0].groupNode.order);for(let i=0;i<e.length;i++){const n=e[i];this.bindingsIndexes[n.name].group=i,n.index=i}}setHashNode(e,i){this.hashNodes[i]=e}addNode(e){this.nodes.includes(e)===!1&&(this.nodes.push(e),this.setHashNode(e,e.getHash(this)))}addSequentialNode(e){this.sequentialNodes.includes(e)===!1&&this.sequentialNodes.push(e)}buildUpdateNodes(){for(const e of this.nodes)e.getUpdateType()!==un.NONE&&this.updateNodes.push(e.getSelf());for(const e of this.sequentialNodes){const i=e.getUpdateBeforeType(),n=e.getUpdateAfterType();i!==un.NONE&&this.updateBeforeNodes.push(e.getSelf()),n!==un.NONE&&this.updateAfterNodes.push(e.getSelf())}}get currentNode(){return this.chaining[this.chaining.length-1]}isFilteredTexture(e){return e.magFilter===dl||e.magFilter===RM||e.magFilter===rg||e.magFilter===Vu||e.minFilter===dl||e.minFilter===RM||e.minFilter===rg||e.minFilter===Vu}addChain(e){this.chaining.push(e)}removeChain(e){if(this.chaining.pop()!==e)throw new Error("NodeBuilder: Invalid node chaining!")}getMethod(e){return e}getNodeFromHash(e){return this.hashNodes[e]}addFlow(e,i){return this.flowNodes[e].push(i),i}setContext(e){this.context=e}getContext(){return this.context}getSharedContext(){return{...this.context},this.context}setCache(e){this.cache=e}getCache(){return this.cache}getCacheFromNode(e,i=!0){const n=this.getDataFromNode(e);return n.cache===void 0&&(n.cache=new FR(i?this.getCache():null)),n.cache}isAvailable(){return!1}getVertexIndex(){console.warn("Abstract function.")}getInstanceIndex(){console.warn("Abstract function.")}getDrawIndex(){console.warn("Abstract function.")}getFrontFacing(){console.warn("Abstract function.")}getFragCoord(){console.warn("Abstract function.")}isFlipY(){return!1}increaseUsage(e){const i=this.getDataFromNode(e);return i.usageCount=i.usageCount===void 0?1:i.usageCount+1,i.usageCount}generateTexture(){console.warn("Abstract function.")}generateTextureLod(){console.warn("Abstract function.")}generateConst(e,i=null){if(i===null&&(e==="float"||e==="int"||e==="uint"?i=0:e==="bool"?i=!1:e==="color"?i=new Zn:e==="vec2"?i=new Dn:e==="vec3"?i=new Lt:e==="vec4"&&(i=new Jn)),e==="float")return M_(i);if(e==="int")return`${Math.round(i)}`;if(e==="uint")return i>=0?`${Math.round(i)}u`:"0u";if(e==="bool")return i?"true":"false";if(e==="color")return`${this.getType("vec3")}( ${M_(i.r)}, ${M_(i.g)}, ${M_(i.b)} )`;const n=this.getTypeLength(e),s=this.getComponentType(e),o=l=>this.generateConst(s,l);if(n===2)return`${this.getType(e)}( ${o(i.x)}, ${o(i.y)} )`;if(n===3)return`${this.getType(e)}( ${o(i.x)}, ${o(i.y)}, ${o(i.z)} )`;if(n===4)return`${this.getType(e)}( ${o(i.x)}, ${o(i.y)}, ${o(i.z)}, ${o(i.w)} )`;if(n>4&&i&&(i.isMatrix3||i.isMatrix4))return`${this.getType(e)}( ${i.elements.map(o).join(", ")} )`;if(n>4)return`${this.getType(e)}()`;throw new Error(`NodeBuilder: Type '${e}' not found in generate constant attempt.`)}getType(e){return e==="color"?"vec3":e}hasGeometryAttribute(e){return this.geometry&&this.geometry.getAttribute(e)!==void 0}getAttribute(e,i){const n=this.attributes;for(const o of n)if(o.name===e)return o;const s=new M7(e,i);return n.push(s),s}getPropertyName(e){return e.name}isVector(e){return/vec\d/.test(e)}isMatrix(e){return/mat\d/.test(e)}isReference(e){return e==="void"||e==="property"||e==="sampler"||e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="depthTexture"||e==="texture3D"}needsToWorkingColorSpace(){return!1}getComponentTypeFromTexture(e){const i=e.type;if(e.isDataTexture){if(i===_o)return"int";if(i===Fa)return"uint"}return"float"}getElementType(e){return e==="mat2"?"vec2":e==="mat3"?"vec3":e==="mat4"?"vec4":this.getComponentType(e)}getComponentType(e){if(e=this.getVectorType(e),e==="float"||e==="bool"||e==="int"||e==="uint")return e;const i=/(b|i|u|)(vec|mat)([2-4])/.exec(e);return i===null?null:i[1]==="b"?"bool":i[1]==="i"?"int":i[1]==="u"?"uint":"float"}getVectorType(e){return e==="color"?"vec3":e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="texture3D"?"vec4":e}getTypeFromLength(e,i="float"){if(e===1)return i;const n=vAe.get(e);return(i==="float"?"":i[0])+n}getTypeFromArray(e){return bAe.get(e.constructor)}getTypeFromAttribute(e){let i=e;e.isInterleavedBufferAttribute&&(i=e.data);const n=i.array,s=e.itemSize,o=e.normalized;let l;return!(e instanceof GU)&&o!==!0&&(l=this.getTypeFromArray(n)),this.getTypeFromLength(s,l)}getTypeLength(e){const i=this.getVectorType(e),n=/vec([2-4])/.exec(i);return n!==null?Number(n[1]):i==="float"||i==="bool"||i==="int"||i==="uint"?1:/mat2/.test(e)===!0?4:/mat3/.test(e)===!0?9:/mat4/.test(e)===!0?16:0}getVectorFromMatrix(e){return e.replace("mat","vec")}changeComponentType(e,i){return this.getTypeFromLength(this.getTypeLength(e),i)}getIntegerType(e){const i=this.getComponentType(e);return i==="int"||i==="uint"?e:this.changeComponentType(e,"int")}addStack(){return this.stack=SR(this.stack),this.stacks.push(I6()||this.stack),t_(this.stack),this.stack}removeStack(){const e=this.stack;return this.stack=e.parent,t_(this.stacks.pop()),e}getDataFromNode(e,i=this.shaderStage,n=null){n=n===null?e.isGlobal(this)?this.globalCache:this.cache:n;let s=n.getData(e);return s===void 0&&(s={},n.setData(e,s)),s[i]===void 0&&(s[i]={}),s[i]}getNodeProperties(e,i="any"){const n=this.getDataFromNode(e,i);return n.properties||(n.properties={outputNode:null})}getBufferAttributeFromNode(e,i){const n=this.getDataFromNode(e);let s=n.bufferAttribute;if(s===void 0){const o=this.uniforms.index++;s=new M7("nodeAttribute"+o,i,e),this.bufferAttributes.push(s),n.bufferAttribute=s}return s}getStructTypeFromNode(e,i=this.shaderStage){const n=this.getDataFromNode(e,i);if(n.structType===void 0){const s=this.structs.index++;e.name=`StructType${s}`,this.structs[i].push(e),n.structType=e}return e}getUniformFromNode(e,i,n=this.shaderStage,s=null){const o=this.getDataFromNode(e,n,this.globalCache);let l=o.uniform;if(l===void 0){const u=this.uniforms.index++;l=new K0e(s||"nodeUniform"+u,i,e),this.uniforms[n].push(l),o.uniform=l}return l}getVarFromNode(e,i=null,n=e.getNodeType(this),s=this.shaderStage){const o=this.getDataFromNode(e,s);let l=o.variable;if(l===void 0){const u=this.vars[s]||(this.vars[s]=[]);i===null&&(i="nodeVar"+u.length),l=new R7(i,n),u.push(l),o.variable=l}return l}getVaryingFromNode(e,i=null,n=e.getNodeType(this)){const s=this.getDataFromNode(e,"any");let o=s.varying;if(o===void 0){const l=this.varyings,u=l.length;i===null&&(i="nodeVarying"+u),o=new J0e(i,n),l.push(o),s.varying=o}return o}getCodeFromNode(e,i,n=this.shaderStage){const s=this.getDataFromNode(e);let o=s.code;if(o===void 0){const l=this.codes[n]||(this.codes[n]=[]),u=l.length;o=new Z0e("nodeCode"+u,i),l.push(o),s.code=o}return o}addFlowCodeHierarchy(e,i){const{flowCodes:n,flowCodeBlock:s}=this.getDataFromNode(e);let o=!0,l=i;for(;l;){if(s.get(l)===!0){o=!1;break}l=this.getDataFromNode(l).parentNodeBlock}if(o)for(const u of n)this.addLineFlowCode(u)}addLineFlowCodeBlock(e,i,n){const s=this.getDataFromNode(e),o=s.flowCodes||(s.flowCodes=[]),l=s.flowCodeBlock||(s.flowCodeBlock=new WeakMap);o.push(i),l.set(n,!0)}addLineFlowCode(e,i=null){return e===""?this:(i!==null&&this.context.nodeBlock&&this.addLineFlowCodeBlock(i,e,this.context.nodeBlock),e=this.tab+e,/;\s*$/.test(e)||(e=e+`;
`),this.flow.code+=e,this)}addFlowCode(e){return this.flow.code+=e,this}addFlowTab(){return this.tab+="	",this}removeFlowTab(){return this.tab=this.tab.slice(0,-1),this}getFlowData(e){return this.flowsData.get(e)}flowNode(e){const i=e.getNodeType(this),n=this.flowChildNode(e,i);return this.flowsData.set(e,n),n}buildFunctionNode(e){const i=new S0e,n=this.currentFunctionNode;return this.currentFunctionNode=i,i.code=this.buildFunctionCode(e),this.currentFunctionNode=n,i}flowShaderNode(e){const i=e.layout,n={[Symbol.iterator](){let l=0;const u=Object.values(this);return{next:()=>({value:u[l],done:l++>=u.length})}}};for(const l of i.inputs)n[l.name]=new a0e(l.type,l.name);e.layout=null;const s=e.call(n),o=this.flowStagesNode(s,i.type);return e.layout=i,o}flowStagesNode(e,i=null){const n=this.flow,s=this.vars,o=this.cache,l=this.buildStage,u=this.stack,c={code:""};this.flow=c,this.vars={},this.cache=new FR,this.stack=SR();for(const h of v6)this.setBuildStage(h),c.result=e.build(this,i);return c.vars=this.getVars(this.shaderStage),this.flow=n,this.vars=s,this.cache=o,this.stack=u,this.setBuildStage(l),c}getFunctionOperator(){return null}flowChildNode(e,i=null){const n=this.flow,s={code:""};return this.flow=s,s.result=e.build(this,i),this.flow=n,s}flowNodeFromShaderStage(e,i,n=null,s=null){const o=this.shaderStage;this.setShaderStage(e);const l=this.flowChildNode(i,n);return s!==null&&(l.code+=`${this.tab+s} = ${l.result};
`),this.flowCode[e]=this.flowCode[e]+l.code,this.setShaderStage(o),l}getAttributesArray(){return this.attributes.concat(this.bufferAttributes)}getAttributes(){console.warn("Abstract function.")}getVaryings(){console.warn("Abstract function.")}getVar(e,i){return`${this.getType(e)} ${i}`}getVars(e){let i="";const n=this.vars[e];if(n!==void 0)for(const s of n)i+=`${this.getVar(s.type,s.name)}; `;return i}getUniforms(){console.warn("Abstract function.")}getCodes(e){const i=this.codes[e];let n="";if(i!==void 0)for(const s of i)n+=s.code+`
`;return n}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(e){this.shaderStage=e}getShaderStage(){return this.shaderStage}setBuildStage(e){this.buildStage=e}getBuildStage(){return this.buildStage}buildCode(){console.warn("Abstract function.")}build(){const{object:e,material:i,renderer:n}=this;if(i!==null){let s=n.library.fromMaterial(i);s===null&&(console.error(`NodeMaterial: Material "${i.type}" is not compatible.`),s=new oa),s.build(this)}else this.addFlow("compute",e);for(const s of v6){this.setBuildStage(s),this.context.vertex&&this.context.vertex.isNode&&this.flowNodeFromShaderStage("vertex",this.context.vertex);for(const o of b6){this.setShaderStage(o);const l=this.flowNodes[o];for(const u of l)s==="generate"?this.flowNode(u):u.build(this)}}return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this.buildUpdateNodes(),this}getNodeUniform(e,i){if(i==="float"||i==="int"||i==="uint")return new oAe(e);if(i==="vec2"||i==="ivec2"||i==="uvec2")return new lAe(e);if(i==="vec3"||i==="ivec3"||i==="uvec3")return new cAe(e);if(i==="vec4"||i==="ivec4"||i==="uvec4")return new uAe(e);if(i==="color")return new hAe(e);if(i==="mat3")return new dAe(e);if(i==="mat4")return new pAe(e);throw new Error(`Uniform "${i}" not declared.`)}createNodeMaterial(e="NodeMaterial"){throw new Error(`THREE.NodeBuilder: createNodeMaterial() was deprecated. Use new ${e}() instead.`)}format(e,i,n){if(i=this.getVectorType(i),n=this.getVectorType(n),i===n||n===null||this.isReference(n))return e;const s=this.getTypeLength(i),o=this.getTypeLength(n);return s===16&&o===9?`${this.getType(n)}(${e}[0].xyz, ${e}[1].xyz, ${e}[2].xyz)`:s===9&&o===4?`${this.getType(n)}(${e}[0].xy, ${e}[1].xy)`:s>4||o>4||o===0?e:s===o?`${this.getType(n)}( ${e} )`:s>o?this.format(`${e}.${"xyz".slice(0,o)}`,this.getTypeFromLength(o,this.getComponentType(i)),n):o===4&&s>1?`${this.getType(n)}( ${this.format(e,i,"vec3")}, 1.0 )`:s===2?`${this.getType(n)}( ${this.format(e,i,"vec2")}, 0.0 )`:(s===1&&o>1&&i!==this.getComponentType(n)&&(e=`${this.getType(this.getComponentType(n))}( ${e} )`),`${this.getType(n)}( ${e} )`)}getSignature(){return`// Three.js r${f1} - Node System
`}}class F7{constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.startTime=null,this.updateMap=new WeakMap,this.updateBeforeMap=new WeakMap,this.updateAfterMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null}_getMaps(e,i){let n=e.get(i);return n===void 0&&(n={renderMap:new WeakMap,frameMap:new WeakMap},e.set(i,n)),n}updateBeforeNode(e){const i=e.getUpdateBeforeType(),n=e.updateReference(this);if(i===un.FRAME){const{frameMap:s}=this._getMaps(this.updateBeforeMap,n);s.get(n)!==this.frameId&&e.updateBefore(this)!==!1&&s.set(n,this.frameId)}else if(i===un.RENDER){const{renderMap:s}=this._getMaps(this.updateBeforeMap,n);s.get(n)!==this.renderId&&e.updateBefore(this)!==!1&&s.set(n,this.renderId)}else i===un.OBJECT&&e.updateBefore(this)}updateAfterNode(e){const i=e.getUpdateAfterType(),n=e.updateReference(this);if(i===un.FRAME){const{frameMap:s}=this._getMaps(this.updateAfterMap,n);s.get(n)!==this.frameId&&e.updateAfter(this)!==!1&&s.set(n,this.frameId)}else if(i===un.RENDER){const{renderMap:s}=this._getMaps(this.updateAfterMap,n);s.get(n)!==this.renderId&&e.updateAfter(this)!==!1&&s.set(n,this.renderId)}else i===un.OBJECT&&e.updateAfter(this)}updateNode(e){const i=e.getUpdateType(),n=e.updateReference(this);if(i===un.FRAME){const{frameMap:s}=this._getMaps(this.updateMap,n);s.get(n)!==this.frameId&&e.update(this)!==!1&&s.set(n,this.frameId)}else if(i===un.RENDER){const{renderMap:s}=this._getMaps(this.updateMap,n);s.get(n)!==this.renderId&&e.update(this)!==!1&&s.set(n,this.renderId)}else i===un.OBJECT&&e.update(this)}update(){this.frameId++,this.lastTime===void 0&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}}class QR{constructor(e,i,n=null,s="",o=!1){this.type=e,this.name=i,this.count=n,this.qualifier=s,this.isConst=o}}QR.isNodeFunctionInput=!0;class xAe extends Zp{static get type(){return"DirectionalLightNode"}constructor(e=null){super(e)}setup(e){super.setup(e);const i=e.context.lightingModel,n=this.colorNode,s=C7(this.light),o=e.context.reflectedLight;i.direct({lightDirection:s,lightColor:n,reflectedLight:o},e.stack,e)}}const qR=new ws,R_=new ws;let ky=null;class _Ae extends Zp{static get type(){return"RectAreaLightNode"}constructor(e=null){super(e),this.halfHeight=Zr(new Lt).setGroup(Tn),this.halfWidth=Zr(new Lt).setGroup(Tn),this.updateType=un.RENDER}update(e){super.update(e);const{light:i}=this,n=e.camera.matrixWorldInverse;R_.identity(),qR.copy(i.matrixWorld),qR.premultiply(n),R_.extractRotation(qR),this.halfWidth.value.set(i.width*.5,0,0),this.halfHeight.value.set(0,i.height*.5,0),this.halfWidth.value.applyMatrix4(R_),this.halfHeight.value.applyMatrix4(R_)}setup(e){super.setup(e);let i,n;e.isAvailable("float32Filterable")?(i=Us(ky.LTC_FLOAT_1),n=Us(ky.LTC_FLOAT_2)):(i=Us(ky.LTC_HALF_1),n=Us(ky.LTC_HALF_2));const{colorNode:s,light:o}=this,l=e.context.lightingModel,u=PR(o),c=e.context.reflectedLight;l.directRectArea({lightColor:s,lightPosition:u,halfWidth:this.halfWidth,halfHeight:this.halfHeight,reflectedLight:c,ltc_1:i,ltc_2:n},e.stack,e)}static setLTC(e){ky=e}}class U7 extends Zp{static get type(){return"SpotLightNode"}constructor(e=null){super(e),this.coneCosNode=Zr(0).setGroup(Tn),this.penumbraCosNode=Zr(0).setGroup(Tn),this.cutoffDistanceNode=Zr(0).setGroup(Tn),this.decayExponentNode=Zr(0).setGroup(Tn)}update(e){super.update(e);const{light:i}=this;this.coneCosNode.value=Math.cos(i.angle),this.penumbraCosNode.value=Math.cos(i.angle*(1-i.penumbra)),this.cutoffDistanceNode.value=i.distance,this.decayExponentNode.value=i.decay}getSpotAttenuation(e){const{coneCosNode:i,penumbraCosNode:n}=this;return Qp(i,n,e)}setup(e){super.setup(e);const i=e.context.lightingModel,{colorNode:n,cutoffDistanceNode:s,decayExponentNode:o,light:l}=this,u=PR(l).sub(Va),c=u.normalize(),h=c.dot(C7(l)),p=this.getSpotAttenuation(h),f=u.length(),g=T7({lightDistance:f,cutoffDistance:s,decayExponent:o}),m=n.mul(p).mul(g),y=e.context.reflectedLight;i.direct({lightDirection:c,lightColor:m,reflectedLight:y},e.stack,e)}}class EAe extends U7{static get type(){return"IESSpotLightNode"}getSpotAttenuation(e){const i=this.light.iesMap;let n=null;if(i&&i.isTexture===!0){const s=e.acos().mul(1/Math.PI);n=Us(i,Ki(s,0),0).r}else n=super.getSpotAttenuation(e);return n}}class wAe extends Zp{static get type(){return"AmbientLightNode"}constructor(e=null){super(e)}setup({context:e}){e.irradiance.addAssign(this.colorNode)}}class CAe extends Zp{static get type(){return"HemisphereLightNode"}constructor(e=null){super(e),this.lightPositionNode=w7(e),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=Zr(new Zn).setGroup(Tn)}update(e){const{light:i}=this;super.update(e),this.lightPositionNode.object3d=i,this.groundColorNode.value.copy(i.groundColor).multiplyScalar(i.intensity)}setup(e){const{colorNode:i,groundColorNode:n,lightDirectionNode:s}=this,o=Cc.dot(s).mul(.5).add(.5),l=As(n,i,o);e.context.irradiance.addAssign(l)}}class SAe extends Zp{static get type(){return"LightProbeNode"}constructor(e=null){super(e);const i=[];for(let n=0;n<9;n++)i.push(new Lt);this.lightProbe=Cy(i)}update(e){const{light:i}=this;super.update(e);for(let n=0;n<9;n++)this.lightProbe.array[n].copy(i.sh.coefficients[n]).multiplyScalar(i.intensity)}setup(e){const i=Q0e(h8,this.lightProbe);e.context.irradiance.addAssign(i)}}class z7{parseFunction(){console.warn("Abstract function.")}}class XR{constructor(e,i,n="",s=""){this.type=e,this.inputs=i,this.name=n,this.precision=s}getCode(){console.warn("Abstract function.")}}XR.isNodeFunction=!0;const TAe=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,MAe=/[a-z_0-9]+/ig,j7="#pragma main",RAe=r=>{r=r.trim();const e=r.indexOf(j7),i=e!==-1?r.slice(e+j7.length):r,n=i.match(TAe);if(n!==null&&n.length===5){const s=n[4],o=[];let l=null;for(;(l=MAe.exec(s))!==null;)o.push(l);const u=[];let c=0;for(;c<o.length;){const y=o[c][0]==="const";y===!0&&c++;let b=o[c][0];b==="in"||b==="out"||b==="inout"?c++:b="";const v=o[c++][0];let _=Number.parseInt(o[c][0]);Number.isNaN(_)===!1?c++:_=null;const T=o[c++][0];u.push(new QR(v,T,_,b,y))}const h=i.substring(n[0].length),p=n[3]!==void 0?n[3]:"",f=n[2],g=n[1]!==void 0?n[1]:"",m=e!==-1?r.slice(0,e):"";return{type:f,inputs:u,name:p,precision:g,inputsCode:s,blockCode:h,headerCode:m}}else throw new Error("FunctionNode: Function is not a GLSL code.")};class IAe extends XR{constructor(e){const{type:i,inputs:n,name:s,precision:o,inputsCode:l,blockCode:u,headerCode:c}=RAe(e);super(i,n,s,o),this.inputsCode=l,this.blockCode=u,this.headerCode=c}getCode(e=this.name){let i;const n=this.blockCode;if(n!==""){const{type:s,inputsCode:o,headerCode:l,precision:u}=this;let c=`${s} ${e} ( ${o.trim()} )`;u!==""&&(c=`${u} ${c}`),i=l+c+n}else i="";return i}}class BAe extends z7{parseFunction(e){return new IAe(e)}}const V7=new WeakMap;class LAe extends wd{constructor(e,i){super(),this.renderer=e,this.backend=i,this.nodeFrame=new F7,this.nodeBuilderCache=new Map,this.callHashCache=new Yc,this.groupsData=new Yc}updateGroup(e){const i=e.groupNode,n=i.name;if(n===D6.name)return!0;if(n===Tn.name){const l=this.get(e),u=this.nodeFrame.renderId;return l.renderId!==u?(l.renderId=u,!0):!1}if(n===mde.name){const l=this.get(e),u=this.nodeFrame.frameId;return l.frameId!==u?(l.frameId=u,!0):!1}const s=[i,e];let o=this.groupsData.get(s);return o===void 0&&this.groupsData.set(s,o={}),o.version!==i.version?(o.version=i.version,!0):!1}getForRenderCacheKey(e){return e.initialCacheKey}getForRender(e){const i=this.get(e);let n=i.nodeBuilderState;if(n===void 0){const{nodeBuilderCache:s}=this,o=this.getForRenderCacheKey(e);if(n=s.get(o),n===void 0){const l=this.backend.createNodeBuilder(e.object,this.renderer);l.scene=e.scene,l.material=e.material,l.camera=e.camera,l.context.material=e.material,l.lightsNode=e.lightsNode,l.environmentNode=this.getEnvironmentNode(e.scene),l.fogNode=this.getFogNode(e.scene),l.clippingContext=e.clippingContext,l.build(),n=this._createNodeBuilderState(l),s.set(o,n)}n.usedTimes++,i.nodeBuilderState=n}return n}delete(e){if(e.isRenderObject){const i=this.get(e).nodeBuilderState;i.usedTimes--,i.usedTimes===0&&this.nodeBuilderCache.delete(this.getForRenderCacheKey(e))}return super.delete(e)}getForCompute(e){const i=this.get(e);let n=i.nodeBuilderState;if(n===void 0){const s=this.backend.createNodeBuilder(e,this.renderer);s.build(),n=this._createNodeBuilderState(s),i.nodeBuilderState=n}return n}_createNodeBuilderState(e){return new Y0e(e.vertexShader,e.fragmentShader,e.computeShader,e.getAttributesArray(),e.getBindings(),e.updateNodes,e.updateBeforeNodes,e.updateAfterNodes,e.monitor,e.transforms)}getEnvironmentNode(e){return e.environmentNode||this.get(e).environmentNode||null}getBackgroundNode(e){return e.backgroundNode||this.get(e).backgroundNode||null}getFogNode(e){return e.fogNode||this.get(e).fogNode||null}getCacheKey(e,i){const n=[e,i],s=this.renderer.info.calls;let o=this.callHashCache.get(n);if(o===void 0||o.callId!==s){const l=this.getEnvironmentNode(e),u=this.getFogNode(e),c=[];i&&c.push(i.getCacheKey(!0)),l&&c.push(l.getCacheKey()),u&&c.push(u.getCacheKey()),c.push(this.renderer.shadowMap.enabled?1:0),o={callId:s,cacheKey:m6(c)},this.callHashCache.set(n,o)}return o.cacheKey}updateScene(e){this.updateEnvironment(e),this.updateFog(e),this.updateBackground(e)}get isToneMappingState(){return!this.renderer.getRenderTarget()}updateBackground(e){const i=this.get(e),n=e.background;if(n){const s=e.backgroundBlurriness===0&&i.backgroundBlurriness>0||e.backgroundBlurriness>0&&i.backgroundBlurriness===0;if(i.background!==n||s){let o=null;if(n.isCubeTexture===!0||n.mapping===YA||n.mapping===KA||n.mapping===TM)if(e.backgroundBlurriness>0||n.mapping===TM)o=o7(n);else{let l;n.isCubeTexture===!0?l=wy(n):l=Us(n),o=k8(l)}else n.isTexture===!0?o=Us(n,Iy.flipY()).setUpdateMatrix(!0):n.isColor!==!0&&console.error("WebGPUNodes: Unsupported background configuration.",n);i.backgroundNode=o,i.background=n,i.backgroundBlurriness=e.backgroundBlurriness}}else i.backgroundNode&&(delete i.backgroundNode,delete i.background)}updateFog(e){const i=this.get(e),n=e.fog;if(n){if(i.fog!==n){let s=null;if(n.isFogExp2){const o=Bs("color","color",n).setGroup(Tn),l=Bs("density","float",n).setGroup(Tn);s=I0e(o,l)}else if(n.isFog){const o=Bs("color","color",n).setGroup(Tn),l=Bs("near","float",n).setGroup(Tn),u=Bs("far","float",n).setGroup(Tn);s=M0e(o,l,u)}else console.error("WebGPUNodes: Unsupported fog configuration.",n);i.fogNode=s,i.fog=n}}else delete i.fogNode,delete i.fog}updateEnvironment(e){const i=this.get(e),n=e.environment;if(n){if(i.environment!==n){let s=null;n.isCubeTexture===!0?s=wy(n):n.isTexture===!0?s=Us(n):console.error("Nodes: Unsupported environment configuration.",n),i.environmentNode=s,i.environment=n}}else i.environmentNode&&(delete i.environmentNode,delete i.environment)}getNodeFrame(e=this.renderer,i=null,n=null,s=null,o=null){const l=this.nodeFrame;return l.renderer=e,l.scene=i,l.object=n,l.camera=s,l.material=o,l}getNodeFrameForRender(e){return this.getNodeFrame(e.renderer,e.scene,e.object,e.camera,e.material)}getOutputCacheKey(){const e=this.renderer;return e.toneMapping+","+e.currentColorSpace}hasOutputChange(e){return V7.get(e)!==this.getOutputCacheKey()}getOutputNode(e){const i=this.renderer,n=this.getOutputCacheKey(),s=Us(e,Iy).renderOutput(i.toneMapping,i.currentColorSpace);return V7.set(e,n),s}updateBefore(e){const i=e.getNodeBuilderState();for(const n of i.updateBeforeNodes)this.getNodeFrameForRender(e).updateBeforeNode(n)}updateAfter(e){const i=e.getNodeBuilderState();for(const n of i.updateAfterNodes)this.getNodeFrameForRender(e).updateAfterNode(n)}updateForCompute(e){const i=this.getNodeFrame(),n=this.getForCompute(e);for(const s of n.updateNodes)i.updateNode(s)}updateForRender(e){const i=this.getNodeFrameForRender(e),n=e.getNodeBuilderState();for(const s of n.updateNodes)i.updateNode(s)}needsRefresh(e){const i=this.getNodeFrameForRender(e);return e.getMonitor().needsRefresh(e,i)}dispose(){super.dispose(),this.nodeFrame=new F7,this.nodeBuilderCache=new Map}}class DAe{constructor(e,i){this.scene=e,this.camera=i}clone(){return Object.assign(new this.constructor,this)}}class NAe{constructor(){this.lists=new Yc}get(e,i){const n=this.lists,s=[e,i];let o=n.get(s);return o===void 0&&(o=new DAe(e,i),n.set(s,o)),o}dispose(){this.lists=new Yc}}class G7{constructor(){this.lightNodes=new WeakMap,this.materialNodes=new Map,this.toneMappingNodes=new Map}fromMaterial(e){if(e.isNodeMaterial)return e;let i=null;const n=this.getMaterialNodeClass(e.type);if(n!==null){i=new n;for(const s in e)i[s]=e[s]}return i}addToneMapping(e,i){this.addType(e,i,this.toneMappingNodes)}getToneMappingFunction(e){return this.toneMappingNodes.get(e)||null}getMaterialNodeClass(e){return this.materialNodes.get(e)||null}addMaterial(e,i){this.addType(e,i.type,this.materialNodes)}getLightNodeClass(e){return this.lightNodes.get(e)||null}addLight(e,i){this.addClass(e,i,this.lightNodes)}addType(e,i,n){if(n.has(i)){console.warn(`Redefinition of node ${i}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof i=="function"||typeof i=="object")throw new Error(`Base class ${i} is not a class.`);n.set(i,e)}addClass(e,i,n){if(n.has(i)){console.warn(`Redefinition of node ${i.name}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof i!="function")throw new Error(`Base class ${i.name} is not a class.`);n.set(i,e)}}const PAe=new S7;class OAe extends Yc{constructor(){super()}createNode(e=[]){return new S7().setLights(e)}getNode(e,i){if(e.isQuadMesh)return PAe;const n=[e,i];let s=this.get(n);return s===void 0&&(s=this.createNode(),this.set(n,s)),s}}const H7=new ZU,I_=new Dn,YR=new Jn,KR=new t6,B_=new ws,Td=new Jn;class kAe{constructor(e,i={}){this.isRenderer=!0;const{logarithmicDepthBuffer:n=!1,alpha:s=!0,depth:o=!0,stencil:l=!1,antialias:u=!1,samples:c=0,getFallback:h=null}=i;this.domElement=e.getDomElement(),this.backend=e,this.samples=c||u===!0?4:0,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.alpha=s,this.logarithmicDepthBuffer=n,this.outputColorSpace=Dr,this.toneMapping=eg,this.toneMappingExposure=1,this.sortObjects=!0,this.depth=o,this.stencil=l,this.clippingPlanes=[],this.info=new Qge,this.nodes={modelViewMatrix:null,modelNormalViewMatrix:null},this.library=new G7,this.lighting=new OAe,this._getFallback=h,this._pixelRatio=1,this._width=this.domElement.width,this._height=this.domElement.height,this._viewport=new Jn(0,0,this._width,this._height),this._scissor=new Jn(0,0,this._width,this._height),this._scissorTest=!1,this._attributes=null,this._geometries=null,this._nodes=null,this._animation=null,this._bindings=null,this._objects=null,this._pipelines=null,this._bundles=null,this._renderLists=null,this._renderContexts=null,this._textures=null,this._background=null,this._quad=new A7(new oa),this._quad.material.type="Renderer_output",this._currentRenderContext=null,this._opaqueSort=null,this._transparentSort=null,this._frameBufferTarget=null;const p=this.alpha===!0?0:1;this._clearColor=new CR(0,0,0,p),this._clearDepth=1,this._clearStencil=0,this._renderTarget=null,this._activeCubeFace=0,this._activeMipmapLevel=0,this._mrt=null,this._renderObjectFunction=null,this._currentRenderObjectFunction=null,this._currentRenderBundle=null,this._handleObjectFunction=this._renderObjectDirect,this._isDeviceLost=!1,this.onDeviceLost=this._onDeviceLost,this._initialized=!1,this._initPromise=null,this._compilationPromises=null,this.transparent=!0,this.opaque=!0,this.shadowMap={enabled:!1,type:qce},this.xr={enabled:!1},this.debug={checkShaderErrors:!0,onShaderError:null,getShaderAsync:async(f,g,m)=>{await this.compileAsync(f,g);const y=this._renderLists.get(f,g),b=this._renderContexts.get(f,g,this._renderTarget),v=f.overrideMaterial||m.material,_=this._objects.get(m,v,f,g,y.lightsNode,b),{fragmentShader:T,vertexShader:E}=_.getNodeBuilderState();return{fragmentShader:T,vertexShader:E}}}}async init(){if(this._initialized)throw new Error("Renderer: Backend has already been initialized.");return this._initPromise!==null?this._initPromise:(this._initPromise=new Promise(async(e,i)=>{let n=this.backend;try{await n.init(this)}catch(s){if(this._getFallback!==null)try{this.backend=n=this._getFallback(s),await n.init(this)}catch(o){i(o);return}else{i(s);return}}this._nodes=new LAe(this,n),this._animation=new Oge(this._nodes,this.info),this._attributes=new Gge(n),this._background=new q0e(this,this._nodes),this._geometries=new Wge(this._attributes,this.info),this._textures=new s0e(this,n,this.info),this._pipelines=new Kge(n,this._nodes),this._bindings=new Jge(n,this._nodes,this._textures,this._attributes,this._pipelines,this.info),this._objects=new zge(this,this._nodes,this._geometries,this._pipelines,this._bindings,this.info),this._renderLists=new e0e(this.lighting),this._bundles=new NAe,this._renderContexts=new r0e,this._initialized=!0,e()}),this._initPromise)}get coordinateSystem(){return this.backend.coordinateSystem}async compileAsync(e,i,n=null){if(this._isDeviceLost===!0)return;this._initialized===!1&&await this.init();const s=this._nodes.nodeFrame,o=s.renderId,l=this._currentRenderContext,u=this._currentRenderObjectFunction,c=this._compilationPromises,h=e.isScene===!0?e:H7;n===null&&(n=e);const p=this._renderTarget,f=this._renderContexts.get(n,i,p),g=this._activeMipmapLevel,m=[];this._currentRenderContext=f,this._currentRenderObjectFunction=this.renderObject,this._handleObjectFunction=this._createObjectPipeline,this._compilationPromises=m,s.renderId++,s.update(),f.depth=this.depth,f.stencil=this.stencil,f.clippingContext||(f.clippingContext=new ER),f.clippingContext.updateGlobal(this,i),h.onBeforeRender(this,e,i,p);const y=this._renderLists.get(e,i);if(y.begin(),this._projectObject(e,i,0,y),n!==e&&n.traverseVisible(function(T){T.isLight&&T.layers.test(i.layers)&&y.pushLight(T)}),y.finish(),p!==null){this._textures.updateRenderTarget(p,g);const T=this._textures.get(p);f.textures=T.textures,f.depthTexture=T.depthTexture}else f.textures=null,f.depthTexture=null;this._nodes.updateScene(h),this._background.update(h,y,f);const b=y.opaque,v=y.transparent,_=y.lightsNode;this.opaque===!0&&b.length>0&&this._renderObjects(b,i,h,_),this.transparent===!0&&v.length>0&&this._renderTransparents(v,i,h,_),s.renderId=o,this._currentRenderContext=l,this._currentRenderObjectFunction=u,this._compilationPromises=c,this._handleObjectFunction=this._renderObjectDirect,await Promise.all(m)}async renderAsync(e,i){this._initialized===!1&&await this.init();const n=this._renderScene(e,i);await this.backend.resolveTimestampAsync(n,"render")}async waitForGPU(){await this.backend.waitForGPU()}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}_onDeviceLost(e){let i=`THREE.WebGPURenderer: ${e.api} Device Lost:

Message: ${e.message}`;e.reason&&(i+=`
Reason: ${e.reason}`),console.error(i),this._isDeviceLost=!0}_renderBundle(e,i,n){const{bundleGroup:s,camera:o,renderList:l}=e,u=this._currentRenderContext,c=this._bundles.get(s,o),h=this.backend.get(c);h.renderContexts===void 0&&(h.renderContexts=new Set);const p=s.version!==h.version,f=h.renderContexts.has(u)===!1||p;if(h.renderContexts.add(u),f){this.backend.beginBundle(u),(h.renderObjects===void 0||p)&&(h.renderObjects=[]),this._currentRenderBundle=c;const g=l.opaque;this.opaque===!0&&g.length>0&&this._renderObjects(g,o,i,n),this._currentRenderBundle=null,this.backend.finishBundle(u,c),h.version=s.version}else{const{renderObjects:g}=h;for(let m=0,y=g.length;m<y;m++){const b=g[m];this._nodes.needsRefresh(b)&&(this._nodes.updateBefore(b),this._nodes.updateForRender(b),this._bindings.updateForRender(b),this._nodes.updateAfter(b))}}this.backend.addBundle(u,c)}render(e,i){if(this._initialized===!1)return console.warn("THREE.Renderer: .render() called before the backend is initialized. Try using .renderAsync() instead."),this.renderAsync(e,i);this._renderScene(e,i)}_getFrameBufferTarget(){const{currentToneMapping:e,currentColorSpace:i}=this;if(e===eg&&i===ud)return null;const{width:n,height:s}=this.getDrawingBufferSize(I_),{depth:o,stencil:l}=this;let u=this._frameBufferTarget;return u===null&&(u=new hg(n,s,{depthBuffer:o,stencilBuffer:l,type:Gu,format:sg,colorSpace:ud,generateMipmaps:!1,minFilter:dl,magFilter:dl,samples:this.samples}),u.isPostProcessingRenderTarget=!0,this._frameBufferTarget=u),u.depthBuffer=o,u.stencilBuffer=l,u.setSize(n,s),u.viewport.copy(this._viewport),u.scissor.copy(this._scissor),u.viewport.multiplyScalar(this._pixelRatio),u.scissor.multiplyScalar(this._pixelRatio),u.scissorTest=this._scissorTest,u}_renderScene(e,i,n=!0){if(this._isDeviceLost===!0)return;const s=n?this._getFrameBufferTarget():null,o=this._nodes.nodeFrame,l=o.renderId,u=this._currentRenderContext,c=this._currentRenderObjectFunction,h=e.isScene===!0?e:H7,p=this._renderTarget,f=this._activeCubeFace,g=this._activeMipmapLevel;let m;s!==null?(m=s,this.setRenderTarget(m)):m=p;const y=this._renderContexts.get(e,i,m);this._currentRenderContext=y,this._currentRenderObjectFunction=this._renderObjectFunction||this.renderObject,this.info.calls++,this.info.render.calls++,this.info.render.frameCalls++,o.renderId=this.info.calls;const b=this.coordinateSystem;i.coordinateSystem!==b&&(i.coordinateSystem=b,i.updateProjectionMatrix()),e.matrixWorldAutoUpdate===!0&&e.updateMatrixWorld(),i.parent===null&&i.matrixWorldAutoUpdate===!0&&i.updateMatrixWorld();let v=this._viewport,_=this._scissor,T=this._pixelRatio;m!==null&&(v=m.viewport,_=m.scissor,T=1),this.getDrawingBufferSize(I_),YR.set(0,0,I_.width,I_.height);const E=v.minDepth===void 0?0:v.minDepth,C=v.maxDepth===void 0?1:v.maxDepth;y.viewportValue.copy(v).multiplyScalar(T).floor(),y.viewportValue.width>>=g,y.viewportValue.height>>=g,y.viewportValue.minDepth=E,y.viewportValue.maxDepth=C,y.viewport=y.viewportValue.equals(YR)===!1,y.scissorValue.copy(_).multiplyScalar(T).floor(),y.scissor=this._scissorTest&&y.scissorValue.equals(YR)===!1,y.scissorValue.width>>=g,y.scissorValue.height>>=g,y.clippingContext||(y.clippingContext=new ER),y.clippingContext.updateGlobal(this,i),h.onBeforeRender(this,e,i,m),B_.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),KR.setFromProjectionMatrix(B_,b);const R=this._renderLists.get(e,i);if(R.begin(),this._projectObject(e,i,0,R),R.finish(),this.sortObjects===!0&&R.sort(this._opaqueSort,this._transparentSort),m!==null){this._textures.updateRenderTarget(m,g);const k=this._textures.get(m);y.textures=k.textures,y.depthTexture=k.depthTexture,y.width=k.width,y.height=k.height,y.renderTarget=m,y.depth=m.depthBuffer,y.stencil=m.stencilBuffer}else y.textures=null,y.depthTexture=null,y.width=this.domElement.width,y.height=this.domElement.height,y.depth=this.depth,y.stencil=this.stencil;y.width>>=g,y.height>>=g,y.activeCubeFace=f,y.activeMipmapLevel=g,y.occlusionQueryCount=R.occlusionQueryCount,this._nodes.updateScene(h),this._background.update(h,R,y),this.backend.beginRender(y);const{bundles:B,lightsNode:I,transparentDoublePass:N,transparent:D,opaque:P}=R;if(B.length>0&&this._renderBundles(B,h,I),this.opaque===!0&&P.length>0&&this._renderObjects(P,i,h,I),this.transparent===!0&&D.length>0&&this._renderTransparents(D,N,i,h,I),this.backend.finishRender(y),o.renderId=l,this._currentRenderContext=u,this._currentRenderObjectFunction=c,s!==null){this.setRenderTarget(p,f,g);const k=this._quad;this._nodes.hasOutputChange(m.texture)&&(k.material.fragmentNode=this._nodes.getOutputNode(m.texture),k.material.needsUpdate=!0),this._renderScene(k,k.camera,!1)}return h.onAfterRender(this,e,i,m),y}getMaxAnisotropy(){return this.backend.getMaxAnisotropy()}getActiveCubeFace(){return this._activeCubeFace}getActiveMipmapLevel(){return this._activeMipmapLevel}async setAnimationLoop(e){this._initialized===!1&&await this.init(),this._animation.setAnimationLoop(e)}async getArrayBufferAsync(e){return await this.backend.getArrayBufferAsync(e)}getContext(){return this.backend.getContext()}getPixelRatio(){return this._pixelRatio}getDrawingBufferSize(e){return e.set(this._width*this._pixelRatio,this._height*this._pixelRatio).floor()}getSize(e){return e.set(this._width,this._height)}setPixelRatio(e=1){this._pixelRatio!==e&&(this._pixelRatio=e,this.setSize(this._width,this._height,!1))}setDrawingBufferSize(e,i,n){this._width=e,this._height=i,this._pixelRatio=n,this.domElement.width=Math.floor(e*n),this.domElement.height=Math.floor(i*n),this.setViewport(0,0,e,i),this._initialized&&this.backend.updateSize()}setSize(e,i,n=!0){this._width=e,this._height=i,this.domElement.width=Math.floor(e*this._pixelRatio),this.domElement.height=Math.floor(i*this._pixelRatio),n===!0&&(this.domElement.style.width=e+"px",this.domElement.style.height=i+"px"),this.setViewport(0,0,e,i),this._initialized&&this.backend.updateSize()}setOpaqueSort(e){this._opaqueSort=e}setTransparentSort(e){this._transparentSort=e}getScissor(e){const i=this._scissor;return e.x=i.x,e.y=i.y,e.width=i.width,e.height=i.height,e}setScissor(e,i,n,s){const o=this._scissor;e.isVector4?o.copy(e):o.set(e,i,n,s)}getScissorTest(){return this._scissorTest}setScissorTest(e){this._scissorTest=e,this.backend.setScissorTest(e)}getViewport(e){return e.copy(this._viewport)}setViewport(e,i,n,s,o=0,l=1){const u=this._viewport;e.isVector4?u.copy(e):u.set(e,i,n,s),u.minDepth=o,u.maxDepth=l}getClearColor(e){return e.copy(this._clearColor)}setClearColor(e,i=1){this._clearColor.set(e),this._clearColor.a=i}getClearAlpha(){return this._clearColor.a}setClearAlpha(e){this._clearColor.a=e}getClearDepth(){return this._clearDepth}setClearDepth(e){this._clearDepth=e}getClearStencil(){return this._clearStencil}setClearStencil(e){this._clearStencil=e}isOccluded(e){const i=this._currentRenderContext;return i&&this.backend.isOccluded(i,e)}clear(e=!0,i=!0,n=!0){if(this._initialized===!1)return console.warn("THREE.Renderer: .clear() called before the backend is initialized. Try using .clearAsync() instead."),this.clearAsync(e,i,n);const s=this._renderTarget||this._getFrameBufferTarget();let o=null;if(s!==null&&(this._textures.updateRenderTarget(s),o=this._textures.get(s)),this.backend.clear(e,i,n,o),s!==null&&this._renderTarget===null){const l=this._quad;this._nodes.hasOutputChange(s.texture)&&(l.material.fragmentNode=this._nodes.getOutputNode(s.texture),l.material.needsUpdate=!0),this._renderScene(l,l.camera,!1)}}clearColor(){return this.clear(!0,!1,!1)}clearDepth(){return this.clear(!1,!0,!1)}clearStencil(){return this.clear(!1,!1,!0)}async clearAsync(e=!0,i=!0,n=!0){this._initialized===!1&&await this.init(),this.clear(e,i,n)}clearColorAsync(){return this.clearAsync(!0,!1,!1)}clearDepthAsync(){return this.clearAsync(!1,!0,!1)}clearStencilAsync(){return this.clearAsync(!1,!1,!0)}get currentToneMapping(){return this._renderTarget!==null?eg:this.toneMapping}get currentColorSpace(){return this._renderTarget!==null?ud:this.outputColorSpace}dispose(){this.info.dispose(),this.backend.dispose(),this._animation.dispose(),this._objects.dispose(),this._pipelines.dispose(),this._nodes.dispose(),this._bindings.dispose(),this._renderLists.dispose(),this._renderContexts.dispose(),this._textures.dispose(),this.setRenderTarget(null),this.setAnimationLoop(null)}setRenderTarget(e,i=0,n=0){this._renderTarget=e,this._activeCubeFace=i,this._activeMipmapLevel=n}getRenderTarget(){return this._renderTarget}setRenderObjectFunction(e){this._renderObjectFunction=e}getRenderObjectFunction(){return this._renderObjectFunction}compute(e){if(this.isDeviceLost===!0)return;if(this._initialized===!1)return console.warn("THREE.Renderer: .compute() called before the backend is initialized. Try using .computeAsync() instead."),this.computeAsync(e);const i=this._nodes.nodeFrame,n=i.renderId;this.info.calls++,this.info.compute.calls++,this.info.compute.frameCalls++,i.renderId=this.info.calls;const s=this.backend,o=this._pipelines,l=this._bindings,u=this._nodes,c=Array.isArray(e)?e:[e];if(c[0]===void 0||c[0].isComputeNode!==!0)throw new Error("THREE.Renderer: .compute() expects a ComputeNode.");s.beginCompute(e);for(const h of c){if(o.has(h)===!1){const g=()=>{h.removeEventListener("dispose",g),o.delete(h),l.delete(h),u.delete(h)};h.addEventListener("dispose",g);const m=h.onInitFunction;m!==null&&m.call(h,{renderer:this})}u.updateForCompute(h),l.updateForCompute(h);const p=l.getForCompute(h),f=o.getForCompute(h,p);s.compute(e,h,p,f)}s.finishCompute(e),i.renderId=n}async computeAsync(e){this._initialized===!1&&await this.init(),this.compute(e),await this.backend.resolveTimestampAsync(e,"compute")}async hasFeatureAsync(e){return this._initialized===!1&&await this.init(),this.backend.hasFeature(e)}hasFeature(e){return this._initialized===!1?(console.warn("THREE.Renderer: .hasFeature() called before the backend is initialized. Try using .hasFeatureAsync() instead."),!1):this.backend.hasFeature(e)}copyFramebufferToTexture(e,i=null){if(i!==null)if(i.isVector2)i=Td.set(i.x,i.y,e.image.width,e.image.height).floor();else if(i.isVector4)i=Td.copy(i).floor();else{console.error("THREE.Renderer.copyFramebufferToTexture: Invalid rectangle.");return}else i=Td.set(0,0,e.image.width,e.image.height);let n=this._currentRenderContext,s;n!==null?s=n.renderTarget:(s=this._renderTarget||this._getFrameBufferTarget(),s!==null&&(this._textures.updateRenderTarget(s),n=this._textures.get(s))),this._textures.updateTexture(e,{renderTarget:s}),this.backend.copyFramebufferToTexture(e,n,i)}copyTextureToTexture(e,i,n=null,s=null,o=0){this._textures.updateTexture(e),this._textures.updateTexture(i),this.backend.copyTextureToTexture(e,i,n,s,o)}readRenderTargetPixelsAsync(e,i,n,s,o,l=0,u=0){return this.backend.copyTextureToBuffer(e.textures[l],i,n,s,o,u)}_projectObject(e,i,n,s){if(e.visible===!1)return;if(e.layers.test(i.layers)){if(e.isGroup)n=e.renderOrder;else if(e.isLOD)e.autoUpdate===!0&&e.update(i);else if(e.isLight)s.pushLight(e);else if(e.isSprite){if(!e.frustumCulled||KR.intersectsSprite(e)){this.sortObjects===!0&&Td.setFromMatrixPosition(e.matrixWorld).applyMatrix4(B_);const{geometry:l,material:u}=e;u.visible&&s.push(e,l,u,n,Td.z,null)}}else if(e.isLineLoop)console.error("THREE.Renderer: Objects of type THREE.LineLoop are not supported. Please use THREE.Line or THREE.LineSegments.");else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||KR.intersectsObject(e))){const{geometry:l,material:u}=e;if(this.sortObjects===!0&&(l.boundingSphere===null&&l.computeBoundingSphere(),Td.copy(l.boundingSphere.center).applyMatrix4(e.matrixWorld).applyMatrix4(B_)),Array.isArray(u)){const c=l.groups;for(let h=0,p=c.length;h<p;h++){const f=c[h],g=u[f.materialIndex];g&&g.visible&&s.push(e,l,g,n,Td.z,f)}}else u.visible&&s.push(e,l,u,n,Td.z,null)}}if(e.isBundleGroup===!0&&this.backend.beginBundle!==void 0){const l=s;s=this._renderLists.get(e,i),s.begin(),l.pushBundle({bundleGroup:e,camera:i,renderList:s}),s.finish()}const o=e.children;for(let l=0,u=o.length;l<u;l++)this._projectObject(o[l],i,n,s)}_renderBundles(e,i,n){for(const s of e)this._renderBundle(s,i,n)}_renderTransparents(e,i,n,s,o){if(i.length>0){for(const{material:l}of i)l.side=mc;this._renderObjects(i,n,s,o,"backSide");for(const{material:l}of i)l.side=Jm;this._renderObjects(e,n,s,o);for(const{material:l}of i)l.side=Zm}else this._renderObjects(e,n,s,o)}_renderObjects(e,i,n,s,o=null){for(let l=0,u=e.length;l<u;l++){const c=e[l],{object:h,geometry:p,material:f,group:g}=c;if(i.isArrayCamera){const m=i.cameras;for(let y=0,b=m.length;y<b;y++){const v=m[y];if(h.layers.test(v.layers)){const _=v.viewport,T=_.minDepth===void 0?0:_.minDepth,E=_.maxDepth===void 0?1:_.maxDepth,C=this._currentRenderContext.viewportValue;C.copy(_).multiplyScalar(this._pixelRatio).floor(),C.minDepth=T,C.maxDepth=E,this.backend.updateViewport(this._currentRenderContext),this._currentRenderObjectFunction(h,n,v,p,f,g,s,o)}}}else this._currentRenderObjectFunction(h,n,i,p,f,g,s,o)}}renderObject(e,i,n,s,o,l,u,c=null){let h,p,f;if(e.onBeforeRender(this,i,n,s,o,l),i.overrideMaterial!==null){const g=i.overrideMaterial;o.positionNode&&o.positionNode.isNode&&(h=g.positionNode,g.positionNode=o.positionNode),g.isShadowNodeMaterial&&(g.side=o.shadowSide===null?o.side:o.shadowSide,o.depthNode&&o.depthNode.isNode&&(f=g.depthNode,g.depthNode=o.depthNode),o.shadowNode&&o.shadowNode.isNode&&(p=g.fragmentNode,g.fragmentNode=o.shadowNode),this.localClippingEnabled&&(o.clipShadows?(g.clippingPlanes!==o.clippingPlanes&&(g.clippingPlanes=o.clippingPlanes,g.needsUpdate=!0),g.clipIntersection!==o.clipIntersection&&(g.clipIntersection=o.clipIntersection)):Array.isArray(g.clippingPlanes)&&(g.clippingPlanes=null,g.needsUpdate=!0))),o=g}o.transparent===!0&&o.side===Zm&&o.forceSinglePass===!1?(o.side=mc,this._handleObjectFunction(e,o,i,n,u,l,"backSide"),o.side=Jm,this._handleObjectFunction(e,o,i,n,u,l,c),o.side=Zm):this._handleObjectFunction(e,o,i,n,u,l,c),h!==void 0&&(i.overrideMaterial.positionNode=h),f!==void 0&&(i.overrideMaterial.depthNode=f),p!==void 0&&(i.overrideMaterial.fragmentNode=p),e.onAfterRender(this,i,n,s,o,l)}_renderObjectDirect(e,i,n,s,o,l,u){const c=this._objects.get(e,i,n,s,o,this._currentRenderContext,u);c.drawRange=e.geometry.drawRange,c.group=l;const h=this._nodes.needsRefresh(c);h&&(this._nodes.updateBefore(c),this._geometries.updateForRender(c),this._nodes.updateForRender(c),this._bindings.updateForRender(c)),this._pipelines.updateForRender(c),this._currentRenderBundle!==null&&(this.backend.get(this._currentRenderBundle).renderObjects.push(c),c.bundle=this._currentRenderBundle.scene),this.backend.draw(c,this.info),h&&this._nodes.updateAfter(c)}_createObjectPipeline(e,i,n,s,o,l){const u=this._objects.get(e,i,n,s,o,this._currentRenderContext,l);this._nodes.updateBefore(u),this._geometries.updateForRender(u),this._nodes.updateForRender(u),this._bindings.updateForRender(u),this._pipelines.getForRender(u,this._compilationPromises),this._nodes.updateAfter(u)}get compile(){return this.compileAsync}}class JR{constructor(e=""){this.name=e,this.visibility=0}setVisibility(e){this.visibility|=e}clone(){return Object.assign(new this.constructor,this)}}function FAe(r){return r+(Cd-r%Cd)%Cd}class W7 extends JR{constructor(e,i=null){super(e),this.isBuffer=!0,this.bytesPerElement=Float32Array.BYTES_PER_ELEMENT,this._buffer=i}get byteLength(){return FAe(this._buffer.byteLength)}get buffer(){return this._buffer}update(){return!0}}class Q7 extends W7{constructor(e,i=null){super(e,i),this.isUniformBuffer=!0}}let UAe=0;class q7 extends Q7{constructor(e,i){super("UniformBuffer_"+UAe++,e?e.value:null),this.nodeUniform=e,this.groupNode=i}get buffer(){return this.nodeUniform.value}}class zAe extends Q7{constructor(e){super(e),this.isUniformsGroup=!0,this._values=null,this.uniforms=[]}addUniform(e){return this.uniforms.push(e),this}removeUniform(e){const i=this.uniforms.indexOf(e);return i!==-1&&this.uniforms.splice(i,1),this}get values(){return this._values===null&&(this._values=Array.from(this.buffer)),this._values}get buffer(){let e=this._buffer;if(e===null){const i=this.byteLength;e=new Float32Array(new ArrayBuffer(i)),this._buffer=e}return e}get byteLength(){let e=0;for(let i=0,n=this.uniforms.length;i<n;i++){const s=this.uniforms[i],{boundary:o,itemSize:l}=s,u=e%Cd,c=Cd-u;u!==0&&c-o<0?e+=Cd-u:u%o!==0&&(e+=u%o),s.offset=e/this.bytesPerElement,e+=l*this.bytesPerElement}return Math.ceil(e/Cd)*Cd}update(){let e=!1;for(const i of this.uniforms)this.updateByType(i)===!0&&(e=!0);return e}updateByType(e){if(e.isNumberUniform)return this.updateNumber(e);if(e.isVector2Uniform)return this.updateVector2(e);if(e.isVector3Uniform)return this.updateVector3(e);if(e.isVector4Uniform)return this.updateVector4(e);if(e.isColorUniform)return this.updateColor(e);if(e.isMatrix3Uniform)return this.updateMatrix3(e);if(e.isMatrix4Uniform)return this.updateMatrix4(e);console.error("THREE.WebGPUUniformsGroup: Unsupported uniform type.",e)}updateNumber(e){let i=!1;const n=this.values,s=e.getValue(),o=e.offset;if(n[o]!==s){const l=this.buffer;l[o]=n[o]=s,i=!0}return i}updateVector2(e){let i=!1;const n=this.values,s=e.getValue(),o=e.offset;if(n[o+0]!==s.x||n[o+1]!==s.y){const l=this.buffer;l[o+0]=n[o+0]=s.x,l[o+1]=n[o+1]=s.y,i=!0}return i}updateVector3(e){let i=!1;const n=this.values,s=e.getValue(),o=e.offset;if(n[o+0]!==s.x||n[o+1]!==s.y||n[o+2]!==s.z){const l=this.buffer;l[o+0]=n[o+0]=s.x,l[o+1]=n[o+1]=s.y,l[o+2]=n[o+2]=s.z,i=!0}return i}updateVector4(e){let i=!1;const n=this.values,s=e.getValue(),o=e.offset;if(n[o+0]!==s.x||n[o+1]!==s.y||n[o+2]!==s.z||n[o+4]!==s.w){const l=this.buffer;l[o+0]=n[o+0]=s.x,l[o+1]=n[o+1]=s.y,l[o+2]=n[o+2]=s.z,l[o+3]=n[o+3]=s.w,i=!0}return i}updateColor(e){let i=!1;const n=this.values,s=e.getValue(),o=e.offset;if(n[o+0]!==s.r||n[o+1]!==s.g||n[o+2]!==s.b){const l=this.buffer;l[o+0]=n[o+0]=s.r,l[o+1]=n[o+1]=s.g,l[o+2]=n[o+2]=s.b,i=!0}return i}updateMatrix3(e){let i=!1;const n=this.values,s=e.getValue().elements,o=e.offset;if(n[o+0]!==s[0]||n[o+1]!==s[1]||n[o+2]!==s[2]||n[o+4]!==s[3]||n[o+5]!==s[4]||n[o+6]!==s[5]||n[o+8]!==s[6]||n[o+9]!==s[7]||n[o+10]!==s[8]){const l=this.buffer;l[o+0]=n[o+0]=s[0],l[o+1]=n[o+1]=s[1],l[o+2]=n[o+2]=s[2],l[o+4]=n[o+4]=s[3],l[o+5]=n[o+5]=s[4],l[o+6]=n[o+6]=s[5],l[o+8]=n[o+8]=s[6],l[o+9]=n[o+9]=s[7],l[o+10]=n[o+10]=s[8],i=!0}return i}updateMatrix4(e){let i=!1;const n=this.values,s=e.getValue().elements,o=e.offset;return VAe(n,s,o)===!1&&(this.buffer.set(s,o),jAe(n,s,o),i=!0),i}}function jAe(r,e,i){for(let n=0,s=e.length;n<s;n++)r[i+n]=e[n]}function VAe(r,e,i){for(let n=0,s=e.length;n<s;n++)if(r[i+n]!==e[n])return!1;return!0}let GAe=0;class X7 extends zAe{constructor(e,i){super(e),this.id=GAe++,this.groupNode=i,this.isNodeUniformsGroup=!0}getNodes(){const e=[];for(const i of this.uniforms){const n=i.nodeUniform.node;if(!n)throw new Error("NodeUniformsGroup: Uniform has no node.");e.push(n)}return e}}let HAe=0;class WAe extends JR{constructor(e,i){super(e),this.id=HAe++,this.texture=i,this.version=i?i.version:0,this.store=!1,this.generation=null,this.isSampledTexture=!0}needsBindingsUpdate(e){const{texture:i}=this;return e!==this.generation?(this.generation=e,!0):i.isVideoTexture}update(){const{texture:e,version:i}=this;return i!==e.version?(this.version=e.version,!0):!1}}class L_ extends WAe{constructor(e,i,n,s=null){super(e,i?i.value:null),this.textureNode=i,this.groupNode=n,this.access=s}needsBindingsUpdate(e){return this.textureNode.value!==this.texture||super.needsBindingsUpdate(e)}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class Y7 extends L_{constructor(e,i,n,s){super(e,i,n,s),this.isSampledCubeTexture=!0}}class K7 extends L_{constructor(e,i,n,s){super(e,i,n,s),this.isSampledTexture3D=!0}}const QAe={atan2:"atan",textureDimensions:"textureSize",equals:"equal"},qAe={low:"lowp",medium:"mediump",high:"highp"},J7={swizzleAssign:!0,storageBuffer:!1},Z7=`
precision highp float;
precision highp int;
precision highp sampler2D;
precision highp sampler3D;
precision highp samplerCube;
precision highp sampler2DArray;

precision highp usampler2D;
precision highp usampler3D;
precision highp usamplerCube;
precision highp usampler2DArray;

precision highp isampler2D;
precision highp isampler3D;
precision highp isamplerCube;
precision highp isampler2DArray;

precision lowp sampler2DShadow;
`;class XAe extends k7{constructor(e,i){super(e,i,new BAe),this.uniformGroups={},this.transforms=[],this.extensions={},this.useComparisonMethod=!0}needsColorSpaceToLinearSRGB(e){return e.isVideoTexture===!0&&e.colorSpace!==Np}getMethod(e){return QAe[e]||e}getOutputStructName(){return""}buildFunctionCode(e){const i=e.layout,n=this.flowShaderNode(e),s=[];for(const o of i.inputs)s.push(this.getType(o.type)+" "+o.name);return`${this.getType(i.type)} ${i.name}( ${s.join(", ")} ) {

	${n.vars}

${n.code}
	return ${n.result};

}`}setupPBO(e){const i=e.value;if(i.pbo===void 0){const n=i.array,s=i.count*i.itemSize,{itemSize:o}=i,l=i.array.constructor.name.toLowerCase().includes("int");let u=l?LM:BM;o===2?u=l?DM:ey:o===3?u=l?cue:IM:o===4&&(u=l?NM:sg);const c={Float32Array:pl,Uint8Array:ld,Uint16Array:ng,Uint32Array:Fa,Int8Array:JA,Int16Array:ZA,Int32Array:_o,Uint8ClampedArray:ld},h=Math.pow(2,Math.ceil(Math.log2(Math.sqrt(s/o))));let p=Math.ceil(s/o/h);h*p*o<s&&p++;const f=h*p*o,g=new n.constructor(f);g.set(n,0),i.array=g;const m=new mhe(i.array,h,p,u,c[i.array.constructor.name]||pl);m.needsUpdate=!0,m.isPBOTexture=!0;const y=new _y(m,null,null);y.setPrecision("high"),i.pboNode=y,i.pbo=y.value,this.getUniformFromNode(i.pboNode,"texture",this.shaderStage,this.context.label)}}getPropertyName(e,i=this.shaderStage){return e.isNodeUniform&&e.node.isTextureNode!==!0&&e.node.isBufferNode!==!0?i.charAt(0)+"_"+e.name:super.getPropertyName(e,i)}generatePBO(e){const{node:i,indexNode:n}=e,s=i.value;if(this.renderer.backend.has(s)){const p=this.renderer.backend.get(s);p.pbo=s.pbo}const o=this.getUniformFromNode(s.pboNode,"texture",this.shaderStage,this.context.label),l=this.getPropertyName(o);this.increaseUsage(n);const u=n.build(this,"uint"),c=this.getDataFromNode(e);let h=c.propertyName;if(h===void 0){const p=this.getVarFromNode(e);h=this.getPropertyName(p);const f=this.getDataFromNode(i);let g=f.propertySizeName;g===void 0&&(g=h+"Size",this.getVarFromNode(i,g,"uint"),this.addLineFlowCode(`${g} = uint( textureSize( ${l}, 0 ).x )`,e),f.propertySizeName=g);const{itemSize:m}=s,y="."+wg.join("").slice(0,m),b=`ivec2(${u} % ${g}, ${u} / ${g})`,v=this.generateTextureLoad(null,l,b,null,"0");let _="vec4";s.pbo.type===Fa?_="uvec4":s.pbo.type===_o&&(_="ivec4"),this.addLineFlowCode(`${h} = ${_}(${v})${y}`,e),c.propertyName=h}return h}generateTextureLoad(e,i,n,s,o="0"){return s?`texelFetch( ${i}, ivec3( ${n}, ${s} ), ${o} )`:`texelFetch( ${i}, ${n}, ${o} )`}generateTexture(e,i,n,s){return e.isDepthTexture?`texture( ${i}, ${n} ).x`:(s&&(n=`vec3( ${n}, ${s} )`),`texture( ${i}, ${n} )`)}generateTextureLevel(e,i,n,s){return`textureLod( ${i}, ${n}, ${s} )`}generateTextureBias(e,i,n,s){return`texture( ${i}, ${n}, ${s} )`}generateTextureGrad(e,i,n,s){return`textureGrad( ${i}, ${n}, ${s[0]}, ${s[1]} )`}generateTextureCompare(e,i,n,s,o,l=this.shaderStage){if(l==="fragment")return`texture( ${i}, vec3( ${n}, ${s} ) )`;console.error(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${l} shader.`)}getVars(e){const i=[],n=this.vars[e];if(n!==void 0)for(const s of n)i.push(`${this.getVar(s.type,s.name)};`);return i.join(`
	`)}getUniforms(e){const i=this.uniforms[e],n=[],s={};for(const l of i){let u=null,c=!1;if(l.type==="texture"){const p=l.node.value;let f="";p.isDataTexture===!0&&(p.type===Fa?f="u":p.type===_o&&(f="i")),p.compareFunction?u=`sampler2DShadow ${l.name};`:p.isDataArrayTexture===!0||p.isCompressedArrayTexture===!0?u=`${f}sampler2DArray ${l.name};`:u=`${f}sampler2D ${l.name};`}else if(l.type==="cubeTexture")u=`samplerCube ${l.name};`;else if(l.type==="texture3D")u=`sampler3D ${l.name};`;else if(l.type==="buffer"){const p=l.node,f=this.getType(p.bufferType),g=p.bufferCount,m=g>0?g:"";u=`${p.name} {
	${f} ${l.name}[${m}];
};
`}else u=`${this.getVectorType(l.type)} ${this.getPropertyName(l,e)};`,c=!0;const h=l.node.precision;if(h!==null&&(u=qAe[h]+" "+u),c){u="	"+u;const p=l.groupNode.name;(s[p]||(s[p]=[])).push(u)}else u="uniform "+u,n.push(u)}let o="";for(const l in s){const u=s[l];o+=this._getGLSLUniformStruct(e+"_"+l,u.join(`
`))+`
`}return o+=n.join(`
`),o}getTypeFromAttribute(e){let i=super.getTypeFromAttribute(e);if(/^[iu]/.test(i)&&e.gpuType!==_o){let n=e;e.isInterleavedBufferAttribute&&(n=e.data);const s=n.array;s instanceof Uint32Array||s instanceof Int32Array||(i=i.slice(1))}return i}getAttributes(e){let i="";if(e==="vertex"||e==="compute"){const n=this.getAttributesArray();let s=0;for(const o of n)i+=`layout( location = ${s++} ) in ${o.type} ${o.name};
`}return i}getStructMembers(e){const i=[],n=e.getMemberTypes();for(let s=0;s<n.length;s++){const o=n[s];i.push(`layout( location = ${s} ) out ${o} m${s};`)}return i.join(`
`)}getStructs(e){const i=[],n=this.structs[e];if(n.length===0)return`layout( location = 0 ) out vec4 fragColor;
`;for(let s=0,o=n.length;s<o;s++){const l=n[s];let u=`
`;u+=this.getStructMembers(l),u+=`
`,i.push(u)}return i.join(`

`)}getVaryings(e){let i="";const n=this.varyings;if(e==="vertex"||e==="compute")for(const s of n){e==="compute"&&(s.needsInterpolation=!0);const o=s.type,l=o.includes("int")||o.includes("uv")||o.includes("iv")?"flat ":"";i+=`${l}${s.needsInterpolation?"out":"/*out*/"} ${o} ${s.name};
`}else if(e==="fragment"){for(const s of n)if(s.needsInterpolation){const o=s.type,l=o.includes("int")||o.includes("uv")||o.includes("iv")?"flat ":"";i+=`${l}in ${o} ${s.name};
`}}return i}getVertexIndex(){return"uint( gl_VertexID )"}getInstanceIndex(){return"uint( gl_InstanceID )"}getInvocationLocalIndex(){return`uint( gl_InstanceID ) % ${this.object.workgroupSize.reduce((e,i)=>e*i,1)}u`}getDrawIndex(){return this.renderer.backend.extensions.has("WEBGL_multi_draw")?"uint( gl_DrawID )":null}getFrontFacing(){return"gl_FrontFacing"}getFragCoord(){return"gl_FragCoord.xy"}getFragDepth(){return"gl_FragDepth"}enableExtension(e,i,n=this.shaderStage){const s=this.extensions[n]||(this.extensions[n]=new Map);s.has(e)===!1&&s.set(e,{name:e,behavior:i})}getExtensions(e){const i=[];if(e==="vertex"){const s=this.renderer.backend.extensions;this.object.isBatchedMesh&&s.has("WEBGL_multi_draw")&&this.enableExtension("GL_ANGLE_multi_draw","require",e)}const n=this.extensions[e];if(n!==void 0)for(const{name:s,behavior:o}of n.values())i.push(`#extension ${s} : ${o}`);return i.join(`
`)}isAvailable(e){let i=J7[e];if(i===void 0){if(e==="float32Filterable"){const n=this.renderer.backend.extensions;n.has("OES_texture_float_linear")?(n.get("OES_texture_float_linear"),i=!0):i=!1}J7[e]=i}return i}isFlipY(){return!0}registerTransform(e,i){this.transforms.push({varyingName:e,attributeNode:i})}getTransforms(){const e=this.transforms;let i="";for(let n=0;n<e.length;n++){const s=e[n],o=this.getPropertyName(s.attributeNode);i+=`${s.varyingName} = ${o};
	`}return i}_getGLSLUniformStruct(e,i){return`
layout( std140 ) uniform ${e} {
${i}
};`}_getGLSLVertexCode(e){return`#version 300 es

${this.getSignature()}

// extensions 
${e.extensions}

// precision
${Z7}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// attributes
${e.attributes}

// codes
${e.codes}

void main() {

	// vars
	${e.vars}

	// transforms
	${e.transforms}

	// flow
	${e.flow}

	gl_PointSize = 1.0;

}
`}_getGLSLFragmentCode(e){return`#version 300 es

${this.getSignature()}

// precision
${Z7}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// codes
${e.codes}

${e.structs}

void main() {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const i in e){let n=`// code

`;n+=this.flowCode[i];const s=this.flowNodes[i],o=s[s.length-1];for(const u of s){const c=this.getFlowData(u),h=u.name;h&&(n.length>0&&(n+=`
`),n+=`	// flow -> ${h}
	`),n+=`${c.code}
	`,u===o&&i!=="compute"&&(n+=`// result
	`,i==="vertex"?(n+="gl_Position = ",n+=`${c.result};`):i==="fragment"&&(u.outputNode.isOutputStructNode||(n+="fragColor = ",n+=`${c.result};`)))}const l=e[i];l.extensions=this.getExtensions(i),l.uniforms=this.getUniforms(i),l.attributes=this.getAttributes(i),l.varyings=this.getVaryings(i),l.vars=this.getVars(i),l.structs=this.getStructs(i),l.codes=this.getCodes(i),l.transforms=this.getTransforms(i),l.flow=n}this.material!==null?(this.vertexShader=this._getGLSLVertexCode(e.vertex),this.fragmentShader=this._getGLSLFragmentCode(e.fragment)):this.computeShader=this._getGLSLVertexCode(e.compute)}getUniformFromNode(e,i,n,s=null){const o=super.getUniformFromNode(e,i,n,s),l=this.getDataFromNode(e,n,this.globalCache);let u=l.uniformGPU;if(u===void 0){const c=e.groupNode,h=c.name,p=this.getBindGroupArray(h,n);if(i==="texture")u=new L_(o.name,o.node,c),p.push(u);else if(i==="cubeTexture")u=new Y7(o.name,o.node,c),p.push(u);else if(i==="texture3D")u=new K7(o.name,o.node,c),p.push(u);else if(i==="buffer"){e.name=`NodeBuffer_${e.id}`,o.name=`buffer${e.id}`;const f=new q7(e,c);f.name=e.name,p.push(f),u=f}else{const f=this.uniformGroups[n]||(this.uniformGroups[n]={});let g=f[h];g===void 0&&(g=new X7(n+"_"+h,c),f[h]=g,p.push(g)),u=this.getNodeUniform(o,i),g.addUniform(u)}l.uniformGPU=u}return o}}let ZR=null,$R=null,jg=null;class $7{constructor(e={}){this.parameters=Object.assign({},e),this.data=new WeakMap,this.renderer=null,this.domElement=null}async init(e){this.renderer=e}begin(){}finish(){}draw(){}createProgram(){}destroyProgram(){}createBindings(){}updateBindings(){}createRenderPipeline(){}createComputePipeline(){}destroyPipeline(){}needsRenderUpdate(){}getRenderCacheKey(){}createNodeBuilder(){}createSampler(){}createDefaultTexture(){}createTexture(){}copyTextureToBuffer(){}createAttribute(){}createIndexAttribute(){}updateAttribute(){}destroyAttribute(){}getContext(){}updateSize(){}resolveTimestampAsync(){}hasFeatureAsync(){}hasFeature(){}getInstanceCount(e){const{object:i,geometry:n}=e;return n.isInstancedBufferGeometry?n.instanceCount:i.count>1?i.count:1}getDrawingBufferSize(){return ZR=ZR||new Dn,this.renderer.getDrawingBufferSize(ZR)}getScissor(){return $R=$R||new Jn,this.renderer.getScissor($R)}setScissorTest(){}getClearColor(){const e=this.renderer;return jg=jg||new CR,e.getClearColor(jg),jg.getRGB(jg,this.renderer.currentColorSpace),jg}getDomElement(){let e=this.domElement;return e===null&&(e=this.parameters.canvas!==void 0?this.parameters.canvas:Hue(),"setAttribute"in e&&e.setAttribute("data-engine",`three.js r${f1} webgpu`),this.domElement=e),e}set(e,i){this.data.set(e,i)}get(e){let i=this.data.get(e);return i===void 0&&(i={},this.data.set(e,i)),i}has(e){return this.data.has(e)}delete(e){this.data.delete(e)}dispose(){}}let YAe=0;class KAe{constructor(e,i){this.buffers=[e.bufferGPU,i],this.type=e.type,this.bufferType=e.bufferType,this.pbo=e.pbo,this.byteLength=e.byteLength,this.bytesPerElement=e.BYTES_PER_ELEMENT,this.version=e.version,this.isInteger=e.isInteger,this.activeBufferIndex=0,this.baseId=e.id}get id(){return`${this.baseId}|${this.activeBufferIndex}`}get bufferGPU(){return this.buffers[this.activeBufferIndex]}get transformBuffer(){return this.buffers[this.activeBufferIndex^1]}switchBuffers(){this.activeBufferIndex^=1}}class JAe{constructor(e){this.backend=e}createAttribute(e,i){const n=this.backend,{gl:s}=n,o=e.array,l=e.usage||s.STATIC_DRAW,u=e.isInterleavedBufferAttribute?e.data:e,c=n.get(u);let h=c.bufferGPU;h===void 0&&(h=this._createBuffer(s,i,o,l),c.bufferGPU=h,c.bufferType=i,c.version=u.version);let p;if(o instanceof Float32Array)p=s.FLOAT;else if(o instanceof Uint16Array)e.isFloat16BufferAttribute?p=s.HALF_FLOAT:p=s.UNSIGNED_SHORT;else if(o instanceof Int16Array)p=s.SHORT;else if(o instanceof Uint32Array)p=s.UNSIGNED_INT;else if(o instanceof Int32Array)p=s.INT;else if(o instanceof Int8Array)p=s.BYTE;else if(o instanceof Uint8Array)p=s.UNSIGNED_BYTE;else if(o instanceof Uint8ClampedArray)p=s.UNSIGNED_BYTE;else throw new Error("THREE.WebGLBackend: Unsupported buffer data format: "+o);let f={bufferGPU:h,bufferType:i,type:p,byteLength:o.byteLength,bytesPerElement:o.BYTES_PER_ELEMENT,version:e.version,pbo:e.pbo,isInteger:p===s.INT||p===s.UNSIGNED_INT||e.gpuType===_o,id:YAe++};if(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute){const g=this._createBuffer(s,i,o,l);f=new KAe(f,g)}n.set(e,f)}updateAttribute(e){const i=this.backend,{gl:n}=i,s=e.array,o=e.isInterleavedBufferAttribute?e.data:e,l=i.get(o),u=l.bufferType,c=e.isInterleavedBufferAttribute?e.data.updateRanges:e.updateRanges;if(n.bindBuffer(u,l.bufferGPU),c.length===0)n.bufferSubData(u,0,s);else{for(let h=0,p=c.length;h<p;h++){const f=c[h];n.bufferSubData(u,f.start*s.BYTES_PER_ELEMENT,s,f.start,f.count)}o.clearUpdateRanges()}n.bindBuffer(u,null),l.version=o.version}destroyAttribute(e){const i=this.backend,{gl:n}=i;e.isInterleavedBufferAttribute&&i.delete(e.data);const s=i.get(e);n.deleteBuffer(s.bufferGPU),i.delete(e)}async getArrayBufferAsync(e){const i=this.backend,{gl:n}=i,s=e.isInterleavedBufferAttribute?e.data:e,{bufferGPU:o}=i.get(s),l=e.array,u=l.byteLength;n.bindBuffer(n.COPY_READ_BUFFER,o);const c=n.createBuffer();n.bindBuffer(n.COPY_WRITE_BUFFER,c),n.bufferData(n.COPY_WRITE_BUFFER,u,n.STREAM_READ),n.copyBufferSubData(n.COPY_READ_BUFFER,n.COPY_WRITE_BUFFER,0,0,u),await i.utils._clientWaitAsync();const h=new e.array.constructor(l.length);return n.bindBuffer(n.COPY_WRITE_BUFFER,c),n.getBufferSubData(n.COPY_WRITE_BUFFER,0,h),n.deleteBuffer(c),n.bindBuffer(n.COPY_READ_BUFFER,null),n.bindBuffer(n.COPY_WRITE_BUFFER,null),h.buffer}_createBuffer(e,i,n,s){const o=e.createBuffer();return e.bindBuffer(i,o),e.bufferData(i,n,s),e.bindBuffer(i,null),o}}let ez=!1,eI,Fy;class ZAe{constructor(e){this.backend=e,this.gl=this.backend.gl,this.enabled={},this.currentFlipSided=null,this.currentCullFace=null,this.currentProgram=null,this.currentBlendingEnabled=!1,this.currentBlending=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipledAlpha=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentColorMask=null,this.currentDepthFunc=null,this.currentDepthMask=null,this.currentStencilFunc=null,this.currentStencilRef=null,this.currentStencilFuncMask=null,this.currentStencilFail=null,this.currentStencilZFail=null,this.currentStencilZPass=null,this.currentStencilMask=null,this.currentLineWidth=null,this.currentBoundFramebuffers={},this.currentDrawbuffers=new WeakMap,this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.currentTextureSlot=null,this.currentBoundTextures={},this.currentBoundBufferBases={},ez===!1&&(this._init(this.gl),ez=!0)}_init(e){eI={[od]:e.FUNC_ADD,[VF]:e.FUNC_SUBTRACT,[GF]:e.FUNC_REVERSE_SUBTRACT},Fy={[HF]:e.ZERO,[WF]:e.ONE,[QF]:e.SRC_COLOR,[v1]:e.SRC_ALPHA,[ZF]:e.SRC_ALPHA_SATURATE,[KF]:e.DST_COLOR,[XF]:e.DST_ALPHA,[qF]:e.ONE_MINUS_SRC_COLOR,[b1]:e.ONE_MINUS_SRC_ALPHA,[JF]:e.ONE_MINUS_DST_COLOR,[YF]:e.ONE_MINUS_DST_ALPHA}}enable(e){const{enabled:i}=this;i[e]!==!0&&(this.gl.enable(e),i[e]=!0)}disable(e){const{enabled:i}=this;i[e]!==!1&&(this.gl.disable(e),i[e]=!1)}setFlipSided(e){if(this.currentFlipSided!==e){const{gl:i}=this;e?i.frontFace(i.CW):i.frontFace(i.CCW),this.currentFlipSided=e}}setCullFace(e){const{gl:i}=this;e!==Hce?(this.enable(i.CULL_FACE),e!==this.currentCullFace&&(e===Wce?i.cullFace(i.BACK):e===Qce?i.cullFace(i.FRONT):i.cullFace(i.FRONT_AND_BACK))):this.disable(i.CULL_FACE),this.currentCullFace=e}setLineWidth(e){const{currentLineWidth:i,gl:n}=this;e!==i&&(n.lineWidth(e),this.currentLineWidth=e)}setBlending(e,i,n,s,o,l,u,c){const{gl:h}=this;if(e===$m){this.currentBlendingEnabled===!0&&(this.disable(h.BLEND),this.currentBlendingEnabled=!1);return}if(this.currentBlendingEnabled===!1&&(this.enable(h.BLEND),this.currentBlendingEnabled=!0),e!==jF){if(e!==this.currentBlending||c!==this.currentPremultipledAlpha){if((this.currentBlendEquation!==od||this.currentBlendEquationAlpha!==od)&&(h.blendEquation(h.FUNC_ADD),this.currentBlendEquation=od,this.currentBlendEquationAlpha=od),c)switch(e){case ad:h.blendFuncSeparate(h.ONE,h.ONE_MINUS_SRC_ALPHA,h.ONE,h.ONE_MINUS_SRC_ALPHA);break;case g1:h.blendFunc(h.ONE,h.ONE);break;case A1:h.blendFuncSeparate(h.ZERO,h.ONE_MINUS_SRC_COLOR,h.ZERO,h.ONE);break;case y1:h.blendFuncSeparate(h.ZERO,h.SRC_COLOR,h.ZERO,h.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",e);break}else switch(e){case ad:h.blendFuncSeparate(h.SRC_ALPHA,h.ONE_MINUS_SRC_ALPHA,h.ONE,h.ONE_MINUS_SRC_ALPHA);break;case g1:h.blendFunc(h.SRC_ALPHA,h.ONE);break;case A1:h.blendFuncSeparate(h.ZERO,h.ONE_MINUS_SRC_COLOR,h.ZERO,h.ONE);break;case y1:h.blendFunc(h.ZERO,h.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",e);break}this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentBlending=e,this.currentPremultipledAlpha=c}return}o=o||i,l=l||n,u=u||s,(i!==this.currentBlendEquation||o!==this.currentBlendEquationAlpha)&&(h.blendEquationSeparate(eI[i],eI[o]),this.currentBlendEquation=i,this.currentBlendEquationAlpha=o),(n!==this.currentBlendSrc||s!==this.currentBlendDst||l!==this.currentBlendSrcAlpha||u!==this.currentBlendDstAlpha)&&(h.blendFuncSeparate(Fy[n],Fy[s],Fy[l],Fy[u]),this.currentBlendSrc=n,this.currentBlendDst=s,this.currentBlendSrcAlpha=l,this.currentBlendDstAlpha=u),this.currentBlending=e,this.currentPremultipledAlpha=!1}setColorMask(e){this.currentColorMask!==e&&(this.gl.colorMask(e,e,e,e),this.currentColorMask=e)}setDepthTest(e){const{gl:i}=this;e?this.enable(i.DEPTH_TEST):this.disable(i.DEPTH_TEST)}setDepthMask(e){this.currentDepthMask!==e&&(this.gl.depthMask(e),this.currentDepthMask=e)}setDepthFunc(e){if(this.currentDepthFunc!==e){const{gl:i}=this;switch(e){case $F:i.depthFunc(i.NEVER);break;case eU:i.depthFunc(i.ALWAYS);break;case tU:i.depthFunc(i.LESS);break;case x1:i.depthFunc(i.LEQUAL);break;case iU:i.depthFunc(i.EQUAL);break;case rU:i.depthFunc(i.GEQUAL);break;case nU:i.depthFunc(i.GREATER);break;case sU:i.depthFunc(i.NOTEQUAL);break;default:i.depthFunc(i.LEQUAL)}this.currentDepthFunc=e}}setStencilTest(e){const{gl:i}=this;e?this.enable(i.STENCIL_TEST):this.disable(i.STENCIL_TEST)}setStencilMask(e){this.currentStencilMask!==e&&(this.gl.stencilMask(e),this.currentStencilMask=e)}setStencilFunc(e,i,n){(this.currentStencilFunc!==e||this.currentStencilRef!==i||this.currentStencilFuncMask!==n)&&(this.gl.stencilFunc(e,i,n),this.currentStencilFunc=e,this.currentStencilRef=i,this.currentStencilFuncMask=n)}setStencilOp(e,i,n){(this.currentStencilFail!==e||this.currentStencilZFail!==i||this.currentStencilZPass!==n)&&(this.gl.stencilOp(e,i,n),this.currentStencilFail=e,this.currentStencilZFail=i,this.currentStencilZPass=n)}setMaterial(e,i){const{gl:n}=this;e.side===Zm?this.disable(n.CULL_FACE):this.enable(n.CULL_FACE);let s=e.side===mc;i&&(s=!s),this.setFlipSided(s),e.blending===ad&&e.transparent===!1?this.setBlending($m):this.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),this.setDepthFunc(e.depthFunc),this.setDepthTest(e.depthTest),this.setDepthMask(e.depthWrite),this.setColorMask(e.colorWrite);const o=e.stencilWrite;this.setStencilTest(o),o&&(this.setStencilMask(e.stencilWriteMask),this.setStencilFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),this.setStencilOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),this.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),e.alphaToCoverage===!0&&this.backend.renderer.samples>1?this.enable(n.SAMPLE_ALPHA_TO_COVERAGE):this.disable(n.SAMPLE_ALPHA_TO_COVERAGE)}setPolygonOffset(e,i,n){const{gl:s}=this;e?(this.enable(s.POLYGON_OFFSET_FILL),(this.currentPolygonOffsetFactor!==i||this.currentPolygonOffsetUnits!==n)&&(s.polygonOffset(i,n),this.currentPolygonOffsetFactor=i,this.currentPolygonOffsetUnits=n)):this.disable(s.POLYGON_OFFSET_FILL)}useProgram(e){return this.currentProgram!==e?(this.gl.useProgram(e),this.currentProgram=e,!0):!1}bindFramebuffer(e,i){const{gl:n,currentBoundFramebuffers:s}=this;return s[e]!==i?(n.bindFramebuffer(e,i),s[e]=i,e===n.DRAW_FRAMEBUFFER&&(s[n.FRAMEBUFFER]=i),e===n.FRAMEBUFFER&&(s[n.DRAW_FRAMEBUFFER]=i),!0):!1}drawBuffers(e,i){const{gl:n}=this;let s=[],o=!1;if(e.textures!==null){s=this.currentDrawbuffers.get(i),s===void 0&&(s=[],this.currentDrawbuffers.set(i,s));const l=e.textures;if(s.length!==l.length||s[0]!==n.COLOR_ATTACHMENT0){for(let u=0,c=l.length;u<c;u++)s[u]=n.COLOR_ATTACHMENT0+u;s.length=l.length,o=!0}}else s[0]!==n.BACK&&(s[0]=n.BACK,o=!0);o&&n.drawBuffers(s)}activeTexture(e){const{gl:i,currentTextureSlot:n,maxTextures:s}=this;e===void 0&&(e=i.TEXTURE0+s-1),n!==e&&(i.activeTexture(e),this.currentTextureSlot=e)}bindTexture(e,i,n){const{gl:s,currentTextureSlot:o,currentBoundTextures:l,maxTextures:u}=this;n===void 0&&(o===null?n=s.TEXTURE0+u-1:n=o);let c=l[n];c===void 0&&(c={type:void 0,texture:void 0},l[n]=c),(c.type!==e||c.texture!==i)&&(o!==n&&(s.activeTexture(n),this.currentTextureSlot=n),s.bindTexture(e,i),c.type=e,c.texture=i)}bindBufferBase(e,i,n){const{gl:s}=this,o=`${e}-${i}`;return this.currentBoundBufferBases[o]!==n?(s.bindBufferBase(e,i,n),this.currentBoundBufferBases[o]=n,!0):!1}unbindTexture(){const{gl:e,currentTextureSlot:i,currentBoundTextures:n}=this,s=n[i];s!==void 0&&s.type!==void 0&&(e.bindTexture(s.type,null),s.type=void 0,s.texture=void 0)}}class $Ae{constructor(e){this.backend=e,this.gl=this.backend.gl,this.extensions=e.extensions}convert(e,i=Np){const{gl:n,extensions:s}=this;let o;if(e===ld)return n.UNSIGNED_BYTE;if(e===nue)return n.UNSIGNED_SHORT_4_4_4_4;if(e===sue)return n.UNSIGNED_SHORT_5_5_5_1;if(e===aU)return n.UNSIGNED_INT_5_9_9_9_REV;if(e===JA)return n.BYTE;if(e===ZA)return n.SHORT;if(e===ng)return n.UNSIGNED_SHORT;if(e===_o)return n.INT;if(e===Fa)return n.UNSIGNED_INT;if(e===pl)return n.FLOAT;if(e===Gu)return n.HALF_FLOAT;if(e===aue)return n.ALPHA;if(e===IM)return n.RGB;if(e===sg)return n.RGBA;if(e===oue)return n.LUMINANCE;if(e===lue)return n.LUMINANCE_ALPHA;if(e===Dp)return n.DEPTH_COMPONENT;if(e===ag)return n.DEPTH_STENCIL;if(e===BM)return n.RED;if(e===LM)return n.RED_INTEGER;if(e===ey)return n.RG;if(e===DM)return n.RG_INTEGER;if(e===NM)return n.RGBA_INTEGER;if(e===PM||e===C1||e===S1||e===T1)if(i===Dr)if(o=s.get("WEBGL_compressed_texture_s3tc_srgb"),o!==null){if(e===PM)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(e===C1)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(e===S1)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(e===T1)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(o=s.get("WEBGL_compressed_texture_s3tc"),o!==null){if(e===PM)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===C1)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===S1)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===T1)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(e===oU||e===lU||e===cU||e===uU)if(o=s.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(e===oU)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===lU)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===cU)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===uU)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(e===hU||e===OM||e===kM)if(o=s.get("WEBGL_compressed_texture_etc"),o!==null){if(e===hU||e===OM)return i===Dr?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(e===kM)return i===Dr?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(e===FM||e===UM||e===zM||e===jM||e===VM||e===GM||e===HM||e===WM||e===QM||e===qM||e===XM||e===YM||e===KM||e===JM)if(o=s.get("WEBGL_compressed_texture_astc"),o!==null){if(e===FM)return i===Dr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(e===UM)return i===Dr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(e===zM)return i===Dr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(e===jM)return i===Dr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(e===VM)return i===Dr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(e===GM)return i===Dr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(e===HM)return i===Dr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(e===WM)return i===Dr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(e===QM)return i===Dr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(e===qM)return i===Dr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(e===XM)return i===Dr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(e===YM)return i===Dr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(e===KM)return i===Dr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(e===JM)return i===Dr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(e===ZM)if(o=s.get("EXT_texture_compression_bptc"),o!==null){if(e===ZM)return i===Dr?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(e===uue||e===dU||e===pU||e===fU)if(o=s.get("EXT_texture_compression_rgtc"),o!==null){if(e===ZM)return o.COMPRESSED_RED_RGTC1_EXT;if(e===dU)return o.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(e===pU)return o.COMPRESSED_RED_GREEN_RGTC2_EXT;if(e===fU)return o.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return e===$A?n.UNSIGNED_INT_24_8:n[e]!==void 0?n[e]:null}_clientWaitAsync(){const{gl:e}=this,i=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);return e.flush(),new Promise((n,s)=>{function o(){const l=e.clientWaitSync(i,e.SYNC_FLUSH_COMMANDS_BIT,0);if(l===e.WAIT_FAILED){e.deleteSync(i),s();return}if(l===e.TIMEOUT_EXPIRED){requestAnimationFrame(o);return}e.deleteSync(i),n()}o()})}}let tz=!1,D_,tI,iz;class eye{constructor(e){this.backend=e,this.gl=e.gl,this.extensions=e.extensions,this.defaultTextures={},tz===!1&&(this._init(this.gl),tz=!0)}_init(e){D_={[E1]:e.REPEAT,[ig]:e.CLAMP_TO_EDGE,[w1]:e.MIRRORED_REPEAT},tI={[to]:e.NEAREST,[MM]:e.NEAREST_MIPMAP_NEAREST,[rg]:e.NEAREST_MIPMAP_LINEAR,[dl]:e.LINEAR,[RM]:e.LINEAR_MIPMAP_NEAREST,[Vu]:e.LINEAR_MIPMAP_LINEAR},iz={[gU]:e.NEVER,[_U]:e.ALWAYS,[e3]:e.LESS,[yU]:e.LEQUAL,[AU]:e.EQUAL,[xU]:e.GEQUAL,[vU]:e.GREATER,[bU]:e.NOTEQUAL}}filterFallback(e){const{gl:i}=this;return e===to||e===MM||e===rg?i.NEAREST:i.LINEAR}getGLTextureType(e){const{gl:i}=this;let n;return e.isCubeTexture===!0?n=i.TEXTURE_CUBE_MAP:e.isDataArrayTexture===!0||e.isCompressedArrayTexture===!0?n=i.TEXTURE_2D_ARRAY:e.isData3DTexture===!0?n=i.TEXTURE_3D:n=i.TEXTURE_2D,n}getInternalFormat(e,i,n,s,o=!1){const{gl:l,extensions:u}=this;if(e!==null){if(l[e]!==void 0)return l[e];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+e+"'")}let c=i;return i===l.RED&&(n===l.FLOAT&&(c=l.R32F),n===l.HALF_FLOAT&&(c=l.R16F),n===l.UNSIGNED_BYTE&&(c=l.R8),n===l.UNSIGNED_SHORT&&(c=l.R16),n===l.UNSIGNED_INT&&(c=l.R32UI),n===l.BYTE&&(c=l.R8I),n===l.SHORT&&(c=l.R16I),n===l.INT&&(c=l.R32I)),i===l.RED_INTEGER&&(n===l.UNSIGNED_BYTE&&(c=l.R8UI),n===l.UNSIGNED_SHORT&&(c=l.R16UI),n===l.UNSIGNED_INT&&(c=l.R32UI),n===l.BYTE&&(c=l.R8I),n===l.SHORT&&(c=l.R16I),n===l.INT&&(c=l.R32I)),i===l.RG&&(n===l.FLOAT&&(c=l.RG32F),n===l.HALF_FLOAT&&(c=l.RG16F),n===l.UNSIGNED_BYTE&&(c=l.RG8),n===l.UNSIGNED_SHORT&&(c=l.RG16),n===l.UNSIGNED_INT&&(c=l.RG32UI),n===l.BYTE&&(c=l.RG8I),n===l.SHORT&&(c=l.RG16I),n===l.INT&&(c=l.RG32I)),i===l.RG_INTEGER&&(n===l.UNSIGNED_BYTE&&(c=l.RG8UI),n===l.UNSIGNED_SHORT&&(c=l.RG16UI),n===l.UNSIGNED_INT&&(c=l.RG32UI),n===l.BYTE&&(c=l.RG8I),n===l.SHORT&&(c=l.RG16I),n===l.INT&&(c=l.RG32I)),i===l.RGB&&(n===l.FLOAT&&(c=l.RGB32F),n===l.HALF_FLOAT&&(c=l.RGB16F),n===l.UNSIGNED_BYTE&&(c=l.RGB8),n===l.UNSIGNED_SHORT&&(c=l.RGB16),n===l.UNSIGNED_INT&&(c=l.RGB32UI),n===l.BYTE&&(c=l.RGB8I),n===l.SHORT&&(c=l.RGB16I),n===l.INT&&(c=l.RGB32I),n===l.UNSIGNED_BYTE&&(c=s===Dr&&o===!1?l.SRGB8:l.RGB8),n===l.UNSIGNED_SHORT_5_6_5&&(c=l.RGB565),n===l.UNSIGNED_SHORT_5_5_5_1&&(c=l.RGB5_A1),n===l.UNSIGNED_SHORT_4_4_4_4&&(c=l.RGB4),n===l.UNSIGNED_INT_5_9_9_9_REV&&(c=l.RGB9_E5)),i===l.RGB_INTEGER&&(n===l.UNSIGNED_BYTE&&(c=l.RGB8UI),n===l.UNSIGNED_SHORT&&(c=l.RGB16UI),n===l.UNSIGNED_INT&&(c=l.RGB32UI),n===l.BYTE&&(c=l.RGB8I),n===l.SHORT&&(c=l.RGB16I),n===l.INT&&(c=l.RGB32I)),i===l.RGBA&&(n===l.FLOAT&&(c=l.RGBA32F),n===l.HALF_FLOAT&&(c=l.RGBA16F),n===l.UNSIGNED_BYTE&&(c=l.RGBA8),n===l.UNSIGNED_SHORT&&(c=l.RGBA16),n===l.UNSIGNED_INT&&(c=l.RGBA32UI),n===l.BYTE&&(c=l.RGBA8I),n===l.SHORT&&(c=l.RGBA16I),n===l.INT&&(c=l.RGBA32I),n===l.UNSIGNED_BYTE&&(c=s===Dr&&o===!1?l.SRGB8_ALPHA8:l.RGBA8),n===l.UNSIGNED_SHORT_4_4_4_4&&(c=l.RGBA4),n===l.UNSIGNED_SHORT_5_5_5_1&&(c=l.RGB5_A1)),i===l.RGBA_INTEGER&&(n===l.UNSIGNED_BYTE&&(c=l.RGBA8UI),n===l.UNSIGNED_SHORT&&(c=l.RGBA16UI),n===l.UNSIGNED_INT&&(c=l.RGBA32UI),n===l.BYTE&&(c=l.RGBA8I),n===l.SHORT&&(c=l.RGBA16I),n===l.INT&&(c=l.RGBA32I)),i===l.DEPTH_COMPONENT&&(n===l.UNSIGNED_INT&&(c=l.DEPTH24_STENCIL8),n===l.FLOAT&&(c=l.DEPTH_COMPONENT32F)),i===l.DEPTH_STENCIL&&n===l.UNSIGNED_INT_24_8&&(c=l.DEPTH24_STENCIL8),(c===l.R16F||c===l.R32F||c===l.RG16F||c===l.RG32F||c===l.RGBA16F||c===l.RGBA32F)&&u.get("EXT_color_buffer_float"),c}setTextureParameters(e,i){const{gl:n,extensions:s,backend:o}=this;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,i.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,i.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,n.NONE),n.texParameteri(e,n.TEXTURE_WRAP_S,D_[i.wrapS]),n.texParameteri(e,n.TEXTURE_WRAP_T,D_[i.wrapT]),(e===n.TEXTURE_3D||e===n.TEXTURE_2D_ARRAY)&&n.texParameteri(e,n.TEXTURE_WRAP_R,D_[i.wrapR]),n.texParameteri(e,n.TEXTURE_MAG_FILTER,tI[i.magFilter]);const l=i.mipmaps!==void 0&&i.mipmaps.length>0,u=i.minFilter===dl&&l?Vu:i.minFilter;if(n.texParameteri(e,n.TEXTURE_MIN_FILTER,tI[u]),i.compareFunction&&(n.texParameteri(e,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(e,n.TEXTURE_COMPARE_FUNC,iz[i.compareFunction])),s.has("EXT_texture_filter_anisotropic")===!0){if(i.magFilter===to||i.minFilter!==rg&&i.minFilter!==Vu||i.type===pl&&s.has("OES_texture_float_linear")===!1)return;if(i.anisotropy>1){const c=s.get("EXT_texture_filter_anisotropic");n.texParameterf(e,c.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(i.anisotropy,o.getMaxAnisotropy()))}}}createDefaultTexture(e){const{gl:i,backend:n,defaultTextures:s}=this,o=this.getGLTextureType(e);let l=s[o];l===void 0&&(l=i.createTexture(),n.state.bindTexture(o,l),i.texParameteri(o,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(o,i.TEXTURE_MAG_FILTER,i.NEAREST),s[o]=l),n.set(e,{textureGPU:l,glTextureType:o,isDefault:!0})}createTexture(e,i){const{gl:n,backend:s}=this,{levels:o,width:l,height:u,depth:c}=i,h=s.utils.convert(e.format,e.colorSpace),p=s.utils.convert(e.type),f=this.getInternalFormat(e.internalFormat,h,p,e.colorSpace,e.isVideoTexture),g=n.createTexture(),m=this.getGLTextureType(e);s.state.bindTexture(m,g),this.setTextureParameters(m,e),e.isDataArrayTexture||e.isCompressedArrayTexture?n.texStorage3D(n.TEXTURE_2D_ARRAY,o,f,l,u,c):e.isData3DTexture?n.texStorage3D(n.TEXTURE_3D,o,f,l,u,c):e.isVideoTexture||n.texStorage2D(m,o,f,l,u),s.set(e,{textureGPU:g,glTextureType:m,glFormat:h,glType:p,glInternalFormat:f})}copyBufferToTexture(e,i){const{gl:n,backend:s}=this,{textureGPU:o,glTextureType:l,glFormat:u,glType:c}=s.get(i),{width:h,height:p}=i.source.data;n.bindBuffer(n.PIXEL_UNPACK_BUFFER,e),s.state.bindTexture(l,o),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n.texSubImage2D(l,0,0,0,h,p,u,c,0),n.bindBuffer(n.PIXEL_UNPACK_BUFFER,null),s.state.unbindTexture()}updateTexture(e,i){const{gl:n}=this,{width:s,height:o}=i,{textureGPU:l,glTextureType:u,glFormat:c,glType:h,glInternalFormat:p}=this.backend.get(e);if(e.isRenderTargetTexture||l===void 0)return;const f=g=>g.isDataTexture?g.image.data:g instanceof ImageBitmap||g instanceof OffscreenCanvas||g instanceof HTMLImageElement||g instanceof HTMLCanvasElement?g:g.data;if(this.backend.state.bindTexture(u,l),this.setTextureParameters(u,e),e.isCompressedTexture){const g=e.mipmaps,m=i.image;for(let y=0;y<g.length;y++){const b=g[y];e.isCompressedArrayTexture?e.format!==n.RGBA?c!==null?n.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,y,0,0,0,b.width,b.height,m.depth,c,b.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texSubImage3D(n.TEXTURE_2D_ARRAY,y,0,0,0,b.width,b.height,m.depth,c,h,b.data):c!==null?n.compressedTexSubImage2D(n.TEXTURE_2D,y,0,0,b.width,b.height,c,b.data):console.warn("Unsupported compressed texture format")}}else if(e.isCubeTexture){const g=i.images;for(let m=0;m<6;m++){const y=f(g[m]);n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+m,0,0,0,s,o,c,h,y)}}else if(e.isDataArrayTexture){const g=i.image;n.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,g.width,g.height,g.depth,c,h,g.data)}else if(e.isData3DTexture){const g=i.image;n.texSubImage3D(n.TEXTURE_3D,0,0,0,0,g.width,g.height,g.depth,c,h,g.data)}else if(e.isVideoTexture)e.update(),n.texImage2D(u,0,p,c,h,i.image);else{const g=f(i.image);n.texSubImage2D(u,0,0,0,s,o,c,h,g)}}generateMipmaps(e){const{gl:i,backend:n}=this,{textureGPU:s,glTextureType:o}=n.get(e);n.state.bindTexture(o,s),i.generateMipmap(o)}deallocateRenderBuffers(e){const{gl:i,backend:n}=this;if(e){const s=n.get(e);if(s.renderBufferStorageSetup=void 0,s.framebuffers){for(const o in s.framebuffers)i.deleteFramebuffer(s.framebuffers[o]);delete s.framebuffers}if(s.depthRenderbuffer&&(i.deleteRenderbuffer(s.depthRenderbuffer),delete s.depthRenderbuffer),s.stencilRenderbuffer&&(i.deleteRenderbuffer(s.stencilRenderbuffer),delete s.stencilRenderbuffer),s.msaaFrameBuffer&&(i.deleteFramebuffer(s.msaaFrameBuffer),delete s.msaaFrameBuffer),s.msaaRenderbuffers){for(let o=0;o<s.msaaRenderbuffers.length;o++)i.deleteRenderbuffer(s.msaaRenderbuffers[o]);delete s.msaaRenderbuffers}}}destroyTexture(e){const{gl:i,backend:n}=this,{textureGPU:s,renderTarget:o}=n.get(e);this.deallocateRenderBuffers(o),i.deleteTexture(s),n.delete(e)}copyTextureToTexture(e,i,n=null,s=null,o=0){const{gl:l,backend:u}=this,{state:c}=this.backend,{textureGPU:h,glTextureType:p,glType:f,glFormat:g}=u.get(i);let m,y,b,v,_,T;n!==null?(m=n.max.x-n.min.x,y=n.max.y-n.min.y,b=n.min.x,v=n.min.y):(m=e.image.width,y=e.image.height,b=0,v=0),s!==null?(_=s.x,T=s.y):(_=0,T=0),c.bindTexture(p,h),l.pixelStorei(l.UNPACK_ALIGNMENT,i.unpackAlignment),l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,i.flipY),l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),l.pixelStorei(l.UNPACK_ALIGNMENT,i.unpackAlignment);const E=l.getParameter(l.UNPACK_ROW_LENGTH),C=l.getParameter(l.UNPACK_IMAGE_HEIGHT),R=l.getParameter(l.UNPACK_SKIP_PIXELS),B=l.getParameter(l.UNPACK_SKIP_ROWS),I=l.getParameter(l.UNPACK_SKIP_IMAGES),N=e.isCompressedTexture?e.mipmaps[o]:e.image;if(l.pixelStorei(l.UNPACK_ROW_LENGTH,N.width),l.pixelStorei(l.UNPACK_IMAGE_HEIGHT,N.height),l.pixelStorei(l.UNPACK_SKIP_PIXELS,b),l.pixelStorei(l.UNPACK_SKIP_ROWS,v),e.isRenderTargetTexture||e.isDepthTexture){const D=u.get(e),P=u.get(i),k=u.get(D.renderTarget),q=u.get(P.renderTarget),V=k.framebuffers[D.cacheKey],j=q.framebuffers[P.cacheKey];c.bindFramebuffer(l.READ_FRAMEBUFFER,V),c.bindFramebuffer(l.DRAW_FRAMEBUFFER,j);let Q=l.COLOR_BUFFER_BIT;e.isDepthTexture&&(Q=l.DEPTH_BUFFER_BIT),l.blitFramebuffer(b,v,m,y,_,T,m,y,Q,l.NEAREST),c.bindFramebuffer(l.READ_FRAMEBUFFER,null),c.bindFramebuffer(l.DRAW_FRAMEBUFFER,null)}else e.isDataTexture?l.texSubImage2D(l.TEXTURE_2D,o,_,T,m,y,g,f,N.data):e.isCompressedTexture?l.compressedTexSubImage2D(l.TEXTURE_2D,o,_,T,N.width,N.height,g,N.data):l.texSubImage2D(l.TEXTURE_2D,o,_,T,m,y,g,f,N);l.pixelStorei(l.UNPACK_ROW_LENGTH,E),l.pixelStorei(l.UNPACK_IMAGE_HEIGHT,C),l.pixelStorei(l.UNPACK_SKIP_PIXELS,R),l.pixelStorei(l.UNPACK_SKIP_ROWS,B),l.pixelStorei(l.UNPACK_SKIP_IMAGES,I),o===0&&i.generateMipmaps&&l.generateMipmap(l.TEXTURE_2D),c.unbindTexture()}copyFramebufferToTexture(e,i,n){const{gl:s}=this,{state:o}=this.backend,{textureGPU:l}=this.backend.get(e),{x:u,y:c,z:h,w:p}=n,f=e.isDepthTexture===!0||i.renderTarget&&i.renderTarget.samples>0,g=i.renderTarget?i.renderTarget.height:this.backend.gerDrawingBufferSize().y;if(f){const m=u!==0||c!==0;let y,b;if(e.isDepthTexture===!0?(y=s.DEPTH_BUFFER_BIT,b=s.DEPTH_ATTACHMENT,i.stencil&&(y|=s.STENCIL_BUFFER_BIT)):(y=s.COLOR_BUFFER_BIT,b=s.COLOR_ATTACHMENT0),m){const v=this.backend.get(i.renderTarget),_=v.framebuffers[i.getCacheKey()],T=v.msaaFrameBuffer;o.bindFramebuffer(s.DRAW_FRAMEBUFFER,_),o.bindFramebuffer(s.READ_FRAMEBUFFER,T);const E=g-c-p;s.blitFramebuffer(u,E,u+h,E+p,u,E,u+h,E+p,y,s.NEAREST),o.bindFramebuffer(s.READ_FRAMEBUFFER,_),o.bindTexture(s.TEXTURE_2D,l),s.copyTexSubImage2D(s.TEXTURE_2D,0,0,0,u,E,h,p),o.unbindTexture()}else{const v=s.createFramebuffer();o.bindFramebuffer(s.DRAW_FRAMEBUFFER,v),s.framebufferTexture2D(s.DRAW_FRAMEBUFFER,b,s.TEXTURE_2D,l,0),s.blitFramebuffer(0,0,h,p,0,0,h,p,y,s.NEAREST),s.deleteFramebuffer(v)}}else o.bindTexture(s.TEXTURE_2D,l),s.copyTexSubImage2D(s.TEXTURE_2D,0,0,0,u,g-p-c,h,p),o.unbindTexture();e.generateMipmaps&&this.generateMipmaps(e),this.backend._setFramebuffer(i)}setupRenderBufferStorage(e,i){const{gl:n}=this,s=i.renderTarget,{samples:o,depthTexture:l,depthBuffer:u,stencilBuffer:c,width:h,height:p}=s;if(n.bindRenderbuffer(n.RENDERBUFFER,e),u&&!c){let f=n.DEPTH_COMPONENT24;o>0?(l&&l.isDepthTexture&&l.type===n.FLOAT&&(f=n.DEPTH_COMPONENT32F),n.renderbufferStorageMultisample(n.RENDERBUFFER,o,f,h,p)):n.renderbufferStorage(n.RENDERBUFFER,f,h,p),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,e)}else u&&c&&(o>0?n.renderbufferStorageMultisample(n.RENDERBUFFER,o,n.DEPTH24_STENCIL8,h,p):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,h,p),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,e))}async copyTextureToBuffer(e,i,n,s,o,l){const{backend:u,gl:c}=this,{textureGPU:h,glFormat:p,glType:f}=this.backend.get(e),g=c.createFramebuffer();c.bindFramebuffer(c.READ_FRAMEBUFFER,g);const m=e.isCubeTexture?c.TEXTURE_CUBE_MAP_POSITIVE_X+l:c.TEXTURE_2D;c.framebufferTexture2D(c.READ_FRAMEBUFFER,c.COLOR_ATTACHMENT0,m,h,0);const y=this._getTypedArrayType(f),b=this._getBytesPerTexel(f,p),v=s*o*b,_=c.createBuffer();c.bindBuffer(c.PIXEL_PACK_BUFFER,_),c.bufferData(c.PIXEL_PACK_BUFFER,v,c.STREAM_READ),c.readPixels(i,n,s,o,p,f,0),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),await u.utils._clientWaitAsync();const T=new y(v/y.BYTES_PER_ELEMENT);return c.bindBuffer(c.PIXEL_PACK_BUFFER,_),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,T),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),c.deleteFramebuffer(g),T}_getTypedArrayType(e){const{gl:i}=this;if(e===i.UNSIGNED_BYTE)return Uint8Array;if(e===i.UNSIGNED_SHORT_4_4_4_4||e===i.UNSIGNED_SHORT_5_5_5_1||e===i.UNSIGNED_SHORT_5_6_5||e===i.UNSIGNED_SHORT)return Uint16Array;if(e===i.UNSIGNED_INT)return Uint32Array;if(e===i.HALF_FLOAT)return Uint16Array;if(e===i.FLOAT)return Float32Array;throw new Error(`Unsupported WebGL type: ${e}`)}_getBytesPerTexel(e,i){const{gl:n}=this;let s=0;if(e===n.UNSIGNED_BYTE&&(s=1),(e===n.UNSIGNED_SHORT_4_4_4_4||e===n.UNSIGNED_SHORT_5_5_5_1||e===n.UNSIGNED_SHORT_5_6_5||e===n.UNSIGNED_SHORT||e===n.HALF_FLOAT)&&(s=2),(e===n.UNSIGNED_INT||e===n.FLOAT)&&(s=4),i===n.RGBA)return s*4;if(i===n.RGB)return s*3;if(i===n.ALPHA)return s}}class tye{constructor(e){this.backend=e,this.gl=this.backend.gl,this.availableExtensions=this.gl.getSupportedExtensions(),this.extensions={}}get(e){let i=this.extensions[e];return i===void 0&&(i=this.gl.getExtension(e),this.extensions[e]=i),i}has(e){return this.availableExtensions.includes(e)}}class iye{constructor(e){this.backend=e,this.maxAnisotropy=null}getMaxAnisotropy(){if(this.maxAnisotropy!==null)return this.maxAnisotropy;const e=this.backend.gl,i=this.backend.extensions;if(i.has("EXT_texture_filter_anisotropic")===!0){const n=i.get("EXT_texture_filter_anisotropic");this.maxAnisotropy=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else this.maxAnisotropy=0;return this.maxAnisotropy}}const rz={WEBGL_multi_draw:"WEBGL_multi_draw",WEBGL_compressed_texture_astc:"texture-compression-astc",WEBGL_compressed_texture_etc:"texture-compression-etc2",WEBGL_compressed_texture_etc1:"texture-compression-etc1",WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBKIT_WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBGL_compressed_texture_s3tc:"texture-compression-bc",EXT_texture_compression_bptc:"texture-compression-bptc",EXT_disjoint_timer_query_webgl2:"timestamp-query"};class rye{constructor(e){this.gl=e.gl,this.extensions=e.extensions,this.info=e.renderer.info,this.mode=null,this.index=0,this.type=null,this.object=null}render(e,i){const{gl:n,mode:s,object:o,type:l,info:u,index:c}=this;c!==0?n.drawElements(s,i,l,e):n.drawArrays(s,e,i),u.update(o,i,s,1)}renderInstances(e,i,n){const{gl:s,mode:o,type:l,index:u,object:c,info:h}=this;n!==0&&(u!==0?s.drawElementsInstanced(o,i,l,e,n):s.drawArraysInstanced(o,e,i,n),h.update(c,i,o,n))}renderMultiDraw(e,i,n){const{extensions:s,mode:o,object:l,info:u}=this;if(n===0)return;const c=s.get("WEBGL_multi_draw");if(c===null)for(let h=0;h<n;h++)this.render(e[h],i[h]);else{this.index!==0?c.multiDrawElementsWEBGL(o,i,0,this.type,e,0,n):c.multiDrawArraysWEBGL(o,e,0,i,0,n);let h=0;for(let p=0;p<n;p++)h+=i[p];u.update(l,h,o,1)}}renderMultiDrawInstances(e,i,n,s){const{extensions:o,mode:l,object:u,info:c}=this;if(n===0)return;const h=o.get("WEBGL_multi_draw");if(h===null)for(let p=0;p<n;p++)this.renderInstances(e[p],i[p],s[p]);else{this.index!==0?h.multiDrawElementsInstancedWEBGL(l,i,0,this.type,e,0,s,0,n):h.multiDrawArraysInstancedWEBGL(l,e,0,i,0,s,0,n);let p=0;for(let f=0;f<n;f++)p+=i[f]*s[f];c.update(u,p,l,1)}}}class nz extends $7{constructor(e={}){super(e),this.isWebGLBackend=!0}init(e){super.init(e);const i=this.parameters,n=i.context!==void 0?i.context:e.domElement.getContext("webgl2");function s(o){o.preventDefault();const l={api:"WebGL",message:o.statusMessage||"Unknown reason",reason:null,originalEvent:o};e.onDeviceLost(l)}this._onContextLost=s,e.domElement.addEventListener("webglcontextlost",s,!1),this.gl=n,this.extensions=new tye(this),this.capabilities=new iye(this),this.attributeUtils=new JAe(this),this.textureUtils=new eye(this),this.bufferRenderer=new rye(this),this.state=new ZAe(this),this.utils=new $Ae(this),this.vaoCache={},this.transformFeedbackCache={},this.discard=!1,this.trackTimestamp=i.trackTimestamp===!0,this.extensions.get("EXT_color_buffer_float"),this.extensions.get("WEBGL_clip_cull_distance"),this.extensions.get("OES_texture_float_linear"),this.extensions.get("EXT_color_buffer_half_float"),this.extensions.get("WEBGL_multisampled_render_to_texture"),this.extensions.get("WEBGL_render_shared_exponent"),this.extensions.get("WEBGL_multi_draw"),this.disjoint=this.extensions.get("EXT_disjoint_timer_query_webgl2"),this.parallel=this.extensions.get("KHR_parallel_shader_compile"),this._knownBindings=new WeakSet,this._currentContext=null}get coordinateSystem(){return gc}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}async waitForGPU(){await this.utils._clientWaitAsync()}initTimestampQuery(e){if(!this.disjoint||!this.trackTimestamp)return;const i=this.get(e);if(this.queryRunning){i.queryQueue||(i.queryQueue=[]),i.queryQueue.push(e);return}i.activeQuery&&(this.gl.endQuery(this.disjoint.TIME_ELAPSED_EXT),i.activeQuery=null),i.activeQuery=this.gl.createQuery(),i.activeQuery!==null&&(this.gl.beginQuery(this.disjoint.TIME_ELAPSED_EXT,i.activeQuery),this.queryRunning=!0)}prepareTimestampBuffer(e){if(!this.disjoint||!this.trackTimestamp)return;const i=this.get(e);if(i.activeQuery&&(this.gl.endQuery(this.disjoint.TIME_ELAPSED_EXT),i.gpuQueries||(i.gpuQueries=[]),i.gpuQueries.push({query:i.activeQuery}),i.activeQuery=null,this.queryRunning=!1,i.queryQueue&&i.queryQueue.length>0)){const n=i.queryQueue.shift();this.initTimestampQuery(n)}}async resolveTimestampAsync(e,i="render"){if(!this.disjoint||!this.trackTimestamp)return;const n=this.get(e);n.gpuQueries||(n.gpuQueries=[]);for(let s=0;s<n.gpuQueries.length;s++){const o=n.gpuQueries[s],l=this.gl.getQueryParameter(o.query,this.gl.QUERY_RESULT_AVAILABLE),u=this.gl.getParameter(this.disjoint.GPU_DISJOINT_EXT);if(l&&!u){const c=this.gl.getQueryParameter(o.query,this.gl.QUERY_RESULT),h=Number(c)/1e6;this.gl.deleteQuery(o.query),n.gpuQueries.splice(s,1),s--,this.renderer.info.updateTimestamp(i,h)}}}getContext(){return this.gl}beginRender(e){const{gl:i}=this,n=this.get(e);if(this.initTimestampQuery(e),n.previousContext=this._currentContext,this._currentContext=e,this._setFramebuffer(e),this.clear(e.clearColor,e.clearDepth,e.clearStencil,e,!1),e.viewport?this.updateViewport(e):i.viewport(0,0,i.drawingBufferWidth,i.drawingBufferHeight),e.scissor){const{x:o,y:l,width:u,height:c}=e.scissorValue;i.scissor(o,e.height-c-l,u,c)}const s=e.occlusionQueryCount;s>0&&(n.currentOcclusionQueries=n.occlusionQueries,n.currentOcclusionQueryObjects=n.occlusionQueryObjects,n.lastOcclusionObject=null,n.occlusionQueries=new Array(s),n.occlusionQueryObjects=new Array(s),n.occlusionQueryIndex=0)}finishRender(e){const{gl:i,state:n}=this,s=this.get(e),o=s.previousContext,l=e.occlusionQueryCount;l>0&&(l>s.occlusionQueryIndex&&i.endQuery(i.ANY_SAMPLES_PASSED),this.resolveOccludedAsync(e));const u=e.textures;if(u!==null)for(let c=0;c<u.length;c++){const h=u[c];h.generateMipmaps&&this.generateMipmaps(h)}if(this._currentContext=o,e.textures!==null&&e.renderTarget){const c=this.get(e.renderTarget),{samples:h}=e.renderTarget;if(h>0){const p=c.framebuffers[e.getCacheKey()],f=i.COLOR_BUFFER_BIT,g=c.msaaFrameBuffer,m=e.textures;n.bindFramebuffer(i.READ_FRAMEBUFFER,g),n.bindFramebuffer(i.DRAW_FRAMEBUFFER,p);for(let y=0;y<m.length;y++)if(e.scissor){const{x:b,y:v,width:_,height:T}=e.scissorValue,E=e.height-T-v;i.blitFramebuffer(b,E,b+_,E+T,b,E,b+_,E+T,f,i.NEAREST),i.invalidateSubFramebuffer(i.READ_FRAMEBUFFER,c.invalidationArray,b,E,_,T)}else i.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,f,i.NEAREST),i.invalidateFramebuffer(i.READ_FRAMEBUFFER,c.invalidationArray)}}o!==null&&(this._setFramebuffer(o),o.viewport?this.updateViewport(o):i.viewport(0,0,i.drawingBufferWidth,i.drawingBufferHeight)),this.prepareTimestampBuffer(e)}resolveOccludedAsync(e){const i=this.get(e),{currentOcclusionQueries:n,currentOcclusionQueryObjects:s}=i;if(n&&s){const o=new WeakSet,{gl:l}=this;i.currentOcclusionQueryObjects=null,i.currentOcclusionQueries=null;const u=()=>{let c=0;for(let h=0;h<n.length;h++){const p=n[h];p!==null&&l.getQueryParameter(p,l.QUERY_RESULT_AVAILABLE)&&(l.getQueryParameter(p,l.QUERY_RESULT)>0&&o.add(s[h]),n[h]=null,l.deleteQuery(p),c++)}c<n.length?requestAnimationFrame(u):i.occluded=o};u()}}isOccluded(e,i){const n=this.get(e);return n.occluded&&n.occluded.has(i)}updateViewport(e){const i=this.gl,{x:n,y:s,width:o,height:l}=e.viewportValue;i.viewport(n,e.height-l-s,o,l)}setScissorTest(e){const i=this.gl;e?i.enable(i.SCISSOR_TEST):i.disable(i.SCISSOR_TEST)}clear(e,i,n,s=null,o=!0){const{gl:l}=this;if(s===null){const c=this.getClearColor();c.r*=c.a,c.g*=c.a,c.b*=c.a,s={textures:null,clearColorValue:c}}let u=0;if(e&&(u|=l.COLOR_BUFFER_BIT),i&&(u|=l.DEPTH_BUFFER_BIT),n&&(u|=l.STENCIL_BUFFER_BIT),u!==0){let c;if(s.clearColorValue?c=s.clearColorValue:(c=this.getClearColor(),c.r*=c.a,c.g*=c.a,c.b*=c.a),i&&this.state.setDepthMask(!0),s.textures===null)l.clearColor(c.r,c.g,c.b,c.a),l.clear(u);else{if(o&&this._setFramebuffer(s),e)for(let h=0;h<s.textures.length;h++)l.clearBufferfv(l.COLOR,h,[c.r,c.g,c.b,c.a]);i&&n?l.clearBufferfi(l.DEPTH_STENCIL,0,1,0):i?l.clearBufferfv(l.DEPTH,0,[1]):n&&l.clearBufferiv(l.STENCIL,0,[0])}}}beginCompute(e){const{state:i,gl:n}=this;i.bindFramebuffer(n.FRAMEBUFFER,null),this.initTimestampQuery(e)}compute(e,i,n,s){const{state:o,gl:l}=this;this.discard||(l.enable(l.RASTERIZER_DISCARD),this.discard=!0);const{programGPU:u,transformBuffers:c,attributes:h}=this.get(s),p=this._getVaoKey(null,h),f=this.vaoCache[p];f===void 0?this._createVao(null,h):l.bindVertexArray(f),o.useProgram(u),this._bindUniforms(n);const g=this._getTransformFeedback(c);l.bindTransformFeedback(l.TRANSFORM_FEEDBACK,g),l.beginTransformFeedback(l.POINTS),h[0].isStorageInstancedBufferAttribute?l.drawArraysInstanced(l.POINTS,0,1,i.count):l.drawArrays(l.POINTS,0,i.count),l.endTransformFeedback(),l.bindTransformFeedback(l.TRANSFORM_FEEDBACK,null);for(let m=0;m<c.length;m++){const y=c[m];y.pbo&&this.textureUtils.copyBufferToTexture(y.transformBuffer,y.pbo),y.switchBuffers()}}finishCompute(e){const i=this.gl;this.discard=!1,i.disable(i.RASTERIZER_DISCARD),this.prepareTimestampBuffer(e),this._currentContext&&this._setFramebuffer(this._currentContext)}draw(e){const{object:i,pipeline:n,material:s,context:o}=e,{programGPU:l}=this.get(n),{gl:u,state:c}=this,h=this.get(o),p=e.getDrawParameters();if(p===null)return;this._bindUniforms(e.getBindings());const f=i.isMesh&&i.matrixWorld.determinant()<0;c.setMaterial(s,f),c.useProgram(l);let g=e.staticVao;if(g===void 0){const E=this._getVaoKey(e.getIndex(),e.getAttributes());if(g=this.vaoCache[E],g===void 0){let C;({vaoGPU:g,staticVao:C}=this._createVao(e.getIndex(),e.getAttributes())),C&&(e.staticVao=g)}}u.bindVertexArray(g);const m=e.getIndex(),y=h.lastOcclusionObject;if(y!==i&&y!==void 0){if(y!==null&&y.occlusionTest===!0&&(u.endQuery(u.ANY_SAMPLES_PASSED),h.occlusionQueryIndex++),i.occlusionTest===!0){const E=u.createQuery();u.beginQuery(u.ANY_SAMPLES_PASSED,E),h.occlusionQueries[h.occlusionQueryIndex]=E,h.occlusionQueryObjects[h.occlusionQueryIndex]=i}h.lastOcclusionObject=i}const b=this.bufferRenderer;i.isPoints?b.mode=u.POINTS:i.isLineSegments?b.mode=u.LINES:i.isLine?b.mode=u.LINE_STRIP:i.isLineLoop?b.mode=u.LINE_LOOP:s.wireframe===!0?(c.setLineWidth(s.wireframeLinewidth*this.renderer.getPixelRatio()),b.mode=u.LINES):b.mode=u.TRIANGLES;const{vertexCount:v,instanceCount:_}=p;let{firstVertex:T}=p;if(b.object=i,m!==null){T*=m.array.BYTES_PER_ELEMENT;const E=this.get(m);b.index=m.count,b.type=E.type}else b.index=0;i.isBatchedMesh?i._multiDrawInstances!==null?b.renderMultiDrawInstances(i._multiDrawStarts,i._multiDrawCounts,i._multiDrawCount,i._multiDrawInstances):this.hasFeature("WEBGL_multi_draw")?b.renderMultiDraw(i._multiDrawStarts,i._multiDrawCounts,i._multiDrawCount):Wue("THREE.WebGLRenderer: WEBGL_multi_draw not supported."):_>1?b.renderInstances(T,v,_):b.render(T,v),u.bindVertexArray(null)}needsRenderUpdate(){return!1}getRenderCacheKey(){return""}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,i){this.textureUtils.createTexture(e,i)}updateTexture(e,i){this.textureUtils.updateTexture(e,i)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e){this.textureUtils.destroyTexture(e)}copyTextureToBuffer(e,i,n,s,o,l){return this.textureUtils.copyTextureToBuffer(e,i,n,s,o,l)}createSampler(){}destroySampler(){}createNodeBuilder(e,i){return new XAe(e,i)}createProgram(e){const i=this.gl,{stage:n,code:s}=e,o=n==="fragment"?i.createShader(i.FRAGMENT_SHADER):i.createShader(i.VERTEX_SHADER);i.shaderSource(o,s),i.compileShader(o),this.set(e,{shaderGPU:o})}destroyProgram(){console.warn("Abstract class.")}createRenderPipeline(e,i){const n=this.gl,s=e.pipeline,{fragmentProgram:o,vertexProgram:l}=s,u=n.createProgram(),c=this.get(o).shaderGPU,h=this.get(l).shaderGPU;if(n.attachShader(u,c),n.attachShader(u,h),n.linkProgram(u),this.set(s,{programGPU:u,fragmentShader:c,vertexShader:h}),i!==null&&this.parallel){const p=new Promise(f=>{const g=this.parallel,m=()=>{n.getProgramParameter(u,g.COMPLETION_STATUS_KHR)?(this._completeCompile(e,s),f()):requestAnimationFrame(m)};m()});i.push(p);return}this._completeCompile(e,s)}_handleSource(e,i){const n=e.split(`
`),s=[],o=Math.max(i-6,0),l=Math.min(i+6,n.length);for(let u=o;u<l;u++){const c=u+1;s.push(`${c===i?">":" "} ${c}: ${n[u]}`)}return s.join(`
`)}_getShaderErrors(e,i,n){const s=e.getShaderParameter(i,e.COMPILE_STATUS),o=e.getShaderInfoLog(i).trim();if(s&&o==="")return"";const l=/ERROR: 0:(\d+)/.exec(o);if(l){const u=parseInt(l[1]);return n.toUpperCase()+`

`+o+`

`+this._handleSource(e.getShaderSource(i),u)}else return o}_logProgramError(e,i,n){if(this.renderer.debug.checkShaderErrors){const s=this.gl,o=s.getProgramInfoLog(e).trim();if(s.getProgramParameter(e,s.LINK_STATUS)===!1)if(typeof this.renderer.debug.onShaderError=="function")this.renderer.debug.onShaderError(s,e,n,i);else{const l=this._getShaderErrors(s,n,"vertex"),u=this._getShaderErrors(s,i,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(e,s.VALIDATE_STATUS)+`

Program Info Log: `+o+`
`+l+`
`+u)}else o!==""&&console.warn("THREE.WebGLProgram: Program Info Log:",o)}}_completeCompile(e,i){const{state:n,gl:s}=this,o=this.get(i),{programGPU:l,fragmentShader:u,vertexShader:c}=o;s.getProgramParameter(l,s.LINK_STATUS)===!1&&this._logProgramError(l,u,c),n.useProgram(l);const h=e.getBindings();this._setupBindings(h,l),this.set(i,{programGPU:l})}createComputePipeline(e,i){const{state:n,gl:s}=this,o={stage:"fragment",code:`#version 300 es
precision highp float;
void main() {}`};this.createProgram(o);const{computeProgram:l}=e,u=s.createProgram(),c=this.get(o).shaderGPU,h=this.get(l).shaderGPU,p=l.transforms,f=[],g=[];for(let v=0;v<p.length;v++){const _=p[v];f.push(_.varyingName),g.push(_.attributeNode)}s.attachShader(u,c),s.attachShader(u,h),s.transformFeedbackVaryings(u,f,s.SEPARATE_ATTRIBS),s.linkProgram(u),s.getProgramParameter(u,s.LINK_STATUS)===!1&&this._logProgramError(u,c,h),n.useProgram(u),this._setupBindings(i,u);const m=l.attributes,y=[],b=[];for(let v=0;v<m.length;v++){const _=m[v].node.attribute;y.push(_),this.has(_)||this.attributeUtils.createAttribute(_,s.ARRAY_BUFFER)}for(let v=0;v<g.length;v++){const _=g[v].attribute;this.has(_)||this.attributeUtils.createAttribute(_,s.ARRAY_BUFFER);const T=this.get(_);b.push(T)}this.set(e,{programGPU:u,transformBuffers:b,attributes:y})}createBindings(e,i){if(this._knownBindings.has(i)===!1){this._knownBindings.add(i);let n=0,s=0;for(const o of i){this.set(o,{textures:s,uniformBuffers:n});for(const l of o.bindings)l.isUniformBuffer&&n++,l.isSampledTexture&&s++}}this.updateBindings(e,i)}updateBindings(e){const{gl:i}=this,n=this.get(e);let s=n.uniformBuffers,o=n.textures;for(const l of e.bindings)if(l.isUniformsGroup||l.isUniformBuffer){const u=l.buffer,c=i.createBuffer();i.bindBuffer(i.UNIFORM_BUFFER,c),i.bufferData(i.UNIFORM_BUFFER,u,i.DYNAMIC_DRAW),this.set(l,{index:s++,bufferGPU:c})}else if(l.isSampledTexture){const{textureGPU:u,glTextureType:c}=this.get(l.texture);this.set(l,{index:o++,textureGPU:u,glTextureType:c})}}updateBinding(e){const i=this.gl;if(e.isUniformsGroup||e.isUniformBuffer){const n=this.get(e).bufferGPU,s=e.buffer;i.bindBuffer(i.UNIFORM_BUFFER,n),i.bufferData(i.UNIFORM_BUFFER,s,i.DYNAMIC_DRAW)}}createIndexAttribute(e){const i=this.gl;this.attributeUtils.createAttribute(e,i.ELEMENT_ARRAY_BUFFER)}createAttribute(e){if(this.has(e))return;const i=this.gl;this.attributeUtils.createAttribute(e,i.ARRAY_BUFFER)}createStorageAttribute(e){if(this.has(e))return;const i=this.gl;this.attributeUtils.createAttribute(e,i.ARRAY_BUFFER)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}updateSize(){}hasFeature(e){const i=Object.keys(rz).filter(s=>rz[s]===e),n=this.extensions;for(let s=0;s<i.length;s++)if(n.has(i[s]))return!0;return!1}getMaxAnisotropy(){return this.capabilities.getMaxAnisotropy()}copyTextureToTexture(e,i,n,s,o){this.textureUtils.copyTextureToTexture(e,i,n,s,o)}copyFramebufferToTexture(e,i,n){this.textureUtils.copyFramebufferToTexture(e,i,n)}_setFramebuffer(e){const{gl:i,state:n}=this;let s=null;if(e.textures!==null){const o=e.renderTarget,l=this.get(o),{samples:u,depthBuffer:c,stencilBuffer:h}=o,p=o.isWebGLCubeRenderTarget===!0;let f=l.msaaFrameBuffer,g=l.depthRenderbuffer;const m=g7(e);let y;if(p?(l.cubeFramebuffers||(l.cubeFramebuffers={}),y=l.cubeFramebuffers[m]):(l.framebuffers||(l.framebuffers={}),y=l.framebuffers[m]),y===void 0){y=i.createFramebuffer(),n.bindFramebuffer(i.FRAMEBUFFER,y);const b=e.textures;if(p){l.cubeFramebuffers[m]=y;const{textureGPU:v}=this.get(b[0]),_=this.renderer._activeCubeFace;i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+_,v,0)}else{l.framebuffers[m]=y;for(let v=0;v<b.length;v++){const _=b[v],T=this.get(_);T.renderTarget=e.renderTarget,T.cacheKey=m;const E=i.COLOR_ATTACHMENT0+v;i.framebufferTexture2D(i.FRAMEBUFFER,E,i.TEXTURE_2D,T.textureGPU,0)}n.drawBuffers(e,y)}if(e.depthTexture!==null){const v=this.get(e.depthTexture),_=h?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;v.renderTarget=e.renderTarget,v.cacheKey=m,i.framebufferTexture2D(i.FRAMEBUFFER,_,i.TEXTURE_2D,v.textureGPU,0)}}if(u>0){if(f===void 0){const b=[];f=i.createFramebuffer(),n.bindFramebuffer(i.FRAMEBUFFER,f);const v=[],_=e.textures;for(let T=0;T<_.length;T++){if(v[T]=i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,v[T]),b.push(i.COLOR_ATTACHMENT0+T),c){const R=h?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;b.push(R)}const E=e.textures[T],C=this.get(E);i.renderbufferStorageMultisample(i.RENDERBUFFER,u,C.glInternalFormat,e.width,e.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+T,i.RENDERBUFFER,v[T])}if(l.msaaFrameBuffer=f,l.msaaRenderbuffers=v,g===void 0){g=i.createRenderbuffer(),this.textureUtils.setupRenderBufferStorage(g,e),l.depthRenderbuffer=g;const T=h?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;b.push(T)}l.invalidationArray=b}s=l.msaaFrameBuffer}else s=y}n.bindFramebuffer(i.FRAMEBUFFER,s)}_getVaoKey(e,i){let n=[];if(e!==null){const s=this.get(e);n+=":"+s.id}for(let s=0;s<i.length;s++){const o=this.get(i[s]);n+=":"+o.id}return n}_createVao(e,i){const{gl:n}=this,s=n.createVertexArray();let o="",l=!0;if(n.bindVertexArray(s),e!==null){const u=this.get(e);n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,u.bufferGPU),o+=":"+u.id}for(let u=0;u<i.length;u++){const c=i[u],h=this.get(c);o+=":"+h.id,n.bindBuffer(n.ARRAY_BUFFER,h.bufferGPU),n.enableVertexAttribArray(u),(c.isStorageBufferAttribute||c.isStorageInstancedBufferAttribute)&&(l=!1);let p,f;c.isInterleavedBufferAttribute===!0?(p=c.data.stride*h.bytesPerElement,f=c.offset*h.bytesPerElement):(p=0,f=0),h.isInteger?n.vertexAttribIPointer(u,c.itemSize,h.type,p,f):n.vertexAttribPointer(u,c.itemSize,h.type,c.normalized,p,f),c.isInstancedBufferAttribute&&!c.isInterleavedBufferAttribute?n.vertexAttribDivisor(u,c.meshPerAttribute):c.isInterleavedBufferAttribute&&c.data.isInstancedInterleavedBuffer&&n.vertexAttribDivisor(u,c.data.meshPerAttribute)}return n.bindBuffer(n.ARRAY_BUFFER,null),this.vaoCache[o]=s,{vaoGPU:s,staticVao:l}}_getTransformFeedback(e){let i="";for(let o=0;o<e.length;o++)i+=":"+e[o].id;let n=this.transformFeedbackCache[i];if(n!==void 0)return n;const{gl:s}=this;n=s.createTransformFeedback(),s.bindTransformFeedback(s.TRANSFORM_FEEDBACK,n);for(let o=0;o<e.length;o++){const l=e[o];s.bindBufferBase(s.TRANSFORM_FEEDBACK_BUFFER,o,l.transformBuffer)}return s.bindTransformFeedback(s.TRANSFORM_FEEDBACK,null),this.transformFeedbackCache[i]=n,n}_setupBindings(e,i){const n=this.gl;for(const s of e)for(const o of s.bindings){const l=this.get(o).index;if(o.isUniformsGroup||o.isUniformBuffer){const u=n.getUniformBlockIndex(i,o.name);n.uniformBlockBinding(i,u,l)}else if(o.isSampledTexture){const u=n.getUniformLocation(i,o.name);n.uniform1i(u,l)}}}_bindUniforms(e){const{gl:i,state:n}=this;for(const s of e)for(const o of s.bindings){const l=this.get(o),u=l.index;o.isUniformsGroup||o.isUniformBuffer?n.bindBufferBase(i.UNIFORM_BUFFER,u,l.bufferGPU):o.isSampledTexture&&n.bindTexture(l.glTextureType,l.textureGPU,i.TEXTURE0+u)}}dispose(){this.renderer.domElement.removeEventListener("webglcontextlost",this._onContextLost)}}class nye extends JR{constructor(e,i){super(e),this.texture=i,this.version=i?i.version:0,this.isSampler=!0}}class sye extends nye{constructor(e,i,n){super(e,i?i.value:null),this.textureNode=i,this.groupNode=n}update(){this.texture=this.textureNode.value}}class aye extends W7{constructor(e,i){super(e,i?i.array:null),this.attribute=i,this.isStorageBuffer=!0}}let oye=0;class lye extends aye{constructor(e,i){super("StorageBuffer_"+oye++,e?e.value:null),this.nodeUniform=e,this.access=e?e.access:LR.Storage,this.groupNode=i}get buffer(){return this.nodeUniform.value}}class cye extends wd{constructor(e){super(),this.device=e;const i=`
struct VarysStruct {
	@builtin( position ) Position: vec4<f32>,
	@location( 0 ) vTex : vec2<f32>
};

@vertex
fn main( @builtin( vertex_index ) vertexIndex : u32 ) -> VarysStruct {

	var Varys : VarysStruct;

	var pos = array< vec2<f32>, 4 >(
		vec2<f32>( -1.0,  1.0 ),
		vec2<f32>(  1.0,  1.0 ),
		vec2<f32>( -1.0, -1.0 ),
		vec2<f32>(  1.0, -1.0 )
	);

	var tex = array< vec2<f32>, 4 >(
		vec2<f32>( 0.0, 0.0 ),
		vec2<f32>( 1.0, 0.0 ),
		vec2<f32>( 0.0, 1.0 ),
		vec2<f32>( 1.0, 1.0 )
	);

	Varys.vTex = tex[ vertexIndex ];
	Varys.Position = vec4<f32>( pos[ vertexIndex ], 0.0, 1.0 );

	return Varys;

}
`,n=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vTex );

}
`,s=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vec2( vTex.x, 1.0 - vTex.y ) );

}
`;this.mipmapSampler=e.createSampler({minFilter:Kp.Linear}),this.flipYSampler=e.createSampler({minFilter:Kp.Nearest}),this.transferPipelines={},this.flipYPipelines={},this.mipmapVertexShaderModule=e.createShaderModule({label:"mipmapVertex",code:i}),this.mipmapFragmentShaderModule=e.createShaderModule({label:"mipmapFragment",code:n}),this.flipYFragmentShaderModule=e.createShaderModule({label:"flipYFragment",code:s})}getTransferPipeline(e){let i=this.transferPipelines[e];return i===void 0&&(i=this.device.createRenderPipeline({label:`mipmap-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.mipmapFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:Og.TriangleStrip,stripIndexFormat:kg.Uint32},layout:"auto"}),this.transferPipelines[e]=i),i}getFlipYPipeline(e){let i=this.flipYPipelines[e];return i===void 0&&(i=this.device.createRenderPipeline({label:`flipY-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.flipYFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:Og.TriangleStrip,stripIndexFormat:kg.Uint32},layout:"auto"}),this.flipYPipelines[e]=i),i}flipY(e,i,n=0){const s=i.format,{width:o,height:l}=i.size,u=this.getTransferPipeline(s),c=this.getFlipYPipeline(s),h=this.device.createTexture({size:{width:o,height:l,depthOrArrayLayers:1},format:s,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),p=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:Ul.TwoD,baseArrayLayer:n}),f=h.createView({baseMipLevel:0,mipLevelCount:1,dimension:Ul.TwoD,baseArrayLayer:0}),g=this.device.createCommandEncoder({}),m=(y,b,v)=>{const _=y.getBindGroupLayout(0),T=this.device.createBindGroup({layout:_,entries:[{binding:0,resource:this.flipYSampler},{binding:1,resource:b}]}),E=g.beginRenderPass({colorAttachments:[{view:v,loadOp:la.Clear,storeOp:Ha.Store,clearValue:[0,0,0,0]}]});E.setPipeline(y),E.setBindGroup(0,T),E.draw(4,1,0,0),E.end()};m(u,p,f),m(c,f,p),this.device.queue.submit([g.finish()]),h.destroy()}generateMipmaps(e,i,n=0){const s=this.get(e);s.useCount===void 0&&(s.useCount=0,s.layers=[]);const o=s.layers[n]||this._mipmapCreateBundles(e,i,n),l=this.device.createCommandEncoder({});this._mipmapRunBundles(l,o),this.device.queue.submit([l.finish()]),s.useCount!==0&&(s.layers[n]=o),s.useCount++}_mipmapCreateBundles(e,i,n){const s=this.getTransferPipeline(i.format),o=s.getBindGroupLayout(0);let l=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:Ul.TwoD,baseArrayLayer:n});const u=[];for(let c=1;c<i.mipLevelCount;c++){const h=this.device.createBindGroup({layout:o,entries:[{binding:0,resource:this.mipmapSampler},{binding:1,resource:l}]}),p=e.createView({baseMipLevel:c,mipLevelCount:1,dimension:Ul.TwoD,baseArrayLayer:n}),f={colorAttachments:[{view:p,loadOp:la.Clear,storeOp:Ha.Store,clearValue:[0,0,0,0]}]},g=this.device.createRenderBundleEncoder({colorFormats:[i.format]});g.setPipeline(s),g.setBindGroup(0,h),g.draw(4,1,0,0),u.push({renderBundles:[g.finish()],passDescriptor:f}),l=p}return u}_mipmapRunBundles(e,i){const n=i.length;for(let s=0;s<n;s++){const o=i[s],l=e.beginRenderPass(o.passDescriptor);l.executeBundles(o.renderBundles),l.end()}}}const uye={[gU]:"never",[e3]:"less",[AU]:"equal",[yU]:"less-equal",[vU]:"greater",[xU]:"greater-equal",[_U]:"always",[bU]:"not-equal"},hye=[0,1,3,2,4,5];class dye{constructor(e){this.backend=e,this._passUtils=null,this.defaultTexture={},this.defaultCubeTexture={},this.defaultVideoFrame=null,this.colorBuffer=null,this.depthTexture=new Eg,this.depthTexture.name="depthBuffer"}createSampler(e){const i=this.backend,n=i.device,s=i.get(e),o={addressModeU:this._convertAddressMode(e.wrapS),addressModeV:this._convertAddressMode(e.wrapT),addressModeW:this._convertAddressMode(e.wrapR),magFilter:this._convertFilterMode(e.magFilter),minFilter:this._convertFilterMode(e.minFilter),mipmapFilter:this._convertFilterMode(e.minFilter),maxAnisotropy:1};o.magFilter===Kp.Linear&&o.minFilter===Kp.Linear&&o.mipmapFilter===Kp.Linear&&(o.maxAnisotropy=e.anisotropy),e.isDepthTexture&&e.compareFunction!==null&&(o.compare=uye[e.compareFunction]),s.sampler=n.createSampler(o)}createDefaultTexture(e){let i;const n=iI(e);e.isCubeTexture?i=this._getDefaultCubeTextureGPU(n):e.isVideoTexture?this.backend.get(e).externalTexture=this._getDefaultVideoFrame():i=this._getDefaultTextureGPU(n),this.backend.get(e).texture=i}createTexture(e,i={}){const n=this.backend,s=n.get(e);if(s.initialized)throw new Error("WebGPUTextureUtils: Texture already initialized.");i.needsMipmaps===void 0&&(i.needsMipmaps=!1),i.levels===void 0&&(i.levels=1),i.depth===void 0&&(i.depth=1);const{width:o,height:l,depth:u,levels:c}=i;e.isFramebufferTexture&&(i.renderTarget?i.format=this.backend.utils.getCurrentColorFormat(i.renderTarget):i.format=this.backend.utils.getPreferredCanvasFormat());const h=this._getDimension(e),p=e.internalFormat||i.format||iI(e,n.device);s.format=p;let f=i.sampleCount!==void 0?i.sampleCount:1;f=n.utils.getSampleCount(f);const g=e.isRenderTargetTexture&&!e.isMultisampleRenderTargetTexture?1:f;let m=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;e.isStorageTexture===!0&&(m|=GPUTextureUsage.STORAGE_BINDING),e.isCompressedTexture!==!0&&e.isCompressedArrayTexture!==!0&&(m|=GPUTextureUsage.RENDER_ATTACHMENT);const y={label:e.name,size:{width:o,height:l,depthOrArrayLayers:u},mipLevelCount:c,sampleCount:g,dimension:h,format:p,usage:m};if(e.isVideoTexture){const b=e.source.data,v=new VideoFrame(b);y.size.width=v.displayWidth,y.size.height=v.displayHeight,v.close(),s.externalTexture=b}else{if(p===void 0)return console.warn("WebGPURenderer: Texture format not supported."),this.createDefaultTexture(e);s.texture=n.device.createTexture(y)}if(e.isRenderTargetTexture&&f>1&&!e.isMultisampleRenderTargetTexture){const b=Object.assign({},y);b.label=b.label+"-msaa",b.sampleCount=f,s.msaaTexture=n.device.createTexture(b)}s.initialized=!0,s.textureDescriptorGPU=y}destroyTexture(e){const i=this.backend,n=i.get(e);n.texture.destroy(),n.msaaTexture!==void 0&&n.msaaTexture.destroy(),i.delete(e)}destroySampler(e){const i=this.backend.get(e);delete i.sampler}generateMipmaps(e){const i=this.backend.get(e);if(e.isCubeTexture)for(let n=0;n<6;n++)this._generateMipmaps(i.texture,i.textureDescriptorGPU,n);else{const n=e.image.depth||1;for(let s=0;s<n;s++)this._generateMipmaps(i.texture,i.textureDescriptorGPU,s)}}getColorBuffer(){this.colorBuffer&&this.colorBuffer.destroy();const e=this.backend,{width:i,height:n}=e.getDrawingBufferSize();return this.colorBuffer=e.device.createTexture({label:"colorBuffer",size:{width:i,height:n,depthOrArrayLayers:1},sampleCount:e.utils.getSampleCount(e.renderer.samples),format:e.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),this.colorBuffer}getDepthBuffer(e=!0,i=!1){const n=this.backend,{width:s,height:o}=n.getDrawingBufferSize(),l=this.depthTexture,u=n.get(l).texture;let c,h;if(i?(c=ag,h=$A):e&&(c=Dp,h=Fa),u!==void 0){if(l.image.width===s&&l.image.height===o&&l.format===c&&l.type===h)return u;this.destroyTexture(l)}return l.name="depthBuffer",l.format=c,l.type=h,l.image.width=s,l.image.height=o,this.createTexture(l,{sampleCount:n.utils.getSampleCount(n.renderer.samples),width:s,height:o}),n.get(l).texture}updateTexture(e,i){const n=this.backend.get(e),{textureDescriptorGPU:s}=n;if(!(e.isRenderTargetTexture||s===void 0)){if(e.isDataTexture)this._copyBufferToTexture(i.image,n.texture,s,0,e.flipY);else if(e.isDataArrayTexture||e.isData3DTexture)for(let o=0;o<i.image.depth;o++)this._copyBufferToTexture(i.image,n.texture,s,o,e.flipY,o);else if(e.isCompressedTexture||e.isCompressedArrayTexture)this._copyCompressedBufferToTexture(e.mipmaps,n.texture,s);else if(e.isCubeTexture)this._copyCubeMapToTexture(i.images,n.texture,s,e.flipY);else if(e.isVideoTexture){const o=e.source.data;n.externalTexture=o}else this._copyImageToTexture(i.image,n.texture,s,0,e.flipY);n.version=e.version,e.onUpdate&&e.onUpdate(e)}}async copyTextureToBuffer(e,i,n,s,o,l){const u=this.backend.device,c=this.backend.get(e),h=c.texture,p=c.textureDescriptorGPU.format,f=this._getBytesPerTexel(p);let g=s*f;g=Math.ceil(g/256)*256;const m=u.createBuffer({size:s*o*f,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),y=u.createCommandEncoder();y.copyTextureToBuffer({texture:h,origin:{x:i,y:n,z:l}},{buffer:m,bytesPerRow:g},{width:s,height:o});const b=this._getTypedArrayType(p);u.queue.submit([y.finish()]),await m.mapAsync(GPUMapMode.READ);const v=m.getMappedRange();return new b(v)}_isEnvironmentTexture(e){const i=e.mapping;return i===YA||i===KA||i===Lp||i===tg}_getDefaultTextureGPU(e){let i=this.defaultTexture[e];if(i===void 0){const n=new wo;n.minFilter=to,n.magFilter=to,this.createTexture(n,{width:1,height:1,format:e}),this.defaultTexture[e]=i=n}return this.backend.get(i).texture}_getDefaultCubeTextureGPU(e){let i=this.defaultTexture[e];if(i===void 0){const n=new E3;n.minFilter=to,n.magFilter=to,this.createTexture(n,{width:1,height:1,depth:6}),this.defaultCubeTexture[e]=i=n}return this.backend.get(i).texture}_getDefaultVideoFrame(){let e=this.defaultVideoFrame;if(e===null){const i={timestamp:0,codedWidth:1,codedHeight:1,format:"RGBA"};this.defaultVideoFrame=e=new VideoFrame(new Uint8Array([0,0,0,255]),i)}return e}_copyCubeMapToTexture(e,i,n,s){for(let o=0;o<6;o++){const l=e[o],u=s===!0?hye[o]:o;l.isDataTexture?this._copyBufferToTexture(l.image,i,n,u,s):this._copyImageToTexture(l,i,n,u,s)}}_copyImageToTexture(e,i,n,s,o){this.backend.device.queue.copyExternalImageToTexture({source:e},{texture:i,mipLevel:0,origin:{x:0,y:0,z:s}},{width:e.width,height:e.height,depthOrArrayLayers:1}),o===!0&&this._flipY(i,n,s)}_getPassUtils(){let e=this._passUtils;return e===null&&(this._passUtils=e=new cye(this.backend.device)),e}_generateMipmaps(e,i,n=0){this._getPassUtils().generateMipmaps(e,i,n)}_flipY(e,i,n=0){this._getPassUtils().flipY(e,i,n)}_copyBufferToTexture(e,i,n,s,o,l=0){const u=this.backend.device,c=e.data,h=this._getBytesPerTexel(n.format),p=e.width*h;u.queue.writeTexture({texture:i,mipLevel:0,origin:{x:0,y:0,z:s}},c,{offset:e.width*e.height*h*l,bytesPerRow:p},{width:e.width,height:e.height,depthOrArrayLayers:1}),o===!0&&this._flipY(i,n,s)}_copyCompressedBufferToTexture(e,i,n){const s=this.backend.device,o=this._getBlockData(n.format),l=n.size.depthOrArrayLayers>1;for(let u=0;u<e.length;u++){const c=e[u],h=c.width,p=c.height,f=l?n.size.depthOrArrayLayers:1,g=Math.ceil(h/o.width)*o.byteLength,m=g*Math.ceil(p/o.height);for(let y=0;y<f;y++)s.queue.writeTexture({texture:i,mipLevel:u,origin:{x:0,y:0,z:y}},c.data,{offset:y*m,bytesPerRow:g,rowsPerImage:Math.ceil(p/o.height)},{width:Math.ceil(h/o.width)*o.width,height:Math.ceil(p/o.height)*o.height,depthOrArrayLayers:1})}}_getBlockData(e){if(e===ht.BC1RGBAUnorm||e===ht.BC1RGBAUnormSRGB)return{byteLength:8,width:4,height:4};if(e===ht.BC2RGBAUnorm||e===ht.BC2RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===ht.BC3RGBAUnorm||e===ht.BC3RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===ht.BC4RUnorm||e===ht.BC4RSNorm)return{byteLength:8,width:4,height:4};if(e===ht.BC5RGUnorm||e===ht.BC5RGSnorm)return{byteLength:16,width:4,height:4};if(e===ht.BC6HRGBUFloat||e===ht.BC6HRGBFloat)return{byteLength:16,width:4,height:4};if(e===ht.BC7RGBAUnorm||e===ht.BC7RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===ht.ETC2RGB8Unorm||e===ht.ETC2RGB8UnormSRGB)return{byteLength:8,width:4,height:4};if(e===ht.ETC2RGB8A1Unorm||e===ht.ETC2RGB8A1UnormSRGB)return{byteLength:8,width:4,height:4};if(e===ht.ETC2RGBA8Unorm||e===ht.ETC2RGBA8UnormSRGB)return{byteLength:16,width:4,height:4};if(e===ht.EACR11Unorm)return{byteLength:8,width:4,height:4};if(e===ht.EACR11Snorm)return{byteLength:8,width:4,height:4};if(e===ht.EACRG11Unorm)return{byteLength:16,width:4,height:4};if(e===ht.EACRG11Snorm)return{byteLength:16,width:4,height:4};if(e===ht.ASTC4x4Unorm||e===ht.ASTC4x4UnormSRGB)return{byteLength:16,width:4,height:4};if(e===ht.ASTC5x4Unorm||e===ht.ASTC5x4UnormSRGB)return{byteLength:16,width:5,height:4};if(e===ht.ASTC5x5Unorm||e===ht.ASTC5x5UnormSRGB)return{byteLength:16,width:5,height:5};if(e===ht.ASTC6x5Unorm||e===ht.ASTC6x5UnormSRGB)return{byteLength:16,width:6,height:5};if(e===ht.ASTC6x6Unorm||e===ht.ASTC6x6UnormSRGB)return{byteLength:16,width:6,height:6};if(e===ht.ASTC8x5Unorm||e===ht.ASTC8x5UnormSRGB)return{byteLength:16,width:8,height:5};if(e===ht.ASTC8x6Unorm||e===ht.ASTC8x6UnormSRGB)return{byteLength:16,width:8,height:6};if(e===ht.ASTC8x8Unorm||e===ht.ASTC8x8UnormSRGB)return{byteLength:16,width:8,height:8};if(e===ht.ASTC10x5Unorm||e===ht.ASTC10x5UnormSRGB)return{byteLength:16,width:10,height:5};if(e===ht.ASTC10x6Unorm||e===ht.ASTC10x6UnormSRGB)return{byteLength:16,width:10,height:6};if(e===ht.ASTC10x8Unorm||e===ht.ASTC10x8UnormSRGB)return{byteLength:16,width:10,height:8};if(e===ht.ASTC10x10Unorm||e===ht.ASTC10x10UnormSRGB)return{byteLength:16,width:10,height:10};if(e===ht.ASTC12x10Unorm||e===ht.ASTC12x10UnormSRGB)return{byteLength:16,width:12,height:10};if(e===ht.ASTC12x12Unorm||e===ht.ASTC12x12UnormSRGB)return{byteLength:16,width:12,height:12}}_convertAddressMode(e){let i=BR.ClampToEdge;return e===E1?i=BR.Repeat:e===w1&&(i=BR.MirrorRepeat),i}_convertFilterMode(e){let i=Kp.Linear;return(e===to||e===MM||e===rg)&&(i=Kp.Nearest),i}_getBytesPerTexel(e){if(e===ht.R8Unorm||e===ht.R8Snorm||e===ht.R8Uint||e===ht.R8Sint)return 1;if(e===ht.R16Uint||e===ht.R16Sint||e===ht.R16Float||e===ht.RG8Unorm||e===ht.RG8Snorm||e===ht.RG8Uint||e===ht.RG8Sint)return 2;if(e===ht.R32Uint||e===ht.R32Sint||e===ht.R32Float||e===ht.RG16Uint||e===ht.RG16Sint||e===ht.RG16Float||e===ht.RGBA8Unorm||e===ht.RGBA8UnormSRGB||e===ht.RGBA8Snorm||e===ht.RGBA8Uint||e===ht.RGBA8Sint||e===ht.BGRA8Unorm||e===ht.BGRA8UnormSRGB||e===ht.RGB9E5UFloat||e===ht.RGB10A2Unorm||e===ht.RG11B10UFloat||e===ht.Depth32Float||e===ht.Depth24Plus||e===ht.Depth24PlusStencil8||e===ht.Depth32FloatStencil8)return 4;if(e===ht.RG32Uint||e===ht.RG32Sint||e===ht.RG32Float||e===ht.RGBA16Uint||e===ht.RGBA16Sint||e===ht.RGBA16Float)return 8;if(e===ht.RGBA32Uint||e===ht.RGBA32Sint||e===ht.RGBA32Float)return 16}_getTypedArrayType(e){if(e===ht.R8Uint)return Uint8Array;if(e===ht.R8Sint)return Int8Array;if(e===ht.R8Unorm)return Uint8Array;if(e===ht.R8Snorm)return Int8Array;if(e===ht.RG8Uint)return Uint8Array;if(e===ht.RG8Sint)return Int8Array;if(e===ht.RG8Unorm)return Uint8Array;if(e===ht.RG8Snorm)return Int8Array;if(e===ht.RGBA8Uint)return Uint8Array;if(e===ht.RGBA8Sint)return Int8Array;if(e===ht.RGBA8Unorm)return Uint8Array;if(e===ht.RGBA8Snorm)return Int8Array;if(e===ht.R16Uint)return Uint16Array;if(e===ht.R16Sint)return Int16Array;if(e===ht.RG16Uint)return Uint16Array;if(e===ht.RG16Sint)return Int16Array;if(e===ht.RGBA16Uint)return Uint16Array;if(e===ht.RGBA16Sint)return Int16Array;if(e===ht.R16Float||e===ht.RG16Float||e===ht.RGBA16Float)return Uint16Array;if(e===ht.R32Uint)return Uint32Array;if(e===ht.R32Sint)return Int32Array;if(e===ht.R32Float)return Float32Array;if(e===ht.RG32Uint)return Uint32Array;if(e===ht.RG32Sint)return Int32Array;if(e===ht.RG32Float)return Float32Array;if(e===ht.RGBA32Uint)return Uint32Array;if(e===ht.RGBA32Sint)return Int32Array;if(e===ht.RGBA32Float)return Float32Array;if(e===ht.BGRA8Unorm||e===ht.BGRA8UnormSRGB)return Uint8Array;if(e===ht.RGB10A2Unorm||e===ht.RGB9E5UFloat||e===ht.RG11B10UFloat)return Uint32Array;if(e===ht.Depth32Float)return Float32Array;if(e===ht.Depth24Plus||e===ht.Depth24PlusStencil8)return Uint32Array;if(e===ht.Depth32FloatStencil8)return Float32Array}_getDimension(e){let i;return e.isData3DTexture?i=x7.ThreeD:i=x7.TwoD,i}}function iI(r,e=null){const i=r.format,n=r.type,s=r.colorSpace;let o;if(r.isCompressedTexture===!0||r.isCompressedArrayTexture===!0)switch(i){case C1:o=s===Dr?ht.BC1RGBAUnormSRGB:ht.BC1RGBAUnorm;break;case S1:o=s===Dr?ht.BC2RGBAUnormSRGB:ht.BC2RGBAUnorm;break;case T1:o=s===Dr?ht.BC3RGBAUnormSRGB:ht.BC3RGBAUnorm;break;case OM:o=s===Dr?ht.ETC2RGB8UnormSRGB:ht.ETC2RGB8Unorm;break;case kM:o=s===Dr?ht.ETC2RGBA8UnormSRGB:ht.ETC2RGBA8Unorm;break;case FM:o=s===Dr?ht.ASTC4x4UnormSRGB:ht.ASTC4x4Unorm;break;case UM:o=s===Dr?ht.ASTC5x4UnormSRGB:ht.ASTC5x4Unorm;break;case zM:o=s===Dr?ht.ASTC5x5UnormSRGB:ht.ASTC5x5Unorm;break;case jM:o=s===Dr?ht.ASTC6x5UnormSRGB:ht.ASTC6x5Unorm;break;case VM:o=s===Dr?ht.ASTC6x6UnormSRGB:ht.ASTC6x6Unorm;break;case GM:o=s===Dr?ht.ASTC8x5UnormSRGB:ht.ASTC8x5Unorm;break;case HM:o=s===Dr?ht.ASTC8x6UnormSRGB:ht.ASTC8x6Unorm;break;case WM:o=s===Dr?ht.ASTC8x8UnormSRGB:ht.ASTC8x8Unorm;break;case QM:o=s===Dr?ht.ASTC10x5UnormSRGB:ht.ASTC10x5Unorm;break;case qM:o=s===Dr?ht.ASTC10x6UnormSRGB:ht.ASTC10x6Unorm;break;case XM:o=s===Dr?ht.ASTC10x8UnormSRGB:ht.ASTC10x8Unorm;break;case YM:o=s===Dr?ht.ASTC10x10UnormSRGB:ht.ASTC10x10Unorm;break;case KM:o=s===Dr?ht.ASTC12x10UnormSRGB:ht.ASTC12x10Unorm;break;case JM:o=s===Dr?ht.ASTC12x12UnormSRGB:ht.ASTC12x12Unorm;break;default:console.error("WebGPURenderer: Unsupported texture format.",i)}else switch(i){case sg:switch(n){case JA:o=ht.RGBA8Snorm;break;case ZA:o=ht.RGBA16Sint;break;case ng:o=ht.RGBA16Uint;break;case Fa:o=ht.RGBA32Uint;break;case _o:o=ht.RGBA32Sint;break;case ld:o=s===Dr?ht.RGBA8UnormSRGB:ht.RGBA8Unorm;break;case Gu:o=ht.RGBA16Float;break;case pl:o=ht.RGBA32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAFormat.",n)}break;case IM:switch(n){case aU:o=ht.RGB9E5UFloat;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBFormat.",n)}break;case BM:switch(n){case JA:o=ht.R8Snorm;break;case ZA:o=ht.R16Sint;break;case ng:o=ht.R16Uint;break;case Fa:o=ht.R32Uint;break;case _o:o=ht.R32Sint;break;case ld:o=ht.R8Unorm;break;case Gu:o=ht.R16Float;break;case pl:o=ht.R32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RedFormat.",n)}break;case ey:switch(n){case JA:o=ht.RG8Snorm;break;case ZA:o=ht.RG16Sint;break;case ng:o=ht.RG16Uint;break;case Fa:o=ht.RG32Uint;break;case _o:o=ht.RG32Sint;break;case ld:o=ht.RG8Unorm;break;case Gu:o=ht.RG16Float;break;case pl:o=ht.RG32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RGFormat.",n)}break;case Dp:switch(n){case ng:o=ht.Depth16Unorm;break;case Fa:o=ht.Depth24Plus;break;case pl:o=ht.Depth32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthFormat.",n)}break;case ag:switch(n){case $A:o=ht.Depth24PlusStencil8;break;case pl:e&&e.features.has(DR.Depth32FloatStencil8)===!1&&console.error('WebGPURenderer: Depth textures with DepthStencilFormat + FloatType can only be used with the "depth32float-stencil8" GPU feature.'),o=ht.Depth32FloatStencil8;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthStencilFormat.",n)}break;case LM:switch(n){case _o:o=ht.R32Sint;break;case Fa:o=ht.R32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RedIntegerFormat.",n)}break;case DM:switch(n){case _o:o=ht.RG32Sint;break;case Fa:o=ht.RG32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RGIntegerFormat.",n)}break;case NM:switch(n){case _o:o=ht.RGBA32Sint;break;case Fa:o=ht.RGBA32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAIntegerFormat.",n)}break;default:console.error("WebGPURenderer: Unsupported texture format.",i)}return o}const pye=/^[fn]*\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)\s*[\-\>]*\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/i,fye=/([a-z_0-9]+)\s*:\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/ig,sz={f32:"float",i32:"int",u32:"uint",bool:"bool","vec2<f32>":"vec2","vec2<i32>":"ivec2","vec2<u32>":"uvec2","vec2<bool>":"bvec2",vec2f:"vec2",vec2i:"ivec2",vec2u:"uvec2",vec2b:"bvec2","vec3<f32>":"vec3","vec3<i32>":"ivec3","vec3<u32>":"uvec3","vec3<bool>":"bvec3",vec3f:"vec3",vec3i:"ivec3",vec3u:"uvec3",vec3b:"bvec3","vec4<f32>":"vec4","vec4<i32>":"ivec4","vec4<u32>":"uvec4","vec4<bool>":"bvec4",vec4f:"vec4",vec4i:"ivec4",vec4u:"uvec4",vec4b:"bvec4","mat2x2<f32>":"mat2",mat2x2f:"mat2","mat3x3<f32>":"mat3",mat3x3f:"mat3","mat4x4<f32>":"mat4",mat4x4f:"mat4",sampler:"sampler",texture_1d:"texture",texture_2d:"texture",texture_2d_array:"texture",texture_multisampled_2d:"cubeTexture",texture_depth_2d:"depthTexture",texture_3d:"texture3D",texture_cube:"cubeTexture",texture_cube_array:"cubeTexture",texture_storage_1d:"storageTexture",texture_storage_2d:"storageTexture",texture_storage_2d_array:"storageTexture",texture_storage_3d:"storageTexture"},mye=r=>{r=r.trim();const e=r.match(pye);if(e!==null&&e.length===4){const i=e[2],n=[];let s=null;for(;(s=fye.exec(i))!==null;)n.push({name:s[1],type:s[2]});const o=[];for(let h=0;h<n.length;h++){const{name:p,type:f}=n[h];let g=f;g.startsWith("ptr")?g="pointer":(g.startsWith("texture")&&(g=f.split("<")[0]),g=sz[g]),o.push(new QR(g,p))}const l=r.substring(e[0].length),u=e[3]||"void",c=e[1]!==void 0?e[1]:"";return{type:sz[u]||u,inputs:o,name:c,inputsCode:i,blockCode:l,outputType:u}}else throw new Error("FunctionNode: Function is not a WGSL code.")};class gye extends XR{constructor(e){const{type:i,inputs:n,name:s,inputsCode:o,blockCode:l,outputType:u}=mye(e);super(i,n,s),this.inputsCode=o,this.blockCode=l,this.outputType=u}getCode(e=this.name){const i=this.outputType!=="void"?"-> "+this.outputType:"";return`fn ${e} ( ${this.inputsCode.trim()} ) ${i}`+this.blockCode}}class Aye extends z7{parseFunction(e){return new gye(e)}}const Vg=self.GPUShaderStage,N_={vertex:Vg?Vg.VERTEX:1,fragment:Vg?Vg.FRAGMENT:2,compute:Vg?Vg.COMPUTE:4},az={instance:!0,swizzleAssign:!1,storageBuffer:!0},yye={"^^":"tsl_xor"},vye={float:"f32",int:"i32",uint:"u32",bool:"bool",color:"vec3<f32>",vec2:"vec2<f32>",ivec2:"vec2<i32>",uvec2:"vec2<u32>",bvec2:"vec2<bool>",vec3:"vec3<f32>",ivec3:"vec3<i32>",uvec3:"vec3<u32>",bvec3:"vec3<bool>",vec4:"vec4<f32>",ivec4:"vec4<i32>",uvec4:"vec4<u32>",bvec4:"vec4<bool>",mat2:"mat2x2<f32>",mat3:"mat3x3<f32>",mat4:"mat4x4<f32>"},ch={tsl_xor:new no("fn tsl_xor( a : bool, b : bool ) -> bool { return ( a || b ) && !( a && b ); }"),mod_float:new no("fn tsl_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }"),mod_vec2:new no("fn tsl_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }"),mod_vec3:new no("fn tsl_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }"),mod_vec4:new no("fn tsl_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }"),equals_bool:new no("fn tsl_equals_bool( a : bool, b : bool ) -> bool { return a == b; }"),equals_bvec2:new no("fn tsl_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }"),equals_bvec3:new no("fn tsl_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }"),equals_bvec4:new no("fn tsl_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }"),repeatWrapping:new no(`
fn tsl_repeatWrapping( uv : vec2<f32>, dimension : vec2<u32> ) -> vec2<u32> {

	let uvScaled = vec2<u32>( uv * vec2<f32>( dimension ) );

	return ( ( uvScaled % dimension ) + dimension ) % dimension;

}
`),biquadraticTexture:new no(`
fn tsl_biquadraticTexture( map : texture_2d<f32>, coord : vec2f, level : i32 ) -> vec4f {

	let iRes = vec2i( textureDimensions( map, level ) );
	let res = vec2f( iRes );

	let uvScaled = coord * res;
	let uvWrapping = ( ( uvScaled % res ) + res ) % res;

	// https://www.shadertoy.com/view/WtyXRy

	let uv = uvWrapping - 0.5;
	let iuv = floor( uv );
	let f = fract( uv );

	let rg1 = textureLoad( map, vec2i( iuv + vec2( 0.5, 0.5 ) ) % iRes, level );
	let rg2 = textureLoad( map, vec2i( iuv + vec2( 1.5, 0.5 ) ) % iRes, level );
	let rg3 = textureLoad( map, vec2i( iuv + vec2( 0.5, 1.5 ) ) % iRes, level );
	let rg4 = textureLoad( map, vec2i( iuv + vec2( 1.5, 1.5 ) ) % iRes, level );

	return mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );

}
`)},Uy={dFdx:"dpdx",dFdy:"- dpdy",mod_float:"tsl_mod_float",mod_vec2:"tsl_mod_vec2",mod_vec3:"tsl_mod_vec3",mod_vec4:"tsl_mod_vec4",equals_bool:"tsl_equals_bool",equals_bvec2:"tsl_equals_bvec2",equals_bvec3:"tsl_equals_bvec3",equals_bvec4:"tsl_equals_bvec4",inversesqrt:"inverseSqrt",bitcast:"bitcast<f32>"};/Windows/g.test(navigator.userAgent)&&(ch.pow_float=new no("fn tsl_pow_float( a : f32, b : f32 ) -> f32 { return select( -pow( -a, b ), pow( a, b ), a > 0.0 ); }"),ch.pow_vec2=new no("fn tsl_pow_vec2( a : vec2f, b : vec2f ) -> vec2f { return vec2f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ) ); }",[ch.pow_float]),ch.pow_vec3=new no("fn tsl_pow_vec3( a : vec3f, b : vec3f ) -> vec3f { return vec3f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ), tsl_pow_float( a.z, b.z ) ); }",[ch.pow_float]),ch.pow_vec4=new no("fn tsl_pow_vec4( a : vec4f, b : vec4f ) -> vec4f { return vec4f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ), tsl_pow_float( a.z, b.z ), tsl_pow_float( a.w, b.w ) ); }",[ch.pow_float]),Uy.pow_float="tsl_pow_float",Uy.pow_vec2="tsl_pow_vec2",Uy.pow_vec3="tsl_pow_vec3",Uy.pow_vec4="tsl_pow_vec4");let oz="";/Firefox|Deno/g.test(navigator.userAgent)!==!0&&(oz+=`diagnostic( off, derivative_uniformity );
`);class bye extends k7{constructor(e,i){super(e,i,new Aye),this.uniformGroups={},this.builtins={},this.directives={},this.scopedArrays=new Map}needsToWorkingColorSpace(e){return e.isVideoTexture===!0&&e.colorSpace!==Np}_generateTextureSample(e,i,n,s,o=this.shaderStage){return o==="fragment"?s?`textureSample( ${i}, ${i}_sampler, ${n}, ${s} )`:`textureSample( ${i}, ${i}_sampler, ${n} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,i,n):this.generateTextureLod(e,i,n,"0")}_generateVideoSample(e,i,n=this.shaderStage){if(n==="fragment")return`textureSampleBaseClampToEdge( ${e}, ${e}_sampler, vec2<f32>( ${i}.x, 1.0 - ${i}.y ) )`;console.error(`WebGPURenderer: THREE.VideoTexture does not support ${n} shader.`)}_generateTextureSampleLevel(e,i,n,s,o,l=this.shaderStage){return l==="fragment"&&this.isUnfilterable(e)===!1?`textureSampleLevel( ${i}, ${i}_sampler, ${n}, ${s} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,i,n,s):this.generateTextureLod(e,i,n,s)}generateFilteredTexture(e,i,n,s="0"){return this._include("biquadraticTexture"),`tsl_biquadraticTexture( ${i}, ${n}, i32( ${s} ) )`}generateTextureLod(e,i,n,s="0"){this._include("repeatWrapping");const o=e.isMultisampleRenderTargetTexture===!0?`textureDimensions( ${i} )`:`textureDimensions( ${i}, 0 )`;return`textureLoad( ${i}, tsl_repeatWrapping( ${n}, ${o} ), i32( ${s} ) )`}generateTextureLoad(e,i,n,s,o="0u"){return s?`textureLoad( ${i}, ${n}, ${s}, ${o} )`:`textureLoad( ${i}, ${n}, ${o} )`}generateTextureStore(e,i,n,s){return`textureStore( ${i}, ${n}, ${s} )`}isUnfilterable(e){return this.getComponentTypeFromTexture(e)!=="float"||!this.isAvailable("float32Filterable")&&e.isDataTexture===!0&&e.type===pl||e.isMultisampleRenderTargetTexture===!0}generateTexture(e,i,n,s,o=this.shaderStage){let l=null;return e.isVideoTexture===!0?l=this._generateVideoSample(i,n,o):this.isUnfilterable(e)?l=this.generateTextureLod(e,i,n,"0",s,o):l=this._generateTextureSample(e,i,n,s,o),l}generateTextureGrad(e,i,n,s,o,l=this.shaderStage){if(l==="fragment")return`textureSampleGrad( ${i}, ${i}_sampler, ${n},  ${s[0]}, ${s[1]} )`;console.error(`WebGPURenderer: THREE.TextureNode.gradient() does not support ${l} shader.`)}generateTextureCompare(e,i,n,s,o,l=this.shaderStage){if(l==="fragment")return`textureSampleCompare( ${i}, ${i}_sampler, ${n}, ${s} )`;console.error(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${l} shader.`)}generateTextureLevel(e,i,n,s,o,l=this.shaderStage){let u=null;return e.isVideoTexture===!0?u=this._generateVideoSample(i,n,l):u=this._generateTextureSampleLevel(e,i,n,s,o,l),u}generateTextureBias(e,i,n,s,o,l=this.shaderStage){if(l==="fragment")return`textureSampleBias( ${i}, ${i}_sampler, ${n}, ${s} )`;console.error(`WebGPURenderer: THREE.TextureNode.biasNode does not support ${l} shader.`)}getPropertyName(e,i=this.shaderStage){if(e.isNodeVarying===!0&&e.needsInterpolation===!0){if(i==="vertex")return`varyings.${e.name}`}else if(e.isNodeUniform===!0){const n=e.name,s=e.type;return s==="texture"||s==="cubeTexture"||s==="storageTexture"||s==="texture3D"?n:s==="buffer"||s==="storageBuffer"||s==="indirectStorageBuffer"?`NodeBuffer_${e.id}.${n}`:e.groupNode.name+"."+n}return super.getPropertyName(e)}getOutputStructName(){return"output"}_getUniformGroupCount(e){return Object.keys(this.uniforms[e]).length}getFunctionOperator(e){const i=yye[e];return i!==void 0?(this._include(i),i):null}getStorageAccess(e){if(e.isStorageTextureNode)switch(e.access){case b7.ReadOnly:return"read";case b7.WriteOnly:return"write";default:return"read_write"}else switch(e.access){case LR.Storage:return"read_write";case LR.ReadOnlyStorage:return"read";default:return"write"}}getUniformFromNode(e,i,n,s=null){const o=super.getUniformFromNode(e,i,n,s),l=this.getDataFromNode(e,n,this.globalCache);if(l.uniformGPU===void 0){let u;const c=e.groupNode,h=c.name,p=this.getBindGroupArray(h,n);if(i==="texture"||i==="cubeTexture"||i==="storageTexture"||i==="texture3D"){let f=null;if(i==="texture"||i==="storageTexture"?f=new L_(o.name,o.node,c,e.access?e.access:null):i==="cubeTexture"?f=new Y7(o.name,o.node,c,e.access?e.access:null):i==="texture3D"&&(f=new K7(o.name,o.node,c,e.access?e.access:null)),f.store=e.isStorageTextureNode===!0,f.setVisibility(N_[n]),n==="fragment"&&this.isUnfilterable(e.value)===!1&&f.store===!1){const g=new sye(`${o.name}_sampler`,o.node,c);g.setVisibility(N_[n]),p.push(g,f),u=[g,f]}else p.push(f),u=[f]}else if(i==="buffer"||i==="storageBuffer"||i==="indirectStorageBuffer"){const f=i==="buffer"?q7:lye,g=new f(e,c);g.setVisibility(N_[n]),p.push(g),u=g}else{const f=this.uniformGroups[n]||(this.uniformGroups[n]={});let g=f[h];g===void 0&&(g=new X7(h,c),g.setVisibility(N_[n]),f[h]=g,p.push(g)),u=this.getNodeUniform(o,i),g.addUniform(u)}l.uniformGPU=u}return o}getBuiltin(e,i,n,s=this.shaderStage){const o=this.builtins[s]||(this.builtins[s]=new Map);return o.has(e)===!1&&o.set(e,{name:e,property:i,type:n}),i}hasBuiltin(e,i=this.shaderStage){return this.builtins[i]!==void 0&&this.builtins[i].has(e)}getVertexIndex(){return this.shaderStage==="vertex"?this.getBuiltin("vertex_index","vertexIndex","u32","attribute"):"vertexIndex"}buildFunctionCode(e){const i=e.layout,n=this.flowShaderNode(e),s=[];for(const l of i.inputs)s.push(l.name+" : "+this.getType(l.type));let o=`fn ${i.name}( ${s.join(", ")} ) -> ${this.getType(i.type)} {
${n.vars}
${n.code}
`;return n.result&&(o+=`	return ${n.result};
`),o+=`
}
`,o}getInstanceIndex(){return this.shaderStage==="vertex"?this.getBuiltin("instance_index","instanceIndex","u32","attribute"):"instanceIndex"}getInvocationLocalIndex(){return this.getBuiltin("local_invocation_index","invocationLocalIndex","u32","attribute")}getSubgroupSize(){return this.enableSubGroups(),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute")}getInvocationSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_invocation_id","invocationSubgroupIndex","u32","attribute")}getSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_id","subgroupIndex","u32","attribute")}getDrawIndex(){return null}getFrontFacing(){return this.getBuiltin("front_facing","isFront","bool")}getFragCoord(){return this.getBuiltin("position","fragCoord","vec4<f32>")+".xy"}getFragDepth(){return"output."+this.getBuiltin("frag_depth","depth","f32","output")}isFlipY(){return!1}enableDirective(e,i=this.shaderStage){(this.directives[i]||(this.directives[i]=new Set)).add(e)}getDirectives(e){const i=[],n=this.directives[e];if(n!==void 0)for(const s of n)i.push(`enable ${s};`);return i.join(`
`)}enableSubGroups(){this.enableDirective("subgroups")}enableSubgroupsF16(){this.enableDirective("subgroups-f16")}enableClipDistances(){this.enableDirective("clip_distances")}enableShaderF16(){this.enableDirective("f16")}enableDualSourceBlending(){this.enableDirective("dual_source_blending")}getBuiltins(e){const i=[],n=this.builtins[e];if(n!==void 0)for(const{name:s,property:o,type:l}of n.values())i.push(`@builtin( ${s} ) ${o} : ${l}`);return i.join(`,
	`)}getScopedArray(e,i,n,s){return this.scopedArrays.has(e)===!1&&this.scopedArrays.set(e,{name:e,scope:i,bufferType:n,bufferCount:s}),e}getScopedArrays(e){if(e!=="compute")return;const i=[];for(const{name:n,scope:s,bufferType:o,bufferCount:l}of this.scopedArrays.values()){const u=this.getType(o);i.push(`var<${s}> ${n}: array< ${u}, ${l} >;`)}return i.join(`
`)}getAttributes(e){const i=[];if(e==="compute"&&(this.getBuiltin("global_invocation_id","id","vec3<u32>","attribute"),this.getBuiltin("workgroup_id","workgroupId","vec3<u32>","attribute"),this.getBuiltin("local_invocation_id","localId","vec3<u32>","attribute"),this.getBuiltin("num_workgroups","numWorkgroups","vec3<u32>","attribute"),this.renderer.hasFeature("subgroups")&&(this.enableDirective("subgroups",e),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute"))),e==="vertex"||e==="compute"){const n=this.getBuiltins("attribute");n&&i.push(n);const s=this.getAttributesArray();for(let o=0,l=s.length;o<l;o++){const u=s[o],c=u.name,h=this.getType(u.type);i.push(`@location( ${o} ) ${c} : ${h}`)}}return i.join(`,
	`)}getStructMembers(e){const i=[],n=e.getMemberTypes();for(let o=0;o<n.length;o++){const l=n[o];i.push(`	@location( ${o} ) m${o} : ${l}<f32>`)}const s=this.getBuiltins("output");return s&&i.push("	"+s),i.join(`,
`)}getStructs(e){const i=[],n=this.structs[e];for(let s=0,o=n.length;s<o;s++){const l=n[s],u=l.name;let c=`struct ${u} {
`;c+=this.getStructMembers(l),c+=`
}`,i.push(c),i.push(`
var<private> output : ${u};

`)}return i.join(`

`)}getVar(e,i){return`var ${i} : ${this.getType(e)}`}getVars(e){const i=[],n=this.vars[e];if(n!==void 0)for(const s of n)i.push(`	${this.getVar(s.type,s.name)};`);return`
${i.join(`
`)}
`}getVaryings(e){const i=[];if(e==="vertex"&&this.getBuiltin("position","Vertex","vec4<f32>","vertex"),e==="vertex"||e==="fragment"){const o=this.varyings,l=this.vars[e];for(let u=0;u<o.length;u++){const c=o[u];if(c.needsInterpolation){let h=`@location( ${u} )`;/^(int|uint|ivec|uvec)/.test(c.type)&&(h+=" @interpolate( flat )"),i.push(`${h} ${c.name} : ${this.getType(c.type)}`)}else e==="vertex"&&l.includes(c)===!1&&l.push(c)}}const n=this.getBuiltins(e);n&&i.push(n);const s=i.join(`,
	`);return e==="vertex"?this._getWGSLStruct("VaryingsStruct","	"+s):s}getUniforms(e){const i=this.uniforms[e],n=[],s=[],o=[],l={};for(const c of i){const h=c.groupNode.name,p=this.bindingsIndexes[h];if(c.type==="texture"||c.type==="cubeTexture"||c.type==="storageTexture"||c.type==="texture3D"){const f=c.node.value;e==="fragment"&&this.isUnfilterable(f)===!1&&c.node.isStorageTextureNode!==!0&&(f.isDepthTexture===!0&&f.compareFunction!==null?n.push(`@binding( ${p.binding++} ) @group( ${p.group} ) var ${c.name}_sampler : sampler_comparison;`):n.push(`@binding( ${p.binding++} ) @group( ${p.group} ) var ${c.name}_sampler : sampler;`));let g,m="";if(f.isMultisampleRenderTargetTexture===!0&&(m="_multisampled"),f.isCubeTexture===!0)g="texture_cube<f32>";else if(f.isDataArrayTexture===!0||f.isCompressedArrayTexture===!0)g="texture_2d_array<f32>";else if(f.isDepthTexture===!0)g=`texture_depth${m}_2d`;else if(f.isVideoTexture===!0)g="texture_external";else if(f.isData3DTexture===!0)g="texture_3d<f32>";else if(c.node.isStorageTextureNode===!0){const y=iI(f),b=this.getStorageAccess(c.node);g=`texture_storage_2d<${y}, ${b}>`}else{const y=this.getComponentTypeFromTexture(f).charAt(0);g=`texture${m}_2d<${y}32>`}n.push(`@binding( ${p.binding++} ) @group( ${p.group} ) var ${c.name} : ${g};`)}else if(c.type==="buffer"||c.type==="storageBuffer"||c.type==="indirectStorageBuffer"){const f=c.node,g=this.getType(f.bufferType),m=f.bufferCount,y=m>0&&c.type==="buffer"?", "+m:"",b=f.isAtomic?`atomic<${g}>`:`${g}`,v=`	${c.name} : array< ${b}${y} >
`,_=f.isStorageBufferNode?`storage, ${this.getStorageAccess(f)}`:"uniform";s.push(this._getWGSLStructBinding("NodeBuffer_"+f.id,v,_,p.binding++,p.group))}else{const f=this.getType(this.getVectorType(c.type)),g=c.groupNode.name;(l[g]||(l[g]={index:p.binding++,id:p.group,snippets:[]})).snippets.push(`	${c.name} : ${f}`)}}for(const c in l){const h=l[c];o.push(this._getWGSLStructBinding(c,h.snippets.join(`,
`),"uniform",h.index,h.id))}let u=n.join(`
`);return u+=s.join(`
`),u+=o.join(`
`),u}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const i in e){const n=e[i];n.uniforms=this.getUniforms(i),n.attributes=this.getAttributes(i),n.varyings=this.getVaryings(i),n.structs=this.getStructs(i),n.vars=this.getVars(i),n.codes=this.getCodes(i),n.directives=this.getDirectives(i),n.scopedArrays=this.getScopedArrays(i);let s=`// code

`;s+=this.flowCode[i];const o=this.flowNodes[i],l=o[o.length-1],u=l.outputNode,c=u!==void 0&&u.isOutputStructNode===!0;for(const h of o){const p=this.getFlowData(h),f=h.name;if(f&&(s.length>0&&(s+=`
`),s+=`	// flow -> ${f}
	`),s+=`${p.code}
	`,h===l&&i!=="compute"){if(s+=`// result

	`,i==="vertex")s+=`varyings.Vertex = ${p.result};`;else if(i==="fragment")if(c)n.returnType=u.nodeType,s+=`return ${p.result};`;else{let g="	@location(0) color: vec4<f32>";const m=this.getBuiltins("output");m&&(g+=`,
	`+m),n.returnType="OutputStruct",n.structs+=this._getWGSLStruct("OutputStruct",g),n.structs+=`
var<private> output : OutputStruct;

`,s+=`output.color = ${p.result};

	return output;`}}}n.flow=s}this.material!==null?(this.vertexShader=this._getWGSLVertexCode(e.vertex),this.fragmentShader=this._getWGSLFragmentCode(e.fragment)):this.computeShader=this._getWGSLComputeCode(e.compute,(this.object.workgroupSize||[64]).join(", "))}getMethod(e,i=null){let n;return i!==null&&(n=this._getWGSLMethod(e+"_"+i)),n===void 0&&(n=this._getWGSLMethod(e)),n||e}getType(e){return vye[e]||e}isAvailable(e){let i=az[e];return i===void 0&&(e==="float32Filterable"&&(i=this.renderer.hasFeature("float32-filterable")),az[e]=i),i}_getWGSLMethod(e){return ch[e]!==void 0&&this._include(e),Uy[e]}_include(e){const i=ch[e];return i.build(this),this.currentFunctionNode!==null&&this.currentFunctionNode.includes.push(i),i}_getWGSLVertexCode(e){return`${this.getSignature()}
// directives
${e.directives}

// uniforms
${e.uniforms}

// varyings
${e.varyings}
var<private> varyings : VaryingsStruct;

// codes
${e.codes}

@vertex
fn main( ${e.attributes} ) -> VaryingsStruct {

	// vars
	${e.vars}

	// flow
	${e.flow}

	return varyings;

}
`}_getWGSLFragmentCode(e){return`${this.getSignature()}
// global
${oz}

// uniforms
${e.uniforms}

// structs
${e.structs}

// codes
${e.codes}

@fragment
fn main( ${e.varyings} ) -> ${e.returnType} {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLComputeCode(e,i){return`${this.getSignature()}
// directives
${e.directives}

// system
var<private> instanceIndex : u32;

// locals
${e.scopedArrays}

// uniforms
${e.uniforms}

// codes
${e.codes}

@compute @workgroup_size( ${i} )
fn main( ${e.attributes} ) {

	// system
	instanceIndex = id.x + id.y * numWorkgroups.x * u32(${i}) + id.z * numWorkgroups.x * numWorkgroups.y * u32(${i});

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLStruct(e,i){return`
struct ${e} {
${i}
};`}_getWGSLStructBinding(e,i,n,s=0,o=0){const l=e+"Struct";return`${this._getWGSLStruct(l,i)}
@binding( ${s} ) @group( ${o} )
var<${n}> ${e} : ${l};`}}class xye{constructor(e){this.backend=e}getCurrentDepthStencilFormat(e){let i;return e.depthTexture!==null?i=this.getTextureFormatGPU(e.depthTexture):e.depth&&e.stencil?i=ht.Depth24PlusStencil8:e.depth&&(i=ht.Depth24Plus),i}getTextureFormatGPU(e){return this.backend.get(e).format}getCurrentColorFormat(e){let i;return e.textures!==null?i=this.getTextureFormatGPU(e.textures[0]):i=this.getPreferredCanvasFormat(),i}getCurrentColorSpace(e){return e.textures!==null?e.textures[0].colorSpace:this.backend.renderer.outputColorSpace}getPrimitiveTopology(e,i){if(e.isPoints)return Og.PointList;if(e.isLineSegments||e.isMesh&&i.wireframe===!0)return Og.LineList;if(e.isLine)return Og.LineStrip;if(e.isMesh)return Og.TriangleList}getSampleCount(e){let i=1;return e>1&&(i=Math.pow(2,Math.floor(Math.log2(e))),i===2&&(i=4)),i}getSampleCountRenderContext(e){return e.textures!==null?this.getSampleCount(e.sampleCount):this.getSampleCount(this.backend.renderer.samples)}getPreferredCanvasFormat(){return navigator.userAgent.includes("Quest")?ht.BGRA8Unorm:navigator.gpu.getPreferredCanvasFormat()}}const _ye=new Map([[Int8Array,["sint8","snorm8"]],[Uint8Array,["uint8","unorm8"]],[Int16Array,["sint16","snorm16"]],[Uint16Array,["uint16","unorm16"]],[Int32Array,["sint32","snorm32"]],[Uint32Array,["uint32","unorm32"]],[Float32Array,["float32"]]]),Eye=new Map([[GU,["float16"]]]),wye=new Map([[Int32Array,"sint32"],[Int16Array,"sint32"],[Uint32Array,"uint32"],[Uint16Array,"uint32"],[Float32Array,"float32"]]);class Cye{constructor(e){this.backend=e}createAttribute(e,i){const n=this._getBufferAttribute(e),s=this.backend,o=s.get(n);let l=o.buffer;if(l===void 0){const u=s.device;let c=n.array;if(e.normalized===!1&&(c.constructor===Int16Array||c.constructor===Uint16Array)){const p=new Uint32Array(c.length);for(let f=0;f<c.length;f++)p[f]=c[f];c=p}if(n.array=c,(n.isStorageBufferAttribute||n.isStorageInstancedBufferAttribute)&&n.itemSize===3){c=new c.constructor(n.count*4);for(let p=0;p<n.count;p++)c.set(n.array.subarray(p*3,p*3+3),p*4);n.itemSize=4,n.array=c}const h=c.byteLength+(4-c.byteLength%4)%4;l=u.createBuffer({label:n.name,size:h,usage:i,mappedAtCreation:!0}),new c.constructor(l.getMappedRange()).set(c),l.unmap(),o.buffer=l}}updateAttribute(e){const i=this._getBufferAttribute(e),n=this.backend,s=n.device,o=n.get(i).buffer,l=i.array,u=i.updateRanges;if(u.length===0)s.queue.writeBuffer(o,0,l,0);else{for(let c=0,h=u.length;c<h;c++){const p=u[c];s.queue.writeBuffer(o,0,l,p.start*l.BYTES_PER_ELEMENT,p.count*l.BYTES_PER_ELEMENT)}i.clearUpdateRanges()}}createShaderVertexBuffers(e){const i=e.getAttributes(),n=new Map;for(let s=0;s<i.length;s++){const o=i[s],l=o.array.BYTES_PER_ELEMENT,u=this._getBufferAttribute(o);let c=n.get(u);if(c===void 0){let f,g;o.isInterleavedBufferAttribute===!0?(f=o.data.stride*l,g=o.data.isInstancedInterleavedBuffer?E_.Instance:E_.Vertex):(f=o.itemSize*l,g=o.isInstancedBufferAttribute?E_.Instance:E_.Vertex),o.normalized===!1&&(o.array.constructor===Int16Array||o.array.constructor===Uint16Array)&&(f=4),c={arrayStride:f,attributes:[],stepMode:g},n.set(u,c)}const h=this._getVertexFormat(o),p=o.isInterleavedBufferAttribute===!0?o.offset*l:0;c.attributes.push({shaderLocation:s,offset:p,format:h})}return Array.from(n.values())}destroyAttribute(e){const i=this.backend;i.get(this._getBufferAttribute(e)).buffer.destroy(),i.delete(e)}async getArrayBufferAsync(e){const i=this.backend,n=i.device,s=i.get(this._getBufferAttribute(e)).buffer,o=s.size,l=n.createBuffer({label:e.name,size:o,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),u=n.createCommandEncoder({});u.copyBufferToBuffer(s,0,l,0,o),l.unmap();const c=u.finish();return n.queue.submit([c]),await l.mapAsync(GPUMapMode.READ),l.getMappedRange()}_getVertexFormat(e){const{itemSize:i,normalized:n}=e,s=e.array.constructor,o=e.constructor;let l;if(i==1)l=wye.get(s);else{const u=(Eye.get(o)||_ye.get(s))[n?1:0];if(u){const c=s.BYTES_PER_ELEMENT*i,h=Math.floor((c+3)/4)*4/s.BYTES_PER_ELEMENT;if(h%1)throw new Error("THREE.WebGPUAttributeUtils: Bad vertex format item size.");l=`${u}x${h}`}}return l||console.error("THREE.WebGPUAttributeUtils: Vertex format not supported yet."),l}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}class Sye{constructor(e){this.backend=e,this.bindGroupLayoutCache=new WeakMap}createBindingsLayout(e){const i=this.backend.device,n=[];let s=0;for(const o of e.bindings){const l={binding:s++,visibility:o.visibility};if(o.isUniformBuffer||o.isStorageBuffer){const u={};o.isStorageBuffer&&(u.type=o.access),l.buffer=u}else if(o.isSampler){const u={};o.texture.isDepthTexture&&o.texture.compareFunction!==null&&(u.type="comparison"),l.sampler=u}else if(o.isSampledTexture&&o.texture.isVideoTexture)l.externalTexture={};else if(o.isSampledTexture&&o.store){const u=this.backend.get(o.texture).texture.format,c=o.access;l.storageTexture={format:u,access:c}}else if(o.isSampledTexture){const u={};if(o.texture.isMultisampleRenderTargetTexture===!0&&(u.multisampled=!0),o.texture.isDepthTexture)u.sampleType=Oy.Depth;else if(o.texture.isDataTexture||o.texture.isDataArrayTexture||o.texture.isData3DTexture){const c=o.texture.type;c===_o?u.sampleType=Oy.SInt:c===Fa?u.sampleType=Oy.UInt:c===pl&&(this.backend.hasFeature("float32-filterable")?u.sampleType=Oy.Float:u.sampleType=Oy.UnfilterableFloat)}o.isSampledCubeTexture?u.viewDimension=Ul.Cube:o.texture.isDataArrayTexture||o.texture.isCompressedArrayTexture?u.viewDimension=Ul.TwoDArray:o.isSampledTexture3D&&(u.viewDimension=Ul.ThreeD),l.texture=u}else console.error(`WebGPUBindingUtils: Unsupported binding "${o}".`);n.push(l)}return i.createBindGroupLayout({entries:n})}createBindings(e){const{backend:i,bindGroupLayoutCache:n}=this,s=i.get(e);let o=n.get(e.bindingsReference);o===void 0&&(o=this.createBindingsLayout(e),n.set(e.bindingsReference,o));const l=this.createBindGroup(e,o);s.layout=o,s.group=l}updateBinding(e){const i=this.backend,n=i.device,s=e.buffer,o=i.get(e).buffer;n.queue.writeBuffer(o,0,s,0)}createBindGroup(e,i){const n=this.backend,s=n.device;let o=0;const l=[];for(const u of e.bindings){if(u.isUniformBuffer){const c=n.get(u);if(c.buffer===void 0){const h=u.byteLength,p=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,f=s.createBuffer({label:"bindingBuffer_"+u.name,size:h,usage:p});c.buffer=f}l.push({binding:o,resource:{buffer:c.buffer}})}else if(u.isStorageBuffer){const c=n.get(u);if(c.buffer===void 0){const h=u.attribute;c.buffer=n.get(h).buffer}l.push({binding:o,resource:{buffer:c.buffer}})}else if(u.isSampler){const c=n.get(u.texture);l.push({binding:o,resource:c.sampler})}else if(u.isSampledTexture){const c=n.get(u.texture);let h;if(c.externalTexture!==void 0)h=s.importExternalTexture({source:c.externalTexture});else{const p=u.store?1:c.texture.mipLevelCount,f=`view-${c.texture.width}-${c.texture.height}-${p}`;if(h=c[f],h===void 0){const g=p0e.All;let m;u.isSampledCubeTexture?m=Ul.Cube:u.isSampledTexture3D?m=Ul.ThreeD:u.texture.isDataArrayTexture||u.texture.isCompressedArrayTexture?m=Ul.TwoDArray:m=Ul.TwoD,h=c[f]=c.texture.createView({aspect:g,dimension:m,mipLevelCount:p})}}l.push({binding:o,resource:h})}o++}return s.createBindGroup({label:"bindGroup_"+e.name,layout:i,entries:l})}}class Tye{constructor(e){this.backend=e}_getSampleCount(e){return this.backend.utils.getSampleCountRenderContext(e)}createRenderPipeline(e,i){const{object:n,material:s,geometry:o,pipeline:l}=e,{vertexProgram:u,fragmentProgram:c}=l,h=this.backend,p=h.device,f=h.utils,g=h.get(l),m=[];for(const V of e.getBindings()){const j=h.get(V);m.push(j.layout)}const y=h.attributeUtils.createShaderVertexBuffers(e);let b;s.transparent===!0&&s.blending!==$m&&(b=this._getBlending(s));let v={};s.stencilWrite===!0&&(v={compare:this._getStencilCompare(s),failOp:this._getStencilOperation(s.stencilFail),depthFailOp:this._getStencilOperation(s.stencilZFail),passOp:this._getStencilOperation(s.stencilZPass)});const _=this._getColorWriteMask(s),T=[];if(e.context.textures!==null){const V=e.context.textures;for(let j=0;j<V.length;j++){const Q=f.getTextureFormatGPU(V[j]);T.push({format:Q,blend:b,writeMask:_})}}else{const V=f.getCurrentColorFormat(e.context);T.push({format:V,blend:b,writeMask:_})}const E=h.get(u).module,C=h.get(c).module,R=this._getPrimitiveState(n,o,s),B=this._getDepthCompare(s),I=f.getCurrentDepthStencilFormat(e.context),N=this._getSampleCount(e.context),D={label:`renderPipeline_${s.name||s.type}_${s.id}`,vertex:Object.assign({},E,{buffers:y}),fragment:Object.assign({},C,{targets:T}),primitive:R,multisample:{count:N,alphaToCoverageEnabled:s.alphaToCoverage&&N>1},layout:p.createPipelineLayout({bindGroupLayouts:m})},P={},k=e.context.depth,q=e.context.stencil;if((k===!0||q===!0)&&(k===!0&&(P.format=I,P.depthWriteEnabled=s.depthWrite,P.depthCompare=B),q===!0&&(P.stencilFront=v,P.stencilBack={},P.stencilReadMask=s.stencilFuncMask,P.stencilWriteMask=s.stencilWriteMask),D.depthStencil=P),i===null)g.pipeline=p.createRenderPipeline(D);else{const V=new Promise(j=>{p.createRenderPipelineAsync(D).then(Q=>{g.pipeline=Q,j()})});i.push(V)}}createBundleEncoder(e){const i=this.backend,{utils:n,device:s}=i,o=n.getCurrentDepthStencilFormat(e),l=n.getCurrentColorFormat(e),u=this._getSampleCount(e),c={label:"renderBundleEncoder",colorFormats:[l],depthStencilFormat:o,sampleCount:u};return s.createRenderBundleEncoder(c)}createComputePipeline(e,i){const n=this.backend,s=n.device,o=n.get(e.computeProgram).module,l=n.get(e),u=[];for(const c of i){const h=n.get(c);u.push(h.layout)}l.pipeline=s.createComputePipeline({compute:o,layout:s.createPipelineLayout({bindGroupLayouts:u})})}_getBlending(e){let i,n;const s=e.blending,o=e.blendSrc,l=e.blendDst,u=e.blendEquation;if(s===jF){const c=e.blendSrcAlpha!==null?e.blendSrcAlpha:o,h=e.blendDstAlpha!==null?e.blendDstAlpha:l,p=e.blendEquationAlpha!==null?e.blendEquationAlpha:u;i={srcFactor:this._getBlendFactor(o),dstFactor:this._getBlendFactor(l),operation:this._getBlendOperation(u)},n={srcFactor:this._getBlendFactor(c),dstFactor:this._getBlendFactor(h),operation:this._getBlendOperation(p)}}else{const c=e.premultipliedAlpha,h=(p,f,g,m)=>{i={srcFactor:p,dstFactor:f,operation:Jp.Add},n={srcFactor:g,dstFactor:m,operation:Jp.Add}};if(c)switch(s){case ad:h(Qr.One,Qr.OneMinusSrcAlpha,Qr.One,Qr.OneMinusSrcAlpha);break;case g1:h(Qr.One,Qr.One,Qr.One,Qr.One);break;case A1:h(Qr.Zero,Qr.OneMinusSrc,Qr.Zero,Qr.One);break;case y1:h(Qr.Zero,Qr.Src,Qr.Zero,Qr.SrcAlpha);break}else switch(s){case ad:h(Qr.SrcAlpha,Qr.OneMinusSrcAlpha,Qr.One,Qr.OneMinusSrcAlpha);break;case g1:h(Qr.SrcAlpha,Qr.One,Qr.SrcAlpha,Qr.One);break;case A1:h(Qr.Zero,Qr.OneMinusSrc,Qr.Zero,Qr.One);break;case y1:h(Qr.Zero,Qr.Src,Qr.Zero,Qr.Src);break}}if(i!==void 0&&n!==void 0)return{color:i,alpha:n};console.error("THREE.WebGPURenderer: Invalid blending: ",s)}_getBlendFactor(e){let i;switch(e){case HF:i=Qr.Zero;break;case WF:i=Qr.One;break;case QF:i=Qr.Src;break;case qF:i=Qr.OneMinusSrc;break;case v1:i=Qr.SrcAlpha;break;case b1:i=Qr.OneMinusSrcAlpha;break;case KF:i=Qr.Dst;break;case JF:i=Qr.OneMinusDstColor;break;case XF:i=Qr.DstAlpha;break;case YF:i=Qr.OneMinusDstAlpha;break;case ZF:i=Qr.SrcAlphaSaturated;break;case jge:i=Qr.Constant;break;case Vge:i=Qr.OneMinusConstant;break;default:console.error("THREE.WebGPURenderer: Blend factor not supported.",e)}return i}_getStencilCompare(e){let i;const n=e.stencilFunc;switch(n){case vue:i=Ga.Never;break;case $M:i=Ga.Always;break;case bue:i=Ga.Less;break;case _ue:i=Ga.LessEqual;break;case xue:i=Ga.Equal;break;case Cue:i=Ga.GreaterEqual;break;case Eue:i=Ga.Greater;break;case wue:i=Ga.NotEqual;break;default:console.error("THREE.WebGPURenderer: Invalid stencil function.",n)}return i}_getStencilOperation(e){let i;switch(e){case Pp:i=Sd.Keep;break;case due:i=Sd.Zero;break;case pue:i=Sd.Replace;break;case yue:i=Sd.Invert;break;case fue:i=Sd.IncrementClamp;break;case mue:i=Sd.DecrementClamp;break;case gue:i=Sd.IncrementWrap;break;case Aue:i=Sd.DecrementWrap;break;default:console.error("THREE.WebGPURenderer: Invalid stencil operation.",i)}return i}_getBlendOperation(e){let i;switch(e){case od:i=Jp.Add;break;case VF:i=Jp.Subtract;break;case GF:i=Jp.ReverseSubtract;break;case Xce:i=Jp.Min;break;case Yce:i=Jp.Max;break;default:console.error("THREE.WebGPUPipelineUtils: Blend equation not supported.",e)}return i}_getPrimitiveState(e,i,n){const s={},o=this.backend.utils;switch(s.topology=o.getPrimitiveTopology(e,n),i.index!==null&&e.isLine===!0&&e.isLineSegments!==!0&&(s.stripIndexFormat=i.index.array instanceof Uint16Array?kg.Uint16:kg.Uint32),n.side){case Jm:s.frontFace=RR.CCW,s.cullMode=IR.Back;break;case mc:s.frontFace=RR.CCW,s.cullMode=IR.Front;break;case Zm:s.frontFace=RR.CCW,s.cullMode=IR.None;break;default:console.error("THREE.WebGPUPipelineUtils: Unknown material.side value.",n.side);break}return s}_getColorWriteMask(e){return e.colorWrite===!0?v7.All:v7.None}_getDepthCompare(e){let i;if(e.depthTest===!1)i=Ga.Always;else{const n=e.depthFunc;switch(n){case $F:i=Ga.Never;break;case eU:i=Ga.Always;break;case tU:i=Ga.Less;break;case x1:i=Ga.LessEqual;break;case iU:i=Ga.Equal;break;case rU:i=Ga.GreaterEqual;break;case nU:i=Ga.Greater;break;case sU:i=Ga.NotEqual;break;default:console.error("THREE.WebGPUPipelineUtils: Invalid depth function.",n)}}return i}}class Mye extends $7{constructor(e={}){super(e),this.isWebGPUBackend=!0,this.parameters.alpha=e.alpha===void 0?!0:e.alpha,this.parameters.requiredLimits=e.requiredLimits===void 0?{}:e.requiredLimits,this.trackTimestamp=e.trackTimestamp===!0,this.device=null,this.context=null,this.colorBuffer=null,this.defaultRenderPassdescriptor=null,this.utils=new xye(this),this.attributeUtils=new Cye(this),this.bindingUtils=new Sye(this),this.pipelineUtils=new Tye(this),this.textureUtils=new dye(this),this.occludedResolveCache=new Map}async init(e){await super.init(e);const i=this.parameters;let n;if(i.device===void 0){const l={powerPreference:i.powerPreference},u=await navigator.gpu.requestAdapter(l);if(u===null)throw new Error("WebGPUBackend: Unable to create WebGPU adapter.");const c=Object.values(DR),h=[];for(const f of c)u.features.has(f)&&h.push(f);const p={requiredFeatures:h,requiredLimits:i.requiredLimits};n=await u.requestDevice(p)}else n=i.device;n.lost.then(l=>{const u={api:"WebGPU",message:l.message||"Unknown reason",reason:l.reason||null,originalEvent:l};e.onDeviceLost(u)});const s=i.context!==void 0?i.context:e.domElement.getContext("webgpu");this.device=n,this.context=s;const o=i.alpha?"premultiplied":"opaque";this.trackTimestamp=this.trackTimestamp&&this.hasFeature(DR.TimestampQuery),this.context.configure({device:this.device,format:this.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:o}),this.updateSize()}get coordinateSystem(){return Op}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}getContext(){return this.context}_getDefaultRenderPassDescriptor(){let e=this.defaultRenderPassdescriptor;if(e===null){const n=this.renderer;e={colorAttachments:[{view:null}]},(this.renderer.depth===!0||this.renderer.stencil===!0)&&(e.depthStencilAttachment={view:this.textureUtils.getDepthBuffer(n.depth,n.stencil).createView()});const s=e.colorAttachments[0];this.renderer.samples>0?s.view=this.colorBuffer.createView():s.resolveTarget=void 0,this.defaultRenderPassdescriptor=e}const i=e.colorAttachments[0];return this.renderer.samples>0?i.resolveTarget=this.context.getCurrentTexture().createView():i.view=this.context.getCurrentTexture().createView(),e}_getRenderPassDescriptor(e){const i=e.renderTarget,n=this.get(i);let s=n.descriptors;if(s===void 0||n.width!==i.width||n.height!==i.height||n.activeMipmapLevel!==i.activeMipmapLevel||n.samples!==i.samples){s={},n.descriptors=s;const u=()=>{i.removeEventListener("dispose",u),this.delete(i)};i.addEventListener("dispose",u)}const o=e.getCacheKey();let l=s[o];if(l===void 0){const u=e.textures,c=[];for(let h=0;h<u.length;h++){const p=this.get(u[h]),f=p.texture.createView({baseMipLevel:e.activeMipmapLevel,mipLevelCount:1,baseArrayLayer:e.activeCubeFace,dimension:Ul.TwoD});let g,m;p.msaaTexture!==void 0?(g=p.msaaTexture.createView(),m=f):(g=f,m=void 0),c.push({view:g,resolveTarget:m,loadOp:la.Load,storeOp:Ha.Store})}if(l={colorAttachments:c},e.depth){const h={view:this.get(e.depthTexture).texture.createView()};l.depthStencilAttachment=h}s[o]=l,n.width=i.width,n.height=i.height,n.samples=i.samples,n.activeMipmapLevel=i.activeMipmapLevel}return l}beginRender(e){const i=this.get(e),n=this.device,s=e.occlusionQueryCount;let o;s>0&&(i.currentOcclusionQuerySet&&i.currentOcclusionQuerySet.destroy(),i.currentOcclusionQueryBuffer&&i.currentOcclusionQueryBuffer.destroy(),i.currentOcclusionQuerySet=i.occlusionQuerySet,i.currentOcclusionQueryBuffer=i.occlusionQueryBuffer,i.currentOcclusionQueryObjects=i.occlusionQueryObjects,o=n.createQuerySet({type:"occlusion",count:s}),i.occlusionQuerySet=o,i.occlusionQueryIndex=0,i.occlusionQueryObjects=new Array(s),i.lastOcclusionObject=null);let l;e.textures===null?l=this._getDefaultRenderPassDescriptor():l=this._getRenderPassDescriptor(e),this.initTimestampQuery(e,l),l.occlusionQuerySet=o;const u=l.depthStencilAttachment;if(e.textures!==null){const p=l.colorAttachments;for(let f=0;f<p.length;f++){const g=p[f];e.clearColor?(g.clearValue=f===0?e.clearColorValue:{r:0,g:0,b:0,a:1},g.loadOp=la.Clear,g.storeOp=Ha.Store):(g.loadOp=la.Load,g.storeOp=Ha.Store)}}else{const p=l.colorAttachments[0];e.clearColor?(p.clearValue=e.clearColorValue,p.loadOp=la.Clear,p.storeOp=Ha.Store):(p.loadOp=la.Load,p.storeOp=Ha.Store)}e.depth&&(e.clearDepth?(u.depthClearValue=e.clearDepthValue,u.depthLoadOp=la.Clear,u.depthStoreOp=Ha.Store):(u.depthLoadOp=la.Load,u.depthStoreOp=Ha.Store)),e.stencil&&(e.clearStencil?(u.stencilClearValue=e.clearStencilValue,u.stencilLoadOp=la.Clear,u.stencilStoreOp=Ha.Store):(u.stencilLoadOp=la.Load,u.stencilStoreOp=Ha.Store));const c=n.createCommandEncoder({label:"renderContext_"+e.id}),h=c.beginRenderPass(l);if(i.descriptor=l,i.encoder=c,i.currentPass=h,i.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},i.renderBundles=[],e.viewport&&this.updateViewport(e),e.scissor){const{x:p,y:f,width:g,height:m}=e.scissorValue;h.setScissorRect(p,f,g,m)}}finishRender(e){const i=this.get(e),n=e.occlusionQueryCount;if(i.renderBundles.length>0&&i.currentPass.executeBundles(i.renderBundles),n>i.occlusionQueryIndex&&i.currentPass.endOcclusionQuery(),i.currentPass.end(),n>0){const s=n*8;let o=this.occludedResolveCache.get(s);o===void 0&&(o=this.device.createBuffer({size:s,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.occludedResolveCache.set(s,o));const l=this.device.createBuffer({size:s,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});i.encoder.resolveQuerySet(i.occlusionQuerySet,0,n,o,0),i.encoder.copyBufferToBuffer(o,0,l,0,s),i.occlusionQueryBuffer=l,this.resolveOccludedAsync(e)}if(this.prepareTimestampBuffer(e,i.encoder),this.device.queue.submit([i.encoder.finish()]),e.textures!==null){const s=e.textures;for(let o=0;o<s.length;o++){const l=s[o];l.generateMipmaps===!0&&this.textureUtils.generateMipmaps(l)}}}isOccluded(e,i){const n=this.get(e);return n.occluded&&n.occluded.has(i)}async resolveOccludedAsync(e){const i=this.get(e),{currentOcclusionQueryBuffer:n,currentOcclusionQueryObjects:s}=i;if(n&&s){const o=new WeakSet;i.currentOcclusionQueryObjects=null,i.currentOcclusionQueryBuffer=null,await n.mapAsync(GPUMapMode.READ);const l=n.getMappedRange(),u=new BigUint64Array(l);for(let c=0;c<s.length;c++)u[c]!==BigInt(0)&&o.add(s[c]);n.destroy(),i.occluded=o}}updateViewport(e){const{currentPass:i}=this.get(e),{x:n,y:s,width:o,height:l,minDepth:u,maxDepth:c}=e.viewportValue;i.setViewport(n,s,o,l,u,c)}clear(e,i,n,s=null){const o=this.device,l=this.renderer;let u=[],c,h,p,f;if(e){const m=this.getClearColor();if(this.renderer.alpha===!0){const y=m.a;h={r:m.r*y,g:m.g*y,b:m.b*y,a:y}}else h={r:m.r,g:m.g,b:m.b,a:m.a}}if(s===null){p=l.depth,f=l.stencil;const m=this._getDefaultRenderPassDescriptor();if(e){u=m.colorAttachments;const y=u[0];y.clearValue=h,y.loadOp=la.Clear,y.storeOp=Ha.Store}(p||f)&&(c=m.depthStencilAttachment)}else{if(p=s.depth,f=s.stencil,e)for(const m of s.textures){const y=this.get(m),b=y.texture.createView();let v,_;y.msaaTexture!==void 0?(v=y.msaaTexture.createView(),_=b):(v=b,_=void 0),u.push({view:v,resolveTarget:_,clearValue:h,loadOp:la.Clear,storeOp:Ha.Store})}(p||f)&&(c={view:this.get(s.depthTexture).texture.createView()})}p&&(i?(c.depthLoadOp=la.Clear,c.depthClearValue=l.getClearDepth(),c.depthStoreOp=Ha.Store):(c.depthLoadOp=la.Load,c.depthStoreOp=Ha.Store)),f&&(n?(c.stencilLoadOp=la.Clear,c.stencilClearValue=l.getClearStencil(),c.stencilStoreOp=Ha.Store):(c.stencilLoadOp=la.Load,c.stencilStoreOp=Ha.Store));const g=o.createCommandEncoder({});g.beginRenderPass({colorAttachments:u,depthStencilAttachment:c}).end(),o.queue.submit([g.finish()])}beginCompute(e){const i=this.get(e),n={};this.initTimestampQuery(e,n),i.cmdEncoderGPU=this.device.createCommandEncoder(),i.passEncoderGPU=i.cmdEncoderGPU.beginComputePass(n)}compute(e,i,n,s){const{passEncoderGPU:o}=this.get(e),l=this.get(s).pipeline;o.setPipeline(l);for(let p=0,f=n.length;p<f;p++){const g=n[p],m=this.get(g);o.setBindGroup(p,m.group)}const u=this.device.limits.maxComputeWorkgroupsPerDimension,c=this.get(i);c.dispatchSize===void 0&&(c.dispatchSize={x:0,y:1,z:1});const{dispatchSize:h}=c;i.dispatchCount>u?(h.x=Math.min(i.dispatchCount,u),h.y=Math.ceil(i.dispatchCount/u)):h.x=i.dispatchCount,o.dispatchWorkgroups(h.x,h.y,h.z)}finishCompute(e){const i=this.get(e);i.passEncoderGPU.end(),this.prepareTimestampBuffer(e,i.cmdEncoderGPU),this.device.queue.submit([i.cmdEncoderGPU.finish()])}async waitForGPU(){await this.device.queue.onSubmittedWorkDone()}draw(e,i){const{object:n,context:s,pipeline:o}=e,l=e.getBindings(),u=this.get(s),c=this.get(o).pipeline,h=u.currentSets,p=u.currentPass,f=e.getDrawParameters();if(f===null)return;h.pipeline!==c&&(p.setPipeline(c),h.pipeline=c);const g=h.bindingGroups;for(let v=0,_=l.length;v<_;v++){const T=l[v],E=this.get(T);g[T.index]!==T.id&&(p.setBindGroup(T.index,E.group),g[T.index]=T.id)}const m=e.getIndex(),y=m!==null;if(y===!0&&h.index!==m){const v=this.get(m).buffer,_=m.array instanceof Uint16Array?kg.Uint16:kg.Uint32;p.setIndexBuffer(v,_),h.index=m}const b=e.getVertexBuffers();for(let v=0,_=b.length;v<_;v++){const T=b[v];if(h.attributes[v]!==T){const E=this.get(T).buffer;p.setVertexBuffer(v,E),h.attributes[v]=T}}if(u.occlusionQuerySet!==void 0){const v=u.lastOcclusionObject;v!==n&&(v!==null&&v.occlusionTest===!0&&(p.endOcclusionQuery(),u.occlusionQueryIndex++),n.occlusionTest===!0&&(p.beginOcclusionQuery(u.occlusionQueryIndex),u.occlusionQueryObjects[u.occlusionQueryIndex]=n),u.lastOcclusionObject=n)}if(n.isBatchedMesh===!0){const v=n._multiDrawStarts,_=n._multiDrawCounts,T=n._multiDrawCount,E=n._multiDrawInstances,C=y?m.array.BYTES_PER_ELEMENT:1;for(let R=0;R<T;R++){const B=E?E[R]:1,I=B>1?0:R;p.drawIndexed(_[R],B,v[R]/C,0,I)}}else if(y===!0){const{vertexCount:v,instanceCount:_,firstVertex:T}=f,E=e.getIndirect();if(E!==null){const C=this.get(E).buffer;p.drawIndexedIndirect(C,0)}else p.drawIndexed(v,_,T,0,0);i.update(n,v,_)}else{const{vertexCount:v,instanceCount:_,firstVertex:T}=f,E=e.getIndirect();if(E!==null){const C=this.get(E).buffer;p.drawIndirect(C,0)}else p.draw(v,_,T,0);i.update(n,v,_)}}needsRenderUpdate(e){const i=this.get(e),{object:n,material:s}=e,o=this.utils,l=o.getSampleCountRenderContext(e.context),u=o.getCurrentColorSpace(e.context),c=o.getCurrentColorFormat(e.context),h=o.getCurrentDepthStencilFormat(e.context),p=o.getPrimitiveTopology(n,s);let f=!1;return(i.material!==s||i.materialVersion!==s.version||i.transparent!==s.transparent||i.blending!==s.blending||i.premultipliedAlpha!==s.premultipliedAlpha||i.blendSrc!==s.blendSrc||i.blendDst!==s.blendDst||i.blendEquation!==s.blendEquation||i.blendSrcAlpha!==s.blendSrcAlpha||i.blendDstAlpha!==s.blendDstAlpha||i.blendEquationAlpha!==s.blendEquationAlpha||i.colorWrite!==s.colorWrite||i.depthWrite!==s.depthWrite||i.depthTest!==s.depthTest||i.depthFunc!==s.depthFunc||i.stencilWrite!==s.stencilWrite||i.stencilFunc!==s.stencilFunc||i.stencilFail!==s.stencilFail||i.stencilZFail!==s.stencilZFail||i.stencilZPass!==s.stencilZPass||i.stencilFuncMask!==s.stencilFuncMask||i.stencilWriteMask!==s.stencilWriteMask||i.side!==s.side||i.alphaToCoverage!==s.alphaToCoverage||i.sampleCount!==l||i.colorSpace!==u||i.colorFormat!==c||i.depthStencilFormat!==h||i.primitiveTopology!==p||i.clippingContextCacheKey!==e.clippingContext.cacheKey)&&(i.material=s,i.materialVersion=s.version,i.transparent=s.transparent,i.blending=s.blending,i.premultipliedAlpha=s.premultipliedAlpha,i.blendSrc=s.blendSrc,i.blendDst=s.blendDst,i.blendEquation=s.blendEquation,i.blendSrcAlpha=s.blendSrcAlpha,i.blendDstAlpha=s.blendDstAlpha,i.blendEquationAlpha=s.blendEquationAlpha,i.colorWrite=s.colorWrite,i.depthWrite=s.depthWrite,i.depthTest=s.depthTest,i.depthFunc=s.depthFunc,i.stencilWrite=s.stencilWrite,i.stencilFunc=s.stencilFunc,i.stencilFail=s.stencilFail,i.stencilZFail=s.stencilZFail,i.stencilZPass=s.stencilZPass,i.stencilFuncMask=s.stencilFuncMask,i.stencilWriteMask=s.stencilWriteMask,i.side=s.side,i.alphaToCoverage=s.alphaToCoverage,i.sampleCount=l,i.colorSpace=u,i.colorFormat=c,i.depthStencilFormat=h,i.primitiveTopology=p,i.clippingContextCacheKey=e.clippingContext.cacheKey,f=!0),f}getRenderCacheKey(e){const{object:i,material:n}=e,s=this.utils,o=e.context;return[n.transparent,n.blending,n.premultipliedAlpha,n.blendSrc,n.blendDst,n.blendEquation,n.blendSrcAlpha,n.blendDstAlpha,n.blendEquationAlpha,n.colorWrite,n.depthWrite,n.depthTest,n.depthFunc,n.stencilWrite,n.stencilFunc,n.stencilFail,n.stencilZFail,n.stencilZPass,n.stencilFuncMask,n.stencilWriteMask,n.side,s.getSampleCountRenderContext(o),s.getCurrentColorSpace(o),s.getCurrentColorFormat(o),s.getCurrentDepthStencilFormat(o),s.getPrimitiveTopology(i,n),e.getGeometryCacheKey(),e.clippingContext.cacheKey].join()}createSampler(e){this.textureUtils.createSampler(e)}destroySampler(e){this.textureUtils.destroySampler(e)}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,i){this.textureUtils.createTexture(e,i)}updateTexture(e,i){this.textureUtils.updateTexture(e,i)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e){this.textureUtils.destroyTexture(e)}copyTextureToBuffer(e,i,n,s,o,l){return this.textureUtils.copyTextureToBuffer(e,i,n,s,o,l)}initTimestampQuery(e,i){if(!this.trackTimestamp)return;const n=this.get(e);if(!n.timeStampQuerySet){const s=this.device.createQuerySet({type:"timestamp",count:2});Object.assign(i,{timestampWrites:{querySet:s,beginningOfPassWriteIndex:0,endOfPassWriteIndex:1}}),n.timeStampQuerySet=s}}prepareTimestampBuffer(e,i){if(!this.trackTimestamp)return;const n=this.get(e),s=2*BigInt64Array.BYTES_PER_ELEMENT;n.currentTimestampQueryBuffers===void 0&&(n.currentTimestampQueryBuffers={resolveBuffer:this.device.createBuffer({label:"timestamp resolve buffer",size:s,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),resultBuffer:this.device.createBuffer({label:"timestamp result buffer",size:s,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),isMappingPending:!1});const{resolveBuffer:o,resultBuffer:l,isMappingPending:u}=n.currentTimestampQueryBuffers;u!==!0&&(i.resolveQuerySet(n.timeStampQuerySet,0,2,o,0),i.copyBufferToBuffer(o,0,l,0,s))}async resolveTimestampAsync(e,i="render"){if(!this.trackTimestamp)return;const n=this.get(e);if(n.currentTimestampQueryBuffers===void 0)return;const{resultBuffer:s,isMappingPending:o}=n.currentTimestampQueryBuffers;o!==!0&&(n.currentTimestampQueryBuffers.isMappingPending=!0,s.mapAsync(GPUMapMode.READ).then(()=>{const l=new BigUint64Array(s.getMappedRange()),u=Number(l[1]-l[0])/1e6;this.renderer.info.updateTimestamp(i,u),s.unmap(),n.currentTimestampQueryBuffers.isMappingPending=!1}))}createNodeBuilder(e,i){return new bye(e,i)}createProgram(e){const i=this.get(e);i.module={module:this.device.createShaderModule({code:e.code,label:e.stage}),entryPoint:"main"}}destroyProgram(e){this.delete(e)}createRenderPipeline(e,i){this.pipelineUtils.createRenderPipeline(e,i)}createComputePipeline(e,i){this.pipelineUtils.createComputePipeline(e,i)}beginBundle(e){const i=this.get(e);i._currentPass=i.currentPass,i._currentSets=i.currentSets,i.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},i.currentPass=this.pipelineUtils.createBundleEncoder(e)}finishBundle(e,i){const n=this.get(e),s=n.currentPass.finish();this.get(i).bundleGPU=s,n.currentSets=n._currentSets,n.currentPass=n._currentPass}addBundle(e,i){this.get(e).renderBundles.push(this.get(i).bundleGPU)}createBindings(e){this.bindingUtils.createBindings(e)}updateBindings(e){this.bindingUtils.createBindings(e)}updateBinding(e){this.bindingUtils.updateBinding(e)}createIndexAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.INDEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createIndirectStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.INDIRECT|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}updateSize(){this.colorBuffer=this.textureUtils.getColorBuffer(),this.defaultRenderPassdescriptor=null}getMaxAnisotropy(){return 16}hasFeature(e){return this.device.features.has(e)}copyTextureToTexture(e,i,n=null,s=null,o=0){let l=0,u=0,c=0,h=0,p=0,f=0,g=e.image.width,m=e.image.height;n!==null&&(h=n.x,p=n.y,f=n.z||0,g=n.width,m=n.height),s!==null&&(l=s.x,u=s.y,c=s.z||0);const y=this.device.createCommandEncoder({label:"copyTextureToTexture_"+e.id+"_"+i.id}),b=this.get(e).texture,v=this.get(i).texture;y.copyTextureToTexture({texture:b,mipLevel:o,origin:{x:h,y:p,z:f}},{texture:v,mipLevel:o,origin:{x:l,y:u,z:c}},[g,m,1]),this.device.queue.submit([y.finish()])}copyFramebufferToTexture(e,i,n){const s=this.get(i);let o=null;i.renderTarget?e.isDepthTexture?o=this.get(i.depthTexture).texture:o=this.get(i.textures[0]).texture:e.isDepthTexture?o=this.textureUtils.getDepthBuffer(i.depth,i.stencil):o=this.context.getCurrentTexture();const l=this.get(e).texture;if(o.format!==l.format){console.error("WebGPUBackend: copyFramebufferToTexture: Source and destination formats do not match.",o.format,l.format);return}let u;if(s.currentPass?(s.currentPass.end(),u=s.encoder):u=this.device.createCommandEncoder({label:"copyFramebufferToTexture_"+e.id}),u.copyTextureToTexture({texture:o,origin:{x:n.x,y:n.y,z:0}},{texture:l},[n.z,n.w]),e.generateMipmaps&&this.textureUtils.generateMipmaps(e),s.currentPass){const{descriptor:c}=s;for(let h=0;h<c.colorAttachments.length;h++)c.colorAttachments[h].loadOp=la.Load;i.depth&&(c.depthStencilAttachment.depthLoadOp=la.Load),i.stencil&&(c.depthStencilAttachment.stencilLoadOp=la.Load),s.currentPass=u.beginRenderPass(c),s.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null}}else this.device.queue.submit([u.finish()])}}class Rye extends p6{constructor(e,i,n,s,o,l){super(e,i,n,s,o,l),this.iesMap=null}copy(e,i){return super.copy(e,i),this.iesMap=e.iesMap,this}}class Iye extends G7{constructor(){super(),this.addMaterial(Lme,s6),this.addMaterial(u7,M3),this.addMaterial(yge,n6),this.addMaterial(_ge,a6),this.addMaterial(Cme,k1),this.addMaterial(Ime,l6),this.addMaterial(vme,o6),this.addMaterial(Sge,c6),this.addMaterial(fme,S3),this.addMaterial(gme,u6),this.addMaterial(Mge,i6),this.addMaterial(Lge,e6),this.addMaterial(Pge,r6),this.addLight(W0e,Ehe),this.addLight(xAe,Che),this.addLight(_Ae,The),this.addLight(U7,p6),this.addLight(wAe,She),this.addLight(CAe,bhe),this.addLight(SAe,Rhe),this.addLight(EAe,Rye),this.addToneMapping(g0e,Zce),this.addToneMapping(A0e,$ce),this.addToneMapping(y0e,eue),this.addToneMapping(b0e,tue),this.addToneMapping(w0e,iue),this.addToneMapping(C0e,rue)}}class Bye extends kAe{constructor(e={}){let i;e.forceWebGL?i=nz:(i=Mye,e.getFallback=()=>(console.warn("THREE.WebGPURenderer: WebGPU is not available, running under WebGL2 backend."),new nz(e)));const n=new i(e);super(n,e),this.library=new Iye,this.isWebGPURenderer=!0}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:f1}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=f1);const rI={type:"change"},nI={type:"start"},sI={type:"end"},lz=1e-6,qn={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4},P_=new ji,Md=new ji,Lye=new at,O_=new at,aI=new at,Gg=new zc,cz=new at,k_=new at,oI=new at,F_=new at;class Dye extends Dx{constructor(e,i=null){super(e,i),this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.keys=["KeyA","KeyS","KeyD"],this.mouseButtons={LEFT:ka.ROTATE,MIDDLE:ka.DOLLY,RIGHT:ka.PAN},this.state=qn.NONE,this.keyState=qn.NONE,this.target=new at,this._lastPosition=new at,this._lastZoom=1,this._touchZoomDistanceStart=0,this._touchZoomDistanceEnd=0,this._lastAngle=0,this._eye=new at,this._movePrev=new ji,this._moveCurr=new ji,this._lastAxis=new at,this._zoomStart=new ji,this._zoomEnd=new ji,this._panStart=new ji,this._panEnd=new ji,this._pointers=[],this._pointerPositions={},this._onPointerMove=Pye.bind(this),this._onPointerDown=Nye.bind(this),this._onPointerUp=Oye.bind(this),this._onPointerCancel=kye.bind(this),this._onContextMenu=Hye.bind(this),this._onMouseWheel=Gye.bind(this),this._onKeyDown=Uye.bind(this),this._onKeyUp=Fye.bind(this),this._onTouchStart=Wye.bind(this),this._onTouchMove=Qye.bind(this),this._onTouchEnd=qye.bind(this),this._onMouseDown=zye.bind(this),this._onMouseMove=jye.bind(this),this._onMouseUp=Vye.bind(this),this._target0=this.target.clone(),this._position0=this.object.position.clone(),this._up0=this.object.up.clone(),this._zoom0=this.object.zoom,i!==null&&(this.connect(),this.handleResize()),this.update()}connect(){window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}handleResize(){const e=this.domElement.getBoundingClientRect(),i=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-i.clientLeft,this.screen.top=e.top+window.pageYOffset-i.clientTop,this.screen.width=e.width,this.screen.height=e.height}update(){this._eye.subVectors(this.object.position,this.target),this.noRotate||this._rotateCamera(),this.noZoom||this._zoomCamera(),this.noPan||this._panCamera(),this.object.position.addVectors(this.target,this._eye),this.object.isPerspectiveCamera?(this._checkDistances(),this.object.lookAt(this.target),this._lastPosition.distanceToSquared(this.object.position)>lz&&(this.dispatchEvent(rI),this._lastPosition.copy(this.object.position))):this.object.isOrthographicCamera?(this.object.lookAt(this.target),(this._lastPosition.distanceToSquared(this.object.position)>lz||this._lastZoom!==this.object.zoom)&&(this.dispatchEvent(rI),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type.")}reset(){this.state=qn.NONE,this.keyState=qn.NONE,this.target.copy(this._target0),this.object.position.copy(this._position0),this.object.up.copy(this._up0),this.object.zoom=this._zoom0,this.object.updateProjectionMatrix(),this._eye.subVectors(this.object.position,this.target),this.object.lookAt(this.target),this.dispatchEvent(rI),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom}_panCamera(){if(Md.copy(this._panEnd).sub(this._panStart),Md.lengthSq()){if(this.object.isOrthographicCamera){const e=(this.object.right-this.object.left)/this.object.zoom/this.domElement.clientWidth,i=(this.object.top-this.object.bottom)/this.object.zoom/this.domElement.clientWidth;Md.x*=e,Md.y*=i}Md.multiplyScalar(this._eye.length()*this.panSpeed),O_.copy(this._eye).cross(this.object.up).setLength(Md.x),O_.add(Lye.copy(this.object.up).setLength(Md.y)),this.object.position.add(O_),this.target.add(O_),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(Md.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}_rotateCamera(){F_.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0);let e=F_.length();e?(this._eye.copy(this.object.position).sub(this.target),cz.copy(this._eye).normalize(),k_.copy(this.object.up).normalize(),oI.crossVectors(k_,cz).normalize(),k_.setLength(this._moveCurr.y-this._movePrev.y),oI.setLength(this._moveCurr.x-this._movePrev.x),F_.copy(k_.add(oI)),aI.crossVectors(F_,this._eye).normalize(),e*=this.rotateSpeed,Gg.setFromAxisAngle(aI,e),this._eye.applyQuaternion(Gg),this.object.up.applyQuaternion(Gg),this._lastAxis.copy(aI),this._lastAngle=e):!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.target),Gg.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(Gg),this.object.up.applyQuaternion(Gg)),this._movePrev.copy(this._moveCurr)}_zoomCamera(){let e;this.state===qn.TOUCH_ZOOM_PAN?(e=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=lS.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(e=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed,e!==1&&e>0&&(this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=lS.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor)}_getMouseOnScreen(e,i){return P_.set((e-this.screen.left)/this.screen.width,(i-this.screen.top)/this.screen.height),P_}_getMouseOnCircle(e,i){return P_.set((e-this.screen.width*.5-this.screen.left)/(this.screen.width*.5),(this.screen.height+2*(this.screen.top-i))/this.screen.width),P_}_addPointer(e){this._pointers.push(e)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let i=0;i<this._pointers.length;i++)if(this._pointers[i].pointerId==e.pointerId){this._pointers.splice(i,1);return}}_trackPointer(e){let i=this._pointerPositions[e.pointerId];i===void 0&&(i=new ji,this._pointerPositions[e.pointerId]=i),i.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const i=e.pointerId===this._pointers[0].pointerId?this._pointers[1]:this._pointers[0];return this._pointerPositions[i.pointerId]}_checkDistances(){(!this.noZoom||!this.noPan)&&(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))}}function Nye(r){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(r.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),this._addPointer(r),r.pointerType==="touch"?this._onTouchStart(r):this._onMouseDown(r))}function Pye(r){this.enabled!==!1&&(r.pointerType==="touch"?this._onTouchMove(r):this._onMouseMove(r))}function Oye(r){this.enabled!==!1&&(r.pointerType==="touch"?this._onTouchEnd(r):this._onMouseUp(),this._removePointer(r),this._pointers.length===0&&(this.domElement.releasePointerCapture(r.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp)))}function kye(r){this._removePointer(r)}function Fye(){this.enabled!==!1&&(this.keyState=qn.NONE,window.addEventListener("keydown",this._onKeyDown))}function Uye(r){this.enabled!==!1&&(window.removeEventListener("keydown",this._onKeyDown),this.keyState===qn.NONE&&(r.code===this.keys[qn.ROTATE]&&!this.noRotate?this.keyState=qn.ROTATE:r.code===this.keys[qn.ZOOM]&&!this.noZoom?this.keyState=qn.ZOOM:r.code===this.keys[qn.PAN]&&!this.noPan&&(this.keyState=qn.PAN)))}function zye(r){let e;switch(r.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case ka.DOLLY:this.state=qn.ZOOM;break;case ka.ROTATE:this.state=qn.ROTATE;break;case ka.PAN:this.state=qn.PAN;break;default:this.state=qn.NONE}const i=this.keyState!==qn.NONE?this.keyState:this.state;i===qn.ROTATE&&!this.noRotate?(this._moveCurr.copy(this._getMouseOnCircle(r.pageX,r.pageY)),this._movePrev.copy(this._moveCurr)):i===qn.ZOOM&&!this.noZoom?(this._zoomStart.copy(this._getMouseOnScreen(r.pageX,r.pageY)),this._zoomEnd.copy(this._zoomStart)):i===qn.PAN&&!this.noPan&&(this._panStart.copy(this._getMouseOnScreen(r.pageX,r.pageY)),this._panEnd.copy(this._panStart)),this.dispatchEvent(nI)}function jye(r){const e=this.keyState!==qn.NONE?this.keyState:this.state;e===qn.ROTATE&&!this.noRotate?(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(r.pageX,r.pageY))):e===qn.ZOOM&&!this.noZoom?this._zoomEnd.copy(this._getMouseOnScreen(r.pageX,r.pageY)):e===qn.PAN&&!this.noPan&&this._panEnd.copy(this._getMouseOnScreen(r.pageX,r.pageY))}function Vye(){this.state=qn.NONE,this.dispatchEvent(sI)}function Gye(r){if(this.enabled!==!1&&this.noZoom!==!0){switch(r.preventDefault(),r.deltaMode){case 2:this._zoomStart.y-=r.deltaY*.025;break;case 1:this._zoomStart.y-=r.deltaY*.01;break;default:this._zoomStart.y-=r.deltaY*25e-5;break}this.dispatchEvent(nI),this.dispatchEvent(sI)}}function Hye(r){this.enabled!==!1&&r.preventDefault()}function Wye(r){switch(this._trackPointer(r),this._pointers.length){case 1:this.state=qn.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(this._pointers[0].pageX,this._pointers[0].pageY)),this._movePrev.copy(this._moveCurr);break;default:this.state=qn.TOUCH_ZOOM_PAN;const e=this._pointers[0].pageX-this._pointers[1].pageX,i=this._pointers[0].pageY-this._pointers[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(e*e+i*i);const n=(this._pointers[0].pageX+this._pointers[1].pageX)/2,s=(this._pointers[0].pageY+this._pointers[1].pageY)/2;this._panStart.copy(this._getMouseOnScreen(n,s)),this._panEnd.copy(this._panStart);break}this.dispatchEvent(nI)}function Qye(r){switch(this._trackPointer(r),this._pointers.length){case 1:this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(r.pageX,r.pageY));break;default:const e=this._getSecondPointerPosition(r),i=r.pageX-e.x,n=r.pageY-e.y;this._touchZoomDistanceEnd=Math.sqrt(i*i+n*n);const s=(r.pageX+e.x)/2,o=(r.pageY+e.y)/2;this._panEnd.copy(this._getMouseOnScreen(s,o));break}}function qye(r){switch(this._pointers.length){case 0:this.state=qn.NONE;break;case 1:this.state=qn.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(r.pageX,r.pageY)),this._movePrev.copy(this._moveCurr);break;case 2:this.state=qn.TOUCH_ZOOM_PAN;for(let e=0;e<this._pointers.length;e++)if(this._pointers[e].pointerId!==r.pointerId){const i=this._pointerPositions[this._pointers[e].pointerId];this._moveCurr.copy(this._getMouseOnCircle(i.x,i.y)),this._movePrev.copy(this._moveCurr);break}break}this.dispatchEvent(sI)}const uz={type:"change"},lI={type:"start"},hz={type:"end"},U_=new sx,dz=new lc,Xye=Math.cos(70*lS.DEG2RAD),ga=new at,Xo=2*Math.PI,os={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},cI=1e-6;class Yye extends Dx{constructor(e,i=null){super(e,i),this.state=os.NONE,this.enabled=!0,this.target=new at,this.cursor=new at,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:ka.ROTATE,MIDDLE:ka.DOLLY,RIGHT:ka.PAN},this.touches={ONE:bu.ROTATE,TWO:bu.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new at,this._lastQuaternion=new zc,this._lastTargetPosition=new at,this._quat=new zc().setFromUnitVectors(e.up,new at(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new N4,this._sphericalDelta=new N4,this._scale=1,this._panOffset=new at,this._rotateStart=new ji,this._rotateEnd=new ji,this._rotateDelta=new ji,this._panStart=new ji,this._panEnd=new ji,this._panDelta=new ji,this._dollyStart=new ji,this._dollyEnd=new ji,this._dollyDelta=new ji,this._dollyDirection=new at,this._mouse=new ji,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=Jye.bind(this),this._onPointerDown=Kye.bind(this),this._onPointerUp=Zye.bind(this),this._onContextMenu=sve.bind(this),this._onMouseWheel=tve.bind(this),this._onKeyDown=ive.bind(this),this._onTouchStart=rve.bind(this),this._onTouchMove=nve.bind(this),this._onMouseDown=$ye.bind(this),this._onMouseMove=eve.bind(this),this._interceptControlDown=ave.bind(this),this._interceptControlUp=ove.bind(this),this.domElement!==null&&this.connect(),this.update()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(uz),this.update(),this.state=os.NONE}update(e=null){const i=this.object.position;ga.copy(i).sub(this.target),ga.applyQuaternion(this._quat),this._spherical.setFromVector3(ga),this.autoRotate&&this.state===os.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let n=this.minAzimuthAngle,s=this.maxAzimuthAngle;isFinite(n)&&isFinite(s)&&(n<-Math.PI?n+=Xo:n>Math.PI&&(n-=Xo),s<-Math.PI?s+=Xo:s>Math.PI&&(s-=Xo),n<=s?this._spherical.theta=Math.max(n,Math.min(s,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(n+s)/2?Math.max(n,this._spherical.theta):Math.min(s,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let o=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const l=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),o=l!=this._spherical.radius}if(ga.setFromSpherical(this._spherical),ga.applyQuaternion(this._quatInverse),i.copy(this.target).add(ga),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let l=null;if(this.object.isPerspectiveCamera){const u=ga.length();l=this._clampDistance(u*this._scale);const c=u-l;this.object.position.addScaledVector(this._dollyDirection,c),this.object.updateMatrixWorld(),o=!!c}else if(this.object.isOrthographicCamera){const u=new at(this._mouse.x,this._mouse.y,0);u.unproject(this.object);const c=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),o=c!==this.object.zoom;const h=new at(this._mouse.x,this._mouse.y,0);h.unproject(this.object),this.object.position.sub(h).add(u),this.object.updateMatrixWorld(),l=ga.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;l!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(l).add(this.object.position):(U_.origin.copy(this.object.position),U_.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(U_.direction))<Xye?this.object.lookAt(this.target):(dz.setFromNormalAndCoplanarPoint(this.object.up,this.target),U_.intersectPlane(dz,this.target))))}else if(this.object.isOrthographicCamera){const l=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),l!==this.object.zoom&&(this.object.updateProjectionMatrix(),o=!0)}return this._scale=1,this._performCursorZoom=!1,o||this._lastPosition.distanceToSquared(this.object.position)>cI||8*(1-this._lastQuaternion.dot(this.object.quaternion))>cI||this._lastTargetPosition.distanceToSquared(this.target)>cI?(this.dispatchEvent(uz),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?Xo/60*this.autoRotateSpeed*e:Xo/60/60*this.autoRotateSpeed}_getZoomScale(e){const i=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*i)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,i){ga.setFromMatrixColumn(i,0),ga.multiplyScalar(-e),this._panOffset.add(ga)}_panUp(e,i){this.screenSpacePanning===!0?ga.setFromMatrixColumn(i,1):(ga.setFromMatrixColumn(i,0),ga.crossVectors(this.object.up,ga)),ga.multiplyScalar(e),this._panOffset.add(ga)}_pan(e,i){const n=this.domElement;if(this.object.isPerspectiveCamera){const s=this.object.position;ga.copy(s).sub(this.target);let o=ga.length();o*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*o/n.clientHeight,this.object.matrix),this._panUp(2*i*o/n.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/n.clientWidth,this.object.matrix),this._panUp(i*(this.object.top-this.object.bottom)/this.object.zoom/n.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,i){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const n=this.domElement.getBoundingClientRect(),s=e-n.left,o=i-n.top,l=n.width,u=n.height;this._mouse.x=s/l*2-1,this._mouse.y=-(o/u)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const i=this.domElement;this._rotateLeft(Xo*this._rotateDelta.x/i.clientHeight),this._rotateUp(Xo*this._rotateDelta.y/i.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let i=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this._rotateUp(Xo*this.rotateSpeed/this.domElement.clientHeight):this._pan(0,this.keyPanSpeed),i=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this._rotateUp(-Xo*this.rotateSpeed/this.domElement.clientHeight):this._pan(0,-this.keyPanSpeed),i=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this._rotateLeft(Xo*this.rotateSpeed/this.domElement.clientHeight):this._pan(this.keyPanSpeed,0),i=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this._rotateLeft(-Xo*this.rotateSpeed/this.domElement.clientHeight):this._pan(-this.keyPanSpeed,0),i=!0;break}i&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const i=this._getSecondPointerPosition(e),n=.5*(e.pageX+i.x),s=.5*(e.pageY+i.y);this._rotateStart.set(n,s)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const i=this._getSecondPointerPosition(e),n=.5*(e.pageX+i.x),s=.5*(e.pageY+i.y);this._panStart.set(n,s)}}_handleTouchStartDolly(e){const i=this._getSecondPointerPosition(e),n=e.pageX-i.x,s=e.pageY-i.y,o=Math.sqrt(n*n+s*s);this._dollyStart.set(0,o)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const n=this._getSecondPointerPosition(e),s=.5*(e.pageX+n.x),o=.5*(e.pageY+n.y);this._rotateEnd.set(s,o)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const i=this.domElement;this._rotateLeft(Xo*this._rotateDelta.x/i.clientHeight),this._rotateUp(Xo*this._rotateDelta.y/i.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const i=this._getSecondPointerPosition(e),n=.5*(e.pageX+i.x),s=.5*(e.pageY+i.y);this._panEnd.set(n,s)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const i=this._getSecondPointerPosition(e),n=e.pageX-i.x,s=e.pageY-i.y,o=Math.sqrt(n*n+s*s);this._dollyEnd.set(0,o),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const l=(e.pageX+i.x)*.5,u=(e.pageY+i.y)*.5;this._updateZoomParameters(l,u)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let i=0;i<this._pointers.length;i++)if(this._pointers[i]==e.pointerId){this._pointers.splice(i,1);return}}_isTrackingPointer(e){for(let i=0;i<this._pointers.length;i++)if(this._pointers[i]==e.pointerId)return!0;return!1}_trackPointer(e){let i=this._pointerPositions[e.pointerId];i===void 0&&(i=new ji,this._pointerPositions[e.pointerId]=i),i.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const i=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[i]}_customWheelEvent(e){const i=e.deltaMode,n={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(i){case 1:n.deltaY*=16;break;case 2:n.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(n.deltaY*=10),n}}function Kye(r){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(r.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(r)&&(this._addPointer(r),r.pointerType==="touch"?this._onTouchStart(r):this._onMouseDown(r)))}function Jye(r){this.enabled!==!1&&(r.pointerType==="touch"?this._onTouchMove(r):this._onMouseMove(r))}function Zye(r){switch(this._removePointer(r),this._pointers.length){case 0:this.domElement.releasePointerCapture(r.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(hz),this.state=os.NONE;break;case 1:const e=this._pointers[0],i=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:i.x,pageY:i.y});break}}function $ye(r){let e;switch(r.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case ka.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(r),this.state=os.DOLLY;break;case ka.ROTATE:if(r.ctrlKey||r.metaKey||r.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(r),this.state=os.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(r),this.state=os.ROTATE}break;case ka.PAN:if(r.ctrlKey||r.metaKey||r.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(r),this.state=os.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(r),this.state=os.PAN}break;default:this.state=os.NONE}this.state!==os.NONE&&this.dispatchEvent(lI)}function eve(r){switch(this.state){case os.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(r);break;case os.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(r);break;case os.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(r);break}}function tve(r){this.enabled===!1||this.enableZoom===!1||this.state!==os.NONE||(r.preventDefault(),this.dispatchEvent(lI),this._handleMouseWheel(this._customWheelEvent(r)),this.dispatchEvent(hz))}function ive(r){this.enabled===!1||this.enablePan===!1||this._handleKeyDown(r)}function rve(r){switch(this._trackPointer(r),this._pointers.length){case 1:switch(this.touches.ONE){case bu.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(r),this.state=os.TOUCH_ROTATE;break;case bu.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(r),this.state=os.TOUCH_PAN;break;default:this.state=os.NONE}break;case 2:switch(this.touches.TWO){case bu.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(r),this.state=os.TOUCH_DOLLY_PAN;break;case bu.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(r),this.state=os.TOUCH_DOLLY_ROTATE;break;default:this.state=os.NONE}break;default:this.state=os.NONE}this.state!==os.NONE&&this.dispatchEvent(lI)}function nve(r){switch(this._trackPointer(r),this.state){case os.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(r),this.update();break;case os.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(r),this.update();break;case os.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(r),this.update();break;case os.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(r),this.update();break;default:this.state=os.NONE}}function sve(r){this.enabled!==!1&&r.preventDefault()}function ave(r){r.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function ove(r){r.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}const lve={type:"change"},pz=1e-6,fz=new zc;class cve extends Dx{constructor(e,i=null){super(e,i),this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1,this._moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this._moveVector=new at(0,0,0),this._rotationVector=new at(0,0,0),this._lastQuaternion=new zc,this._lastPosition=new at,this._status=0,this._onKeyDown=uve.bind(this),this._onKeyUp=hve.bind(this),this._onPointerMove=pve.bind(this),this._onPointerDown=dve.bind(this),this._onPointerUp=fve.bind(this),this._onPointerCancel=mve.bind(this),this._onContextMenu=gve.bind(this),i!==null&&this.connect()}connect(){window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu)}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu)}dispose(){this.disconnect()}update(e){if(this.enabled===!1)return;const i=this.object,n=e*this.movementSpeed,s=e*this.rollSpeed;i.translateX(this._moveVector.x*n),i.translateY(this._moveVector.y*n),i.translateZ(this._moveVector.z*n),fz.set(this._rotationVector.x*s,this._rotationVector.y*s,this._rotationVector.z*s,1).normalize(),i.quaternion.multiply(fz),(this._lastPosition.distanceToSquared(i.position)>pz||8*(1-this._lastQuaternion.dot(i.quaternion))>pz)&&(this.dispatchEvent(lve),this._lastQuaternion.copy(i.quaternion),this._lastPosition.copy(i.position))}_updateMovementVector(){const e=this._moveState.forward||this.autoForward&&!this._moveState.back?1:0;this._moveVector.x=-this._moveState.left+this._moveState.right,this._moveVector.y=-this._moveState.down+this._moveState.up,this._moveVector.z=-e+this._moveState.back}_updateRotationVector(){this._rotationVector.x=-this._moveState.pitchDown+this._moveState.pitchUp,this._rotationVector.y=-this._moveState.yawRight+this._moveState.yawLeft,this._rotationVector.z=-this._moveState.rollRight+this._moveState.rollLeft}_getContainerDimensions(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}}}function uve(r){if(!(r.altKey||this.enabled===!1)){switch(r.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this._moveState.forward=1;break;case"KeyS":this._moveState.back=1;break;case"KeyA":this._moveState.left=1;break;case"KeyD":this._moveState.right=1;break;case"KeyR":this._moveState.up=1;break;case"KeyF":this._moveState.down=1;break;case"ArrowUp":this._moveState.pitchUp=1;break;case"ArrowDown":this._moveState.pitchDown=1;break;case"ArrowLeft":this._moveState.yawLeft=1;break;case"ArrowRight":this._moveState.yawRight=1;break;case"KeyQ":this._moveState.rollLeft=1;break;case"KeyE":this._moveState.rollRight=1;break}this._updateMovementVector(),this._updateRotationVector()}}function hve(r){if(this.enabled!==!1){switch(r.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this._moveState.forward=0;break;case"KeyS":this._moveState.back=0;break;case"KeyA":this._moveState.left=0;break;case"KeyD":this._moveState.right=0;break;case"KeyR":this._moveState.up=0;break;case"KeyF":this._moveState.down=0;break;case"ArrowUp":this._moveState.pitchUp=0;break;case"ArrowDown":this._moveState.pitchDown=0;break;case"ArrowLeft":this._moveState.yawLeft=0;break;case"ArrowRight":this._moveState.yawRight=0;break;case"KeyQ":this._moveState.rollLeft=0;break;case"KeyE":this._moveState.rollRight=0;break}this._updateMovementVector(),this._updateRotationVector()}}function dve(r){if(this.enabled!==!1)if(this.dragToLook)this._status++;else{switch(r.button){case 0:this._moveState.forward=1;break;case 2:this._moveState.back=1;break}this._updateMovementVector()}}function pve(r){if(this.enabled!==!1&&(!this.dragToLook||this._status>0)){const e=this._getContainerDimensions(),i=e.size[0]/2,n=e.size[1]/2;this._moveState.yawLeft=-(r.pageX-e.offset[0]-i)/i,this._moveState.pitchDown=(r.pageY-e.offset[1]-n)/n,this._updateRotationVector()}}function fve(r){if(this.enabled!==!1){if(this.dragToLook)this._status--,this._moveState.yawLeft=this._moveState.pitchDown=0;else{switch(r.button){case 0:this._moveState.forward=0;break;case 2:this._moveState.back=0;break}this._updateMovementVector()}this._updateRotationVector()}}function mve(){this.enabled!==!1&&(this.dragToLook?(this._status=0,this._moveState.yawLeft=this._moveState.pitchDown=0):(this._moveState.forward=0,this._moveState.back=0,this._updateMovementVector()),this._updateRotationVector())}function gve(r){this.enabled!==!1&&r.preventDefault()}const Ave={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};class z_{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const yve=new BS(-1,1,1,-1,0,1);class vve extends Ao{constructor(){super(),this.setAttribute("position",new Os([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Os([0,2,0,0,2,0],2))}}const bve=new vve;class xve{constructor(e){this._mesh=new pa(bve,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,yve)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class _ve extends z_{constructor(e,i){super(),this.textureID=i!==void 0?i:"tDiffuse",e instanceof jc?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=DO.clone(e.uniforms),this.material=new jc({name:e.name!==void 0?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new xve(this.material)}render(e,i,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(i),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class mz extends z_{constructor(e,i){super(),this.scene=e,this.camera=i,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,i,n){const s=e.getContext(),o=e.state;o.buffers.color.setMask(!1),o.buffers.depth.setMask(!1),o.buffers.color.setLocked(!0),o.buffers.depth.setLocked(!0);let l,u;this.inverse?(l=0,u=1):(l=1,u=0),o.buffers.stencil.setTest(!0),o.buffers.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),o.buffers.stencil.setFunc(s.ALWAYS,l,4294967295),o.buffers.stencil.setClear(u),o.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),o.buffers.color.setLocked(!1),o.buffers.depth.setLocked(!1),o.buffers.color.setMask(!0),o.buffers.depth.setMask(!0),o.buffers.stencil.setLocked(!1),o.buffers.stencil.setFunc(s.EQUAL,1,4294967295),o.buffers.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),o.buffers.stencil.setLocked(!0)}}class Eve extends z_{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class wve{constructor(e,i){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),i===void 0){const n=e.getSize(new ji);this._width=n.width,this._height=n.height,i=new Qh(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:fm}),i.texture.name="EffectComposer.rt1"}else this._width=i.width,this._height=i.height;this.renderTarget1=i,this.renderTarget2=i.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new _ve(Ave),this.copyPass.material.blending=Eu,this.clock=new R4}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,i){this.passes.splice(i,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const i=this.passes.indexOf(e);i!==-1&&this.passes.splice(i,1)}isLastEnabledPass(e){for(let i=e+1;i<this.passes.length;i++)if(this.passes[i].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const i=this.renderer.getRenderTarget();let n=!1;for(let s=0,o=this.passes.length;s<o;s++){const l=this.passes[s];if(l.enabled!==!1){if(l.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(s),l.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),l.needsSwap){if(n){const u=this.renderer.getContext(),c=this.renderer.state.buffers.stencil;c.setFunc(u.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),c.setFunc(u.EQUAL,1,4294967295)}this.swapBuffers()}mz!==void 0&&(l instanceof mz?n=!0:l instanceof Eve&&(n=!1))}}this.renderer.setRenderTarget(i)}reset(e){if(e===void 0){const i=this.renderer.getSize(new ji);this._pixelRatio=this.renderer.getPixelRatio(),this._width=i.width,this._height=i.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,i){this._width=e,this._height=i;const n=this._width*this._pixelRatio,s=this._height*this._pixelRatio;this.renderTarget1.setSize(n,s),this.renderTarget2.setSize(n,s);for(let o=0;o<this.passes.length;o++)this.passes[o].setSize(n,s)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class Cve extends z_{constructor(e,i,n=null,s=null,o=null){super(),this.scene=e,this.camera=i,this.overrideMaterial=n,this.clearColor=s,this.clearAlpha=o,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new Cn}render(e,i,n){const s=e.autoClear;e.autoClear=!1;let o,l;this.overrideMaterial!==null&&(l=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor,e.getClearAlpha())),this.clearAlpha!==null&&(o=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),this.clearDepth==!0&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),this.clear===!0&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor!==null&&e.setClearColor(this._oldClearColor),this.clearAlpha!==null&&e.setClearAlpha(o),this.overrideMaterial!==null&&(this.scene.overrideMaterial=l),e.autoClear=s}}var uh=Object.freeze({Linear:Object.freeze({None:function(r){return r},In:function(r){return r},Out:function(r){return r},InOut:function(r){return r}}),Quadratic:Object.freeze({In:function(r){return r*r},Out:function(r){return r*(2-r)},InOut:function(r){return(r*=2)<1?.5*r*r:-.5*(--r*(r-2)-1)}}),Cubic:Object.freeze({In:function(r){return r*r*r},Out:function(r){return--r*r*r+1},InOut:function(r){return(r*=2)<1?.5*r*r*r:.5*((r-=2)*r*r+2)}}),Quartic:Object.freeze({In:function(r){return r*r*r*r},Out:function(r){return 1- --r*r*r*r},InOut:function(r){return(r*=2)<1?.5*r*r*r*r:-.5*((r-=2)*r*r*r-2)}}),Quintic:Object.freeze({In:function(r){return r*r*r*r*r},Out:function(r){return--r*r*r*r*r+1},InOut:function(r){return(r*=2)<1?.5*r*r*r*r*r:.5*((r-=2)*r*r*r*r+2)}}),Sinusoidal:Object.freeze({In:function(r){return 1-Math.sin((1-r)*Math.PI/2)},Out:function(r){return Math.sin(r*Math.PI/2)},InOut:function(r){return .5*(1-Math.sin(Math.PI*(.5-r)))}}),Exponential:Object.freeze({In:function(r){return r===0?0:Math.pow(1024,r-1)},Out:function(r){return r===1?1:1-Math.pow(2,-10*r)},InOut:function(r){return r===0?0:r===1?1:(r*=2)<1?.5*Math.pow(1024,r-1):.5*(-Math.pow(2,-10*(r-1))+2)}}),Circular:Object.freeze({In:function(r){return 1-Math.sqrt(1-r*r)},Out:function(r){return Math.sqrt(1- --r*r)},InOut:function(r){return(r*=2)<1?-.5*(Math.sqrt(1-r*r)-1):.5*(Math.sqrt(1-(r-=2)*r)+1)}}),Elastic:Object.freeze({In:function(r){return r===0?0:r===1?1:-Math.pow(2,10*(r-1))*Math.sin((r-1.1)*5*Math.PI)},Out:function(r){return r===0?0:r===1?1:Math.pow(2,-10*r)*Math.sin((r-.1)*5*Math.PI)+1},InOut:function(r){return r===0?0:r===1?1:(r*=2,r<1?-.5*Math.pow(2,10*(r-1))*Math.sin((r-1.1)*5*Math.PI):.5*Math.pow(2,-10*(r-1))*Math.sin((r-1.1)*5*Math.PI)+1)}}),Back:Object.freeze({In:function(r){var e=1.70158;return r===1?1:r*r*((e+1)*r-e)},Out:function(r){var e=1.70158;return r===0?0:--r*r*((e+1)*r+e)+1},InOut:function(r){var e=2.5949095;return(r*=2)<1?.5*(r*r*((e+1)*r-e)):.5*((r-=2)*r*((e+1)*r+e)+2)}}),Bounce:Object.freeze({In:function(r){return 1-uh.Bounce.Out(1-r)},Out:function(r){return r<1/2.75?7.5625*r*r:r<2/2.75?7.5625*(r-=1.5/2.75)*r+.75:r<2.5/2.75?7.5625*(r-=2.25/2.75)*r+.9375:7.5625*(r-=2.625/2.75)*r+.984375},InOut:function(r){return r<.5?uh.Bounce.In(r*2)*.5:uh.Bounce.Out(r*2-1)*.5+.5}}),generatePow:function(r){return r===void 0&&(r=4),r=r<Number.EPSILON?Number.EPSILON:r,r=r>1e4?1e4:r,{In:function(e){return Math.pow(e,r)},Out:function(e){return 1-Math.pow(1-e,r)},InOut:function(e){return e<.5?Math.pow(e*2,r)/2:(1-Math.pow(2-e*2,r))/2+.5}}}}),zy=function(){return performance.now()},uI=function(){function r(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this._tweens={},this._tweensAddedDuringUpdate={},this.add.apply(this,e)}return r.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map(function(i){return e._tweens[i]})},r.prototype.removeAll=function(){this._tweens={}},r.prototype.add=function(){for(var e,i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];for(var s=0,o=i;s<o.length;s++){var l=o[s];(e=l._group)===null||e===void 0||e.remove(l),l._group=this,this._tweens[l.getId()]=l,this._tweensAddedDuringUpdate[l.getId()]=l}},r.prototype.remove=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];for(var n=0,s=e;n<s.length;n++){var o=s[n];o._group=void 0,delete this._tweens[o.getId()],delete this._tweensAddedDuringUpdate[o.getId()]}},r.prototype.allStopped=function(){return this.getAll().every(function(e){return!e.isPlaying()})},r.prototype.update=function(e,i){e===void 0&&(e=zy()),i===void 0&&(i=!0);var n=Object.keys(this._tweens);if(n.length!==0)for(;n.length>0;){this._tweensAddedDuringUpdate={};for(var s=0;s<n.length;s++){var o=this._tweens[n[s]],l=!i;o&&o.update(e,l)===!1&&!i&&this.remove(o)}n=Object.keys(this._tweensAddedDuringUpdate)}},r}(),hI={Linear:function(r,e){var i=r.length-1,n=i*e,s=Math.floor(n),o=hI.Utils.Linear;return e<0?o(r[0],r[1],n):e>1?o(r[i],r[i-1],i-n):o(r[s],r[s+1>i?i:s+1],n-s)},Utils:{Linear:function(r,e,i){return(e-r)*i+r}}},gz=function(){function r(){}return r.nextId=function(){return r._nextId++},r._nextId=0,r}(),dI=new uI,j_=function(){function r(e,i){this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=uh.Linear.None,this._interpolationFunction=hI.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=gz.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1,this._object=e,typeof i=="object"?(this._group=i,i.add(this)):i===!0&&(this._group=dI,dI.add(this))}return r.prototype.getId=function(){return this._id},r.prototype.isPlaying=function(){return this._isPlaying},r.prototype.isPaused=function(){return this._isPaused},r.prototype.getDuration=function(){return this._duration},r.prototype.to=function(e,i){if(i===void 0&&(i=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=e,this._propertiesAreSetUp=!1,this._duration=i<0?0:i,this},r.prototype.duration=function(e){return e===void 0&&(e=1e3),this._duration=e<0?0:e,this},r.prototype.dynamic=function(e){return e===void 0&&(e=!1),this._isDynamic=e,this},r.prototype.start=function(e,i){if(e===void 0&&(e=zy()),i===void 0&&(i=!1),this._isPlaying)return this;if(this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var n in this._valuesStartRepeat)this._swapEndStartRepeatValues(n),this._valuesStart[n]=this._valuesStartRepeat[n]}if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=e,this._startTime+=this._delayTime,!this._propertiesAreSetUp||i){if(this._propertiesAreSetUp=!0,!this._isDynamic){var s={};for(var o in this._valuesEnd)s[o]=this._valuesEnd[o];this._valuesEnd=s}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,i)}return this},r.prototype.startFromCurrentValues=function(e){return this.start(e,!0)},r.prototype._setupProperties=function(e,i,n,s,o){for(var l in n){var u=e[l],c=Array.isArray(u),h=c?"array":typeof u,p=!c&&Array.isArray(n[l]);if(!(h==="undefined"||h==="function")){if(p){var f=n[l];if(f.length===0)continue;for(var g=[u],m=0,y=f.length;m<y;m+=1){var b=this._handleRelativeValue(u,f[m]);if(isNaN(b)){p=!1,console.warn("Found invalid interpolation list. Skipping.");break}g.push(b)}p&&(n[l]=g)}if((h==="object"||c)&&u&&!p){i[l]=c?[]:{};var v=u;for(var _ in v)i[l][_]=v[_];s[l]=c?[]:{};var f=n[l];if(!this._isDynamic){var T={};for(var _ in f)T[_]=f[_];n[l]=f=T}this._setupProperties(v,i[l],f,s[l],o)}else(typeof i[l]>"u"||o)&&(i[l]=u),c||(i[l]*=1),p?s[l]=n[l].slice().reverse():s[l]=i[l]||0}}},r.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},r.prototype.end=function(){return this._goToEnd=!0,this.update(this._startTime+this._duration),this},r.prototype.pause=function(e){return e===void 0&&(e=zy()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=e,this)},r.prototype.resume=function(e){return e===void 0&&(e=zy()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this)},r.prototype.stopChainedTweens=function(){for(var e=0,i=this._chainedTweens.length;e<i;e++)this._chainedTweens[e].stop();return this},r.prototype.group=function(e){return e?(e.add(this),this):(console.warn("tween.group() without args has been removed, use group.add(tween) instead."),this)},r.prototype.remove=function(){var e;return(e=this._group)===null||e===void 0||e.remove(this),this},r.prototype.delay=function(e){return e===void 0&&(e=0),this._delayTime=e,this},r.prototype.repeat=function(e){return e===void 0&&(e=0),this._initialRepeat=e,this._repeat=e,this},r.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},r.prototype.yoyo=function(e){return e===void 0&&(e=!1),this._yoyo=e,this},r.prototype.easing=function(e){return e===void 0&&(e=uh.Linear.None),this._easingFunction=e,this},r.prototype.interpolation=function(e){return e===void 0&&(e=hI.Linear),this._interpolationFunction=e,this},r.prototype.chain=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return this._chainedTweens=e,this},r.prototype.onStart=function(e){return this._onStartCallback=e,this},r.prototype.onEveryStart=function(e){return this._onEveryStartCallback=e,this},r.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},r.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},r.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},r.prototype.onStop=function(e){return this._onStopCallback=e,this},r.prototype.update=function(e,i){var n=this,s;if(e===void 0&&(e=zy()),i===void 0&&(i=r.autoStartOnUpdate),this._isPaused)return!0;var o;if(!this._goToEnd&&!this._isPlaying)if(i)this.start(e,!0);else return!1;if(this._goToEnd=!1,e<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),this._onEveryStartCallbackFired===!1&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0);var l=e-this._startTime,u=this._duration+((s=this._repeatDelayTime)!==null&&s!==void 0?s:this._delayTime),c=this._duration+this._repeat*u,h=function(){if(n._duration===0||l>c)return 1;var b=Math.trunc(l/u),v=l-b*u,_=Math.min(v/n._duration,1);return _===0&&l===n._duration?1:_},p=h(),f=this._easingFunction(p);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,f),this._onUpdateCallback&&this._onUpdateCallback(this._object,p),this._duration===0||l>=this._duration)if(this._repeat>0){var g=Math.min(Math.trunc((l-this._duration)/u)+1,this._repeat);isFinite(this._repeat)&&(this._repeat-=g);for(o in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[o]=="string"&&(this._valuesStartRepeat[o]=this._valuesStartRepeat[o]+parseFloat(this._valuesEnd[o])),this._yoyo&&this._swapEndStartRepeatValues(o),this._valuesStart[o]=this._valuesStartRepeat[o];return this._yoyo&&(this._reversed=!this._reversed),this._startTime+=u*g,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var m=0,y=this._chainedTweens.length;m<y;m++)this._chainedTweens[m].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},r.prototype._updateProperties=function(e,i,n,s){for(var o in n)if(i[o]!==void 0){var l=i[o]||0,u=n[o],c=Array.isArray(e[o]),h=Array.isArray(u),p=!c&&h;p?e[o]=this._interpolationFunction(u,s):typeof u=="object"&&u?this._updateProperties(e[o],l,u,s):(u=this._handleRelativeValue(l,u),typeof u=="number"&&(e[o]=l+(u-l)*s))}},r.prototype._handleRelativeValue=function(e,i){return typeof i!="string"?i:i.charAt(0)==="+"||i.charAt(0)==="-"?e+parseFloat(i):parseFloat(i)},r.prototype._swapEndStartRepeatValues=function(e){var i=this._valuesStartRepeat[e],n=this._valuesEnd[e];typeof n=="string"?this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(n):this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=i},r.autoStartOnUpdate=!1,r}();gz.nextId;var Zc=dI;Zc.getAll.bind(Zc),Zc.removeAll.bind(Zc),Zc.add.bind(Zc),Zc.remove.bind(Zc),Zc.update.bind(Zc);function Sve(r,e){e===void 0&&(e={});var i=e.insertAt;if(!(typeof document>"u")){var n=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css",i==="top"&&n.firstChild?n.insertBefore(s,n.firstChild):n.appendChild(s),s.styleSheet?s.styleSheet.cssText=r:s.appendChild(document.createTextNode(r))}}var Tve=`.scene-nav-info {
  bottom: 5px;
  width: 100%;
  text-align: center;
  color: slategrey;
  opacity: 0.7;
  font-size: 10px;
}

.scene-tooltip {
  top: 0;
  color: lavender;
  font-size: 15px;
}

.scene-nav-info, .scene-tooltip {
  position: absolute;
  font-family: sans-serif;
  pointer-events: none;
  user-select: none;
}

.scene-container canvas:focus {
  outline: none;
}`;Sve(Tve);function pI(r,e){(e==null||e>r.length)&&(e=r.length);for(var i=0,n=Array(e);i<e;i++)n[i]=r[i];return n}function Mve(r){if(Array.isArray(r))return r}function Rve(r){if(Array.isArray(r))return pI(r)}function Ive(r,e,i){return(e=kve(e))in r?Object.defineProperty(r,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[e]=i,r}function Bve(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function Lve(r,e){var i=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(i!=null){var n,s,o,l,u=[],c=!0,h=!1;try{if(o=(i=i.call(r)).next,e!==0)for(;!(c=(n=o.call(i)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(p){h=!0,s=p}finally{try{if(!c&&i.return!=null&&(l=i.return(),Object(l)!==l))return}finally{if(h)throw s}}return u}}function Dve(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Nve(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Pve(r,e){return Mve(r)||Lve(r,e)||Az(r,e)||Dve()}function jy(r){return Rve(r)||Bve(r)||Az(r)||Nve()}function Ove(r,e){if(typeof r!="object"||!r)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var n=i.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function kve(r){var e=Ove(r,"string");return typeof e=="symbol"?e:e+""}function Az(r,e){if(r){if(typeof r=="string")return pI(r,e);var i={}.toString.call(r).slice(8,-1);return i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set"?Array.from(r):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?pI(r,e):void 0}}var Ss=window.THREE?window.THREE:{WebGLRenderer:Nte,Scene:Pte,PerspectiveCamera:Pl,Raycaster:L4,SRGBColorSpace:al,TextureLoader:nie,Vector2:ji,Vector3:at,Box3:hp,Color:Cn,Mesh:pa,SphereGeometry:Lx,MeshBasicMaterial:Nu,BackSide:go,Clock:R4},yz=wp({props:{width:{default:window.innerWidth,onChange:function(r,e,i){isNaN(r)&&(e.width=i)}},height:{default:window.innerHeight,onChange:function(r,e,i){isNaN(r)&&(e.height=i)}},backgroundColor:{default:"#000011"},backgroundImageUrl:{},onBackgroundImageLoaded:{},showNavInfo:{default:!0},skyRadius:{default:5e4},objects:{default:[]},lights:{default:[]},enablePointerInteraction:{default:!0,onChange:function(r,e){e.hoverObj=null,e.toolTipElem&&(e.toolTipElem.innerHTML="")},triggerUpdate:!1},lineHoverPrecision:{default:1,triggerUpdate:!1},hoverOrderComparator:{default:function(){return-1},triggerUpdate:!1},hoverFilter:{default:function(){return!0},triggerUpdate:!1},tooltipContent:{triggerUpdate:!1},hoverDuringDrag:{default:!1,triggerUpdate:!1},clickAfterDrag:{default:!1,triggerUpdate:!1},onHover:{default:function(){},triggerUpdate:!1},onClick:{default:function(){},triggerUpdate:!1},onRightClick:{triggerUpdate:!1}},methods:{tick:function(r){if(r.initialised){if(r.controls.update&&r.controls.update(Math.min(1,r.clock.getDelta())),r.postProcessingComposer?r.postProcessingComposer.render():r.renderer.render(r.scene,r.camera),r.extraRenderers.forEach(function(s){return s.render(r.scene,r.camera)}),r.enablePointerInteraction){var e=null;if(r.hoverDuringDrag||!r.isPointerDragging){var i=this.intersectingObjects(r.pointerPos.x,r.pointerPos.y).filter(function(s){return r.hoverFilter(s.object)}).sort(function(s,o){return r.hoverOrderComparator(s.object,o.object)}),n=i.length?i[0]:null;e=n?n.object:null,r.intersectionPoint=n?n.point:null}e!==r.hoverObj&&(r.onHover(e,r.hoverObj),r.toolTipElem.innerHTML=e&&mr(r.tooltipContent)(e)||"",r.hoverObj=e)}r.tweenGroup.update()}return this},getPointerPos:function(r){var e=r.pointerPos,i=e.x,n=e.y;return{x:i,y:n}},cameraPosition:function(r,e,i,n){var s=r.camera;if(e&&r.initialised){var o=e,l=i||{x:0,y:0,z:0};if(!n)h(o),p(l);else{var u=Object.assign({},s.position),c=f();r.tweenGroup.add(new j_(u).to(o,n).easing(uh.Quadratic.Out).onUpdate(h).start()),r.tweenGroup.add(new j_(c).to(l,n/3).easing(uh.Quadratic.Out).onUpdate(p).start())}return this}return Object.assign({},s.position,{lookAt:f()});function h(g){var m=g.x,y=g.y,b=g.z;m!==void 0&&(s.position.x=m),y!==void 0&&(s.position.y=y),b!==void 0&&(s.position.z=b)}function p(g){var m=new Ss.Vector3(g.x,g.y,g.z);r.controls.target?r.controls.target=m:s.lookAt(m)}function f(){return Object.assign(new Ss.Vector3(0,0,-1e3).applyQuaternion(s.quaternion).add(s.position))}},zoomToFit:function(r){for(var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:10,n=arguments.length,s=new Array(n>3?n-3:0),o=3;o<n;o++)s[o-3]=arguments[o];return this.fitToBbox(this.getBbox.apply(this,s),e,i)},fitToBbox:function(r,e){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:10,s=r.camera;if(e){var o=new Ss.Vector3(0,0,0),l=Math.max.apply(Math,jy(Object.entries(e).map(function(g){var m=Pve(g,2),y=m[0],b=m[1];return Math.max.apply(Math,jy(b.map(function(v){return Math.abs(o[y]-v)})))})))*2,u=(1-n*2/r.height)*s.fov,c=l/Math.atan(u*Math.PI/180),h=c/s.aspect,p=Math.max(c,h);if(p>0){var f=o.clone().sub(s.position).normalize().multiplyScalar(-p);this.cameraPosition(f,o,i)}}return this},getBbox:function(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return!0},i=new Ss.Box3(new Ss.Vector3(0,0,0),new Ss.Vector3(0,0,0)),n=r.objects.filter(e);return n.length?(n.forEach(function(s){return i.expandByObject(s)}),Object.assign.apply(Object,jy(["x","y","z"].map(function(s){return Ive({},s,[i.min[s],i.max[s]])})))):null},getScreenCoords:function(r,e,i,n){var s=new Ss.Vector3(e,i,n);return s.project(this.camera()),{x:(s.x+1)*r.width/2,y:-(s.y-1)*r.height/2}},getSceneCoords:function(r,e,i){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,s=new Ss.Vector2(e/r.width*2-1,-(i/r.height)*2+1),o=new Ss.Raycaster;return o.setFromCamera(s,r.camera),Object.assign({},o.ray.at(n,new Ss.Vector3))},intersectingObjects:function(r,e,i){var n=new Ss.Vector2(e/r.width*2-1,-(i/r.height)*2+1),s=new Ss.Raycaster;return s.params.Line.threshold=r.lineHoverPrecision,s.setFromCamera(n,r.camera),s.intersectObjects(r.objects,!0)},renderer:function(r){return r.renderer},scene:function(r){return r.scene},camera:function(r){return r.camera},postProcessingComposer:function(r){return r.postProcessingComposer},controls:function(r){return r.controls},tbControls:function(r){return r.controls}},stateInit:function(){return{scene:new Ss.Scene,camera:new Ss.PerspectiveCamera,clock:new Ss.Clock,tweenGroup:new uI}},init:function(r,e){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=i.controlType,s=n===void 0?"trackball":n,o=i.useWebGPU,l=o===void 0?!1:o,u=i.rendererConfig,c=u===void 0?{}:u,h=i.extraRenderers,p=h===void 0?[]:h,f=i.waitForLoadComplete,g=f===void 0?!0:f;r.innerHTML="",r.appendChild(e.container=document.createElement("div")),e.container.className="scene-container",e.container.style.position="relative",e.container.appendChild(e.navInfo=document.createElement("div")),e.navInfo.className="scene-nav-info",e.navInfo.textContent={orbit:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",trackball:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",fly:"WASD: move, R|F: up | down, Q|E: roll, up|down: pitch, left|right: yaw"}[s]||"",e.navInfo.style.display=e.showNavInfo?null:"none",e.toolTipElem=document.createElement("div"),e.toolTipElem.classList.add("scene-tooltip"),e.container.appendChild(e.toolTipElem),e.pointerPos=new Ss.Vector2,e.pointerPos.x=-2,e.pointerPos.y=-2,["pointermove","pointerdown"].forEach(function(m){return e.container.addEventListener(m,function(y){if(m==="pointerdown"&&(e.isPointerPressed=!0),!e.isPointerDragging&&y.type==="pointermove"&&(y.pressure>0||e.isPointerPressed)&&(y.pointerType!=="touch"||y.movementX===void 0||[y.movementX,y.movementY].some(function(_){return Math.abs(_)>1}))&&(e.isPointerDragging=!0),e.enablePointerInteraction){var b=v(e.container);e.pointerPos.x=y.pageX-b.left,e.pointerPos.y=y.pageY-b.top,e.toolTipElem.style.top="".concat(e.pointerPos.y,"px"),e.toolTipElem.style.left="".concat(e.pointerPos.x,"px"),e.toolTipElem.style.transform="translate(-".concat(e.pointerPos.x/e.width*100,"%, ").concat(e.height-e.pointerPos.y<100?"calc(-100% - 8px)":"21px",")")}function v(_){var T=_.getBoundingClientRect(),E=window.pageXOffset||document.documentElement.scrollLeft,C=window.pageYOffset||document.documentElement.scrollTop;return{top:T.top+C,left:T.left+E}}},{passive:!0})}),e.container.addEventListener("pointerup",function(m){e.isPointerPressed=!1,!(e.isPointerDragging&&(e.isPointerDragging=!1,!e.clickAfterDrag))&&requestAnimationFrame(function(){m.button===0&&e.onClick(e.hoverObj||null,m,e.intersectionPoint),m.button===2&&e.onRightClick&&e.onRightClick(e.hoverObj||null,m,e.intersectionPoint)})},{passive:!0,capture:!0}),e.container.addEventListener("contextmenu",function(m){e.onRightClick&&m.preventDefault()}),e.renderer=new(l?Bye:Ss.WebGLRenderer)(Object.assign({antialias:!0,alpha:!0},c)),e.renderer.setPixelRatio(Math.min(2,window.devicePixelRatio)),e.container.appendChild(e.renderer.domElement),e.extraRenderers=p,e.extraRenderers.forEach(function(m){m.domElement.style.position="absolute",m.domElement.style.top="0px",m.domElement.style.pointerEvents="none",e.container.appendChild(m.domElement)}),e.postProcessingComposer=new wve(e.renderer),e.postProcessingComposer.addPass(new Cve(e.scene,e.camera)),e.controls=new{trackball:Dye,orbit:Yye,fly:cve}[s](e.camera,e.renderer.domElement),s==="fly"&&(e.controls.movementSpeed=300,e.controls.rollSpeed=Math.PI/6,e.controls.dragToLook=!0),(s==="trackball"||s==="orbit")&&(e.controls.minDistance=.1,e.controls.maxDistance=e.skyRadius,e.controls.addEventListener("start",function(){e.controlsEngaged=!0}),e.controls.addEventListener("change",function(){e.controlsEngaged&&(e.controlsDragging=!0)}),e.controls.addEventListener("end",function(){e.controlsEngaged=!1,e.controlsDragging=!1})),[e.renderer,e.postProcessingComposer].concat(jy(e.extraRenderers)).forEach(function(m){return m.setSize(e.width,e.height)}),e.camera.aspect=e.width/e.height,e.camera.updateProjectionMatrix(),e.camera.position.z=1e3,e.scene.add(e.skysphere=new Ss.Mesh),e.skysphere.visible=!1,e.loadComplete=e.scene.visible=!g,window.scene=e.scene},update:function(r,e){if(r.width&&r.height&&(e.hasOwnProperty("width")||e.hasOwnProperty("height"))&&(r.container.style.width="".concat(r.width,"px"),r.container.style.height="".concat(r.height,"px"),[r.renderer,r.postProcessingComposer].concat(jy(r.extraRenderers)).forEach(function(s){return s.setSize(r.width,r.height)}),r.camera.aspect=r.width/r.height,r.camera.updateProjectionMatrix()),e.hasOwnProperty("skyRadius")&&r.skyRadius&&(r.controls.hasOwnProperty("maxDistance")&&e.skyRadius&&(r.controls.maxDistance=Math.min(r.controls.maxDistance,r.skyRadius)),r.camera.far=r.skyRadius*2.5,r.camera.updateProjectionMatrix(),r.skysphere.geometry=new Ss.SphereGeometry(r.skyRadius)),e.hasOwnProperty("backgroundColor")){var i=Mp(r.backgroundColor).alpha;i===void 0&&(i=1),r.renderer.setClearColor(new Ss.Color(I5(1,r.backgroundColor)),i)}e.hasOwnProperty("backgroundImageUrl")&&(r.backgroundImageUrl?new Ss.TextureLoader().load(r.backgroundImageUrl,function(s){s.colorSpace=Ss.SRGBColorSpace,r.skysphere.material=new Ss.MeshBasicMaterial({map:s,side:Ss.BackSide}),r.skysphere.visible=!0,r.onBackgroundImageLoaded&&setTimeout(r.onBackgroundImageLoaded),!r.loadComplete&&n()}):(r.skysphere.visible=!1,r.skysphere.material.map=null,!r.loadComplete&&n())),e.hasOwnProperty("showNavInfo")&&(r.navInfo.style.display=r.showNavInfo?null:"none"),e.hasOwnProperty("lights")&&((e.lights||[]).forEach(function(s){return r.scene.remove(s)}),r.lights.forEach(function(s){return r.scene.add(s)})),e.hasOwnProperty("objects")&&((e.objects||[]).forEach(function(s){return r.scene.remove(s)}),r.objects.forEach(function(s){return r.scene.add(s)}));function n(){r.loadComplete=r.scene.visible=!0}}});function Fve(r,e){e===void 0&&(e={});var i=e.insertAt;if(!(typeof document>"u")){var n=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css",i==="top"&&n.firstChild?n.insertBefore(s,n.firstChild):n.appendChild(s),s.styleSheet?s.styleSheet.cssText=r:s.appendChild(document.createTextNode(r))}}var Uve=`.graph-info-msg {
  top: 50%;
  width: 100%;
  text-align: center;
  color: lavender;
  opacity: 0.7;
  font-size: 22px;
  position: absolute;
  font-family: Sans-serif;
}

.scene-container .clickable {
  cursor: pointer;
}

.scene-container .grabbable {
  cursor: move;
  cursor: grab;
  cursor: -moz-grab;
  cursor: -webkit-grab;
}

.scene-container .grabbable:active {
  cursor: grabbing;
  cursor: -moz-grabbing;
  cursor: -webkit-grabbing;
}`;Fve(Uve);function fI(r,e){(e==null||e>r.length)&&(e=r.length);for(var i=0,n=Array(e);i<e;i++)n[i]=r[i];return n}function zve(r){if(Array.isArray(r))return fI(r)}function Vy(r,e,i){return(e=Hve(e))in r?Object.defineProperty(r,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[e]=i,r}function jve(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function Vve(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function vz(r,e){var i=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),i.push.apply(i,n)}return i}function V_(r){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?vz(Object(i),!0).forEach(function(n){Vy(r,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):vz(Object(i)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(i,n))})}return r}function G_(r){return zve(r)||jve(r)||Wve(r)||Vve()}function Gve(r,e){if(typeof r!="object"||!r)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var n=i.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function Hve(r){var e=Gve(r,"string");return typeof e=="symbol"?e:e+""}function Wve(r,e){if(r){if(typeof r=="string")return fI(r,e);var i={}.toString.call(r).slice(8,-1);return i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set"?Array.from(r):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?fI(r,e):void 0}}function bz(r,e){var i=new e;return i._destructor&&i._destructor(),{linkProp:function(n){return{default:i[n](),onChange:function(s,o){o[r][n](s)},triggerUpdate:!1}},linkMethod:function(n){return function(s){for(var o=s[r],l=arguments.length,u=new Array(l>1?l-1:0),c=1;c<l;c++)u[c-1]=arguments[c];var h=o[n].apply(o,u);return h===o?this:h}}}}var mI=window.THREE?window.THREE:{AmbientLight:lie,DirectionalLight:oie,REVISION:Gb},Qve=170,xz=bz("forceGraph",UT),qve=Object.assign.apply(Object,G_(["jsonUrl","graphData","numDimensions","dagMode","dagLevelDistance","dagNodeFilter","onDagError","nodeRelSize","nodeId","nodeVal","nodeResolution","nodeColor","nodeAutoColorBy","nodeOpacity","nodeVisibility","nodeThreeObject","nodeThreeObjectExtend","linkSource","linkTarget","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","forceEngine","d3AlphaDecay","d3VelocityDecay","d3AlphaMin","ngraphPhysics","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"].map(function(r){return Vy({},r,xz.linkProp(r))}))),Xve=Object.assign.apply(Object,G_(["refresh","getGraphBbox","d3Force","d3ReheatSimulation","emitParticle"].map(function(r){return Vy({},r,xz.linkMethod(r))}))),H_=bz("renderObjs",yz),Yve=Object.assign.apply(Object,G_(["width","height","backgroundColor","showNavInfo","enablePointerInteraction"].map(function(r){return Vy({},r,H_.linkProp(r))}))),Kve=Object.assign.apply(Object,G_(["lights","cameraPosition","postProcessingComposer"].map(function(r){return Vy({},r,H_.linkMethod(r))})).concat([{graph2ScreenCoords:H_.linkMethod("getScreenCoords"),screen2GraphCoords:H_.linkMethod("getSceneCoords")}])),Jve=wp({props:V_(V_({nodeLabel:{default:"name",triggerUpdate:!1},linkLabel:{default:"name",triggerUpdate:!1},linkHoverPrecision:{default:1,onChange:function(r,e){return e.renderObjs.lineHoverPrecision(r)},triggerUpdate:!1},enableNavigationControls:{default:!0,onChange:function(r,e){var i=e.renderObjs.controls();i&&(i.enabled=r,r&&i.domElement&&i.domElement.dispatchEvent(new PointerEvent("pointerup")))},triggerUpdate:!1},enableNodeDrag:{default:!0,triggerUpdate:!1},onNodeDrag:{default:function(){},triggerUpdate:!1},onNodeDragEnd:{default:function(){},triggerUpdate:!1},onNodeClick:{triggerUpdate:!1},onNodeRightClick:{triggerUpdate:!1},onNodeHover:{triggerUpdate:!1},onLinkClick:{triggerUpdate:!1},onLinkRightClick:{triggerUpdate:!1},onLinkHover:{triggerUpdate:!1},onBackgroundClick:{triggerUpdate:!1},onBackgroundRightClick:{triggerUpdate:!1}},qve),Yve),methods:V_(V_({zoomToFit:function(r,e,i){for(var n,s=arguments.length,o=new Array(s>3?s-3:0),l=3;l<s;l++)o[l-3]=arguments[l];return r.renderObjs.fitToBbox((n=r.forceGraph).getGraphBbox.apply(n,o),e,i),this},pauseAnimation:function(r){return r.animationFrameRequestId!==null&&(cancelAnimationFrame(r.animationFrameRequestId),r.animationFrameRequestId=null),this},resumeAnimation:function(r){return r.animationFrameRequestId===null&&this._animationCycle(),this},_animationCycle:function(r){r.enablePointerInteraction&&(this.renderer().domElement.style.cursor=null),r.forceGraph.tickFrame(),r.renderObjs.tick(),r.animationFrameRequestId=requestAnimationFrame(this._animationCycle)},scene:function(r){return r.renderObjs.scene()},camera:function(r){return r.renderObjs.camera()},renderer:function(r){return r.renderObjs.renderer()},controls:function(r){return r.renderObjs.controls()},tbControls:function(r){return r.renderObjs.tbControls()},_destructor:function(){this.pauseAnimation(),this.graphData({nodes:[],links:[]})}},Xve),Kve),stateInit:function(r){var e=r.controlType,i=r.rendererConfig,n=r.extraRenderers,s=new UT;return{forceGraph:s,renderObjs:yz({controlType:e,rendererConfig:i,extraRenderers:n}).objects([s]).lights([new mI.AmbientLight(13421772,Math.PI),new mI.DirectionalLight(16777215,.6*Math.PI)])}},init:function(r,e){r.innerHTML="",r.appendChild(e.container=document.createElement("div")),e.container.style.position="relative";var i=document.createElement("div");e.container.appendChild(i),e.renderObjs(i);var n=e.renderObjs.camera(),s=e.renderObjs.renderer(),o=e.renderObjs.controls();o.enabled=!!e.enableNavigationControls,e.lastSetCameraZ=n.position.z;var l;e.container.appendChild(l=document.createElement("div")),l.className="graph-info-msg",l.textContent="",e.forceGraph.onLoading(function(){l.textContent="Loading..."}).onFinishLoading(function(){l.textContent=""}).onUpdate(function(){e.graphData=e.forceGraph.graphData(),n.position.x===0&&n.position.y===0&&n.position.z===e.lastSetCameraZ&&e.graphData.nodes.length&&(n.lookAt(e.forceGraph.position),e.lastSetCameraZ=n.position.z=Math.cbrt(e.graphData.nodes.length)*Qve)}).onFinishUpdate(function(){if(e._dragControls){var u=e.graphData.nodes.find(function(h){return h.__initialFixedPos&&!h.__disposeControlsAfterDrag});u?u.__disposeControlsAfterDrag=!0:e._dragControls.dispose(),e._dragControls=void 0}if(e.enableNodeDrag&&e.enablePointerInteraction&&e.forceEngine==="d3"){var c=e._dragControls=new Uce(e.graphData.nodes.map(function(h){return h.__threeObj}).filter(function(h){return h}),n,s.domElement);c.addEventListener("dragstart",function(h){o.enabled=!1,h.object.__initialPos=h.object.position.clone(),h.object.__prevPos=h.object.position.clone();var p=hh(h.object).__data;!p.__initialFixedPos&&(p.__initialFixedPos={fx:p.fx,fy:p.fy,fz:p.fz}),!p.__initialPos&&(p.__initialPos={x:p.x,y:p.y,z:p.z}),["x","y","z"].forEach(function(f){return p["f".concat(f)]=p[f]}),s.domElement.classList.add("grabbable")}),c.addEventListener("drag",function(h){var p=hh(h.object);if(!h.object.hasOwnProperty("__graphObjType")){var f=h.object.__initialPos,g=h.object.__prevPos,m=h.object.position;p.position.add(m.clone().sub(g)),g.copy(m),m.copy(f)}var y=p.__data,b=p.position,v={x:b.x-y.x,y:b.y-y.y,z:b.z-y.z};["x","y","z"].forEach(function(_){return y["f".concat(_)]=y[_]=b[_]}),e.forceGraph.d3AlphaTarget(.3).resetCountdown(),y.__dragged=!0,e.onNodeDrag(y,v)}),c.addEventListener("dragend",function(h){delete h.object.__initialPos,delete h.object.__prevPos;var p=hh(h.object).__data;p.__disposeControlsAfterDrag&&(c.dispose(),delete p.__disposeControlsAfterDrag);var f=p.__initialFixedPos,g=p.__initialPos,m={x:g.x-p.x,y:g.y-p.y,z:g.z-p.z};f&&(["x","y","z"].forEach(function(y){var b="f".concat(y);f[b]===void 0&&delete p[b]}),delete p.__initialFixedPos,delete p.__initialPos,p.__dragged&&(delete p.__dragged,e.onNodeDragEnd(p,m))),e.forceGraph.d3AlphaTarget(0).resetCountdown(),e.enableNavigationControls&&(o.enabled=!0,o.domElement&&o.domElement.ownerDocument&&o.domElement.ownerDocument.dispatchEvent(new PointerEvent("pointerup",{pointerType:"touch"}))),s.domElement.classList.remove("grabbable")})}}),mI.REVISION<155&&(e.renderObjs.renderer().useLegacyLights=!1),e.renderObjs.hoverOrderComparator(function(u,c){var h=hh(u);if(!h)return 1;var p=hh(c);if(!p)return-1;var f=function(g){return g.__graphObjType==="node"};return f(p)-f(h)}).tooltipContent(function(u){var c=hh(u);return c&&mr(e["".concat(c.__graphObjType,"Label")])(c.__data)||""}).hoverDuringDrag(!1).onHover(function(u){var c=hh(u);if(c!==e.hoverObj){var h=e.hoverObj?e.hoverObj.__graphObjType:null,p=e.hoverObj?e.hoverObj.__data:null,f=c?c.__graphObjType:null,g=c?c.__data:null;if(h&&h!==f){var m=e["on".concat(h==="node"?"Node":"Link","Hover")];m&&m(null,p)}if(f){var y=e["on".concat(f==="node"?"Node":"Link","Hover")];y&&y(g,h===f?p:null)}s.domElement.classList[c&&e["on".concat(f==="node"?"Node":"Link","Click")]||!c&&e.onBackgroundClick?"add":"remove"]("clickable"),e.hoverObj=c}}).clickAfterDrag(!1).onClick(function(u,c){var h=hh(u);if(h){var p=e["on".concat(h.__graphObjType==="node"?"Node":"Link","Click")];p&&p(h.__data,c)}else e.onBackgroundClick&&e.onBackgroundClick(c)}).onRightClick(function(u,c){var h=hh(u);if(h){var p=e["on".concat(h.__graphObjType==="node"?"Node":"Link","RightClick")];p&&p(h.__data,c)}else e.onBackgroundRightClick&&e.onBackgroundRightClick(c)}),this._animationCycle()}});function hh(r){for(var e=r;e&&!e.hasOwnProperty("__graphObjType");)e=e.parent;return e}var gI="http://www.w3.org/1999/xhtml";const _z={svg:"http://www.w3.org/2000/svg",xhtml:gI,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function W_(r){var e=r+="",i=e.indexOf(":");return i>=0&&(e=r.slice(0,i))!=="xmlns"&&(r=r.slice(i+1)),_z.hasOwnProperty(e)?{space:_z[e],local:r}:r}function Zve(r){return function(){var e=this.ownerDocument,i=this.namespaceURI;return i===gI&&e.documentElement.namespaceURI===gI?e.createElement(r):e.createElementNS(i,r)}}function $ve(r){return function(){return this.ownerDocument.createElementNS(r.space,r.local)}}function Ez(r){var e=W_(r);return(e.local?$ve:Zve)(e)}function ebe(){}function AI(r){return r==null?ebe:function(){return this.querySelector(r)}}function tbe(r){typeof r!="function"&&(r=AI(r));for(var e=this._groups,i=e.length,n=new Array(i),s=0;s<i;++s)for(var o=e[s],l=o.length,u=n[s]=new Array(l),c,h,p=0;p<l;++p)(c=o[p])&&(h=r.call(c,c.__data__,p,o))&&("__data__"in c&&(h.__data__=c.__data__),u[p]=h);return new bl(n,this._parents)}function ibe(r){return r==null?[]:Array.isArray(r)?r:Array.from(r)}function rbe(){return[]}function wz(r){return r==null?rbe:function(){return this.querySelectorAll(r)}}function nbe(r){return function(){return ibe(r.apply(this,arguments))}}function sbe(r){typeof r=="function"?r=nbe(r):r=wz(r);for(var e=this._groups,i=e.length,n=[],s=[],o=0;o<i;++o)for(var l=e[o],u=l.length,c,h=0;h<u;++h)(c=l[h])&&(n.push(r.call(c,c.__data__,h,l)),s.push(c));return new bl(n,s)}function Cz(r){return function(){return this.matches(r)}}function Sz(r){return function(e){return e.matches(r)}}var abe=Array.prototype.find;function obe(r){return function(){return abe.call(this.children,r)}}function lbe(){return this.firstElementChild}function cbe(r){return this.select(r==null?lbe:obe(typeof r=="function"?r:Sz(r)))}var ube=Array.prototype.filter;function hbe(){return Array.from(this.children)}function dbe(r){return function(){return ube.call(this.children,r)}}function pbe(r){return this.selectAll(r==null?hbe:dbe(typeof r=="function"?r:Sz(r)))}function fbe(r){typeof r!="function"&&(r=Cz(r));for(var e=this._groups,i=e.length,n=new Array(i),s=0;s<i;++s)for(var o=e[s],l=o.length,u=n[s]=[],c,h=0;h<l;++h)(c=o[h])&&r.call(c,c.__data__,h,o)&&u.push(c);return new bl(n,this._parents)}function Tz(r){return new Array(r.length)}function mbe(){return new bl(this._enter||this._groups.map(Tz),this._parents)}function Q_(r,e){this.ownerDocument=r.ownerDocument,this.namespaceURI=r.namespaceURI,this._next=null,this._parent=r,this.__data__=e}Q_.prototype={constructor:Q_,appendChild:function(r){return this._parent.insertBefore(r,this._next)},insertBefore:function(r,e){return this._parent.insertBefore(r,e)},querySelector:function(r){return this._parent.querySelector(r)},querySelectorAll:function(r){return this._parent.querySelectorAll(r)}};function gbe(r){return function(){return r}}function Abe(r,e,i,n,s,o){for(var l=0,u,c=e.length,h=o.length;l<h;++l)(u=e[l])?(u.__data__=o[l],n[l]=u):i[l]=new Q_(r,o[l]);for(;l<c;++l)(u=e[l])&&(s[l]=u)}function ybe(r,e,i,n,s,o,l){var u,c,h=new Map,p=e.length,f=o.length,g=new Array(p),m;for(u=0;u<p;++u)(c=e[u])&&(g[u]=m=l.call(c,c.__data__,u,e)+"",h.has(m)?s[u]=c:h.set(m,c));for(u=0;u<f;++u)m=l.call(r,o[u],u,o)+"",(c=h.get(m))?(n[u]=c,c.__data__=o[u],h.delete(m)):i[u]=new Q_(r,o[u]);for(u=0;u<p;++u)(c=e[u])&&h.get(g[u])===c&&(s[u]=c)}function vbe(r){return r.__data__}function bbe(r,e){if(!arguments.length)return Array.from(this,vbe);var i=e?ybe:Abe,n=this._parents,s=this._groups;typeof r!="function"&&(r=gbe(r));for(var o=s.length,l=new Array(o),u=new Array(o),c=new Array(o),h=0;h<o;++h){var p=n[h],f=s[h],g=f.length,m=xbe(r.call(p,p&&p.__data__,h,n)),y=m.length,b=u[h]=new Array(y),v=l[h]=new Array(y),_=c[h]=new Array(g);i(p,f,b,v,_,m,e);for(var T=0,E=0,C,R;T<y;++T)if(C=b[T]){for(T>=E&&(E=T+1);!(R=v[E])&&++E<y;);C._next=R||null}}return l=new bl(l,n),l._enter=u,l._exit=c,l}function xbe(r){return typeof r=="object"&&"length"in r?r:Array.from(r)}function _be(){return new bl(this._exit||this._groups.map(Tz),this._parents)}function Ebe(r,e,i){var n=this.enter(),s=this,o=this.exit();return typeof r=="function"?(n=r(n),n&&(n=n.selection())):n=n.append(r+""),e!=null&&(s=e(s),s&&(s=s.selection())),i==null?o.remove():i(o),n&&s?n.merge(s).order():s}function wbe(r){for(var e=r.selection?r.selection():r,i=this._groups,n=e._groups,s=i.length,o=n.length,l=Math.min(s,o),u=new Array(s),c=0;c<l;++c)for(var h=i[c],p=n[c],f=h.length,g=u[c]=new Array(f),m,y=0;y<f;++y)(m=h[y]||p[y])&&(g[y]=m);for(;c<s;++c)u[c]=i[c];return new bl(u,this._parents)}function Cbe(){for(var r=this._groups,e=-1,i=r.length;++e<i;)for(var n=r[e],s=n.length-1,o=n[s],l;--s>=0;)(l=n[s])&&(o&&l.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(l,o),o=l);return this}function Sbe(r){r||(r=Tbe);function e(f,g){return f&&g?r(f.__data__,g.__data__):!f-!g}for(var i=this._groups,n=i.length,s=new Array(n),o=0;o<n;++o){for(var l=i[o],u=l.length,c=s[o]=new Array(u),h,p=0;p<u;++p)(h=l[p])&&(c[p]=h);c.sort(e)}return new bl(s,this._parents).order()}function Tbe(r,e){return r<e?-1:r>e?1:r>=e?0:NaN}function Mbe(){var r=arguments[0];return arguments[0]=this,r.apply(null,arguments),this}function Rbe(){return Array.from(this)}function Ibe(){for(var r=this._groups,e=0,i=r.length;e<i;++e)for(var n=r[e],s=0,o=n.length;s<o;++s){var l=n[s];if(l)return l}return null}function Bbe(){let r=0;for(const e of this)++r;return r}function Lbe(){return!this.node()}function Dbe(r){for(var e=this._groups,i=0,n=e.length;i<n;++i)for(var s=e[i],o=0,l=s.length,u;o<l;++o)(u=s[o])&&r.call(u,u.__data__,o,s);return this}function Nbe(r){return function(){this.removeAttribute(r)}}function Pbe(r){return function(){this.removeAttributeNS(r.space,r.local)}}function Obe(r,e){return function(){this.setAttribute(r,e)}}function kbe(r,e){return function(){this.setAttributeNS(r.space,r.local,e)}}function Fbe(r,e){return function(){var i=e.apply(this,arguments);i==null?this.removeAttribute(r):this.setAttribute(r,i)}}function Ube(r,e){return function(){var i=e.apply(this,arguments);i==null?this.removeAttributeNS(r.space,r.local):this.setAttributeNS(r.space,r.local,i)}}function zbe(r,e){var i=W_(r);if(arguments.length<2){var n=this.node();return i.local?n.getAttributeNS(i.space,i.local):n.getAttribute(i)}return this.each((e==null?i.local?Pbe:Nbe:typeof e=="function"?i.local?Ube:Fbe:i.local?kbe:Obe)(i,e))}function Mz(r){return r.ownerDocument&&r.ownerDocument.defaultView||r.document&&r||r.defaultView}function jbe(r){return function(){this.style.removeProperty(r)}}function Vbe(r,e,i){return function(){this.style.setProperty(r,e,i)}}function Gbe(r,e,i){return function(){var n=e.apply(this,arguments);n==null?this.style.removeProperty(r):this.style.setProperty(r,n,i)}}function Hbe(r,e,i){return arguments.length>1?this.each((e==null?jbe:typeof e=="function"?Gbe:Vbe)(r,e,i??"")):Hg(this.node(),r)}function Hg(r,e){return r.style.getPropertyValue(e)||Mz(r).getComputedStyle(r,null).getPropertyValue(e)}function Wbe(r){return function(){delete this[r]}}function Qbe(r,e){return function(){this[r]=e}}function qbe(r,e){return function(){var i=e.apply(this,arguments);i==null?delete this[r]:this[r]=i}}function Xbe(r,e){return arguments.length>1?this.each((e==null?Wbe:typeof e=="function"?qbe:Qbe)(r,e)):this.node()[r]}function Rz(r){return r.trim().split(/^|\s+/)}function yI(r){return r.classList||new Iz(r)}function Iz(r){this._node=r,this._names=Rz(r.getAttribute("class")||"")}Iz.prototype={add:function(r){var e=this._names.indexOf(r);e<0&&(this._names.push(r),this._node.setAttribute("class",this._names.join(" ")))},remove:function(r){var e=this._names.indexOf(r);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(r){return this._names.indexOf(r)>=0}};function Bz(r,e){for(var i=yI(r),n=-1,s=e.length;++n<s;)i.add(e[n])}function Lz(r,e){for(var i=yI(r),n=-1,s=e.length;++n<s;)i.remove(e[n])}function Ybe(r){return function(){Bz(this,r)}}function Kbe(r){return function(){Lz(this,r)}}function Jbe(r,e){return function(){(e.apply(this,arguments)?Bz:Lz)(this,r)}}function Zbe(r,e){var i=Rz(r+"");if(arguments.length<2){for(var n=yI(this.node()),s=-1,o=i.length;++s<o;)if(!n.contains(i[s]))return!1;return!0}return this.each((typeof e=="function"?Jbe:e?Ybe:Kbe)(i,e))}function $be(){this.textContent=""}function exe(r){return function(){this.textContent=r}}function txe(r){return function(){var e=r.apply(this,arguments);this.textContent=e??""}}function ixe(r){return arguments.length?this.each(r==null?$be:(typeof r=="function"?txe:exe)(r)):this.node().textContent}function rxe(){this.innerHTML=""}function nxe(r){return function(){this.innerHTML=r}}function sxe(r){return function(){var e=r.apply(this,arguments);this.innerHTML=e??""}}function axe(r){return arguments.length?this.each(r==null?rxe:(typeof r=="function"?sxe:nxe)(r)):this.node().innerHTML}function oxe(){this.nextSibling&&this.parentNode.appendChild(this)}function lxe(){return this.each(oxe)}function cxe(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function uxe(){return this.each(cxe)}function hxe(r){var e=typeof r=="function"?r:Ez(r);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function dxe(){return null}function pxe(r,e){var i=typeof r=="function"?r:Ez(r),n=e==null?dxe:typeof e=="function"?e:AI(e);return this.select(function(){return this.insertBefore(i.apply(this,arguments),n.apply(this,arguments)||null)})}function fxe(){var r=this.parentNode;r&&r.removeChild(this)}function mxe(){return this.each(fxe)}function gxe(){var r=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(r,this.nextSibling):r}function Axe(){var r=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(r,this.nextSibling):r}function yxe(r){return this.select(r?Axe:gxe)}function vxe(r){return arguments.length?this.property("__data__",r):this.node().__data__}function bxe(r){return function(e){r.call(this,e,this.__data__)}}function xxe(r){return r.trim().split(/^|\s+/).map(function(e){var i="",n=e.indexOf(".");return n>=0&&(i=e.slice(n+1),e=e.slice(0,n)),{type:e,name:i}})}function _xe(r){return function(){var e=this.__on;if(e){for(var i=0,n=-1,s=e.length,o;i<s;++i)o=e[i],(!r.type||o.type===r.type)&&o.name===r.name?this.removeEventListener(o.type,o.listener,o.options):e[++n]=o;++n?e.length=n:delete this.__on}}}function Exe(r,e,i){return function(){var n=this.__on,s,o=bxe(e);if(n){for(var l=0,u=n.length;l<u;++l)if((s=n[l]).type===r.type&&s.name===r.name){this.removeEventListener(s.type,s.listener,s.options),this.addEventListener(s.type,s.listener=o,s.options=i),s.value=e;return}}this.addEventListener(r.type,o,i),s={type:r.type,name:r.name,value:e,listener:o,options:i},n?n.push(s):this.__on=[s]}}function wxe(r,e,i){var n=xxe(r+""),s,o=n.length,l;if(arguments.length<2){var u=this.node().__on;if(u){for(var c=0,h=u.length,p;c<h;++c)for(s=0,p=u[c];s<o;++s)if((l=n[s]).type===p.type&&l.name===p.name)return p.value}return}for(u=e?Exe:_xe,s=0;s<o;++s)this.each(u(n[s],e,i));return this}function Dz(r,e,i){var n=Mz(r),s=n.CustomEvent;typeof s=="function"?s=new s(e,i):(s=n.document.createEvent("Event"),i?(s.initEvent(e,i.bubbles,i.cancelable),s.detail=i.detail):s.initEvent(e,!1,!1)),r.dispatchEvent(s)}function Cxe(r,e){return function(){return Dz(this,r,e)}}function Sxe(r,e){return function(){return Dz(this,r,e.apply(this,arguments))}}function Txe(r,e){return this.each((typeof e=="function"?Sxe:Cxe)(r,e))}function*Mxe(){for(var r=this._groups,e=0,i=r.length;e<i;++e)for(var n=r[e],s=0,o=n.length,l;s<o;++s)(l=n[s])&&(yield l)}var Nz=[null];function bl(r,e){this._groups=r,this._parents=e}function Gy(){return new bl([[document.documentElement]],Nz)}function Rxe(){return this}bl.prototype=Gy.prototype={constructor:bl,select:tbe,selectAll:sbe,selectChild:cbe,selectChildren:pbe,filter:fbe,data:bbe,enter:mbe,exit:_be,join:Ebe,merge:wbe,selection:Rxe,order:Cbe,sort:Sbe,call:Mbe,nodes:Rbe,node:Ibe,size:Bbe,empty:Lbe,each:Dbe,attr:zbe,style:Hbe,property:Xbe,classed:Zbe,text:ixe,html:axe,raise:lxe,lower:uxe,append:hxe,insert:pxe,remove:mxe,clone:yxe,datum:vxe,on:wxe,dispatch:Txe,[Symbol.iterator]:Mxe};function Sc(r){return typeof r=="string"?new bl([[document.querySelector(r)]],[document.documentElement]):new bl([[r]],Nz)}function Ixe(r){let e;for(;e=r.sourceEvent;)r=e;return r}function dh(r,e){if(r=Ixe(r),e===void 0&&(e=r.currentTarget),e){var i=e.ownerSVGElement||e;if(i.createSVGPoint){var n=i.createSVGPoint();return n.x=r.clientX,n.y=r.clientY,n=n.matrixTransform(e.getScreenCTM().inverse()),[n.x,n.y]}if(e.getBoundingClientRect){var s=e.getBoundingClientRect();return[r.clientX-s.left-e.clientLeft,r.clientY-s.top-e.clientTop]}}return[r.pageX,r.pageY]}const Bxe={passive:!1},Hy={capture:!0,passive:!1};function vI(r){r.stopImmediatePropagation()}function Wg(r){r.preventDefault(),r.stopImmediatePropagation()}function Pz(r){var e=r.document.documentElement,i=Sc(r).on("dragstart.drag",Wg,Hy);"onselectstart"in e?i.on("selectstart.drag",Wg,Hy):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function Oz(r,e){var i=r.document.documentElement,n=Sc(r).on("dragstart.drag",null);e&&(n.on("click.drag",Wg,Hy),setTimeout(function(){n.on("click.drag",null)},0)),"onselectstart"in i?n.on("selectstart.drag",null):(i.style.MozUserSelect=i.__noselect,delete i.__noselect)}const q_=r=>()=>r;function bI(r,{sourceEvent:e,subject:i,target:n,identifier:s,active:o,x:l,y:u,dx:c,dy:h,dispatch:p}){Object.defineProperties(this,{type:{value:r,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:i,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},identifier:{value:s,enumerable:!0,configurable:!0},active:{value:o,enumerable:!0,configurable:!0},x:{value:l,enumerable:!0,configurable:!0},y:{value:u,enumerable:!0,configurable:!0},dx:{value:c,enumerable:!0,configurable:!0},dy:{value:h,enumerable:!0,configurable:!0},_:{value:p}})}bI.prototype.on=function(){var r=this._.on.apply(this._,arguments);return r===this._?this:r};function Lxe(r){return!r.ctrlKey&&!r.button}function Dxe(){return this.parentNode}function Nxe(r,e){return e??{x:r.x,y:r.y}}function Pxe(){return navigator.maxTouchPoints||"ontouchstart"in this}function Oxe(){var r=Lxe,e=Dxe,i=Nxe,n=Pxe,s={},o=RA("start","drag","end"),l=0,u,c,h,p,f=0;function g(C){C.on("mousedown.drag",m).filter(n).on("touchstart.drag",v).on("touchmove.drag",_,Bxe).on("touchend.drag touchcancel.drag",T).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function m(C,R){if(!(p||!r.call(this,C,R))){var B=E(this,e.call(this,C,R),C,R,"mouse");B&&(Sc(C.view).on("mousemove.drag",y,Hy).on("mouseup.drag",b,Hy),Pz(C.view),vI(C),h=!1,u=C.clientX,c=C.clientY,B("start",C))}}function y(C){if(Wg(C),!h){var R=C.clientX-u,B=C.clientY-c;h=R*R+B*B>f}s.mouse("drag",C)}function b(C){Sc(C.view).on("mousemove.drag mouseup.drag",null),Oz(C.view,h),Wg(C),s.mouse("end",C)}function v(C,R){if(r.call(this,C,R)){var B=C.changedTouches,I=e.call(this,C,R),N=B.length,D,P;for(D=0;D<N;++D)(P=E(this,I,C,R,B[D].identifier,B[D]))&&(vI(C),P("start",C,B[D]))}}function _(C){var R=C.changedTouches,B=R.length,I,N;for(I=0;I<B;++I)(N=s[R[I].identifier])&&(Wg(C),N("drag",C,R[I]))}function T(C){var R=C.changedTouches,B=R.length,I,N;for(p&&clearTimeout(p),p=setTimeout(function(){p=null},500),I=0;I<B;++I)(N=s[R[I].identifier])&&(vI(C),N("end",C,R[I]))}function E(C,R,B,I,N,D){var P=o.copy(),k=dh(D||B,R),q,V,j;if((j=i.call(C,new bI("beforestart",{sourceEvent:B,target:g,identifier:N,active:l,x:k[0],y:k[1],dx:0,dy:0,dispatch:P}),I))!=null)return q=j.x-k[0]||0,V=j.y-k[1]||0,function Q(W,G,z){var te=k,Y;switch(W){case"start":s[N]=Q,Y=l++;break;case"end":delete s[N],--l;case"drag":k=dh(z||G,R),Y=l;break}P.call(W,C,new bI(W,{sourceEvent:G,subject:j,target:g,identifier:N,active:Y,x:k[0]+q,y:k[1]+V,dx:k[0]-te[0],dy:k[1]-te[1],dispatch:P}),I)}}return g.filter=function(C){return arguments.length?(r=typeof C=="function"?C:q_(!!C),g):r},g.container=function(C){return arguments.length?(e=typeof C=="function"?C:q_(C),g):e},g.subject=function(C){return arguments.length?(i=typeof C=="function"?C:q_(C),g):i},g.touchable=function(C){return arguments.length?(n=typeof C=="function"?C:q_(!!C),g):n},g.on=function(){var C=o.on.apply(o,arguments);return C===o?g:C},g.clickDistance=function(C){return arguments.length?(f=(C=+C)*C,g):Math.sqrt(f)},g}var kxe=RA("start","end","cancel","interrupt"),Fxe=[],kz=0,Fz=1,xI=2,X_=3,Uz=4,_I=5,Y_=6;function K_(r,e,i,n,s,o){var l=r.__transition;if(!l)r.__transition={};else if(i in l)return;Uxe(r,i,{name:e,index:n,group:s,on:kxe,tween:Fxe,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:kz})}function EI(r,e){var i=Tc(r,e);if(i.state>kz)throw new Error("too late; already scheduled");return i}function $c(r,e){var i=Tc(r,e);if(i.state>X_)throw new Error("too late; already running");return i}function Tc(r,e){var i=r.__transition;if(!i||!(i=i[e]))throw new Error("transition not found");return i}function Uxe(r,e,i){var n=r.__transition,s;n[e]=i,i.timer=aT(o,0,i.time);function o(h){i.state=Fz,i.timer.restart(l,i.delay,i.time),i.delay<=h&&l(h-i.delay)}function l(h){var p,f,g,m;if(i.state!==Fz)return c();for(p in n)if(m=n[p],m.name===i.name){if(m.state===X_)return Z4(l);m.state===Uz?(m.state=Y_,m.timer.stop(),m.on.call("interrupt",r,r.__data__,m.index,m.group),delete n[p]):+p<e&&(m.state=Y_,m.timer.stop(),m.on.call("cancel",r,r.__data__,m.index,m.group),delete n[p])}if(Z4(function(){i.state===X_&&(i.state=Uz,i.timer.restart(u,i.delay,i.time),u(h))}),i.state=xI,i.on.call("start",r,r.__data__,i.index,i.group),i.state===xI){for(i.state=X_,s=new Array(g=i.tween.length),p=0,f=-1;p<g;++p)(m=i.tween[p].value.call(r,r.__data__,i.index,i.group))&&(s[++f]=m);s.length=f+1}}function u(h){for(var p=h<i.duration?i.ease.call(null,h/i.duration):(i.timer.restart(c),i.state=_I,1),f=-1,g=s.length;++f<g;)s[f].call(r,p);i.state===_I&&(i.on.call("end",r,r.__data__,i.index,i.group),c())}function c(){i.state=Y_,i.timer.stop(),delete n[e];for(var h in n)return;delete r.__transition}}function J_(r,e){var i=r.__transition,n,s,o=!0,l;if(i){e=e==null?null:e+"";for(l in i){if((n=i[l]).name!==e){o=!1;continue}s=n.state>xI&&n.state<_I,n.state=Y_,n.timer.stop(),n.on.call(s?"interrupt":"cancel",r,r.__data__,n.index,n.group),delete i[l]}o&&delete r.__transition}}function zxe(r){return this.each(function(){J_(this,r)})}function jxe(r,e){var i,n;return function(){var s=$c(this,r),o=s.tween;if(o!==i){n=i=o;for(var l=0,u=n.length;l<u;++l)if(n[l].name===e){n=n.slice(),n.splice(l,1);break}}s.tween=n}}function Vxe(r,e,i){var n,s;if(typeof i!="function")throw new Error;return function(){var o=$c(this,r),l=o.tween;if(l!==n){s=(n=l).slice();for(var u={name:e,value:i},c=0,h=s.length;c<h;++c)if(s[c].name===e){s[c]=u;break}c===h&&s.push(u)}o.tween=s}}function Gxe(r,e){var i=this._id;if(r+="",arguments.length<2){for(var n=Tc(this.node(),i).tween,s=0,o=n.length,l;s<o;++s)if((l=n[s]).name===r)return l.value;return null}return this.each((e==null?jxe:Vxe)(i,r,e))}function wI(r,e,i){var n=r._id;return r.each(function(){var s=$c(this,n);(s.value||(s.value={}))[e]=i.apply(this,arguments)}),function(s){return Tc(s,n).value[e]}}function zz(r,e){var i;return(typeof e=="number"?id:e instanceof zA?e5:(i=zA(e))?(e=i,e5):Use)(r,e)}function Hxe(r){return function(){this.removeAttribute(r)}}function Wxe(r){return function(){this.removeAttributeNS(r.space,r.local)}}function Qxe(r,e,i){var n,s=i+"",o;return function(){var l=this.getAttribute(r);return l===s?null:l===n?o:o=e(n=l,i)}}function qxe(r,e,i){var n,s=i+"",o;return function(){var l=this.getAttributeNS(r.space,r.local);return l===s?null:l===n?o:o=e(n=l,i)}}function Xxe(r,e,i){var n,s,o;return function(){var l,u=i(this),c;return u==null?void this.removeAttribute(r):(l=this.getAttribute(r),c=u+"",l===c?null:l===n&&c===s?o:(s=c,o=e(n=l,u)))}}function Yxe(r,e,i){var n,s,o;return function(){var l,u=i(this),c;return u==null?void this.removeAttributeNS(r.space,r.local):(l=this.getAttributeNS(r.space,r.local),c=u+"",l===c?null:l===n&&c===s?o:(s=c,o=e(n=l,u)))}}function Kxe(r,e){var i=W_(r),n=i==="transform"?Gse:zz;return this.attrTween(r,typeof e=="function"?(i.local?Yxe:Xxe)(i,n,wI(this,"attr."+r,e)):e==null?(i.local?Wxe:Hxe)(i):(i.local?qxe:Qxe)(i,n,e))}function Jxe(r,e){return function(i){this.setAttribute(r,e.call(this,i))}}function Zxe(r,e){return function(i){this.setAttributeNS(r.space,r.local,e.call(this,i))}}function $xe(r,e){var i,n;function s(){var o=e.apply(this,arguments);return o!==n&&(i=(n=o)&&Zxe(r,o)),i}return s._value=e,s}function e1e(r,e){var i,n;function s(){var o=e.apply(this,arguments);return o!==n&&(i=(n=o)&&Jxe(r,o)),i}return s._value=e,s}function t1e(r,e){var i="attr."+r;if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;var n=W_(r);return this.tween(i,(n.local?$xe:e1e)(n,e))}function i1e(r,e){return function(){EI(this,r).delay=+e.apply(this,arguments)}}function r1e(r,e){return e=+e,function(){EI(this,r).delay=e}}function n1e(r){var e=this._id;return arguments.length?this.each((typeof r=="function"?i1e:r1e)(e,r)):Tc(this.node(),e).delay}function s1e(r,e){return function(){$c(this,r).duration=+e.apply(this,arguments)}}function a1e(r,e){return e=+e,function(){$c(this,r).duration=e}}function o1e(r){var e=this._id;return arguments.length?this.each((typeof r=="function"?s1e:a1e)(e,r)):Tc(this.node(),e).duration}function l1e(r,e){if(typeof e!="function")throw new Error;return function(){$c(this,r).ease=e}}function c1e(r){var e=this._id;return arguments.length?this.each(l1e(e,r)):Tc(this.node(),e).ease}function u1e(r,e){return function(){var i=e.apply(this,arguments);if(typeof i!="function")throw new Error;$c(this,r).ease=i}}function h1e(r){if(typeof r!="function")throw new Error;return this.each(u1e(this._id,r))}function d1e(r){typeof r!="function"&&(r=Cz(r));for(var e=this._groups,i=e.length,n=new Array(i),s=0;s<i;++s)for(var o=e[s],l=o.length,u=n[s]=[],c,h=0;h<l;++h)(c=o[h])&&r.call(c,c.__data__,h,o)&&u.push(c);return new ph(n,this._parents,this._name,this._id)}function p1e(r){if(r._id!==this._id)throw new Error;for(var e=this._groups,i=r._groups,n=e.length,s=i.length,o=Math.min(n,s),l=new Array(n),u=0;u<o;++u)for(var c=e[u],h=i[u],p=c.length,f=l[u]=new Array(p),g,m=0;m<p;++m)(g=c[m]||h[m])&&(f[m]=g);for(;u<n;++u)l[u]=e[u];return new ph(l,this._parents,this._name,this._id)}function f1e(r){return(r+"").trim().split(/^|\s+/).every(function(e){var i=e.indexOf(".");return i>=0&&(e=e.slice(0,i)),!e||e==="start"})}function m1e(r,e,i){var n,s,o=f1e(e)?EI:$c;return function(){var l=o(this,r),u=l.on;u!==n&&(s=(n=u).copy()).on(e,i),l.on=s}}function g1e(r,e){var i=this._id;return arguments.length<2?Tc(this.node(),i).on.on(r):this.each(m1e(i,r,e))}function A1e(r){return function(){var e=this.parentNode;for(var i in this.__transition)if(+i!==r)return;e&&e.removeChild(this)}}function y1e(){return this.on("end.remove",A1e(this._id))}function v1e(r){var e=this._name,i=this._id;typeof r!="function"&&(r=AI(r));for(var n=this._groups,s=n.length,o=new Array(s),l=0;l<s;++l)for(var u=n[l],c=u.length,h=o[l]=new Array(c),p,f,g=0;g<c;++g)(p=u[g])&&(f=r.call(p,p.__data__,g,u))&&("__data__"in p&&(f.__data__=p.__data__),h[g]=f,K_(h[g],e,i,g,h,Tc(p,i)));return new ph(o,this._parents,e,i)}function b1e(r){var e=this._name,i=this._id;typeof r!="function"&&(r=wz(r));for(var n=this._groups,s=n.length,o=[],l=[],u=0;u<s;++u)for(var c=n[u],h=c.length,p,f=0;f<h;++f)if(p=c[f]){for(var g=r.call(p,p.__data__,f,c),m,y=Tc(p,i),b=0,v=g.length;b<v;++b)(m=g[b])&&K_(m,e,i,b,g,y);o.push(g),l.push(p)}return new ph(o,l,e,i)}var x1e=Gy.prototype.constructor;function _1e(){return new x1e(this._groups,this._parents)}function E1e(r,e){var i,n,s;return function(){var o=Hg(this,r),l=(this.style.removeProperty(r),Hg(this,r));return o===l?null:o===i&&l===n?s:s=e(i=o,n=l)}}function jz(r){return function(){this.style.removeProperty(r)}}function w1e(r,e,i){var n,s=i+"",o;return function(){var l=Hg(this,r);return l===s?null:l===n?o:o=e(n=l,i)}}function C1e(r,e,i){var n,s,o;return function(){var l=Hg(this,r),u=i(this),c=u+"";return u==null&&(c=u=(this.style.removeProperty(r),Hg(this,r))),l===c?null:l===n&&c===s?o:(s=c,o=e(n=l,u))}}function S1e(r,e){var i,n,s,o="style."+e,l="end."+o,u;return function(){var c=$c(this,r),h=c.on,p=c.value[o]==null?u||(u=jz(e)):void 0;(h!==i||s!==p)&&(n=(i=h).copy()).on(l,s=p),c.on=n}}function T1e(r,e,i){var n=(r+="")=="transform"?Vse:zz;return e==null?this.styleTween(r,E1e(r,n)).on("end.style."+r,jz(r)):typeof e=="function"?this.styleTween(r,C1e(r,n,wI(this,"style."+r,e))).each(S1e(this._id,r)):this.styleTween(r,w1e(r,n,e),i).on("end.style."+r,null)}function M1e(r,e,i){return function(n){this.style.setProperty(r,e.call(this,n),i)}}function R1e(r,e,i){var n,s;function o(){var l=e.apply(this,arguments);return l!==s&&(n=(s=l)&&M1e(r,l,i)),n}return o._value=e,o}function I1e(r,e,i){var n="style."+(r+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;return this.tween(n,R1e(r,e,i??""))}function B1e(r){return function(){this.textContent=r}}function L1e(r){return function(){var e=r(this);this.textContent=e??""}}function D1e(r){return this.tween("text",typeof r=="function"?L1e(wI(this,"text",r)):B1e(r==null?"":r+""))}function N1e(r){return function(e){this.textContent=r.call(this,e)}}function P1e(r){var e,i;function n(){var s=r.apply(this,arguments);return s!==i&&(e=(i=s)&&N1e(s)),e}return n._value=r,n}function O1e(r){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(r==null)return this.tween(e,null);if(typeof r!="function")throw new Error;return this.tween(e,P1e(r))}function k1e(){for(var r=this._name,e=this._id,i=Vz(),n=this._groups,s=n.length,o=0;o<s;++o)for(var l=n[o],u=l.length,c,h=0;h<u;++h)if(c=l[h]){var p=Tc(c,e);K_(c,r,i,h,l,{time:p.time+p.delay+p.duration,delay:0,duration:p.duration,ease:p.ease})}return new ph(n,this._parents,r,i)}function F1e(){var r,e,i=this,n=i._id,s=i.size();return new Promise(function(o,l){var u={value:l},c={value:function(){--s===0&&o()}};i.each(function(){var h=$c(this,n),p=h.on;p!==r&&(e=(r=p).copy(),e._.cancel.push(u),e._.interrupt.push(u),e._.end.push(c)),h.on=e}),s===0&&o()})}var U1e=0;function ph(r,e,i,n){this._groups=r,this._parents=e,this._name=i,this._id=n}function Vz(){return++U1e}var fh=Gy.prototype;ph.prototype={constructor:ph,select:v1e,selectAll:b1e,selectChild:fh.selectChild,selectChildren:fh.selectChildren,filter:d1e,merge:p1e,selection:_1e,transition:k1e,call:fh.call,nodes:fh.nodes,node:fh.node,size:fh.size,empty:fh.empty,each:fh.each,on:g1e,attr:Kxe,attrTween:t1e,style:T1e,styleTween:I1e,text:D1e,textTween:O1e,remove:y1e,tween:Gxe,delay:n1e,duration:o1e,ease:c1e,easeVarying:h1e,end:F1e,[Symbol.iterator]:fh[Symbol.iterator]};function z1e(r){return((r*=2)<=1?r*r*r:(r-=2)*r*r+2)/2}var j1e={time:null,delay:0,duration:250,ease:z1e};function V1e(r,e){for(var i;!(i=r.__transition)||!(i=i[e]);)if(!(r=r.parentNode))throw new Error(`transition ${e} not found`);return i}function G1e(r){var e,i;r instanceof ph?(e=r._id,r=r._name):(e=Vz(),(i=j1e).time=sT(),r=r==null?null:r+"");for(var n=this._groups,s=n.length,o=0;o<s;++o)for(var l=n[o],u=l.length,c,h=0;h<u;++h)(c=l[h])&&K_(c,r,e,h,l,i||V1e(c,e));return new ph(n,this._parents,r,e)}Gy.prototype.interrupt=zxe,Gy.prototype.transition=G1e;const Z_=r=>()=>r;function H1e(r,{sourceEvent:e,target:i,transform:n,dispatch:s}){Object.defineProperties(this,{type:{value:r,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},transform:{value:n,enumerable:!0,configurable:!0},_:{value:s}})}function mh(r,e,i){this.k=r,this.x=e,this.y=i}mh.prototype={constructor:mh,scale:function(r){return r===1?this:new mh(this.k*r,this.x,this.y)},translate:function(r,e){return r===0&e===0?this:new mh(this.k,this.x+this.k*r,this.y+this.k*e)},apply:function(r){return[r[0]*this.k+this.x,r[1]*this.k+this.y]},applyX:function(r){return r*this.k+this.x},applyY:function(r){return r*this.k+this.y},invert:function(r){return[(r[0]-this.x)/this.k,(r[1]-this.y)/this.k]},invertX:function(r){return(r-this.x)/this.k},invertY:function(r){return(r-this.y)/this.k},rescaleX:function(r){return r.copy().domain(r.range().map(this.invertX,this).map(r.invert,r))},rescaleY:function(r){return r.copy().domain(r.range().map(this.invertY,this).map(r.invert,r))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var CI=new mh(1,0,0);eu.prototype=mh.prototype;function eu(r){for(;!r.__zoom;)if(!(r=r.parentNode))return CI;return r.__zoom}function SI(r){r.stopImmediatePropagation()}function Wy(r){r.preventDefault(),r.stopImmediatePropagation()}function W1e(r){return(!r.ctrlKey||r.type==="wheel")&&!r.button}function Q1e(){var r=this;return r instanceof SVGElement?(r=r.ownerSVGElement||r,r.hasAttribute("viewBox")?(r=r.viewBox.baseVal,[[r.x,r.y],[r.x+r.width,r.y+r.height]]):[[0,0],[r.width.baseVal.value,r.height.baseVal.value]]):[[0,0],[r.clientWidth,r.clientHeight]]}function Gz(){return this.__zoom||CI}function q1e(r){return-r.deltaY*(r.deltaMode===1?.05:r.deltaMode?1:.002)*(r.ctrlKey?10:1)}function X1e(){return navigator.maxTouchPoints||"ontouchstart"in this}function Y1e(r,e,i){var n=r.invertX(e[0][0])-i[0][0],s=r.invertX(e[1][0])-i[1][0],o=r.invertY(e[0][1])-i[0][1],l=r.invertY(e[1][1])-i[1][1];return r.translate(s>n?(n+s)/2:Math.min(0,n)||Math.max(0,s),l>o?(o+l)/2:Math.min(0,o)||Math.max(0,l))}function K1e(){var r=W1e,e=Q1e,i=Y1e,n=q1e,s=X1e,o=[0,1/0],l=[[-1/0,-1/0],[1/0,1/0]],u=250,c=qse,h=RA("start","zoom","end"),p,f,g,m=500,y=150,b=0,v=10;function _(j){j.property("__zoom",Gz).on("wheel.zoom",N,{passive:!1}).on("mousedown.zoom",D).on("dblclick.zoom",P).filter(s).on("touchstart.zoom",k).on("touchmove.zoom",q).on("touchend.zoom touchcancel.zoom",V).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}_.transform=function(j,Q,W,G){var z=j.selection?j.selection():j;z.property("__zoom",Gz),j!==z?R(j,Q,W,G):z.interrupt().each(function(){B(this,arguments).event(G).start().zoom(null,typeof Q=="function"?Q.apply(this,arguments):Q).end()})},_.scaleBy=function(j,Q,W,G){_.scaleTo(j,function(){var z=this.__zoom.k,te=typeof Q=="function"?Q.apply(this,arguments):Q;return z*te},W,G)},_.scaleTo=function(j,Q,W,G){_.transform(j,function(){var z=e.apply(this,arguments),te=this.__zoom,Y=W==null?C(z):typeof W=="function"?W.apply(this,arguments):W,se=te.invert(Y),ve=typeof Q=="function"?Q.apply(this,arguments):Q;return i(E(T(te,ve),Y,se),z,l)},W,G)},_.translateBy=function(j,Q,W,G){_.transform(j,function(){return i(this.__zoom.translate(typeof Q=="function"?Q.apply(this,arguments):Q,typeof W=="function"?W.apply(this,arguments):W),e.apply(this,arguments),l)},null,G)},_.translateTo=function(j,Q,W,G,z){_.transform(j,function(){var te=e.apply(this,arguments),Y=this.__zoom,se=G==null?C(te):typeof G=="function"?G.apply(this,arguments):G;return i(CI.translate(se[0],se[1]).scale(Y.k).translate(typeof Q=="function"?-Q.apply(this,arguments):-Q,typeof W=="function"?-W.apply(this,arguments):-W),te,l)},G,z)};function T(j,Q){return Q=Math.max(o[0],Math.min(o[1],Q)),Q===j.k?j:new mh(Q,j.x,j.y)}function E(j,Q,W){var G=Q[0]-W[0]*j.k,z=Q[1]-W[1]*j.k;return G===j.x&&z===j.y?j:new mh(j.k,G,z)}function C(j){return[(+j[0][0]+ +j[1][0])/2,(+j[0][1]+ +j[1][1])/2]}function R(j,Q,W,G){j.on("start.zoom",function(){B(this,arguments).event(G).start()}).on("interrupt.zoom end.zoom",function(){B(this,arguments).event(G).end()}).tween("zoom",function(){var z=this,te=arguments,Y=B(z,te).event(G),se=e.apply(z,te),ve=W==null?C(se):typeof W=="function"?W.apply(z,te):W,Ae=Math.max(se[1][0]-se[0][0],se[1][1]-se[0][1]),me=z.__zoom,Oe=typeof Q=="function"?Q.apply(z,te):Q,Xe=c(me.invert(ve).concat(Ae/me.k),Oe.invert(ve).concat(Ae/Oe.k));return function(Je){if(Je===1)Je=Oe;else{var it=Xe(Je),dt=Ae/it[2];Je=new mh(dt,ve[0]-it[0]*dt,ve[1]-it[1]*dt)}Y.zoom(null,Je)}})}function B(j,Q,W){return!W&&j.__zooming||new I(j,Q)}function I(j,Q){this.that=j,this.args=Q,this.active=0,this.sourceEvent=null,this.extent=e.apply(j,Q),this.taps=0}I.prototype={event:function(j){return j&&(this.sourceEvent=j),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(j,Q){return this.mouse&&j!=="mouse"&&(this.mouse[1]=Q.invert(this.mouse[0])),this.touch0&&j!=="touch"&&(this.touch0[1]=Q.invert(this.touch0[0])),this.touch1&&j!=="touch"&&(this.touch1[1]=Q.invert(this.touch1[0])),this.that.__zoom=Q,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(j){var Q=Sc(this.that).datum();h.call(j,this.that,new H1e(j,{sourceEvent:this.sourceEvent,target:_,transform:this.that.__zoom,dispatch:h}),Q)}};function N(j,...Q){if(!r.apply(this,arguments))return;var W=B(this,Q).event(j),G=this.__zoom,z=Math.max(o[0],Math.min(o[1],G.k*Math.pow(2,n.apply(this,arguments)))),te=dh(j);if(W.wheel)(W.mouse[0][0]!==te[0]||W.mouse[0][1]!==te[1])&&(W.mouse[1]=G.invert(W.mouse[0]=te)),clearTimeout(W.wheel);else{if(G.k===z)return;W.mouse=[te,G.invert(te)],J_(this),W.start()}Wy(j),W.wheel=setTimeout(Y,y),W.zoom("mouse",i(E(T(G,z),W.mouse[0],W.mouse[1]),W.extent,l));function Y(){W.wheel=null,W.end()}}function D(j,...Q){if(g||!r.apply(this,arguments))return;var W=j.currentTarget,G=B(this,Q,!0).event(j),z=Sc(j.view).on("mousemove.zoom",ve,!0).on("mouseup.zoom",Ae,!0),te=dh(j,W),Y=j.clientX,se=j.clientY;Pz(j.view),SI(j),G.mouse=[te,this.__zoom.invert(te)],J_(this),G.start();function ve(me){if(Wy(me),!G.moved){var Oe=me.clientX-Y,Xe=me.clientY-se;G.moved=Oe*Oe+Xe*Xe>b}G.event(me).zoom("mouse",i(E(G.that.__zoom,G.mouse[0]=dh(me,W),G.mouse[1]),G.extent,l))}function Ae(me){z.on("mousemove.zoom mouseup.zoom",null),Oz(me.view,G.moved),Wy(me),G.event(me).end()}}function P(j,...Q){if(r.apply(this,arguments)){var W=this.__zoom,G=dh(j.changedTouches?j.changedTouches[0]:j,this),z=W.invert(G),te=W.k*(j.shiftKey?.5:2),Y=i(E(T(W,te),G,z),e.apply(this,Q),l);Wy(j),u>0?Sc(this).transition().duration(u).call(R,Y,G,j):Sc(this).call(_.transform,Y,G,j)}}function k(j,...Q){if(r.apply(this,arguments)){var W=j.touches,G=W.length,z=B(this,Q,j.changedTouches.length===G).event(j),te,Y,se,ve;for(SI(j),Y=0;Y<G;++Y)se=W[Y],ve=dh(se,this),ve=[ve,this.__zoom.invert(ve),se.identifier],z.touch0?!z.touch1&&z.touch0[2]!==ve[2]&&(z.touch1=ve,z.taps=0):(z.touch0=ve,te=!0,z.taps=1+!!p);p&&(p=clearTimeout(p)),te&&(z.taps<2&&(f=ve[0],p=setTimeout(function(){p=null},m)),J_(this),z.start())}}function q(j,...Q){if(this.__zooming){var W=B(this,Q).event(j),G=j.changedTouches,z=G.length,te,Y,se,ve;for(Wy(j),te=0;te<z;++te)Y=G[te],se=dh(Y,this),W.touch0&&W.touch0[2]===Y.identifier?W.touch0[0]=se:W.touch1&&W.touch1[2]===Y.identifier&&(W.touch1[0]=se);if(Y=W.that.__zoom,W.touch1){var Ae=W.touch0[0],me=W.touch0[1],Oe=W.touch1[0],Xe=W.touch1[1],Je=(Je=Oe[0]-Ae[0])*Je+(Je=Oe[1]-Ae[1])*Je,it=(it=Xe[0]-me[0])*it+(it=Xe[1]-me[1])*it;Y=T(Y,Math.sqrt(Je/it)),se=[(Ae[0]+Oe[0])/2,(Ae[1]+Oe[1])/2],ve=[(me[0]+Xe[0])/2,(me[1]+Xe[1])/2]}else if(W.touch0)se=W.touch0[0],ve=W.touch0[1];else return;W.zoom("touch",i(E(Y,se,ve),W.extent,l))}}function V(j,...Q){if(this.__zooming){var W=B(this,Q).event(j),G=j.changedTouches,z=G.length,te,Y;for(SI(j),g&&clearTimeout(g),g=setTimeout(function(){g=null},m),te=0;te<z;++te)Y=G[te],W.touch0&&W.touch0[2]===Y.identifier?delete W.touch0:W.touch1&&W.touch1[2]===Y.identifier&&delete W.touch1;if(W.touch1&&!W.touch0&&(W.touch0=W.touch1,delete W.touch1),W.touch0)W.touch0[1]=this.__zoom.invert(W.touch0[0]);else if(W.end(),W.taps===2&&(Y=dh(Y,this),Math.hypot(f[0]-Y[0],f[1]-Y[1])<v)){var se=Sc(this).on("dblclick.zoom");se&&se.apply(this,arguments)}}}return _.wheelDelta=function(j){return arguments.length?(n=typeof j=="function"?j:Z_(+j),_):n},_.filter=function(j){return arguments.length?(r=typeof j=="function"?j:Z_(!!j),_):r},_.touchable=function(j){return arguments.length?(s=typeof j=="function"?j:Z_(!!j),_):s},_.extent=function(j){return arguments.length?(e=typeof j=="function"?j:Z_([[+j[0][0],+j[0][1]],[+j[1][0],+j[1][1]]]),_):e},_.scaleExtent=function(j){return arguments.length?(o[0]=+j[0],o[1]=+j[1],_):[o[0],o[1]]},_.translateExtent=function(j){return arguments.length?(l[0][0]=+j[0][0],l[1][0]=+j[1][0],l[0][1]=+j[0][1],l[1][1]=+j[1][1],_):[[l[0][0],l[0][1]],[l[1][0],l[1][1]]]},_.constrain=function(j){return arguments.length?(i=j,_):i},_.duration=function(j){return arguments.length?(u=+j,_):u},_.interpolate=function(j){return arguments.length?(c=j,_):c},_.on=function(){var j=h.on.apply(h,arguments);return j===h?_:j},_.clickDistance=function(j){return arguments.length?(b=(j=+j)*j,_):Math.sqrt(b)},_.tapDistance=function(j){return arguments.length?(v=+j,_):v},_}var J1e="Expected a function";function Z1e(r,e,i){var n=!0,s=!0;if(typeof r!="function")throw new TypeError(J1e);return zx(i)&&(n="leading"in i?!!i.leading:n,s="trailing"in i?!!i.trailing:s),Lk(r,e,{leading:n,maxWait:e,trailing:s})}function TI(r,e){(e==null||e>r.length)&&(e=r.length);for(var i=0,n=Array(e);i<e;i++)n[i]=r[i];return n}function $1e(r){if(Array.isArray(r))return TI(r)}function Hz(r,e,i){if(typeof r=="function"?r===e:r.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}function e_e(r,e){if(e.has(r))throw new TypeError("Cannot initialize the same private elements twice on an object")}function t_e(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function zl(r,e){return r.get(Hz(r,e))}function Wz(r,e,i){e_e(r,e),e.set(r,i)}function Qz(r,e,i){return r.set(Hz(r,e),i),i}function i_e(r,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,l_e(n.key),n)}}function r_e(r,e,i){return e&&i_e(r.prototype,e),Object.defineProperty(r,"prototype",{writable:!1}),r}function n_e(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function s_e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function a_e(r){return $1e(r)||n_e(r)||c_e(r)||s_e()}function o_e(r,e){if(typeof r!="object"||!r)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var n=i.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}function l_e(r){var e=o_e(r,"string");return typeof e=="symbol"?e:e+""}function c_e(r,e){if(r){if(typeof r=="string")return TI(r,e);var i={}.toString.call(r).slice(8,-1);return i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set"?Array.from(r):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?TI(r,e):void 0}}var u_e=123,h_e=function(r){return"#".concat(Math.min(r,Math.pow(2,24)).toString(16).padStart(6,"0"))},qz=function(r,e,i){return(r<<16)+(e<<8)+i},d_e=function(r){var e=br(r).toRgb(),i=e.r,n=e.g,s=e.b;return qz(i,n,s)},Xz=function(r,e){return r*u_e%Math.pow(2,e)},rf=new WeakMap,gh=new WeakMap,p_e=function(){function r(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:6;t_e(this,r),Wz(this,rf,void 0),Wz(this,gh,void 0),Qz(gh,this,e),this.reset()}return r_e(r,[{key:"reset",value:function(){Qz(rf,this,["__reserved for background__"])}},{key:"register",value:function(e){if(zl(rf,this).length>=Math.pow(2,24-zl(gh,this)))return null;var i=zl(rf,this).length,n=Xz(i,zl(gh,this)),s=h_e(i+(n<<24-zl(gh,this)));return zl(rf,this).push(e),s}},{key:"lookup",value:function(e){if(!e)return null;var i=typeof e=="string"?d_e(e):qz.apply(void 0,a_e(e));if(!i)return null;var n=i&Math.pow(2,24-zl(gh,this))-1,s=i>>24-zl(gh,this)&Math.pow(2,zl(gh,this))-1;return Xz(n,zl(gh,this))!==s||n>=zl(rf,this).length?null:zl(rf,this)[n]}}])}();const{abs:Qy,cos:Ah,sin:Qg,acos:f_e,atan2:qy,sqrt:Rd,pow:jl}=Math;function Xy(r){return r<0?-jl(-r,1/3):jl(r,1/3)}const Yz=Math.PI,$_=2*Yz,Id=Yz/2,m_e=1e-6,MI=Number.MAX_SAFE_INTEGER||9007199254740991,RI=Number.MIN_SAFE_INTEGER||-9007199254740991,g_e={x:0,y:0,z:0},Mi={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(r,e){const i=e(r);let n=i.x*i.x+i.y*i.y;return typeof i.z<"u"&&(n+=i.z*i.z),Rd(n)},compute:function(r,e,i){if(r===0)return e[0].t=0,e[0];const n=e.length-1;if(r===1)return e[n].t=1,e[n];const s=1-r;let o=e;if(n===0)return e[0].t=r,e[0];if(n===1){const u={x:s*o[0].x+r*o[1].x,y:s*o[0].y+r*o[1].y,t:r};return i&&(u.z=s*o[0].z+r*o[1].z),u}if(n<4){let u=s*s,c=r*r,h,p,f,g=0;n===2?(o=[o[0],o[1],o[2],g_e],h=u,p=s*r*2,f=c):n===3&&(h=u*s,p=u*r*3,f=s*c*3,g=r*c);const m={x:h*o[0].x+p*o[1].x+f*o[2].x+g*o[3].x,y:h*o[0].y+p*o[1].y+f*o[2].y+g*o[3].y,t:r};return i&&(m.z=h*o[0].z+p*o[1].z+f*o[2].z+g*o[3].z),m}const l=JSON.parse(JSON.stringify(e));for(;l.length>1;){for(let u=0;u<l.length-1;u++)l[u]={x:l[u].x+(l[u+1].x-l[u].x)*r,y:l[u].y+(l[u+1].y-l[u].y)*r},typeof l[u].z<"u"&&(l[u].z=l[u].z+(l[u+1].z-l[u].z)*r);l.splice(l.length-1,1)}return l[0].t=r,l[0]},computeWithRatios:function(r,e,i,n){const s=1-r,o=i,l=e;let u=o[0],c=o[1],h=o[2],p=o[3],f;if(u*=s,c*=r,l.length===2)return f=u+c,{x:(u*l[0].x+c*l[1].x)/f,y:(u*l[0].y+c*l[1].y)/f,z:n?(u*l[0].z+c*l[1].z)/f:!1,t:r};if(u*=s,c*=2*s,h*=r*r,l.length===3)return f=u+c+h,{x:(u*l[0].x+c*l[1].x+h*l[2].x)/f,y:(u*l[0].y+c*l[1].y+h*l[2].y)/f,z:n?(u*l[0].z+c*l[1].z+h*l[2].z)/f:!1,t:r};if(u*=s,c*=1.5*s,h*=3*s,p*=r*r*r,l.length===4)return f=u+c+h+p,{x:(u*l[0].x+c*l[1].x+h*l[2].x+p*l[3].x)/f,y:(u*l[0].y+c*l[1].y+h*l[2].y+p*l[3].y)/f,z:n?(u*l[0].z+c*l[1].z+h*l[2].z+p*l[3].z)/f:!1,t:r}},derive:function(r,e){const i=[];for(let n=r,s=n.length,o=s-1;s>1;s--,o--){const l=[];for(let u=0,c;u<o;u++)c={x:o*(n[u+1].x-n[u].x),y:o*(n[u+1].y-n[u].y)},e&&(c.z=o*(n[u+1].z-n[u].z)),l.push(c);i.push(l),n=l}return i},between:function(r,e,i){return e<=r&&r<=i||Mi.approximately(r,e)||Mi.approximately(r,i)},approximately:function(r,e,i){return Qy(r-e)<=(i||m_e)},length:function(r){const e=Mi.Tvalues.length;let i=0;for(let n=0,s;n<e;n++)s=.5*Mi.Tvalues[n]+.5,i+=Mi.Cvalues[n]*Mi.arcfn(s,r);return .5*i},map:function(r,e,i,n,s){const o=i-e,l=s-n,u=r-e,c=u/o;return n+l*c},lerp:function(r,e,i){const n={x:e.x+r*(i.x-e.x),y:e.y+r*(i.y-e.y)};return e.z!==void 0&&i.z!==void 0&&(n.z=e.z+r*(i.z-e.z)),n},pointToString:function(r){let e=r.x+"/"+r.y;return typeof r.z<"u"&&(e+="/"+r.z),e},pointsToString:function(r){return"["+r.map(Mi.pointToString).join(", ")+"]"},copy:function(r){return JSON.parse(JSON.stringify(r))},angle:function(r,e,i){const n=e.x-r.x,s=e.y-r.y,o=i.x-r.x,l=i.y-r.y,u=n*l-s*o,c=n*o+s*l;return qy(u,c)},round:function(r,e){const i=""+r,n=i.indexOf(".");return parseFloat(i.substring(0,n+1+e))},dist:function(r,e){const i=r.x-e.x,n=r.y-e.y;return Rd(i*i+n*n)},closest:function(r,e){let i=jl(2,63),n,s;return r.forEach(function(o,l){s=Mi.dist(e,o),s<i&&(i=s,n=l)}),{mdist:i,mpos:n}},abcratio:function(r,e){if(e!==2&&e!==3)return!1;if(typeof r>"u")r=.5;else if(r===0||r===1)return r;const i=jl(r,e)+jl(1-r,e),n=i-1;return Qy(n/i)},projectionratio:function(r,e){if(e!==2&&e!==3)return!1;if(typeof r>"u")r=.5;else if(r===0||r===1)return r;const i=jl(1-r,e),n=jl(r,e)+i;return i/n},lli8:function(r,e,i,n,s,o,l,u){const c=(r*n-e*i)*(s-l)-(r-i)*(s*u-o*l),h=(r*n-e*i)*(o-u)-(e-n)*(s*u-o*l),p=(r-i)*(o-u)-(e-n)*(s-l);return p==0?!1:{x:c/p,y:h/p}},lli4:function(r,e,i,n){const s=r.x,o=r.y,l=e.x,u=e.y,c=i.x,h=i.y,p=n.x,f=n.y;return Mi.lli8(s,o,l,u,c,h,p,f)},lli:function(r,e){return Mi.lli4(r,r.c,e,e.c)},makeline:function(r,e){return new ys(r.x,r.y,(r.x+e.x)/2,(r.y+e.y)/2,e.x,e.y)},findbbox:function(r){let e=MI,i=MI,n=RI,s=RI;return r.forEach(function(o){const l=o.bbox();e>l.x.min&&(e=l.x.min),i>l.y.min&&(i=l.y.min),n<l.x.max&&(n=l.x.max),s<l.y.max&&(s=l.y.max)}),{x:{min:e,mid:(e+n)/2,max:n,size:n-e},y:{min:i,mid:(i+s)/2,max:s,size:s-i}}},shapeintersections:function(r,e,i,n,s){if(!Mi.bboxoverlap(e,n))return[];const o=[],l=[r.startcap,r.forward,r.back,r.endcap],u=[i.startcap,i.forward,i.back,i.endcap];return l.forEach(function(c){c.virtual||u.forEach(function(h){if(h.virtual)return;const p=c.intersects(h,s);p.length>0&&(p.c1=c,p.c2=h,p.s1=r,p.s2=i,o.push(p))})}),o},makeshape:function(r,e,i){const n=e.points.length,s=r.points.length,o=Mi.makeline(e.points[n-1],r.points[0]),l=Mi.makeline(r.points[s-1],e.points[0]),u={startcap:o,forward:r,back:e,endcap:l,bbox:Mi.findbbox([o,r,e,l])};return u.intersections=function(c){return Mi.shapeintersections(u,u.bbox,c,c.bbox,i)},u},getminmax:function(r,e,i){if(!i)return{min:0,max:0};let n=MI,s=RI,o,l;i.indexOf(0)===-1&&(i=[0].concat(i)),i.indexOf(1)===-1&&i.push(1);for(let u=0,c=i.length;u<c;u++)o=i[u],l=r.get(o),l[e]<n&&(n=l[e]),l[e]>s&&(s=l[e]);return{min:n,mid:(n+s)/2,max:s,size:s-n}},align:function(r,e){const i=e.p1.x,n=e.p1.y,s=-qy(e.p2.y-n,e.p2.x-i),o=function(l){return{x:(l.x-i)*Ah(s)-(l.y-n)*Qg(s),y:(l.x-i)*Qg(s)+(l.y-n)*Ah(s)}};return r.map(o)},roots:function(r,e){e=e||{p1:{x:0,y:0},p2:{x:1,y:0}};const i=r.length-1,n=Mi.align(r,e),s=function(I){return 0<=I&&I<=1};if(i===2){const I=n[0].y,N=n[1].y,D=n[2].y,P=I-2*N+D;if(P!==0){const k=-Rd(N*N-I*D),q=-I+N,V=-(k+q)/P,j=-(-k+q)/P;return[V,j].filter(s)}else if(N!==D&&P===0)return[(2*N-D)/(2*N-2*D)].filter(s);return[]}const o=n[0].y,l=n[1].y,u=n[2].y,c=n[3].y;let h=-o+3*l-3*u+c,p=3*o-6*l+3*u,f=-3*o+3*l,g=o;if(Mi.approximately(h,0)){if(Mi.approximately(p,0))return Mi.approximately(f,0)?[]:[-g/f].filter(s);const I=Rd(f*f-4*p*g),N=2*p;return[(I-f)/N,(-f-I)/N].filter(s)}p/=h,f/=h,g/=h;const m=(3*f-p*p)/3,y=m/3,b=(2*p*p*p-9*p*f+27*g)/27,v=b/2,_=v*v+y*y*y;let T,E,C,R,B;if(_<0){const I=-m/3,N=I*I*I,D=Rd(N),P=-b/(2*D),k=P<-1?-1:P>1?1:P,q=f_e(k),V=Xy(D),j=2*V;return C=j*Ah(q/3)-p/3,R=j*Ah((q+$_)/3)-p/3,B=j*Ah((q+2*$_)/3)-p/3,[C,R,B].filter(s)}else{if(_===0)return T=v<0?Xy(-v):-Xy(v),C=2*T-p/3,R=-T-p/3,[C,R].filter(s);{const I=Rd(_);return T=Xy(-v+I),E=Xy(v+I),[T-E-p/3].filter(s)}}},droots:function(r){if(r.length===3){const e=r[0],i=r[1],n=r[2],s=e-2*i+n;if(s!==0){const o=-Rd(i*i-e*n),l=-e+i,u=-(o+l)/s,c=-(-o+l)/s;return[u,c]}else if(i!==n&&s===0)return[(2*i-n)/(2*(i-n))];return[]}if(r.length===2){const e=r[0],i=r[1];return e!==i?[e/(e-i)]:[]}return[]},curvature:function(r,e,i,n,s){let o,l,u,c,h=0,p=0;const f=Mi.compute(r,e),g=Mi.compute(r,i),m=f.x*f.x+f.y*f.y;if(n?(o=Rd(jl(f.y*g.z-g.y*f.z,2)+jl(f.z*g.x-g.z*f.x,2)+jl(f.x*g.y-g.x*f.y,2)),l=jl(m+f.z*f.z,3/2)):(o=f.x*g.y-f.y*g.x,l=jl(m,3/2)),o===0||l===0)return{k:0,r:0};if(h=o/l,p=l/o,!s){const y=Mi.curvature(r-.001,e,i,n,!0).k,b=Mi.curvature(r+.001,e,i,n,!0).k;c=(b-h+(h-y))/2,u=(Qy(b-h)+Qy(h-y))/2}return{k:h,r:p,dk:c,adk:u}},inflections:function(r){if(r.length<4)return[];const e=Mi.align(r,{p1:r[0],p2:r.slice(-1)[0]}),i=e[2].x*e[1].y,n=e[3].x*e[1].y,s=e[1].x*e[2].y,o=e[3].x*e[2].y,l=18*(-3*i+2*n+3*s-o),u=18*(3*i-n-3*s),c=18*(s-i);if(Mi.approximately(l,0)){if(!Mi.approximately(u,0)){let g=-c/u;if(0<=g&&g<=1)return[g]}return[]}const h=2*l;if(Mi.approximately(h,0))return[];const p=u*u-4*l*c;if(p<0)return[];const f=Math.sqrt(p);return[(f-u)/h,-(u+f)/h].filter(function(g){return 0<=g&&g<=1})},bboxoverlap:function(r,e){const i=["x","y"],n=i.length;for(let s=0,o,l,u,c;s<n;s++)if(o=i[s],l=r[o].mid,u=e[o].mid,c=(r[o].size+e[o].size)/2,Qy(l-u)>=c)return!1;return!0},expandbox:function(r,e){e.x.min<r.x.min&&(r.x.min=e.x.min),e.y.min<r.y.min&&(r.y.min=e.y.min),e.z&&e.z.min<r.z.min&&(r.z.min=e.z.min),e.x.max>r.x.max&&(r.x.max=e.x.max),e.y.max>r.y.max&&(r.y.max=e.y.max),e.z&&e.z.max>r.z.max&&(r.z.max=e.z.max),r.x.mid=(r.x.min+r.x.max)/2,r.y.mid=(r.y.min+r.y.max)/2,r.z&&(r.z.mid=(r.z.min+r.z.max)/2),r.x.size=r.x.max-r.x.min,r.y.size=r.y.max-r.y.min,r.z&&(r.z.size=r.z.max-r.z.min)},pairiteration:function(r,e,i){const n=r.bbox(),s=e.bbox(),o=1e5,l=i||.5;if(n.x.size+n.y.size<l&&s.x.size+s.y.size<l)return[(o*(r._t1+r._t2)/2|0)/o+"/"+(o*(e._t1+e._t2)/2|0)/o];let u=r.split(.5),c=e.split(.5),h=[{left:u.left,right:c.left},{left:u.left,right:c.right},{left:u.right,right:c.right},{left:u.right,right:c.left}];h=h.filter(function(f){return Mi.bboxoverlap(f.left.bbox(),f.right.bbox())});let p=[];return h.length===0||(h.forEach(function(f){p=p.concat(Mi.pairiteration(f.left,f.right,l))}),p=p.filter(function(f,g){return p.indexOf(f)===g})),p},getccenter:function(r,e,i){const n=e.x-r.x,s=e.y-r.y,o=i.x-e.x,l=i.y-e.y,u=n*Ah(Id)-s*Qg(Id),c=n*Qg(Id)+s*Ah(Id),h=o*Ah(Id)-l*Qg(Id),p=o*Qg(Id)+l*Ah(Id),f=(r.x+e.x)/2,g=(r.y+e.y)/2,m=(e.x+i.x)/2,y=(e.y+i.y)/2,b=f+u,v=g+c,_=m+h,T=y+p,E=Mi.lli8(f,g,b,v,m,y,_,T),C=Mi.dist(E,r);let R=qy(r.y-E.y,r.x-E.x),B=qy(e.y-E.y,e.x-E.x),I=qy(i.y-E.y,i.x-E.x),N;return R<I?((R>B||B>I)&&(R+=$_),R>I&&(N=I,I=R,R=N)):I<B&&B<R?(N=I,I=R,R=N):I+=$_,E.s=R,E.e=I,E.r=C,E},numberSort:function(r,e){return r-e}};class Yy{constructor(e){this.curves=[],this._3d=!1,e&&(this.curves=e,this._3d=this.curves[0]._3d)}valueOf(){return this.toString()}toString(){return"["+this.curves.map(function(e){return Mi.pointsToString(e.points)}).join(", ")+"]"}addCurve(e){this.curves.push(e),this._3d=this._3d||e._3d}length(){return this.curves.map(function(e){return e.length()}).reduce(function(e,i){return e+i})}curve(e){return this.curves[e]}bbox(){const e=this.curves;for(var i=e[0].bbox(),n=1;n<e.length;n++)Mi.expandbox(i,e[n].bbox());return i}offset(e){const i=[];return this.curves.forEach(function(n){i.push(...n.offset(e))}),new Yy(i)}}const{abs:Ky,min:Kz,max:Jz,cos:A_e,sin:y_e,acos:v_e,sqrt:Jy}=Math,b_e=Math.PI;class ys{constructor(e){let i=e&&e.forEach?e:Array.from(arguments).slice(),n=!1;if(typeof i[0]=="object"){n=i.length;const m=[];i.forEach(function(y){["x","y","z"].forEach(function(b){typeof y[b]<"u"&&m.push(y[b])})}),i=m}let s=!1;const o=i.length;if(n){if(n>4){if(arguments.length!==1)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");s=!0}}else if(o!==6&&o!==8&&o!==9&&o!==12&&arguments.length!==1)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");const l=this._3d=!s&&(o===9||o===12)||e&&e[0]&&typeof e[0].z<"u",u=this.points=[];for(let m=0,y=l?3:2;m<o;m+=y){var c={x:i[m],y:i[m+1]};l&&(c.z=i[m+2]),u.push(c)}const h=this.order=u.length-1,p=this.dims=["x","y"];l&&p.push("z"),this.dimlen=p.length;const f=Mi.align(u,{p1:u[0],p2:u[h]}),g=Mi.dist(u[0],u[h]);this._linear=f.reduce((m,y)=>m+Ky(y.y),0)<g/50,this._lut=[],this._t1=0,this._t2=1,this.update()}static quadraticFromPoints(e,i,n,s){if(typeof s>"u"&&(s=.5),s===0)return new ys(i,i,n);if(s===1)return new ys(e,i,i);const o=ys.getABC(2,e,i,n,s);return new ys(e,o.A,n)}static cubicFromPoints(e,i,n,s,o){typeof s>"u"&&(s=.5);const l=ys.getABC(3,e,i,n,s);typeof o>"u"&&(o=Mi.dist(i,l.C));const u=o*(1-s)/s,c=Mi.dist(e,n),h=(n.x-e.x)/c,p=(n.y-e.y)/c,f=o*h,g=o*p,m=u*h,y=u*p,b={x:i.x-f,y:i.y-g},v={x:i.x+m,y:i.y+y},_=l.A,T={x:_.x+(b.x-_.x)/(1-s),y:_.y+(b.y-_.y)/(1-s)},E={x:_.x+(v.x-_.x)/s,y:_.y+(v.y-_.y)/s},C={x:e.x+(T.x-e.x)/s,y:e.y+(T.y-e.y)/s},R={x:n.x+(E.x-n.x)/(1-s),y:n.y+(E.y-n.y)/(1-s)};return new ys(e,C,R,n)}static getUtils(){return Mi}getUtils(){return ys.getUtils()}static get PolyBezier(){return Yy}valueOf(){return this.toString()}toString(){return Mi.pointsToString(this.points)}toSVG(){if(this._3d)return!1;const e=this.points,i=e[0].x,n=e[0].y,s=["M",i,n,this.order===2?"Q":"C"];for(let o=1,l=e.length;o<l;o++)s.push(e[o].x),s.push(e[o].y);return s.join(" ")}setRatios(e){if(e.length!==this.points.length)throw new Error("incorrect number of ratio values");this.ratios=e,this._lut=[]}verify(){const e=this.coordDigest();e!==this._print&&(this._print=e,this.update())}coordDigest(){return this.points.map(function(e,i){return""+i+e.x+e.y+(e.z?e.z:0)}).join("")}update(){this._lut=[],this.dpoints=Mi.derive(this.points,this._3d),this.computedirection()}computedirection(){const e=this.points,i=Mi.angle(e[0],e[this.order],e[1]);this.clockwise=i>0}length(){return Mi.length(this.derivative.bind(this))}static getABC(e=2,i,n,s,o=.5){const l=Mi.projectionratio(o,e),u=1-l,c={x:l*i.x+u*s.x,y:l*i.y+u*s.y},h=Mi.abcratio(o,e);return{A:{x:n.x+(n.x-c.x)/h,y:n.y+(n.y-c.y)/h},B:n,C:c,S:i,E:s}}getABC(e,i){i=i||this.get(e);let n=this.points[0],s=this.points[this.order];return ys.getABC(this.order,n,i,s,e)}getLUT(e){if(this.verify(),e=e||100,this._lut.length===e+1)return this._lut;this._lut=[],e++,this._lut=[];for(let i=0,n,s;i<e;i++)s=i/(e-1),n=this.compute(s),n.t=s,this._lut.push(n);return this._lut}on(e,i){i=i||5;const n=this.getLUT(),s=[];for(let o=0,l,u=0;o<n.length;o++)l=n[o],Mi.dist(l,e)<i&&(s.push(l),u+=o/n.length);return s.length?t/=s.length:!1}project(e){const i=this.getLUT(),n=i.length-1,s=Mi.closest(i,e),o=s.mpos,l=(o-1)/n,u=(o+1)/n,c=.1/n;let h=s.mdist,p=l,f=p,g;h+=1;for(let m;p<u+c;p+=c)g=this.compute(p),m=Mi.dist(e,g),m<h&&(h=m,f=p);return f=f<0?0:f>1?1:f,g=this.compute(f),g.t=f,g.d=h,g}get(e){return this.compute(e)}point(e){return this.points[e]}compute(e){return this.ratios?Mi.computeWithRatios(e,this.points,this.ratios,this._3d):Mi.compute(e,this.points,this._3d,this.ratios)}raise(){const e=this.points,i=[e[0]],n=e.length;for(let s=1,o,l;s<n;s++)o=e[s],l=e[s-1],i[s]={x:(n-s)/n*o.x+s/n*l.x,y:(n-s)/n*o.y+s/n*l.y};return i[n]=e[n-1],new ys(i)}derivative(e){return Mi.compute(e,this.dpoints[0],this._3d)}dderivative(e){return Mi.compute(e,this.dpoints[1],this._3d)}align(){let e=this.points;return new ys(Mi.align(e,{p1:e[0],p2:e[e.length-1]}))}curvature(e){return Mi.curvature(e,this.dpoints[0],this.dpoints[1],this._3d)}inflections(){return Mi.inflections(this.points)}normal(e){return this._3d?this.__normal3(e):this.__normal2(e)}__normal2(e){const i=this.derivative(e),n=Jy(i.x*i.x+i.y*i.y);return{t:e,x:-i.y/n,y:i.x/n}}__normal3(e){const i=this.derivative(e),n=this.derivative(e+.01),s=Jy(i.x*i.x+i.y*i.y+i.z*i.z),o=Jy(n.x*n.x+n.y*n.y+n.z*n.z);i.x/=s,i.y/=s,i.z/=s,n.x/=o,n.y/=o,n.z/=o;const l={x:n.y*i.z-n.z*i.y,y:n.z*i.x-n.x*i.z,z:n.x*i.y-n.y*i.x},u=Jy(l.x*l.x+l.y*l.y+l.z*l.z);l.x/=u,l.y/=u,l.z/=u;const c=[l.x*l.x,l.x*l.y-l.z,l.x*l.z+l.y,l.x*l.y+l.z,l.y*l.y,l.y*l.z-l.x,l.x*l.z-l.y,l.y*l.z+l.x,l.z*l.z];return{t:e,x:c[0]*i.x+c[1]*i.y+c[2]*i.z,y:c[3]*i.x+c[4]*i.y+c[5]*i.z,z:c[6]*i.x+c[7]*i.y+c[8]*i.z}}hull(e){let i=this.points,n=[],s=[],o=0;for(s[o++]=i[0],s[o++]=i[1],s[o++]=i[2],this.order===3&&(s[o++]=i[3]);i.length>1;){n=[];for(let l=0,u,c=i.length-1;l<c;l++)u=Mi.lerp(e,i[l],i[l+1]),s[o++]=u,n.push(u);i=n}return s}split(e,i){if(e===0&&i)return this.split(i).left;if(i===1)return this.split(e).right;const n=this.hull(e),s={left:this.order===2?new ys([n[0],n[3],n[5]]):new ys([n[0],n[4],n[7],n[9]]),right:this.order===2?new ys([n[5],n[4],n[2]]):new ys([n[9],n[8],n[6],n[3]]),span:n};return s.left._t1=Mi.map(0,0,1,this._t1,this._t2),s.left._t2=Mi.map(e,0,1,this._t1,this._t2),s.right._t1=Mi.map(e,0,1,this._t1,this._t2),s.right._t2=Mi.map(1,0,1,this._t1,this._t2),i?(i=Mi.map(i,e,1,0,1),s.right.split(i).left):s}extrema(){const e={};let i=[];return this.dims.forEach((function(n){let s=function(l){return l[n]},o=this.dpoints[0].map(s);e[n]=Mi.droots(o),this.order===3&&(o=this.dpoints[1].map(s),e[n]=e[n].concat(Mi.droots(o))),e[n]=e[n].filter(function(l){return l>=0&&l<=1}),i=i.concat(e[n].sort(Mi.numberSort))}).bind(this)),e.values=i.sort(Mi.numberSort).filter(function(n,s){return i.indexOf(n)===s}),e}bbox(){const e=this.extrema(),i={};return this.dims.forEach((function(n){i[n]=Mi.getminmax(this,n,e[n])}).bind(this)),i}overlaps(e){const i=this.bbox(),n=e.bbox();return Mi.bboxoverlap(i,n)}offset(e,i){if(typeof i<"u"){const n=this.get(e),s=this.normal(e),o={c:n,n:s,x:n.x+s.x*i,y:n.y+s.y*i};return this._3d&&(o.z=n.z+s.z*i),o}if(this._linear){const n=this.normal(0),s=this.points.map(function(o){const l={x:o.x+e*n.x,y:o.y+e*n.y};return o.z&&n.z&&(l.z=o.z+e*n.z),l});return[new ys(s)]}return this.reduce().map(function(n){return n._linear?n.offset(e)[0]:n.scale(e)})}simple(){if(this.order===3){const s=Mi.angle(this.points[0],this.points[3],this.points[1]),o=Mi.angle(this.points[0],this.points[3],this.points[2]);if(s>0&&o<0||s<0&&o>0)return!1}const e=this.normal(0),i=this.normal(1);let n=e.x*i.x+e.y*i.y;return this._3d&&(n+=e.z*i.z),Ky(v_e(n))<b_e/3}reduce(){let e,i=0,n=0,s=.01,o,l=[],u=[],c=this.extrema().values;for(c.indexOf(0)===-1&&(c=[0].concat(c)),c.indexOf(1)===-1&&c.push(1),i=c[0],e=1;e<c.length;e++)n=c[e],o=this.split(i,n),o._t1=i,o._t2=n,l.push(o),i=n;return l.forEach(function(h){for(i=0,n=0;n<=1;)for(n=i+s;n<=1+s;n+=s)if(o=h.split(i,n),!o.simple()){if(n-=s,Ky(i-n)<s)return[];o=h.split(i,n),o._t1=Mi.map(i,0,1,h._t1,h._t2),o._t2=Mi.map(n,0,1,h._t1,h._t2),u.push(o),i=n;break}i<1&&(o=h.split(i,1),o._t1=Mi.map(i,0,1,h._t1,h._t2),o._t2=h._t2,u.push(o))}),u}translate(e,i,n){n=typeof n=="number"?n:i;const s=this.order;let o=this.points.map((l,u)=>(1-u/s)*i+u/s*n);return new ys(this.points.map((l,u)=>({x:l.x+e.x*o[u],y:l.y+e.y*o[u]})))}scale(e){const i=this.order;let n=!1;if(typeof e=="function"&&(n=e),n&&i===2)return this.raise().scale(n);const s=this.clockwise,o=this.points;if(this._linear)return this.translate(this.normal(0),n?n(0):e,n?n(1):e);const l=n?n(0):e,u=n?n(1):e,c=[this.offset(0,10),this.offset(1,10)],h=[],p=Mi.lli4(c[0],c[0].c,c[1],c[1].c);if(!p)throw new Error("cannot scale this curve. Try reducing it first.");return[0,1].forEach(function(f){const g=h[f*i]=Mi.copy(o[f*i]);g.x+=(f?u:l)*c[f].n.x,g.y+=(f?u:l)*c[f].n.y}),n?([0,1].forEach(function(f){if(!(i===2&&f)){var g=o[f+1],m={x:g.x-p.x,y:g.y-p.y},y=n?n((f+1)/i):e;n&&!s&&(y=-y);var b=Jy(m.x*m.x+m.y*m.y);m.x/=b,m.y/=b,h[f+1]={x:g.x+y*m.x,y:g.y+y*m.y}}}),new ys(h)):([0,1].forEach(f=>{if(i===2&&f)return;const g=h[f*i],m=this.derivative(f),y={x:g.x+m.x,y:g.y+m.y};h[f+1]=Mi.lli4(g,y,p,o[f+1])}),new ys(h))}outline(e,i,n,s){if(i=i===void 0?e:i,this._linear){const R=this.normal(0),B=this.points[0],I=this.points[this.points.length-1];let N,D,P;n===void 0&&(n=e,s=i),N={x:B.x+R.x*e,y:B.y+R.y*e},P={x:I.x+R.x*n,y:I.y+R.y*n},D={x:(N.x+P.x)/2,y:(N.y+P.y)/2};const k=[N,D,P];N={x:B.x-R.x*i,y:B.y-R.y*i},P={x:I.x-R.x*s,y:I.y-R.y*s},D={x:(N.x+P.x)/2,y:(N.y+P.y)/2};const q=[P,D,N],V=Mi.makeline(q[2],k[0]),j=Mi.makeline(k[2],q[0]),Q=[V,new ys(k),j,new ys(q)];return new Yy(Q)}const o=this.reduce(),l=o.length,u=[];let c=[],h,p=0,f=this.length();const g=typeof n<"u"&&typeof s<"u";function m(R,B,I,N,D){return function(P){const k=N/I,q=(N+D)/I,V=B-R;return Mi.map(P,0,1,R+k*V,R+q*V)}}o.forEach(function(R){const B=R.length();g?(u.push(R.scale(m(e,n,f,p,B))),c.push(R.scale(m(-i,-s,f,p,B)))):(u.push(R.scale(e)),c.push(R.scale(-i))),p+=B}),c=c.map(function(R){return h=R.points,h[3]?R.points=[h[3],h[2],h[1],h[0]]:R.points=[h[2],h[1],h[0]],R}).reverse();const y=u[0].points[0],b=u[l-1].points[u[l-1].points.length-1],v=c[l-1].points[c[l-1].points.length-1],_=c[0].points[0],T=Mi.makeline(v,y),E=Mi.makeline(b,_),C=[T].concat(u).concat([E]).concat(c);return new Yy(C)}outlineshapes(e,i,n){i=i||e;const s=this.outline(e,i).curves,o=[];for(let l=1,u=s.length;l<u/2;l++){const c=Mi.makeshape(s[l],s[u-l],n);c.startcap.virtual=l>1,c.endcap.virtual=l<u/2-1,o.push(c)}return o}intersects(e,i){return e?e.p1&&e.p2?this.lineIntersects(e):(e instanceof ys&&(e=e.reduce()),this.curveintersects(this.reduce(),e,i)):this.selfintersects(i)}lineIntersects(e){const i=Kz(e.p1.x,e.p2.x),n=Kz(e.p1.y,e.p2.y),s=Jz(e.p1.x,e.p2.x),o=Jz(e.p1.y,e.p2.y);return Mi.roots(this.points,e).filter(l=>{var u=this.get(l);return Mi.between(u.x,i,s)&&Mi.between(u.y,n,o)})}selfintersects(e){const i=this.reduce(),n=i.length-2,s=[];for(let o=0,l,u,c;o<n;o++)u=i.slice(o,o+1),c=i.slice(o+2),l=this.curveintersects(u,c,e),s.push(...l);return s}curveintersects(e,i,n){const s=[];e.forEach(function(l){i.forEach(function(u){l.overlaps(u)&&s.push({left:l,right:u})})});let o=[];return s.forEach(function(l){const u=Mi.pairiteration(l.left,l.right,n);u.length>0&&(o=o.concat(u))}),o}arcs(e){return e=e||.5,this._iterate(e,[])}_error(e,i,n,s){const o=(s-n)/4,l=this.get(n+o),u=this.get(s-o),c=Mi.dist(e,i),h=Mi.dist(e,l),p=Mi.dist(e,u);return Ky(h-c)+Ky(p-c)}_iterate(e,i){let n=0,s=1,o;do{o=0,s=1;let l=this.get(n),u,c,h,p,f=!1,g=!1,m,y=s,b=1;do if(g=f,p=h,y=(n+s)/2,u=this.get(y),c=this.get(s),h=Mi.getccenter(l,u,c),h.interval={start:n,end:s},f=this._error(h,l,n,s)<=e,m=g&&!f,m||(b=s),f){if(s>=1){if(h.interval.end=b=1,p=h,s>1){let v={x:h.x+h.r*A_e(h.e),y:h.y+h.r*y_e(h.e)};h.e+=Mi.angle({x:h.x,y:h.y},v,this.get(1))}break}s=s+(s-n)/2}else s=y;while(!m&&o++<100);if(o>=100)break;p=p||h,i.push(p),n=b}while(s<1);return i}}function x_e(r,e){e===void 0&&(e={});var i=e.insertAt;if(!(typeof document>"u")){var n=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css",i==="top"&&n.firstChild?n.insertBefore(s,n.firstChild):n.appendChild(s),s.styleSheet?s.styleSheet.cssText=r:s.appendChild(document.createTextNode(r))}}var __e=`.force-graph-container canvas {
  display: block;
  user-select: none;
  outline: none;
  -webkit-tap-highlight-color: transparent;
}

.force-graph-container .graph-tooltip {
  position: absolute;
  top: 0;
  font-family: sans-serif;
  font-size: 16px;
  padding: 4px;
  border-radius: 3px;
  color: #eee;
  background: rgba(0,0,0,0.65);
  visibility: hidden; /* by default */
}

.force-graph-container .clickable {
  cursor: pointer;
}

.force-graph-container .grabbable {
  cursor: move;
  cursor: grab;
  cursor: -moz-grab;
  cursor: -webkit-grab;
}

.force-graph-container .grabbable:active {
  cursor: grabbing;
  cursor: -moz-grabbing;
  cursor: -webkit-grabbing;
}
`;x_e(__e);function II(r,e){(e==null||e>r.length)&&(e=r.length);for(var i=0,n=Array(e);i<e;i++)n[i]=r[i];return n}function E_e(r){if(Array.isArray(r))return r}function w_e(r){if(Array.isArray(r))return II(r)}function Zz(r,e,i){if($z())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,e);var s=new(r.bind.apply(r,n));return s}function Zy(r,e,i){return(e=I_e(e))in r?Object.defineProperty(r,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[e]=i,r}function $z(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return($z=function(){return!!r})()}function C_e(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function S_e(r,e){var i=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(i!=null){var n,s,o,l,u=[],c=!0,h=!1;try{if(o=(i=i.call(r)).next,e!==0)for(;!(c=(n=o.call(i)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(p){h=!0,s=p}finally{try{if(!c&&i.return!=null&&(l=i.return(),Object(l)!==l))return}finally{if(h)throw s}}return u}}function T_e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function M_e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ej(r,e){var i=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),i.push.apply(i,n)}return i}function qg(r){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?ej(Object(i),!0).forEach(function(n){Zy(r,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):ej(Object(i)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(i,n))})}return r}function $y(r,e){return E_e(r)||S_e(r,e)||tj(r,e)||T_e()}function Vl(r){return w_e(r)||C_e(r)||tj(r)||M_e()}function R_e(r,e){if(typeof r!="object"||!r)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var n=i.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function I_e(r){var e=R_e(r,"string");return typeof e=="symbol"?e:e+""}function BI(r){"@babel/helpers - typeof";return BI=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},BI(r)}function tj(r,e){if(r){if(typeof r=="string")return II(r,e);var i={}.toString.call(r).slice(8,-1);return i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set"?Array.from(r):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?II(r,e):void 0}}var B_e=wT(a5);function ij(r,e,i){!e||typeof i!="string"||r.filter(function(n){return!n[i]}).forEach(function(n){n[i]=B_e(e(n))})}function L_e(r,e){var i=r.nodes,n=r.links,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=s.nodeFilter,l=o===void 0?function(){return!0}:o,u=s.onLoopError,c=u===void 0?function(m){throw"Invalid DAG structure! Found cycle in node path: ".concat(m.join(" -> "),".")}:u,h={};i.forEach(function(m){return h[e(m)]={data:m,out:[],depth:-1,skip:!l(m)}}),n.forEach(function(m){var y=m.source,b=m.target,v=C(y),_=C(b);if(!h.hasOwnProperty(v))throw"Missing source node with id: ".concat(v);if(!h.hasOwnProperty(_))throw"Missing target node with id: ".concat(_);var T=h[v],E=h[_];T.out.push(E);function C(R){return BI(R)==="object"?e(R):R}});var p=[];g(Object.values(h));var f=Object.assign.apply(Object,[{}].concat(Vl(Object.entries(h).filter(function(m){var y=$y(m,2),b=y[1];return!b.skip}).map(function(m){var y=$y(m,2),b=y[0],v=y[1];return Zy({},b,v.depth)}))));return f;function g(m){for(var y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,v=function(){var E=m[_];if(y.indexOf(E)!==-1){var C=[].concat(Vl(y.slice(y.indexOf(E))),[E]).map(function(R){return e(R.data)});return p.some(function(R){return R.length===C.length&&R.every(function(B,I){return B===C[I]})})||(p.push(C),c(C)),1}b>E.depth&&(E.depth=b,g(E.out,[].concat(Vl(y),[E]),b+(E.skip?0:1)))},_=0,T=m.length;_<T;_++)v()}}var D_e=2,so=function(r,e){return e.onNeedsRedraw&&e.onNeedsRedraw()},rj=function(r,e){if(!e.isShadow){var i=mr(e.linkDirectionalParticles);e.graphData.links.forEach(function(n){var s=Math.round(Math.abs(i(n)));s?n.__photons=Vl(Array(s)).map(function(){return{}}):delete n.__photons})}},eE=wp({props:{graphData:{default:{nodes:[],links:[]},onChange:function(r,e){e.engineRunning=!1,rj(r,e)}},dagMode:{onChange:function(r,e){!r&&(e.graphData.nodes||[]).forEach(function(i){return i.fx=i.fy=void 0})}},dagLevelDistance:{},dagNodeFilter:{default:function(r){return!0}},onDagError:{triggerUpdate:!1},nodeRelSize:{default:4,triggerUpdate:!1,onChange:so},nodeId:{default:"id"},nodeVal:{default:"val",triggerUpdate:!1,onChange:so},nodeColor:{default:"color",triggerUpdate:!1,onChange:so},nodeAutoColorBy:{},nodeCanvasObject:{triggerUpdate:!1,onChange:so},nodeCanvasObjectMode:{default:function(){return"replace"},triggerUpdate:!1,onChange:so},nodeVisibility:{default:!0,triggerUpdate:!1,onChange:so},linkSource:{default:"source"},linkTarget:{default:"target"},linkVisibility:{default:!0,triggerUpdate:!1,onChange:so},linkColor:{default:"color",triggerUpdate:!1,onChange:so},linkAutoColorBy:{},linkLineDash:{triggerUpdate:!1,onChange:so},linkWidth:{default:1,triggerUpdate:!1,onChange:so},linkCurvature:{default:0,triggerUpdate:!1,onChange:so},linkCanvasObject:{triggerUpdate:!1,onChange:so},linkCanvasObjectMode:{default:function(){return"replace"},triggerUpdate:!1,onChange:so},linkDirectionalArrowLength:{default:0,triggerUpdate:!1,onChange:so},linkDirectionalArrowColor:{triggerUpdate:!1,onChange:so},linkDirectionalArrowRelPos:{default:.5,triggerUpdate:!1,onChange:so},linkDirectionalParticles:{default:0,triggerUpdate:!1,onChange:rj},linkDirectionalParticleSpeed:{default:.01,triggerUpdate:!1},linkDirectionalParticleWidth:{default:4,triggerUpdate:!1},linkDirectionalParticleColor:{triggerUpdate:!1},globalScale:{default:1,triggerUpdate:!1},d3AlphaMin:{default:0,triggerUpdate:!1},d3AlphaDecay:{default:.0228,triggerUpdate:!1,onChange:function(r,e){e.forceLayout.alphaDecay(r)}},d3AlphaTarget:{default:0,triggerUpdate:!1,onChange:function(r,e){e.forceLayout.alphaTarget(r)}},d3VelocityDecay:{default:.4,triggerUpdate:!1,onChange:function(r,e){e.forceLayout.velocityDecay(r)}},warmupTicks:{default:0,triggerUpdate:!1},cooldownTicks:{default:1/0,triggerUpdate:!1},cooldownTime:{default:15e3,triggerUpdate:!1},onUpdate:{default:function(){},triggerUpdate:!1},onFinishUpdate:{default:function(){},triggerUpdate:!1},onEngineTick:{default:function(){},triggerUpdate:!1},onEngineStop:{default:function(){},triggerUpdate:!1},onNeedsRedraw:{triggerUpdate:!1},isShadow:{default:!1,triggerUpdate:!1}},methods:{d3Force:function(r,e,i){return i===void 0?r.forceLayout.force(e):(r.forceLayout.force(e,i),this)},d3ReheatSimulation:function(r){return r.forceLayout.alpha(1),this.resetCountdown(),this},resetCountdown:function(r){return r.cntTicks=0,r.startTickTime=new Date,r.engineRunning=!0,this},isEngineRunning:function(r){return!!r.engineRunning},tickFrame:function(r){return!r.isShadow&&e(),n(),!r.isShadow&&s(),!r.isShadow&&o(),i(),this;function e(){r.engineRunning&&(++r.cntTicks>r.cooldownTicks||new Date-r.startTickTime>r.cooldownTime||r.d3AlphaMin>0&&r.forceLayout.alpha()<r.d3AlphaMin?(r.engineRunning=!1,r.onEngineStop()):(r.forceLayout.tick(),r.onEngineTick()))}function i(){var l=mr(r.nodeVisibility),u=mr(r.nodeVal),c=mr(r.nodeColor),h=mr(r.nodeCanvasObjectMode),p=r.ctx,f=r.isShadow/r.globalScale,g=r.graphData.nodes.filter(l);p.save(),g.forEach(function(m){var y=h(m);if(r.nodeCanvasObject&&(y==="before"||y==="replace")&&(r.nodeCanvasObject(m,p,r.globalScale),y==="replace")){p.restore();return}var b=Math.sqrt(Math.max(0,u(m)||1))*r.nodeRelSize+f;p.beginPath(),p.arc(m.x,m.y,b,0,2*Math.PI,!1),p.fillStyle=c(m)||"rgba(31, 120, 180, 0.92)",p.fill(),r.nodeCanvasObject&&y==="after"&&r.nodeCanvasObject(m,r.ctx,r.globalScale)}),p.restore()}function n(){var l=mr(r.linkVisibility),u=mr(r.linkColor),c=mr(r.linkWidth),h=mr(r.linkLineDash),p=mr(r.linkCurvature),f=mr(r.linkCanvasObjectMode),g=r.ctx,m=r.isShadow*2,y=r.graphData.links.filter(l);y.forEach(R);var b=[],v=[],_=y;if(r.linkCanvasObject){var T=[],E=[];y.forEach(function(B){return({before:b,after:v,replace:T}[f(B)]||E).push(B)}),_=[].concat(Vl(b),v,E),b=b.concat(T)}g.save(),b.forEach(function(B){return r.linkCanvasObject(B,g,r.globalScale)}),g.restore();var C=_T(_,[u,c,h]);g.save(),Object.entries(C).forEach(function(B){var I=$y(B,2),N=I[0],D=I[1],P=!N||N==="undefined"?"rgba(0,0,0,0.15)":N;Object.entries(D).forEach(function(k){var q=$y(k,2),V=q[0],j=q[1],Q=(V||1)/r.globalScale+m;Object.entries(j).forEach(function(W){var G=$y(W,2);G[0];var z=G[1],te=h(z[0]);g.beginPath(),z.forEach(function(Y){var se=Y.source,ve=Y.target;if(!(!se||!ve||!se.hasOwnProperty("x")||!ve.hasOwnProperty("x"))){g.moveTo(se.x,se.y);var Ae=Y.__controlPoints;Ae?g[Ae.length===2?"quadraticCurveTo":"bezierCurveTo"].apply(g,Vl(Ae).concat([ve.x,ve.y])):g.lineTo(ve.x,ve.y)}}),g.strokeStyle=P,g.lineWidth=Q,g.setLineDash(te||[]),g.stroke()})})}),g.restore(),g.save(),v.forEach(function(B){return r.linkCanvasObject(B,g,r.globalScale)}),g.restore();function R(B){var I=p(B);if(!I){B.__controlPoints=null;return}var N=B.source,D=B.target;if(!(!N||!D||!N.hasOwnProperty("x")||!D.hasOwnProperty("x"))){var P=Math.sqrt(Math.pow(D.x-N.x,2)+Math.pow(D.y-N.y,2));if(P>0){var k=Math.atan2(D.y-N.y,D.x-N.x),q=P*I,V={x:(N.x+D.x)/2+q*Math.cos(k-Math.PI/2),y:(N.y+D.y)/2+q*Math.sin(k-Math.PI/2)};B.__controlPoints=[V.x,V.y]}else{var j=I*70;B.__controlPoints=[D.x,D.y-j,D.x+j,D.y]}}}}function s(){var l=1.6,u=.2,c=mr(r.linkDirectionalArrowLength),h=mr(r.linkDirectionalArrowRelPos),p=mr(r.linkVisibility),f=mr(r.linkDirectionalArrowColor||r.linkColor),g=mr(r.nodeVal),m=r.ctx;m.save(),r.graphData.links.filter(p).forEach(function(y){var b=c(y);if(!(!b||b<0)){var v=y.source,_=y.target;if(!(!v||!_||!v.hasOwnProperty("x")||!_.hasOwnProperty("x"))){var T=Math.sqrt(Math.max(0,g(v)||1))*r.nodeRelSize,E=Math.sqrt(Math.max(0,g(_)||1))*r.nodeRelSize,C=Math.min(1,Math.max(0,h(y))),R=f(y)||"rgba(0,0,0,0.28)",B=b/l/2,I=y.__controlPoints&&Zz(ys,[v.x,v.y].concat(Vl(y.__controlPoints),[_.x,_.y])),N=I?function(Q){return I.get(Q)}:function(Q){return{x:v.x+(_.x-v.x)*Q||0,y:v.y+(_.y-v.y)*Q||0}},D=I?I.length():Math.sqrt(Math.pow(_.x-v.x,2)+Math.pow(_.y-v.y,2)),P=T+b+(D-T-E-b)*C,k=N(P/D),q=N((P-b)/D),V=N((P-b*(1-u))/D),j=Math.atan2(k.y-q.y,k.x-q.x)-Math.PI/2;m.beginPath(),m.moveTo(k.x,k.y),m.lineTo(q.x+B*Math.cos(j),q.y+B*Math.sin(j)),m.lineTo(V.x,V.y),m.lineTo(q.x-B*Math.cos(j),q.y-B*Math.sin(j)),m.fillStyle=R,m.fill()}}}),m.restore()}function o(){var l=mr(r.linkDirectionalParticles),u=mr(r.linkDirectionalParticleSpeed),c=mr(r.linkDirectionalParticleWidth),h=mr(r.linkVisibility),p=mr(r.linkDirectionalParticleColor||r.linkColor),f=r.ctx;f.save(),r.graphData.links.filter(h).forEach(function(g){var m=l(g);if(!(!g.hasOwnProperty("__photons")||!g.__photons.length)){var y=g.source,b=g.target;if(!(!y||!b||!y.hasOwnProperty("x")||!b.hasOwnProperty("x"))){var v=u(g),_=g.__photons||[],T=Math.max(0,c(g)/2)/Math.sqrt(r.globalScale),E=p(g)||"rgba(0,0,0,0.28)";f.fillStyle=E;var C=g.__controlPoints?Zz(ys,[y.x,y.y].concat(Vl(g.__controlPoints),[b.x,b.y])):null,R=0,B=!1;_.forEach(function(I){var N=!!I.__singleHop;if(I.hasOwnProperty("__progressRatio")||(I.__progressRatio=N?0:R/m),!N&&R++,I.__progressRatio+=v,I.__progressRatio>=1)if(!N)I.__progressRatio=I.__progressRatio%1;else{B=!0;return}var D=I.__progressRatio,P=C?C.get(D):{x:y.x+(b.x-y.x)*D||0,y:y.y+(b.y-y.y)*D||0};f.beginPath(),f.arc(P.x,P.y,T,0,2*Math.PI,!1),f.fill()}),B&&(g.__photons=g.__photons.filter(function(I){return!I.__singleHop||I.__progressRatio<=1}))}}}),f.restore()}},emitParticle:function(r,e){return e&&(!e.__photons&&(e.__photons=[]),e.__photons.push({__singleHop:!0})),this}},stateInit:function(){return{forceLayout:ik().force("link",q4()).force("charge",rk()).force("center",O4()).force("dagRadial",null).stop(),engineRunning:!1}},init:function(r,e){e.ctx=r},update:function(r,e){r.engineRunning=!1,r.onUpdate(),r.nodeAutoColorBy!==null&&ij(r.graphData.nodes,mr(r.nodeAutoColorBy),r.nodeColor),r.linkAutoColorBy!==null&&ij(r.graphData.links,mr(r.linkAutoColorBy),r.linkColor),r.graphData.links.forEach(function(f){f.source=f[r.linkSource],f.target=f[r.linkTarget]}),r.forceLayout.stop().alpha(1).nodes(r.graphData.nodes);var i=r.forceLayout.force("link");i&&i.id(function(f){return f[r.nodeId]}).links(r.graphData.links);var n=r.dagMode&&L_e(r.graphData,function(f){return f[r.nodeId]},{nodeFilter:r.dagNodeFilter,onLoopError:r.onDagError||void 0}),s=Math.max.apply(Math,Vl(Object.values(n||[]))),o=r.dagLevelDistance||r.graphData.nodes.length/(s||1)*D_e*(["radialin","radialout"].indexOf(r.dagMode)!==-1?.7:1);if(["lr","rl","td","bu"].includes(e.dagMode)){var l=["lr","rl"].includes(e.dagMode)?"fx":"fy";r.graphData.nodes.filter(r.dagNodeFilter).forEach(function(f){return delete f[l]})}if(["lr","rl","td","bu"].includes(r.dagMode)){var u=["rl","bu"].includes(r.dagMode),c=function(f){return(n[f[r.nodeId]]-s/2)*o*(u?-1:1)},h=["lr","rl"].includes(r.dagMode)?"fx":"fy";r.graphData.nodes.filter(r.dagNodeFilter).forEach(function(f){return f[h]=c(f)})}r.forceLayout.force("dagRadial",["radialin","radialout"].indexOf(r.dagMode)!==-1?nk(function(f){var g=n[f[r.nodeId]]||-1;return(r.dagMode==="radialin"?s-g:g)*o}).strength(function(f){return r.dagNodeFilter(f)?1:0}):null);for(var p=0;p<r.warmupTicks&&!(r.d3AlphaMin>0&&r.forceLayout.alpha()<r.d3AlphaMin);p++)r.forceLayout.tick();this.resetCountdown(),r.onFinishUpdate()}});function nj(r,e){var i=r instanceof Array?r:[r],n=new e;return n._destructor&&n._destructor(),{linkProp:function(s){return{default:n[s](),onChange:function(o,l){i.forEach(function(u){return l[u][s](o)})},triggerUpdate:!1}},linkMethod:function(s){return function(o){for(var l=arguments.length,u=new Array(l>1?l-1:0),c=1;c<l;c++)u[c-1]=arguments[c];var h=[];return i.forEach(function(p){var f=o[p],g=f[s].apply(f,u);g!==f&&h.push(g)}),h.length?h[0]:this}}}}var N_e=800,P_e=4,sj=nj("forceGraph",eE),O_e=nj(["forceGraph","shadowGraph"],eE),k_e=Object.assign.apply(Object,Vl(["nodeColor","nodeAutoColorBy","nodeCanvasObject","nodeCanvasObjectMode","linkColor","linkAutoColorBy","linkLineDash","linkWidth","linkCanvasObject","linkCanvasObjectMode","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","dagMode","dagLevelDistance","dagNodeFilter","onDagError","d3AlphaMin","d3AlphaDecay","d3VelocityDecay","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"].map(function(r){return Zy({},r,sj.linkProp(r))})).concat(Vl(["nodeRelSize","nodeId","nodeVal","nodeVisibility","linkSource","linkTarget","linkVisibility","linkCurvature"].map(function(r){return Zy({},r,O_e.linkProp(r))})))),F_e=Object.assign.apply(Object,Vl(["d3Force","d3ReheatSimulation","emitParticle"].map(function(r){return Zy({},r,sj.linkMethod(r))})));function LI(r){if(r.canvas){var e=r.canvas.width,i=r.canvas.height;e===300&&i===150&&(e=i=0);var n=window.devicePixelRatio;e/=n,i/=n,[r.canvas,r.shadowCanvas].forEach(function(o){o.style.width="".concat(r.width,"px"),o.style.height="".concat(r.height,"px"),o.width=r.width*n,o.height=r.height*n,!e&&!i&&o.getContext("2d").scale(n,n)});var s=eu(r.canvas).k;r.zoom.translateBy(r.zoom.__baseElem,(r.width-e)/2/s,(r.height-i)/2/s),r.needsRedraw=!0}}function aj(r){var e=window.devicePixelRatio;r.setTransform(e,0,0,e,0,0)}function oj(r,e,i){r.save(),aj(r),r.clearRect(0,0,e,i),r.restore()}var U_e=wp({props:qg({width:{default:window.innerWidth,onChange:function(r,e){return LI(e)},triggerUpdate:!1},height:{default:window.innerHeight,onChange:function(r,e){return LI(e)},triggerUpdate:!1},graphData:{default:{nodes:[],links:[]},onChange:function(r,e){[r.nodes,r.links].every(function(n){return(n||[]).every(function(s){return!s.hasOwnProperty("__indexColor")})})&&e.colorTracker.reset(),[{type:"Node",objs:r.nodes},{type:"Link",objs:r.links}].forEach(i),e.forceGraph.graphData(r),e.shadowGraph.graphData(r);function i(n){var s=n.type,o=n.objs;o.filter(function(l){if(!l.hasOwnProperty("__indexColor"))return!0;var u=e.colorTracker.lookup(l.__indexColor);return!u||!u.hasOwnProperty("d")||u.d!==l}).forEach(function(l){l.__indexColor=e.colorTracker.register({type:s,d:l})})}},triggerUpdate:!1},backgroundColor:{onChange:function(r,e){e.canvas&&r&&(e.canvas.style.background=r)},triggerUpdate:!1},nodeLabel:{default:"name",triggerUpdate:!1},nodePointerAreaPaint:{onChange:function(r,e){e.shadowGraph.nodeCanvasObject(r?function(i,n,s){return r(i,i.__indexColor,n,s)}:null),e.flushShadowCanvas&&e.flushShadowCanvas()},triggerUpdate:!1},linkPointerAreaPaint:{onChange:function(r,e){e.shadowGraph.linkCanvasObject(r?function(i,n,s){return r(i,i.__indexColor,n,s)}:null),e.flushShadowCanvas&&e.flushShadowCanvas()},triggerUpdate:!1},linkLabel:{default:"name",triggerUpdate:!1},linkHoverPrecision:{default:4,triggerUpdate:!1},minZoom:{default:.01,onChange:function(r,e){e.zoom.scaleExtent([r,e.zoom.scaleExtent()[1]])},triggerUpdate:!1},maxZoom:{default:1e3,onChange:function(r,e){e.zoom.scaleExtent([e.zoom.scaleExtent()[0],r])},triggerUpdate:!1},enableNodeDrag:{default:!0,triggerUpdate:!1},enableZoomInteraction:{default:!0,triggerUpdate:!1},enablePanInteraction:{default:!0,triggerUpdate:!1},enableZoomPanInteraction:{default:!0,triggerUpdate:!1},enablePointerInteraction:{default:!0,onChange:function(r,e){e.hoverObj=null},triggerUpdate:!1},autoPauseRedraw:{default:!0,triggerUpdate:!1},onNodeDrag:{default:function(){},triggerUpdate:!1},onNodeDragEnd:{default:function(){},triggerUpdate:!1},onNodeClick:{triggerUpdate:!1},onNodeRightClick:{triggerUpdate:!1},onNodeHover:{triggerUpdate:!1},onLinkClick:{triggerUpdate:!1},onLinkRightClick:{triggerUpdate:!1},onLinkHover:{triggerUpdate:!1},onBackgroundClick:{triggerUpdate:!1},onBackgroundRightClick:{triggerUpdate:!1},onZoom:{triggerUpdate:!1},onZoomEnd:{triggerUpdate:!1},onRenderFramePre:{triggerUpdate:!1},onRenderFramePost:{triggerUpdate:!1}},k_e),aliases:{stopAnimation:"pauseAnimation"},methods:qg({graph2ScreenCoords:function(r,e,i){var n=eu(r.canvas);return{x:e*n.k+n.x,y:i*n.k+n.y}},screen2GraphCoords:function(r,e,i){var n=eu(r.canvas);return{x:(e-n.x)/n.k,y:(i-n.y)/n.k}},centerAt:function(r,e,i,n){if(!r.canvas)return null;if(e!==void 0||i!==void 0){var s=Object.assign({},e!==void 0?{x:e}:{},i!==void 0?{y:i}:{});return n?r.tweenGroup.add(new j_(o()).to(s,n).easing(uh.Quadratic.Out).onUpdate(l).start()):l(s),this}return o();function o(){var u=eu(r.canvas);return{x:(r.width/2-u.x)/u.k,y:(r.height/2-u.y)/u.k}}function l(u){var c=u.x,h=u.y;r.zoom.translateTo(r.zoom.__baseElem,c===void 0?o().x:c,h===void 0?o().y:h),r.needsRedraw=!0}},zoom:function(r,e,i){if(!r.canvas)return null;if(e!==void 0)return i?r.tweenGroup.add(new j_({k:n()}).to({k:e},i).easing(uh.Quadratic.Out).onUpdate(function(o){var l=o.k;return s(l)}).start()):s(e),this;return n();function n(){return eu(r.canvas).k}function s(o){r.zoom.scaleTo(r.zoom.__baseElem,o),r.needsRedraw=!0}},zoomToFit:function(r){for(var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:10,n=arguments.length,s=new Array(n>3?n-3:0),o=3;o<n;o++)s[o-3]=arguments[o];var l=this.getGraphBbox.apply(this,s);if(l){var u={x:(l.x[0]+l.x[1])/2,y:(l.y[0]+l.y[1])/2},c=Math.max(1e-12,Math.min(1e12,(r.width-i*2)/(l.x[1]-l.x[0]),(r.height-i*2)/(l.y[1]-l.y[0])));this.centerAt(u.x,u.y,e),this.zoom(c,e)}return this},getGraphBbox:function(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return!0},i=mr(r.nodeVal),n=function(o){return Math.sqrt(Math.max(0,i(o)||1))*r.nodeRelSize},s=r.graphData.nodes.filter(e).map(function(o){return{x:o.x,y:o.y,r:n(o)}});return s.length?{x:[bT(s,function(o){return o.x-o.r}),vT(s,function(o){return o.x+o.r})],y:[bT(s,function(o){return o.y-o.r}),vT(s,function(o){return o.y+o.r})]}:null},pauseAnimation:function(r){return r.animationFrameRequestId&&(cancelAnimationFrame(r.animationFrameRequestId),r.animationFrameRequestId=null),this},resumeAnimation:function(r){return r.animationFrameRequestId||this._animationCycle(),this},_destructor:function(){this.pauseAnimation(),this.graphData({nodes:[],links:[]})}},F_e),stateInit:function(){return{lastSetZoom:1,zoom:K1e(),forceGraph:new eE,shadowGraph:new eE().cooldownTicks(0).nodeColor("__indexColor").linkColor("__indexColor").isShadow(!0),colorTracker:new p_e,tweenGroup:new uI}},init:function(r,e){var i=this;r.innerHTML="";var n=document.createElement("div");n.classList.add("force-graph-container"),n.style.position="relative",r.appendChild(n),e.canvas=document.createElement("canvas"),e.backgroundColor&&(e.canvas.style.background=e.backgroundColor),n.appendChild(e.canvas),e.shadowCanvas=document.createElement("canvas");var s=e.canvas.getContext("2d"),o=e.shadowCanvas.getContext("2d",{willReadFrequently:!0}),l={x:-1e12,y:-1e12},u=function(){var p=null,f=window.devicePixelRatio,g=l.x>0&&l.y>0?o.getImageData(l.x*f,l.y*f,1,1):null;return g&&(p=e.colorTracker.lookup(g.data)),p};Sc(e.canvas).call(Oxe().subject(function(){if(!e.enableNodeDrag)return null;var p=u();return p&&p.type==="Node"?p.d:null}).on("start",function(p){var f=p.subject;f.__initialDragPos={x:f.x,y:f.y,fx:f.fx,fy:f.fy},p.active||(f.fx=f.x,f.fy=f.y),e.canvas.classList.add("grabbable")}).on("drag",function(p){var f=p.subject,g=f.__initialDragPos,m=p,y=eu(e.canvas).k,b={x:g.x+(m.x-g.x)/y-f.x,y:g.y+(m.y-g.y)/y-f.y};["x","y"].forEach(function(v){return f["f".concat(v)]=f[v]=g[v]+(m[v]-g[v])/y}),e.forceGraph.d3AlphaTarget(.3).resetCountdown(),e.isPointerDragging=!0,f.__dragged=!0,e.onNodeDrag(f,b)}).on("end",function(p){var f=p.subject,g=f.__initialDragPos,m={x:f.x-g.x,y:f.y-g.y};g.fx===void 0&&(f.fx=void 0),g.fy===void 0&&(f.fy=void 0),delete f.__initialDragPos,e.forceGraph.d3AlphaTarget()&&e.forceGraph.d3AlphaTarget(0).resetCountdown(),e.canvas.classList.remove("grabbable"),e.isPointerDragging=!1,f.__dragged&&(delete f.__dragged,e.onNodeDragEnd(f,m))})),e.zoom(e.zoom.__baseElem=Sc(e.canvas)),e.zoom.__baseElem.on("dblclick.zoom",null),e.zoom.filter(function(p){return!p.button&&e.enableZoomPanInteraction&&(p.type!=="wheel"||mr(e.enableZoomInteraction)(p))&&(p.type==="wheel"||mr(e.enablePanInteraction)(p))}).on("zoom",function(p){var f=p.transform;[s,o].forEach(function(g){aj(g),g.translate(f.x,f.y),g.scale(f.k,f.k)}),e.onZoom&&e.onZoom(qg(qg({},f),i.centerAt())),e.needsRedraw=!0}).on("end",function(p){return e.onZoomEnd&&e.onZoomEnd(qg(qg({},p.transform),i.centerAt()))}),LI(e),e.forceGraph.onNeedsRedraw(function(){return e.needsRedraw=!0}).onFinishUpdate(function(){eu(e.canvas).k===e.lastSetZoom&&e.graphData.nodes.length&&(e.zoom.scaleTo(e.zoom.__baseElem,e.lastSetZoom=P_e/Math.cbrt(e.graphData.nodes.length)),e.needsRedraw=!0)});var c=document.createElement("div");c.classList.add("graph-tooltip"),n.appendChild(c),["pointermove","pointerdown"].forEach(function(p){return n.addEventListener(p,function(f){p==="pointerdown"&&(e.isPointerPressed=!0,e.pointerDownEvent=f),!e.isPointerDragging&&f.type==="pointermove"&&e.onBackgroundClick&&(f.pressure>0||e.isPointerPressed)&&(f.pointerType!=="touch"||f.movementX===void 0||[f.movementX,f.movementY].some(function(y){return Math.abs(y)>1}))&&(e.isPointerDragging=!0);var g=m(n);l.x=f.pageX-g.left,l.y=f.pageY-g.top,c.style.top="".concat(l.y,"px"),c.style.left="".concat(l.x,"px"),c.style.transform="translate(-".concat(l.x/e.width*100,"%, ").concat(e.height-l.y<100?"calc(-100% - 8px)":"21px",")");function m(y){var b=y.getBoundingClientRect(),v=window.pageXOffset||document.documentElement.scrollLeft,_=window.pageYOffset||document.documentElement.scrollTop;return{top:b.top+_,left:b.left+v}}},{passive:!0})}),n.addEventListener("pointerup",function(p){if(e.isPointerPressed=!1,e.isPointerDragging){e.isPointerDragging=!1;return}var f=[p,e.pointerDownEvent];requestAnimationFrame(function(){if(p.button===0)if(e.hoverObj){var g=e["on".concat(e.hoverObj.type,"Click")];g&&g.apply(void 0,[e.hoverObj.d].concat(f))}else e.onBackgroundClick&&e.onBackgroundClick.apply(e,f);if(p.button===2)if(e.hoverObj){var m=e["on".concat(e.hoverObj.type,"RightClick")];m&&m.apply(void 0,[e.hoverObj.d].concat(f))}else e.onBackgroundRightClick&&e.onBackgroundRightClick.apply(e,f)})},{passive:!0}),n.addEventListener("contextmenu",function(p){return!e.onBackgroundRightClick&&!e.onNodeRightClick&&!e.onLinkRightClick?!0:(p.preventDefault(),!1)}),e.forceGraph(s),e.shadowGraph(o);var h=Z1e(function(){oj(o,e.width,e.height),e.shadowGraph.linkWidth(function(f){return mr(e.linkWidth)(f)+e.linkHoverPrecision});var p=eu(e.canvas);e.shadowGraph.globalScale(p.k).tickFrame()},N_e);e.flushShadowCanvas=h.flush,(this._animationCycle=function p(){var f=!e.autoPauseRedraw||!!e.needsRedraw||e.forceGraph.isEngineRunning()||e.graphData.links.some(function(C){return C.__photons&&C.__photons.length});if(e.needsRedraw=!1,e.enablePointerInteraction){var g=e.isPointerDragging?null:u();if(g!==e.hoverObj){var m=e.hoverObj,y=m?m.type:null,b=g?g.type:null;if(y&&y!==b){var v=e["on".concat(y,"Hover")];v&&v(null,m.d)}if(b){var _=e["on".concat(b,"Hover")];_&&_(g.d,y===b?m.d:null)}var T=g&&mr(e["".concat(g.type.toLowerCase(),"Label")])(g.d)||"";c.style.visibility=T?"visible":"hidden",c.innerHTML=T,e.canvas.classList[g&&e["on".concat(b,"Click")]||!g&&e.onBackgroundClick?"add":"remove"]("clickable"),e.hoverObj=g}f&&h()}if(f){oj(s,e.width,e.height);var E=eu(e.canvas).k;e.onRenderFramePre&&e.onRenderFramePre(s,E),e.forceGraph.globalScale(E).tickFrame(),e.onRenderFramePost&&e.onRenderFramePost(s,E)}e.tweenGroup.update(),e.animationFrameRequestId=requestAnimationFrame(p)})()},update:function(r){}}),tE={width:bt.number,height:bt.number,graphData:bt.shape({nodes:bt.arrayOf(bt.object).isRequired,links:bt.arrayOf(bt.object).isRequired}),backgroundColor:bt.string,nodeRelSize:bt.number,nodeId:bt.string,nodeLabel:bt.oneOfType([bt.string,bt.func]),nodeVal:bt.oneOfType([bt.number,bt.string,bt.func]),nodeVisibility:bt.oneOfType([bt.bool,bt.string,bt.func]),nodeColor:bt.oneOfType([bt.string,bt.func]),nodeAutoColorBy:bt.oneOfType([bt.string,bt.func]),onNodeHover:bt.func,onNodeClick:bt.func,linkSource:bt.string,linkTarget:bt.string,linkLabel:bt.oneOfType([bt.string,bt.func]),linkVisibility:bt.oneOfType([bt.bool,bt.string,bt.func]),linkColor:bt.oneOfType([bt.string,bt.func]),linkAutoColorBy:bt.oneOfType([bt.string,bt.func]),linkWidth:bt.oneOfType([bt.number,bt.string,bt.func]),linkCurvature:bt.oneOfType([bt.number,bt.string,bt.func]),linkDirectionalArrowLength:bt.oneOfType([bt.number,bt.string,bt.func]),linkDirectionalArrowColor:bt.oneOfType([bt.string,bt.func]),linkDirectionalArrowRelPos:bt.oneOfType([bt.number,bt.string,bt.func]),linkDirectionalParticles:bt.oneOfType([bt.number,bt.string,bt.func]),linkDirectionalParticleSpeed:bt.oneOfType([bt.number,bt.string,bt.func]),linkDirectionalParticleWidth:bt.oneOfType([bt.number,bt.string,bt.func]),linkDirectionalParticleColor:bt.oneOfType([bt.string,bt.func]),onLinkHover:bt.func,onLinkClick:bt.func,dagMode:bt.oneOf(["td","bu","lr","rl","zin","zout","radialin","radialout"]),dagLevelDistance:bt.number,dagNodeFilter:bt.func,onDagError:bt.func,d3AlphaMin:bt.number,d3AlphaDecay:bt.number,d3VelocityDecay:bt.number,warmupTicks:bt.number,cooldownTicks:bt.number,cooldownTime:bt.number,onEngineTick:bt.func,onEngineStop:bt.func,getGraphBbox:bt.func},lj={zoomToFit:bt.func,onNodeRightClick:bt.func,onNodeDrag:bt.func,onNodeDragEnd:bt.func,onLinkRightClick:bt.func,linkHoverPrecision:bt.number,onBackgroundClick:bt.func,onBackgroundRightClick:bt.func,enablePointerInteraction:bt.bool,enableNodeDrag:bt.bool},DI={showNavInfo:bt.bool,nodeOpacity:bt.number,nodeResolution:bt.number,nodeThreeObject:bt.oneOfType([bt.object,bt.string,bt.func]),nodeThreeObjectExtend:bt.oneOfType([bt.bool,bt.string,bt.func]),linkOpacity:bt.number,linkResolution:bt.number,linkCurveRotation:bt.oneOfType([bt.number,bt.string,bt.func]),linkMaterial:bt.oneOfType([bt.object,bt.string,bt.func]),linkThreeObject:bt.oneOfType([bt.object,bt.string,bt.func]),linkThreeObjectExtend:bt.oneOfType([bt.bool,bt.string,bt.func]),linkPositionUpdate:bt.func,linkDirectionalArrowResolution:bt.number,linkDirectionalParticleResolution:bt.number,forceEngine:bt.oneOf(["d3","ngraph"]),ngraphPhysics:bt.object,numDimensions:bt.oneOf([1,2,3])},z_e=Object.assign({},tE,lj,{linkLineDash:bt.oneOfType([bt.arrayOf(bt.number),bt.string,bt.func]),nodeCanvasObjectMode:bt.oneOfType([bt.string,bt.func]),nodeCanvasObject:bt.func,nodePointerAreaPaint:bt.func,linkCanvasObjectMode:bt.oneOfType([bt.string,bt.func]),linkCanvasObject:bt.func,linkPointerAreaPaint:bt.func,autoPauseRedraw:bt.bool,minZoom:bt.number,maxZoom:bt.number,enableZoomInteraction:bt.oneOfType([bt.bool,bt.func]),enablePanInteraction:bt.oneOfType([bt.bool,bt.func]),onZoom:bt.func,onZoomEnd:bt.func,onRenderFramePre:bt.func,onRenderFramePost:bt.func}),j_e=Object.assign({},tE,lj,DI,{enableNavigationControls:bt.bool,controlType:bt.oneOf(["trackball","orbit","fly"]),rendererConfig:bt.object,extraRenderers:bt.arrayOf(bt.shape({render:bt.func.isRequired}))}),V_e=Object.assign({},tE,DI,{nodeDesc:bt.oneOfType([bt.string,bt.func]),linkDesc:bt.oneOfType([bt.string,bt.func])}),G_e=Object.assign({},tE,DI,{markerAttrs:bt.object,yOffset:bt.number,glScale:bt.number});const cj=l1(N5,{methodNames:["getGraphBbox","emitParticle","d3Force","d3ReheatSimulation","refresh"]});cj.displayName="ForceGraphVR",cj.propTypes=V_e;const uj=l1(Fce,{methodNames:["getGraphBbox","emitParticle","d3Force","d3ReheatSimulation","refresh"],initPropNames:["markerAttrs"]});uj.displayName="ForceGraphAR",uj.propTypes=G_e;const NI=l1(Jve,{methodNames:["emitParticle","d3Force","d3ReheatSimulation","stopAnimation","pauseAnimation","resumeAnimation","cameraPosition","zoomToFit","getGraphBbox","screen2GraphCoords","graph2ScreenCoords","postProcessingComposer","lights","scene","camera","renderer","controls","refresh"],initPropNames:["controlType","rendererConfig","extraRenderers"]});NI.displayName="ForceGraph3D",NI.propTypes=j_e;const PI=l1(U_e,{methodNames:["emitParticle","d3Force","d3ReheatSimulation","stopAnimation","pauseAnimation","resumeAnimation","centerAt","zoom","zoomToFit","getGraphBbox","screen2GraphCoords","graph2ScreenCoords"]});PI.displayName="ForceGraph2D",PI.propTypes=z_e;const H_e={position:"absolute",pointerEvents:"none",background:Ps.PREDICATE,color:"#fff",border:`2px solid ${Ps.PREDICATE}`,borderRadius:8,padding:"6px 14px",fontSize:15,fontWeight:"bold",zIndex:1e4,boxShadow:"0 2px 8px rgba(0,0,0,0.18)",whiteSpace:"nowrap",maxWidth:260,overflow:"hidden",textOverflow:"ellipsis"},W_e=16,hj=32,Q_e=({graphData:r,onNodeClick:e,onEngineStop:i,fgRef:n,tabs:s,activeTab:o,onTabChange:l,children:u,drawerOpen:c,drawerContent:h,onDrawerClose:p,sidebarOpen:f,sidebarContent:g,onSidebarClose:m,selectedTriple:y,endpoint:b})=>{const v=Ct.useRef(),[_,T]=Ct.useState(null),[E,C]=Ct.useState(null),[R,B]=Ct.useState({x:0,y:0}),[I,N]=Ct.useState({width:100,height:100}),[D,P]=Ct.useState(new Map);Ct.useEffect(()=>{const Q=()=>{v.current&&N({width:v.current.clientWidth,height:v.current.clientHeight})};return Q(),window.addEventListener("resize",Q),()=>window.removeEventListener("resize",Q)},[]),Ct.useEffect(()=>{r.nodes.forEach(Q=>{if(Q.image&&!D.has(Q.image)){const W=new Image;W.crossOrigin="anonymous",W.src=Q.image,W.onload=()=>{P(G=>new Map(G).set(Q.image,W)),n.current&&n.current.emit("redraw")}}})},[r.nodes]);const k=Ct.useCallback(()=>{T(null),C(null)},[]),q=Ct.useCallback(Q=>{if(v.current){const W=v.current.getBoundingClientRect();B({x:Q.clientX-W.left,y:Q.clientY-W.top})}},[]),V=Ct.useCallback(()=>{T(null),C(null)},[]),j=()=>{if(!v.current)return{left:R.x,top:R.y};const Q=v.current.getBoundingClientRect(),W=180,G=36;let z=R.x+W_e,te=R.y-hj;return z+W>Q.width&&(z=Q.width-W-8),z<0&&(z=8),te<0&&(te=R.y+hj),te+G>Q.height&&(te=Q.height-G-8),{left:z,top:te}};return De.jsxs("div",{ref:v,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden"},onMouseMove:q,children:[De.jsx(PI,{ref:n,graphData:r,width:I.width,height:I.height,nodeCanvasObject:(Q,W,G)=>{const z=44/G*Math.pow(G,.15);if(Q.type==="object")if(Q.image){if(W.save(),W.beginPath(),W.rect(Q.x-z/2,Q.y-z/2,z,z),W.closePath(),W.strokeStyle=Q.color,W.lineWidth=3/G,W.stroke(),W.clip(),!Q.__img){const te=new window.Image;te.crossOrigin="anonymous",te.src=Q.image,te.onload=()=>{Q.__imgLoaded=!0,n&&n.current&&n.current.emit&&n.current.emit("redraw")},Q.__img=te,Q.__imgLoaded=!1}Q.__imgLoaded?W.drawImage(Q.__img,Q.x-z/2,Q.y-z/2,z,z):(W.fillStyle=Q.color||"#888",W.fillRect(Q.x-z/2,Q.y-z/2,z,z)),W.restore()}else{W.save(),W.beginPath(),W.rect(Q.x-z/2,Q.y-z/2,z,z),W.closePath(),W.fillStyle=Q.color+"CC",W.fill(),W.strokeStyle=Q.color,W.lineWidth=3/G,W.stroke();const te=(Q.label||"?").substring(0,3),Y=20/G;W.font=`bold ${Y}px Sans-Serif`,W.fillStyle="#fff",W.textAlign="center",W.textBaseline="middle",W.fillText(te,Q.x,Q.y+z*.04),W.restore()}else if(Q.image){if(!Q.__img){const te=new window.Image;te.src=Q.image,te.onload=()=>{Q.__imgLoaded=!0,n&&n.current&&n.current.emit&&n.current.emit("redraw")},Q.__img=te,Q.__imgLoaded=!1}W.save(),W.beginPath(),W.arc(Q.x,Q.y,z/2,0,2*Math.PI,!1),W.closePath(),W.lineWidth=3/G,W.strokeStyle=Q.color,W.stroke(),W.clip(),Q.__imgLoaded?W.drawImage(Q.__img,Q.x-z/2,Q.y-z/2,z,z):(W.fillStyle=Q.color||"#888",W.fill()),W.restore()}else{W.save(),W.beginPath(),W.arc(Q.x,Q.y,z/2,0,2*Math.PI,!1),W.closePath(),W.fillStyle=Q.color+"CC",W.fill(),W.strokeStyle=Q.color,W.lineWidth=3/G,W.stroke();const te=(Q.label||"?").substring(0,3),Y=20/G;W.font=`bold ${Y}px Sans-Serif`,W.fillStyle="#fff",W.textAlign="center",W.textBaseline="middle",W.fillText(te,Q.x,Q.y+z*.04),W.restore()}},nodePointerAreaPaint:(Q,W,G,z)=>{const te=44/z*Math.pow(z,.15);G.fillStyle=W,Q.type==="object"?(G.beginPath(),G.rect(Q.x-te/2,Q.y-te/2,te,te),G.closePath(),G.fill()):(G.beginPath(),G.arc(Q.x,Q.y,te/2,0,2*Math.PI,!1),G.closePath(),G.fill())},linkColor:()=>"rgba(255, 211, 42, 0.15)",linkDirectionalParticles:1,linkDirectionalParticleSpeed:.01,linkDirectionalParticleColor:()=>"rgba(255,255,255,0.5)",nodeAutoColorBy:"type",onNodeClick:e,onEngineStop:i,onNodeHover:C,onLinkHover:T,onBackgroundClick:V,onZoom:k}),_&&_.label?De.jsx("div",{style:{...H_e,...j(),pointerEvents:"none"},children:_.label}):E&&E.label?De.jsx("div",{style:{position:"absolute",left:R.x+18,top:R.y-10,background:"#232326",color:"#fff",border:"1.5px solid #ffd32a",borderRadius:8,padding:"6px 14px",fontSize:15,fontWeight:"bold",zIndex:10001,boxShadow:"0 2px 8px rgba(0,0,0,0.18)",pointerEvents:"none",whiteSpace:"nowrap",maxWidth:260,overflow:"hidden",textOverflow:"ellipsis"},children:E.label}):null,y&&De.jsx("div",{style:{position:"absolute",top:80,right:30,width:350,zIndex:9999,maxHeight:"80vh",background:"#18181b",borderRadius:"10px",border:"3px solid #ffd32a",boxShadow:"0 8px 30px rgba(0, 0, 0, 0.5)",overflowY:"auto"},children:De.jsx(dM,{triple:y,endpoint:b,onClose:()=>e(null)})}),s&&De.jsx("div",{style:{position:"absolute",left:0,right:0,bottom:0,zIndex:2e3,display:"flex",justifyContent:"center",alignItems:"center",gap:36,padding:"0 0 4px 0",height:54},children:s.map(Q=>De.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",cursor:"pointer",minWidth:120},onClick:()=>l(Q.key),children:[De.jsx("span",{style:{color:o===Q.key?"#ffd32a":"#fff",fontWeight:o===Q.key?"bold":"normal",fontSize:17,letterSpacing:.5,padding:"8px 0 2px 0",transition:"color 0.2s, font-weight 0.2s"},children:Q.label}),De.jsx("div",{style:{height:3,width:"80%",background:o===Q.key?"#ffd32a":"transparent",borderRadius:2,transition:"background 0.2s"}})]},Q.key||"map"))}),De.jsx("div",{style:{position:"absolute",left:0,right:0,bottom:0,height:c?"33.33vh":0,backgroundColor:"#18181b",borderTopLeftRadius:18,borderTopRightRadius:18,transition:"height 0.35s cubic-bezier(0.4, 1.3, 0.5, 1)",zIndex:1300,boxShadow:"0 -2px 16px rgba(0, 0, 0, 0.18)",border:"2px solid #ffd32a",overflow:"hidden"},children:c&&De.jsxs(De.Fragment,{children:[De.jsx("button",{style:{background:"none",border:"none",color:"#ffd32a",fontSize:32,position:"absolute",top:10,right:18,cursor:"pointer",zIndex:1302,transition:"color 0.2s"},onClick:p,children:"×"}),De.jsx("div",{style:{padding:"48px 24px 24px 24px",overflowY:"auto",height:"100%",color:"#ffd32a"},children:h})]})}),De.jsx("div",{style:{position:"absolute",top:0,left:0,bottom:0,width:f?"16.67vw":0,minWidth:f?"250px":0,backgroundColor:"#18181b",borderTopRightRadius:18,borderBottomRightRadius:18,transition:"width 0.35s cubic-bezier(0.4, 1.3, 0.5, 1)",zIndex:1300,boxShadow:"2px 0 16px rgba(0, 0, 0, 0.18)",border:"2px solid #ffd32a",overflow:"hidden"},children:f&&De.jsxs(De.Fragment,{children:[De.jsx("button",{style:{background:"none",border:"none",color:"#ffd32a",fontSize:32,position:"absolute",top:10,right:18,cursor:"pointer",zIndex:1302,transition:"color 0.2s"},onClick:m,children:"×"}),De.jsx("div",{style:{padding:"48px 24px 24px 24px",overflowY:"auto",height:"100%",color:"#ffd32a"},children:g})]})}),(c||f)&&De.jsx("div",{style:{position:"absolute",inset:0,backgroundColor:"rgba(0, 0, 0, 0.35)",zIndex:1200,pointerEvents:"auto"},onClick:c?p:m}),De.jsx("div",{style:{position:"relative",zIndex:2e3},children:u})]})};var q_e=typeof window<"u"&&window.THREE?window.THREE:{Sprite:Fte};q_e.Sprite;const X_e=({graphData:r,onNodeClick:e,onEngineStop:i,fgRef:n,tabs:s,activeTab:o,onTabChange:l,children:u,drawerOpen:c,drawerContent:h,onDrawerClose:p,sidebarOpen:f,sidebarContent:g,onSidebarClose:m,selectedTriple:y,endpoint:b})=>{const v=Ct.useRef(),[_,T]=Ct.useState({width:100,height:100}),[E,C]=Ct.useState(null),[R,B]=Ct.useState(null),[I,N]=Ct.useState({x:0,y:0}),D=Ct.useRef(new Map);Ct.useEffect(()=>{const k=()=>{v.current&&T({width:v.current.clientWidth,height:v.current.clientHeight})};return k(),window.addEventListener("resize",k),()=>window.removeEventListener("resize",k)},[]);const P=k=>{if(D.current.has(k.id))return D.current.get(k.id);const q=128,V=document.createElement("canvas");V.width=V.height=q;const j=V.getContext("2d");if(j.clearRect(0,0,q,q),k.image){const G=new window.Image;G.crossOrigin="anonymous",G.src=k.image,G.onload=()=>{if(j.clearRect(0,0,q,q),k.type==="object"){j.fillStyle=Of(k.type)+"CC",j.fillRect(0,0,q,q);const z=Math.max(q/G.width,q/G.height),te=G.width*z,Y=G.height*z;j.drawImage(G,q/2-te/2,q/2-Y/2,te,Y)}else{j.save(),j.beginPath(),j.arc(q/2,q/2,q/2,0,2*Math.PI),j.closePath(),j.clip(),j.fillStyle=Of(k.type)+"CC",j.fillRect(0,0,q,q);const z=Math.max(q/G.width,q/G.height),te=G.width*z,Y=G.height*z;j.drawImage(G,q/2-te/2,q/2-Y/2,te,Y),j.restore()}Q.needsUpdate=!0,n.current&&n.current.emit("redraw")}}else{k.type==="object"?(j.fillStyle=Of(k.type)+"CC",j.fillRect(0,0,q,q)):(j.save(),j.beginPath(),j.arc(q/2,q/2,q/2,0,2*Math.PI),j.closePath(),j.clip(),j.fillStyle=Of(k.type)+"CC",j.fillRect(0,0,q,q),j.restore());const G=(k.label||"?").substring(0,3);j.font="bold 48px Sans-Serif",j.fillStyle="#fff",j.textAlign="center",j.textBaseline="middle",j.fillText(G,q/2,q/2+6)}const Q=new Dl(V);Q.needsUpdate=!0;const W=new Nu({map:Q,transparent:!0});return D.current.set(k.id,W),W};return De.jsxs("div",{ref:v,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden"},onMouseMove:k=>{if(v.current){const q=v.current.getBoundingClientRect();N({x:k.clientX-q.left,y:k.clientY-q.top})}},children:[De.jsx(NI,{ref:n,graphData:r,width:_.width,height:_.height,controlType:"fly",backgroundColor:"rgba(0,0,0,0)",nodeLabel:"",onNodeClick:e,linkColor:()=>"rgba(255, 211, 42, 0.15)",linkDirectionalParticles:2,linkDirectionalParticleSpeed:.0025,linkDirectionalParticleColor:()=>"rgba(255,255,255,0.5)",nodeAutoColorBy:"type",nodeThreeObject:k=>{const q=new xp,V=P(k);let j;return k.type==="object"?j=new pa(new vA(16,16),V):j=new pa(new YS(16/2,48),V),q.add(j),q},onEngineStop:i,onNodeHover:C,onLinkHover:B,onBackgroundClick:()=>{B(null),C(null)},onZoom:()=>{B(null),C(null)}}),y&&De.jsx("div",{style:{position:"absolute",top:80,right:30,width:350,zIndex:9999,maxHeight:"80vh",background:"#18181b",borderRadius:"10px",border:"3px solid #ffd32a",boxShadow:"0 8px 30px rgba(0, 0, 0, 0.5)",overflowY:"auto"},children:De.jsx(dM,{triple:y,endpoint:b,onClose:()=>e(null)})}),s&&De.jsx("div",{style:{position:"absolute",left:0,right:0,bottom:0,zIndex:2e3,display:"flex",justifyContent:"center",alignItems:"center",gap:36,padding:"0 0 4px 0",height:54},children:s.map(k=>De.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",cursor:"pointer",minWidth:120},onClick:()=>l(k.key),children:[De.jsx("span",{style:{color:o===k.key?"#ffd32a":"#fff",fontWeight:o===k.key?"bold":"normal",fontSize:17,letterSpacing:.5,padding:"8px 0 2px 0",transition:"color 0.2s, font-weight 0.2s"},children:k.label}),De.jsx("div",{style:{height:3,width:"80%",background:o===k.key?"#ffd32a":"transparent",borderRadius:2,transition:"background 0.2s"}})]},k.key||"map"))}),De.jsx("div",{style:{position:"absolute",left:0,right:0,bottom:0,height:c?"33.33vh":0,backgroundColor:"#18181b",borderTopLeftRadius:18,borderTopRightRadius:18,transition:"height 0.35s cubic-bezier(0.4, 1.3, 0.5, 1)",zIndex:1300,boxShadow:"0 -2px 16px rgba(0, 0, 0, 0.18)",border:"2px solid #ffd32a",overflow:"hidden"},children:c&&De.jsxs(De.Fragment,{children:[De.jsx("button",{style:{background:"none",border:"none",color:"#ffd32a",fontSize:32,position:"absolute",top:10,right:18,cursor:"pointer",zIndex:1302,transition:"color 0.2s"},onClick:p,children:"×"}),De.jsx("div",{style:{padding:"48px 24px 24px 24px",overflowY:"auto",height:"100%",color:"#ffd32a"},children:h})]})}),De.jsx("div",{style:{position:"absolute",top:0,left:0,bottom:0,width:f?"16.67vw":0,minWidth:f?"250px":0,backgroundColor:"#18181b",borderTopRightRadius:18,borderBottomRightRadius:18,transition:"width 0.35s cubic-bezier(0.4, 1.3, 0.5, 1)",zIndex:1300,boxShadow:"2px 0 16px rgba(0, 0, 0, 0.18)",border:"2px solid #ffd32a",overflow:"hidden"},children:f&&De.jsxs(De.Fragment,{children:[De.jsx("button",{style:{background:"none",border:"none",color:"#ffd32a",fontSize:32,position:"absolute",top:10,right:18,cursor:"pointer",zIndex:1302,transition:"color 0.2s"},onClick:m,children:"×"}),De.jsx("div",{style:{padding:"48px 24px 24px 24px",overflowY:"auto",height:"100%",color:"#ffd32a"},children:g})]})}),(c||f)&&De.jsx("div",{style:{position:"absolute",inset:0,backgroundColor:"rgba(0, 0, 0, 0.35)",zIndex:1200,pointerEvents:"auto"},onClick:c?p:m}),De.jsx("div",{style:{position:"relative",zIndex:2e3},children:u}),R&&R.label?De.jsx("div",{style:{position:"absolute",left:I.x+18,top:I.y-10,background:Ps.PREDICATE,color:"#fff",border:`1.5px solid ${Ps.PREDICATE}`,borderRadius:8,padding:"6px 14px",fontSize:15,fontWeight:"bold",zIndex:10001,boxShadow:"0 2px 8px rgba(0,0,0,0.18)",pointerEvents:"none",whiteSpace:"nowrap",maxWidth:260,overflow:"hidden",textOverflow:"ellipsis"},children:R.label}):E&&E.label?De.jsx("div",{style:{position:"absolute",left:I.x+18,top:I.y-10,background:"#232326",color:"#fff",border:"1.5px solid #ffd32a",borderRadius:8,padding:"6px 14px",fontSize:15,fontWeight:"bold",zIndex:10001,boxShadow:"0 2px 8px rgba(0,0,0,0.18)",pointerEvents:"none",whiteSpace:"nowrap",maxWidth:260,overflow:"hidden",textOverflow:"ellipsis"},children:E.label}):null]})};var dj={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},pj=Ct.createContext&&Ct.createContext(dj),Y_e=["attr","size","title"];function K_e(r,e){if(r==null)return{};var i=J_e(r,e),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(r);for(s=0;s<o.length;s++)n=o[s],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(r,n)&&(i[n]=r[n])}return i}function J_e(r,e){if(r==null)return{};var i={};for(var n in r)if(Object.prototype.hasOwnProperty.call(r,n)){if(e.indexOf(n)>=0)continue;i[n]=r[n]}return i}function iE(){return iE=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r[n]=i[n])}return r},iE.apply(this,arguments)}function fj(r,e){var i=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),i.push.apply(i,n)}return i}function rE(r){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?fj(Object(i),!0).forEach(function(n){Z_e(r,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):fj(Object(i)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(i,n))})}return r}function Z_e(r,e,i){return e=$_e(e),e in r?Object.defineProperty(r,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[e]=i,r}function $_e(r){var e=eEe(r,"string");return typeof e=="symbol"?e:e+""}function eEe(r,e){if(typeof r!="object"||!r)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var n=i.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function mj(r){return r&&r.map((e,i)=>Ct.createElement(e.tag,rE({key:i},e.attr),mj(e.child)))}function ev(r){return e=>Ct.createElement(tEe,iE({attr:rE({},r.attr)},e),mj(r.child))}function tEe(r){var e=i=>{var{attr:n,size:s,title:o}=r,l=K_e(r,Y_e),u=s||i.size||"1em",c;return i.className&&(c=i.className),r.className&&(c=(c?c+" ":"")+r.className),Ct.createElement("svg",iE({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},i.attr,n,l,{className:c,style:rE(rE({color:r.color||i.color},i.style),r.style),height:u,width:u,xmlns:"http://www.w3.org/2000/svg"}),o&&Ct.createElement("title",null,o),r.children)};return pj!==void 0?Ct.createElement(pj.Consumer,null,i=>e(i)):e(dj)}function iEe(r){return ev({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M200,154a29.87,29.87,0,0,0-19.5,7.23L154.88,141.3A29.83,29.83,0,0,0,158,128a30.52,30.52,0,0,0-.22-3.6L174,119a30,30,0,1,0-4-15,30.52,30.52,0,0,0,.22,3.6L154,113a29.91,29.91,0,0,0-32.42-14.31l-8.14-18.3a30,30,0,1,0-11,4.88l8.14,18.3A29.92,29.92,0,0,0,102.06,143L74,168a30.08,30.08,0,1,0,8,9L110,152a29.91,29.91,0,0,0,37.47-1.23l25.62,19.93A30,30,0,1,0,200,154Zm0-68a18,18,0,1,1-18,18A18,18,0,0,1,200,86ZM78,56A18,18,0,1,1,96,74,18,18,0,0,1,78,56ZM56,210a18,18,0,1,1,18-18A18,18,0,0,1,56,210Zm72-64a18,18,0,1,1,18-18A18,18,0,0,1,128,146Zm72,56a18,18,0,1,1,18-18A18,18,0,0,1,200,202Z"},child:[]}]})(r)}function rEe(r){return ev({attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M311.9 260.8L160 353.6 8 260.8 160 0l151.9 260.8zM160 383.4L8 290.6 160 512l152-221.4-152 92.8z"},child:[]}]})(r)}function nEe(r){return ev({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M257.5 445.1l-22.2 22.2c-9.4 9.4-24.6 9.4-33.9 0L7 273c-9.4-9.4-9.4-24.6 0-33.9L201.4 44.7c9.4-9.4 24.6-9.4 33.9 0l22.2 22.2c9.5 9.5 9.3 25-.4 34.3L136.6 216H424c13.3 0 24 10.7 24 24v32c0 13.3-10.7 24-24 24H136.6l120.5 114.8c9.8 9.3 10 24.8.4 34.3z"},child:[]}]})(r)}function sEe(r){return ev({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z"},child:[]}]})(r)}function aEe(r){return ev({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"},child:[]}]})(r)}const gj={background:"#ffd32a",color:"#18181b",border:"none",borderRadius:12,width:44,height:44,fontSize:22,fontWeight:"bold",boxShadow:"0 2px 8px rgba(0,0,0,0.18)",cursor:"pointer",marginBottom:0,marginTop:0,textTransform:"uppercase",display:"flex",alignItems:"center",justifyContent:"center",padding:0,transition:"background 0.2s, color 0.2s, transform 0.1s"},oEe={background:"#ffe066",color:"#18181b",transform:"translateY(-2px) scale(1.03)"},lEe=({onReset:r,onBack:e,onForward:i,canGoBack:n,canGoForward:s,onMyView:o})=>{const[l,u]=Ct.useState(""),c=h=>l===h?{...gj,...oEe}:gj;return De.jsxs("div",{style:{position:"absolute",top:"18px",left:"18px",zIndex:50,display:"flex",flexDirection:"row",gap:"12px",alignItems:"center"},children:[De.jsx("button",{style:c("profile"),onClick:o,"aria-label":"Profile",onMouseEnter:()=>u("profile"),onMouseLeave:()=>u(""),children:De.jsx(aEe,{})}),De.jsx("button",{style:{...c("graph"),width:54},onClick:r,"aria-label":"Return to graph",onMouseEnter:()=>u("graph"),onMouseLeave:()=>u(""),children:De.jsx(iEe,{size:28})}),De.jsx("button",{style:{...c("prev"),opacity:n?1:.5},onClick:e,disabled:!n,"aria-label":"Previous",onMouseEnter:()=>u("prev"),onMouseLeave:()=>u(""),children:De.jsx(nEe,{})}),De.jsx("button",{style:{...c("next"),opacity:s?1:.5},onClick:i,disabled:!s,"aria-label":"Next",onMouseEnter:()=>u("next"),onMouseLeave:()=>u(""),children:De.jsx(sEe,{})})]})},cEe=({viewMode:r,onViewModeChange:e})=>De.jsxs("div",{className:"agent-navbar",style:{display:"flex",alignItems:"center",gap:"10px",background:"#18181b",border:"2px solid #ffd32a",borderRadius:"10px",padding:"6px 16px",color:"#ffd32a",fontWeight:"bold",fontSize:"15px",boxShadow:"0 2px 8px rgba(0,0,0,0.18)"},children:[De.jsx("label",{htmlFor:"viewMode",style:{color:"#ffd32a",marginRight:8},children:"View Mode:"}),De.jsxs("select",{id:"viewMode",value:r,onChange:i=>e(i.target.value),style:{background:"#232326",color:"#ffd32a",border:"1.5px solid #ffd32a",borderRadius:6,padding:"4px 10px",fontWeight:"bold",fontSize:15,outline:"none",cursor:"pointer"},children:[De.jsx("option",{value:"2D",children:"2D"}),De.jsx("option",{value:"3D",children:"3D"}),De.jsx("option",{value:"VR",children:"VR"})]})]}),nE=r=>{const e=[],i=[],n=new Map;return r.forEach(({subject:s,predicate:o,object:l})=>{if(!n.has(s.id)){const u={id:s.id,label:s.label,image:s.image,isTriple:!1,color:Of("subject"),type:"subject"};n.set(s.id,u),e.push(u)}if(!n.has(l.id)){const u={id:l.id,label:l.label,image:l.image,isTriple:!1,color:Of("object"),type:"object"};n.set(l.id,u),e.push(u)}i.push({source:s.id,target:l.id,type:"subject-to-object",label:o.label,predicateId:o.id})}),{nodes:e,links:i}},uEe=32890,hEe=(r,e="base")=>{const[i,n]=Ct.useState({nodes:[],links:[]}),[s,o]=Ct.useState(null),[l,u]=Ct.useState(!0),[c,h]=Ct.useState(null),[p,f]=Ct.useState(!1),[g,m]=Ct.useState([]),[y,b]=Ct.useState(0),v=Ct.useRef(null),[_,T]=Ct.useState(""),[E,C]=Ct.useState(""),[R,B]=Ct.useState(""),[I,N]=Ct.useState(!1),[D,P]=Ct.useState(!1),k=Ct.useCallback(async()=>{f(!0);try{let z;e==="agent"?z=await ece(uEe,r):z=await hM(r);const te=nE(z);n(te),o(te)}catch(z){console.error("Error loading graph data:",z)}finally{f(!1)}},[r,e]),q=Ct.useCallback(()=>{n(s),h(null),T(""),C(""),B(""),P(!1)},[s]),V=Ct.useCallback(async(z,te,Y)=>{if(z===null){h(null);return}if(h(z),te&&te.current)try{const se={x:z.x,y:z.y,z:z.z||0},ve=await Jle(z.id,r),Ae=nE(ve),me=Ae.nodes.find(Oe=>Oe.id===z.id);me&&(me.x=se.x,me.y=se.y,Y==="3D"&&(me.z=se.z),me.fx=se.x,me.fy=se.y,Y==="3D"&&(me.fz=se.z)),m(Oe=>{const Xe=Oe.slice(0,y+1);return Xe.push({graphData:i,selectedTriple:z}),Xe}),b(Oe=>Oe+1),n(Ae)}catch(se){console.error("Error fetching triples:",se)}},[r,i,y]),j=Ct.useCallback((z,te)=>{switch(v.current&&clearTimeout(v.current),z){case"subject":T(te);break;case"predicate":C(te);break;case"object":B(te);break}v.current=setTimeout(()=>{P(!0)},500)},[]),Q=Ct.useCallback(async()=>{if(D){if(!_&&!E&&!R){q();return}N(!0);try{const z=await Ym({subject:_,predicate:E,object:R},r);if(!z||z.length===0){n({nodes:[],links:[]});return}const te=nE(z);n(te),m(Y=>{const se=Y.slice(0,y+1);return se.push({graphData:te,selectedTriple:null}),se}),b(Y=>Y+1)}catch(z){console.error("Error searching triples:",z)}finally{N(!1),P(!1)}}},[_,E,R,r,q,y,D]),W=Ct.useCallback(()=>{if(y>0){const{graphData:z,selectedTriple:te}=g[y-1];n(z),h(te),b(Y=>Y-1)}},[y,g]),G=Ct.useCallback(()=>{if(y<g.length-1){const{graphData:z,selectedTriple:te}=g[y+1];n(z),h(te),b(Y=>Y+1)}},[y,g]);return{graphData:i,initialGraphData:s,isInitialLoad:l,selectedTriple:c,isLoading:p,isSearching:I,subjectFilter:_,predicateFilter:E,objectFilter:R,shouldSearch:D,canGoBack:y>0,canGoForward:y<g.length-1,setSelectedTriple:h,setIsInitialLoad:u,loadInitialData:k,resetGraph:q,handleNodeClick:V,handleFilterChange:j,applyFilters:Q,goBack:W,goForward:G,setGraphData:n,graphHistory:g,setGraphHistory:m,currentHistoryIndex:y,setCurrentHistoryIndex:b}};function dEe({open:r,onClose:e,children:i,height:n=400}){return Ct.useEffect(()=>(r?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[r]),De.jsxs(De.Fragment,{children:[De.jsx("div",{className:`drawer-backdrop${r?" open":""}`,onClick:e,"aria-hidden":!r}),De.jsxs("div",{className:`drawer-panel${r?" open":""}`,style:{height:n},role:"dialog","aria-modal":"true",children:[De.jsx("button",{className:"drawer-close-btn",onClick:e,"aria-label":"Close",children:"×"}),De.jsx("div",{className:"drawer-content",children:i})]})]})}function pEe({open:r,onClose:e,children:i,width:n=350}){return Ct.useEffect(()=>(r?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[r]),De.jsxs(De.Fragment,{children:[De.jsx("div",{className:`drawer-backdrop${r?" open":""}`,onClick:e,"aria-hidden":!r}),De.jsxs("div",{className:`sidebar-drawer-panel${r?" open":""}`,style:{width:n},role:"dialog","aria-modal":"true",children:[De.jsx("button",{className:"drawer-close-btn",onClick:e,"aria-label":"Close",children:"×"}),De.jsx("div",{className:"drawer-content",children:i})]})]})}const fEe=({claim:r})=>De.jsxs("div",{style:{background:"#232326",borderRadius:14,padding:"18px 24px",marginBottom:18,boxShadow:"0 2px 12px rgba(0,0,0,0.13)",display:"flex",alignItems:"center",gap:18,borderLeft:"6px solid #ffd32a",transition:"box-shadow 0.2s, border-color 0.2s",position:"relative"},className:"claim-card",children:[De.jsxs("div",{style:{flex:1},children:[De.jsxs("div",{style:{display:"flex",gap:10,marginBottom:8},children:[De.jsx("span",{style:{color:"#ffd32a",fontWeight:700},children:"Subject:"}),De.jsx("span",{style:{color:"#fff"},children:r.subject.label}),De.jsx("span",{style:{color:"#ffd32a",fontWeight:700,marginLeft:12},children:"Predicate:"}),De.jsx("span",{style:{color:"#fff"},children:r.predicate.label}),De.jsx("span",{style:{color:"#ffd32a",fontWeight:700,marginLeft:12},children:"Object:"}),De.jsx("span",{style:{color:"#fff"},children:r.object.label})]}),De.jsxs("div",{style:{color:"#fff",fontSize:"1.1em",display:"flex",alignItems:"center",gap:8},children:[De.jsx(rEe,{color:"#ffd32a"}),De.jsx("span",{style:{color:"#ffd32a",fontWeight:700},children:r.shares}),De.jsx("span",{style:{color:"#fff",fontSize:13,marginLeft:4},children:"shares"})]})]}),De.jsx("button",{style:{background:"#ffd32a",color:"#18181b",border:"none",borderRadius:8,padding:"8px 18px",fontWeight:"bold",cursor:"pointer",transition:"background 0.2s, color 0.2s, transform 0.1s",boxShadow:"0 2px 8px rgba(0,0,0,0.10)"},onMouseEnter:e=>e.currentTarget.style.background="#ffe066",onMouseLeave:e=>e.currentTarget.style.background="#ffd32a",onClick:()=>alert("Action à définir"),children:"Action"})]}),xl=({label:r,value:e})=>De.jsxs("div",{style:{display:"flex",gap:8,marginBottom:4},children:[De.jsxs("span",{style:{color:"#ffd32a",fontWeight:700,minWidth:90},children:[r,":"]}),De.jsx("span",{style:{color:"#fff"},children:e})]}),Aj=({src:r,alt:e})=>r?De.jsx("img",{src:r,alt:e,style:{width:48,height:48,borderRadius:"50%",objectFit:"cover",boxShadow:"0 2px 8px rgba(0,0,0,0.18)",marginRight:10}}):null,mEe=({position:r})=>{var e,i,n,s,o;const l=Number(((e=r.vault)==null?void 0:e.total_shares)||0),u=Number(r.shares||0),c=Number(((i=r.vault)==null?void 0:i.current_share_price)||0),h=r.account,p=r.vault,f=p==null?void 0:p.triple,g=p==null?void 0:p.atom;return De.jsxs("div",{style:{background:"#232326",borderRadius:14,padding:"18px 24px",marginBottom:18,boxShadow:"0 2px 12px rgba(0,0,0,0.13)",borderLeft:"6px solid #ffd32a",position:"relative",display:"flex",flexDirection:"column",gap:10},className:"position-card",children:[De.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:10},children:[De.jsx(Aj,{src:h==null?void 0:h.image,alt:h==null?void 0:h.label}),De.jsxs("div",{children:[De.jsx(xl,{label:"Account",value:(h==null?void 0:h.label)||(h==null?void 0:h.id)}),De.jsx(xl,{label:"Type",value:h==null?void 0:h.type})]})]}),De.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:10},children:[De.jsx(Aj,{src:g==null?void 0:g.image,alt:g==null?void 0:g.label}),De.jsxs("div",{children:[De.jsx(xl,{label:"Vault",value:p==null?void 0:p.id}),De.jsx(xl,{label:"Atom",value:g==null?void 0:g.label})]})]}),De.jsx(xl,{label:"Position ID",value:r.id}),De.jsx(xl,{label:"Shares",value:u}),De.jsx(xl,{label:"Vault Shares",value:l}),De.jsx(xl,{label:"Share Price",value:c}),f&&De.jsxs("div",{style:{marginTop:10,padding:10,background:"#18181b",borderRadius:8},children:[De.jsx("div",{style:{color:"#ffd32a",fontWeight:700,marginBottom:6},children:"Triple"}),De.jsx(xl,{label:"Block",value:f.block_number}),De.jsx(xl,{label:"Tx Hash",value:f.transaction_hash}),De.jsx(xl,{label:"Subject",value:(n=f.subject)==null?void 0:n.label}),De.jsx(xl,{label:"Predicate",value:(s=f.predicate)==null?void 0:s.label}),De.jsx(xl,{label:"Object",value:(o=f.object)==null?void 0:o.label})]})]})},Yo=({label:r,value:e})=>De.jsxs("div",{style:{display:"flex",gap:8,marginBottom:4},children:[De.jsxs("span",{style:{color:"#ffd32a",fontWeight:700,minWidth:110},children:[r,":"]}),De.jsx("span",{style:{color:"#fff"},children:e})]}),yj=({src:r,alt:e})=>r?De.jsx("img",{src:r,alt:e,style:{width:48,height:48,borderRadius:"50%",objectFit:"cover",boxShadow:"0 2px 8px rgba(0,0,0,0.18)",marginRight:10}}):null,OI=({value:r})=>{if(!r)return null;const{person:e,thing:i,organization:n}=r;return De.jsxs("div",{style:{marginTop:6,marginBottom:6},children:[e&&De.jsxs("div",{style:{color:"#ffd32a"},children:[De.jsx("b",{children:"Person:"})," ",e.name," ",De.jsx("br",{}),De.jsx("span",{style:{color:"#fff"},children:e.description}),e.url&&De.jsxs(De.Fragment,{children:[De.jsx("br",{}),De.jsx("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",style:{color:"#ffd32a"},children:e.url})]})]}),i&&De.jsxs("div",{style:{color:"#ffd32a"},children:[De.jsx("b",{children:"Thing:"})," ",i.name," ",De.jsx("br",{}),De.jsx("span",{style:{color:"#fff"},children:i.description}),i.url&&De.jsxs(De.Fragment,{children:[De.jsx("br",{}),De.jsx("a",{href:i.url,target:"_blank",rel:"noopener noreferrer",style:{color:"#ffd32a"},children:i.url})]})]}),n&&De.jsxs("div",{style:{color:"#ffd32a"},children:[De.jsx("b",{children:"Organization:"})," ",n.name," ",De.jsx("br",{}),De.jsx("span",{style:{color:"#fff"},children:n.description}),n.url&&De.jsxs(De.Fragment,{children:[De.jsx("br",{}),De.jsx("a",{href:n.url,target:"_blank",rel:"noopener noreferrer",style:{color:"#ffd32a"},children:n.url})]})]})]})},gEe=({position:r})=>{var e,i,n,s,o,l,u,c;const h=Number(((e=r.vault)==null?void 0:e.total_shares)||0),p=Number(r.shares||0),f=Number(((i=r.vault)==null?void 0:i.current_share_price)||0),g=r.account,m=r.vault,y=m==null?void 0:m.triple,b=m==null?void 0:m.atom;return De.jsxs("div",{style:{background:"#232326",borderRadius:14,padding:"18px 24px",marginBottom:18,boxShadow:"0 2px 12px rgba(0,0,0,0.13)",borderLeft:"6px solid #ffd32a",position:"relative",display:"flex",flexDirection:"column",gap:10},className:"activity-card",children:[De.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:10},children:[De.jsx(yj,{src:g==null?void 0:g.image,alt:g==null?void 0:g.label}),De.jsxs("div",{children:[De.jsx(Yo,{label:"Account",value:(g==null?void 0:g.label)||(g==null?void 0:g.id)}),De.jsx(Yo,{label:"Type",value:g==null?void 0:g.type})]})]}),De.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:10},children:[De.jsx(yj,{src:b==null?void 0:b.image,alt:b==null?void 0:b.label}),De.jsxs("div",{children:[De.jsx(Yo,{label:"Vault",value:m==null?void 0:m.id}),De.jsx(Yo,{label:"Atom",value:b==null?void 0:b.label})]})]}),De.jsx(Yo,{label:"Position ID",value:r.id}),De.jsx(Yo,{label:"Shares",value:p}),De.jsx(Yo,{label:"Vault Shares",value:h}),De.jsx(Yo,{label:"Share Price",value:f}),y&&De.jsxs("div",{style:{marginTop:10,padding:10,background:"#18181b",borderRadius:8},children:[De.jsx("div",{style:{color:"#ffd32a",fontWeight:700,marginBottom:6},children:"Triple"}),De.jsx(Yo,{label:"Block",value:y.block_number}),De.jsx(Yo,{label:"Timestamp",value:y.block_timestamp}),De.jsx(Yo,{label:"Tx Hash",value:y.transaction_hash}),De.jsx(Yo,{label:"Subject",value:(n=y.subject)==null?void 0:n.label}),De.jsx(OI,{value:(s=y.subject)==null?void 0:s.value}),De.jsx(Yo,{label:"Predicate",value:(o=y.predicate)==null?void 0:o.label}),De.jsx(OI,{value:(l=y.predicate)==null?void 0:l.value}),De.jsx(Yo,{label:"Object",value:(u=y.object)==null?void 0:u.label}),De.jsx(OI,{value:(c=y.object)==null?void 0:c.value})]})]})};let tv={endpoint:null,data:null,timestamp:null};const AEe=15*60*1e3,yEe=async r=>{const e=Date.now();if(tv.data&&tv.endpoint===r&&e-tv.timestamp<AEe)return tv.data;const i=await hM(r);return tv={endpoint:r,data:i,timestamp:e},i},vEe=async(r,e="base",i=10)=>{if(!r||r.length<1)return{subjects:[],predicates:[],objects:[],triples:[]};const n=r.toLowerCase().trim();if(["is","of","in","at","by","to"].includes(n))try{const s=await Ym({predicate:n},e);if(s&&s.length>0)return{subjects:[...new Set(s.map(o=>o.subject.label))].slice(0,i),predicates:[n],objects:[...new Set(s.map(o=>o.object.label))].slice(0,i),triples:s.map(o=>({subject:o.subject.label,predicate:o.predicate.label,object:o.object.label})).slice(0,i)}}catch{}try{const s=(await yEe(e)).filter(m=>n.length<=3?m.subject&&m.subject.label&&m.subject.label.toLowerCase().indexOf(n)!==-1||m.predicate&&m.predicate.label&&m.predicate.label.toLowerCase().indexOf(n)!==-1||m.object&&m.object.label&&m.object.label.toLowerCase().indexOf(n)!==-1:m.subject&&m.subject.label&&m.subject.label.toLowerCase().includes(n)||m.predicate&&m.predicate.label&&m.predicate.label.toLowerCase().includes(n)||m.object&&m.object.label&&m.object.label.toLowerCase().includes(n));if(s.length>0){const m=E=>{if(!E)return 0;const C=E.toLowerCase();let R=100-Math.min(E.length,50);return C.startsWith(n)&&(R+=200),C===n&&(R+=300),!/^0x[0-9a-f]{8,}$/i.test(C)&&!/[0-9a-f]{30,}/i.test(C)&&(R+=150),/^[A-Za-z0-9]+ - [A-Za-z0-9 ]+$/.test(E)&&(R+=100),R},y=[...new Set(s.filter(E=>E.subject&&E.subject.label&&E.subject.label.toLowerCase().indexOf(n)!==-1).map(E=>E.subject.label))].sort((E,C)=>m(C)-m(E));let b=[...new Set(s.filter(E=>E.predicate&&E.predicate.label&&E.predicate.label.toLowerCase().indexOf(n)!==-1).map(E=>E.predicate.label))].sort((E,C)=>E.toLowerCase()===n?-1:C.toLowerCase()===n?1:m(C)-m(E));const v=[...new Set(s.filter(E=>E.object&&E.object.label&&E.object.label.toLowerCase().indexOf(n)!==-1).map(E=>E.object.label))].sort((E,C)=>m(C)-m(E)),_=E=>{if(!E)return 0;const C=E.subject?m(E.subject):0,R=E.predicate?m(E.predicate):0,B=E.object?m(E.object):0;return Math.max(C,R,B)},T=s.map(E=>({subject:E.subject.label,predicate:E.predicate.label,object:E.object.label})).sort((E,C)=>_(C)-_(E)).slice(0,i);return{subjects:y.slice(0,i),predicates:b.slice(0,i),objects:v.slice(0,i),triples:T}}const o=await Ym({subject:r},e),l=await Ym({predicate:r},e),u=await Ym({object:r},e);let c=[...o||[]];l&&l.length>0&&(c=[...c,...l.filter(m=>!c.some(y=>y.id===m.id))]),u&&u.length>0&&(c=[...c,...u.filter(m=>!c.some(y=>y.id===m.id))]);const h=[...new Set(c.filter(m=>m.subject&&m.subject.label).map(m=>m.subject.label).filter(m=>m.toLowerCase().includes(n)))],p=[...new Set(c.filter(m=>m.predicate&&m.predicate.label).map(m=>m.predicate.label).filter(m=>m.toLowerCase().includes(n)))],f=[...new Set(c.filter(m=>m.object&&m.object.label).map(m=>m.object.label).filter(m=>m.toLowerCase().includes(n)))],g=c.map(m=>({subject:m.subject.label,predicate:m.predicate.label,object:m.object.label})).slice(0,i);return{subjects:h.slice(0,i),predicates:p.slice(0,i),objects:f.slice(0,i),triples:g}}catch{return{subjects:[],predicates:[],objects:[],triples:[]}}},bEe=({endpoint:r,onSearch:e,isSearching:i,onSearchStart:n})=>{const[s,o]=Ct.useState(""),[l,u]=Ct.useState({subjects:[],predicates:[],objects:[],triples:[]}),[c,h]=Ct.useState({subject:"",predicate:"",object:""}),[p,f]=Ct.useState(!1),[g,m]=Ct.useState(!1),y=Ct.useRef(null),b=Ct.useRef(null);Ct.useEffect(()=>{const V=j=>{b.current&&!b.current.contains(j.target)&&f(!1)};return document.addEventListener("mousedown",V),()=>{document.removeEventListener("mousedown",V)}},[]),Ct.useEffect(()=>(s.length>=2?(clearTimeout(y.current),m(!0),f(!0),y.current=setTimeout(async()=>{try{const V=await vEe(s,r);u(V),f(!0),m(!1)}catch(V){console.error("Error retrieving suggestions:",V),m(!1)}},300)):(u({subjects:[],predicates:[],objects:[],triples:[]}),f(!1),m(!1)),()=>{clearTimeout(y.current)}),[s,r]);const v=(V,j)=>{h(Q=>({...Q,[V]:Q[V]===j?"":j}))},_=async()=>{typeof n=="function"&&n();try{const V={subject:c.subject||"",predicate:c.predicate||"",object:c.object||""};typeof e=="function"&&await e(s,V)}catch{}},T=c.subject||c.predicate||c.object,E=l.subjects.length>0||l.predicates.length>0||l.objects.length>0||l.triples&&l.triples.length>0,C={container:{width:"100%",maxWidth:"550px",margin:"0 auto",position:"relative",zIndex:1e3},inputWrapper:{display:"flex",width:"100%",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",borderRadius:"12px",overflow:"hidden",backgroundColor:"rgba(30, 30, 40, 0.6)",backdropFilter:"blur(5px)",border:"1px solid rgba(255, 255, 255, 0.2)"},input:{flex:1,padding:"10px 15px",fontSize:"15px",border:"none",backgroundColor:"transparent",color:"white",outline:"none",fontWeight:"400",height:"40px"},button:{padding:"0 22px",border:"none",cursor:"pointer",fontWeight:"bold",fontSize:"15px",textTransform:"uppercase"},activeFilters:{display:"flex",flexWrap:"wrap",alignItems:"center",marginTop:"12px",padding:"8px 12px",backgroundColor:"rgba(30, 30, 40, 0.7)",borderRadius:"6px",border:"1px solid rgba(255, 255, 255, 0.1)",backdropFilter:"blur(5px)"},filtersLabel:{fontWeight:"600",marginRight:"12px",color:"rgba(255, 255, 255, 0.9)",fontSize:"13px"},filtersChips:{display:"flex",flexWrap:"wrap",gap:"6px",flex:1},filterChip:{display:"flex",alignItems:"center",padding:"3px 8px",borderRadius:"16px",fontSize:"12px",color:"white",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)"},subjectChip:{backgroundColor:`${Ps.SUBJECT}cc`},predicateChip:{backgroundColor:`${Ps.PREDICATE}cc`},objectChip:{backgroundColor:`${Ps.OBJECT}cc`},chipButton:{background:"none",border:"none",color:"white",marginLeft:"4px",cursor:"pointer",fontSize:"14px",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",width:"16px",height:"16px",borderRadius:"50%",transition:"background-color 0.2s ease"},chipButtonHover:{backgroundColor:"rgba(255, 255, 255, 0.2)"},clearButton:{padding:"4px 10px",backgroundColor:"rgba(255, 70, 70, 0.8)",color:"white",border:"none",borderRadius:"16px",cursor:"pointer",fontSize:"12px",fontWeight:"500",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)",transition:"background-color 0.2s ease",marginLeft:"auto"},clearButtonHover:{backgroundColor:"rgba(255, 70, 70, 1)"},suggestionsContainer:{position:"absolute",top:"calc(100% + 8px)",left:0,right:0,backgroundColor:"rgba(25, 25, 35, 0.9)",backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:"8px",maxHeight:"400px",overflowY:"auto",zIndex:1001,boxShadow:"0 8px 16px rgba(0, 0, 0, 0.3)",color:"white"},suggestionCategory:{padding:"14px",borderBottom:"1px solid rgba(255, 255, 255, 0.1)"},categoryHeader:{fontWeight:"600",marginBottom:"10px",color:"rgba(255, 255, 255, 0.8)",fontSize:"14px",textTransform:"uppercase",letterSpacing:"0.5px"},suggestionList:{display:"flex",flexWrap:"wrap",gap:"8px"},suggestionItem:{padding:"3px 8px",borderRadius:"16px",backgroundColor:"rgba(255, 255, 255, 0.15)",fontSize:"12px",cursor:"pointer",transition:"all 0.2s ease",color:"rgba(255, 255, 255, 0.9)"},suggestionItemHover:{backgroundColor:"rgba(255, 255, 255, 0.25)"},selectedSuggestion:{backgroundColor:"#4A66E8",color:"white"},loadingContainer:{display:"flex",justifyContent:"center",alignItems:"center",padding:"25px"},loader:{width:"30px",height:"30px",border:"3px solid rgba(255,255,255,0.2)",borderRadius:"50%",borderTop:"3px solid #ffd32a",animation:"spin 1s linear infinite"},noResults:{padding:"25px",textAlign:"center",fontSize:"14px",color:"rgba(255,255,255,0.7)"},tripleSuggestion:{padding:"8px 12px",borderRadius:"12px",fontSize:"13px",cursor:"pointer",transition:"all 0.2s ease",backgroundColor:"rgba(30, 30, 40, 0.55)",backdropFilter:"blur(5px)",border:"1px solid rgba(255, 255, 255, 0.15)",display:"flex",flexDirection:"row",flexWrap:"wrap",gap:"6px",alignItems:"center",justifyContent:"center"},tripleSuggestionHover:{backgroundColor:"rgba(50, 50, 60, 0.65)"},tripleSubjectPart:{color:Ps.SUBJECT,fontWeight:"500",padding:"2px 6px",borderRadius:"4px",backgroundColor:`${Ps.SUBJECT}33`},triplePredicatePart:{color:Ps.PREDICATE,fontWeight:"500",padding:"2px 6px",borderRadius:"4px",backgroundColor:`${Ps.PREDICATE}33`},tripleObjectPart:{color:Ps.OBJECT,fontWeight:"500",padding:"2px 6px",borderRadius:"4px",backgroundColor:`${Ps.OBJECT}33`},subjectSuggestion:{backgroundColor:Ps.SUBJECT,color:"#fff",fontWeight:"500",border:"none"},predicateSuggestion:{backgroundColor:Ps.PREDICATE,color:"#fff",fontWeight:"500",border:"none"},objectSuggestion:{backgroundColor:Ps.OBJECT,color:"#fff",fontWeight:"500",border:"none"}},[R,B]=Ct.useState(!1),[I,N]=Ct.useState(!1),[D,P]=Ct.useState(null),[k,q]=Ct.useState(null);return De.jsxs("div",{style:C.container,children:[De.jsx("style",{children:`
          @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
          }
        `}),De.jsxs("div",{style:C.inputWrapper,children:[De.jsx("input",{type:"text",value:s,onChange:V=>o(V.target.value),placeholder:"Search for triples...",style:C.input,onFocus:()=>{s.length>=2&&f(!0)}}),De.jsx("button",{onClick:_,disabled:i,style:{...C.button,backgroundColor:"#ffd32a",color:"#18181b",height:"40px",borderRadius:"0 12px 12px 0",boxShadow:"0 2px 8px rgba(0,0,0,0.18)",transition:"background 0.2s, color 0.2s, transform 0.1s"},onMouseEnter:V=>V.currentTarget.style.backgroundColor="#ffe066",onMouseLeave:V=>V.currentTarget.style.backgroundColor="#ffd32a",children:i?"Searching...":"Search"})]}),T&&De.jsxs("div",{style:C.activeFilters,children:[De.jsx("div",{style:C.filtersLabel,children:"Active filters:"}),De.jsxs("div",{style:C.filtersChips,children:[c.subject&&De.jsxs("div",{style:{...C.filterChip,...C.subjectChip},children:[De.jsxs("span",{children:["Subject: ",c.subject]}),De.jsx("button",{onClick:()=>v("subject",c.subject),style:{...C.chipButton,...D==="subject"?C.chipButtonHover:{}},onMouseEnter:()=>P("subject"),onMouseLeave:()=>P(null),children:"×"})]}),c.predicate&&De.jsxs("div",{style:{...C.filterChip,...C.predicateChip},children:[De.jsxs("span",{children:["Predicate: ",c.predicate]}),De.jsx("button",{onClick:()=>v("predicate",c.predicate),style:{...C.chipButton,...D==="predicate"?C.chipButtonHover:{}},onMouseEnter:()=>P("predicate"),onMouseLeave:()=>P(null),children:"×"})]}),c.object&&De.jsxs("div",{style:{...C.filterChip,...C.objectChip},children:[De.jsxs("span",{children:["Object: ",c.object]}),De.jsx("button",{onClick:()=>v("object",c.object),style:{...C.chipButton,...D==="object"?C.chipButtonHover:{}},onMouseEnter:()=>P("object"),onMouseLeave:()=>P(null),children:"×"})]})]}),De.jsx("button",{onClick:()=>h({subject:"",predicate:"",object:""}),style:{...C.clearButton,...I?C.clearButtonHover:{}},onMouseEnter:()=>N(!0),onMouseLeave:()=>N(!1),children:"Clear all filters"})]}),p&&De.jsxs("div",{style:C.suggestionsContainer,ref:b,children:[g&&De.jsx("div",{style:C.loadingContainer,children:De.jsx("div",{style:C.loader})}),!g&&!E&&s.length>=2&&De.jsxs("div",{style:C.noResults,children:['Aucune suggestion trouvée pour "',s,'"']}),!g&&l.subjects.length>0&&De.jsxs("div",{style:C.suggestionCategory,children:[De.jsx("div",{style:C.categoryHeader,children:"Suggested Subjects"}),De.jsx("div",{style:C.suggestionList,children:l.subjects.map((V,j)=>De.jsx("div",{style:{...C.suggestionItem,...C.subjectSuggestion,...k===`subject-${j}`?C.suggestionItemHover:{},...c.subject===V?C.selectedSuggestion:{}},onClick:()=>v("subject",V),onMouseEnter:()=>q(`subject-${j}`),onMouseLeave:()=>q(null),children:V},`subject-${j}`))})]}),!g&&l.predicates.length>0&&De.jsxs("div",{style:C.suggestionCategory,children:[De.jsx("div",{style:C.categoryHeader,children:"Suggested Predicates"}),De.jsx("div",{style:C.suggestionList,children:l.predicates.map((V,j)=>De.jsx("div",{style:{...C.suggestionItem,...C.predicateSuggestion,...k===`predicate-${j}`?C.suggestionItemHover:{},...c.predicate===V?C.selectedSuggestion:{}},onClick:()=>v("predicate",V),onMouseEnter:()=>q(`predicate-${j}`),onMouseLeave:()=>q(null),children:V},`predicate-${j}`))})]}),!g&&l.objects.length>0&&De.jsxs("div",{style:C.suggestionCategory,children:[De.jsx("div",{style:C.categoryHeader,children:"Suggested Objects"}),De.jsx("div",{style:C.suggestionList,children:l.objects.map((V,j)=>De.jsx("div",{style:{...C.suggestionItem,...C.objectSuggestion,...k===`object-${j}`?C.suggestionItemHover:{},...c.object===V?C.selectedSuggestion:{}},onClick:()=>v("object",V),onMouseEnter:()=>q(`object-${j}`),onMouseLeave:()=>q(null),children:V},`object-${j}`))})]}),!g&&l.triples&&l.triples.length>0&&De.jsxs("div",{style:C.suggestionCategory,children:[De.jsx("div",{style:C.categoryHeader,children:"Suggested Triples"}),De.jsx("div",{style:C.suggestionList,children:l.triples.map((V,j)=>De.jsxs("div",{style:{...C.tripleSuggestion,...k===`triple-${j}`?C.tripleSuggestionHover:{}},onClick:()=>{h({subject:V.subject,predicate:V.predicate,object:V.object})},onMouseEnter:()=>q(`triple-${j}`),onMouseLeave:()=>q(null),children:[De.jsx("span",{style:C.tripleSubjectPart,children:V.subject}),De.jsx("span",{style:C.triplePredicatePart,children:V.predicate}),De.jsx("span",{style:C.tripleObjectPart,children:V.object})]},`triple-${j}`))})]})]})]})},vj=({user:r})=>De.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:8},children:[r.image&&De.jsx("img",{src:r.image,alt:r.label,style:{width:36,height:36,borderRadius:"50%",objectFit:"cover",marginRight:10,boxShadow:"0 2px 8px rgba(0,0,0,0.18)"}}),De.jsx("span",{style:{color:"#ffd32a",fontWeight:600},children:r.label||r.id})]}),xEe=({follows:r,followers:e})=>De.jsxs("div",{children:[De.jsx("h3",{style:{color:"#ffd32a"},children:"Follows"}),r.length===0?De.jsx("p",{style:{color:"#fff"},children:"No follows."}):r.map(i=>De.jsx(vj,{user:i.object},i.object.id)),De.jsx("h3",{style:{color:"#ffd32a",marginTop:18},children:"Followers"}),e.length===0?De.jsx("p",{style:{color:"#fff"},children:"No followers."}):e.map(i=>De.jsx(vj,{user:i.subject},i.subject.id))]}),_Ee=({endpoint:r,walletAddress:e,onNodeSelect:i,onLoadingChange:n})=>{const s=e.toLowerCase(),o=Ct.useRef(),l=Ct.useRef(),[u,c]=Ct.useState("2D"),[h,p]=Ct.useState(!1),[f,g]=Ct.useState(!1),[m,y]=Ct.useState(null),[b,v]=Ct.useState(!1),[_,T]=Ct.useState([]),[E,C]=Ct.useState([]),[R,B]=Ct.useState([]),[I,N]=Ct.useState(!1),[D,P]=Ct.useState(!1),[k,q]=Ct.useState(!1),[V,j]=Ct.useState(null),[Q,W]=Ct.useState("agent"),[G,z]=Ct.useState({follows:[],followers:[]}),{graphData:te,isInitialLoad:Y,selectedTriple:se,isLoading:ve,isSearching:Ae,subjectFilter:me,predicateFilter:Oe,objectFilter:Xe,shouldSearch:Je,canGoBack:it,canGoForward:dt,setIsInitialLoad:St,loadInitialData:Qt,resetGraph:yt,handleNodeClick:bi,handleFilterChange:$e,applyFilters:Fi,goBack:ui,goForward:Si,setGraphData:Ei,setGraphHistory:Zi,currentHistoryIndex:Vi,setCurrentHistoryIndex:We}=hEe(r,Q),Ce=k&&V?V:te,At=D||Ae;Ct.useEffect(()=>{Qt()},[Qt,Q]),Ct.useEffect(()=>{Je&&(q(!1),Fi())},[Je,Fi]);const Ot=()=>{Y&&o.current&&St(!1)};Ct.useEffect(()=>{h&&m==="claims"&&$le(s,r).then(T)},[h,m,r,s]),Ct.useEffect(()=>{h&&m==="positions"&&cM(s,r).then(C)},[h,m,r,s]),Ct.useEffect(()=>{h&&m==="activity"&&cM(s,r).then(B)},[h,m,r,s]),Ct.useEffect(()=>{h&&m==="connections"&&fF(4,s,r).then(z)},[h,m,r,s]);const Zt=async(Ie,U)=>{try{P(!0);const $={subject:U.subject||"",predicate:U.predicate||"",object:U.object||""},re=await Ym($,r);if(re&&re.length>0){const Me=nE(re);q(!1),Ei(Me),Zi(ce=>{const ze=ce.slice(0,Vi+1);return ze.push({graphData:Me,selectedTriple:null,filters:$}),ze}),We(ce=>ce+1)}else Ei({nodes:[],links:[]})}catch{Ei({nodes:[],links:[]})}finally{P(!1)}},jt=()=>{P(!0)},xi=()=>{q(!1),yt()},vt=(Ie,U)=>{q(!1),$e(Ie,U)},ge=()=>{k&&q(!1)},be=[{key:null,label:"Map"},{key:"connections",label:"Connections"},{key:"positions",label:"Positions"},{key:"claims",label:"Claims"},{key:"activity",label:"Activity"}],Ne=Ie=>{y(Ie),p(!!Ie)},Se=()=>{switch(m){case"claims":return De.jsxs(De.Fragment,{children:[De.jsx("h2",{style:{fontSize:"2rem",fontWeight:"bold",color:"#ffd32a",marginBottom:18},children:"Claims"}),_.length===0?De.jsx("p",{style:{color:"#fff"},children:"No claims found."}):De.jsx("div",{children:_.map(Ie=>De.jsx(fEe,{claim:Ie},Ie.id))})]});case"positions":return De.jsxs(De.Fragment,{children:[De.jsx("h2",{style:{fontSize:"2rem",fontWeight:"bold",color:"#ffd32a",marginBottom:18},children:"Positions"}),E.length===0?De.jsx("p",{style:{color:"#fff"},children:"No positions found."}):De.jsx("div",{children:E.map(Ie=>De.jsx(mEe,{position:Ie},Ie.id))})]});case"activity":return De.jsxs(De.Fragment,{children:[De.jsx("h2",{style:{fontSize:"2rem",fontWeight:"bold",color:"#ffd32a",marginBottom:18},children:"Activity"}),R.length===0?De.jsx("p",{style:{color:"#fff"},children:"Aucune activité trouvée."}):De.jsx("div",{children:R.map(Ie=>De.jsx(gEe,{position:Ie},Ie.id))})]});case"connections":return De.jsxs(De.Fragment,{children:[De.jsx("h2",{style:{fontSize:"2rem",fontWeight:"bold",color:"#ffd32a",marginBottom:18},children:"Connections"}),De.jsx(xEe,{follows:G.follows||[],followers:G.followers||[]})]});default:return null}},Fe=()=>De.jsxs("div",{style:{display:"none",alignItems:"center",backgroundColor:"#27272a",padding:"8px 12px",borderRadius:8,marginLeft:12,boxShadow:"0 2px 8px rgba(0,0,0,0.2)"},children:[De.jsx("span",{style:{color:"white",marginRight:10,fontSize:14},children:"Graph Type:"}),De.jsxs("select",{value:Q,onChange:Ie=>W(Ie.target.value),style:{backgroundColor:"#3f3f46",color:"white",border:"none",padding:"4px 8px",borderRadius:4,cursor:"pointer"},children:[De.jsx("option",{value:"base",children:"Base"}),De.jsx("option",{value:"agent",children:"Agent"})]})]});return De.jsxs("div",{ref:l,className:"graph-visualization-container",style:{position:"relative",top:0,left:0,right:0,bottom:0,width:"100%",height:"100vh",overflow:"hidden"},children:[(ve||At||I)&&De.jsx(mF,{}),De.jsx(lEe,{onReset:xi,onBack:()=>{ge(),ui()},onForward:()=>{ge(),Si()},canGoBack:it,canGoForward:dt,onMyView:()=>{g(!0)}}),De.jsx("div",{style:{position:"absolute",top:"80px",left:"18px",zIndex:50},children:De.jsx(cEe,{viewMode:u,onViewModeChange:c})}),De.jsx("div",{style:{position:"absolute",top:"10px",left:"50%",transform:"translateX(-50%)",zIndex:1e3,width:"550px",maxWidth:"calc(100% - 350px)"},children:De.jsx(bEe,{endpoint:r,onSearch:Zt,isSearching:At,onSearchStart:jt})}),De.jsxs("div",{className:"agent-navbar",style:{position:"absolute",top:"10px",right:"10px",zIndex:10,display:"flex",flexDirection:"row",alignItems:"center",gap:"16px"},children:[De.jsx(Fe,{}),!b&&De.jsx("button",{style:{background:"#ffd32a",color:"#18181b",border:"none",borderRadius:12,width:120,height:40,fontSize:15,fontWeight:"bold",boxShadow:"0 2px 8px rgba(0,0,0,0.18)",cursor:"pointer",textTransform:"uppercase",marginLeft:12,transition:"background 0.2s, color 0.2s, transform 0.1s"},onMouseEnter:Ie=>Ie.currentTarget.style.background="#ffe066",onMouseLeave:Ie=>Ie.currentTarget.style.background="#ffd32a",onClick:()=>v(Ie=>!Ie),children:"Filters"}),b&&De.jsx("div",{style:{marginLeft:12,display:"flex",alignItems:"center",gap:16,position:"relative"},children:De.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end",position:"relative"},children:De.jsx(ice,{subjectFilter:me,predicateFilter:Oe,objectFilter:Xe,onFilterChange:vt,onReset:xi,onClose:()=>v(!1)})})})]}),u==="2D"&&De.jsx(Q_e,{graphData:Ce,onNodeClick:Ie=>{ge(),bi(Ie,o,u)},onEngineStop:Ot,fgRef:o,tabs:be,activeTab:m,onTabChange:Ne,drawerOpen:h,drawerContent:Se(),onDrawerClose:()=>{p(!1),y(null)},sidebarOpen:f,sidebarContent:De.jsxs(De.Fragment,{children:[De.jsx("h2",{children:"My Profile"}),De.jsx("p",{children:"Name: Base User"}),De.jsx("p",{children:"Email: user@email.com"}),De.jsx("p",{children:"Role: Player"}),De.jsx("button",{style:{background:"#ffd32a",color:"#18181b",border:"none",borderRadius:8,padding:"10px 18px",fontWeight:"bold",marginTop:20,cursor:"pointer"},onClick:()=>g(!1),children:"Close"})]}),onSidebarClose:()=>g(!1),selectedTriple:se,endpoint:r,children:De.jsx(eN,{})}),u==="3D"&&De.jsx(X_e,{graphData:Ce,onNodeClick:Ie=>{ge(),bi(Ie,o,u)},onEngineStop:Ot,fgRef:o,tabs:be,activeTab:m,onTabChange:Ne,drawerOpen:h,drawerContent:Se(),onDrawerClose:()=>{p(!1),y(null)},sidebarOpen:f,sidebarContent:De.jsxs(De.Fragment,{children:[De.jsx("h2",{children:"My Profile"}),De.jsx("p",{children:"Name: Base User"}),De.jsx("p",{children:"Email: user@email.com"}),De.jsx("p",{children:"Role: Player"}),De.jsx("button",{style:{background:"#ffd32a",color:"#18181b",border:"none",borderRadius:8,padding:"10px 18px",fontWeight:"bold",marginTop:20,cursor:"pointer"},onClick:()=>g(!1),children:"Close"})]}),onSidebarClose:()=>g(!1),selectedTriple:se,endpoint:r,children:De.jsx(eN,{})}),u==="VR"&&De.jsx(tce,{graphData:Ce,onNodeClick:Ie=>{ge(),bi(Ie,o,u)},onBack:()=>{ge(),ui()},onForward:()=>{ge(),Si()},selectedTriple:se,endpoint:r}),De.jsxs(pEe,{open:f,onClose:()=>g(!1),children:[De.jsx("h2",{children:"My Profile"}),De.jsx("p",{children:"Name: Base User"}),De.jsx("p",{children:"Email: user@email.com"}),De.jsx("p",{children:"Role: Player"}),De.jsx("button",{style:{background:"#ffd32a",color:"#18181b",border:"none",borderRadius:8,padding:"10px 18px",fontWeight:"bold",marginTop:20,cursor:"pointer"},onClick:()=>g(!1),children:"Close"})]}),De.jsx(dEe,{open:!!h,onClose:()=>{p(!1),y(null)},children:Se()})]})},bj=({walletAddress:r})=>{const[e,i]=Ct.useState(null),[n,s]=Ct.useState("base"),[o,l]=Ct.useState(!1);return Et.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",width:"100%",position:"relative",overflow:"hidden"},children:[Et.jsx("div",{style:{position:"relative",flex:1,width:"100%",height:"100%",overflow:"hidden"},children:Et.jsx(_Ee,{endpoint:n,onNodeSelect:i,onLoadingChange:l,walletAddress:r})}),o&&Et.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:2},children:Et.jsx(mF,{})})]})};var EEe="https://prod.base.intuition-api.com/v1/graphql",wEe=EEe,CEe={apiUrl:wEe},SEe=()=>({headers:{"Content-Type":"application/json; charset=utf-8"}});function TEe(r,e,i){return async()=>{const s=await(await fetch(CEe.apiUrl,{method:"POST",...SEe(),...i,body:JSON.stringify({query:r,variables:e})})).json();if(s.errors&&(!s.data||Object.keys(s.data).length===0)){const{message:o}=s.errors[0];throw new Error(o)}return s.data}}var MEe=`
    fragment AccountMetadata on accounts {
  label
  image
  id
  atom_id
  type
}
    `,REe=`
    fragment AtomValue on atoms {
  value {
    person {
      name
      image
      description
      url
    }
    thing {
      name
      image
      description
      url
    }
    organization {
      name
      image
      description
      url
    }
  }
}
    `,IEe=`
    fragment PositionAggregateFields on positions_aggregate {
  aggregate {
    count
    sum {
      shares
    }
  }
}
    `,BEe=`
    fragment PositionFields on positions {
  account {
    id
    label
  }
  shares
  vault {
    id
    total_shares
    current_share_price
  }
}
    `,LEe=`
    fragment TripleMetadata on triples {
  id
  subject_id
  predicate_id
  object_id
  subject {
    data
    id
    image
    label
    emoji
    type
    ...AtomValue
    creator {
      ...AccountMetadata
    }
  }
  predicate {
    data
    id
    image
    label
    emoji
    type
    ...AtomValue
    creator {
      ...AccountMetadata
    }
  }
  object {
    data
    id
    image
    label
    emoji
    type
    ...AtomValue
    creator {
      ...AccountMetadata
    }
  }
  vault {
    total_shares
    current_share_price
    allPositions: positions_aggregate {
      ...PositionAggregateFields
    }
    positions {
      ...PositionFields
    }
  }
  counter_vault {
    total_shares
    current_share_price
    allPositions: positions_aggregate {
      ...PositionAggregateFields
    }
    positions {
      ...PositionFields
    }
  }
}
    `,DEe=`
    fragment TripleTxn on triples {
  block_number
  block_timestamp
  transaction_hash
  creator_id
}
    `,NEe=`
    fragment PositionDetails on positions {
  id
  account {
    id
    label
    image
  }
  vault {
    id
    atom {
      id
      label
      image
    }
    triple {
      id
      vault {
        id
        position_count
        positions_aggregate {
          aggregate {
            sum {
              shares
            }
          }
        }
      }
      counter_vault {
        id
        position_count
        positions_aggregate {
          aggregate {
            sum {
              shares
            }
          }
        }
      }
      subject {
        data
        id
        label
        image
        emoji
        type
        ...AtomValue
        creator {
          ...AccountMetadata
        }
      }
      predicate {
        data
        id
        label
        image
        emoji
        type
        ...AtomValue
        creator {
          ...AccountMetadata
        }
      }
      object {
        data
        id
        label
        image
        emoji
        type
        ...AtomValue
        creator {
          ...AccountMetadata
        }
      }
    }
  }
  shares
  vault_id
}
    `,PEe=`
    fragment TripleVaultDetails on triples {
  vault_id
  counter_vault_id
  vault {
    positions {
      ...PositionDetails
    }
  }
  counter_vault {
    positions {
      ...PositionDetails
    }
  }
}
    `,OEe=`
    query GetTriples($limit: Int, $offset: Int, $orderBy: [triples_order_by!], $where: triples_bool_exp) {
  total: triples_aggregate(where: $where) {
    aggregate {
      count
    }
  }
  triples(limit: $limit, offset: $offset, order_by: $orderBy, where: $where) {
    ...TripleMetadata
    ...TripleTxn
    ...TripleVaultDetails
    creator {
      ...AccountMetadata
    }
  }
}
    ${LEe}
${REe}
${MEe}
${IEe}
${BEe}
${DEe}
${PEe}
${NEe}`,kEe=`
    query GetTriplesWithPositions($limit: Int, $offset: Int, $orderBy: [triples_order_by!], $where: triples_bool_exp, $address: String) {
  total: triples_aggregate(where: $where) {
    aggregate {
      count
    }
  }
  triples(limit: $limit, offset: $offset, order_by: $orderBy, where: $where) {
    id
    vault_id
    counter_vault_id
    subject {
      id
      vault_id
      label
      image
    }
    predicate {
      id
      vault_id
      label
      image
    }
    object {
      id
      vault_id
      label
      image
    }
    vault {
      current_share_price
      total_shares
      position_count
      positions(where: {account_id: {_eq: $address}}) {
        account {
          id
          label
          image
        }
        shares
      }
    }
    counter_vault {
      current_share_price
      total_shares
      position_count
      positions(where: {account_id: {_eq: $address}}) {
        account {
          id
          label
          image
        }
        shares
      }
    }
  }
}
    `,_l=(r=>(r.MAINNET="mainnet",r.TESTNET="testnet",r))(_l||{});const iv={mainnet:"https://prod.base.intuition-api.com/v1/graphql",testnet:"https://dev.base-sepolia.intuition-api.com/v1/graphql"},FEe=async(r,e=Number(fs.IS_PLAYER_GAMES.predicateId),i=Number(fs.IS_PLAYER_GAMES.objectId),n=_l.MAINNET)=>{var l;const s=iv[n],o={where:{subject:{creator_id:{_eq:r}},predicate_id:{_eq:e},object_id:{_eq:i}}};try{const c=await(await fetch(s,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({query:OEe,variables:o})})).json();if(c.errors)throw new Error(((l=c.errors[0])==null?void 0:l.message)||"Erreur GraphQL inconnue");return c.data}catch(u){throw console.error(`[fetchTriplesByCreator] Erreur lors de la requête directe vers ${s}:`,u),u}},xj=(r,e=Number(fs.IS_PLAYER_GAMES.predicateId),i=Number(fs.IS_PLAYER_GAMES.objectId),n=_l.MAINNET)=>{const[s,o]=Ct.useState(null),[l,u]=Ct.useState(!0),[c,h]=Ct.useState(null);Ct.useEffect(()=>{(async()=>{if(!r){u(!1);return}try{const g=await FEe(r,e,i,n);o(g)}catch(g){console.error(`[${n}] Erreur lors de la récupération des triples:`,g),h(g instanceof Error?g:new Error(String(g)))}finally{u(!1)}})()},[r,e,i,n]);const p=(s==null?void 0:s.triples)||[];return{loading:l,error:c,triples:p,network:n,rawData:s}},_j=({isOpen:r,onConnectWallet:e})=>r?Et.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"rgba(0, 0, 0, 0.7)",backdropFilter:"blur(5px)",zIndex:1e3,width:"100%",height:"100%"},children:Et.jsxs("div",{style:{backgroundColor:"#1a1a2e",padding:"30px",borderRadius:"10px",textAlign:"center",maxWidth:"500px",boxShadow:"0 0 15px rgba(108, 92, 231, 0.5)"},children:[Et.jsx("h2",{style:{color:"#6c5ce7",marginBottom:"20px"},children:"Wallet Required"}),Et.jsx("p",{style:{fontSize:"18px",marginBottom:"25px",color:"#fff"},children:"Please connect your wallet to access this feature"}),Et.jsx("button",{onClick:e,style:{padding:"12px 24px",backgroundColor:"#6c5ce7",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"16px"},children:"Connect Wallet"})]})}):null,UEe=({isOpen:r,onCreatePlayer:e,onClose:i})=>r?Et.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"rgba(0, 0, 0, 1)",backdropFilter:"blur(1px)",zIndex:1e3,width:"100%",height:"100%"},children:Et.jsxs("div",{style:{backgroundColor:"#1a1a2e",padding:"30px",borderRadius:"10px",textAlign:"center",maxWidth:"500px",boxShadow:"0 0 15px rgba(0, 128, 255, 0.7)",position:"relative"},children:[i&&Et.jsx("button",{onClick:i,style:{position:"absolute",top:"10px",right:"10px",backgroundColor:"transparent",border:"none",fontSize:"20px",color:"#666",cursor:"pointer"},children:"×"}),Et.jsx("h2",{style:{color:"#FFD32A",marginBottom:"20px"},children:"Player Required"}),Et.jsx("p",{style:{fontSize:"18px",marginBottom:"25px",color:"#fff"},children:"You need to create a player before you can vote on claims"}),Et.jsx("button",{onClick:e,style:{padding:"12px 24px",backgroundColor:"#1976d2",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"16px"},children:"Create Player"})]})}):null,zEe=({walletConnected:r=!1,walletAddress:e="",wagmiConfig:i,walletHooks:n,onClose:s,onCreatePlayer:o,onConnectWallet:l})=>{const[u,c]=Ct.useState(_l.MAINNET),[h,p]=Ct.useState(!1),[f,g]=Ct.useState(!1),m=e?e.toLowerCase():"";Ct.useEffect(()=>{g(!!(e&&e!==""))},[e]);const{loading:y,error:b,triples:v}=xj(m,Number(fs.IS_PLAYER_GAMES.predicateId),Number(fs.IS_PLAYER_GAMES.objectId),u),_=v.length>0,T=y,E=b,C=Ct.useCallback(()=>{o&&o(),p(!0)},[o]),R=Ct.useCallback(()=>{p(!1),s&&s()},[s]),B=Ct.useCallback(()=>{l&&l()},[l]);return T&&f?Et.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",backgroundColor:"#101020",color:"#fff"},children:Et.jsxs("div",{style:{textAlign:"center"},children:[Et.jsx("h2",{style:{color:"#6c5ce7",marginBottom:"20px"},children:"Uploading datas playeur..."}),Et.jsx("div",{style:{width:"50px",height:"50px",border:"5px solid #151525",borderTop:"5px solid #6c5ce7",borderRadius:"50%",margin:"0 auto",animation:"spin 1s linear infinite"}}),Et.jsx("style",{children:`
              @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
              }
            `})]})}):E&&f?Et.jsxs("div",{style:{margin:"20px",padding:"30px",borderRadius:"8px",backgroundColor:"#1a1a2e",color:"#fff"},children:[Et.jsx("h2",{style:{color:"#6c5ce7",marginBottom:"20px"},children:"Player Map"}),Et.jsxs("div",{style:{padding:"20px",backgroundColor:"#151525",borderRadius:"6px",color:"#ff6b6b"},children:[Et.jsx("h3",{children:"Error to uploading datas"}),Et.jsx("p",{children:(b==null?void 0:b.message)||"Unknow error"})]})]}):Et.jsxs("div",{style:{position:"relative",width:"100%",height:"100%"},children:[Et.jsx(_j,{isOpen:!f,onConnectWallet:B}),(!f||f&&!_)&&Et.jsx("div",{style:{filter:f?"none":"blur(3px)",opacity:f?1:.7,position:"relative"},children:Et.jsx(Vw,{walletConnected:f,walletAddress:e,wagmiConfig:i,walletHooks:n,onCreatePlayer:C})}),f&&_&&Et.jsx(bj,{walletAddress:e}),Et.jsx(o2,{isOpen:h,onClose:R,walletConnected:r,walletAddress:e,wagmiConfig:i,walletHooks:n})]})};var Er=(r=>(r.For="FOR",r.Against="AGAINST",r.None="NONE",r))(Er||{});const kI=25000000000000n,Ej=[163985n,163986n,163987n,163988n],wj=({walletConnected:r,walletAddress:e,publicClient:i,network:n=_l.MAINNET})=>{const[s,o]=Ct.useState(!1),l=async c=>{var h;try{const p=iv[n],f=await fetch(p,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
            query Triple($tripleId: numeric!) {
              triple(id: $tripleId) {
                id
                vault_id
                counter_vault_id
              }
            }
          `,variables:{tripleId:Number(c)}})});if(!f.ok)return null;const g=await f.json();return g.errors||!((h=g.data)!=null&&h.triple)?null:{id:String(c),...g.data.triple}}catch{return null}};return{depositTriple:async(c,h,p)=>{if(!r||!e)return{success:!1,error:"Wallet not connected"};if(h<=0)return{success:!1,error:"Units must be greater than 0"};o(!0);try{const f=await l(c);if(!f)return o(!1),{success:!1,error:"Failed to fetch triple details"};let g;p===Er.For?g=f.vault_id||f.id:g=f.counter_vault_id||f.id;const m=kI*BigInt(h),y=await r.writeContract({address:Pc,abi:Oc,functionName:"depositTriple",args:[e,BigInt(g)],value:m,gas:300000n});let b;return r.waitForTransactionReceipt?b=await r.waitForTransactionReceipt({hash:y}):y.wait?b=await y.wait():await new Promise(v=>setTimeout(v,5e3)),o(!1),{success:!0,hash:typeof y=="string"?y:y.hash}}catch(f){return o(!1),{success:!1,error:f instanceof Error?f.message:String(f)}}},isLoading:s}},jEe=({walletConnected:r,walletAddress:e,publicClient:i,network:n=_l.MAINNET,onSuccess:s})=>{const[o,l]=Ct.useState(!1),[u,c]=Ct.useState({status:"idle",message:""}),{depositTriple:h,isLoading:p}=wj({walletConnected:r,walletAddress:e,publicClient:i,network:n});return{submitVotes:async g=>{var y;if(!g.some(b=>b.units>0))return c({status:"error",message:"Please place at least one vote."}),null;if(!r||!e)return c({status:"error",message:"Wallet not connected."}),null;try{l(!0),c({status:"pending",message:"Transaction in progress..."});const b=g.filter(_=>_.units>0);let v={success:!0,hash:"",error:void 0};for(const _ of b){const T=await h(_.id,_.units,_.direction);if(!T.success){v=T;break}v.hash=T.hash||""}if(v.success)return c({status:"success",message:`Transaction successful! Hash: ${(y=v.hash)==null?void 0:y.substring(0,10)}...`}),s&&s(),v;{let _=v.error||"An error occurred.";return _.includes("user rejected")?c({status:"error",message:"Transaction cancelled: User rejected the request."}):c({status:"error",message:`Error: ${_}`}),null}}catch(b){return console.error("Error submitting votes:",b),c({status:"error",message:b instanceof Error?b.message:"An error occurred."}),null}finally{l(!1)}},isSubmitting:o,isDepositLoading:p,transactionStatus:u,setTransactionStatus:c}},VEe=({network:r=_l.MAINNET,onError:e}={})=>{const[i,n]=Ct.useState(!1);return{fetchTripleDetails:async o=>{var l,u,c;n(!0);try{const h=iv[r],p=await fetch(h,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
            query Triple($tripleId: numeric!) {
              triple(id: $tripleId) {
                id
                subject {
                  label
                }
                predicate {
                  label
                }
                object {
                  label
                }
                vault_id
                vault {
                  position_count
                }
                counter_vault_id
                counter_vault {
                  position_count
                }
              }
            }
          `,variables:{tripleId:Number(o)}})});if(!p.ok)throw new Error(`GraphQL request failed with status ${p.status}`);const f=await p.json();if(f.errors)throw new Error(`GraphQL errors: ${JSON.stringify(f.errors)}`);if(!((l=f.data)!=null&&l.triple))return e&&e(`Triple with ID ${o} not found`),n(!1),null;const g=((u=f.data.triple.vault)==null?void 0:u.position_count)||0,m=((c=f.data.triple.counter_vault)==null?void 0:c.position_count)||0;return n(!1),{id:String(o),subject:f.data.triple.subject,predicate:f.data.triple.predicate,object:f.data.triple.object,vault_id:f.data.triple.vault_id,counter_vault_id:f.data.triple.counter_vault_id,vault_position_count:g,counter_vault_position_count:m}}catch(h){return e&&e(`Error fetching details for triple ${o}: ${h instanceof Error?h.message:String(h)}`),n(!1),null}},isLoading:i}},Cj=r=>{const[e,i]=Ct.useState(null),[n,s]=Ct.useState(!0),[o,l]=Ct.useState(null);return Ct.useEffect(()=>{(async()=>{if(!r){s(!1);return}try{s(!0);const c={limit:100,offset:0,where:{},address:r.toLowerCase()},p=await TEe(kEe,c)(),f=p;i(p),s(!1)}catch(c){console.error("Erreur lors de la récupération des triples:",c),l(c),s(!1)}})()},[r]),{data:e,loading:n,error:o}},GEe=({network:r=_l.MAINNET,walletAddress:e="",onError:i})=>{const[n,s]=Ct.useState([]),[o,l]=Ct.useState(!0),[u,c]=Ct.useState(0),[h,p]=Ct.useState({}),{fetchTripleDetails:f}=VEe({network:r,onError:i}),{data:g,loading:m}=Cj(e);Ct.useEffect(()=>{if(g&&!m&&e){const E={};g.positions&&Array.isArray(g.positions)&&g.positions.forEach(C=>{if(!C.triple_id)return;const R=C.triple_id;if(C.is_for!==void 0){const B=C.is_for?Er.For:Er.Against;E[String(R)]=B}else C.vault_id&&C.counter_vault_id}),g.triples&&Array.isArray(g.triples)&&g.triples.forEach(C=>{var D,P;if(!C.id)return;if(C.positions&&Array.isArray(C.positions)){const k=C.positions.find(q=>{var V,j;return((j=(V=q.account)==null?void 0:V.id)==null?void 0:j.toLowerCase())===e.toLowerCase()});k&&(k.is_for!==void 0?E[String(C.id)]=k.is_for?Er.For:Er.Against:k.vault_id&&C.vault_id===k.vault_id?E[String(C.id)]=Er.For:k.vault_id&&C.counter_vault_id===k.vault_id&&(E[String(C.id)]=Er.Against))}const R=((D=C.vault)==null?void 0:D.positions)||[],B=((P=C.counter_vault)==null?void 0:P.positions)||[],I=R.find(k=>{var q,V;return((V=(q=k.account)==null?void 0:q.id)==null?void 0:V.toLowerCase())===e.toLowerCase()}),N=B.find(k=>{var q,V;return((V=(q=k.account)==null?void 0:q.id)==null?void 0:V.toLowerCase())===e.toLowerCase()});I?E[String(C.id)]=Er.For:N&&(E[String(C.id)]=Er.Against)}),g.position_triples&&Array.isArray(g.position_triples)&&g.position_triples.forEach(C=>{var B,I,N,D;if(!C.triple_id&&!((B=C.triple)!=null&&B.id))return;const R=C.triple_id||((I=C.triple)==null?void 0:I.id);C.is_for!==void 0?E[String(R)]=C.is_for?Er.For:Er.Against:C.vault_id&&((N=C.triple)==null?void 0:N.vault_id)===C.vault_id?E[String(R)]=Er.For:C.vault_id&&((D=C.triple)==null?void 0:D.counter_vault_id)===C.vault_id&&(E[String(R)]=Er.Against)}),p(E),s(C=>C.map(R=>{const B=E[String(R.id)]||Er.None,I=B!==Er.None;return{...R,userHasPosition:I,userPositionDirection:B}}))}},[g,m,e]),Ct.useEffect(()=>{y()},[]),Ct.useEffect(()=>{const E=n.reduce((C,R)=>C+R.units,0);c(E)},[n]);const y=async()=>{l(!0);try{const E=Ej.map(async B=>{var D,P,k;const I=await f(B);if(!I)return{id:B,subject:`Claim ${B}`,predicate:"is",object:"Unknown",units:0,direction:Er.None,userHasPosition:!1,userPositionDirection:Er.None};const N=h[String(B)]||Er.None;return{id:BigInt(I.id),subject:((D=I.subject)==null?void 0:D.label)||`Subject ${B}`,predicate:((P=I.predicate)==null?void 0:P.label)||"is",object:((k=I.object)==null?void 0:k.label)||`Object ${B}`,units:0,direction:Er.None,vault_id:I.vault_id,vault_position_count:I.vault_position_count||0,counter_vault_id:I.counter_vault_id,counter_vault_position_count:I.counter_vault_position_count||0,userHasPosition:N!==Er.None,userPositionDirection:N}}),C=await Promise.all(E);C.every(B=>B.object==="Unknown")&&i&&i("Error: Failed to fetch triple details. Please check your network connection or try again later."),s(C)}catch{i&&i("Error: Failed to fetch triple details")}finally{l(!1)}},b=(E,C,R)=>{if(C!==Er.None&&!T(E,C)){const I=n.find(N=>N.id===E);if(I&&I.userHasPosition&&I.userPositionDirection!==Er.None){i&&i(`Cannot vote ${C===Er.For?"for":"against"} this claim as you already have an ${I.userPositionDirection===Er.For?"affirmative":"opposing"} position on it.`);return}}s(B=>B.map(I=>I.id===E?I.userHasPosition&&I.userPositionDirection!==Er.None&&C!==Er.None&&I.userPositionDirection!==C?I:I.direction!==C&&I.direction!==Er.None?{...I,units:R,direction:C}:R===0?{...I,units:0,direction:Er.None}:{...I,units:R,direction:C}:I))},v=()=>{s(E=>E.map(C=>({...C,units:0,direction:Er.None})))},_=n.filter(E=>E.units>0).length,T=(E,C)=>{const R=n.find(I=>I.id===E);return!R||!R.userHasPosition?!0:R.userPositionDirection===Er.None||R.userPositionDirection===C};return{voteItems:n,setVoteItems:s,isLoading:o||m,totalUnits:u,numberOfTransactions:_,handleChangeUnits:b,resetAllVotes:v,loadTripleDetails:y,isVoteDirectionAllowed:T,userPositions:h}},Sj=r=>(r*25e-5).toFixed(5),HEe=r=>(r*4e-7).toFixed(7),WEe=({numberOfTransactions:r,totalUnits:e,onResetAll:i})=>Et.jsxs("div",{style:{backgroundColor:"#10172d",padding:"10px",borderRadius:"8px",marginBottom:"25px",display:"flex",flexDirection:"column",border:"1px solid #1e3b70"},children:[Et.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"15px"},children:[Et.jsxs("div",{children:[Et.jsx("div",{style:{fontSize:"0.9em",color:"#6b7280"},children:"Unit value:"}),Et.jsxs("div",{style:{fontSize:"1.1em",fontWeight:"bold",color:"#FFD32A"},children:[Sj(e)," ETH"]})]}),Et.jsxs("div",{children:[Et.jsx("div",{style:{fontSize:"0.9em",color:"#6b7280"},children:"Number of transactions:"}),Et.jsx("div",{style:{fontSize:"1.1em",fontWeight:"bold",color:"#FFD32A"},children:r})]}),Et.jsxs("div",{children:[Et.jsx("div",{style:{fontSize:"0.9em",color:"#6b7280"},children:"Estimated gas cost:"}),Et.jsxs("div",{style:{fontSize:"1.1em",fontWeight:"bold",color:"#FFD32A"},children:["~",HEe(r)," ETH"]})]})]}),Et.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[Et.jsxs("div",{style:{fontSize:"1em",fontWeight:"bold"},children:["Total units selected:",Et.jsxs("span",{style:{fontSize:"1.6em",marginLeft:"10px",color:"#FFD32A"},children:[e," ",e===1?"unit":"units"]})]}),e>0&&Et.jsx("button",{onClick:i,style:{backgroundColor:"transparent",border:"1px solid #6b7280",color:"#FFF",padding:"6px 12px",borderRadius:"4px",cursor:"pointer",fontSize:"0.9em"},children:"Reset all"})]})]}),QEe=({onClose:r})=>Et.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"25px",borderBottom:"1px solid #1e3b70"},children:[Et.jsx("h2",{style:{fontSize:"1.3em",color:"#FFD32A",margin:0,fontWeight:"bold"},children:"VOTE ON CLAIMS"}),r&&Et.jsx("button",{onClick:r,style:{backgroundColor:"transparent",border:"none",color:"#FFF",cursor:"pointer",fontSize:"1.5em"},children:"×"})]}),Tj=({walletAddress:r,tripleId:e,network:i=_l.MAINNET})=>{const[n,s]=Ct.useState(!1),[o,l]=Ct.useState(null),[u,c]=Ct.useState(!0),[h,p]=Ct.useState(null);return Ct.useEffect(()=>{(async()=>{var g,m,y,b,v,_,T,E,C,R,B,I,N;if(!r||!e){c(!1);return}try{c(!0);const D=iv[i],P=await fetch(D,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
              query GetTripleUserPosition($tripleId: numeric!, $walletAddress: String!) {
                # Get the triple with vault information
                triple(id: $tripleId) {
                  id
                  subject {
                    label
                  }
                  predicate {
                    label
                  }
                  object {
                    label
                  }
                  vault_id
                  counter_vault_id
                  
                  # Get vault positions
                  vault {
                    id
                    positions_aggregate(where: {account: {id: {_ilike: $walletAddress}}}) {
                      aggregate {
                        count
                      }
                      nodes {
                        id
                      }
                    }
                  }
                  
                  # Get counter vault positions
                  counter_vault {
                    id
                    positions_aggregate(where: {account: {id: {_ilike: $walletAddress}}}) {
                      aggregate {
                        count
                      }
                      nodes {
                        id
                      }
                    }
                  }
                }
              }
            `,variables:{tripleId:Number(e),walletAddress:r.toLowerCase()}})});if(!P.ok)throw new Error(`GraphQL request failed with status ${P.status}`);const k=await P.json();if(k.errors)throw console.error("GraphQL errors:",k.errors),new Error(`GraphQL errors: ${JSON.stringify(k.errors)}`);const q=(g=k.data)==null?void 0:g.triple;if(!q){s(!1),l(null),c(!1);return}const V=((b=(y=(m=q.vault)==null?void 0:m.positions_aggregate)==null?void 0:y.aggregate)==null?void 0:b.count)>0||((T=(_=(v=q.vault)==null?void 0:v.positions_aggregate)==null?void 0:_.nodes)==null?void 0:T.length)>0,j=((R=(C=(E=q.counter_vault)==null?void 0:E.positions_aggregate)==null?void 0:C.aggregate)==null?void 0:R.count)>0||((N=(I=(B=q.counter_vault)==null?void 0:B.positions_aggregate)==null?void 0:I.nodes)==null?void 0:N.length)>0,Q=V||j;s(Q),Q&&l(V),c(!1)}catch(D){console.error("Error checking triple position:",D),p(D),c(!1)}})()},[r,e,i]),{hasPosition:n,isFor:o,loading:u,error:h}},qEe=({voteItem:r,onChangeUnits:e,isVoteDirectionAllowed:i,walletAddress:n="",network:s=_l.MAINNET})=>{const{id:o,subject:l,predicate:u,object:c,units:h,direction:p,vault_position_count:f=0,counter_vault_position_count:g=0,userHasPosition:m=!1,userPositionDirection:y=Er.None}=r,[b,v]=Ct.useState(0),[_,T]=Ct.useState(!1),[E,C]=Ct.useState(!1),{hasPosition:R,isFor:B,loading:I}=Tj({walletAddress:n,tripleId:String(o),network:s}),N=I?m:R,D=I?y:B!==null?B?Er.For:Er.Against:Er.None,P=20;Ct.useEffect(()=>{p===Er.For?v(h):p===Er.Against?v(-h):v(0)},[h,p]);const k=i?i(o,Er.For):!N||D===Er.For,q=i?i(o,Er.Against):!N||D===Er.Against,V=()=>{if(!k)return;const Ae=Math.min(b+1,P);v(Ae),e(o,Er.For,Ae)},j=()=>{if(!k||b<=0)return;const Ae=b-1;v(Ae),Ae===0?e(o,Er.None,0):e(o,Er.For,Ae)},Q=()=>{if(!q)return;const Ae=Math.max(b-1,-20);v(Ae),e(o,Er.Against,Math.abs(Ae))},W=()=>{if(!q||b>=0)return;const Ae=b+1;v(Ae),Ae===0?e(o,Er.None,0):e(o,Er.Against,Math.abs(Ae))},G=p===Er.For&&h>0,z=p===Er.Against&&h>0,te=Number(kI)/10**18*h,Y=N&&D!==Er.None,se=Y&&D===Er.Against?"You cannot vote FOR this claim because you already have an AGAINST position":"",ve=Y&&D===Er.For?"You cannot vote AGAINST this claim because you already have a FOR position":"";return Et.jsxs("div",{style:{padding:"20px",marginBottom:"20px",borderRadius:"8px",backgroundColor:"#0c1228",position:"relative",border:Y?D===Er.For?"2px solid #4CAF50":"2px solid #F44336":"1px solid #1e3b70",boxShadow:"0 4px 10px rgba(0, 0, 0, 0.3)"},children:[h>0&&Et.jsxs("div",{style:{position:"absolute",top:"5px",left:"5px",backgroundColor:"#FFD32A",color:"#000000",padding:"3px 6px",fontSize:"10px",fontWeight:"bold",borderRadius:"4px"},children:[te.toFixed(3)," ETH"]}),Et.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[Et.jsxs("div",{style:{display:"flex",alignItems:"center",position:"relative"},children:[Et.jsx("div",{style:{fontSize:"0.9em",color:"#E1E1E1",marginRight:"10px"},children:"For ▲:"}),D===Er.For||D===Er.None?Et.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[Et.jsx("button",{onClick:k&&b>0?j:void 0,disabled:!k||b<=0,style:{width:"30px",height:"30px",backgroundColor:k&&b>0?"#1e2030":"#606060",border:"none",borderRadius:"4px",color:"#ffffff",fontSize:"16px",cursor:k&&b>0?"pointer":"not-allowed",display:"flex",alignItems:"center",justifyContent:"center",opacity:k&&b>0?1:.4,pointerEvents:k&&b>0?"auto":"none",userSelect:"none"},children:"-"}),Et.jsx("span",{style:{margin:"0 10px",color:"#ffffff",fontWeight:"bold"},children:G?h:0}),Et.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>se&&T(!0),onMouseLeave:()=>se&&T(!1),children:[Et.jsx("button",{onClick:k?V:void 0,disabled:!k,style:{width:"30px",height:"30px",backgroundColor:k?"#1976d2":"#606060",border:!k&&Y?"2px solid #F44336":"none",borderRadius:"4px",color:"#ffffff",fontSize:"16px",cursor:k?"pointer":"not-allowed",display:"flex",alignItems:"center",justifyContent:"center",opacity:k?1:.4,pointerEvents:k?"auto":"none",userSelect:"none"},children:"+"}),(!k&&Y||_&&se)&&Et.jsx("div",{style:{position:"absolute",bottom:"100%",left:"50%",transform:"translateX(-50%)",backgroundColor:"#F44336",color:"white",padding:"5px 10px",borderRadius:"4px",fontSize:"12px",whiteSpace:"nowrap",zIndex:10,marginBottom:"5px"},children:se})]})]}):Et.jsx("div",{style:{backgroundColor:"#606060",borderRadius:"4px",color:"#ffffff",padding:"5px 10px",fontSize:"12px",marginLeft:"10px"},children:"You have voted AGAINST ▼"})]}),Et.jsxs("div",{style:{display:"flex",marginBottom:"20px",gap:"5px",marginTop:"20px"},children:[Et.jsx("span",{style:{backgroundColor:"#FFB300",padding:"4px 8px",borderRadius:"4px",fontSize:"0.9em",color:"#000000",fontWeight:"bold"},children:l}),"-",Et.jsx("span",{style:{backgroundColor:"#ccd3d3",padding:"4px 8px",borderRadius:"4px",fontSize:"0.9em",color:"#000000",fontWeight:"bold"},children:u}),"-",Et.jsx("span",{style:{backgroundColor:"#43A047",padding:"4px 8px",borderRadius:"4px",fontSize:"0.9em",color:"#000000",fontWeight:"bold"},children:c})]}),Et.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[Et.jsx("div",{style:{fontSize:"0.9em",color:"#E1E1E1",marginRight:"10px"},children:"Against ▼:"}),D===Er.Against||D===Er.None?Et.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[Et.jsx("button",{onClick:q&&b<0?W:void 0,disabled:!q||b>=0,style:{width:"30px",height:"30px",backgroundColor:q&&b<0?"#1e2030":"#606060",border:"none",borderRadius:"4px",color:"#ffffff",fontSize:"16px",cursor:q&&b<0?"pointer":"not-allowed",display:"flex",alignItems:"center",justifyContent:"center",opacity:q&&b<0?1:.4,pointerEvents:q&&b<0?"auto":"none",userSelect:"none"},children:"-"}),Et.jsx("span",{style:{margin:"0 10px",color:"#ffffff",fontWeight:"bold"},children:z?h:0}),Et.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>ve&&C(!0),onMouseLeave:()=>ve&&C(!1),children:[Et.jsx("button",{onClick:q?Q:void 0,disabled:!q,style:{width:"30px",height:"30px",backgroundColor:q?"#dc3545":"#606060",border:!q&&Y?"2px solid #4CAF50":"none",borderRadius:"4px",color:"#ffffff",fontSize:"16px",cursor:q?"pointer":"not-allowed",display:"flex",alignItems:"center",justifyContent:"center",opacity:q?1:.4,pointerEvents:q?"auto":"none",userSelect:"none"},children:"+"}),(!q&&Y||E&&ve)&&Et.jsx("div",{style:{position:"absolute",bottom:"100%",left:"50%",transform:"translateX(-50%)",backgroundColor:"#F44336",color:"white",padding:"5px 10px",borderRadius:"4px",fontSize:"12px",whiteSpace:"nowrap",zIndex:10,marginBottom:"5px"},children:ve})]})]}):Et.jsx("div",{style:{backgroundColor:"#606060",borderRadius:"4px",color:"#ffffff",padding:"5px 10px",fontSize:"12px",marginLeft:"10px"},children:"You have voted FOR ▲"})]})]}),Et.jsxs("div",{className:"flex flex-row justify-between",children:[Et.jsxs("div",{style:{fontSize:"0.7em",color:"#4CAF50",marginBottom:"8px",backgroundColor:"rgba(76, 175, 80, 0.1)",padding:"2px 6px",borderRadius:"4px",fontWeight:"bold"},children:[f," positions"]}),Et.jsxs("div",{style:{fontSize:"0.7em",color:"#F44336",marginBottom:"8px",backgroundColor:"rgba(244, 67, 54, 0.1)",padding:"2px 6px",borderRadius:"4px",fontWeight:"bold"},children:[g," positions"]})]})]})},XEe=({isLoading:r,voteItems:e,onChangeUnits:i,isVoteDirectionAllowed:n,walletAddress:s="",network:o=_l.MAINNET})=>r?Et.jsx("div",{style:{textAlign:"center",padding:"30px",color:"#6b7280",fontSize:"1.1em"},children:"Loading claims..."}):Et.jsx("div",{style:{marginBottom:"25px"},children:e.map(l=>Et.jsx(qEe,{voteItem:l,onChangeUnits:i,isVoteDirectionAllowed:n,walletAddress:s,network:o},l.id.toString()))}),YEe=({onSubmit:r,isSubmitting:e,isDepositLoading:i,totalUnits:n,numberOfTransactions:s})=>Et.jsxs("div",{style:{textAlign:"center"},children:[Et.jsx("div",{style:{marginBottom:"15px",fontSize:"0.9em",color:"#6b7280"},children:s>0&&`You will initiate ${s} transaction${s>1?"s":""}`}),Et.jsx("button",{onClick:r,disabled:e||i||n===0,style:{backgroundColor:n>0&&!e&&!i?"#1976d2":"#10172d",color:"#FFF",padding:"12px 30px",border:"none",borderRadius:"8px",fontSize:"1.1em",fontWeight:"bold",cursor:n>0&&!e&&!i?"pointer":"not-allowed",width:"100%",maxWidth:"350px",boxShadow:"0 4px 10px rgba(0, 0, 0, 0.3)",transition:"background-color 0.2s ease"},children:e||i?"Processing...":n>0?`Submit votes (${Sj(n)} ETH)`:"Submit votes"})]}),KEe=({transactionStatus:r})=>r.status==="idle"||r.status==="whitelist_error"?null:Et.jsx("div",{style:{marginTop:"25px",padding:"20px",borderRadius:"8px",backgroundColor:r.status==="pending"?"#10172d":r.status==="approval_pending"?"rgba(255, 211, 42, 0.1)":r.status==="success"?"rgba(0, 128, 0, 0.1)":"rgba(255, 0, 0, 0.1)",color:r.status==="success"?"#4CAF50":r.status==="error"?"#F44336":r.status==="approval_pending"?"#FFD32A":"#FFF",display:"flex",flexDirection:"column",gap:"10px",border:"1px solid #1e3b70"},children:Et.jsx("div",{children:r.message})}),JEe=({walletConnected:r,walletAddress:e,publicClient:i,onClose:n,network:s=_l.MAINNET,onConnectWallet:o,onCreatePlayer:l,wagmiConfig:u,walletHooks:c})=>{const[h,p]=Ct.useState(!1),[f,g]=Ct.useState(!1),[m,y]=Ct.useState(!1),b=e?e.toLowerCase():"",{loading:v,triples:_}=xj(b,Number(fs.IS_PLAYER_GAMES.predicateId),Number(fs.IS_PLAYER_GAMES.objectId),s),T=_.length>0;Ct.useEffect(()=>{y(!!(e&&e!==""))},[e]),Ct.useEffect(()=>{g(!!(m&&!T&&!v))},[m,T,v]);const{voteItems:E,isLoading:C,totalUnits:R,numberOfTransactions:B,handleChangeUnits:I,resetAllVotes:N,isVoteDirectionAllowed:D}=GEe({network:s,walletAddress:b,onError:te=>{j({status:"error",message:te})}}),{submitVotes:P,isSubmitting:k,isDepositLoading:q,transactionStatus:V,setTransactionStatus:j}=jEe({walletConnected:r,walletAddress:e,publicClient:i,network:s,onSuccess:N}),Q=async()=>{await P(E)},W=()=>{g(!1),p(!0),l&&l()},G=()=>{p(!1)},z=()=>{g(!1),n&&n()};return m?m&&!T&&!v?Et.jsxs("div",{style:{backgroundColor:"#070b1a",minHeight:"50vh",color:"#fff",padding:"15px",border:"1px solid #1e3b70",borderRadius:"8px",maxWidth:"960px",margin:"0 auto",position:"relative",boxShadow:"0 4px 15px rgba(0, 0, 0, 0.3)"},children:[Et.jsx(UEe,{isOpen:!0,onCreatePlayer:W,onClose:z}),Et.jsx(o2,{isOpen:h,onClose:G,walletConnected:r,walletAddress:e,wagmiConfig:u,walletHooks:c})]}):Et.jsxs("div",{style:{backgroundColor:"#070b1a",minHeight:"50vh",opacity:"0.9",color:"#fff",padding:"15px",border:"1px solid #1e3b70",borderRadius:"8px",maxWidth:"960px",margin:"0 auto",position:"relative",boxShadow:"0 4px 15px rgba(0, 0, 0, 0.3)"},children:[Et.jsx(QEe,{onClose:n}),Et.jsx(WEe,{numberOfTransactions:B,totalUnits:R,onResetAll:N}),Et.jsx(XEe,{isLoading:C||v,voteItems:E,onChangeUnits:I,isVoteDirectionAllowed:D,walletAddress:b,network:s}),Et.jsx(YEe,{onSubmit:Q,isSubmitting:k,isDepositLoading:q,totalUnits:R,numberOfTransactions:B}),Et.jsx(KEe,{transactionStatus:V})]}):Et.jsx("div",{style:{backgroundColor:"#070b1a",minHeight:"50vh",opacity:"0.9",color:"#fff",padding:"15px",border:"1px solid #1e3b70",borderRadius:"8px",maxWidth:"960px",margin:"0 auto",position:"relative",boxShadow:"0 4px 15px rgba(0, 0, 0, 0.3)"},children:Et.jsx(_j,{isOpen:!0,onConnectWallet:o||(()=>{})})})},ZEe=async(r,e,i=_l.MAINNET)=>{var n,s,o,l,u,c,h,p,f,g,m,y,b;if(!r)throw new Error("Wallet address is required");try{const v=iv[i],_=await fetch(v,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
          query GetTripleUserPosition($tripleId: numeric!, $walletAddress: String!) {
            # Get the triple with vault information
            triple(id: $tripleId) {
              id
              subject {
                label
              }
              predicate {
                label
              }
              object {
                label
              }
              vault_id
              counter_vault_id
              
              # Get vault positions
              vault {
                id
                positions_aggregate(where: {account: {id: {_ilike: $walletAddress}}}) {
                  aggregate {
                    count
                  }
                  nodes {
                    id
                  }
                }
              }
              
              # Get counter vault positions
              counter_vault {
                id
                positions_aggregate(where: {account: {id: {_ilike: $walletAddress}}}) {
                  aggregate {
                    count
                  }
                  nodes {
                    id
                  }
                }
              }
            }
          }
        `,variables:{tripleId:Number(e),walletAddress:r.toLowerCase()}})});if(!_.ok)throw new Error(`GraphQL request failed with status ${_.status}`);const T=await _.json();if(T.errors)throw console.error("GraphQL errors:",T.errors),new Error(`GraphQL errors: ${JSON.stringify(T.errors)}`);const E=(n=T.data)==null?void 0:n.triple;if(!E)return{hasPosition:!1,isFor:null,result:T.data};const C=((l=(o=(s=E.vault)==null?void 0:s.positions_aggregate)==null?void 0:o.aggregate)==null?void 0:l.count)>0||((h=(c=(u=E.vault)==null?void 0:u.positions_aggregate)==null?void 0:c.nodes)==null?void 0:h.length)>0,R=((g=(f=(p=E.counter_vault)==null?void 0:p.positions_aggregate)==null?void 0:f.aggregate)==null?void 0:g.count)>0||((b=(y=(m=E.counter_vault)==null?void 0:m.positions_aggregate)==null?void 0:y.nodes)==null?void 0:b.length)>0,B=C||R;return{hasPosition:B,isFor:B?C:null,result:T.data}}catch(v){throw console.error("Error checking triple position:",v),v}},$Ee={init:r=>{if(!r.apiUrl)throw new Error("L'URL de l'API est obligatoire pour initialiser Player-map");return lW(r),!0},get:$v},ewe={setAuthToken:t2,getAuthToken:Zv,isAuthenticated:O0,clearAuthToken:ID,initialize:r=>r?(t2(r),!0):!1};ps.ClaimVoting=JEe,ps.GraphComponent=zEe,ps.PREDEFINED_CLAIM_IDS=Ej,ps.PlayerMapConfig=$Ee,ps.PlayerMapGraph=bj,ps.PlayerMapHome=Vw,ps.RegistrationForm=o2,ps.UNIT_VALUE=kI,ps.VoteDirection=Er,ps.auth=ewe,ps.checkTriplePosition=ZEe,ps.clearAuthToken=ID,ps.default=Vw,ps.getAuthToken=Zv,ps.isAuthenticated=O0,ps.setAuthToken=t2,ps.useCheckSpecificTriplePosition=Tj,ps.useDepositTriple=wj,ps.useDisplayTriplesWithPosition=Cj,Object.defineProperties(ps,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
